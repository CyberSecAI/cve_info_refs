=== Content from lists.launchpad.net_5bc02562_20250124_210721.html ===

[‚Üê
Back to team overview](https://launchpad.net/~dulwich-users)
# dulwich-users team mailing list archive

* [Thread](maillist.html)
* [Date](date.html)

1. ![](https://launchpad.net/@@/team)
   [dulwich-users team](https://launchpad.net/~dulwich-users)
2. [Mailing list archive](maillist.html)
3. Message #00829

## Dulwich security issue

|  | [Thread Previous](msg00826.html) ‚Ä¢ [Date Previous](msg00828.html) ‚Ä¢ [Date Next](msg00830.html) ‚Ä¢ [Thread Next](msg00830.html) |
| --- | --- |

* ****To****:
  dulwich-users@xxxxxxxxxxxxxxxxxxx, oss-security@xxxxxxxxxxxxxxxxxx
* ****From****:
  Jelmer Vernooij <jelmer@xxxxxxxxx>
* ****Date****:
  Sun, 22 Mar 2015 00:20:22 +0000
* ****Cc****:
  jelmer@xxxxxxxxxx
* ****Reply-to****:
  jelmer@xxxxxxxxx
* ****User-agent****:
  Mutt/1.5.23 (2014-03-12)

---

```
Ivan Fratric of the Google Security Team has found a buffer overflow
in the C implementation of the apply_delta() function in Dulwich. This
function is used when accessing Git objects in pack files. Any
Git server or client based on Dulwich that handles untrusted pack
files is very likely to be vulnerable.

This issue has been assigned CVE-2015-0838.

I have attached patches against current HEAD and 0.9.8.
Dulwich 0.9.9 has been released with just this patch.

Tarball available here:
<https://pypi.python.org/packages/source/d/dulwich/dulwich-0.9.9.tar.gz>

GPG signature:
<https://pypi.python.org/packages/source/d/dulwich/dulwich-0.9.9.tar.gz.asc>

Cheers,

Jelmer

```
```
Author: Jelmer Vernooƒ≥ <jelmer@xxxxxxxxxx>
Date:   Fri Mar 6 12:29:07 2015 +0000

    Fix buffer overflow in C version of apply_delta().

    This is CVE-2015-0838.

    Thanks to Ivan Fratric of the Google Security Team for
    reporting this issue.

diff --git a/NEWS b/NEWS
index 4d3c1ce..73f0e26 100644
--- a/NEWS
+++ b/NEWS
@@ -1,3 +1,14 @@
+0.9.9	2015-03-20
+
+ SECURITY BUG FIXES
+
+  * Fix buffer overflow in C implementation of pack apply_delta().
+    (CVE-2015-0838)
+
+    Thanks to Ivan Fratric of the Google Security Team for
+    reporting this issue.
+    (Jelmer Vernooij)
+
 0.9.8	2014-11-30

  BUG FIXES
diff --git a/dulwich/__init__.py b/dulwich/__init__.py
index 35d9808..bc36593 100644
--- a/dulwich/__init__.py
+++ b/dulwich/__init__.py
@@ -21,4 +21,4 @@

 """Python implementation of the Git file formats and protocols."""

-__version__ = (0, 9, 8)
+__version__ = (0, 9, 9)
diff --git a/dulwich/_pack.c b/dulwich/_pack.c
index d1534a5..8a8912e 100644
--- a/dulwich/_pack.c
+++ b/dulwich/_pack.c
@@ -146,10 +146,14 @@ static PyObject *py_apply_delta(PyObject *self, PyObject *args)
 				break;
 			memcpy(out+outindex, src_buf+cp_off, cp_size);
 			outindex += cp_size;
+			dest_size -= cp_size;
 		} else if (cmd != 0) {
+			if (cmd > dest_size)
+				break;
 			memcpy(out+outindex, delta+index, cmd);
 			outindex += cmd;
 			index += cmd;
+			dest_size -= cmd;
 		} else {
 			PyErr_SetString(PyExc_ValueError, "Invalid opcode 0");
 			Py_DECREF(ret);
@@ -167,7 +171,7 @@ static PyObject *py_apply_delta(PyObject *self, PyObject *args)
 		return NULL;
 	}

-	if (dest_size != outindex) {
+	if (dest_size != 0) {
 		PyErr_SetString(PyExc_ValueError, "dest size incorrect");
 		Py_DECREF(ret);
 		return NULL;
diff --git a/dulwich/tests/test_pack.py b/dulwich/tests/test_pack.py
index 666a639..53e4a22 100644
--- a/dulwich/tests/test_pack.py
+++ b/dulwich/tests/test_pack.py
@@ -191,6 +191,14 @@ class TestPackDeltas(TestCase):
         self._test_roundtrip(self.test_string_huge + self.test_string1,
                              self.test_string_huge + self.test_string2)

+    def test_dest_overflow(self):
+        self.assertRaises(
+            ValueError,
+            apply_delta, 'a'*0x10000, '\x80\x80\x04\x80\x80\x04\x80' + 'a'*0x10000)
+        self.assertRaises(
+            ValueError,
+            apply_delta, '', '\x00\x80\x02\xb0\x11\x11')
+

 @skipIfPY3
 class TestPackData(PackTests):
diff --git a/setup.py b/setup.py
index 89be710..7a03845 100755
--- a/setup.py
+++ b/setup.py
@@ -8,7 +8,7 @@ except ImportError:
     from distutils.core import setup, Extension
 from distutils.core import Distribution

-dulwich_version_string = '0.9.8'
+dulwich_version_string = '0.9.9'

 include_dirs = []
 # Windows MSVC support

```
```
commit 1c7e06f6ae53cf4a755fe734db7114be67daf35b
Author: Jelmer Vernooƒ≥ <jelmer@xxxxxxxxxx>
Date:   Fri Mar 6 12:29:07 2015 +0000

    Fix buffer overflow in C version of apply_delta().

    This is CVE-2015-0838.

    Thanks to Ivan Fratric of the Google Security Team for
    reporting this issue.

diff --git a/NEWS b/NEWS
index 822dab0..71db58f 100644
--- a/NEWS
+++ b/NEWS
@@ -1,5 +1,14 @@
 0.9.9	UNRELEASED

+ SECURITY BUG FIXES
+
+  * Fix buffer overflow in C implementation of pack apply_delta().
+    (CVE-2015-0838)
+
+    Thanks to Ivan Fratric of the Google Security Team for
+    reporting this issue.
+    (Jelmer Vernooij)
+
  BUG FIXES

   * In dulwich.index.build_index_from_tree, by default
diff --git a/dulwich/_pack.c b/dulwich/_pack.c
index d1534a5..8a8912e 100644
--- a/dulwich/_pack.c
+++ b/dulwich/_pack.c
@@ -146,10 +146,14 @@ static PyObject *py_apply_delta(PyObject *self, PyObject *args)
 				break;
 			memcpy(out+outindex, src_buf+cp_off, cp_size);
 			outindex += cp_size;
+			dest_size -= cp_size;
 		} else if (cmd != 0) {
+			if (cmd > dest_size)
+				break;
 			memcpy(out+outindex, delta+index, cmd);
 			outindex += cmd;
 			index += cmd;
+			dest_size -= cmd;
 		} else {
 			PyErr_SetString(PyExc_ValueError, "Invalid opcode 0");
 			Py_DECREF(ret);
@@ -167,7 +171,7 @@ static PyObject *py_apply_delta(PyObject *self, PyObject *args)
 		return NULL;
 	}

-	if (dest_size != outindex) {
+	if (dest_size != 0) {
 		PyErr_SetString(PyExc_ValueError, "dest size incorrect");
 		Py_DECREF(ret);
 		return NULL;
diff --git a/dulwich/tests/test_pack.py b/dulwich/tests/test_pack.py
index 5caed6d..e8ffb8c 100644
--- a/dulwich/tests/test_pack.py
+++ b/dulwich/tests/test_pack.py
@@ -191,6 +191,14 @@ class TestPackDeltas(TestCase):
         self._test_roundtrip(self.test_string_huge + self.test_string1,
                              self.test_string_huge + self.test_string2)

+    def test_dest_overflow(self):
+        self.assertRaises(
+            ValueError,
+            apply_delta, 'a'*0x10000, '\x80\x80\x04\x80\x80\x04\x80' + 'a'*0x10000)
+        self.assertRaises(
+            ValueError,
+            apply_delta, '', '\x00\x80\x02\xb0\x11\x11')
+

 @skipIfPY3
 class TestPackData(PackTests):

```

**Attachment:
[signature.asc](pgpU6CNLKWGw4.pgp)**

*Description:* Digital signature

---

|  | [Thread Previous](msg00826.html) ‚Ä¢ [Date Previous](msg00828.html) ‚Ä¢ [Date Next](msg00830.html) ‚Ä¢ [Thread Next](msg00830.html) |
| --- | --- |

[![Launchpad](https://launchpad.net/@@/launchpad-logo-and-name-hierarchy.png)](https://launchpad.net/)
¬†‚Ä¢
[Take the tour](https://launchpad.net/%2Btour)
¬†‚Ä¢
[Read the guide](https://help.launchpad.net/)
¬†‚Ä¢
[Help for mailing lists](https://help.launchpad.net/Teams/MailingLists)

¬© 2004-2012
[Canonical¬†Ltd.](http://canonical.com/)
¬†‚Ä¢
[Terms of use](https://launchpad.net/legal)
¬†‚Ä¢
[Contact Launchpad Support](/support)
¬†‚Ä¢
[System status](http://identi.ca/launchpadstatus)



=== Content from www.debian.org_fbbb0409_20250124_210721.html ===


---

[[Date Prev](msg00092.html)][[Date Next](msg00094.html)]
[[Thread Prev](msg00092.html)][[Thread Next](msg00094.html)]
[[Date Index](maillist.html#00093)]
[[Thread Index](threads.html#00093)]

# [SECURITY] [DSA 3206-1] dulwich security update

---

* *To*: debian-security-announce@lists.debian.org
* *Subject*: [SECURITY] [DSA 3206-1] dulwich security update
* *From*: Salvatore Bonaccorso <carnil@debian.org>
* *Date*: Sat, 28 Mar 2015 13:22:01 +0000
* *Message-id*: <[[üîé]](/msgid-search/E1Ybqgb-0006M9-5D%40master.debian.org)¬†[E1Ybqgb-0006M9-5D@master.debian.org](msg00093.html)>
* *Reply-to*: debian-security@lists.debian.org

---

```
-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA512

- -------------------------------------------------------------------------
Debian Security Advisory DSA-3206-1                   security@debian.org
<http://www.debian.org/security/>                      Salvatore Bonaccorso
March 28, 2015                         <http://www.debian.org/security/faq>
- -------------------------------------------------------------------------

Package        : dulwich
CVE ID         : CVE-2014-9706 CVE-2015-0838
Debian Bug     : 780958 780989

Multiple vulnerabilities have been discovered in Dulwich, a Python
implementation of the file formats and protocols used by the Git version
control system. The Common Vulnerabilities and Exposures project
identifies the following problems:

CVE-2014-9706

    It was discovered that Dulwich allows writing to files under .git/
    when checking out working trees. This could lead to the execution of
    arbitrary code with the privileges of the user running an
    application based on Dulwich.

CVE-2015-0838

    Ivan Fratric of the Google Security Team has found a buffer
    overflow in the C implementation of the apply_delta() function,
    used when accessing Git objects in pack files. An attacker could
    take advantage of this flaw to cause the execution of arbitrary
    code with the privileges of the user running a Git server or client
    based on Dulwich.

For the stable distribution (wheezy), these problems have been fixed in
version 0.8.5-2+deb7u2.

For the upcoming stable distribution (jessie), these problems have been
fixed in version 0.9.7-3.

For the unstable distribution (sid), these problems have been fixed in
version 0.10.1-1.

We recommend that you upgrade your dulwich packages.

Further information about Debian Security Advisories, how to apply
these updates to your system and frequently asked questions can be
found at: <https://www.debian.org/security/>

Mailing list: debian-security-announce@lists.debian.org
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1

iQIcBAEBCgAGBQJVFqrBAAoJEAVMuPMTQ89EXMIQAJTFthRtXilrRtR2zW2h254v
PjR2wH/Hx+9CUTTFinYea9IM1J3OldiTs4Kzie6imI8ZAkla0XKVgmCYAFGSuR29
leyGgF/q62CzJkY+qiK1RAhWmCKNxt5nawhxo2Ss3BQL3YgwfaVAUZplkbTWsoNw
N2o/g0/9CQCkj8fUy+WbzPiLlZ1q6sZLgTKXtc3RCFQmF6zOCSHieruDrjeFPpJh
H1sw5fxsuwgibuOMHD+2vqXNCUNO+fWNfr5vmLQuIdqLuGX5E7b8k0fujQvcOJP2
TCDaMC8wrPLEWToH0qXhL/FwCkI0tpKJCzXS0XwwF3E5UwEjtkzWylGhxPBuP2mw
wt1nBng18EBGu58Iaoo/9DoM58Nan6auDinLYaciBPH+Q1221EWUqBZO5yOAhxDM
xD9o/QKEVFqq9Q3dk6Vxekf4WERDIbsBN1B7SA9+pHO3GYaMcwAOhUmdaRyuweWq
9dlCwoyagkYxljo+ZW1WCFvClrmF42hdv+H4sg6DD7MLzB+feQBzTUWxW12rTHU0
B8f6aA47Ccm7Ht8OEF93ojvfHurOF7S3T+qsqT/g2M8pEH/Q6sSq+YpOEY3J2IOs
JEbLf4eNgqRoL0/N12tE5d+9UvTlVMw9kFeeBrm8Yz4fwq4MHd5I28UX96AUhhvV
ymN7Sgsu5iQwJLa0CCoD
=OotG
-----END PGP SIGNATURE-----

```

---


