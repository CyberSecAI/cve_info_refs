=== Content from github.com_a700a820_20250124_175722.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fthoughtbot%2Fpaperclip%2Fcommit%2F9aee4112f36058cd28d5fe4a006d6981bd1eda57)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fthoughtbot%2Fpaperclip%2Fcommit%2F9aee4112f36058cd28d5fe4a006d6981bd1eda57)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=thoughtbot%2Fpaperclip)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

This repository has been archived by the owner on Jul 13, 2023. It is now read-only.

[thoughtbot](/thoughtbot)
/
**[paperclip](/thoughtbot/paperclip)**
Public archive

* [Notifications](/login?return_to=%2Fthoughtbot%2Fpaperclip) You must be signed in to change notification settings
* [Fork
  2.4k](/login?return_to=%2Fthoughtbot%2Fpaperclip)
* [Star
   9k](/login?return_to=%2Fthoughtbot%2Fpaperclip)

* [Code](/thoughtbot/paperclip)
* [Issues
  39](/thoughtbot/paperclip/issues)
* [Pull requests
  15](/thoughtbot/paperclip/pulls)
* [Actions](/thoughtbot/paperclip/actions)
* [Wiki](/thoughtbot/paperclip/wiki)
* [Security](/thoughtbot/paperclip/security)
* [Insights](/thoughtbot/paperclip/pulse)

Additional navigation options

* [Code](/thoughtbot/paperclip)
* [Issues](/thoughtbot/paperclip/issues)
* [Pull requests](/thoughtbot/paperclip/pulls)
* [Actions](/thoughtbot/paperclip/actions)
* [Wiki](/thoughtbot/paperclip/wiki)
* [Security](/thoughtbot/paperclip/security)
* [Insights](/thoughtbot/paperclip/pulse)

## Commit

[Permalink](/thoughtbot/paperclip/commit/9aee4112f36058cd28d5fe4a006d6981bd1eda57)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Fix a possible security issue with spoofing

[Browse files](/thoughtbot/paperclip/tree/9aee4112f36058cd28d5fe4a006d6981bd1eda57)
Browse the repository at this point in the history

```
Thanks to MORI Shingo of DeNA Co., Ltd. for reporting this.

There is an issue where if an HTML file is uploaded with a .html
extension, but the content type is listed as being `image/jpeg`, this
will bypass a validation checking for images. But it will also pass the
spoof check, because a file named .html and containing actual HTML
passes the spoof check.

This change makes it so that we also check the supplied content type. So
even if the file contains HTML and ends with .html, it doesn't match the
content type of `image/jpeg` and so it fails.
```

* Loading branch information

[![@tute](https://avatars.githubusercontent.com/u/54260?s=40&v=4)](/tute)

Jon Yurek
authored and
[tute](/thoughtbot/paperclip/commits?author=tute "View all commits by tute")
committed
Jun 5, 2015

1 parent
[ea1fc3c](/thoughtbot/paperclip/commit/ea1fc3c89743192d8ad906ecb4ced99bb1497957)

commit 9aee411

 Show file tree

 Hide file tree

Showing
**6 changed files**
with
**54 additions**
and
**20 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* NEWS
  [NEWS](#diff-7ee66c4f1536ac84dc5bbff1b8312e2eef24b974b3e48a5c5c2bcfdf2eb8f3ce)
* lib/paperclip

  + locales

    - lib/paperclip/locales/en.yml
      [en.yml](#diff-07ea91fc74e4940711a7ff68cc2d912f86e5562d51d1b3c308d4e99e5250b655)
  + lib/paperclip/media\_type\_spoof\_detector.rb
    [media\_type\_spoof\_detector.rb](#diff-5cc8fa502cbf41633efa339c06cc54d70b58ecb86b00c0ba658b75395d5df13b)
  + validators

    - lib/paperclip/validators/media\_type\_spoof\_detection\_validator.rb
      [media\_type\_spoof\_detection\_validator.rb](#diff-12810771e7a23b46df87f51f7c7206b62ddc542c2a9a904226056be0f2e7773a)
* spec/paperclip

  + spec/paperclip/media\_type\_spoof\_detector\_spec.rb
    [media\_type\_spoof\_detector\_spec.rb](#diff-924eb3a1cb3d00484f3bc096c8ad7bcd08b4ca74bc9fe43016e21066c37adc19)
  + validators

    - spec/paperclip/validators/media\_type\_spoof\_detection\_validator\_spec.rb
      [media\_type\_spoof\_detection\_validator\_spec.rb](#diff-e7a2f4e79e4d587aac7ed0d869b46a32499b458a3ae88c680a6cf6616a9081f6)

## There are no files selected for viewing

4 changes: 4 additions & 0 deletions

4
[NEWS](#diff-7ee66c4f1536ac84dc5bbff1b8312e2eef24b974b3e48a5c5c2bcfdf2eb8f3ce "NEWS")

Show comments

[View file](/thoughtbot/paperclip/blob/9aee4112f36058cd28d5fe4a006d6981bd1eda57/NEWS)
Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

|  |  | @@ -1,3 +1,7 @@ |
|  |  | New in 4.2.2: |
|  |  |  |
|  |  | \* Security fix: Fix a potential security issue with spoofing |
|  |  |  |
|  |  | New in 4.2.1: |
|  |  |  |
|  |  | \* Improvement: Added `validate\_media\_type` options to allow/bypass spoof check |
| Expand Down | |  |

2 changes: 1 addition & 1 deletion

2
[lib/paperclip/locales/en.yml](#diff-07ea91fc74e4940711a7ff68cc2d912f86e5562d51d1b3c308d4e99e5250b655 "lib/paperclip/locales/en.yml")

Show comments

[View file](/thoughtbot/paperclip/blob/9aee4112f36058cd28d5fe4a006d6981bd1eda57/lib/paperclip/locales/en.yml)
Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -2,7 +2,7 @@ en: |
|  |  | errors: |
|  |  | messages: |
|  |  | in\_between: "must be in between %{min} and %{max}" |
|  |  | spoofed\_media\_type: "has an extension that does not match its contents" |
|  |  | spoofed\_media\_type: "has contents that are not what they are reported to be" |
|  |  |  |
|  |  | number: |
|  |  | human: |
| Expand Down | |  |

54 changes: 37 additions & 17 deletions

54
[lib/paperclip/media\_type\_spoof\_detector.rb](#diff-5cc8fa502cbf41633efa339c06cc54d70b58ecb86b00c0ba658b75395d5df13b "lib/paperclip/media_type_spoof_detector.rb")

Show comments

[View file](/thoughtbot/paperclip/blob/9aee4112f36058cd28d5fe4a006d6981bd1eda57/lib/paperclip/media_type_spoof_detector.rb)
Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -1,18 +1,21 @@ |
|  |  | module Paperclip |
|  |  | class MediaTypeSpoofDetector |
|  |  | def self.using(file, name) |
|  |  | new(file, name) |
|  |  | def self.using(file, name, content\_type) |
|  |  | new(file, name, content\_type) |
|  |  | end |
|  |  |  |
|  |  | def initialize(file, name) |
|  |  | def initialize(file, name, content\_type) |
|  |  | @file = file |
|  |  | @name = name |
|  |  | @content\_type = content\_type || "" |
|  |  | end |
|  |  |  |
|  |  | def spoofed? |
|  |  | if has\_name? && has\_extension? && media\_type\_mismatch? && mapping\_override\_mismatch? |
|  |  | Paperclip.log("Content Type Spoof: Filename #{File.basename(@name)} (#{supplied\_file\_content\_types}), content type discovered from file command: #{calculated\_content\_type}. See documentation to allow this combination.") |
|  |  | Paperclip.log("Content Type Spoof: Filename #{File.basename(@name)} (#{supplied\_content\_type} from Headers, #{content\_types\_from\_name} from Extension), content type discovered from file command: #{calculated\_content\_type}. See documentation to allow this combination.") |
|  |  | true |
|  |  | else |
|  |  | false |
|  |  | end |
|  |  | end |
|  |  |  |
| Expand All | | @@ -27,35 +30,44 @@ def has\_extension? |
|  |  | end |
|  |  |  |
|  |  | def media\_type\_mismatch? |
|  |  | ! supplied\_file\_media\_types.include?(calculated\_media\_type) |
|  |  | supplied\_type\_mismatch? || calculated\_type\_mismatch? |
|  |  | end |
|  |  |  |
|  |  | def supplied\_type\_mismatch? |
|  |  | supplied\_media\_type.present? && !media\_types\_from\_name.include?(supplied\_media\_type) |
|  |  | end |
|  |  |  |
|  |  | def calculated\_type\_mismatch? |
|  |  | !media\_types\_from\_name.include?(calculated\_media\_type) |
|  |  | end |
|  |  |  |
|  |  | def mapping\_override\_mismatch? |
|  |  | mapped\_content\_type != calculated\_content\_type |
|  |  | end |
|  |  |  |
|  |  | def supplied\_file\_media\_types |
|  |  | @supplied\_file\_media\_types ||= MIME::Types.type\_for(@name).collect(&:media\_type) |
|  |  |  |
|  |  | def supplied\_content\_type |
|  |  | @content\_type |
|  |  | end |
|  |  |  |
|  |  | def calculated\_media\_type |
|  |  | @calculated\_media\_type ||= calculated\_content\_type.split("/").first |
|  |  | def supplied\_media\_type |
|  |  | @content\_type.split("/").first |
|  |  | end |
|  |  |  |
|  |  | def supplied\_file\_content\_types |
|  |  | @supplied\_file\_content\_types ||= MIME::Types.type\_for(@name).collect(&:content\_type) |
|  |  | def content\_types\_from\_name |
|  |  | @content\_types\_from\_name ||= MIME::Types.type\_for(@name) |
|  |  | end |
|  |  |  |
|  |  | def calculated\_content\_type |
|  |  | @calculated\_content\_type ||= type\_from\_file\_command.chomp |
|  |  | def media\_types\_from\_name |
|  |  | @media\_types\_from\_name ||= content\_types\_from\_name.collect(&:media\_type) |
|  |  | end |
|  |  |  |
|  |  | def mapped\_content\_type |
|  |  | Paperclip.options[:content\_type\_mappings][filename\_extension] |
|  |  | def calculated\_content\_type |
|  |  | @calculated\_content\_type ||= type\_from\_file\_command.chomp |
|  |  | end |
|  |  |  |
|  |  | def filename\_extension |
|  |  | File.extname(@name.to\_s.downcase).sub(/^\./, '').to\_sym |
|  |  | def calculated\_media\_type |
|  |  | @calculated\_media\_type ||= calculated\_content\_type.split("/").first |
|  |  | end |
|  |  |  |
|  |  | def type\_from\_file\_command |
| Expand All | | @@ -65,5 +77,13 @@ def type\_from\_file\_command |
|  |  | "" |
|  |  | end |
|  |  | end |
|  |  |  |
|  |  | def mapped\_content\_type |
|  |  | Paperclip.options[:content\_type\_mappings][filename\_extension] |
|  |  | end |
|  |  |  |
|  |  | def filename\_extension |
|  |  | File.extname(@name.to\_s.downcase).sub(/^\./, '').to\_sym |
|  |  | end |
|  |  | end |
|  |  | end |

2 changes: 1 addition & 1 deletion

2
[lib/paperclip/validators/media\_type\_spoof\_detection\_validator.rb](#diff-12810771e7a23b46df87f51f7c7206b62ddc542c2a9a904226056be0f2e7773a "lib/paperclip/validators/media_type_spoof_detection_validator.rb")

Show comments

[View file](/thoughtbot/paperclip/blob/9aee4112f36058cd28d5fe4a006d6981bd1eda57/lib/paperclip/validators/media_type_spoof_detection_validator.rb)
Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -5,7 +5,7 @@ module Validators |
|  |  | class MediaTypeSpoofDetectionValidator < ActiveModel::EachValidator |
|  |  | def validate\_each(record, attribute, value) |
|  |  | adapter = Paperclip.io\_adapters.for(value) |
|  |  | if Paperclip::MediaTypeSpoofDetector.using(adapter, value.original\_filename).spoofed? |
|  |  | if Paperclip::MediaTypeSpoofDetector.using(adapter, value.original\_filename, value.content\_type).spoofed? |
|  |  | record.errors.add(attribute, :spoofed\_media\_type) |
|  |  | end |
|  |  | end |
| Expand Down | |  |

10 changes: 10 additions & 0 deletions

10
[spec/paperclip/media\_type\_spoof\_detector\_spec.rb](#diff-924eb3a1cb3d00484f3bc096c8ad7bcd08b4ca74bc9fe43016e21066c37adc19 "spec/paperclip/media_type_spoof_detector_spec.rb")

Show comments

[View file](/thoughtbot/paperclip/blob/9aee4112f36058cd28d5fe4a006d6981bd1eda57/spec/paperclip/media_type_spoof_detector_spec.rb)
Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -43,4 +43,14 @@ |
|  |  | Paperclip.options[:content\_type\_mappings] = {} |
|  |  | end |
|  |  | end |
|  |  |  |
|  |  | it "rejects a file if named .html and is as HTML, but we're told JPG" do |
|  |  | file = File.open(fixture\_file("empty.html")) |
|  |  | assert Paperclip::MediaTypeSpoofDetector.using(file, "empty.html", "image/jpg").spoofed? |
|  |  | end |
|  |  |  |
|  |  | it "does not reject is content\_type is empty but otherwise checks out" do |
|  |  | file = File.open(fixture\_file("empty.html")) |
|  |  | assert ! Paperclip::MediaTypeSpoofDetector.using(file, "empty.html", "").spoofed? |
|  |  | end |
|  |  | end |

2 changes: 1 addition & 1 deletion

2
[spec/paperclip/validators/media\_type\_spoof\_detection\_validator\_spec.rb](#diff-e7a2f4e79e4d587aac7ed0d869b46a32499b458a3ae88c680a6cf6616a9081f6 "spec/paperclip/validators/media_type_spoof_detection_validator_spec.rb")

Show comments

[View file](/thoughtbot/paperclip/blob/9aee4112f36058cd28d5fe4a006d6981bd1eda57/spec/paperclip/validators/media_type_spoof_detection_validator_spec.rb)
Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -30,7 +30,7 @@ def build\_validator(options = {}) |
|  |  | Paperclip::MediaTypeSpoofDetector.stubs(:using).returns(detector) |
|  |  | @validator.validate(@dummy) |
|  |  |  |
|  |  | assert\_equal "has an extension that does not match its contents", @dummy.errors[:avatar].first |
|  |  | assert\_equal I18n.t("errors.messages.spoofed\_media\_type"), @dummy.errors[:avatar].first |
|  |  | end |
|  |  |  |
|  |  | it "runs when attachment is dirty" do |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `9aee411`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fthoughtbot%2Fpaperclip%2Fcommit%2F9aee4112f36058cd28d5fe4a006d6981bd1eda57) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from robots.thoughtbot.com_502ccd1c_20250126_024133.html ===


[Skip to main content](#main)
[thoughtbot
thoughtbot](/)
Search thoughtbot.com

Menu

Search thoughtbot.com

Close Menu

* [Live on Twitch!

  #### thoughtbot is livestreaming

  Work alongside the thoughtbot team as we collaborate with each other and our clients, live. Ask us anything, we're live right now!](https://www.twitch.tv/thoughtbot)
* Services
* [Case Studies](/case-studies)
* [Blog](/blog)
* Resources
* [Let’s Talk](/hire-us)

[Live on Twitch!

#### thoughtbot is livestreaming

Work alongside the thoughtbot team as we collaborate with each other and our clients, live. Ask us anything, we're live right now!](https://www.twitch.tv/thoughtbot)
Search thoughtbot.com

 [Let’s get started!](/hire-us)

Back

[View all Services](/services)
Development

* [Ruby on Rails](/services/ruby-on-rails-development)
* [Hotwire](/services/hotwire-stimulus-turbo-frontend-development)
* [AI and Machine Learning](/services/machine-learning-artificial-intelligence-ai)
* [Maintenance](/services/rails-maintenance)
* [Mobile](/services/mobile-development)

Design

* [Discovery Sprints](/services/discovery-sprint)
* [UX, UI, and Product Design](/services/product-design)
* [Design Systems](/services/design-systems)

Product

* [Product Management](/services/product-management)
* [Accessibility](/services/product-accessibility)

Team and Processes

* [Team Augmentation](/services/team-augmentation)
* [Fractional Leadership](/services/fractional-product-technical-leadership)

[View all Services](/services)

Back

[View all Resources](/resources)
[Development](https://thoughtbot.com/resources#development-resources-learn-from-our-development-team)

* [Tech Leadership Resources](/resources/tech-leadership)
* [Open Source](https://thoughtbot.com/open-source)
* [Books](https://thoughtbot.com/resources#books-take-one-off-the-thoughtbot-bookshelf)
* [The Bike Shed Podcast](https://bikeshed.thoughtbot.com/)
* [Live Streaming on YouTube](https://www.youtube.com/%40thoughtbot/streams)
* [Conference Talks](https://www.youtube.com/playlist?list=PL8tzorAO7s0g57gv25kLcHLTIyIBdEVyX)

The business of great software

* [Playbook](https://thoughtbot.com/playbook)
* [Purpose Built](https://thoughtbot.com/purpose-built)
* [Giant Robots Smashing Into Other Giant Robots Podcast](https://podcast.thoughtbot.com/)
* [Design Sprint Guide](https://design.thoughtbot.com/sprint-guide/)
* [Live Streaming on LinkedIn](https://www.linkedin.com/company/thoughtbot-inc-/events)

[View all Resources](/resources)

# Paperclip Security Release

[Tute Costa](/blog/authors/tute-costa)
June 5, 2015
 updated on
October 6, 2015

* [News](/blog/tags/news)
* [Web](/blog/tags/web)
* [Open Source](/blog/tags/open-source)
* [Security](/blog/tags/security)
* [Ruby](/blog/tags/ruby)
* [Paperclip](/blog/tags/paperclip)

We just released paperclip v4.2.2. This contains only a security patch over
v4.2.1, and everyone is encouraged to upgrade. The [commit message](https://github.com/thoughtbot/paperclip/commit/9aee4112f36058cd28d5fe4a006d6981bd1eda57) explains the
problem and fix:

> There is an issue where if an HTML file is uploaded with a .html extension, but the content type is listed as being `image/jpeg`, this will bypass a validation checking for images. But it will also pass the spoof check, because a file named .html and containing actual HTML passes the spoof check.
>
> This change makes it so that we also check the supplied content type. So even if the file contains HTML and ends with .html, it doesn’t match the content type of `image/jpeg` and so it fails.

This vulnerability was assigned [JVN #83881261](https://jvn.jp/en/jp/JVN83881261/).

[paperclip](https://rubygems.org/gems/paperclip) is a Rubygem that that lets you attach files to ActiveRecord
models.

Thanks to Jon Yurek and Mike Burns for their work on this, and special thanks to
MORI Shingo of DeNA Co., Ltd. for reporting the vulnerability.

## If you enjoyed this post, you might also like:

1. [Prevent Spoofing with Paperclip](/blog/prevent-spoofing-with-paperclip)
2. [Paperclip IS vulnerable to ImageTragick](/blog/paperclip-is-vulnerable-to-the-imagetragick-vulnerability)
3. [Update Your Gems: Security Vulnerability in Cocaine](/blog/update-your-gems-security-vulnerability-in-cocaine)

## Sign up to receive a weekly recap from thoughtbot

Your email address

Subscribe

## Footer

thoughtbot

* [Services](/services)
* [Case Studies](/case-studies)
* [Resources](/resources)
* [Let's Talk](/hire-us)

* [Our Company](/our-company)
* [Careers](/jobs)
* [Purpose](/purpose)
* [Blog](/blog)
* [Sponsor](https://github.com/sponsors/thoughtbot)

* [Mastodon](https://thoughtbot.social/%40thoughtbot)
* [GitHub](https://github.com/thoughtbot)
* [Instagram](https://www.instagram.com/thoughtbot/)
* [YouTube](https://www.youtube.com/%40thoughtbot)
* [Twitch](https://www.twitch.tv/thoughtbot)

© 2025
thoughtbot, inc.

The design of a robot and thoughtbot are registered trademarks of thoughtbot, inc.

* US: +1 (877) 9-ROBOTS
* UK: +44 (0)20 3807 0560

* Beware of fraudulent thoughtbot job listings [Learn more](https://thoughtbot.com/blog/fraud-alert-scammers-using-thoughtbot-name-and-logo-for-fake-app-optimization-job)

* [Code of Conduct](/conduct)
* [Accessibility Statement](/accessibility-statement)
* [Privacy Policy](//www.iubenda.com/privacy-policy/7827608)



=== Content from jvndb.jvn.jp_9bd9e5f5_20250124_175720.html ===


![JVN iPedia](/en/common/img/en_logo.gif)
Last Updated:2015/07/14

| [[Japanese]](/ja/contents/2015/JVNDB-2015-000088.html) | |
| --- | --- |
| JVNDB-2015-000088 | |
| Ruby on Rails library Paperclip vulnerable to cross-site scripting | |
| Overview | |
| Paperclip provided by thoughtbot is a library to upload files in Ruby on Rails. Paperclip contains a persistent cross-site scripting vulnerability (CWE-79). | |
| CVSS Severity ([What is CVSS?](/en/nav/jvndbhelp.html#jvndb3)) | |
| **CVSS V2 Severity:Base Metrics [4.3](/cvss/en/v2.html#AV:N/AC:M/Au:N/C:N/I:P/A:N) (Medium) [IPA Score]**  * Access Vector: Network * Access Complexity: Medium * Authentication: None * Confidentiality Impact: None * Integrity Impact: Partial * Availability Impact: None | |
| Affected Products | |
|  | |
| thoughtbot, inc.  * Paperclip 4.2.1 and earlier | |
|  | |
| Impact | |
| An arbitrary script may be executed on the user's web browser. | |
| Solution | |
| [Update the Software] | |
| Vendor Information | |
| thoughtbot, inc.  * GitHub : [thoughtbot/paperclip](https://github.com/thoughtbot/paperclip) * thoughtbot : [Paperclip Security Release](https://robots.thoughtbot.com/paperclip-security-release) | |
| CWE ([What is CWE?](http://www.ipa.go.jp/security/english/vuln/CWE_en.html)) | |
| 1. [Cross-site Scripting](http://www.ipa.go.jp/security/english/vuln/CWE_en.html#CWE79)(CWE-79) [IPA Evaluation] | |
| CVE ([What is CVE?](http://www.ipa.go.jp/security/english/vuln/CVE_en.html)) | |
| 1. [CVE-2015-2963](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2015-2963) | |
| References | |
| 1. JVN : [JVN#83881261](http://jvn.jp/en/jp/JVN83881261/index.html) 2. National Vulnerability Database (NVD) : [CVE-2015-2963](https://web.nvd.nist.gov/view/vuln/detail?vulnId=CVE-2015-2963) | |
| Revision History | |
| * [2015/06/18] | |

| --- | |
| --- | --- |
| Date Public | 2015/06/18 |
| Date First Published | 2015/06/18 |
| Date Last Updated | 2015/07/14 |
| --- | |

* JVN
* [HOME](http://jvn.jp/en/)
* [What is JVN ?](http://jvn.jp/en/nav/jvn.html)
* [Instructions](http://jvn.jp/en/nav/jvnhelp.html)
* [List of Vulnerability Report](http://jvn.jp/en/report/index.html)
* [VN\_JP](http://jvn.jp/en/jp/index.html)
* [VN\_JP(Unreachable)](http://jvn.jp/en/adj/index.html)
* [VN\_VU](http://jvn.jp/en/vu/index.html)
* [TA](http://jvn.jp/en/ta/index.html)
* [TRnotes](http://jvn.jp/en/tr/index.html)
* [JVN iPedia](/en/)
* [Search](/search/index.php?mode=_vulnerability_search_IA_VulnSearch&lang=en)
* [What is JVN iPedia?](/en/nav/jvndb.html)
* [How to Use?](/en/nav/jvndbhelp.html)
* [MyJVN](/en/apis/myjvn/index.html)
* [JVNJS/RSS](http://jvn.jp/en/rss/index.html)
* [Vendor List](http://jvn.jp/en/nav/index.html)
* [List of unreachable developers](http://jvn.jp/en/reply/index.html)
* [Contact](http://jvn.jp/en/contact/index.html)

![Copyright © 2007- IPA. All rights reserved.](/common/img/copyright.png)



=== Content from jvn.jp_10b6b937_20250124_175718.html ===


![Japan Vulnerability Notes](/common/img/note_logo.gif)

Published:2015/06/18  Last Updated:2015/06/18
# JVN#83881261 Ruby on Rails library Paperclip vulnerable to cross-site scripting

## Overview

Paperclip provided by thoughtbot contains a cross-site scripting vulnerability.

## Products Affected

* Paperclip 4.2.1 and earlier

## Description

Paperclip provided by thoughtbot is a library to upload files in Ruby on Rails. Paperclip contains a persistent cross-site scripting vulnerability ([CWE-79](https://cwe.mitre.org/data/definitions/79.html)).

## Impact

An arbitrary script may be executed on the user's web browser.

## Solution

**Update the Software**

Update to the latest version according to the information provided by the developer.

## Vendor Status

| Vendor | Link |
| --- | --- |
| thoughtbot | [thoughtbot/paperclip](https://github.com/thoughtbot/paperclip) |
|  | [Paperclip Security Release](https://robots.thoughtbot.com/paperclip-security-release) |

## References

## JPCERT/CC Addendum

## Vulnerability Analysis by JPCERT/CC

**Analyzed on 2015.06.18 (CVSS Base Metrics)**

[What is CVSS?](/en/nav/jvnhelp.html#cvssv2)

| Measures | Severity | | | Description |
| Access Vector(AV) | Local (L) | Adjacent Network (A) | Network (N) | A vulnerability exploitable with network access means the vulnerable software is bound to the network stack and the attacker does not require local network access or local access. Such a vulnerability is often termed "remotely exploitable". |
| Access Complexity(AC) | High (H) | Medium (M) | Low (L) | The access conditions are somewhat specialized. |
| Authentication(Au) | Multiple (M) | Single (S) | None (N) | Authentication is not required to exploit the vulnerability. |
| Confidentiality Impact(C) | None (N) | Partial (P) | Complete (C) | There is no impact to the confidentiality of the system. |
| Integrity Impact(I) | None (N) | Partial (P) | Complete (C) | Modification of some system files or information is possible, but the attacker does not have control over what can be modified, or the scope of what the attacker can affect is limited. |
| Availability Impact(A) | None (N) | Partial (P) | Complete (C) | There is no impact to the availability of the system. |

Base Score:4.3

## Credit

MORI Shingo of DeNA Co., Ltd. reported this vulnerability to IPA.

JPCERT/CC coordinated with the developer under Information Security Early Warning Partnership.

## Other Information

| JPCERT Alert |  |
| --- | --- |
| JPCERT Reports |  |
| CERT Advisory |  |
| CPNI Advisory |  |
| TRnotes |  |
| CVE | [CVE-2015-2963](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2015-2963) |
| JVN iPedia | [JVNDB-2015-000088](http://jvndb.jvn.jp/jvndb/JVNDB-2015-000088) |

* JVN
* HOME
* What is JVN ?
* Instructions
* List of Vulnerability Report
* [VN\_JP](http://jvn.jp/en/jp/index.html)
* [VN\_JP(Unreachable)](http://jvn.jp/en/adj/index.html)
* [VN\_VU](http://jvn.jp/en/vu/index.html)
* [TA](http://jvn.jp/en/ta/index.html)
* TRnotes
* JVN iPedia
* MyJVN
* JVNJS/RSS
* Vendor List
* List of unreachable developers
* Contact

Copyright (c) 2000-2015 JPCERT/CC and IPA. All rights reserved.



=== Content from openwall.com_7897198c_20250124_175721.html ===


| [Openwall](/) * [Products](/)   + [Openwall GNU/\*/Linux   *server OS*](/Owl/)+ [Linux Kernel Runtime Guard](/lkrg/)+ [John the Ripper   *password cracker*](/john/)         - [Free & Open Source for any platform](/john/)- [in the cloud](/john/cloud/)- [Pro for Linux](/john/pro/linux/)- [Pro for macOS](/john/pro/macosx/)+ [Wordlists   *for password cracking*](/wordlists/)+ [passwdqc   *policy enforcement*](/passwdqc/)             - [Free & Open Source for Unix](/passwdqc/)- [Pro for Windows (Active Directory)](/passwdqc/windows/)+ [yescrypt   *KDF & password hashing*](/yescrypt/)+ [yespower   *Proof-of-Work (PoW)*](/yespower/)+ [crypt\_blowfish   *password hashing*](/crypt/)+ [phpass   *ditto in PHP*](/phpass/)+ [tcb   *better password shadowing*](/tcb/)+ [Pluggable Authentication Modules](/pam/)+ [scanlogd   *port scan detector*](/scanlogd/)+ [popa3d   *tiny POP3 daemon*](/popa3d/)+ [blists   *web interface to mailing lists*](/blists/)+ [msulogin   *single user mode login*](/msulogin/)+ [php\_mt\_seed   *mt\_rand() cracker*](/php_mt_seed/)* [Services](/services/)* Publications       + [Articles](/articles/)+ [Presentations](/presentations/)* Resources         + [Mailing lists](/lists/)+ [Community wiki](https://openwall.info/wiki/)+ [Source code repositories (GitHub)](https://github.com/openwall)+ [Source code repositories (CVSweb)](https://cvsweb.openwall.com)+ [File archive & mirrors](/mirrors/)+ [How to verify digital signatures](/signatures/)+ [OVE IDs](/ove/)* [What's new](/news) | |
| --- | --- |

| | [Follow @Openwall on Twitter for new release announcements and other news](https://twitter.com/openwall) | | --- | |
| --- | --- |

[[<prev]](2) [[next>]](../../../2015/06/20/1) [[<thread-prev]](../../../2015/06/18/1) [[day]](.) [[month]](..) [[year]](../..) [[list]](../../..)
```

Message-ID: <CALPTtNVWKmbss3+7MjzGDgq49oexrprxE=125H4d2TMk128t0Q@mail.gmail.com>
Date: Thu, 18 Jun 2015 23:12:12 -0700
From: Reed Loden <reed@...dloden.com>
To: oss-security@...ts.openwall.com,
	Assign a CVE Identifier <cve-assign@...re.org>
Subject: Re: CVE request: Content type spoofing in ruby gem paperclip <4.2.2

OSVDB noticed that this seems to be CVE-2015-2963

<http://jvn.jp/en/jp/JVN83881261/index.html> (no idea why they call it an
XSS)

<https://robots.thoughtbot.com/paperclip-security-release> is the official
notification and just references the commit message.

~reed

On Thu, Jun 18, 2015 at 1:56 AM, Reed Loden <reed@...dloden.com> wrote:

> Saw this in paperclip's NEWS file, and I couldn't find a CVE for it.
>
>
> <https://github.com/thoughtbot/paperclip/commit/9aee4112f36058cd28d5fe4a006d6981bd1eda57>
>
> """"
> There is an issue where if an HTML file is uploaded with a .html
> extension, but the content type is listed as being `image/jpeg`, this
> will bypass a validation checking for images. But it will also pass the
> spoof check, because a file named .html and containing actual HTML
> passes the spoof check.
>
> This change makes it so that we also check the supplied content type. So
> even if the file contains HTML and ends with .html, it doesn't match the
> content type of `image/jpeg` and so it fails.
> """"
>
> Fixed in paperclip 4.2.2.
>
> ~reed
>

```

[Powered by blists](https://www.openwall.com/blists/) - [more mailing lists](https://lists.openwall.net)

Please check out the
[Open Source Software Security Wiki](https://oss-security.openwall.org/wiki/), which is counterpart to this
[mailing list](https://oss-security.openwall.org/wiki/mailing-lists/oss-security).

Confused about [mailing lists](/lists/) and their use?
[Read about mailing lists on Wikipedia](https://en.wikipedia.org/wiki/Electronic_mailing_list)
and check out these
[guidelines on proper formatting of your messages](https://www.complang.tuwien.ac.at/anton/mail-news-errors.html).


