=== Content from jvndb.jvn.jp_0459c7bd_20250125_223333.html ===


![JVN iPedia](/en/common/img/en_logo.gif)
Last Updated:2015/07/27

| [[Japanese]](/ja/contents/2015/JVNDB-2015-000099.html) | |
| --- | --- |
| JVNDB-2015-000099 | |
| Thetis vulnerable to SQL injection | |
| Overview | |
| Thetis provided by Sysphonic Co., Ltd. is an open source groupware and SNS. Thetis contains a SQL injection (CWE-89) vulnerability. | |
| CVSS Severity ([What is CVSS?](/en/nav/jvndbhelp.html#jvndb3)) | |
| **CVSS V2 Severity:Base Metrics [7.5](/cvss/en/v2.html#AV:N/AC:L/Au:N/C:P/I:P/A:P) (High) [IPA Score]**  * Access Vector: Network * Access Complexity: Low * Authentication: None * Confidentiality Impact: Partial * Integrity Impact: Partial * Availability Impact: Partial | |
| Affected Products | |
|  | |
| Sysphonic Co., Ltd.  * Thetis ver.2.2.0 and earlier | |
|  | |
| Impact | |
| An attacker may obtain or alter information stored in the database. | |
| Solution | |
| [Apply an Update] | |
| Vendor Information | |
| Sysphonic Co., Ltd.  * GitHub : [Reinforcement of security. (1b82347)](https://github.com/sysphonic/thetis/commit/1b8234706e1294f41df42f3d1ccb71b983ffbe23) * GitHub : [Reinforcement of security. (4ca3f5f)](https://github.com/sysphonic/thetis/commit/4ca3f5f486759660b87d7c146f1fdc11264f56eb) * GitHub : [Reinforcement of security. (8004ee0)](https://github.com/sysphonic/thetis/commit/8004ee0c384daae0b28478ff8193d1990c397f57) * GitHub : [Reinforcement of security. (842e44f)](https://github.com/sysphonic/thetis/commit/842e44f0c2bd7d680430bb89a3bb78fd744961f9) * GitHub : [Reinforcement of security. (ce535a3)](https://github.com/sysphonic/thetis/commit/ce535a38ec92ff0f98af11ab41a425d1529a31ef) * GitHub : [Some trivial bug-fixes.](https://github.com/sysphonic/thetis/commit/d9ed965075634ca1a095b480b459c68445ce951d) * GitHub : [Thetis ver.2.3.0: Reinforcement of security.](https://github.com/sysphonic/thetis/commit/c07e255d2296d50a0bffafaf66a76f8f1b53621f) * GitHub : [x ApplicationHelper.get\_sql\_like() -> o SqlHelper.get\_sql\_like()](https://github.com/sysphonic/thetis/commit/a61dc72035c7ae0b06f6d7dc8b2a848ffc7db277) * Sysphonic Co., Ltd. : [Sysphonic Co., Ltd. website](http://sysphonic.com/en/thetis/THETIS-SEC-001.html) | |
| CWE ([What is CWE?](http://www.ipa.go.jp/security/english/vuln/CWE_en.html)) | |
| 1. [SQL Injection](http://www.ipa.go.jp/security/english/vuln/CWE_en.html#CWE89)(CWE-89) [IPA Evaluation] | |
| CVE ([What is CVE?](http://www.ipa.go.jp/security/english/vuln/CVE_en.html)) | |
| 1. [CVE-2015-2972](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2015-2972) | |
| References | |
| 1. JVN : [JVN#19011483](http://jvn.jp/en/jp/JVN19011483/index.html) 2. National Vulnerability Database (NVD) : [CVE-2015-2972](https://web.nvd.nist.gov/view/vuln/detail?vulnId=CVE-2015-2972) | |
| Revision History | |
| * [2015/07/15] | |

| --- | |
| --- | --- |
| Date Public | 2015/07/15 |
| Date First Published | 2015/07/15 |
| Date Last Updated | 2015/07/27 |
| --- | |

* JVN
* [HOME](http://jvn.jp/en/)
* [What is JVN ?](http://jvn.jp/en/nav/jvn.html)
* [Instructions](http://jvn.jp/en/nav/jvnhelp.html)
* [List of Vulnerability Report](http://jvn.jp/en/report/index.html)
* [VN\_JP](http://jvn.jp/en/jp/index.html)
* [VN\_JP(Unreachable)](http://jvn.jp/en/adj/index.html)
* [VN\_VU](http://jvn.jp/en/vu/index.html)
* [TA](http://jvn.jp/en/ta/index.html)
* [TRnotes](http://jvn.jp/en/tr/index.html)
* [JVN iPedia](/en/)
* [Search](/search/index.php?mode=_vulnerability_search_IA_VulnSearch&lang=en)
* [What is JVN iPedia?](/en/nav/jvndb.html)
* [How to Use?](/en/nav/jvndbhelp.html)
* [MyJVN](/en/apis/myjvn/index.html)
* [JVNJS/RSS](http://jvn.jp/en/rss/index.html)
* [Vendor List](http://jvn.jp/en/nav/index.html)
* [List of unreachable developers](http://jvn.jp/en/reply/index.html)
* [Contact](http://jvn.jp/en/contact/index.html)

![Copyright © 2007- IPA. All rights reserved.](/common/img/copyright.png)



=== Content from github.com_fdde389d_20250125_223357.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fsysphonic%2Fthetis%2Fcommit%2Fd9ed965075634ca1a095b480b459c68445ce951d)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fsysphonic%2Fthetis%2Fcommit%2Fd9ed965075634ca1a095b480b459c68445ce951d)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=sysphonic%2Fthetis)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[sysphonic](/sysphonic)
/
**[thetis](/sysphonic/thetis)**
Public

* [Notifications](/login?return_to=%2Fsysphonic%2Fthetis) You must be signed in to change notification settings
* [Fork
  6](/login?return_to=%2Fsysphonic%2Fthetis)
* [Star
   6](/login?return_to=%2Fsysphonic%2Fthetis)

* [Code](/sysphonic/thetis)
* [Issues
  2](/sysphonic/thetis/issues)
* [Pull requests
  8](/sysphonic/thetis/pulls)
* [Actions](/sysphonic/thetis/actions)
* [Projects
  0](/sysphonic/thetis/projects)
* [Wiki](/sysphonic/thetis/wiki)
* [Security](/sysphonic/thetis/security)
* [Insights](/sysphonic/thetis/pulse)

Additional navigation options

* [Code](/sysphonic/thetis)
* [Issues](/sysphonic/thetis/issues)
* [Pull requests](/sysphonic/thetis/pulls)
* [Actions](/sysphonic/thetis/actions)
* [Projects](/sysphonic/thetis/projects)
* [Wiki](/sysphonic/thetis/wiki)
* [Security](/sysphonic/thetis/security)
* [Insights](/sysphonic/thetis/pulse)

## Commit

[Permalink](/sysphonic/thetis/commit/d9ed965075634ca1a095b480b459c68445ce951d)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Some trivial bug-fixes.

[Browse files](/sysphonic/thetis/tree/d9ed965075634ca1a095b480b459c68445ce951d)
Browse the repository at this point in the history

```
Signed-off-by: MORITA Shintaro <shin@sysphonic.com>
```

* Loading branch information

MORITA Shintaro
committed
Jul 7, 2015

1 parent
[8004ee0](/sysphonic/thetis/commit/8004ee0c384daae0b28478ff8193d1990c397f57)

commit d9ed965

Showing
**1 changed file**
with
**6 additions**
and
**1 deletion**.

* Whitespace
* Ignore whitespace

* Split
* Unified

## There are no files selected for viewing

7 changes: 6 additions & 1 deletion

7
[app/controllers/application\_controller.rb](#diff-766c34fd6533171eaf54300c153f89d6002c35c02cfc9c5b219251f85180ad07 "app/controllers/application_controller.rb")

Show comments

[View file](/sysphonic/thetis/blob/d9ed965075634ca1a095b480b459c68445ce951d/app/controllers/application_controller.rb)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -99,7 +99,12 @@ def gate\_process |
|  |  |  |
|  |  | HistoryHelper.keep\_last(request) |
|  |  |  |
|  |  | @login\_user = User.find(session[:login\_user\_id]) |
|  |  | SqlHelper.validate\_token([session[:login\_user\_id]]) |
|  |  | begin |
|  |  | @login\_user = User.find(session[:login\_user\_id]) |
|  |  | rescue => evar |
|  |  | @login\_user = nil |
|  |  | end |
|  |  |  |
|  |  | begin |
|  |  | if @login\_user.nil? \ |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `d9ed965`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fsysphonic%2Fthetis%2Fcommit%2Fd9ed965075634ca1a095b480b459c68445ce951d) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from jvn.jp_639c4e0a_20250125_223330.html ===


![Japan Vulnerability Notes](/common/img/note_logo.gif)

Published:2015/07/15  Last Updated:2015/07/15
# JVN#19011483 Thetis vulnerable to SQL injection

## Overview

Thetis provided by Sysphonic Co., Ltd. contains a SQL injection vulnerability.

## Products Affected

* Thetis ver.2.2.0 and earlier

## Description

Thetis provided by Sysphonic Co., Ltd. is an open source groupware and SNS. Thetis contains a SQL injection ([CWE-89](https://cwe.mitre.org/data/definitions/89.html)) vulnerability.

## Impact

An attacker may obtain or alter information stored in the database.

## Solution

**Apply an Update**

Apply the update according to the information provided by the provider.

## Vendor Status

| Vendor | Status | Last Update | Vendor Notes |
| --- | --- | --- | --- |
| Sysphonic Co., Ltd. | [Vulnerable](995700/index.html) | 2015/07/15 | [Sysphonic Co., Ltd. website](http://sysphonic.com/en/thetis/THETIS-SEC-001.html) |

## References

## JPCERT/CC Addendum

## Vulnerability Analysis by JPCERT/CC

**Analyzed on 2015.07.15 (CVSS Base Metrics)**

[What is CVSS?](/en/nav/jvnhelp.html#cvssv2)

| Measures | Severity | | | Description |
| Access Vector(AV) | Local (L) | Adjacent Network (A) | Network (N) | A vulnerability exploitable with network access means the vulnerable software is bound to the network stack and the attacker does not require local network access or local access. Such a vulnerability is often termed "remotely exploitable". |
| Access Complexity(AC) | High (H) | Medium (M) | Low (L) | Specialized access conditions or extenuating circumstances do not exist. |
| Authentication(Au) | Multiple (M) | Single (S) | None (N) | Authentication is not required to exploit the vulnerability. |
| Confidentiality Impact(C) | None (N) | Partial (P) | Complete (C) | There is considerable informational disclosure. Access to some system files is possible, but the attacker does not have control over what is obtained, or the scope of the loss is constrained. |
| Integrity Impact(I) | None (N) | Partial (P) | Complete (C) | Modification of some system files or information is possible, but the attacker does not have control over what can be modified, or the scope of what the attacker can affect is limited. |
| Availability Impact(A) | None (N) | Partial (P) | Complete (C) | There is reduced performance or interruptions in resource availability. |

Base Score:7.5

## Credit

Shoji Baba reported this vulnerability to IPA.

JPCERT/CC coordinated with the developer under Information Security Early Warning Partnership.

## Other Information

| JPCERT Alert |  |
| --- | --- |
| JPCERT Reports |  |
| CERT Advisory |  |
| CPNI Advisory |  |
| TRnotes |  |
| CVE | [CVE-2015-2972](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2015-2972) |
| JVN iPedia | [JVNDB-2015-000099](http://jvndb.jvn.jp/jvndb/JVNDB-2015-000099) |

* JVN
* HOME
* What is JVN ?
* Instructions
* List of Vulnerability Report
* [VN\_JP](http://jvn.jp/en/jp/index.html)
* [VN\_JP(Unreachable)](http://jvn.jp/en/adj/index.html)
* [VN\_VU](http://jvn.jp/en/vu/index.html)
* [TA](http://jvn.jp/en/ta/index.html)
* TRnotes
* JVN iPedia
* MyJVN
* JVNJS/RSS
* Vendor List
* List of unreachable developers
* Contact

Copyright (c) 2000-2015 JPCERT/CC and IPA. All rights reserved.



=== Content from github.com_3a9916f2_20250125_223356.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fsysphonic%2Fthetis%2Fcommit%2Fce535a38ec92ff0f98af11ab41a425d1529a31ef)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fsysphonic%2Fthetis%2Fcommit%2Fce535a38ec92ff0f98af11ab41a425d1529a31ef)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=sysphonic%2Fthetis)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[sysphonic](/sysphonic)
/
**[thetis](/sysphonic/thetis)**
Public

* [Notifications](/login?return_to=%2Fsysphonic%2Fthetis) You must be signed in to change notification settings
* [Fork
  6](/login?return_to=%2Fsysphonic%2Fthetis)
* [Star
   6](/login?return_to=%2Fsysphonic%2Fthetis)

* [Code](/sysphonic/thetis)
* [Issues
  2](/sysphonic/thetis/issues)
* [Pull requests
  8](/sysphonic/thetis/pulls)
* [Actions](/sysphonic/thetis/actions)
* [Projects
  0](/sysphonic/thetis/projects)
* [Wiki](/sysphonic/thetis/wiki)
* [Security](/sysphonic/thetis/security)
* [Insights](/sysphonic/thetis/pulse)

Additional navigation options

* [Code](/sysphonic/thetis)
* [Issues](/sysphonic/thetis/issues)
* [Pull requests](/sysphonic/thetis/pulls)
* [Actions](/sysphonic/thetis/actions)
* [Projects](/sysphonic/thetis/projects)
* [Wiki](/sysphonic/thetis/wiki)
* [Security](/sysphonic/thetis/security)
* [Insights](/sysphonic/thetis/pulse)

## Commit

[Permalink](/sysphonic/thetis/commit/ce535a38ec92ff0f98af11ab41a425d1529a31ef)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Reinforcement of security.

[Browse files](/sysphonic/thetis/tree/ce535a38ec92ff0f98af11ab41a425d1529a31ef)
Browse the repository at this point in the history

```
Signed-off-by: MORITA Shintaro <shin@sysphonic.com>
```

* Loading branch information

MORITA Shintaro
committed
Jul 7, 2015

1 parent
[4ca3f5f](/sysphonic/thetis/commit/4ca3f5f486759660b87d7c146f1fdc11264f56eb)

commit ce535a3

 Show file tree

 Hide file tree

Showing
**29 changed files**
with
**148 additions**
and
**63 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* app

  + controllers

    - app/controllers/desktop\_controller.rb
      [desktop\_controller.rb](#diff-3b957ea57b9a49d5a3d9f9139d99927002cbe1de7164a74f111caea99a178ea8)
    - app/controllers/items\_controller.rb
      [items\_controller.rb](#diff-22da4de4953a8a5748f5a8f4425eb896283d008abd9525a4a33c9fd76f35f40b)
    - app/controllers/login\_controller.rb
      [login\_controller.rb](#diff-5d401230d249c0833d3c04a53f1aeab6c223010a996fe82296635e88a10c8cc7)
    - app/controllers/mail\_folders\_controller.rb
      [mail\_folders\_controller.rb](#diff-45bf8570f18660deedb22ec9b369d50559113eb1f0a21f0ac90f10885f48be06)
    - app/controllers/timecards\_controller.rb
      [timecards\_controller.rb](#diff-ee6ecda8e8334ea089dad6882a065bae75594ef945a19f5c5083ae4eba46e890)
    - app/controllers/zeptair\_post\_controller.rb
      [zeptair\_post\_controller.rb](#diff-a24700646fbebdf06a9a1473860a8c891ebe05253bc48a37dfd227d352b1b7ac)
  + helpers

    - app/helpers/items\_helper.rb
      [items\_helper.rb](#diff-4a666a9fb1a565fb66af0eecdeed4d7f0d45ca7fa3cb40464a1231e94f8827e9)
    - app/helpers/sql\_helper.rb
      [sql\_helper.rb](#diff-bacba4ae3b300c54897224b84231621c8922484b2f40ebd3720d0bebc8c76b44)
    - app/helpers/templates\_helper.rb
      [templates\_helper.rb](#diff-765d935fafc92e287c8fabf20bff914b68487718c37e3f815da666ca6c512bd1)
    - app/helpers/tree\_element.rb
      [tree\_element.rb](#diff-1414c2a4d0b553d48513eb21a08a61cf34c94d9c7d0c88a6ffb32a350d6e4148)
    - app/helpers/zeptair\_dist\_helper.rb
      [zeptair\_dist\_helper.rb](#diff-2a132ccab064908d719e37c1755829b5353ae3e5b95cc63c9630047d3694ca39)
  + models

    - app/models/address.rb
      [address.rb](#diff-4c2d4bccb73a3296911380789e5eb5e1bd37b277d07e743e6a6441879528cee6)
    - app/models/email.rb
      [email.rb](#diff-02c13e71f0c5f29a8e43dde10a166be8cd5f1999707ae26ef1aef690610e06ec)
    - app/models/folder.rb
      [folder.rb](#diff-71f7d2ee88389d841ac6ac058dde5a4af5e5d1dcfe065f2ecb850919e6ed8fd7)
    - app/models/group.rb
      [group.rb](#diff-d60319197e54a8992a066d6243587f4434506f5b924282954fa5f5a8f4ee05e2)
    - app/models/location.rb
      [location.rb](#diff-83acc4923e9ebe15ae1c7ed932799fabc336c772c0e9233e1537a435da8cb1dc)
    - app/models/mail\_account.rb
      [mail\_account.rb](#diff-bd9cd06c7bf1b1b5f5aa2a92f65d56470e4a9de033c6bdd963ee854191fc2300)
    - app/models/mail\_folder.rb
      [mail\_folder.rb](#diff-02ef7454621c4738b4dc4b9c3c68f7d28dc67c3ee218fe617b8852298c7ff589)
    - app/models/paid\_holiday.rb
      [paid\_holiday.rb](#diff-792ac3f00e707c9621dbefd30e3fc730277a2175e9d16c88e3ca1185a1a9d1b8)
    - app/models/research.rb
      [research.rb](#diff-da0bd78e51ac9e3b0c4d77a642e421bcc0068c0e1535795c992a5ecc89f8e544)
    - app/models/setting.rb
      [setting.rb](#diff-f1d12f9023a819c8e3bbeb276c8de59f412ed96db88a29f473d3cd06aa262f65)
    - app/models/team.rb
      [team.rb](#diff-36f3ec6fb3b342e6b4f2b49aa02469e569f5f25e26e8060523505838b82f7961)
    - app/models/timecard.rb
      [timecard.rb](#diff-285673c52d48be4745f42287eb26f39fea22054eb7856d093b9697e98e6001a7)
    - app/models/toy.rb
      [toy.rb](#diff-b3840a893d5a14a12ce542409d57159dcda7be8293e163870aee90dafeac226f)
    - app/models/user.rb
      [user.rb](#diff-9802ca3c9c4cf89904fd44bc114e35ebdf2c5dd3d5b645491e2b253e1afef29b)
  + views

    - common

      * app/views/common/\_edit\_scope.html.erb
        [\_edit\_scope.html.erb](#diff-2b858f3a5db6d64d9fa343cb1192d0209ba54db70335e281cfe5e9dce6bd8f39)
    - schedules

      * app/views/schedules/\_edit\_members.html.erb
        [\_edit\_members.html.erb](#diff-802e97d38bc5f9b4dbd642f445ecf6b3421ac3a87e84d37b404af7787439a6f3)
    - send\_mails

      * app/views/send\_mails/edit\_send\_to.html.erb
        [edit\_send\_to.html.erb](#diff-334ba41ef491c5d943a7c4be445530f838fc2e23df2a929131106c63d98b7907)
    - timecards

      * app/views/timecards/group.html.erb
        [group.html.erb](#diff-a641e0259032a4ee5ca9f6f388a1e8e8d222fa564e9f915dbfed3f542cc5880a)

## There are no files selected for viewing

2 changes: 1 addition & 1 deletion

2
[app/controllers/desktop\_controller.rb](#diff-3b957ea57b9a49d5a3d9f9139d99927002cbe1de7164a74f111caea99a178ea8 "app/controllers/desktop_controller.rb")

Show comments

[View file](/sysphonic/thetis/blob/ce535a38ec92ff0f98af11ab41a425d1529a31ef/app/controllers/desktop_controller.rb)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -91,7 +91,7 @@ def edit\_timecard |
|  |  |  |
|  |  | date\_s = params[:date] |
|  |  |  |
|  |  | if date\_s.nil? or date\_s.empty? |
|  |  | if date\_s.blank? |
|  |  | @date = Date.today |
|  |  | date\_s = @date.strftime(Schedule::SYS\_DATE\_FORM) |
|  |  | else |
| Expand Down | |  |

7 changes: 4 additions & 3 deletions

7
[app/controllers/items\_controller.rb](#diff-22da4de4953a8a5748f5a8f4425eb896283d008abd9525a4a33c9fd76f35f40b "app/controllers/items_controller.rb")

Show comments

[View file](/sysphonic/thetis/blob/ce535a38ec92ff0f98af11ab41a425d1529a31ef/app/controllers/items_controller.rb)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -1272,9 +1272,10 @@ def team\_organize |
|  |  | end |
|  |  |  |
|  |  | users = @team.get\_users\_a |
|  |  | end |
|  |  | end |
|  |  |  |
|  |  | team\_members = params[:team\_members] |
|  |  | SqlHelper.validate\_token([team\_members]) |
|  |  |  |
|  |  | created = false |
|  |  | modified = false |
| Expand Down  Expand Up | | @@ -1305,9 +1306,9 @@ def team\_organize |
|  |  | @team.clear\_users |
|  |  | end |
|  |  |  |
|  |  | @team.add\_users team\_members |
|  |  | @team.add\_users(team\_members) |
|  |  | @team.save |
|  |  | @team.remove\_application team\_members |
|  |  | @team.remove\_application(team\_members) |
|  |  |  |
|  |  | modified = true |
|  |  | end |
| Expand Down | |  |

2 changes: 1 addition & 1 deletion

2
[app/controllers/login\_controller.rb](#diff-5d401230d249c0833d3c04a53f1aeab6c223010a996fe82296635e88a10c8cc7 "app/controllers/login_controller.rb")

Show comments

[View file](/sysphonic/thetis/blob/ce535a38ec92ff0f98af11ab41a425d1529a31ef/app/controllers/login_controller.rb)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -97,7 +97,7 @@ def send\_password |
|  |  | Log.add\_info(request, params.inspect) |
|  |  |  |
|  |  | mail\_addr = params[:thetisBoxEdit] |
|  |  | SqlHelper.validate\_token([mail\_addr], ['@-']) |
|  |  | SqlHelper.validate\_token([mail\_addr]) |
|  |  | begin |
|  |  | users = User.where("email='#{mail\_addr}'").to\_a |
|  |  | rescue => evar |
| Expand Down | |  |

2 changes: 1 addition & 1 deletion

2
[app/controllers/mail\_folders\_controller.rb](#diff-45bf8570f18660deedb22ec9b369d50559113eb1f0a21f0ac90f10885f48be06 "app/controllers/mail_folders_controller.rb")

Show comments

[View file](/sysphonic/thetis/blob/ce535a38ec92ff0f98af11ab41a425d1529a31ef/app/controllers/mail_folders_controller.rb)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -32,9 +32,9 @@ def show\_tree |
|  |  | con << "(user\_id=#{@login\_user.id})" |
|  |  |  |
|  |  | account\_xtype = params[:mail\_account\_xtype] |
|  |  | SqlHelper.validate\_token([account\_xtype]) |
|  |  |  |
|  |  | unless account\_xtype.blank? |
|  |  | SqlHelper.validate\_token([account\_xtype]) |
|  |  | con << "(xtype='#{account\_xtype}')" |
|  |  | end |
|  |  | @mail\_accounts = MailAccount.find\_all(con.join(' and ')) |
| Expand Down | |  |

2 changes: 1 addition & 1 deletion

2
[app/controllers/timecards\_controller.rb](#diff-ee6ecda8e8334ea089dad6882a065bae75594ef945a19f5c5083ae4eba46e890 "app/controllers/timecards_controller.rb")

Show comments

[View file](/sysphonic/thetis/blob/ce535a38ec92ff0f98af11ab41a425d1529a31ef/app/controllers/timecards_controller.rb)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -120,7 +120,7 @@ def edit |
|  |  |  |
|  |  | date\_s = params[:date] |
|  |  |  |
|  |  | if date\_s.nil? or date\_s.empty? |
|  |  | if date\_s.blank? |
|  |  | @date = Date.today |
|  |  | date\_s = @date.strftime(Schedule::SYS\_DATE\_FORM) |
|  |  | else |
| Expand Down | |  |

41 changes: 24 additions & 17 deletions

41
[app/controllers/zeptair\_post\_controller.rb](#diff-a24700646fbebdf06a9a1473860a8c891ebe05253bc48a37dfd227d352b1b7ac "app/controllers/zeptair_post_controller.rb")

Show comments

[View file](/sysphonic/thetis/blob/ce535a38ec92ff0f98af11ab41a425d1529a31ef/app/controllers/zeptair_post_controller.rb)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -81,33 +81,35 @@ def query |
|  |  |  |
|  |  | target\_user = nil |
|  |  |  |
|  |  | SqlHelper.validate\_token([params[:user\_id], params[:zeptair\_id], params[:group\_id]]) |
|  |  | user\_id = params[:user\_id] |
|  |  | zeptair\_id = params[:zeptair\_id] |
|  |  | group\_id = params[:group\_id] |
|  |  | SqlHelper.validate\_token([user\_id, zeptair\_id, group\_id]) |
|  |  |  |
|  |  | unless params[:user\_id].blank? |
|  |  | target\_user = User.find(params[:user\_id]) |
|  |  | unless user\_id.blank? |
|  |  | target\_user = User.find(user\_id) |
|  |  | end |
|  |  |  |
|  |  | unless params[:zeptair\_id].blank? |
|  |  | zeptair\_id = params[:zeptair\_id] |
|  |  | unless zeptair\_id.blank? |
|  |  | target\_user = User.where("zeptair\_id=#{zeptair\_id}").first |
|  |  | end |
|  |  |  |
|  |  | if target\_user.nil? |
|  |  |  |
|  |  | if params[:group\_id].blank? |
|  |  | if group\_id.blank? |
|  |  | sql = 'select distinct Item.\* from items Item, attachments Attachment' |
|  |  | sql << " where Item.xtype='#{Item::XTYPE\_ZEPTAIR\_POST}' and Item.id=Attachment.item\_id" |
|  |  | sql << ' order by Item.user\_id ASC' |
|  |  | else |
|  |  | group\_ids = [params[:group\_id]] |
|  |  | group\_ids = [group\_id] |
|  |  |  |
|  |  | if params[:recursive] == 'true' |
|  |  | group\_ids += Group.get\_childs(params[:group\_id], true, false) |
|  |  | group\_ids += Group.get\_childs(group\_id, true, false) |
|  |  | end |
|  |  |  |
|  |  | groups\_con = [] |
|  |  | group\_ids.each do |group\_id| |
|  |  | groups\_con << SqlHelper.get\_sql\_like(['User.groups'], "|#{@group\_id}|") |
|  |  | group\_ids.each do |grp\_id| |
|  |  | groups\_con << SqlHelper.get\_sql\_like(['User.groups'], "|#{grp\_id}|") |
|  |  | end |
|  |  | sql = 'select distinct Item.\* from items Item, attachments Attachment, users User' |
|  |  | sql << " where Item.xtype='#{Item::XTYPE\_ZEPTAIR\_POST}' and Item.id=Attachment.item\_id" |
| Expand All | | @@ -134,23 +136,28 @@ def delete\_attachment |
|  |  |  |
|  |  | target\_user = nil |
|  |  |  |
|  |  | unless params[:user\_id].blank? |
|  |  | if @login\_user.admin?(User::AUTH\_ZEPTAIR) or @login\_user.id.to\_s == params[:user\_id].to\_s |
|  |  | target\_user = User.find(params[:user\_id]) |
|  |  | user\_id = params[:user\_id] |
|  |  | zeptair\_id = params[:zeptair\_id] |
|  |  | attachment\_id = params[:attachment\_id] |
|  |  | SqlHelper.validate\_token([user\_id, zeptair\_id, attachment\_id]) |
|  |  |  |
|  |  | unless user\_id.blank? |
|  |  | if @login\_user.admin?(User::AUTH\_ZEPTAIR) or @login\_user.id.to\_s == user\_id.to\_s |
|  |  | target\_user = User.find(user\_id) |
|  |  | end |
|  |  | end |
|  |  |  |
|  |  | unless params[:zeptair\_id].blank? |
|  |  | unless zeptair\_id.blank? |
|  |  |  |
|  |  | target\_user = User.where("zeptair\_id=#{params[:zeptair\_id]}").first |
|  |  | target\_user = User.where("zeptair\_id=#{zeptair\_id}").first |
|  |  |  |
|  |  | unless @login\_user.admin?(User::AUTH\_ZEPTAIR) or @login\_user.id == target\_user.id |
|  |  | target\_user = nil |
|  |  | end |
|  |  | end |
|  |  |  |
|  |  | if target\_user.nil? |
|  |  | if params[:attachment\_id].blank? |
|  |  | if attachment\_id.blank? |
|  |  |  |
|  |  | query |
|  |  | unless @post\_items.nil? |
| Expand All | | @@ -163,7 +170,7 @@ def delete\_attachment |
|  |  | end |
|  |  |  |
|  |  | else |
|  |  | attach = Attachment.find(params[:attachment\_id]) |
|  |  | attach = Attachment.find(attachment\_id) |
|  |  |  |
|  |  | item = Item.find(attach.item\_id) |
|  |  |  |
| Expand Down | |  |

5 changes: 4 additions & 1 deletion

5
[app/helpers/items\_helper.rb](#diff-4a666a9fb1a565fb66af0eecdeed4d7f0d45ca7fa3cb40464a1231e94f8827e9 "app/helpers/items_helper.rb")

Show comments

[View file](/sysphonic/thetis/blob/ce535a38ec92ff0f98af11ab41a425d1529a31ef/app/helpers/items_helper.rb)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -24,6 +24,9 @@ module ItemsHelper |
|  |  | #return:: Next revision number. |
|  |  | # |
|  |  | def self.get\_next\_revision(user\_id, source\_id) |
|  |  |  |
|  |  | SqlHelper.validate\_token([user\_id, source\_id]) |
|  |  |  |
|  |  | copied\_items = Item.where("user\_id=#{user\_id} and source\_id=#{source\_id}").order('created\_at DESC').to\_a |
|  |  |  |
|  |  | rev = 0 |
| Expand All | | @@ -35,7 +38,7 @@ def self.get\_next\_revision(user\_id, source\_id) |
|  |  | break |
|  |  | end |
|  |  |  |
|  |  | return '#' + sprintf('%03d', rev+1) |
|  |  | return ('#' + sprintf('%03d', rev+1)) |
|  |  | end |
|  |  |  |
|  |  | #=== self.get\_copies\_folder |
| Expand Down | |  |

8 changes: 6 additions & 2 deletions

8
[app/helpers/sql\_helper.rb](#diff-bacba4ae3b300c54897224b84231621c8922484b2f40ebd3720d0bebc8c76b44 "app/helpers/sql_helper.rb")

Show comments

[View file](/sysphonic/thetis/blob/ce535a38ec92ff0f98af11ab41a425d1529a31ef/app/helpers/sql_helper.rb)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -25,8 +25,12 @@ module SqlHelper |
|  |  | # |
|  |  | def self.validate\_token(tokens, extra\_chars=nil) |
|  |  |  |
|  |  | extra\_chars = Regexp.escape((extra\_chars || []).join()) |
|  |  | regexp = Regexp.new("^[ ]\*[a-zA-Z0-9\_.#{extra\_chars}]+[ ]\*$") |
|  |  | if extra\_chars.nil? |
|  |  | extra\_chars = '' |
|  |  | else |
|  |  | extra\_chars = Regexp.escape(extra\_chars.join()) |
|  |  | end |
|  |  | regexp = Regexp.new("^[ ]\*[a-zA-Z0-9\_.@\\-#{extra\_chars}]+[ ]\*$") |
|  |  |  |
|  |  | [tokens].flatten.each do |token| |
|  |  | next if token.blank? |
| Expand Down | |  |

3 changes: 2 additions & 1 deletion

3
[app/helpers/templates\_helper.rb](#diff-765d935fafc92e287c8fabf20bff914b68487718c37e3f815da666ca6c512bd1 "app/helpers/templates_helper.rb")

Show comments

[View file](/sysphonic/thetis/blob/ce535a38ec92ff0f98af11ab41a425d1529a31ef/app/helpers/templates_helper.rb)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -166,6 +166,8 @@ def self.get\_tmpl\_folder |
|  |  | # |
|  |  | def self.get\_tmpl\_subfolder(name) |
|  |  |  |
|  |  | SqlHelper.validate\_token([name]) |
|  |  |  |
|  |  | tmpl\_folder = Folder.where("folders.name='#{TMPL\_ROOT}'").first |
|  |  |  |
|  |  | unless tmpl\_folder.nil? |
| Expand All | | @@ -179,5 +181,4 @@ def self.get\_tmpl\_subfolder(name) |
|  |  |  |
|  |  | return [tmpl\_folder, child] |
|  |  | end |
|  |  |  |
|  |  | end |

3 changes: 3 additions & 0 deletions

3
[app/helpers/tree\_element.rb](#diff-1414c2a4d0b553d48513eb21a08a61cf34c94d9c7d0c88a6ffb32a350d6e4148 "app/helpers/tree_element.rb")

Show comments

[View file](/sysphonic/thetis/blob/ce535a38ec92ff0f98af11ab41a425d1529a31ef/app/helpers/tree_element.rb)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -78,6 +78,8 @@ def get\_parents(ret\_obj, cache=nil) |
|  |  | # |
|  |  | def self.get\_childs(klass, node\_id, recursive, ret\_obj) |
|  |  |  |
|  |  | SqlHelper.validate\_token([node\_id]) |
|  |  |  |
|  |  | array = [] |
|  |  |  |
|  |  | if recursive |
| Expand Down  Expand Up | | @@ -131,6 +133,7 @@ def get\_childs(recursive, ret\_obj) |
|  |  | # |
|  |  | def self.get\_tree(klass, tree, conditions, node\_id, order\_by) |
|  |  |  |
|  |  | SqlHelper.validate\_token([node\_id]) |
|  |  | if conditions.nil? |
|  |  | con = '' |
|  |  | else |
| Expand Down | |  |

3 changes: 3 additions & 0 deletions

3
[app/helpers/zeptair\_dist\_helper.rb](#diff-2a132ccab064908d719e37c1755829b5353ae3e5b95cc63c9630047d3694ca39 "app/helpers/zeptair_dist_helper.rb")

Show comments

[View file](/sysphonic/thetis/blob/ce535a38ec92ff0f98af11ab41a425d1529a31ef/app/helpers/zeptair_dist_helper.rb)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -61,6 +61,7 @@ def self.get\_ack\_entry\_for(target) |
|  |  | # |
|  |  | def self.get\_comment\_of(item\_id, user\_id) |
|  |  |  |
|  |  | SqlHelper.validate\_token([item\_id, user\_id]) |
|  |  | begin |
|  |  | comment = Comment.where("(user\_id=#{user\_id}) and (item\_id=#{item\_id}) and (xtype='#{Comment::XTYPE\_DIST\_ACK}')").first |
|  |  | rescue => evar |
| Expand Down  Expand Up | | @@ -143,6 +144,7 @@ def self.completed\_ack\_message(item\_id) |
|  |  | #return:: The number of ACK messages to the specified Distribution Item. |
|  |  | # |
|  |  | def self.count\_ack\_users(item\_id) |
|  |  | SqlHelper.validate\_token([item\_id]) |
|  |  | return Comment.where("(item\_id=#{item\_id}) and (xtype='#{Comment::XTYPE\_DIST\_ACK}')").count |
|  |  | end |
|  |  |  |
| Expand All | | @@ -154,6 +156,7 @@ def self.count\_ack\_users(item\_id) |
|  |  | #return:: The number of completed users of the specified Distribution Item. |
|  |  | # |
|  |  | def self.count\_completed\_users(item\_id) |
|  |  | SqlHelper.validate\_token([item\_id]) |
|  |  | ack\_msg = ZeptairDistHelper.completed\_ack\_message(item\_id) |
|  |  | return Comment.where("(item\_id=#{item\_id}) and (xtype='#{Comment::XTYPE\_DIST\_ACK}') and (message='#{ack\_msg}')").count |
|  |  | end |
| Expand Down | |  |

2 changes: 2 additions & 0 deletions

2
[app/models/address.rb](#diff-4c2d4bccb73a3296911380789e5eb5e1bd37b277d07e743e6a6441879528cee6 "app/models/address.rb")

Show comments

[View file](/sysphonic/thetis/blob/ce535a38ec92ff0f98af11ab41a425d1529a31ef/app/models/address.rb)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -36,6 +36,8 @@ class Address < ActiveRecord::Base |
|  |  | # |
|  |  | def self.get\_by\_email(mail\_addr, user, book=Address::BOOK\_BOTH) |
|  |  |  |
|  |  | SqlHelper.validate\_token([mail\_addr]) |
|  |  |  |
|  |  | email\_con = [] |
|  |  | email\_con.push("(email1='#{mail\_addr}')") |
|  |  | email\_con.push("(email2='#{mail\_addr}')") |
| Expand Down | |  |

5 changes: 5 additions & 0 deletions

5
[app/models/email.rb](#diff-02c13e71f0c5f29a8e43dde10a166be8cd5f1999707ae26ef1aef690610e06ec "app/models/email.rb")

Show comments

[View file](/sysphonic/thetis/blob/ce535a38ec92ff0f98af11ab41a425d1529a31ef/app/models/email.rb)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -618,6 +618,9 @@ def get\_dir |
|  |  | #\_max\_:: Max number. |
|  |  | # |
|  |  | def self.trim(user\_id, mail\_account\_id, max) |
|  |  |  |
|  |  | SqlHelper.validate\_token([user\_id, mail\_account\_id]) |
|  |  |  |
|  |  | begin |
|  |  | count = Email.where("mail\_account\_id=#{mail\_account\_id}").count |
|  |  | if count > max |
| Expand Down  Expand Up | | @@ -757,6 +760,8 @@ def self.destroy(id) |
|  |  | # |
|  |  | def self.destroy\_by\_user(user\_id, add\_con=nil) |
|  |  |  |
|  |  | SqlHelper.validate\_token([user\_id]) |
|  |  |  |
|  |  | con = "user\_id=#{user\_id}" |
|  |  | con << " and (#{add\_con})" unless add\_con.nil? or add\_con.empty? |
|  |  | emails = Email.where(con).to\_a |
| Expand Down | |  |

1 change: 1 addition & 0 deletions

1
[app/models/folder.rb](#diff-71f7d2ee88389d841ac6ac058dde5a4af5e5d1dcfe065f2ecb850919e6ed8fd7 "app/models/folder.rb")

Show comments

[View file](/sysphonic/thetis/blob/ce535a38ec92ff0f98af11ab41a425d1529a31ef/app/models/folder.rb)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -641,6 +641,7 @@ def self.get\_childs\_for(user, folder\_id, recursive, admin, ret\_obj) |
|  |  | # |
|  |  | def self.get\_childs(folder\_id, conditions, recursive, admin, ret\_obj) |
|  |  |  |
|  |  | SqlHelper.validate\_token([folder\_id]) |
|  |  | arr = [] |
|  |  |  |
|  |  | if recursive |
| Expand Down | |  |

1 change: 1 addition & 0 deletions

1
[app/models/group.rb](#diff-d60319197e54a8992a066d6243587f4434506f5b924282954fa5f5a8f4ee05e2 "app/models/group.rb")

Show comments

[View file](/sysphonic/thetis/blob/ce535a38ec92ff0f98af11ab41a425d1529a31ef/app/models/group.rb)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -374,6 +374,7 @@ def get\_group\_folder |
|  |  | # |
|  |  | def self.get\_group\_folder(group\_id) |
|  |  |  |
|  |  | SqlHelper.validate\_token([group\_id]) |
|  |  | begin |
|  |  | return Folder.where("(owner\_id=#{group\_id}) and (xtype='#{Folder::XTYPE\_GROUP}')").first |
|  |  | rescue => evar |
| Expand Down | |  |

1 change: 1 addition & 0 deletions

1
[app/models/location.rb](#diff-83acc4923e9ebe15ae1c7ed932799fabc336c772c0e9233e1537a435da8cb1dc "app/models/location.rb")

Show comments

[View file](/sysphonic/thetis/blob/ce535a38ec92ff0f98af11ab41a425d1529a31ef/app/models/location.rb)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -44,6 +44,7 @@ def self.get\_for(user) |
|  |  | # |
|  |  | def self.get\_for\_group(group\_id) |
|  |  |  |
|  |  | SqlHelper.validate\_token([group\_id]) |
|  |  | if group\_id.nil? |
|  |  | con = 'group\_id is null' |
|  |  | else |
| Expand Down | |  |

8 changes: 5 additions & 3 deletions

8
[app/models/mail\_account.rb](#diff-bd9cd06c7bf1b1b5f5aa2a92f65d56470e4a9de033c6bdd963ee854191fc2300 "app/models/mail_account.rb")

Show comments

[View file](/sysphonic/thetis/blob/ce535a38ec92ff0f98af11ab41a425d1529a31ef/app/models/mail_account.rb)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -154,6 +154,8 @@ def need\_pop?(uid) |
|  |  | # |
|  |  | def self.destroy\_by\_user(user\_id, add\_con=nil) |
|  |  |  |
|  |  | SqlHelper.validate\_token([user\_id]) |
|  |  |  |
|  |  | con = "user\_id=#{user\_id}" |
|  |  | con << " and (#{add\_con})" unless add\_con.nil? or add\_con.empty? |
|  |  | mail\_accounts = MailAccount.where(con).to\_a |
| Expand Down  Expand Up | | @@ -265,12 +267,12 @@ def self.get\_default\_for(user\_id, xtype=nil) |
|  |  | where = 'where ' + con.join(' and ') |
|  |  | end |
|  |  |  |
|  |  | account\_ary = MailAccount.find\_by\_sql('select \* from mail\_accounts ' + where + ' order by xorder ASC, title ASC') |
|  |  | mail\_accounts = MailAccount.find\_by\_sql('select \* from mail\_accounts ' + where + ' order by xorder ASC, title ASC') |
|  |  |  |
|  |  | if account\_ary.nil? or account\_ary.empty? |
|  |  | if mail\_accounts.nil? or mail\_accounts.empty? |
|  |  | return nil |
|  |  | else |
|  |  | return account\_ary.first |
|  |  | return mail\_accounts.first |
|  |  | end |
|  |  | end |
|  |  | end |

4 changes: 4 additions & 0 deletions

4
[app/models/mail\_folder.rb](#diff-02ef7454621c4738b4dc4b9c3c68f7d28dc67c3ee218fe617b8852298c7ff589 "app/models/mail_folder.rb")

Show comments

[View file](/sysphonic/thetis/blob/ce535a38ec92ff0f98af11ab41a425d1529a31ef/app/models/mail_folder.rb)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -148,6 +148,8 @@ def self.get\_for(user, mail\_account\_id, xtype) |
|  |  | user\_id = user.to\_s |
|  |  | end |
|  |  |  |
|  |  | SqlHelper.validate\_token([user\_id, mail\_account\_id, xtype]) |
|  |  |  |
|  |  | con = [] |
|  |  | con << "(user\_id=#{user\_id})" |
|  |  | con << "(mail\_account\_id=#{mail\_account\_id})" |
| Expand All | | @@ -173,6 +175,8 @@ def self.get\_account\_roots\_for(user) |
|  |  | user\_id = user.to\_s |
|  |  | end |
|  |  |  |
|  |  | SqlHelper.validate\_token([user\_id]) |
|  |  |  |
|  |  | con = [] |
|  |  | con << "(user\_id=#{user\_id})" |
|  |  | con << "(xtype='#{MailFolder::XTYPE\_ACCOUNT\_ROOT}')" |
| Expand Down | |  |

13 changes: 11 additions & 2 deletions

13
[app/models/paid\_holiday.rb](#diff-792ac3f00e707c9621dbefd30e3fc730277a2175e9d16c88e3ca1185a1a9d1b8 "app/models/paid_holiday.rb")

Show comments

[View file](/sysphonic/thetis/blob/ce535a38ec92ff0f98af11ab41a425d1529a31ef/app/models/paid_holiday.rb)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -29,6 +29,9 @@ class PaidHoliday < ActiveRecord::Base |
|  |  | #return:: PaidHoliday(s) for the specified User. |
|  |  | # |
|  |  | def self.get\_for(user\_id, fiscal\_year=nil) |
|  |  |  |
|  |  | SqlHelper.validate\_token([user\_id, fiscal\_year]) |
|  |  |  |
|  |  | begin |
|  |  | con = [] |
|  |  | con << "(user\_id=#{user\_id})" |
| Expand All | | @@ -54,8 +57,13 @@ def self.get\_for(user\_id, fiscal\_year=nil) |
|  |  | # |
|  |  | def self.update\_for(user\_id, fiscal\_year, num) |
|  |  |  |
|  |  | SqlHelper.validate\_token([user\_id, fiscal\_year]) |
|  |  |  |
|  |  | if num <= 0 |
|  |  | PaidHoliday.destroy\_all(['user\_id=? and year=?', user\_id, fiscal\_year]) |
|  |  | con = [] |
|  |  | con << "(user\_id=#{user\_id})" |
|  |  | con << "(year=#{fiscal\_year})" |
|  |  | PaidHoliday.destroy\_all(con.join(' and ')) |
|  |  | return |
|  |  | end |
|  |  |  |
| Expand All | | @@ -82,6 +90,8 @@ def self.update\_for(user\_id, fiscal\_year, num) |
|  |  | # |
|  |  | def self.get\_carried\_over(user\_id, year) |
|  |  |  |
|  |  | SqlHelper.validate\_token([user\_id, year]) |
|  |  |  |
|  |  | yaml = ApplicationHelper.get\_config\_yaml |
|  |  | unless yaml[:timecard].nil? |
|  |  | paidhld\_carry\_over = yaml[:timecard]['paidhld\_carry\_over'] |
| Expand Down  Expand Up | | @@ -134,5 +144,4 @@ def self.get\_carried\_over(user\_id, year) |
|  |  | return 0 |
|  |  | end |
|  |  | end |
|  |  |  |
|  |  | end |

2 changes: 2 additions & 0 deletions

2
[app/models/research.rb](#diff-da0bd78e51ac9e3b0c4d77a642e421bcc0068c0e1535795c992a5ecc89f8e544 "app/models/research.rb")

Show comments

[View file](/sysphonic/thetis/blob/ce535a38ec92ff0f98af11ab41a425d1529a31ef/app/models/research.rb)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -356,6 +356,8 @@ def self.get\_status |
|  |  | # |
|  |  | def self.get\_for(user\_id) |
|  |  |  |
|  |  | SqlHelper.validate\_token([user\_id]) |
|  |  |  |
|  |  | return Research.where("user\_id=#{user\_id}").first |
|  |  | end |
|  |  |  |
| Expand Down | |  |

 Loading

Oops, something went wrong.
 Retry

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `ce535a3`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fsysphonic%2Fthetis%2Fcommit%2Fce535a38ec92ff0f98af11ab41a425d1529a31ef) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_60f6ef8d_20250125_223350.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fsysphonic%2Fthetis%2Fcommit%2F842e44f0c2bd7d680430bb89a3bb78fd744961f9)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fsysphonic%2Fthetis%2Fcommit%2F842e44f0c2bd7d680430bb89a3bb78fd744961f9)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=sysphonic%2Fthetis)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[sysphonic](/sysphonic)
/
**[thetis](/sysphonic/thetis)**
Public

* [Notifications](/login?return_to=%2Fsysphonic%2Fthetis) You must be signed in to change notification settings
* [Fork
  6](/login?return_to=%2Fsysphonic%2Fthetis)
* [Star
   6](/login?return_to=%2Fsysphonic%2Fthetis)

* [Code](/sysphonic/thetis)
* [Issues
  2](/sysphonic/thetis/issues)
* [Pull requests
  8](/sysphonic/thetis/pulls)
* [Actions](/sysphonic/thetis/actions)
* [Projects
  0](/sysphonic/thetis/projects)
* [Wiki](/sysphonic/thetis/wiki)
* [Security](/sysphonic/thetis/security)
* [Insights](/sysphonic/thetis/pulse)

Additional navigation options

* [Code](/sysphonic/thetis)
* [Issues](/sysphonic/thetis/issues)
* [Pull requests](/sysphonic/thetis/pulls)
* [Actions](/sysphonic/thetis/actions)
* [Projects](/sysphonic/thetis/projects)
* [Wiki](/sysphonic/thetis/wiki)
* [Security](/sysphonic/thetis/security)
* [Insights](/sysphonic/thetis/pulse)

## Commit

[Permalink](/sysphonic/thetis/commit/842e44f0c2bd7d680430bb89a3bb78fd744961f9)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Reinforcement of security.

[Browse files](/sysphonic/thetis/tree/842e44f0c2bd7d680430bb89a3bb78fd744961f9)
Browse the repository at this point in the history

```
Signed-off-by: MORITA Shintaro <shin@sysphonic.com>
```

* Loading branch information

MORITA Shintaro
committed
Jul 9, 2015

1 parent
[d9ed965](/sysphonic/thetis/commit/d9ed965075634ca1a095b480b459c68445ce951d)

commit 842e44f

 Show file tree

 Hide file tree

Showing
**29 changed files**
with
**552 additions**
and
**171 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* app

  + controllers

    - app/controllers/addressbook\_controller.rb
      [addressbook\_controller.rb](#diff-f40fef05b1e56cb72937d3beed82b848f4d1b655cd0adfdbb7b7da58785c31a2)
    - app/controllers/config\_controller.rb
      [config\_controller.rb](#diff-795aa778f5295b024065c7896ac7d132f5a4eebe37fbd91ac1b697cc3e2b5a71)
    - app/controllers/desktop\_controller.rb
      [desktop\_controller.rb](#diff-3b957ea57b9a49d5a3d9f9139d99927002cbe1de7164a74f111caea99a178ea8)
    - app/controllers/equipment\_controller.rb
      [equipment\_controller.rb](#diff-a6bd8c9d5f7ad7b2475a7e28948c011475e772028fd7d9fd37dda73ae5e5de6b)
    - app/controllers/folders\_controller.rb
      [folders\_controller.rb](#diff-febcb95dfaf86639e0c7d0106b4c9e003038e1cbbef2010145eb83f4e2851a87)
    - app/controllers/groups\_controller.rb
      [groups\_controller.rb](#diff-af3ad490ca40c9ba7d5641ead932a1b6af38ec2b4af21c0f8468b11ed97f0ba5)
    - app/controllers/items\_controller.rb
      [items\_controller.rb](#diff-22da4de4953a8a5748f5a8f4425eb896283d008abd9525a4a33c9fd76f35f40b)
    - app/controllers/locations\_controller.rb
      [locations\_controller.rb](#diff-bee6109a705a78cdfa12162d723fe642c7b7c8e53045513503b6d8e574e41b15)
    - app/controllers/login\_controller.rb
      [login\_controller.rb](#diff-5d401230d249c0833d3c04a53f1aeab6c223010a996fe82296635e88a10c8cc7)
    - app/controllers/logs\_controller.rb
      [logs\_controller.rb](#diff-885f93cb85543b080449d8fb4b29d19a5bdeec5ebb68b64e62cfbb3e6d384c8f)
    - app/controllers/mail\_accounts\_controller.rb
      [mail\_accounts\_controller.rb](#diff-bc5c4f034b7029f2af70d62e9a18db21d6502b50b65fa23fd441d5d5fe592e18)
    - app/controllers/mail\_filters\_controller.rb
      [mail\_filters\_controller.rb](#diff-9bccb1a03eea4bd752e3961f79ca13080c391426447e161550cc9a3c131d13ea)
    - app/controllers/mail\_folders\_controller.rb
      [mail\_folders\_controller.rb](#diff-45bf8570f18660deedb22ec9b369d50559113eb1f0a21f0ac90f10885f48be06)
    - app/controllers/official\_titles\_controller.rb
      [official\_titles\_controller.rb](#diff-ef664c59b95f0c5a76bcf0d71145b2cb7e28c547380a4c60f25ea55e3a40ea3a)
    - app/controllers/paintmail\_controller.rb
      [paintmail\_controller.rb](#diff-28294a1e7318fe3449f82567fd60a87622aa39e2317452849544daaec3fc2a29)
    - app/controllers/researches\_controller.rb
      [researches\_controller.rb](#diff-0499781eed31c40086a8e4deeea6d03b2844b1af37084e73f2dd15e7c62e5446)
    - app/controllers/schedules\_controller.rb
      [schedules\_controller.rb](#diff-176800726e8bb114c5f90d87a1df242f78e48c3fdbcc36daf2bca3ae41865f17)
    - app/controllers/send\_mails\_controller.rb
      [send\_mails\_controller.rb](#diff-d24df03257ed8e00cf433b280701477e1a4f6bfdb2fba5f858ff9b029bab18f4)
    - app/controllers/teams\_controller.rb
      [teams\_controller.rb](#diff-12c9ce357b9fea539eecb36f14249b6adef6a2e0d43e03a1ebc3a89268f32c23)
    - app/controllers/templates\_controller.rb
      [templates\_controller.rb](#diff-346a292d21f0857f4a100d577ce6c1137817211b4417544188e77e9c1f3f74c2)
    - app/controllers/timecards\_controller.rb
      [timecards\_controller.rb](#diff-ee6ecda8e8334ea089dad6882a065bae75594ef945a19f5c5083ae4eba46e890)
    - app/controllers/users\_controller.rb
      [users\_controller.rb](#diff-cfdccd0a9d5df5a43aaad2a35d36ebbe187c52ad5fdc9846fa189d04537adb6e)
    - app/controllers/workflows\_controller.rb
      [workflows\_controller.rb](#diff-17fcd380774296ecbcfc6d7c9d8c5bc357302d1031f18d4c90f97d84aad6e497)
    - app/controllers/zeptair\_dist\_controller.rb
      [zeptair\_dist\_controller.rb](#diff-7bf65e5acd501eee126fb910a13ad9a316fdf793d9b5e430e7c13220c99c7dcd)
    - app/controllers/zeptair\_post\_controller.rb
      [zeptair\_post\_controller.rb](#diff-a24700646fbebdf06a9a1473860a8c891ebe05253bc48a37dfd227d352b1b7ac)
    - app/controllers/zeptair\_xlogs\_controller.rb
      [zeptair\_xlogs\_controller.rb](#diff-d8b4a9680e030c53392fb400f9f5431149263ddb0a056e4526012a13e147853a)
  + helpers

    - app/helpers/addressbook\_helper.rb
      [addressbook\_helper.rb](#diff-dacb9886de07e56a29c39e7c44fe52c38a88b2a5c5942dfe509065e42a948c26)
    - app/helpers/application\_helper.rb
      [application\_helper.rb](#diff-5f3fc5e3977d242572aa1d08551f5eb557de0ccaff30370838ee9df5386ea0da)
  + models

    - app/models/research.rb
      [research.rb](#diff-da0bd78e51ac9e3b0c4d77a642e421bcc0068c0e1535795c992a5ecc89f8e544)

## There are no files selected for viewing

13 changes: 12 additions & 1 deletion

13
[app/controllers/addressbook\_controller.rb](#diff-f40fef05b1e56cb72937d3beed82b848f4d1b655cd0adfdbb7b7da58785c31a2 "app/controllers/addressbook_controller.rb")

Show comments

[View file](/sysphonic/thetis/blob/842e44f0c2bd7d680430bb89a3bb78fd744961f9/app/controllers/addressbook_controller.rb)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -58,6 +58,8 @@ def new |
|  |  | Log.add\_info(request, params.inspect) |
|  |  | end |
|  |  |  |
|  |  | return unless request.post? |
|  |  |  |
|  |  | render(:action => 'edit', :layout => (!request.xhr?)) |
|  |  | end |
|  |  |  |
| Expand All | | @@ -68,6 +70,8 @@ def new |
|  |  | def create |
|  |  | Log.add\_info(request, params.inspect) |
|  |  |  |
|  |  | return unless request.post? |
|  |  |  |
|  |  | @address = Address.new(params.require(:address).permit(Address::PERMIT\_BASE)) |
|  |  |  |
|  |  | @address = AddressbookHelper.arrange\_per\_scope(@address, @login\_user, params[:scope], params[:groups], params[:teams]) |
| Expand Down  Expand Up | | @@ -106,6 +110,7 @@ def edit |
|  |  | begin |
|  |  | @address = Address.find(address\_id) |
|  |  | rescue => evar |
|  |  | @address = nil |
|  |  | Log.add\_error(request, evar) |
|  |  | redirect\_to(:controller => 'login', :action => 'logout') |
|  |  | return |
| Expand Down  Expand Up | | @@ -142,6 +147,8 @@ def show |
|  |  | def update |
|  |  | Log.add\_info(request, params.inspect) |
|  |  |  |
|  |  | return unless request.post? |
|  |  |  |
|  |  | @address = Address.find(params[:id]) |
|  |  | @address.attributes = params[:address] |
|  |  |  |
| Expand Down  Expand Up | | @@ -242,6 +249,8 @@ def search |
|  |  | def destroy |
|  |  | Log.add\_info(request, params.inspect) |
|  |  |  |
|  |  | return unless request.post? |
|  |  |  |
|  |  | if params[:check\_address].nil? |
|  |  | list |
|  |  | render(:action => 'list') |
| Expand Down  Expand Up | | @@ -296,6 +305,8 @@ def export\_csv |
|  |  | def import\_csv |
|  |  | Log.add\_info(request, params.inspect) |
|  |  |  |
|  |  | return unless request.post? |
|  |  |  |
|  |  | file = params[:imp\_file] |
|  |  | mode = params[:mode] |
|  |  | enc = params[:enc] |
| Expand Down  Expand Up | | @@ -436,7 +447,7 @@ def import\_csv |
|  |  | # |
|  |  | def check\_owner |
|  |  |  |
|  |  | return if (params[:id].nil? or params[:id].empty? or @login\_user.nil?) |
|  |  | return if (params[:id].blank? or @login\_user.nil?) |
|  |  |  |
|  |  | address = Address.find(params[:id]) |
|  |  |  |
| Expand Down | |  |

14 changes: 12 additions & 2 deletions

14
[app/controllers/config\_controller.rb](#diff-795aa778f5295b024065c7896ac7d132f5a4eebe37fbd91ac1b697cc3e2b5a71 "app/controllers/config_controller.rb")

Show comments

[View file](/sysphonic/thetis/blob/842e44f0c2bd7d680430bb89a3bb78fd744961f9/app/controllers/config_controller.rb)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -3,7 +3,7 @@ |
|  |  | # |
|  |  | #Original by:: Sysphonic |
|  |  | #Authors:: MORITA Shintaro |
|  |  | #Copyright:: Copyright (c) 2007-2011 MORITA Shintaro, Sysphonic. All rights reserved. |
|  |  | #Copyright:: Copyright (c) 2007-2015 MORITA Shintaro, Sysphonic. All rights reserved. |
|  |  | #License:: New BSD License (See LICENSE file) |
|  |  | #URL:: {http&#58;//sysphonic.com/}[http://sysphonic.com/] |
|  |  | # |
| Expand Down  Expand Up | | @@ -39,13 +39,15 @@ def edit |
|  |  | def update\_by\_ajax |
|  |  | Log.add\_info(request, params.inspect) |
|  |  |  |
|  |  | return unless request.post? |
|  |  |  |
|  |  | cat\_h = {:desktop => User::AUTH\_DESKTOP, :user => User::AUTH\_USER, :log => User::AUTH\_LOG} |
|  |  |  |
|  |  | yaml = ApplicationHelper.get\_config\_yaml |
|  |  |  |
|  |  | cat\_h.keys.each do |cat| |
|  |  |  |
|  |  | next if params[cat].nil? or params[cat].empty? |
|  |  | next if params[cat].blank? |
|  |  |  |
|  |  | unless @login\_user.admin?(cat\_h[cat]) |
|  |  | render(:text => t('msg.need\_to\_be\_admin')) |
| Expand All | | @@ -71,6 +73,8 @@ def update\_by\_ajax |
|  |  | def update |
|  |  | Log.add\_info(request, params.inspect) |
|  |  |  |
|  |  | return unless request.post? |
|  |  |  |
|  |  | categories = [:general, :menu, :topic, :note, :smtp, :feed, :user, :log] |
|  |  |  |
|  |  | yaml = ApplicationHelper.get\_config\_yaml |
| Expand Down  Expand Up | | @@ -149,6 +153,8 @@ def edit\_header\_menu |
|  |  | def destroy\_header\_menu |
|  |  | Log.add\_info(request, params.inspect) |
|  |  |  |
|  |  | return unless request.post? |
|  |  |  |
|  |  | @yaml = ApplicationHelper.get\_config\_yaml |
|  |  |  |
|  |  | unless params[:org\_name].nil? or @yaml[:general]['header\_menus'].nil? |
| Expand All | | @@ -172,6 +178,8 @@ def destroy\_header\_menu |
|  |  | def update\_header\_menu |
|  |  | Log.add\_info(request, params.inspect) |
|  |  |  |
|  |  | return unless request.post? |
|  |  |  |
|  |  | @yaml = ApplicationHelper.get\_config\_yaml |
|  |  |  |
|  |  | @yaml[:general]['header\_menus'] = [] if @yaml[:general]['header\_menus'].nil? |
| Expand Down  Expand Up | | @@ -221,6 +229,8 @@ def update\_header\_menu |
|  |  | def update\_header\_menus\_order |
|  |  | Log.add\_info(request, params.inspect) |
|  |  |  |
|  |  | return unless request.post? |
|  |  |  |
|  |  | header\_menus = params[:header\_menus\_order] |
|  |  |  |
|  |  | yaml = ApplicationHelper.get\_config\_yaml |
| Expand Down | |  |

26 changes: 24 additions & 2 deletions

26
[app/controllers/desktop\_controller.rb](#diff-3b957ea57b9a49d5a3d9f9139d99927002cbe1de7164a74f111caea99a178ea8 "app/controllers/desktop_controller.rb")

Show comments

[View file](/sysphonic/thetis/blob/842e44f0c2bd7d680430bb89a3bb78fd744961f9/app/controllers/desktop_controller.rb)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -3,7 +3,7 @@ |
|  |  | # |
|  |  | #Original by:: Sysphonic |
|  |  | #Authors:: MORITA Shintaro |
|  |  | #Copyright:: Copyright (c) 2007-2011 MORITA Shintaro, Sysphonic. All rights reserved. |
|  |  | #Copyright:: Copyright (c) 2007-2015 MORITA Shintaro, Sysphonic. All rights reserved. |
|  |  | #License:: New BSD License (See LICENSE file) |
|  |  | #URL:: {http&#58;//sysphonic.com/}[http://sysphonic.com/] |
|  |  | # |
| Expand Down  Expand Up | | @@ -36,6 +36,8 @@ class DesktopController < ApplicationController |
|  |  | def drop\_file |
|  |  | Log.add\_info(request, '') # Not to show passwords. |
|  |  |  |
|  |  | return unless request.post? |
|  |  |  |
|  |  | if params[:file].nil? or params[:file].size <= 0 |
|  |  | render(:text => '') |
|  |  | return |
| Expand Down  Expand Up | | @@ -126,6 +128,8 @@ def edit\_config |
|  |  | def update\_pref |
|  |  | Log.add\_info(request, params.inspect) |
|  |  |  |
|  |  | return unless request.post? |
|  |  |  |
|  |  | desktop = Desktop.get\_for(@login\_user, true) |
|  |  |  |
|  |  | params[:desktop].delete(:user\_id) |
| Expand All | | @@ -145,9 +149,11 @@ def update\_pref |
|  |  | def update\_config |
|  |  | Log.add\_info(request, params.inspect) |
|  |  |  |
|  |  | return unless request.post? |
|  |  |  |
|  |  | @yaml = ApplicationHelper.get\_config\_yaml |
|  |  |  |
|  |  | unless params[:desktop].nil? or params[:desktop].empty? |
|  |  | unless params[:desktop].blank? |
|  |  | @yaml[:desktop] = Hash.new if @yaml[:desktop].nil? |
|  |  |  |
|  |  | params[:desktop].each do |key, val| |
| Expand Down  Expand Up | | @@ -294,6 +300,8 @@ def get\_news\_tray |
|  |  | def drop\_on\_desktop |
|  |  | Log.add\_info(request, params.inspect) |
|  |  |  |
|  |  | return unless request.post? |
|  |  |  |
|  |  | if @login\_user.nil? |
|  |  | t = Time.now |
|  |  | render(:text => (t.hour.to\_s + t.min.to\_s + t.sec.to\_s)) |
| Expand All | | @@ -319,6 +327,8 @@ def drop\_on\_desktop |
|  |  | def add\_toy |
|  |  | Log.add\_info(request, params.inspect) |
|  |  |  |
|  |  | return unless request.post? |
|  |  |  |
|  |  | if @login\_user.nil? |
|  |  | render(:text => '0') |
|  |  | return |
| Expand All | | @@ -343,6 +353,9 @@ def add\_toy |
|  |  | def drop\_on\_recyclebox |
|  |  | Log.add\_info(request, params.inspect) |
|  |  |  |
|  |  | return unless request.post? |
|  |  |  |
|  |  | SqlHelper.validate\_token([params[:id]]) |
|  |  | unless @login\_user.nil? |
|  |  | Toy.destroy(params[:id]) |
|  |  | end |
| Expand All | | @@ -358,10 +371,13 @@ def drop\_on\_recyclebox |
|  |  | def on\_toys\_moved |
|  |  | Log.add\_info(request, params.inspect) |
|  |  |  |
|  |  | return unless request.post? |
|  |  |  |
|  |  | unless @login\_user.nil? |
|  |  | begin |
|  |  | toy = Toy.find(params[:id]) |
|  |  | rescue |
|  |  | toy = nil |
|  |  | end |
|  |  |  |
|  |  | unless toy.nil? |
| Expand All | | @@ -381,6 +397,8 @@ def on\_toys\_moved |
|  |  | def create\_label |
|  |  | Log.add\_info(request, params.inspect) |
|  |  |  |
|  |  | return unless request.post? |
|  |  |  |
|  |  | if params[:thetisBoxEdit].empty? |
|  |  | render(:partial => 'ajax\_label', :layout => false) |
|  |  | return |
| Expand Down  Expand Up | | @@ -411,6 +429,8 @@ def create\_label |
|  |  | def update\_label |
|  |  | Log.add\_info(request, params.inspect) |
|  |  |  |
|  |  | return unless request.post? |
|  |  |  |
|  |  | msg = params[:thetisBoxEdit] |
|  |  |  |
|  |  | if params[:thetisBoxEdit].empty? |
| Expand Down  Expand Up | | @@ -455,6 +475,8 @@ def show\_biorhythm |
|  |  | def post\_label |
|  |  | Log.add\_info(request, params.inspect) |
|  |  |  |
|  |  | return unless request.post? |
|  |  |  |
|  |  | if params[:txaPostLabel].empty? or params[:post\_to].empty? |
|  |  | render(:text => '') |
|  |  | return |
| Expand Down | |  |

19 changes: 15 additions & 4 deletions

19
[app/controllers/equipment\_controller.rb](#diff-a6bd8c9d5f7ad7b2475a7e28948c011475e772028fd7d9fd37dda73ae5e5de6b "app/controllers/equipment_controller.rb")

Show comments

[View file](/sysphonic/thetis/blob/842e44f0c2bd7d680430bb89a3bb78fd744961f9/app/controllers/equipment_controller.rb)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -3,7 +3,7 @@ |
|  |  | # |
|  |  | #Original by:: Sysphonic |
|  |  | #Authors:: MORITA Shintaro |
|  |  | #Copyright:: Copyright (c) 2007-2011 MORITA Shintaro, Sysphonic. All rights reserved. |
|  |  | #Copyright:: Copyright (c) 2007-2015 MORITA Shintaro, Sysphonic. All rights reserved. |
|  |  | #License:: New BSD License (See LICENSE file) |
|  |  | #URL:: {http&#58;//sysphonic.com/}[http://sysphonic.com/] |
|  |  | # |
| Expand Down  Expand Up | | @@ -42,6 +42,10 @@ def new |
|  |  | def create |
|  |  | Log.add\_info(request, params.inspect) |
|  |  |  |
|  |  | return unless request.post? |
|  |  |  |
|  |  | SqlHelper.validate\_token([params[:groups], params[:teams]]) |
|  |  |  |
|  |  | if params[:groups].blank? |
|  |  | params[:equipment][:groups] = nil |
|  |  | else |
| Expand Down  Expand Up | | @@ -101,15 +105,19 @@ def show |
|  |  | def update |
|  |  | Log.add\_info(request, params.inspect) |
|  |  |  |
|  |  | return unless request.post? |
|  |  |  |
|  |  | SqlHelper.validate\_token([params[:groups], params[:teams]]) |
|  |  |  |
|  |  | @equipment = Equipment.find(params[:id]) |
|  |  |  |
|  |  | if (params[:groups].nil? or params[:groups].empty?) |
|  |  | if params[:groups].blank? |
|  |  | params[:equipment][:groups] = nil |
|  |  | else |
|  |  | params[:equipment][:groups] = '|' + params[:groups].join('|') + '|' |
|  |  | end |
|  |  |  |
|  |  | if (params[:teams].nil? or params[:teams].empty?) |
|  |  | if params[:teams].blank? |
|  |  | params[:equipment][:teams] = nil |
|  |  | else |
|  |  | params[:equipment][:teams] = '|' + params[:teams].join('|') + '|' |
| Expand Down  Expand Up | | @@ -178,6 +186,8 @@ def list |
|  |  | def destroy |
|  |  | Log.add\_info(request, params.inspect) |
|  |  |  |
|  |  | return unless request.post? |
|  |  |  |
|  |  | if params[:check\_equipment].nil? |
|  |  | list |
|  |  | render(:action => 'list') |
| Expand All | | @@ -186,6 +196,7 @@ def destroy |
|  |  |  |
|  |  | count = 0 |
|  |  | params[:check\_equipment].each do |equipment\_id, value| |
|  |  | SqlHelper.validate\_token([equipment\_id]) |
|  |  | if value == '1' |
|  |  | Equipment.delete(equipment\_id) |
|  |  |  |
| Expand All | | @@ -205,7 +216,7 @@ def schedule\_all |
|  |  | Log.add\_info(request, params.inspect) |
|  |  |  |
|  |  | date\_s = params[:date] |
|  |  | if date\_s.nil? or date\_s.empty? |
|  |  | if date\_s.blank? |
|  |  | @date = Date.today |
|  |  | else |
|  |  | @date = Date.parse(date\_s) |
| Expand Down | |  |

 Loading

Oops, something went wrong.
 Retry

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `842e44f`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fsysphonic%2Fthetis%2Fcommit%2F842e44f0c2bd7d680430bb89a3bb78fd744961f9) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_f63db61a_20250125_223346.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fsysphonic%2Fthetis%2Fcommit%2F4ca3f5f486759660b87d7c146f1fdc11264f56eb)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fsysphonic%2Fthetis%2Fcommit%2F4ca3f5f486759660b87d7c146f1fdc11264f56eb)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=sysphonic%2Fthetis)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[sysphonic](/sysphonic)
/
**[thetis](/sysphonic/thetis)**
Public

* [Notifications](/login?return_to=%2Fsysphonic%2Fthetis) You must be signed in to change notification settings
* [Fork
  6](/login?return_to=%2Fsysphonic%2Fthetis)
* [Star
   6](/login?return_to=%2Fsysphonic%2Fthetis)

* [Code](/sysphonic/thetis)
* [Issues
  2](/sysphonic/thetis/issues)
* [Pull requests
  8](/sysphonic/thetis/pulls)
* [Actions](/sysphonic/thetis/actions)
* [Projects
  0](/sysphonic/thetis/projects)
* [Wiki](/sysphonic/thetis/wiki)
* [Security](/sysphonic/thetis/security)
* [Insights](/sysphonic/thetis/pulse)

Additional navigation options

* [Code](/sysphonic/thetis)
* [Issues](/sysphonic/thetis/issues)
* [Pull requests](/sysphonic/thetis/pulls)
* [Actions](/sysphonic/thetis/actions)
* [Projects](/sysphonic/thetis/projects)
* [Wiki](/sysphonic/thetis/wiki)
* [Security](/sysphonic/thetis/security)
* [Insights](/sysphonic/thetis/pulse)

## Commit

[Permalink](/sysphonic/thetis/commit/4ca3f5f486759660b87d7c146f1fdc11264f56eb)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Reinforcement of security.

[Browse files](/sysphonic/thetis/tree/4ca3f5f486759660b87d7c146f1fdc11264f56eb)
Browse the repository at this point in the history

```
Signed-off-by: MORITA Shintaro <shin@sysphonic.com>
```

* Loading branch information

MORITA Shintaro
committed
Jul 5, 2015

1 parent
[a61dc72](/sysphonic/thetis/commit/a61dc72035c7ae0b06f6d7dc8b2a848ffc7db277)

commit 4ca3f5f

 Show file tree

 Hide file tree

Showing
**14 changed files**
with
**61 additions**
and
**33 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* app

  + controllers

    - app/controllers/desktop\_controller.rb
      [desktop\_controller.rb](#diff-3b957ea57b9a49d5a3d9f9139d99927002cbe1de7164a74f111caea99a178ea8)
    - app/controllers/equipment\_controller.rb
      [equipment\_controller.rb](#diff-a6bd8c9d5f7ad7b2475a7e28948c011475e772028fd7d9fd37dda73ae5e5de6b)
    - app/controllers/folders\_controller.rb
      [folders\_controller.rb](#diff-febcb95dfaf86639e0c7d0106b4c9e003038e1cbbef2010145eb83f4e2851a87)
    - app/controllers/items\_controller.rb
      [items\_controller.rb](#diff-22da4de4953a8a5748f5a8f4425eb896283d008abd9525a4a33c9fd76f35f40b)
    - app/controllers/locations\_controller.rb
      [locations\_controller.rb](#diff-bee6109a705a78cdfa12162d723fe642c7b7c8e53045513503b6d8e574e41b15)
    - app/controllers/login\_controller.rb
      [login\_controller.rb](#diff-5d401230d249c0833d3c04a53f1aeab6c223010a996fe82296635e88a10c8cc7)
    - app/controllers/researches\_controller.rb
      [researches\_controller.rb](#diff-0499781eed31c40086a8e4deeea6d03b2844b1af37084e73f2dd15e7c62e5446)
    - app/controllers/schedules\_controller.rb
      [schedules\_controller.rb](#diff-176800726e8bb114c5f90d87a1df242f78e48c3fdbcc36daf2bca3ae41865f17)
    - app/controllers/send\_mails\_controller.rb
      [send\_mails\_controller.rb](#diff-d24df03257ed8e00cf433b280701477e1a4f6bfdb2fba5f858ff9b029bab18f4)
    - app/controllers/timecards\_controller.rb
      [timecards\_controller.rb](#diff-ee6ecda8e8334ea089dad6882a065bae75594ef945a19f5c5083ae4eba46e890)
    - app/controllers/users\_controller.rb
      [users\_controller.rb](#diff-cfdccd0a9d5df5a43aaad2a35d36ebbe187c52ad5fdc9846fa189d04537adb6e)
    - app/controllers/zeptair\_dist\_controller.rb
      [zeptair\_dist\_controller.rb](#diff-7bf65e5acd501eee126fb910a13ad9a316fdf793d9b5e430e7c13220c99c7dcd)
  + helpers

    - app/helpers/sql\_helper.rb
      [sql\_helper.rb](#diff-bacba4ae3b300c54897224b84231621c8922484b2f40ebd3720d0bebc8c76b44)
* db/migrate

  + db/migrate/20110524100000\_changes\_for\_ver110.rb
    [20110524100000\_changes\_for\_ver110.rb](#diff-db896e4b8784d657a89772c84161cb7424caa2226479e10b93f71bb94fdeeea0)

## There are no files selected for viewing

3 changes: 2 additions & 1 deletion

3
[app/controllers/desktop\_controller.rb](#diff-3b957ea57b9a49d5a3d9f9139d99927002cbe1de7164a74f111caea99a178ea8 "app/controllers/desktop_controller.rb")

Show comments

[View file](/sysphonic/thetis/blob/4ca3f5f486759660b87d7c146f1fdc11264f56eb/app/controllers/desktop_controller.rb)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -498,9 +498,10 @@ def get\_group\_users |
|  |  | @group\_id = nil |
|  |  | if !params[:thetisBoxSelKeeper].nil? |
|  |  | @group\_id = params[:thetisBoxSelKeeper].split(':').last |
|  |  | elsif !params[:group\_id].nil? and !params[:group\_id].empty? |
|  |  | elsif !params[:group\_id].blank? |
|  |  | @group\_id = params[:group\_id] |
|  |  | end |
|  |  | SqlHelper.validate\_token([@group\_id]) |
|  |  |  |
|  |  | submit\_url = url\_for(:controller => 'desktop', :action => 'get\_group\_users') |
|  |  | render(:partial => 'common/select\_users', :layout => false, :locals => {:target\_attr => :id, :submit\_url => submit\_url}) |
| Expand Down | |  |

2 changes: 2 additions & 0 deletions

2
[app/controllers/equipment\_controller.rb](#diff-a6bd8c9d5f7ad7b2475a7e28948c011475e772028fd7d9fd37dda73ae5e5de6b "app/controllers/equipment_controller.rb")

Show comments

[View file](/sysphonic/thetis/blob/4ca3f5f486759660b87d7c146f1fdc11264f56eb/app/controllers/equipment_controller.rb)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -139,6 +139,8 @@ def list |
|  |  | elsif !params[:group\_id].blank? |
|  |  | @group\_id = params[:group\_id] |
|  |  | end |
|  |  | SqlHelper.validate\_token([@group\_id]) |
|  |  |  |
|  |  | unless @group\_id.nil? |
|  |  | if @group\_id == '0' |
|  |  | con << "((groups like '%|0|%') or (groups is null))" |
| Expand Down | |  |

9 changes: 6 additions & 3 deletions

9
[app/controllers/folders\_controller.rb](#diff-febcb95dfaf86639e0c7d0106b4c9e003038e1cbbef2010145eb83f4e2851a87 "app/controllers/folders_controller.rb")

Show comments

[View file](/sysphonic/thetis/blob/4ca3f5f486759660b87d7c146f1fdc11264f56eb/app/controllers/folders_controller.rb)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -35,9 +35,10 @@ def show\_tree |
|  |  | @group\_id = nil |
|  |  | if !params[:thetisBoxSelKeeper].nil? |
|  |  | @group\_id = params[:thetisBoxSelKeeper].split(':').last |
|  |  | elsif !params[:group\_id].nil? and !params[:group\_id].empty? |
|  |  | elsif !params[:group\_id].blank? |
|  |  | @group\_id = params[:group\_id] |
|  |  | end |
|  |  | SqlHelper.validate\_token([@group\_id]) |
|  |  |  |
|  |  | @folder\_tree = Folder.get\_tree\_by\_group\_for\_admin(@group\_id || '0') |
|  |  | else |
| Expand Down  Expand Up | | @@ -506,6 +507,7 @@ def get\_auth\_users |
|  |  | def get\_group\_users |
|  |  | Log.add\_info(request, params.inspect) |
|  |  |  |
|  |  | SqlHelper.validate\_token([params[:id]]) |
|  |  | begin |
|  |  | @folder = Folder.find(params[:id]) |
|  |  | rescue => evar |
| Expand All | | @@ -515,11 +517,12 @@ def get\_group\_users |
|  |  | @group\_id = nil |
|  |  | if !params[:thetisBoxSelKeeper].nil? |
|  |  | @group\_id = params[:thetisBoxSelKeeper].split(':').last |
|  |  | elsif !params[:group\_id].nil? and !params[:group\_id].empty? |
|  |  | elsif !params[:group\_id].blank? |
|  |  | @group\_id = params[:group\_id] |
|  |  | end |
|  |  | SqlHelper.validate\_token([@group\_id]) |
|  |  |  |
|  |  | @users = Group.get\_users @group\_id |
|  |  | @users = Group.get\_users(@group\_id) |
|  |  |  |
|  |  | render(:partial => 'ajax\_select\_users', :layout => false) |
|  |  | end |
| Expand Down | |  |

17 changes: 10 additions & 7 deletions

17
[app/controllers/items\_controller.rb](#diff-22da4de4953a8a5748f5a8f4425eb896283d008abd9525a4a33c9fd76f35f40b "app/controllers/items_controller.rb")

Show comments

[View file](/sysphonic/thetis/blob/4ca3f5f486759660b87d7c146f1fdc11264f56eb/app/controllers/items_controller.rb)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -1217,11 +1217,12 @@ def get\_group\_users |
|  |  | @group\_id = nil |
|  |  | if !params[:thetisBoxSelKeeper].nil? |
|  |  | @group\_id = params[:thetisBoxSelKeeper].split(':').last |
|  |  | elsif !params[:group\_id].nil? and !params[:group\_id].empty? |
|  |  | elsif !params[:group\_id].blank? |
|  |  | @group\_id = params[:group\_id] |
|  |  | end |
|  |  | SqlHelper.validate\_token([@group\_id]) |
|  |  |  |
|  |  | @users = Group.get\_users @group\_id |
|  |  | @users = Group.get\_users(@group\_id) |
|  |  |  |
|  |  | render(:partial => 'ajax\_select\_users', :layout => false) |
|  |  | end |
| Expand All | | @@ -1234,7 +1235,7 @@ def get\_group\_users |
|  |  | def wf\_issue |
|  |  | Log.add\_info(request, params.inspect) |
|  |  |  |
|  |  | begin |
|  |  | begin |
|  |  | @item = Item.find(params[:id]) |
|  |  | @workflow = @item.workflow |
|  |  | rescue => evar |
| Expand All | | @@ -1258,7 +1259,7 @@ def team\_organize |
|  |  | Log.add\_info(request, params.inspect) |
|  |  |  |
|  |  | team\_id = params[:team\_id] |
|  |  | unless team\_id.nil? or team\_id.empty? |
|  |  | unless team\_id.blank? |
|  |  | begin |
|  |  | @team = Team.find(team\_id) |
|  |  | rescue |
| Expand All | | @@ -1280,7 +1281,7 @@ def team\_organize |
|  |  |  |
|  |  | if team\_members.nil? or team\_members.empty? |
|  |  |  |
|  |  | unless team\_id.nil? or team\_id.empty? |
|  |  | unless team\_id.blank? |
|  |  | # @team must not be nil. |
|  |  | @team.save if modified = @team.clear\_users |
|  |  | end |
| Expand All | | @@ -1289,7 +1290,7 @@ def team\_organize |
|  |  |  |
|  |  | if team\_members != users |
|  |  |  |
|  |  | if team\_id.nil? or team\_id.empty? |
|  |  | if team\_id.blank? |
|  |  |  |
|  |  | item = Item.find(params[:id]) |
|  |  |  |
| Expand Down  Expand Up | | @@ -1359,6 +1360,8 @@ def move\_in\_team\_folder |
|  |  | def change\_team\_status |
|  |  | Log.add\_info(request, params.inspect) |
|  |  |  |
|  |  | SqlHelper.validate\_token([params[:status]]) |
|  |  |  |
|  |  | team\_id = params[:team\_id] |
|  |  | begin |
|  |  | team = Team.find(team\_id) |
| Expand All | | @@ -1382,7 +1385,7 @@ def change\_team\_status |
|  |  | #Filter method to check if the current User is owner of the specified Item. |
|  |  | # |
|  |  | def check\_owner |
|  |  | return if params[:id].nil? or params[:id].empty? or @login\_user.nil? |
|  |  | return if params[:id].blank? or @login\_user.nil? |
|  |  |  |
|  |  | begin |
|  |  | owner\_id = Item.find(params[:id]).user\_id |
| Expand Down | |  |

3 changes: 3 additions & 0 deletions

3
[app/controllers/locations\_controller.rb](#diff-bee6109a705a78cdfa12162d723fe642c7b7c8e53045513503b6d8e574e41b15 "app/controllers/locations_controller.rb")

Show comments

[View file](/sysphonic/thetis/blob/4ca3f5f486759660b87d7c146f1fdc11264f56eb/app/controllers/locations_controller.rb)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -38,6 +38,7 @@ def open\_map |
|  |  | elsif !params[:group\_id].blank? |
|  |  | @group\_id = params[:group\_id] |
|  |  | end |
|  |  | SqlHelper.validate\_token([@group\_id]) |
|  |  |  |
|  |  | unless params[:keyword].blank? |
|  |  | con\_prim = [] |
| Expand Down  Expand Up | | @@ -142,6 +143,7 @@ def update\_map |
|  |  | Log.add\_info(request, params.inspect) |
|  |  |  |
|  |  | group\_id = params[:group\_id] |
|  |  | SqlHelper.validate\_token([group\_id]) |
|  |  |  |
|  |  | @office\_map = OfficeMap.get\_for\_group(group\_id, true) |
|  |  |  |
| Expand All | | @@ -163,6 +165,7 @@ def delete\_map |
|  |  | Log.add\_info(request, params.inspect) |
|  |  |  |
|  |  | group\_id = params[:group\_id] |
|  |  | SqlHelper.validate\_token([group\_id]) |
|  |  |  |
|  |  | @office\_map = OfficeMap.get\_for\_group(group\_id, false) |
|  |  |  |
| Expand Down | |  |

4 changes: 3 additions & 1 deletion

4
[app/controllers/login\_controller.rb](#diff-5d401230d249c0833d3c04a53f1aeab6c223010a996fe82296635e88a10c8cc7 "app/controllers/login_controller.rb")

Show comments

[View file](/sysphonic/thetis/blob/4ca3f5f486759660b87d7c146f1fdc11264f56eb/app/controllers/login_controller.rb)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -96,8 +96,10 @@ def logout |
|  |  | def send\_password |
|  |  | Log.add\_info(request, params.inspect) |
|  |  |  |
|  |  | mail\_addr = params[:thetisBoxEdit] |
|  |  | SqlHelper.validate\_token([mail\_addr], ['@-']) |
|  |  | begin |
|  |  | users = User.where("email='#{params[:thetisBoxEdit]}'").to\_a |
|  |  | users = User.where("email='#{mail\_addr}'").to\_a |
|  |  | rescue => evar |
|  |  | end |
|  |  |  |
| Expand Down | |  |

12 changes: 9 additions & 3 deletions

12
[app/controllers/researches\_controller.rb](#diff-0499781eed31c40086a8e4deeea6d03b2844b1af37084e73f2dd15e7c62e5446 "app/controllers/researches_controller.rb")

Show comments

[View file](/sysphonic/thetis/blob/4ca3f5f486759660b87d7c146f1fdc11264f56eb/app/controllers/researches_controller.rb)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -434,8 +434,9 @@ def edit\_page |
|  |  |  |
|  |  | # Specifying page |
|  |  | @page = '01' |
|  |  | unless params[:page].nil? or params[:page].empty? |
|  |  | unless params[:page].blank? |
|  |  | @page = params[:page] |
|  |  | SqlHelper.validate\_token([@page]) |
|  |  | end |
|  |  | end |
|  |  |  |
| Expand Down  Expand Up | | @@ -466,12 +467,14 @@ def save\_page |
|  |  | end |
|  |  | end |
|  |  |  |
|  |  | if params[:research\_id].nil? or params[:research\_id].empty? |
|  |  | research\_id = params[:research\_id] |
|  |  | SqlHelper.validate\_token([research\_id]) |
|  |  | if research\_id.blank? |
|  |  | @research = Research.new(params.require(:research).permit(Research::PERMIT\_BASE)) |
|  |  | @research.status = Research::U\_STATUS\_IN\_ACTON |
|  |  | @research.update\_attribute(:user\_id, @login\_user.id) |
|  |  | else |
|  |  | @research = Research.find(params[:research\_id]) |
|  |  | @research = Research.find(research\_id) |
|  |  | @research.update\_attributes(params.require(:research).permit(Research::PERMIT\_BASE)) |
|  |  | end |
|  |  |  |
| Expand Down  Expand Up | | @@ -552,6 +555,8 @@ def users |
|  |  | elsif !params[:group\_id].blank? |
|  |  | @group\_id = params[:group\_id] |
|  |  | end |
|  |  | SqlHelper.validate\_token([@group\_id]) |
|  |  |  |
|  |  | unless @group\_id.nil? |
|  |  | con << SqlHelper.get\_sql\_like([:groups], "|#{@group\_id}|") |
|  |  | end |
| Expand Down  Expand Up | | @@ -690,6 +695,7 @@ def get\_records\_group |
|  |  |  |
|  |  | unless params[:thetisBoxSelKeeper].nil? |
|  |  | @group\_id = params[:thetisBoxSelKeeper].split(':').last |
|  |  | SqlHelper.validate\_token([@group\_id]) |
|  |  |  |
|  |  | group\_cons = [] |
|  |  |  |
| Expand Down | |  |

6 changes: 4 additions & 2 deletions

6
[app/controllers/schedules\_controller.rb](#diff-176800726e8bb114c5f90d87a1df242f78e48c3fdbcc36daf2bca3ae41865f17 "app/controllers/schedules_controller.rb")

Show comments

[View file](/sysphonic/thetis/blob/4ca3f5f486759660b87d7c146f1fdc11264f56eb/app/controllers/schedules_controller.rb)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -678,9 +678,10 @@ def get\_group\_users |
|  |  | @group\_id = nil |
|  |  | if !params[:thetisBoxSelKeeper].nil? |
|  |  | @group\_id = params[:thetisBoxSelKeeper].split(':').last |
|  |  | elsif !params[:group\_id].nil? and !params[:group\_id].empty? |
|  |  | elsif !params[:group\_id].blank? |
|  |  | @group\_id = params[:group\_id] |
|  |  | end |
|  |  | SqlHelper.validate\_token([@group\_id]) |
|  |  |  |
|  |  | submit\_url = url\_for(:controller => 'schedules', :action => 'get\_group\_users') |
|  |  | render(:partial => 'common/select\_users', :layout => false, :locals => {:target\_attr => :id, :submit\_url => submit\_url}) |
| Expand Down  Expand Up | | @@ -708,9 +709,10 @@ def get\_group\_equipment |
|  |  | @group\_id = nil |
|  |  | if !params[:thetisBoxSelKeeper].nil? |
|  |  | @group\_id = params[:thetisBoxSelKeeper].split(':').last |
|  |  | elsif !params[:group\_id].nil? and !params[:group\_id].empty? |
|  |  | elsif !params[:group\_id].blank? |
|  |  | @group\_id = params[:group\_id] |
|  |  | end |
|  |  | SqlHelper.validate\_token([@group\_id]) |
|  |  |  |
|  |  | submit\_url = url\_for(:controller => 'schedules', :action => 'get\_group\_equipment') |
|  |  | render(:partial => 'common/select\_equipment', :layout => false, :locals => {:target\_attr => :id, :submit\_url => submit\_url}) |
| Expand Down | |  |

5 changes: 3 additions & 2 deletions

5
[app/controllers/send\_mails\_controller.rb](#diff-d24df03257ed8e00cf433b280701477e1a4f6bfdb2fba5f858ff9b029bab18f4 "app/controllers/send_mails_controller.rb")

Show comments

[View file](/sysphonic/thetis/blob/4ca3f5f486759660b87d7c146f1fdc11264f56eb/app/controllers/send_mails_controller.rb)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -363,9 +363,10 @@ def get\_group\_users |
|  |  | @group\_id = nil |
|  |  | if !params[:thetisBoxSelKeeper].nil? |
|  |  | @group\_id = params[:thetisBoxSelKeeper].split(':').last |
|  |  | elsif !params[:group\_id].nil? and !params[:group\_id].empty? |
|  |  | elsif !params[:group\_id].blank? |
|  |  | @group\_id = params[:group\_id] |
|  |  | end |
|  |  | SqlHelper.validate\_token([@group\_id]) |
|  |  |  |
|  |  | submit\_url = url\_for(:controller => 'send\_mails', :action => 'get\_group\_users') |
|  |  | render(:partial => 'common/select\_users', :layout => false, :locals => {:target\_attr => :email, :submit\_url => submit\_url}) |
| Expand All | | @@ -378,7 +379,7 @@ def get\_group\_users |
|  |  | # |
|  |  | def check\_owner |
|  |  |  |
|  |  | return if params[:id].nil? or params[:id].empty? or @login\_user.nil? |
|  |  | return if params[:id].blank? or @login\_user.nil? |
|  |  |  |
|  |  | email = Email.find(params[:id]) |
|  |  |  |
| Expand Down | |  |

2 changes: 2 additions & 0 deletions

2
[app/controllers/timecards\_controller.rb](#diff-ee6ecda8e8334ea089dad6882a065bae75594ef945a19f5c5083ae4eba46e890 "app/controllers/timecards_controller.rb")

Show comments

[View file](/sysphonic/thetis/blob/4ca3f5f486759660b87d7c146f1fdc11264f56eb/app/controllers/timecards_controller.rb)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -427,6 +427,8 @@ def users |
|  |  | elsif !params[:group\_id].blank? |
|  |  | @group\_id = params[:group\_id] |
|  |  | end |
|  |  | SqlHelper.validate\_token([@group\_id]) |
|  |  |  |
|  |  | unless @group\_id.nil? |
|  |  | if @group\_id == '0' |
|  |  | con << "((groups like '%|0|%') or (groups is null))" |
| Expand Down | |  |

4 changes: 4 additions & 0 deletions

4
[app/controllers/users\_controller.rb](#diff-cfdccd0a9d5df5a43aaad2a35d36ebbe187c52ad5fdc9846fa189d04537adb6e "app/controllers/users_controller.rb")

Show comments

[View file](/sysphonic/thetis/blob/4ca3f5f486759660b87d7c146f1fdc11264f56eb/app/controllers/users_controller.rb)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -162,6 +162,7 @@ def list |
|  |  | elsif !params[:group\_id].blank? |
|  |  | @group\_id = params[:group\_id] |
|  |  | end |
|  |  | SqlHelper.validate\_token([@group\_id]) |
|  |  |  |
|  |  | # Copy to FEATURE\_PAGING\_IN\_TREE >>> |
|  |  | con = ['User.id > 0'] |
| Expand Down  Expand Up | | @@ -269,6 +270,7 @@ def select\_official\_titles |
|  |  | unless params[:thetisBoxSelKeeper].nil? |
|  |  | @group\_id = params[:thetisBoxSelKeeper].split(':').last |
|  |  | end |
|  |  | SqlHelper.validate\_token([@group\_id]) |
|  |  |  |
|  |  | if @group\_id.nil? |
|  |  | @official\_titles = OfficialTitle.get\_for('0', false, true) |
| Expand Down  Expand Up | | @@ -351,6 +353,8 @@ def notify |
|  |  | def update\_auth |
|  |  | Log.add\_info(request, params.inspect) |
|  |  |  |
|  |  | return unless request.post? |
|  |  |  |
|  |  | auth = nil |
|  |  |  |
|  |  | if params[:check\_auth\_all] == '1' |
| Expand Down | |  |

2 changes: 2 additions & 0 deletions

2
[app/controllers/zeptair\_dist\_controller.rb](#diff-7bf65e5acd501eee126fb910a13ad9a316fdf793d9b5e430e7c13220c99c7dcd "app/controllers/zeptair_dist_controller.rb")

Show comments

[View file](/sysphonic/thetis/blob/4ca3f5f486759660b87d7c146f1fdc11264f56eb/app/controllers/zeptair_dist_controller.rb)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -48,6 +48,8 @@ def users |
|  |  | elsif !params[:group\_id].blank? |
|  |  | @group\_id = params[:group\_id] |
|  |  | end |
|  |  | SqlHelper.validate\_token([@group\_id]) |
|  |  |  |
|  |  | unless @group\_id.nil? |
|  |  | con << SqlHelper.get\_sql\_like([:groups], "|#{@group\_id}|") |
|  |  | end |
| Expand Down | |  |

4 changes: 2 additions & 2 deletions

4
[app/helpers/sql\_helper.rb](#diff-bacba4ae3b300c54897224b84231621c8922484b2f40ebd3720d0bebc8c76b44 "app/helpers/sql_helper.rb")

Show comments

[View file](/sysphonic/thetis/blob/4ca3f5f486759660b87d7c146f1fdc11264f56eb/app/helpers/sql_helper.rb)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -25,8 +25,8 @@ module SqlHelper |
|  |  | # |
|  |  | def self.validate\_token(tokens, extra\_chars=nil) |
|  |  |  |
|  |  | extra\_chars ||= [] |
|  |  | regexp = Regexp.new("^\s\*[a-zA-Z0-9\_.#{extra\_chars.join()}]+\s\*$") |
|  |  | extra\_chars = Regexp.escape((extra\_chars || []).join()) |
|  |  | regexp = Regexp.new("^[ ]\*[a-zA-Z0-9\_.#{extra\_chars}]+[ ]\*$") |
|  |  |  |
|  |  | [tokens].flatten.each do |token| |
|  |  | next if token.blank? |
| Expand Down | |  |

21 changes: 9 additions & 12 deletions

21
[db/migrate/20110524100000\_changes\_for\_ver110.rb](#diff-db896e4b8784d657a89772c84161cb7424caa2226479e10b93f71bb94fdeeea0 "db/migrate/20110524100000_changes_for_ver110.rb")

Show comments

[View file](/sysphonic/thetis/blob/4ca3f5f486759660b87d7c146f1fdc11264f56eb/db/migrate/20110524100000_changes_for_ver110.rb)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -15,19 +15,16 @@ def self.up |
|  |  | t.timestamps |
|  |  | end |
|  |  |  |
|  |  | teams = Team.all |
|  |  | unless teams.nil? |
|  |  | teams.each do |team| |
|  |  | begin |
|  |  | item = Item.find(team.item\_id) |
|  |  | rescue |
|  |  | end |
|  |  | next if item.nil? |
|  |  |  |
|  |  | attrs = ActionController::Parameters.new({created\_at: item.created\_at, updated\_at: item.updated\_at}) |
|  |  | attrs.permit! |
|  |  | team.update\_attributes(attrs) |
|  |  | Team.find\_each do |team| |
|  |  | begin |
|  |  | item = Item.find(team.item\_id) |
|  |  | rescue |
|  |  | end |
|  |  | next if item.nil? |
|  |  |  |
|  |  | attrs = ActionController::Parameters.new({created\_at: item.created\_at, updated\_at: item.updated\_at}) |
|  |  | attrs.permit! |
|  |  | team.update\_attributes(attrs) |
|  |  | end |
|  |  | end |
|  |  |  |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `4ca3f5f`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fsysphonic%2Fthetis%2Fcommit%2F4ca3f5f486759660b87d7c146f1fdc11264f56eb) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from sysphonic.com_fa1854e0_20250125_223339.html ===




=== Content from github.com_9e9cabad_20250125_223343.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fsysphonic%2Fthetis%2Fcommit%2F1b8234706e1294f41df42f3d1ccb71b983ffbe23)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fsysphonic%2Fthetis%2Fcommit%2F1b8234706e1294f41df42f3d1ccb71b983ffbe23)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=sysphonic%2Fthetis)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[sysphonic](/sysphonic)
/
**[thetis](/sysphonic/thetis)**
Public

* [Notifications](/login?return_to=%2Fsysphonic%2Fthetis) You must be signed in to change notification settings
* [Fork
  6](/login?return_to=%2Fsysphonic%2Fthetis)
* [Star
   6](/login?return_to=%2Fsysphonic%2Fthetis)

* [Code](/sysphonic/thetis)
* [Issues
  2](/sysphonic/thetis/issues)
* [Pull requests
  8](/sysphonic/thetis/pulls)
* [Actions](/sysphonic/thetis/actions)
* [Projects
  0](/sysphonic/thetis/projects)
* [Wiki](/sysphonic/thetis/wiki)
* [Security](/sysphonic/thetis/security)
* [Insights](/sysphonic/thetis/pulse)

Additional navigation options

* [Code](/sysphonic/thetis)
* [Issues](/sysphonic/thetis/issues)
* [Pull requests](/sysphonic/thetis/pulls)
* [Actions](/sysphonic/thetis/actions)
* [Projects](/sysphonic/thetis/projects)
* [Wiki](/sysphonic/thetis/wiki)
* [Security](/sysphonic/thetis/security)
* [Insights](/sysphonic/thetis/pulse)

## Commit

[Permalink](/sysphonic/thetis/commit/1b8234706e1294f41df42f3d1ccb71b983ffbe23)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Reinforcement of security.

[Browse files](/sysphonic/thetis/tree/1b8234706e1294f41df42f3d1ccb71b983ffbe23)
Browse the repository at this point in the history

```
Signed-off-by: MORITA Shintaro <shin@sysphonic.com>
```

* Loading branch information

MORITA Shintaro
committed
Jul 12, 2015

1 parent
[842e44f](/sysphonic/thetis/commit/842e44f0c2bd7d680430bb89a3bb78fd744961f9)

commit 1b82347

 Show file tree

 Hide file tree

Showing
**33 changed files**
with
**138 additions**
and
**90 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* app

  + controllers

    - app/controllers/items\_controller.rb
      [items\_controller.rb](#diff-22da4de4953a8a5748f5a8f4425eb896283d008abd9525a4a33c9fd76f35f40b)
    - app/controllers/locations\_controller.rb
      [locations\_controller.rb](#diff-bee6109a705a78cdfa12162d723fe642c7b7c8e53045513503b6d8e574e41b15)
    - app/controllers/templates\_controller.rb
      [templates\_controller.rb](#diff-346a292d21f0857f4a100d577ce6c1137817211b4417544188e77e9c1f3f74c2)
    - app/controllers/zeptair\_post\_controller.rb
      [zeptair\_post\_controller.rb](#diff-a24700646fbebdf06a9a1473860a8c891ebe05253bc48a37dfd227d352b1b7ac)
  + helpers

    - app/helpers/items\_helper.rb
      [items\_helper.rb](#diff-4a666a9fb1a565fb66af0eecdeed4d7f0d45ca7fa3cb40464a1231e94f8827e9)
    - app/helpers/sql\_helper.rb
      [sql\_helper.rb](#diff-bacba4ae3b300c54897224b84231621c8922484b2f40ebd3720d0bebc8c76b44)
    - app/helpers/templates\_helper.rb
      [templates\_helper.rb](#diff-765d935fafc92e287c8fabf20bff914b68487718c37e3f815da666ca6c512bd1)
    - app/helpers/tree\_element.rb
      [tree\_element.rb](#diff-1414c2a4d0b553d48513eb21a08a61cf34c94d9c7d0c88a6ffb32a350d6e4148)
    - app/helpers/zeptair\_dist\_helper.rb
      [zeptair\_dist\_helper.rb](#diff-2a132ccab064908d719e37c1755829b5353ae3e5b95cc63c9630047d3694ca39)
  + models

    - app/models/email.rb
      [email.rb](#diff-02c13e71f0c5f29a8e43dde10a166be8cd5f1999707ae26ef1aef690610e06ec)
    - app/models/folder.rb
      [folder.rb](#diff-71f7d2ee88389d841ac6ac058dde5a4af5e5d1dcfe065f2ecb850919e6ed8fd7)
    - app/models/group.rb
      [group.rb](#diff-d60319197e54a8992a066d6243587f4434506f5b924282954fa5f5a8f4ee05e2)
    - app/models/location.rb
      [location.rb](#diff-83acc4923e9ebe15ae1c7ed932799fabc336c772c0e9233e1537a435da8cb1dc)
    - app/models/mail\_account.rb
      [mail\_account.rb](#diff-bd9cd06c7bf1b1b5f5aa2a92f65d56470e4a9de033c6bdd963ee854191fc2300)
    - app/models/mail\_filter.rb
      [mail\_filter.rb](#diff-70db971974c19b3d3745bc206c6a78806e3d622564c827ef20610d80c89eec80)
    - app/models/mail\_folder.rb
      [mail\_folder.rb](#diff-02ef7454621c4738b4dc4b9c3c68f7d28dc67c3ee218fe617b8852298c7ff589)
    - app/models/office\_map.rb
      [office\_map.rb](#diff-bef639ec9ff282660c0118f5382274c6aa34a57e0bd7189a087309b9f1b16a84)
    - app/models/official\_title.rb
      [official\_title.rb](#diff-674410dfc2770288af00e476011583b6b2c0b414d67428cc2c908ce400aab557)
    - app/models/paid\_holiday.rb
      [paid\_holiday.rb](#diff-792ac3f00e707c9621dbefd30e3fc730277a2175e9d16c88e3ca1185a1a9d1b8)
    - app/models/research.rb
      [research.rb](#diff-da0bd78e51ac9e3b0c4d77a642e421bcc0068c0e1535795c992a5ecc89f8e544)
    - app/models/setting.rb
      [setting.rb](#diff-f1d12f9023a819c8e3bbeb276c8de59f412ed96db88a29f473d3cd06aa262f65)
    - app/models/team.rb
      [team.rb](#diff-36f3ec6fb3b342e6b4f2b49aa02469e569f5f25e26e8060523505838b82f7961)
    - app/models/timecard.rb
      [timecard.rb](#diff-285673c52d48be4745f42287eb26f39fea22054eb7856d093b9697e98e6001a7)
    - app/models/toy.rb
      [toy.rb](#diff-b3840a893d5a14a12ce542409d57159dcda7be8293e163870aee90dafeac226f)
    - app/models/user.rb
      [user.rb](#diff-9802ca3c9c4cf89904fd44bc114e35ebdf2c5dd3d5b645491e2b253e1afef29b)
  + views

    - folders

      * app/views/folders/show\_tree.html.erb
        [show\_tree.html.erb](#diff-b875dbd47b7c0dff5498cf22b10e11cc00b85dcb8129f118f2cde6ce7688251a)
    - frames

      * app/views/frames/\_footer.html.erb
        [\_footer.html.erb](#diff-7303b78f1d139fa77f823fd0814e39150bb377bc2441d2bac983f51a5430b0aa)
    - groups

      * app/views/groups/show\_tree.html.erb
        [show\_tree.html.erb](#diff-588adcb852f987394d68369514ec0392875ae394c75d290ac0fc3b5ec8ccb5a8)
    - mail\_filters

      * app/views/mail\_filters/list.html.erb
        [list.html.erb](#diff-99fb150589e60c30d46780d972702bfa63920544e9c1f52d8dacbb39702892b0)
    - mail\_folders

      * app/views/mail\_folders/show\_tree.html.erb
        [show\_tree.html.erb](#diff-c1886e7f5c979db74f56661d0ef8c56b8db754069c7ecc4d85e6f0d35ba7ba70)
* config/locales

  + config/locales/de.yml
    [de.yml](#diff-df718bd2d68738b2415f38df20a65377260003be1edb281d1f47a23896198969)
  + config/locales/en.yml
    [en.yml](#diff-44438ce218f5287c58d0017f965d888715635d94280669896f75841fbd7b4cd7)
  + config/locales/ja.yml
    [ja.yml](#diff-b85e8d609d1ca8ea9aef96cf26c7011d39b5dd2e7de34dd4c52d931979917508)

## There are no files selected for viewing

6 changes: 1 addition & 5 deletions

6
[app/controllers/items\_controller.rb](#diff-22da4de4953a8a5748f5a8f4425eb896283d008abd9525a4a33c9fd76f35f40b "app/controllers/items_controller.rb")

Show comments

[View file](/sysphonic/thetis/blob/1b8234706e1294f41df42f3d1ccb71b983ffbe23/app/controllers/items_controller.rb)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -354,12 +354,8 @@ def destroy |
|  |  | if params[:from\_action].nil? |
|  |  | render(:text => params[:id]) |
|  |  | else |
|  |  | params.delete(:controller) |
|  |  | params.delete(:action) |
|  |  | params.delete(:id) |
|  |  | flash[:notice] = t('msg.delete\_success') |
|  |  | params[:action] = params[:from\_action] |
|  |  | redirect\_to(params) |
|  |  | self.send(params[:from\_action]) |
|  |  | end |
|  |  | end |
|  |  |  |
| Expand Down | |  |

2 changes: 1 addition & 1 deletion

2
[app/controllers/locations\_controller.rb](#diff-bee6109a705a78cdfa12162d723fe642c7b7c8e53045513503b6d8e574e41b15 "app/controllers/locations_controller.rb")

Show comments

[View file](/sysphonic/thetis/blob/1b8234706e1294f41df42f3d1ccb71b983ffbe23/app/controllers/locations_controller.rb)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -45,7 +45,7 @@ def open\_map |
|  |  | con\_second = [] |
|  |  | key\_array = params[:keyword].split(nil) |
|  |  | key\_array.each do |key| |
|  |  | key\_quot = ActiveRecord::Base.connection.quote(key) |
|  |  | key\_quot = SqlHelper.quote(key) |
|  |  | con\_prim << "(name=#{key\_quot} or fullname=#{key\_quot} or email=#{key\_quot})" |
|  |  | con\_second << SqlHelper.get\_sql\_like([:name, :fullname, :email], key) |
|  |  | end |
| Expand Down | |  |

2 changes: 0 additions & 2 deletions

2
[app/controllers/templates\_controller.rb](#diff-346a292d21f0857f4a100d577ce6c1137817211b4417544188e77e9c1f3f74c2 "app/controllers/templates_controller.rb")

Show comments

[View file](/sysphonic/thetis/blob/1b8234706e1294f41df42f3d1ccb71b983ffbe23/app/controllers/templates_controller.rb)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -170,8 +170,6 @@ def destroy\_local |
|  |  | def copy |
|  |  | Log.add\_info(request, params.inspect) |
|  |  |  |
|  |  | return unless request.post? |
|  |  |  |
|  |  | tmpl\_id = params[:thetisBoxSelKeeper].split(':').last |
|  |  | tmpl\_item = Item.find(tmpl\_id) |
|  |  |  |
| Expand Down | |  |

4 changes: 2 additions & 2 deletions

4
[app/controllers/zeptair\_post\_controller.rb](#diff-a24700646fbebdf06a9a1473860a8c891ebe05253bc48a37dfd227d352b1b7ac "app/controllers/zeptair_post_controller.rb")

Show comments

[View file](/sysphonic/thetis/blob/1b8234706e1294f41df42f3d1ccb71b983ffbe23/app/controllers/zeptair_post_controller.rb)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -93,7 +93,7 @@ def query |
|  |  | end |
|  |  |  |
|  |  | unless zeptair\_id.blank? |
|  |  | target\_user = User.where("zeptair\_id=#{zeptair\_id}").first |
|  |  | target\_user = User.where("zeptair\_id=#{zeptair\_id.to\_i}").first |
|  |  | end |
|  |  |  |
|  |  | if target\_user.nil? |
| Expand Down  Expand Up | | @@ -153,7 +153,7 @@ def delete\_attachment |
|  |  |  |
|  |  | unless zeptair\_id.blank? |
|  |  |  |
|  |  | target\_user = User.where("zeptair\_id=#{zeptair\_id}").first |
|  |  | target\_user = User.where("zeptair\_id=#{zeptair\_id.to\_i}").first |
|  |  |  |
|  |  | unless @login\_user.admin?(User::AUTH\_ZEPTAIR) or @login\_user.id == target\_user.id |
|  |  | target\_user = nil |
| Expand Down | |  |

8 changes: 5 additions & 3 deletions

8
[app/helpers/items\_helper.rb](#diff-4a666a9fb1a565fb66af0eecdeed4d7f0d45ca7fa3cb40464a1231e94f8827e9 "app/helpers/items_helper.rb")

Show comments

[View file](/sysphonic/thetis/blob/1b8234706e1294f41df42f3d1ccb71b983ffbe23/app/helpers/items_helper.rb)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -27,7 +27,7 @@ def self.get\_next\_revision(user\_id, source\_id) |
|  |  |  |
|  |  | SqlHelper.validate\_token([user\_id, source\_id]) |
|  |  |  |
|  |  | copied\_items = Item.where("user\_id=#{user\_id} and source\_id=#{source\_id}").order('created\_at DESC').to\_a |
|  |  | copied\_items = Item.where("user\_id=#{user\_id.to\_i} and source\_id=#{source\_id.to\_i}").order('created\_at DESC').to\_a |
|  |  |  |
|  |  | rev = 0 |
|  |  | copied\_items.each do |item| |
| Expand All | | @@ -54,7 +54,8 @@ def self.get\_copies\_folder(user\_id) |
|  |  | my\_folder = User.get\_my\_folder(user\_id) |
|  |  |  |
|  |  | unless my\_folder.nil? |
|  |  | con = "(parent\_id=#{my\_folder.id}) and (name='#{Item.copies\_folder}')" |
|  |  | folder\_name\_quot = SqlHelper.quote(Item.copies\_folder) |
|  |  | con = "(parent\_id=#{my\_folder.id}) and (name=#{folder\_name\_quot})" |
|  |  |  |
|  |  | begin |
|  |  | copies\_folder = Folder.where(con).first |
| Expand Down  Expand Up | | @@ -89,7 +90,8 @@ def self.exists\_copies\_folder?(user\_id) |
|  |  | my\_folder = User.get\_my\_folder(user\_id) |
|  |  |  |
|  |  | unless my\_folder.nil? |
|  |  | con = "(parent\_id=#{my\_folder.id}) and (name='#{Item.copies\_folder}')" |
|  |  | folder\_name\_quot = SqlHelper.quote(Item.copies\_folder) |
|  |  | con = "(parent\_id=#{my\_folder.id}) and (name=#{folder\_name\_quot})" |
|  |  |  |
|  |  | begin |
|  |  | copies\_folder = Folder.where(con).first |
| Expand Down | |  |

14 changes: 13 additions & 1 deletion

14
[app/helpers/sql\_helper.rb](#diff-bacba4ae3b300c54897224b84231621c8922484b2f40ebd3720d0bebc8c76b44 "app/helpers/sql_helper.rb")

Show comments

[View file](/sysphonic/thetis/blob/1b8234706e1294f41df42f3d1ccb71b983ffbe23/app/helpers/sql_helper.rb)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -51,7 +51,7 @@ def self.validate\_token(tokens, extra\_chars=nil) |
|  |  | # |
|  |  | def self.get\_sql\_like(attr\_names, keyword) |
|  |  |  |
|  |  | key = ActiveRecord::Base.connection.quote("%#{SqlHelper.escape\_for\_like(keyword)}%") |
|  |  | key = SqlHelper.quote("%#{SqlHelper.escape\_for\_like(keyword)}%") |
|  |  |  |
|  |  | con = [] |
|  |  | attr\_names.each do |attr\_name| |
| Expand All | | @@ -74,4 +74,16 @@ def self.escape\_for\_like(str) |
|  |  | return nil if str.nil? |
|  |  | return str.to\_s.gsub(/([%\_])/){"\\" + $1} |
|  |  | end |
|  |  |  |
|  |  | #=== self.quote |
|  |  | # |
|  |  | #Quotes string. |
|  |  | # |
|  |  | #\_str\_:: Target string. |
|  |  | #return:: Quoted string. |
|  |  | # |
|  |  | def self.quote(str) |
|  |  |  |
|  |  | return ActiveRecord::Base.connection.quote(str) |
|  |  | end |
|  |  | end |

9 changes: 5 additions & 4 deletions

9
[app/helpers/templates\_helper.rb](#diff-765d935fafc92e287c8fabf20bff914b68487718c37e3f815da666ca6c512bd1 "app/helpers/templates_helper.rb")

Show comments

[View file](/sysphonic/thetis/blob/1b8234706e1294f41df42f3d1ccb71b983ffbe23/app/helpers/templates_helper.rb)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -31,7 +31,7 @@ module TemplatesHelper |
|  |  | def self.setup\_tmpl\_folder |
|  |  |  |
|  |  | begin |
|  |  | tmpl\_folder = Folder.where("folders.name='#{TMPL\_ROOT}'").first |
|  |  | tmpl\_folder = Folder.where(name: TMPL\_ROOT).first |
|  |  | rescue |
|  |  | end |
|  |  | if tmpl\_folder.nil? |
| Expand Down  Expand Up | | @@ -117,7 +117,7 @@ def self.setup\_tmpl\_folder |
|  |  | # |
|  |  | def self.get\_tmpl\_folder |
|  |  |  |
|  |  | tmpl\_folder = Folder.where("folders.name='#{TMPL\_ROOT}'").first |
|  |  | tmpl\_folder = Folder.where(name: TMPL\_ROOT).first |
|  |  |  |
|  |  | if tmpl\_folder.nil? |
|  |  |  |
| Expand Down  Expand Up | | @@ -168,10 +168,11 @@ def self.get\_tmpl\_subfolder(name) |
|  |  |  |
|  |  | SqlHelper.validate\_token([name]) |
|  |  |  |
|  |  | tmpl\_folder = Folder.where("folders.name='#{TMPL\_ROOT}'").first |
|  |  | tmpl\_folder = Folder.where(name: TMPL\_ROOT).first |
|  |  |  |
|  |  | unless tmpl\_folder.nil? |
|  |  | con = "(parent\_id=#{tmpl\_folder.id}) and (name='#{name}')" |
|  |  | name\_quot = SqlHelper.quote(name) |
|  |  | con = "(parent\_id=#{tmpl\_folder.id}) and (name=#{name\_quot})" |
|  |  | begin |
|  |  | child = Folder.where(con).first |
|  |  | rescue => evar |
| Expand Down | |  |

4 changes: 2 additions & 2 deletions

4
[app/helpers/tree\_element.rb](#diff-1414c2a4d0b553d48513eb21a08a61cf34c94d9c7d0c88a6ffb32a350d6e4148 "app/helpers/tree_element.rb")

Show comments

[View file](/sysphonic/thetis/blob/1b8234706e1294f41df42f3d1ccb71b983ffbe23/app/helpers/tree_element.rb)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -100,7 +100,7 @@ def self.get\_childs(klass, node\_id, recursive, ret\_obj) |
|  |  |  |
|  |  | else |
|  |  |  |
|  |  | nodes = klass.where("parent\_id=#{node\_id}").order('xorder ASC, id ASC').to\_a |
|  |  | nodes = klass.where("parent\_id=#{node\_id.to\_i}").order('xorder ASC, id ASC').to\_a |
|  |  | if ret\_obj |
|  |  | array = nodes |
|  |  | else |
| Expand Down  Expand Up | | @@ -139,7 +139,7 @@ def self.get\_tree(klass, tree, conditions, node\_id, order\_by) |
|  |  | else |
|  |  | con = Marshal.load(Marshal.dump(conditions)) + ' and ' |
|  |  | end |
|  |  | con << "(parent\_id=#{node\_id})" |
|  |  | con << "(parent\_id=#{node\_id.to\_i})" |
|  |  |  |
|  |  | tree[node\_id] = klass.where(con).order(order\_by).to\_a |
|  |  |  |
| Expand Down | |  |

6 changes: 3 additions & 3 deletions

6
[app/helpers/zeptair\_dist\_helper.rb](#diff-2a132ccab064908d719e37c1755829b5353ae3e5b95cc63c9630047d3694ca39 "app/helpers/zeptair_dist_helper.rb")

Show comments

[View file](/sysphonic/thetis/blob/1b8234706e1294f41df42f3d1ccb71b983ffbe23/app/helpers/zeptair_dist_helper.rb)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -63,7 +63,7 @@ def self.get\_comment\_of(item\_id, user\_id) |
|  |  |  |
|  |  | SqlHelper.validate\_token([item\_id, user\_id]) |
|  |  | begin |
|  |  | comment = Comment.where("(user\_id=#{user\_id}) and (item\_id=#{item\_id}) and (xtype='#{Comment::XTYPE\_DIST\_ACK}')").first |
|  |  | comment = Comment.where("(user\_id=#{user\_id.to\_i}) and (item\_id=#{item\_id.to\_i}) and (xtype='#{Comment::XTYPE\_DIST\_ACK}')").first |
|  |  | rescue => evar |
|  |  | Log.add\_error(nil, evar) |
|  |  | end |
| Expand Down  Expand Up | | @@ -145,7 +145,7 @@ def self.completed\_ack\_message(item\_id) |
|  |  | # |
|  |  | def self.count\_ack\_users(item\_id) |
|  |  | SqlHelper.validate\_token([item\_id]) |
|  |  | return Comment.where("(item\_id=#{item\_id}) and (xtype='#{Comment::XTYPE\_DIST\_ACK}')").count |
|  |  | return Comment.where("(item\_id=#{item\_id.to\_i}) and (xtype='#{Comment::XTYPE\_DIST\_ACK}')").count |
|  |  | end |
|  |  |  |
|  |  | #=== self.count\_completed\_users |
| Expand All | | @@ -158,7 +158,7 @@ def self.count\_ack\_users(item\_id) |
|  |  | def self.count\_completed\_users(item\_id) |
|  |  | SqlHelper.validate\_token([item\_id]) |
|  |  | ack\_msg = ZeptairDistHelper.completed\_ack\_message(item\_id) |
|  |  | return Comment.where("(item\_id=#{item\_id}) and (xtype='#{Comment::XTYPE\_DIST\_ACK}') and (message='#{ack\_msg}')").count |
|  |  | return Comment.where("(item\_id=#{item\_id.to\_i}) and (xtype='#{Comment::XTYPE\_DIST\_ACK}') and (message='#{ack\_msg}')").count |
|  |  | end |
|  |  |  |
|  |  | #=== self.get\_feeds |
| Expand Down | |  |

8 changes: 4 additions & 4 deletions

8
[app/models/email.rb](#diff-02c13e71f0c5f29a8e43dde10a166be8cd5f1999707ae26ef1aef690610e06ec "app/models/email.rb")

Show comments

[View file](/sysphonic/thetis/blob/1b8234706e1294f41df42f3d1ccb71b983ffbe23/app/models/email.rb)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -622,7 +622,7 @@ def self.trim(user\_id, mail\_account\_id, max) |
|  |  | SqlHelper.validate\_token([user\_id, mail\_account\_id]) |
|  |  |  |
|  |  | begin |
|  |  | count = Email.where("mail\_account\_id=#{mail\_account\_id}").count |
|  |  | count = Email.where("mail\_account\_id=#{mail\_account\_id.to\_i}").count |
|  |  | if count > max |
|  |  | #logger.fatal("[INFO] Email.trim(user\_id:#{user\_id}, mail\_account\_id:#{mail\_account\_id}, max:#{max})") |
|  |  | over\_num = count - max |
| Expand All | | @@ -639,7 +639,7 @@ def self.trim(user\_id, mail\_account\_id, max) |
|  |  | # Now, remove others |
|  |  | if emails.length < over\_num |
|  |  | over\_num -= emails.length |
|  |  | emails += Email.where("mail\_account\_id=#{mail\_account\_id}").order('updated\_at ASC').limit(over\_num).to\_a |
|  |  | emails += Email.where("mail\_account\_id=#{mail\_account\_id.to\_i}").order('updated\_at ASC').limit(over\_num).to\_a |
|  |  | end |
|  |  |  |
|  |  | emails.each do |email| |
| Expand Down  Expand Up | | @@ -686,7 +686,7 @@ def self.trim\_by\_capacity(user\_id, mail\_account\_id, capacity\_mb) |
|  |  | # |
|  |  | # # Now, remove others |
|  |  | # if over\_size > 0 |
|  |  | # emails = Email.where("mail\_account\_id=#{mail\_account\_id}").order('updated\_at ASC').to\_a |
|  |  | # emails = Email.where("mail\_account\_id=#{mail\_account\_id.to\_i}").order('updated\_at ASC').to\_a |
|  |  | # emails.each do |email| |
|  |  | # next if email.size.nil? |
|  |  | # |
| Expand Down  Expand Up | | @@ -762,7 +762,7 @@ def self.destroy\_by\_user(user\_id, add\_con=nil) |
|  |  |  |
|  |  | SqlHelper.validate\_token([user\_id]) |
|  |  |  |
|  |  | con = "user\_id=#{user\_id}" |
|  |  | con = "(user\_id=#{user\_id.to\_i})" |
|  |  | con << " and (#{add\_con})" unless add\_con.nil? or add\_con.empty? |
|  |  | emails = Email.where(con).to\_a |
|  |  |  |
| Expand Down | |  |

14 changes: 7 additions & 7 deletions

14
[app/models/folder.rb](#diff-71f7d2ee88389d841ac6ac058dde5a4af5e5d1dcfe065f2ecb850919e6ed8fd7 "app/models/folder.rb")

Show comments

[View file](/sysphonic/thetis/blob/1b8234706e1294f41df42f3d1ccb71b983ffbe23/app/models/folder.rb)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -240,18 +240,18 @@ def self.get\_tree\_by\_group\_for\_admin(group\_id) |
|  |  | if group\_id.to\_s == '0' |
|  |  | sql = 'select distinct \* from folders' |
|  |  |  |
|  |  | where = " where (parent\_id = #{tree\_id})" |
|  |  | where << " and ((xtype is null) or not(xtype = '#{XTYPE\_GROUP}' or xtype = '#{XTYPE\_USER}'))" |
|  |  | where = " where (parent\_id=#{tree\_id.to\_i})" |
|  |  | where << " and ((xtype is null) or not((xtype='#{XTYPE\_GROUP}') or (xtype='#{XTYPE\_USER}')))" |
|  |  |  |
|  |  | order\_by = ' order by xorder ASC, id ASC' |
|  |  | else |
|  |  | sql = 'select distinct Folder.\* from folders Folder, users User' |
|  |  |  |
|  |  | where = " where (Folder.parent\_id = #{tree\_id})" |
|  |  | where = " where (Folder.parent\_id=#{tree\_id.to\_i})" |
|  |  | where << ' and (' |
|  |  | where << "(Folder.xtype = '#{XTYPE\_GROUP}' and Folder.owner\_id = #{group\_id})" |
|  |  | where << "((Folder.xtype='#{XTYPE\_GROUP}') and (Folder.owner\_id=#{group\_id.to\_i}))" |
|  |  | where << ' or ' |
|  |  | where << "(Folder.xtype = '#{XTYPE\_USER}' and  Folder.owner\_id = User.id and #{SqlHelper.get\_sql\_like(['User.groups'], "|#{group\_id}|")})" |
|  |  | where << "((Folder.xtype='#{XTYPE\_USER}') and (Folder.owner\_id=User.id) and #{SqlHelper.get\_sql\_like(['User.groups'], "|#{group\_id}|")})" |
|  |  | where << ' )' |
|  |  |  |
|  |  | order\_by = ' order by Folder.xorder ASC, Folder.id ASC' |
| Expand Down  Expand Up | | @@ -324,7 +324,7 @@ def self.get\_tree(folder\_tree, conditions, parent, admin) |
|  |  | else |
|  |  | con << ' and ' |
|  |  | end |
|  |  | con << "parent\_id=#{tree\_id}" |
|  |  | con << "parent\_id=#{tree\_id.to\_i}" |
|  |  | folder\_tree[tree\_id] += Folder.where(con).order('xorder ASC, id ASC').to\_a |
|  |  |  |
|  |  | delete\_ary = [] |
| Expand Down  Expand Up | | @@ -668,7 +668,7 @@ def self.get\_childs(folder\_id, conditions, recursive, admin, ret\_obj) |
|  |  | else |
|  |  | con << ' and ' |
|  |  | end |
|  |  | con << "parent\_id=#{folder\_id}" |
|  |  | con << "parent\_id=#{folder\_id.to\_i}" |
|  |  |  |
|  |  | unless admin |
|  |  | con << " and (xtype is null or not (xtype='#{Folder::XTYPE\_SYSTEM}'))" |
| Expand Down | |  |

2 changes: 1 addition & 1 deletion

2
[app/models/group.rb](#diff-d60319197e54a8992a066d6243587f4434506f5b924282954fa5f5a8f4ee05e2 "app/models/group.rb")

Show comments

[View file](/sysphonic/thetis/blob/1b8234706e1294f41df42f3d1ccb71b983ffbe23/app/models/group.rb)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -376,7 +376,7 @@ def self.get\_group\_folder(group\_id) |
|  |  |  |
|  |  | SqlHelper.validate\_token([group\_id]) |
|  |  | begin |
|  |  | return Folder.where("(owner\_id=#{group\_id}) and (xtype='#{Folder::XTYPE\_GROUP}')").first |
|  |  | return Folder.where("(owner\_id=#{group\_id.to\_i}) and (xtype='#{Folder::XTYPE\_GROUP}')").first |
|  |  | rescue => evar |
|  |  | Log.add\_error(nil, evar) |
|  |  | return nil |
| Expand Down | |  |

2 changes: 1 addition & 1 deletion

2
[app/models/location.rb](#diff-83acc4923e9ebe15ae1c7ed932799fabc336c772c0e9233e1537a435da8cb1dc "app/models/location.rb")

Show comments

[View file](/sysphonic/thetis/blob/1b8234706e1294f41df42f3d1ccb71b983ffbe23/app/models/location.rb)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -48,7 +48,7 @@ def self.get\_for\_group(group\_id) |
|  |  | if group\_id.nil? |
|  |  | con = 'group\_id is null' |
|  |  | else |
|  |  | con = "group\_id=#{group\_id}" |
|  |  | con = "group\_id=#{group\_id.to\_i}" |
|  |  | end |
|  |  |  |
|  |  | Location.do\_expire(con) |
| Expand Down | |  |

6 changes: 3 additions & 3 deletions

6
[app/models/mail\_account.rb](#diff-bd9cd06c7bf1b1b5f5aa2a92f65d56470e4a9de033c6bdd963ee854191fc2300 "app/models/mail_account.rb")

Show comments

[View file](/sysphonic/thetis/blob/1b8234706e1294f41df42f3d1ccb71b983ffbe23/app/models/mail_account.rb)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -72,7 +72,7 @@ def self.get\_using\_size(mail\_account\_id, add\_con=nil) |
|  |  | SqlHelper.validate\_token([mail\_account\_id]) |
|  |  |  |
|  |  | con = [] |
|  |  | con << "(mail\_account\_id=#{mail\_account\_id})" |
|  |  | con << "(mail\_account\_id=#{mail\_account\_id.to\_i})" |
|  |  | con << "(#{add\_con})" unless add\_con.nil? or add\_con.empty? |
|  |  |  |
|  |  | return (Email.count\_by\_sql("select SUM(size) from emails where #{con.join(' and ')}") || 0) |
| Expand Down  Expand Up | | @@ -156,7 +156,7 @@ def self.destroy\_by\_user(user\_id, add\_con=nil) |
|  |  |  |
|  |  | SqlHelper.validate\_token([user\_id]) |
|  |  |  |
|  |  | con = "user\_id=#{user\_id}" |
|  |  | con = "(user\_id=#{user\_id.to\_i})" |
|  |  | con << " and (#{add\_con})" unless add\_con.nil? or add\_con.empty? |
|  |  | mail\_accounts = MailAccount.where(con).to\_a |
|  |  |  |
| Expand Down  Expand Up | | @@ -258,7 +258,7 @@ def self.get\_default\_for(user\_id, xtype=nil) |
|  |  | SqlHelper.validate\_token([user\_id, xtype]) |
|  |  |  |
|  |  | con = [] |
|  |  | con << "(user\_id=#{user\_id})" |
|  |  | con << "(user\_id=#{user\_id.to\_i})" |
|  |  | con << '(is\_default=1)' |
|  |  | con << "(xtype='#{xtype}')" unless xtype.blank? |
|  |  |  |
| Expand Down | |  |

2 changes: 1 addition & 1 deletion

2
[app/models/mail\_filter.rb](#diff-70db971974c19b3d3745bc206c6a78806e3d622564c827ef20610d80c89eec80 "app/models/mail_filter.rb")

Show comments

[View file](/sysphonic/thetis/blob/1b8234706e1294f41df42f3d1ccb71b983ffbe23/app/models/mail_filter.rb)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -67,7 +67,7 @@ def self.get\_for(mail\_account\_id, enabled=nil, trigger=nil) |
|  |  | SqlHelper.validate\_token([mail\_account\_id, trigger]) |
|  |  |  |
|  |  | con = [] |
|  |  | con << "(mail\_account\_id=#{mail\_account\_id})" |
|  |  | con << "(mail\_account\_id=#{mail\_account\_id.to\_i})" |
|  |  | con << "(enabled=#{(enabled)?(1):(0)})" unless enabled.nil? |
|  |  | con << SqlHelper.get\_sql\_like([:triggers], "|#{trigger}|") unless trigger.nil? |
|  |  |  |
| Expand Down | |  |

8 changes: 5 additions & 3 deletions

8
[app/models/mail\_folder.rb](#diff-02ef7454621c4738b4dc4b9c3c68f7d28dc67c3ee218fe617b8852298c7ff589 "app/models/mail_folder.rb")

Show comments

[View file](/sysphonic/thetis/blob/1b8234706e1294f41df42f3d1ccb71b983ffbe23/app/models/mail_folder.rb)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -122,6 +122,8 @@ def self.sort\_tree(folder\_tree) |
|  |  | # |
|  |  | def self.get\_condtions\_for(user, mail\_account\_ids) |
|  |  |  |
|  |  | SqlHelper.validate\_token([mail\_account\_ids]) |
|  |  |  |
|  |  | if mail\_account\_ids.nil? or mail\_account\_ids.empty? |
|  |  | return "(user\_id=#{user.id} and (mail\_account\_id is null))" |
|  |  | else |
| Expand Down  Expand Up | | @@ -151,8 +153,8 @@ def self.get\_for(user, mail\_account\_id, xtype) |
|  |  | SqlHelper.validate\_token([user\_id, mail\_account\_id, xtype]) |
|  |  |  |
|  |  | con = [] |
|  |  | con << "(user\_id=#{user\_id})" |
|  |  | con << "(mail\_account\_id=#{mail\_account\_id})" |
|  |  | con << "(user\_id=#{user\_id.to\_i})" |
|  |  | con << "(mail\_account\_id=#{mail\_account\_id.to\_i})" |
|  |  | con << "(xtype='#{xtype}')" |
|  |  |  |
|  |  | return MailFolder.where(con.join(' and ')).first |
| Expand All | | @@ -178,7 +180,7 @@ def self.get\_account\_roots\_for(user) |
|  |  | SqlHelper.validate\_token([user\_id]) |
|  |  |  |
|  |  | con = [] |
|  |  | con << "(user\_id=#{user\_id})" |
|  |  | con << "(user\_id=#{user\_id.to\_i})" |
|  |  | con << "(xtype='#{MailFolder::XTYPE\_ACCOUNT\_ROOT}')" |
|  |  |  |
|  |  | order\_by = 'xorder ASC, id ASC' |
| Expand Down | |  |

4 changes: 2 additions & 2 deletions

4
[app/models/office\_map.rb](#diff-bef639ec9ff282660c0118f5382274c6aa34a57e0bd7189a087309b9f1b16a84 "app/models/office_map.rb")

Show comments

[View file](/sysphonic/thetis/blob/1b8234706e1294f41df42f3d1ccb71b983ffbe23/app/models/office_map.rb)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -37,10 +37,10 @@ def self.get\_for\_group(group\_id, incl\_img\_content=false) |
|  |  | office\_map = nil |
|  |  | else |
|  |  | if incl\_img\_content |
|  |  | office\_map = OfficeMap.where("group\_id=#{group\_id}").first |
|  |  | office\_map = OfficeMap.where("group\_id=#{group\_id.to\_i}").first |
|  |  | else |
|  |  | sql = 'select id, group\_id, img\_enabled, img\_name, img\_size, img\_content\_type, created\_at, updated\_at from office\_maps' |
|  |  | sql << " where group\_id=#{group\_id}" |
|  |  | sql << " where group\_id=#{group\_id.to\_i}" |
|  |  | begin |
|  |  | office\_map = OfficeMap.find\_by\_sql(sql).first |
|  |  | rescue |
| Expand Down | |  |

2 changes: 1 addition & 1 deletion

2
[app/models/official\_title.rb](#diff-674410dfc2770288af00e476011583b6b2c0b414d67428cc2c908ce400aab557 "app/models/official_title.rb")

Show comments

[View file](/sysphonic/thetis/blob/1b8234706e1294f41df42f3d1ccb71b983ffbe23/app/models/official_title.rb)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -70,7 +70,7 @@ def self.get\_for(group\_id, include\_parents=false, enabled=nil) |
|  |  |  |
|  |  | con << '(' + group\_con + ')' |
|  |  | else |
|  |  | con << "(group\_id=#{group\_id})" |
|  |  | con << "(group\_id=#{group\_id.to\_i})" |
|  |  | end |
|  |  |  |
|  |  | order\_by = 'order by xorder ASC, id ASC' |
| Expand Down | |  |

10 changes: 5 additions & 5 deletions

10
[app/models/paid\_holiday.rb](#diff-792ac3f00e707c9621dbefd30e3fc730277a2175e9d16c88e3ca1185a1a9d1b8 "app/models/paid_holiday.rb")

Show comments

[View file](/sysphonic/thetis/blob/1b8234706e1294f41df42f3d1ccb71b983ffbe23/app/models/paid_holiday.rb)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -34,11 +34,11 @@ def self.get\_for(user\_id, fiscal\_year=nil) |
|  |  |  |
|  |  | begin |
|  |  | con = [] |
|  |  | con << "(user\_id=#{user\_id})" |
|  |  | con << "(user\_id=#{user\_id.to\_i})" |
|  |  | if fiscal\_year.nil? |
|  |  | return PaidHoliday.where(con).order('year ASC').to\_a |
|  |  | else |
|  |  | con << "(year=#{fiscal\_year})" |
|  |  | con << "(year=#{fiscal\_year.to\_i})" |
|  |  | return PaidHoliday.where(con.join(' and ')).first |
|  |  | end |
|  |  | rescue |
| Expand All | | @@ -61,8 +61,8 @@ def self.update\_for(user\_id, fiscal\_year, num) |
|  |  |  |
|  |  | if num <= 0 |
|  |  | con = [] |
|  |  | con << "(user\_id=#{user\_id})" |
|  |  | con << "(year=#{fiscal\_year})" |
|  |  | con << "(user\_id=#{user\_id.to\_i})" |
|  |  | con << "(year=#{fiscal\_year.to\_i})" |
|  |  | PaidHoliday.destroy\_all(con.join(' and ')) |
|  |  | return |
|  |  | end |
| Expand Down  Expand Up | | @@ -100,7 +100,7 @@ def self.get\_carried\_over(user\_id, year) |
|  |  | return 0 if paidhld\_carry\_over.nil? or paidhld\_carry\_over.empty? or paidhld\_carry\_over == PaidHoliday::CARRY\_OVER\_NONE |
|  |  |  |
|  |  | begin |
|  |  | con = "(user\_id=#{user\_id}) and (year < #{year})" |
|  |  | con = "(user\_id=#{user\_id.to\_i}) and (year < #{year.to\_i})" |
|  |  | paidhlds = PaidHoliday.where(con).order('year ASC').to\_a |
|  |  | rescue |
|  |  | end |
| Expand Down | |  |

 Loading

Oops, something went wrong.
 Retry

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `1b82347`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fsysphonic%2Fthetis%2Fcommit%2F1b8234706e1294f41df42f3d1ccb71b983ffbe23) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_5d1806f6_20250125_223348.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fsysphonic%2Fthetis%2Fcommit%2F8004ee0c384daae0b28478ff8193d1990c397f57)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fsysphonic%2Fthetis%2Fcommit%2F8004ee0c384daae0b28478ff8193d1990c397f57)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=sysphonic%2Fthetis)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[sysphonic](/sysphonic)
/
**[thetis](/sysphonic/thetis)**
Public

* [Notifications](/login?return_to=%2Fsysphonic%2Fthetis) You must be signed in to change notification settings
* [Fork
  6](/login?return_to=%2Fsysphonic%2Fthetis)
* [Star
   6](/login?return_to=%2Fsysphonic%2Fthetis)

* [Code](/sysphonic/thetis)
* [Issues
  2](/sysphonic/thetis/issues)
* [Pull requests
  8](/sysphonic/thetis/pulls)
* [Actions](/sysphonic/thetis/actions)
* [Projects
  0](/sysphonic/thetis/projects)
* [Wiki](/sysphonic/thetis/wiki)
* [Security](/sysphonic/thetis/security)
* [Insights](/sysphonic/thetis/pulse)

Additional navigation options

* [Code](/sysphonic/thetis)
* [Issues](/sysphonic/thetis/issues)
* [Pull requests](/sysphonic/thetis/pulls)
* [Actions](/sysphonic/thetis/actions)
* [Projects](/sysphonic/thetis/projects)
* [Wiki](/sysphonic/thetis/wiki)
* [Security](/sysphonic/thetis/security)
* [Insights](/sysphonic/thetis/pulse)

## Commit

[Permalink](/sysphonic/thetis/commit/8004ee0c384daae0b28478ff8193d1990c397f57)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Reinforcement of security.

[Browse files](/sysphonic/thetis/tree/8004ee0c384daae0b28478ff8193d1990c397f57)
Browse the repository at this point in the history

```
Signed-off-by: MORITA Shintaro <shin@sysphonic.com>
```

* Loading branch information

MORITA Shintaro
committed
Jul 7, 2015

1 parent
[ce535a3](/sysphonic/thetis/commit/ce535a38ec92ff0f98af11ab41a425d1529a31ef)

commit 8004ee0

 Show file tree

 Hide file tree

Showing
**12 changed files**
with
**84 additions**
and
**49 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* app

  + controllers

    - app/controllers/application\_controller.rb
      [application\_controller.rb](#diff-766c34fd6533171eaf54300c153f89d6002c35c02cfc9c5b219251f85180ad07)
    - app/controllers/mail\_filters\_controller.rb
      [mail\_filters\_controller.rb](#diff-9bccb1a03eea4bd752e3961f79ca13080c391426447e161550cc9a3c131d13ea)
    - app/controllers/mail\_folders\_controller.rb
      [mail\_folders\_controller.rb](#diff-45bf8570f18660deedb22ec9b369d50559113eb1f0a21f0ac90f10885f48be06)
    - app/controllers/workflows\_controller.rb
      [workflows\_controller.rb](#diff-17fcd380774296ecbcfc6d7c9d8c5bc357302d1031f18d4c90f97d84aad6e497)
  + helpers

    - app/helpers/mail\_filters\_helper.rb
      [mail\_filters\_helper.rb](#diff-39cbf4b8758f5f49650b776d26fc0c8ef769bff690cdc94ee64c296feb473b7d)
  + models

    - app/models/address.rb
      [address.rb](#diff-4c2d4bccb73a3296911380789e5eb5e1bd37b277d07e743e6a6441879528cee6)
    - app/models/comment.rb
      [comment.rb](#diff-3baef9453c5d8b6c8962ce9ff9ec6b570b2e9cbad934e9f95b6d217ff1029b07)
    - app/models/email.rb
      [email.rb](#diff-02c13e71f0c5f29a8e43dde10a166be8cd5f1999707ae26ef1aef690610e06ec)
    - app/models/item.rb
      [item.rb](#diff-a3af7f7509f0f5653967f73c2e2d04a7ca1e21d8e92f051d0550d8879479aa96)
    - app/models/toy.rb
      [toy.rb](#diff-b3840a893d5a14a12ce542409d57159dcda7be8293e163870aee90dafeac226f)
    - app/models/user.rb
      [user.rb](#diff-9802ca3c9c4cf89904fd44bc114e35ebdf2c5dd3d5b645491e2b253e1afef29b)
  + views/mail\_filters

    - app/views/mail\_filters/\_mail\_filter\_form.html.erb
      [\_mail\_filter\_form.html.erb](#diff-631cac7465f8830e4ee77429df7ae44cfd215c41928676ed4ed84b19fa2d6b56)

## There are no files selected for viewing

20 changes: 7 additions & 13 deletions

20
[app/controllers/application\_controller.rb](#diff-766c34fd6533171eaf54300c153f89d6002c35c02cfc9c5b219251f85180ad07 "app/controllers/application_controller.rb")

Show comments

[View file](/sysphonic/thetis/blob/8004ee0c384daae0b28478ff8193d1990c397f57/app/controllers/application_controller.rb)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -75,18 +75,18 @@ def render(action=nil, options={}, &blk) |
|  |  | #=== paginate\_by\_sql |
|  |  | # |
|  |  | def paginate\_by\_sql(model, sql, per\_page, options={}) |
|  |  | if options[:count] |
|  |  | if options[:count].blank? |
|  |  | total = model.count\_by\_sql\_wrapping\_select\_query(sql) |
|  |  | else |
|  |  | if options[:count].is\_a?(Integer) |
|  |  | total = options[:count] |
|  |  | else |
|  |  | total = model.count\_by\_sql(options[:count]) |
|  |  | #else |
|  |  | # total = model.count\_by\_sql(options[:count]) |
|  |  | end |
|  |  | else |
|  |  | total = model.count\_by\_sql\_wrapping\_select\_query(sql) |
|  |  | end |
|  |  |  |
|  |  | SqlHelper.validate\_token([params['page']]) |
|  |  | object\_pages = model.paginate\_by\_sql(sql, {:page => params['page'], :per\_page => per\_page}) |
|  |  | #objects = model.find\_by\_sql\_with\_limit(sql, object\_pages.current.to\_sql[1], per\_page) |
|  |  | return [object\_pages, object\_pages, total] |
|  |  | end |
|  |  |  |
| Expand All | | @@ -99,7 +99,7 @@ def gate\_process |
|  |  |  |
|  |  | HistoryHelper.keep\_last(request) |
|  |  |  |
|  |  | @login\_user = User.find\_by\_id(session[:login\_user\_id]) |
|  |  | @login\_user = User.find(session[:login\_user\_id]) |
|  |  |  |
|  |  | begin |
|  |  | if @login\_user.nil? \ |
| Expand All | | @@ -118,12 +118,6 @@ def gate\_process |
|  |  |  |
|  |  | module ActiveRecord |
|  |  | class Base |
|  |  | def self.find\_by\_sql\_with\_limit(sql, offset, limit) |
|  |  | sql = sanitize\_sql(sql) |
|  |  | add\_limit!(sql, {:limit => limit, :offset => offset}) |
|  |  | find\_by\_sql(sql) |
|  |  | end |
|  |  |  |
|  |  | def self.count\_by\_sql\_wrapping\_select\_query(sql) |
|  |  | sql = sanitize\_sql(sql) |
|  |  | count\_by\_sql("select count(\*) from (#{sql}) as my\_table") |
| Expand Down | |  |

22 changes: 14 additions & 8 deletions

22
[app/controllers/mail\_filters\_controller.rb](#diff-9bccb1a03eea4bd752e3961f79ca13080c391426447e161550cc9a3c131d13ea "app/controllers/mail_filters_controller.rb")

Show comments

[View file](/sysphonic/thetis/blob/8004ee0c384daae0b28478ff8193d1990c397f57/app/controllers/mail_filters_controller.rb)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -108,7 +108,10 @@ def show |
|  |  | Log.add\_info(request, params.inspect) |
|  |  | end |
|  |  |  |
|  |  | @mail\_filter = MailFilter.find\_by\_id(params[:id]) |
|  |  | begin |
|  |  | @mail\_filter = MailFilter.find(params[:id]) |
|  |  | rescue => evar |
|  |  | end |
|  |  | if @mail\_filter.nil? |
|  |  | render(:text => 'ERROR:' + t('msg.already\_deleted', :name => MailFilter.model\_name.human)) |
|  |  | return |
| Expand Down  Expand Up | | @@ -225,8 +228,8 @@ def destroy |
|  |  | def do\_execute |
|  |  | Log.add\_info(request, params.inspect) |
|  |  |  |
|  |  | mail\_account = MailAccount.find\_by\_id(params[:mail\_account\_id]) |
|  |  | mail\_folder = MailFolder.find\_by\_id(params[:mail\_folder\_id]) |
|  |  | mail\_account = MailAccount.find(params[:mail\_account\_id]) |
|  |  | mail\_folder = MailFolder.find(params[:mail\_folder\_id]) |
|  |  |  |
|  |  | if mail\_account.user\_id != @login\_user.id \ |
|  |  | or mail\_folder.user\_id != @login\_user.id |
| Expand Down  Expand Up | | @@ -258,8 +261,9 @@ def get\_order |
|  |  | Log.add\_info(request, params.inspect) |
|  |  |  |
|  |  | mail\_account\_id = params[:mail\_account\_id] |
|  |  | SqlHelper.validate\_token([mail\_account\_id]) |
|  |  |  |
|  |  | @mail\_account = MailAccount.find\_by\_id(mail\_account\_id) |
|  |  | @mail\_account = MailAccount.find(mail\_account\_id) |
|  |  |  |
|  |  | if @mail\_account.user\_id != @login\_user.id |
|  |  | flash[:notice] = t('msg.need\_to\_be\_owner') |
| Expand All | | @@ -285,9 +289,11 @@ def update\_order |
|  |  | Log.add\_info(request, params.inspect) |
|  |  |  |
|  |  | mail\_account\_id = params[:mail\_account\_id] |
|  |  | order\_ary = params[:mail\_filters\_order] |
|  |  | order\_arr = params[:mail\_filters\_order] |
|  |  |  |
|  |  | SqlHelper.validate\_token([mail\_account\_id]) |
|  |  |  |
|  |  | @mail\_account = MailAccount.find\_by\_id(mail\_account\_id) |
|  |  | @mail\_account = MailAccount.find(mail\_account\_id) |
|  |  |  |
|  |  | if @mail\_account.user\_id != @login\_user.id |
|  |  | render(:text => 'ERROR:' + t('msg.need\_to\_be\_owner')) |
| Expand All | | @@ -301,8 +307,8 @@ def update\_order |
|  |  | id\_a = filter\_a.id.to\_s |
|  |  | id\_b = filter\_b.id.to\_s |
|  |  |  |
|  |  | idx\_a = order\_ary.index(id\_a) |
|  |  | idx\_b = order\_ary.index(id\_b) |
|  |  | idx\_a = order\_arr.index(id\_a) |
|  |  | idx\_b = order\_arr.index(id\_b) |
|  |  |  |
|  |  | if idx\_a.nil? or idx\_b.nil? |
|  |  | idx\_a = filters.index(id\_a) |
| Expand Down | |  |

30 changes: 22 additions & 8 deletions

30
[app/controllers/mail\_folders\_controller.rb](#diff-45bf8570f18660deedb22ec9b369d50559113eb1f0a21f0ac90f10885f48be06 "app/controllers/mail_folders_controller.rb")

Show comments

[View file](/sysphonic/thetis/blob/8004ee0c384daae0b28478ff8193d1990c397f57/app/controllers/mail_folders_controller.rb)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -302,7 +302,7 @@ def get\_mail\_attachments |
|  |  |  |
|  |  | email\_id = params[:id] |
|  |  |  |
|  |  | email = Email.find\_by\_id(email\_id) |
|  |  | email = Email.find(email\_id) |
|  |  | if email.nil? or email.user\_id != @login\_user.id |
|  |  | render(:text => '') |
|  |  | return |
| Expand All | | @@ -327,14 +327,20 @@ def get\_mail\_attachment |
|  |  | Log.add\_info(request, params.inspect) |
|  |  |  |
|  |  | attached\_id = params[:id].to\_i |
|  |  | mail\_attach = MailAttachment.find\_by\_id(attached\_id) |
|  |  | begin |
|  |  | mail\_attach = MailAttachment.find(attached\_id) |
|  |  | rescue => evar |
|  |  | end |
|  |  |  |
|  |  | if mail\_attach.nil? |
|  |  | redirect\_to(THETIS\_RELATIVE\_URL\_ROOT + '/404.html') |
|  |  | return |
|  |  | end |
|  |  |  |
|  |  | email = Email.find\_by\_id(mail\_attach.email\_id) |
|  |  | begin |
|  |  | email = Email.find(mail\_attach.email\_id) |
|  |  | rescue => evar |
|  |  | end |
|  |  | if email.nil? or email.user\_id != @login\_user.id |
|  |  | render(:text => '') |
|  |  | return |
| Expand Down  Expand Up | | @@ -438,7 +444,10 @@ def ajax\_delete\_mails |
|  |  | params[:check\_mail].each do |email\_id, value| |
|  |  | next if value != '1' |
|  |  |  |
|  |  | email = Email.find\_by\_id(email\_id) |
|  |  | begin |
|  |  | email = Email.find(email\_id) |
|  |  | rescue => evar |
|  |  | end |
|  |  | next if email.nil? or (email.user\_id != @login\_user.id) |
|  |  |  |
|  |  | if trash\_folder.nil? \ |
| Expand Down  Expand Up | | @@ -473,7 +482,11 @@ def ajax\_move\_mails |
|  |  | Log.add\_info(request, params.inspect) |
|  |  |  |
|  |  | folder\_id = params[:thetisBoxSelKeeper].split(':').last |
|  |  | mail\_folder = MailFolder.find\_by\_id(folder\_id) |
|  |  | SqlHelper.validate\_token([folder\_id]) |
|  |  | begin |
|  |  | mail\_folder = MailFolder.find(folder\_id) |
|  |  | rescue => evar |
|  |  | end |
|  |  |  |
|  |  | if folder\_id == '0' \ |
|  |  | or mail\_folder.nil? \ |
| Expand Down  Expand Up | | @@ -541,15 +554,16 @@ def get\_folders\_order |
|  |  | def update\_folders\_order |
|  |  | Log.add\_info(request, params.inspect) |
|  |  |  |
|  |  | order\_ary = params[:folders\_order] |
|  |  | order\_arr = params[:folders\_order] |
|  |  |  |
|  |  | SqlHelper.validate\_token([params[:id]]) |
|  |  | folders = MailFolder.get\_childs(params[:id], false, false) |
|  |  | # folders must be ordered by xorder ASC. |
|  |  |  |
|  |  | folders.sort! { |id\_a, id\_b| |
|  |  |  |
|  |  | idx\_a = order\_ary.index(id\_a) |
|  |  | idx\_b = order\_ary.index(id\_b) |
|  |  | idx\_a = order\_arr.index(id\_a) |
|  |  | idx\_b = order\_arr.index(id\_b) |
|  |  |  |
|  |  | if idx\_a.nil? or idx\_b.nil? |
|  |  | idx\_a = folders.index(id\_a) |
| Expand Down | |  |

1 change: 1 addition & 0 deletions

1
[app/controllers/workflows\_controller.rb](#diff-17fcd380774296ecbcfc6d7c9d8c5bc357302d1031f18d4c90f97d84aad6e497 "app/controllers/workflows_controller.rb")

Show comments

[View file](/sysphonic/thetis/blob/8004ee0c384daae0b28478ff8193d1990c397f57/app/controllers/workflows_controller.rb)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -103,6 +103,7 @@ def move |
|  |  |  |
|  |  | unless params[:thetisBoxSelKeeper].nil? |
|  |  | folder\_id = params[:thetisBoxSelKeeper].split(':').last |
|  |  | SqlHelper.validate\_token([folder\_id]) |
|  |  |  |
|  |  | workflow = Workflow.find(params[:id]) |
|  |  |  |
| Expand Down | |  |

6 changes: 5 additions & 1 deletion

6
[app/helpers/mail\_filters\_helper.rb](#diff-39cbf4b8758f5f49650b776d26fc0c8ef769bff690cdc94ee64c296feb473b7d "app/helpers/mail_filters_helper.rb")

Show comments

[View file](/sysphonic/thetis/blob/8004ee0c384daae0b28478ff8193d1990c397f57/app/helpers/mail_filters_helper.rb)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -413,8 +413,12 @@ def self.execute\_actions(mail\_filter, email, actions) |
|  |  | def self.execute\_action\_move(mail\_filter, email, val) |
|  |  |  |
|  |  | mail\_folder\_id = val |
|  |  | SqlHelper.validate\_token([mail\_folder\_id]) |
|  |  |  |
|  |  | mail\_folder = MailFolder.find\_by\_id(mail\_folder\_id) |
|  |  | begin |
|  |  | mail\_folder = MailFolder.find(mail\_folder\_id) |
|  |  | rescue => evar |
|  |  | end |
|  |  | if !mail\_folder.nil? and (mail\_folder.user\_id == email.user\_id) |
|  |  | email.update\_attribute(:mail\_folder\_id, mail\_folder\_id) |
|  |  | end |
| Expand Down | |  |

15 changes: 12 additions & 3 deletions

15
[app/models/address.rb](#diff-4c2d4bccb73a3296911380789e5eb5e1bd37b277d07e743e6a6441879528cee6 "app/models/address.rb")

Show comments

[View file](/sysphonic/thetis/blob/8004ee0c384daae0b28478ff8193d1990c397f57/app/models/address.rb)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -210,7 +210,8 @@ def self.check\_csv\_header(row, book) |
|  |  | def self.parse\_csv\_row(row, book, idxs, user) |
|  |  |  |
|  |  | imp\_id = (idxs[0].nil? or row[idxs[0]].nil?)?(nil):(row[idxs[0]].strip) |
|  |  | unless imp\_id.nil? or imp\_id.empty? |
|  |  | SqlHelper.validate\_token([imp\_id]) |
|  |  | unless imp\_id.blank? |
|  |  | org\_address = Address.find\_by\_id(imp\_id) |
|  |  | end |
|  |  |  |
| Expand Down  Expand Up | | @@ -305,7 +306,11 @@ def check\_import(mode, address\_names) #, address\_emails |
|  |  | if (/^|([0-9]+|)+$/ =~ self.groups) == 0 |
|  |  |  |
|  |  | self.get\_groups\_a.each do |group\_id| |
|  |  | group = Group.find\_by\_id(group\_id) |
|  |  | begin |
|  |  | group = Group.find(group\_id) |
|  |  | rescue => evar |
|  |  | group = nil |
|  |  | end |
|  |  | if group.nil? |
|  |  | err\_msgs << I18n.t('address.import.not\_valid\_groups') + ': '+group\_id.to\_s |
|  |  | break |
| Expand All | | @@ -322,7 +327,11 @@ def check\_import(mode, address\_names) #, address\_emails |
|  |  | if (/^|([0-9]+|)+$/ =~ self.teams) == 0 |
|  |  |  |
|  |  | self.get\_teams\_a.each do |team\_id| |
|  |  | team = Team.find\_by\_id(team\_id) |
|  |  | begin |
|  |  | team = Team.find(team\_id) |
|  |  | rescue => evar |
|  |  | team = nil |
|  |  | end |
|  |  | if team.nil? |
|  |  | err\_msgs << I18n.t('address.import.not\_valid\_teams') + ': '+team\_id.to\_s |
|  |  | break |
| Expand Down | |  |

4 changes: 1 addition & 3 deletions

4
[app/models/comment.rb](#diff-3baef9453c5d8b6c8962ce9ff9ec6b570b2e9cbad934e9f95b6d217ff1029b07 "app/models/comment.rb")

Show comments

[View file](/sysphonic/thetis/blob/8004ee0c384daae0b28478ff8193d1990c397f57/app/models/comment.rb)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -104,8 +104,7 @@ def attachments\_without\_content |
|  |  | rescue => evar |
|  |  | Log.add\_error(nil, evar) |
|  |  | end |
|  |  | attachments = [] if attachments.nil? |
|  |  | return attachments |
|  |  | return (attachments || []) |
|  |  | end |
|  |  |  |
|  |  | #=== self.get\_toys |
| Expand Down  Expand Up | | @@ -160,5 +159,4 @@ def self.get\_feeds(user, root\_url, users\_cache = nil) |
|  |  | end |
|  |  | return entries |
|  |  | end |
|  |  |  |
|  |  | end |

2 changes: 1 addition & 1 deletion

2
[app/models/email.rb](#diff-02c13e71f0c5f29a8e43dde10a166be8cd5f1999707ae26ef1aef690610e06ec "app/models/email.rb")

Show comments

[View file](/sysphonic/thetis/blob/8004ee0c384daae0b28478ff8193d1990c397f57/app/models/email.rb)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -53,7 +53,7 @@ class Email < ActiveRecord::Base |
|  |  | # FEATURE\_MAIL\_STRICT\_CAPACITY >>> |
|  |  | if (email.status != Email::STATUS\_TEMPORARY) \ |
|  |  | and (email.size > org\_size) |
|  |  | mail\_account = MailAccount.find\_by\_id(email.mail\_account\_id) |
|  |  | mail\_account = MailAccount.find(email.mail\_account\_id) |
|  |  | max\_size = mail\_account.get\_capacity\_mb \* 1024 \* 1024 |
|  |  | con = "(id != #{email.id})" unless email.id.nil? |
|  |  | cur\_size = MailAccount.get\_using\_size(mail\_account.id, con) |
| Expand Down | |  |

6 changes: 5 additions & 1 deletion

6
[app/models/item.rb](#diff-a3af7f7509f0f5653967f73c2e2d04a7ca1e21d8e92f051d0550d8879479aa96 "app/models/item.rb")

Show comments

[View file](/sysphonic/thetis/blob/8004ee0c384daae0b28478ff8193d1990c397f57/app/models/item.rb)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -68,7 +68,11 @@ def is\_a\_copy?(folder\_obj\_cache=nil) |
|  |  | return false if self.source\_id.nil? |
|  |  |  |
|  |  | # Exclude those created from system templates. |
|  |  | src\_item = Item.find\_by\_id(self.source\_id) |
|  |  | begin |
|  |  | src\_item = Item.find(self.source\_id) |
|  |  | rescue => evar |
|  |  | src\_item = nil |
|  |  | end |
|  |  | if src\_item.nil? |
|  |  | return true |
|  |  | else |
| Expand Down | |  |

18 changes: 9 additions & 9 deletions

18
[app/models/toy.rb](#diff-b3840a893d5a14a12ce542409d57159dcda7be8293e163870aee90dafeac226f "app/models/toy.rb")

Show comments

[View file](/sysphonic/thetis/blob/8004ee0c384daae0b28478ff8193d1990c397f57/app/models/toy.rb)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -125,7 +125,7 @@ def self.get\_for\_user(user) |
|  |  | return [] if user.nil? |
|  |  |  |
|  |  | toys = Toy.where("user\_id=#{user.id}").to\_a |
|  |  | deleted\_ary = [] |
|  |  | deleted\_arr = [] |
|  |  |  |
|  |  | return [] if toys.nil? |
|  |  |  |
| Expand All | | @@ -134,48 +134,48 @@ def self.get\_for\_user(user) |
|  |  | when Toy::XTYPE\_ITEM |
|  |  | item = Item.find\_by\_id(toy.target\_id) |
|  |  | if item.nil? |
|  |  | deleted\_ary << toy |
|  |  | deleted\_arr << toy |
|  |  | next |
|  |  | end |
|  |  | Toy.copy(toy, item) |
|  |  |  |
|  |  | when Toy::XTYPE\_COMMENT |
|  |  | comment = Comment.find\_by\_id(toy.target\_id) |
|  |  | if comment.nil? |
|  |  | deleted\_ary << toy |
|  |  | deleted\_arr << toy |
|  |  | next |
|  |  | end |
|  |  | Toy.copy(toy, comment) |
|  |  |  |
|  |  | when Toy::XTYPE\_WORKFLOW |
|  |  | workflow = Workflow.find\_by\_id(toy.target\_id) |
|  |  | if workflow.nil? |
|  |  | deleted\_ary << toy |
|  |  | deleted\_arr << toy |
|  |  | next |
|  |  | end |
|  |  | Toy.copy(toy, workflow) |
|  |  |  |
|  |  | when Toy::XTYPE\_SCHEDULE |
|  |  | schedule = Schedule.find\_by\_id(toy.target\_id) |
|  |  | if schedule.nil? |
|  |  | deleted\_ary << toy |
|  |  | deleted\_arr << toy |
|  |  | next |
|  |  | end |
|  |  | Toy.copy(toy, schedule) |
|  |  |  |
|  |  | when Toy::XTYPE\_FOLDER |
|  |  | folder = Folder.find\_by\_id(toy.target\_id) |
|  |  | if folder.nil? |
|  |  | deleted\_ary << toy |
|  |  | deleted\_arr << toy |
|  |  | next |
|  |  | end |
|  |  | Toy.copy(toy, folder) |
|  |  | end |
|  |  | end |
|  |  |  |
|  |  | deleted\_ary.each do |toy| |
|  |  | toys.delete toy |
|  |  | Toy.destroy toy.id |
|  |  | deleted\_arr.each do |toy| |
|  |  | toys.delete(toy) |
|  |  | Toy.destroy(toy.id) |
|  |  | end |
|  |  |  |
|  |  | return toys |
| Expand Down | |  |

6 changes: 5 additions & 1 deletion

6
[app/models/user.rb](#diff-9802ca3c9c4cf89904fd44bc114e35ebdf2c5dd3d5b645491e2b253e1afef29b "app/models/user.rb")

Show comments

[View file](/sysphonic/thetis/blob/8004ee0c384daae0b28478ff8193d1990c397f57/app/models/user.rb)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -1131,7 +1131,11 @@ def check\_import(mode, user\_names) #, user\_emails |
|  |  | if (/^|([0-9]+|)+$/ =~ self.groups) == 0 |
|  |  |  |
|  |  | self.get\_groups\_a.each do |group\_id| |
|  |  | group = Group.find\_by\_id(group\_id) |
|  |  | begin |
|  |  | group = Group.find(group\_id) |
|  |  | rescue => evar |
|  |  | group = nil |
|  |  | end |
|  |  | if group.nil? |
|  |  | err\_msgs << I18n.t('user.import.not\_valid\_groups') + ': '+group\_id.to\_s |
|  |  | break |
| Expand Down | |  |

3 changes: 2 additions & 1 deletion

3
[app/views/mail\_filters/\_mail\_filter\_form.html.erb](#diff-631cac7465f8830e4ee77429df7ae44cfd215c41928676ed4ed84b19fa2d6b56 "app/views/mail_filters/_mail_filter_form.html.erb")

Show comments

[View file](/sysphonic/thetis/blob/8004ee0c384daae0b28478ff8193d1990c397f57/app/views/mail_filters/_mail_filter_form.html.erb)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -6,7 +6,8 @@ if params[:mail\_account\_id].blank? |
|  |  | else |
|  |  | mail\_account\_id = params[:mail\_account\_id] |
|  |  | end |
|  |  | mail\_account = MailAccount.find\_by\_id(mail\_account\_id) |
|  |  | SqlHelper.validate\_token([mail\_account\_id]) |
|  |  | mail\_account = MailAccount.find(mail\_account\_id) |
|  |  | %> |
|  |  |  |
|  |  | <%= render(:partial => 'common/error', :locals => {:obj => @mail\_filter}) %> |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `8004ee0`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fsysphonic%2Fthetis%2Fcommit%2F8004ee0c384daae0b28478ff8193d1990c397f57) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_7ee8daae_20250125_223352.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fsysphonic%2Fthetis%2Fcommit%2Fc07e255d2296d50a0bffafaf66a76f8f1b53621f)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fsysphonic%2Fthetis%2Fcommit%2Fc07e255d2296d50a0bffafaf66a76f8f1b53621f)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=sysphonic%2Fthetis)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[sysphonic](/sysphonic)
/
**[thetis](/sysphonic/thetis)**
Public

* [Notifications](/login?return_to=%2Fsysphonic%2Fthetis) You must be signed in to change notification settings
* [Fork
  6](/login?return_to=%2Fsysphonic%2Fthetis)
* [Star
   6](/login?return_to=%2Fsysphonic%2Fthetis)

* [Code](/sysphonic/thetis)
* [Issues
  2](/sysphonic/thetis/issues)
* [Pull requests
  8](/sysphonic/thetis/pulls)
* [Actions](/sysphonic/thetis/actions)
* [Projects
  0](/sysphonic/thetis/projects)
* [Wiki](/sysphonic/thetis/wiki)
* [Security](/sysphonic/thetis/security)
* [Insights](/sysphonic/thetis/pulse)

Additional navigation options

* [Code](/sysphonic/thetis)
* [Issues](/sysphonic/thetis/issues)
* [Pull requests](/sysphonic/thetis/pulls)
* [Actions](/sysphonic/thetis/actions)
* [Projects](/sysphonic/thetis/projects)
* [Wiki](/sysphonic/thetis/wiki)
* [Security](/sysphonic/thetis/security)
* [Insights](/sysphonic/thetis/pulse)

## Commit

[Permalink](/sysphonic/thetis/commit/c07e255d2296d50a0bffafaf66a76f8f1b53621f)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Thetis ver.2.3.0: Reinforcement of security.

[Browse files](/sysphonic/thetis/tree/c07e255d2296d50a0bffafaf66a76f8f1b53621f)
Browse the repository at this point in the history

```
Signed-off-by: MORITA Shintaro <shin@sysphonic.com>
```

* Loading branch information

MORITA Shintaro
committed
Jul 13, 2015

1 parent
[1b82347](/sysphonic/thetis/commit/1b8234706e1294f41df42f3d1ccb71b983ffbe23)

commit c07e255

 Show file tree

 Hide file tree

Showing
**6 changed files**
with
**76 additions**
and
**55 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* app

  + controllers

    - app/controllers/login\_controller.rb
      [login\_controller.rb](#diff-5d401230d249c0833d3c04a53f1aeab6c223010a996fe82296635e88a10c8cc7)
  + helpers

    - app/helpers/sql\_helper.rb
      [sql\_helper.rb](#diff-bacba4ae3b300c54897224b84231621c8922484b2f40ebd3720d0bebc8c76b44)
  + models

    - app/models/address.rb
      [address.rb](#diff-4c2d4bccb73a3296911380789e5eb5e1bd37b277d07e743e6a6441879528cee6)
    - app/models/user.rb
      [user.rb](#diff-9802ca3c9c4cf89904fd44bc114e35ebdf2c5dd3d5b645491e2b253e1afef29b)
  + views

    - frames

      * app/views/frames/about.html.erb
        [about.html.erb](#diff-46614395acc16ef8e2d216a51d288980c2f43cc3820b61c4e4f06f0fd6245d4a)
    - items

      * app/views/items/\_ajax\_item\_basic.html.erb
        [\_ajax\_item\_basic.html.erb](#diff-ecee3c15d688b7a5b753b0651ea43db48f177fd8dbc5863fe2cc697a47256d9d)

## There are no files selected for viewing

3 changes: 1 addition & 2 deletions

3
[app/controllers/login\_controller.rb](#diff-5d401230d249c0833d3c04a53f1aeab6c223010a996fe82296635e88a10c8cc7 "app/controllers/login_controller.rb")

Show comments

[View file](/sysphonic/thetis/blob/c07e255d2296d50a0bffafaf66a76f8f1b53621f/app/controllers/login_controller.rb)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -97,9 +97,8 @@ def send\_password |
|  |  | Log.add\_info(request, params.inspect) |
|  |  |  |
|  |  | mail\_addr = params[:thetisBoxEdit] |
|  |  | SqlHelper.validate\_token([mail\_addr]) |
|  |  | begin |
|  |  | users = User.where("email='#{mail\_addr}'").to\_a |
|  |  | users = User.where(email: mail\_addr).to\_a |
|  |  | rescue => evar |
|  |  | end |
|  |  |  |
| Expand Down | |  |

5 changes: 3 additions & 2 deletions

5
[app/helpers/sql\_helper.rb](#diff-bacba4ae3b300c54897224b84231621c8922484b2f40ebd3720d0bebc8c76b44 "app/helpers/sql_helper.rb")

Show comments

[View file](/sysphonic/thetis/blob/c07e255d2296d50a0bffafaf66a76f8f1b53621f/app/helpers/sql_helper.rb)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -30,12 +30,13 @@ def self.validate\_token(tokens, extra\_chars=nil) |
|  |  | else |
|  |  | extra\_chars = Regexp.escape(extra\_chars.join()) |
|  |  | end |
|  |  | regexp = Regexp.new("^[ ]\*[a-zA-Z0-9\_.@\\-#{extra\_chars}]+[ ]\*$") |
|  |  | regexp = Regexp.new("^[ ]\*[a-zA-Z0-9\_#{extra\_chars}]+[ ]\*$") |
|  |  |  |
|  |  | [tokens].flatten.each do |token| |
|  |  | next if token.blank? |
|  |  |  |
|  |  | if token.to\_s.match(regexp).nil? |
|  |  | if token.to\_s.match(regexp).nil? \ |
|  |  | and token.to\_s.match(/^[ ]\*\d+-\d+-\d+[ ]\*$/).nil? |
|  |  | raise("[ERROR] SqlHelper.validate\_token failed: #{token}") |
|  |  | end |
|  |  | end |
| Expand Down | |  |

14 changes: 9 additions & 5 deletions

14
[app/models/address.rb](#diff-4c2d4bccb73a3296911380789e5eb5e1bd37b277d07e743e6a6441879528cee6 "app/models/address.rb")

Show comments

[View file](/sysphonic/thetis/blob/c07e255d2296d50a0bffafaf66a76f8f1b53621f/app/models/address.rb)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -36,12 +36,12 @@ class Address < ActiveRecord::Base |
|  |  | # |
|  |  | def self.get\_by\_email(mail\_addr, user, book=Address::BOOK\_BOTH) |
|  |  |  |
|  |  | SqlHelper.validate\_token([mail\_addr]) |
|  |  | mail\_quote = SqlHelper.quote(mail\_addr) |
|  |  |  |
|  |  | email\_con = [] |
|  |  | email\_con.push("(email1='#{mail\_addr}')") |
|  |  | email\_con.push("(email2='#{mail\_addr}')") |
|  |  | email\_con.push("(email3='#{mail\_addr}')") |
|  |  | email\_con.push("(email1=#{mail\_quote})") |
|  |  | email\_con.push("(email2=#{mail\_quote})") |
|  |  | email\_con.push("(email3=#{mail\_quote})") |
|  |  | con = [] |
|  |  | con.push('('+email\_con.join(' or ')+')') |
|  |  | con.push(AddressbookHelper.get\_scope\_condition\_for(user, book)) |
| Expand Down  Expand Up | | @@ -212,7 +212,11 @@ def self.parse\_csv\_row(row, book, idxs, user) |
|  |  | imp\_id = (idxs[0].nil? or row[idxs[0]].nil?)?(nil):(row[idxs[0]].strip) |
|  |  | SqlHelper.validate\_token([imp\_id]) |
|  |  | unless imp\_id.blank? |
|  |  | org\_address = Address.find\_by\_id(imp\_id) |
|  |  | begin |
|  |  | org\_address = Address.find(imp\_id) |
|  |  | rescue => evar |
|  |  | org\_address = nil |
|  |  | end |
|  |  | end |
|  |  |  |
|  |  | if org\_address.nil? |
| Expand Down | |  |

2 changes: 1 addition & 1 deletion

2
[app/models/user.rb](#diff-9802ca3c9c4cf89904fd44bc114e35ebdf2c5dd3d5b645491e2b253e1afef29b "app/models/user.rb")

Show comments

[View file](/sysphonic/thetis/blob/c07e255d2296d50a0bffafaf66a76f8f1b53621f/app/models/user.rb)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -534,7 +534,7 @@ def self.get\_from\_name(user\_name) |
|  |  | SqlHelper.validate\_token([user\_name]) |
|  |  |  |
|  |  | begin |
|  |  | user = User.where("name='#{user\_name}'").first |
|  |  | user = User.where(name: user\_name).first |
|  |  | rescue => evar |
|  |  | Log.add\_error(nil, evar) |
|  |  | end |
| Expand Down | |  |

2 changes: 1 addition & 1 deletion

2
[app/views/frames/about.html.erb](#diff-46614395acc16ef8e2d216a51d288980c2f43cc3820b61c4e4f06f0fd6245d4a "app/views/frames/about.html.erb")

Show comments

[View file](/sysphonic/thetis/blob/c07e255d2296d50a0bffafaf66a76f8f1b53621f/app/views/frames/about.html.erb)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -38,7 +38,7 @@ |
|  |  | <table style="width:60%; margin:0px auto 0px 0px; border-spacing:0px;"> |
|  |  | <tr> |
|  |  | <td style="text-align:left;" nowrap> |
|  |  | Sysphonic <B>Thetis</B><sup>&reg;</sup> <small style="text-align:right;">ver.2.2.0</small>&nbsp; |
|  |  | Sysphonic <B>Thetis</B><sup>&reg;</sup> <small style="text-align:right;">ver.2.3.0</small>&nbsp; |
|  |  | </td> |
|  |  | </tr> |
|  |  | </table> |
| Expand Down | |  |

105 changes: 61 additions & 44 deletions

105
[app/views/items/\_ajax\_item\_basic.html.erb](#diff-ecee3c15d688b7a5b753b0651ea43db48f177fd8dbc5863fe2cc697a47256d9d "app/views/items/_ajax_item_basic.html.erb")

Show comments

[View file](/sysphonic/thetis/blob/c07e255d2296d50a0bffafaf66a76f8f1b53621f/app/views/items/_ajax_item_basic.html.erb)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -22,50 +22,54 @@ |
|  |  | <% when Item::XTYPE\_RESEARCH %> |
|  |  | <%= Research.model\_name.human %> |
|  |  | <% else # XTYPE\_INFO, XTYPE\_PROJECT, XTYPE\_ZEPTAIR\_DIST, XTYPE\_UNKNOWN %> |
|  |  | <%= radio\_button('item', 'xtype', Item::XTYPE\_INFO, :onClick => 'dispZeptCmdOpt(false); modifiedBasic++') %><label for="item\_xtype\_<%= Item::XTYPE\_INFO %>"> <%= t('item.type.normal') %></label><br/> |
|  |  | <%= radio\_button('item', 'xtype', Item::XTYPE\_PROJECT, :onClick => 'dispZeptCmdOpt(false); modifiedBasic++') %><label for="item\_xtype\_<%= Item::XTYPE\_PROJECT %>"> <img src="<%= THETIS\_RELATIVE\_URL\_ROOT %>/images/folder/team\_folder.gif" title="<%= t('item.project') %>" alt="<%= t('item.project') %>" /> <%= t('item.type.project') %></label><br/> |
|  |  | <% if @login\_user.admin?(User::AUTH\_ZEPTAIR) %> |
|  |  | <%= radio\_button('item', 'xtype', Item::XTYPE\_ZEPTAIR\_DIST, :onClick => 'dispZeptCmdOpt(this.checked); modifiedBasic++') %><label for="item\_xtype\_<%= Item::XTYPE\_ZEPTAIR\_DIST %>"> <img src="<%= THETIS\_RELATIVE\_URL\_ROOT %>/images/zeptair/zeptair\_icon.png" title="<%= t('item.type.zeptair\_dist') %>" alt="<%= t('item.type.zeptair\_dist') %>" /> <%= t('item.type.zeptair\_dist') %></label> |
|  |  | &nbsp;<img class="img\_btn" src="<%= THETIS\_RELATIVE\_URL\_ROOT %>/images/info.gif" onclick="msg('<%= t('item.zeptair\_dist\_info') %>');"> |
|  |  |  |
|  |  | <div id="div\_zept\_cmd" style="padding-left:20px; display:<%= (@item.xtype == Item::XTYPE\_ZEPTAIR\_DIST)?'block':'none' %>;"> |
|  |  | <div style="background-color:#FDFEFF; padding:2px 3px"> |
|  |  | <% |
|  |  | zept\_cmd = @item.zeptair\_command |
|  |  | checked = (!zept\_cmd.nil? and zept\_cmd.enabled)?'checked':'' |
|  |  | %> |
|  |  | <input name="zeptair\_command[enabled]" type="hidden" value="0" /> |
|  |  | <input type="checkbox" id="check\_zept\_cmd" name="zeptair\_command[enabled]" value="1" onclick="dispZeptCmdEdit(this.checked); modifiedBasic++;" <%= checked %>><label for="check\_zept\_cmd"><%= t('item.zeptair\_dist\_cmd') %></label> |
|  |  | <div id="div\_zept\_cmd\_edit" style="padding-left:20px; display:<%= (checked=='checked')?'block':'none' %>;"> |
|  |  | <textarea id="zept\_cmd" name="zeptair\_command[commands]" rows="4" wrap="off" style="width:95%; background-color:black; color:white;" onChange="modifiedBasic++;"><%= (zept\_cmd.nil?)?'':zept\_cmd.commands %></textarea><br/> |
|  |  | <% checked = (!zept\_cmd.nil? and zept\_cmd.confirm\_exec)?'checked':'' %> |
|  |  | <input name="zeptair\_command[confirm\_exec]" type="hidden" value="0" /> |
|  |  | <input type="checkbox" id="check\_zept\_cmd\_with\_confirm" name="zeptair\_command[confirm\_exec]" value="1" onclick="modifiedBasic++;" <%= checked %>><label for="check\_zept\_cmd\_with\_confirm"><%= t('item.zeptair\_dist\_cmd\_with\_confirm') %></label> |
|  |  | </div> |
|  |  | </div> |
|  |  | </div> |
|  |  |  |
|  |  | <script type="text/javascript"> |
|  |  | dispZeptCmdOpt = function(sw) |
|  |  | { |
|  |  | if (sw) { |
|  |  | \_z("div\_zept\_cmd").style.display = "block"; |
|  |  | } else { |
|  |  | \_z("div\_zept\_cmd").style.display = "none"; |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | dispZeptCmdEdit = function(sw) |
|  |  | { |
|  |  | if (sw) { |
|  |  | \_z("div\_zept\_cmd\_edit").style.display = "block"; |
|  |  | } else { |
|  |  | \_z("div\_zept\_cmd\_edit").style.display = "none"; |
|  |  | } |
|  |  | } |
|  |  | </script> |
|  |  |  |
|  |  | <% end %> |
|  |  | <%= radio\_button('item', 'xtype', Item::XTYPE\_INFO, :onClick => 'onItemXtypeClicked(this)') %><label for="item\_xtype\_<%= Item::XTYPE\_INFO %>"> <%= t('item.type.normal') %></label><br/> |
|  |  | <%= radio\_button('item', 'xtype', Item::XTYPE\_PROJECT, :onClick => 'onItemXtypeClicked(this)') %><label for="item\_xtype\_<%= Item::XTYPE\_PROJECT %>"> <img src="<%= THETIS\_RELATIVE\_URL\_ROOT %>/images/folder/team\_folder.gif" title="<%= t('item.project') %>" alt="<%= t('item.project') %>" /> <%= t('item.type.project') %></label><br/> |
|  |  | <% |
|  |  | =begin |
|  |  | # if @login\_user.admin?(User::AUTH\_ZEPTAIR) |
|  |  | %> |
|  |  | # <%= radio\_button('item', 'xtype', Item::XTYPE\_ZEPTAIR\_DIST, :onClick => 'onItemXtypeClicked(this)') %><label for="item\_xtype\_<%= Item::XTYPE\_ZEPTAIR\_DIST %>"> <img src="<%= THETIS\_RELATIVE\_URL\_ROOT %>/images/zeptair/zeptair\_icon.png" title="<%= t('item.type.zeptair\_dist') %>" alt="<%= t('item.type.zeptair\_dist') %>" /> <%= t('item.type.zeptair\_dist') %></label> |
|  |  | # &nbsp;<img class="img\_btn" src="<%= THETIS\_RELATIVE\_URL\_ROOT %>/images/info.gif" onclick="msg('<%= t('item.zeptair\_dist\_info') %>');"> |
|  |  | # |
|  |  | # <div id="div\_zept\_cmd" style="padding-left:20px; display:<%= (@item.xtype == Item::XTYPE\_ZEPTAIR\_DIST)?'block':'none' %>;"> |
|  |  | # <div style="background-color:#FDFEFF; padding:2px 3px"> |
|  |  | # <% |
|  |  | # zept\_cmd = @item.zeptair\_command |
|  |  | # checked = (!zept\_cmd.nil? and zept\_cmd.enabled)?'checked':'' |
|  |  | # %> |
|  |  | # <input name="zeptair\_command[enabled]" type="hidden" value="0" /> |
|  |  | # <input type="checkbox" id="check\_zept\_cmd" name="zeptair\_command[enabled]" value="1" onclick="dispZeptCmdEdit(this.checked); modifiedBasic++;" <%= checked %>><label for="check\_zept\_cmd"><%= t('item.zeptair\_dist\_cmd') %></label> |
|  |  | # <div id="div\_zept\_cmd\_edit" style="padding-left:20px; display:<%= (checked=='checked')?'block':'none' %>;"> |
|  |  | # <textarea id="zept\_cmd" name="zeptair\_command[commands]" rows="4" wrap="off" style="width:95%; background-color:black; color:white;" onChange="modifiedBasic++;"><%= (zept\_cmd.nil?)?'':zept\_cmd.commands %></textarea><br/> |
|  |  | # <% checked = (!zept\_cmd.nil? and zept\_cmd.confirm\_exec)?'checked':'' %> |
|  |  | # <input name="zeptair\_command[confirm\_exec]" type="hidden" value="0" /> |
|  |  | # <input type="checkbox" id="check\_zept\_cmd\_with\_confirm" name="zeptair\_command[confirm\_exec]" value="1" onclick="modifiedBasic++;" <%= checked %>><label for="check\_zept\_cmd\_with\_confirm"><%= t('item.zeptair\_dist\_cmd\_with\_confirm') %></label> |
|  |  | # </div> |
|  |  | # </div> |
|  |  | # </div> |
|  |  | # |
|  |  | #<script type="text/javascript"> |
|  |  | #dispZeptCmdOpt = function(sw) |
|  |  | #{ |
|  |  | # var div\_zept\_cmd = \_z("div\_zept\_cmd"); |
|  |  | # if (div\_zept\_cmd) { |
|  |  | # div\_zept\_cmd.style.display = (sw)?"block":"none"; |
|  |  | # } |
|  |  | #} |
|  |  | # |
|  |  | #dispZeptCmdEdit = function(sw) |
|  |  | #{ |
|  |  | # var div\_zept\_cmd\_edit = \_z("div\_zept\_cmd\_edit"); |
|  |  | # if (div\_zept\_cmd\_edit) { |
|  |  | # div\_zept\_cmd\_edit.style.display = (sw)?"block":"none"; |
|  |  | # } |
|  |  | #} |
|  |  | #</script> |
|  |  | # |
|  |  | <% |
|  |  | # end |
|  |  | =end |
|  |  | %> |
|  |  | <% end %> |
|  |  | </td> |
|  |  | </tr> |
| Expand Down  Expand Up | | @@ -271,6 +275,19 @@ dispZeptCmdEdit = function(sw) |
|  |  | document.getElementById("item\_id").value = "<%= @item.id %>"; |
|  |  | <% end %> |
|  |  |  |
|  |  | onItemXtypeClicked = function(elem) |
|  |  | { |
|  |  | modifiedBasic++; |
|  |  |  |
|  |  | if (typeof(dispZeptCmdOpt) == "function") { |
|  |  | if (elem.value == "<%= Item::XTYPE\_ZEPTAIR\_DIST %>") { |
|  |  | dispZeptCmdOpt(elem.checked); |
|  |  | } else { |
|  |  | dispZeptCmdOpt(false); |
|  |  | } |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | function doSelectFolder(frm) |
|  |  | { |
|  |  | var thetisBoxProgress = prog("TOP-RIGHT"); |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `c07e255`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fsysphonic%2Fthetis%2Fcommit%2Fc07e255d2296d50a0bffafaf66a76f8f1b53621f) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_a17bee83_20250125_223351.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fsysphonic%2Fthetis%2Fcommit%2Fa61dc72035c7ae0b06f6d7dc8b2a848ffc7db277)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fsysphonic%2Fthetis%2Fcommit%2Fa61dc72035c7ae0b06f6d7dc8b2a848ffc7db277)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=sysphonic%2Fthetis)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[sysphonic](/sysphonic)
/
**[thetis](/sysphonic/thetis)**
Public

* [Notifications](/login?return_to=%2Fsysphonic%2Fthetis) You must be signed in to change notification settings
* [Fork
  6](/login?return_to=%2Fsysphonic%2Fthetis)
* [Star
   6](/login?return_to=%2Fsysphonic%2Fthetis)

* [Code](/sysphonic/thetis)
* [Issues
  2](/sysphonic/thetis/issues)
* [Pull requests
  8](/sysphonic/thetis/pulls)
* [Actions](/sysphonic/thetis/actions)
* [Projects
  0](/sysphonic/thetis/projects)
* [Wiki](/sysphonic/thetis/wiki)
* [Security](/sysphonic/thetis/security)
* [Insights](/sysphonic/thetis/pulse)

Additional navigation options

* [Code](/sysphonic/thetis)
* [Issues](/sysphonic/thetis/issues)
* [Pull requests](/sysphonic/thetis/pulls)
* [Actions](/sysphonic/thetis/actions)
* [Projects](/sysphonic/thetis/projects)
* [Wiki](/sysphonic/thetis/wiki)
* [Security](/sysphonic/thetis/security)
* [Insights](/sysphonic/thetis/pulse)

## Commit

[Permalink](/sysphonic/thetis/commit/a61dc72035c7ae0b06f6d7dc8b2a848ffc7db277)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

x ApplicationHelper.get\_sql\_like() -> o SqlHelper.get\_sql\_like()

[Browse files](/sysphonic/thetis/tree/a61dc72035c7ae0b06f6d7dc8b2a848ffc7db277)
Browse the repository at this point in the history

```
Signed-off-by: MORITA Shintaro <shin@sysphonic.com>
```

* Loading branch information

MORITA Shintaro
committed
Jul 4, 2015

1 parent
[88d64da](/sysphonic/thetis/commit/88d64daf2907201102c8c944a02b3172bd13a6ff)

commit a61dc72

 Show file tree

 Hide file tree

Showing
**2 changed files**
with
**4 additions**
and
**4 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* app/controllers

  + app/controllers/equipment\_controller.rb
    [equipment\_controller.rb](#diff-a6bd8c9d5f7ad7b2475a7e28948c011475e772028fd7d9fd37dda73ae5e5de6b)
  + app/controllers/groups\_controller.rb
    [groups\_controller.rb](#diff-af3ad490ca40c9ba7d5641ead932a1b6af38ec2b4af21c0f8468b11ed97f0ba5)

## There are no files selected for viewing

6 changes: 3 additions & 3 deletions

6
[app/controllers/equipment\_controller.rb](#diff-a6bd8c9d5f7ad7b2475a7e28948c011475e772028fd7d9fd37dda73ae5e5de6b "app/controllers/equipment_controller.rb")

Show comments

[View file](/sysphonic/thetis/blob/a61dc72035c7ae0b06f6d7dc8b2a848ffc7db277/app/controllers/equipment_controller.rb)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -143,7 +143,7 @@ def list |
|  |  | if @group\_id == '0' |
|  |  | con << "((groups like '%|0|%') or (groups is null))" |
|  |  | else |
|  |  | con << ApplicationHelper.get\_sql\_like([:groups], "|#{@group\_id}|") |
|  |  | con << SqlHelper.get\_sql\_like([:groups], "|#{@group\_id}|") |
|  |  | end |
|  |  | end |
|  |  |  |
| Expand Down  Expand Up | | @@ -219,11 +219,11 @@ def schedule\_all |
|  |  | case display\_type |
|  |  | when 'group' |
|  |  | if @login\_user.get\_groups\_a(true).include?(display\_id) |
|  |  | con = ApplicationHelper.get\_sql\_like([:groups], "|#{display\_id}|") |
|  |  | con = SqlHelper.get\_sql\_like([:groups], "|#{display\_id}|") |
|  |  | end |
|  |  | when 'team' |
|  |  | if @login\_user.get\_teams\_a.include?(display\_id) |
|  |  | con = ApplicationHelper.get\_sql\_like([:teams], "|#{display\_id}|") |
|  |  | con = SqlHelper.get\_sql\_like([:teams], "|#{display\_id}|") |
|  |  | end |
|  |  | end |
|  |  | end |
| Expand Down | |  |

2 changes: 1 addition & 1 deletion

2
[app/controllers/groups\_controller.rb](#diff-af3ad490ca40c9ba7d5641ead932a1b6af38ec2b4af21c0f8468b11ed97f0ba5 "app/controllers/groups_controller.rb")

Show comments

[View file](/sysphonic/thetis/blob/a61dc72035c7ae0b06f6d7dc8b2a848ffc7db277/app/controllers/groups_controller.rb)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -263,7 +263,7 @@ def get\_users |
|  |  | if @group\_id == '0' |
|  |  | con << "((groups like '%|0|%') or (groups is null))" |
|  |  | else |
|  |  | con << ApplicationHelper.get\_sql\_like([:groups], "|#{@group\_id}|") |
|  |  | con << SqlHelper.get\_sql\_like([:groups], "|#{@group\_id}|") |
|  |  | end |
|  |  | end |
|  |  |  |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `a61dc72`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fsysphonic%2Fthetis%2Fcommit%2Fa61dc72035c7ae0b06f6d7dc8b2a848ffc7db277) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


