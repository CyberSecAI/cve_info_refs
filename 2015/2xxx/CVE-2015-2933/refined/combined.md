=== Content from www.openwall.com_473cc16a_20250125_133335.html ===


| [Openwall](/) * [Products](/)   + [Openwall GNU/\*/Linux   *server OS*](/Owl/)+ [Linux Kernel Runtime Guard](/lkrg/)+ [John the Ripper   *password cracker*](/john/)         - [Free & Open Source for any platform](/john/)- [in the cloud](/john/cloud/)- [Pro for Linux](/john/pro/linux/)- [Pro for macOS](/john/pro/macosx/)+ [Wordlists   *for password cracking*](/wordlists/)+ [passwdqc   *policy enforcement*](/passwdqc/)             - [Free & Open Source for Unix](/passwdqc/)- [Pro for Windows (Active Directory)](/passwdqc/windows/)+ [yescrypt   *KDF & password hashing*](/yescrypt/)+ [yespower   *Proof-of-Work (PoW)*](/yespower/)+ [crypt\_blowfish   *password hashing*](/crypt/)+ [phpass   *ditto in PHP*](/phpass/)+ [tcb   *better password shadowing*](/tcb/)+ [Pluggable Authentication Modules](/pam/)+ [scanlogd   *port scan detector*](/scanlogd/)+ [popa3d   *tiny POP3 daemon*](/popa3d/)+ [blists   *web interface to mailing lists*](/blists/)+ [msulogin   *single user mode login*](/msulogin/)+ [php\_mt\_seed   *mt\_rand() cracker*](/php_mt_seed/)* [Services](/services/)* Publications       + [Articles](/articles/)+ [Presentations](/presentations/)* Resources         + [Mailing lists](/lists/)+ [Community wiki](https://openwall.info/wiki/)+ [Source code repositories (GitHub)](https://github.com/openwall)+ [Source code repositories (CVSweb)](https://cvsweb.openwall.com)+ [File archive & mirrors](/mirrors/)+ [How to verify digital signatures](/signatures/)+ [OVE IDs](/ove/)* [What's new](/news) | |
| --- | --- |

| | [Follow @Openwall on Twitter for new release announcements and other news](https://twitter.com/openwall) | | --- | |
| --- | --- |

[[<prev]](../../../2015/03/31/9) [[next>]](2) [[thread-next>]](../../../2015/04/07/3) [[day]](.) [[month]](..) [[year]](../..) [[list]](../../..)
```

Message-ID: <CAKcmtDzP7GhQWdTNb2XaVD1dzfDPXzyjWRhoYaKPrZy+NALygA@mail.gmail.com>
Date: Tue, 31 Mar 2015 18:34:21 -0700
From: Chris Steipp <csteipp@...imedia.org>
To: oss-security@...ts.openwall.com
Subject: CVE request: MediaWiki 1.24.2/1.23.9/1.19.24

Hi, we patched several security issues in MediaWiki today. Could we get
CVE's assigned?

* iSEC Partners discovered a way to circumvent the SVG MIME blacklist for
embedded resources (iSEC-WMF1214-11). This allowed an attacker to embed
JavaScript in the SVG. The issue was additionally identified by Mario
Heiderich / Cure53. MIME types are now whitelisted.
<<https://phabricator.wikimedia.org/T85850>>

* MediaWiki user Bawolff pointed out that the SVG filter to prevent
injecting JavaScript using animate elements was incorrect.
<<https://phabricator.wikimedia.org/T86711>>

* MediaWiki user Bawolff reported a stored XSS vulnerability due to the way
attributes were expanded in MediaWiki's Html class, in combination with
LanguageConverter substitutions.
<<https://phabricator.wikimedia.org/T73394>>

* Internal review discovered that MediaWiki's SVG filtering could be
bypassed with entity encoding under the Zend interpreter. This could be
used to inject JavaScript. This issue was also discovered by Mario Gomes /
Beyond Security.
<<https://phabricator.wikimedia.org/T88310>>

* iSEC Partners discovered a way to bypass the style filtering for SVG
files (iSEC-WMF1214-3) to load external resource. This could violate the
anonymity of users viewing the SVG.
<<https://phabricator.wikimedia.org/T85349>>

* Internal review and iSEC Partners discovered (iSEC-WMF1214-1) that
MediaWiki versions using PBKDF2 for password hashing (the default since
1.24) are vulnerable to DoS attacks using extremely long passwords.
<<https://phabricator.wikimedia.org/T64685>>

* Internal review found that MediaWiki is vulnerable to "Quadratic Blowup"
DoS attacks, under both HHVM and Zend PHP.
<<https://phabricator.wikimedia.org/T71210>>

* iSEC Partners reported that the MediaWiki feature allowing a user to
preview another user's custom JavaScript could be abused for privilege
escalation (iSEC-WMF1214-10). This feature has been removed.
<<https://phabricator.wikimedia.org/T85855>>

* Extension:Scribunto - MediaWiki user Jackmcbarn discovered that function
names were sanitized in Lua error backtraces, which could lead to XSS.
<<https://phabricator.wikimedia.org/T85113>>

* Extension:CheckUser - iSEC Partners discovered that the CheckUser
extension did not prevent CSRF attacks on the form allowing checkusers to
look up sensitive information about other users (iSEC-WMF1214-6). Since the
use of CheckUser is logged, the CSRF could be abused to defame a trusted
user or flood the logs with noise.
<<https://phabricator.wikimedia.org/T85858>>

These next issues came up because of the difference in how HHVM handles PHP
code vs Zend. I'm not sure if CVE's are assigned for specific runtime
configurations? For MediaWiki, we say that HHVM support is experimental,
although we do run Wikipedia on it.

* iSEC Partners discovered a XSS vulnerability in the way api errors were
reflected under HHVM versions before 3.6.1 (iSEC-WMF1214-8). MediaWiki now
detects and mitigates this issue on older versions of HHVM.
<<https://phabricator.wikimedia.org/T85851>>

* iSEC Partners discovered that MediaWiki's SVG and XMP parsing running
under HHVM was susceptible to "Billion Laughs" DoS attacks
(iSEC-WMF1214-13).
<<https://phabricator.wikimedia.org/T85848>>

```

[Powered by blists](https://www.openwall.com/blists/) - [more mailing lists](https://lists.openwall.net)

Please check out the
[Open Source Software Security Wiki](https://oss-security.openwall.org/wiki/), which is counterpart to this
[mailing list](https://oss-security.openwall.org/wiki/mailing-lists/oss-security).

Confused about [mailing lists](/lists/) and their use?
[Read about mailing lists on Wikipedia](https://en.wikipedia.org/wiki/Electronic_mailing_list)
and check out these
[guidelines on proper formatting of your messages](https://www.complang.tuwien.ac.at/anton/mail-news-errors.html).



=== Content from phabricator.wikimedia.org_3febf251_20250126_085822.html ===
Page Menu[HomePhabricator](/)

* SearchConfigure Global Search

[Log In](https://phabricator.wikimedia.org/auth/start/?next=%2FT73394)[Create Task](/maniphest/task/edit/nocreate/) [Maniphest](/maniphest/)  T73394
# XSS in language converter when used with Html class's tricky escapingClosed, Resolved[Public](/policy/explain/PHID-TASK-yafbuhxbgn5dbpw2fbju/view/)Actions

* [Edit Task](/maniphest/task/edit/73394/)
* Edit Related Tasks...
* [Create Subtask](/maniphest/task/subtask/73394/)
* [Edit Parent Tasks](/search/rel/task.has-parent/PHID-TASK-yafbuhxbgn5dbpw2fbju/)
* [Edit Subtasks](/search/rel/task.has-subtask/PHID-TASK-yafbuhxbgn5dbpw2fbju/)
* [Merge Duplicates In](/search/rel/task.merge-in/PHID-TASK-yafbuhxbgn5dbpw2fbju/)
* [Close As Duplicate](/search/rel/task.close-as-duplicate/PHID-TASK-yafbuhxbgn5dbpw2fbju/)
* Edit Related Objects...
* [Edit Commits](/search/rel/task.has-commit/PHID-TASK-yafbuhxbgn5dbpw2fbju/)
* [Edit Mocks](/search/rel/task.has-mock/PHID-TASK-yafbuhxbgn5dbpw2fbju/)
* Subscribe
* [Mute Notifications](/subscriptions/mute/PHID-TASK-yafbuhxbgn5dbpw2fbju/)
* [Protect as security issue](/wmf/escalate-task/73394/)
* [Award Token](/token/give/PHID-TASK-yafbuhxbgn5dbpw2fbju/)
* [Flag For Later](/flag/edit/PHID-TASK-yafbuhxbgn5dbpw2fbju/)

Assigned To

|  | [• csteipp](/p/csteipp/) |
| --- | --- |

Authored By

|  | [Bawolff](/p/Bawolff/) |
| --- | --- |
| Sep 28 2014, 7:16 PM2014-09-28 19:16:00 (UTC+0) |

Tags

* [Security-Core](/tag/security-core/) [(Backlog)](/project/board/427/)
* [Patch-For-Review](/tag/patch-for-review/)
* [MediaWiki-Core-Team](/tag/mediawiki-core-team/)
* [Vuln-XSS](/tag/vuln-xss/)
* [Security](/tag/security/)
Referenced Files

|  | [F103786: T73394-escape\_gt-REL1\_19.patch](/F103786) |
| --- | --- |
| Mar 24 2015, 10:35 PM2015-03-24 22:35:27 (UTC+0) |

|  | [F99618: T73394-escape\_gt-wmf21.patch](/F99618) |
| --- | --- |
| Mar 17 2015, 10:43 PM2015-03-17 22:43:58 (UTC+0) |

|  | [F43922: T73394-escape\_gt.patch](/F43922) |
| --- | --- |
| Feb 19 2015, 11:32 PM2015-02-19 23:32:13 (UTC+0) |

|  | [F16331: bug71394-REL1\_19.patch](/F16331) |
| --- | --- |
| Nov 26 2014, 1:24 PM2014-11-26 13:24:12 (UTC+0) |

|  | [F16330: bug71394-REL1\_24\_REL1\_23\_REL1\_22.patch](/F16330) |
| --- | --- |
| Nov 26 2014, 1:24 PM2014-11-26 13:24:12 (UTC+0) |

|  | [F14798: file\_71394.txt](/F14798) |
| --- | --- |
| Nov 26 2014, 5:56 AM2014-11-26 05:56:31 (UTC+0) |

|  | [F14799: bug71394-tokenizer.patch](/F14799) |
| --- | --- |
| Nov 22 2014, 3:46 AM2014-11-22 03:46:11 (UTC+0) |

Subscribers

|  | [Bawolff](/p/Bawolff/) |
| --- | --- |

|  | [cscott](/p/cscott/) |
| --- | --- |

|  | [• csteipp](/p/csteipp/) |
| --- | --- |

|  | [gerritbot](/p/gerritbot/) |
| --- | --- |

|  | [Grunny](/p/Grunny/) |
| --- | --- |

|  | [liangent](/p/liangent/) |
| --- | --- |

|  | [Liuxinyu970226](/p/Liuxinyu970226/) |
| --- | --- |

[View All 12 Subscribers](/subscriptions/list/PHID-TASK-yafbuhxbgn5dbpw2fbju/)
# Description

Change to Html escaping method

If the language is set to a language with variants (e.g. zh, sr, etc), then its possible to create an XSS if some other code allows user input to be put in an attribute using the escaping done by Html::element (or Html::rawElement).

Example exploit code:

1. Set $wgLanguageCode = 'zh'; $wgDefaultLanguageVariant = 'zh-cn'; (Assuming you don't have a different default variant set in prefs)

Create a page with the following wikitext:

-{H|abc123=>zh-cn:" autofocus onfocus="alert('be evil');}-

{{Special:Contributions|target=>abc123}}

And you have your XSS. I imagine there's probably less obvious ways to exploit this once you take into all the extensions using Html:: for their escaping. The $wgDefaultLanguageVariant isn't really necessary as you can set the variant from the url.

If $wgWellFormedXml is off, I believe it becomes possible to directly insert a <script> tag instead of relying on event handlers (but haven't tested).

Solutions:

The fact that language converter basically does macro expansions after the html sanitization step, is pretty sketchy. But I'm not sure if there's a good way around that without redesigning the feature.

I would suggest fixing this by getting rid of the little weird tricks that Html::expandAttributes does. Well its cute that technically one doesn't need to escape that in that context, cute things like that seem like a bad idea in security critical code. (A similar thing occurs in the escaping of Html::element, however I don't think that is exploitable).

---

**Version**: unspecified

**Severity**: normal

**Patch**: T73394-escape\_gt-wmf21.patch4 KB[Download](https://phab.wmfusercontent.org/file/download/meas22waym3funqf5h2k/PHID-FILE-ztamz2n3p3bl2sji2txh/T73394-escape_gt-wmf21.patch) (fix the attack vectors, we'll address the root of the issue in a public patch)

* 1.24: T73394-escape\_gt.patch3 KB[Download](https://phab.wmfusercontent.org/file/download/vyxm7aac57lljcokqoqi/PHID-FILE-lrvlbwv2yxb5pxtfxvht/T73394-escape_gt.patch)
* 1.23: T73394-escape\_gt.patch3 KB[Download](https://phab.wmfusercontent.org/file/download/vyxm7aac57lljcokqoqi/PHID-FILE-lrvlbwv2yxb5pxtfxvht/T73394-escape_gt.patch)
* 1.19: T73394-escape\_gt-REL1\_19.patch3 KB[Download](https://phab.wmfusercontent.org/file/download/xjxy4x2a2w32nmbsndpg/PHID-FILE-s426wb6jxkecdvtgi5yd/T73394-escape_gt-REL1_19.patch)

**Affected Versions**: Since [f16d1e4ed70cd5a8fa6ae6ca8bb71bfe62f4f47e](/rMWf16d1e4ed70cd5a8fa6ae6ca8bb71bfe62f4f47e) (1.17?)

**Type**: xss

**CVE**: CVE-2015-2933

# Details

Reference bz71394

|  | Subject | Repo | Branch | Lines +/- |
| --- | --- | --- | --- | --- |
|  | [SECURITY: Escape > in Html::expandAttributes](https://gerrit.wikimedia.org/r/c/201222) | [mediawiki/core](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/core) | [master](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/core/%2B/master) | +7 -4 |
|  | [SECURITY: Escape > in Html::expandAttributes](https://gerrit.wikimedia.org/r/c/201027) | [mediawiki/core](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/core) | [REL1\_23](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/core/%2B/REL1_23) | +7 -4 |
|  | [SECURITY: Escape > in Html::expandAttributes](https://gerrit.wikimedia.org/r/c/201016) | [mediawiki/core](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/core) | [REL1\_24](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/core/%2B/REL1_24) | +7 -4 |
|  | [SECURITY: Escape > in Html::expandAttributes](https://gerrit.wikimedia.org/r/c/201037) | [mediawiki/core](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/core) | [REL1\_19](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/core/%2B/REL1_19) | +7 -4 |

[Customize query in gerrit](https://gerrit.wikimedia.org/r/#/q/bug:T73394)
# Related ObjectsSearch...

* Task Graph
* Mentions

|  |  | Status | Subtype | Assigned | Task |
| --- | --- | --- | --- | --- | --- |
|  |  | Resolved |  | [• csteipp](/p/csteipp/) | T88120 [Release MW 1.24.2 and 1.23.9 tarballs](/T88120) |
|  |  | Resolved |  | [• csteipp](/p/csteipp/) | T87275 [MediaWiki Security release 1.24.2](/T87275) |
|  |  | Resolved |  | [• csteipp](/p/csteipp/) | T73394 [XSS in language converter when used with Html class's tricky escaping](/T73394) |

Mentioned In [T57548: Html::expandAttributes can be tricked into omitting necessary quotes](/T57548)
[T125163: id attribute on headlines allow raw > [Possible issue in combination with language converter] (CVE-2017-8812)](/T125163)
[T119158: Language converter: unsafe attribute injection via glossary rules (CVE-2017-8815)](/T119158)
[T118755: Fix LanguageConverter's parsing](/T118755)
[rMW125ed0e5ff6b: SECURITY: Escape > in Html::expandAttributes](/rMW125ed0e5ff6bff50140eb2b844443c0389d5e583)
[rMWb92f883d50f8: SECURITY: Escape > in Html::expandAttributes](/rMWb92f883d50f8883dcfef0b2b68da330bfc3b193e)
[rMW9004770f60f8: SECURITY: Escape > in Html::expandAttributes](/rMW9004770f60f8bc768bfa2f73fc290ccc4c3a42ce)
[rMW98062a7bb4a8: SECURITY: Escape > in Html::expandAttributes](/rMW98062a7bb4a8f78c77335d608371a8eb5b7ea278) Mentioned Here [rMWf16d1e4ed70c: LanguageConverter::captionConvert(): remove HTML tags and escape HTML special…](/rMWf16d1e4ed70cd5a8fa6ae6ca8bb71bfe62f4f47e)
### Event Timeline

There are a very large number of changes, so older changes are hidden. [Show Older Changes](/transactions/showolder/PHID-TASK-yafbuhxbgn5dbpw2fbju/?after=750310&quoteTargetID=UQ0_1&quoteRef=T73394)Restricted Application changed the visibility from "Public (No Login Required)" to "[acl\*security](/tag/acl_security/) (Project)".  · [View Herald Transcript](/herald/transcript/404381/)[Nov 22 2014, 3:46 AM2014-11-22 03:46:02 (UTC+0)](#750310)Restricted Application changed the edit policy from "All Users" to "[acl\*security](/tag/acl_security/) (Project)".  · [View Herald Transcript](/herald/transcript/404381/)[Bawolff](/p/Bawolff/) created this task.[Sep 28 2014, 7:16 PM2014-09-28 19:16:00 (UTC+0)](#750317)[Bawolff](/p/Bawolff/) added a comment.[Sep 28 2014, 7:30 PM2014-09-28 19:30:44 (UTC+0)](#750320)Comment Actions

p.s. In the interest of credit where credit is due for finding this, I should add: thank you to CScott, who helped me understand how language converter actually worked, and Amir who pointed me in this direction during a conversation about a different issue with the language converter.

[Bawolff](/p/Bawolff/) added a comment.[Sep 28 2014, 8:33 PM2014-09-28 20:33:19 (UTC+0)](#750323)Comment Actions

This is also exploitable (I believe, have not tested) on wikis with a non-variant language as content language (e.g. a normal english wiki), if one can set the page language for a page to be a language with variants. This includes:

* If $wgPageLanguageUseDB is set to true (Its false by default, I don't think anyone is currently using it)
* If translate extension is installed (e.g. Commons, meta).
* People can also do the same thing with pages like MediaWiki:Foo/zh, however only admins can edit those, so not big deal.
[• csteipp](/p/csteipp/) added a comment.[Oct 6 2014, 11:19 PM2014-10-06 23:19:42 (UTC+0)](#750330)Comment Actions

Thanks Bawolff! Confirmed it's exploitable, although I'm still trying to figure out exactly how that's working. Adding Niklas in case we can address this on the translation side.

[Bawolff](/p/Bawolff/) added a comment.[Oct 7 2014, 1:43 AM2014-10-07 01:43:38 (UTC+0)](#750347)Comment Actions

(In reply to Chris Steipp from comment #3)

> Thanks Bawolff! Confirmed it's exploitable, although I'm still trying to
>
> figure out exactly how that's working. Adding Niklas in case we can address
>
> this on the translation side.

Its in the code part, not the conversion tables, so not affected by what the translators do (Of course i18n devs are probably familiar with this area of the code). AFAIK the people who know most about this area of the code base and are still active are Liangent and CScott.

---

I probably should have explained a little better how it works:

* Language converter is a feature to convert different writing systems (e.g. Serbian written in Latin, vs serbian written in Cyrillic, traditional Chinese vs simplified Chinese). It more or less works by doing find and replace for various letters or strings.
* In addition to the general pre-defined find and replace strings, users can define their own replacements for a specific page (So in essence it works much like a macro system)
* Replacements are done after all the HTML sanitization takes place (!!) pretty much at the very end of the parsing process.

\*The language converter, in LanguageConverter::autoConvert has a bunch of regexes to exclude HTML tags from being converted, to basically stop people from doing this. Specifically /<[^>]+>/ (plus some other stuff in an alternation)

\*However if you have an html tag like <div class=">"> (Which is allowed in html5, > does not have to be escaped if its inside an attribute enclosed in quotes), the regex will stop two characters short and allow you to do lang converter substitutions on stuff after the first >. Thus the challenge becomes making MW insert a tag with an attribute that has a non escaped > in the attribute.

\*There are multiple ways html is escaped in MediaWiki. Most stuff from wikitext goes through the sanitizer class, which uses &gt; in the attribute for >. Html::element/Html::rawElement tries to be cool about avoiding unnecessary escapes (To save a miniscule amount of bytes I suppose). Thus Html::element can be used to insert such a tag.

\*Very few things controllable from wikitext (or otherwise by the user) use Html::escape as an escaping method, the first one I found was the input box on the Special:Contribution special page. I imagine there are others, probably in extension parser tags, and other transcludable special pages. Lots of transcludable special pages have <input type="hidden" ... > elements that have a controllable value from the user and escaped by Html::element, however I couldn't immediately see a way to execute javascript automatically from an extra attribute on a hidden input, so I went with the text input which has obvious event handler attributes. I imagine there's probably some ingenious way to do the same thing to the hidden form tags.

p.s. Forgot to mention in original comment, languages that are affected: 'gan', 'iu','kk','ku','shi','sr','tg', 'uz', 'zh'. And any wiki where that is the content language or the user can set the page language of a specific page (other than Special pages) to one of those languages (eg a wiki with Translate extension) is vulnerable.

[• csteipp](/p/csteipp/) added a comment.[Oct 9 2014, 11:33 PM2014-10-09 23:33:38 (UTC+0)](#750369)Comment Actions

Created attachment 16738

Match html elements with > in attribute

Thanks Brian! I wouldn't mind encoding > in Html::expandAttributes too, but I'm worried that if we depend on the escaping there only, this could come up in other places. I think LanguageConverter also needs to be updated to (more) correctly try and parse the text it's working on and do sane things there. So here's a patch to do that. I'd probably feel more comfortable with just updating the LanguageConverter regex as a security fix, and then do the expandAttributes change publicly as a hardening.

It looks like LanguageConverterTest.php doesn't exercise the conversions, so it's hard to know if the old regex was being abused for some functionality. But this patch stops the xss for me, and appears to allow the rest of the conversion correctly. I'll add liangent and cscott to get their opinions.

*attachment bug71394-converter.patch ignored as obsolete*

[• csteipp](/p/csteipp/) added a comment.[Oct 9 2014, 11:40 PM2014-10-09 23:40:41 (UTC+0)](#750375)Comment Actions

Liangent / CScott, it would be great if you could take a look and see if this is sane.

[Bawolff](/p/Bawolff/) added a comment.[Oct 10 2014, 4:07 AM2014-10-10 04:07:46 (UTC+0)](#750385)Comment Actions

(In reply to Chris Steipp from comment #5)

> Created attachment 16738 [details]
>
> Match html elements with > in attribute
>
> Thanks Brian! I wouldn't mind encoding > in Html::expandAttributes too, but
>
> I'm worried that if we depend on the escaping there only, this could come up
>
> in other places.

Yes definitely.

Would the couple lines above ($htmlfix variable), that catch unclosed html elements also have to be changed? I'll admit, I'm unclear under what circumstances that part of the regex would come into play.

---

One possible edge case that might be needed to be considered where attachment 16738 would not work, is if someone could insert:

<div title=dog's>foo</div>

into a page. Of course, one could quite convincingly argue that if anything inserted something like that, its already pretty broken (And definitely in violation of the HTML5 spec), however, firefox (or at least the version I tested on) does interpret the title attribute as actually being dog's for that html snippet. So not sure if we should care about that.

> It looks like LanguageConverterTest.php doesn't exercise the conversions, so
>
> it's hard to know if the old regex was being abused for some functionality.
>
> But this patch stops the xss for me, and appears to allow the rest of the
>
> conversion correctly. I'll add liangent and cscott to get their opinions.

I don't think lang converter was being abused in a way that would be stopped by this (And if anyone does, I think its an unreasonable use of the feature). I believe most of the lang converter tests are in tests/parser/parserTests.txt

*attachment bug71394-converter.patch ignored as obsolete*

[• csteipp](/p/csteipp/) added a comment.[Oct 10 2014, 8:29 PM2014-10-10 20:29:37 (UTC+0)](#750401)Comment Actions

(In reply to Bawolff (Brian Wolff) from comment #7)

> Would the couple lines above ($htmlfix variable), that catch unclosed html
>
> elements also have to be changed? I'll admit, I'm unclear under what
>
> circumstances that part of the regex would come into play.

That comes into play when the an html element is started but not closed in the part being autoconverted. I haven't worked out exactly how the wikitext is cut up and sent to the autoconvert function, but it appears to get sent in chunks. Although I haven't been able to find any wikitext that manages to send unclosed html elements to it.

> One possible edge case that might be needed to be considered where
>
> attachment 16738 [details] would not work, is if someone could insert:
>
> <div title=dog's>foo</div>

That is indeed a problem, although even when $wgWellFormedXml is false, we would flag the ' as a blacklisted char if it went through Html::expandAttributes, so it would be title="dog's". But again, looking at the cases where it doesn't go through expandAttributes, I probably should add an extra condition that also matches the naive pattern to catch that.

> into a page. Of course, one could quite convincingly argue that if anything
>
> inserted something like that, its already pretty broken (And definitely in
>
> violation of the HTML5 spec), however, firefox (or at least the version I
>
> tested on) does interpret the title attribute as actually being dog's for
>
> that html snippet. So not sure if we should care about that.
>
> > It looks like LanguageConverterTest.php doesn't exercise the conversions, so
> >
> > it's hard to know if the old regex was being abused for some functionality.
> >
> > But this patch stops the xss for me, and appears to allow the rest of the
> >
> > conversion correctly. I'll add liangent and cscott to get their opinions.
>
> I don't think lang converter was being abused in a way that would be stopped
>
> by this (And if anyone does, I think its an unreasonable use of the
>
> feature). I believe most of the lang converter tests are in
>
> tests/parser/parserTests.txt

[• csteipp](/p/csteipp/) added a comment.[Oct 10 2014, 8:33 PM2014-10-10 20:33:25 (UTC+0)](#750407)Comment Actions

Created attachment 16744

Add matching html elements with > in attribute

This patch adds back in the naive matching (<[^>]+>) at the end of the regex, which, in my testing, handles both.

<div title=foo'bar> and <div title="foo>bar">

This assumes that the |'ed conditions of the regex are evaluated left to right, but I need to verify that we can assume that.

*attachment bug71394-converterb.patch ignored as obsolete*

[cscott](/p/cscott/) added a comment.[Oct 23 2014, 10:43 PM2014-10-23 22:43:36 (UTC+0)](#750420)Comment Actions

I'm suspicious of the approach in chris' patch, I think you'll need something more (haven't yet reviewed bawolff's patch). There are a number of parsing issues in the regexps, for example:

<pre foo="></pre>">

escapes the $prefix match, so:

-{H|abc123=>zh-cn:" onfocus="alert('be evil');}-

<pre foo="></pre>" abc123></pre>

would exploit that, using the same Html::escape trick to get that attribute value past the sanitizer.

A more robust regexp for matching attributes (based on the spec, at <http://dev.w3.org/html5/spec-preview/tokenization.html>) is:

<https://github.com/fgnass/domino/blob/master/lib/HTMLParser.js#L1458>

but I'm not sure I've got high confidence this approach will catch all possible cases. I need to think hard about this.

[cscott](/p/cscott/) added a comment.[Oct 23 2014, 10:48 PM2014-10-23 22:48:32 (UTC+0)](#750425)Comment Actions

Ok, I've read bawolff's patch. I think I like that approach better than trying to fix language converter here, although I would tweak his comment in the source to say something like,

"it's important to escape < >, even if it's not required in this context, to allow other bits of code (for example Language Converter) to use naive algorithms to extract tags"

[cscott](/p/cscott/) added a comment.[Oct 23 2014, 11:01 PM2014-10-23 23:01:20 (UTC+0)](#750439)Comment Actions

To be concrete about the <pre> problem above, the issue is that Html::escape doesn't encode the "<". So to exploit the bad <pre> regexp in language converter, we just need to sneak a < into an attribute value. The vulnerable code in Special:Contributions which bawolff used to exploit the bad attribute-parsing regexp was:

```
		$input = Html::input(
			'target',
			$this->opts['target'],
                        ...
```

So to exploit the bad <pre>-parsing regexp we'd be looking for:

```
$pre = Html::pre( 'anyattribute', $userinput, .... )
```

or

```
$code = Html::code( 'anyattribute', $userinput, .... )
```

since the <code> regexp has the same problem (as does the <script> regexp).

The HTML parsing spec is complex. Until we can move LanguageConverter higher in the parsing stack and get it in front of the sanitizer, we should probably be very conservative in how we allow > to reach the output.

[cscott](/p/cscott/) added a comment.[Oct 23 2014, 11:22 PM2014-10-23 23:22:40 (UTC+0)](#750444)Comment Actions

csteipp: So naively, $prefix = '<pre(?:"[^"]\*"[\'"]\*|\'[^\']\*\'[\'"]\*|[^\'">])\*>.\*?<\/pre>|';

cscott: i'm reading the spec to double check

cscott: i'd simplify that to $prefix = '<pre(?:"[^"]\*"|\'[^\']\*\'|[^\'">])\*>.\*?<\/pre>|';

cscott: that is, you don't need the [^'"] at the end of each quoted string

cscott: but the weird case you haven't covered is <pre foo=bar's>

cscott: i can confirm that once you've entered the "Attribute value (double-quoted) state" the only thing that will bail you out is a double quote, and similarly for single-quoted/single-quote

cscott: but not every double/single quote will get you into the attribute value state

cscott: in particular, single and double quotes when you are in the "attribute value (unquoted) state" are just appended to the attribute value.

cscott: i think the right solution is to be hyper conservative and bail out on language converter entirely if you see strange stuff

cscott: i think merging bawolff's patch is a good first step, followed by auditing anything which does any other "interesting" html escape. belt and suspenders.

cscott: i think we can do better with the language converter regexp, but i think the solution is going to be something like <[a-z]+((\s+[a-z]+="[^"]")\*>|.\*)

cscott: that is, just match to the end of the current string and protect all the rest of the input from language converter if you see something in the tag that doesn't look "right".

[• csteipp](/p/csteipp/) added a comment.[Oct 24 2014, 1:07 AM2014-10-24 01:07:35 (UTC+0)](#750461)Comment Actions
> cscott: i'd simplify that to $prefix =
>
> '<pre(?:"[^"]\*"|\'[^\']\*\'|[^\'">])\*>.\*?<\/pre>|';

done.

I also realized we have a more generalized problem in that " is a valid attribute name, so <div "=">"></div> or <pre "=">">foo</pre> should be matched too.

> cscott: i think merging bawolff's patch is a good first step, followed by
>
> auditing anything which does any other "interesting" html escape. belt and
>
> suspenders.

I definitely now think we want to include bawolff's patch as part of the security fix. There's too many things that can go wrong without it.

> cscott: i think we can do better with the language converter regexp, but i
>
> think the solution is going to be something like
>
> <[a-z]+((\s+[a-z]+="[^"]")\*>|.\*)
>
> cscott: that is, just match to the end of the current string and protect all
>
> the rest of the input from language converter if you see something in the
>
> tag that doesn't look "right".

I'm not sure I fully understand what you're thinking here, I'll ping you on irc and hopefully get a better idea.

[cscott](/p/cscott/) added a comment.[Oct 24 2014, 2:02 AM2014-10-24 02:02:46 (UTC+0)](#750474)Comment Actions

Basically instead of trying to match all possible valid uses of quotes, angle brackets, etc, try to match the common not-crazy patterns -- and then include a fail-safe .\* alternate at the end so if we're not certain where the close-tag is, fail-safe and protect the entire remainder of the string from language converter.

Relies on left-to-right evaluation of alternates, which is indeed how PCRE works (<http://php.net/manual/en/regexp.reference.alternation.php>).

Consider my simple version (assume 'is' regexp flags):

<(/?[a-z]+(\s+[a-z]+="[^"]")\*\s\*>|.\*)

Given the input:

abc<pre>foo</pre>x<div class="foo" style="bar">bat</div>y<pre evil'ness="'">abc123</pre>

It will match as follows:

<pre> (sending 'abc' off to be language converted)

</pre> (sending 'foo' off to be language converted)

<div class="foo" style="bar"> (sending 'x' off to be language converted)

</div> (sending 'bat' off to be language converted)

<pre evil'ness="'">abc123</pre> (sending 'y' off to be language converted)

and we're done. Note that the final <pre> tag didn't match how we expected our attributes to look, and so to be safe we just matched from there to the end of the string and didn't language convert anything in that potentially-dangerous region (since we couldn't trust our simple regex to find the correct end of the tag when things get weird).

[liangent](/p/liangent/) added a comment.[Oct 24 2014, 9:33 AM2014-10-24 09:33:10 (UTC+0)](#750483)Comment Actions

(In reply to C. Scott Ananian from comment #15)

> <pre evil'ness="'">abc123</pre> (sending 'y' off to be language converted)

Just a reminder that <pre evil'ness="'">abc123</pre> will be processed further (// Translate any alt or title attributes inside the matched element) by Language Converter and that part of code also uses delimiter ">".

[• csteipp](/p/csteipp/) added a comment.[Oct 28 2014, 7:23 PM2014-10-28 19:23:51 (UTC+0)](#750487)Comment Actions

Created attachment 16932

Matching html elements with > in attribute, etc.

*attachment bug71394-converterc.patch ignored as obsolete*

[• csteipp](/p/csteipp/) added a comment.[Oct 28 2014, 9:15 PM2014-10-28 21:15:42 (UTC+0)](#750500)Comment Actions

(In reply to Chris Steipp from comment #14)

> > cscott: i'd simplify that to $prefix =
> >
> > '<pre(?:"[^"]\*"|\'[^\']\*\'|[^\'">])\*>.\*?<\/pre>|';
>
> done.

I realized this is actually wrong. We want to aggressively match anything that looks like it's in <pre> tags (ditto <code> or <script>), to prevent that from being translated.

(In reply to C. Scott Ananian from comment #15)

> Consider my simple version (assume 'is' regexp flags):
>
> <(/?[a-z]+(\s+[a-z]+="[^"]")\*\s\*>|.\*)

I want with

<(\/?[a-zA-Z]+(\s+[a-zA-Z]+\s\*=("[^"]\*"|\'[^\']\*\'|[^\'">]\*))\*\s\*>|.\*)

So that catch attributes with > in their value, or if the element has an attribute name that contains a ", we just match the rest of the string, since there isn't a regex that can actually parse according to the spec (I wouldn't mind seeing us implement an actual html parser and using that for cases like this, but that's a much larger project).

This should make the first part of $htmlfix redundant, but I left it in case.

I haven't found a good way to write tests for this fix-- I haven't found any simple wikitext to get a > in the attribute value for parserTests.txt.

(In reply to Liangent from comment #16)

> Just a reminder that <pre evil'ness="'">abc123</pre> will be processed
>
> further (// Translate any alt or title attributes inside the matched
>
> element) by Language Converter and that part of code also uses delimiter ">".

The regex on line 406 can stay unchanged. If we have something like <img class=">foo" title="something-to-translate", then the title won't be converted, even though it's technically harmless for us to do that.

The regex on line 421 is in case the conversion has injected html into the title or alt attribute values, then it's supposed to be stripped out. With bawolff's patch to expandAttributes, then this is going to be run through Sanitizer::encodeAttribute again, so it shouldn't affect the layout.

[cscott](/p/cscott/) added a comment.[Oct 28 2014, 9:39 PM2014-10-28 21:39:29 (UTC+0)](#750515)Comment Actions

Chris: I think your regexp isn't quite right for the "unquoted attribute" case -- it includes whitespace in the unquoted attribute, which isn't right. Does the sanitizer ever emit unquoted attributes? I'd just leave the unquoted attribute case out if possible, or match only [a-z]\* with it to be safe. (I could probably read the spec and come up with a more precise regexp for "things that are safe to include in an unquoted attribute -- but I'd rather just skip that case entirely if we expect attributes to be quoted.)

[• csteipp](/p/csteipp/) added a comment.[Oct 28 2014, 11:36 PM2014-10-28 23:36:00 (UTC+0)](#750519)Comment Actions

Created attachment 16937

Matching html elements with > in attribute, etc.

It shouldn't make a difference if the subpattern match stops at the whitespace, or if it continues until just before the = in the next attribute, but it might be more efficient, so I updated it. I also made it explicit we're not capturing any of the subpatterns.

Also, <http://dev.w3.org/html5/spec-preview/tokenization.html#attribute-name-state> has the "Anything else" section in the parsing, so we should account for attribute names that aren't just a-z. We could use Sanitizer::getAttribsRegex'es logic ($attrib = '[:A-Z\_a-z-.0-9]';), but I'd rather target the spec.

I also realized the last patch neglected boolean attributes, so tags with those would cause the whole string to be matched.

*attachment bug71394-converterd.patch ignored as obsolete*

[Nikerabbit](/p/Nikerabbit/) added a comment.[Oct 29 2014, 6:10 PM2014-10-29 18:10:12 (UTC+0)](#750522)Comment Actions

I was told that feedback from LangEng team was requested. Unfortunately, the language converter is not a thing we have worked on. We do not have enough experience to comment whether the proposed patch might cause issues.

[cscott](/p/cscott/) added a comment.[Oct 29 2014, 7:10 PM2014-10-29 19:10:06 (UTC+0)](#750530)Comment Actions

Chris: I'm still concerned that your character classes match too much, especially your attribute name match. And you're not allowing whitespace after an equals side currently.

My point in comment 15 was that we \*shouldn't\* try to match the spec exactly -- the full parser spec has all sorts of crazy corner cases. In order to have maintainable security here we should instead try to be \*as conservative as possible\* in terms of what we match. Let's only broaden character classes as little as possible to match what we expect the sanitizer to emit, instead of risking bugs (and future maintainability issues) adding extra unnecessary clauses to the regexp.

I think using Sanitizer::getAttribsRegex's value is very reasonable for an attribute name pattern.

And I'd like to see the boolean attribute handled via using a (\s=\s+...)? type of regexp, rather than repeating the attribute name regexp at the end. Basically I'm trying to nail down the hatches here and try to ensure that we don't get weird mismatches creeping in here in the future, since this code turns out to be security-critical.

[• csteipp](/p/csteipp/) added a comment.[Oct 29 2014, 11:51 PM2014-10-29 23:51:50 (UTC+0)](#750553)Comment Actions

(In reply to C. Scott Ananian from comment #22)

> Chris: I'm still concerned that your character classes match too much,
>
> especially your attribute name match. And you're not allowing whitespace
>
> after an equals side currently.

{{done}}

> My point in comment 15 was that we \*shouldn't\* try to match the spec exactly
>
> * the full parser spec has all sorts of crazy corner cases. In order to
>
> have maintainable security here we should instead try to be \*as conservative
>
> as possible\* in terms of what we match. Let's only broaden character
>
> classes as little as possible to match what we expect the sanitizer to emit,
>
> instead of risking bugs (and future maintainability issues) adding extra
>
> unnecessary clauses to the regexp.

Yeah, I was trying to be broad in what we match in the general html part, instead of just letting the fallback .\* handle it. I agree, just matching the rest of the string is probably safer.

I'll leave some comments too so if someone tries to "fix" conversions not showing up they'll hopefully do the right thing as well.

> I think using Sanitizer::getAttribsRegex's value is very reasonable for an
>
> attribute name pattern.

{{done}}

> And I'd like to see the boolean attribute handled via using a (\s=\s+...)?
>
> type of regexp, rather than repeating the attribute name regexp at the end.
>
> Basically I'm trying to nail down the hatches here and try to ensure that we
>
> don't get weird mismatches creeping in here in the future, since this code
>
> turns out to be security-critical.

{{done}}

I also didn't account for self-closing tags, which the sanitizer will emit. So that has the main html matching as:

<(?:\/?[A-Za-z]+(?:\s+[:A-Z\_a-z-.0-9]+(\s\*=\s\*(?:"[^"]\*"|\'[^\']\*\'|[^\'">\s]\*))\*)\*\s\*\/?>|.\*)

I ran that over the source of enwiki and zhwikisource, and it seems to parse everything except comments and CDATA. I'm not sure if we should try to match those.

I also realized we don't match the content of style tags. I think that's something we want to prevent conversion in. Hopefully no one is adjusting their styles based on language variant.

[• csteipp](/p/csteipp/) added a comment.[Oct 29 2014, 11:59 PM2014-10-29 23:59:14 (UTC+0)](#750565)Comment Actions

Created attachment 16951

Matching html elements with > in attribute, etc.

*attachment bug71394-convertere.patch ignored as obsolete*

[tstarling](/p/tstarling/) added a comment.[Nov 4 2014, 12:00 AM2014-11-04 00:00:13 (UTC+0)](#750573)Comment Actions

Nested subpattern repetition is a pretty common example of a regex with pathological performance characteristics, and this patch runs such a regex on the whole document. I wonder if you benchmarked it or tested it for backtrack limit exhaustion?

[tstarling](/p/tstarling/) added a comment.[Nov 4 2014, 1:15 AM2014-11-04 01:15:27 (UTC+0)](#750588)Comment Actions

preg\_match() silently returns false on limit exhaustion, which causes the proposed patch to pass the whole string through. So it's a security issue, not just a performance issue. Example:

ini\_set('pcre.recursion\_limit', 1000);

$s = '-{H|abc123=>zh-cn:" autofocus onfocus="alert(\'be evil\');}- <div ';

for ( $i = 0; $i < 10000; $i++ ) {

```
$s .= "data-$i='x' ";
```

}

$s.= '> {{Special:Contributions|target=>abc123}}';

$out = $wgParser->parse($s, Title::newMainPage(), new ParserOptions);

This test segfaults with pcre.recursion\_limit set to the default, but with it set to 1000 as on WMF, it is an XSS vulnerability.

[• csteipp](/p/csteipp/) added a comment.[Nov 7 2014, 12:28 AM2014-11-07 00:28:55 (UTC+0)](#750595)Comment Actions

Created attachment 17067

Properly remove html from conversion text

After Tim's comments on this bug, we chatted on irc, and he recommended handling as much of the parsing in php as possible, to avoid the pcre limitation.

Since there are html5 parsers in php already available, I modified one to do just the parsing we need, and use that. It would be fairly easy to use this in some of the other places we try to parse html with a regex too.

Running Tim's test against master and this patch, this patch is about 5% faster on my dev system.

**Attached**: bug71394-tokenizer.patch53 KB[Download](https://phab.wmfusercontent.org/file/download/3cf7rer3ofpvepj6ysp2/PHID-FILE-m2hibce2xowurpwshnjx/bug71394-tokenizer.patch)

[tstarling](/p/tstarling/) added a comment.[Nov 12 2014, 3:20 AM2014-11-12 03:20:43 (UTC+0)](#750610)Comment Actions

It's quite a big patch to review in public. Could we maybe do Bawolff's patch in the security release and then put the Html5Tokenizer in Gerrit?

[tstarling](/p/tstarling/) added a comment.[Nov 12 2014, 3:21 AM2014-11-12 03:21:17 (UTC+0)](#750617)Comment Actions

A big patch to review in private, rather.

[• csteipp](/p/csteipp/) added a comment.[Nov 13 2014, 9:22 PM2014-11-13 21:22:22 (UTC+0)](#750629)Comment Actions

I deployed bawolff's patch today:

20:19 csteipp: patched bugs 71111 and 71394 in wmf7 and wmf8

I put the Html5Tokenizer as a draft in gerrit. I didn't want to make it fully public until we either are ready to merge it, or we release bawolff's patch, in case someone digs into why I would be rewriting that. Comments there welcome.

[cscott](/p/cscott/) added a comment.[Nov 13 2014, 10:50 PM2014-11-13 22:50:25 (UTC+0)](#750636)Comment Actions

Chris -- what's the latest version of your regular expression. I just recently fixed a performance regression in a regexp (<https://gist.github.com/gruber/249502#comment-1328838> sigh), perhaps I can refactor a bit to get rid of the backtracking.

[• csteipp](/p/csteipp/) added a comment.[Nov 14 2014, 12:26 AM2014-11-14 00:26:34 (UTC+0)](#750646)Comment Actions

cscott:

$reg = '/' . $codefix . $scriptfix . $stylefix . $prefix .

'<(?:\/?[A-Za-z]+(?:\s+[:A-Z\_a-z-.0-9]+(\s\*=\s\*(?:"[^"]\*"|\'[^\']\*\'|[^\'">\s]\*))\*)\*\s\*\/?>|.\*)|' .

'&[a-zA-Z#][a-z0-9]+;' . $marker . $htmlfix . '/s';

[• csteipp](/p/csteipp/) added a project: [acl\*security](/tag/acl_security/).[Nov 24 2014, 9:27 PM2014-11-24 21:27:42 (UTC+0)](#782084)Restricted Application changed the visibility from "[acl\*security](/tag/acl_security/) (Project)" to "[Custom Policy](/transactions/new/PHID-XACT-TASK-aee2suq7qel72hp/)".  · [View Herald Transcript](/herald/transcript/420969/)[Nov 24 2014, 9:27 PM2014-11-24 21:27:42 (UTC+0)](#782085)Restricted Application changed the edit policy from "[acl\*security](/tag/acl_security/) (Project)" to "[Custom Policy](/transactions/new/PHID-XACT-TASK-xcrlbwa6e6qx4jo/)".  · [View Herald Transcript](/herald/transcript/420969/)[• csteipp](/p/csteipp/) changed the visibility from "[Custom Policy](/transactions/old/PHID-XACT-TASK-5dnnlsjzqyhmsxp/)" to "[Custom Policy](/transactions/new/PHID-XACT-TASK-5dnnlsjzqyhmsxp/)".[Nov 26 2014, 5:56 AM2014-11-26 05:56:31 (UTC+0)](#787302)[• csteipp](/p/csteipp/) added a subscriber: [Grunny](/p/Grunny/).Restricted Application changed the visibility from "[Custom Policy](/transactions/old/PHID-XACT-TASK-reak6lrgv35xydc/)" to "[Custom Policy](/transactions/new/PHID-XACT-TASK-reak6lrgv35xydc/)".  · [View Herald Transcript](/herald/transcript/423798/)[Nov 26 2014, 5:56 AM2014-11-26 05:56:31 (UTC+0)](#787303)Restricted Application changed the edit policy from "[Custom Policy](/transactions/old/PHID-XACT-TASK-pjguaa7qjzoup4t/)" to "[Custom Policy](/transactions/new/PHID-XACT-TASK-pjguaa7qjzoup4t/)".  · [View Herald Transcript](/herald/transcript/423798/)[• csteipp](/p/csteipp/) changed Security from Software security bug to None.[Nov 26 2014, 6:09 AM2014-11-26 06:09:24 (UTC+0)](#787328)[• csteipp](/p/csteipp/) changed the visibility from "[Custom Policy](/transactions/old/PHID-XACT-TASK-uuki7cexi5vvojh/)" to "[Custom Policy](/transactions/new/PHID-XACT-TASK-uuki7cexi5vvojh/)".[Nov 26 2014, 6:23 AM2014-11-26 06:23:27 (UTC+0)](#787335)[Mglaser](/p/Mglaser/) added a comment.[Nov 26 2014, 1:24 PM2014-11-26 13:24:12 (UTC+0)](#787998)Comment Actions

Here are the backports for older release branches. It would be great if anyone could confirm them today before I do the release

bug71394-REL1\_24\_REL1\_23\_REL1\_22.patch1 KB[Download](https://phab.wmfusercontent.org/file/download/nju33356q2t5xlplpzs6/PHID-FILE-mzegb4l5xhbv4eio5fte/bug71394-REL1_24_REL1_23_REL1_22.patch)

bug71394-REL1\_19.patch1 KB[Download](https://phab.wmfusercontent.org/file/download/d2wqg76hebpjehz4bp7s/PHID-FILE-vjwqymdol2djm5ufp7zb/bug71394-REL1_19.patch)

[• csteipp](/p/csteipp/) changed the visibility from "[Custom Policy](/transactions/old/PHID-XACT-TASK-dmxmugziuhtpech/)" to "[Custom Policy](/transactions/new/PHID-XACT-TASK-dmxmugziuhtpech/)".[Nov 26 2014, 6:12 PM2014-11-26 18:12:25 (UTC+0)](#788796)[• csteipp](/p/csteipp/) added a subscriber: [ProgramCeltic](/p/ProgramCeltic/).[Mglaser](/p/Mglaser/) added a comment.[Nov 26 2014, 10:16 PM2014-11-26 22:16:48 (UTC+0)](#789507)Comment Actions

Tested this by calling a few pages, as they all use HTML class in generating their output. On REL1\_24, REL1\_23, REL1\_22 and REL1\_19

[• csteipp](/p/csteipp/) added a comment.[Nov 26 2014, 10:53 PM2014-11-26 22:53:52 (UTC+0)](#789633)Comment Actions
> In [T73394#787998](/T73394#787998), [@Mglaser](/p/Mglaser/) wrote:
>
> Here are the backports for older release branches. It would be great if anyone could confirm them today before I do the release
>
> bug71394-REL1\_24\_REL1\_23\_REL1\_22.patch1 KB[Download](https://phab.wmfusercontent.org/file/download/nju33356q2t5xlplpzs6/PHID-FILE-mzegb4l5xhbv4eio5fte/bug71394-REL1_24_REL1_23_REL1_22.patch)

Issue is fixed with this patch

[• csteipp](/p/csteipp/) added a comment.[Nov 27 2014, 1:23 AM2014-11-27 01:23:52 (UTC+0)](#790270)Comment Actions

I believe Markus is pulling this patch from the release, since it failed some of the unit tests. It would be difficult to get from that patch to an exploit, so I'm not too worried about it, although I'm leaving WMF servers patched. In practicality, the patch doesn't seem to have broken anything.

I thought I had run his patch through all of the unit tests when working on LanguageConverter, but I guess not. Apologies for that.

Of the tests that fail,

* "External link containing a single quote" looked wrong, but chrome and firefox handle it just fine. And the html 5 spec should parse it correctly. [@cscott](/p/cscott/), can you comment on this one?
* "Running test Header with special characters" the test is specifically for what we're trying to do, but looking at the bug and <https://test.wikipedia.org/wiki/Header_with_special_characters> I'm not seeing the issue that the original bug (25462) specified. Was this fixed already by the move to html5? The new values that we generate should be equivalent when this is parsed.

For the rest, the new value is equivalent in html5. Anyone aware of a reason we can't update them?

The failing parser tests are:

Running test External link containing a single quote. (bug 63947)... FAILED!

--- /tmp/mwParser-2129676043-expected 2014-11-26 16:45:26.445386114 -0800

+++ /tmp/mwParser-2129676043-actual 2014-11-26 16:45:26.445386114 -0800

@@ -1,3 +1,3 @@

-<p><a rel="nofollow" class="external autonumber" href="//foo.org/bar'baz">[1]</a>

-</p><p><a rel="nofollow" class="external text" href="//foo.org/bar'baz">bang</a>

+<p><a rel="nofollow" class="external autonumber" href="//foo.org/bar&#39;baz">[1]</a>

+</p><p><a rel="nofollow" class="external text" href="//foo.org/bar&#39;baz">bang</a>

 </p>

Running test Link containing double-single-quotes '' (bug 4598)... FAILED!

--- /tmp/mwParser-1070742882-expected 2014-11-26 16:45:27.336386162 -0800

+++ /tmp/mwParser-1070742882-actual 2014-11-26 16:45:27.336386162 -0800

@@ -1,2 +1,2 @@

-<p><a href="/index.php?title=Lista\_d%27%27e\_paise\_d%27%27o\_munno&amp;action=edit&amp;redlink=1" class="new" title="Lista d''e paise d''o munno (page does not exist)">Lista d''e paise d''o munno</a>

+<p><a href="/index.php?title=Lista\_d%27%27e\_paise\_d%27%27o\_munno&amp;action=edit&amp;redlink=1" class="new" title="Lista d&#39;&#39;e paise d&#39;&#39;o munno (page does not exist)">Lista d''e paise d''o munno</a>

 </p>

Running test Link with double quotes in title part (literal) and alternate part (interpreted)... FAILED!

--- /tmp/mwParser-2035047627-expected 2014-11-26 16:45:27.390386165 -0800

+++ /tmp/mwParser-2035047627-actual 2014-11-26 16:45:27.390386165 -0800

@@ -1,5 +1,5 @@

 <p><a href="/index.php?title=Special:Upload&amp;wpDestFile=Denys\_Savchenko\_%27%27Pentecoste%27%27.jpg" class="new" title="File:Denys Savchenko &#39;&#39;Pentecoste&#39;&#39;.jpg">File:Denys Savchenko <i>Pentecoste</i>.jpg</a>

-</p><p><a href="/index.php?title=%27%27Pentecoste%27%27&amp;action=edit&amp;redlink=1" class="new" title="''Pentecoste'' (page does not exist)">''Pentecoste''</a>

-</p><p><a href="/index.php?title=%27%27Pentecoste%27%27&amp;action=edit&amp;redlink=1" class="new" title="''Pentecoste'' (page does not exist)">Pentecoste</a>

-</p><p><a href="/index.php?title=%27%27Pentecoste%27%27&amp;action=edit&amp;redlink=1" class="new" title="''Pentecoste'' (page does not exist)"><i>Pentecoste</i></a>

+</p><p><a href="/index.php?title=%27%27Pentecoste%27%27&amp;action=edit&amp;redlink=1" class="new" title="&#39;&#39;Pentecoste&#39;&#39; (page does not exist)">''Pentecoste''</a>

+</p><p><a href="/index.php?title=%27%27Pentecoste%27%27&amp;action=edit&amp;redlink=1" class="new" title="&#39;&#39;Pentecoste&#39;&#39; (page does not exist)">Pentecoste</a>

+</p><p><a href="/index.php?title=%27%27Pentecoste%27%27&amp;action=edit&amp;redlink=1" class="new" title="&#39;&#39;Pentecoste&#39;&#39; (page does not exist)"><i>Pentecoste</i></a>

 </p>

Running test Internal link with kaa linktrail with apostrophes (bug 27473)... FAILED!

--- /tmp/mwParser-1736818691-expected 2014-11-26 16:45:28.650386234 -0800

+++ /tmp/mwParser-1736818691-actual 2014-11-26 16:45:28.650386234 -0800

@@ -1,2 +1,2 @@

-<p><a href="/index.php?title=Something&amp;action=edit&amp;redlink=1" class="new" title="Something (bet ele jaratılmag'an)">Something'nice</a>

+<p><a href="/index.php?title=Something&amp;action=edit&amp;redlink=1" class="new" title="Something (bet ele jaratılmag&#39;an)">Something'nice</a>

 </p>

Running test Link to category... FAILED!

--- /tmp/mwParser-259593883-expected 2014-11-26 16:45:38.598386773 -0800

+++ /tmp/mwParser-259593883-actual 2014-11-26 16:45:38.598386773 -0800

@@ -1,2 +1,2 @@

-<p><a href="/wiki/Category:MediaWiki\_User%27s\_Guide" title="Category:MediaWiki User's Guide">Category:MediaWiki User's Guide</a>

+<p><a href="/wiki/Category:MediaWiki\_User%27s\_Guide" title="Category:MediaWiki User&#39;s Guide">Category:MediaWiki User's Guide</a>

 </p>

Running test Category with different sort key... FAILED!

--- /tmp/mwParser-1819840247-expected 2014-11-26 16:45:38.686386778 -0800

+++ /tmp/mwParser-1819840247-actual 2014-11-26 16:45:38.686386778 -0800

@@ -1 +1 @@

-<a href="/wiki/Category:MediaWiki\_User%27s\_Guide" title="Category:MediaWiki User's Guide">MediaWiki User's Guide</a>

+<a href="/wiki/Category:MediaWiki\_User%27s\_Guide" title="Category:MediaWiki User&#039;s Guide">MediaWiki User's Guide</a>

Running test Category with identical sort key... FAILED!

--- /tmp/mwParser-25929600-expected 2014-11-26 16:45:38.725386780 -0800

+++ /tmp/mwParser-25929600-actual 2014-11-26 16:45:38.725386780 -0800

@@ -1 +1 @@

-<a href="/wiki/Category:MediaWiki\_User%27s\_Guide" title="Category:MediaWiki User's Guide">MediaWiki User's Guide</a>

+<a href="/wiki/Category:MediaWiki\_User%27s\_Guide" title="Category:MediaWiki User&#039;s Guide">MediaWiki User's Guide</a>

Running test Header with special characters (bug 25462)... FAILED!

--- /tmp/mwParser-616350119-expected 2014-11-26 16:45:39.143386802 -0800

+++ /tmp/mwParser-616350119-actual 2014-11-26 16:45:39.143386802 -0800

@@ -10,7 +10,7 @@

 </ul>

 </div>

-<h2><span class="mw-headline" id="text\_.3E\_text">text &gt; text</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="/index.php?title=Parser\_test&amp;action=edit&amp;section=1" title="Edit section: text > text">edit</a><span class="mw-editsection-bracket">]</span></span></h2>

+<h2><span class="mw-headline" id="text\_.3E\_text">text &gt; text</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="/index.php?title=Parser\_test&amp;action=edit&amp;section=1" title="Edit section: text &gt; text">edit</a><span class="mw-editsection-bracket">]</span></span></h2>

 <p>section 1

 </p>

 <h2><span class="mw-headline" id="text\_.3C\_text">text &lt; text</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="/index.php?title=Parser\_test&amp;action=edit&amp;section=2" title="Edit section: text &lt; text">edit</a><span class="mw-editsection-bracket">]</span></span></h2>

@@ -19,7 +19,7 @@

 <h2><span class="mw-headline" id="text\_.26\_text">text &amp; text</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="/index.php?title=Parser\_test&amp;action=edit&amp;section=3" title="Edit section: text &amp; text">edit</a><span class="mw-editsection-bracket">]</span></span></h2>

 <p>section 3

 </p>

-<h2><span class="mw-headline" id="text\_.27\_text">text ' text</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="/index.php?title=Parser\_test&amp;action=edit&amp;section=4" title="Edit section: text ' text">edit</a><span class="mw-editsection-bracket">]</span></span></h2>

+<h2><span class="mw-headline" id="text\_.27\_text">text ' text</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="/index.php?title=Parser\_test&amp;action=edit&amp;section=4" title="Edit section: text &#039; text">edit</a><span class="mw-editsection-bracket">]</span></span></h2>

 <p>section 4

 </p>

 <h2><span class="mw-headline" id="text\_.22\_text">text " text</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="/index.php?title=Parser\_test&amp;action=edit&amp;section=5" title="Edit section: text &quot; text">edit</a><span class="mw-editsection-bracket">]</span></span></h2>

[• csteipp](/p/csteipp/) added a comment.[Jan 9 2015, 10:17 PM2015-01-09 22:17:53 (UTC+0)](#967148)Comment Actions
> In [T73394#790270](/T73394#790270), [@csteipp](/p/csteipp/) wrote:
>
> Of the tests that fail,
>
> * "External link containing a single quote" looked wrong, but chrome and firefox handle it just fine. And the html 5 spec should parse it correctly. [@cscott](/p/cscott/), can you comment on this one?
> * "Running test Header with special characters" the test is specifically for what we're trying to do, but looking at the bug and <https://test.wikipedia.org/wiki/Header_with_special_characters> I'm not seeing the issue that the original bug (25462) specified. Was this fixed already by the move to html5? The new values that we generate should be equivalent when this is parsed.

[@cscott](/p/cscott/), is it ok if I update these tests for 63947 to escape 's inside attributes?

[@tstarling](/p/tstarling/), do you know if the tests for bug 25462 are still correct? I can't tell if the original bug was just pre-html5, or if it was being escaped a second time at some point in the past.

[MaxSem](/p/MaxSem/) subscribed.[Jan 10 2015, 12:43 AM2015-01-10 00:43:04 (UTC+0)](#967634)[tstarling](/p/tstarling/) added a comment.[Jan 13 2015, 6:46 AM2015-01-13 06:46:33 (UTC+0)](#972799)Comment Actions

It was double-escaped before the test was introduced, the input text says that explicitly, as does the relevant commit message: [https://www.mediawiki.org/wiki/Special:Code/MediaWiki/74526](https://www.mediawiki.org/wiki/Special%3ACode/MediaWiki/74526) . It's fine to update the expected text for that test.

[• csteipp](/p/csteipp/) added a parent task: [T87275: MediaWiki Security release 1.24.2](/T87275).[Jan 20 2015, 11:08 PM2015-01-20 23:08:50 (UTC+0)](#987725)[• csteipp](/p/csteipp/) added a comment.[Feb 19 2015, 11:32 PM2015-02-19 23:32:13 (UTC+0)](#1051763)Comment Actions

I modified [@Bawolff](/p/Bawolff/)'s patch to only escape > (which is the character causing problems for language converter's current regex), and updated the two parser tests that expected the old output. As I put in the comment, that means the only difference in encoding between the patches (assuming $wgWellFormedXml is set) is ' are not encoded.

I'll add a patch similar to bawolff's publicly after this goes out with the security release, but I think it's going to get resistance from [@Yurik](/p/Yurik/) and mobile, who are working on <https://gerrit.wikimedia.org/r/#/c/182889/>, for example. So entity encoding all " and ' characters I don't think is going to work for them, despite being more conservative from a security perspective.

T73394-escape\_gt.patch3 KB[Download](https://phab.wmfusercontent.org/file/download/vyxm7aac57lljcokqoqi/PHID-FILE-lrvlbwv2yxb5pxtfxvht/T73394-escape_gt.patch)

[Anomie](/p/Anomie/) subscribed.[Feb 23 2015, 8:29 PM2015-02-23 20:29:20 (UTC+0)](#1060228)Comment Actions
> In [T73394#1051763](/T73394#1051763), [@csteipp](/p/csteipp/) wrote:
>
> As I put in the comment, that means the only difference in encoding between the patches (assuming $wgWellFormedXml is set) is ' are not encoded.

That does appear to be the case, yes.

> I'll add a patch similar to bawolff's publicly after this goes out with the security release, but I think it's going to get resistance from [@Yurik](/p/Yurik/) and mobile, who are working on <https://gerrit.wikimedia.org/r/#/c/182889/>, for example. So entity encoding all " and ' characters I don't think is going to work for them, despite being more conservative from a security perspective.

IMO security trumps being "cute" with quotes, but I can't manage to find any way to exploit this with '>' being escaped.

[• csteipp](/p/csteipp/) added a project: [MediaWiki-Core-Team](/tag/mediawiki-core-team/).[Feb 23 2015, 9:58 PM2015-02-23 21:58:15 (UTC+0)](#1060593)[• csteipp](/p/csteipp/) moved this task from [Backlog](/project/board/37/) to [Needs Review/Feedback](/project/board/37/) on the [MediaWiki-Core-Team](/tag/mediawiki-core-team/) board.[• csteipp](/p/csteipp/) added a comment.[Mar 17 2015, 10:43 PM2015-03-17 22:43:58 (UTC+0)](#1126768)Comment Actions

T73394-escape\_gt-wmf21.patch4 KB[Download](https://phab.wmfusercontent.org/file/download/meas22waym3funqf5h2k/PHID-FILE-ztamz2n3p3bl2sji2txh/T73394-escape_gt-wmf21.patch)

Rebased the parser tests and deployed, replacing file\_71394.txt1 KB[Download](https://phab.wmfusercontent.org/file/download/w7dc4dd2akhsxzs34ip2/PHID-FILE-3oea6nvtnlqfhmtqy6dq/file_71394.txt).

[• csteipp](/p/csteipp/) updated the task description. [(Show Details)](/transactions/detail/PHID-XACT-TASK-d32sgifaal3uas7/)[Mar 17 2015, 10:45 PM2015-03-17 22:45:15 (UTC+0)](#1126773)[• csteipp](/p/csteipp/) updated the task description. [(Show Details)](/transactions/detail/PHID-XACT-TASK-uqzrze3niydngpe/)[Mar 18 2015, 12:35 AM2015-03-18 00:35:29 (UTC+0)](#1127053)[• csteipp](/p/csteipp/) added a project: [Vuln-XSS](/tag/vuln-xss/).[• csteipp](/p/csteipp/) added a comment.[Mar 24 2015, 10:35 PM2015-03-24 22:35:27 (UTC+0)](#1146903)Comment Actions

T73394-escape\_gt-REL1\_19.patch3 KB[Download](https://phab.wmfusercontent.org/file/download/xjxy4x2a2w32nmbsndpg/PHID-FILE-s426wb6jxkecdvtgi5yd/T73394-escape_gt-REL1_19.patch) - change in comment style, and differences in parser test output

[• csteipp](/p/csteipp/) updated the task description. [(Show Details)](/transactions/detail/PHID-XACT-TASK-ynahltiexfr37cg/)[Mar 24 2015, 10:36 PM2015-03-24 22:36:36 (UTC+0)](#1146908)[• csteipp](/p/csteipp/) closed this task as Resolved.[Mar 28 2015, 5:22 AM2015-03-28 05:22:44 (UTC+0)](#1159142)[bd808](/p/bd808/) moved this task from [Needs Review/Feedback](/project/board/37/) to [Done](/project/board/37/) on the [MediaWiki-Core-Team](/tag/mediawiki-core-team/) board.[Mar 30 2015, 7:21 PM2015-03-30 19:21:15 (UTC+0)](#1164125)[• csteipp](/p/csteipp/) changed the visibility from "[Custom Policy](/transactions/old/PHID-XACT-TASK-ykzqgudzegexoha/)" to "[Custom Policy](/transactions/new/PHID-XACT-TASK-ykzqgudzegexoha/)".[Mar 31 2015, 12:38 PM2015-03-31 12:38:16 (UTC+0)](#1166663)[• csteipp](/p/csteipp/) changed the visibility from "[Custom Policy](/transactions/old/PHID-XACT-TASK-jnhiiskymgnvtxz/)" to "Public (No Login Required)".[Mar 31 2015, 9:15 PM2015-03-31 21:15:54 (UTC+0)](#1168329)[• csteipp](/p/csteipp/) changed the edit policy from "[Custom Policy](/transactions/old/PHID-XACT-TASK-ps7bd5xdnwtyeic/)" to "All Users".[gerritbot](/p/gerritbot/) subscribed.[Mar 31 2015, 9:22 PM2015-03-31 21:22:25 (UTC+0)](#1168372)Comment Actions

Change 201016 had a related patch set uploaded (by CSteipp):

SECURITY: Escape > in Html::expandAttributes

<https://gerrit.wikimedia.org/r/201016>

[gerritbot](/p/gerritbot/) added a comment.[Mar 31 2015, 9:30 PM2015-03-31 21:30:03 (UTC+0)](#1168412)Comment Actions

Change 201027 had a related patch set uploaded (by CSteipp):

SECURITY: Escape > in Html::expandAttributes

<https://gerrit.wikimedia.org/r/201027>

[gerritbot](/p/gerritbot/) added a comment.[Mar 31 2015, 9:35 PM2015-03-31 21:35:35 (UTC+0)](#1168437)Comment Actions

Change 201037 had a related patch set uploaded (by CSteipp):

SECURITY: Escape > in Html::expandAttributes

<https://gerrit.wikimedia.org/r/201037>

[gerritbot](/p/gerritbot/) added a comment.[Mar 31 2015, 9:59 PM2015-03-31 21:59:54 (UTC+0)](#1168496)Comment Actions

Change 201016 merged by jenkins-bot:

SECURITY: Escape > in Html::expandAttributes

<https://gerrit.wikimedia.org/r/201016>

[• csteipp](/p/csteipp/) mentioned this in [rMW98062a7bb4a8: SECURITY: Escape > in Html::expandAttributes](/rMW98062a7bb4a8f78c77335d608371a8eb5b7ea278).[Mar 31 2015, 10:00 PM2015-03-31 22:00:05 (UTC+0)](#1168499)[gerritbot](/p/gerritbot/) added a comment.[Mar 31 2015, 10:21 PM2015-03-31 22:21:56 (UTC+0)](#1168590)Comment Actions

Change 201027 merged by jenkins-bot:

SECURITY: Escape > in Html::expandAttributes

<https://gerrit.wikimedia.org/r/201027>

[• csteipp](/p/csteipp/) mentioned this in [rMW9004770f60f8: SECURITY: Escape > in Html::expandAttributes](/rMW9004770f60f8bc768bfa2f73fc290ccc4c3a42ce).[Mar 31 2015, 10:22 PM2015-03-31 22:22:16 (UTC+0)](#1168602)[gerritbot](/p/gerritbot/) added a comment.[Mar 31 2015, 10:22 PM2015-03-31 22:22:21 (UTC+0)](#1168615)Comment Actions

Change 201037 merged by jenkins-bot:

SECURITY: Escape > in Html::expandAttributes

<https://gerrit.wikimedia.org/r/201037>

[• csteipp](/p/csteipp/) mentioned this in [rMWb92f883d50f8: SECURITY: Escape > in Html::expandAttributes](/rMWb92f883d50f8883dcfef0b2b68da330bfc3b193e).[Mar 31 2015, 10:22 PM2015-03-31 22:22:48 (UTC+0)](#1168622)[gerritbot](/p/gerritbot/) added a comment.[Apr 1 2015, 4:57 PM2015-04-01 16:57:21 (UTC+0)](#1170742)Comment Actions

Change 201222 had a related patch set uploaded (by CSteipp):

SECURITY: Escape > in Html::expandAttributes

<https://gerrit.wikimedia.org/r/201222>

[gerritbot](/p/gerritbot/) added a comment.[Apr 1 2015, 5:32 PM2015-04-01 17:32:02 (UTC+0)](#1170915)Comment Actions

Change 201222 merged by jenkins-bot:

SECURITY: Escape > in Html::expandAttributes

<https://gerrit.wikimedia.org/r/201222>

[• csteipp](/p/csteipp/) mentioned this in [rMW125ed0e5ff6b: SECURITY: Escape > in Html::expandAttributes](/rMW125ed0e5ff6bff50140eb2b844443c0389d5e583).[Apr 1 2015, 5:32 PM2015-04-01 17:32:18 (UTC+0)](#1170918)[• csteipp](/p/csteipp/) updated the task description. [(Show Details)](/transactions/detail/PHID-XACT-TASK-4hledcqusuulzm3/)[Apr 8 2015, 1:59 AM2015-04-08 01:59:30 (UTC+0)](#1188308)[• dpatrick](/p/dpatrick/) added a project: [Security-Team](/tag/security-team/).[Jun 4 2015, 4:23 PM2015-06-04 16:23:39 (UTC+0)](#1337901)[• dpatrick](/p/dpatrick/) removed a project: [Security-Team](/tag/security-team/).[Jun 4 2015, 4:38 PM2015-06-04 16:38:13 (UTC+0)](#1337996)[• dpatrick](/p/dpatrick/) mentioned this in [T118755: Fix LanguageConverter's parsing](/T118755).[Nov 16 2015, 5:50 PM2015-11-16 17:50:37 (UTC+0)](#1808436)[Bawolff](/p/Bawolff/) mentioned this in [T119158: Language converter: unsafe attribute injection via glossary rules (CVE-2017-8815)](/T119158).[Jan 22 2016, 11:25 AM2016-01-22 11:25:48 (UTC+0)](#1955089)[Bawolff](/p/Bawolff/) mentioned this in [T125163: id attribute on headlines allow raw > [Possible issue in combination with language converter] (CVE-2017-8812)](/T125163).[Jan 28 2016, 11:10 PM2016-01-28 23:10:35 (UTC+0)](#1980136)[Bawolff](/p/Bawolff/) mentioned this in [T57548: Html::expandAttributes can be tricked into omitting necessary quotes](/T57548).[Apr 20 2016, 11:59 PM2016-04-20 23:59:44 (UTC+0)](#2226036)[• chasemp](/p/chasemp/) added a project: [Security](/tag/security/).[Feb 10 2020, 10:50 PM2020-02-10 22:50:49 (UTC+0)](#5867210) · Restricted Application added a subscriber: [Liuxinyu970226](/p/Liuxinyu970226/).  · [View Herald Transcript](/herald/transcript/3518878/)[Feb 10 2020, 10:50 PM2020-02-10 22:50:49 (UTC+0)](#5867217) · [• chasemp](/p/chasemp/) removed a project: [acl\*security](/tag/acl_security/).[Feb 20 2020, 8:11 PM2020-02-20 20:11:41 (UTC+0)](#5903030) · [Aklapper](/p/Aklapper/) removed a subscriber: [Anomie](/p/Anomie/).[Oct 16 2020, 5:38 PM2020-10-16 17:38:21 (UTC+0)](#6552802) · [Log In to Comment](/login/?next=)Content licensed under Creative Commons Attribution-ShareAlike (CC BY-SA) 4.0 unless otherwise noted; code licensed under GNU General Public License (GPL) 2.0 or later and other open source licenses. By using this site, you agree to the Terms of Use, Privacy Policy, and Code of Conduct. · [Wikimedia Foundation](https://wikimediafoundation.org/) · [Privacy Policy](https://foundation.wikimedia.org/wiki/Special%3AMyLanguage/Policy%3ANon-wiki_privacy_policy) · [Code of Conduct](https://www.mediawiki.org/wiki/Special%3AMyLanguage/Code_of_Conduct) · [Terms of Use](https://foundation.wikimedia.org/wiki/Special%3AMyLanguage/Policy%3ATerms_of_Use/Phabricator) · [Disclaimer](https://foundation.wikimedia.org/wiki/Special%3AMyLanguage/Policy%3AGeneral_disclaimer) · [CC-BY-SA](https://creativecommons.org/licenses/by-sa/4.0/) · [GPL](https://www.gnu.org/licenses/old-licenses/gpl-2.0.html) · [Credits](https://www.mediawiki.org/wiki/Phabricator/Credits)

=== Content from phabricator.wikimedia.org_12dc430f_20250126_085824.html ===
Page Menu[HomePhabricator](/)

* SearchConfigure Global Search

[Log In](https://phabricator.wikimedia.org/auth/start/?next=%2FT73394)[Create Task](/maniphest/task/edit/nocreate/) [Maniphest](/maniphest/)  T73394
# XSS in language converter when used with Html class's tricky escapingClosed, Resolved[Public](/policy/explain/PHID-TASK-yafbuhxbgn5dbpw2fbju/view/)Actions

* [Edit Task](/maniphest/task/edit/73394/)
* Edit Related Tasks...
* [Create Subtask](/maniphest/task/subtask/73394/)
* [Edit Parent Tasks](/search/rel/task.has-parent/PHID-TASK-yafbuhxbgn5dbpw2fbju/)
* [Edit Subtasks](/search/rel/task.has-subtask/PHID-TASK-yafbuhxbgn5dbpw2fbju/)
* [Merge Duplicates In](/search/rel/task.merge-in/PHID-TASK-yafbuhxbgn5dbpw2fbju/)
* [Close As Duplicate](/search/rel/task.close-as-duplicate/PHID-TASK-yafbuhxbgn5dbpw2fbju/)
* Edit Related Objects...
* [Edit Commits](/search/rel/task.has-commit/PHID-TASK-yafbuhxbgn5dbpw2fbju/)
* [Edit Mocks](/search/rel/task.has-mock/PHID-TASK-yafbuhxbgn5dbpw2fbju/)
* Subscribe
* [Mute Notifications](/subscriptions/mute/PHID-TASK-yafbuhxbgn5dbpw2fbju/)
* [Protect as security issue](/wmf/escalate-task/73394/)
* [Award Token](/token/give/PHID-TASK-yafbuhxbgn5dbpw2fbju/)
* [Flag For Later](/flag/edit/PHID-TASK-yafbuhxbgn5dbpw2fbju/)

Assigned To

|  | [• csteipp](/p/csteipp/) |
| --- | --- |

Authored By

|  | [Bawolff](/p/Bawolff/) |
| --- | --- |
| Sep 28 2014, 7:16 PM2014-09-28 19:16:00 (UTC+0) |

Tags

* [Security-Core](/tag/security-core/) [(Backlog)](/project/board/427/)
* [Patch-For-Review](/tag/patch-for-review/)
* [MediaWiki-Core-Team](/tag/mediawiki-core-team/)
* [Vuln-XSS](/tag/vuln-xss/)
* [Security](/tag/security/)
Referenced Files

|  | [F103786: T73394-escape\_gt-REL1\_19.patch](/F103786) |
| --- | --- |
| Mar 24 2015, 10:35 PM2015-03-24 22:35:27 (UTC+0) |

|  | [F99618: T73394-escape\_gt-wmf21.patch](/F99618) |
| --- | --- |
| Mar 17 2015, 10:43 PM2015-03-17 22:43:58 (UTC+0) |

|  | [F43922: T73394-escape\_gt.patch](/F43922) |
| --- | --- |
| Feb 19 2015, 11:32 PM2015-02-19 23:32:13 (UTC+0) |

|  | [F16331: bug71394-REL1\_19.patch](/F16331) |
| --- | --- |
| Nov 26 2014, 1:24 PM2014-11-26 13:24:12 (UTC+0) |

|  | [F16330: bug71394-REL1\_24\_REL1\_23\_REL1\_22.patch](/F16330) |
| --- | --- |
| Nov 26 2014, 1:24 PM2014-11-26 13:24:12 (UTC+0) |

|  | [F14798: file\_71394.txt](/F14798) |
| --- | --- |
| Nov 26 2014, 5:56 AM2014-11-26 05:56:31 (UTC+0) |

|  | [F14799: bug71394-tokenizer.patch](/F14799) |
| --- | --- |
| Nov 22 2014, 3:46 AM2014-11-22 03:46:11 (UTC+0) |

Subscribers

|  | [Bawolff](/p/Bawolff/) |
| --- | --- |

|  | [cscott](/p/cscott/) |
| --- | --- |

|  | [• csteipp](/p/csteipp/) |
| --- | --- |

|  | [gerritbot](/p/gerritbot/) |
| --- | --- |

|  | [Grunny](/p/Grunny/) |
| --- | --- |

|  | [liangent](/p/liangent/) |
| --- | --- |

|  | [Liuxinyu970226](/p/Liuxinyu970226/) |
| --- | --- |

[View All 12 Subscribers](/subscriptions/list/PHID-TASK-yafbuhxbgn5dbpw2fbju/)
# Description

Change to Html escaping method

If the language is set to a language with variants (e.g. zh, sr, etc), then its possible to create an XSS if some other code allows user input to be put in an attribute using the escaping done by Html::element (or Html::rawElement).

Example exploit code:

1. Set $wgLanguageCode = 'zh'; $wgDefaultLanguageVariant = 'zh-cn'; (Assuming you don't have a different default variant set in prefs)

Create a page with the following wikitext:

-{H|abc123=>zh-cn:" autofocus onfocus="alert('be evil');}-

{{Special:Contributions|target=>abc123}}

And you have your XSS. I imagine there's probably less obvious ways to exploit this once you take into all the extensions using Html:: for their escaping. The $wgDefaultLanguageVariant isn't really necessary as you can set the variant from the url.

If $wgWellFormedXml is off, I believe it becomes possible to directly insert a <script> tag instead of relying on event handlers (but haven't tested).

Solutions:

The fact that language converter basically does macro expansions after the html sanitization step, is pretty sketchy. But I'm not sure if there's a good way around that without redesigning the feature.

I would suggest fixing this by getting rid of the little weird tricks that Html::expandAttributes does. Well its cute that technically one doesn't need to escape that in that context, cute things like that seem like a bad idea in security critical code. (A similar thing occurs in the escaping of Html::element, however I don't think that is exploitable).

---

**Version**: unspecified

**Severity**: normal

**Patch**: T73394-escape\_gt-wmf21.patch4 KB[Download](https://phab.wmfusercontent.org/file/download/meas22waym3funqf5h2k/PHID-FILE-ztamz2n3p3bl2sji2txh/T73394-escape_gt-wmf21.patch) (fix the attack vectors, we'll address the root of the issue in a public patch)

* 1.24: T73394-escape\_gt.patch3 KB[Download](https://phab.wmfusercontent.org/file/download/vyxm7aac57lljcokqoqi/PHID-FILE-lrvlbwv2yxb5pxtfxvht/T73394-escape_gt.patch)
* 1.23: T73394-escape\_gt.patch3 KB[Download](https://phab.wmfusercontent.org/file/download/vyxm7aac57lljcokqoqi/PHID-FILE-lrvlbwv2yxb5pxtfxvht/T73394-escape_gt.patch)
* 1.19: T73394-escape\_gt-REL1\_19.patch3 KB[Download](https://phab.wmfusercontent.org/file/download/xjxy4x2a2w32nmbsndpg/PHID-FILE-s426wb6jxkecdvtgi5yd/T73394-escape_gt-REL1_19.patch)

**Affected Versions**: Since [f16d1e4ed70cd5a8fa6ae6ca8bb71bfe62f4f47e](/rMWf16d1e4ed70cd5a8fa6ae6ca8bb71bfe62f4f47e) (1.17?)

**Type**: xss

**CVE**: CVE-2015-2933

# Details

Reference bz71394

|  | Subject | Repo | Branch | Lines +/- |
| --- | --- | --- | --- | --- |
|  | [SECURITY: Escape > in Html::expandAttributes](https://gerrit.wikimedia.org/r/c/201222) | [mediawiki/core](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/core) | [master](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/core/%2B/master) | +7 -4 |
|  | [SECURITY: Escape > in Html::expandAttributes](https://gerrit.wikimedia.org/r/c/201027) | [mediawiki/core](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/core) | [REL1\_23](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/core/%2B/REL1_23) | +7 -4 |
|  | [SECURITY: Escape > in Html::expandAttributes](https://gerrit.wikimedia.org/r/c/201016) | [mediawiki/core](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/core) | [REL1\_24](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/core/%2B/REL1_24) | +7 -4 |
|  | [SECURITY: Escape > in Html::expandAttributes](https://gerrit.wikimedia.org/r/c/201037) | [mediawiki/core](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/core) | [REL1\_19](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/core/%2B/REL1_19) | +7 -4 |

[Customize query in gerrit](https://gerrit.wikimedia.org/r/#/q/bug:T73394)
# Related ObjectsSearch...

* Task Graph
* Mentions

|  |  | Status | Subtype | Assigned | Task |
| --- | --- | --- | --- | --- | --- |
|  |  | Resolved |  | [• csteipp](/p/csteipp/) | T88120 [Release MW 1.24.2 and 1.23.9 tarballs](/T88120) |
|  |  | Resolved |  | [• csteipp](/p/csteipp/) | T87275 [MediaWiki Security release 1.24.2](/T87275) |
|  |  | Resolved |  | [• csteipp](/p/csteipp/) | T73394 [XSS in language converter when used with Html class's tricky escaping](/T73394) |

Mentioned In [T57548: Html::expandAttributes can be tricked into omitting necessary quotes](/T57548)
[T125163: id attribute on headlines allow raw > [Possible issue in combination with language converter] (CVE-2017-8812)](/T125163)
[T119158: Language converter: unsafe attribute injection via glossary rules (CVE-2017-8815)](/T119158)
[T118755: Fix LanguageConverter's parsing](/T118755)
[rMW125ed0e5ff6b: SECURITY: Escape > in Html::expandAttributes](/rMW125ed0e5ff6bff50140eb2b844443c0389d5e583)
[rMWb92f883d50f8: SECURITY: Escape > in Html::expandAttributes](/rMWb92f883d50f8883dcfef0b2b68da330bfc3b193e)
[rMW9004770f60f8: SECURITY: Escape > in Html::expandAttributes](/rMW9004770f60f8bc768bfa2f73fc290ccc4c3a42ce)
[rMW98062a7bb4a8: SECURITY: Escape > in Html::expandAttributes](/rMW98062a7bb4a8f78c77335d608371a8eb5b7ea278) Mentioned Here [rMWf16d1e4ed70c: LanguageConverter::captionConvert(): remove HTML tags and escape HTML special…](/rMWf16d1e4ed70cd5a8fa6ae6ca8bb71bfe62f4f47e)
### Event Timeline

There are a very large number of changes, so older changes are hidden. [Show Older Changes](/transactions/showolder/PHID-TASK-yafbuhxbgn5dbpw2fbju/?after=750310&quoteTargetID=UQ0_1&quoteRef=T73394)Restricted Application changed the visibility from "Public (No Login Required)" to "[acl\*security](/tag/acl_security/) (Project)".  · [View Herald Transcript](/herald/transcript/404381/)[Nov 22 2014, 3:46 AM2014-11-22 03:46:02 (UTC+0)](#750310)Restricted Application changed the edit policy from "All Users" to "[acl\*security](/tag/acl_security/) (Project)".  · [View Herald Transcript](/herald/transcript/404381/)[Bawolff](/p/Bawolff/) created this task.[Sep 28 2014, 7:16 PM2014-09-28 19:16:00 (UTC+0)](#750317)[Bawolff](/p/Bawolff/) added a comment.[Sep 28 2014, 7:30 PM2014-09-28 19:30:44 (UTC+0)](#750320)Comment Actions

p.s. In the interest of credit where credit is due for finding this, I should add: thank you to CScott, who helped me understand how language converter actually worked, and Amir who pointed me in this direction during a conversation about a different issue with the language converter.

[Bawolff](/p/Bawolff/) added a comment.[Sep 28 2014, 8:33 PM2014-09-28 20:33:19 (UTC+0)](#750323)Comment Actions

This is also exploitable (I believe, have not tested) on wikis with a non-variant language as content language (e.g. a normal english wiki), if one can set the page language for a page to be a language with variants. This includes:

* If $wgPageLanguageUseDB is set to true (Its false by default, I don't think anyone is currently using it)
* If translate extension is installed (e.g. Commons, meta).
* People can also do the same thing with pages like MediaWiki:Foo/zh, however only admins can edit those, so not big deal.
[• csteipp](/p/csteipp/) added a comment.[Oct 6 2014, 11:19 PM2014-10-06 23:19:42 (UTC+0)](#750330)Comment Actions

Thanks Bawolff! Confirmed it's exploitable, although I'm still trying to figure out exactly how that's working. Adding Niklas in case we can address this on the translation side.

[Bawolff](/p/Bawolff/) added a comment.[Oct 7 2014, 1:43 AM2014-10-07 01:43:38 (UTC+0)](#750347)Comment Actions

(In reply to Chris Steipp from comment #3)

> Thanks Bawolff! Confirmed it's exploitable, although I'm still trying to
>
> figure out exactly how that's working. Adding Niklas in case we can address
>
> this on the translation side.

Its in the code part, not the conversion tables, so not affected by what the translators do (Of course i18n devs are probably familiar with this area of the code). AFAIK the people who know most about this area of the code base and are still active are Liangent and CScott.

---

I probably should have explained a little better how it works:

* Language converter is a feature to convert different writing systems (e.g. Serbian written in Latin, vs serbian written in Cyrillic, traditional Chinese vs simplified Chinese). It more or less works by doing find and replace for various letters or strings.
* In addition to the general pre-defined find and replace strings, users can define their own replacements for a specific page (So in essence it works much like a macro system)
* Replacements are done after all the HTML sanitization takes place (!!) pretty much at the very end of the parsing process.

\*The language converter, in LanguageConverter::autoConvert has a bunch of regexes to exclude HTML tags from being converted, to basically stop people from doing this. Specifically /<[^>]+>/ (plus some other stuff in an alternation)

\*However if you have an html tag like <div class=">"> (Which is allowed in html5, > does not have to be escaped if its inside an attribute enclosed in quotes), the regex will stop two characters short and allow you to do lang converter substitutions on stuff after the first >. Thus the challenge becomes making MW insert a tag with an attribute that has a non escaped > in the attribute.

\*There are multiple ways html is escaped in MediaWiki. Most stuff from wikitext goes through the sanitizer class, which uses &gt; in the attribute for >. Html::element/Html::rawElement tries to be cool about avoiding unnecessary escapes (To save a miniscule amount of bytes I suppose). Thus Html::element can be used to insert such a tag.

\*Very few things controllable from wikitext (or otherwise by the user) use Html::escape as an escaping method, the first one I found was the input box on the Special:Contribution special page. I imagine there are others, probably in extension parser tags, and other transcludable special pages. Lots of transcludable special pages have <input type="hidden" ... > elements that have a controllable value from the user and escaped by Html::element, however I couldn't immediately see a way to execute javascript automatically from an extra attribute on a hidden input, so I went with the text input which has obvious event handler attributes. I imagine there's probably some ingenious way to do the same thing to the hidden form tags.

p.s. Forgot to mention in original comment, languages that are affected: 'gan', 'iu','kk','ku','shi','sr','tg', 'uz', 'zh'. And any wiki where that is the content language or the user can set the page language of a specific page (other than Special pages) to one of those languages (eg a wiki with Translate extension) is vulnerable.

[• csteipp](/p/csteipp/) added a comment.[Oct 9 2014, 11:33 PM2014-10-09 23:33:38 (UTC+0)](#750369)Comment Actions

Created attachment 16738

Match html elements with > in attribute

Thanks Brian! I wouldn't mind encoding > in Html::expandAttributes too, but I'm worried that if we depend on the escaping there only, this could come up in other places. I think LanguageConverter also needs to be updated to (more) correctly try and parse the text it's working on and do sane things there. So here's a patch to do that. I'd probably feel more comfortable with just updating the LanguageConverter regex as a security fix, and then do the expandAttributes change publicly as a hardening.

It looks like LanguageConverterTest.php doesn't exercise the conversions, so it's hard to know if the old regex was being abused for some functionality. But this patch stops the xss for me, and appears to allow the rest of the conversion correctly. I'll add liangent and cscott to get their opinions.

*attachment bug71394-converter.patch ignored as obsolete*

[• csteipp](/p/csteipp/) added a comment.[Oct 9 2014, 11:40 PM2014-10-09 23:40:41 (UTC+0)](#750375)Comment Actions

Liangent / CScott, it would be great if you could take a look and see if this is sane.

[Bawolff](/p/Bawolff/) added a comment.[Oct 10 2014, 4:07 AM2014-10-10 04:07:46 (UTC+0)](#750385)Comment Actions

(In reply to Chris Steipp from comment #5)

> Created attachment 16738 [details]
>
> Match html elements with > in attribute
>
> Thanks Brian! I wouldn't mind encoding > in Html::expandAttributes too, but
>
> I'm worried that if we depend on the escaping there only, this could come up
>
> in other places.

Yes definitely.

Would the couple lines above ($htmlfix variable), that catch unclosed html elements also have to be changed? I'll admit, I'm unclear under what circumstances that part of the regex would come into play.

---

One possible edge case that might be needed to be considered where attachment 16738 would not work, is if someone could insert:

<div title=dog's>foo</div>

into a page. Of course, one could quite convincingly argue that if anything inserted something like that, its already pretty broken (And definitely in violation of the HTML5 spec), however, firefox (or at least the version I tested on) does interpret the title attribute as actually being dog's for that html snippet. So not sure if we should care about that.

> It looks like LanguageConverterTest.php doesn't exercise the conversions, so
>
> it's hard to know if the old regex was being abused for some functionality.
>
> But this patch stops the xss for me, and appears to allow the rest of the
>
> conversion correctly. I'll add liangent and cscott to get their opinions.

I don't think lang converter was being abused in a way that would be stopped by this (And if anyone does, I think its an unreasonable use of the feature). I believe most of the lang converter tests are in tests/parser/parserTests.txt

*attachment bug71394-converter.patch ignored as obsolete*

[• csteipp](/p/csteipp/) added a comment.[Oct 10 2014, 8:29 PM2014-10-10 20:29:37 (UTC+0)](#750401)Comment Actions

(In reply to Bawolff (Brian Wolff) from comment #7)

> Would the couple lines above ($htmlfix variable), that catch unclosed html
>
> elements also have to be changed? I'll admit, I'm unclear under what
>
> circumstances that part of the regex would come into play.

That comes into play when the an html element is started but not closed in the part being autoconverted. I haven't worked out exactly how the wikitext is cut up and sent to the autoconvert function, but it appears to get sent in chunks. Although I haven't been able to find any wikitext that manages to send unclosed html elements to it.

> One possible edge case that might be needed to be considered where
>
> attachment 16738 [details] would not work, is if someone could insert:
>
> <div title=dog's>foo</div>

That is indeed a problem, although even when $wgWellFormedXml is false, we would flag the ' as a blacklisted char if it went through Html::expandAttributes, so it would be title="dog's". But again, looking at the cases where it doesn't go through expandAttributes, I probably should add an extra condition that also matches the naive pattern to catch that.

> into a page. Of course, one could quite convincingly argue that if anything
>
> inserted something like that, its already pretty broken (And definitely in
>
> violation of the HTML5 spec), however, firefox (or at least the version I
>
> tested on) does interpret the title attribute as actually being dog's for
>
> that html snippet. So not sure if we should care about that.
>
> > It looks like LanguageConverterTest.php doesn't exercise the conversions, so
> >
> > it's hard to know if the old regex was being abused for some functionality.
> >
> > But this patch stops the xss for me, and appears to allow the rest of the
> >
> > conversion correctly. I'll add liangent and cscott to get their opinions.
>
> I don't think lang converter was being abused in a way that would be stopped
>
> by this (And if anyone does, I think its an unreasonable use of the
>
> feature). I believe most of the lang converter tests are in
>
> tests/parser/parserTests.txt

[• csteipp](/p/csteipp/) added a comment.[Oct 10 2014, 8:33 PM2014-10-10 20:33:25 (UTC+0)](#750407)Comment Actions

Created attachment 16744

Add matching html elements with > in attribute

This patch adds back in the naive matching (<[^>]+>) at the end of the regex, which, in my testing, handles both.

<div title=foo'bar> and <div title="foo>bar">

This assumes that the |'ed conditions of the regex are evaluated left to right, but I need to verify that we can assume that.

*attachment bug71394-converterb.patch ignored as obsolete*

[cscott](/p/cscott/) added a comment.[Oct 23 2014, 10:43 PM2014-10-23 22:43:36 (UTC+0)](#750420)Comment Actions

I'm suspicious of the approach in chris' patch, I think you'll need something more (haven't yet reviewed bawolff's patch). There are a number of parsing issues in the regexps, for example:

<pre foo="></pre>">

escapes the $prefix match, so:

-{H|abc123=>zh-cn:" onfocus="alert('be evil');}-

<pre foo="></pre>" abc123></pre>

would exploit that, using the same Html::escape trick to get that attribute value past the sanitizer.

A more robust regexp for matching attributes (based on the spec, at <http://dev.w3.org/html5/spec-preview/tokenization.html>) is:

<https://github.com/fgnass/domino/blob/master/lib/HTMLParser.js#L1458>

but I'm not sure I've got high confidence this approach will catch all possible cases. I need to think hard about this.

[cscott](/p/cscott/) added a comment.[Oct 23 2014, 10:48 PM2014-10-23 22:48:32 (UTC+0)](#750425)Comment Actions

Ok, I've read bawolff's patch. I think I like that approach better than trying to fix language converter here, although I would tweak his comment in the source to say something like,

"it's important to escape < >, even if it's not required in this context, to allow other bits of code (for example Language Converter) to use naive algorithms to extract tags"

[cscott](/p/cscott/) added a comment.[Oct 23 2014, 11:01 PM2014-10-23 23:01:20 (UTC+0)](#750439)Comment Actions

To be concrete about the <pre> problem above, the issue is that Html::escape doesn't encode the "<". So to exploit the bad <pre> regexp in language converter, we just need to sneak a < into an attribute value. The vulnerable code in Special:Contributions which bawolff used to exploit the bad attribute-parsing regexp was:

```
		$input = Html::input(
			'target',
			$this->opts['target'],
                        ...
```

So to exploit the bad <pre>-parsing regexp we'd be looking for:

```
$pre = Html::pre( 'anyattribute', $userinput, .... )
```

or

```
$code = Html::code( 'anyattribute', $userinput, .... )
```

since the <code> regexp has the same problem (as does the <script> regexp).

The HTML parsing spec is complex. Until we can move LanguageConverter higher in the parsing stack and get it in front of the sanitizer, we should probably be very conservative in how we allow > to reach the output.

[cscott](/p/cscott/) added a comment.[Oct 23 2014, 11:22 PM2014-10-23 23:22:40 (UTC+0)](#750444)Comment Actions

csteipp: So naively, $prefix = '<pre(?:"[^"]\*"[\'"]\*|\'[^\']\*\'[\'"]\*|[^\'">])\*>.\*?<\/pre>|';

cscott: i'm reading the spec to double check

cscott: i'd simplify that to $prefix = '<pre(?:"[^"]\*"|\'[^\']\*\'|[^\'">])\*>.\*?<\/pre>|';

cscott: that is, you don't need the [^'"] at the end of each quoted string

cscott: but the weird case you haven't covered is <pre foo=bar's>

cscott: i can confirm that once you've entered the "Attribute value (double-quoted) state" the only thing that will bail you out is a double quote, and similarly for single-quoted/single-quote

cscott: but not every double/single quote will get you into the attribute value state

cscott: in particular, single and double quotes when you are in the "attribute value (unquoted) state" are just appended to the attribute value.

cscott: i think the right solution is to be hyper conservative and bail out on language converter entirely if you see strange stuff

cscott: i think merging bawolff's patch is a good first step, followed by auditing anything which does any other "interesting" html escape. belt and suspenders.

cscott: i think we can do better with the language converter regexp, but i think the solution is going to be something like <[a-z]+((\s+[a-z]+="[^"]")\*>|.\*)

cscott: that is, just match to the end of the current string and protect all the rest of the input from language converter if you see something in the tag that doesn't look "right".

[• csteipp](/p/csteipp/) added a comment.[Oct 24 2014, 1:07 AM2014-10-24 01:07:35 (UTC+0)](#750461)Comment Actions
> cscott: i'd simplify that to $prefix =
>
> '<pre(?:"[^"]\*"|\'[^\']\*\'|[^\'">])\*>.\*?<\/pre>|';

done.

I also realized we have a more generalized problem in that " is a valid attribute name, so <div "=">"></div> or <pre "=">">foo</pre> should be matched too.

> cscott: i think merging bawolff's patch is a good first step, followed by
>
> auditing anything which does any other "interesting" html escape. belt and
>
> suspenders.

I definitely now think we want to include bawolff's patch as part of the security fix. There's too many things that can go wrong without it.

> cscott: i think we can do better with the language converter regexp, but i
>
> think the solution is going to be something like
>
> <[a-z]+((\s+[a-z]+="[^"]")\*>|.\*)
>
> cscott: that is, just match to the end of the current string and protect all
>
> the rest of the input from language converter if you see something in the
>
> tag that doesn't look "right".

I'm not sure I fully understand what you're thinking here, I'll ping you on irc and hopefully get a better idea.

[cscott](/p/cscott/) added a comment.[Oct 24 2014, 2:02 AM2014-10-24 02:02:46 (UTC+0)](#750474)Comment Actions

Basically instead of trying to match all possible valid uses of quotes, angle brackets, etc, try to match the common not-crazy patterns -- and then include a fail-safe .\* alternate at the end so if we're not certain where the close-tag is, fail-safe and protect the entire remainder of the string from language converter.

Relies on left-to-right evaluation of alternates, which is indeed how PCRE works (<http://php.net/manual/en/regexp.reference.alternation.php>).

Consider my simple version (assume 'is' regexp flags):

<(/?[a-z]+(\s+[a-z]+="[^"]")\*\s\*>|.\*)

Given the input:

abc<pre>foo</pre>x<div class="foo" style="bar">bat</div>y<pre evil'ness="'">abc123</pre>

It will match as follows:

<pre> (sending 'abc' off to be language converted)

</pre> (sending 'foo' off to be language converted)

<div class="foo" style="bar"> (sending 'x' off to be language converted)

</div> (sending 'bat' off to be language converted)

<pre evil'ness="'">abc123</pre> (sending 'y' off to be language converted)

and we're done. Note that the final <pre> tag didn't match how we expected our attributes to look, and so to be safe we just matched from there to the end of the string and didn't language convert anything in that potentially-dangerous region (since we couldn't trust our simple regex to find the correct end of the tag when things get weird).

[liangent](/p/liangent/) added a comment.[Oct 24 2014, 9:33 AM2014-10-24 09:33:10 (UTC+0)](#750483)Comment Actions

(In reply to C. Scott Ananian from comment #15)

> <pre evil'ness="'">abc123</pre> (sending 'y' off to be language converted)

Just a reminder that <pre evil'ness="'">abc123</pre> will be processed further (// Translate any alt or title attributes inside the matched element) by Language Converter and that part of code also uses delimiter ">".

[• csteipp](/p/csteipp/) added a comment.[Oct 28 2014, 7:23 PM2014-10-28 19:23:51 (UTC+0)](#750487)Comment Actions

Created attachment 16932

Matching html elements with > in attribute, etc.

*attachment bug71394-converterc.patch ignored as obsolete*

[• csteipp](/p/csteipp/) added a comment.[Oct 28 2014, 9:15 PM2014-10-28 21:15:42 (UTC+0)](#750500)Comment Actions

(In reply to Chris Steipp from comment #14)

> > cscott: i'd simplify that to $prefix =
> >
> > '<pre(?:"[^"]\*"|\'[^\']\*\'|[^\'">])\*>.\*?<\/pre>|';
>
> done.

I realized this is actually wrong. We want to aggressively match anything that looks like it's in <pre> tags (ditto <code> or <script>), to prevent that from being translated.

(In reply to C. Scott Ananian from comment #15)

> Consider my simple version (assume 'is' regexp flags):
>
> <(/?[a-z]+(\s+[a-z]+="[^"]")\*\s\*>|.\*)

I want with

<(\/?[a-zA-Z]+(\s+[a-zA-Z]+\s\*=("[^"]\*"|\'[^\']\*\'|[^\'">]\*))\*\s\*>|.\*)

So that catch attributes with > in their value, or if the element has an attribute name that contains a ", we just match the rest of the string, since there isn't a regex that can actually parse according to the spec (I wouldn't mind seeing us implement an actual html parser and using that for cases like this, but that's a much larger project).

This should make the first part of $htmlfix redundant, but I left it in case.

I haven't found a good way to write tests for this fix-- I haven't found any simple wikitext to get a > in the attribute value for parserTests.txt.

(In reply to Liangent from comment #16)

> Just a reminder that <pre evil'ness="'">abc123</pre> will be processed
>
> further (// Translate any alt or title attributes inside the matched
>
> element) by Language Converter and that part of code also uses delimiter ">".

The regex on line 406 can stay unchanged. If we have something like <img class=">foo" title="something-to-translate", then the title won't be converted, even though it's technically harmless for us to do that.

The regex on line 421 is in case the conversion has injected html into the title or alt attribute values, then it's supposed to be stripped out. With bawolff's patch to expandAttributes, then this is going to be run through Sanitizer::encodeAttribute again, so it shouldn't affect the layout.

[cscott](/p/cscott/) added a comment.[Oct 28 2014, 9:39 PM2014-10-28 21:39:29 (UTC+0)](#750515)Comment Actions

Chris: I think your regexp isn't quite right for the "unquoted attribute" case -- it includes whitespace in the unquoted attribute, which isn't right. Does the sanitizer ever emit unquoted attributes? I'd just leave the unquoted attribute case out if possible, or match only [a-z]\* with it to be safe. (I could probably read the spec and come up with a more precise regexp for "things that are safe to include in an unquoted attribute -- but I'd rather just skip that case entirely if we expect attributes to be quoted.)

[• csteipp](/p/csteipp/) added a comment.[Oct 28 2014, 11:36 PM2014-10-28 23:36:00 (UTC+0)](#750519)Comment Actions

Created attachment 16937

Matching html elements with > in attribute, etc.

It shouldn't make a difference if the subpattern match stops at the whitespace, or if it continues until just before the = in the next attribute, but it might be more efficient, so I updated it. I also made it explicit we're not capturing any of the subpatterns.

Also, <http://dev.w3.org/html5/spec-preview/tokenization.html#attribute-name-state> has the "Anything else" section in the parsing, so we should account for attribute names that aren't just a-z. We could use Sanitizer::getAttribsRegex'es logic ($attrib = '[:A-Z\_a-z-.0-9]';), but I'd rather target the spec.

I also realized the last patch neglected boolean attributes, so tags with those would cause the whole string to be matched.

*attachment bug71394-converterd.patch ignored as obsolete*

[Nikerabbit](/p/Nikerabbit/) added a comment.[Oct 29 2014, 6:10 PM2014-10-29 18:10:12 (UTC+0)](#750522)Comment Actions

I was told that feedback from LangEng team was requested. Unfortunately, the language converter is not a thing we have worked on. We do not have enough experience to comment whether the proposed patch might cause issues.

[cscott](/p/cscott/) added a comment.[Oct 29 2014, 7:10 PM2014-10-29 19:10:06 (UTC+0)](#750530)Comment Actions

Chris: I'm still concerned that your character classes match too much, especially your attribute name match. And you're not allowing whitespace after an equals side currently.

My point in comment 15 was that we \*shouldn't\* try to match the spec exactly -- the full parser spec has all sorts of crazy corner cases. In order to have maintainable security here we should instead try to be \*as conservative as possible\* in terms of what we match. Let's only broaden character classes as little as possible to match what we expect the sanitizer to emit, instead of risking bugs (and future maintainability issues) adding extra unnecessary clauses to the regexp.

I think using Sanitizer::getAttribsRegex's value is very reasonable for an attribute name pattern.

And I'd like to see the boolean attribute handled via using a (\s=\s+...)? type of regexp, rather than repeating the attribute name regexp at the end. Basically I'm trying to nail down the hatches here and try to ensure that we don't get weird mismatches creeping in here in the future, since this code turns out to be security-critical.

[• csteipp](/p/csteipp/) added a comment.[Oct 29 2014, 11:51 PM2014-10-29 23:51:50 (UTC+0)](#750553)Comment Actions

(In reply to C. Scott Ananian from comment #22)

> Chris: I'm still concerned that your character classes match too much,
>
> especially your attribute name match. And you're not allowing whitespace
>
> after an equals side currently.

{{done}}

> My point in comment 15 was that we \*shouldn't\* try to match the spec exactly
>
> * the full parser spec has all sorts of crazy corner cases. In order to
>
> have maintainable security here we should instead try to be \*as conservative
>
> as possible\* in terms of what we match. Let's only broaden character
>
> classes as little as possible to match what we expect the sanitizer to emit,
>
> instead of risking bugs (and future maintainability issues) adding extra
>
> unnecessary clauses to the regexp.

Yeah, I was trying to be broad in what we match in the general html part, instead of just letting the fallback .\* handle it. I agree, just matching the rest of the string is probably safer.

I'll leave some comments too so if someone tries to "fix" conversions not showing up they'll hopefully do the right thing as well.

> I think using Sanitizer::getAttribsRegex's value is very reasonable for an
>
> attribute name pattern.

{{done}}

> And I'd like to see the boolean attribute handled via using a (\s=\s+...)?
>
> type of regexp, rather than repeating the attribute name regexp at the end.
>
> Basically I'm trying to nail down the hatches here and try to ensure that we
>
> don't get weird mismatches creeping in here in the future, since this code
>
> turns out to be security-critical.

{{done}}

I also didn't account for self-closing tags, which the sanitizer will emit. So that has the main html matching as:

<(?:\/?[A-Za-z]+(?:\s+[:A-Z\_a-z-.0-9]+(\s\*=\s\*(?:"[^"]\*"|\'[^\']\*\'|[^\'">\s]\*))\*)\*\s\*\/?>|.\*)

I ran that over the source of enwiki and zhwikisource, and it seems to parse everything except comments and CDATA. I'm not sure if we should try to match those.

I also realized we don't match the content of style tags. I think that's something we want to prevent conversion in. Hopefully no one is adjusting their styles based on language variant.

[• csteipp](/p/csteipp/) added a comment.[Oct 29 2014, 11:59 PM2014-10-29 23:59:14 (UTC+0)](#750565)Comment Actions

Created attachment 16951

Matching html elements with > in attribute, etc.

*attachment bug71394-convertere.patch ignored as obsolete*

[tstarling](/p/tstarling/) added a comment.[Nov 4 2014, 12:00 AM2014-11-04 00:00:13 (UTC+0)](#750573)Comment Actions

Nested subpattern repetition is a pretty common example of a regex with pathological performance characteristics, and this patch runs such a regex on the whole document. I wonder if you benchmarked it or tested it for backtrack limit exhaustion?

[tstarling](/p/tstarling/) added a comment.[Nov 4 2014, 1:15 AM2014-11-04 01:15:27 (UTC+0)](#750588)Comment Actions

preg\_match() silently returns false on limit exhaustion, which causes the proposed patch to pass the whole string through. So it's a security issue, not just a performance issue. Example:

ini\_set('pcre.recursion\_limit', 1000);

$s = '-{H|abc123=>zh-cn:" autofocus onfocus="alert(\'be evil\');}- <div ';

for ( $i = 0; $i < 10000; $i++ ) {

```
$s .= "data-$i='x' ";
```

}

$s.= '> {{Special:Contributions|target=>abc123}}';

$out = $wgParser->parse($s, Title::newMainPage(), new ParserOptions);

This test segfaults with pcre.recursion\_limit set to the default, but with it set to 1000 as on WMF, it is an XSS vulnerability.

[• csteipp](/p/csteipp/) added a comment.[Nov 7 2014, 12:28 AM2014-11-07 00:28:55 (UTC+0)](#750595)Comment Actions

Created attachment 17067

Properly remove html from conversion text

After Tim's comments on this bug, we chatted on irc, and he recommended handling as much of the parsing in php as possible, to avoid the pcre limitation.

Since there are html5 parsers in php already available, I modified one to do just the parsing we need, and use that. It would be fairly easy to use this in some of the other places we try to parse html with a regex too.

Running Tim's test against master and this patch, this patch is about 5% faster on my dev system.

**Attached**: bug71394-tokenizer.patch53 KB[Download](https://phab.wmfusercontent.org/file/download/3cf7rer3ofpvepj6ysp2/PHID-FILE-m2hibce2xowurpwshnjx/bug71394-tokenizer.patch)

[tstarling](/p/tstarling/) added a comment.[Nov 12 2014, 3:20 AM2014-11-12 03:20:43 (UTC+0)](#750610)Comment Actions

It's quite a big patch to review in public. Could we maybe do Bawolff's patch in the security release and then put the Html5Tokenizer in Gerrit?

[tstarling](/p/tstarling/) added a comment.[Nov 12 2014, 3:21 AM2014-11-12 03:21:17 (UTC+0)](#750617)Comment Actions

A big patch to review in private, rather.

[• csteipp](/p/csteipp/) added a comment.[Nov 13 2014, 9:22 PM2014-11-13 21:22:22 (UTC+0)](#750629)Comment Actions

I deployed bawolff's patch today:

20:19 csteipp: patched bugs 71111 and 71394 in wmf7 and wmf8

I put the Html5Tokenizer as a draft in gerrit. I didn't want to make it fully public until we either are ready to merge it, or we release bawolff's patch, in case someone digs into why I would be rewriting that. Comments there welcome.

[cscott](/p/cscott/) added a comment.[Nov 13 2014, 10:50 PM2014-11-13 22:50:25 (UTC+0)](#750636)Comment Actions

Chris -- what's the latest version of your regular expression. I just recently fixed a performance regression in a regexp (<https://gist.github.com/gruber/249502#comment-1328838> sigh), perhaps I can refactor a bit to get rid of the backtracking.

[• csteipp](/p/csteipp/) added a comment.[Nov 14 2014, 12:26 AM2014-11-14 00:26:34 (UTC+0)](#750646)Comment Actions

cscott:

$reg = '/' . $codefix . $scriptfix . $stylefix . $prefix .

'<(?:\/?[A-Za-z]+(?:\s+[:A-Z\_a-z-.0-9]+(\s\*=\s\*(?:"[^"]\*"|\'[^\']\*\'|[^\'">\s]\*))\*)\*\s\*\/?>|.\*)|' .

'&[a-zA-Z#][a-z0-9]+;' . $marker . $htmlfix . '/s';

[• csteipp](/p/csteipp/) added a project: [acl\*security](/tag/acl_security/).[Nov 24 2014, 9:27 PM2014-11-24 21:27:42 (UTC+0)](#782084)Restricted Application changed the visibility from "[acl\*security](/tag/acl_security/) (Project)" to "[Custom Policy](/transactions/new/PHID-XACT-TASK-aee2suq7qel72hp/)".  · [View Herald Transcript](/herald/transcript/420969/)[Nov 24 2014, 9:27 PM2014-11-24 21:27:42 (UTC+0)](#782085)Restricted Application changed the edit policy from "[acl\*security](/tag/acl_security/) (Project)" to "[Custom Policy](/transactions/new/PHID-XACT-TASK-xcrlbwa6e6qx4jo/)".  · [View Herald Transcript](/herald/transcript/420969/)[• csteipp](/p/csteipp/) changed the visibility from "[Custom Policy](/transactions/old/PHID-XACT-TASK-5dnnlsjzqyhmsxp/)" to "[Custom Policy](/transactions/new/PHID-XACT-TASK-5dnnlsjzqyhmsxp/)".[Nov 26 2014, 5:56 AM2014-11-26 05:56:31 (UTC+0)](#787302)[• csteipp](/p/csteipp/) added a subscriber: [Grunny](/p/Grunny/).Restricted Application changed the visibility from "[Custom Policy](/transactions/old/PHID-XACT-TASK-reak6lrgv35xydc/)" to "[Custom Policy](/transactions/new/PHID-XACT-TASK-reak6lrgv35xydc/)".  · [View Herald Transcript](/herald/transcript/423798/)[Nov 26 2014, 5:56 AM2014-11-26 05:56:31 (UTC+0)](#787303)Restricted Application changed the edit policy from "[Custom Policy](/transactions/old/PHID-XACT-TASK-pjguaa7qjzoup4t/)" to "[Custom Policy](/transactions/new/PHID-XACT-TASK-pjguaa7qjzoup4t/)".  · [View Herald Transcript](/herald/transcript/423798/)[• csteipp](/p/csteipp/) changed Security from Software security bug to None.[Nov 26 2014, 6:09 AM2014-11-26 06:09:24 (UTC+0)](#787328)[• csteipp](/p/csteipp/) changed the visibility from "[Custom Policy](/transactions/old/PHID-XACT-TASK-uuki7cexi5vvojh/)" to "[Custom Policy](/transactions/new/PHID-XACT-TASK-uuki7cexi5vvojh/)".[Nov 26 2014, 6:23 AM2014-11-26 06:23:27 (UTC+0)](#787335)[Mglaser](/p/Mglaser/) added a comment.[Nov 26 2014, 1:24 PM2014-11-26 13:24:12 (UTC+0)](#787998)Comment Actions

Here are the backports for older release branches. It would be great if anyone could confirm them today before I do the release

bug71394-REL1\_24\_REL1\_23\_REL1\_22.patch1 KB[Download](https://phab.wmfusercontent.org/file/download/nju33356q2t5xlplpzs6/PHID-FILE-mzegb4l5xhbv4eio5fte/bug71394-REL1_24_REL1_23_REL1_22.patch)

bug71394-REL1\_19.patch1 KB[Download](https://phab.wmfusercontent.org/file/download/d2wqg76hebpjehz4bp7s/PHID-FILE-vjwqymdol2djm5ufp7zb/bug71394-REL1_19.patch)

[• csteipp](/p/csteipp/) changed the visibility from "[Custom Policy](/transactions/old/PHID-XACT-TASK-dmxmugziuhtpech/)" to "[Custom Policy](/transactions/new/PHID-XACT-TASK-dmxmugziuhtpech/)".[Nov 26 2014, 6:12 PM2014-11-26 18:12:25 (UTC+0)](#788796)[• csteipp](/p/csteipp/) added a subscriber: [ProgramCeltic](/p/ProgramCeltic/).[Mglaser](/p/Mglaser/) added a comment.[Nov 26 2014, 10:16 PM2014-11-26 22:16:48 (UTC+0)](#789507)Comment Actions

Tested this by calling a few pages, as they all use HTML class in generating their output. On REL1\_24, REL1\_23, REL1\_22 and REL1\_19

[• csteipp](/p/csteipp/) added a comment.[Nov 26 2014, 10:53 PM2014-11-26 22:53:52 (UTC+0)](#789633)Comment Actions
> In [T73394#787998](/T73394#787998), [@Mglaser](/p/Mglaser/) wrote:
>
> Here are the backports for older release branches. It would be great if anyone could confirm them today before I do the release
>
> bug71394-REL1\_24\_REL1\_23\_REL1\_22.patch1 KB[Download](https://phab.wmfusercontent.org/file/download/nju33356q2t5xlplpzs6/PHID-FILE-mzegb4l5xhbv4eio5fte/bug71394-REL1_24_REL1_23_REL1_22.patch)

Issue is fixed with this patch

[• csteipp](/p/csteipp/) added a comment.[Nov 27 2014, 1:23 AM2014-11-27 01:23:52 (UTC+0)](#790270)Comment Actions

I believe Markus is pulling this patch from the release, since it failed some of the unit tests. It would be difficult to get from that patch to an exploit, so I'm not too worried about it, although I'm leaving WMF servers patched. In practicality, the patch doesn't seem to have broken anything.

I thought I had run his patch through all of the unit tests when working on LanguageConverter, but I guess not. Apologies for that.

Of the tests that fail,

* "External link containing a single quote" looked wrong, but chrome and firefox handle it just fine. And the html 5 spec should parse it correctly. [@cscott](/p/cscott/), can you comment on this one?
* "Running test Header with special characters" the test is specifically for what we're trying to do, but looking at the bug and <https://test.wikipedia.org/wiki/Header_with_special_characters> I'm not seeing the issue that the original bug (25462) specified. Was this fixed already by the move to html5? The new values that we generate should be equivalent when this is parsed.

For the rest, the new value is equivalent in html5. Anyone aware of a reason we can't update them?

The failing parser tests are:

Running test External link containing a single quote. (bug 63947)... FAILED!

--- /tmp/mwParser-2129676043-expected 2014-11-26 16:45:26.445386114 -0800

+++ /tmp/mwParser-2129676043-actual 2014-11-26 16:45:26.445386114 -0800

@@ -1,3 +1,3 @@

-<p><a rel="nofollow" class="external autonumber" href="//foo.org/bar'baz">[1]</a>

-</p><p><a rel="nofollow" class="external text" href="//foo.org/bar'baz">bang</a>

+<p><a rel="nofollow" class="external autonumber" href="//foo.org/bar&#39;baz">[1]</a>

+</p><p><a rel="nofollow" class="external text" href="//foo.org/bar&#39;baz">bang</a>

 </p>

Running test Link containing double-single-quotes '' (bug 4598)... FAILED!

--- /tmp/mwParser-1070742882-expected 2014-11-26 16:45:27.336386162 -0800

+++ /tmp/mwParser-1070742882-actual 2014-11-26 16:45:27.336386162 -0800

@@ -1,2 +1,2 @@

-<p><a href="/index.php?title=Lista\_d%27%27e\_paise\_d%27%27o\_munno&amp;action=edit&amp;redlink=1" class="new" title="Lista d''e paise d''o munno (page does not exist)">Lista d''e paise d''o munno</a>

+<p><a href="/index.php?title=Lista\_d%27%27e\_paise\_d%27%27o\_munno&amp;action=edit&amp;redlink=1" class="new" title="Lista d&#39;&#39;e paise d&#39;&#39;o munno (page does not exist)">Lista d''e paise d''o munno</a>

 </p>

Running test Link with double quotes in title part (literal) and alternate part (interpreted)... FAILED!

--- /tmp/mwParser-2035047627-expected 2014-11-26 16:45:27.390386165 -0800

+++ /tmp/mwParser-2035047627-actual 2014-11-26 16:45:27.390386165 -0800

@@ -1,5 +1,5 @@

 <p><a href="/index.php?title=Special:Upload&amp;wpDestFile=Denys\_Savchenko\_%27%27Pentecoste%27%27.jpg" class="new" title="File:Denys Savchenko &#39;&#39;Pentecoste&#39;&#39;.jpg">File:Denys Savchenko <i>Pentecoste</i>.jpg</a>

-</p><p><a href="/index.php?title=%27%27Pentecoste%27%27&amp;action=edit&amp;redlink=1" class="new" title="''Pentecoste'' (page does not exist)">''Pentecoste''</a>

-</p><p><a href="/index.php?title=%27%27Pentecoste%27%27&amp;action=edit&amp;redlink=1" class="new" title="''Pentecoste'' (page does not exist)">Pentecoste</a>

-</p><p><a href="/index.php?title=%27%27Pentecoste%27%27&amp;action=edit&amp;redlink=1" class="new" title="''Pentecoste'' (page does not exist)"><i>Pentecoste</i></a>

+</p><p><a href="/index.php?title=%27%27Pentecoste%27%27&amp;action=edit&amp;redlink=1" class="new" title="&#39;&#39;Pentecoste&#39;&#39; (page does not exist)">''Pentecoste''</a>

+</p><p><a href="/index.php?title=%27%27Pentecoste%27%27&amp;action=edit&amp;redlink=1" class="new" title="&#39;&#39;Pentecoste&#39;&#39; (page does not exist)">Pentecoste</a>

+</p><p><a href="/index.php?title=%27%27Pentecoste%27%27&amp;action=edit&amp;redlink=1" class="new" title="&#39;&#39;Pentecoste&#39;&#39; (page does not exist)"><i>Pentecoste</i></a>

 </p>

Running test Internal link with kaa linktrail with apostrophes (bug 27473)... FAILED!

--- /tmp/mwParser-1736818691-expected 2014-11-26 16:45:28.650386234 -0800

+++ /tmp/mwParser-1736818691-actual 2014-11-26 16:45:28.650386234 -0800

@@ -1,2 +1,2 @@

-<p><a href="/index.php?title=Something&amp;action=edit&amp;redlink=1" class="new" title="Something (bet ele jaratılmag'an)">Something'nice</a>

+<p><a href="/index.php?title=Something&amp;action=edit&amp;redlink=1" class="new" title="Something (bet ele jaratılmag&#39;an)">Something'nice</a>

 </p>

Running test Link to category... FAILED!

--- /tmp/mwParser-259593883-expected 2014-11-26 16:45:38.598386773 -0800

+++ /tmp/mwParser-259593883-actual 2014-11-26 16:45:38.598386773 -0800

@@ -1,2 +1,2 @@

-<p><a href="/wiki/Category:MediaWiki\_User%27s\_Guide" title="Category:MediaWiki User's Guide">Category:MediaWiki User's Guide</a>

+<p><a href="/wiki/Category:MediaWiki\_User%27s\_Guide" title="Category:MediaWiki User&#39;s Guide">Category:MediaWiki User's Guide</a>

 </p>

Running test Category with different sort key... FAILED!

--- /tmp/mwParser-1819840247-expected 2014-11-26 16:45:38.686386778 -0800

+++ /tmp/mwParser-1819840247-actual 2014-11-26 16:45:38.686386778 -0800

@@ -1 +1 @@

-<a href="/wiki/Category:MediaWiki\_User%27s\_Guide" title="Category:MediaWiki User's Guide">MediaWiki User's Guide</a>

+<a href="/wiki/Category:MediaWiki\_User%27s\_Guide" title="Category:MediaWiki User&#039;s Guide">MediaWiki User's Guide</a>

Running test Category with identical sort key... FAILED!

--- /tmp/mwParser-25929600-expected 2014-11-26 16:45:38.725386780 -0800

+++ /tmp/mwParser-25929600-actual 2014-11-26 16:45:38.725386780 -0800

@@ -1 +1 @@

-<a href="/wiki/Category:MediaWiki\_User%27s\_Guide" title="Category:MediaWiki User's Guide">MediaWiki User's Guide</a>

+<a href="/wiki/Category:MediaWiki\_User%27s\_Guide" title="Category:MediaWiki User&#039;s Guide">MediaWiki User's Guide</a>

Running test Header with special characters (bug 25462)... FAILED!

--- /tmp/mwParser-616350119-expected 2014-11-26 16:45:39.143386802 -0800

+++ /tmp/mwParser-616350119-actual 2014-11-26 16:45:39.143386802 -0800

@@ -10,7 +10,7 @@

 </ul>

 </div>

-<h2><span class="mw-headline" id="text\_.3E\_text">text &gt; text</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="/index.php?title=Parser\_test&amp;action=edit&amp;section=1" title="Edit section: text > text">edit</a><span class="mw-editsection-bracket">]</span></span></h2>

+<h2><span class="mw-headline" id="text\_.3E\_text">text &gt; text</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="/index.php?title=Parser\_test&amp;action=edit&amp;section=1" title="Edit section: text &gt; text">edit</a><span class="mw-editsection-bracket">]</span></span></h2>

 <p>section 1

 </p>

 <h2><span class="mw-headline" id="text\_.3C\_text">text &lt; text</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="/index.php?title=Parser\_test&amp;action=edit&amp;section=2" title="Edit section: text &lt; text">edit</a><span class="mw-editsection-bracket">]</span></span></h2>

@@ -19,7 +19,7 @@

 <h2><span class="mw-headline" id="text\_.26\_text">text &amp; text</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="/index.php?title=Parser\_test&amp;action=edit&amp;section=3" title="Edit section: text &amp; text">edit</a><span class="mw-editsection-bracket">]</span></span></h2>

 <p>section 3

 </p>

-<h2><span class="mw-headline" id="text\_.27\_text">text ' text</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="/index.php?title=Parser\_test&amp;action=edit&amp;section=4" title="Edit section: text ' text">edit</a><span class="mw-editsection-bracket">]</span></span></h2>

+<h2><span class="mw-headline" id="text\_.27\_text">text ' text</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="/index.php?title=Parser\_test&amp;action=edit&amp;section=4" title="Edit section: text &#039; text">edit</a><span class="mw-editsection-bracket">]</span></span></h2>

 <p>section 4

 </p>

 <h2><span class="mw-headline" id="text\_.22\_text">text " text</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="/index.php?title=Parser\_test&amp;action=edit&amp;section=5" title="Edit section: text &quot; text">edit</a><span class="mw-editsection-bracket">]</span></span></h2>

[• csteipp](/p/csteipp/) added a comment.[Jan 9 2015, 10:17 PM2015-01-09 22:17:53 (UTC+0)](#967148)Comment Actions
> In [T73394#790270](/T73394#790270), [@csteipp](/p/csteipp/) wrote:
>
> Of the tests that fail,
>
> * "External link containing a single quote" looked wrong, but chrome and firefox handle it just fine. And the html 5 spec should parse it correctly. [@cscott](/p/cscott/), can you comment on this one?
> * "Running test Header with special characters" the test is specifically for what we're trying to do, but looking at the bug and <https://test.wikipedia.org/wiki/Header_with_special_characters> I'm not seeing the issue that the original bug (25462) specified. Was this fixed already by the move to html5? The new values that we generate should be equivalent when this is parsed.

[@cscott](/p/cscott/), is it ok if I update these tests for 63947 to escape 's inside attributes?

[@tstarling](/p/tstarling/), do you know if the tests for bug 25462 are still correct? I can't tell if the original bug was just pre-html5, or if it was being escaped a second time at some point in the past.

[MaxSem](/p/MaxSem/) subscribed.[Jan 10 2015, 12:43 AM2015-01-10 00:43:04 (UTC+0)](#967634)[tstarling](/p/tstarling/) added a comment.[Jan 13 2015, 6:46 AM2015-01-13 06:46:33 (UTC+0)](#972799)Comment Actions

It was double-escaped before the test was introduced, the input text says that explicitly, as does the relevant commit message: [https://www.mediawiki.org/wiki/Special:Code/MediaWiki/74526](https://www.mediawiki.org/wiki/Special%3ACode/MediaWiki/74526) . It's fine to update the expected text for that test.

[• csteipp](/p/csteipp/) added a parent task: [T87275: MediaWiki Security release 1.24.2](/T87275).[Jan 20 2015, 11:08 PM2015-01-20 23:08:50 (UTC+0)](#987725)[• csteipp](/p/csteipp/) added a comment.[Feb 19 2015, 11:32 PM2015-02-19 23:32:13 (UTC+0)](#1051763)Comment Actions

I modified [@Bawolff](/p/Bawolff/)'s patch to only escape > (which is the character causing problems for language converter's current regex), and updated the two parser tests that expected the old output. As I put in the comment, that means the only difference in encoding between the patches (assuming $wgWellFormedXml is set) is ' are not encoded.

I'll add a patch similar to bawolff's publicly after this goes out with the security release, but I think it's going to get resistance from [@Yurik](/p/Yurik/) and mobile, who are working on <https://gerrit.wikimedia.org/r/#/c/182889/>, for example. So entity encoding all " and ' characters I don't think is going to work for them, despite being more conservative from a security perspective.

T73394-escape\_gt.patch3 KB[Download](https://phab.wmfusercontent.org/file/download/vyxm7aac57lljcokqoqi/PHID-FILE-lrvlbwv2yxb5pxtfxvht/T73394-escape_gt.patch)

[Anomie](/p/Anomie/) subscribed.[Feb 23 2015, 8:29 PM2015-02-23 20:29:20 (UTC+0)](#1060228)Comment Actions
> In [T73394#1051763](/T73394#1051763), [@csteipp](/p/csteipp/) wrote:
>
> As I put in the comment, that means the only difference in encoding between the patches (assuming $wgWellFormedXml is set) is ' are not encoded.

That does appear to be the case, yes.

> I'll add a patch similar to bawolff's publicly after this goes out with the security release, but I think it's going to get resistance from [@Yurik](/p/Yurik/) and mobile, who are working on <https://gerrit.wikimedia.org/r/#/c/182889/>, for example. So entity encoding all " and ' characters I don't think is going to work for them, despite being more conservative from a security perspective.

IMO security trumps being "cute" with quotes, but I can't manage to find any way to exploit this with '>' being escaped.

[• csteipp](/p/csteipp/) added a project: [MediaWiki-Core-Team](/tag/mediawiki-core-team/).[Feb 23 2015, 9:58 PM2015-02-23 21:58:15 (UTC+0)](#1060593)[• csteipp](/p/csteipp/) moved this task from [Backlog](/project/board/37/) to [Needs Review/Feedback](/project/board/37/) on the [MediaWiki-Core-Team](/tag/mediawiki-core-team/) board.[• csteipp](/p/csteipp/) added a comment.[Mar 17 2015, 10:43 PM2015-03-17 22:43:58 (UTC+0)](#1126768)Comment Actions

T73394-escape\_gt-wmf21.patch4 KB[Download](https://phab.wmfusercontent.org/file/download/meas22waym3funqf5h2k/PHID-FILE-ztamz2n3p3bl2sji2txh/T73394-escape_gt-wmf21.patch)

Rebased the parser tests and deployed, replacing file\_71394.txt1 KB[Download](https://phab.wmfusercontent.org/file/download/w7dc4dd2akhsxzs34ip2/PHID-FILE-3oea6nvtnlqfhmtqy6dq/file_71394.txt).

[• csteipp](/p/csteipp/) updated the task description. [(Show Details)](/transactions/detail/PHID-XACT-TASK-d32sgifaal3uas7/)[Mar 17 2015, 10:45 PM2015-03-17 22:45:15 (UTC+0)](#1126773)[• csteipp](/p/csteipp/) updated the task description. [(Show Details)](/transactions/detail/PHID-XACT-TASK-uqzrze3niydngpe/)[Mar 18 2015, 12:35 AM2015-03-18 00:35:29 (UTC+0)](#1127053)[• csteipp](/p/csteipp/) added a project: [Vuln-XSS](/tag/vuln-xss/).[• csteipp](/p/csteipp/) added a comment.[Mar 24 2015, 10:35 PM2015-03-24 22:35:27 (UTC+0)](#1146903)Comment Actions

T73394-escape\_gt-REL1\_19.patch3 KB[Download](https://phab.wmfusercontent.org/file/download/xjxy4x2a2w32nmbsndpg/PHID-FILE-s426wb6jxkecdvtgi5yd/T73394-escape_gt-REL1_19.patch) - change in comment style, and differences in parser test output

[• csteipp](/p/csteipp/) updated the task description. [(Show Details)](/transactions/detail/PHID-XACT-TASK-ynahltiexfr37cg/)[Mar 24 2015, 10:36 PM2015-03-24 22:36:36 (UTC+0)](#1146908)[• csteipp](/p/csteipp/) closed this task as Resolved.[Mar 28 2015, 5:22 AM2015-03-28 05:22:44 (UTC+0)](#1159142)[bd808](/p/bd808/) moved this task from [Needs Review/Feedback](/project/board/37/) to [Done](/project/board/37/) on the [MediaWiki-Core-Team](/tag/mediawiki-core-team/) board.[Mar 30 2015, 7:21 PM2015-03-30 19:21:15 (UTC+0)](#1164125)[• csteipp](/p/csteipp/) changed the visibility from "[Custom Policy](/transactions/old/PHID-XACT-TASK-ykzqgudzegexoha/)" to "[Custom Policy](/transactions/new/PHID-XACT-TASK-ykzqgudzegexoha/)".[Mar 31 2015, 12:38 PM2015-03-31 12:38:16 (UTC+0)](#1166663)[• csteipp](/p/csteipp/) changed the visibility from "[Custom Policy](/transactions/old/PHID-XACT-TASK-jnhiiskymgnvtxz/)" to "Public (No Login Required)".[Mar 31 2015, 9:15 PM2015-03-31 21:15:54 (UTC+0)](#1168329)[• csteipp](/p/csteipp/) changed the edit policy from "[Custom Policy](/transactions/old/PHID-XACT-TASK-ps7bd5xdnwtyeic/)" to "All Users".[gerritbot](/p/gerritbot/) subscribed.[Mar 31 2015, 9:22 PM2015-03-31 21:22:25 (UTC+0)](#1168372)Comment Actions

Change 201016 had a related patch set uploaded (by CSteipp):

SECURITY: Escape > in Html::expandAttributes

<https://gerrit.wikimedia.org/r/201016>

[gerritbot](/p/gerritbot/) added a comment.[Mar 31 2015, 9:30 PM2015-03-31 21:30:03 (UTC+0)](#1168412)Comment Actions

Change 201027 had a related patch set uploaded (by CSteipp):

SECURITY: Escape > in Html::expandAttributes

<https://gerrit.wikimedia.org/r/201027>

[gerritbot](/p/gerritbot/) added a comment.[Mar 31 2015, 9:35 PM2015-03-31 21:35:35 (UTC+0)](#1168437)Comment Actions

Change 201037 had a related patch set uploaded (by CSteipp):

SECURITY: Escape > in Html::expandAttributes

<https://gerrit.wikimedia.org/r/201037>

[gerritbot](/p/gerritbot/) added a comment.[Mar 31 2015, 9:59 PM2015-03-31 21:59:54 (UTC+0)](#1168496)Comment Actions

Change 201016 merged by jenkins-bot:

SECURITY: Escape > in Html::expandAttributes

<https://gerrit.wikimedia.org/r/201016>

[• csteipp](/p/csteipp/) mentioned this in [rMW98062a7bb4a8: SECURITY: Escape > in Html::expandAttributes](/rMW98062a7bb4a8f78c77335d608371a8eb5b7ea278).[Mar 31 2015, 10:00 PM2015-03-31 22:00:05 (UTC+0)](#1168499)[gerritbot](/p/gerritbot/) added a comment.[Mar 31 2015, 10:21 PM2015-03-31 22:21:56 (UTC+0)](#1168590)Comment Actions

Change 201027 merged by jenkins-bot:

SECURITY: Escape > in Html::expandAttributes

<https://gerrit.wikimedia.org/r/201027>

[• csteipp](/p/csteipp/) mentioned this in [rMW9004770f60f8: SECURITY: Escape > in Html::expandAttributes](/rMW9004770f60f8bc768bfa2f73fc290ccc4c3a42ce).[Mar 31 2015, 10:22 PM2015-03-31 22:22:16 (UTC+0)](#1168602)[gerritbot](/p/gerritbot/) added a comment.[Mar 31 2015, 10:22 PM2015-03-31 22:22:21 (UTC+0)](#1168615)Comment Actions

Change 201037 merged by jenkins-bot:

SECURITY: Escape > in Html::expandAttributes

<https://gerrit.wikimedia.org/r/201037>

[• csteipp](/p/csteipp/) mentioned this in [rMWb92f883d50f8: SECURITY: Escape > in Html::expandAttributes](/rMWb92f883d50f8883dcfef0b2b68da330bfc3b193e).[Mar 31 2015, 10:22 PM2015-03-31 22:22:48 (UTC+0)](#1168622)[gerritbot](/p/gerritbot/) added a comment.[Apr 1 2015, 4:57 PM2015-04-01 16:57:21 (UTC+0)](#1170742)Comment Actions

Change 201222 had a related patch set uploaded (by CSteipp):

SECURITY: Escape > in Html::expandAttributes

<https://gerrit.wikimedia.org/r/201222>

[gerritbot](/p/gerritbot/) added a comment.[Apr 1 2015, 5:32 PM2015-04-01 17:32:02 (UTC+0)](#1170915)Comment Actions

Change 201222 merged by jenkins-bot:

SECURITY: Escape > in Html::expandAttributes

<https://gerrit.wikimedia.org/r/201222>

[• csteipp](/p/csteipp/) mentioned this in [rMW125ed0e5ff6b: SECURITY: Escape > in Html::expandAttributes](/rMW125ed0e5ff6bff50140eb2b844443c0389d5e583).[Apr 1 2015, 5:32 PM2015-04-01 17:32:18 (UTC+0)](#1170918)[• csteipp](/p/csteipp/) updated the task description. [(Show Details)](/transactions/detail/PHID-XACT-TASK-4hledcqusuulzm3/)[Apr 8 2015, 1:59 AM2015-04-08 01:59:30 (UTC+0)](#1188308)[• dpatrick](/p/dpatrick/) added a project: [Security-Team](/tag/security-team/).[Jun 4 2015, 4:23 PM2015-06-04 16:23:39 (UTC+0)](#1337901)[• dpatrick](/p/dpatrick/) removed a project: [Security-Team](/tag/security-team/).[Jun 4 2015, 4:38 PM2015-06-04 16:38:13 (UTC+0)](#1337996)[• dpatrick](/p/dpatrick/) mentioned this in [T118755: Fix LanguageConverter's parsing](/T118755).[Nov 16 2015, 5:50 PM2015-11-16 17:50:37 (UTC+0)](#1808436)[Bawolff](/p/Bawolff/) mentioned this in [T119158: Language converter: unsafe attribute injection via glossary rules (CVE-2017-8815)](/T119158).[Jan 22 2016, 11:25 AM2016-01-22 11:25:48 (UTC+0)](#1955089)[Bawolff](/p/Bawolff/) mentioned this in [T125163: id attribute on headlines allow raw > [Possible issue in combination with language converter] (CVE-2017-8812)](/T125163).[Jan 28 2016, 11:10 PM2016-01-28 23:10:35 (UTC+0)](#1980136)[Bawolff](/p/Bawolff/) mentioned this in [T57548: Html::expandAttributes can be tricked into omitting necessary quotes](/T57548).[Apr 20 2016, 11:59 PM2016-04-20 23:59:44 (UTC+0)](#2226036)[• chasemp](/p/chasemp/) added a project: [Security](/tag/security/).[Feb 10 2020, 10:50 PM2020-02-10 22:50:49 (UTC+0)](#5867210) · Restricted Application added a subscriber: [Liuxinyu970226](/p/Liuxinyu970226/).  · [View Herald Transcript](/herald/transcript/3518878/)[Feb 10 2020, 10:50 PM2020-02-10 22:50:49 (UTC+0)](#5867217) · [• chasemp](/p/chasemp/) removed a project: [acl\*security](/tag/acl_security/).[Feb 20 2020, 8:11 PM2020-02-20 20:11:41 (UTC+0)](#5903030) · [Aklapper](/p/Aklapper/) removed a subscriber: [Anomie](/p/Anomie/).[Oct 16 2020, 5:38 PM2020-10-16 17:38:21 (UTC+0)](#6552802) · [Log In to Comment](/login/?next=)Content licensed under Creative Commons Attribution-ShareAlike (CC BY-SA) 4.0 unless otherwise noted; code licensed under GNU General Public License (GPL) 2.0 or later and other open source licenses. By using this site, you agree to the Terms of Use, Privacy Policy, and Code of Conduct. · [Wikimedia Foundation](https://wikimediafoundation.org/) · [Privacy Policy](https://foundation.wikimedia.org/wiki/Special%3AMyLanguage/Policy%3ANon-wiki_privacy_policy) · [Code of Conduct](https://www.mediawiki.org/wiki/Special%3AMyLanguage/Code_of_Conduct) · [Terms of Use](https://foundation.wikimedia.org/wiki/Special%3AMyLanguage/Policy%3ATerms_of_Use/Phabricator) · [Disclaimer](https://foundation.wikimedia.org/wiki/Special%3AMyLanguage/Policy%3AGeneral_disclaimer) · [CC-BY-SA](https://creativecommons.org/licenses/by-sa/4.0/) · [GPL](https://www.gnu.org/licenses/old-licenses/gpl-2.0.html) · [Credits](https://www.mediawiki.org/wiki/Phabricator/Credits)

=== Content from security.gentoo.org_ee772b69_20250125_133340.html ===

[![Gentoo](https://assets.gentoo.org/tyrian/v2/site-logo.png)](/ "Back to the homepage")
Security

[**Get Gentoo!**](https://get.gentoo.org/)
gentoo.org sites
[gentoo.org](https://www.gentoo.org/ "Main Gentoo website")
[Wiki](https://wiki.gentoo.org/ "Find and contribute documentation")
[Bugs](https://bugs.gentoo.org/ "Report issues and find common issues")
[Forums](https://forums.gentoo.org/ "Discuss with the community")
[Packages](https://packages.gentoo.org/ "Find software for your Gentoo")

[Planet](https://planet.gentoo.org/ "Find out what's going on in the developer community")
[Archives](https://archives.gentoo.org/ "Read up on past discussions")
[Sources](https://sources.gentoo.org/ "Browse our source code")

[Infra Status](https://infra-status.gentoo.org/ "Get updates on the services provided by Gentoo")

* [Home](/)
* [Stay informed](/subscribe)
* [Advisories](/glsa)

# MediaWiki: Multiple vulnerabilities — GLSA **201510-05**

Multiple vulnerabilities have been found in MediaWiki, the worst of
which may allow remote attackers to cause a Denial of Service.

### Affected packages

| Package | **www-apps/mediawiki** on all architectures |
| --- | --- |
| Affected versions | < **1.25.2** |
| Unaffected versions | >= **1.25.2**revision >= **1.24.3**revision >= **1.23.10** |

### Background

MediaWiki is a collaborative editing software used by large projects
such as Wikipedia.

### Description

Multiple vulnerabilities have been discovered in MediaWiki. Please
review the CVE identifiers referenced below for details.

### Impact

A remote attacker may be able to create a Denial of Service condition,
obtain sensitive information, bypass security restrictions, and inject
arbitrary web script or HTML.

### Workaround

There is no known workaround at this time.

### Resolution

All MediaWiki 1.25 users should upgrade to the latest version:

```
 # emerge --sync
 # emerge --ask --oneshot --verbose ">=www-apps/mediawiki-1.25.2"

```

All MediaWiki 1.24 users should upgrade to the latest version:

```
 # emerge --sync
 # emerge --ask --oneshot --verbose ">=www-apps/mediawiki-1.24.3"

```

All MediaWiki 1.23 users should upgrade to the latest version:

```
 # emerge --sync
 # emerge --ask --oneshot --verbose ">=www-apps/mediawiki-1.23.10"

```
### References

* [CVE-2015-2931](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2015-2931)
* [CVE-2015-2932](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2015-2932)
* [CVE-2015-2933](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2015-2933)
* [CVE-2015-2934](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2015-2934)
* [CVE-2015-2935](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2015-2935)
* [CVE-2015-2936](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2015-2936)
* [CVE-2015-2937](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2015-2937)
* [CVE-2015-2938](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2015-2938)
* [CVE-2015-2939](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2015-2939)
* [CVE-2015-2940](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2015-2940)
* [CVE-2015-2941](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2015-2941)
* [CVE-2015-2942](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2015-2942)
* [CVE-2015-6728](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2015-6728)
* [CVE-2015-6729](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2015-6729)
* [CVE-2015-6730](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2015-6730)
* [CVE-2015-6731](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2015-6731)
* [CVE-2015-6732](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2015-6732)
* [CVE-2015-6733](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2015-6733)
* [CVE-2015-6734](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2015-6734)
* [CVE-2015-6735](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2015-6735)
* [CVE-2015-6736](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2015-6736)
* [CVE-2015-6737](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2015-6737)

**Release date**

October 31, 2015

**Latest revision**

October 31, 2015: 1

**Severity**

normal

**Exploitable**

remote

**Bugzilla entries**

* [545944](https://bugs.gentoo.org/show_bug.cgi?id=545944)
* [557844](https://bugs.gentoo.org/show_bug.cgi?id=557844)

### Questions or comments?

Please feel free to contact us.

**© 2001–2020 Gentoo Foundation, Inc.**



=== Content from www.mandriva.com_3c30de47_20250125_133334.html ===


* [Tuxedo.org](https://tuxedo.org/ "Go to: Tuxedo")
* Store
* Mandriva Linux
* Enterprise Solutions
* Contact Us
* Language ![](/sites/all/themes/mandriva_customer/images/arrow-grey-bottom.gif)
  + English (International)
  + Français
  + Ð ÑÑÑÐºÐ¸Ð¹

# [Mandriva](/mandriva/)

* Download
* Mandriva Linux
* Community
* Help

## One

### The Linux desktopthat's easy to try and easy to keep

Download
![Mandriva One](/sites/all/themes/mandriva_customer/images/front/packshot_Mandriva_One.png)

## Powerpack

### Mandriva Linux- and more

Download
![Mandriva Linux Powerpack](/sites/all/themes/mandriva_customer/images/front/en-49.png)

## Mandriva Flash

### The mobile and installable Linux desktopon a USB key

Buy on Store
![Mandriva Flash](/sites/all/themes/mandriva_customer/images/front/mandriva-flash2.png)

### [Community](community)

* User Forums
* Support - FAQ
* Free Software
* Become a member

### Enterprise Solutions

* Enterprise Linux Products
* Asset Management Solution
* Professional Services
* Support & Maintenance

* Go to site »

### Mandriva Partners

* Worldwide offices
* Partner Program
* Technology Partners
* OEM
* Classmate PC with Mandriva Linux

### News

* Mandriva presents the launch of its new mobile desktop: Mandriva Flash 2008 Spring
* Speaking about Mandriva Linux 2008 Spring in media
* Speaking about Mandriva Linux 2008 Spring in media
* Mandriva presents its latest distribution: Mandriva Linux 2008 Spring
* Mandriva and Novatice Technologies present Edutice, The ready to use solution dedicated to educationand multimedia spaces
* # [Top 50 Online Casinos UK in 2023](https://montycasinos.com/online-casinos/)

more

* Download
  + Mandriva Linux 2008
  + Writing an ISO image
* Mandriva Linux
  + One
  + Powerpack
  + Mandriva Flash
* Community
  + Start
  + Register
  + Stay informed
  + Participate
  + Free software
* Help
  + Getting help
  + Knowledge Base
  + Documentation
  + Forums
  + Support Requests
  + Customer Care
  + Enterprise Support
* Enterprise Solutions
  + Products
  + Support
  + Services
  + Partners
  + Go to site »

Language
English (International)
Français
Ð ÑÑÑÐºÐ¸Ð¹

* © 2007 Mandriva S.A.
* About Us
* Legal Information
* Privacy Policy
* Contact Us



=== Content from gerrit.wikimedia.org_3b9cec44_20250126_085819.html ===




=== Content from lists.wikimedia.org_c65686ea_20250125_133336.html ===


[lists.wikimedia.org](/hyperkitty/)

[Sign In](/accounts/login/?next=/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/message/OTOGQLR6TBG7FPQ2OKWLZ4LKLLR5UAKN/)
[Sign Up](/accounts/signup/?next=/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/message/OTOGQLR6TBG7FPQ2OKWLZ4LKLLR5UAKN/)

* [Sign In](/accounts/login/?next=/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/message/OTOGQLR6TBG7FPQ2OKWLZ4LKLLR5UAKN/)
* [Sign Up](/accounts/signup/?next=/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/message/OTOGQLR6TBG7FPQ2OKWLZ4LKLLR5UAKN/)

* [Manage this list](/postorius/lists/mediawiki-announce.lists.wikimedia.org/)

×
#### Keyboard Shortcuts

### Thread View

* `j`: Next unread message
* `k`: Previous unread message
* `j a`: Jump to all threads* `j l`: Jump to MailingList overview

### 2025

* [January](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2025/1/)

### 2024

* [December](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2024/12/)
* [November](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2024/11/)
* [October](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2024/10/)
* [September](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2024/9/)
* [August](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2024/8/)
* [July](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2024/7/)
* [June](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2024/6/)
* [May](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2024/5/)
* [April](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2024/4/)
* [March](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2024/3/)
* [February](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2024/2/)
* [January](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2024/1/)

### 2023

* [December](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2023/12/)
* [November](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2023/11/)
* [October](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2023/10/)
* [September](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2023/9/)
* [August](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2023/8/)
* [July](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2023/7/)
* [June](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2023/6/)
* [May](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2023/5/)
* [April](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2023/4/)
* [March](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2023/3/)
* [February](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2023/2/)
* [January](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2023/1/)

### 2022

* [December](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2022/12/)
* [November](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2022/11/)
* [October](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2022/10/)
* [September](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2022/9/)
* [August](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2022/8/)
* [July](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2022/7/)
* [June](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2022/6/)
* [May](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2022/5/)
* [April](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2022/4/)
* [March](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2022/3/)
* [February](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2022/2/)
* [January](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2022/1/)

### 2021

* [December](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2021/12/)
* [November](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2021/11/)
* [October](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2021/10/)
* [September](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2021/9/)
* [August](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2021/8/)
* [July](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2021/7/)
* [June](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2021/6/)
* [May](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2021/5/)
* [April](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2021/4/)
* [March](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2021/3/)
* [February](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2021/2/)
* [January](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2021/1/)

### 2020

* [December](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2020/12/)
* [November](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2020/11/)
* [October](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2020/10/)
* [September](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2020/9/)
* [August](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2020/8/)
* [July](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2020/7/)
* [June](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2020/6/)
* [May](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2020/5/)
* [April](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2020/4/)
* [March](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2020/3/)
* [February](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2020/2/)
* [January](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2020/1/)

### 2019

* [December](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2019/12/)
* [November](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2019/11/)
* [October](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2019/10/)
* [September](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2019/9/)
* [August](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2019/8/)
* [July](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2019/7/)
* [June](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2019/6/)
* [May](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2019/5/)
* [April](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2019/4/)
* [March](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2019/3/)
* [February](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2019/2/)
* [January](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2019/1/)

### 2018

* [December](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2018/12/)
* [November](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2018/11/)
* [October](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2018/10/)
* [September](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2018/9/)
* [August](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2018/8/)
* [July](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2018/7/)
* [June](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2018/6/)
* [May](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2018/5/)
* [April](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2018/4/)
* [March](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2018/3/)
* [February](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2018/2/)
* [January](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2018/1/)

### 2017

* [December](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2017/12/)
* [November](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2017/11/)
* [October](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2017/10/)
* [September](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2017/9/)
* [August](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2017/8/)
* [July](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2017/7/)
* [June](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2017/6/)
* [May](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2017/5/)
* [April](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2017/4/)
* [March](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2017/3/)
* [February](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2017/2/)
* [January](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2017/1/)

### 2016

* [December](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2016/12/)
* [November](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2016/11/)
* [October](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2016/10/)
* [September](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2016/9/)
* [August](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2016/8/)
* [July](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2016/7/)
* [June](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2016/6/)
* [May](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2016/5/)
* [April](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2016/4/)
* [March](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2016/3/)
* [February](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2016/2/)
* [January](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2016/1/)

### 2015

* [December](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2015/12/)
* [November](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2015/11/)
* [October](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2015/10/)
* [September](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2015/9/)
* [August](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2015/8/)
* [July](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2015/7/)
* [June](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2015/6/)
* [May](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2015/5/)
* [April](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2015/4/)
* [March](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2015/3/)
* [February](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2015/2/)
* [January](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2015/1/)

### 2014

* [December](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2014/12/)
* [November](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2014/11/)
* [October](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2014/10/)
* [September](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2014/9/)
* [August](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2014/8/)
* [July](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2014/7/)
* [June](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2014/6/)
* [May](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2014/5/)
* [April](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2014/4/)
* [March](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2014/3/)
* [February](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2014/2/)
* [January](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2014/1/)

### 2013

* [December](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2013/12/)
* [November](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2013/11/)
* [October](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2013/10/)
* [September](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2013/9/)
* [August](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2013/8/)
* [July](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2013/7/)
* [June](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2013/6/)
* [May](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2013/5/)
* [April](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2013/4/)
* [March](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2013/3/)
* [February](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2013/2/)
* [January](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2013/1/)

### 2012

* [December](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2012/12/)
* [November](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2012/11/)
* [October](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2012/10/)
* [September](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2012/9/)
* [August](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2012/8/)
* [July](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2012/7/)
* [June](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2012/6/)
* [May](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2012/5/)
* [April](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2012/4/)
* [March](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2012/3/)
* [February](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2012/2/)
* [January](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2012/1/)

### 2011

* [December](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2011/12/)
* [November](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2011/11/)
* [October](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2011/10/)
* [September](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2011/9/)
* [August](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2011/8/)
* [July](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2011/7/)
* [June](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2011/6/)
* [May](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2011/5/)
* [April](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2011/4/)
* [March](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2011/3/)
* [February](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2011/2/)
* [January](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2011/1/)

### 2010

* [December](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2010/12/)
* [November](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2010/11/)
* [October](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2010/10/)
* [September](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2010/9/)
* [August](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2010/8/)
* [July](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2010/7/)
* [June](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2010/6/)
* [May](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2010/5/)
* [April](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2010/4/)
* [March](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2010/3/)
* [February](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2010/2/)
* [January](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2010/1/)

### 2009

* [December](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2009/12/)
* [November](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2009/11/)
* [October](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2009/10/)
* [September](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2009/9/)
* [August](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2009/8/)
* [July](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2009/7/)
* [June](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2009/6/)
* [May](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2009/5/)
* [April](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2009/4/)
* [March](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2009/3/)
* [February](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2009/2/)
* [January](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2009/1/)

### 2008

* [December](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2008/12/)
* [November](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2008/11/)
* [October](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2008/10/)
* [September](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2008/9/)
* [August](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2008/8/)
* [July](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2008/7/)
* [June](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2008/6/)
* [May](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2008/5/)
* [April](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2008/4/)
* [March](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2008/3/)
* [February](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2008/2/)
* [January](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2008/1/)

### 2007

* [December](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2007/12/)
* [November](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2007/11/)
* [October](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2007/10/)
* [September](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2007/9/)
* [August](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2007/8/)
* [July](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2007/7/)
* [June](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2007/6/)
* [May](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2007/5/)
* [April](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2007/4/)
* [March](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2007/3/)
* [February](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2007/2/)
* [January](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2007/1/)

### 2006

* [December](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2006/12/)
* [November](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2006/11/)
* [October](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2006/10/)
* [September](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2006/9/)
* [August](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2006/8/)
* [July](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2006/7/)
* [June](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2006/6/)
* [May](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2006/5/)
* [April](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2006/4/)
* [March](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2006/3/)
* [February](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2006/2/)
* [January](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2006/1/)

### 2005

* [December](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2005/12/)
* [November](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2005/11/)
* [October](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2005/10/)
* [September](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2005/9/)
* [August](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2005/8/)
* [July](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2005/7/)
* [June](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2005/6/)
* [May](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2005/5/)
* [April](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2005/4/)
* [March](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2005/3/)
* [February](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2005/2/)
* [January](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2005/1/)

### 2004

* [December](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2004/12/)

[List overview](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/)

[Download](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/export/mediawiki-announce%40lists.wikimedia.org-OTOGQLR6TBG7FPQ2OKWLZ4LKLLR5UAKN.mbox.gz?message=OTOGQLR6TBG7FPQ2OKWLZ4LKLLR5UAKN "This message in gzipped mbox format")

[thread](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/thread/OTOGQLR6TBG7FPQ2OKWLZ4LKLLR5UAKN/#OTOGQLR6TBG7FPQ2OKWLZ4LKLLR5UAKN)

# [MediaWiki-announce] MediaWiki Security and Maintenance Releases: 1.19.24, 1.23.9, and 1.24.2

[Chris Steipp](/hyperkitty/users/dd272b532a8d4667a37daa128483ef95/ "See the profile for Chris Steipp")

31 Mar
2015

31 Mar
'15

11:20 p.m.

I would like to announce the release of MediaWiki 1.24.2, 1.23.9 and
1.19.24. These releases fix 10 security issues, in addition to other bug
fixes. Download links are given at the end of this email.

== Security fixes ==

\* iSEC Partners discovered a way to circumvent the SVG MIME blacklist for
embedded resources (iSEC-WMF1214-11). This allowed an attacker to embed
JavaScript in the SVG. The issue was additionally identified by Mario
Heiderich / Cure53. MIME types are now whitelisted.
<https://phabricator.wikimedia.org/T85850>

\* MediaWiki user Bawolff pointed out that the SVG filter to prevent
injecting JavaScript using animate elements was incorrect.
<https://phabricator.wikimedia.org/T86711>

\* MediaWiki user Bawolff reported a stored XSS vulnerability due to the way
attributes were expanded in MediaWiki's Html class, in combination with
LanguageConverter substitutions.
<https://phabricator.wikimedia.org/T73394>

\* Internal review discovered that MediaWiki's SVG filtering could be
bypassed with entity encoding under the Zend interpreter. This could be
used to inject JavaScript. This issue was also discovered by Mario Gomes
from Beyond Security.
<https://phabricator.wikimedia.org/T88310>

\* iSEC Partners discovered a XSS vulnerability in the way api errors were
reflected when running under HHVM versions before 3.6.1 (iSEC-WMF1214-8).
MediaWiki now detects and mitigates this issue on older versions of HHVM.
<https://phabricator.wikimedia.org/T85851>

\* Internal review and iSEC Partners discovered (iSEC-WMF1214-1) that
MediaWiki versions using PBKDF2 for password hashing (the default since
1.24) are vulnerable to DoS attacks using extremely long passwords.
<https://phabricator.wikimedia.org/T64685>

\* iSEC Partners discovered that MediaWiki's SVG and XMP parsing, running
under HHVM, was susceptible to "Billion Laughs" DoS attacks
(iSEC-WMF1214-13).
<https://phabricator.wikimedia.org/T85848>

\* Internal review found that MediaWiki is vulnerable to "Quadratic Blowup"
DoS attacks, under both HHVM and Zend PHP.
<https://phabricator.wikimedia.org/T71210>

\* iSEC Partners discovered a way to bypass the style filtering for SVG
files (iSEC-WMF1214-3). This could violate the anonymity of users viewing
the SVG.
<https://phabricator.wikimedia.org/T85349>

\* iSEC Partners reported that the MediaWiki feature allowing a user to
preview another user's custom JavaScript could be abused for privilege
escalation (iSEC-WMF1214-10). This feature has been removed.
<https://phabricator.wikimedia.org/T85855>

Additionally, the following extensions have been updated to fix security
issues:

\* Extension:Scribunto - MediaWiki user Jackmcbarn discovered that function
names were not sanitized in Lua error backtraces, which could lead to XSS.
<https://phabricator.wikimedia.org/T85113>

\* Extension:CheckUser - iSEC Partners discovered that the CheckUser
extension did not prevent CSRF attacks on the form allowing checkusers to
look up sensitive information about other users (iSEC-WMF1214-6). Since the
use of CheckUser is logged, the CSRF could be abused to defame a trusted
user or flood the logs with noise.
<https://phabricator.wikimedia.org/T85858>

== Bug fixes ==

=== 1.24 ===

\* Fix case of SpecialAllPages/SpecialAllMessages in SpecialPageFactory to
fix loading these special pages when $wgAutoloadAttemptLowercase is false.
\* (bug T76254) Fix deleting of pages with PostgreSQL. Requires a schema
change and running update.php to fix.

== 1.23 & 1.24 ==

\* (bug T70087) Fix Special:ActiveUsers page for installations using
PostgreSQL.

\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*

Full release notes:
<https://www.mediawiki.org/wiki/Release_notes/1.24>
<https://www.mediawiki.org/wiki/Release_notes/1.23>
<https://www.mediawiki.org/wiki/Release_notes/1.19>

Download:
<http://download.wikimedia.org/mediawiki/1.24/mediawiki-1.24.2.tar.gz>
<http://download.wikimedia.org/mediawiki/1.23/mediawiki-1.23.9.tar.gz>
<http://download.wikimedia.org/mediawiki/1.19/mediawiki-1.19.24.tar.gz>

Patch to previous version:
<http://download.wikimedia.org/mediawiki/1.24/mediawiki-1.24.2.patch.gz>
<http://download.wikimedia.org/mediawiki/1.23/mediawiki-1.23.9.patch.gz>
<http://download.wikimedia.org/mediawiki/1.19/mediawiki-1.19.24.patch.gz>

GPG signatures:
<http://download.wikimedia.org/mediawiki/1.24/mediawiki-1.24.2.tar.gz.sig>
<http://download.wikimedia.org/mediawiki/1.24/mediawiki-1.24.2.patch.gz.sig>
<http://download.wikimedia.org/mediawiki/1.23/mediawiki-1.23.9.tar.gz.sig>
<http://download.wikimedia.org/mediawiki/1.23/mediawiki-1.23.9.patch.gz.sig>
<http://download.wikimedia.org/mediawiki/1.19/mediawiki-1.19.24.tar.gz.sig>
<http://download.wikimedia.org/mediawiki/1.19/mediawiki-1.19.24.patch.gz.sig>

Extensions:
[http://www.mediawiki.org/wiki/Extension:Scribunto](http://www.mediawiki.org/wiki/Extension%3AScribunto)
[http://www.mediawiki.org/wiki/Extension:CheckUser](http://www.mediawiki.org/wiki/Extension%3ACheckUser)

Public keys:
<https://www.mediawiki.org/keys/keys.html>

[0](#like "You must be logged-in to vote.")
[0](#dislike "You must be logged-in to vote.")

Reply

[Back to the thread](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/thread/OTOGQLR6TBG7FPQ2OKWLZ4LKLLR5UAKN/#OTOGQLR6TBG7FPQ2OKWLZ4LKLLR5UAKN)

[Back to the list](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/)

Powered by [HyperKitty](http://hyperkitty.readthedocs.org) version 1.3.7.



=== Content from www.openwall.com_697f15b9_20250125_133335.html ===


| [Openwall](/) * [Products](/)   + [Openwall GNU/\*/Linux   *server OS*](/Owl/)+ [Linux Kernel Runtime Guard](/lkrg/)+ [John the Ripper   *password cracker*](/john/)         - [Free & Open Source for any platform](/john/)- [in the cloud](/john/cloud/)- [Pro for Linux](/john/pro/linux/)- [Pro for macOS](/john/pro/macosx/)+ [Wordlists   *for password cracking*](/wordlists/)+ [passwdqc   *policy enforcement*](/passwdqc/)             - [Free & Open Source for Unix](/passwdqc/)- [Pro for Windows (Active Directory)](/passwdqc/windows/)+ [yescrypt   *KDF & password hashing*](/yescrypt/)+ [yespower   *Proof-of-Work (PoW)*](/yespower/)+ [crypt\_blowfish   *password hashing*](/crypt/)+ [phpass   *ditto in PHP*](/phpass/)+ [tcb   *better password shadowing*](/tcb/)+ [Pluggable Authentication Modules](/pam/)+ [scanlogd   *port scan detector*](/scanlogd/)+ [popa3d   *tiny POP3 daemon*](/popa3d/)+ [blists   *web interface to mailing lists*](/blists/)+ [msulogin   *single user mode login*](/msulogin/)+ [php\_mt\_seed   *mt\_rand() cracker*](/php_mt_seed/)* [Services](/services/)* Publications       + [Articles](/articles/)+ [Presentations](/presentations/)* Resources         + [Mailing lists](/lists/)+ [Community wiki](https://openwall.info/wiki/)+ [Source code repositories (GitHub)](https://github.com/openwall)+ [Source code repositories (CVSweb)](https://cvsweb.openwall.com)+ [File archive & mirrors](/mirrors/)+ [How to verify digital signatures](/signatures/)+ [OVE IDs](/ove/)* [What's new](/news) | |
| --- | --- |

| | [Follow @Openwall on Twitter for new release announcements and other news](https://twitter.com/openwall) | | --- | |
| --- | --- |

[[<prev]](2) [[next>]](4) [[<thread-prev]](../../../2015/04/01/1) [[day]](.) [[month]](..) [[year]](../..) [[list]](../../..)
```

Message-Id: <20150407073412.354C26C0003@smtpvmsrv1.mitre.org>
Date: Tue,  7 Apr 2015 03:34:12 -0400 (EDT)
From: cve-assign@...re.org
To: csteipp@...imedia.org
Cc: cve-assign@...re.org, oss-security@...ts.openwall.com
Subject: Re: CVE request: MediaWiki 1.24.2/1.23.9/1.19.24

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

> * iSEC Partners discovered a way to circumvent the SVG MIME blacklist for
> embedded resources (iSEC-WMF1214-11). This allowed an attacker to embed
> JavaScript in the SVG. The issue was additionally identified by Mario
> Heiderich / Cure53. MIME types are now whitelisted.
> <https://phabricator.wikimedia.org/T85850>

Use CVE-2015-2931 for this issue involving an incomplete list of
disallowed MIME types for data: URIs (the application/xml type wasn't
in this list). In other words, CVE-2015-2931 does not refer more
generally to the desirability of the "MIME types are now whitelisted"
decision.

> * MediaWiki user Bawolff pointed out that the SVG filter to prevent
> injecting JavaScript using animate elements was incorrect.
> <https://phabricator.wikimedia.org/T86711>

Use CVE-2015-2932 for this issue involving an incomplete list of
dangerous parts of HTML5. (The list is supposed to include all uses of
'animate attributename="xlink:href"' in SVG documents.)

> * MediaWiki user Bawolff reported a stored XSS vulnerability due to the way
> attributes were expanded in MediaWiki's Html class, in combination with
> LanguageConverter substitutions.
> <https://phabricator.wikimedia.org/T73394>

Use CVE-2015-2933 for this XSS issue.

Also, this part of T73394 seems potentially interesting although it is
apparently neither a MediaWiki bug nor a PHP bug:

  <https://phabricator.wikimedia.org/T73394#750588>
  preg_match() silently returns false on limit exhaustion

In other words, if a PHP application uses
"ini_set('pcre.recursion_limit'" and does not properly handle the
preg_match return value, then a hard-to-find XSS vulnerability might
exist.

> * Internal review discovered that MediaWiki's SVG filtering could be
> bypassed with entity encoding under the Zend interpreter. This could be
> used to inject JavaScript. This issue was also discovered by Mario Gomes /
> Beyond Security.
> <https://phabricator.wikimedia.org/T88310>

Use CVE-2015-2934 for this interaction issue in which (roughly
speaking) secure operation of MediaWiki had been relying on a libxml
behavior that was removed for unrelated security reasons. (In other
words, it's apparently an usual type of vulnerability whose avoidance
requires studying all "improvements" in new releases of library code,
and determining whether any of them have unintended adverse
consequences.)

> * iSEC Partners discovered a way to bypass the style filtering for SVG
> files (iSEC-WMF1214-3) to load external resource. This could violate the
> anonymity of users viewing the SVG.
> <https://phabricator.wikimedia.org/T85349>

Use CVE-2015-2935 for this issue of information leaks observable in
log files on an attacker-controlled web server. This issue exists
because of an incomplete fix for CVE-2014-7199.

> * Internal review and iSEC Partners discovered (iSEC-WMF1214-1) that
> MediaWiki versions using PBKDF2 for password hashing (the default since
> 1.24) are vulnerable to DoS attacks using extremely long passwords.
> <https://phabricator.wikimedia.org/T64685>

Use CVE-2015-2936 for this vulnerability with a CPU consumption impact.

> * Internal review found that MediaWiki is vulnerable to "Quadratic Blowup"
> DoS attacks, under both HHVM and Zend PHP.
> <https://phabricator.wikimedia.org/T71210>

Use CVE-2015-2937. This is a quadratic issue and isn't the same as the
CVE-2015-2942 exponential issue affecting only HHVM (see below).

> * iSEC Partners reported that the MediaWiki feature allowing a user to
> preview another user's custom JavaScript could be abused for privilege
> escalation (iSEC-WMF1214-10). This feature has been removed.
> <https://phabricator.wikimedia.org/T85855>

Use CVE-2015-2938 for this XSS issue.

> * Extension:Scribunto - MediaWiki user Jackmcbarn discovered that function
> names were sanitized in Lua error backtraces, which could lead to XSS.
> <https://phabricator.wikimedia.org/T85113>

Use CVE-2015-2939 for this XSS issue. In the above quoted text, "were
sanitized" should be "were not sanitized" instead.

> * Extension:CheckUser - iSEC Partners discovered that the CheckUser
> extension did not prevent CSRF attacks on the form allowing checkusers to
> look up sensitive information about other users (iSEC-WMF1214-6). Since the
> use of CheckUser is logged, the CSRF could be abused to defame a trusted
> user or flood the logs with noise.
> <https://phabricator.wikimedia.org/T85858>

For purposes of CVE, we'll accept reports from a software's author
stating that there is a CSRF vulnerability for a request to read data.
Use CVE-2015-2940. This does not mean that similar reports from
arbitrary researchers about arbitrary products would have CVE IDs
assigned. For many products, the implied security policy does not
include a CSRF protection mechanism that prevents all
undesirable/confusing log entries.

> I'm not sure if CVE's are assigned for specific runtime
> configurations? For MediaWiki, we say that HHVM support is experimental,
> although we do run Wikipedia on it.

There isn't a general rule that CVE IDs are assigned for arbitrary
unsupported deployments of a product. Our impression is that users may
realistically decide that the HHVM support is "complete enough" for
their purposes. Also, in some cases, HHVM support is referenced or
documented in places that don't directly discuss the experimental
nature, such as on the <http://www.mediawiki.org/wiki/HHVM> and
[http://www.mediawiki.org/wiki/Manual:How_to_debug](http://www.mediawiki.org/wiki/Manual%3AHow_to_debug) pages. So, here, we
do want to assign CVE IDs applicable only to HHVM deployments.

> * iSEC Partners discovered a XSS vulnerability in the way api errors were
> reflected under HHVM versions before 3.6.1 (iSEC-WMF1214-8). MediaWiki now
> detects and mitigates this issue on older versions of HHVM.
> <https://phabricator.wikimedia.org/T85851>

It seems that the major concern here is the HHVM vulnerability fixed
by the
<https://github.com/facebook/hhvm/commit/324701c9fd31beb4f070f1b7ef78b115fbdfec34>
commit. Use CVE-2014-9714 for that HHVM vulnerability.

As far as we can tell, T85851 is recommending
<https://gerrit.wikimedia.org/r/#/c/201020/1/includes/api/ApiFormatWddx.php,unified>
as a vulnerability fix for MediaWiki deployments that use an older
version of HHVM. Use CVE-2015-2941 for this MediaWiki vulnerability in
which unsafe calls to wddx_serialize_value can occur.

> * iSEC Partners discovered that MediaWiki's SVG and XMP parsing running
> under HHVM was susceptible to "Billion Laughs" DoS attacks
> (iSEC-WMF1214-13).
> <https://phabricator.wikimedia.org/T85848>

Use CVE-2015-2942 for this exponential issue, which is different from
the CVE-2015-2937 quadratic issue mentioned above.

- --
CVE assignment team, MITRE CVE Numbering Authority
M/S M300
202 Burlington Road, Bedford, MA 01730 USA
[ PGP key available through <http://cve.mitre.org/cve/request_id.html> ]
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.14 (SunOS)

iQEcBAEBAgAGBQJVI4etAAoJEKllVAevmvmsxk0H/R0orjbDyN56mEOJ9a/rlowS
D5cuaiDe4dzWbqEOzii8g+3d2iVsb1BUJHxfuGOFjf0zstb2KhJP5iaKN6hsXcHn
HKdtHE8uKMzs5DYxxeGsbphrp/J/Uff1+G7vwPmBTG3Z+tcLNXstuoIO18Pg3HuP
yT/P37KKJvlyhn5l325M4h0ln3kRu7egDHEctsJGNnb0IHoSoT8VmaiMYs/OwdP/
GT0XZVc7iNIBpXx0Ao03HxaSMgEfFs5X8PNnO95j9V9ngcP7zKQVT9ycsBHAhawP
dP+etPml55OJJKViqVZji5Dvv6BxZWnBACgzDI9ZcNFSHSykgr6Y3E+6nxmEKWY=
=vxIE
-----END PGP SIGNATURE-----

```

[Powered by blists](https://www.openwall.com/blists/) - [more mailing lists](https://lists.openwall.net)

Please check out the
[Open Source Software Security Wiki](https://oss-security.openwall.org/wiki/), which is counterpart to this
[mailing list](https://oss-security.openwall.org/wiki/mailing-lists/oss-security).

Confused about [mailing lists](/lists/) and their use?
[Read about mailing lists on Wikipedia](https://en.wikipedia.org/wiki/Electronic_mailing_list)
and check out these
[guidelines on proper formatting of your messages](https://www.complang.tuwien.ac.at/anton/mail-news-errors.html).


