=== Content from lists.torproject.org_6e87df7a_20250125_010603.html ===

# [tor-talk] Pre-announcement: source for Tor 0.2.4.26 and 0.2.5.11 is available.

**Nick Mathewson**
nickm at freehaven.net

*Tue Mar 17 14:30:35 UTC 2015*

* Previous message: [[tor-talk] RAPTOR: Routing Attacks on Privacy in Tor](037293.html)
* Next message: [[tor-talk] Pre-announcement: source for Tor 0.2.4.26 and 0.2.5.11 is available.](037304.html)
* **Messages sorted by:**
  [[ date ]](date.html#37281)
  [[ thread ]](thread.html#37281)
  [[ subject ]](subject.html#37281)
  [[ author ]](author.html#37281)

---

```
Hi, all!

Usual practice when a _stable_ release comes out is to wait for
packages to be built and become available before I send it to to the
blog and the mailing lists.  But usually when I do that, I get a lot
of questions in the meantime about "hey why didn't you announce the
new release?"  So here's a pre-announcement!

You can get the source for these releases at
   <https://dist.torproject.org/>

Once again, I'll be sending more formal announcements to more places
once there's a

Here are the relevant changelogs -- all changes in these releases are
also in 0.2.6:

Changes in version 0.2.5.11 - 2015-03-17
  Tor 0.2.5.11 is the second stable release in the 0.2.5 series.

  It backports several bugfixes from the 0.2.6 branch, including a
  couple of medium-level security fixes for relays and exit nodes.
  It also updates the list of directory authorities.

  o Directory authority changes:
    - Remove turtles as a directory authority.
    - Add longclaw as a new (v3) directory authority. This implements
      ticket 13296. This keeps the directory authority count at 9.
    - The directory authority Faravahar has a new IP address. This
      closes ticket 14487.

  o Major bugfixes (crash, OSX, security):
    - Fix a remote denial-of-service opportunity caused by a bug in
      OSX's _strlcat_chk() function. Fixes bug 15205; bug first appeared
      in OSX 10.9.

  o Major bugfixes (relay, stability, possible security):
    - Fix a bug that could lead to a relay crashing with an assertion
      failure if a buffer of exactly the wrong layout was passed to
      buf_pullup() at exactly the wrong time. Fixes bug 15083; bugfix on
      0.2.0.10-alpha. Patch from 'cypherpunks'.
    - Do not assert if the 'data' pointer on a buffer is advanced to the
      very end of the buffer; log a BUG message instead. Only assert if
      it is past that point. Fixes bug 15083; bugfix on 0.2.0.10-alpha.

  o Major bugfixes (exit node stability):
    - Fix an assertion failure that could occur under high DNS load.
      Fixes bug 14129; bugfix on Tor 0.0.7rc1. Found by "jowr";
      diagnosed and fixed by "cypherpunks".

  o Major bugfixes (Linux seccomp2 sandbox):
    - Upon receiving sighup with the seccomp2 sandbox enabled, do not
      crash during attempts to call wait4. Fixes bug 15088; bugfix on
      0.2.5.1-alpha. Patch from "sanic".

  o Minor features (controller):
    - New "GETINFO bw-event-cache" to get information about recent
      bandwidth events. Closes ticket 14128. Useful for controllers to
      get recent bandwidth history after the fix for ticket 13988.

  o Minor features (geoip):
    - Update geoip to the March 3 2015 Maxmind GeoLite2 Country database.
    - Update geoip6 to the March 3 2015 Maxmind GeoLite2
      Country database.

  o Minor bugfixes (client, automapping):
    - Avoid crashing on torrc lines for VirtualAddrNetworkIPv[4|6] when
      no value follows the option. Fixes bug 14142; bugfix on
      0.2.4.7-alpha. Patch by "teor".
    - Fix a memory leak when using AutomapHostsOnResolve. Fixes bug
      14195; bugfix on 0.1.0.1-rc.

  o Minor bugfixes (compilation):
    - Build without warnings with the stock OpenSSL srtp.h header, which
      has a duplicate declaration of SSL_get_selected_srtp_profile().
      Fixes bug 14220; this is OpenSSL's bug, not ours.

  o Minor bugfixes (directory authority):
    - Allow directory authorities to fetch more data from one another if
      they find themselves missing lots of votes. Previously, they had
      been bumping against the 10 MB queued data limit. Fixes bug 14261;
      bugfix on 0.1.2.5-alpha.
    - Enlarge the buffer to read bwauth generated files to avoid an
      issue when parsing the file in dirserv_read_measured_bandwidths().
      Fixes bug 14125; bugfix on 0.2.2.1-alpha.

  o Minor bugfixes (statistics):
    - Increase period over which bandwidth observations are aggregated
      from 15 minutes to 4 hours. Fixes bug 13988; bugfix on 0.0.8pre1.

  o Minor bugfixes (preventative security, C safety):
    - When reading a hexadecimal, base-32, or base-64 encoded value from
      a string, always overwrite the whole output buffer. This prevents
      some bugs where we would look at (but fortunately, not reveal)
      uninitialized memory on the stack. Fixes bug 14013; bugfix on all
      versions of Tor.

Changes in version 0.2.4.26 - 2015-03-17
  Tor 0.2.4.26 includes an updated list of directory authorities.  It
  also backports a couple of stability and security bugfixes from 0.2.5
  and beyond.

  o Directory authority changes:
    - Remove turtles as a directory authority.
    - Add longclaw as a new (v3) directory authority. This implements
      ticket 13296. This keeps the directory authority count at 9.
    - The directory authority Faravahar has a new IP address. This
      closes ticket 14487.

  o Major bugfixes (exit node stability, also in 0.2.6.3-alpha):
    - Fix an assertion failure that could occur under high DNS load.
      Fixes bug 14129; bugfix on Tor 0.0.7rc1. Found by "jowr";
      diagnosed and fixed by "cypherpunks".

  o Major bugfixes (relay, stability, possible security, also in 0.2.6.4-rc):
    - Fix a bug that could lead to a relay crashing with an assertion
      failure if a buffer of exactly the wrong layout was passed to
      buf_pullup() at exactly the wrong time. Fixes bug 15083; bugfix on
      0.2.0.10-alpha. Patch from 'cypherpunks'.
    - Do not assert if the 'data' pointer on a buffer is advanced to the
      very end of the buffer; log a BUG message instead. Only assert if
      it is past that point. Fixes bug 15083; bugfix on 0.2.0.10-alpha.

  o Minor features (geoip):
    - Update geoip to the March 3 2015 Maxmind GeoLite2 Country database.
    - Update geoip6 to the March 3 2015 Maxmind GeoLite2
      Country database.

```

---

* Previous message: [[tor-talk] RAPTOR: Routing Attacks on Privacy in Tor](037293.html)
* Next message: [[tor-talk] Pre-announcement: source for Tor 0.2.4.26 and 0.2.5.11 is available.](037304.html)
* **Messages sorted by:**
  [[ date ]](date.html#37281)
  [[ thread ]](thread.html#37281)
  [[ subject ]](subject.html#37281)
  [[ author ]](author.html#37281)

---

[More information about the tor-talk
mailing list](https://lists.torproject.org/cgi-bin/mailman/listinfo/tor-talk)



=== Content from trac.torproject.org_13bea003_20250125_010604.html ===


[Skip to content](#content-body)
GitLab
[![](data:image/gif;base64...)](/ "Homepage")

* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)

This is an archived project. Repository and other project resources are read-only.

# Assertion failure in dns.c, possibly connected to UDP DoS attack

I run a full exit node, and today I was hit by a udp denial of service. Standard botnet garbage, really. But something surprising happened:

Jan 7 10:54:51 testbed Tor[4289]: Circuit handshake stats since last time: 92457/94799 TAP, 209527/209991 NTor.
Jan 7 15:28:03 testbed Tor[4289]: eventdns: All nameservers have failed
Jan 7 15:28:03 testbed Tor[4289]: eventdns: All nameservers have failed
Jan 7 15:28:03 testbed Tor[4289]: eventdns: Nameserver 8.8.8.8:53 is back up
Jan 7 15:28:03 testbed Tor[4289]: eventdns: Nameserver 8.8.8.8:53 is back up
Jan 7 15:28:48 testbed Tor[4289]: eventdns: All nameservers have failed
Jan 7 15:28:48 testbed Tor[4289]: eventdns: All nameservers have failed
Jan 7 15:28:48 testbed Tor[4289]: eventdns: Nameserver 8.8.8.8:53 is back up
Jan 7 15:28:48 testbed Tor[4289]: eventdns: Nameserver 8.8.8.8:53 is back up
Jan 7 15:29:01 testbed Tor[4289]: eventdns: All nameservers have failed
Jan 7 15:29:01 testbed Tor[4289]: eventdns: All nameservers have failed
Jan 7 15:29:01 testbed Tor[4289]: eventdns: Nameserver 8.8.8.8:53 is back up
Jan 7 15:29:01 testbed Tor[4289]: eventdns: Nameserver 8.8.8.8:53 is back up
Jan 7 15:29:23 testbed Tor[4289]: eventdns: All nameservers have failed
Jan 7 15:29:23 testbed Tor[4289]: eventdns: All nameservers have failed
Jan 7 15:29:23 testbed Tor[4289]: eventdns: Nameserver 8.8.8.8:53 is back up
Jan 7 15:29:23 testbed Tor[4289]: eventdns: Nameserver 8.8.8.8:53 is back up
Jan 7 15:30:04 testbed Tor[4289]: eventdns: All nameservers have failed
Jan 7 15:30:04 testbed Tor[4289]: eventdns: All nameservers have failed
Jan 7 16:06:15 testbed Tor[4289]: tor\_assertion\_failed\_(): Bug: src/or/dns.c:1136: connection\_dns\_remove: Assertion 0 failed; aborting.
Jan 7 16:06:15 testbed Tor[4289]: tor\_assertion\_failed\_(): Bug: src/or/dns.c:1136: connection\_dns\_remove: Assertion 0 failed; aborting.
Jan 7 16:06:15 testbed Tor[4289]: Bug: Assertion 0 failed in connection\_dns\_remove at src/or/dns.c:1136. Stack trace:
Jan 7 16:06:15 testbed Tor[4289]: Bug: Assertion 0 failed in connection\_dns\_remove at src/or/dns.c:1136. Stack trace:
Jan 7 16:06:15 testbed Tor[4289]: Bug: /usr/bin/tor(log\_backtrace+0x29) [0x50dbe9]
Jan 7 16:06:15 testbed Tor[4289]: Bug: /usr/bin/tor(log\_backtrace+0x29) [0x50dbe9]
Jan 7 16:06:15 testbed Tor[4289]: Bug: /usr/bin/tor(tor\_assertion\_failed\_+0x7a) [0x51af6a]
Jan 7 16:06:15 testbed Tor[4289]: Bug: /usr/bin/tor(tor\_assertion\_failed\_+0x7a) [0x51af6a]
Jan 7 16:06:15 testbed Tor[4289]: Bug: /usr/bin/tor(connection\_dns\_remove+0x240) [0x4fa6e0]
Jan 7 16:06:15 testbed Tor[4289]: Bug: /usr/bin/tor(connection\_dns\_remove+0x240) [0x4fa6e0]
Jan 7 16:06:15 testbed Tor[4289]: Bug: /usr/bin/tor() [0x428ed9]
Jan 7 16:06:15 testbed Tor[4289]: Bug: /usr/bin/tor() [0x428ed9]
Jan 7 16:06:15 testbed Tor[4289]: Bug: /usr/bin/tor() [0x429209]
Jan 7 16:06:15 testbed Tor[4289]: Bug: /usr/bin/tor() [0x429209]
Jan 7 16:06:15 testbed Tor[4289]: Bug: /usr/lib64/libevent-2.0.so.5(event\_base\_loop+0x40c) [0x3758b7d8f5c]
Jan 7 16:06:15 testbed Tor[4289]: Bug: /usr/lib64/libevent-2.0.so.5(event\_base\_loop+0x40c) [0x3758b7d8f5c]
Jan 7 16:06:15 testbed Tor[4289]: Bug: /usr/bin/tor(do\_main\_loop+0x215) [0x42afd5]
Jan 7 16:06:15 testbed Tor[4289]: Bug: /usr/bin/tor(do\_main\_loop+0x215) [0x42afd5]
Jan 7 16:06:15 testbed Tor[4289]: Bug: /usr/bin/tor(tor\_main+0x15d5) [0x42dc05]
Jan 7 16:06:15 testbed Tor[4289]: Bug: /usr/bin/tor(tor\_main+0x15d5) [0x42dc05]
Jan 7 16:06:15 testbed Tor[4289]: Bug: /lib64/libc.so.6(\_\_libc\_start\_main+0xf5) [0x3758abecab5]
Jan 7 16:06:15 testbed Tor[4289]: Bug: /lib64/libc.so.6(\_\_libc\_start\_main+0xf5) [0x3758abecab5]
Jan 7 16:06:15 testbed Tor[4289]: Bug: /usr/bin/tor() [0x427e31]
Jan 7 16:06:15 testbed Tor[4289]: Bug: /usr/bin/tor() [0x427e31]

I have been having issues with DNS connectivity due to the high packet (~100k pps) rate, which means tor has been without consistent DNS for about a half hour before this died.

Having tor crash was extremely surprising.

I am running tor on Gentoo, tor version:

# tor --version

Tor version 0.2.6.1-alpha (git-5a601dd2901644a5).

My suspicion is that DNS requests piled up in an internal tor buffer of some sort, and that got maxed out resulting in an oops.

I'll try to keep an eye on this. Let me know if more information is needed for debugging.

**Trac**:

**Username**: jowr

To upload designs, you'll need to enable LFS and have an admin enable hashed storage. [More information](/help/user/project/issues/design_management.md#prerequisites)

Assignee
Loading

Time tracking
Loading

Confidentiality

Confidentiality controls have moved to the issue actions menu () at the top of the page.


