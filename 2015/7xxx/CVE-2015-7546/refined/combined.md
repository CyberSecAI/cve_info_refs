=== Content from launchpad.net_f9174aff_20250126_131125.html ===

[Log in / Register](https://launchpad.net/~liusheng/%2Blogin)

[![](/@@/person-logo)](https://launchpad.net/~liusheng)

## [Liusheng](https://launchpad.net/~liusheng)

* Overview
* [Code](https://code.launchpad.net/~liusheng)
* [Bugs](https://bugs.launchpad.net/~liusheng)
* [Blueprints](https://blueprints.launchpad.net/~liusheng)
* [Translations](https://translations.launchpad.net/~liusheng)
* [Answers](https://answers.launchpad.net/~liusheng)

* [Related packages](https://launchpad.net/~liusheng/%2Brelated-packages)
* [Related projects](https://launchpad.net/~liusheng/%2Brelated-projects)

## User information

Launchpad Id:
liusheng

Email:
[Log in](%2Blogin) for email information.

Member since:
2013-07-29

Languages:

English

Time zone:

UTC
(UTC+0000)

Karma:
[0](https://launchpad.net/~liusheng/%2Bkarma)
[Karma help](/%2Bhelp-registry/karma.html)

## [All bugs in progress](https://launchpad.net/~liusheng/%2Bassignedbugs?search=Search&field.status=In+Progress) Assigned bugs

||  | #1734083 [shouldn't allow API request url without version field](https://bugs.launchpad.net/mogan/%2Bbug/1734083) |  |
| --- | --- | --- |
| in [Mogan](/mogan) | | |

| --- | --- | --- | --- | --- | --- |
||  | #1710578 [Mogan gate has been broken by placement auth failure](https://bugs.launchpad.net/mogan/%2Bbug/1710578) |  |
| --- | --- | --- |
| in [Mogan](/mogan) | | |

||  | #1697813 [Add tests for mogan](https://bugs.launchpad.net/mogan/%2Bbug/1697813) |  |
| --- | --- | --- |
| in [Mogan](/mogan) | | |

||  | #1689549 [--limit cannot work in "openstack image list" command](https://bugs.launchpad.net/python-openstackclient/%2Bbug/1689549) |  |
| --- | --- | --- |
| in [python-openstackclient](/python-openstackclient) | | |

## [All memberships](https://launchpad.net/~liusheng/%2Bparticipation) Latest memberships

| [Mogan Drivers](/~mogan-drivers)  Joined on 2017-04-05 | |
| --- | --- |
| [Panko Drivers](/~panko-drivers)  Joined on 2016-06-16 | |
| [Huawei OpenStackers](/~huawei-openstack)  Joined on 2014-03-13 | |

[![Launchpad](/@@/launchpad-footer-logo.svg)](https://launchpad.net/)
 •
[Take the tour](https://launchpad.net/%2Btour)
 •
[Read the guide](https://help.launchpad.net/)

© 2004
[Canonical Ltd.](http://canonical.com/)
 •
[Terms of use](https://launchpad.net/legal)
 •
[Data privacy](https://www.ubuntu.com/legal/dataprivacy)
 •
[Contact Launchpad Support](/feedback)
 •
[Blog](http://blog.launchpad.net/)
 •
[Careers](https://canonical.com/careers)
 •
[System status](https://ubuntu.social/%40launchpadstatus)
 •
4d55102
([Get the code!](https://dev.launchpad.net/))



=== Content from bugs.launchpad.net_147e7d2d_20250126_004110.html ===

[Log in / Register](https://bugs.launchpad.net/keystone/%2Bbug/1490804/%2Blogin)

[![](https://launchpadlibrarian.net/359059841/OpenStack_Project_Keystone_mascot%20%281%29.png)](https://launchpad.net/keystone)

## [OpenStack Identity (keystone)](https://launchpad.net/keystone)

* [Overview](https://launchpad.net/keystone)
* [Code](https://code.launchpad.net/keystone)
* [Bugs](https://bugs.launchpad.net/keystone)
* [Blueprints](https://blueprints.launchpad.net/keystone)
* [Translations](https://translations.launchpad.net/keystone)
* [Answers](https://answers.launchpad.net/keystone)

# [OSSA 2016-005] PKI Token Revocation Bypass (CVE-2015-7546)

Bug #1490804 reported by
[Liusheng](https://launchpad.net/~liusheng)
on 2015-09-01

[264](/%2Bhelp-bugs/bug-heat.html)

This bug affects 1 person

| Affects | | Status | Importance | Assigned to | Milestone |
| --- | --- | --- | --- | --- | --- |
|  | [OpenStack Identity (keystone)](https://bugs.launchpad.net/keystone) | Fix Released | High | [Brant Knudson](https://launchpad.net/~blk-u) | [OpenStack Identity (keystone) mitaka-2 "m2"](https://launchpad.net/keystone/%2Bmilestone/mitaka-2) |
|  | [Kilo](https://bugs.launchpad.net/keystone/kilo) | Fix Released | High | Unassigned | [OpenStack Identity (keystone) 2015.1.3](https://launchpad.net/keystone/%2Bmilestone/2015.1.3) |
|  | [OpenStack Security Advisory](https://bugs.launchpad.net/ossa) | Fix Released | Undecided | Unassigned |  |
|  | [OpenStack Security Notes](https://bugs.launchpad.net/ossn) | Fix Released | Critical | [Nathan Kinder](https://launchpad.net/~nkinder) |  |
|  | [django-openstack-auth](https://bugs.launchpad.net/django-openstack-auth) | Invalid | Undecided | [Adam Young](https://launchpad.net/~ayoung) |  |
|  | [keystonemiddleware](https://bugs.launchpad.net/keystonemiddleware) | Fix Released | High | [Brant Knudson](https://launchpad.net/~blk-u) |  |
|  | [python-keystoneclient](https://bugs.launchpad.net/python-keystoneclient) | Won't Fix | Undecided | [Adam Young](https://launchpad.net/~ayoung) |  |

### Bug Description

A keystone token which has been revoked can still be used by manipulating particular byte fields within the token.

When a Keystone token is revoked it is added to the revoked list which stores the exact token value. Any API will look at the token to see whether or not it should accept a token. By changing a single byte within the token, the revocation can be bypassed. see the testing script [1].

It is suggested that the revocation should be changed to only check the token's inner ID.

[1] <http://paste.openstack.org/show/436516/>

See [original description](comments/0)

Tags:

[in-stable-kilo](/keystone/%2Bbugs?field.tag=in-stable-kilo)
[in-stable-liberty](/keystone/%2Bbugs?field.tag=in-stable-liberty)
[kilo-backport-potential](/keystone/%2Bbugs?field.tag=kilo-backport-potential)
[liberty-backport-potential](/keystone/%2Bbugs?field.tag=liberty-backport-potential)

## CVE References

* [2015-7546](/bugs/cve/2015-7546 "The identity service in OpenStack Ide...")

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2015-09-01: |  |  | [#1](/keystone/%2Bbug/1490804/comments/1) |
| --- | --- | --- | --- |

Since this report concerns a possible security risk, an incomplete security advisory task has been added while the core security reviewers for the affected project or projects confirm the bug and discuss the scope of any vulnerability along with potential solutions.

Since this report concerns a possible security risk, an incomplete security advisory task has been added while the core security reviewers for the affected project or projects confirm the bug and discuss the scope of any vulnerability along with potential solutions.

| Changed in ossa: | |
| --- | --- |
| **status**: | New → Incomplete |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2015-09-01: |  |  | [#2](/keystone/%2Bbug/1490804/comments/2) |
| --- | --- | --- | --- |

The tests scripts does not show how token are created/revoked. What type of token is this ?

Maybe it's a swift setting that allows direct access to the swift account.

The tests scripts does not show how token are created/revoked. What type of token is this ?
Maybe it's a swift setting that allows direct access to the swift account.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Jeremy Stanley (fungi)](https://launchpad.net/~fungi) wrote on 2015-09-01: |  |  | [#3](/keystone/%2Bbug/1490804/comments/3) |
| --- | --- | --- | --- |

Please also be aware that paste.openstack.org contents are not secret/private and can be easily enumerated. We should probably consider this issue publicly disclosed at this point since an exploit has been published to the paste server.

Please also be aware that paste.openstack.org contents are not secret/private and can be easily enumerated. We should probably consider this issue publicly disclosed at this point since an exploit has been published to the paste server.

| **description**: | updated |
| --- | --- |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Morgan Fainberg (mdrnstm)](https://launchpad.net/~mdrnstm) wrote on 2015-09-01: |  |  | [#4](/keystone/%2Bbug/1490804/comments/4) |
| --- | --- | --- | --- |

I would like to know what version of keystone is being used here and what type of token.

This is definitely not uuid tokens, and I don't believe this can be fernet as fernet is live validated and does not rely on the token\_id for revocations.

Can this occur with services other than swift as well? I'll need to dig further on this unless the information can be provided.

I would like to know what version of keystone is being used here and what type of token.
This is definitely not uuid tokens, and I don't believe this can be fernet as fernet is live validated and does not rely on the token\_id for revocations.
Can this occur with services other than swift as well? I'll need to dig further on this unless the information can be provided.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Morgan Fainberg (mdrnstm)](https://launchpad.net/~mdrnstm) wrote on 2015-09-01: |  |  | [#5](/keystone/%2Bbug/1490804/comments/5) |
| --- | --- | --- | --- |

If this is PKI/PKIZ tokens, there are no "internal" IDs as the internal ID would be part of the signed data. The signed data cannot contain the ID itself as it would change the ID.

Discussing this a bit further it looks like "revoke by ID" should have been based on fingerprint or the signed data (as per adam young). Alternatively, we can now use the audit\_ids for "revoke by id"

I am still in process of confirming outside of swift.

If this is PKI/PKIZ tokens, there are no "internal" IDs as the internal ID would be part of the signed data. The signed data cannot contain the ID itself as it would change the ID.
Discussing this a bit further it looks like "revoke by ID" should have been based on fingerprint or the signed data (as per adam young). Alternatively, we can now use the audit\_ids for "revoke by id"
I am still in process of confirming outside of swift.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Dolph Mathews (dolph)](https://launchpad.net/~dolph) wrote on 2015-09-01: |  |  | [#6](/keystone/%2Bbug/1490804/comments/6) |
| --- | --- | --- | --- |

This sounds like it must be limited to PKI/PKIZ tokens? Fernet tokens would fail their HMAC and there is no room to manipulate UUID tokens unless you're guessing a completely different one.

In the script to reproduce, mutating token\_bin[1] would be manipulating the CMS length prefix (MIIE-\*, etc), in which case, I wonder if there's a bug in openssl?

Jeremy: please don't open this bug just because the paste is public. There's nothing in the paste that shouts "security vulnerability," and we should certainly have the ability to delete pastes (and move them here), no?

This sounds like it must be limited to PKI/PKIZ tokens? Fernet tokens would fail their HMAC and there is no room to manipulate UUID tokens unless you're guessing a completely different one.
In the script to reproduce, mutating token\_bin[1] would be manipulating the CMS length prefix (MIIE-\*, etc), in which case, I wonder if there's a bug in openssl?
Jeremy: please don't open this bug just because the paste is public. There's nothing in the paste that shouts "security vulnerability," and we should certainly have the ability to delete pastes (and move them here), no?

| Changed in keystone: | |
| --- | --- |
| **importance**: | Undecided → High |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Jeremy Stanley (fungi)](https://launchpad.net/~fungi) wrote on 2015-09-01: |  |  | [#7](/keystone/%2Bbug/1490804/comments/7) |
| --- | --- | --- | --- |

I won't switch this to public without consensus anyway, but can assure that there are crawlers continuously spidering our paste server (I know because I see them in the logs and they make up quite possibly the majority of requests there).

I won't switch this to public without consensus anyway, but can assure that there are crawlers continuously spidering our paste server (I know because I see them in the logs and they make up quite possibly the majority of requests there).

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Liusheng (liusheng)](https://launchpad.net/~liusheng) wrote on 2015-09-02: |  |  | [#8](/keystone/%2Bbug/1490804/comments/8) |
| --- | --- | --- | --- |

sorry, my mistake, this issue is occured with PKI token.

sorry, my mistake, this issue is occured with PKI token.

| **summary**: | - Token Revocation Bypass+ PKI Token Revocation Bypass |
| --- | --- |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Liusheng (liusheng)](https://launchpad.net/~liusheng) wrote on 2015-09-02:  [**Re: PKI Token Revocation Bypass**](/keystone/%2Bbug/1490804/comments/9) |  |  | [#9](/keystone/%2Bbug/1490804/comments/9) |
| --- | --- | --- | --- |

This issue is found by my colleagues, I will dig more and provide more information, thanks for your attention.

This issue is found by my colleagues, I will dig more and provide more information, thanks for your attention.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Dolph Mathews (dolph)](https://launchpad.net/~dolph) wrote on 2015-09-02: |  |  | [#10](/keystone/%2Bbug/1490804/comments/10) |
| --- | --- | --- | --- |

I won't be able to spend much time on this until at least Sept 4th, but I suspect this is easily reproducible and I'm wondering if the fix must be to make PKI depend on revocation events like Fernet does? Or perhaps to ignore the mutable characters when querying the token table?

I won't be able to spend much time on this until at least Sept 4th, but I suspect this is easily reproducible and I'm wondering if the fix must be to make PKI depend on revocation events like Fernet does? Or perhaps to ignore the mutable characters when querying the token table?

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Dolph Mathews (dolph)](https://launchpad.net/~dolph) wrote on 2015-09-02: |  |  | [#11](/keystone/%2Bbug/1490804/comments/11) |
| --- | --- | --- | --- |

Jeremy: I did not consider crawlers / mirrors. Deleting the paste now might only draw attention to it :)

Jeremy: I did not consider crawlers / mirrors. Deleting the paste now might only draw attention to it :)

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Dolph Mathews (dolph)](https://launchpad.net/~dolph) wrote on 2015-09-02: |  |  | [#12](/keystone/%2Bbug/1490804/comments/12) |
| --- | --- | --- | --- |

Liusheng: if you need to share any other files/logs/patches related to the bug, please add them as attachments to this bug (using the "Add attachment or patch" link at the bottom of the page).

Liusheng: if you need to share any other files/logs/patches related to the bug, please add them as attachments to this bug (using the "Add attachment or patch" link at the bottom of the page).

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Liusheng (liusheng)](https://launchpad.net/~liusheng) wrote on 2015-09-02: |  |  | [#13](/keystone/%2Bbug/1490804/comments/13) |
| --- | --- | --- | --- |

Dolph: sure, I am sorry I didn't realized the test script shouldn't be pasted in paste.openstack.org.

Dolph: sure, I am sorry I didn't realized the test script shouldn't be pasted in paste.openstack.org.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Liusheng (liusheng)](https://launchpad.net/~liusheng) wrote on 2015-09-02: |  |  | [#14](/keystone/%2Bbug/1490804/comments/14) |
| --- | --- | --- | --- |

I have confirmed they guys found this issue in Juno openstack, some version info used:

keystoneclient 0.11.2

keystone 2014.2

openssl-1.0.1i-2.1.4

openssl-certs-1.97-0.3.1

I have confirmed they guys found this issue in Juno openstack, some version info used:
keystoneclient 0.11.2
keystone 2014.2
openssl-1.0.1i-2.1.4
openssl-certs-1.97-0.3.1

[Adam Young (ayoung)](https://launchpad.net/~ayoung)
on 2015-09-02

| Changed in keystone: | |
| --- | --- |
| **assignee**: | nobody → Adam Young (ayoung) |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Adam Young (ayoung)](https://launchpad.net/~ayoung) wrote on 2015-09-02: |  |  | [#15](/keystone/%2Bbug/1490804/comments/15) |
| --- | --- | --- | --- |

This should only be a problem with PKI(Z) tokens. The fix can be made here:

<http://git.openstack.org/cgit/openstack/keystone/tree/keystone/token/utils.py>

Using the logic in the blog post here: <http://adam.younglogic.com/2014/10/who-signed-that-token/> we can pull out the signed data from the token and take a hash of that; modifying the hashed data will mean the token will not longer pass the CMS validation.

This will pull in an additional dependency on pyasn1 to Keystone. We cannot avoid that by calculating the hash on the JSON data itself, as it will not (necessarily) be reproducible.

In addition, Horizon will need an update, as they currently Md5 Hash the tokens before sending them to the remote services.

Another possibility is to generate a UUID for the token ID, and stick that inside the JSON body before signing. revocation could be done on the UUID value instead of the HASH. That would involve changing both Keystone and keystonemiddleware.

another alternative it to compare the signer info in the PKIZ token with the Certificate. If they don't match, the token is invalid. I don't know if it is possible to be 100% certain that the teokn cannot be tampered with.

This should only be a problem with PKI(Z) tokens. The fix can be made here:
http://git.openstack.org/cgit/openstack/keystone/tree/keystone/token/utils.py
Using the logic in the blog post here: http://adam.younglogic.com/2014/10/who-signed-that-token/ we can pull out the signed data from the token and take a hash of that; modifying the hashed data will mean the token will not longer pass the CMS validation.
This will pull in an additional dependency on pyasn1 to Keystone. We cannot avoid that by calculating the hash on the JSON data itself, as it will not (necessarily) be reproducible.
In addition, Horizon will need an update, as they currently Md5 Hash the tokens before sending them to the remote services.
Another possibility is to generate a UUID for the token ID, and stick that inside the JSON body before signing. revocation could be done on the UUID value instead of the HASH. That would involve changing both Keystone and keystonemiddleware.
another alternative it to compare the signer info in the PKIZ token with the Certificate. If they don't match, the token is invalid. I don't know if it is possible to be 100% certain that the teokn cannot be tampered with.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Morgan Fainberg (mdrnstm)](https://launchpad.net/~mdrnstm) wrote on 2015-09-02: |  |  | [#16](/keystone/%2Bbug/1490804/comments/16) |
| --- | --- | --- | --- |

Thanks for the information. It helps us to be sure we are looking at all avenues for the problem. I can see where this is happening and have discussed with Adam and a few other folks on it and how we are approachig potential fixes.

Thanks for the information. It helps us to be sure we are looking at all avenues for the problem. I can see where this is happening and have discussed with Adam and a few other folks on it and how we are approachig potential fixes.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Adam Young (ayoung)](https://launchpad.net/~ayoung) wrote on 2015-09-02: |  |  | [#17](/keystone/%2Bbug/1490804/comments/17) |
| --- | --- | --- | --- |

* [modify\_token.py](https://bugs.launchpad.net/keystone/%2Bbug/1490804/%2Battachment/4455970/%2Bfiles/modify_token.py)
  [Edit](/keystone/%2Bbug/1490804/%2Battachment/4455970)
  (995 bytes,
  text/x-python)

The attached code shows the modification of the binary data that still generates a valid token; it can be run from

python-keystoneclient/examples/pki and usese the sample tokens and certificates in the associated subdirectories.

This shows the modified bytes that successfully pass are:

77 78 79 80 81 82 83 85 86 87 88 3979 3980 3981 3982 3983 3985 3986 3987 3988 3991 3992 4364

The range 77 78 79 80 81 82 83 85 86 87 88 looks like the object identitfier s

1 3 14 3 2 26

and

1 2 840 113549 1 7 1

The last byte is padding.

To see the content of the token in PEM format

cat cms/auth\_v3\_token\_scoped.pem | awk ' ! /---/ {print $1}'| base64 -d | /usr/lib64/nss/unsupported-tools/derdump > /tmp/tokendata

The attached code shows the modification of the binary data that still generates a valid token; it can be run from
python-keystoneclient/examples/pki and usese the sample tokens and certificates in the associated subdirectories.
This shows the modified bytes that successfully pass are:
77 78 79 80 81 82 83 85 86 87 88 3979 3980 3981 3982 3983 3985 3986 3987 3988 3991 3992 4364
The range 77 78 79 80 81 82 83 85 86 87 88 looks like the object identitfier s
1 3 14 3 2 26
and
1 2 840 113549 1 7 1
The last byte is padding.
To see the content of the token in PEM format
cat cms/auth\_v3\_token\_scoped.pem | awk ' ! /---/ {print $1}'| base64 -d | /usr/lib64/nss/unsupported-tools/derdump > /tmp/tokendata

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Adam Young (ayoung)](https://launchpad.net/~ayoung) wrote on 2015-09-02: |  |  | [#18](/keystone/%2Bbug/1490804/comments/18) |
| --- | --- | --- | --- |

* [derdump of Token data in ASN1 format](https://bugs.launchpad.net/keystone/%2Bbug/1490804/%2Battachment/4455971/%2Bfiles/tokendata)
  [Edit](/keystone/%2Bbug/1490804/%2Battachment/4455971)
  (25.1 KiB,
  text/plain)

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Dolph Mathews (dolph)](https://launchpad.net/~dolph) wrote on 2015-09-02: |  |  | [#19](/keystone/%2Bbug/1490804/comments/19) |
| --- | --- | --- | --- |

The attached test manipulates UUID, PKI, PKIz, and Fernet tokens by incrementing and decrementing individual bytes, as illustrated in the bug description. This test passes against each token type, showing that the manipulated tokens cannot be validated \*online\* against keystone. To be clear, this patch does not contain a fix, nor does it confirm or invalidate the bug report.

Unless I missed something, that means the scope of this bug is limited to validating tokens offline (against the token revocation list in keystonemiddleware.auth\_token).

The attached test manipulates UUID, PKI, PKIz, and Fernet tokens by incrementing and decrementing individual bytes, as illustrated in the bug description. This test passes against each token type, showing that the manipulated tokens cannot be validated \*online\* against keystone. To be clear, this patch does not contain a fix, nor does it confirm or invalidate the bug report.
Unless I missed something, that means the scope of this bug is limited to validating tokens offline (against the token revocation list in keystonemiddleware.auth\_token).

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Dolph Mathews (dolph)](https://launchpad.net/~dolph) wrote on 2015-09-02: |  |  | [#20](/keystone/%2Bbug/1490804/comments/20) |
| --- | --- | --- | --- |

* [bug-1490804-tests-master-v1.patch](https://bugs.launchpad.net/keystone/%2Bbug/1490804/%2Battachment/4456156/%2Bfiles/bug-1490804-tests-master-v1.patch)
  [Edit](/keystone/%2Bbug/1490804/%2Battachment/4456156)
  (4.4 KiB,
  text/plain)

Of course, it would help if I attached the patch.

Of course, it would help if I attached the patch.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Adam Young (ayoung)](https://launchpad.net/~ayoung) wrote on 2015-09-02: |  |  | [#21](/keystone/%2Bbug/1490804/comments/21) |
| --- | --- | --- | --- |

Dolph; yeah, this is only for checking the revocation list; the tokens themselves need to be valid tokens. It is restricted to PKI based tokens only. The mistake was using the hash of the whole document for the token id; it should have been the same hash of the token tdata that is used for the cryptographic signature. The values being manipulated are the ASN1 specific values that indicate "This next block is signed data" which openssl really should be validating.

For example; here is a diff of a derdump of the origianl file and the modified file, with some lines of context;

$ diff -U 10 /tmp/auth\_v3\_token\_scoped\_orig.pem.txt /tmp/auth\_v3\_token\_scoped77.pem.txt

--- /tmp/auth\_v3\_token\_scoped\_orig.pem.txt 2015-09-02 11:27:46.423313737 -0400

+++ /tmp/auth\_v3\_token\_scoped77.pem.txt 2015-09-02 11:27:46.398313755 -0400

@@ -4,21 +4,21 @@

    C-[0] (3176)

       C-Sequence (3172)

          Integer (1)

             01

          C-Set (9)

             C-Sequence (7)

                Object Identifier (5)

                   1 3 14 3 2 26 (SHA-1)

          C-Sequence (2692)

             Object Identifier (9)

- 1 2 840 113549 1 7 1 (PKCS #7 Data)

+ 0 26 840 113549 1 7 1

             C-[0] (2677)

                Octet String (2673)

                   7b 22 74 6f 6b 65 6e 22 3a 20 7b 22 6d 65 74 68 6f 64

                   73 22 3a 20 5b 22 70 61 73 73 77 6f 72 64 22 5d 2c 20

                   22 72 6f 6c 65 73 22 3a 20 5b 7b 22 69 64 22 3a 20 22

                   66 30 33 66 64 61 38 66 38 61 33 32 34 39 62 32 61 37

                   30 66 62 31 66 31 37 36 61 37 62 36 33 31 22 2c 20 22

                   6e 61 6d 65 22 3a 20 22 72 6f 6c 65 31 22 7d 2c 20 7b

                   22 69 64 22 3a 20 22 66 30 33 66 64 61 38 66 38 61 33

                   32 34 39 62 32 61 37 30 66 62 31 66 31 37 36 61 37 62

All of the places susceptible to the modifications seem to be this kind of string, with the exception of the final padding;

$ diff -u /tmp/auth\_v3\_token\_scoped\_orig.pem /tmp/auth\_v3\_token\_scoped4364.pem

--- /tmp/auth\_v3\_token\_scoped\_orig.pem 2015-09-02 11:14:11.414915072 -0400

+++ /tmp/auth\_v3\_token\_scoped4364.pem 2015-09-02 11:14:28.749902282 -0400

@@ -66,4 +66,4 @@

 4RQzkShFx97ioGPE9wE1Jv9Yzxo5uTg6z246gi42e50uSIFZMmNMqkUdz0n6Qct+

 1zMf8W+e1pykKscVBz757F9n+qAhx15LxxdCKIrQ1kNT8dAyLRBQU0qZeLmLvS3W

 nmf/JlQ7LDQmq3XQEHRbQ1s5dz/mwM8IiSm8

------END CMS-----

+-----END CMS-----

\ No newline at end of file

Dolph; yeah, this is only for checking the revocation list; the tokens themselves need to be valid tokens. It is restricted to PKI based tokens only. The mistake was using the hash of the whole document for the token id; it should have been the same hash of the token tdata that is used for the cryptographic signature. The values being manipulated are the ASN1 specific values that indicate "This next block is signed data" which openssl really should be validating.
For example; here is a diff of a derdump of the origianl file and the modified file, with some lines of context;
$ diff -U 10 /tmp/auth\_v3\_token\_scoped\_orig.pem.txt /tmp/auth\_v3\_token\_scoped77.pem.txt
--- /tmp/auth\_v3\_token\_scoped\_orig.pem.txt 2015-09-02 11:27:46.423313737 -0400
+++ /tmp/auth\_v3\_token\_scoped77.pem.txt 2015-09-02 11:27:46.398313755 -0400
@@ -4,21 +4,21 @@
C-[0] (3176)
C-Sequence (3172)
Integer (1)
01
C-Set (9)
C-Sequence (7)
Object Identifier (5)
1 3 14 3 2 26 (SHA-1)
C-Sequence (2692)
Object Identifier (9)
- 1 2 840 113549 1 7 1 (PKCS #7 Data)
+ 0 26 840 113549 1 7 1
C-[0] (2677)
Octet String (2673)
7b 22 74 6f 6b 65 6e 22 3a 20 7b 22 6d 65 74 68 6f 64
73 22 3a 20 5b 22 70 61 73 73 77 6f 72 64 22 5d 2c 20
22 72 6f 6c 65 73 22 3a 20 5b 7b 22 69 64 22 3a 20 22
66 30 33 66 64 61 38 66 38 61 33 32 34 39 62 32 61 37
30 66 62 31 66 31 37 36 61 37 62 36 33 31 22 2c 20 22
6e 61 6d 65 22 3a 20 22 72 6f 6c 65 31 22 7d 2c 20 7b
22 69 64 22 3a 20 22 66 30 33 66 64 61 38 66 38 61 33
32 34 39 62 32 61 37 30 66 62 31 66 31 37 36 61 37 62
All of the places susceptible to the modifications seem to be this kind of string, with the exception of the final padding;
$ diff -u /tmp/auth\_v3\_token\_scoped\_orig.pem /tmp/auth\_v3\_token\_scoped4364.pem
--- /tmp/auth\_v3\_token\_scoped\_orig.pem 2015-09-02 11:14:11.414915072 -0400
+++ /tmp/auth\_v3\_token\_scoped4364.pem 2015-09-02 11:14:28.749902282 -0400
@@ -66,4 +66,4 @@
4RQzkShFx97ioGPE9wE1Jv9Yzxo5uTg6z246gi42e50uSIFZMmNMqkUdz0n6Qct+
1zMf8W+e1pykKscVBz757F9n+qAhx15LxxdCKIrQ1kNT8dAyLRBQU0qZeLmLvS3W
nmf/JlQ7LDQmq3XQEHRbQ1s5dz/mwM8IiSm8
------END CMS-----
+-----END CMS-----
\ No newline at end of file

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Morgan Fainberg (mdrnstm)](https://launchpad.net/~mdrnstm) wrote on 2015-09-02: |  |  | [#22](/keystone/%2Bbug/1490804/comments/22) |
| --- | --- | --- | --- |

@dolph,

Yes this would be limited to an auth\_token middleware issue. We should retarget the bug.

@dolph,
Yes this would be limited to an auth\_token middleware issue. We should retarget the bug.

| Changed in keystonemiddleware: | |
| --- | --- |
| **status**: | New → Confirmed |
| **status**: | Confirmed → New |
| **importance**: | Undecided → Critical |
| **importance**: | Critical → High |
| **assignee**: | nobody → Adam Young (ayoung) |
| Changed in keystone: | |
| **status**: | New → Invalid |
| **assignee**: | Adam Young (ayoung) → nobody |
| **status**: | Invalid → New |
| **assignee**: | nobody → Adam Young (ayoung) |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Morgan Fainberg (mdrnstm)](https://launchpad.net/~mdrnstm) wrote on 2015-09-02: |  |  | [#23](/keystone/%2Bbug/1490804/comments/23) |
| --- | --- | --- | --- |

Added keystonemiddleware as there are likely changes needed to KSM as well

Added keystonemiddleware as there are likely changes needed to KSM as well

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Dolph Mathews (dolph)](https://launchpad.net/~dolph) wrote on 2015-09-03: |  |  | [#24](/keystone/%2Bbug/1490804/comments/24) |
| --- | --- | --- | --- |

The fix could impact the contents of the token revocation list itself, though (in keystone).

The fix could impact the contents of the token revocation list itself, though (in keystone).

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Dolph Mathews (dolph)](https://launchpad.net/~dolph) wrote on 2015-09-03: |  |  | [#25](/keystone/%2Bbug/1490804/comments/25) |
| --- | --- | --- | --- |

(read comment #22 & #23 before I saw the new bug status - it seems you already agree!)

(read comment #22 & #23 before I saw the new bug status - it seems you already agree!)

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Adam Young (ayoung)](https://launchpad.net/~ayoung) wrote on 2015-09-03: |  |  | [#26](/keystone/%2Bbug/1490804/comments/26) |
| --- | --- | --- | --- |

* [0001-Reject-modified-PKI-Tokens.patch](https://bugs.launchpad.net/keystone/%2Bbug/1490804/%2Battachment/4456676/%2Bfiles/0001-Reject-modified-PKI-Tokens.patch)
  [Edit](/keystone/%2Bbug/1490804/%2Battachment/4456676)
  (6.1 KiB,
  text/plain)

The following patch detects modifications of the Token.

I am not certain, however, that this is exhaustive; there might be ways to modify the document such that it is still valid, but has a different hash.

We can lock down what is accepted as a token format: additional checks could confirm that the certs are stripped (adding them will still fail validation anyways) or any other cosmetic changes that could change the document.

We might be able to get away with a stop gap like this, and then migrate people to Fernet or change how PKI tokens are hashed.

The following patch detects modifications of the Token.
I am not certain, however, that this is exhaustive; there might be ways to modify the document such that it is still valid, but has a different hash.
We can lock down what is accepted as a token format: additional checks could confirm that the certs are stripped (adding them will still fail validation anyways) or any other cosmetic changes that could change the document.
We might be able to get away with a stop gap like this, and then migrate people to Fernet or change how PKI tokens are hashed.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Morgan Fainberg (mdrnstm)](https://launchpad.net/~mdrnstm) wrote on 2015-09-03: |  |  | [#27](/keystone/%2Bbug/1490804/comments/27) |
| --- | --- | --- | --- |

A few issues that came up in discussion earlier tonight:

\* What happens if someone respins a token from PKI to PKIZ or vice-versa?

\* PKI the delimiter (---- START CMS ---- and corresponding end ones) could be pre/post substituted in PKI (not PKIZ) and change the resulting ID but still pass due to the token\_to\_cms (or cms\_to\_token) code doing a blind substitution between '/' and '-'.

One of the other options could be to provide an options for KeystoneMiddleware to disable offline validations (default to off) and have it hash the tokens the same way django\_openstack\_auth would (which is not affected by this issue).

I'm looking over the code in the Reject-modified-PKI-Tokens.patch and it is a partial solution, but I have not spent enough time poking at the code to be sure what other gaps are there in PKI(Z) validation.

A few issues that came up in discussion earlier tonight:
\* What happens if someone respins a token from PKI to PKIZ or vice-versa?
\* PKI the delimiter (---- START CMS ---- and corresponding end ones) could be pre/post substituted in PKI (not PKIZ) and change the resulting ID but still pass due to the token\_to\_cms (or cms\_to\_token) code doing a blind substitution between '/' and '-'.
One of the other options could be to provide an options for KeystoneMiddleware to disable offline validations (default to off) and have it hash the tokens the same way django\_openstack\_auth would (which is not affected by this issue).
I'm looking over the code in the Reject-modified-PKI-Tokens.patch and it is a partial solution, but I have not spent enough time poking at the code to be sure what other gaps are there in PKI(Z) validation.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Adam Young (ayoung)](https://launchpad.net/~ayoung) wrote on 2015-09-03: |  |  | [#28](/keystone/%2Bbug/1490804/comments/28) |
| --- | --- | --- | --- |

* [0001-hash-the-data-in-the-token.patch](https://bugs.launchpad.net/keystone/%2Bbug/1490804/%2Battachment/4456711/%2Bfiles/0001-hash-the-data-in-the-token.patch)
  [Edit](/keystone/%2Bbug/1490804/%2Battachment/4456711)
  (2.7 KiB,
  text/plain)

This patch is probably the apparoach we need to take; it changes the logic of generating a token\_id from hashing the whole body of the token to hashing the data, same way that the signing algorithm does.

The patch will not yet pass unit tests.

Django OpenStack Auth needs to be modified to call this function in keystoneclient instead of doing their own hashing.

This patch is probably the apparoach we need to take; it changes the logic of generating a token\_id from hashing the whole body of the token to hashing the data, same way that the signing algorithm does.
The patch will not yet pass unit tests.
Django OpenStack Auth needs to be modified to call this function in keystoneclient instead of doing their own hashing.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Morgan Fainberg (mdrnstm)](https://launchpad.net/~mdrnstm) wrote on 2015-09-03: |  |  | [#29](/keystone/%2Bbug/1490804/comments/29) |
| --- | --- | --- | --- |

I am going to be -1 on changing DOA and changing how we hash immediately as this will break anyone who does not use the libraries (aka any language but python).

Lets aim for a fix that doesn't break absolutely everyone.

DOA is not impacted by this as it forces live validation.

Let's not change DOA and only change how middleware interacts in a non-live validated token workflow for Liberty (preferably something back-portable).

I am going to be -1 on changing DOA and changing how we hash immediately as this will break anyone who does not use the libraries (aka any language but python).
Lets aim for a fix that doesn't break absolutely everyone.
DOA is not impacted by this as it forces live validation.
Let's not change DOA and only change how middleware interacts in a non-live validated token workflow for Liberty (preferably something back-portable).

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Adam Young (ayoung)](https://launchpad.net/~ayoung) wrote on 2015-09-03: |  |  | [#30](/keystone/%2Bbug/1490804/comments/30) |
| --- | --- | --- | --- |

The DOA fix is trivial. It should go in anyway.

This is the lowest impact change. It won't break anyone unless they are doing the undocumented Hash hack. The number of people that are doing that should be vnishingly small, and they should update was well, too, for the same reason.

We can post code samples in Ruby and Java for how to do the hash.

The DOA fix is trivial. It should go in anyway.
This is the lowest impact change. It won't break anyone unless they are doing the undocumented Hash hack. The number of people that are doing that should be vnishingly small, and they should update was well, too, for the same reason.
We can post code samples in Ruby and Java for how to do the hash.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Adam Young (ayoung)](https://launchpad.net/~ayoung) wrote on 2015-09-03: |  |  | [#31](/keystone/%2Bbug/1490804/comments/31) |
| --- | --- | --- | --- |

* [0001-Use-the-Keystoneclient-code-to-hash-the-token.patch](https://bugs.launchpad.net/keystone/%2Bbug/1490804/%2Battachment/4456923/%2Bfiles/0001-Use-the-Keystoneclient-code-to-hash-the-token.patch)
  [Edit](/keystone/%2Bbug/1490804/%2Battachment/4456923)
  (1.7 KiB,
  text/plain)

This is the DOA change, and it can and should be applied regardless. I think it is safe to post as a review publicly.

This is the DOA change, and it can and should be applied regardless. I think it is safe to post as a review publicly.

| Changed in python-keystoneclient: | |
| --- | --- |
| **assignee**: | nobody → Adam Young (ayoung) |

[Adam Young (ayoung)](https://launchpad.net/~ayoung)
on 2015-09-04

| Changed in django-openstack-auth: | |
| --- | --- |
| **assignee**: | nobody → Adam Young (ayoung) |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Adam Young (ayoung)](https://launchpad.net/~ayoung) wrote on 2015-09-10: |  |  | [#32](/keystone/%2Bbug/1490804/comments/32) |
| --- | --- | --- | --- |

Is there any direction on this one? Online validation is going to break people doing distributed signing, which is the reason to use PKI tokens. Any fix here has the potential to fix someone. Changing the hash approach is, I suspect, going to have the least impact.

Is there any direction on this one? Online validation is going to break people doing distributed signing, which is the reason to use PKI tokens. Any fix here has the potential to fix someone. Changing the hash approach is, I suspect, going to have the least impact.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Adam Young (ayoung)](https://launchpad.net/~ayoung) wrote on 2015-09-10: |  |  | [#33](/keystone/%2Bbug/1490804/comments/33) |
| --- | --- | --- | --- |

Note that always going to online validation would preclude the use of memcache for tokens.

Note that always going to online validation would preclude the use of memcache for tokens.

[Morgan Fainberg (mdrnstm)](https://launchpad.net/~mdrnstm)
on 2015-09-10

| Changed in django-openstack-auth: | |
| --- | --- |
| **status**: | New → Invalid |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Morgan Fainberg (mdrnstm)](https://launchpad.net/~mdrnstm) wrote on 2015-09-10: |  |  | [#34](/keystone/%2Bbug/1490804/comments/34) |
| --- | --- | --- | --- |

I repeat the previous statement: Changing the hash mechanism will break everyone. DOA is absolutely not affected here.

DOA forces online validation because it hashes the PKI(z) tokens to the SHA form. If a token is already hashed, it will only rely on the online validation which requires matching the key in the database.

The solution for the time being is going to be addressing how middleware validates the token offline via SSL. Options I see are:

\* Done via audit\_ids with new forms of middleware if we make audit\_ids available as a form of the TRL.

\* Option to only online-validate PKI(Z) tokens.

\* Offer a different hash-form TRL (not just audit-id) for new versions of middleware

\* Deprecate PKI(Z) tokens [not a good idea]

\* Issue OSSA and indicate this is not something we can/will fix with the PKI tokens (and deprecate) [not a great idea]

I would prefer to see an online-only validation option with an OSSA as the immediate (and potentially backportable) fix. Discussion on changing hashes etc can be delayed until the summit and done in the open - not under embargo. For the embargo'd bug, I really want to see this not be a breaking change.

Breaking memcache for validated tokens [optionally] where the deployer is aware of the issues (due to OSSA being issued) is fine.

I repeat the previous statement: Changing the hash mechanism will break everyone. DOA is absolutely not affected here.
DOA forces online validation because it hashes the PKI(z) tokens to the SHA form. If a token is already hashed, it will only rely on the online validation which requires matching the key in the database.
The solution for the time being is going to be addressing how middleware validates the token offline via SSL. Options I see are:
\* Done via audit\_ids with new forms of middleware if we make audit\_ids available as a form of the TRL.
\* Option to only online-validate PKI(Z) tokens.
\* Offer a different hash-form TRL (not just audit-id) for new versions of middleware
\* Deprecate PKI(Z) tokens [not a good idea]
\* Issue OSSA and indicate this is not something we can/will fix with the PKI tokens (and deprecate) [not a great idea]
I would prefer to see an online-only validation option with an OSSA as the immediate (and potentially backportable) fix. Discussion on changing hashes etc can be delayed until the summit and done in the open - not under embargo. For the embargo'd bug, I really want to see this not be a breaking change.
Breaking memcache for validated tokens [optionally] where the deployer is aware of the issues (due to OSSA being issued) is fine.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Robert Clark (robert-clark)](https://launchpad.net/~robert-clark) wrote on 2015-09-10: |  |  | [#35](/keystone/%2Bbug/1490804/comments/35) |
| --- | --- | --- | --- |

Ouch, I'd love to do a security blogpost on this once it's announced, a full root cause analysis.

I'm not close-enough to Keystone to understand the full impact of all the the mitigation options however it's clear that this is a pretty severe issue.

I know the numbers are hard to quantify but "thumb in the air" - what percentage of deployments use PKI tokens?

-Rob

Ouch, I'd love to do a security blogpost on this once it's announced, a full root cause analysis.
I'm not close-enough to Keystone to understand the full impact of all the the mitigation options however it's clear that this is a pretty severe issue.
I know the numbers are hard to quantify but "thumb in the air" - what percentage of deployments use PKI tokens?
-Rob

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Morgan Fainberg (mdrnstm)](https://launchpad.net/~mdrnstm) wrote on 2015-09-10: |  |  | [#36](/keystone/%2Bbug/1490804/comments/36) |
| --- | --- | --- | --- |

@Robert,

It's enough to be a serious consideration (in the <50% but more than 15% is my guess; but this is just hazarding a guess). However we are now seeing a move towards Fernet tokens from the orgs that have been using PKI.

Some of the largest deployments are PKI token based.

@Robert,
It's enough to be a serious consideration (in the <50% but more than 15% is my guess; but this is just hazarding a guess). However we are now seeing a move towards Fernet tokens from the orgs that have been using PKI.
Some of the largest deployments are PKI token based.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Travis McPeak (travis-mcpeak)](https://launchpad.net/~travis-mcpeak) wrote on 2015-09-11: |  |  | [#37](/keystone/%2Bbug/1490804/comments/37) |
| --- | --- | --- | --- |

This also seems like a prime target for a security note (OSSN). Basically we'll say something along the lines of "PKI(Z) tokens without online validation shouldn't be considered safe for certain versions" (if I understand this correctly).

This will enable cloud deployers to better understand the documented risks they are accepting.

This also seems like a prime target for a security note (OSSN). Basically we'll say something along the lines of "PKI(Z) tokens without online validation shouldn't be considered safe for certain versions" (if I understand this correctly).
This will enable cloud deployers to better understand the documented risks they are accepting.

[Adam Young (ayoung)](https://launchpad.net/~ayoung)
on 2015-09-11

| Changed in keystone: | |
| --- | --- |
| **status**: | New → Confirmed |
| **status**: | Confirmed → Triaged |
| Changed in keystonemiddleware: | |
| **status**: | New → Triaged |
| Changed in python-keystoneclient: | |
| **status**: | New → Triaged |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Adam Young (ayoung)](https://launchpad.net/~ayoung) wrote on 2015-09-11: |  |  | [#38](/keystone/%2Bbug/1490804/comments/38) |
| --- | --- | --- | --- |

Root cause is the assumption that any tampering with the PKI token would invalidate the token. There are three major fields in the token that are resistant:

1. The message. Any change to the message will be detected due to it not matching the signature.

2. The signature. Any change to the signature and the message will no longer match its signature.

3. The singning info. This checked against the X509 signing cert byte-by-byte. Any change and it won't match.

What I found in testing is that there are other fields that X509 ignores but should not. These include 0 length fields that are place holders for things like the stripped out Certificates.

The other attack now possible is due to there being 2 different PKI token versions. A PKI token could be converted to a PKIZ token, and the signature is still valid. That was not the case when the hashing approach was chosen.

The most common reason for token revocations is logout from the WebUI.

The impact is probably small but consequential; it only affects revoked tokens in the CLI cases. In the webUI case, the tokens are never stored in full except inside the token database. Instead, the WebUI hashes them, and discards the CMS document. Since this is the primary cause of revocations, these tokens are not at risk.

The second most common is password changes. Since these are performed by the end users themselves, the risk here is slight, but not 0.

The most worry some are token revocations for users leaving a project or being disabled altogether. In order for this attack to be viable, the user must have had a valid token prior to the event, and then they could re-enable the token. Since token timeout is a variable, we can;t make any assumptions. We turned the default down to 1 hour, but many sites found this was too short for workflows, and set the value back to 12 hours.

Root cause is the assumption that any tampering with the PKI token would invalidate the token. There are three major fields in the token that are resistant:
1. The message. Any change to the message will be detected due to it not matching the signature.
2. The signature. Any change to the signature and the message will no longer match its signature.
3. The singning info. This checked against the X509 signing cert byte-by-byte. Any change and it won't match.
What I found in testing is that there are other fields that X509 ignores but should not. These include 0 length fields that are place holders for things like the stripped out Certificates.
The other attack now possible is due to there being 2 different PKI token versions. A PKI token could be converted to a PKIZ token, and the signature is still valid. That was not the case when the hashing approach was chosen.
The most common reason for token revocations is logout from the WebUI.
The impact is probably small but consequential; it only affects revoked tokens in the CLI cases. In the webUI case, the tokens are never stored in full except inside the token database. Instead, the WebUI hashes them, and discards the CMS document. Since this is the primary cause of revocations, these tokens are not at risk.
The second most common is password changes. Since these are performed by the end users themselves, the risk here is slight, but not 0.
The most worry some are token revocations for users leaving a project or being disabled altogether. In order for this attack to be viable, the user must have had a valid token prior to the event, and then they could re-enable the token. Since token timeout is a variable, we can;t make any assumptions. We turned the default down to 1 hour, but many sites found this was too short for workflows, and set the value back to 12 hours.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Liusheng (liusheng)](https://launchpad.net/~liusheng) wrote on 2015-09-21: |  |  | [#39](/keystone/%2Bbug/1490804/comments/39) |
| --- | --- | --- | --- |

* [bug1490804-patch-test-traceback.txt](https://bugs.launchpad.net/keystone/%2Bbug/1490804/%2Battachment/4469888/%2Bfiles/bug1490804-patch-test-traceback.txt)
  [Edit](/keystone/%2Bbug/1490804/%2Battachment/4469888)
  (7.6 KiB,
  text/plain)

Hi Adam Young,

My colleague has applied your patch with Juno version keystone, the original problem is successfully solved, however some random errors occur when issuing both v2 and v3 token, the tracebacks are as below.

Seems the errors are introduced by the patch, and we didn't found the root cause. traceback info please see the attachment could you please take a look ?

Keystone is running on apache with worker mode.

Version of pyasn1 packages are:

python-pyasn1-modules-0.0.7-33.2

python-pyasn1-0.1.2-0.5.1

OS is Suse SLE11 SP3

Hi Adam Young,
My colleague has applied your patch with Juno version keystone, the original problem is successfully solved, however some random errors occur when issuing both v2 and v3 token, the tracebacks are as below.
Seems the errors are introduced by the patch, and we didn't found the root cause. traceback info please see the attachment could you please take a look ?
Keystone is running on apache with worker mode.
Version of pyasn1 packages are:
python-pyasn1-modules-0.0.7-33.2
python-pyasn1-0.1.2-0.5.1
OS is Suse SLE11 SP3

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2015-09-21: |  |  | [#40](/keystone/%2Bbug/1490804/comments/40) |
| --- | --- | --- | --- |

Since this seems related to a bad design in PKI(z) token for which the fix isn't easily backportable, I suggest a B type of bug.

Also, since this requires a fair amount of social engineering to abuse this bug, is there a good reason to keep this under embargo ?

Since this seems related to a bad design in PKI(z) token for which the fix isn't easily backportable, I suggest a B type of bug.
Also, since this requires a fair amount of social engineering to abuse this bug, is there a good reason to keep this under embargo ?

[Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray)
on 2015-11-02

| Changed in ossn: | |
| --- | --- |
| **importance**: | Undecided → Critical |

[Nathan Kinder (nkinder)](https://launchpad.net/~nkinder)
on 2015-11-12

| Changed in ossn: | |
| --- | --- |
| **assignee**: | nobody → Nathan Kinder (nkinder) |

[Adam Young (ayoung)](https://launchpad.net/~ayoung)
on 2015-11-19

| Changed in keystone: | |
| --- | --- |
| **status**: | Triaged → Won't Fix |
| Changed in keystonemiddleware: | |
| **status**: | Triaged → Won't Fix |
| Changed in python-keystoneclient: | |
| **status**: | Triaged → Won't Fix |

| 22 comments hidden Loading more comments | [view all 102 comments](?comments=all) |
| --- | --- |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2015-12-02: |  |  | [#63](/keystone/%2Bbug/1490804/comments/63) |
| --- | --- | --- | --- |

Considering this bug exploitation requires administrator action (e.g., to issue token revocation), I would prefer this bug report to be public. Operator could use this information to enforce a more strict revocation process while the fix is being implemented.

What is the status of the OSSN ?

How about we open the bug at the same time we issue the security note, then we could review the proposed patch on gerrit and we'll eventually issue an OSSA if the solution is safely backportable ?

Considering this bug exploitation requires administrator action (e.g., to issue token revocation), I would prefer this bug report to be public. Operator could use this information to enforce a more strict revocation process while the fix is being implemented.
What is the status of the OSSN ?
How about we open the bug at the same time we issue the security note, then we could review the proposed patch on gerrit and we'll eventually issue an OSSA if the solution is safely backportable ?

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Brant Knudson (blk-u)](https://launchpad.net/~blk-u) wrote on 2015-12-02: |  |  | [#64](/keystone/%2Bbug/1490804/comments/64) |
| --- | --- | --- | --- |

The exploit doesn't require admin action. Tokens can be revoked by the user, or they can be revoked by the user changing their password. Tokens can also be made invalid by admins taking away the user's roles.

The exploit doesn't require admin action. Tokens can be revoked by the user, or they can be revoked by the user changing their password. Tokens can also be made invalid by admins taking away the user's roles.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2015-12-02: |  |  | [#65](/keystone/%2Bbug/1490804/comments/65) |
| --- | --- | --- | --- |

Brant, the only scenario I considered is when a malicious user is able to keep access after an operator revoked his token or took away his roles. iiuc the exploit you described requires valid token, what can the user do with tokens he invalidated himself ?

Brant, the only scenario I considered is when a malicious user is able to keep access after an operator revoked his token or took away his roles. iiuc the exploit you described requires valid token, what can the user do with tokens he invalidated himself ?

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Brant Knudson (blk-u)](https://launchpad.net/~blk-u) wrote on 2015-12-02: |  |  | [#66](/keystone/%2Bbug/1490804/comments/66) |
| --- | --- | --- | --- |

Tristan - The only thing I can think of is the user revokes their own tokens because they're concerned that it's been exposed. So they think they're stopping the 3rd party from using their token but the 3rd party can still use the token by modifying it slightly (until the token expires).

Yes, the typical concern would be an admin thinks the user's old tokens are revoked but they're still usable until they expire.

Tristan - The only thing I can think of is the user revokes their own tokens because they're concerned that it's been exposed. So they think they're stopping the 3rd party from using their token but the 3rd party can still use the token by modifying it slightly (until the token expires).
Yes, the typical concern would be an admin thinks the user's old tokens are revoked but they're still usable until they expire.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Nathan Kinder (nkinder)](https://launchpad.net/~nkinder) wrote on 2015-12-02: |  |  | [#67](/keystone/%2Bbug/1490804/comments/67) |
| --- | --- | --- | --- |

Tristan - I have the OSSN draft written up, which has been reviewed by a few people from the Security team as well as by Adam Young. If we are also going to provide a fix, I will need to reword a few things in the "recommendations" section. Here is the current draft of the OSSN:

-----

Potential reuse of revoked Identity tokens

---

### Summary ###

An authorization token issued by the Identity service can be revoked,

which is designed to immediately make that token invalid for future use.

When the PKI or PKIZ token formats are used, it is possible for an

attacker to manipulate the token contents of a revoked token such that

the token will still be considered to be valid. This can allow

unauthorized access to cloud resources if a revoked token is intercepted

by an attacker.

### Affected Services / Software ###

Keystone, Icehouse, Juno, Kilo, Liberty

### Discussion ###

Token revocation is used in OpenStack to invalidate a token for further

use. This token revocation takes place automatically in certain

situations, such as when a user logs out of the Dashboard. If a revoked

token is obtained by another party, it should no longer be possible to

use it to perform any actions within the cloud. Unfortuantely, this is

not the case when the PKI or PKIZ token format is used.

When a PKI or PKIZ token is validated, the Identity service checks it

by searching for a revocation by the entire token. It is possible for

an attacker to manipulate portions of an intercepted PKI or PKIZ token

that are not cryptographically protected, which will cause the

revocation check to improperly consider the token to be valid.

### Recommended Actions ###

We recommend that you do not use the PKI or PKIZ token formats. Due to

the way that these formats were designed, it is not possible to fix this

issue in a way that is backwards compatible. The PKI and PKIZ token

formats do not offer any significant benefit over other token formats

such as the UUID or Fernet formats.

If you are using the PKI or PKIZ token format, it is recommended that

you switch to using another supported token format such as the UUID

format. There are no plans to fix this issue in the PKI and PKIZ token

providers in the Identity service.

To check what token provider you are using, you must look in the

'keystone.conf' file for your Identity service. An example is provided

below:

---- begin keystone.conf sample snippet ----

[token]

#provider = keystone.token.providers.pki.Provider

#provider = keystone.token.providers.pkiz.Provider

provider = keystone.token.providers.uuid.Provider

---- end keystone.conf sample snippet ----

This configuration snippet is using the UUID token format. If you are

using either of the commented out settings from this example, your cloud

is vulnerable to this issue and you should switch to a different token

provider.

### Contacts / References ###

This OSSN : <https://wiki.openstack.org/wiki/OSSN/OSSN-0061>

Original LaunchPad Bug : [https://bugs.launchpad.net/keystone/+bug/1490804](https://bugs.launchpad.net/keystone/%2Bbug/1490804)

OpenStack Security ML : <email address hidden>

OpenStack Security Group : <https://launchpad.net/~openstack-ossg>

Tristan - I have the OSSN draft written up, which has been reviewed by a few people from the Security team as well as by Adam Young. If we are also going to provide a fix, I will need to reword a few things in the "recommendations" section. Here is the current draft of the OSSN:
-----
Potential reuse of revoked Identity tokens
---
### Summary ###
An authorization token issued by the Identity service can be revoked,
which is designed to immediately make that token invalid for future use.
When the PKI or PKIZ token formats are used, it is possible for an
attacker to manipulate the token contents of a revoked token such that
the token will still be considered to be valid. This can allow
unauthorized access to cloud resources if a revoked token is intercepted
by an attacker.
### Affected Services / Software ###
Keystone, Icehouse, Juno, Kilo, Liberty
### Discussion ###
Token revocation is used in OpenStack to invalidate a token for further
use. This token revocation takes place automatically in certain
situations, such as when a user logs out of the Dashboard. If a revoked
token is obtained by another party, it should no longer be possible to
use it to perform any actions within the cloud. Unfortuantely, this is
not the case when the PKI or PKIZ token format is used.
When a PKI or PKIZ token is validated, the Identity service checks it
by searching for a revocation by the entire token. It is possible for
an attacker to manipulate portions of an intercepted PKI or PKIZ token
that are not cryptographically protected, which will cause the
revocation check to improperly consider the token to be valid.
### Recommended Actions ###
We recommend that you do not use the PKI or PKIZ token formats. Due to
the way that these formats were designed, it is not possible to fix this
issue in a way that is backwards compatible. The PKI and PKIZ token
formats do not offer any significant benefit over other token formats
such as the UUID or Fernet formats.
If you are using the PKI or PKIZ token format, it is recommended that
you switch to using another supported token format such as the UUID
format. There are no plans to fix this issue in the PKI and PKIZ token
providers in the Identity service.
To check what token provider you are using, you must look in the
'keystone.conf' file for your Identity service. An example is provided
below:
---- begin keystone.conf sample snippet ----
[token]
#provider = keystone.token.providers.pki.Provider
#provider = keystone.token.providers.pkiz.Provider
provider = keystone.token.providers.uuid.Provider
---- end keystone.conf sample snippet ----
This configuration snippet is using the UUID token format. If you are
using either of the commented out settings from this example, your cloud
is vulnerable to this issue and you should switch to a different token
provider.
### Contacts / References ###
This OSSN : https://wiki.openstack.org/wiki/OSSN/OSSN-0061
Original LaunchPad Bug : https://bugs.launchpad.net/keystone/+bug/1490804
OpenStack Security ML : openstack-security@lists.openstack.org
OpenStack Security Group : https://launchpad.net/~openstack-ossg

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2015-12-02: |  |  | [#68](/keystone/%2Bbug/1490804/comments/68) |
| --- | --- | --- | --- |

Thanks, so we could remove the first chapter of "Recommended Actions" and send this OSSN as an advance notification. We'll then open the bug and review Brant's patch on gerrit. Thought ?

Thanks, so we could remove the first chapter of "Recommended Actions" and send this OSSN as an advance notification. We'll then open the bug and review Brant's patch on gerrit. Thought ?

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Jeremy Stanley (fungi)](https://launchpad.net/~fungi) wrote on 2015-12-03: |  |  | [#69](/keystone/%2Bbug/1490804/comments/69) |
| --- | --- | --- | --- |

It seems reasonable to go forward with the OSSN worded to assume there is no fix forthcoming. Then once there's an actual fix merged to stable branches we can follow up with an OSSA (though worth keeping in mind the proposed backport, as far as I understand, only solves the problem for tokens revoked after the patch gets applied, not any which predate its application).

It seems reasonable to go forward with the OSSN worded to assume there is no fix forthcoming. Then once there's an actual fix merged to stable branches we can follow up with an OSSA (though worth keeping in mind the proposed backport, as far as I understand, only solves the problem for tokens revoked after the patch gets applied, not any which predate its application).

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Nathan Kinder (nkinder)](https://launchpad.net/~nkinder) wrote on 2015-12-03: |  |  | [#70](/keystone/%2Bbug/1490804/comments/70) |
| --- | --- | --- | --- |

Jeremy - Agreed. Are we ready to make this issue public then? Is everyone OK with the OSSN draft I provided in my previous comment?

As soon as we make it public, I can propose the OSSN review and fast-track it's merge and get it published.

Jeremy - Agreed. Are we ready to make this issue public then? Is everyone OK with the OSSN draft I provided in my previous comment?
As soon as we make it public, I can propose the OSSN review and fast-track it's merge and get it published.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Brant Knudson (blk-u)](https://launchpad.net/~blk-u) wrote on 2015-12-03: |  |  | [#71](/keystone/%2Bbug/1490804/comments/71) |
| --- | --- | --- | --- |

Jeremy - Once the change is applied to keystone then the revocation list will include the audit IDs. The audit IDs are already in the token table so that will be available. As such, the fix will work for old tokens.

Comments on the proposed OSSN

1) change "token formats" to "token providers"

2) In the sample config, since keystone has support for using entrypoints for the provider, the examples should also have:

#provider = pki

 #provider = pkiz

This was introduced in liberty so earlier releases need to use keystone.token.providers.uuid.Provider whereas liberty and later should use uuid or fernet

Jeremy - Once the change is applied to keystone then the revocation list will include the audit IDs. The audit IDs are already in the token table so that will be available. As such, the fix will work for old tokens.
Comments on the proposed OSSN
1) change "token formats" to "token providers"
2) In the sample config, since keystone has support for using entrypoints for the provider, the examples should also have:
#provider = pki
#provider = pkiz
This was introduced in liberty so earlier releases need to use keystone.token.providers.uuid.Provider whereas liberty and later should use uuid or fernet

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Jeremy Stanley (fungi)](https://launchpad.net/~fungi) wrote on 2015-12-03: |  |  | [#72](/keystone/%2Bbug/1490804/comments/72) |
| --- | --- | --- | --- |

Brant: Excellent! That's better than I had hoped (was assuming only the full document hash was being stored for earlier tokens). So this really would, in theory, be a complete fix for stable branch consumers. With that in mind, I agree it makes sense to slightly lighten the bit of the OSSN about no possibility of a backward compatible fix. Still shouldn't imply that there is definitely one coming in case something unforeseen happens in review, but getting awareness of the bug and mitigation recommendations out to deployers/operators in the near term is still a good idea.

Brant: Excellent! That's better than I had hoped (was assuming only the full document hash was being stored for earlier tokens). So this really would, in theory, be a complete fix for stable branch consumers. With that in mind, I agree it makes sense to slightly lighten the bit of the OSSN about no possibility of a backward compatible fix. Still shouldn't imply that there is definitely one coming in case something unforeseen happens in review, but getting awareness of the bug and mitigation recommendations out to deployers/operators in the near term is still a good idea.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Nathan Kinder (nkinder)](https://launchpad.net/~nkinder) wrote on 2015-12-09: |  |  | [#73](/keystone/%2Bbug/1490804/comments/73) |
| --- | --- | --- | --- |

[Download full text](https://bugs.launchpad.net/keystone/%2Bbug/1490804/comments/73/%2Bdownload) (3.3 KiB)

Here is a new draft of the OSSN that contains the suggestions made by Brant as well the suggestion made by Jeremy with regards to there being a possibility of a future fix. If this looks good to everyone, I think we can move forward with publishing and opening this bug up.

----------

Potential reuse of revoked Identity tokens

---

### Summary ###

An authorization token issued by the Identity service can be revoked,

which is designed to immediately make that token invalid for future use.

When the PKI or PKIZ token providers are used, it is possible for an

attacker to manipulate the token contents of a revoked token such that

the token will still be considered to be valid. This can allow

unauthorized access to cloud resources if a revoked token is intercepted

by an attacker.

### Affected Services / Software ###

Keystone, Icehouse, Juno, Kilo, Liberty

### Discussion ###

Token revocation is used in OpenStack to invalidate a token for further

use. This token revocation takes place automatically in certain

situations, such as when a user logs out of the Dashboard. If a revoked

token is obtained by another party, it should no longer be possible to

use it to perform any actions within the cloud. Unfortunately, this is

not the case when the PKI or PKIZ token providers are used.

When a PKI or PKIZ token is validated, the Identity service checks it

by searching for a revocation by the entire token. It is possible for

an attacker to manipulate portions of an intercepted PKI or PKIZ token

that are not cryptographically protected, which will cause the

revocation check to improperly consider the token to be valid.

### Recommended Actions ###

We recommend that you do not use the PKI or PKIZ token providers. The

PKI and PKIZ token providers do not offer any significant benefit over

other token providers such as the UUID or Fernet.

If you are using the PKI or PKIZ token providers, it is recommended that

you switch to using another supported token provider such as the UUID

provider. This issue might be fixed in a future update of the PKI and

PKIZ token providers in the Identity service.

To check what token provider you are using, you must look in the

'keystone.conf' file for your Identity service. An example is provided

below:

---- begin keystone.conf sample snippet ----

[token]

#provider = keystone.token.providers.pki.Provider

#provider = keystone.token.providers.pkiz.Provider

provider = keystone.token.providers.uuid.Provider

---- end keystone.conf sample snippet ----

In the Liberty release of the Identity service, the token provider

configuration is different than previous OpenStack releases. An

example from the Libery release is provided below:

---- begin keystone.conf sample snippet ----

[token]

#provider = pki

#provider = pkiz

provider = uuid

---- end keystone.conf sample snippet ----

These configuration snippets are using the UUID token provider. If you

are using any of the commented out settings from these examples, your

cloud is vulnerable to this issue and you should switch to a different

token provider.

### Contacts / References ###

This OSSN : <https://wiki.openstack.org/wiki/OSSN/OSSN-0061>

Original LaunchPad Bug : <https://bugs>...

[Read more...](/keystone/%2Bbug/1490804/comments/73)

Here is a new draft of the OSSN that contains the suggestions made by Brant as well the suggestion made by Jeremy with regards to there being a possibility of a future fix. If this looks good to everyone, I think we can move forward with publishing and opening this bug up.
----------
Potential reuse of revoked Identity tokens
---
### Summary ###
An authorization token issued by the Identity service can be revoked,
which is designed to immediately make that token invalid for future use.
When the PKI or PKIZ token providers are used, it is possible for an
attacker to manipulate the token contents of a revoked token such that
the token will still be considered to be valid. This can allow
unauthorized access to cloud resources if a revoked token is intercepted
by an attacker.
### Affected Services / Software ###
Keystone, Icehouse, Juno, Kilo, Liberty
### Discussion ###
Token revocation is used in OpenStack to invalidate a token for further
use. This token revocation takes place automatically in certain
situations, such as when a user logs out of the Dashboard. If a revoked
token is obtained by another party, it should no longer be possible to
use it to perform any actions within the cloud. Unfortunately, this is
not the case when the PKI or PKIZ token providers are used.
When a PKI or PKIZ token is validated, the Identity service checks it
by searching for a revocation by the entire token. It is possible for
an attacker to manipulate portions of an intercepted PKI or PKIZ token
that are not cryptographically protected, which will cause the
revocation check to improperly consider the token to be valid.
### Recommended Actions ###
We recommend that you do not use the PKI or PKIZ token providers. The
PKI and PKIZ token providers do not offer any significant benefit over
other token providers such as the UUID or Fernet.
If you are using the PKI or PKIZ token providers, it is recommended that
you switch to using another supported token provider such as the UUID
provider. This issue might be fixed in a future update of the PKI and
PKIZ token providers in the Identity service.
To check what token provider you are using, you must look in the
'keystone.conf' file for your Identity service. An example is provided
below:
---- begin keystone.conf sample snippet ----
[token]
#provider = keystone.token.providers.pki.Provider
#provider = keystone.token.providers.pkiz.Provider
provider = keystone.token.providers.uuid.Provider
---- end keystone.conf sample snippet ----
In the Liberty release of the Identity service, the token provider
configuration is different than previous OpenStack releases. An
example from the Libery release is provided below:
---- begin keystone.conf sample snippet ----
[token]
#provider = pki
#provider = pkiz
provider = uuid
---- end keystone.conf sample snippet ----
These configuration snippets are using the UUID token provider. If you
are using any of the commented out settings from these examples, your
cloud is vulnerable to this issue and you should switch to a different
token provider.
### Contacts / References ###
This OSSN : https://wiki.openstack.org/wiki/OSSN/OSSN-0061
Original LaunchPad Bug : https://bugs.launchpad.net/keystone/+bug/1490804
OpenStack Security ML : openstack-security@lists.openstack.org
OpenStack Security Group : https://launchpad.net/~openstack-ossg

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Steve Martinelli (stevemar)](https://launchpad.net/~stevemar) wrote on 2015-12-09: |  |  | [#74](/keystone/%2Bbug/1490804/comments/74) |
| --- | --- | --- | --- |

@Nate, not sure if you also want to mention that the PKI and PKIz token providers are not deprecated in Mitaka.

@Nate, not sure if you also want to mention that the PKI and PKIz token providers are not deprecated in Mitaka.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2015-12-09: |  |  | [#75](/keystone/%2Bbug/1490804/comments/75) |
| --- | --- | --- | --- |

Once the OSSN is approved, I'd like to send it as an advance notification to stakeholders before opening this bug.

Assuming it is done by tomorrow, this could be disclosed next Tuesday:

2015-12-15, 1500UTC

Once the OSSN is approved, I'd like to send it as an advance notification to stakeholders before opening this bug.
Assuming it is done by tomorrow, this could be disclosed next Tuesday:
2015-12-15, 1500UTC

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Brant Knudson (blk-u)](https://launchpad.net/~blk-u) wrote on 2015-12-09: |  |  | [#76](/keystone/%2Bbug/1490804/comments/76) |
| --- | --- | --- | --- |

the OSSN in comment 73 looks good to me.

the OSSN in comment 73 looks good to me.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2015-12-10: |  |  | [#77](/keystone/%2Bbug/1490804/comments/77) |
| --- | --- | --- | --- |

The OSSN has been sent, let's open this bug next Tuesday (2015-12-15, 1500UTC).

The OSSN has been sent, let's open this bug next Tuesday (2015-12-15, 1500UTC).

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2015-12-10:  [**Re: PKI Token Revocation Bypass (CVE-2015-7546)**](/keystone/%2Bbug/1490804/comments/78) |  |  | [#78](/keystone/%2Bbug/1490804/comments/78) |
| --- | --- | --- | --- |

Red Hat preemptively assigned CVE-2015-7546 for this vulnerability.

Red Hat preemptively assigned CVE-2015-7546 for this vulnerability.

| **summary**: | - PKI Token Revocation Bypass+ PKI Token Revocation Bypass (CVE-2015-7546) |
| --- | --- |

[Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray)
on 2015-12-15

| **information type**: | Private Security → Public Security |
| --- | --- |
| **description**: | updated |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2015-12-15: |  |  | [#79](/keystone/%2Bbug/1490804/comments/79) |
| --- | --- | --- | --- |

This bug is now public, OSSN and Keystone patches can be submitted to gerrit.

This bug is now public, OSSN and Keystone patches can be submitted to gerrit.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Nathan Kinder (nkinder)](https://launchpad.net/~nkinder) wrote on 2015-12-15: |  |  | [#80](/keystone/%2Bbug/1490804/comments/80) |
| --- | --- | --- | --- |

The OSSN review has been submitted:

<https://review.openstack.org/#/c/258119/>

The OSSN review has been submitted:
https://review.openstack.org/#/c/258119/

[OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack)
on 2015-12-15

| Changed in keystone: | |
| --- | --- |
| **assignee**: | Adam Young (ayoung) → Brant Knudson (blk-u) |
| **status**: | Won't Fix → In Progress |
| Changed in keystonemiddleware: | |
| **assignee**: | Adam Young (ayoung) → Brant Knudson (blk-u) |
| **status**: | Won't Fix → In Progress |

[Steve Martinelli (stevemar)](https://launchpad.net/~stevemar)
on 2015-12-15

| Changed in keystone: | |
| --- | --- |
| **milestone**: | none → mitaka-2 |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Nathan Kinder (nkinder)](https://launchpad.net/~nkinder) wrote on 2015-12-16: |  |  | [#81](/keystone/%2Bbug/1490804/comments/81) |
| --- | --- | --- | --- |

This issue has been published as OSSN-0062:

<https://wiki.openstack.org/wiki/OSSN/OSSN-0062>

This issue has been published as OSSN-0062:
https://wiki.openstack.org/wiki/OSSN/OSSN-0062

| Changed in ossn: | |
| --- | --- |
| **status**: | New → Fix Released |

[Brant Knudson (blk-u)](https://launchpad.net/~blk-u)
on 2015-12-17

| **tags**: | added: kilo-backport-potential liberty-backport-potential |
| --- | --- |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2015-12-21: |  |  | [#82](/keystone/%2Bbug/1490804/comments/82) |
| --- | --- | --- | --- |

The fix for keystone[master] is <https://review.openstack.org/#/c/258141> . Can this be proposed to stable liberty and kilo too ?

The fix for keystone[master] is https://review.openstack.org/#/c/258141 . Can this be proposed to stable liberty and kilo too ?

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Brant Knudson (blk-u)](https://launchpad.net/~blk-u) wrote on 2015-12-21: |  |  | [#83](/keystone/%2Bbug/1490804/comments/83) |
| --- | --- | --- | --- |

Tristan - It can be proposed, although some might consider the change to be a new feature rather than a bug fix, so not sure if it's appropriate for stable. I'd prefer for the change to be merged in master before I backport it otherwise I'll have make changes in multiple releases if there's a -1.

Tristan - It can be proposed, although some might consider the change to be a new feature rather than a bug fix, so not sure if it's appropriate for stable. I'd prefer for the change to be merged in master before I backport it otherwise I'll have make changes in multiple releases if there's a -1.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Steve Martinelli (stevemar)](https://launchpad.net/~stevemar) wrote on 2015-12-22: |  |  | [#84](/keystone/%2Bbug/1490804/comments/84) |
| --- | --- | --- | --- |

Brant & Tristan, I think it should be fine to backport to kilo and liberty. It's an important security related fix and I consider the proposed changes to be a bug and not a feature.

Brant & Tristan, I think it should be fine to backport to kilo and liberty. It's an important security related fix and I consider the proposed changes to be a bug and not a feature.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2016-01-05: |  |  | [#85](/keystone/%2Bbug/1490804/comments/85) |
| --- | --- | --- | --- |

Thanks, then considering this is going to be fixed in stable release, I've confirmed the OSSA task.

Thanks, then considering this is going to be fixed in stable release, I've confirmed the OSSA task.

| Changed in ossa: | |
| --- | --- |
| **status**: | Incomplete → Confirmed |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2016-01-09:  [**Fix merged to keystone (master)**](/keystone/%2Bbug/1490804/comments/86) |  |  | [#86](/keystone/%2Bbug/1490804/comments/86) |
| --- | --- | --- | --- |

Reviewed: <https://review.openstack.org/258141>

Committed: <https://git.openstack.org/cgit/openstack/keystone/commit/?id=d5378f173da14a34ca010271477337879002d6d0>

Submitter: Jenkins

Branch: master

commit d5378f173da14a34ca010271477337879002d6d0

Author: Brant Knudson <email address hidden>

Date: Tue Dec 1 11:09:14 2015 -0600

Add audit IDs to revocation events

The revoked tokens' audit ID is now included in the data returned in

    the revocation list.

Closes-Bug: 1490804

    Change-Id: Ifcf88f1158bebddc4f927121fbf4136fb53b659f

Reviewed: https://review.openstack.org/258141
Committed: https://git.openstack.org/cgit/openstack/keystone/commit/?id=d5378f173da14a34ca010271477337879002d6d0
Submitter: Jenkins
Branch: master
commit d5378f173da14a34ca010271477337879002d6d0
Author: Brant Knudson <bknudson@us.ibm.com>
Date: Tue Dec 1 11:09:14 2015 -0600
Add audit IDs to revocation events
The revoked tokens' audit ID is now included in the data returned in
the revocation list.
Closes-Bug: 1490804
Change-Id: Ifcf88f1158bebddc4f927121fbf4136fb53b659f

| Changed in keystone: | |
| --- | --- |
| **status**: | In Progress → Fix Released |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2016-01-11:  [**Fix proposed to keystonemiddleware (stable/liberty)**](/keystone/%2Bbug/1490804/comments/87) |  |  | [#87](/keystone/%2Bbug/1490804/comments/87) |
| --- | --- | --- | --- |

Fix proposed to branch: stable/liberty

Review: <https://review.openstack.org/265988>

Fix proposed to branch: stable/liberty
Review: https://review.openstack.org/265988

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2016-01-11:  [**Fix merged to keystonemiddleware (master)**](/keystone/%2Bbug/1490804/comments/88) |  |  | [#88](/keystone/%2Bbug/1490804/comments/88) |
| --- | --- | --- | --- |

Reviewed: <https://review.openstack.org/258143>

Committed: <https://git.openstack.org/cgit/openstack/keystonemiddleware/commit/?id=96ab58e6863c92575ada57615b19652e502adfd8>

Submitter: Jenkins

Branch: master

commit 96ab58e6863c92575ada57615b19652e502adfd8

Author: Brant Knudson <email address hidden>

Date: Tue Dec 1 16:08:00 2015 -0600

auth\_token verify revocation by audit\_id

If the revocation list includes audit\_ids, then when doing offline

    validation also validate the token isn't revoked by audit\_id.

Closes-Bug: 1490804

    Change-Id: I483bc57bd38eb81a0905bcaf94e4ea82604919d6

Reviewed: https://review.openstack.org/258143
Committed: https://git.openstack.org/cgit/openstack/keystonemiddleware/commit/?id=96ab58e6863c92575ada57615b19652e502adfd8
Submitter: Jenkins
Branch: master
commit 96ab58e6863c92575ada57615b19652e502adfd8
Author: Brant Knudson <bknudson@us.ibm.com>
Date: Tue Dec 1 16:08:00 2015 -0600
auth\_token verify revocation by audit\_id
If the revocation list includes audit\_ids, then when doing offline
validation also validate the token isn't revoked by audit\_id.
Closes-Bug: 1490804
Change-Id: I483bc57bd38eb81a0905bcaf94e4ea82604919d6

| Changed in keystonemiddleware: | |
| --- | --- |
| **status**: | In Progress → Fix Released |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2016-01-11:  [**Fix proposed to keystone (stable/liberty)**](/keystone/%2Bbug/1490804/comments/89) |  |  | [#89](/keystone/%2Bbug/1490804/comments/89) |
| --- | --- | --- | --- |

Fix proposed to branch: stable/liberty

Review: <https://review.openstack.org/266022>

Fix proposed to branch: stable/liberty
Review: https://review.openstack.org/266022

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2016-01-11:  [**Fix proposed to keystone (stable/kilo)**](/keystone/%2Bbug/1490804/comments/90) |  |  | [#90](/keystone/%2Bbug/1490804/comments/90) |
| --- | --- | --- | --- |

Fix proposed to branch: stable/kilo

Review: <https://review.openstack.org/266045>

Fix proposed to branch: stable/kilo
Review: https://review.openstack.org/266045

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2016-01-12:  [**Fix proposed to keystonemiddleware (stable/kilo)**](/keystone/%2Bbug/1490804/comments/91) |  |  | [#91](/keystone/%2Bbug/1490804/comments/91) |
| --- | --- | --- | --- |

Fix proposed to branch: stable/kilo

Review: <https://review.openstack.org/266607>

Fix proposed to branch: stable/kilo
Review: https://review.openstack.org/266607

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Doug Hellmann (doug-hellmann)](https://launchpad.net/~doug-hellmann) wrote on 2016-01-13:  [**Fix included in openstack/keystonemiddleware 4.1.0**](/keystone/%2Bbug/1490804/comments/92) |  |  | [#92](/keystone/%2Bbug/1490804/comments/92) |
| --- | --- | --- | --- |

This issue was fixed in the openstack/keystonemiddleware 4.1.0 release.

This issue was fixed in the openstack/keystonemiddleware 4.1.0 release.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2016-01-14:  [**Fix merged to keystone (stable/kilo)**](/keystone/%2Bbug/1490804/comments/93) |  |  | [#93](/keystone/%2Bbug/1490804/comments/93) |
| --- | --- | --- | --- |

Reviewed: <https://review.openstack.org/266045>

Committed: <https://git.openstack.org/cgit/openstack/keystone/commit/?id=9c9c1331e0c004897d5f4c5847f7143b56373f10>

Submitter: Jenkins

Branch: stable/kilo

commit 9c9c1331e0c004897d5f4c5847f7143b56373f10

Author: Brant Knudson <email address hidden>

Date: Tue Dec 1 11:09:14 2015 -0600

Add audit IDs to revocation events

The revoked tokens' audit ID is now included in the data returned in

    the revocation list.

Closes-Bug: 1490804

    Change-Id: Ifcf88f1158bebddc4f927121fbf4136fb53b659f

    (cherry picked from commit d5378f173da14a34ca010271477337879002d6d0)

    Conflicts:

     keystone/tests/unit/test\_backend.py

Reviewed: https://review.openstack.org/266045
Committed: https://git.openstack.org/cgit/openstack/keystone/commit/?id=9c9c1331e0c004897d5f4c5847f7143b56373f10
Submitter: Jenkins
Branch: stable/kilo
commit 9c9c1331e0c004897d5f4c5847f7143b56373f10
Author: Brant Knudson <bknudson@us.ibm.com>
Date: Tue Dec 1 11:09:14 2015 -0600
Add audit IDs to revocation events
The revoked tokens' audit ID is now included in the data returned in
the revocation list.
Closes-Bug: 1490804
Change-Id: Ifcf88f1158bebddc4f927121fbf4136fb53b659f
(cherry picked from commit d5378f173da14a34ca010271477337879002d6d0)
Conflicts:
keystone/tests/unit/test\_backend.py

| **tags**: | added: in-stable-kilo |
| --- | --- |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2016-01-14:  [**Fix merged to keystone (stable/liberty)**](/keystone/%2Bbug/1490804/comments/94) |  |  | [#94](/keystone/%2Bbug/1490804/comments/94) |
| --- | --- | --- | --- |

Reviewed: <https://review.openstack.org/266022>

Committed: <https://git.openstack.org/cgit/openstack/keystone/commit/?id=bff03b5726fe5cac93d44a66715eea49b89c8cb0>

Submitter: Jenkins

Branch: stable/liberty

commit bff03b5726fe5cac93d44a66715eea49b89c8cb0

Author: Brant Knudson <email address hidden>

Date: Tue Dec 1 11:09:14 2015 -0600

Add audit IDs to revocation events

The revoked tokens' audit ID is now included in the data returned in

    the revocation list.

Closes-Bug: 1490804

    Change-Id: Ifcf88f1158bebddc4f927121fbf4136fb53b659f

    (cherry picked from commit d5378f173da14a34ca010271477337879002d6d0)

    Conflicts:

     keystone/tests/unit/test\_backend.py

Reviewed: https://review.openstack.org/266022
Committed: https://git.openstack.org/cgit/openstack/keystone/commit/?id=bff03b5726fe5cac93d44a66715eea49b89c8cb0
Submitter: Jenkins
Branch: stable/liberty
commit bff03b5726fe5cac93d44a66715eea49b89c8cb0
Author: Brant Knudson <bknudson@us.ibm.com>
Date: Tue Dec 1 11:09:14 2015 -0600
Add audit IDs to revocation events
The revoked tokens' audit ID is now included in the data returned in
the revocation list.
Closes-Bug: 1490804
Change-Id: Ifcf88f1158bebddc4f927121fbf4136fb53b659f
(cherry picked from commit d5378f173da14a34ca010271477337879002d6d0)
Conflicts:
keystone/tests/unit/test\_backend.py

| **tags**: | added: in-stable-liberty |
| --- | --- |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2016-01-19:  [**Fix merged to keystonemiddleware (stable/liberty)**](/keystone/%2Bbug/1490804/comments/95) |  |  | [#95](/keystone/%2Bbug/1490804/comments/95) |
| --- | --- | --- | --- |

Reviewed: <https://review.openstack.org/265988>

Committed: <https://git.openstack.org/cgit/openstack/keystonemiddleware/commit/?id=9167afaafc216c63fdc875e737bc379400e94059>

Submitter: Jenkins

Branch: stable/liberty

commit 9167afaafc216c63fdc875e737bc379400e94059

Author: Brant Knudson <email address hidden>

Date: Tue Dec 1 16:08:00 2015 -0600

auth\_token verify revocation by audit\_id

If the revocation list includes audit\_ids, then when doing offline

    validation also validate the token isn't revoked by audit\_id.

Backport notes:

    - test\_auth\_token\_middleware was refactored with commit 9cbd47b to

      check responses differently, so the test changed to use the old

      method.

    - reno was not supported so the release note is removed.

Closes-Bug: 1490804

    Change-Id: I483bc57bd38eb81a0905bcaf94e4ea82604919d6

    (cherry picked from commit 96ab58e6863c92575ada57615b19652e502adfd8)

Reviewed: https://review.openstack.org/265988
Committed: https://git.openstack.org/cgit/openstack/keystonemiddleware/commit/?id=9167afaafc216c63fdc875e737bc379400e94059
Submitter: Jenkins
Branch: stable/liberty
commit 9167afaafc216c63fdc875e737bc379400e94059
Author: Brant Knudson <bknudson@us.ibm.com>
Date: Tue Dec 1 16:08:00 2015 -0600
auth\_token verify revocation by audit\_id
If the revocation list includes audit\_ids, then when doing offline
validation also validate the token isn't revoked by audit\_id.
Backport notes:
- test\_auth\_token\_middleware was refactored with commit 9cbd47b to
check responses differently, so the test changed to use the old
method.
- reno was not supported so the release note is removed.
Closes-Bug: 1490804
Change-Id: I483bc57bd38eb81a0905bcaf94e4ea82604919d6
(cherry picked from commit 96ab58e6863c92575ada57615b19652e502adfd8)

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Thierry Carrez (ttx)](https://launchpad.net/~ttx) wrote on 2016-01-21:  [**Fix included in openstack/keystone 9.0.0.0b2**](/keystone/%2Bbug/1490804/comments/96) |  |  | [#96](/keystone/%2Bbug/1490804/comments/96) |
| --- | --- | --- | --- |

This issue was fixed in the openstack/keystone 9.0.0.0b2 development milestone.

This issue was fixed in the openstack/keystone 9.0.0.0b2 development milestone.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2016-01-21:  [**Re: PKI Token Revocation Bypass (CVE-2015-7546)**](/keystone/%2Bbug/1490804/comments/97) |  |  | [#97](/keystone/%2Bbug/1490804/comments/97) |
| --- | --- | --- | --- |

I've put the stable/kilo task back to In Progress. The fix is half committed it is still missing:

  <https://review.openstack.org/#/c/266607/>

I've put the stable/kilo task back to In Progress. The fix is half committed it is still missing:
https://review.openstack.org/#/c/266607/

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2016-01-25:  [**Fix merged to keystonemiddleware (stable/kilo)**](/keystone/%2Bbug/1490804/comments/98) |  |  | [#98](/keystone/%2Bbug/1490804/comments/98) |
| --- | --- | --- | --- |

Reviewed: <https://review.openstack.org/266607>

Committed: <https://git.openstack.org/cgit/openstack/keystonemiddleware/commit/?id=70eeda3e06f5422aa953a38fe93d302079d7cc21>

Submitter: Jenkins

Branch: stable/kilo

commit 70eeda3e06f5422aa953a38fe93d302079d7cc21

Author: Brant Knudson <email address hidden>

Date: Tue Dec 1 16:08:00 2015 -0600

auth\_token verify revocation by audit\_id

If the revocation list includes audit\_ids, then when doing offline

    validation also validate the token isn't revoked by audit\_id.

Backport notes:

    - test\_auth\_token\_middleware was refactored with commit 9cbd47b to

      check responses differently, so the test changed to use the old

      method.

    - reno was not supported so the release note is removed.

Closes-Bug: 1490804

    Conflicts:

     keystonemiddleware/auth\_token/\_\_init\_\_.py

(cherry picked from commit 96ab58e6863c92575ada57615b19652e502adfd8)

    Change-Id: I483bc57bd38eb81a0905bcaf94e4ea82604919d6

Reviewed: https://review.openstack.org/266607
Committed: https://git.openstack.org/cgit/openstack/keystonemiddleware/commit/?id=70eeda3e06f5422aa953a38fe93d302079d7cc21
Submitter: Jenkins
Branch: stable/kilo
commit 70eeda3e06f5422aa953a38fe93d302079d7cc21
Author: Brant Knudson <bknudson@us.ibm.com>
Date: Tue Dec 1 16:08:00 2015 -0600
auth\_token verify revocation by audit\_id
If the revocation list includes audit\_ids, then when doing offline
validation also validate the token isn't revoked by audit\_id.
Backport notes:
- test\_auth\_token\_middleware was refactored with commit 9cbd47b to
check responses differently, so the test changed to use the old
method.
- reno was not supported so the release note is removed.
Closes-Bug: 1490804
Conflicts:
keystonemiddleware/auth\_token/\_\_init\_\_.py
(cherry picked from commit 96ab58e6863c92575ada57615b19652e502adfd8)
Change-Id: I483bc57bd38eb81a0905bcaf94e4ea82604919d6

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2016-01-28:  [**Related fix proposed to ossa (master)**](/keystone/%2Bbug/1490804/comments/99) |  |  | [#99](/keystone/%2Bbug/1490804/comments/99) |
| --- | --- | --- | --- |

Related fix proposed to branch: master

Review: <https://review.openstack.org/273679>

Related fix proposed to branch: master
Review: https://review.openstack.org/273679

[Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray)
on 2016-01-29

| **summary**: | - PKI Token Revocation Bypass (CVE-2015-7546)+ [OSSA 2015-006] PKI Token Revocation Bypass (CVE-2015-7546) |
| --- | --- |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2016-01-29:  [**Related fix merged to ossa (master)**](/keystone/%2Bbug/1490804/comments/100) |  |  | [#100](/keystone/%2Bbug/1490804/comments/100) |
| --- | --- | --- | --- |

Reviewed: <https://review.openstack.org/273679>

Committed: <https://git.openstack.org/cgit/openstack/ossa/commit/?id=1e03c88750db3cfdd01a59c6084b624b22c78c72>

Submitter: Jenkins

Branch: master

commit 1e03c88750db3cfdd01a59c6084b624b22c78c72

Author: Tristan Cacqueray <email address hidden>

Date: Thu Jan 28 12:24:15 2016 -0500

Adds OSSA-2016-005 (CVE-2015-7546)

This change also remove issues 'type' which isn't used and can't

    be extended to support other type such as OSSN.

Change-Id: I037c8e808466bbdceac38d6cf10a3f98703ad99f

    Related-Bug: #1490804

Reviewed: https://review.openstack.org/273679
Committed: https://git.openstack.org/cgit/openstack/ossa/commit/?id=1e03c88750db3cfdd01a59c6084b624b22c78c72
Submitter: Jenkins
Branch: master
commit 1e03c88750db3cfdd01a59c6084b624b22c78c72
Author: Tristan Cacqueray <tdecacqu@redhat.com>
Date: Thu Jan 28 12:24:15 2016 -0500
Adds OSSA-2016-005 (CVE-2015-7546)
This change also remove issues 'type' which isn't used and can't
be extended to support other type such as OSSN.
Change-Id: I037c8e808466bbdceac38d6cf10a3f98703ad99f
Related-Bug: #1490804

[Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray)
on 2016-01-29

| **summary**: | - [OSSA 2015-006] PKI Token Revocation Bypass (CVE-2015-7546)+ [OSSA 2015-005] PKI Token Revocation Bypass (CVE-2015-7546) |
| --- | --- |
| Changed in ossa: | |
| **status**: | Confirmed → Fix Released |
| **summary**: | - [OSSA 2015-005] PKI Token Revocation Bypass (CVE-2015-7546)+ [OSSA 2016-005] PKI Token Revocation Bypass (CVE-2015-7546) |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Doug Hellmann (doug-hellmann)](https://launchpad.net/~doug-hellmann) wrote on 2016-03-03:  [**Fix included in openstack/keystone 8.1.0**](/keystone/%2Bbug/1490804/comments/101) |  |  | [#101](/keystone/%2Bbug/1490804/comments/101) |
| --- | --- | --- | --- |

This issue was fixed in the openstack/keystone 8.1.0 release.

This issue was fixed in the openstack/keystone 8.1.0 release.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Doug Hellmann (doug-hellmann)](https://launchpad.net/~doug-hellmann) wrote on 2016-03-03:  [**Fix included in openstack/keystonemiddleware 2.3.3**](/keystone/%2Bbug/1490804/comments/102) |  |  | [#102](/keystone/%2Bbug/1490804/comments/102) |
| --- | --- | --- | --- |

This issue was fixed in the openstack/keystonemiddleware 2.3.3 release.

This issue was fixed in the openstack/keystonemiddleware 2.3.3 release.

[See full activity log](https://bugs.launchpad.net/keystone/%2Bbug/1490804/%2Bactivity)

Displaying first 40
and last 40
comments.
[View all 102
comments](/keystone/%2Bbug/1490804?comments=all) or [add a comment](/keystone/%2Bbug/1490804?comments=all).

* [Report a bug](/keystone/%2Bfilebug)

This report contains
**Public Security**
information

Everyone can see this security related information.

You are
[not directly subscribed to this bug's notifications.](/keystone/%2Bbug/1490804/%2Bsubscribe)

Subscribing...

* [Edit bug mail](https://bugs.launchpad.net/keystone/%2Bbug/1490804/%2Bsubscriptions "View and change your subscriptions to this bug")

## Other bug subscribers

[Subscribe someone else](https://bugs.launchpad.net/keystone/%2Bbug/1490804/%2Baddsubscriber "Launchpad will email that person whenever this bugs changes")

## Patches

* [bug-1490804-tests-master-v1.patch](https://bugs.launchpad.net/keystone/%2Bbug/1490804/%2Battachment/4456156/%2Bfiles/bug-1490804-tests-master-v1.patch)
  [Edit](/keystone/%2Bbug/1490804/%2Battachment/4456156 "Change patch details")
* [0001-Reject-modified-PKI-Tokens.patch](https://bugs.launchpad.net/keystone/%2Bbug/1490804/%2Battachment/4456676/%2Bfiles/0001-Reject-modified-PKI-Tokens.patch)
  [Edit](/keystone/%2Bbug/1490804/%2Battachment/4456676 "Change patch details")
* [0001-hash-the-data-in-the-token.patch](https://bugs.launchpad.net/keystone/%2Bbug/1490804/%2Battachment/4456711/%2Bfiles/0001-hash-the-data-in-the-token.patch)
  [Edit](/keystone/%2Bbug/1490804/%2Battachment/4456711 "Change patch details")
* [0001-Use-the-Keystoneclient-code-to-hash-the-token.patch](https://bugs.launchpad.net/keystone/%2Bbug/1490804/%2Battachment/4456923/%2Bfiles/0001-Use-the-Keystoneclient-code-to-hash-the-token.patch)
  [Edit](/keystone/%2Bbug/1490804/%2Battachment/4456923 "Change patch details")
* [0001-Disable-PKI-token-Provider.patch](https://bugs.launchpad.net/keystone/%2Bbug/1490804/%2Battachment/4508239/%2Bfiles/0001-Disable-PKI-token-Provider.patch)
  [Edit](/keystone/%2Bbug/1490804/%2Battachment/4508239 "Change patch details")
* [0001-Add-audit-IDs-to-revocation-events.patch](https://bugs.launchpad.net/keystone/%2Bbug/1490804/%2Battachment/4528257/%2Bfiles/0001-Add-audit-IDs-to-revocation-events.patch)
  [Edit](/keystone/%2Bbug/1490804/%2Battachment/4528257 "Change patch details")
* [0001-Verify-audit\_id-when-available.patch](https://bugs.launchpad.net/keystone/%2Bbug/1490804/%2Battachment/4528258/%2Bfiles/0001-Verify-audit_id-when-available.patch)
  [Edit](/keystone/%2Bbug/1490804/%2Battachment/4528258 "Change patch details")

* [Add patch](/keystone/%2Bbug/1490804/%2Baddcomment?field.patch=on)

## Bug attachments

* [modify\_token.py](https://bugs.launchpad.net/keystone/%2Bbug/1490804/%2Battachment/4455970/%2Bfiles/modify_token.py)
  [Edit](/keystone/%2Bbug/1490804/%2Battachment/4455970 "Change attachment details")
* [derdump of Token data in ASN1 format](https://bugs.launchpad.net/keystone/%2Bbug/1490804/%2Battachment/4455971/%2Bfiles/tokendata)
  [Edit](/keystone/%2Bbug/1490804/%2Battachment/4455971 "Change attachment details")
* [bug1490804-patch-test-traceback.txt](https://bugs.launchpad.net/keystone/%2Bbug/1490804/%2Battachment/4469888/%2Bfiles/bug1490804-patch-test-traceback.txt)
  [Edit](/keystone/%2Bbug/1490804/%2Battachment/4469888 "Change attachment details")

* [Add attachment](/keystone/%2Bbug/1490804/%2Baddcomment)

## Remote bug watches

Bug watches keep track of this bug in other bug trackers.

[![Launchpad](/@@/launchpad-footer-logo.svg)](https://launchpad.net/)
 •
[Take the tour](https://launchpad.net/%2Btour)
 •
[Read the guide](https://help.launchpad.net/)

© 2004
[Canonical Ltd.](http://canonical.com/)
 •
[Terms of use](https://launchpad.net/legal)
 •
[Data privacy](https://www.ubuntu.com/legal/dataprivacy)
 •
[Contact Launchpad Support](/feedback)
 •
[Blog](http://blog.launchpad.net/)
 •
[Careers](https://canonical.com/careers)
 •
[System status](https://ubuntu.social/%40launchpadstatus)
 •
4d55102
([Get the code!](https://dev.launchpad.net/))



=== Content from answers.launchpad.net_da5dcf83_20250126_131121.html ===

[Log in / Register](https://answers.launchpad.net/keystone/%2Blogin)

[![](https://launchpadlibrarian.net/359059841/OpenStack_Project_Keystone_mascot%20%281%29.png)](https://launchpad.net/keystone)

## [OpenStack Identity (keystone)](https://launchpad.net/keystone)

* [Overview](https://launchpad.net/keystone)
* [Code](https://code.launchpad.net/keystone)
* [Bugs](https://bugs.launchpad.net/keystone)
* [Blueprints](https://blueprints.launchpad.net/keystone)
* [Translations](https://translations.launchpad.net/keystone)
* Answers

# Questions for OpenStack Identity (keystone)

**Launchpad does not know where
OpenStack Identity (keystone)
tracks support requests.**

OpenStack Identity (keystone) questions are
tracked in:
[keystone in Ubuntu](/ubuntu/%2Bsource/keystone).

[![Launchpad](/@@/launchpad-footer-logo.svg)](https://launchpad.net/)
 •
[Take the tour](https://launchpad.net/%2Btour)
 •
[Read the guide](https://help.launchpad.net/)

© 2004
[Canonical Ltd.](http://canonical.com/)
 •
[Terms of use](https://launchpad.net/legal)
 •
[Data privacy](https://www.ubuntu.com/legal/dataprivacy)
 •
[Contact Launchpad Support](/feedback)
 •
[Blog](http://blog.launchpad.net/)
 •
[Careers](https://canonical.com/careers)
 •
[System status](https://ubuntu.social/%40launchpadstatus)
 •
4d55102
([Get the code!](https://dev.launchpad.net/))



=== Content from launchpad.net_9e50c715_20250126_131125.html ===

[Log in / Register](https://launchpad.net/~tristan-cacqueray/%2Blogin)

[![](/@@/person-logo)](https://launchpad.net/~tristan-cacqueray)

## [Tristan Cacqueray](https://launchpad.net/~tristan-cacqueray)

* Overview
* [Code](https://code.launchpad.net/~tristan-cacqueray)
* [Bugs](https://bugs.launchpad.net/~tristan-cacqueray)
* [Blueprints](https://blueprints.launchpad.net/~tristan-cacqueray)
* [Translations](https://translations.launchpad.net/~tristan-cacqueray)
* [Answers](https://answers.launchpad.net/~tristan-cacqueray)

* [Related packages](https://launchpad.net/~tristan-cacqueray/%2Brelated-packages)
* [Related projects](https://launchpad.net/~tristan-cacqueray/%2Brelated-projects)

## User information

Launchpad Id:
tristan-cacqueray

Email:
[Log in](%2Blogin) for email information.

Member since:
2013-10-25

[![Icon of OpenStack Security SIG](https://launchpadlibrarian.net/203991792/os14.png "Member of OpenStack Security SIG")](/~openstack-ossg)

Signed Ubuntu Code of Conduct:
Yes

Languages:

English

OpenPGP keys:

EB103DE8B5E69E631C6FF17922B9A05C925CC5D8

SSH keys:

[localadmin@controller](%2Bsshkeys)

Time zone:

UTC
(UTC+0000)

Karma:
[0](https://launchpad.net/~tristan-cacqueray/%2Bkarma)
[Karma help](/%2Bhelp-registry/karma.html)

Social accounts:
![IRC](/@@/social-irc "IRC")
**tristanC**
 on
**irc.freenode.net**

## [All memberships](https://launchpad.net/~tristan-cacqueray/%2Bparticipation) Latest memberships

| [Swiftsync dev](/~swiftsync-devteam)  Joined on 2014-02-13 | |
| --- | --- |
| [OpenStack Security SIG](/~openstack-ossg)  Joined on 2013-12-12 | |

[![Launchpad](/@@/launchpad-footer-logo.svg)](https://launchpad.net/)
 •
[Take the tour](https://launchpad.net/%2Btour)
 •
[Read the guide](https://help.launchpad.net/)

© 2004
[Canonical Ltd.](http://canonical.com/)
 •
[Terms of use](https://launchpad.net/legal)
 •
[Data privacy](https://www.ubuntu.com/legal/dataprivacy)
 •
[Contact Launchpad Support](/feedback)
 •
[Blog](http://blog.launchpad.net/)
 •
[Careers](https://canonical.com/careers)
 •
[System status](https://ubuntu.social/%40launchpadstatus)
 •
4d55102
([Get the code!](https://dev.launchpad.net/))



=== Content from security.openstack.org_6716ab57_20250126_004110.html ===


Toggle navigation

 Search

* [Software](https://www.openstack.org/software/)
  + [Overview](https://www.openstack.org/software/)
  + [OpenStack Components](https://www.openstack.org/software/project-navigator/openstack-components)
  + [SDKs](https://www.openstack.org/software/project-navigator/sdks)
  + [Deployment Tools](https://www.openstack.org/software/project-navigator/deployment-tools)
  + [OpenStack Map](https://www.openstack.org/assets/software/projectmap/openstack-map.pdf)
  + [Sample Configs](https://www.openstack.org/software/sample-configs/)
* [Use Cases](https://www.openstack.org/use-cases/)
  + [Users in Production](https://www.openstack.org/use-cases/)
  + [Ironic Bare Metal](https://www.openstack.org/use-cases/bare-metal/)
  + [Edge Computing](https://www.openstack.org/use-cases/edge-computing/)
  + [Telecom & NFV](https://www.openstack.org/use-cases/telecoms-and-nfv/)
  + [Science and HPC](https://www.openstack.org/use-cases/science/)
  + [Containers](https://www.openstack.org/use-cases/containers/)
  + [Enterprise](https://www.openstack.org/use-cases/enterprise/)
  + [User Survey](https://www.openstack.org/surveys/landing)
* [Events](https://openinfra.dev/summit)
  + [OpenInfra Summit](https://openinfra.dev/summit)
  + [Project Teams Gathering](https://www.openstack.org/ptg/)
  + [OpenDev](https://www.openstack.org/events/opendev-2020/)
  + [Community Events](https://www.openstack.org/events/community-events/)
  + [OpenStack & OpenInfra Days](https://www.openstack.org/events/openstackdays)
  + [Summit Videos](https://www.openstack.org/videos/)
* [Community](https://www.openstack.org/community/)
  + [Welcome! Start Here](https://www.openstack.org/community/)
  + [OpenStack Technical Committee](https://www.openstack.org/community/tech-committee)
  + [Speakers Bureau](https://www.openstack.org/community/speakers/)
  + [OpenStack Wiki](http://wiki.openstack.org)
  + [Get Certified (COA)](https://www.openstack.org/coa/)
  + [Jobs](https://www.openstack.org/community/jobs/)
  + [Marketing Resources](https://www.openstack.org/marketing/)
  + [Community News](https://www.openstack.org/news/)
  + [Superuser Magazine](http://superuser.openstack.org)
  + [OpenInfra Foundation Supporting Organizations](https://www.openstack.org/community/supporting-organizations/)
  + [OpenInfra Foundation](https://openinfra.dev)
* [Marketplace](https://www.openstack.org/marketplace/)
  + [Training](https://www.openstack.org/marketplace/training/)
  + [Distros & Appliances](https://www.openstack.org/marketplace/distros/)
  + [Public Clouds](https://www.openstack.org/marketplace/public-clouds/)
  + [Hosted Private Clouds](https://www.openstack.org/marketplace/hosted-private-clouds/)
  + [Remotely Managed Private Clouds](https://www.openstack.org/marketplace/remotely-managed-private-clouds/)
  + [Consulting & Integrators](https://www.openstack.org/marketplace/consulting/)
  + [Drivers](https://www.openstack.org/marketplace/drivers/)
* [Blog](https://www.openstack.org/blog/)
* [Docs](http://docs.openstack.org/)
* [Join](https://openinfra.dev/join/)
  + [Sign up for Foundation Membership](https://openinfra.dev/join/)
  + [Sponsor the Foundation](https://openinfra.dev/join/)
  + [More about the Foundation](https://openinfra.dev)
* [Log In](https://www.openstack.org/Security/login/?BackURL=/home/)

# OSSA-2016-005: Potential reuse of revoked Identity tokens

# OSSA-2016-005: Potential reuse of revoked Identity tokens[Â¶](#ossa-2016-005-potential-reuse-of-revoked-identity-tokens "Link to this heading")

Date:

January 29, 2016

CVE:

CVE-2015-7546

## Affects[Â¶](#affects "Link to this heading")

* Keystone: <= 2015.1.2, >= 8.0.0 <= 8.0.1
* Keystonemiddleware: >= 1.5.0 <= 1.5.3, >= 1.6.0 <= 2.3.2

## Description[Â¶](#description "Link to this heading")

Liu Sheng reported a vulnerability in Keystone. By manipulating a token content, an authenticated user may prevent its revocation. This can allow unauthorized access to cloud resources if a revoked token is intercepted by an attacker. Only keystone setups using PKI or PKIZ token are affected

## Patches[Â¶](#patches "Link to this heading")

* <https://review.openstack.org/266045> (keystone) (Kilo)
* <https://review.openstack.org/266607> (keystonemiddleware) (Kilo)
* <https://review.openstack.org/266022> (keystone) (Liberty)
* <https://review.openstack.org/265988> (keystonemiddleware) (Liberty)
* <https://review.openstack.org/258141> (keystone) (Mitaka)
* <https://review.openstack.org/258143> (keystonemiddleware) (Mitaka)

## Credits[Â¶](#credits "Link to this heading")

* Liu Sheng from Huawei (CVE-2015-7546)

## References[Â¶](#references "Link to this heading")

* <https://bugs.launchpad.net/bugs/1490804>
* <https://wiki.openstack.org/wiki/OSSN/OSSN-0062>
* <http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2015-7546>

## Notes[Â¶](#notes "Link to this heading")

* The keystone fix is included in 2015.1.3 (Kilo) and will be included
  in a future 8.0.2 (Liberty) releases.
* The keystonemiddleware fix will be included in future 1.5.4 (Kilo) and
  2.3.3 (Liberty) releases.
* Both keystone and keystonemiddleware needs to be updated

this page last updated: 2025-01-07 18:17:35

[![Creative Commons Attribution 3.0 License](../_static/images/docs/license.png)](https://creativecommons.org/licenses/by/3.0/)

Except where otherwise noted, this document is licensed under
[Creative Commons
Attribution 3.0 License](https://creativecommons.org/licenses/by/3.0/). See all [OpenStack Legal Documents](https://www.openstack.org/legal).

found an error? report a bug

OpenStack Documentation

* Guides
* [Install Guides](https://docs.openstack.org/index.html#install-guides)
* [User Guides](https://docs.openstack.org/index.html#user-guides)
* [Configuration Guides](https://docs.openstack.org/index.html#configuration-guides)
* [Operations and Administration Guides](https://docs.openstack.org/index.html#ops-and-admin-guides)
* [API Guides](https://docs.openstack.org/index.html#api-guides)
* [Contributor Guides](https://docs.openstack.org/index.html#contributor-guides)
* Languages
* [Deutsch (German)](https://docs.openstack.org/de/)
* [FranÃ§ais (French)](https://docs.openstack.org/fr/)
* [Bahasa Indonesia (Indonesian)](https://docs.openstack.org/id/)
* [Italiano (Italian)](https://docs.openstack.org/it/)
* [æ¥æ¬èª (Japanese)](https://docs.openstack.org/ja/)
* [íêµ­ì´ (Korean)](https://docs.openstack.org/ko_KR/)
* [PortuguÃªs (Portuguese)](https://docs.openstack.org/pt_BR/)
* [TÃ¼rkÃ§e (TÃ¼rkiye)](https://docs.openstack.org/tr_TR/)
* [ç®ä½ä¸­æ (Simplified Chinese)](https://docs.openstack.org/zh_CN/)

#### Contents

* OSSA-2016-005: Potential reuse of revoked Identity tokens
  + [Affects](#affects)
  + [Description](#description)
  + [Patches](#patches)
  + [Credits](#credits)
  + [References](#references)
  + [Notes](#notes)

### OpenStack

* [Projects](https://www.openstack.org/software/project-navigator/)
* [OpenStack Security](https://security.openstack.org/)
* [Blog](https://openstack.org/blog/)
* [News](https://openstack.org/news/)

### Community

* [User Groups](https://www.meetup.com/pro/openinfradev/)
* [Events](https://openstack.org/community/events/)
* [Jobs](https://openstack.org/community/jobs/)
* [Companies](https://openinfra.dev/members/)
* [Contribute](https://docs.openstack.org/contributors)

### Documentation

* [OpenStack Manuals](https://docs.openstack.org)
* [Getting Started](https://openstack.org/software/start/)
* [API Documentation](https://developer.openstack.org)
* [Wiki](https://wiki.openstack.org)

### Branding & Legal

* [Legal Docs](https://openinfra.dev/legal)
* [Logos & Guidelines](https://openstack.org/brand/)
* [Trademark Policy](https://openinfra.dev/legal/trademark-policy)
* [Privacy Policy](https://openinfra.dev/privacy-policy)
* [OpenInfra CLA](https://docs.openstack.org/contributors/common/setup-gerrit.html#individual-contributor-license-agreement)

### Stay In Touch

The OpenStack project is provided under the
[Apache 2.0 license](https://www.apache.org/licenses/LICENSE-2.0). Docs.openstack.org is powered by
[Rackspace Cloud Computing](https://rackspace.com).



=== Content from bugs.launchpad.net_2ccaabc6_20250126_131128.html ===

[Log in / Register](https://bugs.launchpad.net/keystone/%2Bbug/1490804/%2Blogin)

[![](https://launchpadlibrarian.net/359059841/OpenStack_Project_Keystone_mascot%20%281%29.png)](https://launchpad.net/keystone)

## [OpenStack Identity (keystone)](https://launchpad.net/keystone)

* [Overview](https://launchpad.net/keystone)
* [Code](https://code.launchpad.net/keystone)
* [Bugs](https://bugs.launchpad.net/keystone)
* [Blueprints](https://blueprints.launchpad.net/keystone)
* [Translations](https://translations.launchpad.net/keystone)
* [Answers](https://answers.launchpad.net/keystone)

# [OSSA 2016-005] PKI Token Revocation Bypass (CVE-2015-7546)

Bug #1490804 reported by
[Liusheng](https://launchpad.net/~liusheng)
on 2015-09-01

[264](/%2Bhelp-bugs/bug-heat.html)

This bug affects 1 person

| Affects | | Status | Importance | Assigned to | Milestone |
| --- | --- | --- | --- | --- | --- |
|  | [OpenStack Identity (keystone)](https://bugs.launchpad.net/keystone) | Fix Released | High | [Brant Knudson](https://launchpad.net/~blk-u) | [OpenStack Identity (keystone) mitaka-2 "m2"](https://launchpad.net/keystone/%2Bmilestone/mitaka-2) |
|  | [Kilo](https://bugs.launchpad.net/keystone/kilo) | Fix Released | High | Unassigned | [OpenStack Identity (keystone) 2015.1.3](https://launchpad.net/keystone/%2Bmilestone/2015.1.3) |
|  | [OpenStack Security Advisory](https://bugs.launchpad.net/ossa) | Fix Released | Undecided | Unassigned |  |
|  | [OpenStack Security Notes](https://bugs.launchpad.net/ossn) | Fix Released | Critical | [Nathan Kinder](https://launchpad.net/~nkinder) |  |
|  | [django-openstack-auth](https://bugs.launchpad.net/django-openstack-auth) | Invalid | Undecided | [Adam Young](https://launchpad.net/~ayoung) |  |
|  | [keystonemiddleware](https://bugs.launchpad.net/keystonemiddleware) | Fix Released | High | [Brant Knudson](https://launchpad.net/~blk-u) |  |
|  | [python-keystoneclient](https://bugs.launchpad.net/python-keystoneclient) | Won't Fix | Undecided | [Adam Young](https://launchpad.net/~ayoung) |  |

### Bug Description

A keystone token which has been revoked can still be used by manipulating particular byte fields within the token.

When a Keystone token is revoked it is added to the revoked list which stores the exact token value. Any API will look at the token to see whether or not it should accept a token. By changing a single byte within the token, the revocation can be bypassed. see the testing script [1].

It is suggested that the revocation should be changed to only check the token's inner ID.

[1] <http://paste.openstack.org/show/436516/>

See [original description](comments/0)

Tags:

[in-stable-kilo](/keystone/%2Bbugs?field.tag=in-stable-kilo)
[in-stable-liberty](/keystone/%2Bbugs?field.tag=in-stable-liberty)
[kilo-backport-potential](/keystone/%2Bbugs?field.tag=kilo-backport-potential)
[liberty-backport-potential](/keystone/%2Bbugs?field.tag=liberty-backport-potential)

## CVE References

* [2015-7546](/bugs/cve/2015-7546 "The identity service in OpenStack Ide...")

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2015-09-01: |  |  | [#1](/keystone/%2Bbug/1490804/comments/1) |
| --- | --- | --- | --- |

Since this report concerns a possible security risk, an incomplete security advisory task has been added while the core security reviewers for the affected project or projects confirm the bug and discuss the scope of any vulnerability along with potential solutions.

Since this report concerns a possible security risk, an incomplete security advisory task has been added while the core security reviewers for the affected project or projects confirm the bug and discuss the scope of any vulnerability along with potential solutions.

| Changed in ossa: | |
| --- | --- |
| **status**: | New → Incomplete |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2015-09-01: |  |  | [#2](/keystone/%2Bbug/1490804/comments/2) |
| --- | --- | --- | --- |

The tests scripts does not show how token are created/revoked. What type of token is this ?

Maybe it's a swift setting that allows direct access to the swift account.

The tests scripts does not show how token are created/revoked. What type of token is this ?
Maybe it's a swift setting that allows direct access to the swift account.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Jeremy Stanley (fungi)](https://launchpad.net/~fungi) wrote on 2015-09-01: |  |  | [#3](/keystone/%2Bbug/1490804/comments/3) |
| --- | --- | --- | --- |

Please also be aware that paste.openstack.org contents are not secret/private and can be easily enumerated. We should probably consider this issue publicly disclosed at this point since an exploit has been published to the paste server.

Please also be aware that paste.openstack.org contents are not secret/private and can be easily enumerated. We should probably consider this issue publicly disclosed at this point since an exploit has been published to the paste server.

| **description**: | updated |
| --- | --- |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Morgan Fainberg (mdrnstm)](https://launchpad.net/~mdrnstm) wrote on 2015-09-01: |  |  | [#4](/keystone/%2Bbug/1490804/comments/4) |
| --- | --- | --- | --- |

I would like to know what version of keystone is being used here and what type of token.

This is definitely not uuid tokens, and I don't believe this can be fernet as fernet is live validated and does not rely on the token\_id for revocations.

Can this occur with services other than swift as well? I'll need to dig further on this unless the information can be provided.

I would like to know what version of keystone is being used here and what type of token.
This is definitely not uuid tokens, and I don't believe this can be fernet as fernet is live validated and does not rely on the token\_id for revocations.
Can this occur with services other than swift as well? I'll need to dig further on this unless the information can be provided.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Morgan Fainberg (mdrnstm)](https://launchpad.net/~mdrnstm) wrote on 2015-09-01: |  |  | [#5](/keystone/%2Bbug/1490804/comments/5) |
| --- | --- | --- | --- |

If this is PKI/PKIZ tokens, there are no "internal" IDs as the internal ID would be part of the signed data. The signed data cannot contain the ID itself as it would change the ID.

Discussing this a bit further it looks like "revoke by ID" should have been based on fingerprint or the signed data (as per adam young). Alternatively, we can now use the audit\_ids for "revoke by id"

I am still in process of confirming outside of swift.

If this is PKI/PKIZ tokens, there are no "internal" IDs as the internal ID would be part of the signed data. The signed data cannot contain the ID itself as it would change the ID.
Discussing this a bit further it looks like "revoke by ID" should have been based on fingerprint or the signed data (as per adam young). Alternatively, we can now use the audit\_ids for "revoke by id"
I am still in process of confirming outside of swift.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Dolph Mathews (dolph)](https://launchpad.net/~dolph) wrote on 2015-09-01: |  |  | [#6](/keystone/%2Bbug/1490804/comments/6) |
| --- | --- | --- | --- |

This sounds like it must be limited to PKI/PKIZ tokens? Fernet tokens would fail their HMAC and there is no room to manipulate UUID tokens unless you're guessing a completely different one.

In the script to reproduce, mutating token\_bin[1] would be manipulating the CMS length prefix (MIIE-\*, etc), in which case, I wonder if there's a bug in openssl?

Jeremy: please don't open this bug just because the paste is public. There's nothing in the paste that shouts "security vulnerability," and we should certainly have the ability to delete pastes (and move them here), no?

This sounds like it must be limited to PKI/PKIZ tokens? Fernet tokens would fail their HMAC and there is no room to manipulate UUID tokens unless you're guessing a completely different one.
In the script to reproduce, mutating token\_bin[1] would be manipulating the CMS length prefix (MIIE-\*, etc), in which case, I wonder if there's a bug in openssl?
Jeremy: please don't open this bug just because the paste is public. There's nothing in the paste that shouts "security vulnerability," and we should certainly have the ability to delete pastes (and move them here), no?

| Changed in keystone: | |
| --- | --- |
| **importance**: | Undecided → High |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Jeremy Stanley (fungi)](https://launchpad.net/~fungi) wrote on 2015-09-01: |  |  | [#7](/keystone/%2Bbug/1490804/comments/7) |
| --- | --- | --- | --- |

I won't switch this to public without consensus anyway, but can assure that there are crawlers continuously spidering our paste server (I know because I see them in the logs and they make up quite possibly the majority of requests there).

I won't switch this to public without consensus anyway, but can assure that there are crawlers continuously spidering our paste server (I know because I see them in the logs and they make up quite possibly the majority of requests there).

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Liusheng (liusheng)](https://launchpad.net/~liusheng) wrote on 2015-09-02: |  |  | [#8](/keystone/%2Bbug/1490804/comments/8) |
| --- | --- | --- | --- |

sorry, my mistake, this issue is occured with PKI token.

sorry, my mistake, this issue is occured with PKI token.

| **summary**: | - Token Revocation Bypass+ PKI Token Revocation Bypass |
| --- | --- |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Liusheng (liusheng)](https://launchpad.net/~liusheng) wrote on 2015-09-02:  [**Re: PKI Token Revocation Bypass**](/keystone/%2Bbug/1490804/comments/9) |  |  | [#9](/keystone/%2Bbug/1490804/comments/9) |
| --- | --- | --- | --- |

This issue is found by my colleagues, I will dig more and provide more information, thanks for your attention.

This issue is found by my colleagues, I will dig more and provide more information, thanks for your attention.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Dolph Mathews (dolph)](https://launchpad.net/~dolph) wrote on 2015-09-02: |  |  | [#10](/keystone/%2Bbug/1490804/comments/10) |
| --- | --- | --- | --- |

I won't be able to spend much time on this until at least Sept 4th, but I suspect this is easily reproducible and I'm wondering if the fix must be to make PKI depend on revocation events like Fernet does? Or perhaps to ignore the mutable characters when querying the token table?

I won't be able to spend much time on this until at least Sept 4th, but I suspect this is easily reproducible and I'm wondering if the fix must be to make PKI depend on revocation events like Fernet does? Or perhaps to ignore the mutable characters when querying the token table?

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Dolph Mathews (dolph)](https://launchpad.net/~dolph) wrote on 2015-09-02: |  |  | [#11](/keystone/%2Bbug/1490804/comments/11) |
| --- | --- | --- | --- |

Jeremy: I did not consider crawlers / mirrors. Deleting the paste now might only draw attention to it :)

Jeremy: I did not consider crawlers / mirrors. Deleting the paste now might only draw attention to it :)

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Dolph Mathews (dolph)](https://launchpad.net/~dolph) wrote on 2015-09-02: |  |  | [#12](/keystone/%2Bbug/1490804/comments/12) |
| --- | --- | --- | --- |

Liusheng: if you need to share any other files/logs/patches related to the bug, please add them as attachments to this bug (using the "Add attachment or patch" link at the bottom of the page).

Liusheng: if you need to share any other files/logs/patches related to the bug, please add them as attachments to this bug (using the "Add attachment or patch" link at the bottom of the page).

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Liusheng (liusheng)](https://launchpad.net/~liusheng) wrote on 2015-09-02: |  |  | [#13](/keystone/%2Bbug/1490804/comments/13) |
| --- | --- | --- | --- |

Dolph: sure, I am sorry I didn't realized the test script shouldn't be pasted in paste.openstack.org.

Dolph: sure, I am sorry I didn't realized the test script shouldn't be pasted in paste.openstack.org.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Liusheng (liusheng)](https://launchpad.net/~liusheng) wrote on 2015-09-02: |  |  | [#14](/keystone/%2Bbug/1490804/comments/14) |
| --- | --- | --- | --- |

I have confirmed they guys found this issue in Juno openstack, some version info used:

keystoneclient 0.11.2

keystone 2014.2

openssl-1.0.1i-2.1.4

openssl-certs-1.97-0.3.1

I have confirmed they guys found this issue in Juno openstack, some version info used:
keystoneclient 0.11.2
keystone 2014.2
openssl-1.0.1i-2.1.4
openssl-certs-1.97-0.3.1

[Adam Young (ayoung)](https://launchpad.net/~ayoung)
on 2015-09-02

| Changed in keystone: | |
| --- | --- |
| **assignee**: | nobody → Adam Young (ayoung) |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Adam Young (ayoung)](https://launchpad.net/~ayoung) wrote on 2015-09-02: |  |  | [#15](/keystone/%2Bbug/1490804/comments/15) |
| --- | --- | --- | --- |

This should only be a problem with PKI(Z) tokens. The fix can be made here:

<http://git.openstack.org/cgit/openstack/keystone/tree/keystone/token/utils.py>

Using the logic in the blog post here: <http://adam.younglogic.com/2014/10/who-signed-that-token/> we can pull out the signed data from the token and take a hash of that; modifying the hashed data will mean the token will not longer pass the CMS validation.

This will pull in an additional dependency on pyasn1 to Keystone. We cannot avoid that by calculating the hash on the JSON data itself, as it will not (necessarily) be reproducible.

In addition, Horizon will need an update, as they currently Md5 Hash the tokens before sending them to the remote services.

Another possibility is to generate a UUID for the token ID, and stick that inside the JSON body before signing. revocation could be done on the UUID value instead of the HASH. That would involve changing both Keystone and keystonemiddleware.

another alternative it to compare the signer info in the PKIZ token with the Certificate. If they don't match, the token is invalid. I don't know if it is possible to be 100% certain that the teokn cannot be tampered with.

This should only be a problem with PKI(Z) tokens. The fix can be made here:
http://git.openstack.org/cgit/openstack/keystone/tree/keystone/token/utils.py
Using the logic in the blog post here: http://adam.younglogic.com/2014/10/who-signed-that-token/ we can pull out the signed data from the token and take a hash of that; modifying the hashed data will mean the token will not longer pass the CMS validation.
This will pull in an additional dependency on pyasn1 to Keystone. We cannot avoid that by calculating the hash on the JSON data itself, as it will not (necessarily) be reproducible.
In addition, Horizon will need an update, as they currently Md5 Hash the tokens before sending them to the remote services.
Another possibility is to generate a UUID for the token ID, and stick that inside the JSON body before signing. revocation could be done on the UUID value instead of the HASH. That would involve changing both Keystone and keystonemiddleware.
another alternative it to compare the signer info in the PKIZ token with the Certificate. If they don't match, the token is invalid. I don't know if it is possible to be 100% certain that the teokn cannot be tampered with.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Morgan Fainberg (mdrnstm)](https://launchpad.net/~mdrnstm) wrote on 2015-09-02: |  |  | [#16](/keystone/%2Bbug/1490804/comments/16) |
| --- | --- | --- | --- |

Thanks for the information. It helps us to be sure we are looking at all avenues for the problem. I can see where this is happening and have discussed with Adam and a few other folks on it and how we are approachig potential fixes.

Thanks for the information. It helps us to be sure we are looking at all avenues for the problem. I can see where this is happening and have discussed with Adam and a few other folks on it and how we are approachig potential fixes.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Adam Young (ayoung)](https://launchpad.net/~ayoung) wrote on 2015-09-02: |  |  | [#17](/keystone/%2Bbug/1490804/comments/17) |
| --- | --- | --- | --- |

* [modify\_token.py](https://bugs.launchpad.net/keystone/%2Bbug/1490804/%2Battachment/4455970/%2Bfiles/modify_token.py)
  [Edit](/keystone/%2Bbug/1490804/%2Battachment/4455970)
  (995 bytes,
  text/x-python)

The attached code shows the modification of the binary data that still generates a valid token; it can be run from

python-keystoneclient/examples/pki and usese the sample tokens and certificates in the associated subdirectories.

This shows the modified bytes that successfully pass are:

77 78 79 80 81 82 83 85 86 87 88 3979 3980 3981 3982 3983 3985 3986 3987 3988 3991 3992 4364

The range 77 78 79 80 81 82 83 85 86 87 88 looks like the object identitfier s

1 3 14 3 2 26

and

1 2 840 113549 1 7 1

The last byte is padding.

To see the content of the token in PEM format

cat cms/auth\_v3\_token\_scoped.pem | awk ' ! /---/ {print $1}'| base64 -d | /usr/lib64/nss/unsupported-tools/derdump > /tmp/tokendata

The attached code shows the modification of the binary data that still generates a valid token; it can be run from
python-keystoneclient/examples/pki and usese the sample tokens and certificates in the associated subdirectories.
This shows the modified bytes that successfully pass are:
77 78 79 80 81 82 83 85 86 87 88 3979 3980 3981 3982 3983 3985 3986 3987 3988 3991 3992 4364
The range 77 78 79 80 81 82 83 85 86 87 88 looks like the object identitfier s
1 3 14 3 2 26
and
1 2 840 113549 1 7 1
The last byte is padding.
To see the content of the token in PEM format
cat cms/auth\_v3\_token\_scoped.pem | awk ' ! /---/ {print $1}'| base64 -d | /usr/lib64/nss/unsupported-tools/derdump > /tmp/tokendata

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Adam Young (ayoung)](https://launchpad.net/~ayoung) wrote on 2015-09-02: |  |  | [#18](/keystone/%2Bbug/1490804/comments/18) |
| --- | --- | --- | --- |

* [derdump of Token data in ASN1 format](https://bugs.launchpad.net/keystone/%2Bbug/1490804/%2Battachment/4455971/%2Bfiles/tokendata)
  [Edit](/keystone/%2Bbug/1490804/%2Battachment/4455971)
  (25.1 KiB,
  text/plain)

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Dolph Mathews (dolph)](https://launchpad.net/~dolph) wrote on 2015-09-02: |  |  | [#19](/keystone/%2Bbug/1490804/comments/19) |
| --- | --- | --- | --- |

The attached test manipulates UUID, PKI, PKIz, and Fernet tokens by incrementing and decrementing individual bytes, as illustrated in the bug description. This test passes against each token type, showing that the manipulated tokens cannot be validated \*online\* against keystone. To be clear, this patch does not contain a fix, nor does it confirm or invalidate the bug report.

Unless I missed something, that means the scope of this bug is limited to validating tokens offline (against the token revocation list in keystonemiddleware.auth\_token).

The attached test manipulates UUID, PKI, PKIz, and Fernet tokens by incrementing and decrementing individual bytes, as illustrated in the bug description. This test passes against each token type, showing that the manipulated tokens cannot be validated \*online\* against keystone. To be clear, this patch does not contain a fix, nor does it confirm or invalidate the bug report.
Unless I missed something, that means the scope of this bug is limited to validating tokens offline (against the token revocation list in keystonemiddleware.auth\_token).

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Dolph Mathews (dolph)](https://launchpad.net/~dolph) wrote on 2015-09-02: |  |  | [#20](/keystone/%2Bbug/1490804/comments/20) |
| --- | --- | --- | --- |

* [bug-1490804-tests-master-v1.patch](https://bugs.launchpad.net/keystone/%2Bbug/1490804/%2Battachment/4456156/%2Bfiles/bug-1490804-tests-master-v1.patch)
  [Edit](/keystone/%2Bbug/1490804/%2Battachment/4456156)
  (4.4 KiB,
  text/plain)

Of course, it would help if I attached the patch.

Of course, it would help if I attached the patch.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Adam Young (ayoung)](https://launchpad.net/~ayoung) wrote on 2015-09-02: |  |  | [#21](/keystone/%2Bbug/1490804/comments/21) |
| --- | --- | --- | --- |

Dolph; yeah, this is only for checking the revocation list; the tokens themselves need to be valid tokens. It is restricted to PKI based tokens only. The mistake was using the hash of the whole document for the token id; it should have been the same hash of the token tdata that is used for the cryptographic signature. The values being manipulated are the ASN1 specific values that indicate "This next block is signed data" which openssl really should be validating.

For example; here is a diff of a derdump of the origianl file and the modified file, with some lines of context;

$ diff -U 10 /tmp/auth\_v3\_token\_scoped\_orig.pem.txt /tmp/auth\_v3\_token\_scoped77.pem.txt

--- /tmp/auth\_v3\_token\_scoped\_orig.pem.txt 2015-09-02 11:27:46.423313737 -0400

+++ /tmp/auth\_v3\_token\_scoped77.pem.txt 2015-09-02 11:27:46.398313755 -0400

@@ -4,21 +4,21 @@

    C-[0] (3176)

       C-Sequence (3172)

          Integer (1)

             01

          C-Set (9)

             C-Sequence (7)

                Object Identifier (5)

                   1 3 14 3 2 26 (SHA-1)

          C-Sequence (2692)

             Object Identifier (9)

- 1 2 840 113549 1 7 1 (PKCS #7 Data)

+ 0 26 840 113549 1 7 1

             C-[0] (2677)

                Octet String (2673)

                   7b 22 74 6f 6b 65 6e 22 3a 20 7b 22 6d 65 74 68 6f 64

                   73 22 3a 20 5b 22 70 61 73 73 77 6f 72 64 22 5d 2c 20

                   22 72 6f 6c 65 73 22 3a 20 5b 7b 22 69 64 22 3a 20 22

                   66 30 33 66 64 61 38 66 38 61 33 32 34 39 62 32 61 37

                   30 66 62 31 66 31 37 36 61 37 62 36 33 31 22 2c 20 22

                   6e 61 6d 65 22 3a 20 22 72 6f 6c 65 31 22 7d 2c 20 7b

                   22 69 64 22 3a 20 22 66 30 33 66 64 61 38 66 38 61 33

                   32 34 39 62 32 61 37 30 66 62 31 66 31 37 36 61 37 62

All of the places susceptible to the modifications seem to be this kind of string, with the exception of the final padding;

$ diff -u /tmp/auth\_v3\_token\_scoped\_orig.pem /tmp/auth\_v3\_token\_scoped4364.pem

--- /tmp/auth\_v3\_token\_scoped\_orig.pem 2015-09-02 11:14:11.414915072 -0400

+++ /tmp/auth\_v3\_token\_scoped4364.pem 2015-09-02 11:14:28.749902282 -0400

@@ -66,4 +66,4 @@

 4RQzkShFx97ioGPE9wE1Jv9Yzxo5uTg6z246gi42e50uSIFZMmNMqkUdz0n6Qct+

 1zMf8W+e1pykKscVBz757F9n+qAhx15LxxdCKIrQ1kNT8dAyLRBQU0qZeLmLvS3W

 nmf/JlQ7LDQmq3XQEHRbQ1s5dz/mwM8IiSm8

------END CMS-----

+-----END CMS-----

\ No newline at end of file

Dolph; yeah, this is only for checking the revocation list; the tokens themselves need to be valid tokens. It is restricted to PKI based tokens only. The mistake was using the hash of the whole document for the token id; it should have been the same hash of the token tdata that is used for the cryptographic signature. The values being manipulated are the ASN1 specific values that indicate "This next block is signed data" which openssl really should be validating.
For example; here is a diff of a derdump of the origianl file and the modified file, with some lines of context;
$ diff -U 10 /tmp/auth\_v3\_token\_scoped\_orig.pem.txt /tmp/auth\_v3\_token\_scoped77.pem.txt
--- /tmp/auth\_v3\_token\_scoped\_orig.pem.txt 2015-09-02 11:27:46.423313737 -0400
+++ /tmp/auth\_v3\_token\_scoped77.pem.txt 2015-09-02 11:27:46.398313755 -0400
@@ -4,21 +4,21 @@
C-[0] (3176)
C-Sequence (3172)
Integer (1)
01
C-Set (9)
C-Sequence (7)
Object Identifier (5)
1 3 14 3 2 26 (SHA-1)
C-Sequence (2692)
Object Identifier (9)
- 1 2 840 113549 1 7 1 (PKCS #7 Data)
+ 0 26 840 113549 1 7 1
C-[0] (2677)
Octet String (2673)
7b 22 74 6f 6b 65 6e 22 3a 20 7b 22 6d 65 74 68 6f 64
73 22 3a 20 5b 22 70 61 73 73 77 6f 72 64 22 5d 2c 20
22 72 6f 6c 65 73 22 3a 20 5b 7b 22 69 64 22 3a 20 22
66 30 33 66 64 61 38 66 38 61 33 32 34 39 62 32 61 37
30 66 62 31 66 31 37 36 61 37 62 36 33 31 22 2c 20 22
6e 61 6d 65 22 3a 20 22 72 6f 6c 65 31 22 7d 2c 20 7b
22 69 64 22 3a 20 22 66 30 33 66 64 61 38 66 38 61 33
32 34 39 62 32 61 37 30 66 62 31 66 31 37 36 61 37 62
All of the places susceptible to the modifications seem to be this kind of string, with the exception of the final padding;
$ diff -u /tmp/auth\_v3\_token\_scoped\_orig.pem /tmp/auth\_v3\_token\_scoped4364.pem
--- /tmp/auth\_v3\_token\_scoped\_orig.pem 2015-09-02 11:14:11.414915072 -0400
+++ /tmp/auth\_v3\_token\_scoped4364.pem 2015-09-02 11:14:28.749902282 -0400
@@ -66,4 +66,4 @@
4RQzkShFx97ioGPE9wE1Jv9Yzxo5uTg6z246gi42e50uSIFZMmNMqkUdz0n6Qct+
1zMf8W+e1pykKscVBz757F9n+qAhx15LxxdCKIrQ1kNT8dAyLRBQU0qZeLmLvS3W
nmf/JlQ7LDQmq3XQEHRbQ1s5dz/mwM8IiSm8
------END CMS-----
+-----END CMS-----
\ No newline at end of file

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Morgan Fainberg (mdrnstm)](https://launchpad.net/~mdrnstm) wrote on 2015-09-02: |  |  | [#22](/keystone/%2Bbug/1490804/comments/22) |
| --- | --- | --- | --- |

@dolph,

Yes this would be limited to an auth\_token middleware issue. We should retarget the bug.

@dolph,
Yes this would be limited to an auth\_token middleware issue. We should retarget the bug.

| Changed in keystonemiddleware: | |
| --- | --- |
| **status**: | New → Confirmed |
| **status**: | Confirmed → New |
| **importance**: | Undecided → Critical |
| **importance**: | Critical → High |
| **assignee**: | nobody → Adam Young (ayoung) |
| Changed in keystone: | |
| **status**: | New → Invalid |
| **assignee**: | Adam Young (ayoung) → nobody |
| **status**: | Invalid → New |
| **assignee**: | nobody → Adam Young (ayoung) |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Morgan Fainberg (mdrnstm)](https://launchpad.net/~mdrnstm) wrote on 2015-09-02: |  |  | [#23](/keystone/%2Bbug/1490804/comments/23) |
| --- | --- | --- | --- |

Added keystonemiddleware as there are likely changes needed to KSM as well

Added keystonemiddleware as there are likely changes needed to KSM as well

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Dolph Mathews (dolph)](https://launchpad.net/~dolph) wrote on 2015-09-03: |  |  | [#24](/keystone/%2Bbug/1490804/comments/24) |
| --- | --- | --- | --- |

The fix could impact the contents of the token revocation list itself, though (in keystone).

The fix could impact the contents of the token revocation list itself, though (in keystone).

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Dolph Mathews (dolph)](https://launchpad.net/~dolph) wrote on 2015-09-03: |  |  | [#25](/keystone/%2Bbug/1490804/comments/25) |
| --- | --- | --- | --- |

(read comment #22 & #23 before I saw the new bug status - it seems you already agree!)

(read comment #22 & #23 before I saw the new bug status - it seems you already agree!)

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Adam Young (ayoung)](https://launchpad.net/~ayoung) wrote on 2015-09-03: |  |  | [#26](/keystone/%2Bbug/1490804/comments/26) |
| --- | --- | --- | --- |

* [0001-Reject-modified-PKI-Tokens.patch](https://bugs.launchpad.net/keystone/%2Bbug/1490804/%2Battachment/4456676/%2Bfiles/0001-Reject-modified-PKI-Tokens.patch)
  [Edit](/keystone/%2Bbug/1490804/%2Battachment/4456676)
  (6.1 KiB,
  text/plain)

The following patch detects modifications of the Token.

I am not certain, however, that this is exhaustive; there might be ways to modify the document such that it is still valid, but has a different hash.

We can lock down what is accepted as a token format: additional checks could confirm that the certs are stripped (adding them will still fail validation anyways) or any other cosmetic changes that could change the document.

We might be able to get away with a stop gap like this, and then migrate people to Fernet or change how PKI tokens are hashed.

The following patch detects modifications of the Token.
I am not certain, however, that this is exhaustive; there might be ways to modify the document such that it is still valid, but has a different hash.
We can lock down what is accepted as a token format: additional checks could confirm that the certs are stripped (adding them will still fail validation anyways) or any other cosmetic changes that could change the document.
We might be able to get away with a stop gap like this, and then migrate people to Fernet or change how PKI tokens are hashed.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Morgan Fainberg (mdrnstm)](https://launchpad.net/~mdrnstm) wrote on 2015-09-03: |  |  | [#27](/keystone/%2Bbug/1490804/comments/27) |
| --- | --- | --- | --- |

A few issues that came up in discussion earlier tonight:

\* What happens if someone respins a token from PKI to PKIZ or vice-versa?

\* PKI the delimiter (---- START CMS ---- and corresponding end ones) could be pre/post substituted in PKI (not PKIZ) and change the resulting ID but still pass due to the token\_to\_cms (or cms\_to\_token) code doing a blind substitution between '/' and '-'.

One of the other options could be to provide an options for KeystoneMiddleware to disable offline validations (default to off) and have it hash the tokens the same way django\_openstack\_auth would (which is not affected by this issue).

I'm looking over the code in the Reject-modified-PKI-Tokens.patch and it is a partial solution, but I have not spent enough time poking at the code to be sure what other gaps are there in PKI(Z) validation.

A few issues that came up in discussion earlier tonight:
\* What happens if someone respins a token from PKI to PKIZ or vice-versa?
\* PKI the delimiter (---- START CMS ---- and corresponding end ones) could be pre/post substituted in PKI (not PKIZ) and change the resulting ID but still pass due to the token\_to\_cms (or cms\_to\_token) code doing a blind substitution between '/' and '-'.
One of the other options could be to provide an options for KeystoneMiddleware to disable offline validations (default to off) and have it hash the tokens the same way django\_openstack\_auth would (which is not affected by this issue).
I'm looking over the code in the Reject-modified-PKI-Tokens.patch and it is a partial solution, but I have not spent enough time poking at the code to be sure what other gaps are there in PKI(Z) validation.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Adam Young (ayoung)](https://launchpad.net/~ayoung) wrote on 2015-09-03: |  |  | [#28](/keystone/%2Bbug/1490804/comments/28) |
| --- | --- | --- | --- |

* [0001-hash-the-data-in-the-token.patch](https://bugs.launchpad.net/keystone/%2Bbug/1490804/%2Battachment/4456711/%2Bfiles/0001-hash-the-data-in-the-token.patch)
  [Edit](/keystone/%2Bbug/1490804/%2Battachment/4456711)
  (2.7 KiB,
  text/plain)

This patch is probably the apparoach we need to take; it changes the logic of generating a token\_id from hashing the whole body of the token to hashing the data, same way that the signing algorithm does.

The patch will not yet pass unit tests.

Django OpenStack Auth needs to be modified to call this function in keystoneclient instead of doing their own hashing.

This patch is probably the apparoach we need to take; it changes the logic of generating a token\_id from hashing the whole body of the token to hashing the data, same way that the signing algorithm does.
The patch will not yet pass unit tests.
Django OpenStack Auth needs to be modified to call this function in keystoneclient instead of doing their own hashing.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Morgan Fainberg (mdrnstm)](https://launchpad.net/~mdrnstm) wrote on 2015-09-03: |  |  | [#29](/keystone/%2Bbug/1490804/comments/29) |
| --- | --- | --- | --- |

I am going to be -1 on changing DOA and changing how we hash immediately as this will break anyone who does not use the libraries (aka any language but python).

Lets aim for a fix that doesn't break absolutely everyone.

DOA is not impacted by this as it forces live validation.

Let's not change DOA and only change how middleware interacts in a non-live validated token workflow for Liberty (preferably something back-portable).

I am going to be -1 on changing DOA and changing how we hash immediately as this will break anyone who does not use the libraries (aka any language but python).
Lets aim for a fix that doesn't break absolutely everyone.
DOA is not impacted by this as it forces live validation.
Let's not change DOA and only change how middleware interacts in a non-live validated token workflow for Liberty (preferably something back-portable).

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Adam Young (ayoung)](https://launchpad.net/~ayoung) wrote on 2015-09-03: |  |  | [#30](/keystone/%2Bbug/1490804/comments/30) |
| --- | --- | --- | --- |

The DOA fix is trivial. It should go in anyway.

This is the lowest impact change. It won't break anyone unless they are doing the undocumented Hash hack. The number of people that are doing that should be vnishingly small, and they should update was well, too, for the same reason.

We can post code samples in Ruby and Java for how to do the hash.

The DOA fix is trivial. It should go in anyway.
This is the lowest impact change. It won't break anyone unless they are doing the undocumented Hash hack. The number of people that are doing that should be vnishingly small, and they should update was well, too, for the same reason.
We can post code samples in Ruby and Java for how to do the hash.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Adam Young (ayoung)](https://launchpad.net/~ayoung) wrote on 2015-09-03: |  |  | [#31](/keystone/%2Bbug/1490804/comments/31) |
| --- | --- | --- | --- |

* [0001-Use-the-Keystoneclient-code-to-hash-the-token.patch](https://bugs.launchpad.net/keystone/%2Bbug/1490804/%2Battachment/4456923/%2Bfiles/0001-Use-the-Keystoneclient-code-to-hash-the-token.patch)
  [Edit](/keystone/%2Bbug/1490804/%2Battachment/4456923)
  (1.7 KiB,
  text/plain)

This is the DOA change, and it can and should be applied regardless. I think it is safe to post as a review publicly.

This is the DOA change, and it can and should be applied regardless. I think it is safe to post as a review publicly.

| Changed in python-keystoneclient: | |
| --- | --- |
| **assignee**: | nobody → Adam Young (ayoung) |

[Adam Young (ayoung)](https://launchpad.net/~ayoung)
on 2015-09-04

| Changed in django-openstack-auth: | |
| --- | --- |
| **assignee**: | nobody → Adam Young (ayoung) |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Adam Young (ayoung)](https://launchpad.net/~ayoung) wrote on 2015-09-10: |  |  | [#32](/keystone/%2Bbug/1490804/comments/32) |
| --- | --- | --- | --- |

Is there any direction on this one? Online validation is going to break people doing distributed signing, which is the reason to use PKI tokens. Any fix here has the potential to fix someone. Changing the hash approach is, I suspect, going to have the least impact.

Is there any direction on this one? Online validation is going to break people doing distributed signing, which is the reason to use PKI tokens. Any fix here has the potential to fix someone. Changing the hash approach is, I suspect, going to have the least impact.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Adam Young (ayoung)](https://launchpad.net/~ayoung) wrote on 2015-09-10: |  |  | [#33](/keystone/%2Bbug/1490804/comments/33) |
| --- | --- | --- | --- |

Note that always going to online validation would preclude the use of memcache for tokens.

Note that always going to online validation would preclude the use of memcache for tokens.

[Morgan Fainberg (mdrnstm)](https://launchpad.net/~mdrnstm)
on 2015-09-10

| Changed in django-openstack-auth: | |
| --- | --- |
| **status**: | New → Invalid |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Morgan Fainberg (mdrnstm)](https://launchpad.net/~mdrnstm) wrote on 2015-09-10: |  |  | [#34](/keystone/%2Bbug/1490804/comments/34) |
| --- | --- | --- | --- |

I repeat the previous statement: Changing the hash mechanism will break everyone. DOA is absolutely not affected here.

DOA forces online validation because it hashes the PKI(z) tokens to the SHA form. If a token is already hashed, it will only rely on the online validation which requires matching the key in the database.

The solution for the time being is going to be addressing how middleware validates the token offline via SSL. Options I see are:

\* Done via audit\_ids with new forms of middleware if we make audit\_ids available as a form of the TRL.

\* Option to only online-validate PKI(Z) tokens.

\* Offer a different hash-form TRL (not just audit-id) for new versions of middleware

\* Deprecate PKI(Z) tokens [not a good idea]

\* Issue OSSA and indicate this is not something we can/will fix with the PKI tokens (and deprecate) [not a great idea]

I would prefer to see an online-only validation option with an OSSA as the immediate (and potentially backportable) fix. Discussion on changing hashes etc can be delayed until the summit and done in the open - not under embargo. For the embargo'd bug, I really want to see this not be a breaking change.

Breaking memcache for validated tokens [optionally] where the deployer is aware of the issues (due to OSSA being issued) is fine.

I repeat the previous statement: Changing the hash mechanism will break everyone. DOA is absolutely not affected here.
DOA forces online validation because it hashes the PKI(z) tokens to the SHA form. If a token is already hashed, it will only rely on the online validation which requires matching the key in the database.
The solution for the time being is going to be addressing how middleware validates the token offline via SSL. Options I see are:
\* Done via audit\_ids with new forms of middleware if we make audit\_ids available as a form of the TRL.
\* Option to only online-validate PKI(Z) tokens.
\* Offer a different hash-form TRL (not just audit-id) for new versions of middleware
\* Deprecate PKI(Z) tokens [not a good idea]
\* Issue OSSA and indicate this is not something we can/will fix with the PKI tokens (and deprecate) [not a great idea]
I would prefer to see an online-only validation option with an OSSA as the immediate (and potentially backportable) fix. Discussion on changing hashes etc can be delayed until the summit and done in the open - not under embargo. For the embargo'd bug, I really want to see this not be a breaking change.
Breaking memcache for validated tokens [optionally] where the deployer is aware of the issues (due to OSSA being issued) is fine.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Robert Clark (robert-clark)](https://launchpad.net/~robert-clark) wrote on 2015-09-10: |  |  | [#35](/keystone/%2Bbug/1490804/comments/35) |
| --- | --- | --- | --- |

Ouch, I'd love to do a security blogpost on this once it's announced, a full root cause analysis.

I'm not close-enough to Keystone to understand the full impact of all the the mitigation options however it's clear that this is a pretty severe issue.

I know the numbers are hard to quantify but "thumb in the air" - what percentage of deployments use PKI tokens?

-Rob

Ouch, I'd love to do a security blogpost on this once it's announced, a full root cause analysis.
I'm not close-enough to Keystone to understand the full impact of all the the mitigation options however it's clear that this is a pretty severe issue.
I know the numbers are hard to quantify but "thumb in the air" - what percentage of deployments use PKI tokens?
-Rob

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Morgan Fainberg (mdrnstm)](https://launchpad.net/~mdrnstm) wrote on 2015-09-10: |  |  | [#36](/keystone/%2Bbug/1490804/comments/36) |
| --- | --- | --- | --- |

@Robert,

It's enough to be a serious consideration (in the <50% but more than 15% is my guess; but this is just hazarding a guess). However we are now seeing a move towards Fernet tokens from the orgs that have been using PKI.

Some of the largest deployments are PKI token based.

@Robert,
It's enough to be a serious consideration (in the <50% but more than 15% is my guess; but this is just hazarding a guess). However we are now seeing a move towards Fernet tokens from the orgs that have been using PKI.
Some of the largest deployments are PKI token based.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Travis McPeak (travis-mcpeak)](https://launchpad.net/~travis-mcpeak) wrote on 2015-09-11: |  |  | [#37](/keystone/%2Bbug/1490804/comments/37) |
| --- | --- | --- | --- |

This also seems like a prime target for a security note (OSSN). Basically we'll say something along the lines of "PKI(Z) tokens without online validation shouldn't be considered safe for certain versions" (if I understand this correctly).

This will enable cloud deployers to better understand the documented risks they are accepting.

This also seems like a prime target for a security note (OSSN). Basically we'll say something along the lines of "PKI(Z) tokens without online validation shouldn't be considered safe for certain versions" (if I understand this correctly).
This will enable cloud deployers to better understand the documented risks they are accepting.

[Adam Young (ayoung)](https://launchpad.net/~ayoung)
on 2015-09-11

| Changed in keystone: | |
| --- | --- |
| **status**: | New → Confirmed |
| **status**: | Confirmed → Triaged |
| Changed in keystonemiddleware: | |
| **status**: | New → Triaged |
| Changed in python-keystoneclient: | |
| **status**: | New → Triaged |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Adam Young (ayoung)](https://launchpad.net/~ayoung) wrote on 2015-09-11: |  |  | [#38](/keystone/%2Bbug/1490804/comments/38) |
| --- | --- | --- | --- |

Root cause is the assumption that any tampering with the PKI token would invalidate the token. There are three major fields in the token that are resistant:

1. The message. Any change to the message will be detected due to it not matching the signature.

2. The signature. Any change to the signature and the message will no longer match its signature.

3. The singning info. This checked against the X509 signing cert byte-by-byte. Any change and it won't match.

What I found in testing is that there are other fields that X509 ignores but should not. These include 0 length fields that are place holders for things like the stripped out Certificates.

The other attack now possible is due to there being 2 different PKI token versions. A PKI token could be converted to a PKIZ token, and the signature is still valid. That was not the case when the hashing approach was chosen.

The most common reason for token revocations is logout from the WebUI.

The impact is probably small but consequential; it only affects revoked tokens in the CLI cases. In the webUI case, the tokens are never stored in full except inside the token database. Instead, the WebUI hashes them, and discards the CMS document. Since this is the primary cause of revocations, these tokens are not at risk.

The second most common is password changes. Since these are performed by the end users themselves, the risk here is slight, but not 0.

The most worry some are token revocations for users leaving a project or being disabled altogether. In order for this attack to be viable, the user must have had a valid token prior to the event, and then they could re-enable the token. Since token timeout is a variable, we can;t make any assumptions. We turned the default down to 1 hour, but many sites found this was too short for workflows, and set the value back to 12 hours.

Root cause is the assumption that any tampering with the PKI token would invalidate the token. There are three major fields in the token that are resistant:
1. The message. Any change to the message will be detected due to it not matching the signature.
2. The signature. Any change to the signature and the message will no longer match its signature.
3. The singning info. This checked against the X509 signing cert byte-by-byte. Any change and it won't match.
What I found in testing is that there are other fields that X509 ignores but should not. These include 0 length fields that are place holders for things like the stripped out Certificates.
The other attack now possible is due to there being 2 different PKI token versions. A PKI token could be converted to a PKIZ token, and the signature is still valid. That was not the case when the hashing approach was chosen.
The most common reason for token revocations is logout from the WebUI.
The impact is probably small but consequential; it only affects revoked tokens in the CLI cases. In the webUI case, the tokens are never stored in full except inside the token database. Instead, the WebUI hashes them, and discards the CMS document. Since this is the primary cause of revocations, these tokens are not at risk.
The second most common is password changes. Since these are performed by the end users themselves, the risk here is slight, but not 0.
The most worry some are token revocations for users leaving a project or being disabled altogether. In order for this attack to be viable, the user must have had a valid token prior to the event, and then they could re-enable the token. Since token timeout is a variable, we can;t make any assumptions. We turned the default down to 1 hour, but many sites found this was too short for workflows, and set the value back to 12 hours.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Liusheng (liusheng)](https://launchpad.net/~liusheng) wrote on 2015-09-21: |  |  | [#39](/keystone/%2Bbug/1490804/comments/39) |
| --- | --- | --- | --- |

* [bug1490804-patch-test-traceback.txt](https://bugs.launchpad.net/keystone/%2Bbug/1490804/%2Battachment/4469888/%2Bfiles/bug1490804-patch-test-traceback.txt)
  [Edit](/keystone/%2Bbug/1490804/%2Battachment/4469888)
  (7.6 KiB,
  text/plain)

Hi Adam Young,

My colleague has applied your patch with Juno version keystone, the original problem is successfully solved, however some random errors occur when issuing both v2 and v3 token, the tracebacks are as below.

Seems the errors are introduced by the patch, and we didn't found the root cause. traceback info please see the attachment could you please take a look ?

Keystone is running on apache with worker mode.

Version of pyasn1 packages are:

python-pyasn1-modules-0.0.7-33.2

python-pyasn1-0.1.2-0.5.1

OS is Suse SLE11 SP3

Hi Adam Young,
My colleague has applied your patch with Juno version keystone, the original problem is successfully solved, however some random errors occur when issuing both v2 and v3 token, the tracebacks are as below.
Seems the errors are introduced by the patch, and we didn't found the root cause. traceback info please see the attachment could you please take a look ?
Keystone is running on apache with worker mode.
Version of pyasn1 packages are:
python-pyasn1-modules-0.0.7-33.2
python-pyasn1-0.1.2-0.5.1
OS is Suse SLE11 SP3

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2015-09-21: |  |  | [#40](/keystone/%2Bbug/1490804/comments/40) |
| --- | --- | --- | --- |

Since this seems related to a bad design in PKI(z) token for which the fix isn't easily backportable, I suggest a B type of bug.

Also, since this requires a fair amount of social engineering to abuse this bug, is there a good reason to keep this under embargo ?

Since this seems related to a bad design in PKI(z) token for which the fix isn't easily backportable, I suggest a B type of bug.
Also, since this requires a fair amount of social engineering to abuse this bug, is there a good reason to keep this under embargo ?

[Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray)
on 2015-11-02

| Changed in ossn: | |
| --- | --- |
| **importance**: | Undecided → Critical |

[Nathan Kinder (nkinder)](https://launchpad.net/~nkinder)
on 2015-11-12

| Changed in ossn: | |
| --- | --- |
| **assignee**: | nobody → Nathan Kinder (nkinder) |

[Adam Young (ayoung)](https://launchpad.net/~ayoung)
on 2015-11-19

| Changed in keystone: | |
| --- | --- |
| **status**: | Triaged → Won't Fix |
| Changed in keystonemiddleware: | |
| **status**: | Triaged → Won't Fix |
| Changed in python-keystoneclient: | |
| **status**: | Triaged → Won't Fix |

| 22 comments hidden Loading more comments | [view all 102 comments](?comments=all) |
| --- | --- |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2015-12-02: |  |  | [#63](/keystone/%2Bbug/1490804/comments/63) |
| --- | --- | --- | --- |

Considering this bug exploitation requires administrator action (e.g., to issue token revocation), I would prefer this bug report to be public. Operator could use this information to enforce a more strict revocation process while the fix is being implemented.

What is the status of the OSSN ?

How about we open the bug at the same time we issue the security note, then we could review the proposed patch on gerrit and we'll eventually issue an OSSA if the solution is safely backportable ?

Considering this bug exploitation requires administrator action (e.g., to issue token revocation), I would prefer this bug report to be public. Operator could use this information to enforce a more strict revocation process while the fix is being implemented.
What is the status of the OSSN ?
How about we open the bug at the same time we issue the security note, then we could review the proposed patch on gerrit and we'll eventually issue an OSSA if the solution is safely backportable ?

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Brant Knudson (blk-u)](https://launchpad.net/~blk-u) wrote on 2015-12-02: |  |  | [#64](/keystone/%2Bbug/1490804/comments/64) |
| --- | --- | --- | --- |

The exploit doesn't require admin action. Tokens can be revoked by the user, or they can be revoked by the user changing their password. Tokens can also be made invalid by admins taking away the user's roles.

The exploit doesn't require admin action. Tokens can be revoked by the user, or they can be revoked by the user changing their password. Tokens can also be made invalid by admins taking away the user's roles.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2015-12-02: |  |  | [#65](/keystone/%2Bbug/1490804/comments/65) |
| --- | --- | --- | --- |

Brant, the only scenario I considered is when a malicious user is able to keep access after an operator revoked his token or took away his roles. iiuc the exploit you described requires valid token, what can the user do with tokens he invalidated himself ?

Brant, the only scenario I considered is when a malicious user is able to keep access after an operator revoked his token or took away his roles. iiuc the exploit you described requires valid token, what can the user do with tokens he invalidated himself ?

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Brant Knudson (blk-u)](https://launchpad.net/~blk-u) wrote on 2015-12-02: |  |  | [#66](/keystone/%2Bbug/1490804/comments/66) |
| --- | --- | --- | --- |

Tristan - The only thing I can think of is the user revokes their own tokens because they're concerned that it's been exposed. So they think they're stopping the 3rd party from using their token but the 3rd party can still use the token by modifying it slightly (until the token expires).

Yes, the typical concern would be an admin thinks the user's old tokens are revoked but they're still usable until they expire.

Tristan - The only thing I can think of is the user revokes their own tokens because they're concerned that it's been exposed. So they think they're stopping the 3rd party from using their token but the 3rd party can still use the token by modifying it slightly (until the token expires).
Yes, the typical concern would be an admin thinks the user's old tokens are revoked but they're still usable until they expire.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Nathan Kinder (nkinder)](https://launchpad.net/~nkinder) wrote on 2015-12-02: |  |  | [#67](/keystone/%2Bbug/1490804/comments/67) |
| --- | --- | --- | --- |

Tristan - I have the OSSN draft written up, which has been reviewed by a few people from the Security team as well as by Adam Young. If we are also going to provide a fix, I will need to reword a few things in the "recommendations" section. Here is the current draft of the OSSN:

-----

Potential reuse of revoked Identity tokens

---

### Summary ###

An authorization token issued by the Identity service can be revoked,

which is designed to immediately make that token invalid for future use.

When the PKI or PKIZ token formats are used, it is possible for an

attacker to manipulate the token contents of a revoked token such that

the token will still be considered to be valid. This can allow

unauthorized access to cloud resources if a revoked token is intercepted

by an attacker.

### Affected Services / Software ###

Keystone, Icehouse, Juno, Kilo, Liberty

### Discussion ###

Token revocation is used in OpenStack to invalidate a token for further

use. This token revocation takes place automatically in certain

situations, such as when a user logs out of the Dashboard. If a revoked

token is obtained by another party, it should no longer be possible to

use it to perform any actions within the cloud. Unfortuantely, this is

not the case when the PKI or PKIZ token format is used.

When a PKI or PKIZ token is validated, the Identity service checks it

by searching for a revocation by the entire token. It is possible for

an attacker to manipulate portions of an intercepted PKI or PKIZ token

that are not cryptographically protected, which will cause the

revocation check to improperly consider the token to be valid.

### Recommended Actions ###

We recommend that you do not use the PKI or PKIZ token formats. Due to

the way that these formats were designed, it is not possible to fix this

issue in a way that is backwards compatible. The PKI and PKIZ token

formats do not offer any significant benefit over other token formats

such as the UUID or Fernet formats.

If you are using the PKI or PKIZ token format, it is recommended that

you switch to using another supported token format such as the UUID

format. There are no plans to fix this issue in the PKI and PKIZ token

providers in the Identity service.

To check what token provider you are using, you must look in the

'keystone.conf' file for your Identity service. An example is provided

below:

---- begin keystone.conf sample snippet ----

[token]

#provider = keystone.token.providers.pki.Provider

#provider = keystone.token.providers.pkiz.Provider

provider = keystone.token.providers.uuid.Provider

---- end keystone.conf sample snippet ----

This configuration snippet is using the UUID token format. If you are

using either of the commented out settings from this example, your cloud

is vulnerable to this issue and you should switch to a different token

provider.

### Contacts / References ###

This OSSN : <https://wiki.openstack.org/wiki/OSSN/OSSN-0061>

Original LaunchPad Bug : [https://bugs.launchpad.net/keystone/+bug/1490804](https://bugs.launchpad.net/keystone/%2Bbug/1490804)

OpenStack Security ML : <email address hidden>

OpenStack Security Group : <https://launchpad.net/~openstack-ossg>

Tristan - I have the OSSN draft written up, which has been reviewed by a few people from the Security team as well as by Adam Young. If we are also going to provide a fix, I will need to reword a few things in the "recommendations" section. Here is the current draft of the OSSN:
-----
Potential reuse of revoked Identity tokens
---
### Summary ###
An authorization token issued by the Identity service can be revoked,
which is designed to immediately make that token invalid for future use.
When the PKI or PKIZ token formats are used, it is possible for an
attacker to manipulate the token contents of a revoked token such that
the token will still be considered to be valid. This can allow
unauthorized access to cloud resources if a revoked token is intercepted
by an attacker.
### Affected Services / Software ###
Keystone, Icehouse, Juno, Kilo, Liberty
### Discussion ###
Token revocation is used in OpenStack to invalidate a token for further
use. This token revocation takes place automatically in certain
situations, such as when a user logs out of the Dashboard. If a revoked
token is obtained by another party, it should no longer be possible to
use it to perform any actions within the cloud. Unfortuantely, this is
not the case when the PKI or PKIZ token format is used.
When a PKI or PKIZ token is validated, the Identity service checks it
by searching for a revocation by the entire token. It is possible for
an attacker to manipulate portions of an intercepted PKI or PKIZ token
that are not cryptographically protected, which will cause the
revocation check to improperly consider the token to be valid.
### Recommended Actions ###
We recommend that you do not use the PKI or PKIZ token formats. Due to
the way that these formats were designed, it is not possible to fix this
issue in a way that is backwards compatible. The PKI and PKIZ token
formats do not offer any significant benefit over other token formats
such as the UUID or Fernet formats.
If you are using the PKI or PKIZ token format, it is recommended that
you switch to using another supported token format such as the UUID
format. There are no plans to fix this issue in the PKI and PKIZ token
providers in the Identity service.
To check what token provider you are using, you must look in the
'keystone.conf' file for your Identity service. An example is provided
below:
---- begin keystone.conf sample snippet ----
[token]
#provider = keystone.token.providers.pki.Provider
#provider = keystone.token.providers.pkiz.Provider
provider = keystone.token.providers.uuid.Provider
---- end keystone.conf sample snippet ----
This configuration snippet is using the UUID token format. If you are
using either of the commented out settings from this example, your cloud
is vulnerable to this issue and you should switch to a different token
provider.
### Contacts / References ###
This OSSN : https://wiki.openstack.org/wiki/OSSN/OSSN-0061
Original LaunchPad Bug : https://bugs.launchpad.net/keystone/+bug/1490804
OpenStack Security ML : openstack-security@lists.openstack.org
OpenStack Security Group : https://launchpad.net/~openstack-ossg

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2015-12-02: |  |  | [#68](/keystone/%2Bbug/1490804/comments/68) |
| --- | --- | --- | --- |

Thanks, so we could remove the first chapter of "Recommended Actions" and send this OSSN as an advance notification. We'll then open the bug and review Brant's patch on gerrit. Thought ?

Thanks, so we could remove the first chapter of "Recommended Actions" and send this OSSN as an advance notification. We'll then open the bug and review Brant's patch on gerrit. Thought ?

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Jeremy Stanley (fungi)](https://launchpad.net/~fungi) wrote on 2015-12-03: |  |  | [#69](/keystone/%2Bbug/1490804/comments/69) |
| --- | --- | --- | --- |

It seems reasonable to go forward with the OSSN worded to assume there is no fix forthcoming. Then once there's an actual fix merged to stable branches we can follow up with an OSSA (though worth keeping in mind the proposed backport, as far as I understand, only solves the problem for tokens revoked after the patch gets applied, not any which predate its application).

It seems reasonable to go forward with the OSSN worded to assume there is no fix forthcoming. Then once there's an actual fix merged to stable branches we can follow up with an OSSA (though worth keeping in mind the proposed backport, as far as I understand, only solves the problem for tokens revoked after the patch gets applied, not any which predate its application).

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Nathan Kinder (nkinder)](https://launchpad.net/~nkinder) wrote on 2015-12-03: |  |  | [#70](/keystone/%2Bbug/1490804/comments/70) |
| --- | --- | --- | --- |

Jeremy - Agreed. Are we ready to make this issue public then? Is everyone OK with the OSSN draft I provided in my previous comment?

As soon as we make it public, I can propose the OSSN review and fast-track it's merge and get it published.

Jeremy - Agreed. Are we ready to make this issue public then? Is everyone OK with the OSSN draft I provided in my previous comment?
As soon as we make it public, I can propose the OSSN review and fast-track it's merge and get it published.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Brant Knudson (blk-u)](https://launchpad.net/~blk-u) wrote on 2015-12-03: |  |  | [#71](/keystone/%2Bbug/1490804/comments/71) |
| --- | --- | --- | --- |

Jeremy - Once the change is applied to keystone then the revocation list will include the audit IDs. The audit IDs are already in the token table so that will be available. As such, the fix will work for old tokens.

Comments on the proposed OSSN

1) change "token formats" to "token providers"

2) In the sample config, since keystone has support for using entrypoints for the provider, the examples should also have:

#provider = pki

 #provider = pkiz

This was introduced in liberty so earlier releases need to use keystone.token.providers.uuid.Provider whereas liberty and later should use uuid or fernet

Jeremy - Once the change is applied to keystone then the revocation list will include the audit IDs. The audit IDs are already in the token table so that will be available. As such, the fix will work for old tokens.
Comments on the proposed OSSN
1) change "token formats" to "token providers"
2) In the sample config, since keystone has support for using entrypoints for the provider, the examples should also have:
#provider = pki
#provider = pkiz
This was introduced in liberty so earlier releases need to use keystone.token.providers.uuid.Provider whereas liberty and later should use uuid or fernet

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Jeremy Stanley (fungi)](https://launchpad.net/~fungi) wrote on 2015-12-03: |  |  | [#72](/keystone/%2Bbug/1490804/comments/72) |
| --- | --- | --- | --- |

Brant: Excellent! That's better than I had hoped (was assuming only the full document hash was being stored for earlier tokens). So this really would, in theory, be a complete fix for stable branch consumers. With that in mind, I agree it makes sense to slightly lighten the bit of the OSSN about no possibility of a backward compatible fix. Still shouldn't imply that there is definitely one coming in case something unforeseen happens in review, but getting awareness of the bug and mitigation recommendations out to deployers/operators in the near term is still a good idea.

Brant: Excellent! That's better than I had hoped (was assuming only the full document hash was being stored for earlier tokens). So this really would, in theory, be a complete fix for stable branch consumers. With that in mind, I agree it makes sense to slightly lighten the bit of the OSSN about no possibility of a backward compatible fix. Still shouldn't imply that there is definitely one coming in case something unforeseen happens in review, but getting awareness of the bug and mitigation recommendations out to deployers/operators in the near term is still a good idea.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Nathan Kinder (nkinder)](https://launchpad.net/~nkinder) wrote on 2015-12-09: |  |  | [#73](/keystone/%2Bbug/1490804/comments/73) |
| --- | --- | --- | --- |

[Download full text](https://bugs.launchpad.net/keystone/%2Bbug/1490804/comments/73/%2Bdownload) (3.3 KiB)

Here is a new draft of the OSSN that contains the suggestions made by Brant as well the suggestion made by Jeremy with regards to there being a possibility of a future fix. If this looks good to everyone, I think we can move forward with publishing and opening this bug up.

----------

Potential reuse of revoked Identity tokens

---

### Summary ###

An authorization token issued by the Identity service can be revoked,

which is designed to immediately make that token invalid for future use.

When the PKI or PKIZ token providers are used, it is possible for an

attacker to manipulate the token contents of a revoked token such that

the token will still be considered to be valid. This can allow

unauthorized access to cloud resources if a revoked token is intercepted

by an attacker.

### Affected Services / Software ###

Keystone, Icehouse, Juno, Kilo, Liberty

### Discussion ###

Token revocation is used in OpenStack to invalidate a token for further

use. This token revocation takes place automatically in certain

situations, such as when a user logs out of the Dashboard. If a revoked

token is obtained by another party, it should no longer be possible to

use it to perform any actions within the cloud. Unfortunately, this is

not the case when the PKI or PKIZ token providers are used.

When a PKI or PKIZ token is validated, the Identity service checks it

by searching for a revocation by the entire token. It is possible for

an attacker to manipulate portions of an intercepted PKI or PKIZ token

that are not cryptographically protected, which will cause the

revocation check to improperly consider the token to be valid.

### Recommended Actions ###

We recommend that you do not use the PKI or PKIZ token providers. The

PKI and PKIZ token providers do not offer any significant benefit over

other token providers such as the UUID or Fernet.

If you are using the PKI or PKIZ token providers, it is recommended that

you switch to using another supported token provider such as the UUID

provider. This issue might be fixed in a future update of the PKI and

PKIZ token providers in the Identity service.

To check what token provider you are using, you must look in the

'keystone.conf' file for your Identity service. An example is provided

below:

---- begin keystone.conf sample snippet ----

[token]

#provider = keystone.token.providers.pki.Provider

#provider = keystone.token.providers.pkiz.Provider

provider = keystone.token.providers.uuid.Provider

---- end keystone.conf sample snippet ----

In the Liberty release of the Identity service, the token provider

configuration is different than previous OpenStack releases. An

example from the Libery release is provided below:

---- begin keystone.conf sample snippet ----

[token]

#provider = pki

#provider = pkiz

provider = uuid

---- end keystone.conf sample snippet ----

These configuration snippets are using the UUID token provider. If you

are using any of the commented out settings from these examples, your

cloud is vulnerable to this issue and you should switch to a different

token provider.

### Contacts / References ###

This OSSN : <https://wiki.openstack.org/wiki/OSSN/OSSN-0061>

Original LaunchPad Bug : <https://bugs>...

[Read more...](/keystone/%2Bbug/1490804/comments/73)

Here is a new draft of the OSSN that contains the suggestions made by Brant as well the suggestion made by Jeremy with regards to there being a possibility of a future fix. If this looks good to everyone, I think we can move forward with publishing and opening this bug up.
----------
Potential reuse of revoked Identity tokens
---
### Summary ###
An authorization token issued by the Identity service can be revoked,
which is designed to immediately make that token invalid for future use.
When the PKI or PKIZ token providers are used, it is possible for an
attacker to manipulate the token contents of a revoked token such that
the token will still be considered to be valid. This can allow
unauthorized access to cloud resources if a revoked token is intercepted
by an attacker.
### Affected Services / Software ###
Keystone, Icehouse, Juno, Kilo, Liberty
### Discussion ###
Token revocation is used in OpenStack to invalidate a token for further
use. This token revocation takes place automatically in certain
situations, such as when a user logs out of the Dashboard. If a revoked
token is obtained by another party, it should no longer be possible to
use it to perform any actions within the cloud. Unfortunately, this is
not the case when the PKI or PKIZ token providers are used.
When a PKI or PKIZ token is validated, the Identity service checks it
by searching for a revocation by the entire token. It is possible for
an attacker to manipulate portions of an intercepted PKI or PKIZ token
that are not cryptographically protected, which will cause the
revocation check to improperly consider the token to be valid.
### Recommended Actions ###
We recommend that you do not use the PKI or PKIZ token providers. The
PKI and PKIZ token providers do not offer any significant benefit over
other token providers such as the UUID or Fernet.
If you are using the PKI or PKIZ token providers, it is recommended that
you switch to using another supported token provider such as the UUID
provider. This issue might be fixed in a future update of the PKI and
PKIZ token providers in the Identity service.
To check what token provider you are using, you must look in the
'keystone.conf' file for your Identity service. An example is provided
below:
---- begin keystone.conf sample snippet ----
[token]
#provider = keystone.token.providers.pki.Provider
#provider = keystone.token.providers.pkiz.Provider
provider = keystone.token.providers.uuid.Provider
---- end keystone.conf sample snippet ----
In the Liberty release of the Identity service, the token provider
configuration is different than previous OpenStack releases. An
example from the Libery release is provided below:
---- begin keystone.conf sample snippet ----
[token]
#provider = pki
#provider = pkiz
provider = uuid
---- end keystone.conf sample snippet ----
These configuration snippets are using the UUID token provider. If you
are using any of the commented out settings from these examples, your
cloud is vulnerable to this issue and you should switch to a different
token provider.
### Contacts / References ###
This OSSN : https://wiki.openstack.org/wiki/OSSN/OSSN-0061
Original LaunchPad Bug : https://bugs.launchpad.net/keystone/+bug/1490804
OpenStack Security ML : openstack-security@lists.openstack.org
OpenStack Security Group : https://launchpad.net/~openstack-ossg

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Steve Martinelli (stevemar)](https://launchpad.net/~stevemar) wrote on 2015-12-09: |  |  | [#74](/keystone/%2Bbug/1490804/comments/74) |
| --- | --- | --- | --- |

@Nate, not sure if you also want to mention that the PKI and PKIz token providers are not deprecated in Mitaka.

@Nate, not sure if you also want to mention that the PKI and PKIz token providers are not deprecated in Mitaka.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2015-12-09: |  |  | [#75](/keystone/%2Bbug/1490804/comments/75) |
| --- | --- | --- | --- |

Once the OSSN is approved, I'd like to send it as an advance notification to stakeholders before opening this bug.

Assuming it is done by tomorrow, this could be disclosed next Tuesday:

2015-12-15, 1500UTC

Once the OSSN is approved, I'd like to send it as an advance notification to stakeholders before opening this bug.
Assuming it is done by tomorrow, this could be disclosed next Tuesday:
2015-12-15, 1500UTC

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Brant Knudson (blk-u)](https://launchpad.net/~blk-u) wrote on 2015-12-09: |  |  | [#76](/keystone/%2Bbug/1490804/comments/76) |
| --- | --- | --- | --- |

the OSSN in comment 73 looks good to me.

the OSSN in comment 73 looks good to me.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2015-12-10: |  |  | [#77](/keystone/%2Bbug/1490804/comments/77) |
| --- | --- | --- | --- |

The OSSN has been sent, let's open this bug next Tuesday (2015-12-15, 1500UTC).

The OSSN has been sent, let's open this bug next Tuesday (2015-12-15, 1500UTC).

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2015-12-10:  [**Re: PKI Token Revocation Bypass (CVE-2015-7546)**](/keystone/%2Bbug/1490804/comments/78) |  |  | [#78](/keystone/%2Bbug/1490804/comments/78) |
| --- | --- | --- | --- |

Red Hat preemptively assigned CVE-2015-7546 for this vulnerability.

Red Hat preemptively assigned CVE-2015-7546 for this vulnerability.

| **summary**: | - PKI Token Revocation Bypass+ PKI Token Revocation Bypass (CVE-2015-7546) |
| --- | --- |

[Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray)
on 2015-12-15

| **information type**: | Private Security → Public Security |
| --- | --- |
| **description**: | updated |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2015-12-15: |  |  | [#79](/keystone/%2Bbug/1490804/comments/79) |
| --- | --- | --- | --- |

This bug is now public, OSSN and Keystone patches can be submitted to gerrit.

This bug is now public, OSSN and Keystone patches can be submitted to gerrit.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Nathan Kinder (nkinder)](https://launchpad.net/~nkinder) wrote on 2015-12-15: |  |  | [#80](/keystone/%2Bbug/1490804/comments/80) |
| --- | --- | --- | --- |

The OSSN review has been submitted:

<https://review.openstack.org/#/c/258119/>

The OSSN review has been submitted:
https://review.openstack.org/#/c/258119/

[OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack)
on 2015-12-15

| Changed in keystone: | |
| --- | --- |
| **assignee**: | Adam Young (ayoung) → Brant Knudson (blk-u) |
| **status**: | Won't Fix → In Progress |
| Changed in keystonemiddleware: | |
| **assignee**: | Adam Young (ayoung) → Brant Knudson (blk-u) |
| **status**: | Won't Fix → In Progress |

[Steve Martinelli (stevemar)](https://launchpad.net/~stevemar)
on 2015-12-15

| Changed in keystone: | |
| --- | --- |
| **milestone**: | none → mitaka-2 |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Nathan Kinder (nkinder)](https://launchpad.net/~nkinder) wrote on 2015-12-16: |  |  | [#81](/keystone/%2Bbug/1490804/comments/81) |
| --- | --- | --- | --- |

This issue has been published as OSSN-0062:

<https://wiki.openstack.org/wiki/OSSN/OSSN-0062>

This issue has been published as OSSN-0062:
https://wiki.openstack.org/wiki/OSSN/OSSN-0062

| Changed in ossn: | |
| --- | --- |
| **status**: | New → Fix Released |

[Brant Knudson (blk-u)](https://launchpad.net/~blk-u)
on 2015-12-17

| **tags**: | added: kilo-backport-potential liberty-backport-potential |
| --- | --- |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2015-12-21: |  |  | [#82](/keystone/%2Bbug/1490804/comments/82) |
| --- | --- | --- | --- |

The fix for keystone[master] is <https://review.openstack.org/#/c/258141> . Can this be proposed to stable liberty and kilo too ?

The fix for keystone[master] is https://review.openstack.org/#/c/258141 . Can this be proposed to stable liberty and kilo too ?

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Brant Knudson (blk-u)](https://launchpad.net/~blk-u) wrote on 2015-12-21: |  |  | [#83](/keystone/%2Bbug/1490804/comments/83) |
| --- | --- | --- | --- |

Tristan - It can be proposed, although some might consider the change to be a new feature rather than a bug fix, so not sure if it's appropriate for stable. I'd prefer for the change to be merged in master before I backport it otherwise I'll have make changes in multiple releases if there's a -1.

Tristan - It can be proposed, although some might consider the change to be a new feature rather than a bug fix, so not sure if it's appropriate for stable. I'd prefer for the change to be merged in master before I backport it otherwise I'll have make changes in multiple releases if there's a -1.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Steve Martinelli (stevemar)](https://launchpad.net/~stevemar) wrote on 2015-12-22: |  |  | [#84](/keystone/%2Bbug/1490804/comments/84) |
| --- | --- | --- | --- |

Brant & Tristan, I think it should be fine to backport to kilo and liberty. It's an important security related fix and I consider the proposed changes to be a bug and not a feature.

Brant & Tristan, I think it should be fine to backport to kilo and liberty. It's an important security related fix and I consider the proposed changes to be a bug and not a feature.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2016-01-05: |  |  | [#85](/keystone/%2Bbug/1490804/comments/85) |
| --- | --- | --- | --- |

Thanks, then considering this is going to be fixed in stable release, I've confirmed the OSSA task.

Thanks, then considering this is going to be fixed in stable release, I've confirmed the OSSA task.

| Changed in ossa: | |
| --- | --- |
| **status**: | Incomplete → Confirmed |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2016-01-09:  [**Fix merged to keystone (master)**](/keystone/%2Bbug/1490804/comments/86) |  |  | [#86](/keystone/%2Bbug/1490804/comments/86) |
| --- | --- | --- | --- |

Reviewed: <https://review.openstack.org/258141>

Committed: <https://git.openstack.org/cgit/openstack/keystone/commit/?id=d5378f173da14a34ca010271477337879002d6d0>

Submitter: Jenkins

Branch: master

commit d5378f173da14a34ca010271477337879002d6d0

Author: Brant Knudson <email address hidden>

Date: Tue Dec 1 11:09:14 2015 -0600

Add audit IDs to revocation events

The revoked tokens' audit ID is now included in the data returned in

    the revocation list.

Closes-Bug: 1490804

    Change-Id: Ifcf88f1158bebddc4f927121fbf4136fb53b659f

Reviewed: https://review.openstack.org/258141
Committed: https://git.openstack.org/cgit/openstack/keystone/commit/?id=d5378f173da14a34ca010271477337879002d6d0
Submitter: Jenkins
Branch: master
commit d5378f173da14a34ca010271477337879002d6d0
Author: Brant Knudson <bknudson@us.ibm.com>
Date: Tue Dec 1 11:09:14 2015 -0600
Add audit IDs to revocation events
The revoked tokens' audit ID is now included in the data returned in
the revocation list.
Closes-Bug: 1490804
Change-Id: Ifcf88f1158bebddc4f927121fbf4136fb53b659f

| Changed in keystone: | |
| --- | --- |
| **status**: | In Progress → Fix Released |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2016-01-11:  [**Fix proposed to keystonemiddleware (stable/liberty)**](/keystone/%2Bbug/1490804/comments/87) |  |  | [#87](/keystone/%2Bbug/1490804/comments/87) |
| --- | --- | --- | --- |

Fix proposed to branch: stable/liberty

Review: <https://review.openstack.org/265988>

Fix proposed to branch: stable/liberty
Review: https://review.openstack.org/265988

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2016-01-11:  [**Fix merged to keystonemiddleware (master)**](/keystone/%2Bbug/1490804/comments/88) |  |  | [#88](/keystone/%2Bbug/1490804/comments/88) |
| --- | --- | --- | --- |

Reviewed: <https://review.openstack.org/258143>

Committed: <https://git.openstack.org/cgit/openstack/keystonemiddleware/commit/?id=96ab58e6863c92575ada57615b19652e502adfd8>

Submitter: Jenkins

Branch: master

commit 96ab58e6863c92575ada57615b19652e502adfd8

Author: Brant Knudson <email address hidden>

Date: Tue Dec 1 16:08:00 2015 -0600

auth\_token verify revocation by audit\_id

If the revocation list includes audit\_ids, then when doing offline

    validation also validate the token isn't revoked by audit\_id.

Closes-Bug: 1490804

    Change-Id: I483bc57bd38eb81a0905bcaf94e4ea82604919d6

Reviewed: https://review.openstack.org/258143
Committed: https://git.openstack.org/cgit/openstack/keystonemiddleware/commit/?id=96ab58e6863c92575ada57615b19652e502adfd8
Submitter: Jenkins
Branch: master
commit 96ab58e6863c92575ada57615b19652e502adfd8
Author: Brant Knudson <bknudson@us.ibm.com>
Date: Tue Dec 1 16:08:00 2015 -0600
auth\_token verify revocation by audit\_id
If the revocation list includes audit\_ids, then when doing offline
validation also validate the token isn't revoked by audit\_id.
Closes-Bug: 1490804
Change-Id: I483bc57bd38eb81a0905bcaf94e4ea82604919d6

| Changed in keystonemiddleware: | |
| --- | --- |
| **status**: | In Progress → Fix Released |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2016-01-11:  [**Fix proposed to keystone (stable/liberty)**](/keystone/%2Bbug/1490804/comments/89) |  |  | [#89](/keystone/%2Bbug/1490804/comments/89) |
| --- | --- | --- | --- |

Fix proposed to branch: stable/liberty

Review: <https://review.openstack.org/266022>

Fix proposed to branch: stable/liberty
Review: https://review.openstack.org/266022

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2016-01-11:  [**Fix proposed to keystone (stable/kilo)**](/keystone/%2Bbug/1490804/comments/90) |  |  | [#90](/keystone/%2Bbug/1490804/comments/90) |
| --- | --- | --- | --- |

Fix proposed to branch: stable/kilo

Review: <https://review.openstack.org/266045>

Fix proposed to branch: stable/kilo
Review: https://review.openstack.org/266045

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2016-01-12:  [**Fix proposed to keystonemiddleware (stable/kilo)**](/keystone/%2Bbug/1490804/comments/91) |  |  | [#91](/keystone/%2Bbug/1490804/comments/91) |
| --- | --- | --- | --- |

Fix proposed to branch: stable/kilo

Review: <https://review.openstack.org/266607>

Fix proposed to branch: stable/kilo
Review: https://review.openstack.org/266607

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Doug Hellmann (doug-hellmann)](https://launchpad.net/~doug-hellmann) wrote on 2016-01-13:  [**Fix included in openstack/keystonemiddleware 4.1.0**](/keystone/%2Bbug/1490804/comments/92) |  |  | [#92](/keystone/%2Bbug/1490804/comments/92) |
| --- | --- | --- | --- |

This issue was fixed in the openstack/keystonemiddleware 4.1.0 release.

This issue was fixed in the openstack/keystonemiddleware 4.1.0 release.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2016-01-14:  [**Fix merged to keystone (stable/kilo)**](/keystone/%2Bbug/1490804/comments/93) |  |  | [#93](/keystone/%2Bbug/1490804/comments/93) |
| --- | --- | --- | --- |

Reviewed: <https://review.openstack.org/266045>

Committed: <https://git.openstack.org/cgit/openstack/keystone/commit/?id=9c9c1331e0c004897d5f4c5847f7143b56373f10>

Submitter: Jenkins

Branch: stable/kilo

commit 9c9c1331e0c004897d5f4c5847f7143b56373f10

Author: Brant Knudson <email address hidden>

Date: Tue Dec 1 11:09:14 2015 -0600

Add audit IDs to revocation events

The revoked tokens' audit ID is now included in the data returned in

    the revocation list.

Closes-Bug: 1490804

    Change-Id: Ifcf88f1158bebddc4f927121fbf4136fb53b659f

    (cherry picked from commit d5378f173da14a34ca010271477337879002d6d0)

    Conflicts:

     keystone/tests/unit/test\_backend.py

Reviewed: https://review.openstack.org/266045
Committed: https://git.openstack.org/cgit/openstack/keystone/commit/?id=9c9c1331e0c004897d5f4c5847f7143b56373f10
Submitter: Jenkins
Branch: stable/kilo
commit 9c9c1331e0c004897d5f4c5847f7143b56373f10
Author: Brant Knudson <bknudson@us.ibm.com>
Date: Tue Dec 1 11:09:14 2015 -0600
Add audit IDs to revocation events
The revoked tokens' audit ID is now included in the data returned in
the revocation list.
Closes-Bug: 1490804
Change-Id: Ifcf88f1158bebddc4f927121fbf4136fb53b659f
(cherry picked from commit d5378f173da14a34ca010271477337879002d6d0)
Conflicts:
keystone/tests/unit/test\_backend.py

| **tags**: | added: in-stable-kilo |
| --- | --- |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2016-01-14:  [**Fix merged to keystone (stable/liberty)**](/keystone/%2Bbug/1490804/comments/94) |  |  | [#94](/keystone/%2Bbug/1490804/comments/94) |
| --- | --- | --- | --- |

Reviewed: <https://review.openstack.org/266022>

Committed: <https://git.openstack.org/cgit/openstack/keystone/commit/?id=bff03b5726fe5cac93d44a66715eea49b89c8cb0>

Submitter: Jenkins

Branch: stable/liberty

commit bff03b5726fe5cac93d44a66715eea49b89c8cb0

Author: Brant Knudson <email address hidden>

Date: Tue Dec 1 11:09:14 2015 -0600

Add audit IDs to revocation events

The revoked tokens' audit ID is now included in the data returned in

    the revocation list.

Closes-Bug: 1490804

    Change-Id: Ifcf88f1158bebddc4f927121fbf4136fb53b659f

    (cherry picked from commit d5378f173da14a34ca010271477337879002d6d0)

    Conflicts:

     keystone/tests/unit/test\_backend.py

Reviewed: https://review.openstack.org/266022
Committed: https://git.openstack.org/cgit/openstack/keystone/commit/?id=bff03b5726fe5cac93d44a66715eea49b89c8cb0
Submitter: Jenkins
Branch: stable/liberty
commit bff03b5726fe5cac93d44a66715eea49b89c8cb0
Author: Brant Knudson <bknudson@us.ibm.com>
Date: Tue Dec 1 11:09:14 2015 -0600
Add audit IDs to revocation events
The revoked tokens' audit ID is now included in the data returned in
the revocation list.
Closes-Bug: 1490804
Change-Id: Ifcf88f1158bebddc4f927121fbf4136fb53b659f
(cherry picked from commit d5378f173da14a34ca010271477337879002d6d0)
Conflicts:
keystone/tests/unit/test\_backend.py

| **tags**: | added: in-stable-liberty |
| --- | --- |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2016-01-19:  [**Fix merged to keystonemiddleware (stable/liberty)**](/keystone/%2Bbug/1490804/comments/95) |  |  | [#95](/keystone/%2Bbug/1490804/comments/95) |
| --- | --- | --- | --- |

Reviewed: <https://review.openstack.org/265988>

Committed: <https://git.openstack.org/cgit/openstack/keystonemiddleware/commit/?id=9167afaafc216c63fdc875e737bc379400e94059>

Submitter: Jenkins

Branch: stable/liberty

commit 9167afaafc216c63fdc875e737bc379400e94059

Author: Brant Knudson <email address hidden>

Date: Tue Dec 1 16:08:00 2015 -0600

auth\_token verify revocation by audit\_id

If the revocation list includes audit\_ids, then when doing offline

    validation also validate the token isn't revoked by audit\_id.

Backport notes:

    - test\_auth\_token\_middleware was refactored with commit 9cbd47b to

      check responses differently, so the test changed to use the old

      method.

    - reno was not supported so the release note is removed.

Closes-Bug: 1490804

    Change-Id: I483bc57bd38eb81a0905bcaf94e4ea82604919d6

    (cherry picked from commit 96ab58e6863c92575ada57615b19652e502adfd8)

Reviewed: https://review.openstack.org/265988
Committed: https://git.openstack.org/cgit/openstack/keystonemiddleware/commit/?id=9167afaafc216c63fdc875e737bc379400e94059
Submitter: Jenkins
Branch: stable/liberty
commit 9167afaafc216c63fdc875e737bc379400e94059
Author: Brant Knudson <bknudson@us.ibm.com>
Date: Tue Dec 1 16:08:00 2015 -0600
auth\_token verify revocation by audit\_id
If the revocation list includes audit\_ids, then when doing offline
validation also validate the token isn't revoked by audit\_id.
Backport notes:
- test\_auth\_token\_middleware was refactored with commit 9cbd47b to
check responses differently, so the test changed to use the old
method.
- reno was not supported so the release note is removed.
Closes-Bug: 1490804
Change-Id: I483bc57bd38eb81a0905bcaf94e4ea82604919d6
(cherry picked from commit 96ab58e6863c92575ada57615b19652e502adfd8)

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Thierry Carrez (ttx)](https://launchpad.net/~ttx) wrote on 2016-01-21:  [**Fix included in openstack/keystone 9.0.0.0b2**](/keystone/%2Bbug/1490804/comments/96) |  |  | [#96](/keystone/%2Bbug/1490804/comments/96) |
| --- | --- | --- | --- |

This issue was fixed in the openstack/keystone 9.0.0.0b2 development milestone.

This issue was fixed in the openstack/keystone 9.0.0.0b2 development milestone.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2016-01-21:  [**Re: PKI Token Revocation Bypass (CVE-2015-7546)**](/keystone/%2Bbug/1490804/comments/97) |  |  | [#97](/keystone/%2Bbug/1490804/comments/97) |
| --- | --- | --- | --- |

I've put the stable/kilo task back to In Progress. The fix is half committed it is still missing:

  <https://review.openstack.org/#/c/266607/>

I've put the stable/kilo task back to In Progress. The fix is half committed it is still missing:
https://review.openstack.org/#/c/266607/

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2016-01-25:  [**Fix merged to keystonemiddleware (stable/kilo)**](/keystone/%2Bbug/1490804/comments/98) |  |  | [#98](/keystone/%2Bbug/1490804/comments/98) |
| --- | --- | --- | --- |

Reviewed: <https://review.openstack.org/266607>

Committed: <https://git.openstack.org/cgit/openstack/keystonemiddleware/commit/?id=70eeda3e06f5422aa953a38fe93d302079d7cc21>

Submitter: Jenkins

Branch: stable/kilo

commit 70eeda3e06f5422aa953a38fe93d302079d7cc21

Author: Brant Knudson <email address hidden>

Date: Tue Dec 1 16:08:00 2015 -0600

auth\_token verify revocation by audit\_id

If the revocation list includes audit\_ids, then when doing offline

    validation also validate the token isn't revoked by audit\_id.

Backport notes:

    - test\_auth\_token\_middleware was refactored with commit 9cbd47b to

      check responses differently, so the test changed to use the old

      method.

    - reno was not supported so the release note is removed.

Closes-Bug: 1490804

    Conflicts:

     keystonemiddleware/auth\_token/\_\_init\_\_.py

(cherry picked from commit 96ab58e6863c92575ada57615b19652e502adfd8)

    Change-Id: I483bc57bd38eb81a0905bcaf94e4ea82604919d6

Reviewed: https://review.openstack.org/266607
Committed: https://git.openstack.org/cgit/openstack/keystonemiddleware/commit/?id=70eeda3e06f5422aa953a38fe93d302079d7cc21
Submitter: Jenkins
Branch: stable/kilo
commit 70eeda3e06f5422aa953a38fe93d302079d7cc21
Author: Brant Knudson <bknudson@us.ibm.com>
Date: Tue Dec 1 16:08:00 2015 -0600
auth\_token verify revocation by audit\_id
If the revocation list includes audit\_ids, then when doing offline
validation also validate the token isn't revoked by audit\_id.
Backport notes:
- test\_auth\_token\_middleware was refactored with commit 9cbd47b to
check responses differently, so the test changed to use the old
method.
- reno was not supported so the release note is removed.
Closes-Bug: 1490804
Conflicts:
keystonemiddleware/auth\_token/\_\_init\_\_.py
(cherry picked from commit 96ab58e6863c92575ada57615b19652e502adfd8)
Change-Id: I483bc57bd38eb81a0905bcaf94e4ea82604919d6

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2016-01-28:  [**Related fix proposed to ossa (master)**](/keystone/%2Bbug/1490804/comments/99) |  |  | [#99](/keystone/%2Bbug/1490804/comments/99) |
| --- | --- | --- | --- |

Related fix proposed to branch: master

Review: <https://review.openstack.org/273679>

Related fix proposed to branch: master
Review: https://review.openstack.org/273679

[Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray)
on 2016-01-29

| **summary**: | - PKI Token Revocation Bypass (CVE-2015-7546)+ [OSSA 2015-006] PKI Token Revocation Bypass (CVE-2015-7546) |
| --- | --- |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2016-01-29:  [**Related fix merged to ossa (master)**](/keystone/%2Bbug/1490804/comments/100) |  |  | [#100](/keystone/%2Bbug/1490804/comments/100) |
| --- | --- | --- | --- |

Reviewed: <https://review.openstack.org/273679>

Committed: <https://git.openstack.org/cgit/openstack/ossa/commit/?id=1e03c88750db3cfdd01a59c6084b624b22c78c72>

Submitter: Jenkins

Branch: master

commit 1e03c88750db3cfdd01a59c6084b624b22c78c72

Author: Tristan Cacqueray <email address hidden>

Date: Thu Jan 28 12:24:15 2016 -0500

Adds OSSA-2016-005 (CVE-2015-7546)

This change also remove issues 'type' which isn't used and can't

    be extended to support other type such as OSSN.

Change-Id: I037c8e808466bbdceac38d6cf10a3f98703ad99f

    Related-Bug: #1490804

Reviewed: https://review.openstack.org/273679
Committed: https://git.openstack.org/cgit/openstack/ossa/commit/?id=1e03c88750db3cfdd01a59c6084b624b22c78c72
Submitter: Jenkins
Branch: master
commit 1e03c88750db3cfdd01a59c6084b624b22c78c72
Author: Tristan Cacqueray <tdecacqu@redhat.com>
Date: Thu Jan 28 12:24:15 2016 -0500
Adds OSSA-2016-005 (CVE-2015-7546)
This change also remove issues 'type' which isn't used and can't
be extended to support other type such as OSSN.
Change-Id: I037c8e808466bbdceac38d6cf10a3f98703ad99f
Related-Bug: #1490804

[Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray)
on 2016-01-29

| **summary**: | - [OSSA 2015-006] PKI Token Revocation Bypass (CVE-2015-7546)+ [OSSA 2015-005] PKI Token Revocation Bypass (CVE-2015-7546) |
| --- | --- |
| Changed in ossa: | |
| **status**: | Confirmed → Fix Released |
| **summary**: | - [OSSA 2015-005] PKI Token Revocation Bypass (CVE-2015-7546)+ [OSSA 2016-005] PKI Token Revocation Bypass (CVE-2015-7546) |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Doug Hellmann (doug-hellmann)](https://launchpad.net/~doug-hellmann) wrote on 2016-03-03:  [**Fix included in openstack/keystone 8.1.0**](/keystone/%2Bbug/1490804/comments/101) |  |  | [#101](/keystone/%2Bbug/1490804/comments/101) |
| --- | --- | --- | --- |

This issue was fixed in the openstack/keystone 8.1.0 release.

This issue was fixed in the openstack/keystone 8.1.0 release.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Doug Hellmann (doug-hellmann)](https://launchpad.net/~doug-hellmann) wrote on 2016-03-03:  [**Fix included in openstack/keystonemiddleware 2.3.3**](/keystone/%2Bbug/1490804/comments/102) |  |  | [#102](/keystone/%2Bbug/1490804/comments/102) |
| --- | --- | --- | --- |

This issue was fixed in the openstack/keystonemiddleware 2.3.3 release.

This issue was fixed in the openstack/keystonemiddleware 2.3.3 release.

[See full activity log](https://bugs.launchpad.net/keystone/%2Bbug/1490804/%2Bactivity)

Displaying first 40
and last 40
comments.
[View all 102
comments](/keystone/%2Bbug/1490804?comments=all) or [add a comment](/keystone/%2Bbug/1490804?comments=all).

* [Report a bug](/keystone/%2Bfilebug)

This report contains
**Public Security**
information

Everyone can see this security related information.

You are
[not directly subscribed to this bug's notifications.](/keystone/%2Bbug/1490804/%2Bsubscribe)

Subscribing...

* [Edit bug mail](https://bugs.launchpad.net/keystone/%2Bbug/1490804/%2Bsubscriptions "View and change your subscriptions to this bug")

## Other bug subscribers

[Subscribe someone else](https://bugs.launchpad.net/keystone/%2Bbug/1490804/%2Baddsubscriber "Launchpad will email that person whenever this bugs changes")

## Patches

* [bug-1490804-tests-master-v1.patch](https://bugs.launchpad.net/keystone/%2Bbug/1490804/%2Battachment/4456156/%2Bfiles/bug-1490804-tests-master-v1.patch)
  [Edit](/keystone/%2Bbug/1490804/%2Battachment/4456156 "Change patch details")
* [0001-Reject-modified-PKI-Tokens.patch](https://bugs.launchpad.net/keystone/%2Bbug/1490804/%2Battachment/4456676/%2Bfiles/0001-Reject-modified-PKI-Tokens.patch)
  [Edit](/keystone/%2Bbug/1490804/%2Battachment/4456676 "Change patch details")
* [0001-hash-the-data-in-the-token.patch](https://bugs.launchpad.net/keystone/%2Bbug/1490804/%2Battachment/4456711/%2Bfiles/0001-hash-the-data-in-the-token.patch)
  [Edit](/keystone/%2Bbug/1490804/%2Battachment/4456711 "Change patch details")
* [0001-Use-the-Keystoneclient-code-to-hash-the-token.patch](https://bugs.launchpad.net/keystone/%2Bbug/1490804/%2Battachment/4456923/%2Bfiles/0001-Use-the-Keystoneclient-code-to-hash-the-token.patch)
  [Edit](/keystone/%2Bbug/1490804/%2Battachment/4456923 "Change patch details")
* [0001-Disable-PKI-token-Provider.patch](https://bugs.launchpad.net/keystone/%2Bbug/1490804/%2Battachment/4508239/%2Bfiles/0001-Disable-PKI-token-Provider.patch)
  [Edit](/keystone/%2Bbug/1490804/%2Battachment/4508239 "Change patch details")
* [0001-Add-audit-IDs-to-revocation-events.patch](https://bugs.launchpad.net/keystone/%2Bbug/1490804/%2Battachment/4528257/%2Bfiles/0001-Add-audit-IDs-to-revocation-events.patch)
  [Edit](/keystone/%2Bbug/1490804/%2Battachment/4528257 "Change patch details")
* [0001-Verify-audit\_id-when-available.patch](https://bugs.launchpad.net/keystone/%2Bbug/1490804/%2Battachment/4528258/%2Bfiles/0001-Verify-audit_id-when-available.patch)
  [Edit](/keystone/%2Bbug/1490804/%2Battachment/4528258 "Change patch details")

* [Add patch](/keystone/%2Bbug/1490804/%2Baddcomment?field.patch=on)

## Bug attachments

* [modify\_token.py](https://bugs.launchpad.net/keystone/%2Bbug/1490804/%2Battachment/4455970/%2Bfiles/modify_token.py)
  [Edit](/keystone/%2Bbug/1490804/%2Battachment/4455970 "Change attachment details")
* [derdump of Token data in ASN1 format](https://bugs.launchpad.net/keystone/%2Bbug/1490804/%2Battachment/4455971/%2Bfiles/tokendata)
  [Edit](/keystone/%2Bbug/1490804/%2Battachment/4455971 "Change attachment details")
* [bug1490804-patch-test-traceback.txt](https://bugs.launchpad.net/keystone/%2Bbug/1490804/%2Battachment/4469888/%2Bfiles/bug1490804-patch-test-traceback.txt)
  [Edit](/keystone/%2Bbug/1490804/%2Battachment/4469888 "Change attachment details")

* [Add attachment](/keystone/%2Bbug/1490804/%2Baddcomment)

## Remote bug watches

Bug watches keep track of this bug in other bug trackers.

[![Launchpad](/@@/launchpad-footer-logo.svg)](https://launchpad.net/)
 •
[Take the tour](https://launchpad.net/%2Btour)
 •
[Read the guide](https://help.launchpad.net/)

© 2004
[Canonical Ltd.](http://canonical.com/)
 •
[Terms of use](https://launchpad.net/legal)
 •
[Data privacy](https://www.ubuntu.com/legal/dataprivacy)
 •
[Contact Launchpad Support](/feedback)
 •
[Blog](http://blog.launchpad.net/)
 •
[Careers](https://canonical.com/careers)
 •
[System status](https://ubuntu.social/%40launchpadstatus)
 •
4d55102
([Get the code!](https://dev.launchpad.net/))



=== Content from launchpad.net_a2352692_20250126_131124.html ===

[Log in / Register](https://launchpad.net/~tr/%2Blogin)

[![](/@@/person-logo)](https://launchpad.net/~tr)

## [Olchi](https://launchpad.net/~tr)

* Overview
* [Code](https://code.launchpad.net/~tr)
* [Bugs](https://bugs.launchpad.net/~tr)
* [Blueprints](https://blueprints.launchpad.net/~tr)
* [Translations](https://translations.launchpad.net/~tr)
* [Answers](https://answers.launchpad.net/~tr)

* [Related packages](https://launchpad.net/~tr/%2Brelated-packages)
* [Related projects](https://launchpad.net/~tr/%2Brelated-projects)

## User information

Launchpad Id:
tr

Email:
[Log in](%2Blogin) for email information.

Member since:
2009-02-23

Languages:

English

Time zone:

UTC
(UTC+0000)

Karma:
[0](https://launchpad.net/~tr/%2Bkarma)
[Karma help](/%2Bhelp-registry/karma.html)

## Latest memberships

Olchi is not an
active member of any Launchpad teams.

[![Launchpad](/@@/launchpad-footer-logo.svg)](https://launchpad.net/)
 •
[Take the tour](https://launchpad.net/%2Btour)
 •
[Read the guide](https://help.launchpad.net/)

© 2004
[Canonical Ltd.](http://canonical.com/)
 •
[Terms of use](https://launchpad.net/legal)
 •
[Data privacy](https://www.ubuntu.com/legal/dataprivacy)
 •
[Contact Launchpad Support](/feedback)
 •
[Blog](http://blog.launchpad.net/)
 •
[Careers](https://canonical.com/careers)
 •
[System status](https://ubuntu.social/%40launchpadstatus)
 •
4d55102
([Get the code!](https://dev.launchpad.net/))



=== Content from launchpad.net_11a74184_20250126_131118.html ===

[Log in / Register](https://launchpad.net/~doug-hellmann/%2Blogin)

[![](https://launchpadlibrarian.net/137179030/doug-hellmann-64x64.png)](https://launchpad.net/~doug-hellmann)

## [Doug Hellmann](https://launchpad.net/~doug-hellmann)

* Overview
* [Code](https://code.launchpad.net/~doug-hellmann)
* [Bugs](https://bugs.launchpad.net/~doug-hellmann)
* [Blueprints](https://blueprints.launchpad.net/~doug-hellmann)
* [Translations](https://translations.launchpad.net/~doug-hellmann)
* [Answers](https://answers.launchpad.net/~doug-hellmann)

* [Related packages](https://launchpad.net/~doug-hellmann/%2Brelated-packages)
* [Related projects](https://launchpad.net/~doug-hellmann/%2Brelated-projects)

## User information

Launchpad Id:
doug-hellmann

Email:
[Log in](%2Blogin) for email information.

Member since:
2008-12-13

[![Icon of DreamCompute Team](https://launchpadlibrarian.net/90872633/DreamHost-Cloud-Logo_x14.png "Member of DreamCompute Team")](/~dreamcompute-team)
[![Icon of DreamHost Cloud Team](https://launchpadlibrarian.net/90872858/DreamHost-Cloud-Logo_x14.png "Member of DreamHost Cloud Team")](/~dreamhost-cloud-team)
[![Icon of DreamHost Dev Managers](https://launchpadlibrarian.net/90872782/DreamHost-Logo_x14.png "Member of DreamHost Dev Managers")](/~dreamhost-dev-managers)
[![Icon of DreamHost OpenStack Team](https://launchpadlibrarian.net/86125700/DreamHost-Cloud-Logo_x14.png "Member of DreamHost OpenStack Team")](/~dreamhost-openstack-team)
[![Icon of DreamObjects Team](https://launchpadlibrarian.net/90872708/DreamHost-Cloud-Logo_x14.png "Member of DreamObjects Team")](/~dreamobjects-team)
[![Icon of DreamOps Team](https://launchpadlibrarian.net/90872612/DreamHost-Cloud-Logo_x14.png "Member of DreamOps Team")](/~dreamops-team)
[![Icon of OpenStack Team](https://launchpadlibrarian.net/52313052/os14.png "Member of OpenStack Team")](/~openstack)
[![Icon of Python OpenStack Client](https://launchpadlibrarian.net/697274843/osc-icon.png "Member of Python OpenStack Client")](/~python-openstackclient)

Languages:

English

SSH keys:

[doug@doughellmann.com](%2Bsshkeys)

[dhellmann-rsa@hubert.local](%2Bsshkeys)

[doug.hellmann@gmail.com](%2Bsshkeys)

[doug.hellmann@dreamhost.com](%2Bsshkeys)

Time zone:

America/New\_York
(UTC-0500)

Karma:
[0](https://launchpad.net/~doug-hellmann/%2Bkarma)
[Karma help](/%2Bhelp-registry/karma.html)

Social accounts:
![IRC](/@@/social-irc "IRC")
**dhellmann**
 on
**Irc.freenode.net**

## [All bugs in progress](https://launchpad.net/~doug-hellmann/%2Bassignedbugs?search=Search&field.status=In+Progress) Assigned bugs

||  | #1743202 [pbr documentation uses version numbers that do not match the canonical form expected by pbr itself](https://bugs.launchpad.net/reno/%2Bbug/1743202) |  |
| --- | --- | --- |
| in [reno](/reno), [PBR](/pbr) | | |

| --- | --- | --- | --- | --- | --- |

## [All assigned blueprints](/~doug-hellmann/%2Bspecs?role=assignee) Assigned blueprints

| **[Refactor Test Base Class](https://blueprints.launchpad.net/oslotest/%2Bspec/oslotest-refactor-test-base-class "oslotest-refactor-test-base-class")** for **oslotest**  Deprecate the test base class and move its features into fixtures. | |
| --- | --- |

## [All memberships](https://launchpad.net/~doug-hellmann/%2Bparticipation) Latest memberships

| [Reno Drivers](/~reno-drivers)  Joined on 2018-01-16 | |
| --- | --- |
| [whereto-drivers](/~whereto-drivers)  Joined on 2017-08-23 | |
| [OpenStack Downpour](/~os-downpour)  Joined on 2017-04-26 | |
| [Dulwich Users](/~dulwich-users)  Joined on 2016-12-22 | |
| [Oslo Policy Core](/~oslo-policy-core)  Joined on 2015-01-12 | |

[![Launchpad](/@@/launchpad-footer-logo.svg)](https://launchpad.net/)
 •
[Take the tour](https://launchpad.net/%2Btour)
 •
[Read the guide](https://help.launchpad.net/)

© 2004
[Canonical Ltd.](http://canonical.com/)
 •
[Terms of use](https://launchpad.net/legal)
 •
[Data privacy](https://www.ubuntu.com/legal/dataprivacy)
 •
[Contact Launchpad Support](/feedback)
 •
[Blog](http://blog.launchpad.net/)
 •
[Careers](https://canonical.com/careers)
 •
[System status](https://ubuntu.social/%40launchpadstatus)
 •
4d55102
([Get the code!](https://dev.launchpad.net/))



=== Content from wiki.openstack.org_e5f241c2_20250126_131145.html ===


* [![OpenStack](https://wiki.openstack.org/w/images/thumb/c/c4/OpenStack_Logo_-_notext.png/30px-OpenStack_Logo_-_notext.png)](/wiki/Main_Page "Visit the main page")

* Page
  + [Page](/wiki/OSSN/OSSN-0062 "View the content page [c]")
  + [Discussion](/w/index.php?title=Talk:OSSN/OSSN-0062&action=edit&redlink=1 "Discussion about the content page [t]")
  + [View source](/w/index.php?title=OSSN/OSSN-0062&action=edit "This page is protected.
    You can view its source [e]")
  + [History](/w/index.php?title=OSSN/OSSN-0062&action=history "Past revisions of this page [h]")

* Print/export
  + [Create a book](/w/index.php?title=Special:Book&bookcmd=book_creator&referer=OSSN%2FOSSN-0062)
  + [Download as PDF](/w/index.php?title=Special:Book&bookcmd=render_article&arttitle=OSSN%2FOSSN-0062&returnto=OSSN%2FOSSN-0062&oldid=128838&writer=rl)
  + [Printable version](/w/index.php?title=OSSN/OSSN-0062&printable=yes "Printable version of this page [p]")

* Tools
  + [Page information](/w/index.php?title=OSSN/OSSN-0062&action=info "More information about this page")
  + [Permanent link](/w/index.php?title=OSSN/OSSN-0062&oldid=128838 "Permanent link to this revision of the page")
  + [Special pages](/wiki/Special%3ASpecialPages "A list of all special pages [q]")
  + [Related changes](/wiki/Special%3ARecentChangesLinked/OSSN/OSSN-0062 "Recent changes in pages linked from this page [k]")
  + [What links here](/wiki/Special%3AWhatLinksHere/OSSN/OSSN-0062 "A list of all wiki pages that link here [j]")

* * [Create account](/w/index.php?title=Special:CreateAccount&returnto=OSSN%2FOSSN-0062&returntoquery=oldid%3D128838 "You are encouraged to create an account and log in; however, it is not mandatory")
* * [Log in](/w/index.php?title=Special:UserLogin&returnto=OSSN%2FOSSN-0062&returntoquery=oldid%3D128838 "You are encouraged to log in; however, it is not mandatory [o]")
* * [Log in / create account with OpenID](/w/index.php?title=Special:OpenIDLogin&returnto=OSSN/OSSN-0062)
* + English

* [Home](http://www.openstack.org)
* [Software](http://www.openstack.org/software)
* [User Stories](http://www.openstack.org/user-stories)
* [Community](http://www.openstack.org/community)
* [Profile](http://www.openstack.org/profile)
* [Blog](http://www.openstack.org/blog)
* [Wiki](http://wiki.openstack.org)
* [Documentation](http://docs.openstack.org)

Jump to: [navigation](#mw-head),
[search](#p-search)

# OSSN/OSSN-0062

< [OSSN](/wiki/OSSN "OSSN")Revision as of 10:06, 22 July 2016 by [Lhinds](/w/index.php?title=User:Lhinds&action=edit&redlink=1 "User:Lhinds (page does not exist)") ([talk](/w/index.php?title=User_talk:Lhinds&action=edit&redlink=1 "User talk:Lhinds (page does not exist)") | [contribs](/wiki/Special%3AContributions/Lhinds "Special:Contributions/Lhinds")) ([→](#Contacts_.2F_References)‎Contacts / References)([diff](/w/index.php?title=OSSN/OSSN-0062&diff=prev&oldid=128838 "OSSN/OSSN-0062")) [← Older revision](/w/index.php?title=OSSN/OSSN-0062&direction=prev&oldid=128838 "OSSN/OSSN-0062") | Latest revision (diff) | Newer revision → (diff)

## Potential reuse of revoked Identity tokens

### Summary

An authorization token issued by the Identity service can be revoked,
which is designed to immediately make that token invalid for future use.
When the PKI or PKIZ token providers are used, it is possible for an
attacker to manipulate the token contents of a revoked token such that
the token will still be considered to be valid. This can allow
unauthorized access to cloud resources if a revoked token is intercepted
by an attacker.

### Affected Services / Software

Keystone, Icehouse, Juno, Kilo, Liberty

### Discussion

Token revocation is used in OpenStack to invalidate a token for further
use. This token revocation takes place automatically in certain
situations, such as when a user logs out of the Dashboard. If a revoked
token is obtained by another party, it should no longer be possible to
use it to perform any actions within the cloud. Unfortunately, this is
not the case when the PKI or PKIZ token providers are used.

When a PKI or PKIZ token is validated, the Identity service checks it
by searching for a revocation by the entire token. It is possible for
an attacker to manipulate portions of an intercepted PKI or PKIZ token
that are not cryptographically protected, which will cause the
revocation check to improperly consider the token to be valid.

### Recommended Actions

We recommend that you do not use the PKI or PKIZ token providers. The
PKI and PKIZ token providers do not offer any significant benefit over
other token providers such as the UUID or Fernet.

If you are using the PKI or PKIZ token providers, it is recommended that
you switch to using another supported token provider such as the UUID
provider. This issue might be fixed in a future update of the PKI and
PKIZ token providers in the Identity service.

To check what token provider you are using, you must look in the
'keystone.conf' file for your Identity service. An example is provided
below:

```
 [token]
 #provider = keystone.token.providers.pki.Provider
 #provider = keystone.token.providers.pkiz.Provider
 provider = keystone.token.providers.uuid.Provider

```

In the Liberty release of the Identity service, the token provider
configuration is different than previous OpenStack releases. An
example from the Libery release is provided below:

```
 [token]
 #provider = pki
 #provider = pkiz
 provider = uuid

```

These configuration snippets are using the UUID token provider. If you
are using any of the commented out settings from these examples, your
cloud is vulnerable to this issue and you should switch to a different
token provider.

### Contacts / References

* Author: Nathan Kinder, Red Hat
* This OSSN : <https://wiki.openstack.org/wiki/OSSN/OSSN-0062>
* Original LaunchPad Bug : [https://bugs.launchpad.net/keystone/+bug/1490804](https://bugs.launchpad.net/keystone/%2Bbug/1490804)
* OpenStack Security ML : openstack-security@lists.openstack.org
* OpenStack Security Group : <https://launchpad.net/~openstack-ossg>
* CVE: CVE-2015-7546

Retrieved from "<https://wiki.openstack.org/w/index.php?title=OSSN/OSSN-0062&oldid=128838>"

* [Privacy policy](/wiki/OpenStack%3APrivacy_policy "OpenStack:Privacy policy")
* [About OpenStack](/wiki/OpenStack%3AAbout "OpenStack:About")
* [Disclaimers](/wiki/OpenStack%3AGeneral_disclaimer "OpenStack:General disclaimer")

* [![Attribution 3.0 Unported (CC BY 3.0)](/w/resources/assets/licenses/cc-by.png)](http://creativecommons.org/licenses/by/3.0/)
* [![Powered by MediaWiki](/w/resources/assets/poweredby_mediawiki_88x31.png)](//www.mediawiki.org/)



=== Content from wiki.openstack.org_1d5c61a7_20250126_131135.html ===


* [![OpenStack](https://wiki.openstack.org/w/images/thumb/c/c4/OpenStack_Logo_-_notext.png/30px-OpenStack_Logo_-_notext.png)](/wiki/Main_Page "Visit the main page")

* Page
  + [Page](/wiki/OSSN/OSSN-0062 "View the content page [c]")
  + [Discussion](/w/index.php?title=Talk:OSSN/OSSN-0062&action=edit&redlink=1 "Discussion about the content page [t]")
  + [View source](/w/index.php?title=OSSN/OSSN-0062&action=edit "This page is protected.
    You can view its source [e]")
  + [History](/w/index.php?title=OSSN/OSSN-0062&action=history "Past revisions of this page [h]")

* Print/export
  + [Create a book](/w/index.php?title=Special:Book&bookcmd=book_creator&referer=OSSN%2FOSSN-0062)
  + [Download as PDF](/w/index.php?title=Special:Book&bookcmd=render_article&arttitle=OSSN%2FOSSN-0062&returnto=OSSN%2FOSSN-0062&oldid=128838&writer=rl)
  + [Printable version](/w/index.php?title=OSSN/OSSN-0062&printable=yes "Printable version of this page [p]")

* Tools
  + [Page information](/w/index.php?title=OSSN/OSSN-0062&action=info "More information about this page")
  + [Permanent link](/w/index.php?title=OSSN/OSSN-0062&oldid=128838 "Permanent link to this revision of the page")
  + [Special pages](/wiki/Special%3ASpecialPages "A list of all special pages [q]")
  + [Related changes](/wiki/Special%3ARecentChangesLinked/OSSN/OSSN-0062 "Recent changes in pages linked from this page [k]")
  + [What links here](/wiki/Special%3AWhatLinksHere/OSSN/OSSN-0062 "A list of all wiki pages that link here [j]")

* * [Create account](/w/index.php?title=Special:CreateAccount&returnto=OSSN%2FOSSN-0062 "You are encouraged to create an account and log in; however, it is not mandatory")
* * [Log in](/w/index.php?title=Special:UserLogin&returnto=OSSN%2FOSSN-0062 "You are encouraged to log in; however, it is not mandatory [o]")
* * [Log in / create account with OpenID](/w/index.php?title=Special:OpenIDLogin&returnto=OSSN/OSSN-0062)
* + English

* [Home](http://www.openstack.org)
* [Software](http://www.openstack.org/software)
* [User Stories](http://www.openstack.org/user-stories)
* [Community](http://www.openstack.org/community)
* [Profile](http://www.openstack.org/profile)
* [Blog](http://www.openstack.org/blog)
* [Wiki](http://wiki.openstack.org)
* [Documentation](http://docs.openstack.org)

Jump to: [navigation](#mw-head),
[search](#p-search)

# OSSN/OSSN-0062

< [OSSN](/wiki/OSSN "OSSN")

## Potential reuse of revoked Identity tokens

### Summary

An authorization token issued by the Identity service can be revoked,
which is designed to immediately make that token invalid for future use.
When the PKI or PKIZ token providers are used, it is possible for an
attacker to manipulate the token contents of a revoked token such that
the token will still be considered to be valid. This can allow
unauthorized access to cloud resources if a revoked token is intercepted
by an attacker.

### Affected Services / Software

Keystone, Icehouse, Juno, Kilo, Liberty

### Discussion

Token revocation is used in OpenStack to invalidate a token for further
use. This token revocation takes place automatically in certain
situations, such as when a user logs out of the Dashboard. If a revoked
token is obtained by another party, it should no longer be possible to
use it to perform any actions within the cloud. Unfortunately, this is
not the case when the PKI or PKIZ token providers are used.

When a PKI or PKIZ token is validated, the Identity service checks it
by searching for a revocation by the entire token. It is possible for
an attacker to manipulate portions of an intercepted PKI or PKIZ token
that are not cryptographically protected, which will cause the
revocation check to improperly consider the token to be valid.

### Recommended Actions

We recommend that you do not use the PKI or PKIZ token providers. The
PKI and PKIZ token providers do not offer any significant benefit over
other token providers such as the UUID or Fernet.

If you are using the PKI or PKIZ token providers, it is recommended that
you switch to using another supported token provider such as the UUID
provider. This issue might be fixed in a future update of the PKI and
PKIZ token providers in the Identity service.

To check what token provider you are using, you must look in the
'keystone.conf' file for your Identity service. An example is provided
below:

```
 [token]
 #provider = keystone.token.providers.pki.Provider
 #provider = keystone.token.providers.pkiz.Provider
 provider = keystone.token.providers.uuid.Provider

```

In the Liberty release of the Identity service, the token provider
configuration is different than previous OpenStack releases. An
example from the Libery release is provided below:

```
 [token]
 #provider = pki
 #provider = pkiz
 provider = uuid

```

These configuration snippets are using the UUID token provider. If you
are using any of the commented out settings from these examples, your
cloud is vulnerable to this issue and you should switch to a different
token provider.

### Contacts / References

* Author: Nathan Kinder, Red Hat
* This OSSN : <https://wiki.openstack.org/wiki/OSSN/OSSN-0062>
* Original LaunchPad Bug : [https://bugs.launchpad.net/keystone/+bug/1490804](https://bugs.launchpad.net/keystone/%2Bbug/1490804)
* OpenStack Security ML : openstack-security@lists.openstack.org
* OpenStack Security Group : <https://launchpad.net/~openstack-ossg>
* CVE: CVE-2015-7546

Retrieved from "<https://wiki.openstack.org/w/index.php?title=OSSN/OSSN-0062&oldid=128838>"

* [Privacy policy](/wiki/OpenStack%3APrivacy_policy "OpenStack:Privacy policy")
* [About OpenStack](/wiki/OpenStack%3AAbout "OpenStack:About")
* [Disclaimers](/wiki/OpenStack%3AGeneral_disclaimer "OpenStack:General disclaimer")

* [![Attribution 3.0 Unported (CC BY 3.0)](/w/resources/assets/licenses/cc-by.png)](http://creativecommons.org/licenses/by/3.0/)
* [![Powered by MediaWiki](/w/resources/assets/poweredby_mediawiki_88x31.png)](//www.mediawiki.org/)



=== Content from bugs.launchpad.net_dc0e61ab_20250126_131139.html ===

[Log in / Register](https://bugs.launchpad.net/keystone/%2Bbug/1490804/%2Blogin)

[![](https://launchpadlibrarian.net/359059841/OpenStack_Project_Keystone_mascot%20%281%29.png)](https://launchpad.net/keystone)

## [OpenStack Identity (keystone)](https://launchpad.net/keystone)

* [Overview](https://launchpad.net/keystone)
* [Code](https://code.launchpad.net/keystone)
* [Bugs](https://bugs.launchpad.net/keystone)
* [Blueprints](https://blueprints.launchpad.net/keystone)
* [Translations](https://translations.launchpad.net/keystone)
* [Answers](https://answers.launchpad.net/keystone)

# [OSSA 2016-005] PKI Token Revocation Bypass (CVE-2015-7546)

Bug #1490804 reported by
[Liusheng](https://launchpad.net/~liusheng)
on 2015-09-01

[264](/%2Bhelp-bugs/bug-heat.html)

This bug affects 1 person

| Affects | | Status | Importance | Assigned to | Milestone |
| --- | --- | --- | --- | --- | --- |
|  | [OpenStack Identity (keystone)](https://bugs.launchpad.net/keystone) | Fix Released | High | [Brant Knudson](https://launchpad.net/~blk-u) | [OpenStack Identity (keystone) mitaka-2 "m2"](https://launchpad.net/keystone/%2Bmilestone/mitaka-2) |
|  | [Kilo](https://bugs.launchpad.net/keystone/kilo) | Fix Released | High | Unassigned | [OpenStack Identity (keystone) 2015.1.3](https://launchpad.net/keystone/%2Bmilestone/2015.1.3) |
|  | [OpenStack Security Advisory](https://bugs.launchpad.net/ossa) | Fix Released | Undecided | Unassigned |  |
|  | [OpenStack Security Notes](https://bugs.launchpad.net/ossn) | Fix Released | Critical | [Nathan Kinder](https://launchpad.net/~nkinder) |  |
|  | [django-openstack-auth](https://bugs.launchpad.net/django-openstack-auth) | Invalid | Undecided | [Adam Young](https://launchpad.net/~ayoung) |  |
|  | [keystonemiddleware](https://bugs.launchpad.net/keystonemiddleware) | Fix Released | High | [Brant Knudson](https://launchpad.net/~blk-u) |  |
|  | [python-keystoneclient](https://bugs.launchpad.net/python-keystoneclient) | Won't Fix | Undecided | [Adam Young](https://launchpad.net/~ayoung) |  |

### Bug Description

A keystone token which has been revoked can still be used by manipulating particular byte fields within the token.

When a Keystone token is revoked it is added to the revoked list which stores the exact token value. Any API will look at the token to see whether or not it should accept a token. By changing a single byte within the token, the revocation can be bypassed. see the testing script [1].

It is suggested that the revocation should be changed to only check the token's inner ID.

[1] <http://paste.openstack.org/show/436516/>

See [original description](comments/0)

Tags:

[in-stable-kilo](/keystone/%2Bbugs?field.tag=in-stable-kilo)
[in-stable-liberty](/keystone/%2Bbugs?field.tag=in-stable-liberty)
[kilo-backport-potential](/keystone/%2Bbugs?field.tag=kilo-backport-potential)
[liberty-backport-potential](/keystone/%2Bbugs?field.tag=liberty-backport-potential)

## CVE References

* [2015-7546](/bugs/cve/2015-7546 "The identity service in OpenStack Ide...")

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2015-09-01: |  |  | [#1](/keystone/%2Bbug/1490804/comments/1) |
| --- | --- | --- | --- |

Since this report concerns a possible security risk, an incomplete security advisory task has been added while the core security reviewers for the affected project or projects confirm the bug and discuss the scope of any vulnerability along with potential solutions.

Since this report concerns a possible security risk, an incomplete security advisory task has been added while the core security reviewers for the affected project or projects confirm the bug and discuss the scope of any vulnerability along with potential solutions.

| Changed in ossa: | |
| --- | --- |
| **status**: | New → Incomplete |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2015-09-01: |  |  | [#2](/keystone/%2Bbug/1490804/comments/2) |
| --- | --- | --- | --- |

The tests scripts does not show how token are created/revoked. What type of token is this ?

Maybe it's a swift setting that allows direct access to the swift account.

The tests scripts does not show how token are created/revoked. What type of token is this ?
Maybe it's a swift setting that allows direct access to the swift account.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Jeremy Stanley (fungi)](https://launchpad.net/~fungi) wrote on 2015-09-01: |  |  | [#3](/keystone/%2Bbug/1490804/comments/3) |
| --- | --- | --- | --- |

Please also be aware that paste.openstack.org contents are not secret/private and can be easily enumerated. We should probably consider this issue publicly disclosed at this point since an exploit has been published to the paste server.

Please also be aware that paste.openstack.org contents are not secret/private and can be easily enumerated. We should probably consider this issue publicly disclosed at this point since an exploit has been published to the paste server.

| **description**: | updated |
| --- | --- |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Morgan Fainberg (mdrnstm)](https://launchpad.net/~mdrnstm) wrote on 2015-09-01: |  |  | [#4](/keystone/%2Bbug/1490804/comments/4) |
| --- | --- | --- | --- |

I would like to know what version of keystone is being used here and what type of token.

This is definitely not uuid tokens, and I don't believe this can be fernet as fernet is live validated and does not rely on the token\_id for revocations.

Can this occur with services other than swift as well? I'll need to dig further on this unless the information can be provided.

I would like to know what version of keystone is being used here and what type of token.
This is definitely not uuid tokens, and I don't believe this can be fernet as fernet is live validated and does not rely on the token\_id for revocations.
Can this occur with services other than swift as well? I'll need to dig further on this unless the information can be provided.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Morgan Fainberg (mdrnstm)](https://launchpad.net/~mdrnstm) wrote on 2015-09-01: |  |  | [#5](/keystone/%2Bbug/1490804/comments/5) |
| --- | --- | --- | --- |

If this is PKI/PKIZ tokens, there are no "internal" IDs as the internal ID would be part of the signed data. The signed data cannot contain the ID itself as it would change the ID.

Discussing this a bit further it looks like "revoke by ID" should have been based on fingerprint or the signed data (as per adam young). Alternatively, we can now use the audit\_ids for "revoke by id"

I am still in process of confirming outside of swift.

If this is PKI/PKIZ tokens, there are no "internal" IDs as the internal ID would be part of the signed data. The signed data cannot contain the ID itself as it would change the ID.
Discussing this a bit further it looks like "revoke by ID" should have been based on fingerprint or the signed data (as per adam young). Alternatively, we can now use the audit\_ids for "revoke by id"
I am still in process of confirming outside of swift.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Dolph Mathews (dolph)](https://launchpad.net/~dolph) wrote on 2015-09-01: |  |  | [#6](/keystone/%2Bbug/1490804/comments/6) |
| --- | --- | --- | --- |

This sounds like it must be limited to PKI/PKIZ tokens? Fernet tokens would fail their HMAC and there is no room to manipulate UUID tokens unless you're guessing a completely different one.

In the script to reproduce, mutating token\_bin[1] would be manipulating the CMS length prefix (MIIE-\*, etc), in which case, I wonder if there's a bug in openssl?

Jeremy: please don't open this bug just because the paste is public. There's nothing in the paste that shouts "security vulnerability," and we should certainly have the ability to delete pastes (and move them here), no?

This sounds like it must be limited to PKI/PKIZ tokens? Fernet tokens would fail their HMAC and there is no room to manipulate UUID tokens unless you're guessing a completely different one.
In the script to reproduce, mutating token\_bin[1] would be manipulating the CMS length prefix (MIIE-\*, etc), in which case, I wonder if there's a bug in openssl?
Jeremy: please don't open this bug just because the paste is public. There's nothing in the paste that shouts "security vulnerability," and we should certainly have the ability to delete pastes (and move them here), no?

| Changed in keystone: | |
| --- | --- |
| **importance**: | Undecided → High |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Jeremy Stanley (fungi)](https://launchpad.net/~fungi) wrote on 2015-09-01: |  |  | [#7](/keystone/%2Bbug/1490804/comments/7) |
| --- | --- | --- | --- |

I won't switch this to public without consensus anyway, but can assure that there are crawlers continuously spidering our paste server (I know because I see them in the logs and they make up quite possibly the majority of requests there).

I won't switch this to public without consensus anyway, but can assure that there are crawlers continuously spidering our paste server (I know because I see them in the logs and they make up quite possibly the majority of requests there).

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Liusheng (liusheng)](https://launchpad.net/~liusheng) wrote on 2015-09-02: |  |  | [#8](/keystone/%2Bbug/1490804/comments/8) |
| --- | --- | --- | --- |

sorry, my mistake, this issue is occured with PKI token.

sorry, my mistake, this issue is occured with PKI token.

| **summary**: | - Token Revocation Bypass+ PKI Token Revocation Bypass |
| --- | --- |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Liusheng (liusheng)](https://launchpad.net/~liusheng) wrote on 2015-09-02:  [**Re: PKI Token Revocation Bypass**](/keystone/%2Bbug/1490804/comments/9) |  |  | [#9](/keystone/%2Bbug/1490804/comments/9) |
| --- | --- | --- | --- |

This issue is found by my colleagues, I will dig more and provide more information, thanks for your attention.

This issue is found by my colleagues, I will dig more and provide more information, thanks for your attention.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Dolph Mathews (dolph)](https://launchpad.net/~dolph) wrote on 2015-09-02: |  |  | [#10](/keystone/%2Bbug/1490804/comments/10) |
| --- | --- | --- | --- |

I won't be able to spend much time on this until at least Sept 4th, but I suspect this is easily reproducible and I'm wondering if the fix must be to make PKI depend on revocation events like Fernet does? Or perhaps to ignore the mutable characters when querying the token table?

I won't be able to spend much time on this until at least Sept 4th, but I suspect this is easily reproducible and I'm wondering if the fix must be to make PKI depend on revocation events like Fernet does? Or perhaps to ignore the mutable characters when querying the token table?

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Dolph Mathews (dolph)](https://launchpad.net/~dolph) wrote on 2015-09-02: |  |  | [#11](/keystone/%2Bbug/1490804/comments/11) |
| --- | --- | --- | --- |

Jeremy: I did not consider crawlers / mirrors. Deleting the paste now might only draw attention to it :)

Jeremy: I did not consider crawlers / mirrors. Deleting the paste now might only draw attention to it :)

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Dolph Mathews (dolph)](https://launchpad.net/~dolph) wrote on 2015-09-02: |  |  | [#12](/keystone/%2Bbug/1490804/comments/12) |
| --- | --- | --- | --- |

Liusheng: if you need to share any other files/logs/patches related to the bug, please add them as attachments to this bug (using the "Add attachment or patch" link at the bottom of the page).

Liusheng: if you need to share any other files/logs/patches related to the bug, please add them as attachments to this bug (using the "Add attachment or patch" link at the bottom of the page).

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Liusheng (liusheng)](https://launchpad.net/~liusheng) wrote on 2015-09-02: |  |  | [#13](/keystone/%2Bbug/1490804/comments/13) |
| --- | --- | --- | --- |

Dolph: sure, I am sorry I didn't realized the test script shouldn't be pasted in paste.openstack.org.

Dolph: sure, I am sorry I didn't realized the test script shouldn't be pasted in paste.openstack.org.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Liusheng (liusheng)](https://launchpad.net/~liusheng) wrote on 2015-09-02: |  |  | [#14](/keystone/%2Bbug/1490804/comments/14) |
| --- | --- | --- | --- |

I have confirmed they guys found this issue in Juno openstack, some version info used:

keystoneclient 0.11.2

keystone 2014.2

openssl-1.0.1i-2.1.4

openssl-certs-1.97-0.3.1

I have confirmed they guys found this issue in Juno openstack, some version info used:
keystoneclient 0.11.2
keystone 2014.2
openssl-1.0.1i-2.1.4
openssl-certs-1.97-0.3.1

[Adam Young (ayoung)](https://launchpad.net/~ayoung)
on 2015-09-02

| Changed in keystone: | |
| --- | --- |
| **assignee**: | nobody → Adam Young (ayoung) |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Adam Young (ayoung)](https://launchpad.net/~ayoung) wrote on 2015-09-02: |  |  | [#15](/keystone/%2Bbug/1490804/comments/15) |
| --- | --- | --- | --- |

This should only be a problem with PKI(Z) tokens. The fix can be made here:

<http://git.openstack.org/cgit/openstack/keystone/tree/keystone/token/utils.py>

Using the logic in the blog post here: <http://adam.younglogic.com/2014/10/who-signed-that-token/> we can pull out the signed data from the token and take a hash of that; modifying the hashed data will mean the token will not longer pass the CMS validation.

This will pull in an additional dependency on pyasn1 to Keystone. We cannot avoid that by calculating the hash on the JSON data itself, as it will not (necessarily) be reproducible.

In addition, Horizon will need an update, as they currently Md5 Hash the tokens before sending them to the remote services.

Another possibility is to generate a UUID for the token ID, and stick that inside the JSON body before signing. revocation could be done on the UUID value instead of the HASH. That would involve changing both Keystone and keystonemiddleware.

another alternative it to compare the signer info in the PKIZ token with the Certificate. If they don't match, the token is invalid. I don't know if it is possible to be 100% certain that the teokn cannot be tampered with.

This should only be a problem with PKI(Z) tokens. The fix can be made here:
http://git.openstack.org/cgit/openstack/keystone/tree/keystone/token/utils.py
Using the logic in the blog post here: http://adam.younglogic.com/2014/10/who-signed-that-token/ we can pull out the signed data from the token and take a hash of that; modifying the hashed data will mean the token will not longer pass the CMS validation.
This will pull in an additional dependency on pyasn1 to Keystone. We cannot avoid that by calculating the hash on the JSON data itself, as it will not (necessarily) be reproducible.
In addition, Horizon will need an update, as they currently Md5 Hash the tokens before sending them to the remote services.
Another possibility is to generate a UUID for the token ID, and stick that inside the JSON body before signing. revocation could be done on the UUID value instead of the HASH. That would involve changing both Keystone and keystonemiddleware.
another alternative it to compare the signer info in the PKIZ token with the Certificate. If they don't match, the token is invalid. I don't know if it is possible to be 100% certain that the teokn cannot be tampered with.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Morgan Fainberg (mdrnstm)](https://launchpad.net/~mdrnstm) wrote on 2015-09-02: |  |  | [#16](/keystone/%2Bbug/1490804/comments/16) |
| --- | --- | --- | --- |

Thanks for the information. It helps us to be sure we are looking at all avenues for the problem. I can see where this is happening and have discussed with Adam and a few other folks on it and how we are approachig potential fixes.

Thanks for the information. It helps us to be sure we are looking at all avenues for the problem. I can see where this is happening and have discussed with Adam and a few other folks on it and how we are approachig potential fixes.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Adam Young (ayoung)](https://launchpad.net/~ayoung) wrote on 2015-09-02: |  |  | [#17](/keystone/%2Bbug/1490804/comments/17) |
| --- | --- | --- | --- |

* [modify\_token.py](https://bugs.launchpad.net/keystone/%2Bbug/1490804/%2Battachment/4455970/%2Bfiles/modify_token.py)
  [Edit](/keystone/%2Bbug/1490804/%2Battachment/4455970)
  (995 bytes,
  text/x-python)

The attached code shows the modification of the binary data that still generates a valid token; it can be run from

python-keystoneclient/examples/pki and usese the sample tokens and certificates in the associated subdirectories.

This shows the modified bytes that successfully pass are:

77 78 79 80 81 82 83 85 86 87 88 3979 3980 3981 3982 3983 3985 3986 3987 3988 3991 3992 4364

The range 77 78 79 80 81 82 83 85 86 87 88 looks like the object identitfier s

1 3 14 3 2 26

and

1 2 840 113549 1 7 1

The last byte is padding.

To see the content of the token in PEM format

cat cms/auth\_v3\_token\_scoped.pem | awk ' ! /---/ {print $1}'| base64 -d | /usr/lib64/nss/unsupported-tools/derdump > /tmp/tokendata

The attached code shows the modification of the binary data that still generates a valid token; it can be run from
python-keystoneclient/examples/pki and usese the sample tokens and certificates in the associated subdirectories.
This shows the modified bytes that successfully pass are:
77 78 79 80 81 82 83 85 86 87 88 3979 3980 3981 3982 3983 3985 3986 3987 3988 3991 3992 4364
The range 77 78 79 80 81 82 83 85 86 87 88 looks like the object identitfier s
1 3 14 3 2 26
and
1 2 840 113549 1 7 1
The last byte is padding.
To see the content of the token in PEM format
cat cms/auth\_v3\_token\_scoped.pem | awk ' ! /---/ {print $1}'| base64 -d | /usr/lib64/nss/unsupported-tools/derdump > /tmp/tokendata

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Adam Young (ayoung)](https://launchpad.net/~ayoung) wrote on 2015-09-02: |  |  | [#18](/keystone/%2Bbug/1490804/comments/18) |
| --- | --- | --- | --- |

* [derdump of Token data in ASN1 format](https://bugs.launchpad.net/keystone/%2Bbug/1490804/%2Battachment/4455971/%2Bfiles/tokendata)
  [Edit](/keystone/%2Bbug/1490804/%2Battachment/4455971)
  (25.1 KiB,
  text/plain)

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Dolph Mathews (dolph)](https://launchpad.net/~dolph) wrote on 2015-09-02: |  |  | [#19](/keystone/%2Bbug/1490804/comments/19) |
| --- | --- | --- | --- |

The attached test manipulates UUID, PKI, PKIz, and Fernet tokens by incrementing and decrementing individual bytes, as illustrated in the bug description. This test passes against each token type, showing that the manipulated tokens cannot be validated \*online\* against keystone. To be clear, this patch does not contain a fix, nor does it confirm or invalidate the bug report.

Unless I missed something, that means the scope of this bug is limited to validating tokens offline (against the token revocation list in keystonemiddleware.auth\_token).

The attached test manipulates UUID, PKI, PKIz, and Fernet tokens by incrementing and decrementing individual bytes, as illustrated in the bug description. This test passes against each token type, showing that the manipulated tokens cannot be validated \*online\* against keystone. To be clear, this patch does not contain a fix, nor does it confirm or invalidate the bug report.
Unless I missed something, that means the scope of this bug is limited to validating tokens offline (against the token revocation list in keystonemiddleware.auth\_token).

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Dolph Mathews (dolph)](https://launchpad.net/~dolph) wrote on 2015-09-02: |  |  | [#20](/keystone/%2Bbug/1490804/comments/20) |
| --- | --- | --- | --- |

* [bug-1490804-tests-master-v1.patch](https://bugs.launchpad.net/keystone/%2Bbug/1490804/%2Battachment/4456156/%2Bfiles/bug-1490804-tests-master-v1.patch)
  [Edit](/keystone/%2Bbug/1490804/%2Battachment/4456156)
  (4.4 KiB,
  text/plain)

Of course, it would help if I attached the patch.

Of course, it would help if I attached the patch.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Adam Young (ayoung)](https://launchpad.net/~ayoung) wrote on 2015-09-02: |  |  | [#21](/keystone/%2Bbug/1490804/comments/21) |
| --- | --- | --- | --- |

Dolph; yeah, this is only for checking the revocation list; the tokens themselves need to be valid tokens. It is restricted to PKI based tokens only. The mistake was using the hash of the whole document for the token id; it should have been the same hash of the token tdata that is used for the cryptographic signature. The values being manipulated are the ASN1 specific values that indicate "This next block is signed data" which openssl really should be validating.

For example; here is a diff of a derdump of the origianl file and the modified file, with some lines of context;

$ diff -U 10 /tmp/auth\_v3\_token\_scoped\_orig.pem.txt /tmp/auth\_v3\_token\_scoped77.pem.txt

--- /tmp/auth\_v3\_token\_scoped\_orig.pem.txt 2015-09-02 11:27:46.423313737 -0400

+++ /tmp/auth\_v3\_token\_scoped77.pem.txt 2015-09-02 11:27:46.398313755 -0400

@@ -4,21 +4,21 @@

    C-[0] (3176)

       C-Sequence (3172)

          Integer (1)

             01

          C-Set (9)

             C-Sequence (7)

                Object Identifier (5)

                   1 3 14 3 2 26 (SHA-1)

          C-Sequence (2692)

             Object Identifier (9)

- 1 2 840 113549 1 7 1 (PKCS #7 Data)

+ 0 26 840 113549 1 7 1

             C-[0] (2677)

                Octet String (2673)

                   7b 22 74 6f 6b 65 6e 22 3a 20 7b 22 6d 65 74 68 6f 64

                   73 22 3a 20 5b 22 70 61 73 73 77 6f 72 64 22 5d 2c 20

                   22 72 6f 6c 65 73 22 3a 20 5b 7b 22 69 64 22 3a 20 22

                   66 30 33 66 64 61 38 66 38 61 33 32 34 39 62 32 61 37

                   30 66 62 31 66 31 37 36 61 37 62 36 33 31 22 2c 20 22

                   6e 61 6d 65 22 3a 20 22 72 6f 6c 65 31 22 7d 2c 20 7b

                   22 69 64 22 3a 20 22 66 30 33 66 64 61 38 66 38 61 33

                   32 34 39 62 32 61 37 30 66 62 31 66 31 37 36 61 37 62

All of the places susceptible to the modifications seem to be this kind of string, with the exception of the final padding;

$ diff -u /tmp/auth\_v3\_token\_scoped\_orig.pem /tmp/auth\_v3\_token\_scoped4364.pem

--- /tmp/auth\_v3\_token\_scoped\_orig.pem 2015-09-02 11:14:11.414915072 -0400

+++ /tmp/auth\_v3\_token\_scoped4364.pem 2015-09-02 11:14:28.749902282 -0400

@@ -66,4 +66,4 @@

 4RQzkShFx97ioGPE9wE1Jv9Yzxo5uTg6z246gi42e50uSIFZMmNMqkUdz0n6Qct+

 1zMf8W+e1pykKscVBz757F9n+qAhx15LxxdCKIrQ1kNT8dAyLRBQU0qZeLmLvS3W

 nmf/JlQ7LDQmq3XQEHRbQ1s5dz/mwM8IiSm8

------END CMS-----

+-----END CMS-----

\ No newline at end of file

Dolph; yeah, this is only for checking the revocation list; the tokens themselves need to be valid tokens. It is restricted to PKI based tokens only. The mistake was using the hash of the whole document for the token id; it should have been the same hash of the token tdata that is used for the cryptographic signature. The values being manipulated are the ASN1 specific values that indicate "This next block is signed data" which openssl really should be validating.
For example; here is a diff of a derdump of the origianl file and the modified file, with some lines of context;
$ diff -U 10 /tmp/auth\_v3\_token\_scoped\_orig.pem.txt /tmp/auth\_v3\_token\_scoped77.pem.txt
--- /tmp/auth\_v3\_token\_scoped\_orig.pem.txt 2015-09-02 11:27:46.423313737 -0400
+++ /tmp/auth\_v3\_token\_scoped77.pem.txt 2015-09-02 11:27:46.398313755 -0400
@@ -4,21 +4,21 @@
C-[0] (3176)
C-Sequence (3172)
Integer (1)
01
C-Set (9)
C-Sequence (7)
Object Identifier (5)
1 3 14 3 2 26 (SHA-1)
C-Sequence (2692)
Object Identifier (9)
- 1 2 840 113549 1 7 1 (PKCS #7 Data)
+ 0 26 840 113549 1 7 1
C-[0] (2677)
Octet String (2673)
7b 22 74 6f 6b 65 6e 22 3a 20 7b 22 6d 65 74 68 6f 64
73 22 3a 20 5b 22 70 61 73 73 77 6f 72 64 22 5d 2c 20
22 72 6f 6c 65 73 22 3a 20 5b 7b 22 69 64 22 3a 20 22
66 30 33 66 64 61 38 66 38 61 33 32 34 39 62 32 61 37
30 66 62 31 66 31 37 36 61 37 62 36 33 31 22 2c 20 22
6e 61 6d 65 22 3a 20 22 72 6f 6c 65 31 22 7d 2c 20 7b
22 69 64 22 3a 20 22 66 30 33 66 64 61 38 66 38 61 33
32 34 39 62 32 61 37 30 66 62 31 66 31 37 36 61 37 62
All of the places susceptible to the modifications seem to be this kind of string, with the exception of the final padding;
$ diff -u /tmp/auth\_v3\_token\_scoped\_orig.pem /tmp/auth\_v3\_token\_scoped4364.pem
--- /tmp/auth\_v3\_token\_scoped\_orig.pem 2015-09-02 11:14:11.414915072 -0400
+++ /tmp/auth\_v3\_token\_scoped4364.pem 2015-09-02 11:14:28.749902282 -0400
@@ -66,4 +66,4 @@
4RQzkShFx97ioGPE9wE1Jv9Yzxo5uTg6z246gi42e50uSIFZMmNMqkUdz0n6Qct+
1zMf8W+e1pykKscVBz757F9n+qAhx15LxxdCKIrQ1kNT8dAyLRBQU0qZeLmLvS3W
nmf/JlQ7LDQmq3XQEHRbQ1s5dz/mwM8IiSm8
------END CMS-----
+-----END CMS-----
\ No newline at end of file

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Morgan Fainberg (mdrnstm)](https://launchpad.net/~mdrnstm) wrote on 2015-09-02: |  |  | [#22](/keystone/%2Bbug/1490804/comments/22) |
| --- | --- | --- | --- |

@dolph,

Yes this would be limited to an auth\_token middleware issue. We should retarget the bug.

@dolph,
Yes this would be limited to an auth\_token middleware issue. We should retarget the bug.

| Changed in keystonemiddleware: | |
| --- | --- |
| **status**: | New → Confirmed |
| **status**: | Confirmed → New |
| **importance**: | Undecided → Critical |
| **importance**: | Critical → High |
| **assignee**: | nobody → Adam Young (ayoung) |
| Changed in keystone: | |
| **status**: | New → Invalid |
| **assignee**: | Adam Young (ayoung) → nobody |
| **status**: | Invalid → New |
| **assignee**: | nobody → Adam Young (ayoung) |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Morgan Fainberg (mdrnstm)](https://launchpad.net/~mdrnstm) wrote on 2015-09-02: |  |  | [#23](/keystone/%2Bbug/1490804/comments/23) |
| --- | --- | --- | --- |

Added keystonemiddleware as there are likely changes needed to KSM as well

Added keystonemiddleware as there are likely changes needed to KSM as well

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Dolph Mathews (dolph)](https://launchpad.net/~dolph) wrote on 2015-09-03: |  |  | [#24](/keystone/%2Bbug/1490804/comments/24) |
| --- | --- | --- | --- |

The fix could impact the contents of the token revocation list itself, though (in keystone).

The fix could impact the contents of the token revocation list itself, though (in keystone).

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Dolph Mathews (dolph)](https://launchpad.net/~dolph) wrote on 2015-09-03: |  |  | [#25](/keystone/%2Bbug/1490804/comments/25) |
| --- | --- | --- | --- |

(read comment #22 & #23 before I saw the new bug status - it seems you already agree!)

(read comment #22 & #23 before I saw the new bug status - it seems you already agree!)

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Adam Young (ayoung)](https://launchpad.net/~ayoung) wrote on 2015-09-03: |  |  | [#26](/keystone/%2Bbug/1490804/comments/26) |
| --- | --- | --- | --- |

* [0001-Reject-modified-PKI-Tokens.patch](https://bugs.launchpad.net/keystone/%2Bbug/1490804/%2Battachment/4456676/%2Bfiles/0001-Reject-modified-PKI-Tokens.patch)
  [Edit](/keystone/%2Bbug/1490804/%2Battachment/4456676)
  (6.1 KiB,
  text/plain)

The following patch detects modifications of the Token.

I am not certain, however, that this is exhaustive; there might be ways to modify the document such that it is still valid, but has a different hash.

We can lock down what is accepted as a token format: additional checks could confirm that the certs are stripped (adding them will still fail validation anyways) or any other cosmetic changes that could change the document.

We might be able to get away with a stop gap like this, and then migrate people to Fernet or change how PKI tokens are hashed.

The following patch detects modifications of the Token.
I am not certain, however, that this is exhaustive; there might be ways to modify the document such that it is still valid, but has a different hash.
We can lock down what is accepted as a token format: additional checks could confirm that the certs are stripped (adding them will still fail validation anyways) or any other cosmetic changes that could change the document.
We might be able to get away with a stop gap like this, and then migrate people to Fernet or change how PKI tokens are hashed.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Morgan Fainberg (mdrnstm)](https://launchpad.net/~mdrnstm) wrote on 2015-09-03: |  |  | [#27](/keystone/%2Bbug/1490804/comments/27) |
| --- | --- | --- | --- |

A few issues that came up in discussion earlier tonight:

\* What happens if someone respins a token from PKI to PKIZ or vice-versa?

\* PKI the delimiter (---- START CMS ---- and corresponding end ones) could be pre/post substituted in PKI (not PKIZ) and change the resulting ID but still pass due to the token\_to\_cms (or cms\_to\_token) code doing a blind substitution between '/' and '-'.

One of the other options could be to provide an options for KeystoneMiddleware to disable offline validations (default to off) and have it hash the tokens the same way django\_openstack\_auth would (which is not affected by this issue).

I'm looking over the code in the Reject-modified-PKI-Tokens.patch and it is a partial solution, but I have not spent enough time poking at the code to be sure what other gaps are there in PKI(Z) validation.

A few issues that came up in discussion earlier tonight:
\* What happens if someone respins a token from PKI to PKIZ or vice-versa?
\* PKI the delimiter (---- START CMS ---- and corresponding end ones) could be pre/post substituted in PKI (not PKIZ) and change the resulting ID but still pass due to the token\_to\_cms (or cms\_to\_token) code doing a blind substitution between '/' and '-'.
One of the other options could be to provide an options for KeystoneMiddleware to disable offline validations (default to off) and have it hash the tokens the same way django\_openstack\_auth would (which is not affected by this issue).
I'm looking over the code in the Reject-modified-PKI-Tokens.patch and it is a partial solution, but I have not spent enough time poking at the code to be sure what other gaps are there in PKI(Z) validation.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Adam Young (ayoung)](https://launchpad.net/~ayoung) wrote on 2015-09-03: |  |  | [#28](/keystone/%2Bbug/1490804/comments/28) |
| --- | --- | --- | --- |

* [0001-hash-the-data-in-the-token.patch](https://bugs.launchpad.net/keystone/%2Bbug/1490804/%2Battachment/4456711/%2Bfiles/0001-hash-the-data-in-the-token.patch)
  [Edit](/keystone/%2Bbug/1490804/%2Battachment/4456711)
  (2.7 KiB,
  text/plain)

This patch is probably the apparoach we need to take; it changes the logic of generating a token\_id from hashing the whole body of the token to hashing the data, same way that the signing algorithm does.

The patch will not yet pass unit tests.

Django OpenStack Auth needs to be modified to call this function in keystoneclient instead of doing their own hashing.

This patch is probably the apparoach we need to take; it changes the logic of generating a token\_id from hashing the whole body of the token to hashing the data, same way that the signing algorithm does.
The patch will not yet pass unit tests.
Django OpenStack Auth needs to be modified to call this function in keystoneclient instead of doing their own hashing.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Morgan Fainberg (mdrnstm)](https://launchpad.net/~mdrnstm) wrote on 2015-09-03: |  |  | [#29](/keystone/%2Bbug/1490804/comments/29) |
| --- | --- | --- | --- |

I am going to be -1 on changing DOA and changing how we hash immediately as this will break anyone who does not use the libraries (aka any language but python).

Lets aim for a fix that doesn't break absolutely everyone.

DOA is not impacted by this as it forces live validation.

Let's not change DOA and only change how middleware interacts in a non-live validated token workflow for Liberty (preferably something back-portable).

I am going to be -1 on changing DOA and changing how we hash immediately as this will break anyone who does not use the libraries (aka any language but python).
Lets aim for a fix that doesn't break absolutely everyone.
DOA is not impacted by this as it forces live validation.
Let's not change DOA and only change how middleware interacts in a non-live validated token workflow for Liberty (preferably something back-portable).

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Adam Young (ayoung)](https://launchpad.net/~ayoung) wrote on 2015-09-03: |  |  | [#30](/keystone/%2Bbug/1490804/comments/30) |
| --- | --- | --- | --- |

The DOA fix is trivial. It should go in anyway.

This is the lowest impact change. It won't break anyone unless they are doing the undocumented Hash hack. The number of people that are doing that should be vnishingly small, and they should update was well, too, for the same reason.

We can post code samples in Ruby and Java for how to do the hash.

The DOA fix is trivial. It should go in anyway.
This is the lowest impact change. It won't break anyone unless they are doing the undocumented Hash hack. The number of people that are doing that should be vnishingly small, and they should update was well, too, for the same reason.
We can post code samples in Ruby and Java for how to do the hash.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Adam Young (ayoung)](https://launchpad.net/~ayoung) wrote on 2015-09-03: |  |  | [#31](/keystone/%2Bbug/1490804/comments/31) |
| --- | --- | --- | --- |

* [0001-Use-the-Keystoneclient-code-to-hash-the-token.patch](https://bugs.launchpad.net/keystone/%2Bbug/1490804/%2Battachment/4456923/%2Bfiles/0001-Use-the-Keystoneclient-code-to-hash-the-token.patch)
  [Edit](/keystone/%2Bbug/1490804/%2Battachment/4456923)
  (1.7 KiB,
  text/plain)

This is the DOA change, and it can and should be applied regardless. I think it is safe to post as a review publicly.

This is the DOA change, and it can and should be applied regardless. I think it is safe to post as a review publicly.

| Changed in python-keystoneclient: | |
| --- | --- |
| **assignee**: | nobody → Adam Young (ayoung) |

[Adam Young (ayoung)](https://launchpad.net/~ayoung)
on 2015-09-04

| Changed in django-openstack-auth: | |
| --- | --- |
| **assignee**: | nobody → Adam Young (ayoung) |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Adam Young (ayoung)](https://launchpad.net/~ayoung) wrote on 2015-09-10: |  |  | [#32](/keystone/%2Bbug/1490804/comments/32) |
| --- | --- | --- | --- |

Is there any direction on this one? Online validation is going to break people doing distributed signing, which is the reason to use PKI tokens. Any fix here has the potential to fix someone. Changing the hash approach is, I suspect, going to have the least impact.

Is there any direction on this one? Online validation is going to break people doing distributed signing, which is the reason to use PKI tokens. Any fix here has the potential to fix someone. Changing the hash approach is, I suspect, going to have the least impact.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Adam Young (ayoung)](https://launchpad.net/~ayoung) wrote on 2015-09-10: |  |  | [#33](/keystone/%2Bbug/1490804/comments/33) |
| --- | --- | --- | --- |

Note that always going to online validation would preclude the use of memcache for tokens.

Note that always going to online validation would preclude the use of memcache for tokens.

[Morgan Fainberg (mdrnstm)](https://launchpad.net/~mdrnstm)
on 2015-09-10

| Changed in django-openstack-auth: | |
| --- | --- |
| **status**: | New → Invalid |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Morgan Fainberg (mdrnstm)](https://launchpad.net/~mdrnstm) wrote on 2015-09-10: |  |  | [#34](/keystone/%2Bbug/1490804/comments/34) |
| --- | --- | --- | --- |

I repeat the previous statement: Changing the hash mechanism will break everyone. DOA is absolutely not affected here.

DOA forces online validation because it hashes the PKI(z) tokens to the SHA form. If a token is already hashed, it will only rely on the online validation which requires matching the key in the database.

The solution for the time being is going to be addressing how middleware validates the token offline via SSL. Options I see are:

\* Done via audit\_ids with new forms of middleware if we make audit\_ids available as a form of the TRL.

\* Option to only online-validate PKI(Z) tokens.

\* Offer a different hash-form TRL (not just audit-id) for new versions of middleware

\* Deprecate PKI(Z) tokens [not a good idea]

\* Issue OSSA and indicate this is not something we can/will fix with the PKI tokens (and deprecate) [not a great idea]

I would prefer to see an online-only validation option with an OSSA as the immediate (and potentially backportable) fix. Discussion on changing hashes etc can be delayed until the summit and done in the open - not under embargo. For the embargo'd bug, I really want to see this not be a breaking change.

Breaking memcache for validated tokens [optionally] where the deployer is aware of the issues (due to OSSA being issued) is fine.

I repeat the previous statement: Changing the hash mechanism will break everyone. DOA is absolutely not affected here.
DOA forces online validation because it hashes the PKI(z) tokens to the SHA form. If a token is already hashed, it will only rely on the online validation which requires matching the key in the database.
The solution for the time being is going to be addressing how middleware validates the token offline via SSL. Options I see are:
\* Done via audit\_ids with new forms of middleware if we make audit\_ids available as a form of the TRL.
\* Option to only online-validate PKI(Z) tokens.
\* Offer a different hash-form TRL (not just audit-id) for new versions of middleware
\* Deprecate PKI(Z) tokens [not a good idea]
\* Issue OSSA and indicate this is not something we can/will fix with the PKI tokens (and deprecate) [not a great idea]
I would prefer to see an online-only validation option with an OSSA as the immediate (and potentially backportable) fix. Discussion on changing hashes etc can be delayed until the summit and done in the open - not under embargo. For the embargo'd bug, I really want to see this not be a breaking change.
Breaking memcache for validated tokens [optionally] where the deployer is aware of the issues (due to OSSA being issued) is fine.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Robert Clark (robert-clark)](https://launchpad.net/~robert-clark) wrote on 2015-09-10: |  |  | [#35](/keystone/%2Bbug/1490804/comments/35) |
| --- | --- | --- | --- |

Ouch, I'd love to do a security blogpost on this once it's announced, a full root cause analysis.

I'm not close-enough to Keystone to understand the full impact of all the the mitigation options however it's clear that this is a pretty severe issue.

I know the numbers are hard to quantify but "thumb in the air" - what percentage of deployments use PKI tokens?

-Rob

Ouch, I'd love to do a security blogpost on this once it's announced, a full root cause analysis.
I'm not close-enough to Keystone to understand the full impact of all the the mitigation options however it's clear that this is a pretty severe issue.
I know the numbers are hard to quantify but "thumb in the air" - what percentage of deployments use PKI tokens?
-Rob

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Morgan Fainberg (mdrnstm)](https://launchpad.net/~mdrnstm) wrote on 2015-09-10: |  |  | [#36](/keystone/%2Bbug/1490804/comments/36) |
| --- | --- | --- | --- |

@Robert,

It's enough to be a serious consideration (in the <50% but more than 15% is my guess; but this is just hazarding a guess). However we are now seeing a move towards Fernet tokens from the orgs that have been using PKI.

Some of the largest deployments are PKI token based.

@Robert,
It's enough to be a serious consideration (in the <50% but more than 15% is my guess; but this is just hazarding a guess). However we are now seeing a move towards Fernet tokens from the orgs that have been using PKI.
Some of the largest deployments are PKI token based.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Travis McPeak (travis-mcpeak)](https://launchpad.net/~travis-mcpeak) wrote on 2015-09-11: |  |  | [#37](/keystone/%2Bbug/1490804/comments/37) |
| --- | --- | --- | --- |

This also seems like a prime target for a security note (OSSN). Basically we'll say something along the lines of "PKI(Z) tokens without online validation shouldn't be considered safe for certain versions" (if I understand this correctly).

This will enable cloud deployers to better understand the documented risks they are accepting.

This also seems like a prime target for a security note (OSSN). Basically we'll say something along the lines of "PKI(Z) tokens without online validation shouldn't be considered safe for certain versions" (if I understand this correctly).
This will enable cloud deployers to better understand the documented risks they are accepting.

[Adam Young (ayoung)](https://launchpad.net/~ayoung)
on 2015-09-11

| Changed in keystone: | |
| --- | --- |
| **status**: | New → Confirmed |
| **status**: | Confirmed → Triaged |
| Changed in keystonemiddleware: | |
| **status**: | New → Triaged |
| Changed in python-keystoneclient: | |
| **status**: | New → Triaged |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Adam Young (ayoung)](https://launchpad.net/~ayoung) wrote on 2015-09-11: |  |  | [#38](/keystone/%2Bbug/1490804/comments/38) |
| --- | --- | --- | --- |

Root cause is the assumption that any tampering with the PKI token would invalidate the token. There are three major fields in the token that are resistant:

1. The message. Any change to the message will be detected due to it not matching the signature.

2. The signature. Any change to the signature and the message will no longer match its signature.

3. The singning info. This checked against the X509 signing cert byte-by-byte. Any change and it won't match.

What I found in testing is that there are other fields that X509 ignores but should not. These include 0 length fields that are place holders for things like the stripped out Certificates.

The other attack now possible is due to there being 2 different PKI token versions. A PKI token could be converted to a PKIZ token, and the signature is still valid. That was not the case when the hashing approach was chosen.

The most common reason for token revocations is logout from the WebUI.

The impact is probably small but consequential; it only affects revoked tokens in the CLI cases. In the webUI case, the tokens are never stored in full except inside the token database. Instead, the WebUI hashes them, and discards the CMS document. Since this is the primary cause of revocations, these tokens are not at risk.

The second most common is password changes. Since these are performed by the end users themselves, the risk here is slight, but not 0.

The most worry some are token revocations for users leaving a project or being disabled altogether. In order for this attack to be viable, the user must have had a valid token prior to the event, and then they could re-enable the token. Since token timeout is a variable, we can;t make any assumptions. We turned the default down to 1 hour, but many sites found this was too short for workflows, and set the value back to 12 hours.

Root cause is the assumption that any tampering with the PKI token would invalidate the token. There are three major fields in the token that are resistant:
1. The message. Any change to the message will be detected due to it not matching the signature.
2. The signature. Any change to the signature and the message will no longer match its signature.
3. The singning info. This checked against the X509 signing cert byte-by-byte. Any change and it won't match.
What I found in testing is that there are other fields that X509 ignores but should not. These include 0 length fields that are place holders for things like the stripped out Certificates.
The other attack now possible is due to there being 2 different PKI token versions. A PKI token could be converted to a PKIZ token, and the signature is still valid. That was not the case when the hashing approach was chosen.
The most common reason for token revocations is logout from the WebUI.
The impact is probably small but consequential; it only affects revoked tokens in the CLI cases. In the webUI case, the tokens are never stored in full except inside the token database. Instead, the WebUI hashes them, and discards the CMS document. Since this is the primary cause of revocations, these tokens are not at risk.
The second most common is password changes. Since these are performed by the end users themselves, the risk here is slight, but not 0.
The most worry some are token revocations for users leaving a project or being disabled altogether. In order for this attack to be viable, the user must have had a valid token prior to the event, and then they could re-enable the token. Since token timeout is a variable, we can;t make any assumptions. We turned the default down to 1 hour, but many sites found this was too short for workflows, and set the value back to 12 hours.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Liusheng (liusheng)](https://launchpad.net/~liusheng) wrote on 2015-09-21: |  |  | [#39](/keystone/%2Bbug/1490804/comments/39) |
| --- | --- | --- | --- |

* [bug1490804-patch-test-traceback.txt](https://bugs.launchpad.net/keystone/%2Bbug/1490804/%2Battachment/4469888/%2Bfiles/bug1490804-patch-test-traceback.txt)
  [Edit](/keystone/%2Bbug/1490804/%2Battachment/4469888)
  (7.6 KiB,
  text/plain)

Hi Adam Young,

My colleague has applied your patch with Juno version keystone, the original problem is successfully solved, however some random errors occur when issuing both v2 and v3 token, the tracebacks are as below.

Seems the errors are introduced by the patch, and we didn't found the root cause. traceback info please see the attachment could you please take a look ?

Keystone is running on apache with worker mode.

Version of pyasn1 packages are:

python-pyasn1-modules-0.0.7-33.2

python-pyasn1-0.1.2-0.5.1

OS is Suse SLE11 SP3

Hi Adam Young,
My colleague has applied your patch with Juno version keystone, the original problem is successfully solved, however some random errors occur when issuing both v2 and v3 token, the tracebacks are as below.
Seems the errors are introduced by the patch, and we didn't found the root cause. traceback info please see the attachment could you please take a look ?
Keystone is running on apache with worker mode.
Version of pyasn1 packages are:
python-pyasn1-modules-0.0.7-33.2
python-pyasn1-0.1.2-0.5.1
OS is Suse SLE11 SP3

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2015-09-21: |  |  | [#40](/keystone/%2Bbug/1490804/comments/40) |
| --- | --- | --- | --- |

Since this seems related to a bad design in PKI(z) token for which the fix isn't easily backportable, I suggest a B type of bug.

Also, since this requires a fair amount of social engineering to abuse this bug, is there a good reason to keep this under embargo ?

Since this seems related to a bad design in PKI(z) token for which the fix isn't easily backportable, I suggest a B type of bug.
Also, since this requires a fair amount of social engineering to abuse this bug, is there a good reason to keep this under embargo ?

[Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray)
on 2015-11-02

| Changed in ossn: | |
| --- | --- |
| **importance**: | Undecided → Critical |

[Nathan Kinder (nkinder)](https://launchpad.net/~nkinder)
on 2015-11-12

| Changed in ossn: | |
| --- | --- |
| **assignee**: | nobody → Nathan Kinder (nkinder) |

[Adam Young (ayoung)](https://launchpad.net/~ayoung)
on 2015-11-19

| Changed in keystone: | |
| --- | --- |
| **status**: | Triaged → Won't Fix |
| Changed in keystonemiddleware: | |
| **status**: | Triaged → Won't Fix |
| Changed in python-keystoneclient: | |
| **status**: | Triaged → Won't Fix |

| 22 comments hidden Loading more comments | [view all 102 comments](?comments=all) |
| --- | --- |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2015-12-02: |  |  | [#63](/keystone/%2Bbug/1490804/comments/63) |
| --- | --- | --- | --- |

Considering this bug exploitation requires administrator action (e.g., to issue token revocation), I would prefer this bug report to be public. Operator could use this information to enforce a more strict revocation process while the fix is being implemented.

What is the status of the OSSN ?

How about we open the bug at the same time we issue the security note, then we could review the proposed patch on gerrit and we'll eventually issue an OSSA if the solution is safely backportable ?

Considering this bug exploitation requires administrator action (e.g., to issue token revocation), I would prefer this bug report to be public. Operator could use this information to enforce a more strict revocation process while the fix is being implemented.
What is the status of the OSSN ?
How about we open the bug at the same time we issue the security note, then we could review the proposed patch on gerrit and we'll eventually issue an OSSA if the solution is safely backportable ?

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Brant Knudson (blk-u)](https://launchpad.net/~blk-u) wrote on 2015-12-02: |  |  | [#64](/keystone/%2Bbug/1490804/comments/64) |
| --- | --- | --- | --- |

The exploit doesn't require admin action. Tokens can be revoked by the user, or they can be revoked by the user changing their password. Tokens can also be made invalid by admins taking away the user's roles.

The exploit doesn't require admin action. Tokens can be revoked by the user, or they can be revoked by the user changing their password. Tokens can also be made invalid by admins taking away the user's roles.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2015-12-02: |  |  | [#65](/keystone/%2Bbug/1490804/comments/65) |
| --- | --- | --- | --- |

Brant, the only scenario I considered is when a malicious user is able to keep access after an operator revoked his token or took away his roles. iiuc the exploit you described requires valid token, what can the user do with tokens he invalidated himself ?

Brant, the only scenario I considered is when a malicious user is able to keep access after an operator revoked his token or took away his roles. iiuc the exploit you described requires valid token, what can the user do with tokens he invalidated himself ?

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Brant Knudson (blk-u)](https://launchpad.net/~blk-u) wrote on 2015-12-02: |  |  | [#66](/keystone/%2Bbug/1490804/comments/66) |
| --- | --- | --- | --- |

Tristan - The only thing I can think of is the user revokes their own tokens because they're concerned that it's been exposed. So they think they're stopping the 3rd party from using their token but the 3rd party can still use the token by modifying it slightly (until the token expires).

Yes, the typical concern would be an admin thinks the user's old tokens are revoked but they're still usable until they expire.

Tristan - The only thing I can think of is the user revokes their own tokens because they're concerned that it's been exposed. So they think they're stopping the 3rd party from using their token but the 3rd party can still use the token by modifying it slightly (until the token expires).
Yes, the typical concern would be an admin thinks the user's old tokens are revoked but they're still usable until they expire.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Nathan Kinder (nkinder)](https://launchpad.net/~nkinder) wrote on 2015-12-02: |  |  | [#67](/keystone/%2Bbug/1490804/comments/67) |
| --- | --- | --- | --- |

Tristan - I have the OSSN draft written up, which has been reviewed by a few people from the Security team as well as by Adam Young. If we are also going to provide a fix, I will need to reword a few things in the "recommendations" section. Here is the current draft of the OSSN:

-----

Potential reuse of revoked Identity tokens

---

### Summary ###

An authorization token issued by the Identity service can be revoked,

which is designed to immediately make that token invalid for future use.

When the PKI or PKIZ token formats are used, it is possible for an

attacker to manipulate the token contents of a revoked token such that

the token will still be considered to be valid. This can allow

unauthorized access to cloud resources if a revoked token is intercepted

by an attacker.

### Affected Services / Software ###

Keystone, Icehouse, Juno, Kilo, Liberty

### Discussion ###

Token revocation is used in OpenStack to invalidate a token for further

use. This token revocation takes place automatically in certain

situations, such as when a user logs out of the Dashboard. If a revoked

token is obtained by another party, it should no longer be possible to

use it to perform any actions within the cloud. Unfortuantely, this is

not the case when the PKI or PKIZ token format is used.

When a PKI or PKIZ token is validated, the Identity service checks it

by searching for a revocation by the entire token. It is possible for

an attacker to manipulate portions of an intercepted PKI or PKIZ token

that are not cryptographically protected, which will cause the

revocation check to improperly consider the token to be valid.

### Recommended Actions ###

We recommend that you do not use the PKI or PKIZ token formats. Due to

the way that these formats were designed, it is not possible to fix this

issue in a way that is backwards compatible. The PKI and PKIZ token

formats do not offer any significant benefit over other token formats

such as the UUID or Fernet formats.

If you are using the PKI or PKIZ token format, it is recommended that

you switch to using another supported token format such as the UUID

format. There are no plans to fix this issue in the PKI and PKIZ token

providers in the Identity service.

To check what token provider you are using, you must look in the

'keystone.conf' file for your Identity service. An example is provided

below:

---- begin keystone.conf sample snippet ----

[token]

#provider = keystone.token.providers.pki.Provider

#provider = keystone.token.providers.pkiz.Provider

provider = keystone.token.providers.uuid.Provider

---- end keystone.conf sample snippet ----

This configuration snippet is using the UUID token format. If you are

using either of the commented out settings from this example, your cloud

is vulnerable to this issue and you should switch to a different token

provider.

### Contacts / References ###

This OSSN : <https://wiki.openstack.org/wiki/OSSN/OSSN-0061>

Original LaunchPad Bug : [https://bugs.launchpad.net/keystone/+bug/1490804](https://bugs.launchpad.net/keystone/%2Bbug/1490804)

OpenStack Security ML : <email address hidden>

OpenStack Security Group : <https://launchpad.net/~openstack-ossg>

Tristan - I have the OSSN draft written up, which has been reviewed by a few people from the Security team as well as by Adam Young. If we are also going to provide a fix, I will need to reword a few things in the "recommendations" section. Here is the current draft of the OSSN:
-----
Potential reuse of revoked Identity tokens
---
### Summary ###
An authorization token issued by the Identity service can be revoked,
which is designed to immediately make that token invalid for future use.
When the PKI or PKIZ token formats are used, it is possible for an
attacker to manipulate the token contents of a revoked token such that
the token will still be considered to be valid. This can allow
unauthorized access to cloud resources if a revoked token is intercepted
by an attacker.
### Affected Services / Software ###
Keystone, Icehouse, Juno, Kilo, Liberty
### Discussion ###
Token revocation is used in OpenStack to invalidate a token for further
use. This token revocation takes place automatically in certain
situations, such as when a user logs out of the Dashboard. If a revoked
token is obtained by another party, it should no longer be possible to
use it to perform any actions within the cloud. Unfortuantely, this is
not the case when the PKI or PKIZ token format is used.
When a PKI or PKIZ token is validated, the Identity service checks it
by searching for a revocation by the entire token. It is possible for
an attacker to manipulate portions of an intercepted PKI or PKIZ token
that are not cryptographically protected, which will cause the
revocation check to improperly consider the token to be valid.
### Recommended Actions ###
We recommend that you do not use the PKI or PKIZ token formats. Due to
the way that these formats were designed, it is not possible to fix this
issue in a way that is backwards compatible. The PKI and PKIZ token
formats do not offer any significant benefit over other token formats
such as the UUID or Fernet formats.
If you are using the PKI or PKIZ token format, it is recommended that
you switch to using another supported token format such as the UUID
format. There are no plans to fix this issue in the PKI and PKIZ token
providers in the Identity service.
To check what token provider you are using, you must look in the
'keystone.conf' file for your Identity service. An example is provided
below:
---- begin keystone.conf sample snippet ----
[token]
#provider = keystone.token.providers.pki.Provider
#provider = keystone.token.providers.pkiz.Provider
provider = keystone.token.providers.uuid.Provider
---- end keystone.conf sample snippet ----
This configuration snippet is using the UUID token format. If you are
using either of the commented out settings from this example, your cloud
is vulnerable to this issue and you should switch to a different token
provider.
### Contacts / References ###
This OSSN : https://wiki.openstack.org/wiki/OSSN/OSSN-0061
Original LaunchPad Bug : https://bugs.launchpad.net/keystone/+bug/1490804
OpenStack Security ML : openstack-security@lists.openstack.org
OpenStack Security Group : https://launchpad.net/~openstack-ossg

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2015-12-02: |  |  | [#68](/keystone/%2Bbug/1490804/comments/68) |
| --- | --- | --- | --- |

Thanks, so we could remove the first chapter of "Recommended Actions" and send this OSSN as an advance notification. We'll then open the bug and review Brant's patch on gerrit. Thought ?

Thanks, so we could remove the first chapter of "Recommended Actions" and send this OSSN as an advance notification. We'll then open the bug and review Brant's patch on gerrit. Thought ?

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Jeremy Stanley (fungi)](https://launchpad.net/~fungi) wrote on 2015-12-03: |  |  | [#69](/keystone/%2Bbug/1490804/comments/69) |
| --- | --- | --- | --- |

It seems reasonable to go forward with the OSSN worded to assume there is no fix forthcoming. Then once there's an actual fix merged to stable branches we can follow up with an OSSA (though worth keeping in mind the proposed backport, as far as I understand, only solves the problem for tokens revoked after the patch gets applied, not any which predate its application).

It seems reasonable to go forward with the OSSN worded to assume there is no fix forthcoming. Then once there's an actual fix merged to stable branches we can follow up with an OSSA (though worth keeping in mind the proposed backport, as far as I understand, only solves the problem for tokens revoked after the patch gets applied, not any which predate its application).

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Nathan Kinder (nkinder)](https://launchpad.net/~nkinder) wrote on 2015-12-03: |  |  | [#70](/keystone/%2Bbug/1490804/comments/70) |
| --- | --- | --- | --- |

Jeremy - Agreed. Are we ready to make this issue public then? Is everyone OK with the OSSN draft I provided in my previous comment?

As soon as we make it public, I can propose the OSSN review and fast-track it's merge and get it published.

Jeremy - Agreed. Are we ready to make this issue public then? Is everyone OK with the OSSN draft I provided in my previous comment?
As soon as we make it public, I can propose the OSSN review and fast-track it's merge and get it published.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Brant Knudson (blk-u)](https://launchpad.net/~blk-u) wrote on 2015-12-03: |  |  | [#71](/keystone/%2Bbug/1490804/comments/71) |
| --- | --- | --- | --- |

Jeremy - Once the change is applied to keystone then the revocation list will include the audit IDs. The audit IDs are already in the token table so that will be available. As such, the fix will work for old tokens.

Comments on the proposed OSSN

1) change "token formats" to "token providers"

2) In the sample config, since keystone has support for using entrypoints for the provider, the examples should also have:

#provider = pki

 #provider = pkiz

This was introduced in liberty so earlier releases need to use keystone.token.providers.uuid.Provider whereas liberty and later should use uuid or fernet

Jeremy - Once the change is applied to keystone then the revocation list will include the audit IDs. The audit IDs are already in the token table so that will be available. As such, the fix will work for old tokens.
Comments on the proposed OSSN
1) change "token formats" to "token providers"
2) In the sample config, since keystone has support for using entrypoints for the provider, the examples should also have:
#provider = pki
#provider = pkiz
This was introduced in liberty so earlier releases need to use keystone.token.providers.uuid.Provider whereas liberty and later should use uuid or fernet

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Jeremy Stanley (fungi)](https://launchpad.net/~fungi) wrote on 2015-12-03: |  |  | [#72](/keystone/%2Bbug/1490804/comments/72) |
| --- | --- | --- | --- |

Brant: Excellent! That's better than I had hoped (was assuming only the full document hash was being stored for earlier tokens). So this really would, in theory, be a complete fix for stable branch consumers. With that in mind, I agree it makes sense to slightly lighten the bit of the OSSN about no possibility of a backward compatible fix. Still shouldn't imply that there is definitely one coming in case something unforeseen happens in review, but getting awareness of the bug and mitigation recommendations out to deployers/operators in the near term is still a good idea.

Brant: Excellent! That's better than I had hoped (was assuming only the full document hash was being stored for earlier tokens). So this really would, in theory, be a complete fix for stable branch consumers. With that in mind, I agree it makes sense to slightly lighten the bit of the OSSN about no possibility of a backward compatible fix. Still shouldn't imply that there is definitely one coming in case something unforeseen happens in review, but getting awareness of the bug and mitigation recommendations out to deployers/operators in the near term is still a good idea.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Nathan Kinder (nkinder)](https://launchpad.net/~nkinder) wrote on 2015-12-09: |  |  | [#73](/keystone/%2Bbug/1490804/comments/73) |
| --- | --- | --- | --- |

[Download full text](https://bugs.launchpad.net/keystone/%2Bbug/1490804/comments/73/%2Bdownload) (3.3 KiB)

Here is a new draft of the OSSN that contains the suggestions made by Brant as well the suggestion made by Jeremy with regards to there being a possibility of a future fix. If this looks good to everyone, I think we can move forward with publishing and opening this bug up.

----------

Potential reuse of revoked Identity tokens

---

### Summary ###

An authorization token issued by the Identity service can be revoked,

which is designed to immediately make that token invalid for future use.

When the PKI or PKIZ token providers are used, it is possible for an

attacker to manipulate the token contents of a revoked token such that

the token will still be considered to be valid. This can allow

unauthorized access to cloud resources if a revoked token is intercepted

by an attacker.

### Affected Services / Software ###

Keystone, Icehouse, Juno, Kilo, Liberty

### Discussion ###

Token revocation is used in OpenStack to invalidate a token for further

use. This token revocation takes place automatically in certain

situations, such as when a user logs out of the Dashboard. If a revoked

token is obtained by another party, it should no longer be possible to

use it to perform any actions within the cloud. Unfortunately, this is

not the case when the PKI or PKIZ token providers are used.

When a PKI or PKIZ token is validated, the Identity service checks it

by searching for a revocation by the entire token. It is possible for

an attacker to manipulate portions of an intercepted PKI or PKIZ token

that are not cryptographically protected, which will cause the

revocation check to improperly consider the token to be valid.

### Recommended Actions ###

We recommend that you do not use the PKI or PKIZ token providers. The

PKI and PKIZ token providers do not offer any significant benefit over

other token providers such as the UUID or Fernet.

If you are using the PKI or PKIZ token providers, it is recommended that

you switch to using another supported token provider such as the UUID

provider. This issue might be fixed in a future update of the PKI and

PKIZ token providers in the Identity service.

To check what token provider you are using, you must look in the

'keystone.conf' file for your Identity service. An example is provided

below:

---- begin keystone.conf sample snippet ----

[token]

#provider = keystone.token.providers.pki.Provider

#provider = keystone.token.providers.pkiz.Provider

provider = keystone.token.providers.uuid.Provider

---- end keystone.conf sample snippet ----

In the Liberty release of the Identity service, the token provider

configuration is different than previous OpenStack releases. An

example from the Libery release is provided below:

---- begin keystone.conf sample snippet ----

[token]

#provider = pki

#provider = pkiz

provider = uuid

---- end keystone.conf sample snippet ----

These configuration snippets are using the UUID token provider. If you

are using any of the commented out settings from these examples, your

cloud is vulnerable to this issue and you should switch to a different

token provider.

### Contacts / References ###

This OSSN : <https://wiki.openstack.org/wiki/OSSN/OSSN-0061>

Original LaunchPad Bug : <https://bugs>...

[Read more...](/keystone/%2Bbug/1490804/comments/73)

Here is a new draft of the OSSN that contains the suggestions made by Brant as well the suggestion made by Jeremy with regards to there being a possibility of a future fix. If this looks good to everyone, I think we can move forward with publishing and opening this bug up.
----------
Potential reuse of revoked Identity tokens
---
### Summary ###
An authorization token issued by the Identity service can be revoked,
which is designed to immediately make that token invalid for future use.
When the PKI or PKIZ token providers are used, it is possible for an
attacker to manipulate the token contents of a revoked token such that
the token will still be considered to be valid. This can allow
unauthorized access to cloud resources if a revoked token is intercepted
by an attacker.
### Affected Services / Software ###
Keystone, Icehouse, Juno, Kilo, Liberty
### Discussion ###
Token revocation is used in OpenStack to invalidate a token for further
use. This token revocation takes place automatically in certain
situations, such as when a user logs out of the Dashboard. If a revoked
token is obtained by another party, it should no longer be possible to
use it to perform any actions within the cloud. Unfortunately, this is
not the case when the PKI or PKIZ token providers are used.
When a PKI or PKIZ token is validated, the Identity service checks it
by searching for a revocation by the entire token. It is possible for
an attacker to manipulate portions of an intercepted PKI or PKIZ token
that are not cryptographically protected, which will cause the
revocation check to improperly consider the token to be valid.
### Recommended Actions ###
We recommend that you do not use the PKI or PKIZ token providers. The
PKI and PKIZ token providers do not offer any significant benefit over
other token providers such as the UUID or Fernet.
If you are using the PKI or PKIZ token providers, it is recommended that
you switch to using another supported token provider such as the UUID
provider. This issue might be fixed in a future update of the PKI and
PKIZ token providers in the Identity service.
To check what token provider you are using, you must look in the
'keystone.conf' file for your Identity service. An example is provided
below:
---- begin keystone.conf sample snippet ----
[token]
#provider = keystone.token.providers.pki.Provider
#provider = keystone.token.providers.pkiz.Provider
provider = keystone.token.providers.uuid.Provider
---- end keystone.conf sample snippet ----
In the Liberty release of the Identity service, the token provider
configuration is different than previous OpenStack releases. An
example from the Libery release is provided below:
---- begin keystone.conf sample snippet ----
[token]
#provider = pki
#provider = pkiz
provider = uuid
---- end keystone.conf sample snippet ----
These configuration snippets are using the UUID token provider. If you
are using any of the commented out settings from these examples, your
cloud is vulnerable to this issue and you should switch to a different
token provider.
### Contacts / References ###
This OSSN : https://wiki.openstack.org/wiki/OSSN/OSSN-0061
Original LaunchPad Bug : https://bugs.launchpad.net/keystone/+bug/1490804
OpenStack Security ML : openstack-security@lists.openstack.org
OpenStack Security Group : https://launchpad.net/~openstack-ossg

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Steve Martinelli (stevemar)](https://launchpad.net/~stevemar) wrote on 2015-12-09: |  |  | [#74](/keystone/%2Bbug/1490804/comments/74) |
| --- | --- | --- | --- |

@Nate, not sure if you also want to mention that the PKI and PKIz token providers are not deprecated in Mitaka.

@Nate, not sure if you also want to mention that the PKI and PKIz token providers are not deprecated in Mitaka.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2015-12-09: |  |  | [#75](/keystone/%2Bbug/1490804/comments/75) |
| --- | --- | --- | --- |

Once the OSSN is approved, I'd like to send it as an advance notification to stakeholders before opening this bug.

Assuming it is done by tomorrow, this could be disclosed next Tuesday:

2015-12-15, 1500UTC

Once the OSSN is approved, I'd like to send it as an advance notification to stakeholders before opening this bug.
Assuming it is done by tomorrow, this could be disclosed next Tuesday:
2015-12-15, 1500UTC

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Brant Knudson (blk-u)](https://launchpad.net/~blk-u) wrote on 2015-12-09: |  |  | [#76](/keystone/%2Bbug/1490804/comments/76) |
| --- | --- | --- | --- |

the OSSN in comment 73 looks good to me.

the OSSN in comment 73 looks good to me.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2015-12-10: |  |  | [#77](/keystone/%2Bbug/1490804/comments/77) |
| --- | --- | --- | --- |

The OSSN has been sent, let's open this bug next Tuesday (2015-12-15, 1500UTC).

The OSSN has been sent, let's open this bug next Tuesday (2015-12-15, 1500UTC).

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2015-12-10:  [**Re: PKI Token Revocation Bypass (CVE-2015-7546)**](/keystone/%2Bbug/1490804/comments/78) |  |  | [#78](/keystone/%2Bbug/1490804/comments/78) |
| --- | --- | --- | --- |

Red Hat preemptively assigned CVE-2015-7546 for this vulnerability.

Red Hat preemptively assigned CVE-2015-7546 for this vulnerability.

| **summary**: | - PKI Token Revocation Bypass+ PKI Token Revocation Bypass (CVE-2015-7546) |
| --- | --- |

[Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray)
on 2015-12-15

| **information type**: | Private Security → Public Security |
| --- | --- |
| **description**: | updated |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2015-12-15: |  |  | [#79](/keystone/%2Bbug/1490804/comments/79) |
| --- | --- | --- | --- |

This bug is now public, OSSN and Keystone patches can be submitted to gerrit.

This bug is now public, OSSN and Keystone patches can be submitted to gerrit.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Nathan Kinder (nkinder)](https://launchpad.net/~nkinder) wrote on 2015-12-15: |  |  | [#80](/keystone/%2Bbug/1490804/comments/80) |
| --- | --- | --- | --- |

The OSSN review has been submitted:

<https://review.openstack.org/#/c/258119/>

The OSSN review has been submitted:
https://review.openstack.org/#/c/258119/

[OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack)
on 2015-12-15

| Changed in keystone: | |
| --- | --- |
| **assignee**: | Adam Young (ayoung) → Brant Knudson (blk-u) |
| **status**: | Won't Fix → In Progress |
| Changed in keystonemiddleware: | |
| **assignee**: | Adam Young (ayoung) → Brant Knudson (blk-u) |
| **status**: | Won't Fix → In Progress |

[Steve Martinelli (stevemar)](https://launchpad.net/~stevemar)
on 2015-12-15

| Changed in keystone: | |
| --- | --- |
| **milestone**: | none → mitaka-2 |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Nathan Kinder (nkinder)](https://launchpad.net/~nkinder) wrote on 2015-12-16: |  |  | [#81](/keystone/%2Bbug/1490804/comments/81) |
| --- | --- | --- | --- |

This issue has been published as OSSN-0062:

<https://wiki.openstack.org/wiki/OSSN/OSSN-0062>

This issue has been published as OSSN-0062:
https://wiki.openstack.org/wiki/OSSN/OSSN-0062

| Changed in ossn: | |
| --- | --- |
| **status**: | New → Fix Released |

[Brant Knudson (blk-u)](https://launchpad.net/~blk-u)
on 2015-12-17

| **tags**: | added: kilo-backport-potential liberty-backport-potential |
| --- | --- |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2015-12-21: |  |  | [#82](/keystone/%2Bbug/1490804/comments/82) |
| --- | --- | --- | --- |

The fix for keystone[master] is <https://review.openstack.org/#/c/258141> . Can this be proposed to stable liberty and kilo too ?

The fix for keystone[master] is https://review.openstack.org/#/c/258141 . Can this be proposed to stable liberty and kilo too ?

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Brant Knudson (blk-u)](https://launchpad.net/~blk-u) wrote on 2015-12-21: |  |  | [#83](/keystone/%2Bbug/1490804/comments/83) |
| --- | --- | --- | --- |

Tristan - It can be proposed, although some might consider the change to be a new feature rather than a bug fix, so not sure if it's appropriate for stable. I'd prefer for the change to be merged in master before I backport it otherwise I'll have make changes in multiple releases if there's a -1.

Tristan - It can be proposed, although some might consider the change to be a new feature rather than a bug fix, so not sure if it's appropriate for stable. I'd prefer for the change to be merged in master before I backport it otherwise I'll have make changes in multiple releases if there's a -1.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Steve Martinelli (stevemar)](https://launchpad.net/~stevemar) wrote on 2015-12-22: |  |  | [#84](/keystone/%2Bbug/1490804/comments/84) |
| --- | --- | --- | --- |

Brant & Tristan, I think it should be fine to backport to kilo and liberty. It's an important security related fix and I consider the proposed changes to be a bug and not a feature.

Brant & Tristan, I think it should be fine to backport to kilo and liberty. It's an important security related fix and I consider the proposed changes to be a bug and not a feature.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2016-01-05: |  |  | [#85](/keystone/%2Bbug/1490804/comments/85) |
| --- | --- | --- | --- |

Thanks, then considering this is going to be fixed in stable release, I've confirmed the OSSA task.

Thanks, then considering this is going to be fixed in stable release, I've confirmed the OSSA task.

| Changed in ossa: | |
| --- | --- |
| **status**: | Incomplete → Confirmed |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2016-01-09:  [**Fix merged to keystone (master)**](/keystone/%2Bbug/1490804/comments/86) |  |  | [#86](/keystone/%2Bbug/1490804/comments/86) |
| --- | --- | --- | --- |

Reviewed: <https://review.openstack.org/258141>

Committed: <https://git.openstack.org/cgit/openstack/keystone/commit/?id=d5378f173da14a34ca010271477337879002d6d0>

Submitter: Jenkins

Branch: master

commit d5378f173da14a34ca010271477337879002d6d0

Author: Brant Knudson <email address hidden>

Date: Tue Dec 1 11:09:14 2015 -0600

Add audit IDs to revocation events

The revoked tokens' audit ID is now included in the data returned in

    the revocation list.

Closes-Bug: 1490804

    Change-Id: Ifcf88f1158bebddc4f927121fbf4136fb53b659f

Reviewed: https://review.openstack.org/258141
Committed: https://git.openstack.org/cgit/openstack/keystone/commit/?id=d5378f173da14a34ca010271477337879002d6d0
Submitter: Jenkins
Branch: master
commit d5378f173da14a34ca010271477337879002d6d0
Author: Brant Knudson <bknudson@us.ibm.com>
Date: Tue Dec 1 11:09:14 2015 -0600
Add audit IDs to revocation events
The revoked tokens' audit ID is now included in the data returned in
the revocation list.
Closes-Bug: 1490804
Change-Id: Ifcf88f1158bebddc4f927121fbf4136fb53b659f

| Changed in keystone: | |
| --- | --- |
| **status**: | In Progress → Fix Released |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2016-01-11:  [**Fix proposed to keystonemiddleware (stable/liberty)**](/keystone/%2Bbug/1490804/comments/87) |  |  | [#87](/keystone/%2Bbug/1490804/comments/87) |
| --- | --- | --- | --- |

Fix proposed to branch: stable/liberty

Review: <https://review.openstack.org/265988>

Fix proposed to branch: stable/liberty
Review: https://review.openstack.org/265988

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2016-01-11:  [**Fix merged to keystonemiddleware (master)**](/keystone/%2Bbug/1490804/comments/88) |  |  | [#88](/keystone/%2Bbug/1490804/comments/88) |
| --- | --- | --- | --- |

Reviewed: <https://review.openstack.org/258143>

Committed: <https://git.openstack.org/cgit/openstack/keystonemiddleware/commit/?id=96ab58e6863c92575ada57615b19652e502adfd8>

Submitter: Jenkins

Branch: master

commit 96ab58e6863c92575ada57615b19652e502adfd8

Author: Brant Knudson <email address hidden>

Date: Tue Dec 1 16:08:00 2015 -0600

auth\_token verify revocation by audit\_id

If the revocation list includes audit\_ids, then when doing offline

    validation also validate the token isn't revoked by audit\_id.

Closes-Bug: 1490804

    Change-Id: I483bc57bd38eb81a0905bcaf94e4ea82604919d6

Reviewed: https://review.openstack.org/258143
Committed: https://git.openstack.org/cgit/openstack/keystonemiddleware/commit/?id=96ab58e6863c92575ada57615b19652e502adfd8
Submitter: Jenkins
Branch: master
commit 96ab58e6863c92575ada57615b19652e502adfd8
Author: Brant Knudson <bknudson@us.ibm.com>
Date: Tue Dec 1 16:08:00 2015 -0600
auth\_token verify revocation by audit\_id
If the revocation list includes audit\_ids, then when doing offline
validation also validate the token isn't revoked by audit\_id.
Closes-Bug: 1490804
Change-Id: I483bc57bd38eb81a0905bcaf94e4ea82604919d6

| Changed in keystonemiddleware: | |
| --- | --- |
| **status**: | In Progress → Fix Released |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2016-01-11:  [**Fix proposed to keystone (stable/liberty)**](/keystone/%2Bbug/1490804/comments/89) |  |  | [#89](/keystone/%2Bbug/1490804/comments/89) |
| --- | --- | --- | --- |

Fix proposed to branch: stable/liberty

Review: <https://review.openstack.org/266022>

Fix proposed to branch: stable/liberty
Review: https://review.openstack.org/266022

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2016-01-11:  [**Fix proposed to keystone (stable/kilo)**](/keystone/%2Bbug/1490804/comments/90) |  |  | [#90](/keystone/%2Bbug/1490804/comments/90) |
| --- | --- | --- | --- |

Fix proposed to branch: stable/kilo

Review: <https://review.openstack.org/266045>

Fix proposed to branch: stable/kilo
Review: https://review.openstack.org/266045

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2016-01-12:  [**Fix proposed to keystonemiddleware (stable/kilo)**](/keystone/%2Bbug/1490804/comments/91) |  |  | [#91](/keystone/%2Bbug/1490804/comments/91) |
| --- | --- | --- | --- |

Fix proposed to branch: stable/kilo

Review: <https://review.openstack.org/266607>

Fix proposed to branch: stable/kilo
Review: https://review.openstack.org/266607

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Doug Hellmann (doug-hellmann)](https://launchpad.net/~doug-hellmann) wrote on 2016-01-13:  [**Fix included in openstack/keystonemiddleware 4.1.0**](/keystone/%2Bbug/1490804/comments/92) |  |  | [#92](/keystone/%2Bbug/1490804/comments/92) |
| --- | --- | --- | --- |

This issue was fixed in the openstack/keystonemiddleware 4.1.0 release.

This issue was fixed in the openstack/keystonemiddleware 4.1.0 release.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2016-01-14:  [**Fix merged to keystone (stable/kilo)**](/keystone/%2Bbug/1490804/comments/93) |  |  | [#93](/keystone/%2Bbug/1490804/comments/93) |
| --- | --- | --- | --- |

Reviewed: <https://review.openstack.org/266045>

Committed: <https://git.openstack.org/cgit/openstack/keystone/commit/?id=9c9c1331e0c004897d5f4c5847f7143b56373f10>

Submitter: Jenkins

Branch: stable/kilo

commit 9c9c1331e0c004897d5f4c5847f7143b56373f10

Author: Brant Knudson <email address hidden>

Date: Tue Dec 1 11:09:14 2015 -0600

Add audit IDs to revocation events

The revoked tokens' audit ID is now included in the data returned in

    the revocation list.

Closes-Bug: 1490804

    Change-Id: Ifcf88f1158bebddc4f927121fbf4136fb53b659f

    (cherry picked from commit d5378f173da14a34ca010271477337879002d6d0)

    Conflicts:

     keystone/tests/unit/test\_backend.py

Reviewed: https://review.openstack.org/266045
Committed: https://git.openstack.org/cgit/openstack/keystone/commit/?id=9c9c1331e0c004897d5f4c5847f7143b56373f10
Submitter: Jenkins
Branch: stable/kilo
commit 9c9c1331e0c004897d5f4c5847f7143b56373f10
Author: Brant Knudson <bknudson@us.ibm.com>
Date: Tue Dec 1 11:09:14 2015 -0600
Add audit IDs to revocation events
The revoked tokens' audit ID is now included in the data returned in
the revocation list.
Closes-Bug: 1490804
Change-Id: Ifcf88f1158bebddc4f927121fbf4136fb53b659f
(cherry picked from commit d5378f173da14a34ca010271477337879002d6d0)
Conflicts:
keystone/tests/unit/test\_backend.py

| **tags**: | added: in-stable-kilo |
| --- | --- |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2016-01-14:  [**Fix merged to keystone (stable/liberty)**](/keystone/%2Bbug/1490804/comments/94) |  |  | [#94](/keystone/%2Bbug/1490804/comments/94) |
| --- | --- | --- | --- |

Reviewed: <https://review.openstack.org/266022>

Committed: <https://git.openstack.org/cgit/openstack/keystone/commit/?id=bff03b5726fe5cac93d44a66715eea49b89c8cb0>

Submitter: Jenkins

Branch: stable/liberty

commit bff03b5726fe5cac93d44a66715eea49b89c8cb0

Author: Brant Knudson <email address hidden>

Date: Tue Dec 1 11:09:14 2015 -0600

Add audit IDs to revocation events

The revoked tokens' audit ID is now included in the data returned in

    the revocation list.

Closes-Bug: 1490804

    Change-Id: Ifcf88f1158bebddc4f927121fbf4136fb53b659f

    (cherry picked from commit d5378f173da14a34ca010271477337879002d6d0)

    Conflicts:

     keystone/tests/unit/test\_backend.py

Reviewed: https://review.openstack.org/266022
Committed: https://git.openstack.org/cgit/openstack/keystone/commit/?id=bff03b5726fe5cac93d44a66715eea49b89c8cb0
Submitter: Jenkins
Branch: stable/liberty
commit bff03b5726fe5cac93d44a66715eea49b89c8cb0
Author: Brant Knudson <bknudson@us.ibm.com>
Date: Tue Dec 1 11:09:14 2015 -0600
Add audit IDs to revocation events
The revoked tokens' audit ID is now included in the data returned in
the revocation list.
Closes-Bug: 1490804
Change-Id: Ifcf88f1158bebddc4f927121fbf4136fb53b659f
(cherry picked from commit d5378f173da14a34ca010271477337879002d6d0)
Conflicts:
keystone/tests/unit/test\_backend.py

| **tags**: | added: in-stable-liberty |
| --- | --- |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2016-01-19:  [**Fix merged to keystonemiddleware (stable/liberty)**](/keystone/%2Bbug/1490804/comments/95) |  |  | [#95](/keystone/%2Bbug/1490804/comments/95) |
| --- | --- | --- | --- |

Reviewed: <https://review.openstack.org/265988>

Committed: <https://git.openstack.org/cgit/openstack/keystonemiddleware/commit/?id=9167afaafc216c63fdc875e737bc379400e94059>

Submitter: Jenkins

Branch: stable/liberty

commit 9167afaafc216c63fdc875e737bc379400e94059

Author: Brant Knudson <email address hidden>

Date: Tue Dec 1 16:08:00 2015 -0600

auth\_token verify revocation by audit\_id

If the revocation list includes audit\_ids, then when doing offline

    validation also validate the token isn't revoked by audit\_id.

Backport notes:

    - test\_auth\_token\_middleware was refactored with commit 9cbd47b to

      check responses differently, so the test changed to use the old

      method.

    - reno was not supported so the release note is removed.

Closes-Bug: 1490804

    Change-Id: I483bc57bd38eb81a0905bcaf94e4ea82604919d6

    (cherry picked from commit 96ab58e6863c92575ada57615b19652e502adfd8)

Reviewed: https://review.openstack.org/265988
Committed: https://git.openstack.org/cgit/openstack/keystonemiddleware/commit/?id=9167afaafc216c63fdc875e737bc379400e94059
Submitter: Jenkins
Branch: stable/liberty
commit 9167afaafc216c63fdc875e737bc379400e94059
Author: Brant Knudson <bknudson@us.ibm.com>
Date: Tue Dec 1 16:08:00 2015 -0600
auth\_token verify revocation by audit\_id
If the revocation list includes audit\_ids, then when doing offline
validation also validate the token isn't revoked by audit\_id.
Backport notes:
- test\_auth\_token\_middleware was refactored with commit 9cbd47b to
check responses differently, so the test changed to use the old
method.
- reno was not supported so the release note is removed.
Closes-Bug: 1490804
Change-Id: I483bc57bd38eb81a0905bcaf94e4ea82604919d6
(cherry picked from commit 96ab58e6863c92575ada57615b19652e502adfd8)

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Thierry Carrez (ttx)](https://launchpad.net/~ttx) wrote on 2016-01-21:  [**Fix included in openstack/keystone 9.0.0.0b2**](/keystone/%2Bbug/1490804/comments/96) |  |  | [#96](/keystone/%2Bbug/1490804/comments/96) |
| --- | --- | --- | --- |

This issue was fixed in the openstack/keystone 9.0.0.0b2 development milestone.

This issue was fixed in the openstack/keystone 9.0.0.0b2 development milestone.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2016-01-21:  [**Re: PKI Token Revocation Bypass (CVE-2015-7546)**](/keystone/%2Bbug/1490804/comments/97) |  |  | [#97](/keystone/%2Bbug/1490804/comments/97) |
| --- | --- | --- | --- |

I've put the stable/kilo task back to In Progress. The fix is half committed it is still missing:

  <https://review.openstack.org/#/c/266607/>

I've put the stable/kilo task back to In Progress. The fix is half committed it is still missing:
https://review.openstack.org/#/c/266607/

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2016-01-25:  [**Fix merged to keystonemiddleware (stable/kilo)**](/keystone/%2Bbug/1490804/comments/98) |  |  | [#98](/keystone/%2Bbug/1490804/comments/98) |
| --- | --- | --- | --- |

Reviewed: <https://review.openstack.org/266607>

Committed: <https://git.openstack.org/cgit/openstack/keystonemiddleware/commit/?id=70eeda3e06f5422aa953a38fe93d302079d7cc21>

Submitter: Jenkins

Branch: stable/kilo

commit 70eeda3e06f5422aa953a38fe93d302079d7cc21

Author: Brant Knudson <email address hidden>

Date: Tue Dec 1 16:08:00 2015 -0600

auth\_token verify revocation by audit\_id

If the revocation list includes audit\_ids, then when doing offline

    validation also validate the token isn't revoked by audit\_id.

Backport notes:

    - test\_auth\_token\_middleware was refactored with commit 9cbd47b to

      check responses differently, so the test changed to use the old

      method.

    - reno was not supported so the release note is removed.

Closes-Bug: 1490804

    Conflicts:

     keystonemiddleware/auth\_token/\_\_init\_\_.py

(cherry picked from commit 96ab58e6863c92575ada57615b19652e502adfd8)

    Change-Id: I483bc57bd38eb81a0905bcaf94e4ea82604919d6

Reviewed: https://review.openstack.org/266607
Committed: https://git.openstack.org/cgit/openstack/keystonemiddleware/commit/?id=70eeda3e06f5422aa953a38fe93d302079d7cc21
Submitter: Jenkins
Branch: stable/kilo
commit 70eeda3e06f5422aa953a38fe93d302079d7cc21
Author: Brant Knudson <bknudson@us.ibm.com>
Date: Tue Dec 1 16:08:00 2015 -0600
auth\_token verify revocation by audit\_id
If the revocation list includes audit\_ids, then when doing offline
validation also validate the token isn't revoked by audit\_id.
Backport notes:
- test\_auth\_token\_middleware was refactored with commit 9cbd47b to
check responses differently, so the test changed to use the old
method.
- reno was not supported so the release note is removed.
Closes-Bug: 1490804
Conflicts:
keystonemiddleware/auth\_token/\_\_init\_\_.py
(cherry picked from commit 96ab58e6863c92575ada57615b19652e502adfd8)
Change-Id: I483bc57bd38eb81a0905bcaf94e4ea82604919d6

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2016-01-28:  [**Related fix proposed to ossa (master)**](/keystone/%2Bbug/1490804/comments/99) |  |  | [#99](/keystone/%2Bbug/1490804/comments/99) |
| --- | --- | --- | --- |

Related fix proposed to branch: master

Review: <https://review.openstack.org/273679>

Related fix proposed to branch: master
Review: https://review.openstack.org/273679

[Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray)
on 2016-01-29

| **summary**: | - PKI Token Revocation Bypass (CVE-2015-7546)+ [OSSA 2015-006] PKI Token Revocation Bypass (CVE-2015-7546) |
| --- | --- |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2016-01-29:  [**Related fix merged to ossa (master)**](/keystone/%2Bbug/1490804/comments/100) |  |  | [#100](/keystone/%2Bbug/1490804/comments/100) |
| --- | --- | --- | --- |

Reviewed: <https://review.openstack.org/273679>

Committed: <https://git.openstack.org/cgit/openstack/ossa/commit/?id=1e03c88750db3cfdd01a59c6084b624b22c78c72>

Submitter: Jenkins

Branch: master

commit 1e03c88750db3cfdd01a59c6084b624b22c78c72

Author: Tristan Cacqueray <email address hidden>

Date: Thu Jan 28 12:24:15 2016 -0500

Adds OSSA-2016-005 (CVE-2015-7546)

This change also remove issues 'type' which isn't used and can't

    be extended to support other type such as OSSN.

Change-Id: I037c8e808466bbdceac38d6cf10a3f98703ad99f

    Related-Bug: #1490804

Reviewed: https://review.openstack.org/273679
Committed: https://git.openstack.org/cgit/openstack/ossa/commit/?id=1e03c88750db3cfdd01a59c6084b624b22c78c72
Submitter: Jenkins
Branch: master
commit 1e03c88750db3cfdd01a59c6084b624b22c78c72
Author: Tristan Cacqueray <tdecacqu@redhat.com>
Date: Thu Jan 28 12:24:15 2016 -0500
Adds OSSA-2016-005 (CVE-2015-7546)
This change also remove issues 'type' which isn't used and can't
be extended to support other type such as OSSN.
Change-Id: I037c8e808466bbdceac38d6cf10a3f98703ad99f
Related-Bug: #1490804

[Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray)
on 2016-01-29

| **summary**: | - [OSSA 2015-006] PKI Token Revocation Bypass (CVE-2015-7546)+ [OSSA 2015-005] PKI Token Revocation Bypass (CVE-2015-7546) |
| --- | --- |
| Changed in ossa: | |
| **status**: | Confirmed → Fix Released |
| **summary**: | - [OSSA 2015-005] PKI Token Revocation Bypass (CVE-2015-7546)+ [OSSA 2016-005] PKI Token Revocation Bypass (CVE-2015-7546) |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Doug Hellmann (doug-hellmann)](https://launchpad.net/~doug-hellmann) wrote on 2016-03-03:  [**Fix included in openstack/keystone 8.1.0**](/keystone/%2Bbug/1490804/comments/101) |  |  | [#101](/keystone/%2Bbug/1490804/comments/101) |
| --- | --- | --- | --- |

This issue was fixed in the openstack/keystone 8.1.0 release.

This issue was fixed in the openstack/keystone 8.1.0 release.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Doug Hellmann (doug-hellmann)](https://launchpad.net/~doug-hellmann) wrote on 2016-03-03:  [**Fix included in openstack/keystonemiddleware 2.3.3**](/keystone/%2Bbug/1490804/comments/102) |  |  | [#102](/keystone/%2Bbug/1490804/comments/102) |
| --- | --- | --- | --- |

This issue was fixed in the openstack/keystonemiddleware 2.3.3 release.

This issue was fixed in the openstack/keystonemiddleware 2.3.3 release.

[See full activity log](https://bugs.launchpad.net/keystone/%2Bbug/1490804/%2Bactivity)

Displaying first 40
and last 40
comments.
[View all 102
comments](/keystone/%2Bbug/1490804?comments=all) or [add a comment](/keystone/%2Bbug/1490804?comments=all).

* [Report a bug](/keystone/%2Bfilebug)

This report contains
**Public Security**
information

Everyone can see this security related information.

You are
[not directly subscribed to this bug's notifications.](/keystone/%2Bbug/1490804/%2Bsubscribe)

Subscribing...

* [Edit bug mail](https://bugs.launchpad.net/keystone/%2Bbug/1490804/%2Bsubscriptions "View and change your subscriptions to this bug")

## Other bug subscribers

[Subscribe someone else](https://bugs.launchpad.net/keystone/%2Bbug/1490804/%2Baddsubscriber "Launchpad will email that person whenever this bugs changes")

## Patches

* [bug-1490804-tests-master-v1.patch](https://bugs.launchpad.net/keystone/%2Bbug/1490804/%2Battachment/4456156/%2Bfiles/bug-1490804-tests-master-v1.patch)
  [Edit](/keystone/%2Bbug/1490804/%2Battachment/4456156 "Change patch details")
* [0001-Reject-modified-PKI-Tokens.patch](https://bugs.launchpad.net/keystone/%2Bbug/1490804/%2Battachment/4456676/%2Bfiles/0001-Reject-modified-PKI-Tokens.patch)
  [Edit](/keystone/%2Bbug/1490804/%2Battachment/4456676 "Change patch details")
* [0001-hash-the-data-in-the-token.patch](https://bugs.launchpad.net/keystone/%2Bbug/1490804/%2Battachment/4456711/%2Bfiles/0001-hash-the-data-in-the-token.patch)
  [Edit](/keystone/%2Bbug/1490804/%2Battachment/4456711 "Change patch details")
* [0001-Use-the-Keystoneclient-code-to-hash-the-token.patch](https://bugs.launchpad.net/keystone/%2Bbug/1490804/%2Battachment/4456923/%2Bfiles/0001-Use-the-Keystoneclient-code-to-hash-the-token.patch)
  [Edit](/keystone/%2Bbug/1490804/%2Battachment/4456923 "Change patch details")
* [0001-Disable-PKI-token-Provider.patch](https://bugs.launchpad.net/keystone/%2Bbug/1490804/%2Battachment/4508239/%2Bfiles/0001-Disable-PKI-token-Provider.patch)
  [Edit](/keystone/%2Bbug/1490804/%2Battachment/4508239 "Change patch details")
* [0001-Add-audit-IDs-to-revocation-events.patch](https://bugs.launchpad.net/keystone/%2Bbug/1490804/%2Battachment/4528257/%2Bfiles/0001-Add-audit-IDs-to-revocation-events.patch)
  [Edit](/keystone/%2Bbug/1490804/%2Battachment/4528257 "Change patch details")
* [0001-Verify-audit\_id-when-available.patch](https://bugs.launchpad.net/keystone/%2Bbug/1490804/%2Battachment/4528258/%2Bfiles/0001-Verify-audit_id-when-available.patch)
  [Edit](/keystone/%2Bbug/1490804/%2Battachment/4528258 "Change patch details")

* [Add patch](/keystone/%2Bbug/1490804/%2Baddcomment?field.patch=on)

## Bug attachments

* [modify\_token.py](https://bugs.launchpad.net/keystone/%2Bbug/1490804/%2Battachment/4455970/%2Bfiles/modify_token.py)
  [Edit](/keystone/%2Bbug/1490804/%2Battachment/4455970 "Change attachment details")
* [derdump of Token data in ASN1 format](https://bugs.launchpad.net/keystone/%2Bbug/1490804/%2Battachment/4455971/%2Bfiles/tokendata)
  [Edit](/keystone/%2Bbug/1490804/%2Battachment/4455971 "Change attachment details")
* [bug1490804-patch-test-traceback.txt](https://bugs.launchpad.net/keystone/%2Bbug/1490804/%2Battachment/4469888/%2Bfiles/bug1490804-patch-test-traceback.txt)
  [Edit](/keystone/%2Bbug/1490804/%2Battachment/4469888 "Change attachment details")

* [Add attachment](/keystone/%2Bbug/1490804/%2Baddcomment)

## Remote bug watches

Bug watches keep track of this bug in other bug trackers.

[![Launchpad](/@@/launchpad-footer-logo.svg)](https://launchpad.net/)
 •
[Take the tour](https://launchpad.net/%2Btour)
 •
[Read the guide](https://help.launchpad.net/)

© 2004
[Canonical Ltd.](http://canonical.com/)
 •
[Terms of use](https://launchpad.net/legal)
 •
[Data privacy](https://www.ubuntu.com/legal/dataprivacy)
 •
[Contact Launchpad Support](/feedback)
 •
[Blog](http://blog.launchpad.net/)
 •
[Careers](https://canonical.com/careers)
 •
[System status](https://ubuntu.social/%40launchpadstatus)
 •
4d55102
([Get the code!](https://dev.launchpad.net/))



=== Content from translations.launchpad.net_4db0e6d1_20250126_131120.html ===

[Log in / Register](https://translations.launchpad.net/keystone/%2Blogin)

[![](https://launchpadlibrarian.net/359059841/OpenStack_Project_Keystone_mascot%20%281%29.png)](https://launchpad.net/keystone)

## [OpenStack Identity (keystone)](https://launchpad.net/keystone)

* [Overview](https://launchpad.net/keystone)
* [Code](https://code.launchpad.net/keystone)
* [Bugs](https://bugs.launchpad.net/keystone)
* [Blueprints](https://blueprints.launchpad.net/keystone)
* Translations
* [Answers](https://answers.launchpad.net/keystone)

# Translation overview

[Help for translations](https://help.launchpad.net/Translations)

There are no translations for this project.

### Translation details

To see all the translation files that are waiting to be
imported, please look at
[OpenStack Identity (keystone) import queue](/keystone/%2Bimports).

### Permissions

[OpenStack Identity (keystone)](https://launchpad.net/keystone) is translated
with [Open](/%2Bhelp-translations/permissions-policies.html)
permissions.

### All translatable distribution packages

* [keystone source package in Plucky](/ubuntu/plucky/%2Bsources/keystone/%2Btranslations)
* [keystone source package in Oracular](/ubuntu/oracular/%2Bsources/keystone/%2Btranslations)
* [keystone source package in Noble](/ubuntu/noble/%2Bsources/keystone/%2Btranslations)
* [keystone source package in Mantic](/ubuntu/mantic/%2Bsources/keystone/%2Btranslations)
* [keystone source package in Lunar](/ubuntu/lunar/%2Bsources/keystone/%2Btranslations)
* [keystone source package in Kinetic](/ubuntu/kinetic/%2Bsources/keystone/%2Btranslations)
* [keystone source package in Jammy](/ubuntu/jammy/%2Bsources/keystone/%2Btranslations)
* [keystone source package in Impish](/ubuntu/impish/%2Bsources/keystone/%2Btranslations)
* [keystone source package in Hirsute](/ubuntu/hirsute/%2Bsources/keystone/%2Btranslations)
* [keystone source package in Groovy](/ubuntu/groovy/%2Bsources/keystone/%2Btranslations)
* [keystone source package in Focal](/ubuntu/focal/%2Bsources/keystone/%2Btranslations)
* [keystone source package in Eoan](/ubuntu/eoan/%2Bsources/keystone/%2Btranslations)
* [keystone source package in Disco](/ubuntu/disco/%2Bsources/keystone/%2Btranslations)
* [keystone source package in Cosmic](/ubuntu/cosmic/%2Bsources/keystone/%2Btranslations)
* [keystone source package in Bionic](/ubuntu/bionic/%2Bsources/keystone/%2Btranslations)
* [keystone source package in Artful](/ubuntu/artful/%2Bsources/keystone/%2Btranslations)
* [keystone source package in Zesty](/ubuntu/zesty/%2Bsources/keystone/%2Btranslations)
* [keystone source package in Yakkety](/ubuntu/yakkety/%2Bsources/keystone/%2Btranslations)
* [keystone source package in Xenial](/ubuntu/xenial/%2Bsources/keystone/%2Btranslations)
* [keystone source package in Wily](/ubuntu/wily/%2Bsources/keystone/%2Btranslations)
* [keystone source package in Vivid](/ubuntu/vivid/%2Bsources/keystone/%2Btranslations)
* [keystone source package in Utopic](/ubuntu/utopic/%2Bsources/keystone/%2Btranslations)
* [keystone source package in Trusty](/ubuntu/trusty/%2Bsources/keystone/%2Btranslations)
* [keystone source package in Saucy](/ubuntu/saucy/%2Bsources/keystone/%2Btranslations)
* [keystone source package in Raring](/ubuntu/raring/%2Bsources/keystone/%2Btranslations)
* [keystone source package in Quantal](/ubuntu/quantal/%2Bsources/keystone/%2Btranslations)

[![Launchpad](/@@/launchpad-footer-logo.svg)](https://launchpad.net/)
 •
[Take the tour](https://launchpad.net/%2Btour)
 •
[Read the guide](https://help.launchpad.net/)

© 2004
[Canonical Ltd.](http://canonical.com/)
 •
[Terms of use](https://launchpad.net/legal)
 •
[Data privacy](https://www.ubuntu.com/legal/dataprivacy)
 •
[Contact Launchpad Support](/feedback)
 •
[Blog](http://blog.launchpad.net/)
 •
[Careers](https://canonical.com/careers)
 •
[System status](https://ubuntu.social/%40launchpadstatus)
 •
4d55102
([Get the code!](https://dev.launchpad.net/))



=== Content from review.openstack.org_eef85e0b_20250126_131126.html ===




=== Content from launchpad.net_358978c3_20250126_131121.html ===

[Log in / Register](https://launchpad.net/~hudson-openstack/%2Blogin)

[![](/@@/person-logo)](https://launchpad.net/~hudson-openstack)

## [OpenStack Infra](https://launchpad.net/~hudson-openstack)

* Overview
* [Code](https://code.launchpad.net/~hudson-openstack)
* [Bugs](https://bugs.launchpad.net/~hudson-openstack)
* [Blueprints](https://blueprints.launchpad.net/~hudson-openstack)
* [Translations](https://translations.launchpad.net/~hudson-openstack)
* [Answers](https://answers.launchpad.net/~hudson-openstack)

* [Related packages](https://launchpad.net/~hudson-openstack/%2Brelated-packages)
* [Related projects](https://launchpad.net/~hudson-openstack/%2Brelated-projects)

## User information

Launchpad Id:
hudson-openstack

Email:
[Log in](%2Blogin) for email information.

Member since:
2010-07-14

[![Icon of Burrow](https://launchpadlibrarian.net/67728214/os14.png "Member of Burrow")](/~burrow)
[![Icon of Citrix OpenStack development team](https://launchpadlibrarian.net/64472709/Citrix%2014.png "Member of Citrix OpenStack development team")](/~citrix-openstack)
[![Icon of (deprecated) OpenStack PPA maintainers](https://launchpadlibrarian.net/87891894/ppa.gif "Member of (deprecated) OpenStack PPA maintainers")](/~openstack-ppa)
[![Icon of Designate Core](https://launchpadlibrarian.net/360468328/designate_14.jpg "Member of Designate Core")](/~designate-core)
[![Icon of Designate Drivers](https://launchpadlibrarian.net/360468067/designate_14.jpg "Member of Designate Drivers")](/~designate-drivers)
[![Icon of MidoNet Bugs](https://launchpadlibrarian.net/228074955/midonet_14x14.png "Member of MidoNet Bugs")](/~midonet-bugs)
[![Icon of Nova Bug Team](https://launchpadlibrarian.net/108832444/bug.gif "Member of Nova Bug Team")](/~nova-bugs)
[![Icon of Nova](https://launchpadlibrarian.net/52560219/os14.png "Member of Nova")](/~nova)
[![Icon of OpenStack Team](https://launchpadlibrarian.net/52313052/os14.png "Member of OpenStack Team")](/~openstack)

Languages:

English

OpenPGP keys:

72571ACC301E6FE900837F5CDF85501232EE128C

SSH keys:

[hudson@hudson](%2Bsshkeys)

[jenkins@vpcslave](%2Bsshkeys)

Time zone:

UTC
(UTC+0000)

Karma:
[6503](https://launchpad.net/~hudson-openstack/%2Bkarma)
[Karma help](/%2Bhelp-registry/karma.html)

## [All memberships](https://launchpad.net/~hudson-openstack/%2Bparticipation) Latest memberships

| [Compute Hyper-V Bugs](/~compute-hyperv-bugs)  Joined on 2019-08-28 | |
| --- | --- |
| [OS-Win Bugs](/~os-win-bugs)  Joined on 2019-08-28 | |
| [Networking Hyper-V Bugs](/~networking-hyperv-bugs)  Joined on 2019-08-28 | |
| [kolla-drivers](/~kolla-drivers)  Joined on 2019-05-20 | |
| [fixtures-git-bugs](/~fixtures-git-bugs)  Joined on 2018-03-25 | |

## [Recent activities](https://launchpad.net/~hudson-openstack/%2Bkarma) Most active in

| [StarlingX](/starlingx) |  |
| --- | --- |
| [kolla-ansible](/kolla-ansible) |  |
| [kolla](/kolla) |  |
| [kayobe](/kayobe) |  |
| [OpenStack Compute (nova)](/nova) |  |

[![Launchpad](/@@/launchpad-footer-logo.svg)](https://launchpad.net/)
 •
[Take the tour](https://launchpad.net/%2Btour)
 •
[Read the guide](https://help.launchpad.net/)

© 2004
[Canonical Ltd.](http://canonical.com/)
 •
[Terms of use](https://launchpad.net/legal)
 •
[Data privacy](https://www.ubuntu.com/legal/dataprivacy)
 •
[Contact Launchpad Support](/feedback)
 •
[Blog](http://blog.launchpad.net/)
 •
[Careers](https://canonical.com/careers)
 •
[System status](https://ubuntu.social/%40launchpadstatus)
 •
4d55102
([Get the code!](https://dev.launchpad.net/))



=== Content from review.openstack.org_4e0e4e36_20250126_131122.html ===




=== Content from launchpad.net_43e97fd4_20250126_131136.html ===

[Log in / Register](https://launchpad.net/~openstack-ossg/%2Blogin)

[![](https://launchpadlibrarian.net/203991794/os64.png)](https://launchpad.net/~openstack-ossg)

## [“OpenStack Security SIG” team](https://launchpad.net/~openstack-ossg)

* Overview
* [Code](https://code.launchpad.net/~openstack-ossg)
* [Bugs](https://bugs.launchpad.net/~openstack-ossg)
* [Blueprints](https://blueprints.launchpad.net/~openstack-ossg)
* [Translations](https://translations.launchpad.net/~openstack-ossg)
* [Answers](https://answers.launchpad.net/~openstack-ossg)

Overview:

The OpenStack Security SIG actively works to improve OpenStack security through improvements to code, architecture and various documentation efforts including vulnerability management (through the Vulnerability Management Team) and issuing of Security Notes.

The primary focus points for the security team are:

(1) Securing the OpenStack code base

(2) Providing deployers with the documentation needed to make sound security choices when deploying or consuming OpenStack

(3) Helping address security needs in a cross project collaborative way.

Author and maintain the OpenStack Security Guide:

\* <http://docs.openstack.org/sec/>

The security team conducts all non-confidential business on the openstack-sig mailing list with the [Security] tag.

\* Subscribe: <http://lists.openstack.org/cgi-bin/mailman/listinfo/openstack-sigs>

We previously used the openstack-security mailing list

\* Archive: <http://lists.openstack.org/pipermail/openstack-sigs/>

Advisory Activities:

\* Act as a consultancy group for OpenStack developers

\* The Vulnerability Management Team (VMT) exists as a subset of the Security SIG

\* VMT confidentially handles vulnerability disclosures

\* The wider security SIG can confirm vulnerability severity at the request of the VMT

Security Guidance:

\* OpenStack Security Notes provide Security Guidance on OpenStack Configuration and Usage: <https://launchpad.net/ossn/>

\* Issued Security Notes: <https://wiki.openstack.org/wiki/Security_Notes>

Research Activities:

\* Exploits / Proofs of Concept

\* Vulnerability Research

\* Threat Verification

\* Hardening

\* Security Architecture

\* Secure OpenStack Provisioning

\* Documenting Security Features

\* Configuration Management

\* Site Survey Functionality / Security Dashboard

\* More

Membership:

In April 2015 the Security SIG became an official part of OpenStack. Previously the security team was comprised of two separate organisations; the VMT and the OSSG. The VMT was a small team handling critical vulnerability reports and remediation whereas the OSSG formed the bulk of the remaining security activities within OpenStack. In early 2015 these teams merged, this was quickly followed by the Security team being accepted into OpenStack.

History of the OSSG:

Originally instigated in 2012 by HP and Nebula, the OSSG initially sought to work on an invite only basis, seeking to draw in contributors from large OpenStack teams such as Rackspace, Ubuntu and Red Hat. The team has grown significantly in size and function and now works on a moderated list model, we're open to contributors of all types and the list is moderated simply to keep out spammers.

In early 2018 what was the Security Project became the Security SIG

Security GIG Code of Ethics:

Members of the security team agree that the goals of the group are to improve the security of OpenStack. Information made available to the security team may at times be sensitive and should always be treated as confidential, not to be shared outside of the group. Members are expressly prohibited from profiting by sharing vulnerability or exploit information obtained from the security team with a third party. All group members agree to abide by industry best practices in responsible disclosure, including providing proper attribution for any technical contributions.

Leadership:

The security SIG has no formal leadership, instead it has chairs, with the current chairs being Luke Hinds (Red Hat) and Gage Hugo (AT&T).

Leadership Functions:

\* Formal liaison with OpenStack teams

\* Security team co-ordination

\* Driving Security Awareness

\* Providing Suggestions for Research Direction

\* More

Ongoing Tasks for the Security SIG:

\* Recruiting security talent

\* Evangelizing security within the community

\* Document current best practices - useful as a documentation exercise and for understanding next steps. (e.g., if best practices involve strongly isolating a particular component b/c it is riddled with security issues, then that will help reveal where we should be working)

\* Develop stress tests that can be integrated with current testing

* [Related packages](https://launchpad.net/~openstack-ossg/%2Brelated-packages)
* [Related projects](https://launchpad.net/~openstack-ossg/%2Brelated-projects)

## Team details

Email:
[Log in](%2Blogin) for email information.

Owner:
[Luke Hinds](/~lhinds)

Created on:
2012-05-23

Languages:
English

Membership policy:
Moderated Team

## [All members](https://launchpad.net/~openstack-ossg/%2Bmembers)

**345**
[active
members](/~openstack-ossg/%2Bmembers#active),
**10**
[proposed
members](/~openstack-ossg/%2Bmembers#proposed)

You must [log in](%2Blogin)
to join or leave this team.

* [Show member photos](https://launchpad.net/~openstack-ossg/%2Bmugshots)

| Latest members  * [Sandipan Roy](/~bytehackr) * [Gage Hugo](/~gagehugo) * [Padmini](/~pgaur1411) * [Jean-Sébastien MINE](/~js.m) * [Prerana](/~prerana03) | Pending approval  * [Brian Rosmaita](/~brian-rosmaita) * [Immaculate Atim](/~immaculate-atim) * [Brian Tray](/~btray900) * [Mohammad Reza Gerami](/~mrgerami) * [RBK](/~rbkv2) |
| --- | --- |

### Latest invited

## Mailing list

![mail](/@@/mail)
openstack-ossg@lists.launchpad.net

**Policy:**
You must be a team member to subscribe to the team mailing list.

![email](/@@/mail)
[View public archive](https://lists.launchpad.net/openstack-ossg)

![team](/@@/team) [View subscribers](/~openstack-ossg/%2Bmailing-list-subscribers)

## [Show related projects](%2Bprojects) Related projects

| [Bandit](/bandit) |
| --- |
| [OpenStack Security Guide Documentation](/ossp-security-documentation) |
| [OpenStack Security Notes](/ossn) |
| [openstack-secaudit](/openstack-secaudit) |

Public team

* [Join the team](https://launchpad.net/~openstack-ossg/%2Bjoin)
* [Add one of my teams](https://launchpad.net/~openstack-ossg/%2Badd-my-teams)

[![Launchpad](/@@/launchpad-footer-logo.svg)](https://launchpad.net/)
 •
[Take the tour](https://launchpad.net/%2Btour)
 •
[Read the guide](https://help.launchpad.net/)

© 2004
[Canonical Ltd.](http://canonical.com/)
 •
[Terms of use](https://launchpad.net/legal)
 •
[Data privacy](https://www.ubuntu.com/legal/dataprivacy)
 •
[Contact Launchpad Support](/feedback)
 •
[Blog](http://blog.launchpad.net/)
 •
[Careers](https://canonical.com/careers)
 •
[System status](https://ubuntu.social/%40launchpadstatus)
 •
4d55102
([Get the code!](https://dev.launchpad.net/))


