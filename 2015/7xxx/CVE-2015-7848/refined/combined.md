=== Content from security.gentoo.org_7a9148c9_20250125_192621.html ===

[![Gentoo](https://assets.gentoo.org/tyrian/v2/site-logo.png)](/ "Back to the homepage")
Security

[**Get Gentoo!**](https://get.gentoo.org/)
gentoo.org sites
[gentoo.org](https://www.gentoo.org/ "Main Gentoo website")
[Wiki](https://wiki.gentoo.org/ "Find and contribute documentation")
[Bugs](https://bugs.gentoo.org/ "Report issues and find common issues")
[Forums](https://forums.gentoo.org/ "Discuss with the community")
[Packages](https://packages.gentoo.org/ "Find software for your Gentoo")

[Planet](https://planet.gentoo.org/ "Find out what's going on in the developer community")
[Archives](https://archives.gentoo.org/ "Read up on past discussions")
[Sources](https://sources.gentoo.org/ "Browse our source code")

[Infra Status](https://infra-status.gentoo.org/ "Get updates on the services provided by Gentoo")

* [Home](/)
* [Stay informed](/subscribe)
* [Advisories](/glsa)

# NTP: Multiple vulnerabilities — GLSA **201607-15**

Multiple vulnerabilities have been found in NTP, the worst of which
could lead to Denial of Service.

### Affected packages

| Package | **net-misc/ntp** on all architectures |
| --- | --- |
| Affected versions | < **4.2.8\_p8** |
| Unaffected versions | >= **4.2.8\_p8** |

### Background

NTP contains software for the Network Time Protocol.

### Description

Multiple vulnerabilities have been discovered in NTP. Please review the
CVE identifiers referenced below for details.

### Impact

A remote attacker could possibly cause a Denial of Service condition.

### Workaround

There is no known workaround at this time.

### Resolution

All NTP users should upgrade to the latest version:

```
 # emerge --sync
 # emerge --ask --oneshot --verbose ">=net-misc/ntp-4.2.8_p8"

```
### References

* [CVE-2015-7691](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2015-7691)
* [CVE-2015-7692](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2015-7692)
* [CVE-2015-7701](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2015-7701)
* [CVE-2015-7702](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2015-7702)
* [CVE-2015-7703](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2015-7703)
* [CVE-2015-7704](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2015-7704)
* [CVE-2015-7705](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2015-7705)
* [CVE-2015-7848](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2015-7848)
* [CVE-2015-7849](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2015-7849)
* [CVE-2015-7850](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2015-7850)
* [CVE-2015-7851](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2015-7851)
* [CVE-2015-7852](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2015-7852)
* [CVE-2015-7853](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2015-7853)
* [CVE-2015-7854](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2015-7854)
* [CVE-2015-7855](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2015-7855)
* [CVE-2015-7871](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2015-7871)
* [CVE-2015-7973](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2015-7973)
* [CVE-2015-7974](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2015-7974)
* [CVE-2015-7975](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2015-7975)
* [CVE-2015-7976](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2015-7976)
* [CVE-2015-7977](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2015-7977)
* [CVE-2015-7978](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2015-7978)
* [CVE-2015-7979](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2015-7979)
* [CVE-2015-8138](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2015-8138)
* [CVE-2015-8139](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2015-8139)
* [CVE-2015-8140](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2015-8140)
* [CVE-2015-8158](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2015-8158)
* [CVE-2016-1547](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2016-1547)
* [CVE-2016-1548](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2016-1548)
* [CVE-2016-1549](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2016-1549)
* [CVE-2016-1550](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2016-1550)
* [CVE-2016-1551](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2016-1551)
* [CVE-2016-2516](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2016-2516)
* [CVE-2016-2517](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2016-2517)
* [CVE-2016-2518](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2016-2518)
* [CVE-2016-2519](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2016-2519)
* [CVE-2016-4953](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2016-4953)
* [CVE-2016-4954](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2016-4954)
* [CVE-2016-4955](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2016-4955)
* [CVE-2016-4956](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2016-4956)
* [CVE-2016-4957](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2016-4957)

**Release date**

July 20, 2016

**Latest revision**

July 20, 2016: 1

**Severity**

normal

**Exploitable**

remote

**Bugzilla entries**

* [563774](https://bugs.gentoo.org/show_bug.cgi?id=563774)
* [572452](https://bugs.gentoo.org/show_bug.cgi?id=572452)
* [581528](https://bugs.gentoo.org/show_bug.cgi?id=581528)
* [584954](https://bugs.gentoo.org/show_bug.cgi?id=584954)

### Questions or comments?

Please feel free to contact us.

**© 2001–2020 Gentoo Foundation, Inc.**



=== Content from security.netapp.com_802b2036_20250125_192623.html ===

[Skip to main content](#n-main-content)

* [NetApp.com](https://www.netapp.com/)
* [Support](https://mysupport.netapp.com)
* [Community](https://community.netapp.com)
* [Training](https://www.netapp.com/support-and-training/netapp-learning-services/)

* [Contact Us](https://www.netapp.com/company/contact-us/)

English
æ¥æ¬èª

[netapp-mark

NetApp

## Product Security](https://security.netapp.com)

Search

Search

* Search

Search

Search

* [Home](https://security.netapp.com/en)
* [Advisories](https://security.netapp.com/advisory/)
* [Bulletins](https://security.netapp.com/bulletins/)
* [Contact](https://security.netapp.com/contact/)
* [Policy](https://security.netapp.com/policy/)
* [Resources](https://security.netapp.com/resources/)
* [Certifications](https://security.netapp.com/certs/)

* [Home](https://security.netapp.com/en)
* [Advisory](https://security.netapp.com/advisory)
* [October 2015 Network Time Protocol Daemon (ntpd) Vulnerabilities in Multiple NetApp Products](https://security.netapp.com/advisory/ntap-20171004-0001)

## October 2015 Network Time Protocol Daemon (ntpd) Vulnerabilities in Multiple NetApp Products

circle-check-alt

This advisory should be considered the single source of current, up-to-date, authorized and accurate information from NetApp regarding Full Support products and versions.

close ×

#### Subscribe to NTAP-20171004-0001 updates

Email

Yes, please send me emails when NetApp Security Advisories are posted or updated.

 By filling and submitting this form, I understand and agree with the [NetApp privacy policy](https://www.netapp.com/company/legal/privacy-policy/ "Privacy Policy") and understand that I can unsubscribe from NetApp Security Advisory communications at any time.

Subscribe

#### Subscribe to NTAP-20171004-0001 advisory updates

OTP

Confirm

ionicons-v5-e

Confirmed your subscription to advisory alerts

close ×

#### Unsubscribe from NTAP-20171004-0001 advisory updates

Email

Unsubscribe

#### Unsubscribe from NTAP-20171004-0001 advisory updates

Email

Confirm

ionicons-v5-e

Unsubscribed successfully from advisory alerts

Subscribe to receive email updates

**Advisory ID:** NTAP-20171004-0001
**Version:**
5.0

**Last updated:**
09/18/2019

**Status:**
Final.

**CVEs:** CVE-2015-7871, CVE-2015-7855, CVE-2015-7854, CVE-2015-7853, CVE-2015-7852, CVE-2015-7851, CVE-2015-7850, CVE-2015-7849, CVE-2015-7848, CVE-2015-7701, CVE-2015-7703, CVE-2015-7704, CVE-2015-7705, CVE-2015-7691, CVE-2015-7692, CVE-2015-7702, CVE-2015-5300

Overview
#### Summary

Multiple NetAppÂ® products contain the Network Time Protocol daemon (ntpd). The Open NTP project (www.ntp.org) has released a Security Notice regarding vulnerabilities that affect versions before ntp-4.2.8p4. These vulnerabilities could allow an attacker to modify data, execute arbitrary code, cause a process crash or Denial of Service (DoS).

#### Impact

Exploitation of these vulnerabilities may lead to data modification, arbitrary code execution, process crashes or Denial of Service (DoS).

Clustered Data ONTAP and Data ONTAP operating in 7-Mode were only found to be affected by CVE-2015-5300, CVE-2015-7704, and CVE-2015-7705.

#### Vulnerability Scoring Details

| **CVE** | **Score** | **Vector** |
| --- | --- | --- |
| [CVE-2015-5300](https://nvd.nist.gov/vuln/detail/CVE-2015-5300) | 3.7 (LOW) | AV:N/AC:M/Au:N/C:N/I:P/A:N/E:U/RL:U/RC:C |
| [CVE-2015-7691](https://nvd.nist.gov/vuln/detail/CVE-2015-7691) | 3.9 (LOW) | AV:N/AC:H/Au:M/C:N/I:N/A:C/E:U/RL:U/RC:C |
| [CVE-2015-7692](https://nvd.nist.gov/vuln/detail/CVE-2015-7692) | 3.9 (LOW) | AV:N/AC:H/Au:M/C:N/I:N/A:C/E:U/RL:U/RC:C |
| [CVE-2015-7701](https://nvd.nist.gov/vuln/detail/CVE-2015-7701) | 3.9 (LOW) | AV:N/AC:H/Au:M/C:N/I:N/A:C/E:U/RL:U/RC:C |
| [CVE-2015-7702](https://nvd.nist.gov/vuln/detail/CVE-2015-7702) | 3.9 (LOW) | AV:N/AC:H/Au:M/C:N/I:N/A:C/E:U/RL:U/RC:C |
| [CVE-2015-7703](https://nvd.nist.gov/vuln/detail/CVE-2015-7703) | 5.3 (MEDIUM) | AV:N/AC:H/Au:M/C:N/I:C/A:C/E:U/RL:U/RC:C |
| [CVE-2015-7704](https://nvd.nist.gov/vuln/detail/CVE-2015-7704) | 3.7 (LOW) | AV:N/AC:M/Au:N/C:N/I:N/A:P/E:U/RL:U/RC:C |
| [CVE-2015-7705](https://nvd.nist.gov/vuln/detail/CVE-2015-7705) | 3.7 (LOW) | AV:N/AC:M/Au:N/C:N/I:N/A:P/E:U/RL:U/RC:C |
| [CVE-2015-7848](https://nvd.nist.gov/vuln/detail/CVE-2015-7848) | 3.9 (LOW) | AV:N/AC:H/Au:M/C:N/I:N/A:C/E:U/RL:U/RC:C |
| [CVE-2015-7849](https://nvd.nist.gov/vuln/detail/CVE-2015-7849) | 5.3 (MEDIUM) | AV:N/AC:H/Au:M/C:N/I:C/A:C/E:U/RL:U/RC:C |
| [CVE-2015-7850](https://nvd.nist.gov/vuln/detail/CVE-2015-7850) | 3.9 (LOW) | AV:N/AC:H/Au:M/C:N/I:N/A:C/E:U/RL:U/RC:C |
| [CVE-2015-7851](https://nvd.nist.gov/vuln/detail/CVE-2015-7851) | 4.5 (MEDIUM) | AV:N/AC:H/Au:M/C:N/I:P/A:C/E:U/RL:U/RC:C |
| [CVE-2015-7852](https://nvd.nist.gov/vuln/detail/CVE-2015-7852) | 3.4 (LOW) | AV:N/AC:H/Au:N/C:N/I:P/A:P/E:U/RL:U/RC:C |
| [CVE-2015-7853](https://nvd.nist.gov/vuln/detail/CVE-2015-7853) | 5.0 (MEDIUM) | AV:L/AC:H/Au:M/C:C/I:C/A:C/E:U/RL:U/RC:C |
| [CVE-2015-7854](https://nvd.nist.gov/vuln/detail/CVE-2015-7854) | 5.8 (MEDIUM) | AV:N/AC:H/Au:M/C:C/I:C/A:C/E:U/RL:U/RC:C |
| [CVE-2015-7855](https://nvd.nist.gov/vuln/detail/CVE-2015-7855) | 3.9 (LOW) | AV:N/AC:H/Au:M/C:N/I:N/A:C/E:U/RL:U/RC:C |
| [CVE-2015-7871](https://nvd.nist.gov/vuln/detail/CVE-2015-7871) | 5.4 (MEDIUM) | AV:N/AC:L/Au:N/C:N/I:P/A:P/E:U/RL:U/RC:C |

#### Exploitation and Public Announcements

NetApp is aware of public discussion of this vulnerability.

#### References

* <http://support.ntp.org/bin/view/Main/SecurityNotice#October_2015_NTP_4_2_8p4_Securit>

Affected Products
#### Affected Products

* Clustered Data ONTAP
* Data ONTAP operating in 7-Mode
* OnCommand Balance
* OnCommand Performance Manager (Unified Manager Performance Pkg)
* OnCommand Unified Manager for Clustered Data ONTAP

#### Products Not Affected

* 7-Mode Transition Tool
* ATTO FibreBridge
* Brocade Fabric Operating System Firmware
* Brocade Network Advisor Software
* Clustered Data ONTAP Antivirus Connector
* E-Series SANtricity Management Plug-ins (VMware vCenter)
* E-Series SANtricity Storage Manager
* E-Series SANtricity Web Services (REST API) for Web Services Proxy
* FAS/AFF BIOS
* FlashRay
* Host Utilities - SAN for Linux
* Host Utilities - SAN for Windows
* MetroCluster Tiebreaker for clustered Data ONTAP
* NetApp Cloud Backup (formerly AltaVault)
* NetApp Manageability SDK
* NetApp NFS Plug-in for VMware VAAI
* NetApp Plug-in for Symantec NetBackup
* NetApp SANtricity SMI-S Provider
* NetApp SMI-S Provider
* NetApp Storage Encryption
* NetApp VASA Provider for Clustered Data ONTAP 7.2 and above
* OnCommand API Services
* OnCommand Cloud Manager
* OnCommand Insight
* OnCommand System Manager 9.x
* OnCommand Unified Manager for 7-Mode (core package)
* OnCommand Workflow Automation
* Open Systems SnapVault Agent
* RAID Controller CTS2600 Legacy Engenio
* Service Processor
* Single Mailbox Recovery
* Snap Creator Framework
* SnapCenter
* SnapDrive for Unix
* SnapDrive for Windows
* SnapManager for Exchange
* SnapManager for Hyper-V
* SnapManager for MS SQL
* SnapManager for Oracle
* SnapManager for SAP
* SnapManager for Sharepoint
* Storage Replication Adapter for Clustered Data ONTAP for VMware vSphere 7.2 and above
* Storage Services Connector
* StorageGRID (formerly StorageGRID Webscale)
* StorageGRID9 (9.x and prior)
* System Setup
* Virtual Storage Console for VMware vSphere 7.2 and above

Remediation
#### Software Versions and Fixes

NetApp's currently available patches are listed below.

| **Product** | **First Fixed in Release** |
| --- | --- |
| **OnCommand Performance Manager (Unified Manager Performance Pkg)** | <https://mysupport.netapp.com/NOW/download/software/oncommand_pm/7.1/> <https://mysupport.netapp.com/NOW/download/software/oncommand_pm_linux/7.1/> |
| **Data ONTAP operating in 7-Mode** | Data ONTAP operating in 7-Mode has no plans to address this vulnerability. |
| **OnCommand Balance** | OnCommand Balance has no plans to address this vulnerability. See the [EOA announcement](https://mysupport.netapp.com/info/communications/ECMP1655122.html) for more information. |
| **OnCommand Unified Manager for Clustered Data ONTAP** | <http://mysupport.netapp.com/NOW/download/software/oncommand_cdot_win/7.0/> <http://mysupport.netapp.com/NOW/download/software/oncommand_cdot_lin/7.0/> <http://mysupport.netapp.com/NOW/download/software/oncommand_cdot/7.0/> |
| **Clustered Data ONTAP** | <https://mysupport.netapp.com/NOW/download/software/ontap/9.0> |

#### Workarounds

None at this time.

#### Obtaining Software Fixes

Software fixes will be made available through the NetApp Support website in the Software Download section.

<https://mysupport.netapp.com/site/downloads/>

Customers who do not have access to the Support website should contact Technical Support at the number below to obtain the patches.

#### Contact Information

Check <http://mysupport.netapp.com> for further
updates.

**Technical Support**

Revision History
#### Status of This Notice

**Final.**

This advisory should be considered the single source of current, up-to-date, authorized and accurate information from NetApp regarding Full Support products and versions.

This advisory is posted at the following link:

<https://security.netapp.com/advisory/NTAP-20171004-0001>
#### Revision History

| **Revision #** | **Date** | **Comments** |
| --- | --- | --- |
| 1.0 | 20171004 | Initial Public Release |
| 2.0 | 20180122 | OnCommand Balance moved to Won't Fix status |
| 3.0 | 20180129 | NetApp VASA Provider for Clustered Data ONTAP 7.0 and above moved to Products Not Affected |
| 4.0 | 20180730 | Final Status |
| 5.0 | 20190918 | Updated Impact section to reference Clustered Data ONTAP |

This document is provided solely for informational purposes. All information is based upon NetAppâs current knowledge and understanding of the hardware and software products tested by NetApp, and the methodology and assumptions used by NetApp. NetApp is not responsible for any errors or omissions that may be contained herein, and no warranty, representation, or other legal commitment or obligation is being provided by NetApp. Â© 2025 NetApp, Inc. All rights reserved. No portions of this document may be reproduced without prior written consent of NetApp, Inc.

 ©  NetApp

Have feedback for our website?
[Let us know](https://www.netapp.com/forms/site-feedback/)



=== Content from www.talosintelligence.com_e29aee83_20250125_192620.html ===


* [Cisco Login](/users/auth/saml)

* [Intelligence Center](/reputation)

  + [# Intelligence Center](/reputation)
  + BACK
  + [Intelligence Search](/reputation_center)
  + [Email & Spam Trends](/reputation_center/email_rep)
* [Vulnerability Research](/vulnerability_info)

  + [# Vulnerability Research](/vulnerability_info)
  + BACK
  + [Vulnerability Reports](/vulnerability_reports)
  + [Microsoft Advisories](/ms_advisories)
* [Incident Response](/incident_response)

  + [# Incident Response](/incident_response)
  + BACK
  + [Reactive Services](/incident_response/services#reactive-services)
  + [Proactive Services](/incident_response/services#proactive-services)
  + Emergency Support
* [Blog](https://blog.talosintelligence.com)
* [Support](https://support.talosintelligence.com)

More

* Security Resources

  # Security Resources

  + BACK
  Security Resources
  + [Open Source Security Tools](/software)
  + [Intelligence Categories Reference](/categories)
  + [Secure Endpoint Naming Reference](/secure-endpoint-naming)
* Media

  # Media

  + BACK
  Media
  + [Talos Intelligence Blog](https://blog.talosintelligence.com)
  + [Threat Source Newsletter](https://blog.talosintelligence.com/category/threat-source-newsletter/)
  + [Beers with Talos Podcast](/podcasts/shows/beers_with_talos)
  + [Talos Takes Podcast](/podcasts/shows/talos_takes)
  + [Talos Videos](https://www.youtube.com/channel/UCPZ1DtzQkStYBSG3GTNoyfg/featured)
* Company

  # Company

  + BACK
  Company
  + [About Talos](/about)
  + [Careers](/careers)

* Under Attack?
* [Cisco Login](/users/auth/saml)

## Contact Cisco Talos Incident Response

×

Close

This form is for Incident Response service inquiries only, including emergency network security needs.

For reputation or categorization inquiries, visit the [Talos Support site](/support).
For emergency DDoS mitigation assistance, please contact the [Cisco Secure DDoS Protection Team](https://www.cisco.com/c/en/us/products/collateral/security/ddos-emergency-attack-mitigation-aag.pdf).

Name

Company (optional)

Email address

Phone number

Preferred communication:

Email

Phone

What Incident Response Service are you interested in?
General Talos IR services and retainer information
Emergency Response
IR Plan
IR Playbooks
IR Readiness Assessment
Tabletop Exercises
Compromise Assessment
Threat Hunting
Cyber Range Training
Intelligence on Demand

Please provide as much detail as possible so we can best address your needs

I acknowledge that this is an inquiry for Incident Response services and that any other use of this form will not receive a response.

Send Email
Cancel

# Talos Vulnerability Report

### TALOS-2015-0052

## Network Time Protocol ntpd multiple integer overflow read access violations

##### October 21, 2015

##### CVE Number

CVE-2015-7848

##### Description

When processing a specially crafted private mode packet, an integer overflow can
occur leading to out of bounds memory copy operation. The crafted packet needs to
have the correct message authentication code and a valid timestamp. When processed
by the NTP daemon, it leads to an immediate crash.

##### Tested Versions

ntp-dev.4.3.70

##### Product URLs

<http://www.ntp.org>

##### Details

While parsing a private mode packet with a request code of RESET\_PEER (0x16) two
values 16 bit big endian values from the packet are interpreted as number of items
and size of item respectively. A faulty check on the number of items ends up
decrementing the value which is later used in a second check. If the initial value
was zero, the decremented value will be 65535 leading to a crash in a while loop.

##### Technical Information

With a request code of RESET\_PEER, the function reset\_peer() is reached

```
  reset_peer - clear a peer's statistics

static void
reset_peer(
    sockaddr_u srcadr,
    endpt inter,
    struct req_pkt inpkt
    )
{
    u_short			items;
    size_t			item_sz;
    char 			datap;
    struct conf_unpeer	cp;
    struct peer 		p;
    sockaddr_u		peeraddr;
    int			bad;

```

We check first to see that every peer exists. If not, we return an error.

```
    items = INFO_NITEMS(inpkt-err_nitems);								[1]
    item_sz = INFO_ITEMSIZE(inpkt-mbz_itemsize); 						[2]
    datap = inpkt-u.data;
    if (item_sz  sizeof(cp)) {
        req_ack(srcadr, inter, inpkt, INFO_ERR_FMT);
        return;
    }

    bad = FALSE;
    while (items--  0 && !bad) { 										[3]
        ZERO(cp);
        memcpy(&cp, datap, item_sz);
        ZERO_SOCK(&peeraddr);
        if (client_v6_capable && cp.v6_flag) {
            AF(&peeraddr) = AF_INET6;
            SOCK_ADDR6(&peeraddr) = cp.peeraddr6;
        } else {
            AF(&peeraddr) = AF_INET;
            NSRCADR(&peeraddr) = cp.peeraddr;
        }

#ifdef ISC_PLATFORM_HAVESALEN
        peeraddr.sa.sa_len = SOCKLEN(&peeraddr);
#endif
        p = findexistingpeer(&peeraddr, NULL, NULL, -1, 0);
        printf(%d %dn, bad,  p);
        if (NULL == p)
            bad++;
        datap += item_sz;
    }

    if (bad) {
        req_ack(srcadr, inter, inpkt, INFO_ERR_NODATA);
        return;
    }

```

Now do it in earnest.

```
datap = inpkt-u.data;
    while (items--  0) {
    [4]
        ZERO(cp);
        memcpy(&cp, datap, item_sz);
        ZERO_SOCK(&peeraddr);
        if (client_v6_capable && cp.v6_flag) {
            AF(&peeraddr) = AF_INET6;
            SOCK_ADDR6(&peeraddr) = cp.peeraddr6;
        } else {
            AF(&peeraddr) = AF_INET;
            NSRCADR(&peeraddr) = cp.peeraddr;
        }
        SET_PORT(&peeraddr, 123);
#ifdef ISC_PLATFORM_HAVESALEN
        peeraddr.sa.sa_len = SOCKLEN(&peeraddr);
#endif
        p = findexistingpeer(&peeraddr, NULL, NULL, -1, 0);
        while (p != NULL) {
            peer_reset(p);
            p = findexistingpeer(&peeraddr, NULL, p, -1, 0);
        }
        datap += item_sz;
    }

    req_ack(srcadr, inter, inpkt, INFO_OKAY);
}

```

At [1] the number of items is derived and the size of each item at [2]. Size can be either 4 of 24.
At [3], a check is being made to ensure ‘items’ is greated than zero. If it’s not, the check
fails and the code never enters the while loop. At [4], the same check is performed again, but
because of the postdecrement operator at [3], the value in ‘items’ is now already decremented by one.

In case the initial value of ‘items’ was 0, the first check will fail, but the post decrement
operator will decremet this value thus overflowing the integer. New value of ‘items’ will be
65535 when it reaches [4], passing the check and entering the while loop.
A crash occures on memcpy when ‘datap’ pointer is incremented past the allocated memory.

Size of the ‘memcpy’ is limited to either 4 of 24, and the destination buffer is always
large enough, thus limiting this issue to an out of bounds read leading to sudden termination
of the process.

The similar condition occurs inside do\_restrict() function, which can be triggered with a packet
with different opcode (0x12 for example) and different size value (0x0c for example)

```
static void
do_restrict(
    sockaddr_u srcadr,
    endpt inter,
    struct req_pkt inpkt,
    int op
    )
{
    char 			datap;
    struct conf_restrict	cr;
    u_short			items;
    size_t			item_sz;
    sockaddr_u		matchaddr;
    sockaddr_u		matchmask;
    int			bad;

```

Do a check of the flags to make sure that only the NTPPORT flag is set, if any. If not, complain about it. Note we are very picky here.

```
    items = INFO_NITEMS(inpkt-err_nitems); 					[1]
    item_sz = INFO_ITEMSIZE(inpkt-mbz_itemsize);
    datap = inpkt-u.data;
    if (item_sz  sizeof(cr)) {
        req_ack(srcadr, inter, inpkt, INFO_ERR_FMT);
        return;
    }

    bad = FALSE;
    while (items--  0 && !bad) {								[2]
        memcpy(&cr, datap, item_sz);
        cr.flags = ntohs(cr.flags);
        cr.mflags = ntohs(cr.mflags);
        if (~RESM_NTPONLY & cr.mflags)
            bad = 1;
        if (~RES_ALLFLAGS & cr.flags)
            bad = 2;
        if (INADDR_ANY != cr.mask) {
            if (client_v6_capable && cr.v6_flag) {
                if (IN6_IS_ADDR_UNSPECIFIED(&cr.addr6))
                    bad = 4;
            } else {
                if (INADDR_ANY == cr.addr)
                    bad = 8;
            }
        }
        datap += item_sz;
    }

    if (bad) {
        msyslog(LOG_ERR, do_restrict bad = %#x, bad);
        req_ack(srcadr, inter, inpkt, INFO_ERR_FMT);
        return;
    }

```

Looks okay, try it out

```
    	ZERO_SOCK(&matchaddr);
    	ZERO_SOCK(&matchmask);
    	datap = inpkt-u.data;

    	while (items--  0) { 									[3]
    		memcpy(&cr, datap, item_sz);
    		cr.flags = ntohs(cr.flags);
    		cr.mflags = ntohs(cr.mflags);
    		if (client_v6_capable && cr.v6_flag) {
    			AF(&matchaddr) = AF_INET6;
    			AF(&matchmask) = AF_INET6;
    			SOCK_ADDR6(&matchaddr) = cr.addr6;
    			SOCK_ADDR6(&matchmask) = cr.mask6;
    		} else {
    			AF(&matchaddr) = AF_INET;
    			AF(&matchmask) = AF_INET;
    			NSRCADR(&matchaddr) = cr.addr;
    			NSRCADR(&matchmask) = cr.mask;
    		}
    		hack_restrict(op, &matchaddr, &matchmask, cr.mflags,
    			      cr.flags, 0);
    		datap += item_sz;
    	}

    	req_ack(srcadr, inter, inpkt, INFO_OKAY);
    }

```

Same as in reset\_peer(), at [1] the ‘items’ value is derived, at [2] it is checked against zero
and decremented, and at [3], the decremented value is used in a check again.

Both of these issues can be triggered by the supplied proof of concept code which contains
two payloads, for each of the vulnerabilities.

The vulnerabilities can be triggered in the latest version of ntpd with the supplied configuration files
that set up proper keys and options as the vulnerabilities are only reachable with proper authentication.

##### Credit

Aleksandar Nikolic of Cisco Talos

---

[Vulnerability Reports](/vulnerability_reports) [Next Report

TALOS-2015-0054](/vulnerability_reports/TALOS-2015-0054) [Previous Report

TALOS-2015-0035](/vulnerability_reports/TALOS-2015-0035)

* + ###### [Intelligence Center](/reputation)
  + [Intelligence Search](/reputation_center)
  + [Email & Spam Trends](/reputation_center/email_rep)
* + ###### [Vulnerability Research](/vulnerability_info)
  + [Vulnerability Reports](/vulnerability_reports)
  + [Microsoft Advisories](/ms_advisories)
* + ###### [Incident Response](/incident_response)
  + [Reactive Services](/incident_response/services#reactive-services)
  + [Proactive Services](/incident_response/services#proactive-services)
  + Emergency Support
* + ###### Security Resources
  + [Open Source Security Tools](/software)
  + [Intelligence Categories Reference](/categories)
  + [Secure Endpoint Naming Reference](/secure-endpoint-naming)
* + ###### Media
  + [Talos Intelligence Blog](https://blog.talosintelligence.com)
  + [Threat Source Newsletter](https://blog.talosintelligence.com/category/threat-source-newsletter/)
  + [Beers with Talos Podcast](/podcasts/shows/beers_with_talos)
  + [Talos Takes Podcast](/podcasts/shows/talos_takes)
  + [Talos Videos](https://www.youtube.com/channel/UCPZ1DtzQkStYBSG3GTNoyfg/featured)
* + ###### Support
  + [Support Documentation](https://support.talosintelligence.com)
* + ###### Company
  + [About Talos](/about)
  + [Careers](/careers)
  + [Cisco Security](https://www.cisco.com/c/en/us/products/security/product-listing.html)

###### Follow us

[![Cisco](/assets/logo_cisco_white-d87b7f7d3152ad412e48aad924a972cc5b802b7a53cb56b0792a4456c9b7b3a5.svg)](http://tools.cisco.com/security/center/home.x)

©
2025
Cisco Systems, Inc. and/or its affiliates. All rights
reserved. View our
[Privacy Policy.](http://www.cisco.com/web/siteassets/legal/privacy_full.html)


