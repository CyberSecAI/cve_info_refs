=== Content from arxiv.org_396de9af_20250125_031558.html ===

[Skip to main content](#content)

[![Cornell University](/static/browse/0.3.4/images/icons/cu/cornell-reduced-white-SMALL.svg)](https://www.cornell.edu/)

In just 3 minutes help us improve arXiv:

[Annual Global Survey](https://cornell.ca1.qualtrics.com/jfe/form/SV_6m22mbqW9GQ3pQO)
We gratefully acknowledge support from the Simons Foundation, [member institutions](https://info.arxiv.org/about/ourmembers.html), and all contributors.
[Donate](https://info.arxiv.org/about/donate.html)

[![arxiv logo](/static/browse/0.3.4/images/arxiv-logo-one-color-white.svg)](/) > [cs](/list/cs/recent) > arXiv:1502.07373

[Help](https://info.arxiv.org/help) | [Advanced Search](https://arxiv.org/search/advanced)

All fields
Title
Author
Abstract
Comments
Journal reference
ACM classification
MSC classification
Report number
arXiv identifier
DOI
ORCID
arXiv author ID
Help pages
Full text

Search

[![arXiv logo](/static/browse/0.3.4/images/arxiv-logomark-small-white.svg)](https://arxiv.org/)
[![Cornell University Logo](/static/browse/0.3.4/images/icons/cu/cornell-reduced-white-SMALL.svg)](https://www.cornell.edu/)
open search

GO

open navigation menu
## quick links

* [Login](https://arxiv.org/login)
* [Help Pages](https://info.arxiv.org/help)
* [About](https://info.arxiv.org/about)

# Computer Science > Cryptography and Security

**arXiv:1502.07373** (cs)

[Submitted on 25 Feb 2015 ([v1](https://arxiv.org/abs/1502.07373v1)), last revised 1 Mar 2015 (this version, v2)]
# Title:The Spy in the Sandbox -- Practical Cache Attacks in Javascript

Authors:[Yossef Oren](https://arxiv.org/search/cs?searchtype=author&query=Oren,+Y), [Vasileios P. Kemerlis](https://arxiv.org/search/cs?searchtype=author&query=Kemerlis,+V+P), [Simha Sethumadhavan](https://arxiv.org/search/cs?searchtype=author&query=Sethumadhavan,+S), [Angelos D. Keromytis](https://arxiv.org/search/cs?searchtype=author&query=Keromytis,+A+D) View a PDF of the paper titled The Spy in the Sandbox -- Practical Cache Attacks in Javascript, by Yossef Oren and 2 other authors
[View PDF](/pdf/1502.07373)
> Abstract:We present the first micro-architectural side-channel attack which runs entirely in the browser. In contrast to other works in this genre, this attack does not require the attacker to install any software on the victim's machine -- to facilitate the attack, the victim needs only to browse to an untrusted webpage with attacker-controlled content. This makes the attack model highly scalable and extremely relevant and practical to today's web, especially since most desktop browsers currently accessing the Internet are vulnerable to this attack. Our attack, which is an extension of the last-level cache attacks of Yarom et al., allows a remote adversary recover information belonging to other processes, other users and even other virtual machines running on the same physical host as the victim web browser. We describe the fundamentals behind our attack, evaluate its performance using a high bandwidth covert channel and finally use it to construct a system-wide mouse/network activity logger. Defending against this attack is possible, but the required countermeasures can exact an impractical cost on other benign uses of the web browser and of the computer.

| Subjects: | Cryptography and Security (cs.CR); Networking and Internet Architecture (cs.NI) |
| --- | --- |
| Cite as: | [arXiv:1502.07373](https://arxiv.org/abs/1502.07373) [cs.CR] |
|  | (or  [arXiv:1502.07373v2](https://arxiv.org/abs/1502.07373v2) [cs.CR] for this version) |
|  | <https://doi.org/10.48550/arXiv.1502.07373>  Focus to learn more    arXiv-issued DOI via DataCite |

## Submission history

From: Yossef Oren [[view email](/show-email/9fd0e2a6/1502.07373)]
 **[[v1]](/abs/1502.07373v1)**
Wed, 25 Feb 2015 21:25:49 UTC (940 KB)

**[v2]**
Sun, 1 Mar 2015 22:58:28 UTC (939 KB)

Full-text links:
## Access Paper:

View a PDF of the paper titled The Spy in the Sandbox -- Practical Cache Attacks in Javascript, by Yossef Oren and 2 other authors* [View PDF](/pdf/1502.07373)
* [TeX Source](/src/1502.07373)
* [Other Formats](/format/1502.07373)

[view license](http://arxiv.org/licenses/nonexclusive-distrib/1.0/ "Rights to this article")

Current browse context: cs.CR
[< prev](/prevnext?id=1502.07373&function=prev&context=cs.CR "previous in cs.CR (accesskey p)")

  |
[next >](/prevnext?id=1502.07373&function=next&context=cs.CR "next in cs.CR (accesskey n)")

[new](/list/cs.CR/new)
 |
[recent](/list/cs.CR/recent)
 | [2015-02](/list/cs.CR/2015-02)
Change to browse by:
[cs](/abs/1502.07373?context=cs)

[cs.NI](/abs/1502.07373?context=cs.NI)

### References & Citations

* [NASA ADS](https://ui.adsabs.harvard.edu/abs/arXiv%3A1502.07373)
* [Google Scholar](https://scholar.google.com/scholar_lookup?arxiv_id=1502.07373)
* [Semantic Scholar](https://api.semanticscholar.org/arXiv%3A1502.07373)

### [DBLP](https://dblp.uni-trier.de) - CS Bibliography

[listing](https://dblp.uni-trier.de/db/journals/corr/corr1502.html#OrenKSK15 "listing on DBLP") | [bibtex](https://dblp.uni-trier.de/rec/bibtex/journals/corr/OrenKSK15 "DBLP bibtex record")
[Yossef Oren](https://dblp.uni-trier.de/search/author?author=Yossef%20Oren "DBLP author search")

[a](/static/browse/0.3.4/css/cite.css)
export BibTeX citation
Loading...

## BibTeX formatted citation

×

loading...

Data provided by:

### Bookmark

[![BibSonomy logo](/static/browse/0.3.4/images/icons/social/bibsonomy.png)](http://www.bibsonomy.org/BibtexHandler?requTask=upload&url=https://arxiv.org/abs/1502.07373&description=The Spy in the Sandbox -- Practical Cache Attacks in Javascript "Bookmark on BibSonomy")
[![Reddit logo](/static/browse/0.3.4/images/icons/social/reddit.png)](https://reddit.com/submit?url=https://arxiv.org/abs/1502.07373&title=The Spy in the Sandbox -- Practical Cache Attacks in Javascript "Bookmark on Reddit")

Bibliographic Tools
# Bibliographic and Citation Tools

Bibliographic Explorer Toggle

Bibliographic Explorer *([What is the Explorer?](https://info.arxiv.org/labs/showcase.html#arxiv-bibliographic-explorer))*

Connected Papers Toggle

Connected Papers *([What is Connected Papers?](https://www.connectedpapers.com/about))*

Litmaps Toggle

Litmaps *([What is Litmaps?](https://www.litmaps.co/))*

scite.ai Toggle

scite Smart Citations *([What are Smart Citations?](https://www.scite.ai/))*

Code, Data, Media
# Code, Data and Media Associated with this Article

alphaXiv Toggle

alphaXiv *([What is alphaXiv?](https://alphaxiv.org/))*

Links to Code Toggle

CatalyzeX Code Finder for Papers *([What is CatalyzeX?](https://www.catalyzex.com))*

DagsHub Toggle

DagsHub *([What is DagsHub?](https://dagshub.com/))*

GotitPub Toggle

Gotit.pub *([What is GotitPub?](http://gotit.pub/faq))*

Huggingface Toggle

Hugging Face *([What is Huggingface?](https://huggingface.co/huggingface))*

Links to Code Toggle

Papers with Code *([What is Papers with Code?](https://paperswithcode.com/))*

ScienceCast Toggle

ScienceCast *([What is ScienceCast?](https://sciencecast.org/welcome))*

Demos
# Demos

Replicate Toggle

Replicate *([What is Replicate?](https://replicate.com/docs/arxiv/about))*

Spaces Toggle

Hugging Face Spaces *([What is Spaces?](https://huggingface.co/docs/hub/spaces))*

Spaces Toggle

TXYZ.AI *([What is TXYZ.AI?](https://txyz.ai))*

Related Papers
# Recommenders and Search Tools

Link to Influence Flower

Influence Flower *([What are Influence Flowers?](https://influencemap.cmlab.dev/))*

Core recommender toggle

CORE Recommender *([What is CORE?](https://core.ac.uk/services/recommender))*

* Author
* Venue
* Institution
* Topic

About arXivLabs

# arXivLabs: experimental projects with community collaborators

arXivLabs is a framework that allows collaborators to develop and share new arXiv features directly on our website.

Both individuals and organizations that work with arXivLabs have embraced and accepted our values of openness, community, excellence, and user data privacy. arXiv is committed to these values and only works with partners that adhere to them.

Have an idea for a project that will add value for arXiv's community? [**Learn more about arXivLabs**](https://info.arxiv.org/labs/index.html).

[Which authors of this paper are endorsers?](/auth/show-endorsers/1502.07373) |
Disable MathJax ([What is MathJax?](https://info.arxiv.org/help/mathjax.html))

* [About](https://info.arxiv.org/about)
* [Help](https://info.arxiv.org/help)

* contact arXivClick here to contact arXiv
   [Contact](https://info.arxiv.org/help/contact.html)
* subscribe to arXiv mailingsClick here to subscribe
   [Subscribe](https://info.arxiv.org/help/subscribe)

* [Copyright](https://info.arxiv.org/help/license/index.html)
* [Privacy Policy](https://info.arxiv.org/help/policies/privacy_policy.html)

* [Web Accessibility Assistance](https://info.arxiv.org/help/web_accessibility.html)
* [arXiv Operational Status](https://status.arxiv.org)

  Get status notifications via
  [email](https://subscribe.sorryapp.com/24846f03/email/new)
  or [slack](https://subscribe.sorryapp.com/24846f03/slack/new)



=== Content from bugzilla.mozilla.org_8598f6bf_20250125_031600.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/1153672)
* [XML](/show_bug.cgi?ctype=xml&id=1153672)

Closed
[Bug 1153672](/show_bug.cgi?id=1153672)

Opened 10 years ago
Closed 10 years ago

# Fingerprinting individuals via performance.now()

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Fingerprinting individuals via performance.now()

## Categories

### (Core :: DOM: Core & HTML, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=DOM%3A%20Core%20%26%20HTML#DOM%3A%20Core%20%26%20HTML)

DOM: Core & HTML
▾

Core :: DOM: Core & HTML
Issues in DOM tree [https://dom.spec.whatwg.org](https://dom.spec.whatwg.org/) & HTML [https://html.spec.whatwg.org](https://html.spec.whatwg.org/) that do not fit into any other DOM or HTML component or which span multiple DOM or HTML components.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=DOM%3A%20Core%20%26%20HTML&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=DOM%3A%20Core%20%26%20HTML&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=DOM%3A%20Core%20%26%20HTML)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

unspecified

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

x86

All

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

normal

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla42

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Webcompat Priority | --- |
| --- | --- |
| Accessibility Severity | --- |
| a11y-review | --- |
| Performance Impact | --- |
| Webcompat Score | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox40 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox40&o1=equals&v1=wontfix) |
| firefox41 | --- | [fixed](/buglist.cgi?f1=cf_status_firefox41&o1=equals&v1=fixed) |
| firefox42 | --- | [fixed](/buglist.cgi?f1=cf_status_firefox42&o1=equals&v1=fixed) |
| firefox-esr31 | --- | [unaffected](/buglist.cgi?f1=cf_status_firefox_esr31&o1=equals&v1=unaffected) |
| firefox-esr38 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox_esr38&o1=equals&v1=wontfix) |
| b2g-v2.0 | --- | [unaffected](/buglist.cgi?f1=cf_status_b2g_2_0&o1=equals&v1=unaffected) |
| b2g-v2.0M | --- | [unaffected](/buglist.cgi?f1=cf_status_b2g_2_0m&o1=equals&v1=unaffected) |
| b2g-v2.1 | --- | [wontfix](/buglist.cgi?f1=cf_status_b2g_2_1&o1=equals&v1=wontfix) |
| b2g-v2.1S | --- | [wontfix](/buglist.cgi?f1=cf_status_b2g_2_1_s&o1=equals&v1=wontfix) |
| b2g-v2.2 | --- | [affected](/buglist.cgi?f1=cf_status_b2g_2_2&o1=equals&v1=affected) |
| b2g-v2.2r | --- | [affected](/buglist.cgi?f1=cf_status_b2g_2_2r&o1=equals&v1=affected) |
| b2g-master | --- | [fixed](/buglist.cgi?f1=cf_status_b2g_master&o1=equals&v1=fixed) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox40 |  | wontfix |
| firefox41 |  | fixed |
| firefox42 |  | fixed |
| firefox-esr31 |  | unaffected |
| firefox-esr38 |  | wontfix |
| b2g-v2.0 |  | unaffected |
| b2g-v2.0M |  | unaffected |
| b2g-v2.1 |  | wontfix |
| b2g-v2.1S |  | wontfix |
| b2g-v2.2 |  | affected |
| b2g-v2.2r |  | affected |
| relnote-firefox |  | --- |
| b2g-master |  | fixed |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: dveditz, Assigned: bzbarsky)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](extensions/Gravatar/web/default.jpg)  [bzbarsky](/user_profile?user_id=20209)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/da6b54ad3fdb36ba7656df9adfe65d12?d=mm&size=40)  [dveditz](/user_profile?user_id=1689)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/5111b810214a00377104f5ad3efefa26?d=mm&size=40)  [sefeng](/user_profile?user_id=625922)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

16 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

[1167489](/show_bug.cgi?id=1167489 "RESOLVED FIXED - \"Spy in the Sandbox\" - Security issue related to High Resolution Time API")

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

Dependency [tree](/showdependencytree.cgi?id=1153672&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=1153672)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

[1167489](/show_bug.cgi?id=1167489 "RESOLVED FIXED - \"Spy in the Sandbox\" - Security issue related to High Resolution Time API")

## Details

### (Keywords: privacy, sec-low, Whiteboard: [post-critsmash-triage][adv-main41+][fingerprinting])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[privacy](/buglist.cgi?keywords=privacy&resolution=---),
[sec-low](/buglist.cgi?keywords=sec-low&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[post-critsmash-triage][adv-main41+][fingerprinting]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (2 files, 1 obsolete file)

| [Multiple Browsers Performance object leaks the Windows performance counter frequency](/attachment.cgi?id=8591392)  [10 years ago](#c0)  [Daniel Veditz [:dveditz]](/user_profile?user_id=1689)   233.62 KB, application/pdf |  | [Details](/attachment.cgi?id=8591392&action=edit) |
| --- | --- | --- |
| [PoC from paper](/attachment.cgi?id=8591393)  [10 years ago](#c1)  [Daniel Veditz [:dveditz]](/user_profile?user_id=1689)   498 bytes, text/html |  | [Details](/attachment.cgi?id=8591393&action=edit) |
| [measure performance counter frequency](/attachment.cgi?id=8591398)  [10 years ago](#c2)  [Daniel Veditz [:dveditz]](/user_profile?user_id=1689)   866 bytes, text/html |  | [Details](/attachment.cgi?id=8591398&action=edit) |

Show Obsolete

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=1153672#c0)• 10 years ago |
|  | |

Attached file
[Multiple Browsers Performance object leaks the Windows performance counter frequency](attachment.cgi?id=8591392)
— [Details](attachment.cgi?id=8591392&action=edit)

Amit Klein is working on research that shows it's possible to extract the Windows counter frequency using the Windows.performance.now() high-resolution timer, and that this value is consistent between Firefox and IE. He doesn't mention Chrome which also supports this now-standard feature (<http://www.w3.org/TR/hr-time>) so it's unclear if the technique doesn't work on Chrome or if he simply didn't test it.
Amit is able to detect two families of VM by their characteristic frequency, and between two machines of the same nominal clock speed there can be a detectable and consistent skew that raises fingerprinting worries.
He has also reported this to Microsoft and we should coordinate any disclosures through Amit to make sure everyone's on the same page.

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689)  Reporter |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=1153672#c1)• 10 years ago |
|  | |

Attached file
[PoC from paper](attachment.cgi?id=8591393) (obsolete)
— [Details](attachment.cgi?id=8591393&action=edit)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689)  Reporter |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=1153672#c2)• 10 years ago |
|  | |

Attached file
[measure performance counter frequency](attachment.cgi?id=8591398)
— [Details](attachment.cgi?id=8591398&action=edit)

This version is a little easier to play with than the bare-bones one from the paper. I get pretty wide fluctuations in measurement if you only do 10 loops, but if you increase it to 100 or 1000 it starts settling down (still very fast to calculate). So far I've only tested on a Mac while the paper is talking about the Windows implementation so I may get better results when I try it there.
[Attachment #8591393](/attachment.cgi?id=8591393&action=edit "PoC from paper") -
Attachment is obsolete: true

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689)  Reporter |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=1153672#c3)• 10 years ago |
|  | |

On windows I do get exactly the same result on Firefox and IE, and 10 loops is plenty.
Chrome gives me completely different results but fairly close values between my Mac and Windows physical machines (right around 1 million Hz, whereas the Firefox values are quite different as I'd expect from the different hardware (2.2M on windows, ~10M on Mac).

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689)  Reporter |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=1153672#c4)• 10 years ago |
|  | |

sorry, the answers I'm getting on Mac are more like 100M Hz. I'm not sure I believe that.

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=1153672#c5)• 10 years ago |
|  | |

On Mac, it will really depend on exactly what API TimeStamp::Now uses and what its resolution is.
On Mac we use mach\_absolute\_time for that. The documentation claims that this does in fact have CPU-dependent resolution, but not what it would be in terms of CPU frequency.
I haven't managed to figure out where in Blink's source (if at all) the monotonic timer lives; Platform.h just has a virtual function that always returns 0, and it's possible the implementation is part of Chrome, not Blink.
That all said, is this really worse than just extracting the raw CPU clock speed, which I bet you can do reasonably reliably by just writing a JS busy-loop and timing it?

|  | [Amit Klein](/user_profile?user_id=536568) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=1153672#c6)• 10 years ago |
|  | |

Regarding the previous comment:
1. I doubt you can get the kind of accuracy the advisory describes (few ppm) by timing JS busy loop, what with other processes/threads running on the same core and present day varying CPU clock speed. Accurate measurement helps telling apart non-TSC based clocks from TSC-based clock (see below) as well as enabling discernment of different machines running the same CPU clock speed (there's an example in the advisory of telling apart two machines with clock speed of 3.4GHz).
2. I should have clarified this in the advisory, but when the performance counter source is not the TSC timer (bur rather HPET or APIC timer), then the CPU clock speed cannot be derived from it (and vice versa). So measuring the CPU speed via JS busy loop cannot help to tell apart these cases - i.e. you can't tell TSC from HPET or APIC.
3. Busy loop has adverse impact on the "user" experience, this is much more visible than this method.

|  | [Amit Klein](/user_profile?user_id=536568) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=1153672#c7)• 10 years ago |
|  | |

Regarding Google Chrome - the advisory doesn't mention it because Chrome is not vulnerable (at least not on Windows) - it provide time measurements in units of exactly 1 microsecond. So the performance counter frequency cannot be inferred.

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=1153672#c8)• 10 years ago |
|  | |

We \_could\_ round off performance.now() values to the nearest us. It seems a little unfortunate to lose so much precision, though.

|  | [Amit Klein](/user_profile?user_id=536568) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=1153672#c9)• 10 years ago |
|  | |

Arguably you're not losing a lot of precision. Given that on most machines the source timer is TSC, with typical frequency ranging in 1MHz-4MHz, you lose less than 2 bits (again - typically).

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1153672#a766161_1689)• 10 years ago |

Keywords: [sec-low](/buglist.cgi?keywords=sec-low&resolution=---)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689)  Reporter |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=1153672#c10)• 10 years ago |
|  | |

Note: the "low" rating is relative to \_security\_ bugs--no one's going to get malware from this. That does not mean it's a "low" \_privacy\_ problem. The fingerprintability is quite accurate on Windows machines but I don't know how that rates for the privacy team.

|  | [Amit Klein](/user_profile?user_id=536568) |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=1153672#c11)• 10 years ago |
|  | |

I got permission to share with you the following quick update from Microsoft (MSRC):
We [Microsoft] are working on a fix [...] the contact info for the issue of this case [is] (email secure@microsoft.com with the subject containing "[21897mp]"

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=1153672#c12)• 10 years ago |
|  | |

Did they indicate what their planned fix is? Seems to me like whatever the fix is should just get standardized...

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=1153672#c13)• 10 years ago |
|  | |

Also, in [comment 7](/show_bug.cgi?id=1153672#c7 "RESOLVED FIXED - Fingerprinting individuals via performance.now()") there was mention that Chrome provides performance measurements in units of 1us. That's not exactly what I'm seeing in Chrome; it looks like it's rounding to the nearest us but then also adding a bit of noise in the several-percent-of-a-nanosecond range or something. I did check that this is not just rounding errors from float-to-double conversions of non-representable values or something; the numbers Chrome is logging don't correspond to double values of representable floats.... Maybe it's some artifact of how they do their rounding.

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=1153672#c14)• 10 years ago |
|  | |

So for what it's worth, I tried the obvious thing: instead of returning the value we return now from now(), return round(value \* 1000)/1000.
As expected, this makes calls to now() significantly slower (at least on Mac); it's about a 30% regression. That might be ok; the result is still faster than Chrome. It's definitely slower than Safari, though (and just looking at performance.now() values in Safari shows they're not doing any sort of rounding to the nearest us.
It would be good to understand what the actual threat model here is and in particular whether it's windows-only or applicable to other OSes based on the now() implementations we use there...

|  | [Amit Klein](/user_profile?user_id=536568) |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=1153672#c15)• 10 years ago |
|  | |

(In reply to Not doing reviews right now from [comment #12](/show_bug.cgi?id=1153672#c12 "RESOLVED FIXED - Fingerprinting individuals via performance.now()"))
> Did they indicate what their planned fix is? Seems to me like whatever the
> fix is should just get standardized...
Nope, I have no info on their proposed solution, sorry.

|  | [Amit Klein](/user_profile?user_id=536568) |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=1153672#c16)• 10 years ago |
|  | |

(In reply to Not doing reviews right now from [comment #14](/show_bug.cgi?id=1153672#c14 "RESOLVED FIXED - Fingerprinting individuals via performance.now()"))
> So for what it's worth, I tried the obvious thing: instead of returning the
> value we return now from now(), return round(value \* 1000)/1000.
>
> As expected, this makes calls to now() significantly slower (at least on
> Mac); it's about a 30% regression. That might be ok; the result is still
> faster than Chrome. It's definitely slower than Safari, though (and just
> looking at performance.now() values in Safari shows they're not doing any
> sort of rounding to the nearest us.
>
> It would be good to understand what the actual threat model here is and in
> particular whether it's windows-only or applicable to other OSes based on
> the now() implementations we use there...
Would using 1024 instead of 1000 improve things? I mean, there's nothing magical about sticking to 1000. Maybe do the whole thing over integers with resolution 2^20 (1048576)?

|  | [Amit Klein](/user_profile?user_id=536568) |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=1153672#c17)• 10 years ago |
|  | |

(In reply to Not doing reviews right now from [comment #13](/show_bug.cgi?id=1153672#c13 "RESOLVED FIXED - Fingerprinting individuals via performance.now()"))
> Also, in [comment 7](/show_bug.cgi?id=1153672#c7 "RESOLVED FIXED - Fingerprinting individuals via performance.now()") there was mention that Chrome provides performance
> measurements in units of 1us. That's not exactly what I'm seeing in Chrome;
> it looks like it's rounding to the nearest us but then also adding a bit of
> noise in the several-percent-of-a-nanosecond range or something. I did
> check that this is not just rounding errors from float-to-double conversions
> of non-representable values or something; the numbers Chrome is logging
> don't correspond to double values of representable floats.... Maybe it's
> some artifact of how they do their rounding.
I don't have an explanation to what you see there. I did try to follow the call tree for Perfomance::now() in Chromium, and eventually got to QPCValueToTimeDelta()(at [https://chromium.googlesource.com/chromium/src.git/+/master/base/time/time\_win.cc](https://chromium.googlesource.com/chromium/src.git/%2B/master/base/time/time_win.cc)) which contains the following code (this is but a single branch...):
return TimeDelta::FromMicroseconds(
qpc\_value \* Time::kMicrosecondsPerSecond / g\_qpc\_ticks\_per\_second);
I'll try to experiment with a live code later today.

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=1153672#c18)• 10 years ago |
|  | |

> Would using 1024 instead of 1000 improve things?
Not really, because it's the round() call that's slow.
> I mean, there's nothing magical about sticking to 1000.
But there is. The spec requires performance.now() to have at least microsecond accuracy. Using 1024 would not provide that.
> Maybe do the whole thing over integers with resolution 2^20 (1048576)?
That would work if it were not for the fact that the underlying timing API I have is handing me back doubles. ;) Changing that will require a bit of surgery.

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=1153672#c19)• 10 years ago |
|  | |

So ok, I tried doing this by adding a ToRoundedMicroseconds() method on TimeDuration (which actually just rounds down; it doesn't do arithmetically correct rounding) and that seems to work acceptably both in terms of resulting behavior and performance. Assuming we're ok with the just rounding down behavior. Basically right now I'm doing:
(aTicks / kNsPerUs) \* sNsPerTick;
Where the division is an integer division (and the multiply is as doubles, since sNsPerTick is a double).
We could also do something like:
(aTicks / kNsPerUs + (aTicks % kNsPerUs >= kNsPerUs / 2)) \* sNsPerTick;
But note that both of those approaches lose a lot of precision if it happens that a tick is in fact smaller than a us. Not sure what tick sizes actually are on all our platforms yet. On Mac, sNsPerTick is 1.0, so at least there this would be viable.

|  | [Mike Perry](/user_profile?user_id=439514) |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=1153672#c20)• 10 years ago |
|  | |

FWIW, in the Tor Browser 5.0a1 release today, we decided to go with a more aggressive approach for testing by our alpha users. Our patch against Firefox 31.7.0 is here: <https://gitweb.torproject.org/tor-browser.git/commit/?h=tor-browser-31.7.0esr-5.0-1&id=dcd5fcc102a3eb19c20013542fa3ca399db66da4>
That patch reduces all content-facing time sources to at least 100ms resolution. The primary motivation for such a large resolution was keystroke fingerprinting. In fact, we additionally clip keypress events to 250ms resolution, to make any currently deployed versions of these attacks break. It also seemed best to go with an aggressively course resolution for all time sources as a first attempt, so that any breakage was more obvious.
I used floor() instead of round() to keep the timers monotonic. I imagine floor() should also be much quicker than round(), but monotonicity was the main reasoning for that choice.
We're calling on our users to specifically test HTML5 video, animations, and games. I'll update this bug if anyone reports any issues with this approach. Please also let me know if there are other types of sites we should look into.
I wrote this patch because we've long been worried about various ways that accurate time sources can be used to fingerprint users. In addition to the issues pointed out in this bug, there have also been a series of side channel attacks relating to SVG filters (with the most recent one demonstrating history sniffing: <http://cseweb.ucsd.edu/~dkohlbre/papers/subnormal.pdf>). Even more concerning, cache side channel attacks capable of performing cross-process data stealing and/or high capacity exfiltration were recently demonstrated in <http://arxiv.org/abs/1502.07373>. All of these recent side channel attacks rely on the high accuracy provided by performance.now(), but we decided to also clamp Date.now() and event timestamps to mitigate other forms of performance and behavioral fingerprinting.

|  | [Amit Klein](/user_profile?user_id=536568) |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=1153672#c21)• 10 years ago |
|  | |

(In reply to Amit Klein from [comment #17](/show_bug.cgi?id=1153672#c17 "RESOLVED FIXED - Fingerprinting individuals via performance.now()"))
> (In reply to Not doing reviews right now from [comment #13](/show_bug.cgi?id=1153672#c13 "RESOLVED FIXED - Fingerprinting individuals via performance.now()"))
> > Also, in [comment 7](/show_bug.cgi?id=1153672#c7 "RESOLVED FIXED - Fingerprinting individuals via performance.now()") there was mention that Chrome provides performance
> > measurements in units of 1us. That's not exactly what I'm seeing in Chrome;
> > it looks like it's rounding to the nearest us but then also adding a bit of
> > noise in the several-percent-of-a-nanosecond range or something. I did
> > check that this is not just rounding errors from float-to-double conversions
> > of non-representable values or something; the numbers Chrome is logging
> > don't correspond to double values of representable floats.... Maybe it's
> > some artifact of how they do their rounding.
>
> I don't have an explanation to what you see there. I did try to follow the
> call tree for Perfomance::now() in Chromium, and eventually got to
> QPCValueToTimeDelta()(at
> [https://chromium.googlesource.com/chromium/src.git/+/master/base/time/](https://chromium.googlesource.com/chromium/src.git/%2B/master/base/time/)
> time\_win.cc) which contains the following code (this is but a single
> branch...):
>
> return TimeDelta::FromMicroseconds(
> qpc\_value \* Time::kMicrosecondsPerSecond / g\_qpc\_ticks\_per\_second);
>
> I'll try to experiment with a live code later today.
Indeed, I got similar results to what you described, namely a "too high" inaccuracy.
I think I found the culprit. Long story short - this is an artifact of the fact that double not being an accurate representation of a real number. It just bites in a bit more tricky manner.
The full story is this: there's indeed a tiny, expected inaccuracy once the microseconds (internally kept as int64) are converted to double and divided by 1000000. The division results in a number that cannot be accurately expressed as a double, so let's assume there's an error in the order of magnitude of 2^(-54) of the value (we're talking about floating point architecture of course). Now, keep in mind that the value here de-facto represents the number of seconds since boot.
The last stage of calculating Performance::now() is subtracting m\_referenceTime, which is (I presume) a timestamp taken when the frame was started.
And therein lies the rub. The end result is a difference between two quantities that represent time since boot at two close points. When I tested it (and I suppose when you tested it as well), these values were around hundreds of thousands of seconds (in my case 160000sec - almost two days since boot), so the typical error here was 2^(-54)\*160000 =~= 10^(-11).
However, after subtraction, we get a value of order of magnitude of milliseconds, but with the same error, in other words, the error is "amplified", and instead of the "expected" 2^(-54) of the value, it becomes 10^(-11)/10^(-3)=10^(-8) =~= 2^(-27) of the value. In absolute terms, the error here, at the eleventh digit to the right of the decimal point, is in line with my empirical observation.
To double check this theory, I conducted another experiment. I rebooted my machine, and as soon as Windows came up, I retested. Now the typical value was 60-100 seconds, the typical error is more around 10^(-15) and indeed I got 3-4 additional zero digits before the inaccuracy kicked in.
Not sure how much of this is applicable to Mozilla, but just in case, you may want to keep it in mind.

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=1153672#c22)• 10 years ago |
|  | |

Thank you for figuring that out! If they round before subtracting, not after, that would totally explain what I was seeing.
We're storing all this stuff as int64 ticks until the last moment of conversion to double (and in particular, the subtraction is done on int64), so we wouldn't run into that problem.

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1153672#a3557764_20209)• 10 years ago |

See Also: → [1167489](/show_bug.cgi?id=1167489 "RESOLVED FIXED - \"Spy in the Sandbox\" - Security issue related to High Resolution Time API")

|  | [Amit Klein](/user_profile?user_id=536568) |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=1153672#c23)• 10 years ago |
|  | |

If [bug 1167489](/show_bug.cgi?id=1167489 "RESOLVED FIXED - \"Spy in the Sandbox\" - Security issue related to High Resolution Time API") (see previous comment) is relevant for me, can you please grant me access to it?

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=1153672#c24)• 10 years ago |
|  | |

Done.

|  | [Amit Klein](/user_profile?user_id=536568) |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=1153672#c25)• 10 years ago |
|  | |

Microsoft's MSRC just informed me that they WONT FIX. So no need to coordinate with Microsoft, but please do let \*me\* know what's the plan.

|  | [Amit Klein](/user_profile?user_id=536568) |  |
| --- | --- | --- |
| [Comment 26](/show_bug.cgi?id=1153672#c26)• 10 years ago |
|  | |

Would it be possible to release later this month (July)?

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 27](/show_bug.cgi?id=1153672#c27)• 10 years ago |
|  | |

We're not likely to have a fix shipping this month.
I think what we'll likely end up doing here is clamping the values to the nearest 5us; see discussion in [bug 1167489](/show_bug.cgi?id=1167489 "RESOLVED FIXED - \"Spy in the Sandbox\" - Security issue related to High Resolution Time API").

|  | [Amit Klein](/user_profile?user_id=536568) |  |
| --- | --- | --- |
| [Comment 28](/show_bug.cgi?id=1153672#c28)• 10 years ago |
|  | |

OK. Any idea when this is expected to be released?

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 29](/show_bug.cgi?id=1153672#c29)• 10 years ago |
|  | |

Hard to say until we have a fix actually written, no? Once we have an idea I'll update this bug.

|  | [Amit Klein](/user_profile?user_id=536568) |  |
| --- | --- | --- |
| [Comment 30](/show_bug.cgi?id=1153672#c30)• 10 years ago |
|  | |

No problems. Didn't mean to bug you (pardon my pun).

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1153672#a7411203_20209)• 10 years ago |

Depends on: [1167489](/show_bug.cgi?id=1167489 "RESOLVED FIXED - \"Spy in the Sandbox\" - Security issue related to High Resolution Time API")

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Comment 31](/show_bug.cgi?id=1153672#c31)• 10 years ago |
|  | |

Assigning this to bz because he is fixing [bug 1167489](/show_bug.cgi?id=1167489 "RESOLVED FIXED - \"Spy in the Sandbox\" - Security issue related to High Resolution Time API").Assignee: nobody → bzbarsky

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 32](/show_bug.cgi?id=1153672#c32)• 10 years ago |
|  | |

<https://hg.mozilla.org/integration/mozilla-inbound/rev/48ae8b5e62ab>

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 33](/show_bug.cgi?id=1153672#c33)• 10 years ago |
|  | |

Amit, I checked in a fix for this today and requested release manager approval for backporting to Firefox 41. If that approval comes through, I expect we will ship the fix near the end of September 2015 (see <<https://wiki.mozilla.org/RapidRelease/Calendar>>). If not, then it will ship in Firefox 42 in early November 2015. Of course if we run into web compat issues between now and then we will end up needing to reevlaute the schedule.

|  | [Amit Klein](/user_profile?user_id=536568) |  |
| --- | --- | --- |
| [Comment 34](/show_bug.cgi?id=1153672#c34)• 10 years ago |
|  | |

Sounds good, thanks.

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 35](/show_bug.cgi?id=1153672#c35)• 10 years ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/48ae8b5e62ab>
<https://hg.mozilla.org/releases/mozilla-aurora/rev/aeab359c2292>Status: NEW → RESOLVEDClosed: 10 years ago
[status-b2g-v2.0](/buglist.cgi?f1=cf_status_b2g_2_0&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_b2g_2_0&o1=equals&v1=unaffected)
[status-b2g-v2.0M](/buglist.cgi?f1=cf_status_b2g_2_0m&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_b2g_2_0m&o1=equals&v1=unaffected)
[status-b2g-v2.1](/buglist.cgi?f1=cf_status_b2g_2_1&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_b2g_2_1&o1=equals&v1=wontfix)
[status-b2g-v2.1S](/buglist.cgi?f1=cf_status_b2g_2_1_s&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_b2g_2_1_s&o1=equals&v1=wontfix)
[status-b2g-v2.2](/buglist.cgi?f1=cf_status_b2g_2_2&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_b2g_2_2&o1=equals&v1=affected)
[status-b2g-v2.2r](/buglist.cgi?f1=cf_status_b2g_2_2r&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_b2g_2_2r&o1=equals&v1=affected)
[status-b2g-master](/buglist.cgi?f1=cf_status_b2g_master&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_b2g_master&o1=equals&v1=fixed)
[status-firefox40](/buglist.cgi?f1=cf_status_firefox40&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox40&o1=equals&v1=wontfix)
[status-firefox41](/buglist.cgi?f1=cf_status_firefox41&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox41&o1=equals&v1=fixed)
[status-firefox42](/buglist.cgi?f1=cf_status_firefox42&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox42&o1=equals&v1=fixed)
[status-firefox-esr31](/buglist.cgi?f1=cf_status_firefox_esr31&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_firefox_esr31&o1=equals&v1=unaffected)
[status-firefox-esr38](/buglist.cgi?f1=cf_status_firefox_esr38&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox_esr38&o1=equals&v1=affected)Resolution: --- → FIXEDTarget Milestone: --- → mozilla42

|  | [BMO Automation](/user_profile?user_id=546015) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1153672#a12305684_546015)• 9 years ago |

Group: core-security → core-security-release

|  | [Matt Wobensmith [:mwobensmith][:matt:]](/user_profile?user_id=452604) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1153672#a12445258_452604)• 9 years ago |

Whiteboard: Coordinate disclosure w/reporter and Microsoft → [post-critsmash-triage] Coordinate disclosure w/reporter and Microsoft

|  | [Amit Klein](/user_profile?user_id=536568) |  |
| --- | --- | --- |
| [Comment 36](/show_bug.cgi?id=1153672#c36)• 9 years ago |
|  | |

I remind you that in early July, Microsoft informed me that they WONTFIX ([https://bugzilla.mozilla.org/show\_bug.cgi?id=1153672#c25](/show_bug.cgi?id=1153672#c25 "RESOLVED FIXED - Fingerprinting individuals via performance.now()")). So you only need to coordinate with me (AKA "the reporter"). As far as I'm concerned, let me know in advance (ideally a week or more), indicate the fix/advisory ID and fixed version, and I will provide you with my advisory URL (if you embed this in your page).

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 37](/show_bug.cgi?id=1153672#c37)• 9 years ago |
|  | |

Amit,
I'm planning on writing an advisory for this for Firefox for next week's release, along with another bug in this area that was reported by another researcher. We don't normally put out advisories by third parties though you are welcome to release your own write up after we ship the fix for this. We'd prefer you not give a huge amount of detail for a week or two in order to give people time to update to the fixed version but this isn't the kind of attack where people will have computers taken over. If you have any comments on this, please let me know.Flags: needinfo?(aksecurity)Whiteboard: [post-critsmash-triage] Coordinate disclosure w/reporter and Microsoft → [post-critsmash-triage][adv-main41+] Coordinate disclosure w/reporter and Microsoft

|  | [Amit Klein](/user_profile?user_id=536568) |  |
| --- | --- | --- |
| [Comment 38](/show_bug.cgi?id=1153672#c38)• 9 years ago |
|  | |

(In reply to Al Billings [:abillings] from [comment #37](/show_bug.cgi?id=1153672#c37 "RESOLVED FIXED - Fingerprinting individuals via performance.now()"))
> Amit,
>
> I'm planning on writing an advisory for this for Firefox for next week's
> release, along with another bug in this area that was reported by another
> researcher. We don't normally put out advisories by third parties though you
> are welcome to release your own write up after we ship the fix for this.
> We'd prefer you not give a huge amount of detail for a week or two in order
> to give people time to update to the fixed version but this isn't the kind
> of attack where people will have computers taken over. If you have any
> comments on this, please let me know.
Sure thing, I'll give about one week's grace (unless it's disclosed elsewhere).Flags: needinfo?(aksecurity)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1153672#a13564975_280903)• 9 years ago |

Alias: CVE-2015-4515

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1153672#a14022776_280903)• 9 years ago |

Alias: CVE-2015-4515

|  | [Amit Klein](/user_profile?user_id=536568) |  |
| --- | --- | --- |
| [Comment 39](/show_bug.cgi?id=1153672#c39)• 9 years ago |
|  | |

My advisory is now public:
<http://www.securitygalore.com/site3/vmd1-advisory>
Thanks for working on this and coordinating with me.
-Amit

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1153672#a16768555_280903)• 9 years ago |

[status-firefox-esr38](/buglist.cgi?f1=cf_status_firefox_esr38&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox_esr38&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox_esr38&o1=equals&v1=wontfix)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1153672#a38610508_1689)• 9 years ago |

Group: core-security-release

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1153672#a48643033_1689)• 8 years ago |

Whiteboard: [post-critsmash-triage][adv-main41+] Coordinate disclosure w/reporter and Microsoft → [post-critsmash-triage][adv-main41+][fingerprinting]

|  | [Nobody; OK to take it and work on it](/user_profile?user_id=1) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1153672#a123613010_1)• 6 years ago |

Component: DOM → DOM: Core & HTML
You need to [log in](/show_bug.cgi?id=1153672&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Daniel Veditz [:dveditz]](/user_profile?user_id=1689)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from www.mozilla.org_5b6a2108_20250125_031559.html ===


## Help us improve your Mozilla experience

In addition to Cookies necessary for this site to function, we’d like your permission to set some additional Cookies to better understand your browsing needs and improve your experience. Rest assured — we value your privacy.

Accept All Additional Cookies

Reject All Additional Cookies

[Cookie settings](/en-US/privacy/websites/cookie-settings/)

Menu
[![Mozilla](https://www.mozilla.org/media/img/logos/m24/lockup-black.f2ddba3f0724.svg)](/en-US/)

* [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
  Firefox browsers](/en-US/firefox/)
  Close Firefox browsers menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Desktop](/en-US/firefox/new/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for iOS](/en-US/firefox/browsers/mobile/ios/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Android](/en-US/firefox/browsers/mobile/android/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/focus/logo.aac3e33175cb.svg)
    ## Firefox Focus](/en-US/firefox/browsers/mobile/focus/)
  + [## Firefox blog](https://blog.mozilla.org/firefox/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=firefox)
* [Products](/en-US/products/)
  Close Products menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/mozilla/vpn/logo.c648f487bfb8.svg)
    ## Mozilla VPN](/en-US/products/vpn/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/monitor/logo.d97e5516f9e6.svg)
    ## Mozilla Monitor](https://monitor.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/relay/logo-white.d42a8b52e44c.svg)
    ## Firefox Relay](https://relay.firefox.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/pocket/logo.17446bc33a5d.svg)
    ## Pocket](https://getpocket.com/firefox_learnmore/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/nav/icons/icon-mdn-plus.f54475f980ab.svg)
    ## MDN Plus](https://developer.mozilla.org/plus?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/fakespot/logo-blue.3973b8fe9631.svg)
    ## Fakespot](https://fakespot.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/thunderbird/logo-thunderbird.121e9c0fed45.svg)
    ## Thunderbird](https://www.thunderbird.net/)

  [All products](/en-US/products/)
* [About us](/en-US/about/)
  Close About us menu

  Our Mission

  + [## About Mozilla](/en-US/about/)
  + [## The Mozilla Manifesto](/en-US/about/manifesto/)
  + [## Get Involved](/en-US/contribute/)
  + [## Innovation Projects](https://future.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Blog](https://blog.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)

  Our Work

  + [## Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla.ai](https://www.mozilla.ai/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Ventures](https://mozilla.vc/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Advertising](/en-US/advertising/)

## Menu

* Mozilla Security

## [Mozilla Security](/en-US/security/)

* [Advisories](/en-US/security/advisories/)
* [Known Vulnerabilities](/en-US/security/known-vulnerabilities/)
* [Mozilla Security Blog](https://blog.mozilla.com/security/)
* [Security Bug Bounty](/en-US/security/bug-bounty/)
* [Third-party Injection Policy](/en-US/security/third-party-software-injection/)

## [Client Bug Bounty](/en-US/security/client-bug-bounty/)

* [Frequently Asked Questions](/en-US/security/bug-bounty/faq/)
* [Hall of Fame](/en-US/security/bug-bounty/hall-of-fame/)

## [Web Bug Bounty](/en-US/security/web-bug-bounty/)

* [Eligible Websites](/en-US/security/bug-bounty/web-eligible-sites/)
* [Frequently Asked Questions](/en-US/security/bug-bounty/faq-webapp/)
* [Hall of Fame](/en-US/security/bug-bounty/web-hall-of-fame/)

# Mozilla Foundation Security Advisory 2015-114

## Information disclosure via the High Resolution Time API

Announced
September 22, 2015
Reporter
Yossef Oren et al, Amit Klein
Impact
Moderate
Products
Firefox, Firefox OS, SeaMonkey
Fixed in

* Firefox 41
* Firefox OS 2.5
* SeaMonkey 2.38

### Description

Security researchers **Yossef Oren, Vasileios P. Kemerlis, Simha Sethumadhavan,
Angelos D. Keromytis** of Columbia University's Network Security Lab reported a
method of using the High Resolution Time API for side channel attacks. This attack uses
JavaScript loaded through a hostile web page to track access to the last-level
cache over a period of time as a user engages in other browser activity. This attack takes
advantage of the `performance.now()` API's use of single nanosecond resolution
for timing.

Security researcher **Amit Klein** independently reported use of the
`performance.now()` API on Windows systems to extract the Windows counter
frequency as an avenue for side channel attacks.

Both of these flaws allow for the disclosure of private information, user
fingerprinting, and data leakage. They have been addressed by reducing the resolution of
the `performance.now()` API to 5 microseconds to remove the precision in
resolution available to attackers.

The Windows counter frequency issue does not affect Linux or OS X systems.

### References

* ["Spy in the Sandbox" - Security issue related to High Resolution Time API](https://bugzilla.mozilla.org/show_bug.cgi?id=1167489)

+ [The Spy in the Sandbox -- Practical Cache Attacks in Javascript](http://arxiv.org/abs/1502.07373)

* [Fingerprinting individuals via performance.now()](https://bugzilla.mozilla.org/show_bug.cgi?id=1153672)

## Company

* [Leadership](/about/leadership/)
* [Press Center](https://blog.mozilla.org/category/mozilla/news/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=company)
* [Careers](/en-US/careers/)
* [Contact](/en-US/contact/)

## Support

* [Product Help](https://support.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [File a Bug](https://bugzilla.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [Localize Mozilla](https://pontoon.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)

## Resources

* [Advertise with Mozilla](/en-US/advertising/)
* [Firefox Release Notes](/firefox/134.0.2/releasenotes/)

## Developers

* [Developer Edition](/en-US/firefox/developer/)
* [Enterprise](/en-US/firefox/enterprise/)
* [Tools](https://firefox-source-docs.mozilla.org/devtools-user/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=developers)
* [MDN](https://developer.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer)

## Follow @Mozilla

* [X (formerly Twitter) (@mozilla)](https://twitter.com/mozilla)
* [Instagram (@mozilla)](https://www.instagram.com/mozilla/)
* [LinkedIn (@mozilla)](https://www.linkedin.com/company/mozilla-corporation/)
* [TikTok (@mozilla)](https://www.tiktok.com/%40mozilla)
* [Spotify (@mozilla)](https://open.spotify.com/show/0vT7LJMeVDxyQ2ZamHKu08?si=_uDRD6bRR_6M5YZyISGXgA)

## Follow @Firefox

* [X (formerly Twitter) (@firefox)](https://twitter.com/firefox)
* [Instagram (@firefox)](https://www.instagram.com/firefox/)
* [YouTube (@firefoxchannel)](https://www.youtube.com/user/firefoxchannel)
* [TikTok (@firefox)](https://www.tiktok.com/%40firefox)

[Donate](https://foundation.mozilla.org/?form=moco-donate-footer)

Visit [Mozilla Corporation’s](/en-US/) not-for-profit parent, the [Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer).

Portions of this content are ©1998–2025 by individual mozilla.org contributors. Content available under a [Creative Commons license](/en-US/foundation/licensing/website-content/).

* [Website Privacy Notice](/en-US/privacy/websites/)
* [Cookies](/en-US/privacy/websites/cookie-settings/)
* [Legal](/en-US/about/legal/)
* [Community Participation Guidelines](/en-US/about/governance/policies/participation/)
* [About this site](/en-US/about/this-site/)

![](https://www.mozilla.org/media/img/logos/m24/wordmark-white.2d673bb5b33a.svg)



=== Content from bugzilla.mozilla.org_26bbf5c1_20250125_031603.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/1167489)
* [XML](/show_bug.cgi?ctype=xml&id=1167489)

Closed
[Bug 1167489](/show_bug.cgi?id=1167489)

Opened 10 years ago
Closed 10 years ago

# "Spy in the Sandbox" - Security issue related to High Resolution Time API

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

"Spy in the Sandbox" - Security issue related to High Resolution Time API

## Categories

### (Core :: DOM: Core & HTML, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=DOM%3A%20Core%20%26%20HTML#DOM%3A%20Core%20%26%20HTML)

DOM: Core & HTML
▾

Core :: DOM: Core & HTML
Issues in DOM tree [https://dom.spec.whatwg.org](https://dom.spec.whatwg.org/) & HTML [https://html.spec.whatwg.org](https://html.spec.whatwg.org/) that do not fit into any other DOM or HTML component or which span multiple DOM or HTML components.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=DOM%3A%20Core%20%26%20HTML&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=DOM%3A%20Core%20%26%20HTML&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=DOM%3A%20Core%20%26%20HTML)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

34 Branch

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

Unspecified

Unspecified

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

normal

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla42

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Performance Impact | --- |
| --- | --- |
| Webcompat Score | --- |
| Accessibility Severity | --- |
| a11y-review | --- |
| Webcompat Priority | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox40 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox40&o1=equals&v1=wontfix) |
| firefox41 | [+](/buglist.cgi?f1=cf_tracking_firefox41&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox41&o1=equals&v1=fixed) |
| firefox42 | --- | [fixed](/buglist.cgi?f1=cf_status_firefox42&o1=equals&v1=fixed) |
| firefox-esr31 | --- | [unaffected](/buglist.cgi?f1=cf_status_firefox_esr31&o1=equals&v1=unaffected) |
| firefox-esr38 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox_esr38&o1=equals&v1=wontfix) |
| b2g-v2.0 | --- | [unaffected](/buglist.cgi?f1=cf_status_b2g_2_0&o1=equals&v1=unaffected) |
| b2g-v2.0M | --- | [unaffected](/buglist.cgi?f1=cf_status_b2g_2_0m&o1=equals&v1=unaffected) |
| b2g-v2.1 | --- | [wontfix](/buglist.cgi?f1=cf_status_b2g_2_1&o1=equals&v1=wontfix) |
| b2g-v2.1S | --- | [wontfix](/buglist.cgi?f1=cf_status_b2g_2_1_s&o1=equals&v1=wontfix) |
| b2g-v2.2 | --- | [affected](/buglist.cgi?f1=cf_status_b2g_2_2&o1=equals&v1=affected) |
| b2g-v2.2r | --- | [affected](/buglist.cgi?f1=cf_status_b2g_2_2r&o1=equals&v1=affected) |
| b2g-master | --- | [fixed](/buglist.cgi?f1=cf_status_b2g_master&o1=equals&v1=fixed) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox40 |  | wontfix |
| firefox41 | + | fixed |
| firefox42 |  | fixed |
| firefox-esr31 |  | unaffected |
| firefox-esr38 |  | wontfix |
| b2g-v2.0 |  | unaffected |
| b2g-v2.0M |  | unaffected |
| b2g-v2.1 |  | wontfix |
| b2g-v2.1S |  | wontfix |
| b2g-v2.2 |  | affected |
| b2g-v2.2r |  | affected |
| relnote-firefox |  | --- |
| b2g-master |  | fixed |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: bugzilla, Assigned: bzbarsky)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](extensions/Gravatar/web/default.jpg)  [bzbarsky](/user_profile?user_id=20209)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/a6f600afd9fcfba034b6e422bcc2f5b8?d=mm&size=40)  [bugzilla](/user_profile?user_id=539718)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/5111b810214a00377104f5ad3efefa26?d=mm&size=40)  [sefeng](/user_profile?user_id=625922)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

27 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[1153672](/show_bug.cgi?id=1153672 "RESOLVED FIXED - Fingerprinting individuals via performance.now()"), [1186489](/show_bug.cgi?id=1186489 "RESOLVED FIXED - Clamp the resolution of performance.now() in workers too")

Dependency [tree](/showdependencytree.cgi?id=1167489&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=1167489)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[Duplicates:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#duplicates)

[1169448](/show_bug.cgi?id=1169448 "RESOLVED DUPLICATE - Misuse of High-Resolution Time API exposes security threat")

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

[1153672](/show_bug.cgi?id=1153672 "RESOLVED FIXED - Fingerprinting individuals via performance.now()")

## Details

### (4 keywords, Whiteboard: [post-critsmash-triage][adv-main41+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[csectype-disclosure](/buglist.cgi?keywords=csectype-disclosure&resolution=---),
[privacy](/buglist.cgi?keywords=privacy&resolution=---),
[reporter-external](/buglist.cgi?keywords=reporter-external&resolution=---),
[sec-moderate](/buglist.cgi?keywords=sec-moderate&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[post-critsmash-triage][adv-main41+]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [abillings](/user_profile?user_id=280903) | [sec-bounty](#a5161225_280903 "10 years ago") | + |
| --- | --- | --- |
| [abillings](/user_profile?user_id=280903) | sec-bounty | + |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (2 files)

| [spyinthesandbox-ccs15.pdf (draft of technical paper about the problem)](/attachment.cgi?id=8609163)  [10 years ago](#c0)  [Yossi Oren](/user_profile?user_id=539718)   617.30 KB, application/pdf |  | [Details](/attachment.cgi?id=8609163&action=edit) |
| --- | --- | --- |
| [and bug 1153672. Clamp the resolution of performance.now() calls to 5us, because otherwise we allow various timing attacks that depend on high accuracy timers](/attachment.cgi?id=8630479)  [10 years ago](#c15)  [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)   1.24 KB, patch | froydnj : [review+](#c17 "10 years ago")  abillings : [approval-mozilla-aurora+](#a4120756_280903 "10 years ago") | [Details](/attachment.cgi?id=8630479&action=edit) | [Diff](/attachment.cgi?id=8630479&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1167489&attachment=8630479) |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Yossi Oren](/user_profile?user_id=539718)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=1167489#c0)• 10 years ago |
|  | |

Attached file
[spyinthesandbox-ccs15.pdf (draft of technical paper about the problem)](attachment.cgi?id=8609163)
— [Details](attachment.cgi?id=8609163&action=edit)

User Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10\_10\_3) AppleWebKit/600.6.3 (KHTML, like Gecko) Version/8.0.6 Safari/600.6.3
Steps to reproduce:
My name is Yossi and I’m a post-doc at Columbia University’s Network Security Lab. We’ve recently published a report describing a new Javascript-based network attack. Our attack lets a malicious website learn a surprising amount of personal information about an innocent user, and is largely based upon repeated calls to performance.now() as a measurement method.
Here is a proof of concept that works on Firefox 34 and later for Mac OS and Linux:
<http://s.codepen.io/yossioren/debug/ba94a14dd5942fda5db1a3e70809181d>?
From our testing it is very apparent that somewhat reducing the resolution of performance.now() will make the attack much more difficult. We noticed that various browser vendors implement the call with different precisions, with Firefox for Linux and MacOS going down to the single nanosecond. Our attack as described becomes very difficult to launch once the resolution of performance.now() is upper-bounded to 5 thousandths of a millisecond.
Assuming there is not too much of a usability loss (to games, music, VR, etc) if this resolution is upper-bounded, perhaps you should look at changing your implementation. We’re also in touch with the relevant parties at the W3C to modify the standard accordingly.
I would welcome answering any questions or concerns you may have. We can have a phone call / teleconf if it’s easier for you.

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1167489#a48529_280903)• 10 years ago |

[status-firefox41](/buglist.cgi?f1=cf_status_firefox41&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox41&o1=equals&v1=affected)Flags: sec-bounty?

|  | [Benjamin Smedberg](/user_profile?user_id=7044) |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=1167489#c1)• 10 years ago |
|  | |

Doug who's the right person to think about this?Component: Untriaged → DOMFlags: needinfo?(dougt)Product: Firefox → Core

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=1167489#c2)• 10 years ago |
|  | |

Note related [bug 1153672](/show_bug.cgi?id=1153672 "RESOLVED FIXED - Fingerprinting individuals via performance.now()"). In that bug there is discussion about possibly clamping the performance.now() values to exact microsecond precision (as in, only returning values that are some integer number of microseconds).
That's not quite the 5 microseconds that [comment 0](/show_bug.cgi?id=1167489#c0 "RESOLVED FIXED - \"Spy in the Sandbox\" - Security issue related to High Resolution Time API") says would be an effective mitigation here, but 5 microseconds would also be a clear violation of the current spec...
Yossi, how much of a win is going to integer microseconds for performance.now in handling your attack?Status: UNCONFIRMED → NEWEver confirmed: true

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1167489#a165778_20209)• 10 years ago |

See Also: → [1153672](/show_bug.cgi?id=1153672 "RESOLVED FIXED - Fingerprinting individuals via performance.now()")

|  | [Yossi Oren](/user_profile?user_id=539718)  Reporter |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=1167489#c3)• 10 years ago |
|  | |

Hi, we have a microsecond attack that's currently aimed at IE and Chrome. Profiling takes a little longer and the attack has a slightly lower resolution, but the exploitability is still there. I will update the bug with a microsecond PoC in a couple of days.
Regarding the current spec - perhaps you can reach out to the relevant W3G parties to understand why a resolution of exactly one microsecond was put in there, and what would go wrong if it was changed to 5 microseconds. FWIW I think it was just to get nice animations at 60fps.
Also, could you please authorize me to access #1153672?

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=1167489#c4)• 10 years ago |
|  | |

I can reach out to them, but so can you. It's a public mailing list. <public-web-perf@w3.org>. It seems that a more direct conversation would work better than a long chain of messages (you to me to them) that has more potential for confusion and misunderstandings.
If you want to reach out to just the spec editors, that would be <jmann@microsoft.com> and <simonjam@google.com>.
> FWIW I think it was just to get nice animations at 60fps.
The idea of the performance.now() API was to allow timing of operations at a higher granularity than 1ms. That can be used for things like frame time budgets, yes, but there were other use cases too. <http://w3c.github.io/hr-time/#introduction> lists some; note the bit about audio/video synchronization in particular.
> Also, could you please authorize me to access #1153672?
Done.

|  | [Yossi Oren](/user_profile?user_id=539718)  Reporter |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=1167489#c5)• 10 years ago |
|  | |

I reached out to jmann@microsoft.com back in March and haven't heard back. I'll try contacting the mailing list, as you suggested.

|  | [Yossi Oren](/user_profile?user_id=539718)  Reporter |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=1167489#c7)• 10 years ago |
|  | |

Related post on public-web-perf@w3.com:
<https://lists.w3.org/Archives/Public/public-web-perf/2015May/0033.html>

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1167489#a1003380_1689)• 10 years ago |

Keywords: [csectype-disclosure](/buglist.cgi?keywords=csectype-disclosure&resolution=---),
[privacy](/buglist.cgi?keywords=privacy&resolution=---),
[sec-moderate](/buglist.cgi?keywords=sec-moderate&resolution=---)

|  | [Doug Turner (:dougt)](/user_profile?user_id=302291) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1167489#a2719857_302291)• 10 years ago |

Flags: needinfo?(dougt)

|  | [Eric Rescorla (:ekr)](/user_profile?user_id=35667) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=1167489#c8)• 10 years ago |
|  | |

Adding Hovav Shacham to see if he can offer any insight here.

|  | [Yossi Oren](/user_profile?user_id=539718)  Reporter |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=1167489#c9)• 10 years ago |
|  | |

Just updating that the issue was resolved in WebKit by reducing the resolution of performance.now() to 5 microseconds:
<https://bugs.webkit.org/show_bug.cgi?id=146531>
The issue was also resolved in Chromium by the same method:
<https://code.google.com/p/chromium/issues/detail?id=506723>
That leaves Firefox and IE.

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=1167489#c10)• 10 years ago |
|  | |

<sigh>. I guess we should reduce resolution to 5us too...
Nathan, you seem to have most of the recent reviews in the timestamp code. Is it worth trying to add faster ToSanitizedMilliseconds methods on the platform utils stuff that try to get by with integer arithmetic (after converting the double to a 64-bit int of nanoseconds or microseconds) or should we just bite the bullet and do a floor() in the DOM performance code (or in shared TimeStamp code, e.g. a shared ToSanitizedMilliseconds) and not worry about the performance too much?Flags: needinfo?(nfroyd)

|  | [Nathan Froyd [:froydnj]](/user_profile?user_id=417288) |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=1167489#c11)• 10 years ago |
|  | |

(In reply to Boris Zbarsky [:bz] from [comment #10](/show_bug.cgi?id=1167489#c10 "RESOLVED FIXED - \"Spy in the Sandbox\" - Security issue related to High Resolution Time API"))
> Is it worth trying to add faster ToSanitizedMilliseconds methods on the
> platform utils stuff that try to get by with integer arithmetic (after
> converting the double to a 64-bit int of nanoseconds or microseconds) or
> should we just bite the bullet and do a floor() in the DOM performance code
> (or in shared TimeStamp code, e.g. a shared ToSanitizedMilliseconds) and not
> worry about the performance too much?
I guess it partly depends on how fast the divide + floor operation is in float vs. integer code? If the former is faster, you want to do it outside of the platform-specific code; if the latter is faster, you want to do it in the platform-specific code.
At least for the divide step, my sense is that float division is somewhat-to-significantly faster than integer division: I don't know whether all our supported ARM chips actually have hardware divide or not, for instance, and Agner Fog's x86 instruction tables suggest that floating-point divides are somewhat-to-significantly faster (assuming I'm reading them correctly). And even if the compiler (or us) can optimize the division into a multiply, floating point is still at least even.
For the flooring...I don't have good ideas here, but I'd be willing to bet the floating-point library function is fast enough, or we could write a fast-enough version with knowledge of the input ranges (i.e. we know infinities and NaNs are not a problem here...I think).
The above reasoning points to putting this in the DOM performance code. And if we're only going for a resolution of 5us, then we have a lot of time to "waste" sanitizing the value anyway, right?
I'm having a hard time thinking of other places where we'd want to sanitize these values, so I don't think the shared TimeStamp code is the right place. (Undoubtedly, some clever person will probably come along with another similar exploit, and we'll bite the bullet then...)Flags: needinfo?(nfroyd)

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=1167489#c12)• 10 years ago |
|  | |

> I guess it partly depends on how fast the divide + floor operation is in float vs.
> integer code?
At least on my Mac it's faster in integer code, because floor seems to involve a function call. But I have no idea what it's like across platforms/compilers/libcs. :(
OK, I'll just do the simple thing in shared code.

|  | [Nathan Froyd [:froydnj]](/user_profile?user_id=417288) |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=1167489#c13)• 10 years ago |
|  | |

(In reply to Boris Zbarsky [:bz] from [comment #12](/show_bug.cgi?id=1167489#c12 "RESOLVED FIXED - \"Spy in the Sandbox\" - Security issue related to High Resolution Time API"))
> > I guess it partly depends on how fast the divide + floor operation is in float vs.
> > integer code?
>
> At least on my Mac it's faster in integer code, because floor seems to
> involve a function call. But I have no idea what it's like across
> platforms/compilers/libcs. :(
Probably just as bad. =/
How much slower is it?Flags: needinfo?(bzbarsky)

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=1167489#c14)• 10 years ago |
|  | |

[Bug 1153672 comment 14](/show_bug.cgi?id=1153672#c14 "RESOLVED FIXED - Fingerprinting individuals via performance.now()") has some data, but that was using round(). Also see [bug 1153672 comment 19](/show_bug.cgi?id=1153672#c19 "RESOLVED FIXED - Fingerprinting individuals via performance.now()"). Specifically, times without the rounding are in the 40ns range for a performance.now() call. With round() they're more like 55ns.
If I use floor() times are about 47ns. I guess we can just live with that; it's no worse than competitors at this point.Flags: needinfo?(bzbarsky)

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=1167489#c15)• 10 years ago |
|  | |

Attached patch

[and bug 1153672. Clamp the resolution of performance.now() calls to 5us, because otherwise we allow various timing attacks that depend on high accuracy timers](attachment.cgi?id=8630479&action=diff)
— [Details](attachment.cgi?id=8630479&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1167489&attachment=8630479)

[Attachment #8630479](/attachment.cgi?id=8630479&action=edit "and bug 1153672.  Clamp the resolution of performance.now() calls to 5us, because otherwise we allow various timing attacks that depend on high accuracy timers") -
Flags: review?(nfroyd)

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1167489#a4019206_20209)• 10 years ago |

Assignee: nobody → bzbarskyStatus: NEW → ASSIGNED

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1167489#a4019217_20209)• 10 years ago |

Blocks: [1153672](/show_bug.cgi?id=1153672 "RESOLVED FIXED - Fingerprinting individuals via performance.now()")

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=1167489#c16)• 10 years ago |
|  | |

So I think we should probably land this on m-c and Aurora. I'm less sure about doing beta; would prefer to just let things ride from Aurora.

|  | [Nathan Froyd [:froydnj]](/user_profile?user_id=417288) |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=1167489#c17)• 10 years ago |
|  | |

Comment on [attachment 8630479](/attachment.cgi?id=8630479 "and bug 1153672.  Clamp the resolution of performance.now() calls to 5us, because otherwise we allow various timing attacks that depend on high accuracy timers") [[details]](/attachment.cgi?id=8630479&action=edit "and bug 1153672.  Clamp the resolution of performance.now() calls to 5us, because otherwise we allow various timing attacks that depend on high accuracy timers") [[diff]](/attachment.cgi?id=8630479&action=diff "and bug 1153672.  Clamp the resolution of performance.now() calls to 5us, because otherwise we allow various timing attacks that depend on high accuracy timers") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1167489&attachment=8630479)
and [bug 1153672](/show_bug.cgi?id=1153672 "RESOLVED FIXED - Fingerprinting individuals via performance.now()"). Clamp the resolution of performance.now() calls to 5us, because otherwise we allow various timing attacks that depend on high accuracy timers
Review of [attachment 8630479](/attachment.cgi?id=8630479 "and bug 1153672.  Clamp the resolution of performance.now() calls to 5us, because otherwise we allow various timing attacks that depend on high accuracy timers") [[details]](/attachment.cgi?id=8630479&action=edit "and bug 1153672.  Clamp the resolution of performance.now() calls to 5us, because otherwise we allow various timing attacks that depend on high accuracy timers") [[diff]](/attachment.cgi?id=8630479&action=diff "and bug 1153672.  Clamp the resolution of performance.now() calls to 5us, because otherwise we allow various timing attacks that depend on high accuracy timers") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1167489&attachment=8630479):
-----------------------------------------------------------------
::: dom/base/nsPerformance.cpp
@@ +503,5 @@
> {
> + double nowTime = GetDOMTiming()->TimeStampToDOMHighRes(TimeStamp::Now());
> + // Round down to the nearest 5us, because if the timer is too
> + // accurate people can do nasty timing attacks with it.
> + const double maxResolutionMs = 0.005;
Minor brain confusion between |us| in the comment and |Ms| in the variable name, but I don't know of a good way to fix that.
[Attachment #8630479](/attachment.cgi?id=8630479&action=edit "and bug 1153672.  Clamp the resolution of performance.now() calls to 5us, because otherwise we allow various timing attacks that depend on high accuracy timers") -
Flags: review?(nfroyd) → review+

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=1167489#c18)• 10 years ago |
|  | |

I can just make the comment say "0.005ms (5us)" to make it clear. And I guess rename nowTime to nowTimeMs.

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=1167489#c19)• 10 years ago |
|  | |

<https://hg.mozilla.org/integration/mozilla-inbound/rev/48ae8b5e62ab>

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=1167489#c20)• 10 years ago |
|  | |

Comment on [attachment 8630479](/attachment.cgi?id=8630479 "and bug 1153672.  Clamp the resolution of performance.now() calls to 5us, because otherwise we allow various timing attacks that depend on high accuracy timers") [[details]](/attachment.cgi?id=8630479&action=edit "and bug 1153672.  Clamp the resolution of performance.now() calls to 5us, because otherwise we allow various timing attacks that depend on high accuracy timers") [[diff]](/attachment.cgi?id=8630479&action=diff "and bug 1153672.  Clamp the resolution of performance.now() calls to 5us, because otherwise we allow various timing attacks that depend on high accuracy timers") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1167489&attachment=8630479)
and [bug 1153672](/show_bug.cgi?id=1153672 "RESOLVED FIXED - Fingerprinting individuals via performance.now()"). Clamp the resolution of performance.now() calls to 5us, because otherwise we allow various timing attacks that depend on high accuracy timers
Approval Request Comment
[Feature/regressing bug #]: performance.now() implementation
[User impact if declined]: Various privacy leaks; see this bug and [bug 1153672](/show_bug.cgi?id=1153672 "RESOLVED FIXED - Fingerprinting individuals via performance.now()")
[Describe test coverage new/current, TreeHerder]:
[Risks and why]: Medium risk. Clamping to 1us would be pretty safe (since Chrome
does that already), but no browser right now clamps to 5us. That said, I
don't expect anything in the wild depends on higher resolution than that right
now...
[String/UUID change made/needed]:
[Attachment #8630479](/attachment.cgi?id=8630479&action=edit "and bug 1153672.  Clamp the resolution of performance.now() calls to 5us, because otherwise we allow various timing attacks that depend on high accuracy timers") -
Flags: approval-mozilla-aurora?

|  | [Carsten Book [:Tomcat]](/user_profile?user_id=277293) |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=1167489#c21)• 10 years ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/48ae8b5e62ab>Status: ASSIGNED → RESOLVEDClosed: 10 years ago
[status-firefox42](/buglist.cgi?f1=cf_status_firefox42&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox42&o1=equals&v1=fixed)Resolution: --- → FIXEDTarget Milestone: --- → mozilla42

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1167489#a4120756_280903)• 10 years ago |

[Attachment #8630479](/attachment.cgi?id=8630479&action=edit "and bug 1153672.  Clamp the resolution of performance.now() calls to 5us, because otherwise we allow various timing attacks that depend on high accuracy timers") -
Flags: approval-mozilla-aurora? → approval-mozilla-aurora+

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=1167489#c22)• 10 years ago |
|  | |

Do we need this on Beta or ESR38?
[tracking-firefox41](/buglist.cgi?f1=cf_tracking_firefox41&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox41&o1=equals&v1=%2B)

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=1167489#c23)• 10 years ago |
|  | |

I think it's a bit risky for beta. Not sure about ESR38; we should see how it goes on Aurora.

|  | [Hovav Shacham](/user_profile?user_id=28795) |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=1167489#c24)• 10 years ago |
|  | |

Yossi: Nice work!
All sorts of timing side-channel vulnerabilities are facilitated by the availability of high-resolution timers. See Paul Stone's "Pixel Perfect" work for another example. I would recommend aiming for a granularity substantially closer to (1/60) s than to 5 us, at least in the absence of a user permission.

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=1167489#c25)• 10 years ago |
|  | |

1/60 s is way too low for anything useful. And the web has had millisecond-accurate timers for going on 20 years now; \_tons\_ of stuff depends on those.

|  | [Hovav Shacham](/user_profile?user_id=28795) |  |
| --- | --- | --- |
| [Comment 26](/show_bug.cgi?id=1167489#c26)• 10 years ago |
|  | |

None of the examples listed at <http://w3c.github.io/hr-time/#introduction> self-evidently calls for timer granularity even as fine as 1 ms, let alone lower.
Keep in mind, also, that when you clamp a timer to 5 us, you still allow JS to recover more like a 2 us timer, due to edge effects.

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 27](/show_bug.cgi?id=1167489#c27)• 10 years ago |
|  | |

The examples section there is rather incomplete. The use cases for finer-grained timers I know of are:
1) Knowing how much frame budget you have left. The frame budget is 16ms, so this needs decent timer granularity; 16ms is clearly too coarse. 1ms was being too coarse in practice, because people have more than 16 things they want to do in a frame.
2) A/V sync. 16ms is clearly way to coarse, again. 1ms may be good enough.
3) Figuring out the order of events within a frame (the example in the spec). The resolution you want here depends on how many events you expect to have. 1ms means you can only get 16 things ordered.

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 28](/show_bug.cgi?id=1167489#c28)• 10 years ago |
|  | |

<https://hg.mozilla.org/releases/mozilla-aurora/rev/aeab359c2292>
[status-b2g-v2.0](/buglist.cgi?f1=cf_status_b2g_2_0&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_b2g_2_0&o1=equals&v1=unaffected)
[status-b2g-v2.0M](/buglist.cgi?f1=cf_status_b2g_2_0m&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_b2g_2_0m&o1=equals&v1=unaffected)
[status-b2g-v2.1](/buglist.cgi?f1=cf_status_b2g_2_1&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_b2g_2_1&o1=equals&v1=wontfix)
[status-b2g-v2.1S](/buglist.cgi?f1=cf_status_b2g_2_1_s&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_b2g_2_1_s&o1=equals&v1=wontfix)
[status-b2g-v2.2](/buglist.cgi?f1=cf_status_b2g_2_2&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_b2g_2_2&o1=equals&v1=affected)
[status-b2g-v2.2r](/buglist.cgi?f1=cf_status_b2g_2_2r&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_b2g_2_2r&o1=equals&v1=affected)
[status-b2g-master](/buglist.cgi?f1=cf_status_b2g_master&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_b2g_master&o1=equals&v1=fixed)
[status-firefox40](/buglist.cgi?f1=cf_status_firefox40&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox40&o1=equals&v1=wontfix)
[status-firefox41](/buglist.cgi?f1=cf_status_firefox41&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox41&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox41&o1=equals&v1=fixed)
[status-firefox-esr31](/buglist.cgi?f1=cf_status_firefox_esr31&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_firefox_esr31&o1=equals&v1=unaffected)
[status-firefox-esr38](/buglist.cgi?f1=cf_status_firefox_esr38&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox_esr38&o1=equals&v1=affected)

|  | [Eric Rescorla (:ekr)](/user_profile?user_id=35667) |  |
| --- | --- | --- |
| [Comment 29](/show_bug.cgi?id=1167489#c29)• 10 years ago |
|  | |

Adding Mike Perry for insight from:
<https://trac.torproject.org/projects/tor/ticket/1517>

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1167489#a5161225_280903)• 10 years ago |

Flags: sec-bounty? → sec-bounty+

|  | [Hovav Shacham](/user_profile?user_id=28795) |  |
| --- | --- | --- |
| [Comment 30](/show_bug.cgi?id=1167489#c30)• 10 years ago |
|  | |

Boris, what about the other implementation of Performance, in dom/workers/Performance.cpp?

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1167489#a5320579_20209)• 10 years ago |

Blocks: [1186489](/show_bug.cgi?id=1186489 "RESOLVED FIXED - Clamp the resolution of performance.now() in workers too")

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 31](/show_bug.cgi?id=1167489#c31)• 10 years ago |
|  | |

Gah, good catch. I forgot that it doesn't share this code, because my initial patches that changed the TimeDuration behavior applied to it too... Filed [bug 1186489](/show_bug.cgi?id=1186489 "RESOLVED FIXED - Clamp the resolution of performance.now() in workers too").

|  | [Matt Wobensmith [:mwobensmith][:matt:]](/user_profile?user_id=452604) |  |
| --- | --- | --- |
| [Comment 32](/show_bug.cgi?id=1167489#c32)• 9 years ago |
|  | |

Hi Yossi, we have made several changes to this API that should address the issues raised. We'd really appreciate it if you could take a look at a current build of Fx41 and comment on how the fixes work for you. Thank you.

|  | [Matt Wobensmith [:mwobensmith][:matt:]](/user_profile?user_id=452604) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1167489#a8435205_452604)• 9 years ago |

Flags: needinfo?(bugzilla)

|  | [Yossi Oren](/user_profile?user_id=539718)  Reporter |  |
| --- | --- | --- |
| [Comment 33](/show_bug.cgi?id=1167489#c33)• 9 years ago |
|  | |

Fine Matt, I will test it and report here.Flags: needinfo?(bugzilla)

|  | [Yossi Oren](/user_profile?user_id=539718)  Reporter |  |
| --- | --- | --- |
| [Comment 34](/show_bug.cgi?id=1167489#c34)• 9 years ago |
|  | |

Test machine - Intel core i7-3667U running Mac OS 10.10.3 (Ivy Bridge, 4MB cache)
Using the proof of concept webpage: <http://s.codepen.io/yossioren/debug/ba94a14dd5942fda5db1a3e70809181d>?
Testing on Firefox 40.0.3 from <https://download-installer.cdn.mozilla.net/pub/firefox/releases/40.0.3/mac/en-US/Firefox%2040.0.3.dmg>
—
Profiling was successful, measurement was successful - Spy in the Sandbox attack is possible
Testing on Firefox 41.0b4 from <https://ftp.mozilla.org/pub/mozilla.org/firefox/releases/41.0b4/mac/en-US/Firefox%2041.0b4.dmg>
—
Profiling was unsuccessful. Whatever you did to the code mitigated the attack. Congratulations :-)
Just a cautionary note: it seems possible to polyfill high resolution time using SharedArrayBuffers. You can get down to the nanosecond, if you don’t mind the crazy amounts of jitter. Here’s a demo, which works on the latest Firefox nightly (although not on 41.0b4):
<http://s.codepen.io/yossioren/debug/LVBNMR>?
There’s already an issue opened about it on the SharedArrayBuffer spec:
<https://github.com/lars-t-hansen/ecmascript_sharedmem/issues/1>

|  | [Matt Wobensmith [:mwobensmith][:matt:]](/user_profile?user_id=452604) |  |
| --- | --- | --- |
| [Comment 35](/show_bug.cgi?id=1167489#c35)• 9 years ago |
|  | |

Thanks Yossi.
Reading [comment 34](/show_bug.cgi?id=1167489#c34 "RESOLVED FIXED - \"Spy in the Sandbox\" - Security issue related to High Resolution Time API"), it sounds like you feel that there still might be another vector for attack here. If you believe so, please feel free to file another bug with as much information - and working PoC - as you can to help us investigate and/or fix that as well.

|  | [BMO Automation](/user_profile?user_id=546015) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1167489#a8913720_546015)• 9 years ago |

Group: core-security → core-security-release

|  | [Matt Wobensmith [:mwobensmith][:matt:]](/user_profile?user_id=452604) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1167489#a9053446_452604)• 9 years ago |

Whiteboard: [post-critsmash-triage]

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 36](/show_bug.cgi?id=1167489#c36)• 9 years ago |
|  | |

I'm writing a security advisory for this unless someone says not to do so. Is there any reason not to disclose this issue and fix?Flags: needinfo?(bugzilla)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1167489#a10090624_280903)• 9 years ago |

Flags: needinfo?(bzbarsky)Whiteboard: [post-critsmash-triage] → [post-critsmash-triage][adv-main41+]

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 37](/show_bug.cgi?id=1167489#c37)• 9 years ago |
|  | |

Apart from coordinating with the reporter of [bug 1153672](/show_bug.cgi?id=1153672 "RESOLVED FIXED - Fingerprinting individuals via performance.now()") I'm not aware of anything.Flags: needinfo?(bzbarsky)

|  | [Yossi Oren](/user_profile?user_id=539718)  Reporter |  |
| --- | --- | --- |
| [Comment 38](/show_bug.cgi?id=1167489#c38)• 9 years ago |
|  | |

No objections on my side, as long as you don't release actual exploit code before Apple rolls out their fix for Safari.Flags: needinfo?(bugzilla)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 39](/show_bug.cgi?id=1167489#c39)• 9 years ago |
|  | |

(In reply to Yossi Oren from [comment #38](/show_bug.cgi?id=1167489#c38 "RESOLVED FIXED - \"Spy in the Sandbox\" - Security issue related to High Resolution Time API"))
> No objections on my side, as long as you don't release actual exploit code
> before Apple rolls out their fix for Safari.
That's a new wrinkle. Do you know when they are shipping? Generally, we'd avoid even the chance of causing Safari difficulty if they're doing the right thing and fixing with appropriate speed.Flags: needinfo?(bugzilla)

|  | [Yossi Oren](/user_profile?user_id=539718)  Reporter |  |
| --- | --- | --- |
| [Comment 40](/show_bug.cgi?id=1167489#c40)• 9 years ago |
|  | |

We got pinged by Apple Product Security on 26/Aug, asking how to credit us on the disclosure in a coming Security Update, so probably it's coming out real soon now.Flags: needinfo?(bugzilla)

|  | [Yossi Oren](/user_profile?user_id=539718)  Reporter |  |
| --- | --- | --- |
| [Comment 41](/show_bug.cgi?id=1167489#c41)• 9 years ago |
|  | |

OK, Apple is acknowledging our disclosure and patching it in today's Security Update (APPLE-SA-2015-09-16-1). It's listed as [CVE-2015-5825](https://www.cve.org/CVERecord?id=CVE-2015-5825)
<https://support.apple.com/en-us/HT205212>

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1167489#a10172956_280903)• 9 years ago |

Alias: CVE-2015-4514

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1167489#a10630783_280903)• 9 years ago |

Alias: CVE-2015-4514

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1167489#a13376579_280903)• 9 years ago |

[status-firefox-esr38](/buglist.cgi?f1=cf_status_firefox_esr38&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox_esr38&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox_esr38&o1=equals&v1=wontfix)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1167489#a35218519_1689)• 9 years ago |

Group: core-security-release

|  | [Nobody; OK to take it and work on it](/user_profile?user_id=1) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1167489#a120221024_1)• 6 years ago |

Component: DOM → DOM: Core & HTML

|  | [David Lawrence [:dkl]](/user_profile?user_id=5898) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1167489#a284821386_5898)• 8 months ago |

Keywords: [reporter-external](/buglist.cgi?keywords=reporter-external&resolution=---)
You need to [log in](/show_bug.cgi?id=1167489&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Yossi Oren](/user_profile?user_id=539718)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review


