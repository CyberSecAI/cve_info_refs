=== Content from people.redhat.com_ff74a1c0_20250126_005905.html ===
Factoring RSA Keys With TLS Perfect Forward Secrecy

Florian Weimer
Red Hat Product Security

September 2015

Abstract

This report describes the successful factorization of
RSA moduli, by connecting to faulty TLS servers
which enable forward secrecy and which use an
insuﬃciently hardened RSA-CRT implementation.
The history of this particular RSA-CRT implemen-
tation defect is discussed, and the current state of
countermeasures is reviewed. Some familiarity with
the RSA cryptosystem and the Transport Layer Se-
curity protocol suite is assumed.

1 The RSA-CRT optimization

The RSA cryptosystem works in a ring Z/nZ.
Knowledge of the private key pq = n allows one to
construct a ring isomorphism between Z/nZ and
Z/pZ ⊕ Z/qZ.

In practice, both p and q are about the size of
√
n. The cost of RSA operations grows quite a
bit faster than O(cid:0)(log n)2(cid:1), for typical implementa-
tions. Therefore, doing the computations in Z/pZ
and Z/qZ separately is more eﬃcient, even after
taking into account the cost of separating the input
and combining the result. (Not just are the moduli
much shorter, but the decryption exponent d can
be reduced as well, and many of the values needed
can be pre-computed during key generation.) This
optimization is usually called the Chinese Remain-
der Theorem (CRT) optimization.

With the CRT optimization, the bulk of the com-
putation happens in the ring Z/pZ ⊕ Z/qZ. If a
fault happens during the computation of a RSA sig-
nature in exactly one of the components, say Z/pZ,
and the attacker gets hold of that faulty signature
y, and the attacker knows the original value x which
is being signed, then

1 < gcd(ye − x, n) < n

(1)

over the integers, where e is the public RSA expo-
nent and a suitable integer representative for ye
(mod n) has been chosen. This means that the
greatest common divisor reveals a prime factor of
n.

Here is why this works, assuming such a fault
has occurred: The ring isomorphism ϕ : Z/nZ →
Z/pZ ⊕ Z/qZ behind the CRT optimization can be
realized as the reduction modulo p and q in the re-
spective components. Assume ϕ(y) = (yp, yq) for
a signature y which is faulty in the component yp,
then ϕ(ye) = (ye
q): the fault is still restricted
to the ﬁrst component. Writing the original value-
to-be-signed x in the form ϕ(x) = (xe
q), we see
that

p, xe

p, ye

ϕ(ye − x) = (a, 0)

for some a ∈ Z/pZ. But this means that any rep-
resentative of ye − x modulo n is a multiple of q.
If the representative is less than n (which is always
possible to arrange), the greatest common divisor
of ye − x with n is q, revealing the factorization.

1.1 Arjen Lenstra’s CRT attack

A widely-cited memo by Arjen Lenstra [1] points
out a problem with this optimization in the sense
that it can lead to an additional side-channel at-
tack. We summarize Lenstra’s observation below,
using slightly diﬀerent language.

1.2 Faults enabling Lenstra’s attack

The nature of the fault which aﬀects the CRT op-
timization can take various forms:

1. The arbitrary precision integer library used by
the RSA implementation could have a defect

1

that causes it to produce incorrect results (see
CVE-2014-3570 in [2], although the practical
impact of this particular defect is minimal, as
explained in the security advisory).

2. There could be a race condition involving data
access from multiple threads in an unsynchro-
nized fashion.

3. The arithmetic unit in the CPU could produce
incorrect results, either in a deterministic fash-
ion for some inputs (as described in [3]), or
randomly due to some environmental condi-
tions (perhaps after overheating, as a result of
its extensive use during an RSA operation).

4. Critical parts of the private key could have
been corrupted after all the integrity checks
(if any) have been performed (see [4]), causing
all future signatures to reveal the private key.

5. CPU caches, other caches, or main memory
could be defective and introduce bit errors into
intermediate results.

If the target is a smartcard (or other device which
is supposed to prevent even its owner from access-
ing the private key material), other forms of faults
may be relevant, typically deliberately introduced
by someone who has physical access to the device.
We are eventually interested in faults in TLS imple-
mentations where we do not have physical access,
which is why we did not consider these additional
faults further.

1.3 Countermeasures

The obvious countermeasure is to verify the cor-
rectness of the signature y by checking ye ≡ x
(mod n), using arithmetic in Z/nZ (without the
CRT optimization). This is already alluded to
in [1]. This veriﬁcation step is relatively cheap com-
pared to the signing operation itself because the
public encryption exponent is typically e = 65537,
which is much shorter than the private exponent
(even with the CRT optimization in place). The
diﬀerence is even more pronounced with the other
popular choice, e = 3,

In response to Klima and Rosa’s attack on the
secret key storage in some implementations of
OpenPGP [4], several RSA-CRT implementations

Implementation
cryptlib 3.4.2
GnuPG 1.4.18
GNUTLS
Go 1.4.1
libgcrypt 1.6.2
Nettle 3.0.0
NSS
ocaml-nocrypto 0.5.1
OpenJDK 8
OpenSSL 1.0.1l
OpenSwan 2.6.44
PolarSSL 1.3.9

Veriﬁcation
disabled by default
yes
see libgcrypt and Nettle
no
no
no
yes
no
yes (see text)
yes (see section 1.3.1)
no
no

Table 1: RSA-CRT and signature veriﬁcation

(notably GnuPG and OpenSSL) introduced hard-
ening against Lenstra’s RSA-CRT attack (because
it was used in the RSA part of the Klima/Rosa
attack). It has been conjectured that this kind of
hardening is no longer relevant (see [5] for a re-
cent example), at least not in the context of non-
smartcard implementations, so we examined the
state of current implementations.

Table 1 shows the result of a source code review
of the major free-software RSA implementations.
The versions reviewed were the most recent sta-
ble versions available at the time of review. All
of them implemented the RSA-CRT optimization.
The table reﬂects the default upstream implemen-
tation only and does not cover alternative RSA im-
plementations which may have been installed using
a plug-in mechanism (which is an optional feature
oﬀered by several of the cryptographic libraries sur-
veyed).

Cryptlib supports checking after CRT-based
RSA signing operations, but the conﬁguration op-
tion which controls this functionality is disabled by
default. The cryptlib author reports in [7] that “en-
abling this option” for general protection against
side-channel attacks “will slow down all private-key
operations by up to 10%”. The post-signing check
is deliberately included among the general protec-
tion mechanisms, so it is disabled by default as well.
NSS simply reports an error to the caller if a
signature fails to verify immediately after its com-
putation. We think this is the best way to deal
with this situation.

OpenJDK was ﬁxed prior to publication, in re-

2

sponse to this research, under the vulnerability
identiﬁer CVE-2015-0478 [6].

2 RSA use in TLS

1.3.1 Countermeasures in OpenSSL

The OpenSSL case is slightly complicated because
this library performs a veriﬁcation and re-computes
the signature without the CRT optimization if a
fault has been detected. We believe that this poses
no immediate danger—Lenstra’s attack on RSA-
CRT certainly does not work even if a second fault
occurs because of the unoptimized second compu-
tation. Depending on the nature of the faults, this
could conceivably still reveal the key over time, but
several thousand faulty signatures are needed for
current key sizes [1, 8], each one preceded by an
RSA-CRT fault. As shown in [8], it is possible to
construct a faulty CPU which indeed leaks keys
in this way, which is why there are some linger-
ing concerns about the reliability of the OpenSSL
hardening.

There may also be OpenSSL variants in cir-
culation which omit RSA-CRT veriﬁcation alto-
gether, either because they have been patched, or a
completely diﬀerent RSA implementation has been
swapped in, using the OpenSSL plug-in mecha-
nism. The comments in the preceding paragraph
apply only to current (1.0.1l) upstream sources and
the rsa_eay.c implementation.

1.4 RSA blinding

Since Lenstra has described his attack, RSA imple-
mentations have started to follow additional rec-
ommendations, particularly as a form of harden-
ing against timing attacks. One common hard-
ening measure is RSA blinding [9], which multi-
plies the value-to-be-signed with a random number
before computing the signature and compensates
for this additional factor afterwards (details vary).
But no matter how RSA blinding is actually imple-
mented, it will not propagate a computation error
which aﬀects only one CRT component to the other
component (again, this is a consequence of the ring
isomorphism ϕ), and RSA blinding does not stop
Lenstra’s attack.

Traditionally, SSL 3.0 and all TLS versions up
to 1.2 ([10], the current version) require that the
server performs an RSA decryption of a client-
supplied challenge as part of the handshake, thus
authenticating the server to the client. But this
approach does not work if the server uses an X.509
certiﬁcate which does not embed an encryption-
capable public key.
(Historically, such keys were
DSA keys.) To use such keys, SSL 3.0 provides
a diﬀerent authentication mechanism: the server
signs a message containing, among other things, a
client-supplied random string (to ensure freshness)
and parameters for establishing a session key us-
ing an instance of the Diﬃe-Hellman key agreement
scheme.

It was then noticed that it is possible to pretend
that RSA keys do not support encryption, and use
their signing capabilities only, just as one would
do with a DSA key. This protocol tweak has the
property that as long as there is no practical oﬄine
attack on the Diﬃe-Hellman variant being used,
it is not possible to recover the plaintext of TLS
sessions even if the server private key is leaked after
the fact, which is why this protocol variant goes
by the somewhat pompous name Perfect Forward
Secrecy, or just forward secrecy.

This protocol change opens up RSA keys to
Lenstra’s attack, assuming that the underlying
RSA-CRT implementation lacks appropriate check-
ing. (The Diﬃe-Hellman variant used for session
key negotiation does not matter here.)

Recall that Lenstra’s attack needs knowledge of
the value x which has been signed, in addition to
the corrupted signature y. This means that a deter-
ministic padding scheme is required for the attack
to work. Curiously, SSL 3.0 and all versions of TLS
up to 1.2 use a variant of the fully deterministic
PKCS #1 version 1.5 RSA signature padding [11].
Versions up to TLS 1.1 concatenate the MD5 and
SHA-1 hash of the message and do not include the
DER-encoded OID of the digest algorithm. TLS
1.2 added digest algorithm negotiation, switched
to a standard digest algorithm (no more concate-
nation of two digests), and includes the OID in the
padding.

But the key point remains: These schemes are all
deterministic. There have been discussions to use
randomized padding schemes for RSA signatures in

3

TLS (predominantly RSASSA-PSS [12]), and the
new negotiation capabilities in TLS 1.2 would have
provided a backwards-compatible way to introduce
them. It is surprising that this has not happened.
The actual key recovery attack can be described
in very simple terms: establish a TLS session, ne-
gotiate forward secrecy, and watch out for a mis-
computed signature.
If a signature mismatch is
detected, attempt Lenstra’s attack to recover the
RSA private key. Figure 1 shows the patch we
used to experimentally validate that the approach
works. The patch introduces the fault (the time
dependency will be used in section 4) and removes
OpenSSL’s countermeasure against faults during
the RSA-CRT computation.

3 The experiment

As explained above,
implementers no longer
consider hardening RSA-CRT signing operations
against faults a necessity. The increased deploy-
ment of TLS with forward secrecy provides a way
to test if this decision is reasonable: We imple-
mented a crawler which performs TLS handshakes
and looks for miscomputed RSA signatures. We
ran this crawler for several months.

The intention behind this conﬁguration is to
spread the load as widely as possible. We did
not want to target particular servers because that
might have been viewed as a denial-of-service at-
tack by individual server operators. We assumed
that if a vulnerable implementation is out in the
wild and it is somewhat widespread, this experi-
mental setup still ensures the collection of a fair
number of handshake samples to show its existence.
We believe this approach—probing many instal-
lations across the Internet, as opposed to stressing a
few in a lab—is a novel way to discover side-channel
vulnerabilities which has not been attempted be-
fore.

3.1 Setup

The crawler ran in two instances:

• One instance used the OpenSSL 1.0.1k-3 De-
bian package, recompiled to add back SSL
3.0 support (to reduce the amount of spuri-
ous handshake failures). It ran on a Debian 8
operating system (amd64 architecture).

• Another instance ran on Red Hat Enterprise
Linux 7.1, using the OpenSSL packages with
versions 1.0.1e-42.el7_1.6 and later (which
reject weak Diﬃe-Hellman primes).

An OpenSSL function, SSL_set_msg_callback,
is used to install a callback function which Open-
SSL invokes after processing handshake messages.
This enables the crawler to run with an unmodiﬁed
OpenSSL library (and will make it possible to re-
run the experiment in the future, potentially with
a diﬀerent OpenSSL version). The callback func-
tion is invoked even in the presence of handshake
failures.

We chose to include cipher suites without for-
ward secrecy in the client hello message, to make it
somewhat less obvious to server operators what we
were after in this experiment. The crawler adver-
tised TLS 1.2 support, but would retry connections
with TLS 1.0 and SSL 3.0 in response to certain
handshake failures.

Three diﬀerent forms of target selection were

used:

1. Domain-based target selection. The domain
list consisted of a manually curated list of crit-
ical domains, plus Hubert Kario’s domain list
used in his TLS scans [13]. We also included
domain names from a subset of the certiﬁ-
cates documented by the Rapid7 Sonar SSL
scans [14]. Later on, we added host names ex-
tracted from certiﬁcate transparency logs [15],
too.

The total set of targets had 25 million host
names (and IP addresses), and we saw hand-
shakes with forward secrecy for 8 million of
these targets. We conducted about 1.7 billion
TLS handshakes in total, of which 1.4 billion
involved forward secrecy.

2. IP-based target selection. We used IP ad-
dresses extracted from the same Rapid7 Sonar
SSL scans. We also experimented with the
University of Michigan ZMap data [16], but
the published data was not current at the time
we noticed its availability.1

1Originally, the published ZMap/zgrab data did not in-
clude the client hello and the complete ServerKeyExchange
message, so the TLS traces do not contain suﬃcient infor-
mation to attempt key recovery. The ZMap team has since
switched to publishing more complete data.

4

The consolidated target set contained 32 mil-
lion IP addresses, of which 10 million re-
sponded with a forward secrecy handshake.
Here, the number of TLS handshakes was
around 3.8 billion, of which 3.4 billion had for-
ward secrecy enabled.

3. Certiﬁcate-based target selection. We selected
targets based on X.509 certiﬁcate properties,
mainly vendor strings. There were 26,000 tar-
gets in that category, with about 40 million for-
ward secrecy handshakes combined, yielding a
high number of such handshakes per target.

In both cases, we switched, after a few probing
runs over the entire target set, to the subset of
targets which performed a TLS handshake which
involved a ServerKeyExchange message (because
that is the only way a key leak could occur).

We assumed that the ﬁrst option would yield bet-
ter results: Port scanning, without domain names,
should no longer be fully eﬀective because some
TLS servers require a valid Server Name Indication
before they complete the TLS handshake. But this
turned out not to be the case, and the second ap-
proach was far more eﬀective. As the results below
show, most of the aﬀected devices were not in the
browser PKI. They do not even contain a match-
ing host name in their X.509 certiﬁcates, and do
not show up in the certiﬁcate transparency logs.

In addition,

for the domain-based approach,
DNS resolution turned out to be a major bottle-
neck. We used the PowerDNS recursor on the
same machine, conﬁgured to cache records aggres-
sively (mostly by increasing the cache size and
ignoring server-provided TTL values). However,
this caching was only eﬀective while we were us-
ing a smaller set of host names, and we eventually
had to cache name resolution results in an SQLite
database, completely bypassing TTL values.

3.2 Key recovery implementation

If OpenSSL reports any handshake failure, the
RSA signature is extracted from the Server-
KeyExchange handshake message using a custom-
written partial TLS parser. A key recovery based
on equation (1) is attempted: y is the extracted
signature, e and n are extracted from the X.509
certiﬁcate sent by the server, and the expected sig-

nature value x is formed by applying PKCS#1 ver-
sion 1.5 padding to the appropriate digest value, as
required by the TLS protocol.

The dominating operation in equation (1) is the
public RSA operation, ye. Therefore, the key re-
covery computation is slightly more costly than ver-
ifying an RSA signature.

Key recovery can fail for various reasons:

1. If the signature is not actually faulty, then
ye ≡ x (mod n), and the handshake failed for
other reasons.

2. If the signature has faults in both CRT com-
ponents, the greatest common divisor gcd(ye −
x, n) will be 1, and not reveal a factorization.

(a) The public key in the X.509 certiﬁcate
and the private RSA key used to create
the signature do not match: The private
RSA key is internally consistent, and no
fault occurs during signature computa-
tion. The signature is just for the wrong
public key, and cannot be veriﬁed against
the public key in the X.509 certiﬁcate.

(b) Multiple faults occur during a RSA-CRT
computation, aﬀecting all CRT compo-
nents and not just one.

(c) A fault occurred, but the RSA-CRT op-
timization was not used to compute the
signature as it is disclosed to the client.
(This case includes the OpenSSL fallback
scenario, discussed in section 1.3.1 and
[8].)

(d) The ServerKeyExchange message was
corrupted after the signature was com-
puted (perhaps during transmission over
the Internet).

(e) The signature was computed correctly,
using the expected key, but over the
wrong digest. This can happen if the di-
gest was miscomputed on the server side,
or earlier handshake messages were cor-
rupted so that the client computes the
wrong expected digest.

Except in the last case, ye will not have valid
PKCS#1 version 1.5 padding.

We discuss key recovery failures in more detail in

section 3.4.

5

3.3 Results

Table 2 summarizes the results of the crawler.
“Vendor” refers to the putative device maker; see
below for a description how devices were attributed
to speciﬁc vendors.

The counts in the “Keys” column is based on the
number of distinct RSA moduli (and not full X.509
certiﬁcates, or device or IP address counts).

The “PKI” column indicates whether the pub-
lic key was signed by a certiﬁcate authority which
is part of the browser PKI; “expired” means the
certiﬁcate was expired at time of factorization.

The “Rate” column indicates how often the key
leaked; most key leaks were seen multiple times, but
the rate varied from one-time leaks (“very low”), to
the occasional odd handshake (“low”) to the ma-
jority of handshakes (“high”; at this point, faults
prevent leaks by happening in both CRT compo-
nents at the same time), or even all handshakes
(“always”). The location in the “Geo” column was
determined based on WHOIS data.

3.3.1 Discussion of individual key leaks

The two keys leaked ﬁrst were used by the same
organization, on devices with neighboring IP ad-
dresses. An investigation with the help of the
certiﬁcate authority and the system administrator
showed that the keys were stored in the same hard-
ware accelerator card of a TLS-terminating load
balancer, a Citrix Netscaler device. The load bal-
ancer was quite old and was already scheduled for
replacement. This replacement happened after we
contacted the system administrator, and the cer-
tiﬁcates were reissued.

The next key leak we observed was from a de-
vice made by Hillstone Networks. The ﬁrst leaked
key of this kind was picked up by accident dur-
ing our domain-based crawler runs. The certiﬁ-
cate was self-signed, and the subject distinguished
name in the X.509 certiﬁcate contained the strings
“Hillstone Networks” and “SG-6000”. Further
probing based on this vendor name identiﬁed more
than 200 additional public keys whose private key
leaked. Devices with the “DCFW-1800” string in
their X.509 certiﬁcates are from them same manu-
facturer and are included in these counts. Hillstone
Networks as since release a ﬁrmware update [17] to
correct this issue.

Vendor
Citrix
Hillstone

Networks

Alteon/
Nortel
Viprinet
QNO

ZyXEL

BEJY
Fortinet

2 DE

Keys Geo PKI
yes
231 CN no
no
1 CZ
1 PL
no
1 TH no
no
1 US
expired
1 US
no
1 US
1 NL
no
2 CN no
1 TW no
4 AT
no
1 CH no
no
1 DE
2 DK no
no
1 FR
no
7
IE
no
IT
1
no
2 NL
1
no
SE
5 UK no
no
1 US
yes
1 DE
no
1 US
no
IN
1

Rate
medium
low
low
low
low
low
high
high
always
medium
medium
low
low
low
low
low
low
low
low
low
low
low
low (?)
very low
very low

Table 2: Crawler results

6

The key leaks attributed to an Alteon/Nor-
tel device occured from two IP addresses on the
same subnet, and because of that proximity and
the similarity in behavior, we assumed it was
a single device. Only one of the certiﬁcates
embedded the string “Alteon/Nortel Generated
Certificate”, on which the attribution is based.
For both IP addresses failure rate was so high that
the TLS implementation was unable to complete
the majority of handshakes successfully. The va-
lidity periods of the the X.509 certiﬁcates suggest
that they were generated many years ago. If the
key is still loaded into the same device on which
it was generated, these two keys were leaked by an
old piece of equipment, like those from the Citrix
device.

In the case of the Viprinet device, the key
was apparently corrupted in memory or in persis-
tent storage because the RSA signature in every
ServerKeyExchange message generated by the de-
vice exposes the RSA private key. (This is similar
to what happens in case of the Klima/Rosa attack
[4].) See section 3.4.3 for another defect related to
this vendor.

The devices made by QNO Technology were ﬁrst
identiﬁed using the second probing approach (based
on IP addresses), followed by further tests target-
ing a subset of addresses based on X.509 certiﬁcate
properties (on which the attribution is based).

The ZyXEL devices we observed were discovered
in the same way. The Common Name attribute
in their X.509 certiﬁcates started with “zw110” or
“nxc2500”. ZyXEL conﬁrmed [18] that they had
already addressed this issue in a ﬁrmware update
in March 2013, but as a functionality defect and
not as a security vulnerability.

BEJY is a proprietary, custom Java implemen-
tation of RSA, TLS, and HTTP/HTTPS, which is
not based on the usual Java cryptographic frame-
works (JCE and JSSE). The server operator ﬁxed
the code rather quickly, and we only saw a single
key leak. This particular code base does not ap-
pear to be widely used, although JAR ﬁles with
the server code can be downloaded for free.

The Fortinet devices identiﬁed themselves with
a Common Name starting with “FG300B”. We ob-
served just two key leaks from two diﬀerent devices,
in over 90 million TLS handshakes with forward
secrecy, across many diﬀerent devices with simi-
lar certiﬁcates. Clearly, the TLS implementation

lacked RSA-CRT hardening, but beyond that, it
was unclear what was happening.

3.3.2 A note on interpreting the results

Various versions of the crawler ran over a time pe-
riod of nine months. As a result, lots of handshakes
were analyzed, but at 200 handshakes per second
on average, the number of handshakes is still just a
negligible fraction of all TLS handshakes on the In-
ternet during that time period. Very close to pub-
lication of this report, we picked up one case with
an extremely low key leak rate (Fortinet) by sheer
luck, and other such cases may exist as well.

In all likelihood, the distribution between ven-
dors and countries shown in table 2 does not ac-
curately reﬂect the actual distribution of devices
which leak RSA keys in this way. In order for the
crawler to pick up the device at all, a few require-
ments need to be met:

1. The device must implement TLS.

2. It must oﬀer a TLS service on port 443/TCP.

3. This TLS service must be accessible to the gen-

eral Internet.

The third item is not just a property of the de-
vice, but also depends on how the device is deployed
in the ﬁeld. An Internet service provider that in-
stalls customer premises equipment with a world-
accessible HTTPS management interface on port
443/TCP can easily shift these numbers, and some
of the observations in table 2 may be the result of
that.

3.3.3 A common root cause?

[20],

[19], Hillstone Networks

Citrix
and
ZyXEL [18] conﬁrmed that they use Cavium
as a hardware supplier.
Documentation [21]
from Radware (the company that acquired the
Alteon/Nortel product lines) suggests that they
use this that they use this supplier as well,
but we could not conﬁrm that the referenced
documentation actually applied to the device we
observed.

In case of Hillstone Networks and ZyXEL, Cav-
ium supplied custom versions of OpenSSL, which
are not available to the general public in source

7

code form. Both vendors disabled the hardware
acceleration in order to prevent the key leak and to
re-enable the RSA-CRT hardening present in the
OpenSSL upstream version.

Cavium kindly provided us with the following

statement [22]:

Cavium has issued a patch and noti-
ﬁed all customers (CVE-2015-5738) that
are using older SDK 2.x Cavium Cryp-
tographic Software under Linux on older
OCTEON II CN6xxx Hardware with de-
tails of the vulnerability. OCTEON II
running Simple Exec (SE-S) applications
and OCTEON III CN7xxx processors are
not aﬀected.

The relationship of QNO or Fortinet with this
hardware supplier is unknown. Viprinet and BEJY
do not use this supplier.

3.4 Other faulty signatures

In addition to faulty signatures which resulted in
recovery of the private key, we saw faulty signa-
tures were key recovery failed. As explained in sec-
tion 3.2, there are several potential causes. We
attempted to attribute these failures to speciﬁc
causes.

3.4.1 Public/private key mismatch

In this scenario, the server public key, as contained
in its X.509 certiﬁcate sent during the TLS hand-
shake, does not match the private key which is used
to compute the signature, but apart from that, the
signature is computed correctly.

We used the following approach to recover the
public key n from two faulty signatures (x, y),
(x(cid:48), y(cid:48)), where x, x(cid:48) are the expected padded values
over which the signature is computed, and y, y(cid:48) are
the server-provided signatures. Assuming the RSA
signatures have been computed correctly using the
same private key, n | ye − x and n | y(cid:48)e − x(cid:48), so that

n | gcd(ye − x, y(cid:48)e − x(cid:48)),

(2)

computed over Z. (If our assumption about correct
computation was incorrect, the greatest common
divisor will likely be 1 or a small integer, see below.)

It is still necessary to guess the public encryption
exponent e. We tried the values 3, 17, and 65537.
The latter makes the computation of the greatest
common divisor in (2) somewhat cumbersome, but
it is well within reach of modern systems.

ye − x and y(cid:48)e − x(cid:48) should be (pseudo-)random
multiples of n (otherwise, this might point to a ﬂaw
in the RSA cryptosystem), which means that the
respective cofactors of n are relatively prime with
probability 6π−2. (This result goes back to Dirich-
let, see exercise 4.5.2(10) in [23].) Consequently,
there is a good chance that (2) is, in fact, an equal-
ity. The greatest common divisor with additional
pairs can be computed to make sure that the in-
ferred value of n is indeed the right one.

We did not fully automate this process because
our main goal here was to weed out known causes
of miscomputed signatures. The handshake failure
due to this misconﬁguration is harmless because
it does not leak the private key, and so it does not
warrant further consideration as part of this report.

3.4.2 Accidental factors of a corrupted pub-

lic key

We observed one rather peculiar factorization of a
RSA modulus, involving factor 23. What happened
was that the public key in the X.509 certiﬁcate was
corrupted in some (there was a bit ﬂip, according to
the server operator), and equation (1) accidentally
revealed the factor 23. The corrupted modulus had
other small factors, too, and a large composite fac-
tor with an unknown factorization.

Even if a complete factorization of the corrupted
modulus had leaked, this would not have been use-
ful for attacking the correct modulus. The server
had RSA-CRT hardening, so a key leak was not
possible, but the operator quickly retired the de-
fective server and replaced the X.509 certiﬁcate as
a precaution.

3.4.3 No-op RSA

Several deployed VPN devices whose certiﬁcates
suggest they were manufactured by Viprinet con-
sistently generate ServerKeyExchange messages
where the RSA signature is unencrypted. That is,
x = y and e = d = 1 for the computation, although
the X.509 certiﬁcate says that the public exponent
is 65537. This defect leads to an interoperability

8

failure with properly behaving clients, but it does
not leak the server private key.

If this is not the result of memory implementa-
tion, but of a defect in the TLS implementation
which uses this no-op RSA variant, and this TLS
implementation is used on both ends, TLS will not
provide any cryptographic protection.

3.4.4 Zero RSA

Some servers occasionally or consistently produce
ServerKeyExchange messages which contain RSA
signatures which are zero. Encoding of the num-
ber zero varied. In some cases, zero or one bytes
were transmitted. Sometimes the length of the sig-
nature matched the size of the RSA modulus. The
latter suggests that the server implementation may
have omitted the copy of the computed signature.
This could happen if RSA-CRT hardening detects
a faulty signature, does not write the result to a
caller-provided buﬀer, returns an error. If the caller
is defective and ignores RSA signature computation
failures, it may then proceed to send out the un-
written buﬀer.

4 Browser behavior

The

This section presents a curious observation which
is only peripherally related to the main results.
timing dependency in our

corrupted
OpenSSL version (see ﬁgure 1) gives clients who
retry on handshake error a second chance. Most
web browsers perform such second tries to in-
crease compatibility, reducing security at the same
time (“insecure protocol downgrade”). To see
what this means in the presence of corrupted
forward secrecy signatures, we checked several
web browsers against the example web server in
OpenSSL (“openssl s_server -www”).

The results are shown in table 3. Most of the
tested browsers are binaries provided by Debian.
The Firefox binaries are oﬃcial builds from Mozilla.
Neither the Iceweasel nor the Firefox binaries use
the system NSS library. The test system was a De-
bian 7.8 amd64 installation, except for the Internet
Explorer test, where a German version of Windows
8.1 (updated to the January 2015 version) was used.
Most of the tested browsers hide server prob-
lems in the TLS signing operation. Between ver-

Browser
Chromium

37.0.2062.120-1~deb7u1
Iceweasel 31.4.0esr-1~deb7u1
Internet Explorer

11.0.9600.17498/11.0.15

Firefox 31.0
Firefox 32.0
...
Firefox 37.0
Firefox 38.0
w3m 0.5.3-8

Behavior
silent retry

silent retry
limited retry

silent retry
limited retry
...
limited retry
failure
failure

Table 3: Browser behavior in response to server
signature failures

sion 31.0 and 32.0, Firefox switched from an un-
conditional retry on this particular error to report-
ing a failure (with a “Try Again” button, though).
However, the error is only reported on subsequent
connection attempts during the same browser ses-
sion. Even in version 32.0 (and later versions up
to 37.0), Firefox silently retries a second time if
the error happens during the initial connection at-
(We believe this behavior is not related
tempt.
to TLS session resumption, but caused by a cache
introduced to reduce protocol downgrades due to
network glitches.) Beginning with version 38.0,
Firefox always reports handshake failures due to
faulty ServerKeyExchange signatures (with a “Try
Again” button).

The tested version of Internet Explorer shows the
reverse retry behavior: Initial connections with a
faulty signature fail, but if an unsuccessful session
resumption attempt leads to a full handshake with
a faulty signature, Internet Explorer silently retries
the connection, covering up the signing error.

We need to stress here that all these behavioral
variants in browsers are not themselves vulnerabil-
ities. But these silent retries help to hide the fact
that the server signing operation is vulnerable to
Lenstra’s attack.

5 Impact on other protocols

The RSA cryptosystem is used in other protocols
besides TLS, and deterministic padding schemes
such as PKCS #1 version 1.5 are widely used. How-

9

ever, some protocols make key leaks from miscom-
puted RSA signatures invisible to passive observers.

5.1 IPsec

The majority of the leaked keys aﬀected devices
whose X.509 certiﬁcates suggested they are used
as VPN gateways.
Some operating modes for
IPsec-based VPN gateways use RSA, and until re-
cently [24], there was not a standard option in the
Internet Key Exchange (IKE) to avoid determinis-
tic signatures when RSA keys are used. Therefore,
it is conceivable that IPsec VPN gateways with
faulty RSA implementations leak private key ma-
terial not just over their web front ends, but also
through IKE (that is, as part of regular IPsec op-
eration). Due to the early use of a Diﬃe-Hellman
key exchange in IKE protocol, such key leaks may
not be visible to passive observers, only to those
actively participating in the handshake.

Most VPN devices will not expose the admin-
istrative front end to the public Internet, which
means that the results presented in section 3.3
likely underestimate the number of aﬀected VPN
devices and the range of vendors. Further research,
using a diﬀerent crawler implementation, might be
able to settle this question.

5.2 SSH

Like IPsec, SSH performs a Diﬃe-Hellman key ex-
change early in the protocol, so active participation
in the handshake is required to observe key leaks.

5.3 DNSSEC

Due to its use of oﬄine signatures, DNSSEC is less
exposed than other RSA-using protocols. Further-
more, it is recommended practice to check zone ﬁles
for consistency and cryptographic correctness prior
to publication. A key-leaking RSA signature would
be noticed at this step, and prevent publication of
the zone.

6 Conclusion

This report shows that it is still possible to use
Lenstra’s attack to recover RSA private keys, al-
most two decades after the attack has been de-

scribed ﬁrst, and that fault-based side-channel at-
tacks can be relevant even in scenarios where the
attacker does not have physical access to the device.
Several factors had to contribute to make this

attack possible, namely:

1. Many RSA implementations still do not verify
signatures that have been computed with the
CRT optimization.

2. TLS with forward secrecy uses RSA signatures
with deterministic padding, which are, in prin-
ciple, vulnerable to Lenstra’s attack.

3. A campaign is under way to deploy forward
secrecy in TLS more widely, in eﬀect making
more servers potentially vulnerable to this at-
tack.

4. Browsers cover up faulty server-computed
RSA signatures, hiding even fairly high error
rates.

The net eﬀect is that a passive observer with vis-
ibility into global Internet traﬃc is likely able to
recover quite a few RSA keys in a completely non-
attributable fashion.

Initially, we suspected that these puzzle pieces
ﬁt together in a rather strange manner. But dis-
cussions with TLS library implementers showed
they assumed that they had good reasons to avoid
adding the check to RSA-CRT-based signing. The
campaign for Perfect Forward Secrecy is likely
based on its compelling name, and not on a care-
ful analysis of the security trade-oﬀs involved. The
browser fallback behavior appears just to be an un-
related accident.

In the short term, implementing a checked RSA-
CRT signing operation, like NSS or even OpenSSL
already do (despite some theoretical concerns about
the eﬀectiveness in the case of OpenSSL), seems a
very reasonable hardening measure. Longer term,
TLS should perhaps switch to a non-deterministic
signature scheme like RSASSA-PSS. However, none
of these measures will help those operators who
have been using unchecked RSA-CRT implemen-
tations for years, and are now wondering if their
RSA private keys have already leaked.

10

Acknowledgments

Nikos Mavrogiannopoulos kindly answered ques-
tions about the RSA implementations used by
GNUTLS. Xuelei Fan unearthed an online copy of
Lenstra’s 1996 memo, and Arjen Lenstra conﬁrmed
that is genuine. Werner Koch helped to link the in-
troduction of RSA-CRT checking to the attack by
Klima and Rosa. Hubert Kario provided helpful
comments on a draft of this report. Peter Gut-
mann answered questions regarding cryptlib. Paul
Wouters clariﬁed some IPsec aspects.

[7] Peter Gutmann, cryptlib Security Toolkit

Version 3.4.2. ftp://ftp.franken.de/pub/
crypt/cryptlib/manual.pdf (retrieved
2015-01-21)

[8] Andrea Pellegrini, Valeria Bertacco, Todd

Austin, Fault-Based Attack of RSA
Authentication. Design Automation and Test
in Europe (DATE), March 2010.
http://web.eecs.umich.edu/~valeria/
research/publications/DATE10RSA.pdf
(retrieved 2015-01-21)

References

[1] Arjen Lenstra, Memo on RSA signature
generation in the presence of faults.
https://infoscience.epfl.ch/record/
164524/files/nscan20.PDF (retrieved
2015-01-22)

[2] OpenSSL Project, OpenSSL Security

Advisory 08 Jan 2015. January 2015. http:
//openssl.org/news/secadv_20150108.txt
(retrieved 2015-01-21)

[3] Eli Biham, Yaniv Carmeli, Adi Shamir, Bug

Attacks. CRYPTO 2008.
http://iacr.org/archive/crypto2008/
51570222/51570222.pdf (retrieved
2015-06-15)

[4] Vlastimil Klíma and Tomáš Rosa, Attack on
Private Signature Keys of the OpenPGP
format, PGP programs and other applications
compatible with OpenPGP. March 2001.
http://eprint.iacr.org/2002/076.pdf
(retrieved 2015-01-24)

[5] Peter Gutmann, Vulnerability of RSA vs.

DLP to single-bit faults. Mailing list posting,
November 2014.
http://www.metzdowd.com/pipermail/
cryptography/2014-November/023464.html
(retrieved 2015-01-22)

[6] Oracle Corporation, Oracle Critical Patch

Update Advisory—April 2015.
http://www.oracle.com/technetwork/
topics/security/cpuapr2015-2365600.
html#AppendixJAVA (retrieved 2015-06-11)

[9] Paul C. Kocher, Timing Attacks on

Implementations of Diﬃe-Hellman, RSA,
DSS, and Other Systems. CRYPTO, 1996.
http://www.cryptography.com/public/
pdf/TimingAttacks.pdf (retrieved
2015-01-21)

[10] Tim Dierks, Eric Rescorla (eds.), The

Transport Layer Security (TLS) Protocol
Version 1.2. RFC 5246, August 2008.
http://tools.ietf.org/html/rfc5246
(retrieved 2015-01-22)

[11] Burt Kaliski, PKCS #1: RSA Encryption
Version 1.5. RFC 2313, March 1998.
http://tools.ietf.org/html/rfc2313
(retrieved 2015-01-22)

[12] Jakob Jonsson, Burt Kaliski, Public-Key

Cryptography Standards (PKCS) #1: RSA
Cryptography Speciﬁcations Version 2.1. RFC
3447, February 2003.
http://tools.ietf.org/html/rfc3447
(retrieved 2015-01-22)

[13] Hubert Kario, TLS landscape. January 2015.
https://securityblog.redhat.com/2014/
09/10/tls-landscape/ (retrieved
2015-01-24)

[14] Rapid 7, Project Sonar SSL Certiﬁcates.

January 2015.
https://scans.io/study/sonar.ssl
(retrieved 2015-01-22)

[15] Certiﬁcate Transparency—Known Logs.

http://www.certificate-transparency.
org/known-logs (retrieved 2015-02-03)

11

[16] University of Michigan, Full IPv4 HTTPS
Handshakes. https://scans.io/series/
443-https-tls-full_ipv4 (retrieved
2015-06-08)

[17] Hillstone Networks, 山石网科关于第三方某型号硬
件器件设计缺陷可能导致信息泄露问题的声明.
July 2015. http://www.hillstone.com.cn/
services/2015/0728/20150728.html
(retrieved 2015-08-26)

[18] ZyXEL Communications Corp., personal

communications, June 2015.

[19] Citrix Systems, Inc., personal
communications, April 2015.

[20] Hillstone Networks, personal
communications, June 2015.

[21] Radware, BP15958: Alteon Support for FIPS

140-2. http:
//kb.radware.com/Questions/Alteon/
Public/Alteon-Support-for-FIPS-140-2
(retrieved 2015-08-25)

[22] Cavium, Inc., personal communcations,

August 2015.

[23] Donald E. Knuth, The Art of Computer
Programming. Volume 2: Seminumerical
Algorithms. Second edition. Addison-Wesley,
1981.

[24] Tero Kivinen, Joel Snyder, Signature

Authentication in the Internet Key Exchange
Version 2 (IKEv2). RFC 7427, January 2015.

12

diff --git a/crypto/rsa/rsa_eay.c b/crypto/rsa/rsa_eay.c
index 3e08fe7..87c1f09 100644
--- a/crypto/rsa/rsa_eay.c
+++ b/crypto/rsa/rsa_eay.c
@@ -844,6 +844,17 @@ static int RSA_eay_mod_exp(BIGNUM *r0, const BIGNUM *I, RSA *rsa, BN_CTX *ctx)

if (!rsa->meth->bn_mod_exp(m1,r1,dmq1,rsa->q,ctx,

rsa->_method_mod_q)) goto err;

+
+
+
+
+
+
+
+
+
+
+

// Occasionally inject a fault.
{

static time_t last;
time_t current = time(NULL);
if (current - last > 5) {

last = current;
BN_add_word(m1, 0x80);
printf("Fault injected.\n");

}

}

/* compute I mod p */
if (!(rsa->flags & RSA_FLAG_NO_CONSTTIME))

{

@@ -897,7 +908,7 @@ static int RSA_eay_mod_exp(BIGNUM *r0, const BIGNUM *I, RSA *rsa, BN_CTX *ctx)

if (!BN_mul(r1,r0,rsa->q,ctx)) goto err;
if (!BN_add(r0,r1,m1)) goto err;

-
+

if (rsa->e && rsa->n)
if (rsa->e && rsa->n && 0)

{
if (!rsa->meth->bn_mod_exp(vrfy,r0,rsa->e,rsa->n,ctx,rsa->_method_mod_n)) goto err;
/* If 'I' was greater than (or equal to) rsa->n, the operation

Figure 1: Patch to inject a RSA-CRT-related fault into OpenSSL for testing purposes

13



=== Content from wolfssl.com_32e5ea3d_20250124_120202.html ===

[Skip to content](#content)

* Questions? [Contact Us](https://www.wolfssl.com/contact/)
* [Support Forums](https://www.wolfssl.com/products/support-and-maintenance/)
* [![wolfSSL Japan](/wordpress/wp-content/uploads/2017/11/japan-site.png)](https://www.wolfssl.jp)

[Home![](https://www.wolfssl.com/wordpress/wp-content/uploads/2020/12/wolfssl_logo_300px.png)](https://www.wolfssl.com/)
[Menu Menu](#menu)

* [Home](https://www.wolfssl.com/)
* [About](https://www.wolfssl.com/about/)
  + [Contact Us](https://www.wolfssl.com/contact/)
  + [wolfSSL Software Development Process and Quality Assurance](https://www.wolfssl.com/about/wolfssl-software-development-process-quality-assurance/)
* [Products](https://www.wolfssl.com/products/)
  + [Post Quantum](https://www.wolfssl.com/products/wolfcrypt-post-quantum/)
  + [wolfSSL / wolfCrypt](https://www.wolfssl.com/products/wolfssl/)
  + [wolfCrypt FIPS 140-2/3](https://www.wolfssl.com/license/fips/)
  + [wolfHSM](https://www.wolfssl.com/products/wolfhsm/)
  + [DO-178](https://www.wolfssl.com/wolfssl-support-178-dal/)
  + [wolfTPM](https://www.wolfssl.com/products/wolftpm/)
  + [wolfMQTT](https://www.wolfssl.com/products/wolfmqtt/)
  + [wolfSSH](https://www.wolfssl.com/products/wolfssh/)
  + [wolfBoot](https://www.wolfssl.com/products/wolfboot/)
  + [wolfSentry IDPS](https://www.wolfssl.com/products/wolfsentry/)
  + [curl / tinycurl](https://www.wolfssl.com/products/curl/)
  + [wolfSSL JNI and JSSE Provider](https://www.wolfssl.com/products/wolfssl-jni-jsse/)
  + [wolfCrypt JNI and JCE Provider](https://www.wolfssl.com/products/wolfcrypt-jni-jce/)
  + [wolfCLU](https://www.wolfssl.com/products/wolfclu/)
* [Download](/download)
* [License](https://www.wolfssl.com/license/)
  + [Support and Maintenance](https://www.wolfssl.com/products/support-and-maintenance/)
  + [Consulting Services](https://www.wolfssl.com/docs/consulting/)
  + [FIPS 140-2 and FIPS 140-3](https://www.wolfssl.com/license/fips/)
  + [DO-178](https://www.wolfssl.com/wolfssl-support-178-dal/)
* [Blog](https://www.wolfssl.com/blog/)
* [Docs](https://www.wolfssl.com/docs/)
  + [FAQ](https://www.wolfssl.com/docs/frequently-asked-questions-faq/)
  + [wolfSSL Manual](https://www.wolfssl.com/documentation/manuals/wolfssl/index.html)
  + [YouTube Videos](https://www.youtube.com/wolfssl)
  + [Benchmarks](https://www.wolfssl.com/docs/benchmarks/)
  + [Case Studies](https://www.wolfssl.com/docs/case-studies/)
  + [White Papers](https://www.wolfssl.com/docs/wolfssl-white-papers/)
  + [Vulnerability Info](https://www.wolfssl.com/docs/security-vulnerabilities/)
* [Community](https://www.wolfssl.com/community/)
  + [Events / Webinars](https://www.wolfssl.com/events/)
  + [Forums](https://www.wolfssl.com/forums/)
* [Partners](https://www.wolfssl.com/community/partner-network/)
* Search for:

  *Search*

# WOLFSSL CHANGELOG

The **wolfSSL ChangeLog** documenting the changes that took place with each release of wolfSSL since the project’s beginning in 2006 can be found in each wolfSSL release archive as well as online on GitHub here:

<https://github.com/wolfSSL/wolfssl/blob/master/ChangeLog.md>

[# wolfSSL FAQ](https://www.wolfssl.com/frequently-asked-questions-faq/)

[# wolfSSL curl](https://www.wolfssl.com/products/curl/)

[![](/wordpress/wp-content/uploads/2018/08/TLS13-now-avail.png)](https://www.wolfssl.com/docs/tls13/)
[# Upcoming Events](https://www.wolfssl.com/events/)

[# wolfSSL Partners](https://www.wolfssl.com/community/partner-network/)

[## wolfSSL SSL/TLS Library

The wolfSSL lightweight TLS library supports TLS 1.3 and DTLS 1.3 on both client and server sides, features progressive algorithm support, is optimized for footprint and runtime memory use, and more!](/products/wolfssl/)
[## wolfCrypt Crypto Engine

The wolfCrypt Crypto engine is a lightweight, embeddable, and easy-to-configure crypto library with a strong focus on portability, modularity, security, and feature set. FIPS 140-3 and MISRA available.](/products/wolfcrypt/)

[## Case Studies

Through use in games, databases, sensors, VoIP application, and more there is over 1 Billion copies of wolfSSL products in production environments today. Click to view all wolfSSL case studies.](/docs/case-studies/)

[## wolfCrypt FIPS Module

The Cryptographic Module Validation Program (CMVP) has issued FIPS 140-3 Certificate #4718 for the wolfCrypt Module developed by wolfSSL Inc, the world's first SP800-140Br1 validated certificate. Click to read more.](/license/fips/)

Product Information

[* wolfSSL TLS Library](/products/wolfssl/)
[* wolfCrypt Crypto Engine](/products/wolfcrypt/)
[* wolfCrypt FIPS](/license/fips/)
[* wolfTPM Portable TPM 2.0 Library](/products/wolftpm/)
[* wolfMQTT Client Library](/products/wolfmqtt/)
[* wolfSSH SSH Library](/products/wolfssh/)
[* wolfBoot Secure Bootloader](/products/wolfboot/)
[* cURL](/products/curl/)
[* wolfSSL JNI](/products/wolfssl-jni/)
[* wolfCrypt JNI and JCE Provider](/products/wolfcrypt-jni-jce/)
[* License Information](/license/)

Documentation

[* wolfSSL Manual](/documentation/manuals/wolfssl/)
[* wolfSSL API Reference](/docs/wolfssl-manual/ch17/)
[* Doxygen API Reference](/doxygen/index.html)
[* Building wolfSSL](/docs/wolfssl-manual/ch2/)
[* SSL Tutorial](/docs/wolfssl-manual/ch11/)
[* Case Studies](/docs/case-studies/)
[* Additional Documentation](/docs/)

Copyright © 2025 wolfSSL Inc.
All rights reserved.

[![X](/wordpress/wp-content/uploads/2023/08/x.png)](https://twitter.com/wolfssl)
[![Facebook](https://www.wolfssl.com/wordpress/wp-content/uploads/2018/06/facebook-icon.png)](https://www.facebook.com/wolfssl)
[![Github](/wordpress/wp-content/uploads/2018/06/github-icon.png)](https://www.github.com/wolfssl)
[![Linkedin](/wordpress/wp-content/uploads/2020/12/linkedin_50_50.png)](https://www.linkedin.com/company/wolfssl/)
[![Flickr](/wordpress/wp-content/uploads/2018/06/flickr-icon.png)](https://www.flickr.com/photos/54654493%40N05/)

![Made in the USA](/wordpress/wp-content/uploads/2020/12/madeInUsa_100px.png)

Help and Support

[* FAQ Page](https://www.wolfssl.com/frequently-asked-questions-faq/)
[* Support Forum](https://www.wolfssl.com/products/support-and-maintenance/)
[* Support Blog](/support-blog/)
[* Support and Maintenance](/products/support-and-maintenance/)
[* Consulting Services](/docs/consulting/)
[* Vulnerability Info](/docs/security-vulnerabilities/)
[* Contact Us](/contact/)
[* Partners](/community/partner-network/)

Reference

[* Algorithm/Protocol Reference](/docs/wolfssl-manual/appendix-b/)
[* Presentations](/docs/media/)
[* Upcoming Events](/events/)
[* Site Directory](/directory/)



=== Content from wolfssl.com_54125086_20250124_120204.html ===

[Skip to content](#content)

* Questions? [Contact Us](https://www.wolfssl.com/contact/)
* [Support Forums](https://www.wolfssl.com/products/support-and-maintenance/)
* [![wolfSSL Japan](/wordpress/wp-content/uploads/2017/11/japan-site.png)](https://www.wolfssl.jp)

[Home![](https://www.wolfssl.com/wordpress/wp-content/uploads/2020/12/wolfssl_logo_300px.png)](https://www.wolfssl.com/)
[Menu Menu](#menu)

* [Home](https://www.wolfssl.com/)
* [About](https://www.wolfssl.com/about/)
  + [Contact Us](https://www.wolfssl.com/contact/)
  + [wolfSSL Software Development Process and Quality Assurance](https://www.wolfssl.com/about/wolfssl-software-development-process-quality-assurance/)
* [Products](https://www.wolfssl.com/products/)
  + [Post Quantum](https://www.wolfssl.com/products/wolfcrypt-post-quantum/)
  + [wolfSSL / wolfCrypt](https://www.wolfssl.com/products/wolfssl/)
  + [wolfCrypt FIPS 140-2/3](https://www.wolfssl.com/license/fips/)
  + [wolfHSM](https://www.wolfssl.com/products/wolfhsm/)
  + [DO-178](https://www.wolfssl.com/wolfssl-support-178-dal/)
  + [wolfTPM](https://www.wolfssl.com/products/wolftpm/)
  + [wolfMQTT](https://www.wolfssl.com/products/wolfmqtt/)
  + [wolfSSH](https://www.wolfssl.com/products/wolfssh/)
  + [wolfBoot](https://www.wolfssl.com/products/wolfboot/)
  + [wolfSentry IDPS](https://www.wolfssl.com/products/wolfsentry/)
  + [curl / tinycurl](https://www.wolfssl.com/products/curl/)
  + [wolfSSL JNI and JSSE Provider](https://www.wolfssl.com/products/wolfssl-jni-jsse/)
  + [wolfCrypt JNI and JCE Provider](https://www.wolfssl.com/products/wolfcrypt-jni-jce/)
  + [wolfCLU](https://www.wolfssl.com/products/wolfclu/)
* [Download](/download)
* [License](https://www.wolfssl.com/license/)
  + [Support and Maintenance](https://www.wolfssl.com/products/support-and-maintenance/)
  + [Consulting Services](https://www.wolfssl.com/docs/consulting/)
  + [FIPS 140-2 and FIPS 140-3](https://www.wolfssl.com/license/fips/)
  + [DO-178](https://www.wolfssl.com/wolfssl-support-178-dal/)
* [Blog](https://www.wolfssl.com/blog/)
* [Docs](https://www.wolfssl.com/docs/)
  + [FAQ](https://www.wolfssl.com/docs/frequently-asked-questions-faq/)
  + [wolfSSL Manual](https://www.wolfssl.com/documentation/manuals/wolfssl/index.html)
  + [YouTube Videos](https://www.youtube.com/wolfssl)
  + [Benchmarks](https://www.wolfssl.com/docs/benchmarks/)
  + [Case Studies](https://www.wolfssl.com/docs/case-studies/)
  + [White Papers](https://www.wolfssl.com/docs/wolfssl-white-papers/)
  + [Vulnerability Info](https://www.wolfssl.com/docs/security-vulnerabilities/)
* [Community](https://www.wolfssl.com/community/)
  + [Events / Webinars](https://www.wolfssl.com/events/)
  + [Forums](https://www.wolfssl.com/forums/)
* [Partners](https://www.wolfssl.com/community/partner-network/)
* Search for:

  *Search*

# Two Vulnerabilities Recently Found, An Attack on RSA using CRT and DoS Vulnerability With DTLS

- [September 17, 2015](https://www.wolfssl.com/two-vulnerabilities-recently-found-an-attack-on-rsa-using-crt-and-dos-vulnerability-with-dtls/)

**Attack on RSA CRT:**
A recent paper written by Florian Weimer of the Red Hat Product Security group shows a fault attack on RSA. Many cryptographic libraries that perform RSA operations use an optimization called CRT (Chinese Remainder Theorem). The attack is based off of creating a fault during the CRT process, for example; by causing the system to overheat, using a race condition, or simply a faulty CPU. With the introduction of this attack the function wc\_RsaSSL\_VerifyInline is now used to verify no fault has happened, this verify function is now automatically used on all TLS connections that were previously affected.

Only a small subset of wolfSSL embedded SSL/TLS builds were affected by the attack on RSA CRT. Those using wolfSSL for TLS connections on the server side with private RSA keys, allowing the use of ephemeral key exchange and without using the low memory setting are affected. An example of this is a wolfSSL TLS server side that uses the suite ECDHE-RSA-AES256-SHA256 having ephemeral key exchange and loading in a private RSA to create the connection, the client side of this connection is not affected. We recommend updating to the most recent wolfSSL release 3.6.8 and renewing all RSA private keys if you meet the affected criteria. If using wolfSSL on the client side this attack is not an issue.

CVE-2015-7744 has been assigned to this vulnerability.

**DoS on DTLS:**

Recently a researcher (thanks to Sebastian Ramacher from the Institute for Applied Information Processing and Communications at Graz University of Technology) notified wolfSSL of the potential to amplify a DTLS denial of service attack. The original cookie generation callback used a hash of the current socket peer’s IP address and port number. Now the cookie is based on the client’s hello message per the RFC (client IP address, client port number, version, random, cipher suites, compression) and HMACed with an application provided secret.

Only those using DTLS on the server side of a publicly accessible machine are affected. We recommend affected servers to update to release 3.6.8 which now generates an unpredictable cookie using HMAC.

CVE-2015-6925 has been assigned to this vulnerability.

For any questions contact us at facts@wolfssl.comLink to paper written about the RSA-CRT attack <https://people.redhat.com/~fweimer/rsa-crt-leaks.pdf>

Posted in [Uncategorized](https://www.wolfssl.com/category/uncategorized/)

[# wolfSSL FAQ](https://www.wolfssl.com/frequently-asked-questions-faq/)

[# wolfSSL curl](https://www.wolfssl.com/products/curl/)

[![](/wordpress/wp-content/uploads/2018/08/TLS13-now-avail.png)](https://www.wolfssl.com/docs/tls13/)
[# Upcoming Events](https://www.wolfssl.com/events/)

[# wolfSSL Partners](https://www.wolfssl.com/community/partner-network/)

[## wolfSSL SSL/TLS Library

The wolfSSL lightweight TLS library supports TLS 1.3 and DTLS 1.3 on both client and server sides, features progressive algorithm support, is optimized for footprint and runtime memory use, and more!](/products/wolfssl/)
[## wolfCrypt Crypto Engine

The wolfCrypt Crypto engine is a lightweight, embeddable, and easy-to-configure crypto library with a strong focus on portability, modularity, security, and feature set. FIPS 140-3 and MISRA available.](/products/wolfcrypt/)

[## Case Studies

Through use in games, databases, sensors, VoIP application, and more there is over 1 Billion copies of wolfSSL products in production environments today. Click to view all wolfSSL case studies.](/docs/case-studies/)

[## wolfCrypt FIPS Module

The Cryptographic Module Validation Program (CMVP) has issued FIPS 140-3 Certificate #4718 for the wolfCrypt Module developed by wolfSSL Inc, the world's first SP800-140Br1 validated certificate. Click to read more.](/license/fips/)

Product Information

[* wolfSSL TLS Library](/products/wolfssl/)
[* wolfCrypt Crypto Engine](/products/wolfcrypt/)
[* wolfCrypt FIPS](/license/fips/)
[* wolfTPM Portable TPM 2.0 Library](/products/wolftpm/)
[* wolfMQTT Client Library](/products/wolfmqtt/)
[* wolfSSH SSH Library](/products/wolfssh/)
[* wolfBoot Secure Bootloader](/products/wolfboot/)
[* cURL](/products/curl/)
[* wolfSSL JNI](/products/wolfssl-jni/)
[* wolfCrypt JNI and JCE Provider](/products/wolfcrypt-jni-jce/)
[* License Information](/license/)

Documentation

[* wolfSSL Manual](/documentation/manuals/wolfssl/)
[* wolfSSL API Reference](/docs/wolfssl-manual/ch17/)
[* Doxygen API Reference](/doxygen/index.html)
[* Building wolfSSL](/docs/wolfssl-manual/ch2/)
[* SSL Tutorial](/docs/wolfssl-manual/ch11/)
[* Case Studies](/docs/case-studies/)
[* Additional Documentation](/docs/)

Copyright © 2025 wolfSSL Inc.
All rights reserved.

[![X](/wordpress/wp-content/uploads/2023/08/x.png)](https://twitter.com/wolfssl)
[![Facebook](https://www.wolfssl.com/wordpress/wp-content/uploads/2018/06/facebook-icon.png)](https://www.facebook.com/wolfssl)
[![Github](/wordpress/wp-content/uploads/2018/06/github-icon.png)](https://www.github.com/wolfssl)
[![Linkedin](/wordpress/wp-content/uploads/2020/12/linkedin_50_50.png)](https://www.linkedin.com/company/wolfssl/)
[![Flickr](/wordpress/wp-content/uploads/2018/06/flickr-icon.png)](https://www.flickr.com/photos/54654493%40N05/)

![Made in the USA](/wordpress/wp-content/uploads/2020/12/madeInUsa_100px.png)

Help and Support

[* FAQ Page](https://www.wolfssl.com/frequently-asked-questions-faq/)
[* Support Forum](https://www.wolfssl.com/products/support-and-maintenance/)
[* Support Blog](/support-blog/)
[* Support and Maintenance](/products/support-and-maintenance/)
[* Consulting Services](/docs/consulting/)
[* Vulnerability Info](/docs/security-vulnerabilities/)
[* Contact Us](/contact/)
[* Partners](/community/partner-network/)

Reference

[* Algorithm/Protocol Reference](/docs/wolfssl-manual/appendix-b/)
[* Presentations](/docs/media/)
[* Upcoming Events](/events/)
[* Site Directory](/directory/)



=== Content from github.com_8d28895d_20250124_120203.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FIAIK%2FwolfSSL-DoS)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FIAIK%2FwolfSSL-DoS)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E&source=header-repo&source_repo=IAIK%2FwolfSSL-DoS)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[IAIK](/IAIK)
/
**[wolfSSL-DoS](/IAIK/wolfSSL-DoS)**
Public

* [Notifications](/login?return_to=%2FIAIK%2FwolfSSL-DoS) You must be signed in to change notification settings
* [Fork
  7](/login?return_to=%2FIAIK%2FwolfSSL-DoS)
* [Star
   7](/login?return_to=%2FIAIK%2FwolfSSL-DoS)

Proof of concept for denial of service attack on wolfSSL's DTLS server implementation.

[7
stars](/IAIK/wolfSSL-DoS/stargazers) [7
forks](/IAIK/wolfSSL-DoS/forks) [Branches](/IAIK/wolfSSL-DoS/branches) [Tags](/IAIK/wolfSSL-DoS/tags) [Activity](/IAIK/wolfSSL-DoS/activity)
 [Star](/login?return_to=%2FIAIK%2FwolfSSL-DoS)

 [Notifications](/login?return_to=%2FIAIK%2FwolfSSL-DoS) You must be signed in to change notification settings

* [Code](/IAIK/wolfSSL-DoS)
* [Issues
  0](/IAIK/wolfSSL-DoS/issues)
* [Pull requests
  0](/IAIK/wolfSSL-DoS/pulls)
* [Actions](/IAIK/wolfSSL-DoS/actions)
* [Projects
  0](/IAIK/wolfSSL-DoS/projects)
* [Wiki](/IAIK/wolfSSL-DoS/wiki)
* [Security](/IAIK/wolfSSL-DoS/security)
* [Insights](/IAIK/wolfSSL-DoS/pulse)

Additional navigation options

* [Code](/IAIK/wolfSSL-DoS)
* [Issues](/IAIK/wolfSSL-DoS/issues)
* [Pull requests](/IAIK/wolfSSL-DoS/pulls)
* [Actions](/IAIK/wolfSSL-DoS/actions)
* [Projects](/IAIK/wolfSSL-DoS/projects)
* [Wiki](/IAIK/wolfSSL-DoS/wiki)
* [Security](/IAIK/wolfSSL-DoS/security)
* [Insights](/IAIK/wolfSSL-DoS/pulse)

# IAIK/wolfSSL-DoS

    master[Branches](/IAIK/wolfSSL-DoS/branches)[Tags](/IAIK/wolfSSL-DoS/tags)Go to fileCode
## Folders and files

| Name | | Name | Last commit message | Last commit date |
| --- | --- | --- | --- | --- |
| Latest commit History[14 Commits](/IAIK/wolfSSL-DoS/commits/master/) | | |
| [.gitignore](/IAIK/wolfSSL-DoS/blob/master/.gitignore ".gitignore") | | [.gitignore](/IAIK/wolfSSL-DoS/blob/master/.gitignore ".gitignore") |  |  |
| [Makefile](/IAIK/wolfSSL-DoS/blob/master/Makefile "Makefile") | | [Makefile](/IAIK/wolfSSL-DoS/blob/master/Makefile "Makefile") |  |  |
| [README.md](/IAIK/wolfSSL-DoS/blob/master/README.md "README.md") | | [README.md](/IAIK/wolfSSL-DoS/blob/master/README.md "README.md") |  |  |
| [attack.c](/IAIK/wolfSSL-DoS/blob/master/attack.c "attack.c") | | [attack.c](/IAIK/wolfSSL-DoS/blob/master/attack.c "attack.c") |  |  |
| [server-dtls.c](/IAIK/wolfSSL-DoS/blob/master/server-dtls.c "server-dtls.c") | | [server-dtls.c](/IAIK/wolfSSL-DoS/blob/master/server-dtls.c "server-dtls.c") |  |  |
| [target.c](/IAIK/wolfSSL-DoS/blob/master/target.c "target.c") | | [target.c](/IAIK/wolfSSL-DoS/blob/master/target.c "target.c") |  |  |
| View all files | | |

## Repository files navigation

* README
# CVE-2015-6925 [1, 2]: DoS attack on wolfSSL DTLS server and DoS amplification

DTLS 1.2 [5] includes an optional extra round trip based on a cookie in the
handshake phase to prevent the following two attack scenarios:

1. DoS of the DTLS server caused by forcing the server to allocate an extensive
   amount of resources or by performing expensive computations, and
2. amplifying a DoS attack via a forged source.

The implementation of the protection is roughly:

1. The ClientHello message is extended to include a cookie. If the client does
   not posses a cookie, it sends a zero length cookie.
2. The server checks while receiving a ClientHello whether the message contains
   a valid cookie. If the cookie is valid, the server proceeds with the normal
   handshake. If the cookie is invalid, it replies with a HelloVerifySent
   including a cookie for this client.
3. If a client receives a HelloVerifySent after a ClientHello message, it
   includes the received cookie in the ClientHello message and resends it.

Attack scenario 2. can easily be prevented by generating random cookies on the
server and storing them. But this does not help with attack scenario 1. as it
would require to store the computed cookies. So the cookie is implemented
stateless and the recommendation in the RFC is to use an HMAC and computing the
cookie like

```
  HMAC(client address || constant data from the ClientInfo message)

```

where the HMAC key is global state on the server and not per session state. This
allows the cookie to be regenerated only be looking at the ClientInfo message
and the sender.

The DTLS server implementation included in wolfSSL implements this cookie based
approach, but uses an hash function instead of a keyed function like an HMAC.
But then the cookie does not contain any secret data and valid cookies can be
computed by an adversary, making the DTLS server vulnerable to attack scenarios

1. and 2.

## Timeline

* 2015-09-11: wolfSSL has been informed about this issue and were provided with
  the proof of concept code to reproduce it.
* 2015-09-18: wolfSSL 3.6.8 including a fix for this issue has been released
  [4].
* 2015-09-23: Publication of the PoC.

## Proof of concept

This is a simple example demonstrating CVE-2015-6925. It sends
ClientHello messages with spoofed sender addresses but valid cookies to a
wolfSSL based DTLS server. All wolfSSL versions supporting DTLS before 3.6.8 are
affected by this vulnerability.

* attack.c: Sends the spoofed ClientHello messages.
* dtls-server.c: Very simple DTLS server (slightly modified version of [3])
* target.c: Listens and prints the number of bytes received.

Assume the following scenario:

* dtls-server runs on a machine with IP 192.168.0.1.
* target runs on a machine with IP 192.168.0.2.
* attack runs on any other machine.

Now run

```
  $ attack -i $interface --server 192.168.0.1 --target 192.168.0.2
```

where $interface is the network interface the packets should be sent on. If
there is a gateway involved or attack can not detect the MAC address of the
server, specify --server-hwaddr.

attack needs superuser privileges to run.

target should print

```
  Received 48 bytes. (for the HelloVerifyRequest message)

```

and about seven times (based on the default timeouts)

```
  Received 95 bytes. (for the ServerHello message)
  Received 3281 bytes. (for the Certificate message)
  Received 482 bytes. (for the ServerKeyExchange message)
  Received 25 bytes. (for the ServerHelloDone message)

```

The numbers depend on the choice of algorithms and may vary with the choice of
algorithms and packet fragmentation of the handshake packets.

## Reference

[1] <https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2015-6925>
[2] [https://www.wolfssl.com/wolfSSL/Blog/Entries/2015/9/17\_Two\_Vulnerabilities\_Recently\_Found,\_An\_Attack\_on\_RSA\_using\_CRT\_and\_DoS\_Vulnerability\_With\_DTLS.html](https://www.wolfssl.com/wolfSSL/Blog/Entries/2015/9/17_Two_Vulnerabilities_Recently_Found%2C_An_Attack_on_RSA_using_CRT_and_DoS_Vulnerability_With_DTLS.html)
[3] <https://github.com/wolfSSL/wolfssl-examples/blob/master/dtls/server-dtls.c>
[4] <http://wolfssl.com/wolfSSL/Blog/Entries/2015/9/18_wolfSSL_3.6.8_is_Now_Available.html>
[5] <https://tools.ietf.org/html/rfc6347>

## About

Proof of concept for denial of service attack on wolfSSL's DTLS server implementation.

### Resources

[Readme](#readme-ov-file)

[Activity](/IAIK/wolfSSL-DoS/activity)
[Custom properties](/IAIK/wolfSSL-DoS/custom-properties)
### Stars

[**7**
stars](/IAIK/wolfSSL-DoS/stargazers)
### Watchers

[**10**
watching](/IAIK/wolfSSL-DoS/watchers)
### Forks

[**7**
forks](/IAIK/wolfSSL-DoS/forks)
[Report repository](/contact/report-content?content_url=https%3A%2F%2Fgithub.com%2FIAIK%2FwolfSSL-DoS&report=IAIK+%28user%29)

## [Releases](/IAIK/wolfSSL-DoS/releases)

No releases published

## [Packages 0](/orgs/IAIK/packages?repo_name=wolfSSL-DoS)

No packages published

## Languages

* [C
  98.4%](/IAIK/wolfSSL-DoS/search?l=c)
* [Makefile
  1.6%](/IAIK/wolfSSL-DoS/search?l=makefile)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


