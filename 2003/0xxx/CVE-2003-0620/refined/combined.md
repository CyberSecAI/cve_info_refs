=== Content from marc.info_23fa98df_20250124_115409.html ===

```
[[prev in list](?l=bugtraq&m=105966793930331&w=2)] [[next in list](?l=bugtraq&m=105966689728805&w=2)] [[prev in thread](?l=bugtraq&m=105951284512898&w=2)] [next in thread]
List:       [bugtraq](?l=bugtraq&r=1&w=2)
Subject:    [Re: man-db[] multiple(4) vulnerabilities.](?t=105951302200001&r=1&w=2)
From:       [Colin Watson <cjwatson () debian ! org>](?a=98628708200001&r=1&w=2)
Date:       [2003-07-30 21:36:23](?l=bugtraq&r=1&w=2&b=200307)
[Download RAW [message](?l=bugtraq&m=105960276803617&q=mbox) or [body](?l=bugtraq&m=105960276803617&q=raw)]

In article <20030729210308.15518.qmail@www.securityfocus.com>
on chiark.mail.bugtraq, Vade 79 wrote:

[...]

Thank you for reporting these vulnerabilities in man-db. However, I'm
disappointed that you neither informed me a little beforehand so that I
wasn't taken by surprise by your BugTraq post (preferable), nor sent a
copy of your report to me as the maintainer of man-db (which I would
regard as the minimum of common courtesy). Fortunately, a friend brought
your post to my attention this morning so that I could begin preparing
patches, a little later than I would otherwise have been able to do.

Please inform the maintainer in future. The BugTraq guidelines suggest a
one-week notice period, although in fact I'd personally have been happy
with a few days.

>[part 1: add_to_dirlist() buffer overflow]
>
>man-db contains a buffer overflow vulnerability do to the lack of bounds
>checking in multiple sscanf() calls.  which formats the user supplied file
>~/.manpath.
[...]
>as you can see; MANDATORY_MANPATH, MANPATH_MAP, and MANDB_MAP do not
>properly limit the value written to key[[50]](#50), and/or cont[512]).  however,
>as far as exploitation by overflowing those buffers goes is limited.  this
>is do to the way the buffers are allocated in memory, so when
>overwritten, will just overwrite into another character buffer.
>
>but, this is not all in vain.  do to the size of buf[BUFSIZE], which is
>8192 bytes(standard), and what key/cont overwrites into.  you can pass
>enormously long values(~8192) to other functions.  as most checks are done
>before-hand, and almost all buffers in the program are allocated to 4095
>bytes; you can make the overflow occur, in many locations, elsewhere in
>the program.

I've fixed the sscanf() invocations so that these arrays aren't
overflowed. Other PATH_MAX-sized buffers will take a little more work,
but I'll look at them.

>[part 2: ult_src() buffer overflow]
>
>man-db contains a buffer overflow vulnerability do to the size of a buffer
>being half the size it should be(doesn't follow the 4096 trend), for a
>"path".

Fixed by allocating this buffer dynamically instead.

>[part 3: ".so" link buffer overflow]
>
>man-db contains a buffer overflow vulnerability do to the lack of bounds
>checking for ".so" link/redirection manpages.  this occurs when the
>function attempts to change memory, without re-calculating the
>size.

Fixed in the process of fixing part 2 above, by causing the function in
question to return a newly allocated string rather than doing that
grotty hack of writing into a string allocated elsewhere without
reallocation.

>[part 4: PATH/MANPATH argument overflow]
>
>man-db contains a buffer overflow vulnerability do to the lack of bounds
>checking for the amount PATH/MANPATH values given.  the bug is found in
>multiple routines.
>
>proof/to test for vulnerability existence:
># man -M `perl -e 'print"/tmp:"x260'` x
>Segmentation fault

On my machine it seems to require 432 elements or more, but anyway. I've
applied a stopgap measure for now, namely to check whether the number of
elements in MANPATH is going to overflow the list holding them. I'll add
proper dynamically resized arrays later when I have a little more time.

These fixes are in savannah.nongnu.org CVS for now; I'll prepare a
release for Debian unstable tonight and if possible Debian stable as
well. A full 2.4.2 release will have to wait a little longer, but should
be within the week.

Cheers,

--
Colin Watson                                       [cjwatson@debian.org]
[[prev in list](?l=bugtraq&m=105966793930331&w=2)] [[next in list](?l=bugtraq&m=105966689728805&w=2)] [[prev in thread](?l=bugtraq&m=105951284512898&w=2)] [next in thread]

```

[Configure](?q=configure) |
[About](?q=about) |
[News](?q=news) |
Add a list |
Sponsored by [KoreLogic](http://www.korelogic.com/)



=== Content from marc.info_1f727ea5_20250124_115408.html ===

```
[[prev in list](?l=bugtraq&m=105958746216745&w=2)] [[next in list](?l=bugtraq&m=105958318410327&w=2)] [prev in thread] [[next in thread](?l=bugtraq&m=105960276803617&w=2)]
List:       [bugtraq](?l=bugtraq&r=1&w=2)
Subject:    [man-db[] multiple(4) vulnerabilities.](?t=105951302200001&r=1&w=2)
From:       [Vade 79 <v9 () fakehalo ! deadpig ! org>](?a=100741324900003&r=1&w=2)
Date:       [2003-07-29 21:03:08](?l=bugtraq&r=1&w=2&b=200307)
[Download RAW [message](?l=bugtraq&m=105951284512898&q=mbox) or [body](?l=bugtraq&m=105951284512898&q=raw)]

[part 1: add_to_dirlist() buffer overflow]

man-db contains a buffer overflow vulnerability do to the lack of bounds
checking in multiple sscanf() calls.  which formats the user supplied file
~/.manpath.  here is the function(src/manp.c):

static void add_to_dirlist (FILE *config, int user)
{
	char *bp;
	char buf[BUFSIZ];
	char key[[50]](#50), cont[512];
	int c;

	while ((bp = fgets (buf, BUFSIZ, config))) {

		while (isspace (*bp))
			bp++;

		if (*bp == '#' || *bp == '\0')
			continue;
		else if (strncmp (bp, "NO", 2) == 0)
			continue;
		else if (sscanf (bp, "MANBIN %*s") == 1)
			continue;
		else if (sscanf (bp, "MANDATORY_MANPATH %s", key) == 1)
			add_mandatory (key);
		else if (sscanf (bp, "MANPATH_MAP %s %s", key, cont) == 2)
			add_manpath_map (key, cont);
	else if ((c = sscanf (bp, "MANDB_MAP %s %s", key, cont)) > 0)
			add_mandb_map (key, cont, c, user);
		else if ((c = sscanf (bp, "DEFINE %50s %511[^\n]",
				      key, cont)) > 0)
			add_def (key, cont, c);
		else if (sscanf (bp, "SECTION %511[^\n]", cont) == 1)
			add_sections (cont);
		else if (sscanf (bp, "SECTIONS %511[^\n]", cont) == 1)
			/* Since I keep getting it wrong ... */
			add_sections (cont);
	 	else {
		error (0, 0, _("can't parse directory list `%s'"), bp);
			gripe_reading_mp_config (CONFIG_FILE);
		}
	}
}

as you can see; MANDATORY_MANPATH, MANPATH_MAP, and MANDB_MAP do not
properly limit the value written to key[[50]](#50), and/or cont[512]).  however,
as far as exploitation by overflowing those buffers goes is limited.  this
is do to the way the buffers are allocated in memory, so when
overwritten, will just overwrite into another character buffer.

but, this is not all in vain.  do to the size of buf[BUFSIZE], which is
8192 bytes(standard), and what key/cont overwrites into.  you can pass
enormously long values(~8192) to other functions.  as most checks are done
before-hand, and almost all buffers in the program are allocated to 4095
bytes; you can make the overflow occur, in many locations, elsewhere in
the program.

proof/to test for vulnerability existence:
(mandb will not make "x" when setuid, make it for it/bypass)
# cd /tmp
# mkdir x
# echo MANDB_MAP `perl -e 'print"x"x8100'` x >~/.manpath
# mandb
Segmentation fault

(can also apply this to the "man" binary, by fooling it with links)
# cd /tmp
# mkdir x
# ln /usr/bin/man mandb
# echo MANDB_MAP `perl -e 'print"x"x8100'` x >~/.manpath
# ./mandb
Segmentation fault

versions found to have the vulnerability(current):
2.4.1, 2.4.0, 2.3.20, 2.3.19, 2.3.18, ...?(far as i went back)

[part 2: ult_src() buffer overflow]

man-db contains a buffer overflow vulnerability do to the size of a buffer
being half the size it should be(doesn't follow the 4096 trend), for a
"path".  another quote from the source(src/ult_src.c):

char *ult_src (char *name, const char *path, struct stat *buf, int flags)
{
        static char basename[2048];     /* must be static */
        static short recurse;           /* must be static */
        static char *relative;          /* must be static */

        /* initialise the function */

        /* as ult_softlink() & ult_hardlink() do all of their respective
         * resolving in one call, only need to sort them out once
         */

        if (recurse == 0) {
                struct stat new_buf;
                (void) strcpy (basename, name);

...(other possibilities continue)
}

proof/to test for vulnerability existence:
# man -M `perl -e 'print"/"x2100'`usr/share/man ls
...(verbose)
Segmentation fault

versions found to have the vulnerability(current):
2.4.1, 2.4.0, 2.3.20, 2.3.19, 2.3.18, ...?(far as i went back)

[part 3: ".so" link buffer overflow]

man-db contains a buffer overflow vulnerability do to the lack of bounds
checking for ".so" link/redirection manpages.  this occurs when the
function attempts to change memory, without re-calculating the
size.  another source reference(src/ult_src.c):

static __inline__ int test_for_include (char *buffer, char *rel)
{
        /* strip out any leading whitespace (if any) */
        while (isspace ((int) *buffer))
                buffer++;

        /* see if the `command' is a .so */
        if (strncmp (buffer, ".so", 3) == 0) {
                buffer += 3;

                /* strip out any whitespace between the command and
                   it's argumant */
                while (isspace ((int) *buffer))
                        buffer++;

                if (*buffer != '/') {
                        /* copy filename into rel address */
                        while (*buffer && !isspace ((int) *buffer))
                                *(rel++) = *(buffer++);

                        *rel = '\0';
                        return 1;
                }
        }
        return 0;
}

proof/to test for vulnerability existence:
# cd /tmp
# mkdir man man/man1
# echo .so `perl -e 'print"x"x1024'` >man/man1/x.1
# man -M /tmp/man x
...(verbose)
Segmentation fault

versions found to have the vulnerability(current):
2.4.1, 2.4.0, ...?(far as i went back)

[part 4: PATH/MANPATH argument overflow]

man-db contains a buffer overflow vulnerability do to the lack of bounds
checking for the amount PATH/MANPATH values given.  the bug is found in
multiple routines.

proof/to test for vulnerability existence:
# man -M `perl -e 'print"/tmp:"x260'` x
Segmentation fault

versions found to have the vulnerability(current):
2.4.1, 2.4.0, 2.3.20, 2.3.19, 2.3.18, ...?(far as i went back)

Vade79 -> v9@fakehalo.deadpig.org -> fakehalo.
[[prev in list](?l=bugtraq&m=105958746216745&w=2)] [[next in list](?l=bugtraq&m=105958318410327&w=2)] [prev in thread] [[next in thread](?l=bugtraq&m=105960276803617&w=2)]

```

[Configure](?q=configure) |
[About](?q=about) |
[News](?q=news) |
Add a list |
Sponsored by [KoreLogic](http://www.korelogic.com/)



=== Content from www.debian.org_ed0e2510_20250124_115409.html ===

[![Debian](./Pics/openlogo-50.png)](./ "Debian Home")

[Skip Quicknav](#content)

* [Blog](https://bits.debian.org/ "Bits from Debian")
* [Micronews](https://micronews.debian.org "Micronews from Debian")
* [Planet](https://planet.debian.org/ "The Planet of Debian")

# Debian

# The Community

## Debian is a Community of People!

### DC24 Group Photo

![DebConf23 Group Photo](Pics/debconf24_group_photo.jpg)

### MiniDebConf Berlin 2024

![Group photo of the MiniDebConf Berlin 2024](Pics/mini-dc24-berlin.jpg)

### MiniDebConf BrasÃ­lia 2023

![Group photo of the MiniDebConf BrasÃ­lia 2023](Pics/mini-dc23-brasilia.jpg)

### Screenshot Calamares Installer

![Screenshot from the Calamares installer](Pics/calamares-bookworm.png)

### Debian is like a Swiss Army Knife

![Debian is like a Swiss Army Knife](Pics/debian-swiss-knife-hands-1024x576.jpg)

### People have fun with Debian

![Debian people at Debconf18 in Hsinchu really having fun](Pics/debian-funny-people-1024x576.jpg)

[![](Pics/users.svg)](intro/people)

## [People](intro/people)

Who we are and what we do

[![](Pics/heartbeat.svg)](intro/philosophy)

## [Our Philosophy](intro/philosophy)

Why we do it, and how we do it

[![](Pics/user-plus.svg)](devel/join/)

## [Get Involved, Contribute](devel/join/)

How you can join us!

[![](Pics/list.svg)](intro/index#community)

## [More...](intro/index#community)

Additional information about the Debian community

# The Operating System

## Debian is a complete Free Operating System!

![Debian](Pics/debian-logo-1024x576.png)
[Download](https://cdimage.debian.org/debian-cd/current/amd64/iso-cd/debian-12.9.0-amd64-netinst.iso)
[Other downloads](distrib)

[![](Pics/trophy.svg)](intro/why_debian)

## [Why Debian](intro/why_debian)

What makes Debian special

[![](Pics/life-ring.svg)](support)

## [User Support](support)

Getting help and documentation

[![](Pics/security.svg)](security/)

## [Security Updates](security/)

Debian Security Advisories (DSA)

[![](Pics/list.svg)](intro/index#software)

## [More...](intro/index#software)

Further links to downloads and software

---

# Project News

## News and Announcements about Debian

17January2025[The Debian Project mourns the loss of Steve Langasek (vorlon)](News/2025/20250117)
11January2025[Updated Debian 12: 12.9 released](News/2025/20250111)
19November2024[The Debian Project mourns the loss of JÃ©rÃ©my Bobbio (Lunar)](News/2024/20241119)
31August2024[Updated Debian 11: 11.11 released](News/2024/2024083102)
14August2024[Security support for Bullseye handed over to the LTS team](News/2024/20240814)

[All the news](News)
[RSS](News/news)

---

This page is also available in the following languages:
Select your language
català
dansk
Deutsch
español
français
Galego
Indonesia
Italiano
magyar
Nederlands
norsk (bokmål)
polski
Português
suomi
svenska
Tiếng Việt
Български (Bəlgarski)
Русский (Russkij)
українська (ukrajins'ka)
عربية (Arabiya)
中文(简)
中文(HK)
中文(繁)
한국어 (Korean)
Ελληνικά (Ellinika)
فارسی (Farsi)

How to set [the default document language](./intro/cn)

---

See our [contact page](./contact) to get in touch. Web site source code is [available](https://salsa.debian.org/webmaster-team/webwml).

Last Modified: Sat, Sep 16 13:09:56 UTC 2023

Last Built: Sun, Jan 19 23:26:10 UTC 2025

Copyright © 1997-2025 [SPI](https://www.spi-inc.org/) and others; See [license terms](./license)

Debian is a registered [trademark](./trademark) of Software in the Public Interest, Inc.


