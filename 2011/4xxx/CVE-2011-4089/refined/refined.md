```
## Summary of CVE-2011-4089

The vulnerability, located in the `bzexe` utility of the `bzip2` package, is a **race condition** related to insecure temporary file handling during the decompression of executables.

**Root cause of vulnerability:**
The `bzexe` script uses a temporary file in `/tmp` and creates a hard link to it. If an attacker creates a directory at the same location as the temporary file, the `ln` command will create a new file inside that directory. By using a race condition, the attacker can replace the directory with an executable, which will be executed by the calling user.

**Weaknesses/vulnerabilities present:**
- Insecure temporary file creation in `/tmp` without proper checks for existing directories.
- The `ln` command used in the script doesn't prevent directory traversal attacks.
- A race condition can be exploited where an attacker can manipulate the file system between the temporary file creation and execution.

**Impact of exploitation:**
A local attacker can achieve arbitrary code execution with the privileges of the user who executes a `bzexe` compressed executable. If a root user executes a compressed file, this can result in root privilege escalation.

**Attack vectors:**
- Local access to the target system is required.
- The attacker needs to be able to write to `/tmp` and create directories there.
- The attacker needs to know that a bzexe compressed executable is being run by the targeted user.
- A race condition needs to be successfully exploited.

**Required attacker capabilities/position:**
- Local user access
- Ability to create directories and files in `/tmp`
- Ability to monitor or predict the execution of bzexe compressed executables by other users.

**Additional details:**
- The vulnerability exists because `bzexe` uses the `ln` command to create a hard link to a temporary file, and the `ln` command will create a directory if a directory already exists at the target path.
- The fix involves using the `-T` option in the `ln` command, which prevents it from creating a file in the subdirectory, and instead overwrites the existing directory.
- The attack relies on a race condition between `ln` command execution and the target execution.
- The vulnerability is considered to have a low impact because `bzexe` is not commonly used.
- The vulnerability was reported by vladz and was addressed in bzip2 versions 1.0.6-1 and 1.0.5-6+squeeze1.
- Proof-of-concept code was created to demonstrate the vulnerability.
```