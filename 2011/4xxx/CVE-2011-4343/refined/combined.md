=== Content from issues.apache.org_1d1618a2_20250125_080407.html ===
Index: api/src/main/java/javax/faces/application/\_NavigationUtils.java
===================================================================
--- api/src/main/java/javax/faces/application/\_NavigationUtils.java (revision 0)
+++ api/src/main/java/javax/faces/application/\_NavigationUtils.java (revision 0)
@@ -0,0 +1,107 @@
+/\*
+ \* Licensed to the Apache Software Foundation (ASF) under one
+ \* or more contributor license agreements. See the NOTICE file
+ \* distributed with this work for additional information
+ \* regarding copyright ownership. The ASF licenses this file
+ \* to you under the Apache License, Version 2.0 (the
+ \* "License"); you may not use this file except in compliance
+ \* with the License. You may obtain a copy of the License at
+ \*
+ \* http://www.apache.org/licenses/LICENSE-2.0
+ \*
+ \* Unless required by applicable law or agreed to in writing,
+ \* software distributed under the License is distributed on an
+ \* "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
+ \* KIND, either express or implied. See the License for the
+ \* specific language governing permissions and limitations
+ \* under the License.
+ \*/
+package javax.faces.application;
+
+import java.util.ArrayList;
+import java.util.HashMap;
+import java.util.List;
+import java.util.Map;
+
+import javax.faces.context.FacesContext;
+
+/\*\*
+ \*
+ \* @author Leonardo Uribe
+ \*
+ \*/
+class \_NavigationUtils
+{
+ /\*\*
+ \* Evaluate all EL expressions found as parameters and return a map that can be used for
+ \* redirect or render bookmark links
+ \*
+ \* @param parameters parameter map retrieved from NavigationCase.getParameters()
+ \* @return
+ \*/
+ public static Map > getEvaluatedNavigationParameters(Map > parameters)
+ {
+ Map> evaluatedParameters = null;
+ if (parameters != null && parameters.size() > 0)
+ {
+ evaluatedParameters = new HashMap>();
+ for (Map.Entry> pair : parameters.entrySet())
+ {
+ boolean containsEL = false;
+ for (String value : pair.getValue())
+ {
+ if (\_isExpression(value))
+ {
+ containsEL = true;
+ break;
+ }
+ }
+ if (containsEL)
+ {
+ evaluatedParameters.put(pair.getKey(), \_evaluateValueExpressions(pair.getValue()));
+ }
+ else
+ {
+ evaluatedParameters.put(pair.getKey(), pair.getValue());
+ }
+ }
+ }
+ else
+ {
+ evaluatedParameters = parameters;
+ }
+ return evaluatedParameters;
+ }
+
+ /\*\*
+ \* Checks the Strings in the List for EL expressions and evaluates them.
+ \* Note that the returned List will be a copy of the given List, because
+ \* otherwise it will have unwanted side-effects.
+ \* @param values
+ \* @return
+ \*/
+ private static List \_evaluateValueExpressions(List values)
+ {
+ // note that we have to create a new List here, because if we
+ // change any value on the given List, it will be changed in the
+ // NavigationCase too and the EL expression won't be evaluated again
+ List target = new ArrayList(values.size());
+ FacesContext context = FacesContext.getCurrentInstance();
+ for (String value : values)
+ {
+ if (\_isExpression(value))
+ {
+ // evaluate the ValueExpression
+ value = context.getApplication().evaluateExpressionGet(context, value, String.class);
+ }
+ target.add(value);
+ }
+ return target;
+ }
+
+ private static boolean \_isExpression(String text)
+ {
+ return text.indexOf("#{") != -1;
+ }
+
+}
Property changes on: api\src\main\java\javax\faces\application\\_NavigationUtils.java
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
Added: svn:eol-style
+ native
Index: api/src/main/java/javax/faces/application/NavigationCase.java
===================================================================
--- api/src/main/java/javax/faces/application/NavigationCase.java (revision 1205183)
+++ api/src/main/java/javax/faces/application/NavigationCase.java (working copy)
@@ -137,7 +137,8 @@
return new URL(externalContext.getRequestScheme(),
externalContext.getRequestServerName(),
externalContext.getRequestServerPort(),
- context.getApplication().getViewHandler().getBookmarkableURL(context, getToViewId(context), getParameters(), isIncludeViewParams()));
+ context.getApplication().getViewHandler().getBookmarkableURL(context, getToViewId(context),
+ \_NavigationUtils.getEvaluatedNavigationParameters(getParameters()), isIncludeViewParams()));
}
public URL getResourceURL(FacesContext context) throws MalformedURLException
@@ -153,7 +154,8 @@
return new URL(externalContext.getRequestScheme(),
externalContext.getRequestServerName(),
externalContext.getRequestServerPort(),
- context.getApplication().getViewHandler().getRedirectURL(context, getToViewId(context), getParameters(), isIncludeViewParams()));
+ context.getApplication().getViewHandler().getRedirectURL(context, getToViewId(context),
+ \_NavigationUtils.getEvaluatedNavigationParameters(getParameters()), isIncludeViewParams()));
}
public Map> getParameters()
Index: impl/src/main/java/org/apache/myfaces/application/NavigationHandlerImpl.java
===================================================================
--- impl/src/main/java/org/apache/myfaces/application/NavigationHandlerImpl.java (revision 1205183)
+++ impl/src/main/java/org/apache/myfaces/application/NavigationHandlerImpl.java (working copy)
@@ -50,6 +50,7 @@
import org.apache.myfaces.config.RuntimeConfig;
import org.apache.myfaces.config.element.NavigationRule;
+import org.apache.myfaces.shared.application.NavigationUtils;
import org.apache.myfaces.shared.util.HashMapUtils;
import org.apache.myfaces.shared.util.StringUtils;
import org.apache.myfaces.view.facelets.tag.jsf.PreDisposeViewEvent;
@@ -101,8 +102,13 @@
ExternalContext externalContext = facesContext.getExternalContext();
ViewHandler viewHandler = facesContext.getApplication().getViewHandler();
String toViewId = navigationCase.getToViewId(facesContext);
- String redirectPath = viewHandler.getRedirectURL(facesContext, toViewId, navigationCase.getParameters(), navigationCase.isIncludeViewParams());
+
+ String redirectPath = viewHandler.getRedirectURL(
+ facesContext, toViewId,
+ NavigationUtils.getEvaluatedNavigationParameters(navigationCase.getParameters()) ,
+ navigationCase.isIncludeViewParams());
+
//Clear ViewMap if we are redirecting to other resource
UIViewRoot viewRoot = facesContext.getViewRoot();
if (viewRoot != null && !viewRoot.getViewId().equals(toViewId))
Index: impl/src/main/java/org/apache/myfaces/context/servlet/ServletExternalContextImpl.java
===================================================================
--- impl/src/main/java/org/apache/myfaces/context/servlet/ServletExternalContextImpl.java (revision 1205183)
+++ impl/src/main/java/org/apache/myfaces/context/servlet/ServletExternalContextImpl.java (working copy)
@@ -765,7 +765,7 @@
{
if (pair.getKey() != null && pair.getKey().trim().length() != 0)
{
- paramMap.put(pair.getKey(), \_evaluateValueExpressions(pair.getValue()));
+ paramMap.put(pair.getKey(), pair.getValue());
}
}
}
@@ -816,37 +816,6 @@
}
/\*\*
- \* Checks the Strings in the List for EL expressions and evaluates them.
- \* Note that the returned List will be a copy of the given List, because
- \* otherwise it will have unwanted side-effects.
- \* @param values
- \* @return
- \*/
- private List \_evaluateValueExpressions(List values)
- {
- // note that we have to create a new List here, because if we
- // change any value on the given List, it will be changed in the
- // NavigationCase too and the EL expression won't be evaluated again
- List target = new ArrayList(values.size());
- FacesContext context = FacesContext.getCurrentInstance();
- for (String value : values)
- {
- if (\_isExpression(value))
- {
- // evaluate the ValueExpression
- value = context.getApplication().evaluateExpressionGet(context, value, String.class);
- }
- target.add(value);
- }
- return target;
- }
-
- private boolean \_isExpression(String text)
- {
- return text.indexOf("#{") != -1;
- }
-
- /\*\*
\* @since 2.0
\*/
public Flash getFlash()
Index: impl/src/test/java/org/apache/myfaces/context/servlet/ServletExternalContextImplTest.java
===================================================================
--- impl/src/test/java/org/apache/myfaces/context/servlet/ServletExternalContextImplTest.java (revision 1205183)
+++ impl/src/test/java/org/apache/myfaces/context/servlet/ServletExternalContextImplTest.java (working copy)
@@ -65,6 +65,7 @@
\* Tests if encodeRedirectURL() and encodeBookmarkableURL() correctly
\* evaluate ValueExpressions as parameters values.
\*/
+ /\* TODO: Invalid test, because EL evaluation should be done before call these methods.
@Test
@SuppressWarnings("unchecked")
public void testEncodeURLHandlesValueExpressionParameters()
@@ -94,7 +95,7 @@
Assert.assertTrue(bookmarkableUrl.contains("param1=literalvalue"));
Assert.assertTrue(bookmarkableUrl.contains("param1=myvalue1"));
Assert.assertTrue(bookmarkableUrl.contains("param2=myvalue2"));
- }
+ }\*/
@Test
public void testEncodeRedirectUrlWithEmptyParamInBaseUrl()
Index: shared/src/main/java/org/apache/myfaces/shared/application/NavigationUtils.java
===================================================================
--- shared/src/main/java/org/apache/myfaces/shared/application/NavigationUtils.java (revision 0)
+++ shared/src/main/java/org/apache/myfaces/shared/application/NavigationUtils.java (revision 0)
@@ -0,0 +1,107 @@
+/\*
+ \* Licensed to the Apache Software Foundation (ASF) under one
+ \* or more contributor license agreements. See the NOTICE file
+ \* distributed with this work for additional information
+ \* regarding copyright ownership. The ASF licenses this file
+ \* to you under the Apache License, Version 2.0 (the
+ \* "License"); you may not use this file except in compliance
+ \* with the License. You may obtain a copy of the License at
+ \*
+ \* http://www.apache.org/licenses/LICENSE-2.0
+ \*
+ \* Unless required by applicable law or agreed to in writing,
+ \* software distributed under the License is distributed on an
+ \* "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
+ \* KIND, either express or implied. See the License for the
+ \* specific language governing permissions and limitations
+ \* under the License.
+ \*/
+package org.apache.myfaces.shared.application;
+
+import java.util.ArrayList;
+import java.util.HashMap;
+import java.util.List;
+import java.util.Map;
+
+import javax.faces.context.FacesContext;
+
+/\*\*
+ \*
+ \* @author Leonardo Uribe
+ \*
+ \*/
+public class NavigationUtils
+{
+ /\*\*
+ \* Evaluate all EL expressions found as parameters and return a map that can be used for
+ \* redirect or render bookmark links
+ \*
+ \* @param parameters parameter map retrieved from NavigationCase.getParameters()
+ \* @return
+ \*/
+ public static Map > getEvaluatedNavigationParameters(Map > parameters)
+ {
+ Map> evaluatedParameters = null;
+ if (parameters != null && parameters.size() > 0)
+ {
+ evaluatedParameters = new HashMap>();
+ for (Map.Entry> pair : parameters.entrySet())
+ {
+ boolean containsEL = false;
+ for (String value : pair.getValue())
+ {
+ if (\_isExpression(value))
+ {
+ containsEL = true;
+ break;
+ }
+ }
+ if (containsEL)
+ {
+ evaluatedParameters.put(pair.getKey(), \_evaluateValueExpressions(pair.getValue()));
+ }
+ else
+ {
+ evaluatedParameters.put(pair.getKey(), pair.getValue());
+ }
+ }
+ }
+ else
+ {
+ evaluatedParameters = parameters;
+ }
+ return evaluatedParameters;
+ }
+
+ /\*\*
+ \* Checks the Strings in the List for EL expressions and evaluates them.
+ \* Note that the returned List will be a copy of the given List, because
+ \* otherwise it will have unwanted side-effects.
+ \* @param values
+ \* @return
+ \*/
+ private static List \_evaluateValueExpressions(List values)
+ {
+ // note that we have to create a new List here, because if we
+ // change any value on the given List, it will be changed in the
+ // NavigationCase too and the EL expression won't be evaluated again
+ List target = new ArrayList(values.size());
+ FacesContext context = FacesContext.getCurrentInstance();
+ for (String value : values)
+ {
+ if (\_isExpression(value))
+ {
+ // evaluate the ValueExpression
+ value = context.getApplication().evaluateExpressionGet(context, value, String.class);
+ }
+ target.add(value);
+ }
+ return target;
+ }
+
+ private static boolean \_isExpression(String text)
+ {
+ return text.indexOf("#{") != -1;
+ }
+
+}
Property changes on: shared\src\main\java\org\apache\myfaces\shared\application\NavigationUtils.java
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
Added: svn:eol-style
+ native
Index: shared/src/main/java/org/apache/myfaces/shared/renderkit/html/HtmlRendererUtils.java
===================================================================
--- shared/src/main/java/org/apache/myfaces/shared/renderkit/html/HtmlRendererUtils.java (revision 1205183)
+++ shared/src/main/java/org/apache/myfaces/shared/renderkit/html/HtmlRendererUtils.java (working copy)
@@ -63,6 +63,7 @@
import javax.faces.model.SelectItem;
import javax.faces.model.SelectItemGroup;
+import org.apache.myfaces.shared.application.NavigationUtils;
import org.apache.myfaces.shared.component.DisplayValueOnlyCapable;
import org.apache.myfaces.shared.component.EscapeCapable;
import org.apache.myfaces.shared.config.MyfacesConfig;
@@ -1589,8 +1590,8 @@
}
}
// handle NavigationCase parameters
- Map> navigationCaseParams = navigationCase
- .getParameters();
+ Map> navigationCaseParams =
+ NavigationUtils.getEvaluatedNavigationParameters(navigationCase.getParameters());
if (navigationCaseParams != null)
{
if (parameters == null)


=== Content from marc.info_22d4d568_20250125_080407.html ===

```
[[prev in list](?l=full-disclosure&m=132313262714499&w=2)] [[next in list](?l=full-disclosure&m=132309785200897&w=2)] [prev in thread] [next in thread]
List:       [full-disclosure](?l=full-disclosure&r=1&w=2)
Subject:    [Full-disclosure] [CVE-2011-4343] Apache MyFaces information
From:       [Leonardo Uribe <lu4242 () apache ! org>](?a=120147957800001&r=1&w=2)
Date:       [2011-12-05 14:33:18](?l=full-disclosure&r=1&w=2&b=201112)
Message-ID: [4EDCD62E.5070307 () apache ! org](?i=4EDCD62E.5070307%20()%20apache%20!%20org)
[Download RAW [message](?l=full-disclosure&m=132313252814362&q=mbox) or [body](?l=full-disclosure&m=132313252814362&q=raw)]

[[Attachment #2 (multipart/alternative)]](?l=full-disclosure&m=132313252814362&q=p2)

--------------------------------------------------------------------------------------------------
CVE-2011-4343: Apache MyFaces information disclosure vulnerability

Severity: Important

Vendor: The Apache Software Foundation

Versions Affected:
             MyFaces Core 2.0.1 to 2.0.10
             MyFaces Core 2.1.0 to 2.1.4

Description:

If a submit outcome includes both faces-redirect=true and
includeViewParams=true
(or faces-include-view-params=true alias) it is possible to inject EL
expressions
directly into input fields mapped as view parameters.

Mitigation:

2.0.x users should update to 2.0.11
2.1.x users should update to 2.1.5
or apply the patch available on
<https://issues.apache.org/jira/secure/attachment/12504807/MYFACES-3405-1.patch>

Example:

Bean (request scoped):

private String value; // +getter+setter

public String submit() {
  String viewId = FacesContext.
getCurrentInstance().getViewRoot().getViewId();
  return viewId + "?faces-redirect=true&amp;includeViewParams=true";
}

View:

<f:metadata>
<f:viewParam name="value" value="#{bean.value}" />
</f:metadata>
<h:form>
<h:inputText value="#{bean.value}" />
<h:commandButton value="submit" action="#{bean.submit}" />
</h:form>

Credit: Issue reported on JAVASERVERFACES issue tracer by user BalusC,
and reported back to MyFaces by Frederick Kämpfer.

References:
<https://issues.apache.org/jira/browse/MYFACES-3405>
<<https://issues.apache.org/jira/browse/MYFACES-3405>>
<http://java.net/jira/browse/JAVASERVERFACES-2247>
<<http://java.net/jira/browse/JAVASERVERFACES-2247>>

--------------------------------------------------------------------------------------------------

regards,

Leonardo Uribe

[[Attachment #5 (text/html)]](?l=full-disclosure&m=132313252814362&q=p5)

<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
  <head>

    <meta http-equiv="content-type" content="text/html; charset=ISO-8859-1">
  </head>
  <body bgcolor="#ffffff" text="#000000">
    <span class="il"></span>--------------------------------------------------------------------------------------------------<br>
  CVE-2011-4343: Apache MyFaces information disclosure vulnerability<br>
    <br>
    Severity: Important<br>
    <br>
    Vendor: The Apache Software Foundation<br>
    <br>
    Versions Affected:<br>
    &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; MyFaces Core 2.0.1 to 2.0.10<br>
    &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; MyFaces Core 2.1.0 to 2.1.4<br>
    <br>
    Description:<br>
    <br>
    If a submit outcome includes both faces-redirect=true and<br>
    includeViewParams=true<br>
    (or faces-include-view-params=true alias) it is possible to inject
    EL<br>
    expressions<br>
    directly into input fields mapped as view parameters.<br>
    <br>
    Mitigation:<br>
    <br>
    2.0.x users should update to 2.0.11<br>
    2.1.x users should update to 2.1.5<br>
    or apply the patch available on<br>
<a class="moz-txt-link-freetext" \
href="<https://issues.apache.org/jira/secure/attachment/12504807/MYFACES-3405-1.patch>"> \
<https://issues.apache.org/jira/secure/attachment/12504807/MYFACES-3405-1.patch></a><br>
  <br>
    Example:<br>
    <br>
    Bean (request scoped):<br>
    <br>
    private String value; // +getter+setter<br>
    <br>
    public String submit() {<br>
    &nbsp;String viewId = FacesContext.
    <div id=":ue"><wbr>getCurrentInstance().<wbr>getViewRoot().getViewId();<br>
      &nbsp;return viewId + \
"?faces-redirect=true&amp;amp;<wbr>includeViewParams=true";<br>  }<br>
      <br>
      View:<br>
      <br>
      &lt;f:metadata&gt;<br>
      &nbsp;&lt;f:viewParam name="value" value="#{bean.value}" /&gt;<br>
      &lt;/f:metadata&gt;<br>
      &lt;h:form&gt;<br>
      &nbsp;&lt;h:inputText value="#{bean.value}" /&gt;<br>
      &nbsp;&lt;h:commandButton value="submit" action="#{bean.submit}" /&gt;<br>
      &lt;/h:form&gt;<br>
      <br>
      Credit: Issue reported on JAVASERVERFACES issue tracer by user
      BalusC,<br>
      and reported back to MyFaces by Frederick K&auml;mpfer.<br>
      <br>
      References:<br>
      <a href="<https://issues.apache.org/jira/browse/MYFACES-3405>"
        target="_blank"><https://issues.apache.org/><wbr>jira/browse/MYFACES-3405</a><br>
  <a href="<http://java.net/jira/browse/JAVASERVERFACES-2247>"
        target="_blank"><http://java.net/jira/browse/><wbr>JAVASERVERFACES-2247</a><br>
      <br>
      <span class="il"></span>--------------------------------------------------------------------------------------------------<br>
  <br>
      regards,<br>
      <br>
      Leonardo Uribe<br>
    </div>
  </body>
</html>

_______________________________________________
Full-Disclosure - We believe in it.
Charter: <http://lists.grok.org.uk/full-disclosure-charter.html>
Hosted and sponsored by Secunia - <http://secunia.com/>

[[prev in list](?l=full-disclosure&m=132313262714499&w=2)] [[next in list](?l=full-disclosure&m=132309785200897&w=2)] [prev in thread] [next in thread]

```

[Configure](?q=configure) |
[About](?q=about) |
[News](?q=news) |
Add a list |
Sponsored by [KoreLogic](http://www.korelogic.com/)


