=== Content from bazaar.launchpad.net_92c08e92_20250125_164351.html ===


[← Back to branch summary](https://code.launchpad.net/~ecryptfs/ecryptfs/trunk)
# ~ecryptfs/ecryptfs/trunk

* [Changes](/~ecryptfs/ecryptfs/trunk/changes "Changes")
* [Files](/~ecryptfs/ecryptfs/trunk/files "Files")

[~ecryptfs/ecryptfs/trunk](https://code.launchpad.net/~ecryptfs/ecryptfs/trunk)
» Revision
558

# Viewing all changes in revision 558.

* [browse files at revision 558](/~ecryptfs/ecryptfs/trunk/files/558 "browse files at revision 558")
* [compare with another revision](/~ecryptfs/ecryptfs/trunk/revision/558?remember=558 "compare with another revision")
* [download diff](/~ecryptfs/ecryptfs/trunk/diff/558)
* [download tarball](/~ecryptfs/ecryptfs/trunk/tarball/558)
* [view history from revision 558](/~ecryptfs/ecryptfs/trunk/changes/558 "view history from revision 558")

* **Committer:**
  Dustin Kirkland
* **Date:**
  2011-08-31 21:43:01 UTC
* **Revision ID:**
  kirkland@ubuntu.com-20110831214301-nx5kclzcg3tgweox

Tags: 91

<https://launchpad.net/bugs/830850>

\*Â src/utils/mount.ecryptfs\_private.c:
\*Â SECURITYÂ UPDATE:Â wrongÂ mtabÂ ownershipÂ andÂ permissionsÂ (LP:Â #830850)
Â Â -Â debian/patches/CVE-2011-3145.patch:Â alsoÂ setÂ gidÂ andÂ umaskÂ before
Â Â Â Â updatingÂ mtabÂ inÂ src/utils/mount.ecryptfs\_private.c.
Â Â -Â CVE-2011-3145

+ files modified:
+ [debian/changelog](/~ecryptfs/ecryptfs/trunk/revision/558/debian/changelog#debian/changelog "View changes to debian/changelog in revision 558")

+ [src/utils/mount.ecryptfs\_private.c](/~ecryptfs/ecryptfs/trunk/revision/558/src/utils/mount.ecryptfs_private.c#src/utils/mount.ecryptfs_private.c "View changes to src/utils/mount.ecryptfs_private.c in revision 558")

![expand all](/static/images/treeCollapsed.png) expand all

![collapse all](/static/images/treeExpanded.png) collapse all

Show diffs side-by-side

![added](/static/images/newCode.gif) added

![removed](/static/images/deleteCode.gif) removed

Lines of Context:

[![](/static/images/treeCollapsed.png)
debian/changelog](/~ecryptfs/ecryptfs/trunk/revision/558/debian/changelog "View changes to debian/changelog only")

![](/static/images/spinner.gif)

[![](/static/images/treeCollapsed.png)
src/utils/mount.ecryptfs\_private.c](/~ecryptfs/ecryptfs/trunk/revision/558/src/utils/mount.ecryptfs_private.c "View changes to src/utils/mount.ecryptfs_private.c only")

![](/static/images/spinner.gif)

* [Older »](/~ecryptfs/ecryptfs/trunk/revision/893?start_revid=894)

Loggerhead is a web-based interface for [Breezy](https://www.breezy-vcs.org/)

Version: 2.0.1



=== Content from launchpad.net_99a90996_20250126_102122.html ===

[Log in / Register](https://bugs.launchpad.net/ubuntu/%2Bsource/ecryptfs-utils/%2Bbug/830850/%2Blogin)

[![](https://launchpadlibrarian.net/606381979/CoF%2064px.png)](https://launchpad.net/ubuntu)

## [Ubuntu](https://launchpad.net/ubuntu)[ecryptfs-utils package](https://launchpad.net/ubuntu/%2Bsource/ecryptfs-utils)

* [Overview](https://launchpad.net/ubuntu/%2Bsource/ecryptfs-utils)
* [Code](https://code.launchpad.net/ubuntu/%2Bsource/ecryptfs-utils)
* [Bugs](https://bugs.launchpad.net/ubuntu/%2Bsource/ecryptfs-utils)
* Blueprints
* [Translations](https://translations.launchpad.net/ubuntu/%2Bsource/ecryptfs-utils)
* [Answers](https://answers.launchpad.net/ubuntu/%2Bsource/ecryptfs-utils)

# mount.ecrpytfs\_private sets group owner of /etc/mtab to user's primary group

Bug #830850 reported by
[John L. Templer](https://launchpad.net/~green-tiger)
on 2011-08-22

[346](/%2Bhelp-bugs/bug-heat.html)

This bug affects 1 person

| Affects | | Status | Importance | Assigned to | Milestone |
| --- | --- | --- | --- | --- | --- |
|  | [ecryptfs-utils (Ubuntu)](https://bugs.launchpad.net/ubuntu/%2Bsource/ecryptfs-utils "Latest release: 111-6ubuntu3, uploaded to universe on 2024-03-31 18:11:39.426219+00:00 by Steve Langasek (vorlon), maintained by Ubuntu Developers (ubuntu-devel-discuss-lists)") | Fix Released | High | [Marc Deslauriers](https://launchpad.net/~mdeslaur) | [Ubuntu ubuntu-11.10-beta-2](https://launchpad.net/ubuntu/%2Bmilestone/ubuntu-11.10-beta-2) |
|  | [Oneiric](https://bugs.launchpad.net/ubuntu/oneiric/%2Bsource/ecryptfs-utils) | Fix Released | High | [Marc Deslauriers](https://launchpad.net/~mdeslaur) | [Ubuntu ubuntu-11.10-beta-2](https://launchpad.net/ubuntu/%2Bmilestone/ubuntu-11.10-beta-2) |

### Bug Description

When mount.ecrpytfs\_private calls set setreuid() it doesn't also set the effective group id. So when it creates the new version, mtab.tmp, it's created with the group id of the user running mount.ecryptfs\_private.

ProblemType: Bug

DistroRelease: Ubuntu 11.04

Package: ecryptfs-utils 87-0ubuntu1.1

ProcVersionSignature: Ubuntu 2.6.38-11.48-generic 2.6.38.8

Uname: Linux 2.6.38-11-generic i686

Architecture: i386

Date: Mon Aug 22 00:41:43 2011

EcryptfsInUse: Yes

ProcEnviron:

 LANGUAGE=en\_US:en

 PATH=(custom, user)

 LANG=en\_US.UTF-8

 SHELL=/bin/bash

SourcePackage: ecryptfs-utils

UpgradeStatus: Upgraded to natty on 2011-04-30 (113 days ago)

Tags:

[apport-bug](/ubuntu/%2Bsource/ecryptfs-utils/%2Bbugs?field.tag=apport-bug)
[i386](/ubuntu/%2Bsource/ecryptfs-utils/%2Bbugs?field.tag=i386)
[natty](/ubuntu/%2Bsource/ecryptfs-utils/%2Bbugs?field.tag=natty)

## Related branches

[lp:ubuntu/lucid-security/ecryptfs-utils](https://code.launchpad.net/~ubuntu-branches/ubuntu/lucid/ecryptfs-utils/lucid-security)

[lp:ubuntu/maverick-security/ecryptfs-utils](https://code.launchpad.net/~ubuntu-branches/ubuntu/maverick/ecryptfs-utils/maverick-security)

[lp:ubuntu/natty-security/ecryptfs-utils](https://code.launchpad.net/~ubuntu-branches/ubuntu/natty/ecryptfs-utils/natty-security)

[lp:~ecryptfs/ecryptfs/oldtrunk](https://code.launchpad.net/~ecryptfs/ecryptfs/oldtrunk)
(Merged)

[lp:ubuntu/oneiric/ecryptfs-utils](https://code.launchpad.net/~ubuntu-branches/ubuntu/oneiric/ecryptfs-utils/oneiric)

## CVE References

* [2011-3145](/bugs/cve/2011-3145 "When mount.ecrpytfs_private before ve...")

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [John L. Templer (green-tiger)](https://launchpad.net/~green-tiger) wrote on 2011-08-22: |  |  | [#1](/ubuntu/%2Bsource/ecryptfs-utils/%2Bbug/830850/comments/1) |
| --- | --- | --- | --- |

* [Dependencies.txt](https://bugs.launchpad.net/ubuntu/%2Bsource/ecryptfs-utils/%2Bbug/830850/%2Battachment/2298476/%2Bfiles/Dependencies.txt)
  [Edit](/ubuntu/%2Bsource/ecryptfs-utils/%2Bbug/830850/%2Battachment/2298476)
  (969 bytes,
  text/plain; charset="utf-8")

[Marc Deslauriers (mdeslaur)](https://launchpad.net/~mdeslaur)
on 2011-08-22

| Changed in ecryptfs-utils (Ubuntu): | |
| --- | --- |
| **status**: | New → Confirmed |
| **importance**: | Undecided → High |
| **security vulnerability**: | no → yes |
| **visibility**: | public → private |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Marc Deslauriers (mdeslaur)](https://launchpad.net/~mdeslaur) wrote on 2011-08-22: |  |  | [#2](/ubuntu/%2Bsource/ecryptfs-utils/%2Bbug/830850/comments/2) |
| --- | --- | --- | --- |

Thanks for reporting this issue. We are working on a fix.

Thanks for reporting this issue. We are working on a fix.

| Changed in ecryptfs-utils (Ubuntu): | |
| --- | --- |
| **assignee**: | nobody → Marc Deslauriers (mdeslaur) |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Dan Rosenberg (dan-j-rosenberg)](https://launchpad.net/~dan-j-rosenberg) wrote on 2011-08-22: |  |  | [#3](/ubuntu/%2Bsource/ecryptfs-utils/%2Bbug/830850/comments/3) |
| --- | --- | --- | --- |

Sigh. For the record, this issue existed prior to the recent fixes...sorry for missing it. Additionally, this by itself doesn't seem to be a vulnerability, since a mis-assigned group ID on mtab doesn't actually allow the unprivileged user to cross any privilege boundaries. But good catch, definitely a bug and worth fixing.

The more problematic issue is that every setuid mount helper that doesn't explicitly set its umask prior to invoking setmntent() will create an mtab-like file that is potentially world-writable, opening a race window in the best-case scenario.

Sigh. For the record, this issue existed prior to the recent fixes...sorry for missing it. Additionally, this by itself doesn't seem to be a vulnerability, since a mis-assigned group ID on mtab doesn't actually allow the unprivileged user to cross any privilege boundaries. But good catch, definitely a bug and worth fixing.
The more problematic issue is that every setuid mount helper that doesn't explicitly set its umask prior to invoking setmntent() will create an mtab-like file that is potentially world-writable, opening a race window in the best-case scenario.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Launchpad Janitor (janitor)](https://launchpad.net/~janitor) wrote on 2011-08-23: |  |  | [#4](/ubuntu/%2Bsource/ecryptfs-utils/%2Bbug/830850/comments/4) |
| --- | --- | --- | --- |

This bug was fixed in the package ecryptfs-utils - 87-0ubuntu1.2

---------------

ecryptfs-utils (87-0ubuntu1.2) natty-security; urgency=low

\* SECURITY UPDATE: wrong mtab ownership and permissions (LP: [#830850](/bugs/830850))

    - debian/patches/CVE-2011-3145.patch: also set gid and umask before

      updating mtab in src/utils/mount.ecryptfs\_private.c.

    - CVE-2011-3145

 -- Marc Deslauriers <email address hidden> Mon, 22 Aug 2011 14:10:47 -0400

This bug was fixed in the package ecryptfs-utils - 87-0ubuntu1.2
---------------
ecryptfs-utils (87-0ubuntu1.2) natty-security; urgency=low
\* SECURITY UPDATE: wrong mtab ownership and permissions (LP: #830850)
- debian/patches/CVE-2011-3145.patch: also set gid and umask before
updating mtab in src/utils/mount.ecryptfs\_private.c.
- CVE-2011-3145
-- Marc Deslauriers <marc.deslauriers@ubuntu.com> Mon, 22 Aug 2011 14:10:47 -0400

| Changed in ecryptfs-utils (Ubuntu): | |
| --- | --- |
| **status**: | Confirmed → Fix Released |

[Marc Deslauriers (mdeslaur)](https://launchpad.net/~mdeslaur)
on 2011-08-23

| **visibility**: | private → public |
| --- | --- |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Kasper Dupont (ubuntu-launchpad-feb)](https://launchpad.net/~ubuntu-launchpad-feb) wrote on 2011-08-24: |  |  | [#5](/ubuntu/%2Bsource/ecryptfs-utils/%2Bbug/830850/comments/5) |
| --- | --- | --- | --- |

Something is also creating /etc/mtab.fuselock with incorrect group. It doesn't always happen simultaneously though as on my system I found that /etc/mtab and /etc/mtab.fuselock had two different gropus (both incorrect).

Something is also creating /etc/mtab.fuselock with incorrect group. It doesn't always happen simultaneously though as on my system I found that /etc/mtab and /etc/mtab.fuselock had two different gropus (both incorrect).

[Dustin Kirkland  (kirkland)](https://launchpad.net/~kirkland)
on 2011-08-31

| Changed in ecryptfs-utils (Ubuntu Oneiric): | |
| --- | --- |
| **milestone**: | none → oneiric-updates |
| **milestone**: | oneiric-updates → ubuntu-11.10-beta-1 |
| **status**: | Fix Released → Fix Committed |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Martin Pitt (pitti)](https://launchpad.net/~pitti) wrote on 2011-09-01: |  |  | [#6](/ubuntu/%2Bsource/ecryptfs-utils/%2Bbug/830850/comments/6) |
| --- | --- | --- | --- |

I'm afraid we can't afford yet another respin, the release is today. But as this was fixed in stables, I suppose it can also be fixed with an update in oneiric. Moving milestone.

I'm afraid we can't afford yet another respin, the release is today. But as this was fixed in stables, I suppose it can also be fixed with an update in oneiric. Moving milestone.

| Changed in ecryptfs-utils (Ubuntu Oneiric): | |
| --- | --- |
| **milestone**: | ubuntu-11.10-beta-1 → ubuntu-11.10-beta-2 |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Launchpad Janitor (janitor)](https://launchpad.net/~janitor) wrote on 2011-09-01: |  |  | [#7](/ubuntu/%2Bsource/ecryptfs-utils/%2Bbug/830850/comments/7) |
| --- | --- | --- | --- |

This bug was fixed in the package ecryptfs-utils - 91-0ubuntu1

---------------

ecryptfs-utils (91-0ubuntu1) oneiric; urgency=low

[ Diego E. "Flameeyes" Pettenò ]

  \* configure.ac:

    - fix reliance on nss-config, which hinders cross-compilation

[ Marc Deslauriers ]

  \* src/utils/mount.ecryptfs\_private.c:

  \* SECURITY UPDATE: wrong mtab ownership and permissions (LP: [#830850](/bugs/830850))

    - debian/patches/CVE-2011-3145.patch: also set gid and umask before

      updating mtab in src/utils/mount.ecryptfs\_private.c.

    - CVE-2011-3145

 -- Dustin Kirkland <email address hidden> Wed, 31 Aug 2011 16:44:22 -0500

This bug was fixed in the package ecryptfs-utils - 91-0ubuntu1
---------------
ecryptfs-utils (91-0ubuntu1) oneiric; urgency=low
[ Diego E. "Flameeyes" Pettenò ]
\* configure.ac:
- fix reliance on nss-config, which hinders cross-compilation
[ Marc Deslauriers ]
\* src/utils/mount.ecryptfs\_private.c:
\* SECURITY UPDATE: wrong mtab ownership and permissions (LP: #830850)
- debian/patches/CVE-2011-3145.patch: also set gid and umask before
updating mtab in src/utils/mount.ecryptfs\_private.c.
- CVE-2011-3145
-- Dustin Kirkland <kirkland@ubuntu.com> Wed, 31 Aug 2011 16:44:22 -0500

| Changed in ecryptfs-utils (Ubuntu Oneiric): | |
| --- | --- |
| **status**: | Fix Committed → Fix Released |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Dustin Kirkland  (kirkland)](https://launchpad.net/~kirkland) wrote on 2011-09-01:  [**Re: [Bug 830850] Re: mount.ecrpytfs\_private sets group owner of /etc/mtab to user's primary group**](/ubuntu/%2Bsource/ecryptfs-utils/%2Bbug/830850/comments/8) |  |  | [#8](/ubuntu/%2Bsource/ecryptfs-utils/%2Bbug/830850/comments/8) |
| --- | --- | --- | --- |

Sure, no problem, Martin. Thanks!

Sure, no problem, Martin. Thanks!

[See full activity log](https://bugs.launchpad.net/ubuntu/%2Bsource/ecryptfs-utils/%2Bbug/830850/%2Bactivity)

To post a comment you must [log in](%2Blogin?comments=all).

* [Report a bug](/ubuntu/%2Bsource/ecryptfs-utils/%2Bfilebug)

This report contains
**Public Security**
information

Everyone can see this security related information.

You are
[not directly subscribed to this bug's notifications.](/ubuntu/%2Bsource/ecryptfs-utils/%2Bbug/830850/%2Bsubscribe)

Subscribing...

* [Edit bug mail](https://bugs.launchpad.net/ubuntu/%2Bsource/ecryptfs-utils/%2Bbug/830850/%2Bsubscriptions "View and change your subscriptions to this bug")

## Other bug subscribers

[Subscribe someone else](https://bugs.launchpad.net/ubuntu/%2Bsource/ecryptfs-utils/%2Bbug/830850/%2Baddsubscriber "Launchpad will email that person whenever this bugs changes")

## Bug attachments

* [Dependencies.txt](https://bugs.launchpad.net/ubuntu/%2Bsource/ecryptfs-utils/%2Bbug/830850/%2Battachment/2298476/%2Bfiles/Dependencies.txt)
  [Edit](/ubuntu/%2Bsource/ecryptfs-utils/%2Bbug/830850/%2Battachment/2298476 "Change attachment details")

* [Add attachment](/ubuntu/%2Bsource/ecryptfs-utils/%2Bbug/830850/%2Baddcomment)

## Remote bug watches

Bug watches keep track of this bug in other bug trackers.

[![Launchpad](/@@/launchpad-footer-logo.svg)](https://launchpad.net/)
 •
[Take the tour](https://launchpad.net/%2Btour)
 •
[Read the guide](https://help.launchpad.net/)

© 2004
[Canonical Ltd.](http://canonical.com/)
 •
[Terms of use](https://launchpad.net/legal)
 •
[Data privacy](https://www.ubuntu.com/legal/dataprivacy)
 •
[Contact Launchpad Support](/feedback)
 •
[Blog](http://blog.launchpad.net/)
 •
[Careers](https://canonical.com/careers)
 •
[System status](https://ubuntu.social/%40launchpadstatus)
 •
4d55102
([Get the code!](https://dev.launchpad.net/))


