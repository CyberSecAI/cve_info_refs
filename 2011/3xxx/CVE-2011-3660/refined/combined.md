=== Content from bugzilla.mozilla.org_02066815_20250124_235755.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/688974)
* [XML](/show_bug.cgi?ctype=xml&id=688974)

Closed
[Bug 688974](/show_bug.cgi?id=688974)

Opened 13 years ago
Closed 13 years ago

# Assertion failure: lastProp->hasSlot() && getSlot(lastProp->slot).isUndefined(), at jsscope.cpp:1151

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Assertion failure: lastProp->hasSlot() && getSlot(lastProp->slot).isUndefined(), at jsscope.cpp:1151

## Categories

### (Core :: JavaScript Engine, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=JavaScript%20Engine#JavaScript%20Engine)

JavaScript Engine
▾

Core :: JavaScript Engine
The interpreter engine for the core JavaScript language, independent of the browser's object model. File ONLY core JavaScript language bugs in this category. For bugs involving browser objects such as "window" and "document", use the "DOM" component. For bugs involving calls between JavaScript and C++, use the "XPConnect" component.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=JavaScript%20Engine&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=JavaScript%20Engine&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=JavaScript%20Engine)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

x86\_64

Linux

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

critical

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

---

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Performance Impact | --- |
| --- | --- |
| Webcompat Priority | --- |
| Accessibility Severity | --- |
| Webcompat Score | --- |
| a11y-review | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox6 | [+](/buglist.cgi?f1=cf_tracking_firefox6&o1=equals&v1=%2B) | [unaffected](/buglist.cgi?f1=cf_status_firefox6&o1=equals&v1=unaffected) |
| firefox7 | [+](/buglist.cgi?f1=cf_tracking_firefox7&o1=equals&v1=%2B) | [unaffected](/buglist.cgi?f1=cf_status_firefox7&o1=equals&v1=unaffected) |
| firefox8 | [+](/buglist.cgi?f1=cf_tracking_firefox8&o1=equals&v1=%2B) | [unaffected](/buglist.cgi?f1=cf_status_firefox8&o1=equals&v1=unaffected) |
| firefox9 | [+](/buglist.cgi?f1=cf_tracking_firefox9&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=fixed) |
| firefox10 | [+](/buglist.cgi?f1=cf_tracking_firefox10&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=fixed) |
| status1.9.2 | --- | [unaffected](/buglist.cgi?f1=cf_status_192&o1=equals&v1=unaffected) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox6 | + | unaffected |
| firefox7 | + | unaffected |
| firefox8 | + | unaffected |
| firefox9 | + | fixed |
| firefox10 | + | fixed |
| status1.9.2 |  | unaffected |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: decoder, Assigned: bhackett1024)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/764aa0af2fda6f02fb17dc9771bb18d9?d=mm&size=40)  [bhackett1024](/user_profile?user_id=346231)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/b29b83d12aba827b8ff68296e473bec5?d=mm&size=40)  [decoder](/user_profile?user_id=395101)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/4fe52ee1503aecf7b6c976b8eb7c1753?d=mm&size=40)  [willyelm](/user_profile?user_id=714609)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

8 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: assertion, testcase, Whiteboard: [sg:critical?][qa-])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[assertion](/buglist.cgi?keywords=assertion&resolution=---),
[testcase](/buglist.cgi?keywords=testcase&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[sg:critical?][qa-]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [decoder](/user_profile?user_id=395101) | [in-testsuite](#c23 "12 years ago") | + |
| --- | --- | --- |
| [decoder](/user_profile?user_id=395101) | in-testsuite | + |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (1 file, 1 obsolete file)

| [patch](/attachment.cgi?id=564854)  [13 years ago](#c1)  [Brian Hackett [Laid off!]](/user_profile?user_id=346231)   1.14 KB, patch |  | [Details](/attachment.cgi?id=564854&action=edit) | [Diff](/attachment.cgi?id=564854&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=688974&attachment=564854) |
| --- | --- | --- |
| [better patch](/attachment.cgi?id=567611)  [13 years ago](#c10)  [Brian Hackett [Laid off!]](/user_profile?user_id=346231)   1.49 KB, patch | luke : [review+](#c11 "13 years ago")  jst : [approval-mozilla-aurora+](#c17 "13 years ago") | [Details](/attachment.cgi?id=567611&action=edit) | [Diff](/attachment.cgi?id=567611&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=688974&attachment=567611) |

Show Obsolete

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=688974#c0)• 13 years ago |
|  | |

The following test asserts on mozilla-central revision fecae145d884 (options -m -n -a):
gczeal(2);
Object.defineProperty(Object.prototype, "b", {set: function() {}});
function C(a, b) {
this.a=a;
this.b=b;
}
var f = C.bind(0x2004, 2);
for (var i=0; i<10000; ++i)
new f;
S-s for now because test is GC-related (requires gczeal).

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=688974#a385783_1689)• 13 years ago |

Whiteboard: [sg:critical?]

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=688974#a457867_12352)• 13 years ago |

[status-firefox10](/buglist.cgi?f1=cf_status_firefox10&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=affected)
[status-firefox6](/buglist.cgi?f1=cf_status_firefox6&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox6&o1=equals&v1=wontfix)
[status-firefox7](/buglist.cgi?f1=cf_status_firefox7&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox7&o1=equals&v1=wontfix)
[status-firefox8](/buglist.cgi?f1=cf_status_firefox8&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox8&o1=equals&v1=affected)
[status-firefox9](/buglist.cgi?f1=cf_status_firefox9&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=affected)
[tracking-firefox10](/buglist.cgi?f1=cf_tracking_firefox10&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox10&o1=equals&v1=%2B)
[tracking-firefox6](/buglist.cgi?f1=cf_tracking_firefox6&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox6&o1=equals&v1=%2B)
[tracking-firefox7](/buglist.cgi?f1=cf_tracking_firefox7&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox7&o1=equals&v1=%2B)
[tracking-firefox8](/buglist.cgi?f1=cf_tracking_firefox8&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox8&o1=equals&v1=%2B)
[tracking-firefox9](/buglist.cgi?f1=cf_tracking_firefox9&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox9&o1=equals&v1=%2B)

|  | [Brian Hackett [Laid off!]](/user_profile?user_id=346231)  Assignee |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=688974#c1)• 13 years ago |
|  | |

Attached patch

[patch](attachment.cgi?id=564854&action=diff) (obsolete)
— [Details](attachment.cgi?id=564854&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=688974&attachment=564854)

Bug when fixing up objects that add setters to their prototypes during construction. If we pregenerate a shape for a newly constructed object, we fixup that shape according to the properties added at the current point of execution of the constructor.
function foo() {
Object.defineProperty(foo.prototype, "x", {set: function() {...}});
this.x = x;
}
While in this testcase the setter is added outside the constructor, we don't detect that until analyzing the script during compilation, and when fixing the stack read the uninitialized 'this' slot out of the topmost frame. The fix ignores frames that are at the start of execution. Once the 'this' object is constructed the pregenerated shape info will have been cleared and the object will have an empty shape.
I'm tempted to rip this stack walking out entirely (and a fair amount of supporting complexity) and just be unsound with respect to code that does such an absurd thing as the example above. This would manifest as generating the 'x' property on the new object before the 'this.x = x', and not calling the setter.Assignee: general → bhackett1024
[Attachment #564854](/attachment.cgi?id=564854&action=edit "patch") -
Flags: review?(luke)

|  | [Luke Wagner [:luke]](/user_profile?user_id=347312) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=688974#c2)• 13 years ago |
|  | |

I don't understand this fix. I ran the test case to hit the assert and for the offending fp->thisValue, fp was initialized in C++ through InvokeConstructorKernel+InvokeKernel. How does the this-value get corrupted in jit code (and only when pc == script->code)?

|  | [Brian Hackett [Laid off!]](/user_profile?user_id=346231)  Assignee |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=688974#c3)• 13 years ago |
|  | |

There is no jitcode change/corruption here. CallOrConstructBoundFunction does not initialize args.thisv() when calling InvokeConstructor, which goes to InvokeConstructorKernel and tries to compile the method with a still-uninitialized fp->thisValue().
I don't think there is currently a requirement that fp->thisValue() be initialized in the topmost frame when invoking a constructor. This could be made a requirement, but it would be more involved, especially if we want to let the JIT keep the thisValue() uninitialized when calling scripted constructors. This fix sidesteps the issue by making sure the stack walk triggered during compilation does not inspect the 'this' values of frames which may not have constructed their 'this' object yet.

|  | [Luke Wagner [:luke]](/user_profile?user_id=347312) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=688974#c4)• 13 years ago |
|  | |

(In reply to Brian Hackett from [comment #3](/show_bug.cgi?id=688974#c3 "VERIFIED FIXED - Assertion failure: lastProp->hasSlot() && getSlot(lastProp->slot).isUndefined(), at jsscope.cpp:1151"))
Wow, I was not aware that we allowed 'this' to be unitialized when calling the constructor. I guess that's valid because we conservatively mark the VM stack. Well, when/if we get closer to ripping out conservative stack scanning, we can change it back. (The fix is hardly involve, though; pushInvokeArgs just needs to do MakeValueRangeGCSafe on the pushed values.)
> This fix sidesteps the issue by making sure the stack walk
> triggered during compilation does not inspect the 'this' values of frames
> which may not have constructed their 'this' object yet.
What if fp->thisValue has been initialized but pc still points to script->code? After initializing thisValue, is it necessary to that pc is incremented before the first chance to escape into C++?

|  | [Brian Hackett [Laid off!]](/user_profile?user_id=346231)  Assignee |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=688974#c5)• 13 years ago |
|  | |

(In reply to Luke Wagner [:luke] from [comment #4](/show_bug.cgi?id=688974#c4 "VERIFIED FIXED - Assertion failure: lastProp->hasSlot() && getSlot(lastProp->slot).isUndefined(), at jsscope.cpp:1151"))
> What if fp->thisValue has been initialized but pc still points to
> script->code? After initializing thisValue, is it necessary to that pc is
> incremented before the first chance to escape into C++?
The hazard here is that if the prototype gets a setter before the pc is incremented, the fixup pass might think the 'this' value is uninitialized and not change its shape. This would not be a crash risk but could affect correctness (the added setter would not get called as the object finishes initialization). Creating the 'this' object is the last thing done before a script starts executing, but it \*is\* possible to add a setter at the first opcode, in limited/stupid circumstances:
function foo(x) {
x++;
this.f = x;
}
new foo({valueOf: function() {
Object.defineProperty(foo.prototype, "f", {set:function() {...}});
}});
This could be fully fixed by having constraints ensuring the 'this' value will be initialized when the VM reads it. This would be a more involved fix.

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=688974#c6)• 13 years ago |
|  | |

Brian, based on your last comment this sounds like it's not a security vulnerability at all, is that the case? If so, we can open this bug up.

|  | [Brian Hackett [Laid off!]](/user_profile?user_id=346231)  Assignee |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=688974#c7)• 13 years ago |
|  | |

(In reply to Johnny Stenback (:jst, jst@mozilla.com) from [comment #6](/show_bug.cgi?id=688974#c6 "VERIFIED FIXED - Assertion failure: lastProp->hasSlot() && getSlot(lastProp->slot).isUndefined(), at jsscope.cpp:1151"))
> Brian, based on your last comment this sounds like it's not a security
> vulnerability at all, is that the case? If so, we can open this bug up.
No, [comment 5](/show_bug.cgi?id=688974#c5 "VERIFIED FIXED - Assertion failure: lastProp->hasSlot() && getSlot(lastProp->slot).isUndefined(), at jsscope.cpp:1151") is describing a potential correctness problem with the patch applied (it's hard to do things exactly right the way object construction is currently structured). Without the patch, there is a use of uninitialized memory here which could potentially see a torn/invalid value.

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=688974#c8)• 13 years ago |
|  | |

Ok, thanks for clarifying!

|  | [Luke Wagner [:luke]](/user_profile?user_id=347312) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=688974#c9)• 13 years ago |
|  | |

(In reply to Brian Hackett from [comment #5](/show_bug.cgi?id=688974#c5 "VERIFIED FIXED - Assertion failure: lastProp->hasSlot() && getSlot(lastProp->slot).isUndefined(), at jsscope.cpp:1151"))
> but it \*is\* possible to add a setter at the first
> opcode, in limited/stupid circumstances:
Well, then that seems to make this patch undesirable as the permanent resolution to the bug.
> This could be fully fixed by having constraints ensuring the 'this' value
> will be initialized when the VM reads it. This would be a more involved fix.
In C++ I think it would be a fix in one place. Is it more than one place to fix in mjit?

|  | [Brian Hackett [Laid off!]](/user_profile?user_id=346231)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=688974#a2022811_346231)• 13 years ago |

[Attachment #564854](/attachment.cgi?id=564854&action=edit "patch") -
Flags: review?(luke)

|  | [Brian Hackett [Laid off!]](/user_profile?user_id=346231)  Assignee |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=688974#c10)• 13 years ago |
|  | |

Attached patch

[better patch](attachment.cgi?id=567611&action=diff)
— [Details](attachment.cgi?id=567611&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=688974&attachment=567611)

Actually, only the C++ call path needs to be updated --- with TI enabled the mjit ensures the 'this' slot of 'new' frames is initially a null value.
[Attachment #564854](/attachment.cgi?id=564854&action=edit "patch") -
Attachment is obsolete: true
[Attachment #567611](/attachment.cgi?id=567611&action=edit "better patch") -
Flags: review?(luke)

|  | [Luke Wagner [:luke]](/user_profile?user_id=347312) |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=688974#c11)• 13 years ago |
|  | |

Comment on [attachment 567611](/attachment.cgi?id=567611 "better patch") [[details]](/attachment.cgi?id=567611&action=edit "better patch") [[diff]](/attachment.cgi?id=567611&action=diff "better patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=688974&attachment=567611)
better patch
I like this fix a lot more. It definitely needs a comment explaining "Bail logic inspects 'thisv' of constructor frames, so ensure valid value."
Alternatively, I was hoping for this fix:
diff --git a/js/src/vm/Stack.cpp b/js/src/vm/Stack.cpp
@@ -648,16 +648,17 @@ ContextStack::pushInvokeArgs(JSContext \*
ImplicitCast<CallArgs>(\*iag) = CallArgsFromVp(argc, firstUnused);
+ MakeRangeGCSafe(iag->base(), iag->end());
since that's the real "bug" here (only not a bug b/c of conservative GC stack scanning, and will be a bug when someone (perhaps you :) makes us not conservative).
[Attachment #567611](/attachment.cgi?id=567611&action=edit "better patch") -
Flags: review?(luke) → review+

|  | [Brian Hackett [Laid off!]](/user_profile?user_id=346231)  Assignee |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=688974#c12)• 13 years ago |
|  | |

I'd rather tackle the exact scanning JS stack issue when we come to it. That looks like the wrong place for that change anyways --- if we initialize stack memory the instant it is pushed, just to write its real values shortly afterwards with no intervening chance for a GC, then we are wasting a probably significant amount of work.

|  | [Luke Wagner [:luke]](/user_profile?user_id=347312) |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=688974#c13)• 13 years ago |
|  | |

(In reply to Brian Hackett from [comment #12](/show_bug.cgi?id=688974#c12 "VERIFIED FIXED - Assertion failure: lastProp->hasSlot() && getSlot(lastProp->slot).isUndefined(), at jsscope.cpp:1151"))
> That looks like the wrong place for that change anyways --- if we initialize
> stack memory the instant it is pushed, just to write its real values shortly
> afterwards with no intervening chance for a GC, then we are wasting a
> probably significant amount of work.
Wasted work, sure, but significant, I doubt. Remember, this is only a few (probably 2-5) values and we're about to call Invoke. There are only a few really hot ways to call Invoke (replace, sort, map, reduce, forEach, etc) and we should be self-hosting most of those anyways. Having an interface that says "you had better initialize this before the first possible GC" that is used as widely as pushInvokeArgs is a Bad Idea.
But if you want the local fix for now, that's fine. I doubt we'll forget the issue now :)

|  | [Brian Hackett [Laid off!]](/user_profile?user_id=346231)  Assignee |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=688974#c14)• 13 years ago |
|  | |

<https://hg.mozilla.org/integration/mozilla-inbound/rev/6fe1b8214bfa>

|  | [Brian Hackett [Laid off!]](/user_profile?user_id=346231)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=688974#a2091851_346231)• 13 years ago |

[Attachment #567611](/attachment.cgi?id=567611&action=edit "better patch") -
Flags: approval-mozilla-aurora?

|  | [Brian Hackett [Laid off!]](/user_profile?user_id=346231)  Assignee |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=688974#c15)• 13 years ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/6fe1b8214bfa>Status: NEW → RESOLVEDClosed: 13 years agoResolution: --- → FIXED

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=688974#c16)• 13 years ago |
|  | |

Any reason we wouldn't want this in beta for 8? Seems like a pretty straight forward fix.

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=688974#c17)• 13 years ago |
|  | |

Comment on [attachment 567611](/attachment.cgi?id=567611 "better patch") [[details]](/attachment.cgi?id=567611&action=edit "better patch") [[diff]](/attachment.cgi?id=567611&action=diff "better patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=688974&attachment=567611)
better patch
Approved for aurora per today's triage meeting.
[Attachment #567611](/attachment.cgi?id=567611&action=edit "better patch") -
Flags: approval-mozilla-aurora? → approval-mozilla-aurora+

|  | [Brian Hackett [Laid off!]](/user_profile?user_id=346231)  Assignee |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=688974#c18)• 13 years ago |
|  | |

(In reply to Johnny Stenback (:jst, jst@mozilla.com) from [comment #16](/show_bug.cgi?id=688974#c16 "VERIFIED FIXED - Assertion failure: lastProp->hasSlot() && getSlot(lastProp->slot).isUndefined(), at jsscope.cpp:1151"))
> Any reason we wouldn't want this in beta for 8? Seems like a pretty straight
> forward fix.
While this memory is also uninitialized in 8, nothing tries to read that memory except for TI related code, so this bug should only affect 9.

|  | [Brian Hackett [Laid off!]](/user_profile?user_id=346231)  Assignee |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=688974#c19)• 13 years ago |
|  | |

<https://hg.mozilla.org/releases/mozilla-aurora/rev/b8492fce41a0>

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=688974#c20)• 13 years ago |
|  | |

Updating flags per previous comment.
[status-firefox10](/buglist.cgi?f1=cf_status_firefox10&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=fixed)
[status-firefox6](/buglist.cgi?f1=cf_status_firefox6&o1=isnotempty):
[wontfix](/buglist.cgi?f1=cf_status_firefox6&o1=equals&v1=wontfix) → [unaffected](/buglist.cgi?f1=cf_status_firefox6&o1=equals&v1=unaffected)
[status-firefox7](/buglist.cgi?f1=cf_status_firefox7&o1=isnotempty):
[wontfix](/buglist.cgi?f1=cf_status_firefox7&o1=equals&v1=wontfix) → [unaffected](/buglist.cgi?f1=cf_status_firefox7&o1=equals&v1=unaffected)
[status-firefox8](/buglist.cgi?f1=cf_status_firefox8&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox8&o1=equals&v1=affected) → [unaffected](/buglist.cgi?f1=cf_status_firefox8&o1=equals&v1=unaffected)
[status-firefox9](/buglist.cgi?f1=cf_status_firefox9&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=fixed)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=688974#a3229542_1689)• 13 years ago |

[status1.9.2](/buglist.cgi?f1=cf_status_192&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_192&o1=equals&v1=unaffected)

|  | [u279076](/user_profile?user_id=279076) |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=688974#c21)• 13 years ago |
|  | |

Could someone who is already set up to reproduce this bug please verify the fix?Whiteboard: [sg:critical?] → [sg:critical?][qa-]

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=688974#c22)• 13 years ago |
|  | |

Verified fixed on Firefox 9 and 10.

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=688974#a12561542_1689)• 13 years ago |

Group: core-security

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=688974#a15675378_395101)• 13 years ago |

Status: RESOLVED → VERIFIED

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=688974#c23)• 12 years ago |
|  | |

Automatically extracted testcase for this bug was committed:
<https://hg.mozilla.org/mozilla-central/rev/efaf8960a929>Flags: in-testsuite+
You need to [log in](/show_bug.cgi?id=688974&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Brian Hackett [Laid off!]](/user_profile?user_id=346231)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from bugzilla.mozilla.org_3ec06a44_20250124_235822.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/700512)
* [XML](/show_bug.cgi?ctype=xml&id=700512)

Closed
[Bug 700512](/show_bug.cgi?id=700512)

Opened 13 years ago
Closed 13 years ago

# Workers + Files exposes threadsafety assertions with DataOwner

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Workers + Files exposes threadsafety assertions with DataOwner

## Categories

### (Core :: DOM: Core & HTML, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=DOM%3A%20Core%20%26%20HTML#DOM%3A%20Core%20%26%20HTML)

DOM: Core & HTML
▾

Core :: DOM: Core & HTML
Issues in DOM tree [https://dom.spec.whatwg.org](https://dom.spec.whatwg.org/) & HTML [https://html.spec.whatwg.org](https://html.spec.whatwg.org/) that do not fit into any other DOM or HTML component or which span multiple DOM or HTML components.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=DOM%3A%20Core%20%26%20HTML&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=DOM%3A%20Core%20%26%20HTML&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=DOM%3A%20Core%20%26%20HTML)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

unspecified

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

All

All

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

normal

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla9

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| a11y-review | --- |
| --- | --- |
| Webcompat Priority | --- |
| Performance Impact | --- |
| Accessibility Severity | --- |
| Webcompat Score | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox8 | [-](/buglist.cgi?f1=cf_tracking_firefox8&o1=equals&v1=-) | [wontfix](/buglist.cgi?f1=cf_status_firefox8&o1=equals&v1=wontfix) |
| firefox9 | [+](/buglist.cgi?f1=cf_tracking_firefox9&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=fixed) |
| firefox10 | [+](/buglist.cgi?f1=cf_tracking_firefox10&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=fixed) |
| blocking1.9.2 | --- | [-](/buglist.cgi?f1=cf_blocking_192&o1=equals&v1=-) |
| status1.9.2 | --- | [unaffected](/buglist.cgi?f1=cf_status_192&o1=equals&v1=unaffected) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox8 | - | wontfix |
| firefox9 | + | fixed |
| firefox10 | + | fixed |
| blocking1.9.2 |  |  |
| status1.9.2 |  | unaffected |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: khuey, Assigned: khuey)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/d8bebbee32670ee5755ce1bc535cd251?d=mm&size=40)  [khuey](/user_profile?user_id=336670)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/d8bebbee32670ee5755ce1bc535cd251?d=mm&size=40)  [khuey](/user_profile?user_id=336670)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/5111b810214a00377104f5ad3efefa26?d=mm&size=40)  [sefeng](/user_profile?user_id=625922)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

9 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Whiteboard: [sg:high][qa?])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

---

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[sg:high][qa?]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [khuey](/user_profile?user_id=336670) | [in-testsuite](#c20 "13 years ago") | + |
| --- | --- | --- |
| [khuey](/user_profile?user_id=336670) | in-testsuite | + |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (1 file, 2 obsolete files)

| [Patch](/attachment.cgi?id=572786)  [13 years ago](#c2)  [Kyle Huey (Exited; not receiving bugmail, old account, do not use)](/user_profile?user_id=336670)   5.45 KB, patch |  | [Details](/attachment.cgi?id=572786&action=edit) | [Diff](/attachment.cgi?id=572786&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=700512&attachment=572786) |
| --- | --- | --- |
| [Patch](/attachment.cgi?id=572820)  [13 years ago](#c3)  [Kyle Huey (Exited; not receiving bugmail, old account, do not use)](/user_profile?user_id=336670)   5.53 KB, patch | sicking : [review-](#c4 "13 years ago") | [Details](/attachment.cgi?id=572820&action=edit) | [Diff](/attachment.cgi?id=572820&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=700512&attachment=572820) |
| [Patch](/attachment.cgi?id=572824)  [13 years ago](#c5)  [Kyle Huey (Exited; not receiving bugmail, old account, do not use)](/user_profile?user_id=336670)   5.77 KB, patch | sicking : [review+](#a71877_9186 "13 years ago")  benjamin : [review+](#a759255_7044 "13 years ago")  christian : [approval-mozilla-aurora+](#c15 "13 years ago")  christian : [approval-mozilla-beta+](#c15 "13 years ago") | [Details](/attachment.cgi?id=572824&action=edit) | [Diff](/attachment.cgi?id=572824&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=700512&attachment=572824) |

Show Obsolete

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Kyle Huey (Exited; not receiving bugmail, old account, do not use)](/user_profile?user_id=336670)  Assignee |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=700512#c0)• 13 years ago |
|  | |

Jonas reports that bent has seen threadsafety assertions from DataOwner when manipulating File objects in Workers in certain ways.

|  | [Jonas Sicking (:sicking) No longer reading bugmail consistently](/user_profile?user_id=9186) |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=700512#c1)• 13 years ago |
|  | |

Yeah, we need to make the DataOwner refcounting threadsafe. As things stand now, if a memory-blob is used on both the main thread and a worker thread, the refcount can end up both too high and too low due to races.

|  | [Kyle Huey (Exited; not receiving bugmail, old account, do not use)](/user_profile?user_id=336670)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=700512#a40823_336670)• 13 years ago |

Assignee: nobody → khuey

|  | [Kyle Huey (Exited; not receiving bugmail, old account, do not use)](/user_profile?user_id=336670)  Assignee |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=700512#c2)• 13 years ago |
|  | |

Attached patch

[Patch](attachment.cgi?id=572786&action=diff) (obsolete)
— [Details](attachment.cgi?id=572786&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=700512&attachment=572786)

[Attachment #572786](/attachment.cgi?id=572786&action=edit "Patch") -
Flags: review?(jonas)

|  | [Kyle Huey (Exited; not receiving bugmail, old account, do not use)](/user_profile?user_id=336670)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=700512#a44753_336670)• 13 years ago |

[Attachment #572786](/attachment.cgi?id=572786&action=edit "Patch") -
Flags: review?(benjamin)

|  | [Kyle Huey (Exited; not receiving bugmail, old account, do not use)](/user_profile?user_id=336670)  Assignee |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=700512#c3)• 13 years ago |
|  | |

Attached patch

[Patch](attachment.cgi?id=572820&action=diff) (obsolete)
— [Details](attachment.cgi?id=572820&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=700512&attachment=572820)

[Attachment #572786](/attachment.cgi?id=572786&action=edit "Patch") -
Attachment is obsolete: true
[Attachment #572786](/attachment.cgi?id=572786&action=edit "Patch") -
Flags: review?(jonas)
[Attachment #572786](/attachment.cgi?id=572786&action=edit "Patch") -
Flags: review?(benjamin)
[Attachment #572820](/attachment.cgi?id=572820&action=edit "Patch") -
Flags: review?(jonas)

|  | [Kyle Huey (Exited; not receiving bugmail, old account, do not use)](/user_profile?user_id=336670)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=700512#a55258_336670)• 13 years ago |

[Attachment #572820](/attachment.cgi?id=572820&action=edit "Patch") -
Flags: review?(benjamin)

|  | [Jonas Sicking (:sicking) No longer reading bugmail consistently](/user_profile?user_id=9186) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=700512#c4)• 13 years ago |
|  | |

Comment on [attachment 572820](/attachment.cgi?id=572820 "Patch") [[details]](/attachment.cgi?id=572820&action=edit "Patch") [[diff]](/attachment.cgi?id=572820&action=diff "Patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=700512&attachment=572820)
Patch
Err.. you only want to delete if the refcount goes to 0, right?
[Attachment #572820](/attachment.cgi?id=572820&action=edit "Patch") -
Flags: review?(jonas) → review-

|  | [Kyle Huey (Exited; not receiving bugmail, old account, do not use)](/user_profile?user_id=336670)  Assignee |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=700512#c5)• 13 years ago |
|  | |

Attached patch

[Patch](attachment.cgi?id=572824&action=diff)
— [Details](attachment.cgi?id=572824&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=700512&attachment=572824)

[Attachment #572820](/attachment.cgi?id=572820&action=edit "Patch") -
Attachment is obsolete: true
[Attachment #572820](/attachment.cgi?id=572820&action=edit "Patch") -
Flags: review?(benjamin)
[Attachment #572824](/attachment.cgi?id=572824&action=edit "Patch") -
Flags: review?(jonas)

|  | [Jonas Sicking (:sicking) No longer reading bugmail consistently](/user_profile?user_id=9186) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=700512#a71877_9186)• 13 years ago |

[Attachment #572824](/attachment.cgi?id=572824&action=edit "Patch") -
Flags: review?(jonas) → review+

|  | [Kyle Huey (Exited; not receiving bugmail, old account, do not use)](/user_profile?user_id=336670)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=700512#a74583_336670)• 13 years ago |

[Attachment #572824](/attachment.cgi?id=572824&action=edit "Patch") -
Flags: review?(benjamin)

|  | [Kyle Huey (Exited; not receiving bugmail, old account, do not use)](/user_profile?user_id=336670)  Assignee |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=700512#c6)• 13 years ago |
|  | |

If we're respinning 8.0, perhaps we should consider including this? It's a pretty easy fix to a new bug in 8.0.

|  | [Ben Turner (not reading bugmail, use the needinfo flag!)](/user_profile?user_id=200444) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=700512#a315649_200444)• 13 years ago |

[tracking-firefox10](/buglist.cgi?f1=cf_tracking_firefox10&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox10&o1=equals&v1=%3F)
[tracking-firefox8](/buglist.cgi?f1=cf_tracking_firefox8&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox8&o1=equals&v1=%3F)
[tracking-firefox9](/buglist.cgi?f1=cf_tracking_firefox9&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox9&o1=equals&v1=%3F)

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=700512#c7)• 13 years ago |
|  | |

[Triage Comment]
This is sg:high and therefore doesn't meet the criteria for landing on the release branch for a chemspill.
[tracking-firefox8](/buglist.cgi?f1=cf_tracking_firefox8&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox8&o1=equals&v1=%3F) → [-](/buglist.cgi?f1=cf_tracking_firefox8&o1=equals&v1=-)

|  | [Kyle Huey (Exited; not receiving bugmail, old account, do not use)](/user_profile?user_id=336670)  Assignee |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=700512#c8)• 13 years ago |
|  | |

Review ping.

|  | [Benjamin Smedberg](/user_profile?user_id=7044) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=700512#a759255_7044)• 13 years ago |

[Attachment #572824](/attachment.cgi?id=572824&action=edit "Patch") -
Flags: review?(benjamin) → review+

|  | [Ben Turner (not reading bugmail, use the needinfo flag!)](/user_profile?user_id=200444) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=700512#c9)• 13 years ago |
|  | |

Wait... I don't like that this doesn't stabilize the refcount. Having inconsistent implementations of Release seems like a recipe for headaches, and having no stabilization seems like a recipe for double-free.

|  | [Benjamin Smedberg](/user_profile?user_id=7044) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=700512#c10)• 13 years ago |
|  | |

refcount stabilization was a terrible idea. We should assert if you try to addref a dying object, not propagate stabilization to new macros where it's not already potentially used.

|  | [Ben Turner (not reading bugmail, use the needinfo flag!)](/user_profile?user_id=200444) |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=700512#c11)• 13 years ago |
|  | |

Fatally asserting sounds fine, but I imagine we'd only do that in debug builds since you have to have some other state bit to track that. For opt builds we'd just have no protection against double frees?

|  | [Benjamin Smedberg](/user_profile?user_id=7044) |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=700512#c12)• 13 years ago |
|  | |

You really don't need another state bit, just use PR\_UINT32\_MAX as a sentinel value. I'm not sure that the extra branch is worth the protection in release builds, but we should probably measure to see how much it actually costs.

|  | [Kyle Huey (Exited; not receiving bugmail, old account, do not use)](/user_profile?user_id=336670)  Assignee |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=700512#c13)• 13 years ago |
|  | |

Checked in without a test case.
<https://hg.mozilla.org/mozilla-central/rev/d20b9d389776>Status: NEW → RESOLVEDClosed: 13 years agoFlags: in-testsuite?Resolution: --- → FIXEDTarget Milestone: --- → mozilla11

|  | [Kyle Huey (Exited; not receiving bugmail, old account, do not use)](/user_profile?user_id=336670)  Assignee |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=700512#c14)• 13 years ago |
|  | |

Comment on [attachment 572824](/attachment.cgi?id=572824 "Patch") [[details]](/attachment.cgi?id=572824&action=edit "Patch") [[diff]](/attachment.cgi?id=572824&action=diff "Patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=700512&attachment=572824)
Patch
Requesting aurora and beta approval for this security regression introduced in Firefox 8.
[Attachment #572824](/attachment.cgi?id=572824&action=edit "Patch") -
Flags: approval-mozilla-beta?
[Attachment #572824](/attachment.cgi?id=572824&action=edit "Patch") -
Flags: approval-mozilla-aurora?

|  | [LegNeato](/user_profile?user_id=482154) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=700512#a1271507_482154)• 13 years ago |

[status-firefox8](/buglist.cgi?f1=cf_status_firefox8&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox8&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox8&o1=equals&v1=wontfix)
[tracking-firefox10](/buglist.cgi?f1=cf_tracking_firefox10&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox10&o1=equals&v1=%3F) → [+](/buglist.cgi?f1=cf_tracking_firefox10&o1=equals&v1=%2B)
[tracking-firefox9](/buglist.cgi?f1=cf_tracking_firefox9&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox9&o1=equals&v1=%3F) → [+](/buglist.cgi?f1=cf_tracking_firefox9&o1=equals&v1=%2B)

|  | [LegNeato](/user_profile?user_id=482154) |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=700512#c15)• 13 years ago |
|  | |

Comment on [attachment 572824](/attachment.cgi?id=572824 "Patch") [[details]](/attachment.cgi?id=572824&action=edit "Patch") [[diff]](/attachment.cgi?id=572824&action=diff "Patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=700512&attachment=572824)
Patch
[triage comment]
Please land on aurora and beta today if at all possible.
[Attachment #572824](/attachment.cgi?id=572824&action=edit "Patch") -
Flags: approval-mozilla-beta?
[Attachment #572824](/attachment.cgi?id=572824&action=edit "Patch") -
Flags: approval-mozilla-beta+
[Attachment #572824](/attachment.cgi?id=572824&action=edit "Patch") -
Flags: approval-mozilla-aurora?
[Attachment #572824](/attachment.cgi?id=572824&action=edit "Patch") -
Flags: approval-mozilla-aurora+

|  | [Kyle Huey (Exited; not receiving bugmail, old account, do not use)](/user_profile?user_id=336670)  Assignee |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=700512#c16)• 13 years ago |
|  | |

<https://hg.mozilla.org/releases/mozilla-aurora/rev/a45dd5ac1f90>
<https://hg.mozilla.org/releases/mozilla-beta/rev/6858e50813de>
[status-firefox10](/buglist.cgi?f1=cf_status_firefox10&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=fixed)
[status-firefox9](/buglist.cgi?f1=cf_status_firefox9&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=fixed)Target Milestone: mozilla11 → mozilla9

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=700512#c17)• 13 years ago |
|  | |

Does this affect the 1.9.2 branch? (qawanted)blocking1.9.2: --- → ?
[status1.9.2](/buglist.cgi?f1=cf_status_192&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_status_192&o1=equals&v1=%3F)Keywords: [qawanted](/buglist.cgi?keywords=qawanted&resolution=---)

|  | [Kyle Huey (Exited; not receiving bugmail, old account, do not use)](/user_profile?user_id=336670)  Assignee |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=700512#c18)• 13 years ago |
|  | |

No, File objects are main thread only in 1.9.2.
[status1.9.2](/buglist.cgi?f1=cf_status_192&o1=isnotempty):
[?](/buglist.cgi?f1=cf_status_192&o1=equals&v1=%3F) → [unaffected](/buglist.cgi?f1=cf_status_192&o1=equals&v1=unaffected)Keywords: [qawanted](/buglist.cgi?keywords=qawanted&resolution=---)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=700512#a2150939_1689)• 13 years ago |

blocking1.9.2: ? → -

|  | [u279076](/user_profile?user_id=279076) |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=700512#c19)• 13 years ago |
|  | |

Is there something QA can do to verify this fix?Whiteboard: [sg:high] → [sg:high][qa?]

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=700512#a8717196_1689)• 13 years ago |

Group: core-security

|  | [Kyle Huey (Exited; not receiving bugmail, old account, do not use)](/user_profile?user_id=336670)  Assignee |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=700512#c20)• 13 years ago |
|  | |

The tests for this landed in [Bug 698621](/show_bug.cgi?id=698621 "RESOLVED FIXED - Add telephony worker for dealing with RIL messages") for reasons that I don't understand.Flags: in-testsuite? → in-testsuite+

|  | [Nobody; OK to take it and work on it](/user_profile?user_id=1) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=700512#a231771063_1)• 6 years ago |

Component: DOM → DOM: Core & HTML
You need to [log in](/show_bug.cgi?id=700512&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Kyle Huey (Exited; not receiving bugmail, old account, do not use)](/user_profile?user_id=336670)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from bugzilla.mozilla.org_6e68b7ee_20250124_235740.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/679494)
* [XML](/show_bug.cgi?ctype=xml&id=679494)

Closed
[Bug 679494](/show_bug.cgi?id=679494)

Opened 13 years ago
Closed 13 years ago

# "compartment mismatched" when listening message event

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

"compartment mismatched" when listening message event

## Categories

### (Core :: XPConnect, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=XPConnect#XPConnect)

XPConnect
▾

Core :: XPConnect
Facilitates calling between JavaScript and XPCOM components.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=XPConnect&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=XPConnect&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=XPConnect)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

All

All

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

normal

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla9

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Accessibility Severity | --- |
| --- | --- |
| Performance Impact | --- |
| a11y-review | --- |
| Webcompat Score | --- |
| Webcompat Priority | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: ochameau, Assigned: bholley)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/ac57223c49d41049a4917e187b854377?d=mm&size=40)  [bholley](/user_profile?user_id=313730)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/da6d769a219551f618ed95bff2c36aca?d=mm&size=40)  [ochameau](/user_profile?user_id=283262)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/5111b810214a00377104f5ad3efefa26?d=mm&size=40)  [sefeng](/user_profile?user_id=625922)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

8 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[679539](/show_bug.cgi?id=679539 "RESOLVED WORKSFORME - test-content-proxy.testProxy triggers assertion in jscntxtinlines.h")

Dependency [tree](/showdependencytree.cgi?id=679494&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=679494)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[Duplicates:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#duplicates)

[688364](/show_bug.cgi?id=688364 "RESOLVED DUPLICATE - compartment mismatch when sharing with F1")

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

---

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

---

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [Ms2ger](/user_profile?user_id=302720) | [in-testsuite](#c14 "13 years ago") | + |
| --- | --- | --- |
| [Ms2ger](/user_profile?user_id=302720) | in-testsuite | + |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (4 files, 1 obsolete file)

| [stacktrace](/attachment.cgi?id=553858)  [13 years ago](#c2)  [Bobby Holley (:bholley)](/user_profile?user_id=313730)   7.96 KB, text/plain |  | [Details](/attachment.cgi?id=553858&action=edit) |
| --- | --- | --- |
| [Bug 679494 - Wrap value returned from nsDOMMessageEvent::GetData. v1](/attachment.cgi?id=554167)  [13 years ago](#c5)  [Bobby Holley (:bholley)](/user_profile?user_id=313730)   1.64 KB, patch | mrbkap : [review+](#a177146_69426 "13 years ago")  christian : [approval-mozilla-beta-](#a5427966_482154 "13 years ago") | [Details](/attachment.cgi?id=554167&action=edit) | [Diff](/attachment.cgi?id=554167&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=679494&attachment=554167) |
| [Bug 679494 - Tests. v1](/attachment.cgi?id=554168)  [13 years ago](#c6)  [Bobby Holley (:bholley)](/user_profile?user_id=313730)   1.83 KB, patch |  | [Details](/attachment.cgi?id=554168&action=edit) | [Diff](/attachment.cgi?id=554168&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=679494&attachment=554168) |
| [Bug 679494 - Tests v2](/attachment.cgi?id=554195)  [13 years ago](#c10)  [Bobby Holley (:bholley)](/user_profile?user_id=313730)   2.55 KB, patch | khuey : [review+](#c11 "13 years ago")  christian : [approval-mozilla-beta-](#a5427936_482154 "13 years ago") | [Details](/attachment.cgi?id=554195&action=edit) | [Diff](/attachment.cgi?id=554195&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=679494&attachment=554195) |
| [Bug 679494 - UUID rev followup. v1](/attachment.cgi?id=554905)  [13 years ago](#c17)  [Bobby Holley (:bholley)](/user_profile?user_id=313730)   822 bytes, patch | khuey : [review+](#a507578_336670 "13 years ago")  jst : [approval-mozilla-beta-](#c22 "13 years ago") | [Details](/attachment.cgi?id=554905&action=edit) | [Diff](/attachment.cgi?id=554905&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=679494&attachment=554905) |

Show Obsolete

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Alexandre Poirot [:ochameau]](/user_profile?user_id=283262)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=679494#c0)• 13 years ago |
|  | |

Assertion failure: compartment mismatched, at /home/pouf/mozilla-central/js/src/jscntxtinlines.h:120
when running the following script in JS console:
var w=top.opener.gBrowser.contentDocument.defaultView;
w.addEventListener("message", function(event) {
alert(event.data);
}, false);
w.postMessage("test");
I suppose that it only occurs when we listen to `message` event from another compartment than the event source document.

|  | [Blake Kaplan (:mrbkap) (inactive)](/user_profile?user_id=69426) |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=679494#c1)• 13 years ago |
|  | |

Alex found me on IRC and was kind enough to pastebin a stack trace. The relevant bit is:
#9 0x025800a8 in js::CallJSPropertyOp (cx=0xb1d0b570, op=
0x19b0a65 <nsIDOMMessageEvent\_GetData(JSContext\*, JSObject\*, jsid, jsval\*)>, receiver=0xad49be40, id=..., vp=0xbfffb638)
this shows us that the problem is a getter returning a value in another compartment. Some quick MXRing later shows us that the problem is that nsDOMMessageEvent::GetData passes through its jsval without wrapping it. So, we need to call JS\_WrapValue before returning the data, but in order to do that, we're going to need to add [implicit\_jscontext] to the IDL in order to get a cx with with to call JS\_WrapValue.Assignee: nobody → bobbyholley+bmo

|  | [Myk Melez [:myk] [@mykmelez]](/user_profile?user_id=27300) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=679494#a7198_27300)• 13 years ago |

Blocks: [679539](/show_bug.cgi?id=679539 "RESOLVED WORKSFORME - test-content-proxy.testProxy triggers assertion in jscntxtinlines.h")

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=679494#c2)• 13 years ago |
|  | |

Attached file
[stacktrace](attachment.cgi?id=553858)
— [Details](attachment.cgi?id=553858&action=edit)

Attaching the full stack trace to give n00bs like myself a better sense of what's going on.

|  | [Dave Townsend [:mossop]](/user_profile?user_id=91159) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=679494#c3)• 13 years ago |
|  | |

What is the priority of getting a fix here? This is causing the Jetpack tests to fail and presumably causing problems for add-ons using the functionality we expose

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=679494#c4)• 13 years ago |
|  | |

(In reply to Dave Townsend (:Mossop) from [comment #3](/show_bug.cgi?id=679494#c3 "RESOLVED FIXED - \"compartment mismatched\" when listening message event"))
> What is the priority of getting a fix here? This is causing the Jetpack
> tests to fail and presumably causing problems for add-ons using the
> functionality we expose
I've got a patch. Just tweaking it a bit and I'll post it for review real soon now.

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=679494#c5)• 13 years ago |
|  | |

Attached patch

[Bug 679494 - Wrap value returned from nsDOMMessageEvent::GetData. v1](attachment.cgi?id=554167&action=diff)
— [Details](attachment.cgi?id=554167&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=679494&attachment=554167)

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=679494#c6)• 13 years ago |
|  | |

Attached patch

[Bug 679494 - Tests. v1](attachment.cgi?id=554168&action=diff) (obsolete)
— [Details](attachment.cgi?id=554168&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=679494&attachment=554168)

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=679494#a166447_313730)• 13 years ago |

[Attachment #554167](/attachment.cgi?id=554167&action=edit "Bug 679494 - Wrap value returned from nsDOMMessageEvent::GetData. v1") -
Flags: review?(mrbkap)

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=679494#c7)• 13 years ago |
|  | |

Comment on [attachment 554168](/attachment.cgi?id=554168 "Bug 679494 - Tests. v1") [[details]](/attachment.cgi?id=554168&action=edit "Bug 679494 - Tests. v1") [[diff]](/attachment.cgi?id=554168&action=diff "Bug 679494 - Tests. v1") [[review]](/page.cgi?id=splinter.html&ignore=&bug=679494&attachment=554168)
[Bug 679494](/show_bug.cgi?id=679494 "RESOLVED FIXED - \"compartment mismatched\" when listening message event") - Tests. v1
Added a patch and tests. Flagging bkap for review.
[Attachment #554168](/attachment.cgi?id=554168&action=edit "Bug 679494 - Tests. v1") -
Flags: review?(mrbkap)

|  | [Kyle Huey (Exited; not receiving bugmail, old account, do not use)](/user_profile?user_id=336670) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=679494#c8)• 13 years ago |
|  | |

Why do you need a browser chrome test here? You should be able to do it with a chrome test with a content iframe, no?

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=679494#c9)• 13 years ago |
|  | |

(In reply to Kyle Huey [:khuey] (khuey@mozilla.com) from [comment #8](/show_bug.cgi?id=679494#c8 "RESOLVED FIXED - \"compartment mismatched\" when listening message event"))
> Why do you need a browser chrome test here? You should be able to do it
> with a chrome test with a content iframe, no?
Probably - I was just trying to match the test-case as much as possible. Would that be preferable? I'm not sure of the relative overhead.

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=679494#c10)• 13 years ago |
|  | |

Attached patch

[Bug 679494 - Tests v2](attachment.cgi?id=554195&action=diff)
— [Details](attachment.cgi?id=554195&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=679494&attachment=554195)

> Would that be preferable? I'm not sure of the relative overhead.
I'm going to assume from [comment 8](/show_bug.cgi?id=679494#c8 "RESOLVED FIXED - \"compartment mismatched\" when listening message event") that it is. Here's an updated version. Flagging khuey for review.
[Attachment #554168](/attachment.cgi?id=554168&action=edit "Bug 679494 - Tests. v1") -
Attachment is obsolete: true
[Attachment #554168](/attachment.cgi?id=554168&action=edit "Bug 679494 - Tests. v1") -
Flags: review?(mrbkap)
[Attachment #554195](/attachment.cgi?id=554195&action=edit "Bug 679494 - Tests v2") -
Flags: review?(khuey)

|  | [Kyle Huey (Exited; not receiving bugmail, old account, do not use)](/user_profile?user_id=336670) |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=679494#c11)• 13 years ago |
|  | |

Comment on [attachment 554195](/attachment.cgi?id=554195 "Bug 679494 - Tests v2") [[details]](/attachment.cgi?id=554195&action=edit "Bug 679494 - Tests v2") [[diff]](/attachment.cgi?id=554195&action=diff "Bug 679494 - Tests v2") [[review]](/page.cgi?id=splinter.html&ignore=&bug=679494&attachment=554195)
[Bug 679494](/show_bug.cgi?id=679494 "RESOLVED FIXED - \"compartment mismatched\" when listening message event") - Tests v2
Yeah, this is better.
Chrome tests are preferable to browser-chrome tests because they run in all Gecko things and not Firefox. We generally avoid browser-chrome tests for anything except the browser UI.
[Attachment #554195](/attachment.cgi?id=554195&action=edit "Bug 679494 - Tests v2") -
Flags: review?(khuey) → review+

|  | [Blake Kaplan (:mrbkap) (inactive)](/user_profile?user_id=69426) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=679494#a177146_69426)• 13 years ago |

[Attachment #554167](/attachment.cgi?id=554167&action=edit "Bug 679494 - Wrap value returned from nsDOMMessageEvent::GetData. v1") -
Flags: review?(mrbkap) → review+

|  | [Mozilla RelEng Bot](/user_profile?user_id=393356) |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=679494#c12)• 13 years ago |
|  | |

Try run for e05ba95b7e9e is complete.
Detailed breakdown of the results available here:
<http://tbpl.allizom.org/?tree=Try&usebuildbot=1&rev=e05ba95b7e9e>
Results (out of 27 total builds):
success: 25
warnings: 2
Builds available at [http://ftp.mozilla.org/pub/mozilla.org/firefox/try-builds/bobbyholley@gmail.com-e05ba95b7e9e](http://ftp.mozilla.org/pub/mozilla.org/firefox/try-builds/bobbyholley%40gmail.com-e05ba95b7e9e)

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=679494#c13)• 13 years ago |
|  | |

Landed on mozilla-inbound:
<http://hg.mozilla.org/integration/mozilla-inbound/rev/70a6be6a9caa>
<http://hg.mozilla.org/integration/mozilla-inbound/rev/b1844f9cf777>Whiteboard: [inbound]

|  | [:Ms2ger (he/him; ⌚ UTC+1/+2)](/user_profile?user_id=302720) |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=679494#c14)• 13 years ago |
|  | |

<http://hg.mozilla.org/mozilla-central/rev/70a6be6a9caa>
<http://hg.mozilla.org/mozilla-central/rev/b1844f9cf777>Status: NEW → RESOLVEDClosed: 13 years agoFlags: in-testsuite+Resolution: --- → FIXEDTarget Milestone: --- → mozilla9Version: unspecified → Trunk

|  | [:Ms2ger (he/him; ⌚ UTC+1/+2)](/user_profile?user_id=302720) |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=679494#c15)• 13 years ago |
|  | |

And this should have had a uuid bump, surely?Whiteboard: [inbound]

|  | [Kyle Huey (Exited; not receiving bugmail, old account, do not use)](/user_profile?user_id=336670) |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=679494#c16)• 13 years ago |
|  | |

(In reply to Ms2ger from [comment #15](/show_bug.cgi?id=679494#c15 "RESOLVED FIXED - \"compartment mismatched\" when listening message event"))
> And this should have had a uuid bump, surely?
It needs one, yes.

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=679494#c17)• 13 years ago |
|  | |

Attached patch

[Bug 679494 - UUID rev followup. v1](attachment.cgi?id=554905&action=diff)
— [Details](attachment.cgi?id=554905&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=679494&attachment=554905)

D'oh!. Attaching a followup. Flagging khuey for review.
[Attachment #554905](/attachment.cgi?id=554905&action=edit "Bug 679494 - UUID rev followup. v1") -
Flags: review?(khuey)

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=679494#a507378_313730)• 13 years ago |

Status: RESOLVED → REOPENEDResolution: FIXED → ---

|  | [Kyle Huey (Exited; not receiving bugmail, old account, do not use)](/user_profile?user_id=336670) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=679494#a507578_336670)• 13 years ago |

[Attachment #554905](/attachment.cgi?id=554905&action=edit "Bug 679494 - UUID rev followup. v1") -
Flags: review?(khuey) → review+

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=679494#c18)• 13 years ago |
|  | |

Landed on mozilla-inbound:
<http://hg.mozilla.org/integration/mozilla-inbound/rev/98725bc76d7e>

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=679494#a512796_313730)• 13 years ago |

Whiteboard: [inbound]

|  | [Mounir Lamouri (:mounir)](/user_profile?user_id=342786) |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=679494#c19)• 13 years ago |
|  | |

<http://hg.mozilla.org/mozilla-central/rev/98725bc76d7e>Status: REOPENED → RESOLVEDClosed: 13 years ago → 13 years agoResolution: --- → FIXEDWhiteboard: [inbound]

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=679494#a3806651_313730)• 13 years ago |

[Attachment #554167](/attachment.cgi?id=554167&action=edit "Bug 679494 - Wrap value returned from nsDOMMessageEvent::GetData. v1") -
Flags: approval-mozilla-beta?

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=679494#a3806657_313730)• 13 years ago |

[Attachment #554905](/attachment.cgi?id=554905&action=edit "Bug 679494 - UUID rev followup. v1") -
Flags: approval-mozilla-beta?

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=679494#a3806666_313730)• 13 years ago |

[Attachment #554195](/attachment.cgi?id=554195&action=edit "Bug 679494 - Tests v2") -
Flags: approval-mozilla-beta?

|  | [LegNeato](/user_profile?user_id=482154) |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=679494#c21)• 13 years ago |
|  | |

Why was this nominated for beta? What is the risk vs reward? We're heavily leaning against taking this due to the uuid change.

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=679494#c22)• 13 years ago |
|  | |

Comment on [attachment 554905](/attachment.cgi?id=554905 "Bug 679494 - UUID rev followup. v1") [[details]](/attachment.cgi?id=554905&action=edit "Bug 679494 - UUID rev followup. v1") [[diff]](/attachment.cgi?id=554905&action=diff "Bug 679494 - UUID rev followup. v1") [[review]](/page.cgi?id=splinter.html&ignore=&bug=679494&attachment=554905)
[Bug 679494](/show_bug.cgi?id=679494 "RESOLVED FIXED - \"compartment mismatched\" when listening message event") - UUID rev followup. v1
We're going to wait another 6 weeks and get this in Firefox 9 since this is already in aurora (and the reasons that made me ask bholley to request approval here have since been invalidated, or at least lowered in weight).
[Attachment #554905](/attachment.cgi?id=554905&action=edit "Bug 679494 - UUID rev followup. v1") -
Flags: approval-mozilla-beta? → approval-mozilla-beta-

|  | [LegNeato](/user_profile?user_id=482154) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=679494#a5427936_482154)• 13 years ago |

[Attachment #554195](/attachment.cgi?id=554195&action=edit "Bug 679494 - Tests v2") -
Flags: approval-mozilla-beta? → approval-mozilla-beta-

|  | [LegNeato](/user_profile?user_id=482154) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=679494#a5427966_482154)• 13 years ago |

[Attachment #554167](/attachment.cgi?id=554167&action=edit "Bug 679494 - Wrap value returned from nsDOMMessageEvent::GetData. v1") -
Flags: approval-mozilla-beta? → approval-mozilla-beta-

|  | [Biru [:poiru]](/user_profile?user_id=473193) |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=679494#c23)• 10 years ago |
|  | |

The test incorrectly referenced file\_679494.html instead of file\_bug679494.html, fixed in:
<https://hg.mozilla.org/integration/mozilla-inbound/rev/28a7a3744901>

|  | [Carsten Book [:Tomcat]](/user_profile?user_id=277293) |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=679494#c24)• 10 years ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/28a7a3744901>
You need to [log in](/show_bug.cgi?id=679494&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Bobby Holley (:bholley)](/user_profile?user_id=313730)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from bugzilla.mozilla.org_25cf6650_20250124_235742.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/679986)
* [XML](/show_bug.cgi?ctype=xml&id=679986)

Closed
[Bug 679986](/show_bug.cgi?id=679986)

Opened 13 years ago
Closed 13 years ago

# Assertion failure: limit >= start, at jsregexpinlines.h:274 or Crash [@ QuoteString]

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Assertion failure: limit >= start, at jsregexpinlines.h:274 or Crash [@ QuoteString]

## Categories

### (Core :: JavaScript Engine, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=JavaScript%20Engine#JavaScript%20Engine)

JavaScript Engine
▾

Core :: JavaScript Engine
The interpreter engine for the core JavaScript language, independent of the browser's object model. File ONLY core JavaScript language bugs in this category. For bugs involving browser objects such as "window" and "document", use the "DOM" component. For bugs involving calls between JavaScript and C++, use the "XPConnect" component.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=JavaScript%20Engine&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=JavaScript%20Engine&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=JavaScript%20Engine)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

x86

Linux

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

critical

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla9

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Webcompat Priority | --- |
| --- | --- |
| Performance Impact | --- |
| Accessibility Severity | --- |
| Webcompat Score | --- |
| a11y-review | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox5 | [-](/buglist.cgi?f1=cf_tracking_firefox5&o1=equals&v1=-) | [unaffected](/buglist.cgi?f1=cf_status_firefox5&o1=equals&v1=unaffected) |
| firefox6 | [-](/buglist.cgi?f1=cf_tracking_firefox6&o1=equals&v1=-) | [unaffected](/buglist.cgi?f1=cf_status_firefox6&o1=equals&v1=unaffected) |
| firefox7 | [-](/buglist.cgi?f1=cf_tracking_firefox7&o1=equals&v1=-) | [wontfix](/buglist.cgi?f1=cf_status_firefox7&o1=equals&v1=wontfix) |
| firefox8 | [+](/buglist.cgi?f1=cf_tracking_firefox8&o1=equals&v1=%2B) | [affected](/buglist.cgi?f1=cf_status_firefox8&o1=equals&v1=affected) |
| firefox9 | [+](/buglist.cgi?f1=cf_tracking_firefox9&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=fixed) |
| firefox10 | --- | [fixed](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=fixed) |
| status1.9.2 | --- | [unaffected](/buglist.cgi?f1=cf_status_192&o1=equals&v1=unaffected) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox5 | - | unaffected |
| firefox6 | - | unaffected |
| firefox7 | - | wontfix |
| firefox8 | + | affected |
| firefox9 | + | fixed |
| firefox10 |  | fixed |
| status1.9.2 |  | unaffected |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: decoder, Assigned: dmandelin)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/a86fae4b06c1570a6c1a1bc1c5a6c1f6?d=mm&size=40)  [dmandelin](/user_profile?user_id=294323)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/b29b83d12aba827b8ff68296e473bec5?d=mm&size=40)  [decoder](/user_profile?user_id=395101)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/4fe52ee1503aecf7b6c976b8eb7c1753?d=mm&size=40)  [willyelm](/user_profile?user_id=714609)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

10 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[625600](/show_bug.cgi?id=625600 "RESOLVED FIXED - Update Yarr import")

Dependency [tree](/showdependencytree.cgi?id=679986&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=679986)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[Duplicates:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#duplicates)

[685477](/show_bug.cgi?id=685477 "RESOLVED DUPLICATE - Crash [@JSC::Yarr::YarrCodeBlock::execute] and Assertion failure: limit >= start, at jsregexpinlines.h:274"), [687302](/show_bug.cgi?id=687302 "RESOLVED DUPLICATE - Assertion failure: limit >= start, at jsregexpinlines.h:274")

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

[bugs.webkit.org/show\_bug.cgi?id=67752](https://bugs.webkit.org/show_bug.cgi?id=67752 "https://bugs.webkit.org/show_bug.cgi?id=67752")

## Details

### (4 keywords, Whiteboard: [sg:high][qa-] js-triage-done wanted-standalone-js)

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[assertion](/buglist.cgi?keywords=assertion&resolution=---),
[crash](/buglist.cgi?keywords=crash&resolution=---),
[regression](/buglist.cgi?keywords=regression&resolution=---),
[testcase](/buglist.cgi?keywords=testcase&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[sg:high][qa-] js-triage-done wanted-standalone-js

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [decoder](/user_profile?user_id=395101) | [in-testsuite](#c25 "12 years ago") | + |
| --- | --- | --- |
| [decoder](/user_profile?user_id=395101) | in-testsuite | + |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | qe-verify |  |

## Crash Data

Signature:

[[@ QuoteString ]](https://crash-stats.mozilla.org/signature/?signature=QuoteString)

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (2 files, 1 obsolete file)

| [Patch](/attachment.cgi?id=568835)  [13 years ago](#c10)  [David Mandelin [:dmandelin]](/user_profile?user_id=294323)   1.80 KB, patch | cdleary : [review+](#c12 "13 years ago") | [Details](/attachment.cgi?id=568835&action=edit) | [Diff](/attachment.cgi?id=568835&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=679986&attachment=568835) |
| --- | --- | --- |
| [Deoptimization patch](/attachment.cgi?id=569733)  [13 years ago](#c13)  [David Mandelin [:dmandelin]](/user_profile?user_id=294323)   1.80 KB, patch | cdleary : [review+](#c16 "13 years ago") | [Details](/attachment.cgi?id=569733&action=edit) | [Diff](/attachment.cgi?id=569733&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=679986&attachment=569733) |
| [Deoptimization patch, fixed tabs](/attachment.cgi?id=570878)  [13 years ago](#c17)  [David Mandelin [:dmandelin]](/user_profile?user_id=294323)   1.98 KB, patch |  | [Details](/attachment.cgi?id=570878&action=edit) | [Diff](/attachment.cgi?id=570878&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=679986&attachment=570878) |

Show Obsolete

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=679986#c0)• 13 years ago |
|  | |

The following test asserts on mozilla-central (tested revision 7054f0e3e70e) when run with options "-j -m". Stepping through violates several more asserts and then crashes, the optimized build also crashes. I also verified this crash with Firefox 7.0a2 (see [bp-7c8779d1-ac27-4f72-ae94-71a762110817](https://crash-stats.mozilla.org/report/index/7c8779d1-ac27-4f72-ae94-71a762110817)). Test was produced by Jesse's RegExp fuzzer:
function testRegexp(res, mode, strings) {
try {
re = new RegExp(res, mode);
for (var i = 0; i < strings.length; ++i) {
var str = strings[i];
var execResult = re.exec(str);
uneval(execResult);
}
} catch(e) {
}
}
testRegexp("(?:\\3{0}|\\2\\1)+", "i", ["", "", "\x7F\x7F", "", "", "", "", "mmmm\_mmmm\_", "", ""]);
The nature of the crash and the assert make me believe that this is exploitable with high probability. Backtrace:
==29756== Invalid read of size 2
==29756== at 0x4B8270: QuoteString(js::Sprinter\*, JSString\*, unsigned int) (jsopcode.cpp:780)
==29756== by 0x4B85BB: js\_QuoteString (jsopcode.cpp:844)
==29756== by 0x520D46: js\_ValueToSource(JSContext\*, js::Value const&) (jsstr.cpp:3489)
==29756== by 0x42B187: array\_toSource(JSContext\*, unsigned int, js::Value\*) (jsarray.cpp:1196)
==29756== by 0x486659: js::Invoke(JSContext\*, js::CallArgs const&, js::MaybeConstruct) (jscntxtinlines.h:281)
==29756== by 0x486C78: js::ExternalInvoke(JSContext\*, js::Value const&, js::Value const&, unsigned int, js::Value\*, js::Value\*) (jsinterp.h:169)
==29756== by 0x520DE4: js\_ValueToSource(JSContext\*, js::Value const&) (jsstr.cpp:3507)
==29756== by 0x520E2B: str\_uneval(JSContext\*, unsigned int, js::Value\*) (jsstr.cpp:308)
==29756== by 0x486659: js::Invoke(JSContext\*, js::CallArgs const&, js::MaybeConstruct) (jscntxtinlines.h:281)
==29756== by 0x682099: js::Interpret(JSContext\*, js::StackFrame\*, js::InterpMode) (jsinterp.cpp:4016)
==29756== by 0x487103: js::ExternalExecute(JSContext\*, JSScript\*, JSObject&, js::Value\*) (jsinterp.cpp:912)
==29756== by 0x4152B7: JS\_ExecuteScript (jsapi.cpp:4926)
==29756== Address 0x4200000 is not stack'd, malloc'd or (recently) free'd

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=679986#c1)• 13 years ago |
|  | |

autoBisect shows this is probably related to the following changeset:
The first bad revision is:
changeset: 70607:cc36a234d0d6
user: David Mandelin
date: Thu May 12 18:39:47 2011 -0700
summary: [Bug 625600](/show_bug.cgi?id=625600 "RESOLVED FIXED - Update Yarr import"): Update Yarr import to WebKit rev 86639, r=cdleary,dvander

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=679986#a56448_12352)• 13 years ago |

[status-firefox5](/buglist.cgi?f1=cf_status_firefox5&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_firefox5&o1=equals&v1=unaffected)
[status-firefox6](/buglist.cgi?f1=cf_status_firefox6&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_firefox6&o1=equals&v1=unaffected)
[status-firefox7](/buglist.cgi?f1=cf_status_firefox7&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox7&o1=equals&v1=affected)
[status-firefox8](/buglist.cgi?f1=cf_status_firefox8&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox8&o1=equals&v1=affected)
[status-firefox9](/buglist.cgi?f1=cf_status_firefox9&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=affected)
[tracking-firefox5](/buglist.cgi?f1=cf_tracking_firefox5&o1=isnotempty):
--- → [-](/buglist.cgi?f1=cf_tracking_firefox5&o1=equals&v1=-)
[tracking-firefox6](/buglist.cgi?f1=cf_tracking_firefox6&o1=isnotempty):
--- → [-](/buglist.cgi?f1=cf_tracking_firefox6&o1=equals&v1=-)
[tracking-firefox7](/buglist.cgi?f1=cf_tracking_firefox7&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox7&o1=equals&v1=%2B)
[tracking-firefox8](/buglist.cgi?f1=cf_tracking_firefox8&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox8&o1=equals&v1=%2B)
[tracking-firefox9](/buglist.cgi?f1=cf_tracking_firefox9&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox9&o1=equals&v1=%2B)

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=679986#a56477_12352)• 13 years ago |

Blocks: [625600](/show_bug.cgi?id=625600 "RESOLVED FIXED - Update Yarr import")Keywords: [regression](/buglist.cgi?keywords=regression&resolution=---)

|  | [Chris Leary [:cdleary] (not checking bugmail)](/user_profile?user_id=374575) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=679986#a412040_374575)• 13 years ago |

Assignee: general → cdleary

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=679986#c2)• 13 years ago |
|  | |

The following test was found by LangFuzz with the regular expression extension:
re = new RegExp("(((..).)|(.))+?a[b-m]|\(\1\)\*\(x\)" , "i");
re.exec("aaaaaaceax");
It looks different but the assertion is the same and the bisect points to the same changeset (though that changeset probably includes lots of changes). It does not crash though. If this is a different bug, please let me know and I'll file it separately.

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=679986#c3)• 13 years ago |
|  | |

Chris, any updates here? Seems it's too late to take this for 7, unless this is a trivial fix we can do in the next couple of days or so...
[status-firefox7](/buglist.cgi?f1=cf_status_firefox7&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox7&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox7&o1=equals&v1=wontfix)
[tracking-firefox7](/buglist.cgi?f1=cf_tracking_firefox7&o1=isnotempty):
[+](/buglist.cgi?f1=cf_tracking_firefox7&o1=equals&v1=%2B) → [-](/buglist.cgi?f1=cf_tracking_firefox7&o1=equals&v1=-)

|  | [Brandon Sterne (:bsterne)](/user_profile?user_id=296777) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=679986#c4)• 13 years ago |
|  | |

Our opinion is that this bug should be easily discoverable by anyone with a RegExp fuzzer, so we need to prioritize fixing this bug ASAP.

|  | [David Mandelin [:dmandelin]](/user_profile?user_id=294323)  Assignee |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=679986#c5)• 13 years ago |
|  | |

Filed <https://bugs.webkit.org/show_bug.cgi?id=67752>

|  | [David Mandelin [:dmandelin]](/user_profile?user_id=294323)  Assignee |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=679986#c6)• 13 years ago |
|  | |

This asserts because Yarr::execute returns 0 (indicating a match) but the |output| buffer has invalid data. The first pair is (0, -2), which is supposed to be (start, end), so clearly that's not right.
I noticed that the test regexp has backreferences, but no capturing parens, so that might be the source of the problem. The spec seems to say that's "an error", but both Chrome and IE run this without throwing. It looks like V8 converts any backreference to a capturing group that hasn't been seen yet into an empty pattern. Yarr seems to convert those to a ForwardReference, which then has empty cases later, presumably to get the same effect.
When I debug through YarrJIT, I see that it's compiling "TypePatternCharacter" terms where I would expect to see the ForwardReferences. Very strange. Just before the return, the generated code has "sub edx, 2", presumably to bump the pointer back after it was bumped forward to try to match the putative length-2 subpattern. That's where the -2 comes from in |output|.

|  | [David Mandelin [:dmandelin]](/user_profile?user_id=294323)  Assignee |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=679986#c7)• 13 years ago |
|  | |

(In reply to Christian Holler (:decoder) from [comment #2](/show_bug.cgi?id=679986#c2 "VERIFIED FIXED - Assertion failure: limit >= start, at jsregexpinlines.h:274 or Crash [@ QuoteString]"))
> The following test was found by LangFuzz with the regular expression
> extension:
>
> re = new RegExp("(((..).)|(.))+?a[b-m]|\(\1\)\*\(x\)" , "i");
> re.exec("aaaaaaceax");
>
> It looks different but the assertion is the same and the bisect points to
> the same changeset (though that changeset probably includes lots of
> changes). It does not crash though. If this is a different bug, please let
> me know and I'll file it separately.
Please file separately, I think it's a different bug.

|  | [Wesley W. Garland](/user_profile?user_id=122472) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=679986#a3315049_122472)• 13 years ago |

Whiteboard: [sg:critical?] js-triage-needed → [sg:critical?] js-triage-needed wanted-standalone-js

|  | [Chris Leary [:cdleary] (not checking bugmail)](/user_profile?user_id=374575) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=679986#c8)• 13 years ago |
|  | |

(In reply to David Mandelin from [comment #6](/show_bug.cgi?id=679986#c6 "VERIFIED FIXED - Assertion failure: limit >= start, at jsregexpinlines.h:274 or Crash [@ QuoteString]"))
I'm pretty sure that we have a non-standard extension to change \5 into the literal character 5 whenever 5 (or any other single digit character) > the number of capturing groups. We really should start documenting these things (I should have done it when I was encountering all this junk in the YARR port).

|  | [David Mandelin [:dmandelin]](/user_profile?user_id=294323)  Assignee |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=679986#c9)• 13 years ago |
|  | |

Here is a reduced test case:
"".match(/(?:|a)+/);
Note that it doesn't have any backrefs. Chris is right: invalid backrefs get converted to octal escapes in Yarr as well: this was intentional behavior to match Firefox. It appears the key is to have an empty first alternative inside a quantified group, which I think Christian pointed out somewhere. Some of the other Yarr bugs are probably also of this type. Continuing to investigate.Assignee: cdleary → dmandelin

|  | [David Mandelin [:dmandelin]](/user_profile?user_id=294323)  Assignee |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=679986#c10)• 13 years ago |
|  | |

Attached patch

[Patch](attachment.cgi?id=568835&action=diff) (obsolete)
— [Details](attachment.cgi?id=568835&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=679986&attachment=568835)

I'm going to ask about this patch in the WebKit bug. It fixes the assert and passes all of our tests.
[Attachment #568835](/attachment.cgi?id=568835&action=edit "Patch") -
Flags: review?(cdleary)

|  | [David Mandelin [:dmandelin]](/user_profile?user_id=294323)  Assignee |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=679986#c11)• 13 years ago |
|  | |

See <https://bugs.webkit.org/show_bug.cgi?id=67752#c5> and also [comment 6](/show_bug.cgi?id=679986#c6 "VERIFIED FIXED - Assertion failure: limit >= start, at jsregexpinlines.h:274 or Crash [@ QuoteString]") for a detailed explanation of the problem and the patch I just posted.

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=679986#a5610078_1689)• 13 years ago |

[status1.9.2](/buglist.cgi?f1=cf_status_192&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_192&o1=equals&v1=unaffected)See Also: → <https://bugs.webkit.org/show_bug.cgi?id=67752>

|  | [Chris Leary [:cdleary] (not checking bugmail)](/user_profile?user_id=374575) |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=679986#c12)• 13 years ago |
|  | |

Comment on [attachment 568835](/attachment.cgi?id=568835 "Patch") [[details]](/attachment.cgi?id=568835&action=edit "Patch") [[diff]](/attachment.cgi?id=568835&action=diff "Patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=679986&attachment=568835)
Patch
Review of [attachment 568835](/attachment.cgi?id=568835 "Patch") [[details]](/attachment.cgi?id=568835&action=edit "Patch") [[diff]](/attachment.cgi?id=568835&action=diff "Patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=679986&attachment=568835):
-----------------------------------------------------------------
Can we add the /(?:a|aa)\*/ test that I believe we said suffers from the same problem?
[Attachment #568835](/attachment.cgi?id=568835&action=edit "Patch") -
Flags: review?(cdleary) → review+

|  | [David Mandelin [:dmandelin]](/user_profile?user_id=294323)  Assignee |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=679986#c13)• 13 years ago |
|  | |

Attached patch

[Deoptimization patch](attachment.cgi?id=569733&action=diff)
— [Details](attachment.cgi?id=569733&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=679986&attachment=569733)

The previous patch is incorrect--it doesn't handle these test cases correctly. I decided that it's going to be easiest to fix this in the short term by turning off the optimization in the cases in which it's unsafe. Chris and I talked about what's going on already, and a summary is given in the comment in the patch.
[Attachment #568835](/attachment.cgi?id=568835&action=edit "Patch") -
Attachment is obsolete: true
[Attachment #569733](/attachment.cgi?id=569733&action=edit "Deoptimization patch") -
Flags: review?(cdleary)

|  | [Chris Leary [:cdleary] (not checking bugmail)](/user_profile?user_id=374575) |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=679986#c16)• 13 years ago |
|  | |

Comment on [attachment 569733](/attachment.cgi?id=569733 "Deoptimization patch") [[details]](/attachment.cgi?id=569733&action=edit "Deoptimization patch") [[diff]](/attachment.cgi?id=569733&action=diff "Deoptimization patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=679986&attachment=569733)
Deoptimization patch
Review of [attachment 569733](/attachment.cgi?id=569733 "Deoptimization patch") [[details]](/attachment.cgi?id=569733&action=edit "Deoptimization patch") [[diff]](/attachment.cgi?id=569733&action=diff "Deoptimization patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=679986&attachment=569733):
-----------------------------------------------------------------
Looks like some hard tabs accidentally snuck in there.
[Attachment #569733](/attachment.cgi?id=569733&action=edit "Deoptimization patch") -
Flags: review?(cdleary) → review+

|  | [David Mandelin [:dmandelin]](/user_profile?user_id=294323)  Assignee |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=679986#c17)• 13 years ago |
|  | |

Attached patch

[Deoptimization patch, fixed tabs](attachment.cgi?id=570878&action=diff)
— [Details](attachment.cgi?id=570878&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=679986&attachment=570878)

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=679986#c18)• 13 years ago |
|  | |

After closer inspection, this seems to be sg:high (it looks like an invalid read due to an integer overflow, but the read is not influencing control flow but rather the memory areas read are processed as data and might be leaked at some point). If this is wrong, feel free to correct my rating.Whiteboard: [sg:critical?] js-triage-needed wanted-standalone-js → [sg:high] js-triage-needed wanted-standalone-js

|  | [David Mandelin [:dmandelin]](/user_profile?user_id=294323)  Assignee |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=679986#c19)• 13 years ago |
|  | |

I told WebKit we would land this Monday, Nov 7 unless they tell us otherwise. I'll be traveling, so cdleary will coordinate the landing.

|  | [Chris Leary [:cdleary] (not checking bugmail)](/user_profile?user_id=374575) |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=679986#c20)• 13 years ago |
|  | |

So I landed this on inbound and aurora. From the bug, I'm not clear about our intent to land this in mozilla-beta. My guess would be yes from the bug history, but after the downgrade to sg:high I'm not totally clear. jst, any guidance there? (Sorry, should have clarified this with dmandelin before he took off.)

|  | [Chris Leary [:cdleary] (not checking bugmail)](/user_profile?user_id=374575) |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=679986#c21)• 13 years ago |
|  | |

<https://hg.mozilla.org/integration/mozilla-inbound/rev/ad6b14835247>
<http://hg.mozilla.org/releases/mozilla-aurora/rev/a78bbe2376be>
Holding off on FF8...Target Milestone: --- → mozilla9

|  | [Justin Wood (:Callek)](/user_profile?user_id=129968) |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=679986#c22)• 13 years ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/ad6b14835247> for gecko 10
(In reply to Chris Leary [:cdleary] from [comment #21](/show_bug.cgi?id=679986#c21 "VERIFIED FIXED - Assertion failure: limit >= start, at jsregexpinlines.h:274 or Crash [@ QuoteString]"))
> Holding off on FF8...
Which is shipping tomorrow, so unless there is a chemspill won't be in there
Also chris, it doesn't \*look\* like this bug had an aurora approval either (sec bugs, afaik still need approvals)Status: NEW → RESOLVEDClosed: 13 years ago
[status-firefox10](/buglist.cgi?f1=cf_status_firefox10&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=fixed)
[status-firefox9](/buglist.cgi?f1=cf_status_firefox9&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=fixed)Resolution: --- → FIXED

|  | [u279076](/user_profile?user_id=279076) |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=679986#c23)• 13 years ago |
|  | |

Is there something QA can do to verify this fix?Whiteboard: [sg:high] js-triage-needed wanted-standalone-js → [sg:high][qa?] js-triage-needed wanted-standalone-js

|  | [David Mandelin [:dmandelin]](/user_profile?user_id=294323)  Assignee |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=679986#c24)• 13 years ago |
|  | |

(In reply to Anthony Hughes, Mozilla QA (irc: ashughes) from [comment #23](/show_bug.cgi?id=679986#c23 "VERIFIED FIXED - Assertion failure: limit >= start, at jsregexpinlines.h:274 or Crash [@ QuoteString]"))
> Is there something QA can do to verify this fix?
No, the test cases we added should be enough.

|  | [u279076](/user_profile?user_id=279076) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=679986#a8285191_279076)• 13 years ago |

Whiteboard: [sg:high][qa?] js-triage-needed wanted-standalone-js → [sg:high][qa-] js-triage-needed wanted-standalone-js

|  | [Chris Leary [:cdleary] (not checking bugmail)](/user_profile?user_id=374575) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=679986#a8341210_374575)• 13 years ago |

Whiteboard: [sg:high][qa-] js-triage-needed wanted-standalone-js → [sg:high][qa-] js-triage-done wanted-standalone-js

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=679986#a15788148_1689)• 13 years ago |

Group: core-security

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=679986#a18901770_395101)• 13 years ago |

Status: RESOLVED → VERIFIED

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=679986#c25)• 12 years ago |
|  | |

A testcase for this bug was automatically identified at js/src/jit-test/tests/basic/[bug679986](/show_bug.cgi?id=679986 "VERIFIED FIXED - Assertion failure: limit >= start, at jsregexpinlines.h:274 or Crash [@ QuoteString]")-2.js.Flags: in-testsuite+
You need to [log in](/show_bug.cgi?id=679986&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [David Mandelin [:dmandelin]](/user_profile?user_id=294323)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from bugzilla.mozilla.org_d9af15e6_20250124_235753.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/686107)
* [XML](/show_bug.cgi?ctype=xml&id=686107)

Closed
[Bug 686107](/show_bug.cgi?id=686107)

Opened 13 years ago
Closed 13 years ago

# Crash [@ JSC::MacroAssemblerCodePtr::executableAddress()]

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Crash [@ JSC::MacroAssemblerCodePtr::executableAddress()]

## Categories

### (Core :: JavaScript Engine, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=JavaScript%20Engine#JavaScript%20Engine)

JavaScript Engine
▾

Core :: JavaScript Engine
The interpreter engine for the core JavaScript language, independent of the browser's object model. File ONLY core JavaScript language bugs in this category. For bugs involving browser objects such as "window" and "document", use the "DOM" component. For bugs involving calls between JavaScript and C++, use the "XPConnect" component.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=JavaScript%20Engine&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=JavaScript%20Engine&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=JavaScript%20Engine)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

x86\_64

Linux

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

critical

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla9

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Accessibility Severity | --- |
| --- | --- |
| a11y-review | --- |
| Webcompat Score | --- |
| Performance Impact | --- |
| Webcompat Priority | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox9 | [+](/buglist.cgi?f1=cf_tracking_firefox9&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=fixed) |
| firefox10 | [+](/buglist.cgi?f1=cf_tracking_firefox10&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=fixed) |
| status1.9.2 | --- | [unaffected](/buglist.cgi?f1=cf_status_192&o1=equals&v1=unaffected) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox9 | + | fixed |
| firefox10 | + | fixed |
| status1.9.2 |  | unaffected |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: decoder, Assigned: bhackett1024)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/764aa0af2fda6f02fb17dc9771bb18d9?d=mm&size=40)  [bhackett1024](/user_profile?user_id=346231)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/b29b83d12aba827b8ff68296e473bec5?d=mm&size=40)  [decoder](/user_profile?user_id=395101)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/4fe52ee1503aecf7b6c976b8eb7c1753?d=mm&size=40)  [willyelm](/user_profile?user_id=714609)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

7 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[Duplicates:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#duplicates)

[692065](/show_bug.cgi?id=692065 "RESOLVED DUPLICATE - Use after free in JS methodjit IC structure with possible crash [@ js::mjit::ic::BaseIC::disable]")

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: crash, regression, testcase, Whiteboard: [sg:critical?][qa-])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[crash](/buglist.cgi?keywords=crash&resolution=---),
[regression](/buglist.cgi?keywords=regression&resolution=---),
[testcase](/buglist.cgi?keywords=testcase&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[sg:critical?][qa-]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [decoder](/user_profile?user_id=395101) | [in-testsuite](#c15 "12 years ago") | + |
| --- | --- | --- |
| [decoder](/user_profile?user_id=395101) | in-testsuite | + |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | qe-verify |  |

## Crash Data

Signature:

[[@ JSC::MacroAssemblerCodePtr::executableAddress() ]](https://crash-stats.mozilla.org/signature/?signature=JSC%3A%3AMacroAssemblerCodePtr%3A%3AexecutableAddress%28%29)

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (1 file)

| [patch](/attachment.cgi?id=564846)  [13 years ago](#c4)  [Brian Hackett [Laid off!]](/user_profile?user_id=346231)   658 bytes, patch | dvander : [review+](#a2187706_309316 "13 years ago")  asa : [approval-mozilla-aurora+](#a2719280_5003 "13 years ago") | [Details](/attachment.cgi?id=564846&action=edit) | [Diff](/attachment.cgi?id=564846&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=686107&attachment=564846) |
| --- | --- | --- |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=686107#c0)• 13 years ago |
|  | |

The following test crashes on mozilla-central revision d078623f7875 (options -m -n -a), tested on 64 bit:
function testKeyTransitions() {
var i, key, result, message;
var array = [];
for (i = 0; i != 10; i++) {
key = (i < 3) ? 'pop' : (/\u009e\u0029/g );
array[key](i);
}
}
testKeyTransitions();
Looks like a null-pointer deref, but s-s to be sure:
==39098== Invalid read of size 8
==39098== at 0x4423CC: JSC::MacroAssemblerCodePtr::executableAddress() const (MacroAssemblerCodeRef.h:150)
==39098== by 0x76FAF1: JSC::RepatchBuffer::RepatchBuffer(JSC::MacroAssemblerCodeRef const&) (RepatchBuffer.h:54)
==39098== by 0x76FBD6: js::mjit::ic::Repatcher::Repatcher(js::mjit::JITScript\*) (ICRepatcher.h:64)
==39098== by 0x77806C: js::mjit::ic::BaseIC::disable(JSContext\*, char const\*, void\*) (PolyIC.cpp:2233)
==39098== by 0x77830A: js::mjit::ic::GetElementIC::disable(JSContext\*, char const\*) (PolyIC.cpp:2290)
==39098== by 0x77AF86: js::mjit::ic::GetElementIC::update(js::VMFrame&, JSContext\*, JSObject\*, js::Value const&, jsid, js::Value\*) (PolyIC.cpp:2757)
==39098== by 0x77B131: js::mjit::ic::CallElement(js::VMFrame&, js::mjit::ic::GetElementIC\*) (PolyIC.cpp:2788)
==39098== by 0x6DF341: ??? (MethodJIT.cpp:153)
==39098== by 0x6DF5DB: js::mjit::EnterMethodJIT(JSContext\*, js::StackFrame\*, void\*, js::Value\*, bool) (MethodJIT.cpp:884)
==39098== by 0x6DF800: CheckStackAndEnterMethodJIT(JSContext\*, js::StackFrame\*, void\*, bool) (MethodJIT.cpp:945)
==39098== by 0x6DF950: js::mjit::JaegerShotAtSafePoint(JSContext\*, void\*, bool) (MethodJIT.cpp:972)
==39098== by 0x502554: js::Interpret(JSContext\*, js::StackFrame\*, js::InterpMode) (jsinterp.cpp:2206)
==39098== Address 0x0 is not stack'd, malloc'd or (recently) free'd

|  | [David Mandelin [:dmandelin]](/user_profile?user_id=294323) |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=686107#c1)• 13 years ago |
|  | |

Brian, can you take a look at this to see if it's a vulnerability?

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=686107#c2)• 13 years ago |
|  | |

Here's a bisect for the regressing changeset (possibly inaccurate):
The first bad revision is:
changeset: 76087:d763fda00eb9
user: Brian Hackett
date: Mon Aug 01 09:09:39 2011 -0700
summary: [INFER] Only allow expansion of all inline frames in a compartment, [bug 675251](/show_bug.cgi?id=675251 "RESOLVED FIXED - TI: Assertion failure: (uint8*)ic.funGuard.executableAddress() + ic.joinPointOffset == returnAddress, at methodjit/MethodJIT.cpp:1264").
However, this test no longer reproduces on mozilla-central tip. Here's a bisect for a possible fix:
The first good revision is:
changeset: 77145:b961a248e94d
user: Brian Hackett
date: Sat Sep 17 19:31:33 2011 -0700
summary: [INFER] Reapply f1c585415dd4 7c89b0ff453d 19794de530f1 ([bug 686000](/show_bug.cgi?id=686000 "RESOLVED FIXED - JM+TI: faster property access stubcalls")).
Not sure if this is really fixed though, could also be that the second changeset just breaks the test. I guess Brian can figure that out :)
I also tested the latest aurora JS shell and cannot reproduce there.

|  | [Brian Hackett [Laid off!]](/user_profile?user_id=346231)  Assignee |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=686107#c4)• 13 years ago |
|  | |

Attached patch

[patch](attachment.cgi?id=564846&action=diff)
— [Details](attachment.cgi?id=564846&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=686107&attachment=564846)

Sorry, missed this bug when it was first filed.
Recompilation bug under ic::CallElement, if js\_InternNonIntElementId triggers recompilation then we would still try to disable the IC afterwards. ic::GetElement already does the right thing, I don't know why I didn't fix this when I fixed that one.Assignee: general → bhackett1024
[Attachment #564846](/attachment.cgi?id=564846&action=edit "patch") -
Flags: review?(dvander)

|  | [Brian Hackett [Laid off!]](/user_profile?user_id=346231)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=686107#a2176065_346231)• 13 years ago |

Whiteboard: js-triage-needed

|  | [David Anderson [:dvander] - inactive, e-mail if emergency](/user_profile?user_id=309316) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=686107#a2187706_309316)• 13 years ago |

[Attachment #564846](/attachment.cgi?id=564846&action=edit "patch") -
Flags: review?(dvander) → review+

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=686107#c5)• 13 years ago |
|  | |

I made this sg:critical? because [bug 692065](/show_bug.cgi?id=692065 "RESOLVED DUPLICATE - Use after free in JS methodjit IC structure with possible crash [@ js::mjit::ic::BaseIC::disable]") is a duplicate of this and shows use-after-free with invalid reads/writes so this could be exploitable.Whiteboard: [sg:critical?]

|  | [Brian Hackett [Laid off!]](/user_profile?user_id=346231)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=686107#a2348717_346231)• 13 years ago |

[Attachment #564846](/attachment.cgi?id=564846&action=edit "patch") -
Flags: approval-mozilla-aurora?

|  | [Brian Hackett [Laid off!]](/user_profile?user_id=346231)  Assignee |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=686107#c6)• 13 years ago |
|  | |

<https://hg.mozilla.org/integration/mozilla-inbound/rev/7277c1bddd22>

|  | [Asa Dotzler [:asa]](/user_profile?user_id=5003) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=686107#a2719280_5003)• 13 years ago |

[Attachment #564846](/attachment.cgi?id=564846&action=edit "patch") -
Flags: approval-mozilla-aurora? → approval-mozilla-aurora+

|  | [Asa Dotzler [:asa]](/user_profile?user_id=5003) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=686107#c7)• 13 years ago |
|  | |

Trigger happy. I approved this and it hasn't hit m-c yet. Please hold off on landing this until it's made a cycle or three on m-c with no fallout.

|  | [Brian Hackett [Laid off!]](/user_profile?user_id=346231)  Assignee |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=686107#c8)• 13 years ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/7277c1bddd22>Status: NEW → RESOLVEDClosed: 13 years agoResolution: --- → FIXED

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=686107#c9)• 13 years ago |
|  | |

I'm assuming this doesn't affect Firefox 8?
[status-firefox10](/buglist.cgi?f1=cf_status_firefox10&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=fixed)
[status-firefox9](/buglist.cgi?f1=cf_status_firefox9&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=affected)
[tracking-firefox10](/buglist.cgi?f1=cf_tracking_firefox10&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox10&o1=equals&v1=%2B)
[tracking-firefox9](/buglist.cgi?f1=cf_tracking_firefox9&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox9&o1=equals&v1=%2B)Keywords: [regression](/buglist.cgi?keywords=regression&resolution=---)Target Milestone: --- → mozilla10

|  | [Brian Hackett [Laid off!]](/user_profile?user_id=346231)  Assignee |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=686107#c10)• 13 years ago |
|  | |

(In reply to Daniel Veditz from [comment #9](/show_bug.cgi?id=686107#c9 "VERIFIED FIXED - Crash [@ JSC::MacroAssemblerCodePtr::executableAddress()]"))
> I'm assuming this doesn't affect Firefox 8?
No, this doesn't.

|  | [Brian Hackett [Laid off!]](/user_profile?user_id=346231)  Assignee |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=686107#c11)• 13 years ago |
|  | |

<https://hg.mozilla.org/releases/mozilla-aurora/rev/9c3b0542705c>
[status-firefox10](/buglist.cgi?f1=cf_status_firefox10&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=fixed) → ---
[status-firefox9](/buglist.cgi?f1=cf_status_firefox9&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=affected) → ---
[tracking-firefox10](/buglist.cgi?f1=cf_tracking_firefox10&o1=isnotempty):
[+](/buglist.cgi?f1=cf_tracking_firefox10&o1=equals&v1=%2B) → ---
[tracking-firefox9](/buglist.cgi?f1=cf_tracking_firefox9&o1=isnotempty):
[+](/buglist.cgi?f1=cf_tracking_firefox9&o1=equals&v1=%2B) → ---Target Milestone: mozilla10 → ---

|  | [Brian Hackett [Laid off!]](/user_profile?user_id=346231)  Assignee |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=686107#c12)• 13 years ago |
|  | |

Oops, not sure how I reset those bits.
[status-firefox10](/buglist.cgi?f1=cf_status_firefox10&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=fixed)
[status-firefox9](/buglist.cgi?f1=cf_status_firefox9&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=fixed)
[tracking-firefox10](/buglist.cgi?f1=cf_tracking_firefox10&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox10&o1=equals&v1=%3F)
[tracking-firefox9](/buglist.cgi?f1=cf_tracking_firefox9&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox9&o1=equals&v1=%3F)Target Milestone: --- → mozilla9

|  | [David Mandelin [:dmandelin]](/user_profile?user_id=294323) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=686107#a3424468_294323)• 13 years ago |

[tracking-firefox10](/buglist.cgi?f1=cf_tracking_firefox10&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox10&o1=equals&v1=%3F) → [+](/buglist.cgi?f1=cf_tracking_firefox10&o1=equals&v1=%2B)
[tracking-firefox9](/buglist.cgi?f1=cf_tracking_firefox9&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox9&o1=equals&v1=%3F) → [+](/buglist.cgi?f1=cf_tracking_firefox9&o1=equals&v1=%2B)

|  | [u279076](/user_profile?user_id=279076) |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=686107#c13)• 13 years ago |
|  | |

Christian, can you please verify if this is fixed?Whiteboard: [sg:critical?] → [sg:critical?][qa-]

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=686107#c14)• 13 years ago |
|  | |

Verified fixed on Firefox 9 and 10.

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=686107#a6349004_1689)• 13 years ago |

[status1.9.2](/buglist.cgi?f1=cf_status_192&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_192&o1=equals&v1=unaffected)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=686107#a13781201_1689)• 13 years ago |

Group: core-security

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=686107#a16894982_395101)• 13 years ago |

Status: RESOLVED → VERIFIED

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=686107#c15)• 12 years ago |
|  | |

Automatically extracted testcase for this bug was committed:
<https://hg.mozilla.org/mozilla-central/rev/efaf8960a929>Flags: in-testsuite+
You need to [log in](/show_bug.cgi?id=686107&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Brian Hackett [Laid off!]](/user_profile?user_id=346231)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from www.mozilla.org_7eff2388_20250124_235737.html ===


## Help us improve your Mozilla experience

In addition to Cookies necessary for this site to function, we’d like your permission to set some additional Cookies to better understand your browsing needs and improve your experience. Rest assured — we value your privacy.

Accept All Additional Cookies

Reject All Additional Cookies

[Cookie settings](/en-US/privacy/websites/cookie-settings/)

Menu
[![Mozilla](https://www.mozilla.org/media/img/logos/m24/lockup-black.f2ddba3f0724.svg)](/en-US/)

* [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
  Firefox browsers](/en-US/firefox/)
  Close Firefox browsers menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Desktop](/en-US/firefox/new/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for iOS](/en-US/firefox/browsers/mobile/ios/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Android](/en-US/firefox/browsers/mobile/android/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/focus/logo.aac3e33175cb.svg)
    ## Firefox Focus](/en-US/firefox/browsers/mobile/focus/)
  + [## Firefox blog](https://blog.mozilla.org/firefox/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=firefox)
* [Products](/en-US/products/)
  Close Products menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/mozilla/vpn/logo.c648f487bfb8.svg)
    ## Mozilla VPN](/en-US/products/vpn/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/monitor/logo.d97e5516f9e6.svg)
    ## Mozilla Monitor](https://monitor.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/relay/logo-white.d42a8b52e44c.svg)
    ## Firefox Relay](https://relay.firefox.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/pocket/logo.17446bc33a5d.svg)
    ## Pocket](https://getpocket.com/firefox_learnmore/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/nav/icons/icon-mdn-plus.f54475f980ab.svg)
    ## MDN Plus](https://developer.mozilla.org/plus?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/fakespot/logo-blue.3973b8fe9631.svg)
    ## Fakespot](https://fakespot.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/thunderbird/logo-thunderbird.121e9c0fed45.svg)
    ## Thunderbird](https://www.thunderbird.net/)

  [All products](/en-US/products/)
* [About us](/en-US/about/)
  Close About us menu

  Our Mission

  + [## About Mozilla](/en-US/about/)
  + [## The Mozilla Manifesto](/en-US/about/manifesto/)
  + [## Get Involved](/en-US/contribute/)
  + [## Innovation Projects](https://future.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Blog](https://blog.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)

  Our Work

  + [## Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla.ai](https://www.mozilla.ai/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Ventures](https://mozilla.vc/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Advertising](/en-US/advertising/)

## Menu

* Mozilla Security

## [Mozilla Security](/en-US/security/)

* [Advisories](/en-US/security/advisories/)
* [Known Vulnerabilities](/en-US/security/known-vulnerabilities/)
* [Mozilla Security Blog](https://blog.mozilla.com/security/)
* [Security Bug Bounty](/en-US/security/bug-bounty/)
* [Third-party Injection Policy](/en-US/security/third-party-software-injection/)

## [Client Bug Bounty](/en-US/security/client-bug-bounty/)

* [Frequently Asked Questions](/en-US/security/bug-bounty/faq/)
* [Hall of Fame](/en-US/security/bug-bounty/hall-of-fame/)

## [Web Bug Bounty](/en-US/security/web-bug-bounty/)

* [Eligible Websites](/en-US/security/bug-bounty/web-eligible-sites/)
* [Frequently Asked Questions](/en-US/security/bug-bounty/faq-webapp/)
* [Hall of Fame](/en-US/security/bug-bounty/web-hall-of-fame/)

# Mozilla Foundation Security Advisory 2011-53

## Miscellaneous memory safety hazards (rv:9.0)

Announced
December 20, 2011
Reporter
Mozilla developers and community
Impact
Critical
Products
Firefox, SeaMonkey, Thunderbird
Fixed in

* Firefox 9
* SeaMonkey 2.6
* Thunderbird 9

### Description

Mozilla developers identified and fixed several memory safety bugs
in the browser engine used in Firefox and other Mozilla-based
products. Some of these bugs showed evidence of memory corruption
under certain circumstances, and we presume that with enough effort at
least some of these could be exploited to run arbitrary code.

In general these flaws cannot be exploited through email in the Thunderbird
and SeaMonkey products because scripting is disabled, but are potentially a risk
in browser or browser-like contexts in those products.

These vulnerabilities did not affect the older browser engine used
prior to Firefox 4.

### References

Alexandre Poirot, Chris Blizzard, Kyle Huey, Scoobidiver, Christian Holler,
David Baron, Gary Kwong, Jim Blandy, Bob Clary, Jesse Ruderman, Marcia Knous,
and Rober Longson
reported memory safety problems that were fixed in Firefox 9.

* [Memory safety bugs fixed in Firefox 9](https://bugzilla.mozilla.org/buglist.cgi?bug_id=679494,688364,700512,693143,679986,682252,685321,686107,688974,689892,691746,693144,694200,701248,685186,690376,697255,691873,701637,706249,680687,562442,696579)
* [CVE-2011-3660](http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2011-3660)

## Company

* [Leadership](/about/leadership/)
* [Press Center](https://blog.mozilla.org/category/mozilla/news/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=company)
* [Careers](/en-US/careers/)
* [Contact](/en-US/contact/)

## Support

* [Product Help](https://support.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [File a Bug](https://bugzilla.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [Localize Mozilla](https://pontoon.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)

## Resources

* [Advertise with Mozilla](/en-US/advertising/)
* [Firefox Release Notes](/firefox/134.0.2/releasenotes/)

## Developers

* [Developer Edition](/en-US/firefox/developer/)
* [Enterprise](/en-US/firefox/enterprise/)
* [Tools](https://firefox-source-docs.mozilla.org/devtools-user/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=developers)
* [MDN](https://developer.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer)

## Follow @Mozilla

* [X (formerly Twitter) (@mozilla)](https://twitter.com/mozilla)
* [Instagram (@mozilla)](https://www.instagram.com/mozilla/)
* [LinkedIn (@mozilla)](https://www.linkedin.com/company/mozilla-corporation/)
* [TikTok (@mozilla)](https://www.tiktok.com/%40mozilla)
* [Spotify (@mozilla)](https://open.spotify.com/show/0vT7LJMeVDxyQ2ZamHKu08?si=_uDRD6bRR_6M5YZyISGXgA)

## Follow @Firefox

* [X (formerly Twitter) (@firefox)](https://twitter.com/firefox)
* [Instagram (@firefox)](https://www.instagram.com/firefox/)
* [YouTube (@firefoxchannel)](https://www.youtube.com/user/firefoxchannel)
* [TikTok (@firefox)](https://www.tiktok.com/%40firefox)

[Donate](https://foundation.mozilla.org/?form=moco-donate-footer)

Visit [Mozilla Corporation’s](/en-US/) not-for-profit parent, the [Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer).

Portions of this content are ©1998–2025 by individual mozilla.org contributors. Content available under a [Creative Commons license](/en-US/foundation/licensing/website-content/).

* [Website Privacy Notice](/en-US/privacy/websites/)
* [Cookies](/en-US/privacy/websites/cookie-settings/)
* [Legal](/en-US/about/legal/)
* [Community Participation Guidelines](/en-US/about/governance/policies/participation/)
* [About this site](/en-US/about/this-site/)

![](https://www.mozilla.org/media/img/logos/m24/wordmark-white.2d673bb5b33a.svg)



=== Content from bugzilla.mozilla.org_2bdcab40_20250124_235813.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/694200)
* [XML](/show_bug.cgi?ctype=xml&id=694200)

Closed
[Bug 694200](/show_bug.cgi?id=694200)

Opened 13 years ago
Closed 13 years ago

# Crash [@ js::mjit::ic::BaseIC::disable]

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Crash [@ js::mjit::ic::BaseIC::disable]

## Categories

### (Core :: JavaScript Engine, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=JavaScript%20Engine#JavaScript%20Engine)

JavaScript Engine
▾

Core :: JavaScript Engine
The interpreter engine for the core JavaScript language, independent of the browser's object model. File ONLY core JavaScript language bugs in this category. For bugs involving browser objects such as "window" and "document", use the "DOM" component. For bugs involving calls between JavaScript and C++, use the "XPConnect" component.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=JavaScript%20Engine&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=JavaScript%20Engine&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=JavaScript%20Engine)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

x86\_64

Linux

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

critical

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

---

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Webcompat Priority | --- |
| --- | --- |
| a11y-review | --- |
| Webcompat Score | --- |
| Performance Impact | --- |
| Accessibility Severity | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox8 | --- | [unaffected](/buglist.cgi?f1=cf_status_firefox8&o1=equals&v1=unaffected) |
| firefox9 | [+](/buglist.cgi?f1=cf_tracking_firefox9&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=fixed) |
| firefox10 | [+](/buglist.cgi?f1=cf_tracking_firefox10&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=fixed) |
| status1.9.2 | --- | [unaffected](/buglist.cgi?f1=cf_status_192&o1=equals&v1=unaffected) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox8 |  | unaffected |
| firefox9 | + | fixed |
| firefox10 | + | fixed |
| status1.9.2 |  | unaffected |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: decoder, Assigned: bhackett1024)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/764aa0af2fda6f02fb17dc9771bb18d9?d=mm&size=40)  [bhackett1024](/user_profile?user_id=346231)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/b29b83d12aba827b8ff68296e473bec5?d=mm&size=40)  [decoder](/user_profile?user_id=395101)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/4fe52ee1503aecf7b6c976b8eb7c1753?d=mm&size=40)  [willyelm](/user_profile?user_id=714609)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

11 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[Duplicates:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#duplicates)

[694872](/show_bug.cgi?id=694872 "RESOLVED DUPLICATE - Assertion failure: m_value and crash [@ JSC::MacroAssemblerCodePtr::dataLocation] due to invalid code pointer"), [695875](/show_bug.cgi?id=695875 "RESOLVED DUPLICATE - crash [@ js::mjit::ic::BaseIC::disable]")

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (4 keywords, Whiteboard: [sg:critical][qa-])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[crash](/buglist.cgi?keywords=crash&resolution=---),
[testcase](/buglist.cgi?keywords=testcase&resolution=---),
[verified-aurora](/buglist.cgi?keywords=verified-aurora&resolution=---),
[verified-beta](/buglist.cgi?keywords=verified-beta&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[sg:critical][qa-]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [decoder](/user_profile?user_id=395101) | [in-testsuite](#a44553345_395101 "12 years ago") | - |
| --- | --- | --- |
| [decoder](/user_profile?user_id=395101) | in-testsuite | - |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | qe-verify |  |

## Crash Data

Signature:

[[@ js::mjit::ic::BaseIC::disable ]](https://crash-stats.mozilla.org/signature/?signature=js%3A%3Amjit%3A%3Aic%3A%3ABaseIC%3A%3Adisable)

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (2 files)

| [Test case for shell (see README file inside).](/attachment.cgi?id=566688)  [13 years ago](#c0)  [Christian Holler (:decoder)](/user_profile?user_id=395101)   1.76 KB, application/x-compressed-tar |  | [Details](/attachment.cgi?id=566688&action=edit) |
| --- | --- | --- |
| [patch](/attachment.cgi?id=566829)  [13 years ago](#c1)  [Brian Hackett [Laid off!]](/user_profile?user_id=346231)   1.45 KB, patch | dvander : [review+](#a65698_309316 "13 years ago")  jst : [approval-mozilla-aurora+](#c7 "13 years ago") | [Details](/attachment.cgi?id=566829&action=edit) | [Diff](/attachment.cgi?id=566829&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=694200&attachment=566829) |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=694200#c0)• 13 years ago |
|  | |

Attached file
[Test case for shell (see README file inside).](attachment.cgi?id=566688)
— [Details](attachment.cgi?id=566688&action=edit)

The attached test crashes on mozilla-central revision 866b2b1793cd (see README for running instructions).
Valgrind trace:
==15832== Invalid read of size 8
==15832== at 0x7846B5: js::mjit::ic::BaseIC::disable(JSContext\*, char const\*, void\*) (PolyIC.cpp:2330)
==15832== by 0x78CD95: PICStubCompiler::disable(JSContext\*, char const\*) (PolyIC.cpp:184)
==15832== by 0x78CD5E: PICStubCompiler::disable(char const\*) (PolyIC.cpp:180)
==15832== by 0x783694: js::mjit::ic::GetProp(js::VMFrame&, js::mjit::ic::PICInfo\*) (PolyIC.cpp:1992)
==15832== by 0x6E7C75: ??? (MethodJIT.cpp:164)
==15832== by 0x404FB4F: ???
==15832== Address 0x40 is not stack'd, malloc'd or (recently) free'd
S-s because crashes with this signature have been previously critical.

|  | [Brian Hackett [Laid off!]](/user_profile?user_id=346231)  Assignee |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=694200#c1)• 13 years ago |
|  | |

Attached patch

[patch](attachment.cgi?id=566829&action=diff)
— [Details](attachment.cgi?id=566829&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=694200&attachment=566829)

On error paths, the IC code sometimes tried to disable the IC before returning an error. This is a problem when the error was generated by a VM operation, as the error is checked before recompilation. Patch does a sweep and removes all places where ICs are disabled on error paths.Assignee: general → bhackett1024
[Attachment #566829](/attachment.cgi?id=566829&action=edit "patch") -
Flags: review?(dvander)

|  | [David Anderson [:dvander] - inactive, e-mail if emergency](/user_profile?user_id=309316) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=694200#a65698_309316)• 13 years ago |

[Attachment #566829](/attachment.cgi?id=566829&action=edit "patch") -
Flags: review?(dvander) → review+

|  | [Brian Hackett [Laid off!]](/user_profile?user_id=346231)  Assignee |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=694200#c2)• 13 years ago |
|  | |

<https://hg.mozilla.org/integration/mozilla-inbound/rev/3783a31eda47>

|  | [Brian Hackett [Laid off!]](/user_profile?user_id=346231)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=694200#a422808_346231)• 13 years ago |

[Attachment #566829](/attachment.cgi?id=566829&action=edit "patch") -
Flags: approval-mozilla-aurora?

|  | [Brian Hackett [Laid off!]](/user_profile?user_id=346231)  Assignee |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=694200#c3)• 13 years ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/3783a31eda47>Status: NEW → RESOLVEDClosed: 13 years agoResolution: --- → FIXED

|  | [Brian Hackett [Laid off!]](/user_profile?user_id=346231)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=694200#a483294_346231)• 13 years ago |

Whiteboard: js-triage-needed → [sg:critical]

|  | [Naoki Hirata :nhirata (please use needinfo instead of cc)](/user_profile?user_id=391803) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=694200#c4)• 13 years ago |
|  | |

Brian, is [bug 695875](/show_bug.cgi?id=695875 "RESOLVED DUPLICATE - crash [@ js::mjit::ic::BaseIC::disable]") revolving around something similar to this bug?

|  | [Brian Hackett [Laid off!]](/user_profile?user_id=346231)  Assignee |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=694200#c5)• 13 years ago |
|  | |

(In reply to Naoki Hirata :nhirata from [comment #4](/show_bug.cgi?id=694200#c4 "VERIFIED FIXED - Crash [@ js::mjit::ic::BaseIC::disable]"))
> Brian, is [bug 695875](/show_bug.cgi?id=695875 "RESOLVED DUPLICATE - crash [@ js::mjit::ic::BaseIC::disable]") revolving around something similar to this bug?
Possibly, yeah. The crash in that bug predates the fix here, so it would be good to see if that crash can be reproduced on a current nightly.

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=694200#c7)• 13 years ago |
|  | |

Comment on [attachment 566829](/attachment.cgi?id=566829 "patch") [[details]](/attachment.cgi?id=566829&action=edit "patch") [[diff]](/attachment.cgi?id=566829&action=diff "patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=694200&attachment=566829)
patch
Approved per today's triage meeting.
[Attachment #566829](/attachment.cgi?id=566829&action=edit "patch") -
Flags: approval-mozilla-aurora? → approval-mozilla-aurora+

|  | [Brian Hackett [Laid off!]](/user_profile?user_id=346231)  Assignee |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=694200#c8)• 13 years ago |
|  | |

<https://hg.mozilla.org/releases/mozilla-aurora/rev/b9725bcebd71>

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=694200#c10)• 13 years ago |
|  | |

Do we need this for 8?
[status-firefox10](/buglist.cgi?f1=cf_status_firefox10&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=fixed)
[status-firefox9](/buglist.cgi?f1=cf_status_firefox9&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=fixed)
[tracking-firefox10](/buglist.cgi?f1=cf_tracking_firefox10&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox10&o1=equals&v1=%2B)
[tracking-firefox8](/buglist.cgi?f1=cf_tracking_firefox8&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox8&o1=equals&v1=%3F)
[tracking-firefox9](/buglist.cgi?f1=cf_tracking_firefox9&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox9&o1=equals&v1=%2B)

|  | [Brian Hackett [Laid off!]](/user_profile?user_id=346231)  Assignee |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=694200#c11)• 13 years ago |
|  | |

No, this is a TI bug.

|  | [[:Cww]](/user_profile?user_id=297228) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=694200#a1288744_297228)• 13 years ago |

[tracking-firefox8](/buglist.cgi?f1=cf_tracking_firefox8&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox8&o1=equals&v1=%3F) → ---

|  | [u279076](/user_profile?user_id=279076) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=694200#a3462164_279076)• 13 years ago |

Whiteboard: [sg:critical] → [sg:critical][qa+]

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=694200#a3534705_1689)• 13 years ago |

[status1.9.2](/buglist.cgi?f1=cf_status_192&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_192&o1=equals&v1=unaffected)
[status-firefox8](/buglist.cgi?f1=cf_status_firefox8&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_firefox8&o1=equals&v1=unaffected)

|  | [Henrik Skupin [:whimboo][⌚️UTC+2]](/user_profile?user_id=76551) |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=694200#c12)• 13 years ago |
|  | |

Brian, is there another way to verify that the issue has been solved as running the testcase through js? I have problems to compile Firefox on OS X at least with the given changeset from [comment 0](/show_bug.cgi?id=694200#c0 "VERIFIED FIXED - Crash [@ js::mjit::ic::BaseIC::disable]").

|  | [u279076](/user_profile?user_id=279076) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=694200#a4832810_279076)• 13 years ago |

Whiteboard: [sg:critical][qa+] → [sg:critical][qa?]

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=694200#c13)• 13 years ago |
|  | |

Confirmed fixed on trunk, aurora and beta.
@Henrik: You don't need to compile Firefox to verify tests like this, a JS shell suffices (which is much easier). If you need help on how to compile these, let me know (just ping me on IRC or email) :)

|  | [u279076](/user_profile?user_id=279076) |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=694200#c14)• 13 years ago |
|  | |

[qa-] since QA didn't verify this fix. Marking it VERIFIED based on [comment 13](/show_bug.cgi?id=694200#c13 "VERIFIED FIXED - Crash [@ js::mjit::ic::BaseIC::disable]").
Thanks ChristianStatus: RESOLVED → VERIFIEDKeywords: [verified-aurora](/buglist.cgi?keywords=verified-aurora&resolution=---),
[verified-beta](/buglist.cgi?keywords=verified-beta&resolution=---)Whiteboard: [sg:critical][qa?] → [sg:critical][qa-]

|  | [Henrik Skupin [:whimboo][⌚️UTC+2]](/user_profile?user_id=76551) |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=694200#c15)• 13 years ago |
|  | |

(In reply to Christian Holler (:decoder) from [comment #13](/show_bug.cgi?id=694200#c13 "VERIFIED FIXED - Crash [@ js::mjit::ic::BaseIC::disable]"))
> @Henrik: You don't need to compile Firefox to verify tests like this, a JS
> shell suffices (which is much easier). If you need help on how to compile
> these, let me know (just ping me on IRC or email) :)
You came me before now. Yesterday I have already seen this by checking the tinderbox folders on FTP. All the builds up there have the jsshell included. But thanks for the verification.

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=694200#a10966763_1689)• 13 years ago |

Group: core-security

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=694200#a44553345_395101)• 12 years ago |

Flags: in-testsuite-
You need to [log in](/show_bug.cgi?id=694200&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Christian Holler (:decoder)](/user_profile?user_id=395101)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from bugzilla.mozilla.org_aebcfd70_20250124_235751.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/685321)
* [XML](/show_bug.cgi?ctype=xml&id=685321)

Closed
[Bug 685321](/show_bug.cgi?id=685321)

Opened 13 years ago
Closed 13 years ago

# Assertion failure: [infer failure] Missing type pushed 0: int, at jsinfer.cpp:341 with destructuring assignment

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Assertion failure: [infer failure] Missing type pushed 0: int, at jsinfer.cpp:341 with destructuring assignment

## Categories

### (Core :: JavaScript Engine, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=JavaScript%20Engine#JavaScript%20Engine)

JavaScript Engine
▾

Core :: JavaScript Engine
The interpreter engine for the core JavaScript language, independent of the browser's object model. File ONLY core JavaScript language bugs in this category. For bugs involving browser objects such as "window" and "document", use the "DOM" component. For bugs involving calls between JavaScript and C++, use the "XPConnect" component.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=JavaScript%20Engine&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=JavaScript%20Engine&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=JavaScript%20Engine)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

All

All

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

critical

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla11

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Performance Impact | --- |
| --- | --- |
| Accessibility Severity | --- |
| a11y-review | --- |
| Webcompat Score | --- |
| Webcompat Priority | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox7 | [-](/buglist.cgi?f1=cf_tracking_firefox7&o1=equals&v1=-) | [wontfix](/buglist.cgi?f1=cf_status_firefox7&o1=equals&v1=wontfix) |
| firefox8 | [-](/buglist.cgi?f1=cf_tracking_firefox8&o1=equals&v1=-) | [wontfix](/buglist.cgi?f1=cf_status_firefox8&o1=equals&v1=wontfix) |
| firefox9 | [+](/buglist.cgi?f1=cf_tracking_firefox9&o1=equals&v1=%2B) | [verified](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=verified) |
| firefox10 | [+](/buglist.cgi?f1=cf_tracking_firefox10&o1=equals&v1=%2B) | [verified](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=verified) |
| firefox11 | [+](/buglist.cgi?f1=cf_tracking_firefox11&o1=equals&v1=%2B) | [verified](/buglist.cgi?f1=cf_status_firefox11&o1=equals&v1=verified) |
| status1.9.2 | --- | [unaffected](/buglist.cgi?f1=cf_status_192&o1=equals&v1=unaffected) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox7 | - | wontfix |
| firefox8 | - | wontfix |
| firefox9 | + | verified |
| firefox10 | + | verified |
| firefox11 | + | verified |
| status1.9.2 |  | unaffected |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: decoder, Assigned: dmandelin)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/a86fae4b06c1570a6c1a1bc1c5a6c1f6?d=mm&size=40)  [dmandelin](/user_profile?user_id=294323)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/b29b83d12aba827b8ff68296e473bec5?d=mm&size=40)  [decoder](/user_profile?user_id=395101)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/4fe52ee1503aecf7b6c976b8eb7c1753?d=mm&size=40)  [willyelm](/user_profile?user_id=714609)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

16 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

[719750](/show_bug.cgi?id=719750 "VERIFIED WORKSFORME - Assertion failure: [infer failure] Missing type pushed 0: int with destructuring assignment")

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[566022](/show_bug.cgi?id=566022 "RESOLVED FIXED - JM: tracker can be wrong after implicit calls"), [701248](/show_bug.cgi?id=701248 "VERIFIED FIXED - Assertion failure: ((js::SrcNoteType)(((*(sn) >> 3) >= SRC_XDELTA) ? SRC_XDELTA : *(sn) >> 3)) == SRC_DESTRUCT, at jsopcode.cpp:3543")

Dependency [tree](/showdependencytree.cgi?id=685321&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=685321)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: assertion, testcase, Whiteboard: [sg:critical][qa!])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[assertion](/buglist.cgi?keywords=assertion&resolution=---),
[testcase](/buglist.cgi?keywords=testcase&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[sg:critical][qa!]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [whimboo](/user_profile?user_id=76551) | [in-testsuite](#c43 "13 years ago") | + |
| --- | --- | --- |
| [whimboo](/user_profile?user_id=76551) | in-testsuite | + |
| --- | --- | --- |
| [whimboo](/user_profile?user_id=76551) | [in-litmus](#c43 "13 years ago") | - |
| --- | --- | --- |
| [whimboo](/user_profile?user_id=76551) | in-litmus | - | | |
| --- | --- | --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (1 file, 1 obsolete file)

| [one-line spot fix](/attachment.cgi?id=574986)  [13 years ago](#c19)  [Brendan Eich [:brendan]](/user_profile?user_id=1214)   768 bytes, patch |  | [Details](/attachment.cgi?id=574986&action=edit) | [Diff](/attachment.cgi?id=574986&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=685321&attachment=574986) |
| --- | --- | --- |
| [spot fix with test case](/attachment.cgi?id=575365)  [13 years ago](#c20)  [David Mandelin [:dmandelin]](/user_profile?user_id=294323)   832 bytes, patch | jorendorff : [review+](#c23 "13 years ago")  akeybl : [approval-mozilla-aurora+](#c41 "13 years ago")  akeybl : [approval-mozilla-beta+](#c41 "13 years ago") | [Details](/attachment.cgi?id=575365&action=edit) | [Diff](/attachment.cgi?id=575365&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=685321&attachment=575365) |

Show Obsolete

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=685321#c0)• 13 years ago |
|  | |

The following test asserts on mozilla-central revision b7d269a291b6 (options -m -n -a):
function f() {
function g() {
for (var i = 0; i < 3; i++)
x = i;
};
var [x] = 0;
g();
assertEq(x, 2);
}
f();

|  | [Chris Jones [:cjones] inactive; ni?/f?/r? if you need me](/user_profile?user_id=336288) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=685321#a87157_336288)• 13 years ago |

Group: core-security

|  | [Brian Hackett [Laid off!]](/user_profile?user_id=346231) |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=685321#c1)• 13 years ago |
|  | |

In function 'f', 'x' is not marked as a closure variable by the emitter, and analysis and JM will not account for modifications that 'g' makes to the variable. This is bad news for JM, both with and without TI.

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=685321#a1219795_1689)• 13 years ago |

Whiteboard: [sg:critical?]

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=685321#c2)• 13 years ago |
|  | |

Is this a regression? I guess technically it must be somewhere since JM isn't on the 1.9.2 branch, but does the problem go that far back? In other words, are our current Firefox 6 or 7 users vulnerable, or is this just a (near) future problem?
[status1.9.2](/buglist.cgi?f1=cf_status_192&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_192&o1=equals&v1=unaffected)
[status-firefox9](/buglist.cgi?f1=cf_status_firefox9&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=affected)
[tracking-firefox8](/buglist.cgi?f1=cf_tracking_firefox8&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox8&o1=equals&v1=%2B)
[tracking-firefox9](/buglist.cgi?f1=cf_tracking_firefox9&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox9&o1=equals&v1=%2B)

|  | [Brian Hackett [Laid off!]](/user_profile?user_id=346231) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=685321#c3)• 13 years ago |
|  | |

The closure variable stuff was added for Firefox 4, so the problem could potentially go back that far. dvander, do you mind looking at this? I don't know at all the code which determines closure variables, and IonMonkey will also need this information to be correct.

|  | [Wesley W. Garland](/user_profile?user_id=122472) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=685321#c4)• 13 years ago |
|  | |

FWIW, I couldn't repro on a JS 1.8.5 shell, which is trivially different from Firefox 4's.
Note, that shell doesn't have the -n option, I ran with -m -a.

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=685321#c5)• 13 years ago |
|  | |

(In reply to Wesley W. Garland from [comment #4](/show_bug.cgi?id=685321#c4 "VERIFIED FIXED - Assertion failure: [infer failure] Missing type pushed 0: int, at jsinfer.cpp:341 with destructuring assignment"))
> FWIW, I couldn't repro on a JS 1.8.5 shell, which is trivially different
> from Firefox 4's.
>
> Note, that shell doesn't have the -n option, I ran with -m -a.
The assert triggered here only exists in the type inference code (-n). However, the underlying issue described by bhackett might go back much further, you won't get this assert though. It should however be possible though to come up with a correctness test that shows the problem. If I understand the problem correctly, the modification made by 'g' in this code will not be visible outside the function, so checking that should work. I'll try this tomorrow with a small test.

|  | [David Mandelin [:dmandelin]](/user_profile?user_id=294323)  Assignee |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=685321#c6)• 13 years ago |
|  | |

I looked at this a while on Friday. I found that the parser does mark an 'x' variable (i.e., a 'name' parse node with atom "x") as closed over at these lines in jsparse.cpp:
/\* Mark the outer dn as escaping. \*/
outer\_dn->pn\_dflags |= PND\_CLOSED;
But later, in the emitter in MaybeEmitVarDecl, it doesn't note the closed name here:
if (cg->inFunction() &&
JOF\_OPTYPE(pn->getOp()) == JOF\_LOCAL &&
pn->pn\_cookie.slot() < cg->bindings.countVars() &&
cg->shouldNoteClosedName(pn))
{
if (!cg->closedVars.append(pn->pn\_cookie.slot()))
It seems that the parse node here doesn't have the same identity as the one marked by the parser.
If I change the test case not to use the destructuring assignment, then the nodes do have the same identity, the closed-over flag gets propagated by the the code above, and the test passes.

|  | [Brian Hackett [Laid off!]](/user_profile?user_id=346231) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=685321#c7)• 13 years ago |
|  | |

Crashing testcase on aurora tip:
var o = {};
function f() {
function g() {
x = 80;
return x;
};
Object.defineProperty(o, "f", {get:g});
var [x] = 0;
x = {};
2 + o.f;
print(x);
}
f();

|  | [Jeff Walden [:Waldo]](/user_profile?user_id=83595) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=685321#c8)• 13 years ago |
|  | |

Tentatively taking.Assignee: general → jwalden+bmo

|  | [Jeff Walden [:Waldo]](/user_profile?user_id=83595) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=685321#c9)• 13 years ago |
|  | |

The root of the problem, which I think I finally understand now, is this.
In the non-destructuring case, the parse node for the variable name |x| in |var x| is created by NewBindingNode. That does the work to reuse the existing placeholder definition which is found in lexdeps, added there by LeaveFunction when leaving |g|.
But in the destructuring case, |x|'s parse node is created by NameNode::create, way way deep in Parser::primaryExpr. (This seems to be a consequence of making destructuring-parsing a sub-mode of primary-expression parsing.) That NameNode parse node isn't the placeholder created in lexdeps when doing LeaveFunction for the function |g|. So we continue on our way with the wrong parse node, and we insert a definition for that parse node into decls. Meanwhile, the real placeholder in lexdeps gets PND\_CLOSED all the way out, because we never find a definition for it. So we get divergence, and eventually someone tries to work with a closed-over variable only to find things are whack.
Whee, analysis done. I think. Fix coming tomorrow, I hope.

|  | [Jeff Walden [:Waldo]](/user_profile?user_id=83595) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=685321#c10)• 13 years ago |
|  | |

I am somewhat inclined to rewrite the parsing of |var DECL|, where |DECL| uses destructuring syntax, to fix this, because it's not at all clear to me where exactly it could be fixed in the current code.
Changing the place where the NameNode is created seems incredibly dodgy to me, because that code is central to all name parsing everywhere, and I have nowhere near enough understanding of the code to be confident that any change I'd make would only affect this narrow destructuring-specific situation.
Changing BindDestructuringVar seems initially more plausible. But at that point you already have the mis-constructed parse node, and it's already been inserted into the parse tree, so you'd have to do an after-the-fact hot-swap or something. That seems nearly as dangerous itself.
Changing BindVarOrConst or Define (the former calls the latter) might also be plausible. But you still have the mis-constructed parse node to deal with. And you have the same problem with the NameNode location, that this is quite central code, and that changing it will affect a lot of other code in subtle ways such that it's difficult to have much certainty in a fully correct fix.
Of course the down side of a rewrite is that such a fix is a very unlikely candidate for backporting. Maybe that matters, maybe it doesn't. Any of the potential plausible spot fixes look equally un-candidate-worthy to me. So maybe rewriting really is the way to go. Thoughts from others appreciated.

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=685321#c11)• 13 years ago |
|  | |

Waldo, do we know how far back this problem goes? And based on your last comment, this doesn't sounds like something we'd like to take on beta, but if you disagree please say so. And also, do we believe this is actually exploitable? Trying to figure out what releases we need to worry about this for...
[status-firefox8](/buglist.cgi?f1=cf_status_firefox8&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox8&o1=equals&v1=affected)

|  | [Jeff Walden [:Waldo]](/user_profile?user_id=83595) |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=685321#c12)• 13 years ago |
|  | |

I don't believe the destructuring parsing has changed much since it was first introduced. The name resolution stuff that seems to be the cause of it probably goes back to bug upvar2 or so. The JSCodeGenerator list that is mistaken, that's now being used by TI and others, is somewhat newer (I think), but I don't know that it's that much newer. If this doesn't go back to Firefox 4 at least, I'd be surprised.
Without a spot-fix, yeah, I don't see this being taken for beta. Not to say one's not possible, but I'm not smart enough, and don't know enough about how all the pieces intertwine here, to write it. Perhaps after the rewrite I'll understand enough, but it's hard to say.
As for exploitability, I don't know who depends on this information for correctness. But if (as seems the case) it's any of the JITs, it probably is with enough pain, or at least it isn't clearly non-exploitable.

|  | [Brian Hackett [Laid off!]](/user_profile?user_id=346231) |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=685321#c13)• 13 years ago |
|  | |

I think this is exploitable. That 'x = 80' line is specifying the address which the program will dereference, and while this is just a read, it should be possible to get the program to write to a location based on the value it reads here.

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=685321#a3710301_12352)• 13 years ago |

[status-firefox10](/buglist.cgi?f1=cf_status_firefox10&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=affected)
[status-firefox7](/buglist.cgi?f1=cf_status_firefox7&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox7&o1=equals&v1=wontfix)
[status-firefox8](/buglist.cgi?f1=cf_status_firefox8&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox8&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox8&o1=equals&v1=wontfix)
[tracking-firefox10](/buglist.cgi?f1=cf_tracking_firefox10&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox10&o1=equals&v1=%2B)
[tracking-firefox7](/buglist.cgi?f1=cf_tracking_firefox7&o1=isnotempty):
--- → [-](/buglist.cgi?f1=cf_tracking_firefox7&o1=equals&v1=-)
[tracking-firefox8](/buglist.cgi?f1=cf_tracking_firefox8&o1=isnotempty):
[+](/buglist.cgi?f1=cf_tracking_firefox8&o1=equals&v1=%2B) → [-](/buglist.cgi?f1=cf_tracking_firefox8&o1=equals&v1=-)

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=685321#c14)• 13 years ago |
|  | |

As per [comment 13](/show_bug.cgi?id=685321#c13 "VERIFIED FIXED - Assertion failure: [infer failure] Missing type pushed 0: int, at jsinfer.cpp:341 with destructuring assignment") this is confirmed sg:critical (invalid read influencing control flow).Whiteboard: [sg:critical?] → [sg:critical]

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=685321#c15)• 13 years ago |
|  | |

Jeff, this critical bug is almost 2 months old by now, can you find some time to work on this, or should we find someone else to take this over? Thanks.

|  | [Jeff Walden [:Waldo]](/user_profile?user_id=83595) |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=685321#c16)• 13 years ago |
|  | |

I've kind of been holding off on this because I know it conflicts pretty badly with stuff Luke is doing for parsing of let-statements and such. Probably it makes more sense for him to do it at this point, since he's already touching that code so much.Assignee: jwalden+bmo → luke

|  | [Luke Wagner [:luke]](/user_profile?user_id=347312) |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=685321#c17)• 13 years ago |
|  | |

Jeff and I talked and it would seem that his destructuring overhaul (or spot fix if one should magically appear) would be orthogonal (even complementary) to the let changes.Assignee: luke → jwalden+bmo

|  | [Jeff Walden [:Waldo]](/user_profile?user_id=83595) |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=685321#c18)• 13 years ago |
|  | |

I started work on this several hours ago today, and thus far things proceed nicely -- lots of simplifications to the parsing code to be made. The hard part -- actually binding names correctly and all that -- yet remains.Status: NEW → ASSIGNEDOS: Linux → AllHardware: x86\_64 → All

|  | [Brendan Eich [:brendan]](/user_profile?user_id=1214) |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=685321#c19)• 13 years ago |
|  | |

Attached patch

[one-line spot fix](attachment.cgi?id=574986&action=diff) (obsolete)
— [Details](attachment.cgi?id=574986&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=685321&attachment=574986)

Waldo, will you please take this and add a test and land it? Full speed ahead on the cleanups for EmitVariables etc. in other bugs. This is the minimal fix for this bug.
/be

|  | [Brendan Eich [:brendan]](/user_profile?user_id=1214) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=685321#a6058863_1214)• 13 years ago |

Blocks: [566022](/show_bug.cgi?id=566022 "RESOLVED FIXED - JM: tracker can be wrong after implicit calls")

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=685321#a6059850_1689)• 13 years ago |

Blocks: [701248](/show_bug.cgi?id=701248 "VERIFIED FIXED - Assertion failure: ((js::SrcNoteType)(((*(sn) >> 3) >= SRC_XDELTA) ? SRC_XDELTA : *(sn) >> 3)) == SRC_DESTRUCT, at jsopcode.cpp:3543")

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=685321#a6132567_12352)• 13 years ago |

[status-firefox11](/buglist.cgi?f1=cf_status_firefox11&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox11&o1=equals&v1=affected)
[tracking-firefox11](/buglist.cgi?f1=cf_tracking_firefox11&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox11&o1=equals&v1=%2B)

|  | [David Mandelin [:dmandelin]](/user_profile?user_id=294323)  Assignee |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=685321#c20)• 13 years ago |
|  | |

Attached patch

[spot fix with test case](attachment.cgi?id=575365&action=diff)
— [Details](attachment.cgi?id=575365&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=685321&attachment=575365)

Jason, can you expedite review on this? This sg:crit has been outstanding for a while. I verified that the patch fixes the problem and passes shell tests, and it seems safe to be conservative about marking variables as closed-over, but it's harder to see whether this fixes all the security vulnerabilities associated with the underlying bug.
[Attachment #574986](/attachment.cgi?id=574986&action=edit "one-line spot fix") -
Attachment is obsolete: true
[Attachment #575365](/attachment.cgi?id=575365&action=edit "spot fix with test case") -
Flags: review?(jorendorff)

|  | [Brendan Eich [:brendan]](/user_profile?user_id=1214) |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=685321#c21)• 13 years ago |
|  | |

The analysis in [comment 10](/show_bug.cgi?id=685321#c10 "VERIFIED FIXED - Assertion failure: [infer failure] Missing type pushed 0: int, at jsinfer.cpp:341 with destructuring assignment") did almost hit the target, but paragraph 4 backed away for fear of changing a common subroutine without analyzing how it is used. (That's not an argument for doing away with common subroutines by manually expanding them into their call sites, because then we would have to make this bug's fix in many places.)
The logic in the one-line fix is required in that place in the common Define subroutine, though, as the comment for TCF\_DECL\_DESTRUCTURING suggests.
/\*
\* Set when parsing a declaration-like destructuring pattern. This
\* flag causes PrimaryExpr to create PN\_NAME parse nodes for variable
\* references which are not hooked into any definition's use chain,
\* added to any tree context's AtomList, etc. etc. CheckDestructuring
\* will do that work later.
\*
\* The comments atop CheckDestructuring explain the distinction
\* between assignment-like and declaration-like destructuring
\* patterns, and why they need to be treated differently.
\*/
#define TCF\_DECL\_DESTRUCTURING 0x10000
This comment fails to detail how CheckDestructuring calls BindDestructuringVar calls binder -> BindVarOrConst calls Define, but [comment 10](/show_bug.cgi?id=685321#c10 "VERIFIED FIXED - Assertion failure: [infer failure] Missing type pushed 0: int, at jsinfer.cpp:341 with destructuring assignment") tracked that well enough.
Destructuring in JS requires parsing object and array lvalue patterns as object and array literal rvalues at first, and then fixing up the parse tree (with error checks) to be a "pattern" instead of a "literal".
This is already formalized in the ES6 drafts -- see <http://wiki.ecmascript.org/doku.php?id=globalization:specification_drafts>. There is no getting around it without a different parsing algorithm (GLR could do it), but not a practical one I know of.
Given the nature of the parsing problem, the challenges of validating and revising the AST and any def/use chains computed eagerly in one pass while parsing can't be avoided.
The one-line fix needs a comment, but it is a complete fix. It covers all the Define cases that convert a use misattributed to an earlier def into a fresh def and therefore strip some or all uses from the old def's chain, linking them from the new def's chain (the old def is dn, the new one pn).
The one-line fix is a consistent fix. The [bug 566022](/show_bug.cgi?id=566022 "RESOLVED FIXED - JM: tracker can be wrong after implicit calls") patch that introduced this bug added PND\_CLOSED but failed to propagate it to the new def from the old.
Jason is a good reviewer choice, or Jim Blandy -- they know how the one-pass def/use chaining code works.
/be

|  | [Brendan Eich [:brendan]](/user_profile?user_id=1214) |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=685321#c22)• 13 years ago |
|  | |

I did look at the patch for [bug 566022](/show_bug.cgi?id=566022 "RESOLVED FIXED - JM: tracker can be wrong after implicit calls"), sorry I missed this regression in it, but I don't see a review stamp there. Dvander, did it get real review, maybe when the moo branch landed?
/be

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791) |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=685321#c23)• 13 years ago |
|  | |

Comment on [attachment 575365](/attachment.cgi?id=575365 "spot fix with test case") [[details]](/attachment.cgi?id=575365&action=edit "spot fix with test case") [[diff]](/attachment.cgi?id=575365&action=diff "spot fix with test case") [[review]](/page.cgi?id=splinter.html&ignore=&bug=685321&attachment=575365)
spot fix with test case
The test case doesn't fail for me in tip, even with -m -n -a.
Is it supposed to?
Please also add the test case in [comment 7](/show_bug.cgi?id=685321#c7 "VERIFIED FIXED - Assertion failure: [infer failure] Missing type pushed 0: int, at jsinfer.cpp:341 with destructuring assignment").
Why propagate only PND\_CLOSED and not all the PND\_USE2DEF\_FLAGS? I can't fit the entire algorithm in my head at once, so I'm not good at reasoning about this stuff. I can imagine a possible argument that the situation I'm worrying about, where one of the other PND\_USE2DEF\_FLAGS is marked on the wrong def before it's shadowed, just can't happen.
r=me with those addressed.
[Attachment #575365](/attachment.cgi?id=575365&action=edit "spot fix with test case") -
Flags: review?(jorendorff) → review+

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791) |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=685321#c24)• 13 years ago |
|  | |

(In reply to Jason Orendorff [:jorendorff] from [comment #23](/show_bug.cgi?id=685321#c23 "VERIFIED FIXED - Assertion failure: [infer failure] Missing type pushed 0: int, at jsinfer.cpp:341 with destructuring assignment"))
> The test case doesn't fail for me in tip, even with -m -n -a.
> Is it supposed to?
Oh ffs. Ignore this. I was using the shell wrong. (You have to put the flags before the filename, dummy...)
The test asserts just like it's supposed to.

|  | [David Mandelin [:dmandelin]](/user_profile?user_id=294323)  Assignee |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=685321#c25)• 13 years ago |
|  | |

<http://hg.mozilla.org/integration/mozilla-inbound/rev/014d6e732bd7>
[status-firefox11](/buglist.cgi?f1=cf_status_firefox11&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox11&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox11&o1=equals&v1=fixed)

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791) |  |
| --- | --- | --- |
| [Comment 27](/show_bug.cgi?id=685321#c27)• 13 years ago |
|  | |

this has merged, -> RESO FIXED ...but David, what about these review comments?
> Please also add the test case in [comment 7](/show_bug.cgi?id=685321#c7 "VERIFIED FIXED - Assertion failure: [infer failure] Missing type pushed 0: int, at jsinfer.cpp:341 with destructuring assignment").
>
> Why propagate only PND\_CLOSED and not all the PND\_USE2DEF\_FLAGS? I can't fit
> the entire algorithm in my head at once, so I'm not good at reasoning about
> this stuff. I can imagine a possible argument that the situation I'm
> worrying about, where one of the other PND\_USE2DEF\_FLAGS is marked on the
> wrong def before it's shadowed, just can't happen.
>
> r=me with those addressed.Status: ASSIGNED → RESOLVEDClosed: 13 years agoResolution: --- → FIXED

|  | [(no longer active)](/user_profile?user_id=251051) |  |
| --- | --- | --- |
| [Comment 28](/show_bug.cgi?id=685321#c28)• 13 years ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/014d6e732bd7>Target Milestone: --- → mozilla11

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Comment 29](/show_bug.cgi?id=685321#c29)• 13 years ago |
|  | |

Reopening this bug, seems there's two outstanding issues here, one testcase is missing, and there's a review comment that's not dealt with.
With both those issues dealt with we'd still be interested in taking this for 9, but time's running short.Status: RESOLVED → REOPENEDResolution: FIXED → ---

|  | [David Mandelin [:dmandelin]](/user_profile?user_id=294323)  Assignee |  |
| --- | --- | --- |
| [Comment 30](/show_bug.cgi?id=685321#c30)• 13 years ago |
|  | |

Oops, not sure how I missed those review comments. I just landed the additional test case:
<http://hg.mozilla.org/integration/mozilla-inbound/rev/1fc0e97638e0>
I will briefly look at the USE2DEF issue, but I don't think it's worth spending a lot of time on because Jeff will be done with the definitive fix for this bug soon anyway--this patch is just temporary until that one is done.

|  | [David Mandelin [:dmandelin]](/user_profile?user_id=294323)  Assignee |  |
| --- | --- | --- |
| [Comment 31](/show_bug.cgi?id=685321#c31)• 13 years ago |
|  | |

From reading the code, it looks to me that propagating more USE2DEF flags is probably at least OK--it seems to feed into conservative analyses. I tested a version of the patch that does that and it checks out OK on shell tests. One risk is that it could deoptimize more things.
I don't think it's worth worrying too much about this stopgap fix anyway, and we'll likely have the better fix before the 11 Aurora merge, but at this point I think options are:
1. Take the current patch onto 9 and/or 10. It is working so far on trunk. The main issue is that it may not fix hypothetical problems around not propagating the other flags. It also carries some level of risk from being a new patch.
2. Take the patch that propagates more USE2DEF flags onto 9 and/or 10 (after landing it to trunk). This covers the hypothetical problems, but is another patch, so more risk of regression.
3. Don't take any of these patches to 9 and 10.
My default action will be #3 (do nothing) unless someone else says they want #1 or #2.

|  | [David Mandelin [:dmandelin]](/user_profile?user_id=294323)  Assignee |  |
| --- | --- | --- |
| [Comment 32](/show_bug.cgi?id=685321#c32)• 13 years ago |
|  | |

test case is on m-c:
<https://hg.mozilla.org/mozilla-central/rev/1fc0e97638e0>

|  | [Jeff Walden [:Waldo]](/user_profile?user_id=83595) |  |
| --- | --- | --- |
| [Comment 33](/show_bug.cgi?id=685321#c33)• 13 years ago |
|  | |

For what it's worth, I have a comprehensive fix finished down to about five jstests.py failures and an unknown number of jit-test failures (but I would place reasonable odds on any failures there being from new patterns, not from jit-specific stuff). Once those are fixed it could use the normal polishing before posting, but beyond those things it's in good shape. (And yes, it does fix the problem here, and the hackaround already posted is removable with it in place.) I'm holding off on polishing off the rest of it until various other emitter and parser bugs-in-progress get fixed first. Lots of churn in this code of late...and that's a good thing!

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Comment 34](/show_bug.cgi?id=685321#c34)• 13 years ago |
|  | |

David, can you attach a complete patch for branches here and request approval? Doesn't sound like we need to worry about the USE2DEF flag details here given waldo's upcoming fixes, so let's land what we landed on trunk for branches here!

|  | [Brendan Eich [:brendan]](/user_profile?user_id=1214) |  |
| --- | --- | --- |
| [Comment 35](/show_bug.cgi?id=685321#c35)• 13 years ago |
|  | |

Where's the comprehensive patch going? I suggest a new bug.
I used CLOSED only ,not USE2DEF\_FLAGS, because I was concerned about deoptimizations and I saw no correctness requirements.
/be

|  | [Brendan Eich [:brendan]](/user_profile?user_id=1214) |  |
| --- | --- | --- |
| [Comment 36](/show_bug.cgi?id=685321#c36)• 13 years ago |
|  | |

New bug because it can be open, not s-s, mainly; also because it will be cleaning up code, not fixing a bug that no longer bites, namely this bug.
/be

|  | [David Mandelin [:dmandelin]](/user_profile?user_id=294323)  Assignee |  |
| --- | --- | --- |
| [Comment 37](/show_bug.cgi?id=685321#c37)• 13 years ago |
|  | |

I'll file a new bug.

|  | [David Mandelin [:dmandelin]](/user_profile?user_id=294323)  Assignee |  |
| --- | --- | --- |
| [Comment 38](/show_bug.cgi?id=685321#c38)• 13 years ago |
|  | |

Comment on [attachment 575365](/attachment.cgi?id=575365 "spot fix with test case") [[details]](/attachment.cgi?id=575365&action=edit "spot fix with test case") [[diff]](/attachment.cgi?id=575365&action=diff "spot fix with test case") [[review]](/page.cgi?id=splinter.html&ignore=&bug=685321&attachment=575365)
spot fix with test case
Benefits: it fixes a security vulnerability. Risk is low: it is a 1-line deoptimization patch (that had no effect on benchmarks).
[Attachment #575365](/attachment.cgi?id=575365&action=edit "spot fix with test case") -
Flags: approval-mozilla-beta?
[Attachment #575365](/attachment.cgi?id=575365&action=edit "spot fix with test case") -
Flags: approval-mozilla-aurora?

|  | [David Mandelin [:dmandelin]](/user_profile?user_id=294323)  Assignee |  |
| --- | --- | --- |
| [Comment 39](/show_bug.cgi?id=685321#c39)• 13 years ago |
|  | |

Filed [bug 708892](/show_bug.cgi?id=708892 "RESOLVED INVALID - Clean up destructuring var initializers") for the finish.Assignee: jwalden+bmo → dmandelin

|  | [David Mandelin [:dmandelin]](/user_profile?user_id=294323)  Assignee |  |
| --- | --- | --- |
| [Comment 40](/show_bug.cgi?id=685321#c40)• 13 years ago |
|  | |

And now that we have the new bug this one is fixed.Status: REOPENED → RESOLVEDClosed: 13 years ago → 13 years agoResolution: --- → FIXED

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Comment 41](/show_bug.cgi?id=685321#c41)• 13 years ago |
|  | |

Comment on [attachment 575365](/attachment.cgi?id=575365 "spot fix with test case") [[details]](/attachment.cgi?id=575365&action=edit "spot fix with test case") [[diff]](/attachment.cgi?id=575365&action=diff "spot fix with test case") [[review]](/page.cgi?id=splinter.html&ignore=&bug=685321&attachment=575365)
spot fix with test case
[Triage Comment]
Low risk fix to an sg:crit bug. Let's land on aurora and beta today.
[Attachment #575365](/attachment.cgi?id=575365&action=edit "spot fix with test case") -
Flags: approval-mozilla-beta?
[Attachment #575365](/attachment.cgi?id=575365&action=edit "spot fix with test case") -
Flags: approval-mozilla-beta+
[Attachment #575365](/attachment.cgi?id=575365&action=edit "spot fix with test case") -
Flags: approval-mozilla-aurora?
[Attachment #575365](/attachment.cgi?id=575365&action=edit "spot fix with test case") -
Flags: approval-mozilla-aurora+

|  | [David Mandelin [:dmandelin]](/user_profile?user_id=294323)  Assignee |  |
| --- | --- | --- |
| [Comment 42](/show_bug.cgi?id=685321#c42)• 13 years ago |
|  | |

<http://hg.mozilla.org/releases/mozilla-aurora/rev/b86a7005ba70>
<http://hg.mozilla.org/releases/mozilla-beta/rev/bccd17f22cc3>
[status-firefox10](/buglist.cgi?f1=cf_status_firefox10&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=fixed)
[status-firefox9](/buglist.cgi?f1=cf_status_firefox9&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=fixed)

|  | [u279076](/user_profile?user_id=279076) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=685321#a8382062_279076)• 13 years ago |

Whiteboard: [sg:critical] → [sg:critical][qa+]

|  | [Henrik Skupin [:whimboo][⌚️UTC+2]](/user_profile?user_id=76551) |  |
| --- | --- | --- |
| [Comment 43](/show_bug.cgi?id=685321#c43)• 13 years ago |
|  | |

Verified fixed with jsshell from beta, aurora, nightly tinderbox debug builds on OS X.Status: RESOLVED → VERIFIEDFlags: in-testsuite+Flags: in-litmus-Keywords: [verified-aurora](/buglist.cgi?keywords=verified-aurora&resolution=---),
[verified-beta](/buglist.cgi?keywords=verified-beta&resolution=---)Whiteboard: [sg:critical][qa+] → [sg:critical][qa!]

|  | [Henrik Skupin [:whimboo][⌚️UTC+2]](/user_profile?user_id=76551) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=685321#a8635000_76551)• 13 years ago |

[status-firefox10](/buglist.cgi?f1=cf_status_firefox10&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=verified)
[status-firefox11](/buglist.cgi?f1=cf_status_firefox11&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox11&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox11&o1=equals&v1=verified)
[status-firefox9](/buglist.cgi?f1=cf_status_firefox9&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=verified)Keywords: [verified-aurora](/buglist.cgi?keywords=verified-aurora&resolution=---),
[verified-beta](/buglist.cgi?keywords=verified-beta&resolution=---)Whiteboard: [sg:critical][qa!] → [sg:critical][qa-]

|  | [Henrik Skupin [:whimboo][⌚️UTC+2]](/user_profile?user_id=76551) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=685321#a8635297_76551)• 13 years ago |

Whiteboard: [sg:critical][qa-] → [sg:critical][qa!]

|  | [Brian Hackett [Laid off!]](/user_profile?user_id=346231) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=685321#a11651694_346231)• 13 years ago |

Depends on: [719750](/show_bug.cgi?id=719750 "VERIFIED WORKSFORME - Assertion failure: [infer failure] Missing type pushed 0: int with destructuring assignment")

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=685321#a14614625_1689)• 13 years ago |

Group: core-security
You need to [log in](/show_bug.cgi?id=685321&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Brendan Eich [:brendan]](/user_profile?user_id=1214)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from bugzilla.mozilla.org_6b9f1cb4_20250124_235819.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/697255)
* [XML](/show_bug.cgi?ctype=xml&id=697255)

Closed
[Bug 697255](/show_bug.cgi?id=697255)

Opened 13 years ago
Closed 13 years ago

# TM/JM: Crash [@ js\_GetProperty] or [@ js::analyze::ScriptAnalysis::maybeCode] or "Assertion failure: offset < script->length," or "Assertion failure: script->code <= pc && pc < endpc,"

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

TM/JM: Crash [@ js\_GetProperty] or [@ js::analyze::ScriptAnalysis::maybeCode] or "Assertion failure: offset < script->length," or "Assertion failure: script->code <= pc && pc < endpc,"

## Categories

### (Core :: JavaScript Engine, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=JavaScript%20Engine#JavaScript%20Engine)

JavaScript Engine
▾

Core :: JavaScript Engine
The interpreter engine for the core JavaScript language, independent of the browser's object model. File ONLY core JavaScript language bugs in this category. For bugs involving browser objects such as "window" and "document", use the "DOM" component. For bugs involving calls between JavaScript and C++, use the "XPConnect" component.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=JavaScript%20Engine&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=JavaScript%20Engine&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=JavaScript%20Engine)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

x86

macOS

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

critical

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla10

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| a11y-review | --- |
| --- | --- |
| Webcompat Score | --- |
| Webcompat Priority | --- |
| Accessibility Severity | --- |
| Performance Impact | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox7 | [-](/buglist.cgi?f1=cf_tracking_firefox7&o1=equals&v1=-) | [unaffected](/buglist.cgi?f1=cf_status_firefox7&o1=equals&v1=unaffected) |
| firefox8 | [-](/buglist.cgi?f1=cf_tracking_firefox8&o1=equals&v1=-) | [unaffected](/buglist.cgi?f1=cf_status_firefox8&o1=equals&v1=unaffected) |
| firefox9 | [+](/buglist.cgi?f1=cf_tracking_firefox9&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=fixed) |
| firefox10 | [+](/buglist.cgi?f1=cf_tracking_firefox10&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=fixed) |
| status1.9.2 | --- | [unaffected](/buglist.cgi?f1=cf_status_192&o1=equals&v1=unaffected) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox7 | - | unaffected |
| firefox8 | - | unaffected |
| firefox9 | + | fixed |
| firefox10 | + | fixed |
| status1.9.2 |  | unaffected |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: gkw, Assigned: bhackett1024)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/764aa0af2fda6f02fb17dc9771bb18d9?d=mm&size=40)  [bhackett1024](/user_profile?user_id=346231)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](extensions/Gravatar/web/default.jpg)  [gkw](/user_profile?user_id=132034)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/4fe52ee1503aecf7b6c976b8eb7c1753?d=mm&size=40)  [willyelm](/user_profile?user_id=714609)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

8 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[630996](/show_bug.cgi?id=630996 "RESOLVED FIXED - A tool for stress testing objects and PIC's")

Dependency [tree](/showdependencytree.cgi?id=697255&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=697255)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (4 keywords, Whiteboard: [sg:critical][qa-] js-triage-done)

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[assertion](/buglist.cgi?keywords=assertion&resolution=---),
[crash](/buglist.cgi?keywords=crash&resolution=---),
[regression](/buglist.cgi?keywords=regression&resolution=---),
[testcase](/buglist.cgi?keywords=testcase&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[sg:critical][qa-] js-triage-done

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [decoder](/user_profile?user_id=395101) | [in-testsuite](#c13 "12 years ago") | + |
| --- | --- | --- |
| [decoder](/user_profile?user_id=395101) | in-testsuite | + |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | qe-verify |  |

## Crash Data

Signature:

[[@ js\_GetProperty ]](https://crash-stats.mozilla.org/signature/?signature=js_GetProperty)

[[@ js::analyze::ScriptAnalysis::maybeCode ]](https://crash-stats.mozilla.org/signature/?signature=js%3A%3Aanalyze%3A%3AScriptAnalysis%3A%3AmaybeCode)

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (2 files, 1 obsolete file)

| [stack](/attachment.cgi?id=569501)  [13 years ago](#c0)  [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034)   219 bytes, text/plain |  | [Details](/attachment.cgi?id=569501&action=edit) |
| --- | --- | --- |
| [actual stack](/attachment.cgi?id=569502)  [13 years ago](#c1)  [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034)   4.14 KB, text/plain |  | [Details](/attachment.cgi?id=569502&action=edit) |
| [patch](/attachment.cgi?id=569884)  [13 years ago](#c3)  [Brian Hackett [Laid off!]](/user_profile?user_id=346231)   668 bytes, patch | luke : [review+](#a124873_347312 "13 years ago")  akeybl : [approval-mozilla-aurora+](#c9 "13 years ago") | [Details](/attachment.cgi?id=569884&action=edit) | [Diff](/attachment.cgi?id=569884&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=697255&attachment=569884) |

Show Obsolete

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=697255#c0)• 13 years ago |
|  | |

Attached file
[stack](attachment.cgi?id=569501) (obsolete)
— [Details](attachment.cgi?id=569501&action=edit)

a = evalcx("lazy");
b = {}
b.\_\_proto\_\_ = a
a.\_\_proto\_\_ = String
for (var a = 0; a < 50; a++) {
try {
b + ""
} catch (e) {}
}
asserts js debug shell on m-c changeset 6cd262091470 with -m and -j at Assertion failure: script->code <= pc && pc < endpc,
A variant,
o9 = evalcx("lazy");
d = {}
d.\_\_proto\_\_ = o9
o9.\_\_proto\_\_ = String.prototype.\_\_proto\_\_;
\_\_proto\_\_.\_\_defineGetter\_\_("toString", function() {})
for (var a = 0; a < 50; a++) {
try {
d + ""
} catch (e) {}
}
asserts js debug shell on m-c changeset 6cd262091470 with -m and -j at Assertion failure: offset < script->length, and crashes js opt shell at js\_GetProperty
Tested on 32-bit Mac 10.6, setting [sg:critical] because a scary memory address, 0x83000005, is being read.
(Ran autoBisect on the second testcase, not sure if it's correct)
autoBisect shows this is probably related to the following changeset:
The first bad revision is:
changeset: 77143:9ca3d16d575c
parent: 77103:06445f55f009
user: Brian Hackett
date: Sat Sep 17 19:14:22 2011 -0700
summary: [INFER] Reapply c2726640029f 3330521cfa4a b68281262e15 ([bug 557358](/show_bug.cgi?id=557358 "RESOLVED FIXED - JM: getprop PIC for getters")), 6a8947bcc821 ([bug 684943](/show_bug.cgi?id=684943 "RESOLVED FIXED - Assertion failure: Unpossible rejoin!, at js/src/methodjit/InvokeHelpers.cpp:1330")), 50d4f6fa00ce ([bug 683714](/show_bug.cgi?id=683714 "RESOLVED FIXED - \"Assertion failure: fun->getProto() == proto\" in CloneFunctionObject")), f3dd7cf2d0b3 ([bug 683999](/show_bug.cgi?id=683999 "RESOLVED FIXED - \"Assertion failure: hasSingletonType()\" in JSObject::splicePrototype (jsinfer.cpp)")).

|  | [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034)  Reporter |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=697255#c1)• 13 years ago |
|  | |

Attached file
[actual stack](attachment.cgi?id=569502)
— [Details](attachment.cgi?id=569502&action=edit)

(gdb) x/i $pc
0xc8cf0 <\_Z14js\_GetPropertyP9JSContextP8JSObjectS2\_iPN2JS5ValueE+1040>: orl $0x4000,(%eax)
(gdb) x/b $eax
0x83000005: Cannot access memory at address 0x83000005
orl performs a logical or between 0x4000 and eax, which is weird address 0x83000005
[Attachment #569501](/attachment.cgi?id=569501&action=edit "stack") -
Attachment is obsolete: true

|  | [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=697255#a926_132034)• 13 years ago |

Blocks: [630996](/show_bug.cgi?id=630996 "RESOLVED FIXED - A tool for stress testing objects and PIC's")

|  | [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034)  Reporter |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=697255#c2)• 13 years ago |
|  | |

Also crashes Mac 10.6 64-bit m-c tip changeset f2fa4ae74ee1, albeit with -j only, and with js::analyze::ScriptAnalysis::maybeCode at the top of js\_GetProperty on the crash stack.Crash Signature: [@ js\_GetProperty] → [@ js\_GetProperty]
[@ js::analyze::ScriptAnalysis::maybeCode]Summary: TM/JM: Crash [@ js\_GetProperty] or "Assertion failure: offset < script->length," or "Assertion failure: script->code <= pc && pc < endpc," → TM/JM: Crash [@ js\_GetProperty] or [@ js::analyze::ScriptAnalysis::maybeCode] or "Assertion failure: offset < script->length," or "Assertion failure: script->code <= pc && pc < endpc,"

|  | [Brian Hackett [Laid off!]](/user_profile?user_id=346231)  Assignee |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=697255#c3)• 13 years ago |
|  | |

Attached patch

[patch](attachment.cgi?id=569884&action=diff)
— [Details](attachment.cgi?id=569884&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=697255&attachment=569884)

Bug related to imacros. The pc returned via currentScript could be in an imacro, which confused callers that expected the script/pc to match each other.
autoBisect is wrong, the blamed revision doesn't touch anything around here.
[Attachment #569884](/attachment.cgi?id=569884&action=edit "patch") -
Flags: review?(luke)

|  | [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034)  Reporter |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=697255#c4)• 13 years ago |
|  | |

> autoBisect is wrong, the blamed revision doesn't touch anything around here.
No wonder I had different blamed revs for the 2 testcases..

|  | [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=697255#a104106_132034)• 13 years ago |

Whiteboard: [sg:critical] js-triage-needed → [sg:critical] js-triage-done

|  | [Luke Wagner [:luke]](/user_profile?user_id=347312) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=697255#a124873_347312)• 13 years ago |

[Attachment #569884](/attachment.cgi?id=569884&action=edit "patch") -
Flags: review?(luke) → review+

|  | [Brian Hackett [Laid off!]](/user_profile?user_id=346231)  Assignee |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=697255#c5)• 13 years ago |
|  | |

<https://hg.mozilla.org/integration/mozilla-inbound/rev/9507d7ca0f58>

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=697255#c6)• 13 years ago |
|  | |

Is this something that we could take on aurora? And my understanding is that this is TI specific, so 8 and older are unaffected. Please correct me if I'm wrong on that.Assignee: general → bhackett1024
[status-firefox10](/buglist.cgi?f1=cf_status_firefox10&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=affected)
[status-firefox7](/buglist.cgi?f1=cf_status_firefox7&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_firefox7&o1=equals&v1=unaffected)
[status-firefox8](/buglist.cgi?f1=cf_status_firefox8&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_firefox8&o1=equals&v1=unaffected)
[status-firefox9](/buglist.cgi?f1=cf_status_firefox9&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=affected)
[tracking-firefox10](/buglist.cgi?f1=cf_tracking_firefox10&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox10&o1=equals&v1=%3F) → [+](/buglist.cgi?f1=cf_tracking_firefox10&o1=equals&v1=%2B)
[tracking-firefox7](/buglist.cgi?f1=cf_tracking_firefox7&o1=isnotempty):
--- → [-](/buglist.cgi?f1=cf_tracking_firefox7&o1=equals&v1=-)
[tracking-firefox8](/buglist.cgi?f1=cf_tracking_firefox8&o1=isnotempty):
--- → [-](/buglist.cgi?f1=cf_tracking_firefox8&o1=equals&v1=-)
[tracking-firefox9](/buglist.cgi?f1=cf_tracking_firefox9&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox9&o1=equals&v1=%3F) → [+](/buglist.cgi?f1=cf_tracking_firefox9&o1=equals&v1=%2B)

|  | [Brian Hackett [Laid off!]](/user_profile?user_id=346231)  Assignee |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=697255#c7)• 13 years ago |
|  | |

Comment on [attachment 569884](/attachment.cgi?id=569884 "patch") [[details]](/attachment.cgi?id=569884&action=edit "patch") [[diff]](/attachment.cgi?id=569884&action=diff "patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=697255&attachment=569884)
patch
currentScript() was added for the TI merge so this should only affect Fx9 and later (though this only manifests with the tracer enabled).
[Attachment #569884](/attachment.cgi?id=569884&action=edit "patch") -
Flags: approval-mozilla-aurora?

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=697255#c8)• 13 years ago |
|  | |

emorley merged this to mozilla-central: <https://hg.mozilla.org/mozilla-central/rev/9507d7ca0f58>
Resolving fixed.Status: NEW → RESOLVEDClosed: 13 years agoResolution: --- → FIXED

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=697255#a225507_313730)• 13 years ago |

Target Milestone: --- → mozilla10

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=697255#c9)• 13 years ago |
|  | |

Comment on [attachment 569884](/attachment.cgi?id=569884 "patch") [[details]](/attachment.cgi?id=569884&action=edit "patch") [[diff]](/attachment.cgi?id=569884&action=diff "patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=697255&attachment=569884)
patch
[Triage Comment]
\* Approving for Aurora since this is a TI regression in 9
[Attachment #569884](/attachment.cgi?id=569884&action=edit "patch") -
Flags: approval-mozilla-aurora? → approval-mozilla-aurora+

|  | [Brian Hackett [Laid off!]](/user_profile?user_id=346231)  Assignee |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=697255#c10)• 13 years ago |
|  | |

<https://hg.mozilla.org/releases/mozilla-aurora/rev/b16983396f30>

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=697255#a774508_12352)• 13 years ago |

[status-firefox10](/buglist.cgi?f1=cf_status_firefox10&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=fixed)
[status-firefox9](/buglist.cgi?f1=cf_status_firefox9&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=fixed)

|  | [u279076](/user_profile?user_id=279076) |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=697255#c11)• 13 years ago |
|  | |

Can someone who is already set up to reproduce this bug please verify the fix?Whiteboard: [sg:critical] js-triage-done → [sg:critical][qa-] js-triage-done

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=697255#a2421415_1689)• 13 years ago |

[status1.9.2](/buglist.cgi?f1=cf_status_192&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_192&o1=equals&v1=unaffected)

|  | [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034)  Reporter |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=697255#c12)• 13 years ago |
|  | |

(In reply to Anthony Hughes, Mozilla QA (irc: ashughes) from [comment #11](/show_bug.cgi?id=697255#c11 "VERIFIED FIXED - TM/JM: Crash [@ js_GetProperty] or [@ js::analyze::ScriptAnalysis::maybeCode] or \"Assertion failure: offset < script->length,\" or \"Assertion failure: script->code <= pc && pc < endpc,\""))
> Can someone who is already set up to reproduce this bug please verify the
> fix?
Verified fixed on 64-bit debug and opt builds on Mac 10.6 on m-c changeset bc48009a6bbb.

|  | [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=697255#a2951658_132034)• 13 years ago |

Status: RESOLVED → VERIFIED

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=697255#a9853462_1689)• 13 years ago |

Group: core-security

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101) |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=697255#c13)• 12 years ago |
|  | |

Automatically extracted testcase for this bug was committed:
<https://hg.mozilla.org/mozilla-central/rev/efaf8960a929>Flags: in-testsuite+
You need to [log in](/show_bug.cgi?id=697255&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from bugzilla.mozilla.org_bd9906fa_20250124_235827.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/706249)
* [XML](/show_bug.cgi?ctype=xml&id=706249)

Closed
[Bug 706249](/show_bug.cgi?id=706249)

Opened 13 years ago
Closed 13 years ago

# "ASSERTION: We've overflowed the mSpec buffer" in nsStandardURL::BuildNormalizedSpec

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

"ASSERTION: We've overflowed the mSpec buffer" in nsStandardURL::BuildNormalizedSpec

## Categories

### (Core :: Networking, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=Networking#Networking)

Networking
▾

Core :: Networking
For bugs in Mozilla's modular networking library (aka "Netlib" or "Necko".) The networking library supplies the software interface that Mozilla uses to access physical transports (e.g. the Internet and local drives), perform URL resolutions, and handle a variety of networking protocols.

Examples of appropriate bugs: URLs with backslash not fetched; URLs starting with a single slash turn into http:///; Cannot access authenticated FTP site.

[See Open Bugs in This Component](/buglist.cgi?product=Core&component=Networking&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=Networking&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=Networking)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

All

All

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

normal

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla11

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Accessibility Severity | --- |
| --- | --- |
| Webcompat Score | --- |
| Webcompat Priority | --- |
| Performance Impact | --- |
| a11y-review | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox8 | [-](/buglist.cgi?f1=cf_tracking_firefox8&o1=equals&v1=-) | [wontfix](/buglist.cgi?f1=cf_status_firefox8&o1=equals&v1=wontfix) |
| firefox9 | [-](/buglist.cgi?f1=cf_tracking_firefox9&o1=equals&v1=-) | [verified](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=verified) |
| firefox10 | [+](/buglist.cgi?f1=cf_tracking_firefox10&o1=equals&v1=%2B) | [verified](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=verified) |
| firefox11 | [+](/buglist.cgi?f1=cf_tracking_firefox11&o1=equals&v1=%2B) | [verified](/buglist.cgi?f1=cf_status_firefox11&o1=equals&v1=verified) |
| status1.9.2 | --- | [unaffected](/buglist.cgi?f1=cf_status_192&o1=equals&v1=unaffected) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox8 | - | wontfix |
| firefox9 | - | verified |
| firefox10 | + | verified |
| firefox11 | + | verified |
| status1.9.2 |  | unaffected |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: jruderman, Assigned: jesup)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/ae002109ba1cfbb7f5ad990cc5d9fbaf?d=mm&size=40)  [jesup](/user_profile?user_id=11539)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/d2dc9227eafcd0ec5ba3712ee4f19b75?d=mm&size=40)  [jruderman](/user_profile?user_id=11608)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/608e04ebca94be52b05c003d51d43e07?d=mm&size=40)  [kershaw](/user_profile?user_id=505624)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

6 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[343943](/show_bug.cgi?id=343943 "RESOLVED INACTIVE - [meta] HTML Element and Attribute fuzzer")

Dependency [tree](/showdependencytree.cgi?id=706249&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=706249)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: assertion, testcase, Whiteboard: [sg:critical][qa!])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[assertion](/buglist.cgi?keywords=assertion&resolution=---),
[testcase](/buglist.cgi?keywords=testcase&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[sg:critical][qa!]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [whimboo](/user_profile?user_id=76551) | [in-testsuite](#c11 "13 years ago") | + |
| --- | --- | --- |
| [whimboo](/user_profile?user_id=76551) | in-testsuite | + |
| --- | --- | --- |
| [whimboo](/user_profile?user_id=76551) | [in-litmus](#c11 "13 years ago") | - |
| --- | --- | --- |
| [whimboo](/user_profile?user_id=76551) | in-litmus | - | | |
| --- | --- | --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (3 files)

| [testcase](/attachment.cgi?id=577738)  [13 years ago](#c0)  [Jesse Ruderman](/user_profile?user_id=11608)   24 bytes, text/html |  | [Details](/attachment.cgi?id=577738&action=edit) |
| --- | --- | --- |
| [stack trace](/attachment.cgi?id=577739)  [13 years ago](#c1)  [Jesse Ruderman](/user_profile?user_id=11608)   2.53 KB, text/plain |  | [Details](/attachment.cgi?id=577739&action=edit) |
| [Patch with tests](/attachment.cgi?id=577837)  [13 years ago](#c3)  [Randell Jesup [:jesup] (needinfo me)](/user_profile?user_id=11539)   4.84 KB, patch | bzbarsky : [review+](#c5 "13 years ago")  akeybl : [approval-mozilla-aurora+](#c9 "13 years ago")  akeybl : [approval-mozilla-beta+](#c9 "13 years ago") | [Details](/attachment.cgi?id=577837&action=edit) | [Diff](/attachment.cgi?id=577837&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=706249&attachment=577837) |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Jesse Ruderman](/user_profile?user_id=11608)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=706249#c0)• 13 years ago |
|  | |

Attached file
[testcase](attachment.cgi?id=577738)
— [Details](attachment.cgi?id=577738&action=edit)

###!!! ASSERTION: We've overflowed the mSpec buffer!: 'mSpec.Length() <= approxLen', file netwerk/base/src/nsStandardURL.cpp, line 697
The last major change to this function was in [bug 125608](/show_bug.cgi?id=125608 "RESOLVED FIXED - NewURI does larger allocations than needed").

|  | [Jesse Ruderman](/user_profile?user_id=11608)  Reporter |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=706249#c1)• 13 years ago |
|  | |

Attached file
[stack trace](attachment.cgi?id=577739)
— [Details](attachment.cgi?id=577739&action=edit)

|  | [Randell Jesup [:jesup] (needinfo me)](/user_profile?user_id=11539)  Assignee |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=706249#c2)• 13 years ago |
|  | |

Caused by the null password entry. Could fix by omitting it if empty, but that would be a change in behavior and it's not clear if that would even be correct (i.e. a null password is a password), so enforce adding one byte for a password (for the ':') even if the field is empty. Patch follows.Assignee: nobody → rjesup

|  | [Randell Jesup [:jesup] (needinfo me)](/user_profile?user_id=11539)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=706249#a15342_11539)• 13 years ago |

OS: Mac OS X → AllHardware: x86\_64 → All

|  | [Randell Jesup [:jesup] (needinfo me)](/user_profile?user_id=11539)  Assignee |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=706249#c3)• 13 years ago |
|  | |

Attached patch

[Patch with tests](attachment.cgi?id=577837&action=diff)
— [Details](attachment.cgi?id=577837&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=706249&attachment=577837)

Tested; asserts without code fix, no assert with it

|  | [Randell Jesup [:jesup] (needinfo me)](/user_profile?user_id=11539)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=706249#a22241_11539)• 13 years ago |

[Attachment #577837](/attachment.cgi?id=577837&action=edit "Patch with tests") -
Flags: review?(bzbarsky)

|  | [Randell Jesup [:jesup] (needinfo me)](/user_profile?user_id=11539)  Assignee |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=706249#c4)• 13 years ago |
|  | |

Worst-case analysis of this bug is it writes a '\0' to the byte following the allocation in some (not all) cases where the password is given but empty.

|  | [Jesse Ruderman](/user_profile?user_id=11608)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=706249#a22885_11608)• 13 years ago |

Whiteboard: [sg:critical]

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=706249#a172290_12352)• 13 years ago |

blocking1.9.2: --- → ?
[status-firefox10](/buglist.cgi?f1=cf_status_firefox10&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=affected)
[status-firefox11](/buglist.cgi?f1=cf_status_firefox11&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox11&o1=equals&v1=affected)
[status-firefox8](/buglist.cgi?f1=cf_status_firefox8&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox8&o1=equals&v1=wontfix)
[status-firefox9](/buglist.cgi?f1=cf_status_firefox9&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=wontfix)
[tracking-firefox10](/buglist.cgi?f1=cf_tracking_firefox10&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox10&o1=equals&v1=%2B)
[tracking-firefox11](/buglist.cgi?f1=cf_tracking_firefox11&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox11&o1=equals&v1=%2B)
[tracking-firefox8](/buglist.cgi?f1=cf_tracking_firefox8&o1=isnotempty):
--- → [-](/buglist.cgi?f1=cf_tracking_firefox8&o1=equals&v1=-)
[tracking-firefox9](/buglist.cgi?f1=cf_tracking_firefox9&o1=isnotempty):
--- → [-](/buglist.cgi?f1=cf_tracking_firefox9&o1=equals&v1=-)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=706249#a172369_1689)• 13 years ago |

[status1.9.2](/buglist.cgi?f1=cf_status_192&o1=isnotempty):
--- → [wanted](/buglist.cgi?f1=cf_status_192&o1=equals&v1=wanted)

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=706249#c5)• 13 years ago |
|  | |

Comment on [attachment 577837](/attachment.cgi?id=577837 "Patch with tests") [[details]](/attachment.cgi?id=577837&action=edit "Patch with tests") [[diff]](/attachment.cgi?id=577837&action=diff "Patch with tests") [[review]](/page.cgi?id=splinter.html&ignore=&bug=706249&attachment=577837)
Patch with tests
r=me
[Attachment #577837](/attachment.cgi?id=577837&action=edit "Patch with tests") -
Flags: review?(bzbarsky) → review+

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=706249#a261960_1689)• 13 years ago |

blocking1.9.2: ? → .25+

|  | [Randell Jesup [:jesup] (needinfo me)](/user_profile?user_id=11539)  Assignee |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=706249#c6)• 13 years ago |
|  | |

inbound via <https://hg.mozilla.org/integration/mozilla-inbound/rev/8304db7e46bb>
The original bug never existed in 1.9.x -> unaffected
Once it's green and merged to m-c I'll ask for approvals for Aurora and Betablocking1.9.2: .25+ → ---
[status1.9.2](/buglist.cgi?f1=cf_status_192&o1=isnotempty):
[wanted](/buglist.cgi?f1=cf_status_192&o1=equals&v1=wanted) → [unaffected](/buglist.cgi?f1=cf_status_192&o1=equals&v1=unaffected)Whiteboard: [sg:critical] → [sg:critical][inbound]

|  | [Randell Jesup [:jesup] (needinfo me)](/user_profile?user_id=11539)  Assignee |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=706249#c7)• 13 years ago |
|  | |

Merged to m-cStatus: NEW → RESOLVEDClosed: 13 years agoResolution: --- → FIXEDWhiteboard: [sg:critical][inbound] → [sg:critical]

|  | [Randell Jesup [:jesup] (needinfo me)](/user_profile?user_id=11539)  Assignee |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=706249#c8)• 13 years ago |
|  | |

Comment on [attachment 577837](/attachment.cgi?id=577837 "Patch with tests") [[details]](/attachment.cgi?id=577837&action=edit "Patch with tests") [[diff]](/attachment.cgi?id=577837&action=diff "Patch with tests") [[review]](/page.cgi?id=splinter.html&ignore=&bug=706249&attachment=577837)
Patch with tests
Now in m-c; we should get it into aurora and beta soon
[Attachment #577837](/attachment.cgi?id=577837&action=edit "Patch with tests") -
Flags: approval-mozilla-beta?
[Attachment #577837](/attachment.cgi?id=577837&action=edit "Patch with tests") -
Flags: approval-mozilla-aurora?

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=706249#c9)• 13 years ago |
|  | |

Comment on [attachment 577837](/attachment.cgi?id=577837 "Patch with tests") [[details]](/attachment.cgi?id=577837&action=edit "Patch with tests") [[diff]](/attachment.cgi?id=577837&action=diff "Patch with tests") [[review]](/page.cgi?id=splinter.html&ignore=&bug=706249&attachment=577837)
Patch with tests
[Triage Comment]
Please land this sg:crit bug on aurora/beta asap so that we can bake this on beta for ~2 weeks.
[Attachment #577837](/attachment.cgi?id=577837&action=edit "Patch with tests") -
Flags: approval-mozilla-beta?
[Attachment #577837](/attachment.cgi?id=577837&action=edit "Patch with tests") -
Flags: approval-mozilla-beta+
[Attachment #577837](/attachment.cgi?id=577837&action=edit "Patch with tests") -
Flags: approval-mozilla-aurora?
[Attachment #577837](/attachment.cgi?id=577837&action=edit "Patch with tests") -
Flags: approval-mozilla-aurora+

|  | [Randell Jesup [:jesup] (needinfo me)](/user_profile?user_id=11539)  Assignee |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=706249#c10)• 13 years ago |
|  | |

Aurora: <https://hg.mozilla.org/releases/mozilla-aurora/rev/12c96ed8154d>
Beta: <https://hg.mozilla.org/releases/mozilla-beta/rev/9f3a16bf8afc>
Tracking for FF9 was confused - it is affected, and it was also approved for beta, so marking fixed. Didn't touch tracking (JST?)
[status-firefox10](/buglist.cgi?f1=cf_status_firefox10&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=fixed)
[status-firefox11](/buglist.cgi?f1=cf_status_firefox11&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox11&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox11&o1=equals&v1=fixed)
[status-firefox9](/buglist.cgi?f1=cf_status_firefox9&o1=isnotempty):
[wontfix](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=wontfix) → [fixed](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=fixed)

|  | [u279076](/user_profile?user_id=279076) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=706249#a692090_279076)• 13 years ago |

Whiteboard: [sg:critical] → [sg:critical][qa+]

|  | [Henrik Skupin [:whimboo][⌚️UTC+2]](/user_profile?user_id=76551) |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=706249#c11)• 13 years ago |
|  | |

Verified fixed with the following tinderbox debug builds:
Mozilla/5.0 (Macintosh; Intel Mac OS X 10.7; rv:11.0a1) Gecko/20111214 Firefox/11.0a1
Mozilla/5.0 (Macintosh; Intel Mac OS X 10.7; rv:10.0a2) Gecko/20111214 Firefox/10.0a2
Mozilla/5.0 (Macintosh; Intel Mac OS X 10.7; rv:9.0) Gecko/20111212 Firefox/9.0
Mozilla/5.0 (X11; Linux i686; rv:9.0) Gecko/20111208 Firefox/9.0
I was not able to check on Windows because all the tinderbox debug builds seem to be broken and I can't start those.Status: RESOLVED → VERIFIEDFlags: in-testsuite+Flags: in-litmus-Keywords: [verified-aurora](/buglist.cgi?keywords=verified-aurora&resolution=---),
[verified-beta](/buglist.cgi?keywords=verified-beta&resolution=---)Whiteboard: [sg:critical][qa+] → [sg:critical][qa!]Target Milestone: --- → mozilla11

|  | [Henrik Skupin [:whimboo][⌚️UTC+2]](/user_profile?user_id=76551) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=706249#a1464822_76551)• 13 years ago |

[status-firefox10](/buglist.cgi?f1=cf_status_firefox10&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=verified)
[status-firefox11](/buglist.cgi?f1=cf_status_firefox11&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox11&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox11&o1=equals&v1=verified)
[status-firefox9](/buglist.cgi?f1=cf_status_firefox9&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=verified)Keywords: [verified-aurora](/buglist.cgi?keywords=verified-aurora&resolution=---),
[verified-beta](/buglist.cgi?keywords=verified-beta&resolution=---)Whiteboard: [sg:critical][qa!] → [sg:critical][qa-]

|  | [Henrik Skupin [:whimboo][⌚️UTC+2]](/user_profile?user_id=76551) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=706249#a1465136_76551)• 13 years ago |

Whiteboard: [sg:critical][qa-] → [sg:critical][qa!]

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=706249#a7444275_1689)• 13 years ago |

Group: core-security
You need to [log in](/show_bug.cgi?id=706249&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Jesse Ruderman](/user_profile?user_id=11608)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from bugzilla.mozilla.org_37154ba8_20250124_235759.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/690376)
* [XML](/show_bug.cgi?ctype=xml&id=690376)

Closed
[Bug 690376](/show_bug.cgi?id=690376)

Opened 13 years ago
Closed 13 years ago

# Crash [@ JSObject::nonNativeSetProperty]

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Crash [@ JSObject::nonNativeSetProperty]

## Categories

### (Core :: JavaScript Engine, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=JavaScript%20Engine#JavaScript%20Engine)

JavaScript Engine
▾

Core :: JavaScript Engine
The interpreter engine for the core JavaScript language, independent of the browser's object model. File ONLY core JavaScript language bugs in this category. For bugs involving browser objects such as "window" and "document", use the "DOM" component. For bugs involving calls between JavaScript and C++, use the "XPConnect" component.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=JavaScript%20Engine&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=JavaScript%20Engine&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=JavaScript%20Engine)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

x86

macOS

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

critical

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla10

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Accessibility Severity | --- |
| --- | --- |
| a11y-review | --- |
| Webcompat Score | --- |
| Webcompat Priority | --- |
| Performance Impact | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox8 | --- | [unaffected](/buglist.cgi?f1=cf_status_firefox8&o1=equals&v1=unaffected) |
| firefox9 | [+](/buglist.cgi?f1=cf_tracking_firefox9&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=fixed) |
| firefox10 | [+](/buglist.cgi?f1=cf_tracking_firefox10&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=fixed) |
| firefox11 | --- | [fixed](/buglist.cgi?f1=cf_status_firefox11&o1=equals&v1=fixed) |
| status1.9.2 | --- | [unaffected](/buglist.cgi?f1=cf_status_192&o1=equals&v1=unaffected) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox8 |  | unaffected |
| firefox9 | + | fixed |
| firefox10 | + | fixed |
| firefox11 |  | fixed |
| status1.9.2 |  | unaffected |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: gkw, Assigned: bhackett1024)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/764aa0af2fda6f02fb17dc9771bb18d9?d=mm&size=40)  [bhackett1024](/user_profile?user_id=346231)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](extensions/Gravatar/web/default.jpg)  [gkw](/user_profile?user_id=132034)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/4fe52ee1503aecf7b6c976b8eb7c1753?d=mm&size=40)  [willyelm](/user_profile?user_id=714609)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

9 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: crash, regression, testcase, Whiteboard: [sg:critical?][qa-] js-triage-needed)

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[crash](/buglist.cgi?keywords=crash&resolution=---),
[regression](/buglist.cgi?keywords=regression&resolution=---),
[testcase](/buglist.cgi?keywords=testcase&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[sg:critical?][qa-] js-triage-needed

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [decoder](/user_profile?user_id=395101) | [in-testsuite](#c12 "12 years ago") | - |
| --- | --- | --- |
| [decoder](/user_profile?user_id=395101) | in-testsuite | - |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (2 files)

| [stack](/attachment.cgi?id=563425)  [13 years ago](#c0)  [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034)   4.19 KB, text/plain |  | [Details](/attachment.cgi?id=563425&action=edit) |
| --- | --- | --- |
| [patch](/attachment.cgi?id=565069)  [13 years ago](#c2)  [Brian Hackett [Laid off!]](/user_profile?user_id=346231)   981 bytes, patch | dvander : [review+](#a562340_309316 "13 years ago")  curtisk : [approval-mozilla-aurora+](#a1057787_406847 "13 years ago") | [Details](/attachment.cgi?id=565069&action=edit) | [Diff](/attachment.cgi?id=565069&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=690376&attachment=565069) |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=690376#c0)• 13 years ago |
|  | |

Attached file
[stack](attachment.cgi?id=563425)
— [Details](attachment.cgi?id=563425&action=edit)

(function() {
function b(c) {
if (c) u = function() {};
this.x = /x/;
switch (c) {
case 4:
case 6:
}
this.r = {}
}
for each(let a in [
new Boolean(true),
0,
new Boolean(true),
function() {},
new Boolean(true),
new Boolean(true),
function() {},
function() {},
function() {}
]) {
try {
new b(a)();
} catch (e) {}
}
})()
crashes js opt shell 64-bit on Mac 10.6 on JM changeset 44ef245b8706 with -m, -a and -j at JSObject::nonNativeSetProperty. Testcase should be passed in as a CLI argument to reproduce.
The $pc value seems to be accessing register r11 at a scary address 0xf1c6d7e000000001 so locking s-s till shown otherwise.

|  | [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034)  Reporter |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=690376#c1)• 13 years ago |
|  | |

Crashes m-c changeset dbb129f069b1 64-bit js shell too, with possibly-related-but-not-really-identical stack.

|  | [Brian Hackett [Laid off!]](/user_profile?user_id=346231)  Assignee |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=690376#c2)• 13 years ago |
|  | |

Attached patch

[patch](attachment.cgi?id=565069&action=diff)
— [Details](attachment.cgi?id=565069&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=690376&attachment=565069)

Codegen bug in JM+TM interaction, introduced in the TI merge I think. JM+TM can enter jitcode at any opcode marked as a safe point, but JM did not guarantee this for safe points that are not the targets of a jump.Assignee: general → bhackett1024
[Attachment #565069](/attachment.cgi?id=565069&action=edit "patch") -
Flags: review?(dvander)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=690376#a550444_1689)• 13 years ago |

Whiteboard: js-triage-needed → [sg:critical?] js-triage-needed

|  | [David Anderson [:dvander] - inactive, e-mail if emergency](/user_profile?user_id=309316) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=690376#a562340_309316)• 13 years ago |

[Attachment #565069](/attachment.cgi?id=565069&action=edit "patch") -
Flags: review?(dvander) → review+

|  | [Brian Hackett [Laid off!]](/user_profile?user_id=346231)  Assignee |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=690376#c3)• 13 years ago |
|  | |

<https://hg.mozilla.org/integration/mozilla-inbound/rev/e456bef5839b>

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=690376#c4)• 13 years ago |
|  | |

Gary: does this crash affect Beta (Firefox 8)? Given the patch (if .. !typeInferenceEnabled()) maybe it does, then again this could have been completely different code prior to the TI landing.
[status-firefox10](/buglist.cgi?f1=cf_status_firefox10&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=affected)
[status-firefox9](/buglist.cgi?f1=cf_status_firefox9&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=affected)
[tracking-firefox10](/buglist.cgi?f1=cf_tracking_firefox10&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox10&o1=equals&v1=%2B)
[tracking-firefox8](/buglist.cgi?f1=cf_tracking_firefox8&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox8&o1=equals&v1=%3F)
[tracking-firefox9](/buglist.cgi?f1=cf_tracking_firefox9&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox9&o1=equals&v1=%2B)Keywords: [regression](/buglist.cgi?keywords=regression&resolution=---),
[regressionwindow-wanted](/buglist.cgi?keywords=regressionwindow-wanted&resolution=---)

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=690376#c5)• 13 years ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/e456bef5839b>Status: NEW → RESOLVEDClosed: 13 years agoResolution: --- → FIXED

|  | [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034)  Reporter |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=690376#c6)• 13 years ago |
|  | |

(In reply to Daniel Veditz from [comment #4](/show_bug.cgi?id=690376#c4 "VERIFIED FIXED - Crash [@ JSObject::nonNativeSetProperty]"))
> Gary: does this crash affect Beta (Firefox 8)? Given the patch (if ..
> !typeInferenceEnabled()) maybe it does, then again this could have been
> completely different code prior to the TI landing.
I have to hold off testing on this, as the minis are in boxes and soon-to-be shipping..

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=690376#c7)• 13 years ago |
|  | |

bhackett: do you know the answer to [comment 4](/show_bug.cgi?id=690376#c4 "VERIFIED FIXED - Crash [@ JSObject::nonNativeSetProperty]")?

|  | [Brian Hackett [Laid off!]](/user_profile?user_id=346231)  Assignee |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=690376#c8)• 13 years ago |
|  | |

(In reply to Daniel Veditz from [comment #7](/show_bug.cgi?id=690376#c7 "VERIFIED FIXED - Crash [@ JSObject::nonNativeSetProperty]"))
> bhackett: do you know the answer to [comment 4](/show_bug.cgi?id=690376#c4 "VERIFIED FIXED - Crash [@ JSObject::nonNativeSetProperty]")?
This should not affect Firefox 8 or earlier. The bug is caused by doing cross-branch register allocation when we shouldn't (when JM+TM is enabled), this kind of register allocation was introduced with the TI merge.

|  | [Brian Hackett [Laid off!]](/user_profile?user_id=346231)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=690376#a971136_346231)• 13 years ago |

[Attachment #565069](/attachment.cgi?id=565069&action=edit "patch") -
Flags: approval-mozilla-aurora?

|  | [Curtis Koenig [:curtisk-use curtis.koenig+bzATgmail.com]]](/user_profile?user_id=406847) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=690376#a1057787_406847)• 13 years ago |

[Attachment #565069](/attachment.cgi?id=565069&action=edit "patch") -
Flags: approval-mozilla-aurora? → approval-mozilla-aurora+

|  | [Brian Hackett [Laid off!]](/user_profile?user_id=346231)  Assignee |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=690376#c9)• 13 years ago |
|  | |

<https://hg.mozilla.org/releases/mozilla-aurora/rev/c0c7322521b7>

|  | [[:Cww]](/user_profile?user_id=297228) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=690376#a2439786_297228)• 13 years ago |

[tracking-firefox8](/buglist.cgi?f1=cf_tracking_firefox8&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox8&o1=equals&v1=%3F) → ---

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=690376#a3040108_12352)• 13 years ago |

[status-firefox10](/buglist.cgi?f1=cf_status_firefox10&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=fixed)
[status-firefox9](/buglist.cgi?f1=cf_status_firefox9&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=fixed)

|  | [LegNeato](/user_profile?user_id=482154) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=690376#a3490855_482154)• 13 years ago |

Target Milestone: --- → mozilla10

|  | [u279076](/user_profile?user_id=279076) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=690376#c10)• 13 years ago |
|  | |

Can someone who is already set up to reproduce this bug please verify the fix?Whiteboard: [sg:critical?] js-triage-needed → [sg:critical?][qa-] js-triage-needed

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=690376#a4687240_1689)• 13 years ago |

[status1.9.2](/buglist.cgi?f1=cf_status_192&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_192&o1=equals&v1=unaffected)
[status-firefox11](/buglist.cgi?f1=cf_status_firefox11&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox11&o1=equals&v1=fixed)
[status-firefox8](/buglist.cgi?f1=cf_status_firefox8&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_firefox8&o1=equals&v1=unaffected)

|  | [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034)  Reporter |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=690376#c11)• 13 years ago |
|  | |

(In reply to Anthony Hughes, Mozilla QA (irc: ashughes) from [comment #10](/show_bug.cgi?id=690376#c10 "VERIFIED FIXED - Crash [@ JSObject::nonNativeSetProperty]"))
> Can someone who is already set up to reproduce this bug please verify the
> fix?
Verified fixed on 64-bit debug and opt builds on Mac 10.6 on m-c changeset bc48009a6bbb.Status: RESOLVED → VERIFIED

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=690376#a12119383_1689)• 13 years ago |

Group: core-security

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101) |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=690376#c12)• 12 years ago |
|  | |

Bug involving TM, but TM is already removed, in-testsuite-.Flags: in-testsuite-

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=690376#a126957350_75935)• 9 years ago |

Keywords: [regressionwindow-wanted](/buglist.cgi?keywords=regressionwindow-wanted&resolution=---)
You need to [log in](/show_bug.cgi?id=690376&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from bugzilla.mozilla.org_f9b8a364_20250124_235806.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/693143)
* [XML](/show_bug.cgi?ctype=xml&id=693143)

Closed
[Bug 693143](/show_bug.cgi?id=693143)

Opened 13 years ago
Closed 13 years ago

# Crash in \_cairo\_dwrite\_font\_face\_scaled\_font\_create

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Crash in \_cairo\_dwrite\_font\_face\_scaled\_font\_create

## Categories

### (Core :: Graphics, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=Graphics#Graphics)

Graphics
▾

Core :: Graphics
Mapping of cross platform rendering interfaces to various 2D graphics APIs
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=Graphics&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=Graphics&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=Graphics)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

8 Branch

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

x86

Windows 7

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

critical

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla11

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Webcompat Score | --- |
| --- | --- |
| Performance Impact | --- |
| a11y-review | --- |
| Accessibility Severity | --- |
| Webcompat Priority | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox8 | [-](/buglist.cgi?f1=cf_tracking_firefox8&o1=equals&v1=-) | [wontfix](/buglist.cgi?f1=cf_status_firefox8&o1=equals&v1=wontfix) |
| firefox9 | [+](/buglist.cgi?f1=cf_tracking_firefox9&o1=equals&v1=%2B) | [verified](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=verified) |
| firefox10 | [+](/buglist.cgi?f1=cf_tracking_firefox10&o1=equals&v1=%2B) | [verified](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=verified) |
| firefox11 | [+](/buglist.cgi?f1=cf_tracking_firefox11&o1=equals&v1=%2B) | [verified](/buglist.cgi?f1=cf_status_firefox11&o1=equals&v1=verified) |
| status1.9.2 | --- | [unaffected](/buglist.cgi?f1=cf_status_192&o1=equals&v1=unaffected) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox8 | - | wontfix |
| firefox9 | + | verified |
| firefox10 | + | verified |
| firefox11 | + | verified |
| status1.9.2 |  | unaffected |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: scoobidiver, Assigned: jfkthame)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/e0f9759e1d7514ae4adfd806869e3c5d?d=mm&size=40)  [jfkthame](/user_profile?user_id=329583)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/43a258096978fdc5ca10d5b423b0c178?d=mm&size=40)  [scoobidiver](/user_profile?user_id=386758)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/17436ade8da1b23d42b3df05b9c4fc77?d=mm&size=40)  [bhood](/user_profile?user_id=697075)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

14 people

## References

### (Blocks 1 open bug, [URL](http://people.mozilla.org/~jdaggett/tests/bitmapfonts-waterfall.html "http://people.mozilla.org/~jdaggett/tests/bitmapfonts-waterfall.html") )

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

[670072](/show_bug.cgi?id=670072 "RESOLVED FIXED - Font sizes smaller than 0.5px are not painted correctly under GDI")

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[708162](/show_bug.cgi?id=708162 "NEW - inconsistent rendering of text with very small font size (<0.5px)")

Dependency [tree](/showdependencytree.cgi?id=693143&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=693143)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[people.mozilla.org/~jdaggett/tests/bi...](http://people.mozilla.org/~jdaggett/tests/bitmapfonts-waterfall.html "http://people.mozilla.org/~jdaggett/tests/bitmapfonts-waterfall.html")

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

[648245](/show_bug.cgi?id=648245 "RESOLVED WORKSFORME - Crash [@ _cairo_dwrite_font_face_scaled_font_create ] when use japanese font \"有澤太楷書P\", \"EPSON 太行書体Ｂ\"")

## Details

### (Keywords: crash, regression, reproducible, Whiteboard: [sg:critical][qa!])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[crash](/buglist.cgi?keywords=crash&resolution=---),
[regression](/buglist.cgi?keywords=regression&resolution=---),
[reproducible](/buglist.cgi?keywords=reproducible&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[sg:critical][qa!]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [whimboo](/user_profile?user_id=76551) | [in-testsuite](#c51 "13 years ago") | + |
| --- | --- | --- |
| [whimboo](/user_profile?user_id=76551) | in-testsuite | + |
| --- | --- | --- |
| [whimboo](/user_profile?user_id=76551) | [in-litmus](#c51 "13 years ago") | - |
| --- | --- | --- |
| [whimboo](/user_profile?user_id=76551) | in-litmus | - | | |
| --- | --- | --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | qe-verify |  |

## Crash Data

Signature:

[[@ \_cairo\_dwrite\_font\_face\_scaled\_font\_create ]](https://crash-stats.mozilla.org/signature/?signature=_cairo_dwrite_font_face_scaled_font_create)

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (5 files, 3 obsolete files)

| [patch, mark GDI font as invalid on cairo backend failure](/attachment.cgi?id=578939)  [13 years ago](#c17)  [Jonathan Kew [:jfkthame]](/user_profile?user_id=329583)   934 bytes, patch |  | [Details](/attachment.cgi?id=578939&action=edit) | [Diff](/attachment.cgi?id=578939&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=693143&attachment=578939) |
| --- | --- | --- |
| [testcase, test a set of bitmap fonts](/attachment.cgi?id=579000)  [13 years ago](#c20)  [John Daggett (:jtd)](/user_profile?user_id=280585)   603 bytes, text/html |  | [Details](/attachment.cgi?id=579000&action=edit) |
| [patch, enforce minimum font size of 1.0](/attachment.cgi?id=579001)  [13 years ago](#c21)  [John Daggett (:jtd)](/user_profile?user_id=280585)   3.31 KB, patch | jfkthame : [review-](#a4915801_329583 "13 years ago") | [Details](/attachment.cgi?id=579001&action=edit) | [Diff](/attachment.cgi?id=579001&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=693143&attachment=579001) |
| [alternate patch, invalidate the font and zero the metrics](/attachment.cgi?id=579253)  [13 years ago](#c31)  [John Daggett (:jtd)](/user_profile?user_id=280585)   3.95 KB, patch |  | [Details](/attachment.cgi?id=579253&action=edit) | [Diff](/attachment.cgi?id=579253&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=693143&attachment=579253) |
| [reftests, will only pass in the GDI case](/attachment.cgi?id=579254)  [13 years ago](#c32)  [John Daggett (:jtd)](/user_profile?user_id=280585)   4.29 KB, patch |  | [Details](/attachment.cgi?id=579254&action=edit) | [Diff](/attachment.cgi?id=579254&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=693143&attachment=579254) |
| [crashtest extracted for the previous patch](/attachment.cgi?id=579257)  [13 years ago](#c33)  [John Daggett (:jtd)](/user_profile?user_id=280585)   968 bytes, patch |  | [Details](/attachment.cgi?id=579257&action=edit) | [Diff](/attachment.cgi?id=579257&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=693143&attachment=579257) |
| [alternate patch, invalidate the font and zero the metrics (GDI only)](/attachment.cgi?id=579553)  [13 years ago](#c39)  [John Daggett (:jtd)](/user_profile?user_id=280585)   13.76 KB, patch | roc : [review+](#a5064709_5038 "13 years ago")  akeybl : [approval-mozilla-aurora+](#c43 "13 years ago")  akeybl : [approval-mozilla-beta+](#c45 "13 years ago") | [Details](/attachment.cgi?id=579553&action=edit) | [Diff](/attachment.cgi?id=579553&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=693143&attachment=579553) |
| [crashtest, test with list of bitmap fonts at small sizes](/attachment.cgi?id=579555)  [13 years ago](#c40)  [John Daggett (:jtd)](/user_profile?user_id=280585)   1.34 KB, patch | roc : [review+](#a5064723_5038 "13 years ago")  akeybl : [approval-mozilla-aurora+](#a5117758_425645 "13 years ago")  akeybl : [approval-mozilla-beta+](#a5225480_425645 "13 years ago") | [Details](/attachment.cgi?id=579555&action=edit) | [Diff](/attachment.cgi?id=579555&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=693143&attachment=579555) |

Show Obsolete

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Scoobidiver (away)](/user_profile?user_id=386758)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=693143#c0)• 13 years ago |
|  | |

It's #35 top crasher in 8.0b1 while it is only #115 in 7.0.1 and #188 in 6.0.2.
There are two kinds of stack traces:
Frame Module Signature [Expand] Source
0 xul.dll \_cairo\_dwrite\_font\_face\_scaled\_font\_create gfx/cairo/cairo/src/cairo-dwrite-font.cpp:462
1 xul.dll \_moz\_cairo\_scaled\_font\_create gfx/cairo/cairo/src/cairo-scaled-font.c:1054
2 xul.dll DCFromContext::DCFromContext gfx/thebes/gfxWindowsPlatform.h:79
3 xul.dll HBGetGlyphAdvance gfx/thebes/gfxHarfBuzzShaper.cpp:266
4 xul.dll hb\_ot\_shape\_execute\_internal gfx/harfbuzz/src/hb-ot-shape.cc:344
5 xul.dll gfxHarfBuzzShaper::InitTextRun gfx/thebes/gfxHarfBuzzShaper.cpp:888
6 xul.dll gfxGDIFont::InitTextRun gfx/thebes/gfxGDIFont.cpp:166
7 xul.dll gfxFont::SplitAndInitTextRun gfx/thebes/gfxFont.cpp:1513
8 xul.dll gfxFontGroup::InitScriptRun gfx/thebes/gfxFont.cpp:2524
9 xul.dll gfxFontGroup::InitTextRun gfx/thebes/gfxFont.cpp:2484
10 xul.dll gfxFontGroup::MakeTextRun gfx/thebes/gfxFont.cpp:2418
11 xul.dll TextRunWordCache::MakeTextRun gfx/thebes/gfxTextRunWordCache.cpp:850
Frame Module Signature [Expand] Source
0 xul.dll \_cairo\_dwrite\_font\_face\_scaled\_font\_create gfx/cairo/cairo/src/cairo-dwrite-font.cpp:462
1 xul.dll \_moz\_cairo\_scaled\_font\_create gfx/cairo/cairo/src/cairo-scaled-font.c:1054
2 xul.dll \_cairo\_gstate\_ensure\_scaled\_font gfx/cairo/cairo/src/cairo-gstate.c:1811
3 xul.dll GetRoundOffsetsToPixels gfx/thebes/gfxHarfBuzzShaper.cpp:932
4 xul.dll gfxHarfBuzzShaper::SetGlyphsFromRun gfx/thebes/gfxHarfBuzzShaper.cpp:1020
5 xul.dll gfxHarfBuzzShaper::InitTextRun gfx/thebes/gfxHarfBuzzShaper.cpp:897
6 xul.dll gfxGDIFont::InitTextRun gfx/thebes/gfxGDIFont.cpp:166
7 xul.dll gfxFont::SplitAndInitTextRun gfx/thebes/gfxFont.cpp:1513
8 xul.dll gfxFontGroup::InitScriptRun gfx/thebes/gfxFont.cpp:2524
9 xul.dll gfxFontGroup::InitTextRun gfx/thebes/gfxFont.cpp:2484
10 xul.dll gfxFontGroup::MakeTextRun gfx/thebes/gfxFont.cpp:2436
11 xul.dll TextRunWordCache::MakeTextRun gfx/thebes/gfxTextRunWordCache.cpp:717
12 xul.dll MakeTextRun layout/generic/nsTextFrameThebes.cpp:551
...
More reports at:
<https://crash-stats.mozilla.com/report/list?signature=_cairo_dwrite_font_face_scaled_font_create&version=Firefox%3A8.0>

|  | [Jeff Muizelaar [:jrmuizel]](/user_profile?user_id=309398) |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=693143#c1)• 13 years ago |
|  | |

I've I had to guess at this I'd guess that font\_face contains uninitialized memory, but it's not obvious to me what would be going on here.

|  | [Scoobidiver (away)](/user_profile?user_id=386758)  Reporter |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=693143#c2)• 13 years ago |
|  | |

In every crash reports I checked, D3D9 and D3D10 are disabled.

|  | [Jonathan Kew [:jfkthame]](/user_profile?user_id=329583)  Assignee |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=693143#c3)• 13 years ago |
|  | |

The problem here is that we're using GDI fonts (see frame 6), but the cairo font didn't get initialized at the appropriate time and then internally cairo has tried to create a fallback font using the DWrite backend (see frame 0). That mixture doesn't work. We fixed something like this previously in [bug 544617](/show_bug.cgi?id=544617 "RESOLVED FIXED - crash [@ _cairo_dwrite_font_face_scaled_font_create]"), but there must be some subtly different conditions here that are leading to a similar problem.

|  | [Joe Drew (not getting mail)](/user_profile?user_id=94) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=693143#c4)• 13 years ago |
|  | |

John, can you take a look at this & pass it off if you're not comfortable?

|  | [Joe Drew (not getting mail)](/user_profile?user_id=94) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=693143#c5)• 13 years ago |
|  | |

Er, whoops, midair.
John, can you take a look at this & pass it off if you're not comfortable?Assignee: nobody → jdaggett

|  | [Bob Clary [:bc] (inactive)](/user_profile?user_id=23402) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=693143#c6)• 13 years ago |
|  | |

1. <http://lizbraswell.com/>
2. Crash Firefox 8 and Beta/9 at address 0xcdcdcdcd IDWriteFontFace \*
If I understand this correctly, this is susceptible to arbitrary code execution?
- &font\_face 0x0017217c \_cairo\_dwrite\_font\_face \* \*
- 0x042b1928 {base={...} font=0x01935110 dwriteface=0xcdcdcdcd } \_cairo\_dwrite\_font\_face \*
+ base {hash\_entry={...} status=CAIRO\_STATUS\_SUCCESS ref\_count={...} ...} \_cairo\_font\_face
+ font 0x01935110 IDWriteFont \*
+ dwriteface 0xcdcdcdcd IDWriteFontFace \*
> xul.dll!\_cairo\_dwrite\_font\_face\_scaled\_font\_create(void \* abstract\_face=0x042b1928, const \_cairo\_matrix \* font\_matrix=0x6831ad38, const \_cairo\_matrix \* ctm=0x6831ada0, const \_cairo\_font\_options \* options=0x00172384, \_cairo\_scaled\_font \* \* font=0x001721b4) Line 462 + 0x10 bytes C++
xul.dll!\_moz\_cairo\_scaled\_font\_create(\_cairo\_font\_face \* font\_face=0x042b1928, const \_cairo\_matrix \* font\_matrix=0x6831ad38, const \_cairo\_matrix \* ctm=0x6831ada0, const \_cairo\_font\_options \* options=0x00172384) Line 1054 + 0x22 bytes C
xul.dll!\_cairo\_gstate\_ensure\_scaled\_font(\_cairo\_gstate \* gstate=0x6831ace8) Line 1811 + 0x21 bytes C
xul.dll!\_cairo\_gstate\_get\_scaled\_font(\_cairo\_gstate \* gstate=0x6831ace8, \_cairo\_scaled\_font \* \* scaled\_font=0x001723bc) Line 1685 + 0x9 bytes C
xul.dll!\_moz\_cairo\_get\_scaled\_font(\_cairo \* cr=0x6831acc8) Line 3260 + 0x10 bytes C
xul.dll!DCFromContext::DCFromContext(gfxContext \* aContext=0x044a2cf8) Line 79 + 0xe bytes C++
xul.dll!gfxUniscribeShaper::InitTextRun(gfxContext \* aContext=0x044a2cf8, gfxTextRun \* aTextRun=0x0797c578, const wchar\_t \* aString=0x0017306c, unsigned int aRunStart=0, unsigned int aRunLength=1, int aRunScript=0) Line 471 C++
xul.dll!gfxGDIFont::InitTextRun(gfxContext \* aContext=0x044a2cf8, gfxTextRun \* aTextRun=0x0797c578, const wchar\_t \* aString=0x0017306c, unsigned int aRunStart=0, unsigned int aRunLength=1, int aRunScript=0, int aPreferPlatformShaping=0) Line 185 + 0x3f bytes C++
xul.dll!gfxFont::SplitAndInitTextRun(gfxContext \* aContext=0x044a2cf8, gfxTextRun \* aTextRun=0x0797c578, const wchar\_t \* aString=0x0017306c, unsigned int aRunStart=0, unsigned int aRunLength=1, int aRunScript=0) Line 1584 + 0x2d bytes C++
xul.dll!gfxFontGroup::InitScriptRun(gfxContext \* aContext=0x044a2cf8, gfxTextRun \* aTextRun=0x0797c578, const wchar\_t \* aString=0x0017306c, unsigned int aTotalLength=1, unsigned int aScriptRunStart=0, unsigned int aScriptRunEnd=1, int aRunScript=0) Line 2606 + 0x20 bytes C++
xul.dll!gfxFontGroup::InitTextRun(gfxContext \* aContext=0x044a2cf8, gfxTextRun \* aTextRun=0x0797c578, const wchar\_t \* aString=0x0017306c, unsigned int aLength=1) Line 2556 C++
xul.dll!gfxFontGroup::MakeTextRun(const unsigned char \* aString=0x680bd385, unsigned int aLength=1, const gfxTextRunFactory::Parameters \* aParams=0x00173130, unsigned int aFlags=35) Line 2491 C++
xul.dll!gfxTextRun::SetSpaceGlyph(gfxFont \* aFont=0x07a797f0, gfxContext \* aContext=0x044a2cf8, unsigned int aCharIndex=0) Line 4347 + 0x22 bytes C++
xul.dll!TextRunWordCache::MakeTextRun(const unsigned char \* aText=0x00174c00, unsigned int aLength=16, gfxFontGroup \* aFontGroup=0x07c714d0, const gfxTextRunFactory::Parameters \* aParams=0x00174b8c, unsigned int aFlags=22282528) Line 824 C++
xul.dll!gfxTextRunWordCache::MakeTextRun(const unsigned char \* aText=0x00174c00, unsigned int aLength=16, gfxFontGroup \* aFontGroup=0x07c714d0, const gfxTextRunFactory::Parameters \* aParams=0x00174b8c, unsigned int aFlags=22282528) Line 1047 C++
xul.dll!MakeTextRun(const unsigned char \* aText=0x00174c00, unsigned int aLength=16, gfxFontGroup \* aFontGroup=0x07c714d0, const gfxTextRunFactory::Parameters \* aParams=0x00174b8c, unsigned int aFlags=22282528) Line 584 + 0x19 bytes C++
xul.dll!BuildTextRunsScanner::BuildTextRunForFrames(void \* aTextBuffer=0x00174c10) Line 1984 + 0x1f bytes C++
xul.dll!BuildTextRunsScanner::FlushFrames(int aFlushLineBreaks=1, int aSuppressTrailingBreak=0) Line 1399 + 0x17 bytes C++
xul.dll!BuildTextRuns(gfxContext \* aContext=0x044a2cf8, nsTextFrame \* aForFrame=0x070100b0, nsIFrame \* aLineContainer=0x0700ffe8, const nsLineList\_iterator \* aForFrameLine=0x001766d4) Line 1331 C++
Reproducible in debug Beta/9 builds on Windows 7 but not on Aurora/10, or Nightly/11
Reproducible in Firefox 8 [bp-65ec9a6e-3ef7-4ef5-91a2-d505e2111110](https://crash-stats.mozilla.org/report/index/65ec9a6e-3ef7-4ef5-91a2-d505e2111110)
See also [bug 648245](/show_bug.cgi?id=648245 "RESOLVED WORKSFORME - Crash [@ _cairo_dwrite_font_face_scaled_font_create ] when use japanese font \"有澤太楷書P\", \"EPSON 太行書体Ｂ\"") but I could not reproduce with that url <http://www.tamasoft.co.jp/ja/general-info/unicode.html>Group: core-securityWhiteboard: [sg:critical]

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=693143#a3405314_12352)• 13 years ago |

[status-firefox10](/buglist.cgi?f1=cf_status_firefox10&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=affected)
[status-firefox11](/buglist.cgi?f1=cf_status_firefox11&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox11&o1=equals&v1=affected)
[status-firefox8](/buglist.cgi?f1=cf_status_firefox8&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox8&o1=equals&v1=wontfix)
[status-firefox9](/buglist.cgi?f1=cf_status_firefox9&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=affected)
[tracking-firefox10](/buglist.cgi?f1=cf_tracking_firefox10&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox10&o1=equals&v1=%2B)
[tracking-firefox11](/buglist.cgi?f1=cf_tracking_firefox11&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox11&o1=equals&v1=%2B)
[tracking-firefox8](/buglist.cgi?f1=cf_tracking_firefox8&o1=isnotempty):
--- → [-](/buglist.cgi?f1=cf_tracking_firefox8&o1=equals&v1=-)
[tracking-firefox9](/buglist.cgi?f1=cf_tracking_firefox9&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox9&o1=equals&v1=%2B)

|  | [Bob Clary [:bc] (inactive)](/user_profile?user_id=23402) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=693143#c7)• 13 years ago |
|  | |

ditto Beta/9 Windows <http://www.sihk.de/share/flip/November2011/files/assets/seo/page39.html>

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=693143#c8)• 13 years ago |
|  | |

John, this crash is still happening. Any updates on a fix here?

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=693143#c9)• 13 years ago |
|  | |

See also [Bug 648245](/show_bug.cgi?id=648245 "RESOLVED WORKSFORME - Crash [@ _cairo_dwrite_font_face_scaled_font_create ] when use japanese font \"有澤太楷書P\", \"EPSON 太行書体Ｂ\"") which may give more clues how to find a reproduceable testcase (Japanese Epson printer font?)See Also: → [648245](/show_bug.cgi?id=648245 "RESOLVED WORKSFORME - Crash [@ _cairo_dwrite_font_face_scaled_font_create ] when use japanese font \"有澤太楷書P\", \"EPSON 太行書体Ｂ\"")

|  | [John Daggett (:jtd)](/user_profile?user_id=280585) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=693143#c10)• 13 years ago |
|  | |

Using the URL in [comment 7](/show_bug.cgi?id=693143#c7 "VERIFIED FIXED - Crash in _cairo_dwrite_font_face_scaled_font_create") I can reproduce this with Firefox 8
Build identifier: Mozilla/5.0 (Windows NT 6.1; WOW64; rv:8.0) Gecko/20100101 Firefox/8.0
Steps to reproduce:
1. about:config -> set 'gfx.direct2d.disabled' to true (this simulates running on a machine with a blacklisted driver)
2. Click on <http://www.sihk.de/share/flip/November2011/files/assets/seo/page39.html>
Result: crash occurs
Also occurs with:
Build identifier: Mozilla/5.0 (Windows NT 6.1; WOW64; rv:9.0) Gecko/20100101 Firefox/9.0
Does not occur with:
Build identifier: Mozilla/5.0 (Windows NT 6.1; WOW64; rv:10.0a2) Gecko/20111201 Firefox/10.0a2
Build identifier: Mozilla/5.0 (Windows NT 6.1; Win64; x64; rv:11.0a1) Gecko/20111201 Firefox/11.0a1

|  | [John Daggett (:jtd)](/user_profile?user_id=280585) |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=693143#c11)• 13 years ago |
|  | |

Analyizing crashes from the past week, confirmed the behavior Jonathan noted in [comment 3](/show_bug.cgi?id=693143#c3 "VERIFIED FIXED - Crash in _cairo_dwrite_font_face_scaled_font_create"):
Total dumps: 1167
gfxGDIFont::InitTextRun 1166
HBGetGlyphAdvance 791
GetRoundOffsetsToPixels 337
\_cairo\_dwrite\_font\_face\_scaled\_font\_create 1167
Next step is to isolate when this got "fixed" and try and figure out the details so we can land the fix on beta/release.

|  | [John Daggett (:jtd)](/user_profile?user_id=280585) |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=693143#c12)• 13 years ago |
|  | |

Using mozilla-central nightlies:
Bad: Gecko/20111028
Good: Gecko/20111029

|  | [Scoobidiver (away)](/user_profile?user_id=386758)  Reporter |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=693143#c13)• 13 years ago |
|  | |

There are still crashes in 10.0a2:
<https://crash-stats.mozilla.com/report/list?version=Firefox%3A10.0a2&range_value=4&range_unit=weeks&signature=_cairo_dwrite_font_face_scaled_font_create>
(In reply to John Daggett (:jtd) from [comment #12](/show_bug.cgi?id=693143#c12 "VERIFIED FIXED - Crash in _cairo_dwrite_font_face_scaled_font_create"))
> Bad: Gecko/20111028
> Good: Gecko/20111029
The working range for this STR is :
<http://hg.mozilla.org/mozilla-central/pushloghtml?fromchange=322354df233d&tochange=dfbe9a0fbf97>Keywords: [reproducible](/buglist.cgi?keywords=reproducible&resolution=---)

|  | [John Daggett (:jtd)](/user_profile?user_id=280585) |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=693143#c14)• 13 years ago |
|  | |

Changes in gfx during this time:
gfxDrawable.cpp: changeset: 79450:e481b6ffc60b
gfxDrawable.cpp: user: Adrian Johnson <ajohnson@redneon.com>
gfxDrawable.cpp: date: Sat Oct 29 19:36:19 2011 +1030
gfxDrawable.cpp: summary: [Bug 691061](/show_bug.cgi?id=691061 "REOPENED - Don't use EXTEND_PAD on printing surfaces") - Don't use EXTEND\_PAD on printing surfaces. r=jmuizelaar
gfxDrawable.cpp:
gfxGDIFontList.cpp: changeset: 79383:21f2d6c4c976
gfxGDIFontList.cpp: user: Jonathan Watt <jwatt@jwatt.org>
gfxGDIFontList.cpp: date: Fri Oct 28 19:33:28 2011 +0100
gfxGDIFontList.cpp: summary: [Bug 695303](/show_bug.cgi?id=695303 "RESOLVED FIXED - Add mozilla::clamped function") - Add a mozilla::clamped function to replace NS\_CLAMP (so side affects of args are evaluated no more than once) and NS\_MIN(max, NS\_MAX(val, min)) (to make code clearer). r=bsmedberg.
gfxGDIFontList.cpp:
gfxGDIFontList.cpp: changeset: 79367:96278b6d8c92
gfxGDIFontList.cpp: user: Adrian Johnson <ajohnson@redneon.com>
gfxGDIFontList.cpp: date: Fri Oct 28 09:58:49 2011 -0400
gfxGDIFontList.cpp: summary: [Bug 454532](/show_bug.cgi?id=454532 "RESOLVED FIXED - Font glyphs incorrectly displayed with certain printer drivers"). Substitute "Courier" with "Courier New". r=jdagget
gfxGDIFontList.cpp:
gfxQuaternion.h: changeset: 79383:21f2d6c4c976
gfxQuaternion.h: user: Jonathan Watt <jwatt@jwatt.org>
gfxQuaternion.h: date: Fri Oct 28 19:33:28 2011 +0100
gfxQuaternion.h: summary: [Bug 695303](/show_bug.cgi?id=695303 "RESOLVED FIXED - Add mozilla::clamped function") - Add a mozilla::clamped function to replace NS\_CLAMP (so side affects of args are evaluated no more than once) and NS\_MIN(max, NS\_MAX(val, min)) (to make code clearer). r=bsmedberg.
gfxQuaternion.h:
I suspect this has something to do with the substitution of Courier with Courier New, I confirmed that the page does include a "Courier,sans-serif" font list. Next step is to confirm this with a local build.

|  | [Jonathan Kew [:jfkthame]](/user_profile?user_id=329583)  Assignee |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=693143#c15)• 13 years ago |
|  | |

Sounds like this is an issue with old .FON-format bitmap fonts, then. You can probably reproduce it on current trunk by specifying a different bitmap font, as we're now force-substituting Courier.

|  | [John Daggett (:jtd)](/user_profile?user_id=280585) |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=693143#c16)• 13 years ago |
|  | |

(In reply to Jonathan Kew (:jfkthame) from [comment #15](/show_bug.cgi?id=693143#c15 "VERIFIED FIXED - Crash in _cairo_dwrite_font_face_scaled_font_create"))
> Sounds like this is an issue with old .FON-format bitmap fonts, then. You
> can probably reproduce it on current trunk by specifying a different bitmap
> font, as we're now force-substituting Courier.
It's the end of my work week, I may have time tomorrow evening to look at this again. My next step was to stub out the substitution code on trunk and try to reproduce it there. Feel free to give it a whirl if you have a Windows 7 machine sitting idle.

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=693143#a4707383_425645)• 13 years ago |

[status1.9.2](/buglist.cgi?f1=cf_status_192&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_192&o1=equals&v1=unaffected)

|  | [Jonathan Kew [:jfkthame]](/user_profile?user_id=329583)  Assignee |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=693143#c17)• 13 years ago |
|  | |

Attached patch

[patch, mark GDI font as invalid on cairo backend failure](attachment.cgi?id=578939&action=diff)
— [Details](attachment.cgi?id=578939&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=693143&attachment=578939)

The crash occurs when the cairo scaled\_font associated with the gfxGDIFont we're trying to use is in an error state. This leads to cairo creating a "toy" font internally using its DW backend, resulting in a mismatch with our code which assumes it's using a GDI font.
It seems that with bitmap .fon fonts such as Courier (prior to the forced Courier New substitution), the call to cairo\_scaled\_font\_create in gfxGDIFont::Initialize() may fail (although I haven't yet traced it to figure out exactly why it's failing). In this case, we print a warning (in debug builds), but still proceed to try and use the font - which is a Bad Thing. We should be marking it as invalid.
There may be some deeper issue to investigate in cairo, as it's not clear to me why cairo\_scaled\_font\_create is failing in this case, but in any case we need to handle the possibility of failure more robustly.
(Tested on a trunk build with the Courier->Courier New substitution backed out, and confirmed that this fixes the crash we were seeing on the page mentioned here.)
[Attachment #578939](/attachment.cgi?id=578939&action=edit "patch, mark GDI font as invalid on cairo backend failure") -
Flags: review?(jdaggett)

|  | [John Daggett (:jtd)](/user_profile?user_id=280585) |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=693143#c18)• 13 years ago |
|  | |

Bug appears to be caused by very small font sizes, the failure occurs when the size on the gfxFont is 0.083px.
Simplified testcase:
data:text/html,<body><div%20style="font-family:%20Courier;%20font-size:%201px;"><span%20style="font-size:%208.3%;">very%20small</span></div></body>

|  | [John Daggett (:jtd)](/user_profile?user_id=280585) |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=693143#c19)• 13 years ago |
|  | |

Comment on [attachment 578939](/attachment.cgi?id=578939 "patch, mark GDI font as invalid on cairo backend failure") [[details]](/attachment.cgi?id=578939&action=edit "patch, mark GDI font as invalid on cairo backend failure") [[diff]](/attachment.cgi?id=578939&action=diff "patch, mark GDI font as invalid on cairo backend failure") [[review]](/page.cgi?id=splinter.html&ignore=&bug=693143&attachment=578939)
patch, mark GDI font as invalid on cairo backend failure
Causes a leak:
WARNING: Textrun cache not empty!: 'mCache.Count() == 0', file c:/builds/mozcentral/gfx/thebes/gfxTextRunWordCache.cpp, line 88
WARNING: Fonts still alive while shutting down gfxFontCache: 'mFonts.Count() == 0', file c:\builds\mozcentral\obj-debug\dist\include\gfxFont.h, line 658
Assertion failed at c:/builds/mozcentral/gfx/cairo/cairo/src/cairo-hash.c:196: hash\_table->live\_entries == 0
Unfortunately, I think we probably need to dig deeper into the cairo code to error out sooner.
[Attachment #578939](/attachment.cgi?id=578939&action=edit "patch, mark GDI font as invalid on cairo backend failure") -
Flags: review?(jdaggett) → review-

|  | [John Daggett (:jtd)](/user_profile?user_id=280585) |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=693143#c20)• 13 years ago |
|  | |

Attached file
[testcase, test a set of bitmap fonts](attachment.cgi?id=579000)
— [Details](attachment.cgi?id=579000&action=edit)

Refined testcase, uses crappy bitmap fonts other than Courier such that this crashes on trunk (yay!).

|  | [John Daggett (:jtd)](/user_profile?user_id=280585) |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=693143#c21)• 13 years ago |
|  | |

Attached patch

[patch, enforce minimum font size of 1.0](attachment.cgi?id=579001&action=diff) (obsolete)
— [Details](attachment.cgi?id=579001&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=693143&attachment=579001)

With crashtest.
[Attachment #579001](/attachment.cgi?id=579001&action=edit "patch, enforce minimum font size of 1.0") -
Flags: review?(jfkthame)

|  | [Jonathan Kew [:jfkthame]](/user_profile?user_id=329583)  Assignee |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=693143#c22)• 13 years ago |
|  | |

(In reply to John Daggett (:jtd) from [comment #19](/show_bug.cgi?id=693143#c19 "VERIFIED FIXED - Crash in _cairo_dwrite_font_face_scaled_font_create"))
> Comment on [attachment 578939](/attachment.cgi?id=578939 "patch, mark GDI font as invalid on cairo backend failure") [[details]](/attachment.cgi?id=578939&action=edit "patch, mark GDI font as invalid on cairo backend failure") [[diff]](/attachment.cgi?id=578939&action=diff "patch, mark GDI font as invalid on cairo backend failure") [[review]](/page.cgi?id=splinter.html&ignore=&bug=693143&attachment=578939) [diff] [details] [review]
> patch, mark GDI font as invalid on cairo backend failure
>
> Causes a leak:
>
> WARNING: Textrun cache not empty!: 'mCache.Count() == 0', file
> c:/builds/mozcentral/gfx/thebes/gfxTextRunWordCache.cpp, line 88
> WARNING: Fonts still alive while shutting down gfxFontCache: 'mFonts.Count()
> == 0', file c:\builds\mozcentral\obj-debug\dist\include\gfxFont.h, line 658
> Assertion failed at
> c:/builds/mozcentral/gfx/cairo/cairo/src/cairo-hash.c:196:
> hash\_table->live\_entries == 0
I'm not seeing this happening on my local build.
I've run across these warnings occasionally (on various platforms) in the past. I don't see why this change would trigger them, though. Marking a gfxFont as invalid just causes it to return FALSE from HasCharacter() for all character codes, so that we will always skip it and fall back to something else, but doesn't affect lifetime of the object.

|  | [John Daggett (:jtd)](/user_profile?user_id=280585) |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=693143#c23)• 13 years ago |
|  | |

(In reply to Jonathan Kew (:jfkthame) from [comment #22](/show_bug.cgi?id=693143#c22 "VERIFIED FIXED - Crash in _cairo_dwrite_font_face_scaled_font_create"))
> I'm not seeing this happening on my local build.
>
> I've run across these warnings occasionally (on various platforms) in the
> past. I don't see why this change would trigger them, though. Marking a
> gfxFont as invalid just causes it to return FALSE from HasCharacter() for
> all character codes, so that we will always skip it and fall back to
> something else, but doesn't affect lifetime of the object.
Interesting. Stepping through the cairo\_scaled\_font\_create code, it looks like the code initializes a data structure and puts it into a hash table and that seems to be the same hash table in the warning message.
The revised patch doesn't hit this code because it doesn't call cairo code to create a size=0 font.

|  | [Jonathan Kew [:jfkthame]](/user_profile?user_id=329583)  Assignee |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=693143#c24)• 13 years ago |
|  | |

(In reply to John Daggett (:jtd) from [comment #21](/show_bug.cgi?id=693143#c21 "VERIFIED FIXED - Crash in _cairo_dwrite_font_face_scaled_font_create"))
> Created [attachment 579001](/attachment.cgi?id=579001 "patch, enforce minimum font size of 1.0") [[details]](/attachment.cgi?id=579001&action=edit "patch, enforce minimum font size of 1.0") [[diff]](/attachment.cgi?id=579001&action=diff "patch, enforce minimum font size of 1.0") [[review]](/page.cgi?id=splinter.html&ignore=&bug=693143&attachment=579001) [diff] [details] [review]
> patch, enforce minimum font size of 1.0
This will regress [bug 670072](/show_bug.cgi?id=670072 "RESOLVED FIXED - Font sizes smaller than 0.5px are not painted correctly under GDI"), which is currently fixed on Win7/GDI, though it is still a problem on XP (and hence is not marked as resolved).

|  | [Jonathan Kew [:jfkthame]](/user_profile?user_id=329583)  Assignee |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=693143#c25)• 13 years ago |
|  | |

(In reply to John Daggett (:jtd) from [comment #23](/show_bug.cgi?id=693143#c23 "VERIFIED FIXED - Crash in _cairo_dwrite_font_face_scaled_font_create"))
> (In reply to Jonathan Kew (:jfkthame) from [comment #22](/show_bug.cgi?id=693143#c22 "VERIFIED FIXED - Crash in _cairo_dwrite_font_face_scaled_font_create"))
> > I'm not seeing this happening on my local build.
> >
> > I've run across these warnings occasionally (on various platforms) in the
> > past. I don't see why this change would trigger them, though. Marking a
> > gfxFont as invalid just causes it to return FALSE from HasCharacter() for
> > all character codes, so that we will always skip it and fall back to
> > something else, but doesn't affect lifetime of the object.
>
> Interesting. Stepping through the cairo\_scaled\_font\_create code, it looks
> like the code initializes a data structure and puts it into a hash table and
> that seems to be the same hash table in the warning message.
>
> The revised patch doesn't hit this code because it doesn't call cairo code
> to create a size=0 font.
The warning can still happen, though, as it's not specific to that size-zero font. I just encountered it on a build that has your patch (and not mine). It seems to like to show up (together with a bunch of messages about leaked URLs), particularly if I shut down the browser immediately after starting up and loading a bugzilla page.
However, this happens equally readily with or without the patches here; it's an unrelated issue. Maybe in certain circumstances we don't reliably shut things down in quite the right sequence. I don't have consistent STR, though; I think it's timing-dependent or something like that.

|  | [Jonathan Kew [:jfkthame]](/user_profile?user_id=329583)  Assignee |  |
| --- | --- | --- |
| [Comment 26](/show_bug.cgi?id=693143#c26)• 13 years ago |
|  | |

Comment on [attachment 578939](/attachment.cgi?id=578939 "patch, mark GDI font as invalid on cairo backend failure") [[details]](/attachment.cgi?id=578939&action=edit "patch, mark GDI font as invalid on cairo backend failure") [[diff]](/attachment.cgi?id=578939&action=diff "patch, mark GDI font as invalid on cairo backend failure") [[review]](/page.cgi?id=splinter.html&ignore=&bug=693143&attachment=578939)
patch, mark GDI font as invalid on cairo backend failure
Re-requesting review on this, as (a) I don't believe it's responsible for the warning/possible leak that sometimes occurs, as noted above; and (b) even if we do something else to avoid problems with small font sizes, we should still handle the possibility of failure here. Currently, we detect the cairo failure, print a warning (in debug builds), and then mark the font as "valid" and continue; that's just wrong.
[Attachment #578939](/attachment.cgi?id=578939&action=edit "patch, mark GDI font as invalid on cairo backend failure") -
Flags: review- → review?(jdaggett)

|  | [Jonathan Kew [:jfkthame]](/user_profile?user_id=329583)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=693143#a4915801_329583)• 13 years ago |

[Attachment #579001](/attachment.cgi?id=579001&action=edit "patch, enforce minimum font size of 1.0") -
Flags: review?(jfkthame) → review-

|  | [John Daggett (:jtd)](/user_profile?user_id=280585) |  |
| --- | --- | --- |
| [Comment 27](/show_bug.cgi?id=693143#c27)• 13 years ago |
|  | |

(In reply to Jonathan Kew (:jfkthame) from [comment #24](/show_bug.cgi?id=693143#c24 "VERIFIED FIXED - Crash in _cairo_dwrite_font_face_scaled_font_create"))
> (In reply to John Daggett (:jtd) from [comment #21](/show_bug.cgi?id=693143#c21 "VERIFIED FIXED - Crash in _cairo_dwrite_font_face_scaled_font_create"))
> > Created [attachment 579001](/attachment.cgi?id=579001 "patch, enforce minimum font size of 1.0") [[details]](/attachment.cgi?id=579001&action=edit "patch, enforce minimum font size of 1.0") [[diff]](/attachment.cgi?id=579001&action=diff "patch, enforce minimum font size of 1.0") [[review]](/page.cgi?id=splinter.html&ignore=&bug=693143&attachment=579001) [diff] [details] [review] [diff] [details] [review]
> > patch, enforce minimum font size of 1.0
>
> This will regress [bug 670072](/show_bug.cgi?id=670072 "RESOLVED FIXED - Font sizes smaller than 0.5px are not painted correctly under GDI"), which is currently fixed on Win7/GDI, though
> it is still a problem on XP (and hence is not marked as resolved).
So you that ROUND is there expressly to make size < 1.0 ==> size = 0?
If that's the case, I think we should back out your fix for 670072 and come up with something that doesn't crash or leak.

|  | [John Daggett (:jtd)](/user_profile?user_id=280585) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=693143#a4916370_280585)• 13 years ago |

Depends on: [670072](/show_bug.cgi?id=670072 "RESOLVED FIXED - Font sizes smaller than 0.5px are not painted correctly under GDI")

|  | [Jonathan Kew [:jfkthame]](/user_profile?user_id=329583)  Assignee |  |
| --- | --- | --- |
| [Comment 28](/show_bug.cgi?id=693143#c28)• 13 years ago |
|  | |

[Attachment 578939](/attachment.cgi?id=578939 "patch, mark GDI font as invalid on cairo backend failure") [[details]](/attachment.cgi?id=578939&action=edit "patch, mark GDI font as invalid on cairo backend failure") [[diff]](/attachment.cgi?id=578939&action=diff "patch, mark GDI font as invalid on cairo backend failure") doesn't crash or leak, AFAICS. It would be correct to make gfx respect the status returned by cairo there, even if we weren't seeing a specific problem that results from ignoring it. Is there any reason \_not\_ to land it?

|  | [John Daggett (:jtd)](/user_profile?user_id=280585) |  |
| --- | --- | --- |
| [Comment 29](/show_bug.cgi?id=693143#c29)• 13 years ago |
|  | |

I looked into the root cause of the cairo font error today. With existing code, when font size is zero, the call to cairo\_scaled\_font\_create within gfxGDIFont::Initialize fails when the font is a bitmap font but is fine when the font is an OpenType font.
I traced through the code and the problem is that due to the way the font matrix is set up in the size == 0 case, a slightly different code path is taken within the Win32 cairo code for this case. The sequence of steps is this:
1. \_win32\_scaled\_font\_create calls \_compute\_transform (f, &scale)
2. \_compute\_transform sets preserve\_axes based on the contents of
the font matrix. Normal case is true, in the size == 0 case
it's set to false.
3. \_win32\_scaled\_font\_create calls \_cairo\_win32\_scaled\_font\_set\_metrics
4. Within \_cairo\_win32\_scaled\_font\_set\_metrics the pseudo-logic below is used:
if (preserve\_axes)
call GetTextMetrics ==> fine for all fonts
else
call \_cairo\_win32\_scaled\_font\_select\_unscaled\_font
call \_win32\_scaled\_font\_get\_unscaled\_hfont
call GetOutlineTextMetrics ==> fails for non-ttf fonts
5. The error ripples out
I'm not quite sure what the intent of preserve\_axes is and why the code path is different for the two cases but the right fix (as opposed to the band-aid) would be to fix up the cairo code so that it doesn't error out in the size == 0 case.
We actually never should have landed the fix for [bug 670072](/show_bug.cgi?id=670072 "RESOLVED FIXED - Font sizes smaller than 0.5px are not painted correctly under GDI") that caused this in the first place because it's only "fixing" the problem for the GDI case. If size < 0.5px is going to imply effectively size == 0 with no effect on layout, then we need to make this work consistently on all platforms. That's actually trickier than it sounds because we have all sorts of assumptions that the size is \*not\* zero and both the font-size-adjust and OSX codepaths clamp the lower bound at 1px. Plus we have assertions in out code that mFUnitsConvFactor is not zero, which it will be in the size == 0.0 case.
In short, the right fix is going to take a lot more work than ROUND(size) in the original patch and certainly a lot more testing across platforms and font types.

|  | [John Daggett (:jtd)](/user_profile?user_id=280585) |  |
| --- | --- | --- |
| [Comment 30](/show_bug.cgi?id=693143#c30)• 13 years ago |
|  | |

Another problem with the current code is that although the size is rounded down to zero, non-zero metrics are still returned. Windows appears to have a lower limit on font size, roughly 2px for OpenType fonts and 6px for non-OpenType fonts. Any size below that is ignored. For the 'font-size: 0px' case the existing code whacks the metrics within SanitizeMetrics so I think the way to correctly get the metrics zero'd out is to change the condition in SanitizeMetrics to look at the adjusted size, not the size in the style. Without this, gfxFont::Draw is called when mAdjustedSize is zero but with it it's never called in that case. I have a feeling this will fix the XP case but I haven't tested that yet.

|  | [John Daggett (:jtd)](/user_profile?user_id=280585) |  |
| --- | --- | --- |
| [Comment 31](/show_bug.cgi?id=693143#c31)• 13 years ago |
|  | |

Attached patch

[alternate patch, invalidate the font and zero the metrics](attachment.cgi?id=579253&action=diff) (obsolete)
— [Details](attachment.cgi?id=579253&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=693143&attachment=579253)

[Attachment #579001](/attachment.cgi?id=579001&action=edit "patch, enforce minimum font size of 1.0") -
Attachment is obsolete: true

|  | [John Daggett (:jtd)](/user_profile?user_id=280585) |  |
| --- | --- | --- |
| [Comment 32](/show_bug.cgi?id=693143#c32)• 13 years ago |
|  | |

Attached patch

[reftests, will only pass in the GDI case](attachment.cgi?id=579254&action=diff)
— [Details](attachment.cgi?id=579254&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=693143&attachment=579254)

Tests to confirm that font sizes < 0.5px don't affect layout

|  | [John Daggett (:jtd)](/user_profile?user_id=280585) |  |
| --- | --- | --- |
| [Comment 33](/show_bug.cgi?id=693143#c33)• 13 years ago |
|  | |

Attached patch

[crashtest extracted for the previous patch](attachment.cgi?id=579257&action=diff) (obsolete)
— [Details](attachment.cgi?id=579257&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=693143&attachment=579257)

[Attachment #579257](/attachment.cgi?id=579257&action=edit "crashtest extracted for the previous patch") -
Flags: review?(jfkthame)

|  | [John Daggett (:jtd)](/user_profile?user_id=280585) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=693143#a5002253_280585)• 13 years ago |

[Attachment #579254](/attachment.cgi?id=579254&action=edit "reftests, will only pass in the GDI case") -
Flags: review?(jfkthame)

|  | [John Daggett (:jtd)](/user_profile?user_id=280585) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=693143#a5002294_280585)• 13 years ago |

Assignee: jdaggett → jfkthame

|  | [John Daggett (:jtd)](/user_profile?user_id=280585) |  |
| --- | --- | --- |
| [Comment 34](/show_bug.cgi?id=693143#c34)• 13 years ago |
|  | |

Confirmed that the alternate patch fixes the drawing problem on XP.

|  | [Jonathan Kew [:jfkthame]](/user_profile?user_id=329583)  Assignee |  |
| --- | --- | --- |
| [Comment 35](/show_bug.cgi?id=693143#c35)• 13 years ago |
|  | |

Comment on [attachment 579253](/attachment.cgi?id=579253 "alternate patch, invalidate the font and zero the metrics") [[details]](/attachment.cgi?id=579253&action=edit "alternate patch, invalidate the font and zero the metrics") [[diff]](/attachment.cgi?id=579253&action=diff "alternate patch, invalidate the font and zero the metrics") [[review]](/page.cgi?id=splinter.html&ignore=&bug=693143&attachment=579253)
alternate patch, invalidate the font and zero the metrics
Review of [attachment 579253](/attachment.cgi?id=579253 "alternate patch, invalidate the font and zero the metrics") [[details]](/attachment.cgi?id=579253&action=edit "alternate patch, invalidate the font and zero the metrics") [[diff]](/attachment.cgi?id=579253&action=diff "alternate patch, invalidate the font and zero the metrics") [[review]](/page.cgi?id=splinter.html&ignore=&bug=693143&attachment=579253):
-----------------------------------------------------------------
::: gfx/thebes/gfxFont.cpp
@@ +1831,5 @@
> gfxFont::SanitizeMetrics(gfxFont::Metrics \*aMetrics, bool aIsBadUnderlineFont)
> {
> // Even if this font size is zero, this font is created with non-zero size.
> // However, for layout and others, we should return the metrics of zero size font.
> + if (mAdjustedSize == 0.0) {
I think this may break things on Linux and Android (and probably OS/2), as the FT2 backend doesn't appear to set mAdjustedSize at all AFAICS.

|  | [Jonathan Kew [:jfkthame]](/user_profile?user_id=329583)  Assignee |  |
| --- | --- | --- |
| [Comment 36](/show_bug.cgi?id=693143#c36)• 13 years ago |
|  | |

(In reply to John Daggett (:jtd) from [comment #29](/show_bug.cgi?id=693143#c29 "VERIFIED FIXED - Crash in _cairo_dwrite_font_face_scaled_font_create"))
> We actually never should have landed the fix for [bug 670072](/show_bug.cgi?id=670072 "RESOLVED FIXED - Font sizes smaller than 0.5px are not painted correctly under GDI") that caused this
> in the first place because it's only "fixing" the problem for the GDI case.
> If size < 0.5px is going to imply effectively size == 0 with no effect on
> layout, then we need to make this work consistently on all platforms.
I don't think that's necessarily true, nor is it critical to fixing \_this\_ bug. I don't see any reason why size < 0.5px should necessarily map to size = 0 on all platforms. It does under GDI because GDI doesn't support tiny fractional font sizes, but that's no reason other platforms have to be bound by the same constraint. If an author tries to render some text with a 0.1px font, that's what they should get - within the limitations of the platform capabilities, which in some cases may mean rounding the size to 0px.
I'd argue that we should fix this bug right now, by landing the patch that marks a font as invalid if cairo\_create\_scaled\_font fails (for any reason - there might potentially be other failure modes besides zero-sized fonts). If we want to consider other changes to how tiny font sizes are handled across various platforms, that's a distinct topic and should be a separate bug.

|  | [John Daggett (:jtd)](/user_profile?user_id=280585) |  |
| --- | --- | --- |
| [Comment 37](/show_bug.cgi?id=693143#c37)• 13 years ago |
|  | |

(In reply to Jonathan Kew (:jfkthame) from [comment #36](/show_bug.cgi?id=693143#c36 "VERIFIED FIXED - Crash in _cairo_dwrite_font_face_scaled_font_create"))
> I don't think that's necessarily true, nor is it critical to fixing \_this\_
> bug. I don't see any reason why size < 0.5px should necessarily map to size
> = 0 on all platforms. It does under GDI because GDI doesn't support tiny
> fractional font sizes, but that's no reason other platforms have to be bound
> by the same constraint. If an author tries to render some text with a 0.1px
> font, that's what they should get - within the limitations of the platform
> capabilities, which in some cases may mean rounding the size to 0px.
It should have never landed because it makes rendering inconsistent across platforms/os. Handling fractional sizes is a \*separate\* issue from how subpixel sizes are dealt with. If we decide that text < 0.5px means invisible text (modulo min font size), then that behavior should be consistent.
I agree that we should fix the crash first but a simple way of doing that is backing out the original patch which causes it and which turned out not to be a complete fix anyways (i.e. only in the GDI/Win7 case).

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Comment 38](/show_bug.cgi?id=693143#c38)• 13 years ago |
|  | |

[Triage Comment]
We either need to get an r+'d patch or a backout of 670072 in today before we go to build. Please nominate for aurora/beta and email me at alex.keybl@gmail.com as soon as we're ready. Thanks!

|  | [John Daggett (:jtd)](/user_profile?user_id=280585) |  |
| --- | --- | --- |
| [Comment 39](/show_bug.cgi?id=693143#c39)• 13 years ago |
|  | |

Attached patch

[alternate patch, invalidate the font and zero the metrics (GDI only)](attachment.cgi?id=579553&action=diff)
— [Details](attachment.cgi?id=579553&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=693143&attachment=579553)

This includes Jonathan's patch and adds the logic set up null metrics so that nothing is drawn in the XP case. This will only affect the GDI font case (i.e. XP or Win7/Vista with no hw acceleration).
I'll log a separate bug for fixing the inconsistency across platform/os of < 0.5px fonts.
[Attachment #579253](/attachment.cgi?id=579253&action=edit "alternate patch, invalidate the font and zero the metrics") -
Attachment is obsolete: true
[Attachment #579553](/attachment.cgi?id=579553&action=edit "alternate patch, invalidate the font and zero the metrics (GDI only)") -
Flags: review?(roc)

|  | [John Daggett (:jtd)](/user_profile?user_id=280585) |  |
| --- | --- | --- |
| [Comment 40](/show_bug.cgi?id=693143#c40)• 13 years ago |
|  | |

Attached patch

[crashtest, test with list of bitmap fonts at small sizes](attachment.cgi?id=579555&action=diff)
— [Details](attachment.cgi?id=579555&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=693143&attachment=579555)

crashtest for this
[Attachment #579257](/attachment.cgi?id=579257&action=edit "crashtest extracted for the previous patch") -
Attachment is obsolete: true
[Attachment #579257](/attachment.cgi?id=579257&action=edit "crashtest extracted for the previous patch") -
Flags: review?(jfkthame)
[Attachment #579555](/attachment.cgi?id=579555&action=edit "crashtest, test with list of bitmap fonts at small sizes") -
Flags: review?(roc)

|  | [John Daggett (:jtd)](/user_profile?user_id=280585) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=693143#a5064081_280585)• 13 years ago |

[Attachment #579254](/attachment.cgi?id=579254&action=edit "reftests, will only pass in the GDI case") -
Flags: review?(jfkthame)

|  | [John Daggett (:jtd)](/user_profile?user_id=280585) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=693143#a5064095_280585)• 13 years ago |

[Attachment #578939](/attachment.cgi?id=578939&action=edit "patch, mark GDI font as invalid on cairo backend failure") -
Flags: review?(jdaggett)

|  | [Robert O'Callahan (:roc) (email my personal email if necessary)](/user_profile?user_id=5038) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=693143#a5064709_5038)• 13 years ago |

[Attachment #579553](/attachment.cgi?id=579553&action=edit "alternate patch, invalidate the font and zero the metrics (GDI only)") -
Flags: review?(roc) → review+

|  | [Robert O'Callahan (:roc) (email my personal email if necessary)](/user_profile?user_id=5038) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=693143#a5064723_5038)• 13 years ago |

[Attachment #579555](/attachment.cgi?id=579555&action=edit "crashtest, test with list of bitmap fonts at small sizes") -
Flags: review?(roc) → review+

|  | [Robert O'Callahan (:roc) (email my personal email if necessary)](/user_profile?user_id=5038) |  |
| --- | --- | --- |
| [Comment 41](/show_bug.cgi?id=693143#c41)• 13 years ago |
|  | |

(In reply to John Daggett (:jtd) from [comment #37](/show_bug.cgi?id=693143#c37 "VERIFIED FIXED - Crash in _cairo_dwrite_font_face_scaled_font_create"))
> It should have never landed because it makes rendering inconsistent across
> platforms/os. Handling fractional sizes is a \*separate\* issue from how
> subpixel sizes are dealt with. If we decide that text < 0.5px means
> invisible text (modulo min font size), then that behavior should be
> consistent.
Rendering is never perfectly consistent across platforms. The fact that GDI explodes when we try to pass too small a font size, so we need to make text disappear, doesn't mean we need to replicate the fix on all platforms.
Having said that, I think it would probably be fine to make all platforms draw nothing for font sizes < 1px. The only thing I'd worry about is if someone draws, say, 0.5px text with a large scale-up transform. But wouldn't hinting and spacing be quite broken anyway?

|  | [John Daggett (:jtd)](/user_profile?user_id=280585) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=693143#a5067486_280585)• 13 years ago |

Blocks: [708162](/show_bug.cgi?id=708162 "NEW - inconsistent rendering of text with very small font size (<0.5px)")

|  | [John Daggett (:jtd)](/user_profile?user_id=280585) |  |
| --- | --- | --- |
| [Comment 42](/show_bug.cgi?id=693143#c42)• 13 years ago |
|  | |

Landed on trunk:
<https://hg.mozilla.org/mozilla-central/rev/365d0a50014a>
<https://hg.mozilla.org/mozilla-central/rev/86e70adaf190>Status: NEW → RESOLVEDClosed: 13 years agoResolution: --- → FIXED

|  | [John Daggett (:jtd)](/user_profile?user_id=280585) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=693143#a5081351_280585)• 13 years ago |

[Attachment #579553](/attachment.cgi?id=579553&action=edit "alternate patch, invalidate the font and zero the metrics (GDI only)") -
Flags: approval-mozilla-beta?
[Attachment #579553](/attachment.cgi?id=579553&action=edit "alternate patch, invalidate the font and zero the metrics (GDI only)") -
Flags: approval-mozilla-aurora?

|  | [John Daggett (:jtd)](/user_profile?user_id=280585) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=693143#a5081378_280585)• 13 years ago |

[Attachment #579555](/attachment.cgi?id=579555&action=edit "crashtest, test with list of bitmap fonts at small sizes") -
Flags: approval-mozilla-beta?
[Attachment #579555](/attachment.cgi?id=579555&action=edit "crashtest, test with list of bitmap fonts at small sizes") -
Flags: approval-mozilla-aurora?

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Comment 43](/show_bug.cgi?id=693143#c43)• 13 years ago |
|  | |

Comment on [attachment 579553](/attachment.cgi?id=579553 "alternate patch, invalidate the font and zero the metrics (GDI only)") [[details]](/attachment.cgi?id=579553&action=edit "alternate patch, invalidate the font and zero the metrics (GDI only)") [[diff]](/attachment.cgi?id=579553&action=diff "alternate patch, invalidate the font and zero the metrics (GDI only)") [[review]](/page.cgi?id=splinter.html&ignore=&bug=693143&attachment=579553)
alternate patch, invalidate the font and zero the metrics (GDI only)
[Triage Comment]
This ended up missing our go-to-build last night, so let's first take this on aurora and land on beta early next week after further testing on m-c/aurora.
[Attachment #579553](/attachment.cgi?id=579553&action=edit "alternate patch, invalidate the font and zero the metrics (GDI only)") -
Flags: approval-mozilla-aurora? → approval-mozilla-aurora+

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=693143#a5117758_425645)• 13 years ago |

[Attachment #579555](/attachment.cgi?id=579555&action=edit "crashtest, test with list of bitmap fonts at small sizes") -
Flags: approval-mozilla-aurora? → approval-mozilla-aurora+

|  | [u279076](/user_profile?user_id=279076) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=693143#a5134687_279076)• 13 years ago |

Whiteboard: [sg:critical] → [sg:critical][qa+]

|  | [John Daggett (:jtd)](/user_profile?user_id=280585) |  |
| --- | --- | --- |
| [Comment 44](/show_bug.cgi?id=693143#c44)• 13 years ago |
|  | |

For QA use:
Steps to reproduce
1. Set up a profile on a Windows 7 machine
2. about:config, set gfx.direct2d.disabled to true
3. Restart
4. Open URL
FF8/9/10 ==> crash, trunk code ==> tra la!URL: [http://people.mozilla.org/~jdaggett/t...](http://people.mozilla.org/~jdaggett/tests/bitmapfonts-waterfall.html)

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Comment 45](/show_bug.cgi?id=693143#c45)• 13 years ago |
|  | |

Comment on [attachment 579553](/attachment.cgi?id=579553 "alternate patch, invalidate the font and zero the metrics (GDI only)") [[details]](/attachment.cgi?id=579553&action=edit "alternate patch, invalidate the font and zero the metrics (GDI only)") [[diff]](/attachment.cgi?id=579553&action=diff "alternate patch, invalidate the font and zero the metrics (GDI only)") [[review]](/page.cgi?id=splinter.html&ignore=&bug=693143&attachment=579553)
alternate patch, invalidate the font and zero the metrics (GDI only)
[Triage Comment]
Approving for Beta as well because this is a high value backout. Can we get a try build of beta+693143 to pass off to QA ahead of our beta 6 go to build?
[Attachment #579553](/attachment.cgi?id=579553&action=edit "alternate patch, invalidate the font and zero the metrics (GDI only)") -
Flags: approval-mozilla-beta? → approval-mozilla-beta+

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=693143#a5225480_425645)• 13 years ago |

[Attachment #579555](/attachment.cgi?id=579555&action=edit "crashtest, test with list of bitmap fonts at small sizes") -
Flags: approval-mozilla-beta? → approval-mozilla-beta+

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Comment 46](/show_bug.cgi?id=693143#c46)• 13 years ago |
|  | |

Adding qawanted for the try build.Keywords: [qawanted](/buglist.cgi?keywords=qawanted&resolution=---)

|  | [John Daggett (:jtd)](/user_profile?user_id=280585) |  |
| --- | --- | --- |
| [Comment 47](/show_bug.cgi?id=693143#c47)• 13 years ago |
|  | |

Pushed to aurora
<https://hg.mozilla.org/releases/mozilla-aurora/rev/2453d5384fea>
<https://hg.mozilla.org/releases/mozilla-aurora/rev/8532e30e372a>
Pushed beta patches to try
<http://hg.mozilla.org/try/pushloghtml?changeset=99078012adf2>
[http://ftp.mozilla.org/pub/mozilla.org/firefox/try-builds/jdaggett@mozilla.com-99078012adf2](http://ftp.mozilla.org/pub/mozilla.org/firefox/try-builds/jdaggett%40mozilla.com-99078012adf2)

|  | [John Daggett (:jtd)](/user_profile?user_id=280585) |  |
| --- | --- | --- |
| [Comment 48](/show_bug.cgi?id=693143#c48)• 13 years ago |
|  | |

Pushed to beta
<https://hg.mozilla.org/releases/mozilla-beta/rev/f4e11a42ed9a>
<https://hg.mozilla.org/releases/mozilla-beta/rev/eb256dc10994>

|  | [Scoobidiver (away)](/user_profile?user_id=386758)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=693143#a5257163_386758)• 13 years ago |

[status-firefox10](/buglist.cgi?f1=cf_status_firefox10&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=fixed)
[status-firefox11](/buglist.cgi?f1=cf_status_firefox11&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox11&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox11&o1=equals&v1=fixed)
[status-firefox9](/buglist.cgi?f1=cf_status_firefox9&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=fixed)Target Milestone: --- → mozilla11

|  | [u279076](/user_profile?user_id=279076) |  |
| --- | --- | --- |
| [Comment 49](/show_bug.cgi?id=693143#c49)• 13 years ago |
|  | |

Using the tryserver build on Windows 7 and the following steps...
1. Started Try server build with a new profile.
2. Built an amount of history items, bookmarked pages, grouped a few tabs in Panorama, installed Download Helper add-on. The profile had most popular plugins installed: Real Player, Quick Time, Shockwave, Java.
3. Set gfx.direct2d.disabled to true in about:config.
4. Restarted Firefox.
5. Opened <http://people.mozilla.org/~jdaggett/tests/bitmapfonts-waterfall.html>
...we only see blue text; no red text and no crash. The try build seems good enough, though I will let John and Alex make that call.

|  | [John Daggett (:jtd)](/user_profile?user_id=280585) |  |
| --- | --- | --- |
| [Comment 50](/show_bug.cgi?id=693143#c50)• 13 years ago |
|  | |

(In reply to Anthony Hughes, Mozilla QA (irc: ashughes) from [comment #49](/show_bug.cgi?id=693143#c49 "VERIFIED FIXED - Crash in _cairo_dwrite_font_face_scaled_font_create"))
> ...we only see blue text; no red text and no crash. The try build seems good
> enough, though I will let John and Alex make that call.
The key is you didn't crash! You should see blue text but no red text in both the default profile case (DirectWrite) and the no-D2D case (GDI).

|  | [Henrik Skupin [:whimboo][⌚️UTC+2]](/user_profile?user_id=76551) |  |
| --- | --- | --- |
| [Comment 51](/show_bug.cgi?id=693143#c51)• 13 years ago |
|  | |

Verified fixed with Tinderbox builds and the both test cases (crash + blue letters) on Windows 7:
Mozilla/5.0 (Windows NT 6.1; rv:11.0a1) Gecko/20111212 Firefox/11.0a1
Mozilla/5.0 (Windows NT 6.1; rv:10.0a2) Gecko/20111208 Firefox/10.0a2
Mozilla/5.0 (Windows NT 6.1; rv:9.0) Gecko/20111208 Firefox/9.0Status: RESOLVED → VERIFIEDFlags: in-testsuite+Flags: in-litmus-Keywords: [qawanted](/buglist.cgi?keywords=qawanted&resolution=---) → [verified-aurora](/buglist.cgi?keywords=verified-aurora&resolution=---),
[verified-beta](/buglist.cgi?keywords=verified-beta&resolution=---)Whiteboard: [sg:critical][qa+] → [sg:critical][qa!]

|  | [Henrik Skupin [:whimboo][⌚️UTC+2]](/user_profile?user_id=76551) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=693143#a5908577_76551)• 13 years ago |

[status-firefox10](/buglist.cgi?f1=cf_status_firefox10&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=verified)
[status-firefox11](/buglist.cgi?f1=cf_status_firefox11&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox11&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox11&o1=equals&v1=verified)
[status-firefox9](/buglist.cgi?f1=cf_status_firefox9&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=verified)Keywords: [verified-aurora](/buglist.cgi?keywords=verified-aurora&resolution=---),
[verified-beta](/buglist.cgi?keywords=verified-beta&resolution=---)Whiteboard: [sg:critical][qa!] → [sg:critical][qa-]

|  | [Henrik Skupin [:whimboo][⌚️UTC+2]](/user_profile?user_id=76551) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=693143#a5908911_76551)• 13 years ago |

Whiteboard: [sg:critical][qa-] → [sg:critical][qa!]

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=693143#a11888206_1689)• 13 years ago |

Group: core-security
You need to [log in](/show_bug.cgi?id=693143&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Jonathan Kew [:jfkthame]](/user_profile?user_id=329583)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from bugzilla.mozilla.org_6b78d831_20250124_235824.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/701248)
* [XML](/show_bug.cgi?ctype=xml&id=701248)

Closed
[Bug 701248](/show_bug.cgi?id=701248)

Opened 13 years ago
Closed 13 years ago

# Assertion failure: ((js::SrcNoteType)(((\*(sn) >> 3) >= SRC\_XDELTA) ? SRC\_XDELTA : \*(sn) >> 3)) == SRC\_DESTRUCT, at jsopcode.cpp:3543

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Assertion failure: ((js::SrcNoteType)(((\*(sn) >> 3) >= SRC\_XDELTA) ? SRC\_XDELTA : \*(sn) >> 3)) == SRC\_DESTRUCT, at jsopcode.cpp:3543

## Categories

### (Core :: JavaScript Engine, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=JavaScript%20Engine#JavaScript%20Engine)

JavaScript Engine
▾

Core :: JavaScript Engine
The interpreter engine for the core JavaScript language, independent of the browser's object model. File ONLY core JavaScript language bugs in this category. For bugs involving browser objects such as "window" and "document", use the "DOM" component. For bugs involving calls between JavaScript and C++, use the "XPConnect" component.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=JavaScript%20Engine&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=JavaScript%20Engine&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=JavaScript%20Engine)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

x86\_64

Linux

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

critical

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

---

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Webcompat Priority | --- |
| --- | --- |
| Webcompat Score | --- |
| a11y-review | --- |
| Performance Impact | --- |
| Accessibility Severity | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox8 | [-](/buglist.cgi?f1=cf_tracking_firefox8&o1=equals&v1=-) | [wontfix](/buglist.cgi?f1=cf_status_firefox8&o1=equals&v1=wontfix) |
| firefox9 | [+](/buglist.cgi?f1=cf_tracking_firefox9&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=fixed) |
| firefox10 | [+](/buglist.cgi?f1=cf_tracking_firefox10&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=fixed) |
| firefox11 | [+](/buglist.cgi?f1=cf_tracking_firefox11&o1=equals&v1=%2B) | [verified](/buglist.cgi?f1=cf_status_firefox11&o1=equals&v1=verified) |
| status1.9.2 | --- | [unaffected](/buglist.cgi?f1=cf_status_192&o1=equals&v1=unaffected) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox8 | - | wontfix |
| firefox9 | + | fixed |
| firefox10 | + | fixed |
| firefox11 | + | verified |
| status1.9.2 |  | unaffected |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: decoder, Assigned: Waldo)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/d26a0ca7ae1134e0e1dbdddf82e28929?d=mm&size=40)  [Waldo](/user_profile?user_id=83595)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/b29b83d12aba827b8ff68296e473bec5?d=mm&size=40)  [decoder](/user_profile?user_id=395101)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/4fe52ee1503aecf7b6c976b8eb7c1753?d=mm&size=40)  [willyelm](/user_profile?user_id=714609)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

9 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

[685321](/show_bug.cgi?id=685321 "VERIFIED FIXED - Assertion failure: [infer failure] Missing type pushed 0: int, at jsinfer.cpp:341 with destructuring assignment")

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

Dependency [tree](/showdependencytree.cgi?id=701248&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=701248)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: assertion, testcase, verified-beta, Whiteboard: [sg:critical] fixed by 685321 [qa!])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[assertion](/buglist.cgi?keywords=assertion&resolution=---),
[testcase](/buglist.cgi?keywords=testcase&resolution=---),
[verified-beta](/buglist.cgi?keywords=verified-beta&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[sg:critical] fixed by 685321 [qa!]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [decoder](/user_profile?user_id=395101) | [in-testsuite](#c9 "12 years ago") | + |
| --- | --- | --- |
| [decoder](/user_profile?user_id=395101) | in-testsuite | + |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=701248#c0)• 13 years ago |
|  | |

The following test asserts on mozilla-central revision c60535115ea1 (no options required):
function F(x, y) {
var { j, y, p, a } = testSyntax("#1=<a>b</a>", true) = this;
}
var src = F.toSource(-1)+"\n";
Could be related to a decompiler patch that landed recently, Cc'ing Luke and Waldo.

|  | [Jeff Walden [:Waldo]](/user_profile?user_id=83595)  Assignee |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=701248#c1)• 13 years ago |
|  | |

Reduced somewhat (potentially morphing, but I don't quite think so), I get this:
(function F(x) { var {x} = this; }).toSource(-1);
That implicates [bug 685321](/show_bug.cgi?id=685321 "VERIFIED FIXED - Assertion failure: [infer failure] Missing type pushed 0: int, at jsinfer.cpp:341 with destructuring assignment"), which I really need to get to soon. :-\Group: core-security

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=701248#c2)• 13 years ago |
|  | |

"depends on" rather than "dupe" in case of morphing, but if a patch for that bug fixes this one we can dupe at that time. Please include both Christian's original and your variant as regression tests when you check in.Depends on: [685321](/show_bug.cgi?id=685321 "VERIFIED FIXED - Assertion failure: [infer failure] Missing type pushed 0: int, at jsinfer.cpp:341 with destructuring assignment")Whiteboard: js-triage-needed → [sg:critical] js-triage-needed

|  | [David Mandelin [:dmandelin]](/user_profile?user_id=294323) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=701248#c3)• 13 years ago |
|  | |

Jeff, recording you as assignee since you're working on the likely dup.Assignee: general → jwalden+bmo

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=701248#a677148_12352)• 13 years ago |

[status-firefox10](/buglist.cgi?f1=cf_status_firefox10&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=affected)
[status-firefox11](/buglist.cgi?f1=cf_status_firefox11&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox11&o1=equals&v1=affected)
[status-firefox8](/buglist.cgi?f1=cf_status_firefox8&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox8&o1=equals&v1=wontfix)
[status-firefox9](/buglist.cgi?f1=cf_status_firefox9&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=affected)
[tracking-firefox10](/buglist.cgi?f1=cf_tracking_firefox10&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox10&o1=equals&v1=%2B)
[tracking-firefox11](/buglist.cgi?f1=cf_tracking_firefox11&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox11&o1=equals&v1=%2B)
[tracking-firefox8](/buglist.cgi?f1=cf_tracking_firefox8&o1=isnotempty):
--- → [-](/buglist.cgi?f1=cf_tracking_firefox8&o1=equals&v1=-)
[tracking-firefox9](/buglist.cgi?f1=cf_tracking_firefox9&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox9&o1=equals&v1=%2B)

|  | [David Mandelin [:dmandelin]](/user_profile?user_id=294323) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=701248#a1629817_294323)• 13 years ago |

Status: NEW → RESOLVEDClosed: 13 years agoResolution: --- → DUPLICATE

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=701248#c5)• 13 years ago |
|  | |

Would like decoder to verify that the fix for [bug 685321](/show_bug.cgi?id=685321 "VERIFIED FIXED - Assertion failure: [infer failure] Missing type pushed 0: int, at jsinfer.cpp:341 with destructuring assignment") really does fix his testcase.
[status-firefox11](/buglist.cgi?f1=cf_status_firefox11&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox11&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox11&o1=equals&v1=fixed)Resolution: DUPLICATE → FIXEDWhiteboard: [sg:critical] js-triage-needed → [sg:critical] fixed by 685321

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=701248#c6)• 13 years ago |
|  | |

Confirmed that the test in [comment 0](/show_bug.cgi?id=701248#c0 "VERIFIED FIXED - Assertion failure: ((js::SrcNoteType)(((*(sn) >> 3) >= SRC_XDELTA) ? SRC_XDELTA : *(sn) >> 3)) == SRC_DESTRUCT, at jsopcode.cpp:3543") no longer reproduces on trunk.

|  | [u279076](/user_profile?user_id=279076) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=701248#a2927346_279076)• 13 years ago |

Whiteboard: [sg:critical] fixed by 685321 → [sg:critical] fixed by 685321 [qa+]

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=701248#c7)• 13 years ago |
|  | |

Fixed in 10 by [bug 685321](/show_bug.cgi?id=685321 "VERIFIED FIXED - Assertion failure: [infer failure] Missing type pushed 0: int, at jsinfer.cpp:341 with destructuring assignment").
[status-firefox10](/buglist.cgi?f1=cf_status_firefox10&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=fixed)
[status-firefox9](/buglist.cgi?f1=cf_status_firefox9&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=fixed)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=701248#a5535204_1689)• 13 years ago |

[status1.9.2](/buglist.cgi?f1=cf_status_192&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_192&o1=equals&v1=unaffected)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=701248#a8543227_1689)• 13 years ago |

Group: core-security

|  | [Mihaela Velimiroviciu (:mihaelav)](/user_profile?user_id=421899) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=701248#c8)• 13 years ago |
|  | |

OS: Ubuntu 11.04 64bit
I have built the js from mozilla-beta-52cf2b0c8439 and run the tests from [comment #0](/show_bug.cgi?id=701248#c0 "VERIFIED FIXED - Assertion failure: ((js::SrcNoteType)(((*(sn) >> 3) >= SRC_XDELTA) ? SRC_XDELTA : *(sn) >> 3)) == SRC_DESTRUCT, at jsopcode.cpp:3543") and [comment #1](/show_bug.cgi?id=701248#c1 "VERIFIED FIXED - Assertion failure: ((js::SrcNoteType)(((*(sn) >> 3) >= SRC_XDELTA) ? SRC_XDELTA : *(sn) >> 3)) == SRC_DESTRUCT, at jsopcode.cpp:3543") and no error was displayed.Status: RESOLVED → VERIFIED
[status-firefox11](/buglist.cgi?f1=cf_status_firefox11&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox11&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox11&o1=equals&v1=verified)Keywords: [verified-beta](/buglist.cgi?keywords=verified-beta&resolution=---)Whiteboard: [sg:critical] fixed by 685321 [qa+] → [sg:critical] fixed by 685321 [qa!]

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=701248#c9)• 12 years ago |
|  | |

Automatically extracted testcase for this bug was committed:
<https://hg.mozilla.org/mozilla-central/rev/efaf8960a929>Flags: in-testsuite+
You need to [log in](/show_bug.cgi?id=701248&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑



=== Content from bugzilla.mozilla.org_26ec1c05_20250124_235826.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/701637)
* [XML](/show_bug.cgi?ctype=xml&id=701637)

Closed
[Bug 701637](/show_bug.cgi?id=701637)

Opened 13 years ago
Closed 13 years ago

# DOM related GC | Cycle Collector Crash triggered by harfbuzz buffer overrun

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

DOM related GC | Cycle Collector Crash triggered by harfbuzz buffer overrun

## Categories

### (Core :: Layout: Text and Fonts, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=Layout%3A%20Text%20and%20Fonts#Layout%3A%20Text%20and%20Fonts)

Layout: Text and Fonts
▾

Core :: Layout: Text and Fonts

Issues with CSS font selection, font loading, text shaping and glyph selection, breaking, text decorations, bidirectional text processing, and white space processing. For issues with glyph rendering and font format support, see the Graphics: Text component.

Example bugs:

* line-breaking code does not handle supplementary-plane characters properly
* double or wavy decoration lines are not repainted correctly if specified on floating first letter

Specifications covered:

* CSS Fonts
* CSS Size Adjustment
* CSS Text
* CSS Text Decoration

[See Open Bugs in This Component](/buglist.cgi?product=Core&component=Layout%3A%20Text%20and%20Fonts&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=Layout%3A%20Text%20and%20Fonts&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=Layout%3A%20Text%20and%20Fonts)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

x86

Windows XP

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

critical

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla9

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Webcompat Score | --- |
| --- | --- |
| Accessibility Severity | --- |
| Performance Impact | --- |
| Webcompat Priority | --- |
| a11y-review | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox8 | [-](/buglist.cgi?f1=cf_tracking_firefox8&o1=equals&v1=-) | [wontfix](/buglist.cgi?f1=cf_status_firefox8&o1=equals&v1=wontfix) |
| firefox9 | [+](/buglist.cgi?f1=cf_tracking_firefox9&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=fixed) |
| firefox10 | [+](/buglist.cgi?f1=cf_tracking_firefox10&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=fixed) |
| firefox11 | [+](/buglist.cgi?f1=cf_tracking_firefox11&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox11&o1=equals&v1=fixed) |
| status1.9.2 | --- | [unaffected](/buglist.cgi?f1=cf_status_192&o1=equals&v1=unaffected) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox8 | - | wontfix |
| firefox9 | + | fixed |
| firefox10 | + | fixed |
| firefox11 | + | fixed |
| status1.9.2 |  | unaffected |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: bc, Assigned: jfkthame)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/e0f9759e1d7514ae4adfd806869e3c5d?d=mm&size=40)  [jfkthame](/user_profile?user_id=329583)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/ee4c7c6351b45c4655e16993a29979b0?d=mm&size=40)  [bc](/user_profile?user_id=23402)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/e0f9759e1d7514ae4adfd806869e3c5d?d=mm&size=40)  [jfkthame](/user_profile?user_id=329583)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

10 people

## References

### ( [URL](http://www.haveeru.com.mv/dhivehi/south_asia/112652 "http://www.haveeru.com.mv/dhivehi/south_asia/112652") )

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

[714067](/show_bug.cgi?id=714067 "VERIFIED FIXED - Last component of Arabic ligature is sometimes duplicated")

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

Dependency [tree](/showdependencytree.cgi?id=701637&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=701637)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[Duplicates:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#duplicates)

[707095](/show_bug.cgi?id=707095 "RESOLVED DUPLICATE - Crash in _hb_ot_layout_get_glyph_property")

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[haveeru.com.mv/dhivehi/south\_asia/112652](http://www.haveeru.com.mv/dhivehi/south_asia/112652 "http://www.haveeru.com.mv/dhivehi/south_asia/112652")

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: crash, verified-aurora, verified-beta, Whiteboard: [sg:critical][qa!])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[crash](/buglist.cgi?keywords=crash&resolution=---),
[verified-aurora](/buglist.cgi?keywords=verified-aurora&resolution=---),
[verified-beta](/buglist.cgi?keywords=verified-beta&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[sg:critical][qa!]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [khuey](/user_profile?user_id=336670) | [in-testsuite](#a26181992_336670 "13 years ago") | - |
| --- | --- | --- |
| [khuey](/user_profile?user_id=336670) | in-testsuite | - |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | qe-verify |  |

## Crash Data

Signature:

[[@ nsAttrValue::EnsureEmptyMiscContainer() ]](https://crash-stats.mozilla.org/signature/?signature=nsAttrValue%3A%3AEnsureEmptyMiscContainer%28%29)

[[@ msvcr80.dll@0x173f2 ]](https://crash-stats.mozilla.org/signature/?signature=msvcr80.dll%400x173f2)

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (1 file, 3 obsolete files)

| [patch, avoid the buffer overrun error](/attachment.cgi?id=575421)  [13 years ago](#c8)  [Jonathan Kew [:jfkthame]](/user_profile?user_id=329583)   2.18 KB, patch |  | [Details](/attachment.cgi?id=575421&action=edit) | [Diff](/attachment.cgi?id=575421&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=701637&attachment=575421) |
| --- | --- | --- |
| [patch v2 - rewrite all the loops involving \_hb\_ot\_layout\_skip\_mark](/attachment.cgi?id=576197)  [13 years ago](#c13)  [Jonathan Kew [:jfkthame]](/user_profile?user_id=329583)   10.63 KB, patch | mozilla : [review-](#c14 "13 years ago") | [Details](/attachment.cgi?id=576197&action=edit) | [Diff](/attachment.cgi?id=576197&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=701637&attachment=576197) |
| [patch v2.1 - updated for review comments](/attachment.cgi?id=576223)  [13 years ago](#c15)  [Jonathan Kew [:jfkthame]](/user_profile?user_id=329583)   9.20 KB, patch |  | [Details](/attachment.cgi?id=576223&action=edit) | [Diff](/attachment.cgi?id=576223&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=701637&attachment=576223) |
| [patch v2.2 - fixed indexing in match\_input](/attachment.cgi?id=576429)  [13 years ago](#c19)  [Jonathan Kew [:jfkthame]](/user_profile?user_id=329583)   9.23 KB, patch | mozilla : [review+](#c20 "13 years ago")  christian : [approval-mozilla-aurora+](#c25 "13 years ago")  christian : [approval-mozilla-beta+](#c25 "13 years ago") | [Details](/attachment.cgi?id=576429&action=edit) | [Diff](/attachment.cgi?id=576429&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=701637&attachment=576429) |

Show Obsolete

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Bob Clary [:bc] (inactive)](/user_profile?user_id=23402)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=701637#c0)• 13 years ago |
|  | |

1. <http://www.haveeru.com.mv/dhivehi/south_asia/112652>
Windows XP only I think. May need to reload several times.
2. Crash [@ nsAttrValue::EnsureEmptyMiscContainer() ]
Beta [bp-dac1f532-e438-450c-b5d3-5e3c12111110](https://crash-stats.mozilla.org/report/index/dac1f532-e438-450c-b5d3-5e3c12111110)
Aurora [bp-67ee699e-b484-4106-bb16-0f7c72111111](https://crash-stats.mozilla.org/report/index/67ee699e-b484-4106-bb16-0f7c72111111)
Nightly [bp-3267b454-6e6c-4a49-9da5-d4bfe2111111](https://crash-stats.mozilla.org/report/index/3267b454-6e6c-4a49-9da5-d4bfe2111111)
Other urls:
<http://www.haveeru.com.mv/dhivehi>
<http://www.haveeru.com.mv/dhivehi/atolls/112618>
See also [bug 681118](/show_bug.cgi?id=681118 "RESOLVED INACTIVE - crash in nsAttrValue::Reset") which is mobile ARM/Android only.
I originally saw this in the crash automation where debug Beta builds on Windows XP were firing crashdumps with \_hb\_ot\_layout\_get\_glyph\_property \_hb\_ot\_layout\_skip\_mark PairPosFormat2::apply(hb\_apply\_context\_t\*) PairPos::apply(hb\_apply\_context\_t\*) PosLookupSubTable::apply(hb\_apply\_context\_t\*, unsigned int) stacks, but still exiting normally though Ted's exploitable tool rated these as low. Ted, I recently updated all my minidump\_stackwalk's and your exploitable tool to tip. Any idea why it would generate dumps for the browser process while the browser would still exit normally?
Making sensitive since Ted's flagged it as low and it is GC/CC related.

|  | [(not currently active) Ted Mielczarek](/user_profile?user_id=39022) |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=701637#c1)• 13 years ago |
|  | |

These look like two different stacks. I'm not sure why we'd exit with a normal status and still write a dump, that doesn't ring a bell.

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=701637#c2)• 13 years ago |
|  | |

Please capture the testcases in the bug in case they go away or change.Keywords: [testcase-wanted](/buglist.cgi?keywords=testcase-wanted&resolution=---)

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=701637#c3)• 13 years ago |
|  | |

Kyle, can you dig in here?Assignee: nobody → khueyWhiteboard: [sg:critical]

|  | [Bob Clary [:bc] (inactive)](/user_profile?user_id=23402)  Reporter |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=701637#c4)• 13 years ago |
|  | |

I haven't been able to get a saved test case that crashes, but if you go to the site and start opening links into new tabs you will crash in pretty short order with a variety of signatures.
[bp-88b4b9ca-05a9-42e9-bf12-ceb882111117](https://crash-stats.mozilla.org/report/index/88b4b9ca-05a9-42e9-bf12-ceb882111117)
[@ nsHttpChannel::GetLoadGroup(nsILoadGroup\*\*) ]
[bp-5617f544-f9f9-420e-a14a-da88c2111117](https://crash-stats.mozilla.org/report/index/5617f544-f9f9-420e-a14a-da88c2111117)
[@ imgRequestProxy::~imgRequestProxy() ]
[bp-32b45b5d-4b7a-431c-bf46-076c72111117](https://crash-stats.mozilla.org/report/index/32b45b5d-4b7a-431c-bf46-076c72111117)
[@ msvcr80.dll@0x173f2 ]
[bp-8fd9ee75-ecf9-4931-a790-57a502111117](https://crash-stats.mozilla.org/report/index/8fd9ee75-ecf9-4931-a790-57a502111117)
[@ gfxTextRun::`vector deleting destructor''(unsigned int) ]

|  | [Kyle Huey (Exited; not receiving bugmail, old account, do not use)](/user_profile?user_id=336670) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=701637#c5)• 13 years ago |
|  | |

Sure. I was able to capture the crash in the record and replay setup and am investigating.

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=701637#a565484_12352)• 13 years ago |

[status-firefox8](/buglist.cgi?f1=cf_status_firefox8&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox8&o1=equals&v1=wontfix)
[tracking-firefox10](/buglist.cgi?f1=cf_tracking_firefox10&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox10&o1=equals&v1=%2B)
[tracking-firefox11](/buglist.cgi?f1=cf_tracking_firefox11&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox11&o1=equals&v1=%2B)
[tracking-firefox8](/buglist.cgi?f1=cf_tracking_firefox8&o1=isnotempty):
--- → [-](/buglist.cgi?f1=cf_tracking_firefox8&o1=equals&v1=-)
[tracking-firefox9](/buglist.cgi?f1=cf_tracking_firefox9&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox9&o1=equals&v1=%2B)

|  | [Kyle Huey (Exited; not receiving bugmail, old account, do not use)](/user_profile?user_id=336670) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=701637#c6)• 13 years ago |
|  | |

This appears to be an off by one error in HarfBuzz.
At <http://hg.mozilla.org/mozilla-central/annotate/b62e6ee5ba9b/gfx/harfbuzz/src/hb-ot-layout-gpos-private.hh#l621> we have the following:
624 unsigned int end = MIN (c->buffer->len, c->buffer->i + c->context\_length);
<snip>
632 unsigned int j = c->buffer->i + 1;
633 while (\_hb\_ot\_layout\_skip\_mark (c->layout->face, &c->buffer->info[j], c->lookup\_props, NULL))
634 {
635 if (unlikely (j == end))
636 return false;
637 j++;
638 }
The problem is that c->buffer->len starts counting at 1, while array indices start counting at 0. It's thus possible to run off the end of the array and into somebody else's memory. \_hb\_ot\_layout\_skip\_mark calls \_hb\_ot\_layout\_get\_glyph\_property which writes beyond the end of the loop. This causes the memory corruption which later brings down the browser.

|  | [Kyle Huey (Exited; not receiving bugmail, old account, do not use)](/user_profile?user_id=336670) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=701637#a592396_336670)• 13 years ago |

Assignee: khuey → nobodyComponent: DOM: Core & HTML → Layout: TextQA Contact: general → layout.fonts-and-text

|  | [Kyle Huey (Exited; not receiving bugmail, old account, do not use)](/user_profile?user_id=336670) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=701637#c7)• 13 years ago |
|  | |

I have this in a replay machine if that's needed to proceed. Otherwise, somebody who knows HarfBuzz should finish this off.

|  | [Jonathan Kew [:jfkthame]](/user_profile?user_id=329583)  Assignee |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=701637#c8)• 13 years ago |
|  | |

Attached patch

[patch, avoid the buffer overrun error](attachment.cgi?id=575421&action=diff) (obsolete)
— [Details](attachment.cgi?id=575421&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=701637&attachment=575421)

It looks to me like the loop-exit test "j == end" needs to happen after j has been incremented in the loop, not before.
This idiom occurs several times in this file, and each occurrence requires the same fix.
Behdad, I realize this file has been renamed in the current HB trunk, but it looks like the same error is still present - please check and verify whether the fix is correct, and apply upstream as necessary. Thanks!
[Attachment #575421](/attachment.cgi?id=575421&action=edit "patch, avoid the buffer overrun error") -
Flags: review?(mozilla)

|  | [Jonathan Kew [:jfkthame]](/user_profile?user_id=329583)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=701637#a619669_329583)• 13 years ago |

Summary: DOM related GC | Cycle Collector Crash → DOM related GC | Cycle Collector Crash triggered by harfbuzz buffer overrun

|  | [Kyle Huey (Exited; not receiving bugmail, old account, do not use)](/user_profile?user_id=336670) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=701637#c9)• 13 years ago |
|  | |

FWIW, that 'end' still points past the end of the array feels pretty nasty to me, even though the patch should fix the bug.

|  | [Behdad Esfahbod](/user_profile?user_id=174983) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=701637#c10)• 13 years ago |
|  | |

Lemme check.
Kyle, end pointing to to after the array is a very common idiom, and welldefined by the C spec.

|  | [Jonathan Kew [:jfkthame]](/user_profile?user_id=329583)  Assignee |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=701637#c11)• 13 years ago |
|  | |

Right, it's equivalent to using the begin() and end() iterators on a container, for example; "end" points immediately after the last item. No problem with that; but the "end" iterator (or index) must not be dereferenced.
Behdad, please confirm the fix here is OK so that we can land it for the code as present in our tree, as well as fixing it upstream in harfbuzz for future versions.

|  | [Behdad Esfahbod](/user_profile?user_id=174983) |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=701637#c12)• 13 years ago |
|  | |

(09:39:12 AM) behdad: jfkthame: so
(09:39:27 AM) behdad: jfkthame: would it make more sense to rewrite the loops as do{}while?
(09:39:48 AM) behdad: we're assuming that at the beginning of the loop j can't be equal to end
(09:40:02 AM) behdad: and that's correct only because the if at the beginning of the functions takes care of it
(09:40:15 AM) behdad: that's too fragile / unclear
(09:42:07 AM) behdad: jfkthame: might even be worth putting that loop into a function

|  | [Jonathan Kew [:jfkthame]](/user_profile?user_id=329583)  Assignee |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=701637#c13)• 13 years ago |
|  | |

Attached patch

[patch v2 - rewrite all the loops involving \_hb\_ot\_layout\_skip\_mark](attachment.cgi?id=576197&action=diff) (obsolete)
— [Details](attachment.cgi?id=576197&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=701637&attachment=576197)

Here's a more extensive patch - I've tried to check each of the loops involving to \_hb\_ot\_layout\_skip\_mark and adjusted exit criteria to avoid potential out-of-bounds access. In a number of cases I've changed while() loops into do...while(), where this seemed to fit well with the control flow and conditions needed.
This seems to work OK with a few fonts I've tried, but has not been extensively tested yet.
[Attachment #576197](/attachment.cgi?id=576197&action=edit "patch v2 - rewrite all the loops involving _hb_ot_layout_skip_mark") -
Flags: review?(mozilla)

|  | [Behdad Esfahbod](/user_profile?user_id=174983) |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=701637#c14)• 13 years ago |
|  | |

Comment on [attachment 576197](/attachment.cgi?id=576197 "patch v2 - rewrite all the loops involving _hb_ot_layout_skip_mark") [[details]](/attachment.cgi?id=576197&action=edit "patch v2 - rewrite all the loops involving _hb_ot_layout_skip_mark") [[diff]](/attachment.cgi?id=576197&action=diff "patch v2 - rewrite all the loops involving _hb_ot_layout_skip_mark") [[review]](/page.cgi?id=splinter.html&ignore=&bug=701637&attachment=576197)
patch v2 - rewrite all the loops involving \_hb\_ot\_layout\_skip\_mark
Review of [attachment 576197](/attachment.cgi?id=576197 "patch v2 - rewrite all the loops involving _hb_ot_layout_skip_mark") [[details]](/attachment.cgi?id=576197&action=edit "patch v2 - rewrite all the loops involving _hb_ot_layout_skip_mark") [[diff]](/attachment.cgi?id=576197&action=diff "patch v2 - rewrite all the loops involving _hb_ot_layout_skip_mark") [[review]](/page.cgi?id=splinter.html&ignore=&bug=701637&attachment=576197):
-----------------------------------------------------------------
Generally looks good. I'll do them all as do{}while() upstream, but what you have is fine. Except for one chunk which looks like optimization, but is wrong.
::: gfx/harfbuzz/src/hb-ot-layout-gpos-private.hh
@@ +622,5 @@
> {
> TRACE\_APPLY ();
> + unsigned int j = c->buffer->i;
> + unsigned int end = MIN (c->buffer->len, j + c->context\_length);
> + if (unlikely (j >= end))
This is harmless, but not equivalent to what was there before. The old code was accounting for the fact that we need at least two glyphs. But, this version is simpler. I like.
::: gfx/harfbuzz/src/hb-ot-layout-gsub-private.hh
@@ +347,3 @@
> unsigned int count = component.len;
> + unsigned int end = MIN (c->buffer->len, j + c->context\_length);
> + if (unlikely (j + count >= end))
This however, keeps the count in the new version. I suggest we drop it and do a simple j >= end here too. I'm thinking about adding a struct to replace this logic.
@@ +351,5 @@
>
> bool first\_was\_mark = (c->property & HB\_OT\_LAYOUT\_GLYPH\_CLASS\_MARK);
> bool found\_non\_mark = false;
>
> + for (i = 1; i < count; i++)
Humm, took me a while to confirm that the new loop correctly skips over the matched glyphs. But it does, and I like how it reads. Nice.
@@ +361,1 @@
> if (unlikely (j + count - i == end))
Same here. We can just do j == end.
@@ +398,3 @@
> {
> + c->buffer->info[k].lig\_comp() = i;
> + c->buffer->info[k].lig\_id() = lig\_id;
This is wrong. 'k' is static, whereas in the previous code, buffer->i was advancing. Suggest backout the k thing. That's irrelevant to the issue at hand, and wrong.
::: gfx/harfbuzz/src/hb-ot-layout-gsubgpos-private.hh
@@ +140,1 @@
> return false;
The LigatureSubst logic is exactly the same as this one and your do{}while version makes much more sense IMO. In fact, maybe we should make LigatureSubst call this function.
@@ +164,2 @@
> {
> + if (unlikely (j < count - i))
Like my other comments, we can simplify this and just id "if (!j)". What you have is fine though.
@@ +191,5 @@
> {
> while (\_hb\_ot\_layout\_skip\_mark (c->layout->face, &c->buffer->info[j], c->lookup\_props, NULL))
> {
> + j++;
> + if (unlikely (j + count - i > end))
Same here. I like the do{}while() version more.
[Attachment #576197](/attachment.cgi?id=576197&action=edit "patch v2 - rewrite all the loops involving _hb_ot_layout_skip_mark") -
Flags: review?(mozilla) → review-

|  | [Jonathan Kew [:jfkthame]](/user_profile?user_id=329583)  Assignee |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=701637#c15)• 13 years ago |
|  | |

Attached patch

[patch v2.1 - updated for review comments](attachment.cgi?id=576223&action=diff) (obsolete)
— [Details](attachment.cgi?id=576223&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=701637&attachment=576223)

Updated to take account of your comments above - thanks.
[Attachment #576197](/attachment.cgi?id=576197&action=edit "patch v2 - rewrite all the loops involving _hb_ot_layout_skip_mark") -
Attachment is obsolete: true
[Attachment #576223](/attachment.cgi?id=576223&action=edit "patch v2.1 - updated for review comments") -
Flags: review?(mozilla)

|  | [Behdad Esfahbod](/user_profile?user_id=174983) |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=701637#c16)• 13 years ago |
|  | |

Comment on [attachment 576223](/attachment.cgi?id=576223 "patch v2.1 - updated for review comments") [[details]](/attachment.cgi?id=576223&action=edit "patch v2.1 - updated for review comments") [[diff]](/attachment.cgi?id=576223&action=diff "patch v2.1 - updated for review comments") [[review]](/page.cgi?id=splinter.html&ignore=&bug=701637&attachment=576223)
patch v2.1 - updated for review comments
Review of [attachment 576223](/attachment.cgi?id=576223 "patch v2.1 - updated for review comments") [[details]](/attachment.cgi?id=576223&action=edit "patch v2.1 - updated for review comments") [[diff]](/attachment.cgi?id=576223&action=diff "patch v2.1 - updated for review comments") [[review]](/page.cgi?id=splinter.html&ignore=&bug=701637&attachment=576223):
-----------------------------------------------------------------
LGTM, except for one minor issue.
::: gfx/harfbuzz/src/hb-ot-layout-gsubgpos-private.hh
@@ +133,3 @@
> return false;
>
> + j = j + 1;
Do we need this? Given that j is incremented in the do{}while loop?

|  | [Jonathan Kew [:jfkthame]](/user_profile?user_id=329583)  Assignee |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=701637#c17)• 13 years ago |
|  | |

Yes, because in the case where count==1, the for-loop body (and hence the do-while loop) is not executed at all, and we'd then end up returning context\_length\_out as zero, which is wrong.

|  | [Behdad Esfahbod](/user_profile?user_id=174983) |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=701637#c18)• 13 years ago |
|  | |

(In reply to Jonathan Kew (:jfkthame) from [comment #17](/show_bug.cgi?id=701637#c17 "VERIFIED FIXED - DOM related GC | Cycle Collector Crash triggered by harfbuzz buffer overrun"))
> Yes, because in the case where count==1, the for-loop body (and hence the
> do-while loop) is not executed at all, and we'd then end up returning
> context\_length\_out as zero, which is wrong.
I'm not convinced. You have a point, but I think the correct fix is to return j - buffer->i + 1 instead.
Two j++'s in a row, without any check on the glyph being skipped is wrong.

|  | [Jonathan Kew [:jfkthame]](/user_profile?user_id=329583)  Assignee |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=701637#c19)• 13 years ago |
|  | |

Attached patch

[patch v2.2 - fixed indexing in match\_input](attachment.cgi?id=576429&action=diff)
— [Details](attachment.cgi?id=576429&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=701637&attachment=576429)

(In reply to Behdad Esfahbod from [comment #18](/show_bug.cgi?id=701637#c18 "VERIFIED FIXED - DOM related GC | Cycle Collector Crash triggered by harfbuzz buffer overrun"))
> (In reply to Jonathan Kew (:jfkthame) from [comment #17](/show_bug.cgi?id=701637#c17 "VERIFIED FIXED - DOM related GC | Cycle Collector Crash triggered by harfbuzz buffer overrun"))
> > Yes, because in the case where count==1, the for-loop body (and hence the
> > do-while loop) is not executed at all, and we'd then end up returning
> > context\_length\_out as zero, which is wrong.
>
> I'm not convinced. You have a point, but I think the correct fix is to
> return j - buffer->i + 1 instead.
You're right. I'd almost finished a detailed reply explaining why it \_was\_ correct as I wrote it, but I think that was just my jet-lag talking. Must be time to make coffee....
[Attachment #575421](/attachment.cgi?id=575421&action=edit "patch, avoid the buffer overrun error") -
Attachment is obsolete: true
[Attachment #576223](/attachment.cgi?id=576223&action=edit "patch v2.1 - updated for review comments") -
Attachment is obsolete: true
[Attachment #575421](/attachment.cgi?id=575421&action=edit "patch, avoid the buffer overrun error") -
Flags: review?(mozilla)
[Attachment #576223](/attachment.cgi?id=576223&action=edit "patch v2.1 - updated for review comments") -
Flags: review?(mozilla)
[Attachment #576429](/attachment.cgi?id=576429&action=edit "patch v2.2 - fixed indexing in match_input") -
Flags: review?(mozilla)

|  | [Behdad Esfahbod](/user_profile?user_id=174983) |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=701637#c20)• 13 years ago |
|  | |

Comment on [attachment 576429](/attachment.cgi?id=576429 "patch v2.2 - fixed indexing in match_input") [[details]](/attachment.cgi?id=576429&action=edit "patch v2.2 - fixed indexing in match_input") [[diff]](/attachment.cgi?id=576429&action=diff "patch v2.2 - fixed indexing in match_input") [[review]](/page.cgi?id=splinter.html&ignore=&bug=701637&attachment=576429)
patch v2.2 - fixed indexing in match\_input
Review of [attachment 576429](/attachment.cgi?id=576429 "patch v2.2 - fixed indexing in match_input") [[details]](/attachment.cgi?id=576429&action=edit "patch v2.2 - fixed indexing in match_input") [[diff]](/attachment.cgi?id=576429&action=diff "patch v2.2 - fixed indexing in match_input") [[review]](/page.cgi?id=splinter.html&ignore=&bug=701637&attachment=576429):
-----------------------------------------------------------------
LGTM.
[Attachment #576429](/attachment.cgi?id=576429&action=edit "patch v2.2 - fixed indexing in match_input") -
Flags: review?(mozilla) → review+

|  | [Behdad Esfahbod](/user_profile?user_id=174983) |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=701637#c21)• 13 years ago |
|  | |

Please ping me when it's ok to push this upstream.

|  | [Jonathan Kew [:jfkthame]](/user_profile?user_id=329583)  Assignee |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=701637#c22)• 13 years ago |
|  | |

Pushed to mozilla-central:
<https://hg.mozilla.org/mozilla-central/rev/de483d897af4>Status: NEW → RESOLVEDClosed: 13 years agoResolution: --- → FIXED

|  | [Jonathan Kew [:jfkthame]](/user_profile?user_id=329583)  Assignee |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=701637#c23)• 13 years ago |
|  | |

Comment on [attachment 576429](/attachment.cgi?id=576429 "patch v2.2 - fixed indexing in match_input") [[details]](/attachment.cgi?id=576429&action=edit "patch v2.2 - fixed indexing in match_input") [[diff]](/attachment.cgi?id=576429&action=diff "patch v2.2 - fixed indexing in match_input") [[review]](/page.cgi?id=splinter.html&ignore=&bug=701637&attachment=576429)
patch v2.2 - fixed indexing in match\_input
Nominating for aurora and beta as this is a potential vulnerability in our currently-shipping code. I'm not sure how feasible it would be for someone to exploit this for arbitrary code execution rather than "just" a crash/DoS (perhaps using a specially-crafted font, along with specific text strings that hit the erroneous code paths), but anything that can manifest as heap corruption seems dangerous.
[Attachment #576429](/attachment.cgi?id=576429&action=edit "patch v2.2 - fixed indexing in match_input") -
Flags: approval-mozilla-beta?
[Attachment #576429](/attachment.cgi?id=576429&action=edit "patch v2.2 - fixed indexing in match_input") -
Flags: approval-mozilla-aurora?

|  | [Jonathan Kew [:jfkthame]](/user_profile?user_id=329583)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=701637#a1123261_329583)• 13 years ago |

Assignee: nobody → jfkthameTarget Milestone: --- → mozilla11

|  | [Kyle Huey (Exited; not receiving bugmail, old account, do not use)](/user_profile?user_id=336670) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=701637#a1153814_336670)• 13 years ago |

[status-firefox11](/buglist.cgi?f1=cf_status_firefox11&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox11&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox11&o1=equals&v1=fixed)

|  | [Kyle Huey (Exited; not receiving bugmail, old account, do not use)](/user_profile?user_id=336670) |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=701637#c24)• 13 years ago |
|  | |

Is the failure mode here understood well enough to write an automated test case for it?

|  | [LegNeato](/user_profile?user_id=482154) |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=701637#c25)• 13 years ago |
|  | |

Comment on [attachment 576429](/attachment.cgi?id=576429 "patch v2.2 - fixed indexing in match_input") [[details]](/attachment.cgi?id=576429&action=edit "patch v2.2 - fixed indexing in match_input") [[diff]](/attachment.cgi?id=576429&action=diff "patch v2.2 - fixed indexing in match_input") [[review]](/page.cgi?id=splinter.html&ignore=&bug=701637&attachment=576429)
patch v2.2 - fixed indexing in match\_input
[triage comment]
This looks...scary. How well tested is this area of code? We'll approve it but we definitely have reservations.
[Attachment #576429](/attachment.cgi?id=576429&action=edit "patch v2.2 - fixed indexing in match_input") -
Flags: approval-mozilla-beta?
[Attachment #576429](/attachment.cgi?id=576429&action=edit "patch v2.2 - fixed indexing in match_input") -
Flags: approval-mozilla-beta+
[Attachment #576429](/attachment.cgi?id=576429&action=edit "patch v2.2 - fixed indexing in match_input") -
Flags: approval-mozilla-aurora?
[Attachment #576429](/attachment.cgi?id=576429&action=edit "patch v2.2 - fixed indexing in match_input") -
Flags: approval-mozilla-aurora+

|  | [Kyle Huey (Exited; not receiving bugmail, old account, do not use)](/user_profile?user_id=336670) |  |
| --- | --- | --- |
| [Comment 26](/show_bug.cgi?id=701637#c26)• 13 years ago |
|  | |

<https://hg.mozilla.org/releases/mozilla-aurora/rev/6de566eaf103>
<https://hg.mozilla.org/releases/mozilla-beta/rev/a2aab866a09b>
[status-firefox10](/buglist.cgi?f1=cf_status_firefox10&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=fixed)
[status-firefox9](/buglist.cgi?f1=cf_status_firefox9&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=fixed)Flags: in-testsuite?Target Milestone: mozilla11 → mozilla9

|  | [u279076](/user_profile?user_id=279076) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=701637#a1780964_279076)• 13 years ago |

Whiteboard: [sg:critical] → [sg:critical][qa+]

|  | [Jonathan Kew [:jfkthame]](/user_profile?user_id=329583)  Assignee |  |
| --- | --- | --- |
| [Comment 27](/show_bug.cgi?id=701637#c27)• 13 years ago |
|  | |

(In reply to Christian Legnitto [:LegNeato] from [comment #25](/show_bug.cgi?id=701637#c25 "VERIFIED FIXED - DOM related GC | Cycle Collector Crash triggered by harfbuzz buffer overrun"))
> [triage comment]
> This looks...scary. How well tested is this area of code? We'll approve it
> but we definitely have reservations.
Hmm, do you mean the crash looks scary, or the patch looks scary? Or both? :)
IMO, although the crash is bad, it would probably be pretty challenging to exploit in any predictable way - making use of the heap corruption caused by overshooting the glyph buffer by one position to achieve a controlled, malicious result seems like it'd be really hard.
As for the patch, I don't think it's quite as scary as it looks, really. The specific error that caused this crash was pinpointed and clearly understood (thanks, Kyle - [comment 6](/show_bug.cgi?id=701637#c6 "VERIFIED FIXED - DOM related GC | Cycle Collector Crash triggered by harfbuzz buffer overrun")), and could have been fixed with a very small and obviously correct patch ([comment 8](/show_bug.cgi?id=701637#c8 "VERIFIED FIXED - DOM related GC | Cycle Collector Crash triggered by harfbuzz buffer overrun")). However, on examination of similar code fragments we found that the equivalent problem - and hence the potential for corruption - was present in multiple places, and so we're fixing them all pre-emptively; and in discussion with Behdad, we decided to rewrite the loops in a form that makes the indexing and loop-termination logic easier to follow, as it was a bit confusing as originally written. All this makes for a larger and more complex-looking patch, but a better result.
I strongly suspect [bug 707095](/show_bug.cgi?id=707095 "RESOLVED DUPLICATE - Crash in _hb_ot_layout_get_glyph_property") (newly filed from crash-stats) is a manifestation of this bug, and so those reports should die away once the fix here gets out to users.

|  | [Behdad Esfahbod](/user_profile?user_id=174983) |  |
| --- | --- | --- |
| [Comment 28](/show_bug.cgi?id=701637#c28)• 13 years ago |
|  | |

I agree with Jonathan. We're both much more confident in the code being added here than just trying to fix the old code with minimal changes.

|  | [Matt Evans [:mevans]](/user_profile?user_id=378449) |  |
| --- | --- | --- |
| [Comment 29](/show_bug.cgi?id=701637#c29)• 13 years ago |
|  | |

Mozilla/5.0 (Windows NT 6.1; WOW64; rv:11.0a1) Gecko/20111203 Firefox/11.0a1
Mozilla/5.0 (Windows NT 6.1; WOW64; rv:10.0a2) Gecko/20111203 Firefox/10.0a2
Mozilla/5.0 (Windows NT 6.1; WOW64; rv:9.0) Gecko/20100101 Firefox/9.0
Loaded websites listed in the Desciption many times. Crash was easily reproducible with FF8. Validated on Win7 across all channels.Status: RESOLVED → VERIFIEDKeywords: [verified-aurora](/buglist.cgi?keywords=verified-aurora&resolution=---),
[verified-beta](/buglist.cgi?keywords=verified-beta&resolution=---)

|  | [u279076](/user_profile?user_id=279076) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=701637#a2216723_279076)• 13 years ago |

Whiteboard: [sg:critical][qa+] → [sg:critical][qa!]

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 30](/show_bug.cgi?id=701637#c30)• 13 years ago |
|  | |

Harfbuzz didn't exist on the 1.9.2 branch so this bug should not affect it.
[status1.9.2](/buglist.cgi?f1=cf_status_192&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_192&o1=equals&v1=unaffected)

|  | [Simon Montagu :smontagu](/user_profile?user_id=11171) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=701637#a4176506_11171)• 13 years ago |

Depends on: [714067](/show_bug.cgi?id=714067 "VERIFIED FIXED - Last component of Arabic ligature is sometimes duplicated")

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=701637#a8431554_1689)• 13 years ago |

Group: core-security

|  | [Behdad Esfahbod](/user_profile?user_id=174983) |  |
| --- | --- | --- |
| [Comment 32](/show_bug.cgi?id=701637#c32)• 13 years ago |
|  | |

This has been upstreamed already btw.

|  | [Kyle Huey (Exited; not receiving bugmail, old account, do not use)](/user_profile?user_id=336670) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=701637#a26181992_336670)• 12 years ago |

Flags: in-testsuite? → in-testsuite-

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=701637#a124021691_75935)• 9 years ago |

Keywords: [testcase-wanted](/buglist.cgi?keywords=testcase-wanted&resolution=---)
You need to [log in](/show_bug.cgi?id=701637&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Jonathan Kew [:jfkthame]](/user_profile?user_id=329583)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from blog.mozilla.org_02ca07ef_20250126_043822.html ===

[Skip to content](#content)

[Mozilla](https://blog.mozilla.org/en/)

![search](https://blog.mozilla.org/wp-content/themes/foxtail/assets/images/icons/search.svg)

* [Internet Culture](https://blog.mozilla.org/en/category/internet-culture/)
  + [Deep Dives](https://blog.mozilla.org/en/category/internet-culture/deep-dives/)
  + [Mozilla Explains](https://blog.mozilla.org/en/category/internet-culture/mozilla-explains/)
  + [Interviews](https://blog.mozilla.org/en/category/internet-culture/interviews/)
  + [Videos](https://blog.mozilla.org/en/category/videos/)
* [Privacy & Security](https://blog.mozilla.org/en/category/privacy-security/)
* [Products](https://blog.mozilla.org/en/category/products/)
  + [Firefox](https://blog.mozilla.org/en/category/products/firefox/)
  + [Pocket](https://blog.mozilla.org/en/category/products/pocket/)
  + [Mozilla VPN](https://blog.mozilla.org/en/category/products/mozilla-vpn/)
* [Mozilla](https://blog.mozilla.org/en/category/mozilla/)
  + [News](https://blog.mozilla.org/en/category/mozilla/news/)
  + [Internet Policy](https://blog.mozilla.org/en/category/mozilla/internet-policy/)
  + [Leadership](https://blog.mozilla.org/en/category/mozilla/leadership/)
    - [Mitchell Baker, CEO](https://blog.mozilla.org/en/author/mitchellmozillacom/)
    - [Mark Surman, ED Foundation](https://blog.mozilla.org/en/author/markmozillafoundation-org/)
    - [Eric Rescorla, Firefox CTO](https://blog.mozilla.org/en/author/ekrmozilla-com/)

[Download Firefox](https://www.mozilla.org/firefox/new/?utm_source=blog.mozilla.org&utm_medium=referral&utm_campaign=blog-nav)

![search](https://blog.mozilla.org/wp-content/themes/foxtail/assets/images/icons/search.svg)

#### Search

Search for:

![](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2019/01/mozilla-logo-bw-rgb.png)
## News

Official announcements and press releases

[![Room filled with people listening to a speaker on stage. Demo Day visual image in the background.](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2024/12/Demo_Day_Blog_Header_-1-800x800.jpg)
Mozilla
## Mozilla Builders: Celebrating community-driven innovation in AI

Read More](https://blog.mozilla.org/en/mozilla/mozilla-builders-demo-day/)

[![The Mozilla logo in green on a black background](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2024/12/logo-lockup-video-poster-800x800.png)
Mozilla
## Mozilla welcomes new executive team members

Read More](https://blog.mozilla.org/en/mozilla/new-executives/)

[![Decorative image of wrapped gifts in front of an iphone](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2023/11/moz_header_holiday_firefox-phone-gifts_blue-03.png-800x800.png)
Products
## Shopping for everyone? We’ve got you covered with the Fakespot Holiday Gift Guide 2024

Read More](https://blog.mozilla.org/en/products/shopping-for-everyone-weve-got-you-covered-with-the-fakespot-holiday-gift-guide-2024/)

[![Text: Mozilla Builders](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2024/06/Blog-16_9-1920x1080-1-800x800.png)
Mozilla
## 14 AI projects to watch: Mozilla’s first Builders Accelerator cohort kicks off

Read More](https://blog.mozilla.org/en/mozilla/14-ai-projects-to-watch-mozillas-first-builders-accelerator-cohort-kicks-off/)

[![A check mark next to the text "Fakespot."](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2023/07/Fakespot_ProductBlog-2-800x800.jpg)
News
## Fakespot’s guide to trending back-to-school products

Read More](https://blog.mozilla.org/en/mozilla/news/fakespots-guide-to-trending-back-to-school-products/)

[![](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2024/06/IG_Highlights_Icon-800x800.png)
Mozilla
## BAFTA Award-Winner Siobhán McSweeney to host Mozilla’s 2nd Annual Rise25 Awards in Dublin, Ireland on Aug. 13

Read More](https://blog.mozilla.org/en/mozilla/bafta-award-winner-siobhan-mcsweeney-to-host-mozillas-2nd-annual-rise25-awards-in-dublin-ireland-on-august-13/)

[![](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2024/05/fx_website_meta-image_tips-tricks_alt-04-1-800x800.webp)
Mozilla
## Here’s what we’re working on in Firefox

Read More](https://blog.mozilla.org/en/mozilla/heres-what-were-working-on-in-firefox/)

[![A check mark next to the text "Fakespot."](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2023/07/Fakespot_ProductBlog-2-800x800.jpg)
News
## Fakespot reveals the product categories with the most and least reliable product reviews

Read More](https://blog.mozilla.org/en/mozilla/news/fakespot-reveals-the-product-categories-with-the-most-and-least-reliable-product-reviews-for-summer-and-back-to-school-shopping/)

[![A dark blue speech bubble with horizontal purple and red bars on a pink background.](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2020/03/fx_blog_header_announcements_001_1920x1080-800x800.jpg)
Firefox
## Engaging with our Firefox community: Highlights from our recent AMA

Read More](https://blog.mozilla.org/en/products/firefox/engaging-with-our-firefox-community-highlights-from-our-recent-ama/)

[![](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2024/06/IG_Highlights_Icon-800x800.png)
Mozilla
## Mozilla announces finalists for the 2nd annual Rise25 Awards

Read More](https://blog.mozilla.org/en/mozilla/mozilla-announces-finalists-for-the-2nd-annual-rise25-awards/)

[![Mozilla and Anonym logos](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2024/06/blog_1200x800_v2-800x800.png)
Mozilla
## Introducing Anonym: Raising the bar for privacy-preserving digital advertising

Read More](https://blog.mozilla.org/en/mozilla/mozilla-anonym-raising-the-bar-for-privacy-preserving-digital-advertising/)

[![logo - zero with a diagonal line through it, and the letters D, I, N](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2024/06/odintbanner-500x500.png)
Mozilla
## Keeping GenAI technologies secure is a shared responsibility

Read More](https://blog.mozilla.org/en/mozilla/keeping-genai-technologies-secure-is-a-shared-responsibility/)

1
[2](https://blog.mozilla.org/en/category/mozilla/news/page/2?utm_source=www.mozilla.o)
[3](https://blog.mozilla.org/en/category/mozilla/news/page/3?utm_source=www.mozilla.o)
…
[24](https://blog.mozilla.org/en/category/mozilla/news/page/24?utm_source=www.mozilla.o)
[next](https://blog.mozilla.org/en/category/mozilla/news/page/2?utm_source=www.mozilla.o)

![newsletter](https://blog.mozilla.org/wp-content/themes/foxtail/assets/images/newsletter.png)

### Keep up with all things Firefox

Get how-tos, advice and news to make your Firefox experience work best for you.

Your e-mail address

Country
- select -
Afghanistan
Akrotiri
Albania
Algeria
American Samoa
Andorra
Angola
Anguilla
Antarctica
Antigua and Barbuda
Argentina
Armenia
Aruba
Ashmore and Cartier Islands
Australia
Austria
Azerbaijan
Bahamas, The
Bahrain
Baker Island
Bangladesh
Barbados
Bassas da India
Belarus
Belgium
Belize
Benin
Bermuda
Bhutan
Bolivia
Bonaire, Sint Eustatius, and Saba
Bosnia and Herzegovina
Botswana
Bouvet Island
Brazil
British Indian Ocean Territory
Brunei
Bulgaria
Burkina Faso
Burma
Burundi
Cabo Verde
Cambodia
Cameroon
Canada
Cayman Islands
Central African Republic
Chad
Chile
China
Christmas Island
Clipperton Island
Cocos (Keeling) Islands
Colombia
Comoros
Congo (Brazzaville)
Congo (Kinshasa)
Cook Islands
Coral Sea Islands
Costa Rica
Croatia
Cuba
Curaçao
Cyprus
Czech Republic
Côte d’Ivoire
Denmark
Dhekelia
Diego Garcia
Djibouti
Dominica
Dominican Republic
Ecuador
Egypt
El Salvador
Equatorial Guinea
Eritrea
Estonia
Ethiopia
Europa Island
Falkland Islands (Islas Malvinas)
Faroe Islands
Fiji
Finland
France
French Guiana
French Polynesia
French Southern and Antarctic Lands
Gabon
Gambia, The
Gaza Strip
Georgia
Germany
Ghana
Gibraltar
Glorioso Islands
Greece
Greenland
Grenada
Guadeloupe
Guam
Guatemala
Guernsey
Guinea
Guinea-Bissau
Guyana
Haiti
Heard Island and McDonald Islands
Honduras
Hong Kong
Howland Island
Hungary
Iceland
India
Indonesia
Iran
Iraq
Ireland
Isle of Man
Israel
Italy
Jamaica
Jan Mayen
Japan
Jarvis Island
Jersey
Johnston Atoll
Jordan
Juan de Nova Island
Kazakhstan
Kenya
Kingman Reef
Kiribati
Korea, North
Korea, South
Kosovo
Kuwait
Kyrgyzstan
Laos
Latvia
Lebanon
Lesotho
Liberia
Libya
Liechtenstein
Lithuania
Luxembourg
Macau
Macedonia
Madagascar
Malawi
Malaysia
Maldives
Mali
Malta
Marshall Islands
Martinique
Mauritania
Mauritius
Mayotte
Mexico
Micronesia, Federated States of
Midway Islands
Moldova
Monaco
Mongolia
Montenegro
Montserrat
Morocco
Mozambique
Namibia
Nauru
Navassa Island
Nepal
Netherlands
New Caledonia
New Zealand
Nicaragua
Niger
Nigeria
Niue
Norfolk Island
Northern Mariana Islands
Norway
Oman
Pakistan
Palau
Palmyra Atoll
Panama
Papua New Guinea
Paracel Islands
Paraguay
Peru
Philippines
Pitcairn Islands
Poland
Portugal
Puerto Rico
Qatar
Reunion
Romania
Russia
Rwanda
Saint Barthelemy
Saint Helena, Ascension, and Tristan da Cunha
Saint Kitts and Nevis
Saint Lucia
Saint Martin
Saint Pierre and Miquelon
Saint Vincent and the Grenadines
Samoa
San Marino
Sao Tome and Principe
Saudi Arabia
Senegal
Serbia
Seychelles
Sierra Leone
Singapore
Sint Maarten
Slovakia
Slovenia
Solomon Islands
Somalia
South Africa
South Georgia and South Sandwich Islands
South Sudan
Spain
Spratly Islands
Sri Lanka
Sudan
Suriname
Svalbard
Swaziland
Sweden
Switzerland
Syria
Taiwan
Tajikistan
Tanzania
Thailand
Timor-Leste
Togo
Tokelau
Tonga
Trinidad and Tobago
Tromelin Island
Tunisia
Turkey
Turkmenistan
Turks and Caicos Islands
Tuvalu
Uganda
Ukraine
United Arab Emirates
United Kingdom
United States
Uruguay
Uzbekistan
Vanuatu
Vatican City
Venezuela
Vietnam
Virgin Islands, British
Virgin Islands, U.S.
Wake Island
Wallis and Futuna
West Bank
Western Sahara
Yemen
Zambia
Zimbabwe

Language
English
Bahasa Indonesia
Deutsch
Español
Français
Polski
Português
Русский
正體中文

Format

 HTML

 Text

I’m okay with Mozilla handling my info as explained in this [Privacy Policy](https://www.mozilla.org/privacy/).

Sign up now
We will only send you
Mozilla-related information.

## Thanks!

If you haven’t previously confirmed a subscription to a Mozilla-related newsletter you may have to do so. Please check your inbox or your spam filter for an e-mail from us.

[Mozilla](https://www.mozilla.org/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)

##### Mozilla

* [About](https://www.mozilla.org/about/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Contact Us](https://www.mozilla.org/contact/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Donate](https://donate.mozilla.org/?presets=50,30,20,10&amount=30¤cy=usd&utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)

##### Firefox

* [Download Firefox](https://www.mozilla.org/firefox/new/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Desktop](https://www.mozilla.org/firefox/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Mobile](https://www.mozilla.org/firefox/mobile/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Features](https://www.mozilla.org/firefox/features/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Beta, Nightly, Developer Edition](https://www.mozilla.org/firefox/channel/desktop/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)

##### Resources

* [Privacy Hub](https://www.mozilla.org/privacy/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Browser Comparison](https://www.mozilla.org/firefox/browsers/compare/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Brand Standards](https://mozilla.design/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)

##### Social

Follow @Firefox

* [Twitter (@mozilla)](https://twitter.com/firefox)
* [Instagram (@mozilla)](https://www.instagram.com/firefox/)
* [YouTube (@firefoxchannel)](https://www.youtube.com/user/firefoxchannel)

Follow @Mozilla

* [Twitter (@mozilla)](https://twitter.com/mozilla)
* [Instagram (@mozilla)](https://www.instagram.com/mozilla/)

* [Website Privacy Notice](https://www.mozilla.org/privacy/websites/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Legal](https://www.mozilla.org/about/legal/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)



=== Content from secunia.com_a24bb08b_20250124_235733.html ===


[Skip to main content](#main-content)
[![Home](/themes/custom/flexera/images/logo.svg)](https://www.flexera.com/)

[![Home](/themes/custom/flexera/images/logo.svg)](https://www.flexera.com/)

Search

## Main navigation

* Solutions
  + Column 1
    - Business challenge
      * [Software renewals and audits](https://www.flexera.com/solutions/software-renewals-audits)
      * [Software license management and optimization](https://www.flexera.com/solutions/software-usage-costs)
      * [SaaS spend management](https://www.flexera.com/solutions/saas-spend)
      * [Cloud cost management](https://www.flexera.com/solutions/cloud-cost)
      * [IT asset lifecycle management](https://www.flexera.com/solutions/it-asset-lifecycle)
      * [CMDB data quality](https://www.flexera.com/solutions/cmdb-data-quality)
      * [Accurate IT inventory](https://www.flexera.com/solutions/it-inventory)
      * [Security and regulatory risk management](https://www.flexera.com/solutions/it-security-regulatory-risk)
      * [Sustainable IT](https://www.flexera.com/solutions/sustainable-it)
      * [AI-powered transformation](https://www.flexera.com/solutions/ai-powered-transformation)
      * [Public sector](https://www.flexera.com/solutions/public-sector)
  + Column 2
    - Spend management by vendor
      * [IBM](https://www.flexera.com/solutions/vendor/ibm)
      * [Oracle](https://www.flexera.com/solutions/vendor/oracle)
      * [Microsoft](https://www.flexera.com/solutions/vendor/microsoft)
      * [SAP](https://www.flexera.com/solutions/vendor/sap)
      * [VMware](https://www.flexera.com/solutions/vendor/vmware)
      * [ServiceNow](https://www.flexera.com/solutions/vendor/servicenow)
      * [AWS](https://www.flexera.com/solutions/vendor/aws)
      * [Salesforce](https://www.flexera.com/solutions/vendor/salesforce)
      * [BMC](https://www.flexera.com/solutions/cmdb-data-quality/bmc)
      * [Adobe](https://www.flexera.com/solutions/vendor/adobe)

  ### Achieve more through a united FinOps and ITAM function

  The future is hybrid. Break down the walls between ITAM and FinOps to drive more revenue, more customer growth and more innovation.

  [Discover More](https://www.flexera.com/resources/hybrid-itam-finops)
* Products
  + Column 1
    - [Flexera One](https://www.flexera.com/products/flexera-one)
      * [IT Visibility](https://www.flexera.com/products/flexera-one/it-visibility)
      * [ITAM](https://www.flexera.com/products/flexera-one/it-asset-management)
      * [SaaS Management](https://www.flexera.com/products/flexera-one/saas-management)
      * [FinOps](https://www.flexera.com/products/flexera-one/finops)
      * [Technology Intelligence Platform](https://www.flexera.com/products/flexera-one/technology-intelligence-platform)
  + Column 2
    - [Snow Atlas](https://www.flexera.com/products/snow-atlas)
      * [Snow Spend Optimizer](https://www.flexera.com/products/snow-atlas/snow-spend-optimizer)
      * [Snow SaaS Management](https://www.flexera.com/products/snow-atlas/snow-saas-management)
  + Column 3
    - Hide group
      * [Security](https://www.flexera.com/products/security)
      * [Application Readiness](https://www.flexera.com/products/adminstudio)
      * [All products](https://www.flexera.com/products)
      * [All Snow products](https://www.flexera.com/products/snow)
      * [Integrations](https://www.flexera.com/products/integrations)

  ### Flexera 2024 State of the Cloud Report

  What do transformative initiatives such as GenAI, machine learning and sustainability mean for the cloud? Check out the 2024 State of the Cloud Report to find the answer as well as all the latest cloud computing trends.

  [View Report](https://info.flexera.com/CM-REPORT-State-of-the-Cloud)
* Success
  + Column 1
    - [Customer success](https://www.flexera.com/customer-success)
      * Support
        + [Flexera support portal](https://community.flexera.com/s/support-hub)
        + [Flexera product documentation](https://docs.flexera.com)
        + [Snow product documentation](https://docs.snowsoftware.io/)
      * Services and training
        + [Services](https://www.flexera.com/customer-success/services)
        + [Training](https://www.flexera.com/customer-success/training)
  + Column 2
    - Hide group
      * [Technology Intelligence Awards](https://www.flexera.com/customer-success/awards)
      * [Flexera community](https://community.flexera.com/s/)

  ### Insights from Gartner®

  Find a curated series of actionable and objective insights for IT executives and their teams. Get expert insights from valued analysts, courtesy of Flexera.

  [Discover More](https://www.flexera.com/resources/gartner-analyst-research)
* Resources
  + Column 1
    - [Resources](https://www.flexera.com/resources)
      * [Webinars](https://www.flexera.com/resources?type%5Bwebinar%5D=webinar)
      * [Videos](https://www.flexera.com/resources?type%5Bvideo%5D=video)
      * [Datasheets](https://www.flexera.com/resources?type%5Bdatasheet%5D=datasheet)
      * [White papers & reports](https://www.flexera.com/resources?type%5Bwhite-paper-industry-report%5D=white-paper-industry-report)
  + Column 2
    - Hide group
      * [Blog](/blog/)
      * [Case studies](https://www.flexera.com/resources/case-studies)
      * [Events](https://www.flexera.com/resources?type%5Bevent%5D=event)
      * [Analyst Research](https://www.flexera.com/resources/gartner-analyst-research)
      * [Glossary](https://www.flexera.com/resources/glossary)
      * [Demos & trials](https://www.flexera.com/resources?type%5Bdemo-trials%5D=demo-trials)
      * [Business value calculator](https://www.flexera.com/resources/business-value-calculator)

  ### Flexera 2025 IT Priorities Report

  Insights from Flexera’s 2025 IT Priorities Report highlight what’s top of mind for IT decision makers in the year ahead. Discover the challenges, priorities and opportunities that will shape the future IT landscape.

  [View Report](https://info.flexera.com/ITV-REPORT-IT-Priorities)
* About
  + Column 1
    - [Company](https://www.flexera.com/about-us)
      * [About](https://www.flexera.com/about-us)
      * [Careers](https://www.flexera.com/about-us/careers)
      * [Contact](https://www.flexera.com/about-us/contact-us)
      * [Leadership](https://www.flexera.com/about-us/leadership)
    - [Partners](https://www.flexera.com/about-us/partners)
      * [Partner program](https://www.flexera.com/about-us/partners/partner-program)
      * [Partner directory](https://www.flexera.com/about-us/partners/directory)
  + Column 2
    - [Press center](https://www.flexera.com/about-us/press-center)
      * [Press releases](https://www.flexera.com/about-us/all-press-releases)
      * [Awards](https://www.flexera.com/about-us/press-center#awards)
      * [Articles](https://www.flexera.com/about-us/all-articles)
    - Hide group
      * Social responsibility
        + [ESG](https://www.flexera.com/about-us/environmental-social-governance)
        + [Diversity](https://www.flexera.com/about-us/diversity)

  ### More value with technology intelligence

  The unparalleled synergy of Flexera and Snow provides the Technology Intelligence you need for more efficiency, insight and governance than ever before.

  [Discover More](https://www.flexera.com/more-value-with-technology-intelligence)

Search

en

* [English](https://www.flexera.com/products/security/software-vulnerability-research/secunia-research?referrer=secunia)
* [Deutsch](https://www.flexera.de/products/security/software-vulnerability-research/secunia-research?referrer=secunia)

## External Links

* External Links
  + [Community](https://community.flexera.com/)
  + [Product Access](https://app.flexera.com/login)
  + [Partner Portal](https://flexera.channeltivity.com/Login)

[Book a demo](/about-us/contact-us?C_Interest1=sales)

# Secunia Research

## The world’s best vulnerability intelligence

The Secunia Research team from Flexera provides the most accurate and reliable source of vulnerability intelligence.

[Contact Us](https://www.flexera.com/about-us/contact-us?C_Interest1=sales&C_SolutionInterest=SVM)
Watch video (0:29)

Related links

* [Anatomy of a security advisory](https://www.flexera.com/resources/infographics/anatomy-of-a-security-advisory)
* [Software Vulnerability Research](https://www.flexera.com/products/software-vulnerability-research)
* [Software Vulnerability Manager](/products/software-vulnerability-manager)
* [Security advisories from Secunia Research](https://www.flexera.com/products/security/software-vulnerability-advisories)
* [Report a vulnerability](https://www.flexera.com/about-us/contact-us/report-vulnerability)

 ![Secunia Research](/sites/default/files/2022-04/hero-secunia-research-bg.jpg)

Featured Details

## Multiple ways to consume Secunia Research

Secunia delivers software security research that provides reliable, curated and actionable vulnerability intelligence. Organizations can expect to receive standardized, validated and enriched vulnerability research on a specific version of a software product. Secunia Research supports four solutions:

![Software Vulnerability Research](/sites/default/files/2022-04/icon-secunia-research-svr.svg)

### [Software Vulnerability Research](https://www.flexera.com/products/software-vulnerability-research)

Software Vulnerability Research utilizes Secunia Research to drive awareness of vulnerabilities matching your specified criteria

[Learn More](https://www.flexera.com/products/software-vulnerability-research)

![Software Vulnerability Manager](/sites/default/files/2022-04/icon-secunia-research-svm.svg)

### [Software Vulnerability Manager](/products/software-vulnerability-manager)

Software Vulnerability Manager uses Secunia Research data to identify, prioritize and patch known vulnerable software detected in your environment

[Learn More](/products/software-vulnerability-manager)

![Data Platform](/sites/default/files/2022-04/icon-secunia-research-dp.svg)

### [Data Platform](https://www.flexera.com/products/data-platform)

Data Platform leverages Secunia Research to provide high-level insights based on major or minor versions of software in your normalized inventory

[Learn More](https://www.flexera.com/products/data-platform)

![Flexera One](/sites/default/files/2022-04/icon-secunia-research-flexera-one.svg)

### [Flexera One](/flexera-one)

Flexera One utilizes Secunia Research (alongside public NVD data) to provide more granular matching of build-level versions of software in your normalized inventory within its IT Asset Management and IT Visibility solutions

[Learn More](/flexera-one)

How it works

## Accurate, reliable vulnerability insights at your fingertips

The Secunia Research team from Flexera is comprised of several security specialists who conduct vulnerability research in various products in addition to testing, verifying and validating public vulnerability reports. Since its inception in 2002, the goal of the Secunia Research team is to provide the most accurate and reliable source of vulnerability intelligence.

Delivering the world’s best vulnerability intelligence requires skill and passion. Team members continually develop their skills exploring various high-profile closed and open-source software using a variety of approaches, focusing chiefly on thorough code audits and binary analysis. The team has received industry recognition, including naming members to [Microsoft’s Most Valuable Security Researchers](https://msrc-blog.microsoft.com/2019/08/07/announcing-2019-msrc-most-valuable-security-researchers/) list.

Secunia researchers discover hard-to-find vulnerabilities that aren’t normally identified with techniques such as fuzzing, and the results have been impressive. Members of the Secunia Research team have discovered critical vulnerabilities in products from vendors including Microsoft, Symantec, IBM, Adobe, RealNetworks, Trend Micro, HP, Blue Coat, Samba, CA, Mozilla and Apple.

The team produces invaluable security advisories based on research of the vulnerabilities affecting any given software update. Sometimes a single update can address multiple vulnerabilities of varying criticalities and threats; but these advisories aggregate and distill findings down to a single advisory perfect for the prioritization of patching efforts within [Software Vulnerability Manager](/products/software-vulnerability-manager). Criticality scores are consistently applied along with details around attack vector and other valuable details within [Software Vulnerability Research](/products/software-vulnerability-research/secunia-research). Illegitimate vulnerability reports are also investigated and rejected so you can focus only on what truly matters.

Informing IT, Transforming IT

## Industry insights to help keep you informed

[#### Webinar

### Stay Ahead of Cyber Threats: Flexera's Latest Vulnerability Insights

Join us for this session where we'll explore the latest findings from the Flexera Monthly Vulnerability Insights Report.](https://info.flexera.com/SVM-WBNR-Vulnerability-Insights-Roundtable)

[#### Webinar

### Dive deeper into the Flexera Annual Vulnerability Insights

We'll explore the key findings from the Flexera Annual Vulnerability Insights Report. Learn about the latest cybersecurity trends, the most targeted industries, the types of vulnerabilities, plus management and mitigation strategies.](https://info.flexera.com/SVM-WBNR-Flexera-Annual-Vulnerability-Insights?lead_source=Website%20Visitor&id=Flexera.com-Resources)

#### Video

### Close the Risk Window with Software Vulnerability Manager

Stop reacting. Gain control. Stay secure. Build a more effective risk mitigation process leveraging Secunia Research vulnerability intelligence and the largest repository of third-party patch data in the industry.

Remote video URL

[#### Trial

### Software Vulnerability Manager Assessment free trial

Get access to the complete set of modules of Software Vulnerability Manager: Research, Assessment and Patching](https://info.flexera.com/SVM-EVAL-Software-Vulnerability-Manager)

[#### Datasheet

### Protect your ServiceNow® investment with the highest quality data

IT Visibility offers certified ServiceNow integrations that accelerate platform expansion, improve ROI and increase efficiencies across ITIL processes by delivering clean software and hardware asset data directly.](/sites/default/files/datasheet-itv-maximize-servicenow-investment.pdf)

[#### Blog

### Avoid missing crucial vulnerability intelligence amid NVD backlog

Recent developments regarding the National Vulnerability Database (NVD) have some technology leaders on edge. Since February, the U.S. National Institute of Standards and Technology (NIST) has almost completely stopped enriching software vulnerabi...](https://www.flexera.com/blog/vulnerability-management/avoid-missing-crucial-vulnerability-intelligence-amid-nvd-backlog/)

[View all resources](https://www.flexera.com/resources?category%5Bsoftware-vulnerability-management%5D=software-vulnerability-management)

## Footer Menu

* Column
  + Business challenge
    - [Software renewals and audits](https://www.flexera.com/solutions/software-renewals-audits)
    - [Software license management and optimization](https://www.flexera.com/solutions/software-usage-costs)
    - [SaaS spend management](https://www.flexera.com/solutions/saas-spend)
    - [Cloud cost management](https://www.flexera.com/solutions/cloud-cost)
    - [IT asset lifecycle management](https://www.flexera.com/solutions/it-asset-lifecycle)
    - [CMDB data quality](https://www.flexera.com/solutions/cmdb-data-quality)
    - [Accurate IT inventory](https://www.flexera.com/solutions/it-inventory)
    - [Security and regulatory risk management](https://www.flexera.com/solutions/it-security-regulatory-risk)
    - [Sustainable IT](https://www.flexera.com/solutions/sustainable-it)
    - [AI-powered transformation](https://www.flexera.com/solutions/ai-powered-transformation)
    - [Public sector](https://www.flexera.com/solutions/public-sector)
* Column
  + Spend management by vendor
    - [IBM](https://www.flexera.com/solutions/vendor/ibm)
    - [Oracle](https://www.flexera.com/solutions/vendor/oracle)
    - [Microsoft](https://www.flexera.com/solutions/vendor/microsoft)
    - [SAP](https://www.flexera.com/solutions/vendor/sap)
    - [VMware](https://www.flexera.com/solutions/vendor/vmware)
    - [ServiceNow](https://www.flexera.com/solutions/vendor/servicenow)
    - [AWS](https://www.flexera.com/solutions/vendor/aws)
    - [Salesforce](https://www.flexera.com/solutions/vendor/salesforce)
    - [BMC](https://www.flexera.com/solutions/cmdb-data-quality/bmc)
    - [Adobe](https://www.flexera.com/solutions/vendor/adobe)
* Column
  + Products
    - [Flexera One](https://www.flexera.com/products/flexera-one)
    - [Snow Atlas](https://www.flexera.com/products/snow-atlas)
    - [Security](https://www.flexera.com/products/security)
    - [Application Readiness](https://www.flexera.com/products/adminstudio)
    - [All products](https://www.flexera.com/products)
    - [All Snow products](https://www.flexera.com/products/snow)
    - [Integrations](https://www.flexera.com/products/integrations)
* Column
  + Company
    - [About](https://www.flexera.com/about-us)
    - [Careers](https://www.flexera.com/about-us/careers)
    - [Leadership](https://www.flexera.com/about-us/leadership)
    - [Contact us](https://www.flexera.com/about-us/contact-us)
    - [Media / press center](https://www.flexera.com/about-us/press-center)
    - [Revenera.com](https://www.revenera.com)

 +1.800.374.4353

en

* [English](https://www.flexera.com/products/security/software-vulnerability-research/secunia-research?referrer=secunia)
* [Deutsch](https://www.flexera.de/products/security/software-vulnerability-research/secunia-research?referrer=secunia)

 [![Home](/themes/custom/flexera/images/logo.svg)](https://www.flexera.com/)

© 2025 Flexera. All Rights Reserved.

## Footer

* [Privacy Policy](https://www.flexera.com/legal/privacy-policy)
* [Terms and conditions](https://www.flexera.com/legal)
* [Contact Us](https://www.flexera.com/about-us/contact-us)
* [Impressum](https://www.flexera.com/about-us/impressum)
* [Site Map](https://www.flexera.com/sitemap)

#####

×

...



=== Content from www.mandriva.com_8b5119d7_20250124_235735.html ===


* [Tuxedo.org](https://tuxedo.org/ "Go to: Tuxedo")
* Store
* Mandriva Linux
* Enterprise Solutions
* Contact Us
* Language ![](/sites/all/themes/mandriva_customer/images/arrow-grey-bottom.gif)
  + English (International)
  + Français
  + Ð ÑÑÑÐºÐ¸Ð¹

# [Mandriva](/mandriva/)

* Download
* Mandriva Linux
* Community
* Help

## One

### The Linux desktopthat's easy to try and easy to keep

Download
![Mandriva One](/sites/all/themes/mandriva_customer/images/front/packshot_Mandriva_One.png)

## Powerpack

### Mandriva Linux- and more

Download
![Mandriva Linux Powerpack](/sites/all/themes/mandriva_customer/images/front/en-49.png)

## Mandriva Flash

### The mobile and installable Linux desktopon a USB key

Buy on Store
![Mandriva Flash](/sites/all/themes/mandriva_customer/images/front/mandriva-flash2.png)

### [Community](community)

* User Forums
* Support - FAQ
* Free Software
* Become a member

### Enterprise Solutions

* Enterprise Linux Products
* Asset Management Solution
* Professional Services
* Support & Maintenance

* Go to site »

### Mandriva Partners

* Worldwide offices
* Partner Program
* Technology Partners
* OEM
* Classmate PC with Mandriva Linux

### News

* Mandriva presents the launch of its new mobile desktop: Mandriva Flash 2008 Spring
* Speaking about Mandriva Linux 2008 Spring in media
* Speaking about Mandriva Linux 2008 Spring in media
* Mandriva presents its latest distribution: Mandriva Linux 2008 Spring
* Mandriva and Novatice Technologies present Edutice, The ready to use solution dedicated to educationand multimedia spaces
* # [Top 50 Online Casinos UK in 2023](https://montycasinos.com/online-casinos/)

more

* Download
  + Mandriva Linux 2008
  + Writing an ISO image
* Mandriva Linux
  + One
  + Powerpack
  + Mandriva Flash
* Community
  + Start
  + Register
  + Stay informed
  + Participate
  + Free software
* Help
  + Getting help
  + Knowledge Base
  + Documentation
  + Forums
  + Support Requests
  + Customer Care
  + Enterprise Support
* Enterprise Solutions
  + Products
  + Support
  + Services
  + Partners
  + Go to site »

Language
English (International)
Français
Ð ÑÑÑÐºÐ¸Ð¹

* © 2007 Mandriva S.A.
* About Us
* Legal Information
* Privacy Policy
* Contact Us



=== Content from bugzilla.mozilla.org_d2ef1501_20250124_235746.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/682252)
* [XML](/show_bug.cgi?ctype=xml&id=682252)

Closed
[Bug 682252](/show_bug.cgi?id=682252)

Opened 13 years ago
Closed 13 years ago

# YARR Assertion failure: static\_cast<unsigned>(-position) <= pos (or optimized crash [@ JSC::Yarr::Interpreter::checkCharacterClass])

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

YARR Assertion failure: static\_cast<unsigned>(-position) <= pos (or optimized crash [@ JSC::Yarr::Interpreter::checkCharacterClass])

## Categories

### (Core :: JavaScript Engine, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=JavaScript%20Engine#JavaScript%20Engine)

JavaScript Engine
▾

Core :: JavaScript Engine
The interpreter engine for the core JavaScript language, independent of the browser's object model. File ONLY core JavaScript language bugs in this category. For bugs involving browser objects such as "window" and "document", use the "DOM" component. For bugs involving calls between JavaScript and C++, use the "XPConnect" component.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=JavaScript%20Engine&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=JavaScript%20Engine&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=JavaScript%20Engine)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

x86\_64

Linux

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

critical

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

---

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| a11y-review | --- |
| --- | --- |
| Webcompat Score | --- |
| Accessibility Severity | --- |
| Performance Impact | --- |
| Webcompat Priority | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox6 | [-](/buglist.cgi?f1=cf_tracking_firefox6&o1=equals&v1=-) | [unaffected](/buglist.cgi?f1=cf_status_firefox6&o1=equals&v1=unaffected) |
| firefox7 | [-](/buglist.cgi?f1=cf_tracking_firefox7&o1=equals&v1=-) | [wontfix](/buglist.cgi?f1=cf_status_firefox7&o1=equals&v1=wontfix) |
| firefox8 | [-](/buglist.cgi?f1=cf_tracking_firefox8&o1=equals&v1=-) | [affected](/buglist.cgi?f1=cf_status_firefox8&o1=equals&v1=affected) |
| firefox9 | [+](/buglist.cgi?f1=cf_tracking_firefox9&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=fixed) |
| firefox10 | [+](/buglist.cgi?f1=cf_tracking_firefox10&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=fixed) |
| status1.9.2 | --- | [unaffected](/buglist.cgi?f1=cf_status_192&o1=equals&v1=unaffected) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox6 | - | unaffected |
| firefox7 | - | wontfix |
| firefox8 | - | affected |
| firefox9 | + | fixed |
| firefox10 | + | fixed |
| status1.9.2 |  | unaffected |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: decoder, Assigned: dmandelin)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/a86fae4b06c1570a6c1a1bc1c5a6c1f6?d=mm&size=40)  [dmandelin](/user_profile?user_id=294323)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/b29b83d12aba827b8ff68296e473bec5?d=mm&size=40)  [decoder](/user_profile?user_id=395101)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/4fe52ee1503aecf7b6c976b8eb7c1753?d=mm&size=40)  [willyelm](/user_profile?user_id=714609)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

8 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

[683838](/show_bug.cgi?id=683838 "VERIFIED FIXED - Different regular expression result since Firefox 7")

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[625600](/show_bug.cgi?id=625600 "RESOLVED FIXED - Update Yarr import"), [682572](/show_bug.cgi?id=682572 "RESOLVED DUPLICATE - YARR Assertion failure: (matchBegin == -1) || (matchBegin <= matchEnd) (or optimized crash [@ JSC::Yarr::Interpreter::checkCasedCharacter])")

Dependency [tree](/showdependencytree.cgi?id=682252&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=682252)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[Duplicates:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#duplicates)

[682572](/show_bug.cgi?id=682572 "RESOLVED DUPLICATE - YARR Assertion failure: (matchBegin == -1) || (matchBegin <= matchEnd) (or optimized crash [@ JSC::Yarr::Interpreter::checkCasedCharacter])")

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

[bugs.webkit.org/show\_bug.cgi?id=67454](https://bugs.webkit.org/show_bug.cgi?id=67454 "https://bugs.webkit.org/show_bug.cgi?id=67454")

## Details

### (4 keywords, Whiteboard: [sg:high][js-triage-needed][qa-] wanted-standalone-js)

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[assertion](/buglist.cgi?keywords=assertion&resolution=---),
[crash](/buglist.cgi?keywords=crash&resolution=---),
[regression](/buglist.cgi?keywords=regression&resolution=---),
[testcase](/buglist.cgi?keywords=testcase&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[sg:high][js-triage-needed][qa-] wanted-standalone-js

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [decoder](/user_profile?user_id=395101) | [in-testsuite](#c9 "13 years ago") | + |
| --- | --- | --- |
| [decoder](/user_profile?user_id=395101) | in-testsuite | + |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | qe-verify |  |

## Crash Data

Signature:

[[@ JSC::Yarr::Interpreter::checkCharacterClass ]](https://crash-stats.mozilla.org/signature/?signature=JSC%3A%3AYarr%3A%3AInterpreter%3A%3AcheckCharacterClass)

[[@ JSC::Yarr::Interpreter::InputStream::readChecked ]](https://crash-stats.mozilla.org/signature/?signature=JSC%3A%3AYarr%3A%3AInterpreter%3A%3AInputStream%3A%3AreadChecked)

## Security

### (public)

This bug is publicly visible.

## User Story

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=682252#c0)• 13 years ago |
|  | |

The following test crashes (YARR assert) on mozilla-central (tested revision 7054f0e3e70e) when run with options "-j -m". Test was produced by LangFuzz with the regular expression extension:
re = new RegExp("([^b]\*)+((..)|(\\3))+?Sc\*a!(a|ab)(c|bcd)(<\*)", "i");
var str = "aNULLxabcd";
str.replace(re, function(s) { return s; });
Optimized shell furthermore crashes dangerously:
==12570== Invalid read of size 2
==12570== at 0x51F060: JSC::Yarr::Interpreter::checkCharacterClass(JSC::Yarr::CharacterClass\*, bool, int) (YarrInterpreter.cpp:212)
==12570== by 0x51F420: JSC::Yarr::Interpreter::matchCharacterClass(JSC::Yarr::ByteTerm&, JSC::Yarr::Interpreter::DisjunctionContext\*) (YarrInterpreter.cpp:454)
==12570== by 0x51FD87: JSC::Yarr::Interpreter::matchDisjunction(JSC::Yarr::ByteDisjunction\*, JSC::Yarr::Interpreter::DisjunctionContext\*, bool, bool) (YarrInterpreter.cpp:1194)
==12570== by 0x51F81F: JSC::Yarr::Interpreter::matchNonZeroDisjunction(JSC::Yarr::ByteDisjunction\*, JSC::Yarr::Interpreter::DisjunctionContext\*, bool) (YarrInterpreter.cpp:1376)
==12570== by 0x5201AF: JSC::Yarr::Interpreter::matchParentheses(JSC::Yarr::ByteTerm&, JSC::Yarr::Interpreter::DisjunctionContext\*) (YarrInterpreter.cpp:881)
==12570== by 0x51FDA7: JSC::Yarr::Interpreter::matchDisjunction(JSC::Yarr::ByteDisjunction\*, JSC::Yarr::Interpreter::DisjunctionContext\*, bool, bool) (YarrInterpreter.cpp:1202)
==12570== by 0x5202D8: JSC::Yarr::Interpreter::interpret() (YarrInterpreter.cpp:1401)
==12570== by 0x51EB52: JSC::Yarr::interpret(JSC::Yarr::BytecodePattern\*, unsigned short const\*, unsigned int, unsigned int, int\*) (YarrInterpreter.cpp:1901)
==12570== by 0x414BD9: js::RegExp::executeInternal(JSContext\*, js::RegExpStatics\*, JSString\*, unsigned long\*, bool, js::Value\*) (jsregexpinlines.h:371)
==12570== by 0x4982AE: DoMatch(JSContext\*, js::RegExpStatics\*, JSString\*, RegExpPair const&, bool (\*)(JSContext\*, js::RegExpStatics\*, unsigned long, void\*), void\*, MatchControlFlags, js::Value\*) (jsregexpinlines.h:167)
==12570== by 0x49A0AF: js::str\_replace(JSContext\*, unsigned int, js::Value\*) (jsstr.cpp:2049)
==12570== by 0x51019C: CallCompiler::generateNativeStub() (jscntxtinlines.h:281)
==12570== Address 0x2041039c4 is not stack'd, malloc'd or (recently) free'd
==12570==
==12570==
==12570== Process terminating with default action of signal 11 (SIGSEGV)
==12570== Access not within mapped region at address 0x2041039C4
Bisect shows the same revision as [bug 679986](/show_bug.cgi?id=679986 "VERIFIED FIXED - Assertion failure: limit >= start, at jsregexpinlines.h:274 or Crash [@ QuoteString]") (the YARR import):
The first bad revision is:
changeset: 70607:cc36a234d0d6
user: David Mandelin <dmandelin@mozilla.com>
date: Thu May 12 18:39:47 2011 -0700
summary: [Bug 625600](/show_bug.cgi?id=625600 "RESOLVED FIXED - Update Yarr import"): Update Yarr import to WebKit rev 86639, r=cdleary,dvander
It seems unlikely to me though that it's the same bug (more likely the import of that WebKit revision pulled in a few bugs). Cloned this from [bug 679986](/show_bug.cgi?id=679986 "VERIFIED FIXED - Assertion failure: limit >= start, at jsregexpinlines.h:274 or Crash [@ QuoteString]") including all tracking flags.

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=682252#a105845_395101)• 13 years ago |

Blocks: [682572](/show_bug.cgi?id=682572 "RESOLVED DUPLICATE - YARR Assertion failure: (matchBegin == -1) || (matchBegin <= matchEnd) (or optimized crash [@ JSC::Yarr::Interpreter::checkCasedCharacter])")

|  | [David Mandelin [:dmandelin]](/user_profile?user_id=294323)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=682252#a356521_294323)• 13 years ago |

Whiteboard: [sg:critical?] → [sg:critical?][js-triage-needed]

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=682252#a552291_12352)• 13 years ago |

[status-firefox7](/buglist.cgi?f1=cf_status_firefox7&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox7&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox7&o1=equals&v1=wontfix)
[tracking-firefox7](/buglist.cgi?f1=cf_tracking_firefox7&o1=isnotempty):
[+](/buglist.cgi?f1=cf_tracking_firefox7&o1=equals&v1=%2B) → [-](/buglist.cgi?f1=cf_tracking_firefox7&o1=equals&v1=-)

|  | [David Mandelin [:dmandelin]](/user_profile?user_id=294323)  Assignee |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=682252#c1)• 13 years ago |
|  | |

This also affects WebKit trunk. Filed <https://bugs.webkit.org/show_bug.cgi?id=67454>

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=682252#c2)• 13 years ago |
|  | |

@dmandelin: Can you Cc me on the webkit bug? Same email address as used here. Thanks!

|  | [David Mandelin [:dmandelin]](/user_profile?user_id=294323)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=682252#a2456488_294323)• 13 years ago |

Assignee: general → dmandelin

|  | [Wesley W. Garland](/user_profile?user_id=122472) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=682252#a2600986_122472)• 13 years ago |

Whiteboard: [sg:critical?][js-triage-needed] → [sg:critical?][js-triage-needed] wanted-standalone-js

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=682252#a4713851_1689)• 13 years ago |

[status1.9.2](/buglist.cgi?f1=cf_status_192&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_192&o1=equals&v1=unaffected)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=682252#a4785194_1689)• 13 years ago |

[status-firefox10](/buglist.cgi?f1=cf_status_firefox10&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=affected)
[tracking-firefox10](/buglist.cgi?f1=cf_tracking_firefox10&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox10&o1=equals&v1=%2B)
[tracking-firefox8](/buglist.cgi?f1=cf_tracking_firefox8&o1=isnotempty):
[+](/buglist.cgi?f1=cf_tracking_firefox8&o1=equals&v1=%2B) → [-](/buglist.cgi?f1=cf_tracking_firefox8&o1=equals&v1=-)See Also: → <https://bugs.webkit.org/show_bug.cgi?id=67454>

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=682252#c3)• 13 years ago |
|  | |

I cannot reproduce this anymore since the fix for [bug 683838](/show_bug.cgi?id=683838 "VERIFIED FIXED - Different regular expression result since Firefox 7") landed:
The first good revision is:
changeset: 78388:b9bae20fb35c
user: Gavin Barraclough
date: Fri Oct 07 17:52:50 2011 -0700
summary: [Bug 683838](/show_bug.cgi?id=683838 "VERIFIED FIXED - Different regular expression result since Firefox 7"): Fix return logic in backTrackParentheses, r=dmandelin
Someone from the JS dev team should verify that these two we're really the same issues and mark this fixed as appropriate.
Furthermore, I'm marking this as sg:high because the symptoms look similar to those described in [comment 18](/show_bug.cgi?id=682252#c18 "VERIFIED FIXED - YARR Assertion failure: static_cast<unsigned>(-position) <= pos (or optimized crash [@ JSC::Yarr::Interpreter::checkCharacterClass])") of [bug 679986](/show_bug.cgi?id=679986 "VERIFIED FIXED - Assertion failure: limit >= start, at jsregexpinlines.h:274 or Crash [@ QuoteString]"). Feel free to adjust the rating if this is not correct.Whiteboard: [sg:critical?][js-triage-needed] wanted-standalone-js → [sg:high][js-triage-needed] wanted-standalone-js

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=682252#a5816470_395101)• 13 years ago |

Depends on: [683838](/show_bug.cgi?id=683838 "VERIFIED FIXED - Different regular expression result since Firefox 7")

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=682252#a5816490_395101)• 13 years ago |

Flags: in-testsuite?

|  | [David Mandelin [:dmandelin]](/user_profile?user_id=294323)  Assignee |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=682252#c5)• 13 years ago |
|  | |

I can't repro this any more either, so I'm pretty sure it's a dup. The presumed fix was merged to aurora, and I verified this no longer crashes there as well.Status: NEW → RESOLVEDClosed: 13 years ago
[status-firefox10](/buglist.cgi?f1=cf_status_firefox10&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=fixed)
[status-firefox9](/buglist.cgi?f1=cf_status_firefox9&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=fixed)Resolution: --- → DUPLICATE

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=682252#c6)• 13 years ago |
|  | |

I was told s-g bugs are not duped to non-sg bugs but rather resolved as fixed with a depend on the duplicate bug. Shall we still do that here?

|  | [David Mandelin [:dmandelin]](/user_profile?user_id=294323)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=682252#a5999521_294323)• 13 years ago |

Resolution: DUPLICATE → FIXED

|  | [u279076](/user_profile?user_id=279076) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=682252#c7)• 13 years ago |
|  | |

Due to the dependencies to reproduce this bug, marking qa-. Chrisitian, could you kindly verify this is fixed on Firefox 9 and 10?Whiteboard: [sg:high][js-triage-needed] wanted-standalone-js → [sg:high][js-triage-needed][qa-] wanted-standalone-js

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=682252#c8)• 13 years ago |
|  | |

Confirmed to be fixed on Firefox 9 and 10.

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=682252#a15073494_1689)• 13 years ago |

Group: core-security

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=682252#a18187228_395101)• 13 years ago |

Status: RESOLVED → VERIFIED

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=682252#c9)• 12 years ago |
|  | |

Automatically extracted testcase for this bug was committed:
<https://hg.mozilla.org/mozilla-central/rev/efaf8960a929>Flags: in-testsuite? → in-testsuite+
You need to [log in](/show_bug.cgi?id=682252&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑



=== Content from bugzilla.mozilla.org_f002802f_20250124_235744.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/680687)
* [XML](/show_bug.cgi?ctype=xml&id=680687)

Closed
[Bug 680687](/show_bug.cgi?id=680687)

Opened 13 years ago
Closed 13 years ago

# Crash [@ nsSVGSwitchElement::FindActiveChild] after GC

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Crash [@ nsSVGSwitchElement::FindActiveChild] after GC

## Categories

### (Core :: SVG, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=SVG#SVG)

SVG
▾

Core :: SVG

Issues with the layout or rendering of SVG content and interacting with the SVG DOM.

Example bugs:

* SVG marker can not be clipped with clip-path
* x position adjustments of SVG vertical text on a path moves in the wrong direction

Specifications covered:

* SVG

[See Open Bugs in This Component](/buglist.cgi?product=Core&component=SVG&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=SVG&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=SVG)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

x86

macOS

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

critical

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

---

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Performance Impact | --- |
| --- | --- |
| Accessibility Severity | --- |
| Webcompat Priority | --- |
| Webcompat Score | --- |
| a11y-review | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox7 | [-](/buglist.cgi?f1=cf_tracking_firefox7&o1=equals&v1=-) | [unaffected](/buglist.cgi?f1=cf_status_firefox7&o1=equals&v1=unaffected) |
| firefox8 | [-](/buglist.cgi?f1=cf_tracking_firefox8&o1=equals&v1=-) | [unaffected](/buglist.cgi?f1=cf_status_firefox8&o1=equals&v1=unaffected) |
| firefox9 | [+](/buglist.cgi?f1=cf_tracking_firefox9&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=fixed) |
| firefox10 | [+](/buglist.cgi?f1=cf_tracking_firefox10&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=fixed) |
| status1.9.2 | --- | [unaffected](/buglist.cgi?f1=cf_status_192&o1=equals&v1=unaffected) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox7 | - | unaffected |
| firefox8 | - | unaffected |
| firefox9 | + | fixed |
| firefox10 | + | fixed |
| status1.9.2 |  | unaffected |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: jruderman, Assigned: smaug)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/056757eff6ed7c8ec26f61e3bf7695fe?d=mm&size=40)  [smaug](/user_profile?user_id=39966)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/d2dc9227eafcd0ec5ba3712ee4f19b75?d=mm&size=40)  [jruderman](/user_profile?user_id=11608)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](extensions/Gravatar/web/default.jpg)  [jwatt](/user_profile?user_id=32767)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

6 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[344905](/show_bug.cgi?id=344905 "RESOLVED FIXED - [meta] SVG Element and Attribute fuzzer")

Dependency [tree](/showdependencytree.cgi?id=680687&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=680687)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: crash, testcase, verified-beta, Whiteboard: [sg:critical?][qa!] possible regression from 335998?)

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[crash](/buglist.cgi?keywords=crash&resolution=---),
[testcase](/buglist.cgi?keywords=testcase&resolution=---),
[verified-beta](/buglist.cgi?keywords=verified-beta&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[sg:critical?][qa!] possible regression from 335998?

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |
|  | qe-verify |  |

## Crash Data

Signature:

[[@ nsSVGSwitchElement::FindActiveChild ]](https://crash-stats.mozilla.org/signature/?signature=nsSVGSwitchElement%3A%3AFindActiveChild)

[[@ nsNodeUtils::ContentRemoved ]](https://crash-stats.mozilla.org/signature/?signature=nsNodeUtils%3A%3AContentRemoved)

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (3 files)

| [testcase (requires extension for GC) (crashes when loaded)](/attachment.cgi?id=554650)  [13 years ago](#c0)  [Jesse Ruderman](/user_profile?user_id=11608)   453 bytes, image/svg+xml |  | [Details](/attachment.cgi?id=554650&action=edit) |
| --- | --- | --- |
| [stack trace (mac, debug, gdb)](/attachment.cgi?id=554651)  [13 years ago](#c1)  [Jesse Ruderman](/user_profile?user_id=11608)   10.37 KB, text/plain |  | [Details](/attachment.cgi?id=554651&action=edit) |
| [Follow the COM rules](/attachment.cgi?id=554672)  [13 years ago](#c3)  [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966)   6.63 KB, patch | jst : [review+](#a214983_12352 "13 years ago") | [Details](/attachment.cgi?id=554672&action=edit) | [Diff](/attachment.cgi?id=554672&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=680687&attachment=554672) |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Jesse Ruderman](/user_profile?user_id=11608)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=680687#c0)• 13 years ago |
|  | |

Attached image
[testcase (requires extension for GC) (crashes when loaded)](attachment.cgi?id=554650)
— [Details](attachment.cgi?id=554650&action=edit)

1. Install <https://www.squarefree.com/extensions/domFuzzLite2.xpi>
2. Load the testcase.
Result:
Debug: Crash [@ nsSVGSwitchElement::FindActiveChild] calling 0x0 ?
Opt: Crash [@ nsNodeUtils::ContentRemoved] calling bogus ?
The GC pattern makes me wonder if this is related to [bug 335998](/show_bug.cgi?id=335998 "VERIFIED FIXED - parentNode of element gets lost") being fixed.

|  | [Jesse Ruderman](/user_profile?user_id=11608)  Reporter |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=680687#c1)• 13 years ago |
|  | |

Attached file
[stack trace (mac, debug, gdb)](attachment.cgi?id=554651)
— [Details](attachment.cgi?id=554651&action=edit)

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966)  Assignee |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=680687#c2)• 13 years ago |
|  | |

Um, nsSVGSwitchElement overrides InsertChildAt/RemoveChildAtAssignee: nobody → Olli.Pettay

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966)  Assignee |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=680687#c3)• 13 years ago |
|  | |

Attached patch

[Follow the COM rules](attachment.cgi?id=554672&action=diff)
— [Details](attachment.cgi?id=554672&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=680687&attachment=554672)

The changes shouldn't be in hot paths, and this is the right thing to do.
Yet, it is unfortunate to add new Addref/releases.
[Attachment #554672](/attachment.cgi?id=554672&action=edit "Follow the COM rules") -
Flags: review?(jst)

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966)  Assignee |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=680687#c4)• 13 years ago |
|  | |

...so I patched all the cases I found where similar problem could occur,
not only nsGenericElement.

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966)  Assignee |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=680687#c5)• 13 years ago |
|  | |

And note, in parser eTreeOpAppendChildrenToNewParent
it is really the node which needs to be strong.

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=680687#a181541_1689)• 13 years ago |

Whiteboard: [sg:critical?] possible regression from 335998?

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=680687#a214983_12352)• 13 years ago |

[Attachment #554672](/attachment.cgi?id=554672&action=edit "Follow the COM rules") -
Flags: review?(jst) → review+

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966)  Assignee |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=680687#c6)• 13 years ago |
|  | |

<http://hg.mozilla.org/mozilla-central/rev/071d9c997f3d>Status: NEW → RESOLVEDClosed: 13 years agoResolution: --- → FIXED

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=680687#c7)• 13 years ago |
|  | |

Olli, this is something we could take in 8, right?
[status-firefox10](/buglist.cgi?f1=cf_status_firefox10&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=fixed)
[status-firefox7](/buglist.cgi?f1=cf_status_firefox7&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox7&o1=equals&v1=wontfix)
[status-firefox8](/buglist.cgi?f1=cf_status_firefox8&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox8&o1=equals&v1=affected)
[status-firefox9](/buglist.cgi?f1=cf_status_firefox9&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=fixed)
[tracking-firefox10](/buglist.cgi?f1=cf_tracking_firefox10&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox10&o1=equals&v1=%2B)
[tracking-firefox7](/buglist.cgi?f1=cf_tracking_firefox7&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox7&o1=equals&v1=%2B)
[tracking-firefox8](/buglist.cgi?f1=cf_tracking_firefox8&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox8&o1=equals&v1=%2B)
[tracking-firefox9](/buglist.cgi?f1=cf_tracking_firefox9&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox9&o1=equals&v1=%2B)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=680687#c8)• 13 years ago |
|  | |

I could not reproduce the crash using the testcase on Firefox 8 (beta), is it possible this was introduced by something in Firefox 9 rather than [bug 335998](/show_bug.cgi?id=335998 "VERIFIED FIXED - parentNode of element gets lost") as Jesse guessed? Didn't see any script errors running the testcase so I think I ran it correctly, but I'd be happier if Jesse concurred. It's also possible something else that landed on both Fx9 and 8 masked/fixed this, or something that landed earlier on Fx9 that un-masked the underlying problem.

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966)  Assignee |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=680687#c9)• 13 years ago |
|  | |

The patch for [bug 335998](/show_bug.cgi?id=335998 "VERIFIED FIXED - parentNode of element gets lost") is not in FF8.

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966)  Assignee |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=680687#c10)• 13 years ago |
|  | |

I don't see any reason to take this to FF8.

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=680687#c11)• 13 years ago |
|  | |

Excellent, thanks Olli!
[status-firefox7](/buglist.cgi?f1=cf_status_firefox7&o1=isnotempty):
[wontfix](/buglist.cgi?f1=cf_status_firefox7&o1=equals&v1=wontfix) → [unaffected](/buglist.cgi?f1=cf_status_firefox7&o1=equals&v1=unaffected)
[status-firefox8](/buglist.cgi?f1=cf_status_firefox8&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox8&o1=equals&v1=affected) → [unaffected](/buglist.cgi?f1=cf_status_firefox8&o1=equals&v1=unaffected)
[tracking-firefox7](/buglist.cgi?f1=cf_tracking_firefox7&o1=isnotempty):
[+](/buglist.cgi?f1=cf_tracking_firefox7&o1=equals&v1=%2B) → [-](/buglist.cgi?f1=cf_tracking_firefox7&o1=equals&v1=-)
[tracking-firefox8](/buglist.cgi?f1=cf_tracking_firefox8&o1=isnotempty):
[+](/buglist.cgi?f1=cf_tracking_firefox8&o1=equals&v1=%2B) → [-](/buglist.cgi?f1=cf_tracking_firefox8&o1=equals&v1=-)

|  | [u279076](/user_profile?user_id=279076) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=680687#a8057375_279076)• 13 years ago |

Whiteboard: [sg:critical?] possible regression from 335998? → [sg:critical?][qa+] possible regression from 335998?

|  | [Marcia Knous [:marcia]](/user_profile?user_id=8519) |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=680687#c12)• 13 years ago |
|  | |

Verified fixed using Mozilla/5.0 (Macintosh; Intel Mac OS X 10.6; rv:11.0a1) Gecko/20111122 Firefox/11.0a1. I verified by following the steps in [Comment 0](/show_bug.cgi?id=680687#c0 "VERIFIED FIXED - Crash [@ nsSVGSwitchElement::FindActiveChild] after GC").Status: RESOLVED → VERIFIED

|  | [u279076](/user_profile?user_id=279076) |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=680687#c13)• 13 years ago |
|  | |

(In reply to Marcia Knous [:marcia] from [comment #12](/show_bug.cgi?id=680687#c12 "VERIFIED FIXED - Crash [@ nsSVGSwitchElement::FindActiveChild] after GC"))
> Verified fixed using Mozilla/5.0 (Macintosh; Intel Mac OS X 10.6; rv:11.0a1)
> Gecko/20111122 Firefox/11.0a1. I verified by following the steps in Comment
> 0.
Thanks Marcia. If you have time, could you please also verify on Firefox 9 and 10?

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=680687#a8133881_1689)• 13 years ago |

[status1.9.2](/buglist.cgi?f1=cf_status_192&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_192&o1=equals&v1=unaffected)

|  | [Marcia Knous [:marcia]](/user_profile?user_id=8519) |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=680687#c14)• 13 years ago |
|  | |

Verified fixed using Mozilla/5.0 (Macintosh; Intel Mac OS X 10.6; rv:9.0) Gecko/20100101 Firefox/9.0. The extension is not compatible with Aurora, so I am not sure if forcing compat would be a fair test.

|  | [u279076](/user_profile?user_id=279076) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=680687#a8140166_279076)• 13 years ago |

Keywords: [verified-beta](/buglist.cgi?keywords=verified-beta&resolution=---)Whiteboard: [sg:critical?][qa+] possible regression from 335998? → [sg:critical?][qa!] possible regression from 335998?

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=680687#a15565280_1689)• 13 years ago |

Group: core-security
You need to [log in](/show_bug.cgi?id=680687&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Jesse Ruderman](/user_profile?user_id=11608)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from bugzilla.mozilla.org_128e2eb9_20250124_235801.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/691746)
* [XML](/show_bug.cgi?ctype=xml&id=691746)

Closed
[Bug 691746](/show_bug.cgi?id=691746)

Opened 13 years ago
Closed 13 years ago

# Assertion failure: JSID\_IS\_STRING(id) || JSID\_IS\_INT(id), at jswatchpoint.cpp:207

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Assertion failure: JSID\_IS\_STRING(id) || JSID\_IS\_INT(id), at jswatchpoint.cpp:207

## Categories

### (Core :: JavaScript Engine, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=JavaScript%20Engine#JavaScript%20Engine)

JavaScript Engine
▾

Core :: JavaScript Engine
The interpreter engine for the core JavaScript language, independent of the browser's object model. File ONLY core JavaScript language bugs in this category. For bugs involving browser objects such as "window" and "document", use the "DOM" component. For bugs involving calls between JavaScript and C++, use the "XPConnect" component.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=JavaScript%20Engine&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=JavaScript%20Engine&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=JavaScript%20Engine)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

x86\_64

Linux

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

critical

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

---

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| a11y-review | --- |
| --- | --- |
| Accessibility Severity | --- |
| Webcompat Score | --- |
| Performance Impact | --- |
| Webcompat Priority | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox7 | [-](/buglist.cgi?f1=cf_tracking_firefox7&o1=equals&v1=-) | --- |
| firefox8 | [-](/buglist.cgi?f1=cf_tracking_firefox8&o1=equals&v1=-) | [wontfix](/buglist.cgi?f1=cf_status_firefox8&o1=equals&v1=wontfix) |
| firefox9 | [+](/buglist.cgi?f1=cf_tracking_firefox9&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=fixed) |
| firefox10 | [+](/buglist.cgi?f1=cf_tracking_firefox10&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=fixed) |
| status1.9.2 | --- | [unaffected](/buglist.cgi?f1=cf_status_192&o1=equals&v1=unaffected) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox7 | - |  |
| firefox8 | - | wontfix |
| firefox9 | + | fixed |
| firefox10 | + | fixed |
| status1.9.2 |  | unaffected |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: decoder, Assigned: jorendorff)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/5a83f46f9f97d184457cb2dedfa19173?d=mm&size=40)  [jorendorff](/user_profile?user_id=281791)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/b29b83d12aba827b8ff68296e473bec5?d=mm&size=40)  [decoder](/user_profile?user_id=395101)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/4fe52ee1503aecf7b6c976b8eb7c1753?d=mm&size=40)  [willyelm](/user_profile?user_id=714609)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

12 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: assertion, testcase, Whiteboard: [sg:critical][qa-])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[assertion](/buglist.cgi?keywords=assertion&resolution=---),
[testcase](/buglist.cgi?keywords=testcase&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[sg:critical][qa-]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [decoder](/user_profile?user_id=395101) | [in-testsuite](#c21 "12 years ago") | + |
| --- | --- | --- |
| [decoder](/user_profile?user_id=395101) | in-testsuite | + |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (1 file)

| [v1](/attachment.cgi?id=568771)  [13 years ago](#c3)  [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)   4.17 KB, patch | jimb : [review+](#a1503795_298765 "13 years ago")  christian : [approval-mozilla-aurora+](#c7 "13 years ago")  christian : [approval-mozilla-beta-](#c7 "13 years ago") | [Details](/attachment.cgi?id=568771&action=edit) | [Diff](/attachment.cgi?id=568771&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=691746&attachment=568771) |
| --- | --- | --- |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=691746#c0)• 13 years ago |
|  | |

The following test asserts on mozilla-central revision a896a9e237a0 (options -m -n):
var obj = {};
obj.watch(QName(), function () {});
gc();
S-s because this is a gc related assert. It does not crash though in optimized builds. The original test was much more complex due to the missing gc() call, which I added manually.

|  | [David Mandelin [:dmandelin]](/user_profile?user_id=294323) |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=691746#c1)• 13 years ago |
|  | |

We're crashing in watchpoint code. Not sure what the intent is, it may as simple as just not allowing XML names as keys for Object.watch. Jason, could you take a look at this?

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=691746#a724900_1689)• 13 years ago |

Assignee: general → jorendorff

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=691746#a724934_1689)• 13 years ago |

Whiteboard: js-triage-needed → [sg:critical?] js-triage-needed

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=691746#c2)• 13 years ago |
|  | |

If this is something that we can fix safely for 8 then I'd love to do that, that is, assuming that 8 is affected by this. We don't have a whole lot of time left for 8 though...
[status-firefox10](/buglist.cgi?f1=cf_status_firefox10&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=affected)
[status-firefox8](/buglist.cgi?f1=cf_status_firefox8&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox8&o1=equals&v1=affected)
[status-firefox9](/buglist.cgi?f1=cf_status_firefox9&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=affected)
[tracking-firefox10](/buglist.cgi?f1=cf_tracking_firefox10&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox10&o1=equals&v1=%2B)
[tracking-firefox7](/buglist.cgi?f1=cf_tracking_firefox7&o1=isnotempty):
--- → [-](/buglist.cgi?f1=cf_tracking_firefox7&o1=equals&v1=-)
[tracking-firefox8](/buglist.cgi?f1=cf_tracking_firefox8&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox8&o1=equals&v1=%2B)
[tracking-firefox9](/buglist.cgi?f1=cf_tracking_firefox9&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox9&o1=equals&v1=%2B)

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=691746#a1405962_12352)• 13 years ago |

[status-firefox8](/buglist.cgi?f1=cf_status_firefox8&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox8&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox8&o1=equals&v1=wontfix)
[tracking-firefox8](/buglist.cgi?f1=cf_tracking_firefox8&o1=isnotempty):
[+](/buglist.cgi?f1=cf_tracking_firefox8&o1=equals&v1=%2B) → [-](/buglist.cgi?f1=cf_tracking_firefox8&o1=equals&v1=-)

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)  Assignee |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=691746#c3)• 13 years ago |
|  | |

Attached patch

[v1](attachment.cgi?id=568771&action=diff)
— [Details](attachment.cgi?id=568771&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=691746&attachment=568771)

[Attachment #568771](/attachment.cgi?id=568771&action=edit "v1") -
Flags: review?

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=691746#c4)• 13 years ago |
|  | |

Given how safe this patch looks I think we can attempt to take this for 8 still.
[status-firefox8](/buglist.cgi?f1=cf_status_firefox8&o1=isnotempty):
[wontfix](/buglist.cgi?f1=cf_status_firefox8&o1=equals&v1=wontfix) → [affected](/buglist.cgi?f1=cf_status_firefox8&o1=equals&v1=affected)
[tracking-firefox8](/buglist.cgi?f1=cf_tracking_firefox8&o1=isnotempty):
[-](/buglist.cgi?f1=cf_tracking_firefox8&o1=equals&v1=-) → [+](/buglist.cgi?f1=cf_tracking_firefox8&o1=equals&v1=%2B)

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=691746#a1494720_281791)• 13 years ago |

[Attachment #568771](/attachment.cgi?id=568771&action=edit "v1") -
Flags: review? → review?(jimb)

|  | [Jim Blandy :jimb](/user_profile?user_id=298765) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=691746#a1503795_298765)• 13 years ago |

[Attachment #568771](/attachment.cgi?id=568771&action=edit "v1") -
Flags: review?(jimb) → review+

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)  Assignee |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=691746#c5)• 13 years ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/58563c49a531>Status: NEW → RESOLVEDClosed: 13 years agoResolution: --- → FIXED

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=691746#a1841559_12352)• 13 years ago |

[status-firefox10](/buglist.cgi?f1=cf_status_firefox10&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=fixed)

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=691746#c6)• 13 years ago |
|  | |

Is this patch good for 8 and 9? If so, please request approvals. We're running very very low on time for 8, so it might be too late there, but the patch does look safe.

|  | [David Mandelin [:dmandelin]](/user_profile?user_id=294323) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=691746#a2103314_294323)• 13 years ago |

[Attachment #568771](/attachment.cgi?id=568771&action=edit "v1") -
Flags: approval-mozilla-beta?
[Attachment #568771](/attachment.cgi?id=568771&action=edit "v1") -
Flags: approval-mozilla-aurora?

|  | [LegNeato](/user_profile?user_id=482154) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=691746#c7)• 13 years ago |
|  | |

Comment on [attachment 568771](/attachment.cgi?id=568771 "v1") [[details]](/attachment.cgi?id=568771&action=edit "v1") [[diff]](/attachment.cgi?id=568771&action=diff "v1") [[review]](/page.cgi?id=splinter.html&ignore=&bug=691746&attachment=568771)
v1
[triage comment]
Approving for 9aurora. At this point not worth the risk on beta. This is internally found so we are comfortable deferring 6 weeks.
[Attachment #568771](/attachment.cgi?id=568771&action=edit "v1") -
Flags: approval-mozilla-beta?
[Attachment #568771](/attachment.cgi?id=568771&action=edit "v1") -
Flags: approval-mozilla-beta-
[Attachment #568771](/attachment.cgi?id=568771&action=edit "v1") -
Flags: approval-mozilla-aurora?
[Attachment #568771](/attachment.cgi?id=568771&action=edit "v1") -
Flags: approval-mozilla-aurora+

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=691746#c8)• 13 years ago |
|  | |

But please do land on aurora this week so it makes it into Fx9 beta.
Christian: does this affect the 1.9.2 branch?
[status1.9.2](/buglist.cgi?f1=cf_status_192&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_status_192&o1=equals&v1=%3F)
[status-firefox8](/buglist.cgi?f1=cf_status_firefox8&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox8&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox8&o1=equals&v1=wontfix)
[tracking-firefox8](/buglist.cgi?f1=cf_tracking_firefox8&o1=isnotempty):
[+](/buglist.cgi?f1=cf_tracking_firefox8&o1=equals&v1=%2B) → [-](/buglist.cgi?f1=cf_tracking_firefox8&o1=equals&v1=-)

|  | [David Mandelin [:dmandelin]](/user_profile?user_id=294323) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=691746#a2368801_294323)• 13 years ago |

Whiteboard: [sg:critical?] js-triage-needed → [sg:critical]

|  | [David Mandelin [:dmandelin]](/user_profile?user_id=294323) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=691746#c9)• 13 years ago |
|  | |

<http://hg.mozilla.org/releases/mozilla-aurora/rev/c8fcdb6bd4d7>
[status-firefox9](/buglist.cgi?f1=cf_status_firefox9&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=fixed)

|  | [juan becerra [:juanb]](/user_profile?user_id=241759) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=691746#c10)• 13 years ago |
|  | |

Adding [qa-] to demote this for bug verification. This isn't easily verifiable by our team.Whiteboard: [sg:critical] → [sg:critical][qa-]

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=691746#c11)• 13 years ago |
|  | |

(In reply to juan becerra [:juanb] from [comment #10](/show_bug.cgi?id=691746#c10 "VERIFIED FIXED - Assertion failure: JSID_IS_STRING(id) || JSID_IS_INT(id), at jswatchpoint.cpp:207"))
> Adding [qa-] to demote this for bug verification. This isn't easily
> verifiable by our team.
There is a three line JS test for this in [comment 0](/show_bug.cgi?id=691746#c0 "VERIFIED FIXED - Assertion failure: JSID_IS_STRING(id) || JSID_IS_INT(id), at jswatchpoint.cpp:207"), isn't that sufficient for verifying?

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)  Assignee |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=691746#c12)• 13 years ago |
|  | |

decoder, that would not be a useful kind of verification, because that is already checked in as an automated test. It runs on every build.
It's good to have both QA humans and QA machines. It's also good for the QA humans to focus on things the QA machines aren't already doing.

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=691746#c13)• 13 years ago |
|  | |

(In reply to Jason Orendorff [:jorendorff] from [comment #12](/show_bug.cgi?id=691746#c12 "VERIFIED FIXED - Assertion failure: JSID_IS_STRING(id) || JSID_IS_INT(id), at jswatchpoint.cpp:207"))
> decoder, that would not be a useful kind of verification, because that is
> already checked in as an automated test. It runs on every build.
Is it? I had at least one case where the test was not added to the testsuite, the bugfix was accidentially reverted and the browser shipped without the fix. Maybe QA could ensure that a test was added, and if that's the case, they don't need to do anything else. Does that make sense?

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)  Assignee |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=691746#c14)• 13 years ago |
|  | |

(In reply to Christian Holler (:decoder) from [comment #13](/show_bug.cgi?id=691746#c13 "VERIFIED FIXED - Assertion failure: JSID_IS_STRING(id) || JSID_IS_INT(id), at jswatchpoint.cpp:207"))
> (In reply to Jason Orendorff [:jorendorff] from [comment #12](/show_bug.cgi?id=691746#c12 "VERIFIED FIXED - Assertion failure: JSID_IS_STRING(id) || JSID_IS_INT(id), at jswatchpoint.cpp:207"))
> > decoder, that would not be a useful kind of verification, because that is
> > already checked in as an automated test. It runs on every build.
>
> Is it?
Yes.
> I had at least one case where the test was not added to the
> testsuite, the bugfix was accidentially reverted and the browser shipped
> without the fix. Maybe QA could ensure that a test was added, and if that's
> the case, they don't need to do anything else. Does that make sense?
That sounds like a terrible use of a human being's time.

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=691746#c15)• 13 years ago |
|  | |

(In reply to Jason Orendorff [:jorendorff] from [comment #14](/show_bug.cgi?id=691746#c14 "VERIFIED FIXED - Assertion failure: JSID_IS_STRING(id) || JSID_IS_INT(id), at jswatchpoint.cpp:207"))
>
> That sounds like a terrible use of a human being's time.
I agree that we should automate what we can automate. To verify that the test was added to the testsuite, we will likely have to change something in the process though (I could imagine adding a testcase field to bugzilla and/or being able to mark attachments as testcases because that would allow automated scripts to check if that test was added to some testsuite).
My initial comment also wasn't meant as a recommendation to do all this manually. I was just trying to point out that "not easy to verify" vs. "automated test available in comment" does not make sense to me.

|  | [juan becerra [:juanb]](/user_profile?user_id=241759) |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=691746#c16)• 13 years ago |
|  | |

Christian, I think I overlooked [comment #0](/show_bug.cgi?id=691746#c0 "VERIFIED FIXED - Assertion failure: JSID_IS_STRING(id) || JSID_IS_INT(id), at jswatchpoint.cpp:207"). Today I was on a rush to triage a list of bugs that needed verification by human eyes, and I didn't read this well enough. I was trying to prioritize.
We could mark this as verified since there is a test included, and it runs in every build.

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=691746#c17)• 13 years ago |
|  | |

Sounds good to me :) Thanks for verifying! :)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=691746#c18)• 13 years ago |
|  | |

qawanted: need to test whether this affects 1.9.2, from the patch it might be old code.blocking1.9.2: --- → ?Keywords: [qawanted](/buglist.cgi?keywords=qawanted&resolution=---)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=691746#c19)• 13 years ago |
|  | |

Dan, you were going to look at this in a debug build?

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=691746#c20)• 13 years ago |
|  | |

Only the first part of this patch would apply to the 1.9.2 branch (jswatchpoint.cpp doesn't exist there, nor the watch() method). Testcase doesn't seem to be causing any issues on the old branch so we can pass on this one.blocking1.9.2: ? → ---
[status1.9.2](/buglist.cgi?f1=cf_status_192&o1=isnotempty):
[?](/buglist.cgi?f1=cf_status_192&o1=equals&v1=%3F) → [unaffected](/buglist.cgi?f1=cf_status_192&o1=equals&v1=unaffected)Keywords: [qawanted](/buglist.cgi?keywords=qawanted&resolution=---)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=691746#a11692839_1689)• 13 years ago |

Group: core-security

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=691746#a14807058_395101)• 13 years ago |

Status: RESOLVED → VERIFIED

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=691746#c21)• 12 years ago |
|  | |

A testcase for this bug was automatically identified at js/src/tests/js1\_8\_5/extensions/regress-691746.js.Flags: in-testsuite+
You need to [log in](/show_bug.cgi?id=691746&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from secunia.com_9e4e2b8c_20250124_235732.html ===


[Skip to main content](#main-content)
[![Home](/themes/custom/flexera/images/logo.svg)](https://www.flexera.com/)

[![Home](/themes/custom/flexera/images/logo.svg)](https://www.flexera.com/)

Search

## Main navigation

* Solutions
  + Column 1
    - Business challenge
      * [Software renewals and audits](https://www.flexera.com/solutions/software-renewals-audits)
      * [Software license management and optimization](https://www.flexera.com/solutions/software-usage-costs)
      * [SaaS spend management](https://www.flexera.com/solutions/saas-spend)
      * [Cloud cost management](https://www.flexera.com/solutions/cloud-cost)
      * [IT asset lifecycle management](https://www.flexera.com/solutions/it-asset-lifecycle)
      * [CMDB data quality](https://www.flexera.com/solutions/cmdb-data-quality)
      * [Accurate IT inventory](https://www.flexera.com/solutions/it-inventory)
      * [Security and regulatory risk management](https://www.flexera.com/solutions/it-security-regulatory-risk)
      * [Sustainable IT](https://www.flexera.com/solutions/sustainable-it)
      * [AI-powered transformation](https://www.flexera.com/solutions/ai-powered-transformation)
      * [Public sector](https://www.flexera.com/solutions/public-sector)
  + Column 2
    - Spend management by vendor
      * [IBM](https://www.flexera.com/solutions/vendor/ibm)
      * [Oracle](https://www.flexera.com/solutions/vendor/oracle)
      * [Microsoft](https://www.flexera.com/solutions/vendor/microsoft)
      * [SAP](https://www.flexera.com/solutions/vendor/sap)
      * [VMware](https://www.flexera.com/solutions/vendor/vmware)
      * [ServiceNow](https://www.flexera.com/solutions/vendor/servicenow)
      * [AWS](https://www.flexera.com/solutions/vendor/aws)
      * [Salesforce](https://www.flexera.com/solutions/vendor/salesforce)
      * [BMC](https://www.flexera.com/solutions/cmdb-data-quality/bmc)
      * [Adobe](https://www.flexera.com/solutions/vendor/adobe)

  ### Achieve more through a united FinOps and ITAM function

  The future is hybrid. Break down the walls between ITAM and FinOps to drive more revenue, more customer growth and more innovation.

  [Discover More](https://www.flexera.com/resources/hybrid-itam-finops)
* Products
  + Column 1
    - [Flexera One](https://www.flexera.com/products/flexera-one)
      * [IT Visibility](https://www.flexera.com/products/flexera-one/it-visibility)
      * [ITAM](https://www.flexera.com/products/flexera-one/it-asset-management)
      * [SaaS Management](https://www.flexera.com/products/flexera-one/saas-management)
      * [FinOps](https://www.flexera.com/products/flexera-one/finops)
      * [Technology Intelligence Platform](https://www.flexera.com/products/flexera-one/technology-intelligence-platform)
  + Column 2
    - [Snow Atlas](https://www.flexera.com/products/snow-atlas)
      * [Snow Spend Optimizer](https://www.flexera.com/products/snow-atlas/snow-spend-optimizer)
      * [Snow SaaS Management](https://www.flexera.com/products/snow-atlas/snow-saas-management)
  + Column 3
    - Hide group
      * [Security](https://www.flexera.com/products/security)
      * [Application Readiness](https://www.flexera.com/products/adminstudio)
      * [All products](https://www.flexera.com/products)
      * [All Snow products](https://www.flexera.com/products/snow)
      * [Integrations](https://www.flexera.com/products/integrations)

  ### Flexera 2024 State of the Cloud Report

  What do transformative initiatives such as GenAI, machine learning and sustainability mean for the cloud? Check out the 2024 State of the Cloud Report to find the answer as well as all the latest cloud computing trends.

  [View Report](https://info.flexera.com/CM-REPORT-State-of-the-Cloud)
* Success
  + Column 1
    - [Customer success](https://www.flexera.com/customer-success)
      * Support
        + [Flexera support portal](https://community.flexera.com/s/support-hub)
        + [Flexera product documentation](https://docs.flexera.com)
        + [Snow product documentation](https://docs.snowsoftware.io/)
      * Services and training
        + [Services](https://www.flexera.com/customer-success/services)
        + [Training](https://www.flexera.com/customer-success/training)
  + Column 2
    - Hide group
      * [Technology Intelligence Awards](https://www.flexera.com/customer-success/awards)
      * [Flexera community](https://community.flexera.com/s/)

  ### Insights from Gartner®

  Find a curated series of actionable and objective insights for IT executives and their teams. Get expert insights from valued analysts, courtesy of Flexera.

  [Discover More](https://www.flexera.com/resources/gartner-analyst-research)
* Resources
  + Column 1
    - [Resources](https://www.flexera.com/resources)
      * [Webinars](https://www.flexera.com/resources?type%5Bwebinar%5D=webinar)
      * [Videos](https://www.flexera.com/resources?type%5Bvideo%5D=video)
      * [Datasheets](https://www.flexera.com/resources?type%5Bdatasheet%5D=datasheet)
      * [White papers & reports](https://www.flexera.com/resources?type%5Bwhite-paper-industry-report%5D=white-paper-industry-report)
  + Column 2
    - Hide group
      * [Blog](/blog/)
      * [Case studies](https://www.flexera.com/resources/case-studies)
      * [Events](https://www.flexera.com/resources?type%5Bevent%5D=event)
      * [Analyst Research](https://www.flexera.com/resources/gartner-analyst-research)
      * [Glossary](https://www.flexera.com/resources/glossary)
      * [Demos & trials](https://www.flexera.com/resources?type%5Bdemo-trials%5D=demo-trials)
      * [Business value calculator](https://www.flexera.com/resources/business-value-calculator)

  ### Flexera 2025 IT Priorities Report

  Insights from Flexera’s 2025 IT Priorities Report highlight what’s top of mind for IT decision makers in the year ahead. Discover the challenges, priorities and opportunities that will shape the future IT landscape.

  [View Report](https://info.flexera.com/ITV-REPORT-IT-Priorities)
* About
  + Column 1
    - [Company](https://www.flexera.com/about-us)
      * [About](https://www.flexera.com/about-us)
      * [Careers](https://www.flexera.com/about-us/careers)
      * [Contact](https://www.flexera.com/about-us/contact-us)
      * [Leadership](https://www.flexera.com/about-us/leadership)
    - [Partners](https://www.flexera.com/about-us/partners)
      * [Partner program](https://www.flexera.com/about-us/partners/partner-program)
      * [Partner directory](https://www.flexera.com/about-us/partners/directory)
  + Column 2
    - [Press center](https://www.flexera.com/about-us/press-center)
      * [Press releases](https://www.flexera.com/about-us/all-press-releases)
      * [Awards](https://www.flexera.com/about-us/press-center#awards)
      * [Articles](https://www.flexera.com/about-us/all-articles)
    - Hide group
      * Social responsibility
        + [ESG](https://www.flexera.com/about-us/environmental-social-governance)
        + [Diversity](https://www.flexera.com/about-us/diversity)

  ### More value with technology intelligence

  The unparalleled synergy of Flexera and Snow provides the Technology Intelligence you need for more efficiency, insight and governance than ever before.

  [Discover More](https://www.flexera.com/more-value-with-technology-intelligence)

Search

en

* [English](https://www.flexera.com/products/security/software-vulnerability-research/secunia-research?referrer=secunia)
* [Deutsch](https://www.flexera.de/products/security/software-vulnerability-research/secunia-research?referrer=secunia)

## External Links

* External Links
  + [Community](https://community.flexera.com/)
  + [Product Access](https://app.flexera.com/login)
  + [Partner Portal](https://flexera.channeltivity.com/Login)

[Book a demo](/about-us/contact-us?C_Interest1=sales)

# Secunia Research

## The world’s best vulnerability intelligence

The Secunia Research team from Flexera provides the most accurate and reliable source of vulnerability intelligence.

[Contact Us](https://www.flexera.com/about-us/contact-us?C_Interest1=sales&C_SolutionInterest=SVM)
Watch video (0:29)

Related links

* [Anatomy of a security advisory](https://www.flexera.com/resources/infographics/anatomy-of-a-security-advisory)
* [Software Vulnerability Research](https://www.flexera.com/products/software-vulnerability-research)
* [Software Vulnerability Manager](/products/software-vulnerability-manager)
* [Security advisories from Secunia Research](https://www.flexera.com/products/security/software-vulnerability-advisories)
* [Report a vulnerability](https://www.flexera.com/about-us/contact-us/report-vulnerability)

 ![Secunia Research](/sites/default/files/2022-04/hero-secunia-research-bg.jpg)

Featured Details

## Multiple ways to consume Secunia Research

Secunia delivers software security research that provides reliable, curated and actionable vulnerability intelligence. Organizations can expect to receive standardized, validated and enriched vulnerability research on a specific version of a software product. Secunia Research supports four solutions:

![Software Vulnerability Research](/sites/default/files/2022-04/icon-secunia-research-svr.svg)

### [Software Vulnerability Research](https://www.flexera.com/products/software-vulnerability-research)

Software Vulnerability Research utilizes Secunia Research to drive awareness of vulnerabilities matching your specified criteria

[Learn More](https://www.flexera.com/products/software-vulnerability-research)

![Software Vulnerability Manager](/sites/default/files/2022-04/icon-secunia-research-svm.svg)

### [Software Vulnerability Manager](/products/software-vulnerability-manager)

Software Vulnerability Manager uses Secunia Research data to identify, prioritize and patch known vulnerable software detected in your environment

[Learn More](/products/software-vulnerability-manager)

![Data Platform](/sites/default/files/2022-04/icon-secunia-research-dp.svg)

### [Data Platform](https://www.flexera.com/products/data-platform)

Data Platform leverages Secunia Research to provide high-level insights based on major or minor versions of software in your normalized inventory

[Learn More](https://www.flexera.com/products/data-platform)

![Flexera One](/sites/default/files/2022-04/icon-secunia-research-flexera-one.svg)

### [Flexera One](/flexera-one)

Flexera One utilizes Secunia Research (alongside public NVD data) to provide more granular matching of build-level versions of software in your normalized inventory within its IT Asset Management and IT Visibility solutions

[Learn More](/flexera-one)

How it works

## Accurate, reliable vulnerability insights at your fingertips

The Secunia Research team from Flexera is comprised of several security specialists who conduct vulnerability research in various products in addition to testing, verifying and validating public vulnerability reports. Since its inception in 2002, the goal of the Secunia Research team is to provide the most accurate and reliable source of vulnerability intelligence.

Delivering the world’s best vulnerability intelligence requires skill and passion. Team members continually develop their skills exploring various high-profile closed and open-source software using a variety of approaches, focusing chiefly on thorough code audits and binary analysis. The team has received industry recognition, including naming members to [Microsoft’s Most Valuable Security Researchers](https://msrc-blog.microsoft.com/2019/08/07/announcing-2019-msrc-most-valuable-security-researchers/) list.

Secunia researchers discover hard-to-find vulnerabilities that aren’t normally identified with techniques such as fuzzing, and the results have been impressive. Members of the Secunia Research team have discovered critical vulnerabilities in products from vendors including Microsoft, Symantec, IBM, Adobe, RealNetworks, Trend Micro, HP, Blue Coat, Samba, CA, Mozilla and Apple.

The team produces invaluable security advisories based on research of the vulnerabilities affecting any given software update. Sometimes a single update can address multiple vulnerabilities of varying criticalities and threats; but these advisories aggregate and distill findings down to a single advisory perfect for the prioritization of patching efforts within [Software Vulnerability Manager](/products/software-vulnerability-manager). Criticality scores are consistently applied along with details around attack vector and other valuable details within [Software Vulnerability Research](/products/software-vulnerability-research/secunia-research). Illegitimate vulnerability reports are also investigated and rejected so you can focus only on what truly matters.

Informing IT, Transforming IT

## Industry insights to help keep you informed

[#### Webinar

### Stay Ahead of Cyber Threats: Flexera's Latest Vulnerability Insights

Join us for this session where we'll explore the latest findings from the Flexera Monthly Vulnerability Insights Report.](https://info.flexera.com/SVM-WBNR-Vulnerability-Insights-Roundtable)

[#### Webinar

### Dive deeper into the Flexera Annual Vulnerability Insights

We'll explore the key findings from the Flexera Annual Vulnerability Insights Report. Learn about the latest cybersecurity trends, the most targeted industries, the types of vulnerabilities, plus management and mitigation strategies.](https://info.flexera.com/SVM-WBNR-Flexera-Annual-Vulnerability-Insights?lead_source=Website%20Visitor&id=Flexera.com-Resources)

#### Video

### Close the Risk Window with Software Vulnerability Manager

Stop reacting. Gain control. Stay secure. Build a more effective risk mitigation process leveraging Secunia Research vulnerability intelligence and the largest repository of third-party patch data in the industry.

Remote video URL

[#### Trial

### Software Vulnerability Manager Assessment free trial

Get access to the complete set of modules of Software Vulnerability Manager: Research, Assessment and Patching](https://info.flexera.com/SVM-EVAL-Software-Vulnerability-Manager)

[#### Datasheet

### Protect your ServiceNow® investment with the highest quality data

IT Visibility offers certified ServiceNow integrations that accelerate platform expansion, improve ROI and increase efficiencies across ITIL processes by delivering clean software and hardware asset data directly.](/sites/default/files/datasheet-itv-maximize-servicenow-investment.pdf)

[#### Blog

### Avoid missing crucial vulnerability intelligence amid NVD backlog

Recent developments regarding the National Vulnerability Database (NVD) have some technology leaders on edge. Since February, the U.S. National Institute of Standards and Technology (NIST) has almost completely stopped enriching software vulnerabi...](https://www.flexera.com/blog/vulnerability-management/avoid-missing-crucial-vulnerability-intelligence-amid-nvd-backlog/)

[View all resources](https://www.flexera.com/resources?category%5Bsoftware-vulnerability-management%5D=software-vulnerability-management)

## Footer Menu

* Column
  + Business challenge
    - [Software renewals and audits](https://www.flexera.com/solutions/software-renewals-audits)
    - [Software license management and optimization](https://www.flexera.com/solutions/software-usage-costs)
    - [SaaS spend management](https://www.flexera.com/solutions/saas-spend)
    - [Cloud cost management](https://www.flexera.com/solutions/cloud-cost)
    - [IT asset lifecycle management](https://www.flexera.com/solutions/it-asset-lifecycle)
    - [CMDB data quality](https://www.flexera.com/solutions/cmdb-data-quality)
    - [Accurate IT inventory](https://www.flexera.com/solutions/it-inventory)
    - [Security and regulatory risk management](https://www.flexera.com/solutions/it-security-regulatory-risk)
    - [Sustainable IT](https://www.flexera.com/solutions/sustainable-it)
    - [AI-powered transformation](https://www.flexera.com/solutions/ai-powered-transformation)
    - [Public sector](https://www.flexera.com/solutions/public-sector)
* Column
  + Spend management by vendor
    - [IBM](https://www.flexera.com/solutions/vendor/ibm)
    - [Oracle](https://www.flexera.com/solutions/vendor/oracle)
    - [Microsoft](https://www.flexera.com/solutions/vendor/microsoft)
    - [SAP](https://www.flexera.com/solutions/vendor/sap)
    - [VMware](https://www.flexera.com/solutions/vendor/vmware)
    - [ServiceNow](https://www.flexera.com/solutions/vendor/servicenow)
    - [AWS](https://www.flexera.com/solutions/vendor/aws)
    - [Salesforce](https://www.flexera.com/solutions/vendor/salesforce)
    - [BMC](https://www.flexera.com/solutions/cmdb-data-quality/bmc)
    - [Adobe](https://www.flexera.com/solutions/vendor/adobe)
* Column
  + Products
    - [Flexera One](https://www.flexera.com/products/flexera-one)
    - [Snow Atlas](https://www.flexera.com/products/snow-atlas)
    - [Security](https://www.flexera.com/products/security)
    - [Application Readiness](https://www.flexera.com/products/adminstudio)
    - [All products](https://www.flexera.com/products)
    - [All Snow products](https://www.flexera.com/products/snow)
    - [Integrations](https://www.flexera.com/products/integrations)
* Column
  + Company
    - [About](https://www.flexera.com/about-us)
    - [Careers](https://www.flexera.com/about-us/careers)
    - [Leadership](https://www.flexera.com/about-us/leadership)
    - [Contact us](https://www.flexera.com/about-us/contact-us)
    - [Media / press center](https://www.flexera.com/about-us/press-center)
    - [Revenera.com](https://www.revenera.com)

 +1.800.374.4353

en

* [English](https://www.flexera.com/products/security/software-vulnerability-research/secunia-research?referrer=secunia)
* [Deutsch](https://www.flexera.de/products/security/software-vulnerability-research/secunia-research?referrer=secunia)

 [![Home](/themes/custom/flexera/images/logo.svg)](https://www.flexera.com/)

© 2025 Flexera. All Rights Reserved.

## Footer

* [Privacy Policy](https://www.flexera.com/legal/privacy-policy)
* [Terms and conditions](https://www.flexera.com/legal)
* [Contact Us](https://www.flexera.com/about-us/contact-us)
* [Impressum](https://www.flexera.com/about-us/impressum)
* [Site Map](https://www.flexera.com/sitemap)

#####

×

...



=== Content from bugzilla.mozilla.org_cabe3b9b_20250124_235809.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/693144)
* [XML](/show_bug.cgi?ctype=xml&id=693144)

Closed
[Bug 693144](/show_bug.cgi?id=693144)

Opened 13 years ago
Closed 13 years ago

# Crash [@ js::mjit::EnterMethodJIT] with typed array and TI

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Crash [@ js::mjit::EnterMethodJIT] with typed array and TI

## Categories

### (Core :: JavaScript Engine, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=JavaScript%20Engine#JavaScript%20Engine)

JavaScript Engine
▾

Core :: JavaScript Engine
The interpreter engine for the core JavaScript language, independent of the browser's object model. File ONLY core JavaScript language bugs in this category. For bugs involving browser objects such as "window" and "document", use the "DOM" component. For bugs involving calls between JavaScript and C++, use the "XPConnect" component.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=JavaScript%20Engine&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=JavaScript%20Engine&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=JavaScript%20Engine)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

x86\_64

Linux

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

critical

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

---

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| a11y-review | --- |
| --- | --- |
| Webcompat Score | --- |
| Accessibility Severity | --- |
| Performance Impact | --- |
| Webcompat Priority | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox9 | [+](/buglist.cgi?f1=cf_tracking_firefox9&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=fixed) |
| firefox10 | [+](/buglist.cgi?f1=cf_tracking_firefox10&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=fixed) |
| status1.9.2 | --- | [unaffected](/buglist.cgi?f1=cf_status_192&o1=equals&v1=unaffected) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox9 | + | fixed |
| firefox10 | + | fixed |
| status1.9.2 |  | unaffected |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: decoder, Assigned: bhackett1024)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/764aa0af2fda6f02fb17dc9771bb18d9?d=mm&size=40)  [bhackett1024](/user_profile?user_id=346231)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/b29b83d12aba827b8ff68296e473bec5?d=mm&size=40)  [decoder](/user_profile?user_id=395101)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/4fe52ee1503aecf7b6c976b8eb7c1753?d=mm&size=40)  [willyelm](/user_profile?user_id=714609)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

8 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: crash, testcase, Whiteboard: [sg:critical?][qa-])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[crash](/buglist.cgi?keywords=crash&resolution=---),
[testcase](/buglist.cgi?keywords=testcase&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[sg:critical?][qa-]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [decoder](/user_profile?user_id=395101) | [in-testsuite](#c8 "12 years ago") | + |
| --- | --- | --- |
| [decoder](/user_profile?user_id=395101) | in-testsuite | + |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | qe-verify |  |

## Crash Data

Signature:

[[@ js::mjit::EnterMethodJIT ]](https://crash-stats.mozilla.org/signature/?signature=js%3A%3Amjit%3A%3AEnterMethodJIT)

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (1 file)

| [patch](/attachment.cgi?id=566262)  [13 years ago](#c1)  [Brian Hackett [Laid off!]](/user_profile?user_id=346231)   664 bytes, patch | dvander : [review+](#a196145_309316 "13 years ago")  christian : [approval-mozilla-aurora+](#c4 "13 years ago") | [Details](/attachment.cgi?id=566262&action=edit) | [Diff](/attachment.cgi?id=566262&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=693144&attachment=566262) |
| --- | --- | --- |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=693144#c0)• 13 years ago |
|  | |

The following test crashes on mozilla-central revision b4da2d439cbc (options -m -n -a):
function f() {
var oa = [];
for (var i = 0; i < 8; ++i) {
var o = {};
oa[(new Int32Array(ArrayBuffer.prototype).length)] = o;
}
}
f();
This also affects aurora. As the -n switch (TI) seems to be required, I assume it does not affect beta/release.
Backtrace from m-c debug build:
==3713== Invalid write of size 8
==3713== at 0x403A464: ???
==3713== by 0x6E6C51: js::mjit::EnterMethodJIT(JSContext\*, js::StackFrame\*, void\*, JS::Value\*, bool) (MethodJIT.cpp:884)
==3713== by 0x6E6E71: CheckStackAndEnterMethodJIT(JSContext\*, js::StackFrame\*, void\*, bool) (MethodJIT.cpp:945)
==3713== by 0x6E6FC1: js::mjit::JaegerShotAtSafePoint(JSContext\*, void\*, bool) (MethodJIT.cpp:972)
==3713== by 0x502930: js::Interpret(JSContext\*, js::StackFrame\*, js::InterpMode) (jsinterp.cpp:2174)
[...]
==3713== Address 0xffc4000006d07278 is not stack'd, malloc'd or (recently) free'd
(gdb) x /2i $pc
=> 0x7ffff7f624c0: mov %r10,(%r9,%r12,8)
0x7ffff7f624c4: mov 0x70(%rbx),%r12
(gdb) info registers r9 r10 r12
r9 0x7ffff6007278 140737320612472
r10 0xfffbfffff6009230 -1125900074577360
r12 0xfff8800000000000 -2111062325329920

|  | [David Mandelin [:dmandelin]](/user_profile?user_id=294323) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=693144#a125362_294323)• 13 years ago |

[tracking-firefox10](/buglist.cgi?f1=cf_tracking_firefox10&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox10&o1=equals&v1=%3F) → [+](/buglist.cgi?f1=cf_tracking_firefox10&o1=equals&v1=%2B)
[tracking-firefox9](/buglist.cgi?f1=cf_tracking_firefox9&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox9&o1=equals&v1=%3F) → [+](/buglist.cgi?f1=cf_tracking_firefox9&o1=equals&v1=%2B)

|  | [Brian Hackett [Laid off!]](/user_profile?user_id=346231)  Assignee |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=693144#c1)• 13 years ago |
|  | |

Attached patch

[patch](attachment.cgi?id=566262&action=diff)
— [Details](attachment.cgi?id=566262&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=693144&attachment=566262)

When hoisting <typed array>.length, loadPtr was used to get an int32 out of a fixed slot holding the typed array length, which leaves the high bits still holding the type tag on x64.Assignee: general → bhackett1024
[Attachment #566262](/attachment.cgi?id=566262&action=edit "patch") -
Flags: review?(dvander)

|  | [Brian Hackett [Laid off!]](/user_profile?user_id=346231)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=693144#a196042_346231)• 13 years ago |

Whiteboard: js-triage-needed → [sg:critical?]

|  | [David Anderson [:dvander] - inactive, e-mail if emergency](/user_profile?user_id=309316) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=693144#a196145_309316)• 13 years ago |

[Attachment #566262](/attachment.cgi?id=566262&action=edit "patch") -
Flags: review?(dvander) → review+

|  | [Brian Hackett [Laid off!]](/user_profile?user_id=346231)  Assignee |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=693144#c2)• 13 years ago |
|  | |

<https://hg.mozilla.org/integration/mozilla-inbound/rev/90bbf471c432>

|  | [Brian Hackett [Laid off!]](/user_profile?user_id=346231)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=693144#a225452_346231)• 13 years ago |

[Attachment #566262](/attachment.cgi?id=566262&action=edit "patch") -
Flags: approval-mozilla-aurora?

|  | [Brian Hackett [Laid off!]](/user_profile?user_id=346231)  Assignee |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=693144#c3)• 13 years ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/90bbf471c432>Status: NEW → RESOLVEDClosed: 13 years agoResolution: --- → FIXED

|  | [LegNeato](/user_profile?user_id=482154) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=693144#c4)• 13 years ago |
|  | |

Comment on [attachment 566262](/attachment.cgi?id=566262 "patch") [[details]](/attachment.cgi?id=566262&action=edit "patch") [[diff]](/attachment.cgi?id=566262&action=diff "patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=693144&attachment=566262)
patch
Approved for mozilla-aurora
[Attachment #566262](/attachment.cgi?id=566262&action=edit "patch") -
Flags: approval-mozilla-aurora? → approval-mozilla-aurora+

|  | [Brian Hackett [Laid off!]](/user_profile?user_id=346231)  Assignee |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=693144#c5)• 13 years ago |
|  | |

<https://hg.mozilla.org/releases/mozilla-aurora/rev/598684717e50>

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=693144#a2191876_12352)• 13 years ago |

[status-firefox10](/buglist.cgi?f1=cf_status_firefox10&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=fixed)
[status-firefox9](/buglist.cgi?f1=cf_status_firefox9&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=fixed)

|  | [u279076](/user_profile?user_id=279076) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=693144#c6)• 13 years ago |
|  | |

Can someone who is already set up to reproduce this bug please verify the fix?Whiteboard: [sg:critical?] → [sg:critical?][qa-]

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=693144#c7)• 13 years ago |
|  | |

Verified fixed on Firefox 9 and 10.

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=693144#a3838884_1689)• 13 years ago |

[status1.9.2](/buglist.cgi?f1=cf_status_192&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_192&o1=equals&v1=unaffected)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=693144#a11270885_1689)• 13 years ago |

Group: core-security

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=693144#a14385101_395101)• 13 years ago |

Status: RESOLVED → VERIFIED

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=693144#c8)• 12 years ago |
|  | |

Automatically extracted testcase for this bug was committed:
<https://hg.mozilla.org/mozilla-central/rev/efaf8960a929>Flags: in-testsuite+
You need to [log in](/show_bug.cgi?id=693144&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Brian Hackett [Laid off!]](/user_profile?user_id=346231)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from bugzilla.mozilla.org_d09cef47_20250124_235757.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/689892)
* [XML](/show_bug.cgi?ctype=xml&id=689892)

Closed
[Bug 689892](/show_bug.cgi?id=689892)

Opened 13 years ago
Closed 13 years ago

# Assertion failure: isInterpreted(), at ../../jsfun.h:199 or Crash [@ js::gc::Cell::compartment]

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Assertion failure: isInterpreted(), at ../../jsfun.h:199 or Crash [@ js::gc::Cell::compartment]

## Categories

### (Core :: JavaScript Engine, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=JavaScript%20Engine#JavaScript%20Engine)

JavaScript Engine
▾

Core :: JavaScript Engine
The interpreter engine for the core JavaScript language, independent of the browser's object model. File ONLY core JavaScript language bugs in this category. For bugs involving browser objects such as "window" and "document", use the "DOM" component. For bugs involving calls between JavaScript and C++, use the "XPConnect" component.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=JavaScript%20Engine&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=JavaScript%20Engine&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=JavaScript%20Engine)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

x86

Linux

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

critical

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla10

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Webcompat Score | --- |
| --- | --- |
| a11y-review | --- |
| Accessibility Severity | --- |
| Webcompat Priority | --- |
| Performance Impact | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox6 | [-](/buglist.cgi?f1=cf_tracking_firefox6&o1=equals&v1=-) | [unaffected](/buglist.cgi?f1=cf_status_firefox6&o1=equals&v1=unaffected) |
| firefox7 | [-](/buglist.cgi?f1=cf_tracking_firefox7&o1=equals&v1=-) | [unaffected](/buglist.cgi?f1=cf_status_firefox7&o1=equals&v1=unaffected) |
| firefox8 | [-](/buglist.cgi?f1=cf_tracking_firefox8&o1=equals&v1=-) | [unaffected](/buglist.cgi?f1=cf_status_firefox8&o1=equals&v1=unaffected) |
| firefox9 | [+](/buglist.cgi?f1=cf_tracking_firefox9&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=fixed) |
| firefox10 | [+](/buglist.cgi?f1=cf_tracking_firefox10&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=fixed) |
| status1.9.2 | --- | [unaffected](/buglist.cgi?f1=cf_status_192&o1=equals&v1=unaffected) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox6 | - | unaffected |
| firefox7 | - | unaffected |
| firefox8 | - | unaffected |
| firefox9 | + | fixed |
| firefox10 | + | fixed |
| status1.9.2 |  | unaffected |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: decoder, Assigned: bhackett1024)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/764aa0af2fda6f02fb17dc9771bb18d9?d=mm&size=40)  [bhackett1024](/user_profile?user_id=346231)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/b29b83d12aba827b8ff68296e473bec5?d=mm&size=40)  [decoder](/user_profile?user_id=395101)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/4fe52ee1503aecf7b6c976b8eb7c1753?d=mm&size=40)  [willyelm](/user_profile?user_id=714609)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

8 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (4 keywords, Whiteboard: [sg:critical?][qa-])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[assertion](/buglist.cgi?keywords=assertion&resolution=---),
[crash](/buglist.cgi?keywords=crash&resolution=---),
[regression](/buglist.cgi?keywords=regression&resolution=---),
[testcase](/buglist.cgi?keywords=testcase&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[sg:critical?][qa-]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [decoder](/user_profile?user_id=395101) | [in-testsuite](#c13 "12 years ago") | + |
| --- | --- | --- |
| [decoder](/user_profile?user_id=395101) | in-testsuite | + |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | qe-verify |  |

## Crash Data

Signature:

[[@ js::gc::Cell::compartment ]](https://crash-stats.mozilla.org/signature/?signature=js%3A%3Agc%3A%3ACell%3A%3Acompartment)

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (1 file)

| [patch](/attachment.cgi?id=563739)  [13 years ago](#c1)  [Brian Hackett [Laid off!]](/user_profile?user_id=346231)   5.83 KB, patch | dvander : [review+](#a272008_309316 "13 years ago")  asa : [approval-mozilla-aurora+](#a731237_5003 "13 years ago") | [Details](/attachment.cgi?id=563739&action=edit) | [Diff](/attachment.cgi?id=563739&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=689892&attachment=563739) |
| --- | --- | --- |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=689892#c0)• 13 years ago |
|  | |

The following test asserts on mozilla-central revision 7f4867717226 (options -m -n -a):
function foo2(x, n) {
var i = 0;
while (--n >= 0) {
x[i++] = 0;
}
}
foo2([1,0Xae ,3,4,5],('0123456'));
Stepping through the assert crashes:
Program received signal SIGSEGV, Segmentation fault.
0x0000000000412a94 in js::gc::Cell::compartment (this=0xfff8800000000000) at ../../jsgc.h:809
809 return arenaHeader()->compartment;
(gdb) bt
#0 0x0000000000412a94 in js::gc::Cell::compartment (this=0xfff8800000000000) at ../../jsgc.h:809
#1 0x00000000006e2a0e in PopActiveVMFrame (f=...) at /srv/repos/mozilla-central/js/src/methodjit/MethodJIT.cpp:143
#2 0x00000000006e2abd in JaegerTrampolineReturn () at /srv/repos/mozilla-central/js/src/methodjit/MethodJIT.cpp:153
#3 0x00007ffff7f61368 in ?? ()
#4 0x0000000000000001 in ?? ()
#5 0x0000000000000000 in ?? ()

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=689892#a49816_1689)• 13 years ago |

Whiteboard: js-triage-needed → [sg:critical?] js-triage-needed

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=689892#a121434_12352)• 13 years ago |

[status-firefox10](/buglist.cgi?f1=cf_status_firefox10&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=affected)
[status-firefox6](/buglist.cgi?f1=cf_status_firefox6&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox6&o1=equals&v1=wontfix)
[status-firefox7](/buglist.cgi?f1=cf_status_firefox7&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox7&o1=equals&v1=wontfix)
[status-firefox8](/buglist.cgi?f1=cf_status_firefox8&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox8&o1=equals&v1=affected)
[status-firefox9](/buglist.cgi?f1=cf_status_firefox9&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=affected)
[tracking-firefox10](/buglist.cgi?f1=cf_tracking_firefox10&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox10&o1=equals&v1=%2B)
[tracking-firefox6](/buglist.cgi?f1=cf_tracking_firefox6&o1=isnotempty):
--- → [-](/buglist.cgi?f1=cf_tracking_firefox6&o1=equals&v1=-)
[tracking-firefox7](/buglist.cgi?f1=cf_tracking_firefox7&o1=isnotempty):
--- → [-](/buglist.cgi?f1=cf_tracking_firefox7&o1=equals&v1=-)
[tracking-firefox8](/buglist.cgi?f1=cf_tracking_firefox8&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox8&o1=equals&v1=%2B)
[tracking-firefox9](/buglist.cgi?f1=cf_tracking_firefox9&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox9&o1=equals&v1=%2B)

|  | [Brian Hackett [Laid off!]](/user_profile?user_id=346231)  Assignee |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=689892#c1)• 13 years ago |
|  | |

Attached patch

[patch](attachment.cgi?id=563739&action=diff)
— [Details](attachment.cgi?id=563739&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=689892&attachment=563739)

Problem with hoisting bounds checks out of loops. We come up with the correct hoisted condition for the x[i++], except for the fact that the type of 'n' changes in the decrement --- the loop test will be on integers, but when entering the loop 'n' may still be a string (we checked the type of the decrement's result, but not its input). When checking the hoisted condition on loop entry we use the payload of 'n' as if it is an integer and get the wrong result. The fix makes sure that all increment/arithmetic operations used when hoisting checks have both integer results and integer inputs.Assignee: general → bhackett1024
[Attachment #563739](/attachment.cgi?id=563739&action=edit "patch") -
Flags: review?(dvander)
[Attachment #563739](/attachment.cgi?id=563739&action=edit "patch") -
Flags: approval-mozilla-aurora?

|  | [Brian Hackett [Laid off!]](/user_profile?user_id=346231)  Assignee |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=689892#c2)• 13 years ago |
|  | |

Also, TI regression, so doesn't affect Firefox 8 or earlier.

|  | [Brian Hackett [Laid off!]](/user_profile?user_id=346231)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=689892#a204553_346231)• 13 years ago |

Whiteboard: [sg:critical?] js-triage-needed → [sg:critical?]

|  | [David Anderson [:dvander] - inactive, e-mail if emergency](/user_profile?user_id=309316) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=689892#a272008_309316)• 13 years ago |

[Attachment #563739](/attachment.cgi?id=563739&action=edit "patch") -
Flags: review?(dvander) → review+

|  | [Brian Hackett [Laid off!]](/user_profile?user_id=346231)  Assignee |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=689892#c3)• 13 years ago |
|  | |

<https://hg.mozilla.org/integration/mozilla-inbound/rev/28a549e90410>

|  | [Brian Hackett [Laid off!]](/user_profile?user_id=346231)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=689892#a480116_346231)• 13 years ago |

Status: NEW → RESOLVEDClosed: 13 years agoResolution: --- → FIXED

|  | [Brian Hackett [Laid off!]](/user_profile?user_id=346231)  Assignee |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=689892#c4)• 13 years ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/28a549e90410>

|  | [LegNeato](/user_profile?user_id=482154) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=689892#c5)• 13 years ago |
|  | |

Brian: What could be broken by this if we leave it in? How could this patch go wrong? Do we know what checking caused this other than just "TI"? Thanks!

|  | [Brian Hackett [Laid off!]](/user_profile?user_id=346231)  Assignee |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=689892#c6)• 13 years ago |
|  | |

I think this logic was added by [bug 650715](/show_bug.cgi?id=650715 "RESOLVED FIXED - JM+TI: do SSA") (added SSA analysis, a core TI patch). I think the odds of a page stumbling across this crash by chance are low, but if found the crash could be exploited (buffer overflow).

|  | [Asa Dotzler [:asa]](/user_profile?user_id=5003) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=689892#a731237_5003)• 13 years ago |

[Attachment #563739](/attachment.cgi?id=563739&action=edit "patch") -
Flags: approval-mozilla-aurora? → approval-mozilla-aurora+

|  | [Brian Hackett [Laid off!]](/user_profile?user_id=346231)  Assignee |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=689892#c7)• 13 years ago |
|  | |

<https://hg.mozilla.org/releases/mozilla-aurora/rev/a4123ca7c79a>

|  | [u279076](/user_profile?user_id=279076) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=689892#c8)• 13 years ago |
|  | |

qa- as QA cannot easily verify this fix. Can someone who is already set up to test this bug please verify the fix?Whiteboard: [sg:critical?] → [sg:critical?][qa-]

|  | [Bob Clary [:bc] (inactive)](/user_profile?user_id=23402) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=689892#c9)• 13 years ago |
|  | |

Automation hit something similar on Windows 7/Beta 8 debug but not nightly opt. It is not reproducible.
<http://www.neimanmarcus.com/search.jhtml?No=0%26Ntt=kate%2Bspade%26_requestid=48919%26N=0%26pageSize=160>
Operating system: Windows NT
6.1.7601 Service Pack 1
CPU: x86
GenuineIntel family 6 model 44 stepping 2
1 CPU
Crash reason: EXCEPTION\_ACCESS\_VIOLATION\_READ
Crash address: 0x0
Thread 0 (crashed)
0 mozjs.dll!js::gc::Cell::compartment() [jsgc.h : 755 + 0x8]
eip = 0x6794b0ef esp = 0x00148dcc ebp = 0x00148dd0 ebx = 0x00000000
esi = 0x67e9aff8 edi = 0xffffff87 eax = 0x00000000 ecx = 0x00000008
edx = 0x00000000 efl = 0x00210246
Found by: given as instruction pointer in context
1 mozjs.dll!JSObject::getCompartment() [jsgc.h : 1514 + 0x7]
eip = 0x6794b0cf esp = 0x00148dd8 ebp = 0x00148ddc
Found by: call frame info
2 mozjs.dll!JSAutoEnterCompartment::enter(JSContext \*,JSObject \*) [jsapi.cpp : 1242 + 0x7]
eip = 0x6794b060 esp = 0x00148de4 ebp = 0x00148de8
Found by: call frame info
3 xul.dll!NativeInterface2JSObject [nsXPConnect.cpp : 1293 + 0x15]
eip = 0x624f1ba5 esp = 0x00148df0 ebp = 0x00148e28
Found by: call frame info
4 xul.dll!nsXPConnect::WrapNativeToJSVal(JSContext \*,JSObject \*,nsISupports \*,nsWrapperCache \*,nsID const \*,int,jsval\_layout \*,nsIXPConnectJSObjectHolder \* \*) [nsXPConnect.cpp : 1358 + 0x27]
eip = 0x624f1e2b esp = 0x00148e30 ebp = 0x00148f1c
Found by: call frame info
5 xul.dll!WrapNative [nsDOMClassInfo.cpp : 1754 + 0x35]
eip = 0x620d4e2a esp = 0x00148f24 ebp = 0x00148f50
Found by: call frame info
6 xul.dll!WrapNative [nsDOMClassInfo.cpp : 1765 + 0x22]
eip = 0x620d4d76 esp = 0x00148f58 ebp = 0x00148f78
Found by: call frame info
7 xul.dll!nsWindowSH::GetProperty(nsIXPConnectWrappedNative \*,JSContext \*,JSObject \*,jsid,jsval\_layout \*,int \*) [nsDOMClassInfo.cpp : 5264 + 0x46]
eip = 0x620e065d esp = 0x00148f80 ebp = 0x00149010
Found by: call frame info
8 xul.dll!XPC\_WN\_Helper\_GetProperty [xpcwrappednativejsops.cpp : 997 + 0x25]
eip = 0x6254795e esp = 0x00149018 ebp = 0x00149048
Found by: call frame info
9 mozjs.dll!js::CallJSPropertyOp(JSContext \*,int (\*)(JSContext \*,JSObject \*,jsid,js::Value \*),JSObject \*,jsid,js::Value \*) [jscntxtinlines.h : 333 + 0x12]
eip = 0x67a41f45 esp = 0x00149050 ebp = 0x00149064
Found by: call frame info
10 mozjs.dll!js::Shape::get(JSContext \*,JSObject \*,JSObject \*,JSObject \*,js::Value \*) [jsscopeinlines.h : 284 + 0x50]
eip = 0x67a4a4c8 esp = 0x0014906c ebp = 0x00149094
Found by: call frame info
If that is distinct from this, let me know and I'll file a bug as soon as I can reproduce reliably.

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=689892#c10)• 13 years ago |
|  | |

Brian, any reason we wouldn't want this on beta to fix this for 8?
[status-firefox10](/buglist.cgi?f1=cf_status_firefox10&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=fixed)
[status-firefox9](/buglist.cgi?f1=cf_status_firefox9&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=fixed)

|  | [Brian Hackett [Laid off!]](/user_profile?user_id=346231)  Assignee |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=689892#c11)• 13 years ago |
|  | |

(In reply to Johnny Stenback (:jst, jst@mozilla.com) from [comment #10](/show_bug.cgi?id=689892#c10 "VERIFIED FIXED - Assertion failure: isInterpreted(), at ../../jsfun.h:199 or Crash [@ js::gc::Cell::compartment]"))
> Brian, any reason we wouldn't want this on beta to fix this for 8?
This is a TI bug so won't affect 8. The stack in [comment 9](/show_bug.cgi?id=689892#c9 "VERIFIED FIXED - Assertion failure: isInterpreted(), at ../../jsfun.h:199 or Crash [@ js::gc::Cell::compartment]") is different and looks like a compartment or DOM problem (crashing under WrapNative).

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=689892#c12)• 13 years ago |
|  | |

Thanks for the clarification!
[status-firefox6](/buglist.cgi?f1=cf_status_firefox6&o1=isnotempty):
[wontfix](/buglist.cgi?f1=cf_status_firefox6&o1=equals&v1=wontfix) → [unaffected](/buglist.cgi?f1=cf_status_firefox6&o1=equals&v1=unaffected)
[status-firefox7](/buglist.cgi?f1=cf_status_firefox7&o1=isnotempty):
[wontfix](/buglist.cgi?f1=cf_status_firefox7&o1=equals&v1=wontfix) → [unaffected](/buglist.cgi?f1=cf_status_firefox7&o1=equals&v1=unaffected)
[status-firefox8](/buglist.cgi?f1=cf_status_firefox8&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox8&o1=equals&v1=affected) → [unaffected](/buglist.cgi?f1=cf_status_firefox8&o1=equals&v1=unaffected)
[tracking-firefox8](/buglist.cgi?f1=cf_tracking_firefox8&o1=isnotempty):
[+](/buglist.cgi?f1=cf_tracking_firefox8&o1=equals&v1=%2B) → [-](/buglist.cgi?f1=cf_tracking_firefox8&o1=equals&v1=-)

|  | [LegNeato](/user_profile?user_id=482154) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=689892#a3596518_482154)• 13 years ago |

Target Milestone: --- → mozilla10

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=689892#a4792814_1689)• 13 years ago |

[status1.9.2](/buglist.cgi?f1=cf_status_192&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_192&o1=equals&v1=unaffected)Keywords: [regression](/buglist.cgi?keywords=regression&resolution=---)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=689892#a12225089_1689)• 13 years ago |

Group: core-security

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=689892#a15339570_395101)• 13 years ago |

Status: RESOLVED → VERIFIED

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=689892#c13)• 12 years ago |
|  | |

Automatically extracted testcase for this bug was committed:
<https://hg.mozilla.org/mozilla-central/rev/efaf8960a929>Flags: in-testsuite+
You need to [log in](/show_bug.cgi?id=689892&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Brian Hackett [Laid off!]](/user_profile?user_id=346231)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from bugzilla.mozilla.org_b4516283_20250124_235754.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/688364)
* [XML](/show_bug.cgi?ctype=xml&id=688364)

Closed
[Bug 688364](/show_bug.cgi?id=688364)

Opened 13 years ago
Closed 13 years ago

# compartment mismatch when sharing with F1

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

compartment mismatch when sharing with F1

## Categories

### (Core :: DOM: Core & HTML, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=DOM%3A%20Core%20%26%20HTML#DOM%3A%20Core%20%26%20HTML)

DOM: Core & HTML
▾

Core :: DOM: Core & HTML
Issues in DOM tree [https://dom.spec.whatwg.org](https://dom.spec.whatwg.org/) & HTML [https://html.spec.whatwg.org](https://html.spec.whatwg.org/) that do not fit into any other DOM or HTML component or which span multiple DOM or HTML components.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=DOM%3A%20Core%20%26%20HTML&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=DOM%3A%20Core%20%26%20HTML&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=DOM%3A%20Core%20%26%20HTML)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

6 Branch

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

x86\_64

Windows 7

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

normal

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
DUPLICATE
of [bug 679494](/show_bug.cgi?id=679494 "RESOLVED FIXED - \"compartment mismatched\" when listening message event")

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

DUPLICATE

of

Mark as Duplicate

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

---

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Webcompat Priority | --- |
| --- | --- |
| a11y-review | --- |
| Accessibility Severity | --- |
| Webcompat Score | --- |
| Performance Impact | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox6 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox6&o1=equals&v1=wontfix) |
| firefox7 | [-](/buglist.cgi?f1=cf_tracking_firefox7&o1=equals&v1=-) | [wontfix](/buglist.cgi?f1=cf_status_firefox7&o1=equals&v1=wontfix) |
| firefox8 | [-](/buglist.cgi?f1=cf_tracking_firefox8&o1=equals&v1=-) | [wontfix](/buglist.cgi?f1=cf_status_firefox8&o1=equals&v1=wontfix) |
| firefox9 | [+](/buglist.cgi?f1=cf_tracking_firefox9&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=fixed) |
| firefox10 | [+](/buglist.cgi?f1=cf_tracking_firefox10&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=fixed) |
| status1.9.2 | --- | [unaffected](/buglist.cgi?f1=cf_status_192&o1=equals&v1=unaffected) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox6 |  | wontfix |
| firefox7 | - | wontfix |
| firefox8 | - | wontfix |
| firefox9 | + | fixed |
| firefox10 | + | fixed |
| status1.9.2 |  | unaffected |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: blizzard, Assigned: mrbkap)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/89d2149736265010bfe669ce8c3075c0?d=mm&size=40)  [mrbkap](/user_profile?user_id=69426)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/60e8d4680b2951023e8396b48b3daff7?d=mm&size=40)  [blizzard](/user_profile?user_id=14701)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/5111b810214a00377104f5ad3efefa26?d=mm&size=40)  [sefeng](/user_profile?user_id=625922)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

4 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: crash, Whiteboard: [sg:critical?])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[crash](/buglist.cgi?keywords=crash&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[sg:critical?]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Christopher Blizzard (:blizzard)](/user_profile?user_id=14701)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=688364#c0)• 13 years ago |
|  | |

1. Open this URL: <http://people.mozilla.com/~mclaypotch/jscagematch/rainbow.gif>
2. Share to twitter with F1.
3. Get a crash/assertion.
In a debugger, this was the stack trace:
ntdll.dll!\_NtRaiseException@12() + 0x12 bytes
ntdll.dll!\_NtRaiseException@12() + 0x12 bytes
mozjs.dll!js::gc::Cell::isMarked(unsigned int color) Line 518 C++
> mozjs.dll!js::CompartmentChecker::fail(JSCompartment \* c1, JSCompartment \* c2) Line 121 + 0x11 bytes C++
mozjs.dll!js::CompartmentChecker::check(JSCompartment \* c) Line 137 + 0x10 bytes C++
mozjs.dll!js::CompartmentChecker::check(JSString \* str) Line 151 C++
mozjs.dll!js::CompartmentChecker::check(const js::Value & v) Line 158 C++
mozjs.dll!js::assertSameCompartment<JSObject \*,js::Value>(JSContext \* cx, JSObject \* t1, js::Value t2) Line 229 C++
mozjs.dll!js::CallJSPropertyOp(JSContext \* cx, int (JSContext \*, JSObject \*, jsid, js::Value \*)\* op, JSObject \* receiver, jsid id, js::Value \* vp) Line 328 + 0x17 bytes C++
mozjs.dll!js::Shape::get(JSContext \* cx, JSObject \* receiver, JSObject \* obj, JSObject \* pobj, js::Value \* vp) Line 283 + 0x51 bytes C++
mozjs.dll!js\_NativeGetInline(JSContext \* cx, JSObject \* receiver, JSObject \* obj, JSObject \* pobj, const js::Shape \* shape, unsigned int getHow, js::Value \* vp) Line 5218 + 0x1c bytes C++
mozjs.dll!js\_GetPropertyHelperWithShapeInline(JSContext \* cx, JSObject \* obj, JSObject \* receiver, jsid id, unsigned int getHow, js::Value \* vp, const js::Shape \* \* shapeOut, JSObject \* \* holderOut) Line 5400 + 0x21 bytes C++
mozjs.dll!js\_GetPropertyHelperInline(JSContext \* cx, JSObject \* obj, JSObject \* receiver, jsid id, unsigned int getHow, js::Value \* vp) Line 5421 + 0x25 bytes C++
mozjs.dll!js\_GetPropertyHelper(JSContext \* cx, JSObject \* obj, jsid id, unsigned int getHow, js::Value \* vp) Line 5427 + 0x1d bytes C++
mozjs.dll!js::Interpret(JSContext \* cx, js::StackFrame \* entryFrame, unsigned int inlineCallCount, js::InterpMode interpMode) Line 4095 + 0x74 bytes C++
mozjs.dll!js::RunScript(JSContext \* cx, JSScript \* script, js::StackFrame \* fp) Line 613 + 0x11 bytes C++
mozjs.dll!js::Invoke(JSContext \* cx, const js::CallArgs & argsRef, js::ConstructOption option) Line 694 + 0x11 bytes C++
mozjs.dll!js::ExternalInvoke(JSContext \* cx, const js::Value & thisv, const js::Value & fval, unsigned int argc, js::Value \* argv, js::Value \* rval) Line 816 + 0xf bytes C++
mozjs.dll!js::JSProxyHandler::call(JSContext \* cx, JSObject \* proxy, unsigned int argc, js::Value \* vp) Line 273 + 0x31 bytes C++
mozjs.dll!JSWrapper::call(JSContext \* cx, JSObject \* wrapper, unsigned int argc, js::Value \* vp) Line 250 + 0x43 bytes C++
mozjs.dll!JSCrossCompartmentWrapper::call(JSContext \* cx, JSObject \* wrapper, unsigned int argc, js::Value \* vp) Line 652 + 0x18 bytes C++
mozjs.dll!js::JSProxy::call(JSContext \* cx, JSObject \* proxy, unsigned int argc, js::Value \* vp) Line 839 + 0x28 bytes C++
mozjs.dll!js::proxy\_Call(JSContext \* cx, unsigned int argc, js::Value \* vp) Line 1104 + 0x15 bytes C++
mozjs.dll!js::CallJSNative(JSContext \* cx, int (JSContext \*, unsigned int, js::Value \*)\* native, unsigned int argc, js::Value \* vp) Line 277 + 0xf bytes C++
mozjs.dll!js::Invoke(JSContext \* cx, const js::CallArgs & argsRef, js::ConstructOption option) Line 649 + 0x22 bytes C++
mozjs.dll!js::ExternalInvoke(JSContext \* cx, const js::Value & thisv, const js::Value & fval, unsigned int argc, js::Value \* argv, js::Value \* rval) Line 816 + 0xf bytes C++
mozjs.dll!JS\_CallFunctionValue(JSContext \* cx, JSObject \* obj, jsval\_layout fval, unsigned int argc, jsval\_layout \* argv, jsval\_layout \* rval) Line 5080 + 0x45 bytes C++
xul.dll!nsXPCWrappedJSClass::CallMethod(nsXPCWrappedJS \* wrapper, unsigned short methodIndex, const XPTMethodDescriptor \* info, nsXPTCMiniVariant \* nativeParams) Line 1662 + 0x38 bytes C++
xul.dll!nsXPCWrappedJS::CallMethod(unsigned short methodIndex, const XPTMethodDescriptor \* info, nsXPTCMiniVariant \* params) Line 587 C++
xul.dll!PrepareAndDispatch(nsXPTCStubBase \* self, unsigned int methodIndex, unsigned int \* args, unsigned int \* stackBytesToPop) Line 114 + 0x21 bytes C++
xul.dll!SharedStub() Line 142 C++
xul.dll!nsEventListenerManager::HandleEventSubType(nsListenerStruct \* aListenerStruct, nsIDOMEventListener \* aListener, nsIDOMEvent \* aDOMEvent, nsPIDOMEventTarget \* aCurrentTarget, unsigned int aPhaseFlags, nsCxPusher \* aPusher) Line 1142 + 0x12 bytes C++
xul.dll!nsEventListenerManager::HandleEventInternal(nsPresContext \* aPresContext, nsEvent \* aEvent, nsIDOMEvent \* \* aDOMEvent, nsPIDOMEventTarget \* aCurrentTarget, unsigned int aFlags, nsEventStatus \* aEventStatus, nsCxPusher \* aPusher) Line 1239 + 0x27 bytes C++
xul.dll!nsEventListenerManager::HandleEvent(nsPresContext \* aPresContext, nsEvent \* aEvent, nsIDOMEvent \* \* aDOMEvent, nsPIDOMEventTarget \* aCurrentTarget, unsigned int aFlags, nsEventStatus \* aEventStatus, nsCxPusher \* aPusher) Line 147 C++
xul.dll!nsEventTargetChainItem::HandleEvent(nsEventChainPostVisitor & aVisitor, unsigned int aFlags, int aMayHaveNewListenerManagers, nsCxPusher \* aPusher) Line 216 C++
xul.dll!nsEventTargetChainItem::HandleEventTargetChain(nsEventChainPostVisitor & aVisitor, unsigned int aFlags, nsDispatchingCallback \* aCallback, int aMayHaveNewListenerManagers, nsCxPusher \* aPusher) Line 346 C++
xul.dll!nsEventDispatcher::Dispatch(nsISupports \* aTarget, nsPresContext \* aPresContext, nsEvent \* aEvent, nsIDOMEvent \* aDOMEvent, nsEventStatus \* aEventStatus, nsDispatchingCallback \* aCallback, nsCOMArray<nsPIDOMEventTarget> \* aTargets) Line 648 + 0x1e bytes C++
xul.dll!PostMessageEvent::Run() Line 6015 + 0x2f bytes C++
xul.dll!nsThread::ProcessNextEvent(int mayWait, int \* result) Line 618 + 0x19 bytes C++
xul.dll!NS\_ProcessNextEvent\_P(nsIThread \* thread, int mayWait) Line 245 + 0x16 bytes C++
xul.dll!mozilla::ipc::MessagePump::Run(base::MessagePump::Delegate \* aDelegate) Line 110 + 0xe bytes C++
xul.dll!MessageLoop::RunInternal() Line 219 C++
xul.dll!MessageLoop::RunHandler() Line 203 C++
xul.dll!MessageLoop::Run() Line 177 C++
xul.dll!nsBaseAppShell::Run() Line 191 C++
xul.dll!nsAppShell::Run() Line 249 + 0x9 bytes C++
xul.dll!nsAppStartup::Run() Line 222 + 0x1c bytes C++
xul.dll!XRE\_main(int argc, char \* \* argv, const nsXREAppData \* aAppData) Line 3686 + 0x25 bytes C++
firefox.exe!NS\_internal\_main(int argc, char \* \* argv) Line 158 + 0x12 bytes C++
firefox.exe!wmain(int argc, wchar\_t \* \* argv) Line 106 + 0xd bytes C++
firefox.exe!\_\_tmainCRTStartup() Line 552 + 0x19 bytes C
firefox.exe!wmainCRTStartup() Line 371 C
kernel32.dll!@BaseThreadInitThunk@12() + 0x12 bytes
ntdll.dll!\_\_\_RtlUserThreadStart@8() + 0x27 bytes
ntdll.dll!\_\_RtlUserThreadStart@8() + 0x1b bytes

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=688364#c1)• 13 years ago |
|  | |

Blake, can you have a look here? Marking sg:critical? since that's what we typically do with compartment mismatches.Whiteboard: [sg:critical?]

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=688364#a1183_12352)• 13 years ago |

Assignee: nobody → mrbkap

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=688364#c2)• 13 years ago |
|  | |

Is this strictly a problem with what the add-on is doing alone, or does the page content influence the crash? If the former it might be sg:moderate rather than critical, although some other addon might be doing similar things in actions that could theoretically be triggered by content.
[status-firefox6](/buglist.cgi?f1=cf_status_firefox6&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox6&o1=equals&v1=wontfix)
[status-firefox7](/buglist.cgi?f1=cf_status_firefox7&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox7&o1=equals&v1=wontfix)
[status-firefox8](/buglist.cgi?f1=cf_status_firefox8&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox8&o1=equals&v1=affected)
[status-firefox9](/buglist.cgi?f1=cf_status_firefox9&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=affected)
[tracking-firefox8](/buglist.cgi?f1=cf_tracking_firefox8&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox8&o1=equals&v1=%2B)
[tracking-firefox9](/buglist.cgi?f1=cf_tracking_firefox9&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox9&o1=equals&v1=%2B)

|  | [Blake Kaplan (:mrbkap) (inactive)](/user_profile?user_id=69426)  Assignee |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=688364#c3)• 13 years ago |
|  | |

This has already been fixed on trunk by [bug 679494](/show_bug.cgi?id=679494 "RESOLVED FIXED - \"compartment mismatched\" when listening message event").Status: NEW → RESOLVEDClosed: 13 years agoResolution: --- → DUPLICATE

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=688364#a1188941_12352)• 13 years ago |

[status-firefox10](/buglist.cgi?f1=cf_status_firefox10&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=fixed)
[status-firefox9](/buglist.cgi?f1=cf_status_firefox9&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=fixed)
[tracking-firefox10](/buglist.cgi?f1=cf_tracking_firefox10&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox10&o1=equals&v1=%2B)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=688364#a2469420_1689)• 13 years ago |

Group: mozilla-confidential
[status1.9.2](/buglist.cgi?f1=cf_status_192&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_192&o1=equals&v1=unaffected)

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=688364#a2477864_12352)• 13 years ago |

[status-firefox8](/buglist.cgi?f1=cf_status_firefox8&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox8&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox8&o1=equals&v1=wontfix)
[tracking-firefox7](/buglist.cgi?f1=cf_tracking_firefox7&o1=isnotempty):
--- → [-](/buglist.cgi?f1=cf_tracking_firefox7&o1=equals&v1=-)
[tracking-firefox8](/buglist.cgi?f1=cf_tracking_firefox8&o1=isnotempty):
[+](/buglist.cgi?f1=cf_tracking_firefox8&o1=equals&v1=%2B) → [-](/buglist.cgi?f1=cf_tracking_firefox8&o1=equals&v1=-)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=688364#a13381892_1689)• 13 years ago |

Group: core-security

|  | [Kyle Huey (Exited; not receiving bugmail, old account, do not use)](/user_profile?user_id=336670) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=688364#a13383598_336670)• 13 years ago |

Group: mozilla-confidential

|  | [Nobody; OK to take it and work on it](/user_profile?user_id=1) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=688364#a235819416_1)• 6 years ago |

Component: DOM → DOM: Core & HTML
You need to [log in](/show_bug.cgi?id=688364&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑



=== Content from bugzilla.mozilla.org_a1b80992_20250124_235816.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/696579)
* [XML](/show_bug.cgi?ctype=xml&id=696579)

Closed
[Bug 696579](/show_bug.cgi?id=696579)

Opened 13 years ago
Closed 13 years ago

# carefully chosen values of kernelUnitLength can cause lighting filters to overwrite memory they don't own

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

carefully chosen values of kernelUnitLength can cause lighting filters to overwrite memory they don't own

## Categories

### (Core :: SVG, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=SVG#SVG)

SVG
▾

Core :: SVG

Issues with the layout or rendering of SVG content and interacting with the SVG DOM.

Example bugs:

* SVG marker can not be clipped with clip-path
* x position adjustments of SVG vertical text on a path moves in the wrong direction

Specifications covered:

* SVG

[See Open Bugs in This Component](/buglist.cgi?product=Core&component=SVG&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=SVG&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=SVG)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

All

All

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

critical

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla10

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| a11y-review | --- |
| --- | --- |
| Accessibility Severity | --- |
| Webcompat Score | --- |
| Webcompat Priority | --- |
| Performance Impact | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox8 | [-](/buglist.cgi?f1=cf_tracking_firefox8&o1=equals&v1=-) | [affected](/buglist.cgi?f1=cf_status_firefox8&o1=equals&v1=affected) |
| firefox9 | [-](/buglist.cgi?f1=cf_tracking_firefox9&o1=equals&v1=-) | [fixed](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=fixed) |
| status1.9.2 | --- | [unaffected](/buglist.cgi?f1=cf_status_192&o1=equals&v1=unaffected) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox8 | - | affected |
| firefox9 | - | fixed |
| status1.9.2 |  | unaffected |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: longsonr, Assigned: longsonr)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/c5d912dac5c74b47bbaff7164f5f8bb8?d=mm&size=40)  [longsonr](/user_profile?user_id=218550)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/c5d912dac5c74b47bbaff7164f5f8bb8?d=mm&size=40)  [longsonr](/user_profile?user_id=218550)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](extensions/Gravatar/web/default.jpg)  [jwatt](/user_profile?user_id=32767)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

11 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

[CVE-2012-0470](/show_bug.cgi?id=734288 "VERIFIED FIXED - ASAN: Heap-buffer-overflow WRITE of size 1 at nsSVGFEDiffuseLightingElement::LightPixel")

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

Dependency [tree](/showdependencytree.cgi?id=696579&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=696579)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: verified-aurora, verified-beta, Whiteboard: [sg:critical][qa!])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[verified-aurora](/buglist.cgi?keywords=verified-aurora&resolution=---),
[verified-beta](/buglist.cgi?keywords=verified-beta&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[sg:critical][qa!]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [dholbert](/user_profile?user_id=278074) | [in-testsuite](#c16 "13 years ago") | ? |
| --- | --- | --- |
| [dholbert](/user_profile?user_id=278074) | in-testsuite | ? |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (2 files, 2 obsolete files)

| [testcase(crashes)](/attachment.cgi?id=568867)  [13 years ago](#c1)  [Robert Longson [:longsonr]](/user_profile?user_id=218550)   522 bytes, image/svg+xml |  | [Details](/attachment.cgi?id=568867&action=edit) |
| --- | --- | --- |
| [patch](/attachment.cgi?id=568873)  [13 years ago](#c3)  [Robert Longson [:longsonr]](/user_profile?user_id=218550)   2.71 KB, patch |  | [Details](/attachment.cgi?id=568873&action=edit) | [Diff](/attachment.cgi?id=568873&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=696579&attachment=568873) |
| [right patch](/attachment.cgi?id=568874)  [13 years ago](#c4)  [Robert Longson [:longsonr]](/user_profile?user_id=218550)   1.06 KB, patch |  | [Details](/attachment.cgi?id=568874&action=edit) | [Diff](/attachment.cgi?id=568874&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=696579&attachment=568874) |
| [updated patch](/attachment.cgi?id=569326)  [13 years ago](#c12)  [Robert Longson [:longsonr]](/user_profile?user_id=218550)   2.44 KB, patch | roc : [review+](#a276971_5038 "13 years ago")  akeybl : [approval-mozilla-aurora+](#c21 "13 years ago")  akeybl : [approval-mozilla-beta-](#c21 "13 years ago") | [Details](/attachment.cgi?id=569326&action=edit) | [Diff](/attachment.cgi?id=569326&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=696579&attachment=569326) |

Show Obsolete

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Robert Longson [:longsonr]](/user_profile?user_id=218550)  Assignee |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=696579#c0)• 13 years ago |
|  | |

*No description provided.*

|  | [Robert Longson [:longsonr]](/user_profile?user_id=218550)  Assignee |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=696579#c1)• 13 years ago |
|  | |

Attached image
[testcase(crashes)](attachment.cgi?id=568867)
— [Details](attachment.cgi?id=568867&action=edit)

|  | [Robert Longson [:longsonr]](/user_profile?user_id=218550)  Assignee |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=696579#c2)• 13 years ago |
|  | |

Crashes Firefox 7 and trunk for me. The lighting filter scaling code was introduced in [bug 416305](/show_bug.cgi?id=416305 "RESOLVED FIXED - Speed up Gaussian blur filter considerably by optimizing for alpha-only surfaces"). There's a modification to that code in [bug 610466](/show_bug.cgi?id=610466 "RESOLVED FIXED - feDiffuseLighting with filterRes larger than filter region causes filter not to work") that may be significant.

|  | [Robert Longson [:longsonr]](/user_profile?user_id=218550)  Assignee |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=696579#c3)• 13 years ago |
|  | |

Attached patch

[patch](attachment.cgi?id=568873&action=diff) (obsolete)
— [Details](attachment.cgi?id=568873&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=696579&attachment=568873)

Assignee: nobody → longsonr
[Attachment #568873](/attachment.cgi?id=568873&action=edit "patch") -
Flags: review?(roc)

|  | [Robert Longson [:longsonr]](/user_profile?user_id=218550)  Assignee |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=696579#c4)• 13 years ago |
|  | |

Attached patch

[right patch](attachment.cgi?id=568874&action=diff) (obsolete)
— [Details](attachment.cgi?id=568874&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=696579&attachment=568874)

[Attachment #568873](/attachment.cgi?id=568873&action=edit "patch") -
Attachment is obsolete: true
[Attachment #568873](/attachment.cgi?id=568873&action=edit "patch") -
Flags: review?(roc)
[Attachment #568874](/attachment.cgi?id=568874&action=edit "right patch") -
Flags: review?(roc)

|  | [Robert Longson [:longsonr]](/user_profile?user_id=218550)  Assignee |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=696579#c5)• 13 years ago |
|  | |

[bug 610466](/show_bug.cgi?id=610466 "RESOLVED FIXED - feDiffuseLighting with filterRes larger than filter region causes filter not to work") made it easier to trigger this bug but I suspect you can crash without it although you'd need to use different and even more carefully chosen values.

|  | [Robert Longson [:longsonr]](/user_profile?user_id=218550)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=696579#a3857_218550)• 13 years ago |

[status-firefox8](/buglist.cgi?f1=cf_status_firefox8&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox8&o1=equals&v1=affected)
[status-firefox9](/buglist.cgi?f1=cf_status_firefox9&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=affected)
[tracking-firefox8](/buglist.cgi?f1=cf_tracking_firefox8&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox8&o1=equals&v1=%3F)
[tracking-firefox9](/buglist.cgi?f1=cf_tracking_firefox9&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox9&o1=equals&v1=%3F)

|  | [Robert O'Callahan (:roc) (email my personal email if necessary)](/user_profile?user_id=5038) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=696579#c6)• 13 years ago |
|  | |

Comment on [attachment 568874](/attachment.cgi?id=568874 "right patch") [[details]](/attachment.cgi?id=568874&action=edit "right patch") [[diff]](/attachment.cgi?id=568874&action=diff "right patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=696579&attachment=568874)
right patch
Why does this fix the bug? It's not even clear to me what the problem is.

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=696579#a201665_278074)• 13 years ago |

[Attachment #568874](/attachment.cgi?id=568874&action=edit "right patch") -
Attachment is patch: true

|  | [Robert Longson [:longsonr]](/user_profile?user_id=218550)  Assignee |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=696579#c7)• 13 years ago |
|  | |

In the testcase we have these values...
aTarget->mImage width, height = 300
aDataRect = 0, 0, 300, 300
kernelX, kernelY = 1.6552
300/1.6552 = 181.246
scaledSize = 181 x 181 as nsSVGUtils::ConvertToSurfaceSize does a NS\_lround to round to the nearest integer.
gfxRect r(aDataRect.x, aDataRect.y, aDataRect.width, aDataRect.height);
r = 0, 0, 300, 300
r.Scale(gfxFloat(scaledSize.width)/aTarget->mImage->Width(),
gfxFloat(scaledSize.height)/aTarget->mImage->Height());
r = 0, 0, 181.00000000000003, 181.00000000000003
r.RoundOut();
r = 0, 0, 182, 182
r > scaledSize and we blow up.
I think we need the same rounding as ConvertToSurfaceSize.

|  | [Robert Longson [:longsonr]](/user_profile?user_id=218550)  Assignee |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=696579#c8)• 13 years ago |
|  | |

Maybe nsSVGUtils::ConvertToSurfaceSize should round out which I could look into as a follow up if you like but we'd still need to be careful not to overflow later so we'd still need it to be Round rather than RoundOut even if it did.

|  | [Robert O'Callahan (:roc) (email my personal email if necessary)](/user_profile?user_id=5038) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=696579#c9)• 13 years ago |
|  | |

(In reply to Robert Longson from [comment #8](/show_bug.cgi?id=696579#c8 "VERIFIED FIXED - carefully chosen values of kernelUnitLength can cause lighting filters to overwrite memory they don't own"))
> Maybe nsSVGUtils::ConvertToSurfaceSize should round out which I could look
> into as a follow up if you like
That seems like the right thing.
> but we'd still need to be careful not to
> overflow later so we'd still need it to be Round rather than RoundOut even
> if it did.
Not sure why.

|  | [Robert Longson [:longsonr]](/user_profile?user_id=218550)  Assignee |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=696579#c10)• 13 years ago |
|  | |

We'd have scaledSize greater by 1 so
r.Scale(gfxFloat(scaledSize.width)/aTarget->mImage->Width(),
gfxFloat(scaledSize.height)/aTarget->mImage->Height());
might then give us
r = 0, 0, 182.00000000000003, 182.00000000000003
which we'd not want to round out.

|  | [Robert O'Callahan (:roc) (email my personal email if necessary)](/user_profile?user_id=5038) |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=696579#c11)• 13 years ago |
|  | |

Then we should make sure that if it's within epsilon of an integer, it shouldn't get rounded out.

|  | [Robert Longson [:longsonr]](/user_profile?user_id=218550)  Assignee |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=696579#c12)• 13 years ago |
|  | |

Attached patch

[updated patch](attachment.cgi?id=569326&action=diff)
— [Details](attachment.cgi?id=569326&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=696579&attachment=569326)

This seems to work. We scale the surface and the rect in the same way and then round them both out so that they always match.
[Attachment #568874](/attachment.cgi?id=568874&action=edit "right patch") -
Attachment is obsolete: true
[Attachment #568874](/attachment.cgi?id=568874&action=edit "right patch") -
Flags: review?(roc)
[Attachment #569326](/attachment.cgi?id=569326&action=edit "updated patch") -
Flags: review?(roc)

|  | [Robert Longson [:longsonr]](/user_profile?user_id=218550)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=696579#a250256_218550)• 13 years ago |

[Attachment #569326](/attachment.cgi?id=569326&action=edit "updated patch") -
Attachment is patch: true

|  | [Robert O'Callahan (:roc) (email my personal email if necessary)](/user_profile?user_id=5038) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=696579#a276971_5038)• 13 years ago |

[Attachment #569326](/attachment.cgi?id=569326&action=edit "updated patch") -
Flags: review?(roc) → review+

|  | [Robert Longson [:longsonr]](/user_profile?user_id=218550)  Assignee |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=696579#c13)• 13 years ago |
|  | |

pushed <https://hg.mozilla.org/integration/mozilla-inbound/rev/ebd6501de883>

|  | [Robert Longson [:longsonr]](/user_profile?user_id=218550)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=696579#a330365_218550)• 13 years ago |

[Attachment #569326](/attachment.cgi?id=569326&action=edit "updated patch") -
Flags: approval1.9.2.24?
[Attachment #569326](/attachment.cgi?id=569326&action=edit "updated patch") -
Flags: approval-mozilla-beta?
[Attachment #569326](/attachment.cgi?id=569326&action=edit "updated patch") -
Flags: approval-mozilla-aurora?

|  | [Robert Longson [:longsonr]](/user_profile?user_id=218550)  Assignee |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=696579#c14)• 13 years ago |
|  | |

We allocate a slightly larger region for non-integer sized filters now so that when we calculated the dirty region we want to repaint we don't find that that extends outside the bounds of the surface. I think this is a pretty low risk change.

|  | [LegNeato](/user_profile?user_id=482154) |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=696579#c15)• 13 years ago |
|  | |

Dan, can we get a security rating on this so we can reason about it?Keywords: [#relman/triage/needs-info](/buglist.cgi?keywords=%23relman%2Ftriage%2Fneeds-info&resolution=---)

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074) |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=696579#c16)• 13 years ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/ebd6501de883>Status: NEW → RESOLVEDClosed: 13 years agoFlags: in-testsuite?Resolution: --- → FIXEDTarget Milestone: --- → mozilla10

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=696579#c17)• 13 years ago |
|  | |

Daniel H - in DanV's absence, if you can provide any insight (however rough) about the criticality of this bug for FF8, it would be greatly appreciated. Thanks!

|  | [Robert Longson [:longsonr]](/user_profile?user_id=218550)  Assignee |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=696579#c18)• 13 years ago |
|  | |

I haven't actually tried 3.6 to see if it crashes with the testcase, nor have I checked that this patch fixes it if it does. 3.6 does not have [bug 610466](/show_bug.cgi?id=610466 "RESOLVED FIXED - feDiffuseLighting with filterRes larger than filter region causes filter not to work") and that may make it safe from this crash. On the other hand it may need that bug too in order to be safe.

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074) |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=696579#c19)• 13 years ago |
|  | |

(In reply to Alex Keybl [:akeybl] from [comment #17](/show_bug.cgi?id=696579#c17 "VERIFIED FIXED - carefully chosen values of kernelUnitLength can cause lighting filters to overwrite memory they don't own"))
> Daniel H - in DanV's absence, if you can provide any insight (however rough)
> about the criticality of this bug for FF8
roc / longsonr can probably provide more educated feedback, but here are my thoughts:
Overwriting random memory is scary... I imagine this could potentially overwrite a vtable pointer or something, which would be exploitable. Given that, I'd think we'd want to aggressively get this onto our affected branches (i.e. at least back to Firefox 8, and back to 3.6 if we determine it to be affected).
It does seem like this might cause a behavior change, but I think it'd be minimal (1px larger/smaller in filter-rendering), and worth the security win.

|  | [Curtis Koenig [:curtisk-use curtis.koenig+bzATgmail.com]]](/user_profile?user_id=406847) |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=696579#c20)• 13 years ago |
|  | |

marking bug as sg:critical given description and what not.
In discussing this during the beta/aurora meting, at this point this does not seem worthy to respin the beta, however, if we do respin this should go in for sure. Not chaning the flag for now and leaving this.Whiteboard: [sg:critical]

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=696579#c21)• 13 years ago |
|  | |

Comment on [attachment 569326](/attachment.cgi?id=569326 "updated patch") [[details]](/attachment.cgi?id=569326&action=edit "updated patch") [[diff]](/attachment.cgi?id=569326&action=diff "updated patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=696579&attachment=569326)
updated patch
[Triage Comment]
\* Approving for Aurora since this is sg:critical
\* Denying for Beta since we don't expect to re-roll
[Attachment #569326](/attachment.cgi?id=569326&action=edit "updated patch") -
Flags: approval1.9.2.24?
[Attachment #569326](/attachment.cgi?id=569326&action=edit "updated patch") -
Flags: approval-mozilla-beta?
[Attachment #569326](/attachment.cgi?id=569326&action=edit "updated patch") -
Flags: approval-mozilla-beta-
[Attachment #569326](/attachment.cgi?id=569326&action=edit "updated patch") -
Flags: approval-mozilla-aurora?
[Attachment #569326](/attachment.cgi?id=569326&action=edit "updated patch") -
Flags: approval-mozilla-aurora+

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074) |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=696579#c22)• 13 years ago |
|  | |

Landed on Aurora:
<https://hg.mozilla.org/releases/mozilla-aurora/rev/152e68819fd7>
Setting status-firefox9 --> Fixed.
[status-firefox9](/buglist.cgi?f1=cf_status_firefox9&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=fixed)

|  | [juan becerra [:juanb]](/user_profile?user_id=241759) |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=696579#c23)• 13 years ago |
|  | |

Adding [qa+] for bug verification. It's crasher, it has a testcase, it should be easy to verify.Whiteboard: [sg:critical] → [sg:critical][qa+]

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=696579#c24)• 13 years ago |
|  | |

qawanted: Since the feature was introduced in 2008 I'm guessing this affects the 1.9.2 branch?blocking1.9.2: --- → ?
[status1.9.2](/buglist.cgi?f1=cf_status_192&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_status_192&o1=equals&v1=%3F)Keywords: [qawanted](/buglist.cgi?keywords=qawanted&resolution=---)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=696579#c25)• 13 years ago |
|  | |

No crash when I run the attached testcase on 3.6.24 on OS X 10.7: Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10.7; en-US; rv:1.9.2.24) Gecko/20111103 Firefox/3.6.24.Keywords: [qawanted](/buglist.cgi?keywords=qawanted&resolution=---)

|  | [u279076](/user_profile?user_id=279076) |  |
| --- | --- | --- |
| [Comment 26](/show_bug.cgi?id=696579#c26)• 13 years ago |
|  | |

Verified fixed on Firefox 9.0b3 and 10.0a2.Status: RESOLVED → VERIFIEDKeywords: [verified-aurora](/buglist.cgi?keywords=verified-aurora&resolution=---),
[verified-beta](/buglist.cgi?keywords=verified-beta&resolution=---)Whiteboard: [sg:critical][qa+] → [sg:critical][qa!]

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 27](/show_bug.cgi?id=696579#c27)• 13 years ago |
|  | |

I don't crash on 3.6.24 either, apparently the [comment 2](/show_bug.cgi?id=696579#c2 "VERIFIED FIXED - carefully chosen values of kernelUnitLength can cause lighting filters to overwrite memory they don't own") guess that the [bug 610466](/show_bug.cgi?id=610466 "RESOLVED FIXED - feDiffuseLighting with filterRes larger than filter region causes filter not to work") changes "may be significant" was correct.blocking1.9.2: ? → ---
[status1.9.2](/buglist.cgi?f1=cf_status_192&o1=isnotempty):
[?](/buglist.cgi?f1=cf_status_192&o1=equals&v1=%3F) → [unaffected](/buglist.cgi?f1=cf_status_192&o1=equals&v1=unaffected)

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=696579#a3931126_425645)• 13 years ago |

[tracking-firefox8](/buglist.cgi?f1=cf_tracking_firefox8&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox8&o1=equals&v1=%3F) → [-](/buglist.cgi?f1=cf_tracking_firefox8&o1=equals&v1=-)
[tracking-firefox9](/buglist.cgi?f1=cf_tracking_firefox9&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox9&o1=equals&v1=%3F) → [-](/buglist.cgi?f1=cf_tracking_firefox9&o1=equals&v1=-)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=696579#a3950409_1689)• 13 years ago |

Keywords: [#relman/triage/needs-info](/buglist.cgi?keywords=%23relman%2Ftriage%2Fneeds-info&resolution=---)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=696579#a10139022_1689)• 13 years ago |

Group: core-security

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=696579#a12044684_278074)• 13 years ago |

Depends on: [CVE-2012-0470](/show_bug.cgi?id=734288 "VERIFIED FIXED - ASAN: Heap-buffer-overflow WRITE of size 1 at nsSVGFEDiffuseLightingElement::LightPixel")
You need to [log in](/show_bug.cgi?id=696579&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Robert Longson [:longsonr]](/user_profile?user_id=218550)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from bugzilla.mozilla.org_ad47b586_20250124_235748.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/685186)
* [XML](/show_bug.cgi?ctype=xml&id=685186)

Closed
[Bug 685186](/show_bug.cgi?id=685186)

Opened 13 years ago
Closed 13 years ago

# Assertion failure: [infer failure] Missing type for arg 1 in jsinfer.cpp

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Assertion failure: [infer failure] Missing type for arg 1 in jsinfer.cpp

## Categories

### (Core :: JavaScript Engine, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=JavaScript%20Engine#JavaScript%20Engine)

JavaScript Engine
▾

Core :: JavaScript Engine
The interpreter engine for the core JavaScript language, independent of the browser's object model. File ONLY core JavaScript language bugs in this category. For bugs involving browser objects such as "window" and "document", use the "DOM" component. For bugs involving calls between JavaScript and C++, use the "XPConnect" component.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=JavaScript%20Engine&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=JavaScript%20Engine&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=JavaScript%20Engine)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

x86\_64

Linux

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

normal

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

---

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| a11y-review | --- |
| --- | --- |
| Performance Impact | --- |
| Webcompat Priority | --- |
| Webcompat Score | --- |
| Accessibility Severity | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox7 | [-](/buglist.cgi?f1=cf_tracking_firefox7&o1=equals&v1=-) | [unaffected](/buglist.cgi?f1=cf_status_firefox7&o1=equals&v1=unaffected) |
| firefox8 | [-](/buglist.cgi?f1=cf_tracking_firefox8&o1=equals&v1=-) | [unaffected](/buglist.cgi?f1=cf_status_firefox8&o1=equals&v1=unaffected) |
| firefox9 | [+](/buglist.cgi?f1=cf_tracking_firefox9&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=fixed) |
| firefox10 | [+](/buglist.cgi?f1=cf_tracking_firefox10&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=fixed) |
| status1.9.2 | --- | [unaffected](/buglist.cgi?f1=cf_status_192&o1=equals&v1=unaffected) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox7 | - | unaffected |
| firefox8 | - | unaffected |
| firefox9 | + | fixed |
| firefox10 | + | fixed |
| status1.9.2 |  | unaffected |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: dbaron, Assigned: bhackett1024)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/764aa0af2fda6f02fb17dc9771bb18d9?d=mm&size=40)  [bhackett1024](/user_profile?user_id=346231)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/0a32391d55cfa63276f87eb9819dfbd0?d=mm&size=40)  [dbaron](/user_profile?user_id=3881)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/4fe52ee1503aecf7b6c976b8eb7c1753?d=mm&size=40)  [willyelm](/user_profile?user_id=714609)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

10 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[688165](/show_bug.cgi?id=688165 "RESOLVED DUPLICATE - google plus abort js/src/jsinfer.cpp:341")

Dependency [tree](/showdependencytree.cgi?id=685186&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=685186)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[Duplicates:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#duplicates)

[688165](/show_bug.cgi?id=688165 "RESOLVED DUPLICATE - google plus abort js/src/jsinfer.cpp:341")

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: assertion, Whiteboard: [sg:critical][qa+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[assertion](/buglist.cgi?keywords=assertion&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[sg:critical][qa+]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (3 files, 1 obsolete file)

| [dump](/attachment.cgi?id=559704)  [13 years ago](#c4)  [David Baron :dbaron: (⌚️UTC-4, no longer working on Mozilla)](/user_profile?user_id=3881)   1.04 MB, text/plain; charset=UTF-8 |  | [Details](/attachment.cgi?id=559704&action=edit) |
| --- | --- | --- |
| [dump with new patch](/attachment.cgi?id=562128)  [13 years ago](#c8)  [David Baron :dbaron: (⌚️UTC-4, no longer working on Mozilla)](/user_profile?user_id=3881)   1.14 MB, text/plain; charset=UTF-8 |  | [Details](/attachment.cgi?id=562128&action=edit) |
| [patch](/attachment.cgi?id=564436)  [13 years ago](#c12)  [Brian Hackett [Laid off!]](/user_profile?user_id=346231)   1.58 KB, patch |  | [Details](/attachment.cgi?id=564436&action=edit) | [Diff](/attachment.cgi?id=564436&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=685186&attachment=564436) |
| [updated](/attachment.cgi?id=564889)  [13 years ago](#c15)  [Brian Hackett [Laid off!]](/user_profile?user_id=346231)   1.64 KB, patch | dvander : [review+](#a2424947_309316 "13 years ago")  asa : [approval-mozilla-aurora+](#a2956466_5003 "13 years ago") | [Details](/attachment.cgi?id=564889&action=edit) | [Diff](/attachment.cgi?id=564889&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=685186&attachment=564889) |

Show Obsolete

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [David Baron :dbaron: (⌚️UTC-4, no longer working on Mozilla)](/user_profile?user_id=3881)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=685186#c0)• 13 years ago |
|  | |

I've crashed twice in the past 24 hours (on a self-built Linux debug build based on mozilla-central cf1ba8f0dbf71900bb24d77b5a63ad82c279b113 with the following:
Assertion failure: \_PT\_PTHREAD\_MUTEX\_IS\_LOCKED(lock->mutex), at /home/dbaron/builds/ssd/mozilla-central/mozilla/nsprpub/pr/src/pthreads/ptsynch.c:227
The first of the two crashes I debugged a bit:
#6 0x00007f5f9781dab6 in abort () at abort.c:92
#7 0x00007f5f988f89aa in PR\_Assert (
s=0x7f5f9891df88 "\_PT\_PTHREAD\_MUTEX\_IS\_LOCKED(lock->mutex)",
file=0x7f5f9891de68 "/home/dbaron/builds/ssd/mozilla-central/mozilla/nsprpub
/pr/src/pthreads/ptsynch.c", ln=227)
at /home/dbaron/builds/ssd/mozilla-central/mozilla/nsprpub/pr/src/io/prlog.c
:587
#8 0x00007f5f9890d4a7 in PR\_Unlock (lock=0x13d5350)
at /home/dbaron/builds/ssd/mozilla-central/mozilla/nsprpub/pr/src/pthreads/p
tsynch.c:227
#9 0x00007f5f95ef8460 in AutoUnlockGC (cx=0x7f5ef501a110,
fmt=<value optimized out>)
at /home/dbaron/builds/ssd/mozilla-central/mozilla/js/src/jscntxt.h:1822
#10 print (cx=0x7f5ef501a110, fmt=<value optimized out>)
at /home/dbaron/builds/ssd/mozilla-central/mozilla/js/src/jsinfer.cpp:2314
#11 js::types::TypeFailure (cx=0x7f5ef501a110, fmt=<value optimized out>)
at /home/dbaron/builds/ssd/mozilla-central/mozilla/js/src/jsinfer.cpp:338
#12 0x00007f5f962a7efb in js::mjit::stubs::AssertArgumentTypes (f=...)
at /home/dbaron/builds/ssd/mozilla-central/mozilla/js/src/methodjit/StubCall
s.cpp:2470
#13 0x00007f5f71834b97 in ?? ()
This looks like we're doing AutoUnlockGC when the GC is not locked.
The script being executed was Google-plus related, though I think I may have actually been on <https://www.google.com/reader/view/> (I'm not going to paste URLs of the script or the frame because they may have auth info...)

|  | [Brian Hackett [Laid off!]](/user_profile?user_id=346231)  Assignee |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=685186#c1)• 13 years ago |
|  | |

Hmm, this should not crash here anymore on m-c tip (since a merge from JM last night), but the reason we were trying to unlock the GC was to dump state because of a type checking failure (the TypeFailure on the stack). If you hit this again can you paste the dump and JS stack, or do you have more ideas about how to get this to repro?

|  | [David Baron :dbaron: (⌚️UTC-4, no longer working on Mozilla)](/user_profile?user_id=3881)  Reporter |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=685186#c2)• 13 years ago |
|  | |

(In reply to Brian Hackett from [comment #1](/show_bug.cgi?id=685186#c1 "RESOLVED FIXED - Assertion failure: [infer failure] Missing type for arg 1 in jsinfer.cpp"))
> Hmm, this should not crash here anymore on m-c tip (since a merge from JM
> last night), but the reason we were trying to unlock the GC was to dump
> state because of a type checking failure (the TypeFailure on the stack). If
> you hit this again can you paste the dump and JS stack, or do you have more
> ideas about how to get this to repro?
Is "the dump" something that's printed to stdout? If it's not going to crash anymore, what should I look for?

|  | [Brian Hackett [Laid off!]](/user_profile?user_id=346231)  Assignee |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=685186#c3)• 13 years ago |
|  | |

Yeah, it will print to stdout. It will crash immediately afterwards, with an "[infer failure]" message in TypeFailure.

|  | [David Baron :dbaron: (⌚️UTC-4, no longer working on Mozilla)](/user_profile?user_id=3881)  Reporter |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=685186#c4)• 13 years ago |
|  | |

Attached file
[dump](attachment.cgi?id=559704)
— [Details](attachment.cgi?id=559704&action=edit)

Here's what it printed out before aborting.

|  | [Brian Hackett [Laid off!]](/user_profile?user_id=346231)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=685186#a1212793_346231)• 13 years ago |

Blocks: [688165](/show_bug.cgi?id=688165 "RESOLVED DUPLICATE - google plus abort js/src/jsinfer.cpp:341")

|  | [David Baron :dbaron: (⌚️UTC-4, no longer working on Mozilla)](/user_profile?user_id=3881)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=685186#a1321212_3881)• 13 years ago |

Summary: fatal NSPR assertion failure doing AutoUnlockGC when not locked: \_PT\_PTHREAD\_MUTEX\_IS\_LOCKED(lock->mutex), at ptsynch.c:227 → Assertion failure: [infer failure] Missing type for arg 1 in jsinfer.cpp

|  | [David Baron :dbaron: (⌚️UTC-4, no longer working on Mozilla)](/user_profile?user_id=3881)  Reporter |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=685186#c5)• 13 years ago |
|  | |

So with the new debugging patch applied, I now get:
Assertion failure: [infer failure] Missing type pushed 0: [0x7f13a34e2e80], at /home/dbaron/builds/ssd/mozilla-central/mozilla/js/src/jsinfer.cpp:341
at the stack:
#4 <signal handler called>
#5 0x00007f13d3ed5b3b in raise (sig=<value optimized out>)
at ../nptl/sysdeps/unix/sysv/linux/pt-raise.c:42
#6 0x00007f13d189dd66 in js::types::TypeFailure (cx=<value optimized out>,
fmt=<value optimized out>)
at /home/dbaron/builds/ssd/mozilla-central/mozilla/js/src/jsinfer.cpp:341
#7 0x00007f13d18a003e in js::types::TypeScript::CheckBytecode (
cx=0x7f13ad28d1a0, script=0x7f13a39582e0, pc=0x734b35c "7T",
sp=0x7f13b965a728)
at /home/dbaron/builds/ssd/mozilla-central/mozilla/js/src/jsinfer.cpp:5510
#8 0x00007f13b3a26bfe in ?? ()

|  | [David Baron :dbaron: (⌚️UTC-4, no longer working on Mozilla)](/user_profile?user_id=3881)  Reporter |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=685186#c6)• 13 years ago |
|  | |

And, for the record, the latest crash was following a link to:
<https://plus.google.com/photos/114490712483753086051/albums/5655320612646245745/5655320611468053890>
and letting the page sit there briefly. (It was something @limi tweeted; still not sure what it's a picture of, though.)

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=685186#c7)• 13 years ago |
|  | |

It is a picture of a bag of gummi worms, labelled "fat free".

|  | [David Baron :dbaron: (⌚️UTC-4, no longer working on Mozilla)](/user_profile?user_id=3881)  Reporter |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=685186#c8)• 13 years ago |
|  | |

Attached file
[dump with new patch](attachment.cgi?id=562128)
— [Details](attachment.cgi?id=562128&action=edit)

The dump with <https://hg.mozilla.org/mozilla-central/rev/29c8fccd95ba> applied to my tree, plus the output of js\_DumpPC(cx).

|  | [David Baron :dbaron: (⌚️UTC-4, no longer working on Mozilla)](/user_profile?user_id=3881)  Reporter |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=685186#c9)• 13 years ago |
|  | |

Any progress here? Leaving debug builds crashy for long periods of time really isn't ok.

|  | [Brian Hackett [Laid off!]](/user_profile?user_id=346231)  Assignee |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=685186#c10)• 13 years ago |
|  | |

I haven't able to reproduce this.

|  | [Patrick McManus [:mcmanus]](/user_profile?user_id=32546) |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=685186#c11)• 13 years ago |
|  | |

(In reply to Brian Hackett from [comment #10](/show_bug.cgi?id=685186#c10 "RESOLVED FIXED - Assertion failure: [infer failure] Missing type for arg 1 in jsinfer.cpp"))
> I haven't able to reproduce this.
Try this:
goto plus.google.com and sign in.
load <https://plus.google.com/108176814619778619437/posts/RmbumJ1HmLX>
press ^r to reload.
that crashes for me today 100% of the time with the jsinfer assertion.
I'm working on spdy support, so I spend a lot of time trawling google for tests cases with debug builds :)

|  | [Jeff Walden [:Waldo]](/user_profile?user_id=83595) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=685186#a2283225_83595)• 13 years ago |

Group: core-security

|  | [Brian Hackett [Laid off!]](/user_profile?user_id=346231)  Assignee |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=685186#c12)• 13 years ago |
|  | |

Attached patch

[patch](attachment.cgi?id=564436&action=diff) (obsolete)
— [Details](attachment.cgi?id=564436&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=685186&attachment=564436)

Thanks, with the latest instructions I was able to repro. Sorry about the long delay here.
This is a reentrancy problem while solving type constraints. Type barriers (a kind of runtime check for improving analysis precision) are added for JS opcodes during type inference, and can also be forcibly removed in some situations (analyzing how properties are added when calling 'new' on a script). There was a reentrance problem when removing type barriers, such that if removing the barrier triggered new barriers at the same opcode then those new barriers could vanish, leading to an inconsistent state and incorrect type information (which was caught by the assert).
While this page doesn't manifest in a (non-debug) crash, this should I think be fixed on aurora because bad type information can lead to generating incorrect (possibly crashing) jitcode.Assignee: general → bhackett1024
[Attachment #564436](/attachment.cgi?id=564436&action=edit "patch") -
Flags: review?(dvander)
[Attachment #564436](/attachment.cgi?id=564436&action=edit "patch") -
Flags: approval-mozilla-aurora?

|  | [LegNeato](/user_profile?user_id=482154) |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=685186#c13)• 13 years ago |
|  | |

Comment on [attachment 564436](/attachment.cgi?id=564436 "patch") [[details]](/attachment.cgi?id=564436&action=edit "patch") [[diff]](/attachment.cgi?id=564436&action=diff "patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=685186&attachment=564436)
patch
We won't approve until it has a review. Please renominate if you want when it has a review.
[Attachment #564436](/attachment.cgi?id=564436&action=edit "patch") -
Flags: approval-mozilla-aurora?

|  | [David Baron :dbaron: (⌚️UTC-4, no longer working on Mozilla)](/user_profile?user_id=3881)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=685186#a2415238_3881)• 13 years ago |

[tracking-firefox9](/buglist.cgi?f1=cf_tracking_firefox9&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox9&o1=equals&v1=%3F)

|  | [David Baron :dbaron: (⌚️UTC-4, no longer working on Mozilla)](/user_profile?user_id=3881)  Reporter |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=685186#c14)• 13 years ago |
|  | |

Even with the patch, I'm still crashing when leaving Google Plus pages.

|  | [Brian Hackett [Laid off!]](/user_profile?user_id=346231)  Assignee |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=685186#c15)• 13 years ago |
|  | |

Attached patch

[updated](attachment.cgi?id=564889&action=diff)
— [Details](attachment.cgi?id=564889&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=685186&attachment=564889)

Oops, I attached the wrong version of the patch.
[Attachment #564436](/attachment.cgi?id=564436&action=edit "patch") -
Attachment is obsolete: true
[Attachment #564436](/attachment.cgi?id=564436&action=edit "patch") -
Flags: review?(dvander)
[Attachment #564889](/attachment.cgi?id=564889&action=edit "updated") -
Flags: review?(dvander)

|  | [David Baron :dbaron: (⌚️UTC-4, no longer working on Mozilla)](/user_profile?user_id=3881)  Reporter |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=685186#c16)• 13 years ago |
|  | |

When you hand-edit patches, you should fiddle the chunk headers appropriately too. :-)

|  | [David Anderson [:dvander] - inactive, e-mail if emergency](/user_profile?user_id=309316) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=685186#a2424947_309316)• 13 years ago |

[Attachment #564889](/attachment.cgi?id=564889&action=edit "updated") -
Flags: review?(dvander) → review+

|  | [Brian Hackett [Laid off!]](/user_profile?user_id=346231)  Assignee |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=685186#c17)• 13 years ago |
|  | |

<https://hg.mozilla.org/integration/mozilla-inbound/rev/617182196237>

|  | [Brian Hackett [Laid off!]](/user_profile?user_id=346231)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=685186#a2587211_346231)• 13 years ago |

[Attachment #564889](/attachment.cgi?id=564889&action=edit "updated") -
Flags: approval-mozilla-aurora?

|  | [David Mandelin [:dmandelin]](/user_profile?user_id=294323) |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=685186#c18)• 13 years ago |
|  | |

Marking sg:critical due to potential for generating bad jitcode. Feel free to revise.Whiteboard: sg:critical

|  | [Asa Dotzler [:asa]](/user_profile?user_id=5003) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=685186#a2956466_5003)• 13 years ago |

[Attachment #564889](/attachment.cgi?id=564889&action=edit "updated") -
Flags: approval-mozilla-aurora? → approval-mozilla-aurora+

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=685186#c19)• 13 years ago |
|  | |

Please let this bake on mozilla-central for a few days before landing on aurora.
[status-firefox10](/buglist.cgi?f1=cf_status_firefox10&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=affected)
[status-firefox7](/buglist.cgi?f1=cf_status_firefox7&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_firefox7&o1=equals&v1=unaffected)
[status-firefox8](/buglist.cgi?f1=cf_status_firefox8&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_firefox8&o1=equals&v1=unaffected)
[status-firefox9](/buglist.cgi?f1=cf_status_firefox9&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=affected)
[tracking-firefox10](/buglist.cgi?f1=cf_tracking_firefox10&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox10&o1=equals&v1=%2B)
[tracking-firefox7](/buglist.cgi?f1=cf_tracking_firefox7&o1=isnotempty):
--- → [-](/buglist.cgi?f1=cf_tracking_firefox7&o1=equals&v1=-)
[tracking-firefox8](/buglist.cgi?f1=cf_tracking_firefox8&o1=isnotempty):
--- → [-](/buglist.cgi?f1=cf_tracking_firefox8&o1=equals&v1=-)
[tracking-firefox9](/buglist.cgi?f1=cf_tracking_firefox9&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox9&o1=equals&v1=%3F) → [+](/buglist.cgi?f1=cf_tracking_firefox9&o1=equals&v1=%2B)Whiteboard: sg:critical → [sg:critical]

|  | [Brian Hackett [Laid off!]](/user_profile?user_id=346231)  Assignee |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=685186#c20)• 13 years ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/617182196237>Status: NEW → RESOLVEDClosed: 13 years agoResolution: --- → FIXED

|  | [Brian Hackett [Laid off!]](/user_profile?user_id=346231)  Assignee |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=685186#c21)• 13 years ago |
|  | |

<https://hg.mozilla.org/releases/mozilla-aurora/rev/2ff67bfc7b19>

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=685186#a4939087_12352)• 13 years ago |

[status-firefox10](/buglist.cgi?f1=cf_status_firefox10&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=fixed)
[status-firefox9](/buglist.cgi?f1=cf_status_firefox9&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=fixed)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=685186#a6586023_1689)• 13 years ago |

[status1.9.2](/buglist.cgi?f1=cf_status_192&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_192&o1=equals&v1=unaffected)

|  | [u279076](/user_profile?user_id=279076) |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=685186#c23)• 13 years ago |
|  | |

QA to verify fix using testcase in [comment 11](/show_bug.cgi?id=685186#c11 "RESOLVED FIXED - Assertion failure: [infer failure] Missing type for arg 1 in jsinfer.cpp").Whiteboard: [sg:critical] → [sg:critical][qa+]

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=685186#a14018478_1689)• 13 years ago |

Group: core-security
You need to [log in](/show_bug.cgi?id=685186&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [David Baron :dbaron: (⌚️UTC-4, no longer working on Mozilla)](/user_profile?user_id=3881)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from bugzilla.mozilla.org_30373d9a_20250124_235738.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/562442)
* [XML](/show_bug.cgi?ctype=xml&id=562442)

Closed
[Bug 562442](/show_bug.cgi?id=562442)

Opened 15 years ago
Closed 13 years ago

# Crash in [@ nsPluginInstanceOwner::ReleasePluginPort(void\*)]

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Crash in [@ nsPluginInstanceOwner::ReleasePluginPort(void\*)]

## Categories

### (Core Graveyard :: Plug-ins, defect)

[Product:](/describecomponents.cgi?product=Core%20Graveyard)

Core Graveyard
▾

Core Graveyard
Old, retired Core components
[See Open Bugs in This Product](/buglist.cgi?product=Core%20Graveyard&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core%20Graveyard)
Watch This Product

[Component:](/describecomponents.cgi?product=Core%20Graveyard&component=Plug-ins#Plug-ins)

Plug-ins
▾

Core Graveyard :: Plug-ins
Bugs in core Mozilla code that supports registering and using plug-ins. For bugs in specific plugins, please file those bugs under External Software Affecting Firefox.
[See Open Bugs in This Component](/buglist.cgi?product=Core%20Graveyard&component=Plug-ins&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core%20Graveyard&component=Plug-ins&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core%20Graveyard&component=Plug-ins)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

x86

Windows 7

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

critical

## Tracking

### (firefox7 affected, firefox8 affected, firefox9 fixed, firefox10 fixed, status1.9.2 unaffected)

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Accessibility Severity | --- |
| --- | --- |
| Performance Impact | --- |
| a11y-review | --- |
| Webcompat Score | --- |
| Webcompat Priority | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox7 | --- | [affected](/buglist.cgi?f1=cf_status_firefox7&o1=equals&v1=affected) |
| firefox8 | --- | [affected](/buglist.cgi?f1=cf_status_firefox8&o1=equals&v1=affected) |
| firefox9 | --- | [fixed](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=fixed) |
| firefox10 | --- | [fixed](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=fixed) |
| status1.9.2 | --- | [unaffected](/buglist.cgi?f1=cf_status_192&o1=equals&v1=unaffected) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox7 |  | affected |
| firefox8 |  | affected |
| firefox9 |  | fixed |
| firefox10 |  | fixed |
| status1.9.2 |  | unaffected |

## People

### (Reporter: marcia, Assigned: jaas)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/a8fc05fdb6f74856d2cfbeef69fcda2a?d=mm&size=40)  [jaas](/user_profile?user_id=18821)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/cf7a6485ad75c35d66da0af6c88515d5?d=mm&size=40)  [marcia](/user_profile?user_id=8519)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](extensions/Gravatar/web/default.jpg)  [jimm](/user_profile?user_id=279663)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

8 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: crash, verified-aurora, verified-beta, Whiteboard: [sg:high][qa!])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[crash](/buglist.cgi?keywords=crash&resolution=---),
[verified-aurora](/buglist.cgi?keywords=verified-aurora&resolution=---),
[verified-beta](/buglist.cgi?keywords=verified-beta&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[sg:high][qa!]

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

1

Bug Flags:

|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |
|  | qe-verify |  |

## Crash Data

Signature:

[[@ nsPluginInstanceOwner::ReleasePluginPort(void\*) ]](https://crash-stats.mozilla.org/signature/?signature=nsPluginInstanceOwner%3A%3AReleasePluginPort%28void%2A%29)

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (2 files, 1 obsolete file)

| [fix v1.0](/attachment.cgi?id=570328)  [13 years ago](#c3)  [Josh Aas](/user_profile?user_id=18821)   2.08 KB, patch |  | [Details](/attachment.cgi?id=570328&action=edit) | [Diff](/attachment.cgi?id=570328&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=562442&attachment=570328) |
| --- | --- | --- |
| [fix v1.1](/attachment.cgi?id=570696)  [13 years ago](#c4)  [Josh Aas](/user_profile?user_id=18821)   1.45 KB, patch | jimm : [review+](#c5 "13 years ago") | [Details](/attachment.cgi?id=570696&action=edit) | [Diff](/attachment.cgi?id=570696&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=562442&attachment=570696) |
| [aurora fix v1.0](/attachment.cgi?id=571075)  [13 years ago](#c6)  [Josh Aas](/user_profile?user_id=18821)   1.46 KB, patch | jst : [approval-mozilla-aurora+](#c8 "13 years ago") | [Details](/attachment.cgi?id=571075&action=edit) | [Diff](/attachment.cgi?id=571075&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=562442&attachment=571075) |

Show Obsolete

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Marcia Knous [:marcia]](/user_profile?user_id=8519)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=562442#c0)• 15 years ago |
|  | |

Seen while running Mozilla/5.0 (Windows; U; Windows NT 6.1; en-US; rv:1.9.3a5pre) Gecko/20100428 Minefield/3.7a5pre
<https://crash-stats.mozilla.com/report/index/7c982f11-1f35-42ca-bb03-c34a92100428>
STR:
1. I was composing an email in Gmail.
2. Added <http://www.caltrain.com/pdf/Holiday_Schedules/Caltrain_Weekend_Holiday_Schedule_08-31-2009.pdf> to the email and hit Send.
3. The crash occurred
Have not been able to repro
Frame Module Signature [Expand] Source
0 xul.dll nsPluginInstanceOwner::ReleasePluginPort layout/generic/nsObjectFrame.cpp:5725
1 xul.dll nsObjectFrame::CallSetWindow layout/generic/nsObjectFrame.cpp:1057
2 xul.dll nsObjectFrame::DidReflow layout/generic/nsObjectFrame.cpp:1149
3 xul.dll nsLineLayout::ReflowFrame layout/generic/nsLineLayout.cpp:967
4 xul.dll nsBlockFrame::ReflowInlineFrame layout/generic/nsBlockFrame.cpp:3716
5 xul.dll nsBlockFrame::DoReflowInlineFrames layout/generic/nsBlockFrame.cpp:3511
6 xul.dll nsBlockFrame::ReflowInlineFrames layout/generic/nsBlockFrame.cpp:3365
7 xul.dll nsBlockFrame::ReflowLine layout/generic/nsBlockFrame.cpp:2461
8 xul.dll nsBlockFrame::ReflowDirtyLines layout/generic/nsBlockFrame.cpp:1907
9 xul.dll nsBlockFrame::Reflow layout/generic/nsBlockFrame.cpp:1009
10 xul.dll nsContainerFrame::ReflowChild layout/generic/nsContainerFrame.cpp:736
11 xul.dll nsHTMLReflowState::Init layout/generic/nsHTMLReflowState.cpp:285
12 xul.dll nsCSSFrameConstructor::RestyleElement layout/base/nsCSSFrameConstructor.cpp:8007
13 @0x3802a3f

|  | [Marcia Knous [:marcia]](/user_profile?user_id=8519)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=562442#a599140_8519)• 15 years ago |

Summary: Crash in [@nsPluginInstanceOwner::ReleasePluginPort(void\*)] → Crash in [@ nsPluginInstanceOwner::ReleasePluginPort(void\*)]

|  | [aravindm](/user_profile?user_id=369768) |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=562442#c1)• 15 years ago |
|  | |

Mozilla/5.0 (Windows; U; Windows NT 6.0; en-US; rv:1.9.3a5pre) Gecko/20100603 Minefield/3.7a5pre
Works for me in the latest trunk build.

|  | [Virtual\_ManPL [:Virtual] 🇵🇱 - (please needinfo? me - so I will see your comment/reply/question/etc.)](/user_profile?user_id=342842) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=562442#c2)• 14 years ago |
|  | |

Happens also in XP in Fx4...
<http://crash-stats.mozilla.com/report/index/f086e727-aa10-4215-8aa0-73d252101125>

|  | [Nobody; OK to take it and work on it](/user_profile?user_id=1) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=562442#a35171347_1)• 14 years ago |

Crash Signature: [@ nsPluginInstanceOwner::ReleasePluginPort(void\*)]

|  | [Josh Aas](/user_profile?user_id=18821)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=562442#a47337960_18821)• 13 years ago |

Assignee: nobody → joshmoz

|  | [Josh Aas](/user_profile?user_id=18821)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=562442#a47344425_18821)• 13 years ago |

Group: core-security

|  | [Josh Aas](/user_profile?user_id=18821)  Assignee |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=562442#c3)• 13 years ago |
|  | |

Attached patch

[fix v1.0](attachment.cgi?id=570328&action=diff) (obsolete)
— [Details](attachment.cgi?id=570328&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=562442&attachment=570328)

This will fix the crash but in cases where we would crash we'll leak the plugin port on Windows. That's much better than what happens now but this patch could be expanded to avoid the leak if someone takes the time to figure out how to re-factor the plugin port memory management here. We could file a separate bug on that and fix it later, a strategy that makes even more sense if we want to lower risk porting this patch to aurora and beta.
[Attachment #570328](/attachment.cgi?id=570328&action=edit "fix v1.0") -
Flags: review?(bzbarsky)

|  | [Josh Aas](/user_profile?user_id=18821)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=562442#a47584606_18821)• 13 years ago |

[Attachment #570328](/attachment.cgi?id=570328&action=edit "fix v1.0") -
Flags: review?(bzbarsky)

|  | [Josh Aas](/user_profile?user_id=18821)  Assignee |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=562442#c4)• 13 years ago |
|  | |

Attached patch

[fix v1.1](attachment.cgi?id=570696&action=diff)
— [Details](attachment.cgi?id=570696&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=562442&attachment=570696)

Includes a fix for the memory leak.
[Attachment #570328](/attachment.cgi?id=570328&action=edit "fix v1.0") -
Attachment is obsolete: true
[Attachment #570696](/attachment.cgi?id=570696&action=edit "fix v1.1") -
Flags: review?(jmathies)

|  | [Josh Aas](/user_profile?user_id=18821)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=562442#a47585495_18821)• 13 years ago |

Whiteboard: sg:high

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=562442#c5)• 13 years ago |
|  | |

Comment on [attachment 570696](/attachment.cgi?id=570696 "fix v1.1") [[details]](/attachment.cgi?id=570696&action=edit "fix v1.1") [[diff]](/attachment.cgi?id=570696&action=diff "fix v1.1") [[review]](/page.cgi?id=splinter.html&ignore=&bug=562442&attachment=570696)
fix v1.1
Looks ok to me.
[Attachment #570696](/attachment.cgi?id=570696&action=edit "fix v1.1") -
Flags: review?(jmathies) → review+

|  | [Josh Aas](/user_profile?user_id=18821)  Assignee |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=562442#c6)• 13 years ago |
|  | |

Attached patch

[aurora fix v1.0](attachment.cgi?id=571075&action=diff)
— [Details](attachment.cgi?id=571075&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=562442&attachment=571075)

|  | [Josh Aas](/user_profile?user_id=18821)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=562442#a47687166_18821)• 13 years ago |

[Attachment #571075](/attachment.cgi?id=571075&action=edit "aurora fix v1.0") -
Flags: approval-mozilla-aurora?

|  | [Josh Aas](/user_profile?user_id=18821)  Assignee |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=562442#c7)• 13 years ago |
|  | |

pushed to mozilla-central
<http://hg.mozilla.org/mozilla-central/rev/978002c0b0ad>Status: NEW → RESOLVEDClosed: 13 years agoResolution: --- → FIXED

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=562442#c8)• 13 years ago |
|  | |

Comment on [attachment 571075](/attachment.cgi?id=571075 "aurora fix v1.0") [[details]](/attachment.cgi?id=571075&action=edit "aurora fix v1.0") [[diff]](/attachment.cgi?id=571075&action=diff "aurora fix v1.0") [[review]](/page.cgi?id=splinter.html&ignore=&bug=562442&attachment=571075)
aurora fix v1.0
a=drivers per today's meeting.
[Attachment #571075](/attachment.cgi?id=571075&action=edit "aurora fix v1.0") -
Flags: approval-mozilla-aurora? → approval-mozilla-aurora+

|  | [Josh Aas](/user_profile?user_id=18821)  Assignee |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=562442#c9)• 13 years ago |
|  | |

pushed to aurora
<http://hg.mozilla.org/releases/mozilla-aurora/rev/3c039628db9b>
[status-firefox10](/buglist.cgi?f1=cf_status_firefox10&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=fixed)
[status-firefox7](/buglist.cgi?f1=cf_status_firefox7&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox7&o1=equals&v1=affected)
[status-firefox8](/buglist.cgi?f1=cf_status_firefox8&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox8&o1=equals&v1=affected)
[status-firefox9](/buglist.cgi?f1=cf_status_firefox9&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=fixed)

|  | [juan becerra [:juanb]](/user_profile?user_id=241759) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=562442#c10)• 13 years ago |
|  | |

Adding [qa+] for bug verification. We can try the steps in [comment #0](/show_bug.cgi?id=562442#c0 "VERIFIED FIXED - Crash in [@ nsPluginInstanceOwner::ReleasePluginPort(void*)]"), but since we can't reproduce reliably we can check crash-stats before and after fix.Whiteboard: sg:high → sg:high,[qa+]

|  | [u279076](/user_profile?user_id=279076) |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=562442#c11)• 13 years ago |
|  | |

I'm seeing no instances of this crash on crash-stats for anything newer than Firefox 8. Marking verified.Status: RESOLVED → VERIFIEDKeywords: [verified-aurora](/buglist.cgi?keywords=verified-aurora&resolution=---),
[verified-beta](/buglist.cgi?keywords=verified-beta&resolution=---)Whiteboard: sg:high,[qa+] → sg:high,[qa!]

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=562442#a50811059_1689)• 13 years ago |

Whiteboard: sg:high,[qa!] → [sg:high][qa!]

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=562442#c12)• 13 years ago |
|  | |

Does not appear to affect the 1.9.2 branch
[https://crash-stats.mozilla.com/report/list?product=Firefox&query\_search=signature&query\_type=contains&query=nsPluginInstanceOwner%3A%3AReleasePluginPort%28void\*%29&reason\_type=contains&date=12%2F07%2F2011%2014%3A25%3A51&range\_value=1&range\_unit=weeks&hang\_type=any&process\_type=any&do\_query=1&signature=nsPluginInstanceOwner%3A%3AReleasePluginPort%28void\*%29](https://crash-stats.mozilla.com/report/list?product=Firefox&query_search=signature&query_type=contains&query=nsPluginInstanceOwner%3A%3AReleasePluginPort%28void*%29&reason_type=contains&date=12%2F07%2F2011%2014%3A25%3A51&range_value=1&range_unit=weeks&hang_type=any&process_type=any&do_query=1&signature=nsPluginInstanceOwner%3A%3AReleasePluginPort%28void*%29)
[status1.9.2](/buglist.cgi?f1=cf_status_192&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_192&o1=equals&v1=unaffected)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=562442#a56945261_1689)• 13 years ago |

Group: core-security

|  | [BMO Automation](/user_profile?user_id=546015) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=562442#a380245285_546015)• 3 years ago |

Product: Core → Core Graveyard
You need to [log in](/show_bug.cgi?id=562442&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Josh Aas](/user_profile?user_id=18821)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from bugzilla.mozilla.org_2356d1ee_20250124_235803.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/691873)
* [XML](/show_bug.cgi?ctype=xml&id=691873)

Closed
[Bug 691873](/show_bug.cgi?id=691873)

Opened 13 years ago
Closed 13 years ago

# js::types::TypeCompartment::addPending can write off end of pendingArray if OOM

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

js::types::TypeCompartment::addPending can write off end of pendingArray if OOM

## Categories

### (Core :: JavaScript Engine, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=JavaScript%20Engine#JavaScript%20Engine)

JavaScript Engine
▾

Core :: JavaScript Engine
The interpreter engine for the core JavaScript language, independent of the browser's object model. File ONLY core JavaScript language bugs in this category. For bugs involving browser objects such as "window" and "document", use the "DOM" component. For bugs involving calls between JavaScript and C++, use the "XPConnect" component.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=JavaScript%20Engine&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=JavaScript%20Engine&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=JavaScript%20Engine)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

unspecified

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

x86\_64

Linux

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

normal

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

---

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Webcompat Priority | --- |
| --- | --- |
| Accessibility Severity | --- |
| a11y-review | --- |
| Performance Impact | --- |
| Webcompat Score | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox7 | [-](/buglist.cgi?f1=cf_tracking_firefox7&o1=equals&v1=-) | [unaffected](/buglist.cgi?f1=cf_status_firefox7&o1=equals&v1=unaffected) |
| firefox8 | [-](/buglist.cgi?f1=cf_tracking_firefox8&o1=equals&v1=-) | [unaffected](/buglist.cgi?f1=cf_status_firefox8&o1=equals&v1=unaffected) |
| firefox9 | [+](/buglist.cgi?f1=cf_tracking_firefox9&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=fixed) |
| firefox10 | [+](/buglist.cgi?f1=cf_tracking_firefox10&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=fixed) |
| status1.9.2 | --- | [unaffected](/buglist.cgi?f1=cf_status_192&o1=equals&v1=unaffected) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox7 | - | unaffected |
| firefox8 | - | unaffected |
| firefox9 | + | fixed |
| firefox10 | + | fixed |
| status1.9.2 |  | unaffected |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: jimb, Assigned: bhackett1024)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/764aa0af2fda6f02fb17dc9771bb18d9?d=mm&size=40)  [bhackett1024](/user_profile?user_id=346231)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/26684b295a47bf5a82b22010a9427ade?d=mm&size=40)  [jimb](/user_profile?user_id=298765)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/4fe52ee1503aecf7b6c976b8eb7c1753?d=mm&size=40)  [willyelm](/user_profile?user_id=714609)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

3 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Whiteboard: [sg:critical?][qa?])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

---

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[sg:critical?][qa?]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (1 file)

| [patch](/attachment.cgi?id=565074)  [13 years ago](#c2)  [Brian Hackett [Laid off!]](/user_profile?user_id=346231)   2.59 KB, patch | jimb : [review+](#a263646_298765 "13 years ago")  jst : [approval-mozilla-aurora+](#c4 "13 years ago") | [Details](/attachment.cgi?id=565074&action=edit) | [Diff](/attachment.cgi?id=565074&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=691873&attachment=565074) |
| --- | --- | --- |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Jim Blandy :jimb](/user_profile?user_id=298765)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=691873#c0)• 13 years ago |
|  | |

In TypeCompartment::addPending, we say:
if (pendingCount == pendingCapacity)
growPendingArray(cx);
PendingWork &pending = pendingArray[pendingCount++];
pending.constraint = constraint;
pending.source = source;
pending.type = type;
If growPendingArray fails because of OOM, then the writes to pending's referent's members are writing off the end of the array.
It looks as if, once pendingCount > pendingCapacity, we won't try to call growPendingArray any more, and all subsequent addPending calls will write off the end of that array, so we might be able to reach pretty far.

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=691873#c1)• 13 years ago |
|  | |

sg:critical? assuming growPendingArray refers to the kind of array a web script can create and grow to an arbitrary size.Whiteboard: [sg:critical?]

|  | [Brian Hackett [Laid off!]](/user_profile?user_id=346231)  Assignee |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=691873#c2)• 13 years ago |
|  | |

Attached patch

[patch](attachment.cgi?id=565074&action=diff)
— [Details](attachment.cgi?id=565074&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=691873&attachment=565074)

Great catch, this was pretty braindead.Assignee: general → bhackett1024
[Attachment #565074](/attachment.cgi?id=565074&action=edit "patch") -
Flags: review?(jimb)

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=691873#a177129_12352)• 13 years ago |

[status-firefox10](/buglist.cgi?f1=cf_status_firefox10&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=affected)
[status-firefox7](/buglist.cgi?f1=cf_status_firefox7&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_firefox7&o1=equals&v1=unaffected)
[status-firefox8](/buglist.cgi?f1=cf_status_firefox8&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_firefox8&o1=equals&v1=unaffected)
[status-firefox9](/buglist.cgi?f1=cf_status_firefox9&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=affected)
[tracking-firefox10](/buglist.cgi?f1=cf_tracking_firefox10&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox10&o1=equals&v1=%2B)
[tracking-firefox7](/buglist.cgi?f1=cf_tracking_firefox7&o1=isnotempty):
--- → [-](/buglist.cgi?f1=cf_tracking_firefox7&o1=equals&v1=-)
[tracking-firefox8](/buglist.cgi?f1=cf_tracking_firefox8&o1=isnotempty):
--- → [-](/buglist.cgi?f1=cf_tracking_firefox8&o1=equals&v1=-)
[tracking-firefox9](/buglist.cgi?f1=cf_tracking_firefox9&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox9&o1=equals&v1=%2B)

|  | [Jim Blandy :jimb](/user_profile?user_id=298765)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=691873#a263646_298765)• 13 years ago |

[Attachment #565074](/attachment.cgi?id=565074&action=edit "patch") -
Flags: review?(jimb) → review+

|  | [Brian Hackett [Laid off!]](/user_profile?user_id=346231)  Assignee |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=691873#c3)• 13 years ago |
|  | |

<https://hg.mozilla.org/integration/mozilla-inbound/rev/1eca7dca8152>

|  | [Brian Hackett [Laid off!]](/user_profile?user_id=346231)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=691873#a855733_346231)• 13 years ago |

[Attachment #565074](/attachment.cgi?id=565074&action=edit "patch") -
Flags: approval-mozilla-aurora?

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=691873#c4)• 13 years ago |
|  | |

Comment on [attachment 565074](/attachment.cgi?id=565074 "patch") [[details]](/attachment.cgi?id=565074&action=edit "patch") [[diff]](/attachment.cgi?id=565074&action=diff "patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=691873&attachment=565074)
patch
Approved for aurora per today's triage meeting.
[Attachment #565074](/attachment.cgi?id=565074&action=edit "patch") -
Flags: approval-mozilla-aurora? → approval-mozilla-aurora+

|  | [Brian Hackett [Laid off!]](/user_profile?user_id=346231)  Assignee |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=691873#c5)• 13 years ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/1eca7dca8152>
(This has been on m-c for several days but the bug wasn't updated).
<https://hg.mozilla.org/releases/mozilla-aurora/rev/781ed08803ea>Status: NEW → RESOLVEDClosed: 13 years agoResolution: --- → FIXED

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=691873#c6)• 13 years ago |
|  | |

Fixed in 9 and 10 per previous comment.
[status-firefox10](/buglist.cgi?f1=cf_status_firefox10&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=fixed)
[status-firefox9](/buglist.cgi?f1=cf_status_firefox9&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=fixed)

|  | [u279076](/user_profile?user_id=279076) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=691873#c7)• 13 years ago |
|  | |

Is there something QA can do to verify this fix?Whiteboard: [sg:critical?] → [sg:critical?][qa?]

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=691873#a4243218_1689)• 13 years ago |

[status1.9.2](/buglist.cgi?f1=cf_status_192&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_192&o1=equals&v1=unaffected)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=691873#a11675352_1689)• 13 years ago |

Group: core-security
You need to [log in](/show_bug.cgi?id=691873&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Brian Hackett [Laid off!]](/user_profile?user_id=346231)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from blog.mozilla.org_0753cb36_20250126_043823.html ===

[Skip to content](#content)

[Mozilla](https://blog.mozilla.org/en/)

![search](https://blog.mozilla.org/wp-content/themes/foxtail/assets/images/icons/search.svg)

* [Internet Culture](https://blog.mozilla.org/en/category/internet-culture/)
  + [Deep Dives](https://blog.mozilla.org/en/category/internet-culture/deep-dives/)
  + [Mozilla Explains](https://blog.mozilla.org/en/category/internet-culture/mozilla-explains/)
  + [Interviews](https://blog.mozilla.org/en/category/internet-culture/interviews/)
  + [Videos](https://blog.mozilla.org/en/category/videos/)
* [Privacy & Security](https://blog.mozilla.org/en/category/privacy-security/)
* [Products](https://blog.mozilla.org/en/category/products/)
  + [Firefox](https://blog.mozilla.org/en/category/products/firefox/)
  + [Pocket](https://blog.mozilla.org/en/category/products/pocket/)
  + [Mozilla VPN](https://blog.mozilla.org/en/category/products/mozilla-vpn/)
* [Mozilla](https://blog.mozilla.org/en/category/mozilla/)
  + [News](https://blog.mozilla.org/en/category/mozilla/news/)
  + [Internet Policy](https://blog.mozilla.org/en/category/mozilla/internet-policy/)
  + [Leadership](https://blog.mozilla.org/en/category/mozilla/leadership/)
    - [Mitchell Baker, CEO](https://blog.mozilla.org/en/author/mitchellmozillacom/)
    - [Mark Surman, ED Foundation](https://blog.mozilla.org/en/author/markmozillafoundation-org/)
    - [Eric Rescorla, Firefox CTO](https://blog.mozilla.org/en/author/ekrmozilla-com/)

[Download Firefox](https://www.mozilla.org/firefox/new/?utm_source=blog.mozilla.org&utm_medium=referral&utm_campaign=blog-nav)

![search](https://blog.mozilla.org/wp-content/themes/foxtail/assets/images/icons/search.svg)

#### Search

Search for:

![](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2019/01/mozilla-logo-bw-rgb.png)
## News

Official announcements and press releases

[![Room filled with people listening to a speaker on stage. Demo Day visual image in the background.](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2024/12/Demo_Day_Blog_Header_-1-800x800.jpg)
Mozilla
## Mozilla Builders: Celebrating community-driven innovation in AI

Read More](https://blog.mozilla.org/en/mozilla/mozilla-builders-demo-day/)

[![The Mozilla logo in green on a black background](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2024/12/logo-lockup-video-poster-800x800.png)
Mozilla
## Mozilla welcomes new executive team members

Read More](https://blog.mozilla.org/en/mozilla/new-executives/)

[![Decorative image of wrapped gifts in front of an iphone](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2023/11/moz_header_holiday_firefox-phone-gifts_blue-03.png-800x800.png)
Products
## Shopping for everyone? We’ve got you covered with the Fakespot Holiday Gift Guide 2024

Read More](https://blog.mozilla.org/en/products/shopping-for-everyone-weve-got-you-covered-with-the-fakespot-holiday-gift-guide-2024/)

[![Text: Mozilla Builders](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2024/06/Blog-16_9-1920x1080-1-800x800.png)
Mozilla
## 14 AI projects to watch: Mozilla’s first Builders Accelerator cohort kicks off

Read More](https://blog.mozilla.org/en/mozilla/14-ai-projects-to-watch-mozillas-first-builders-accelerator-cohort-kicks-off/)

[![A check mark next to the text "Fakespot."](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2023/07/Fakespot_ProductBlog-2-800x800.jpg)
News
## Fakespot’s guide to trending back-to-school products

Read More](https://blog.mozilla.org/en/mozilla/news/fakespots-guide-to-trending-back-to-school-products/)

[![](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2024/06/IG_Highlights_Icon-800x800.png)
Mozilla
## BAFTA Award-Winner Siobhán McSweeney to host Mozilla’s 2nd Annual Rise25 Awards in Dublin, Ireland on Aug. 13

Read More](https://blog.mozilla.org/en/mozilla/bafta-award-winner-siobhan-mcsweeney-to-host-mozillas-2nd-annual-rise25-awards-in-dublin-ireland-on-august-13/)

[![](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2024/05/fx_website_meta-image_tips-tricks_alt-04-1-800x800.webp)
Mozilla
## Here’s what we’re working on in Firefox

Read More](https://blog.mozilla.org/en/mozilla/heres-what-were-working-on-in-firefox/)

[![A check mark next to the text "Fakespot."](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2023/07/Fakespot_ProductBlog-2-800x800.jpg)
News
## Fakespot reveals the product categories with the most and least reliable product reviews

Read More](https://blog.mozilla.org/en/mozilla/news/fakespot-reveals-the-product-categories-with-the-most-and-least-reliable-product-reviews-for-summer-and-back-to-school-shopping/)

[![A dark blue speech bubble with horizontal purple and red bars on a pink background.](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2020/03/fx_blog_header_announcements_001_1920x1080-800x800.jpg)
Firefox
## Engaging with our Firefox community: Highlights from our recent AMA

Read More](https://blog.mozilla.org/en/products/firefox/engaging-with-our-firefox-community-highlights-from-our-recent-ama/)

[![](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2024/06/IG_Highlights_Icon-800x800.png)
Mozilla
## Mozilla announces finalists for the 2nd annual Rise25 Awards

Read More](https://blog.mozilla.org/en/mozilla/mozilla-announces-finalists-for-the-2nd-annual-rise25-awards/)

[![Mozilla and Anonym logos](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2024/06/blog_1200x800_v2-800x800.png)
Mozilla
## Introducing Anonym: Raising the bar for privacy-preserving digital advertising

Read More](https://blog.mozilla.org/en/mozilla/mozilla-anonym-raising-the-bar-for-privacy-preserving-digital-advertising/)

[![logo - zero with a diagonal line through it, and the letters D, I, N](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2024/06/odintbanner-500x500.png)
Mozilla
## Keeping GenAI technologies secure is a shared responsibility

Read More](https://blog.mozilla.org/en/mozilla/keeping-genai-technologies-secure-is-a-shared-responsibility/)

1
[2](https://blog.mozilla.org/en/category/mozilla/news/page/2?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=compan)
[3](https://blog.mozilla.org/en/category/mozilla/news/page/3?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=compan)
…
[24](https://blog.mozilla.org/en/category/mozilla/news/page/24?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=compan)
[next](https://blog.mozilla.org/en/category/mozilla/news/page/2?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=compan)

![newsletter](https://blog.mozilla.org/wp-content/themes/foxtail/assets/images/newsletter.png)

### Keep up with all things Firefox

Get how-tos, advice and news to make your Firefox experience work best for you.

Your e-mail address

Country
- select -
Afghanistan
Akrotiri
Albania
Algeria
American Samoa
Andorra
Angola
Anguilla
Antarctica
Antigua and Barbuda
Argentina
Armenia
Aruba
Ashmore and Cartier Islands
Australia
Austria
Azerbaijan
Bahamas, The
Bahrain
Baker Island
Bangladesh
Barbados
Bassas da India
Belarus
Belgium
Belize
Benin
Bermuda
Bhutan
Bolivia
Bonaire, Sint Eustatius, and Saba
Bosnia and Herzegovina
Botswana
Bouvet Island
Brazil
British Indian Ocean Territory
Brunei
Bulgaria
Burkina Faso
Burma
Burundi
Cabo Verde
Cambodia
Cameroon
Canada
Cayman Islands
Central African Republic
Chad
Chile
China
Christmas Island
Clipperton Island
Cocos (Keeling) Islands
Colombia
Comoros
Congo (Brazzaville)
Congo (Kinshasa)
Cook Islands
Coral Sea Islands
Costa Rica
Croatia
Cuba
Curaçao
Cyprus
Czech Republic
Côte d’Ivoire
Denmark
Dhekelia
Diego Garcia
Djibouti
Dominica
Dominican Republic
Ecuador
Egypt
El Salvador
Equatorial Guinea
Eritrea
Estonia
Ethiopia
Europa Island
Falkland Islands (Islas Malvinas)
Faroe Islands
Fiji
Finland
France
French Guiana
French Polynesia
French Southern and Antarctic Lands
Gabon
Gambia, The
Gaza Strip
Georgia
Germany
Ghana
Gibraltar
Glorioso Islands
Greece
Greenland
Grenada
Guadeloupe
Guam
Guatemala
Guernsey
Guinea
Guinea-Bissau
Guyana
Haiti
Heard Island and McDonald Islands
Honduras
Hong Kong
Howland Island
Hungary
Iceland
India
Indonesia
Iran
Iraq
Ireland
Isle of Man
Israel
Italy
Jamaica
Jan Mayen
Japan
Jarvis Island
Jersey
Johnston Atoll
Jordan
Juan de Nova Island
Kazakhstan
Kenya
Kingman Reef
Kiribati
Korea, North
Korea, South
Kosovo
Kuwait
Kyrgyzstan
Laos
Latvia
Lebanon
Lesotho
Liberia
Libya
Liechtenstein
Lithuania
Luxembourg
Macau
Macedonia
Madagascar
Malawi
Malaysia
Maldives
Mali
Malta
Marshall Islands
Martinique
Mauritania
Mauritius
Mayotte
Mexico
Micronesia, Federated States of
Midway Islands
Moldova
Monaco
Mongolia
Montenegro
Montserrat
Morocco
Mozambique
Namibia
Nauru
Navassa Island
Nepal
Netherlands
New Caledonia
New Zealand
Nicaragua
Niger
Nigeria
Niue
Norfolk Island
Northern Mariana Islands
Norway
Oman
Pakistan
Palau
Palmyra Atoll
Panama
Papua New Guinea
Paracel Islands
Paraguay
Peru
Philippines
Pitcairn Islands
Poland
Portugal
Puerto Rico
Qatar
Reunion
Romania
Russia
Rwanda
Saint Barthelemy
Saint Helena, Ascension, and Tristan da Cunha
Saint Kitts and Nevis
Saint Lucia
Saint Martin
Saint Pierre and Miquelon
Saint Vincent and the Grenadines
Samoa
San Marino
Sao Tome and Principe
Saudi Arabia
Senegal
Serbia
Seychelles
Sierra Leone
Singapore
Sint Maarten
Slovakia
Slovenia
Solomon Islands
Somalia
South Africa
South Georgia and South Sandwich Islands
South Sudan
Spain
Spratly Islands
Sri Lanka
Sudan
Suriname
Svalbard
Swaziland
Sweden
Switzerland
Syria
Taiwan
Tajikistan
Tanzania
Thailand
Timor-Leste
Togo
Tokelau
Tonga
Trinidad and Tobago
Tromelin Island
Tunisia
Turkey
Turkmenistan
Turks and Caicos Islands
Tuvalu
Uganda
Ukraine
United Arab Emirates
United Kingdom
United States
Uruguay
Uzbekistan
Vanuatu
Vatican City
Venezuela
Vietnam
Virgin Islands, British
Virgin Islands, U.S.
Wake Island
Wallis and Futuna
West Bank
Western Sahara
Yemen
Zambia
Zimbabwe

Language
English
Bahasa Indonesia
Deutsch
Español
Français
Polski
Português
Русский
正體中文

Format

 HTML

 Text

I’m okay with Mozilla handling my info as explained in this [Privacy Policy](https://www.mozilla.org/privacy/).

Sign up now
We will only send you
Mozilla-related information.

## Thanks!

If you haven’t previously confirmed a subscription to a Mozilla-related newsletter you may have to do so. Please check your inbox or your spam filter for an e-mail from us.

[Mozilla](https://www.mozilla.org/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)

##### Mozilla

* [About](https://www.mozilla.org/about/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Contact Us](https://www.mozilla.org/contact/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Donate](https://donate.mozilla.org/?presets=50,30,20,10&amount=30¤cy=usd&utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)

##### Firefox

* [Download Firefox](https://www.mozilla.org/firefox/new/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Desktop](https://www.mozilla.org/firefox/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Mobile](https://www.mozilla.org/firefox/mobile/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Features](https://www.mozilla.org/firefox/features/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Beta, Nightly, Developer Edition](https://www.mozilla.org/firefox/channel/desktop/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)

##### Resources

* [Privacy Hub](https://www.mozilla.org/privacy/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Browser Comparison](https://www.mozilla.org/firefox/browsers/compare/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Brand Standards](https://mozilla.design/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)

##### Social

Follow @Firefox

* [Twitter (@mozilla)](https://twitter.com/firefox)
* [Instagram (@mozilla)](https://www.instagram.com/firefox/)
* [YouTube (@firefoxchannel)](https://www.youtube.com/user/firefoxchannel)

Follow @Mozilla

* [Twitter (@mozilla)](https://twitter.com/mozilla)
* [Instagram (@mozilla)](https://www.instagram.com/mozilla/)

* [Website Privacy Notice](https://www.mozilla.org/privacy/websites/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Legal](https://www.mozilla.org/about/legal/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)


