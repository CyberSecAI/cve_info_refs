=== Content from bugzilla.mozilla.org_dc0b68bf_20250125_045751.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/646968)
* [XML](/show_bug.cgi?ctype=xml&id=646968)

Closed
[Bug 646968](/show_bug.cgi?id=646968)

Opened 14 years ago
Closed 14 years ago

# let-block variable initializers are statically outside the let-scope but dynamically inside it

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

let-block variable initializers are statically outside the let-scope but dynamically inside it

## Categories

### (Core :: JavaScript Engine, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=JavaScript%20Engine#JavaScript%20Engine)

JavaScript Engine
▾

Core :: JavaScript Engine
The interpreter engine for the core JavaScript language, independent of the browser's object model. File ONLY core JavaScript language bugs in this category. For bugs involving browser objects such as "window" and "document", use the "DOM" component. For bugs involving calls between JavaScript and C++, use the "XPConnect" component.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=JavaScript%20Engine&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=JavaScript%20Engine&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=JavaScript%20Engine)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Other Branch

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

All

All

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

normal

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla8

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Webcompat Priority | --- |
| --- | --- |
| Webcompat Score | --- |
| Performance Impact | --- |
| a11y-review | --- |
| Accessibility Severity | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox5 | [-](/buglist.cgi?f1=cf_tracking_firefox5&o1=equals&v1=-) | [wontfix](/buglist.cgi?f1=cf_status_firefox5&o1=equals&v1=wontfix) |
| firefox6 | [-](/buglist.cgi?f1=cf_tracking_firefox6&o1=equals&v1=-) | [wontfix](/buglist.cgi?f1=cf_status_firefox6&o1=equals&v1=wontfix) |
| firefox7 | [-](/buglist.cgi?f1=cf_tracking_firefox7&o1=equals&v1=-) | [wontfix](/buglist.cgi?f1=cf_status_firefox7&o1=equals&v1=wontfix) |
| firefox8 | [+](/buglist.cgi?f1=cf_tracking_firefox8&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox8&o1=equals&v1=fixed) |
| firefox9 | [+](/buglist.cgi?f1=cf_tracking_firefox9&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=fixed) |
| firefox10 | [+](/buglist.cgi?f1=cf_tracking_firefox10&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=fixed) |
| blocking1.9.2 | --- | [-](/buglist.cgi?f1=cf_blocking_192&o1=equals&v1=-) |
| status1.9.2 | --- | [wontfix](/buglist.cgi?f1=cf_status_192&o1=equals&v1=wontfix) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox5 | - | wontfix |
| firefox6 | - | wontfix |
| firefox7 | - | wontfix |
| firefox8 | + | fixed |
| firefox9 | + | fixed |
| firefox10 | + | fixed |
| blocking1.9.2 |  |  |
| status1.9.2 |  | wontfix |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: jorendorff, Assigned: jorendorff)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/5a83f46f9f97d184457cb2dedfa19173?d=mm&size=40)  [jorendorff](/user_profile?user_id=281791)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/5a83f46f9f97d184457cb2dedfa19173?d=mm&size=40)  [jorendorff](/user_profile?user_id=281791)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/4fe52ee1503aecf7b6c976b8eb7c1753?d=mm&size=40)  [willyelm](/user_profile?user_id=714609)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

15 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

[672804](/show_bug.cgi?id=672804 "VERIFIED FIXED - \"Assertion failure: parent,\""), [673070](/show_bug.cgi?id=673070 "VERIFIED FIXED - \"Assertion failure: sharedBlock,\" with e4x")

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

Dependency [tree](/showdependencytree.cgi?id=646968&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=646968)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[Duplicates:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#duplicates)

[647695](/show_bug.cgi?id=647695 "RESOLVED DUPLICATE - TM: Crash [@ js::types::TypeFailure] involving missing type XML:prototype:new")

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Whiteboard: [sg:critical?] [landed m-c 7/15][qa-] not exploitable on 1.9.2?)

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

---

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[sg:critical?] [landed m-c 7/15][qa-] not exploitable on 1.9.2?

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [ehsan.akhgari](/user_profile?user_id=251051) | [in-testsuite](#c30 "14 years ago") | + |
| --- | --- | --- |
| [ehsan.akhgari](/user_profile?user_id=251051) | in-testsuite | + |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (1 file, 2 obsolete files)

| [WIP 1](/attachment.cgi?id=543048)  [14 years ago](#c19)  [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)   10.66 KB, patch |  | [Details](/attachment.cgi?id=543048&action=edit) | [Diff](/attachment.cgi?id=543048&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=646968&attachment=543048) |
| --- | --- | --- |
| [v2](/attachment.cgi?id=543428)  [14 years ago](#c20)  [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)   12.38 KB, patch |  | [Details](/attachment.cgi?id=543428&action=edit) | [Diff](/attachment.cgi?id=543428&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=646968&attachment=543428) |
| [v3](/attachment.cgi?id=543429)  [14 years ago](#c21)  [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)   13.17 KB, patch | brendan : [review+](#c28 "14 years ago")  asa : [approval-mozilla-aurora-](#c36 "14 years ago")  asa : [approval-mozilla-beta-](#c36 "14 years ago") | [Details](/attachment.cgi?id=543429&action=edit) | [Diff](/attachment.cgi?id=543429&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=646968&attachment=543429) |

Show Obsolete

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)  Assignee |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=646968#c0)• 14 years ago |
|  | |

The EXPR in `let (x = EXPR) foo();` is supposed to be outside the scope of the lexical variable x being declared.
The compiler gets this right for names it can bind statically, but it still emits the bytecode for the expression \*after\* the JSOP\_ENTERBLOCK instruction. That means the scope is wrong for plain old JSOP\_NAME opcodes:
var x = 5;
let (x = x)
assertEq(x, 5); // PASS
let (x = eval("x"))
assertEq(x, 5); // FAIL
let (x = function () { with ({}) return x; })
assertEq(x(), 5); // FAIL
(let (x = x) assertEq(x, 5)); // PASS
(let (x = eval("x")) assertEq(x, 5)); // FAIL
(let (x = function () { with ({}) return x; }) assertEq(x(), 5)); // FAIL
I can't think of a clever way to fix this offhand.

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=646968#a2273_281791)• 14 years ago |

Group: core-security

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)  Assignee |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=646968#c1)• 14 years ago |
|  | |

dvander points out that
- you don't need with/eval to emit NAME opcodes; an escaping function
with upvars is enough
- this could cause a JSOP\_NAME/JSOP\_SETNAME to read or write an inner
variable that the static analysis thinks isn't being read/written.
He thinks it can probably be exploited in the JIT.

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)  Assignee |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=646968#c2)• 14 years ago |
|  | |

We could emit the right-hand sides first, then ENTERBLOCK. We would modify ENTERBLOCK to use the already-populated operand stack slots as storage for the varibles in the new scope, instead of populating new slots with undefined.
Disassembly for `let (x = EXPR1, y = EXPR2) EXPR3` would look like this:
EXPR1 # v1
EXPR2 # v1 v2
enterblock (x, y) # x=v1 y=v2
EXPR3 # x y v3
leaveblockexpr 2 # v3
This might be a little tricky for destructuring let. More on that in a minute.

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)  Assignee |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=646968#c3)• 14 years ago |
|  | |

It's not so bad.
`let ([x, y] = obj) ...`
push # set aside a slot for x
push # and one for y
getgname obj
dup
zero
getelem
setlocalpop 0 # set x = obj[0]
dup
one
getelem
setlocalpop 1 # set y = obj[1]
enterblock (x, y)
The only difficulty I anticipate here is getting the decompiler to
understand which names those setlocalpop instructions are assigning to.
Worst-case, we add a JSOP\_NOP with a magic source note.
`let ([x, y] = [a, b]) ...`
Using the existing group destructuring code with this new approach, we
would get:
push # set aside a slot for x
push # and one for y
getgname a
getgname b
getlocal 2
setlocal 0 # store x = a
getlocal 3
setlocal 1 # store y = b
popn 2
enterblock (x, y)
(Of course all that amounts to:
getgname a
getgname b
enterblock (x, y)
which the decompiler would happily decompile to `let (x=a, y=b)`. Cute, but
not worth implementing, at least not in this bug.)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=646968#c4)• 14 years ago |
|  | |

(In reply to [comment #1](/show_bug.cgi?id=646968#c1 "RESOLVED FIXED - let-block variable initializers are statically outside the let-scope but dynamically inside it"))
> - this could cause a JSOP\_NAME/JSOP\_SETNAME to read or write an inner
> variable that the static analysis thinks isn't being read/written.
Is the variable potentially written to still a "variable"? or could that bit of memory now be used for something else entirely where now an attacker can cause us to execute the wrong stuff. I guess even as a variable it could be a reference to some object on which you call methods, replaced with a value that points at a fake object the attacker lays out in a typedarray or something like that?

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=646968#c5)• 14 years ago |
|  | |

David, per [comment 1](/show_bug.cgi?id=646968#c1 "RESOLVED FIXED - let-block variable initializers are statically outside the let-scope but dynamically inside it") you're suggesting that this is a potentially exploitable bug. Can you please suggest a sg: rating per <https://wiki.mozilla.org/Security_Severity_Ratings>Assignee: general → dvander

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=646968#c6)• 14 years ago |
|  | |

David says that while it would be tricky to get the jit to generate exploitable code here he thinks it's possible, and suggests sg:critical? for this bug. He also thought Jason would be a good owner here, so reassigning to Jason for now.Assignee: dvander → jorendorffWhiteboard: [sg:critical?]

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=646968#a6653671_12352)• 14 years ago |

[status-firefox5](/buglist.cgi?f1=cf_status_firefox5&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox5&o1=equals&v1=wontfix)
[status-firefox6](/buglist.cgi?f1=cf_status_firefox6&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox6&o1=equals&v1=affected)
[status-firefox7](/buglist.cgi?f1=cf_status_firefox7&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox7&o1=equals&v1=affected)
[tracking-firefox5](/buglist.cgi?f1=cf_tracking_firefox5&o1=isnotempty):
--- → [-](/buglist.cgi?f1=cf_tracking_firefox5&o1=equals&v1=-)
[tracking-firefox6](/buglist.cgi?f1=cf_tracking_firefox6&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox6&o1=equals&v1=%2B)
[tracking-firefox7](/buglist.cgi?f1=cf_tracking_firefox7&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox7&o1=equals&v1=%2B)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=646968#c7)• 14 years ago |
|  | |

can we get a testcase or js shell script that exhibits the problem? We'll need this to verify the bug and create a regression test.
Does this affect the 1.9.2 branch as well, or is this a problem that crept in with the method JIT?Keywords: [testcase-wanted](/buglist.cgi?keywords=testcase-wanted&resolution=---)

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=646968#c8)• 14 years ago |
|  | |

Jason, do you think you're the right owner here? And if so, when do you think you can get to this?

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=646968#c9)• 14 years ago |
|  | |

Jason: Only a couple weeks left before mozilla6 goes to beta channel, will this be done by then?

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)  Assignee |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=646968#c10)• 14 years ago |
|  | |

Yeah, this is on my list. I'll patch it this week.

|  | [Dave Herman [:dherman]](/user_profile?user_id=368424) |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=646968#c11)• 14 years ago |
|  | |

FWIW, I believe Jason is right that the intended scoping semantics of let expressions and let statements was that in the form:
let (x1[= e1], ..., xn[= en]) body
all the expressions e1 ... en are in the outer scope, and the x1 ... xn variables are only in scope in the body. (This corresponds to Scheme's LET, as opposed to LET\* or LETREC.)
But this is from ES4 and is not in Harmony, at least not currently. So there isn't really a definitive spec.
Dave

|  | [Brendan Eich [:brendan]](/user_profile?user_id=1214) |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=646968#c12)• 14 years ago |
|  | |

Scoping should be like Scheme let, not let\* or letrec.
/be

|  | [Jeff Walden [:Waldo]](/user_profile?user_id=83595) |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=646968#c13)• 14 years ago |
|  | |

I was always partial to let\* allowing easy abbreviation of intermediate steps, myself. But I imagine let is easiest and least complicated to implement, because you don't have a gazillion different possible scope-object-munges. Is simplicity the reason we would want let rather than let\*?

|  | [Dave Herman [:dherman]](/user_profile?user_id=368424) |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=646968#c14)• 14 years ago |
|  | |

Jeff: I pretty much agree with you. I like let\* for the same reason. I think I originally proposed let instead of let\* for ES4 without really thinking it through. And now it looks like we're schedule-bound to get this patched quickly.
But we might actually be able to get away with changing this down the road, if we decided we preferred the let\* semantics; I think people use let-declarations far more often than let-expressions and let-statements, so it might not break much. And we could easily do some simple scope analysis of Firefox and addon code to see how much bustage it would cause.
Dave

|  | [Dave Herman [:dherman]](/user_profile?user_id=368424) |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=646968#c15)• 14 years ago |
|  | |

FWIW, we could probably do scope analysis to merge frames in many cases, so let\* would often devolve to being no more expensive than let.
Dave

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)  Assignee |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=646968#c16)• 14 years ago |
|  | |

The code for emitting switch statements contains this:
/\* Emit JSOP\_ENTERBLOCK before code to evaluate the discriminant. \*/
if (!EmitEnterBlock(cx, pn2, cg))
return JS\_FALSE;
That seems like the same kind of bug.

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)  Assignee |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=646968#c17)• 14 years ago |
|  | |

Heh, after all that noise in comments 2 and 3, I think all I had to do was emit the block chain in a couple extra places.

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)  Assignee |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=646968#c18)• 14 years ago |
|  | |

Whoops, posted that prematurely. I guess I might as well explain.
What I mean is, there's already code in EmitVariables to handle let-heads and other similar places specially. My plan: in the places where that code hacks the CodeGenerator, also emit JSOP\_BLOCKCHAIN/NULLBLOCKCHAIN annotations for GetBlockChain's benefit.

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)  Assignee |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=646968#c19)• 14 years ago |
|  | |

Attached patch

[WIP 1](attachment.cgi?id=543048&action=diff) (obsolete)
— [Details](attachment.cgi?id=543048&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=646968&attachment=543048)

This passes the tests with let-expressions and let-blocks, but it still fails
for(let x = eval('x');;) and switch (eval('x')) { let x; }.

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)  Assignee |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=646968#c20)• 14 years ago |
|  | |

Attached patch

[v2](attachment.cgi?id=543428&action=diff) (obsolete)
— [Details](attachment.cgi?id=543428&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=646968&attachment=543428)

Phew. This patch was harder to write than it looks. :-|
Unfortunately there is still this:
var s = '', x = {a: 1, b: 2, c: 3};
for (let x in let (y = 0) x)
s += x;
assertEq(s, 'abc');
typein:4: Error: Assertion failed: got "", expected "abc"
I think this is a bug too, but it seems to be a bug in the jsparse code that builds the def-use chains, not jsemit. Assuming this patch gets review, I'll file a follow-up bug for that.
Maybe I should remove the for-in part of this patch, though, so that I at least leave things consistent. Your thoughts?
[Attachment #543048](/attachment.cgi?id=543048&action=edit "WIP 1") -
Attachment is obsolete: true
[Attachment #543428](/attachment.cgi?id=543428&action=edit "v2") -
Flags: review?(brendan)

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)  Assignee |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=646968#c21)• 14 years ago |
|  | |

Attached patch

[v3](attachment.cgi?id=543429&action=diff)
— [Details](attachment.cgi?id=543429&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=646968&attachment=543429)

Identical to v2 except for bumping the bytecode version.
[Attachment #543428](/attachment.cgi?id=543428&action=edit "v2") -
Attachment is obsolete: true
[Attachment #543428](/attachment.cgi?id=543428&action=edit "v2") -
Flags: review?(brendan)
[Attachment #543429](/attachment.cgi?id=543429&action=edit "v3") -
Flags: review?(brendan)

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)  Assignee |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=646968#c22)• 14 years ago |
|  | |

Went ahead and filed followup [bug 668848](/show_bug.cgi?id=668848 "RESOLVED WONTFIX - jsparse use-def chains incorrectly bind variable in for-let-in head").

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=646968#c24)• 14 years ago |
|  | |

Jason and Brendan, we're considering this for Firefox 6, which is already in beta. Any chance of getting this reviewed and landed reasonably soon to get plenty of testing during beta for this?

|  | [Brendan Eich [:brendan]](/user_profile?user_id=1214) |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=646968#c25)• 14 years ago |
|  | |

Comment on [attachment 543429](/attachment.cgi?id=543429 "v3") [[details]](/attachment.cgi?id=543429&action=edit "v3") [[diff]](/attachment.cgi?id=543429&action=diff "v3") [[review]](/page.cgi?id=splinter.html&ignore=&bug=646968&attachment=543429)
v3
Why the JSOP\_NOP emits before the EmitBlockChain calls?
/be

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)  Assignee |  |
| --- | --- | --- |
| [Comment 26](/show_bug.cgi?id=646968#c26)• 14 years ago |
|  | |

Sorry I didn't write a nice comment about that.
The current block chain is \*not\* always computed by looking at the most recent JSOP\_BLOCKCHAIN/NULLBLOCKCHAIN/ENTERBLOCK instruction. Sometimes we call GetBlockChainFast. It looks at the op immediately \*following\* the op at pc. If it is JSOP\_BLOCKCHAIN or JSOP\_NULLBLOCKCHAIN, then we don't bother looking at instructions before the pc.
So in this patch, I emit JSOP\_NOPs in order to avoid accidentally confusing GetBlockChainFast when pc points to the preceding instruction. (!)
I think it would be better to separate these two competely different meanings of JSOP\_BLOCKCHAIN/NULLBLOCKCHAIN (modifying the immediately preceding opcode vs. modifying only subsequent opcodes), but I thought it best not to refactor all that in this bug.

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)  Assignee |  |
| --- | --- | --- |
| [Comment 27](/show_bug.cgi?id=646968#c27)• 14 years ago |
|  | |

It might also be better if GetBlockChainFast could assert that the looked-for annotation is there. We should know that statically at each call site, right?

|  | [Brendan Eich [:brendan]](/user_profile?user_id=1214) |  |
| --- | --- | --- |
| [Comment 28](/show_bug.cgi?id=646968#c28)• 14 years ago |
|  | |

Comment on [attachment 543429](/attachment.cgi?id=543429 "v3") [[details]](/attachment.cgi?id=543429&action=edit "v3") [[diff]](/attachment.cgi?id=543429&action=diff "v3") [[review]](/page.cgi?id=splinter.html&ignore=&bug=646968&attachment=543429)
v3
Please FIXME-comment the NOPs citing the followup bug. Thanks,
/be
[Attachment #543429](/attachment.cgi?id=543429&action=edit "v3") -
Flags: review?(brendan) → review+

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Comment 29](/show_bug.cgi?id=646968#c29)• 14 years ago |
|  | |

Can we get this landed on the trunk so that we can tell whether this is something we can take late in a beta cycle for 6?

|  | [(no longer active)](/user_profile?user_id=251051) |  |
| --- | --- | --- |
| [Comment 30](/show_bug.cgi?id=646968#c30)• 14 years ago |
|  | |

<http://hg.mozilla.org/mozilla-central/rev/69dfa4008531>Status: NEW → RESOLVEDClosed: 14 years agoFlags: in-testsuite+Resolution: --- → FIXEDTarget Milestone: --- → mozilla8

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)  Assignee |  |
| --- | --- | --- |
| [Comment 31](/show_bug.cgi?id=646968#c31)• 14 years ago |
|  | |

Comment on [attachment 543429](/attachment.cgi?id=543429 "v3") [[details]](/attachment.cgi?id=543429&action=edit "v3") [[diff]](/attachment.cgi?id=543429&action=diff "v3") [[review]](/page.cgi?id=splinter.html&ignore=&bug=646968&attachment=543429)
v3
I assume I still need to get these bits even though this is tracking-firefox6+ and tracking-firefox7+.
[Attachment #543429](/attachment.cgi?id=543429&action=edit "v3") -
Flags: approval-mozilla-beta?
[Attachment #543429](/attachment.cgi?id=543429&action=edit "v3") -
Flags: approval-mozilla-aurora?

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)  Assignee |  |
| --- | --- | --- |
| [Comment 32](/show_bug.cgi?id=646968#c32)• 14 years ago |
|  | |

(btw, followup [bug 671360](/show_bug.cgi?id=671360 "RESOLVED DUPLICATE - This JSOP_BLOCKCHAIN/NULLBLOCKCHAIN stuff is getting just a little ridiculous").)

|  | [Asa Dotzler [:asa]](/user_profile?user_id=5003) |  |
| --- | --- | --- |
| [Comment 33](/show_bug.cgi?id=646968#c33)• 14 years ago |
|  | |

jorendorff, yes, and we'll get to these approval requests on Monday's 2pm PT triage.Whiteboard: [sg:critical?] → [sg:critical?] [landed m-c 7/15]

|  | [Asa Dotzler [:asa]](/user_profile?user_id=5003) |  |
| --- | --- | --- |
| [Comment 34](/show_bug.cgi?id=646968#c34)• 14 years ago |
|  | |

Is this the kind of thing we'd expect to see independently discovered in the wild? If not, can we just let it climb up the release chain normally?

|  | [Jeff Walden [:Waldo]](/user_profile?user_id=83595) |  |
| --- | --- | --- |
| [Comment 35](/show_bug.cgi?id=646968#c35)• 14 years ago |
|  | |

Hasn't this been in since the start of let, i.e. 2006 or so? Waiting's always a gamble, but five years of gambling has, er, not bitten us yet. I'd at least lean toward waiting.

|  | [Asa Dotzler [:asa]](/user_profile?user_id=5003) |  |
| --- | --- | --- |
| [Comment 36](/show_bug.cgi?id=646968#c36)• 14 years ago |
|  | |

Comment on [attachment 543429](/attachment.cgi?id=543429 "v3") [[details]](/attachment.cgi?id=543429&action=edit "v3") [[diff]](/attachment.cgi?id=543429&action=diff "v3") [[review]](/page.cgi?id=splinter.html&ignore=&bug=646968&attachment=543429)
v3
We're not willing to take the risk into Aurora and Beta -- worried especially about add-on compatibility. Given that this is internally found, we'd prefer to take the extra 6 weeks to let this climb the normal rout through the channels.
[Attachment #543429](/attachment.cgi?id=543429&action=edit "v3") -
Flags: approval-mozilla-beta?
[Attachment #543429](/attachment.cgi?id=543429&action=edit "v3") -
Flags: approval-mozilla-beta-
[Attachment #543429](/attachment.cgi?id=543429&action=edit "v3") -
Flags: approval-mozilla-aurora?
[Attachment #543429](/attachment.cgi?id=543429&action=edit "v3") -
Flags: approval-mozilla-aurora-

|  | [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=646968#a9571476_132034)• 14 years ago |

Depends on: [672804](/show_bug.cgi?id=672804 "VERIFIED FIXED - \"Assertion failure: parent,\"")

|  | [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=646968#a9637401_132034)• 14 years ago |

Depends on: [673070](/show_bug.cgi?id=673070 "VERIFIED FIXED - \"Assertion failure: sharedBlock,\" with e4x")

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Comment 37](/show_bug.cgi?id=646968#c37)• 14 years ago |
|  | |

Tracking for 8 since there were regressions from this.
[status-firefox6](/buglist.cgi?f1=cf_status_firefox6&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox6&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox6&o1=equals&v1=wontfix)
[status-firefox7](/buglist.cgi?f1=cf_status_firefox7&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox7&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox7&o1=equals&v1=wontfix)
[status-firefox8](/buglist.cgi?f1=cf_status_firefox8&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox8&o1=equals&v1=fixed)
[tracking-firefox6](/buglist.cgi?f1=cf_tracking_firefox6&o1=isnotempty):
[+](/buglist.cgi?f1=cf_tracking_firefox6&o1=equals&v1=%2B) → [-](/buglist.cgi?f1=cf_tracking_firefox6&o1=equals&v1=-)
[tracking-firefox7](/buglist.cgi?f1=cf_tracking_firefox7&o1=isnotempty):
[+](/buglist.cgi?f1=cf_tracking_firefox7&o1=equals&v1=%2B) → [-](/buglist.cgi?f1=cf_tracking_firefox7&o1=equals&v1=-)
[tracking-firefox8](/buglist.cgi?f1=cf_tracking_firefox8&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox8&o1=equals&v1=%2B)

|  | [u279076](/user_profile?user_id=279076) |  |
| --- | --- | --- |
| [Comment 38](/show_bug.cgi?id=646968#c38)• 13 years ago |
|  | |

qa- as nothing to do for QA verification -- please reset to qa+ if a testcase can be provided.Whiteboard: [sg:critical?] [landed m-c 7/15] → [sg:critical?] [landed m-c 7/15][qa-]

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=646968#a16935436_12352)• 13 years ago |

[status-firefox10](/buglist.cgi?f1=cf_status_firefox10&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=fixed)
[status-firefox9](/buglist.cgi?f1=cf_status_firefox9&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=fixed)
[tracking-firefox10](/buglist.cgi?f1=cf_tracking_firefox10&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox10&o1=equals&v1=%2B)
[tracking-firefox9](/buglist.cgi?f1=cf_tracking_firefox9&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox9&o1=equals&v1=%2B)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 39](/show_bug.cgi?id=646968#c39)• 13 years ago |
|  | |

Does this bug affect 1.9.2? at least part of the patch would apply to jsemitblocking1.9.2: --- → ?
[status1.9.2](/buglist.cgi?f1=cf_status_192&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_status_192&o1=equals&v1=%3F)

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)  Assignee |  |
| --- | --- | --- |
| [Comment 40](/show_bug.cgi?id=646968#c40)• 13 years ago |
|  | |

I think 1.9.2 is affected, but we never found a way to exploit this. The way we imagined it might be exploitable involved the methodjit, which does not exist in 1.9.2.
Combine that with the size of the patch and the number of regressions it introduced, and I can confidently say that 1.9.2 is better off without it.

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=646968#a18483428_425645)• 13 years ago |

[status1.9.2](/buglist.cgi?f1=cf_status_192&o1=isnotempty):
[?](/buglist.cgi?f1=cf_status_192&o1=equals&v1=%3F) → [wontfix](/buglist.cgi?f1=cf_status_192&o1=equals&v1=wontfix)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=646968#a18495355_1689)• 13 years ago |

Whiteboard: [sg:critical?] [landed m-c 7/15][qa-] → [sg:critical?] [landed m-c 7/15][qa-] not exploitable on 1.9.2?

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=646968#a20394422_1689)• 13 years ago |

blocking1.9.2: ? → -

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=646968#a25396641_1689)• 13 years ago |

Group: core-security

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=646968#a143418034_75935)• 9 years ago |

Keywords: [testcase-wanted](/buglist.cgi?keywords=testcase-wanted&resolution=---)
You need to [log in](/show_bug.cgi?id=646968&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from www.mozilla.org_cc522abb_20250125_045749.html ===


## Help us improve your Mozilla experience

In addition to Cookies necessary for this site to function, we’d like your permission to set some additional Cookies to better understand your browsing needs and improve your experience. Rest assured — we value your privacy.

Accept All Additional Cookies

Reject All Additional Cookies

[Cookie settings](/en-US/privacy/websites/cookie-settings/)

Menu
[![Mozilla](https://www.mozilla.org/media/img/logos/m24/lockup-black.f2ddba3f0724.svg)](/en-US/)

* [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
  Firefox browsers](/en-US/firefox/)
  Close Firefox browsers menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Desktop](/en-US/firefox/new/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for iOS](/en-US/firefox/browsers/mobile/ios/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Android](/en-US/firefox/browsers/mobile/android/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/focus/logo.aac3e33175cb.svg)
    ## Firefox Focus](/en-US/firefox/browsers/mobile/focus/)
  + [## Firefox blog](https://blog.mozilla.org/firefox/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=firefox)
* [Products](/en-US/products/)
  Close Products menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/mozilla/vpn/logo.c648f487bfb8.svg)
    ## Mozilla VPN](/en-US/products/vpn/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/monitor/logo.d97e5516f9e6.svg)
    ## Mozilla Monitor](https://monitor.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/relay/logo-white.d42a8b52e44c.svg)
    ## Firefox Relay](https://relay.firefox.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/pocket/logo.17446bc33a5d.svg)
    ## Pocket](https://getpocket.com/firefox_learnmore/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/nav/icons/icon-mdn-plus.f54475f980ab.svg)
    ## MDN Plus](https://developer.mozilla.org/plus?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/fakespot/logo-blue.3973b8fe9631.svg)
    ## Fakespot](https://fakespot.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/thunderbird/logo-thunderbird.121e9c0fed45.svg)
    ## Thunderbird](https://www.thunderbird.net/)

  [All products](/en-US/products/)
* [About us](/en-US/about/)
  Close About us menu

  Our Mission

  + [## About Mozilla](/en-US/about/)
  + [## The Mozilla Manifesto](/en-US/about/manifesto/)
  + [## Get Involved](/en-US/contribute/)
  + [## Innovation Projects](https://future.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Blog](https://blog.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)

  Our Work

  + [## Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla.ai](https://www.mozilla.ai/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Ventures](https://mozilla.vc/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Advertising](/en-US/advertising/)

## Menu

* Mozilla Security

## [Mozilla Security](/en-US/security/)

* [Advisories](/en-US/security/advisories/)
* [Known Vulnerabilities](/en-US/security/known-vulnerabilities/)
* [Mozilla Security Blog](https://blog.mozilla.com/security/)
* [Security Bug Bounty](/en-US/security/bug-bounty/)
* [Third-party Injection Policy](/en-US/security/third-party-software-injection/)

## [Client Bug Bounty](/en-US/security/client-bug-bounty/)

* [Frequently Asked Questions](/en-US/security/bug-bounty/faq/)
* [Hall of Fame](/en-US/security/bug-bounty/hall-of-fame/)

## [Web Bug Bounty](/en-US/security/web-bug-bounty/)

* [Eligible Websites](/en-US/security/bug-bounty/web-eligible-sites/)
* [Frequently Asked Questions](/en-US/security/bug-bounty/faq-webapp/)
* [Hall of Fame](/en-US/security/bug-bounty/web-hall-of-fame/)

# Mozilla Foundation Security Advisory 2011-48

## Miscellaneous memory safety hazards (rv:8.0)

Announced
November 8, 2011
Impact
Critical
Products
Firefox, SeaMonkey, Thunderbird
Fixed in

* Firefox 8
* SeaMonkey 2.5
* Thunderbird 8

### Description

Mozilla developers fixed several memory safety bugs
in the browser engine used in Firefox and other Mozilla-based
products. Some of these bugs showed evidence of memory corruption
under certain circumstances, and we presume that with enough effort at
least some of these could be exploited to run arbitrary code.

In general these flaws cannot be exploited through email in the Thunderbird
and SeaMonkey products because scripting is disabled, but are potentially a risk
in browser or browser-like contexts in those products.

### References

Jason Orendorff, Boris Zbarsky, Gregg Tavares, Mats Palmgren, Christian
Holler, Jesse Ruderman, Simona Marcu, Bob Clary, and William McCloskey reported
memory safety problems that affected Firefox 7.

* [Memory safety bugs fixed in Firefox 8](https://bugzilla.mozilla.org/buglist.cgi?bug_id=646968,652054,665070,671160,672892,674843,675515,676918,677847,679593,686044)
* [CVE-2011-3651](http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2011-3651)

Security researcher **Rh0** reported a potentially exploitable
crash due to unchecked allocation failure.

* <https://bugzilla.mozilla.org/show_bug.cgi?id=682727>
* [CVE-2011-3652](http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2011-3652)

Security researcher **Aki Helin** reported a potentially
exploitable crash with an SVG `<mpath>` linking to
a non-SVG element.

* <https://bugzilla.mozilla.org/show_bug.cgi?id=694953>
* [CVE-2011-3654](http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2011-3654)

## Company

* [Leadership](/about/leadership/)
* [Press Center](https://blog.mozilla.org/category/mozilla/news/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=company)
* [Careers](/en-US/careers/)
* [Contact](/en-US/contact/)

## Support

* [Product Help](https://support.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [File a Bug](https://bugzilla.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [Localize Mozilla](https://pontoon.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)

## Resources

* [Advertise with Mozilla](/en-US/advertising/)
* [Firefox Release Notes](/firefox/134.0.2/releasenotes/)

## Developers

* [Developer Edition](/en-US/firefox/developer/)
* [Enterprise](/en-US/firefox/enterprise/)
* [Tools](https://firefox-source-docs.mozilla.org/devtools-user/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=developers)
* [MDN](https://developer.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer)

## Follow @Mozilla

* [X (formerly Twitter) (@mozilla)](https://twitter.com/mozilla)
* [Instagram (@mozilla)](https://www.instagram.com/mozilla/)
* [LinkedIn (@mozilla)](https://www.linkedin.com/company/mozilla-corporation/)
* [TikTok (@mozilla)](https://www.tiktok.com/%40mozilla)
* [Spotify (@mozilla)](https://open.spotify.com/show/0vT7LJMeVDxyQ2ZamHKu08?si=_uDRD6bRR_6M5YZyISGXgA)

## Follow @Firefox

* [X (formerly Twitter) (@firefox)](https://twitter.com/firefox)
* [Instagram (@firefox)](https://www.instagram.com/firefox/)
* [YouTube (@firefoxchannel)](https://www.youtube.com/user/firefoxchannel)
* [TikTok (@firefox)](https://www.tiktok.com/%40firefox)

[Donate](https://foundation.mozilla.org/?form=moco-donate-footer)

Visit [Mozilla Corporation’s](/en-US/) not-for-profit parent, the [Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer).

Portions of this content are ©1998–2025 by individual mozilla.org contributors. Content available under a [Creative Commons license](/en-US/foundation/licensing/website-content/).

* [Website Privacy Notice](/en-US/privacy/websites/)
* [Cookies](/en-US/privacy/websites/cookie-settings/)
* [Legal](/en-US/about/legal/)
* [Community Participation Guidelines](/en-US/about/governance/policies/participation/)
* [About this site](/en-US/about/this-site/)

![](https://www.mozilla.org/media/img/logos/m24/wordmark-white.2d673bb5b33a.svg)



=== Content from bugzilla.mozilla.org_2fe8e856_20250126_060754.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/682727)
* [XML](/show_bug.cgi?ctype=xml&id=682727)

Closed
[Bug 682727](/show_bug.cgi?id=682727)
(CVE-2011-3652)

Opened 13 years ago
Closed 13 years ago

# Crash during datamove (ACCESS VIOLATION READ) [@ memcpy | nsAString\_internal::Assign(unsigned short const\*, unsigned int)]

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Crash during datamove (ACCESS VIOLATION READ) [@ memcpy | nsAString\_internal::Assign(unsigned short const\*, unsigned int)]

## Categories

### (Core :: Networking: Cache, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=Networking%3A%20Cache#Networking%3A%20Cache)

Networking: Cache
▾

Core :: Networking: Cache
For bugs in the cache, which stores recently accessed data for more rapid access. Includes the disk cache, memory cache, and all cache preferences.

Examples of appropriate bugs: Implement compression of network cache data; or Implement partial HTTP caching.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=Networking%3A%20Cache&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=Networking%3A%20Cache&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=Networking%3A%20Cache)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

x86

Windows XP

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

critical

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla10

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| a11y-review | --- |
| --- | --- |
| Webcompat Score | --- |
| Performance Impact | --- |
| Accessibility Severity | --- |
| Webcompat Priority | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox6 | [-](/buglist.cgi?f1=cf_tracking_firefox6&o1=equals&v1=-) | [wontfix](/buglist.cgi?f1=cf_status_firefox6&o1=equals&v1=wontfix) |
| firefox7 | [-](/buglist.cgi?f1=cf_tracking_firefox7&o1=equals&v1=-) | [wontfix](/buglist.cgi?f1=cf_status_firefox7&o1=equals&v1=wontfix) |
| firefox8 | [+](/buglist.cgi?f1=cf_tracking_firefox8&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox8&o1=equals&v1=fixed) |
| firefox9 | [+](/buglist.cgi?f1=cf_tracking_firefox9&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=fixed) |
| firefox10 | [+](/buglist.cgi?f1=cf_tracking_firefox10&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=fixed) |
| status1.9.2 | --- | [unaffected](/buglist.cgi?f1=cf_status_192&o1=equals&v1=unaffected) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox6 | - | wontfix |
| firefox7 | - | wontfix |
| firefox8 | + | fixed |
| firefox9 | + | fixed |
| firefox10 | + | fixed |
| status1.9.2 |  | unaffected |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: rh01, Assigned: michal)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/0299ccf6cbed3f86e2a9316f177739a8?d=mm&size=40)  [michal](/user_profile?user_id=268625)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/becec868016e8df713e813d54f845b27?d=mm&size=40)  [rh01](/user_profile?user_id=410033)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/608e04ebca94be52b05c003d51d43e07?d=mm&size=40)  [kershaw](/user_profile?user_id=505624)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

8 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: reporter-external, Whiteboard: [sg:critical][oom][qa?])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

CVE-2011-3652

[Keywords:](/describekeywords.cgi)

[reporter-external](/buglist.cgi?keywords=reporter-external&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[sg:critical][oom][qa?]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [rforbes](/user_profile?user_id=411311) | [sec-bounty](#a59724098_411311 "12 years ago") | + |
| --- | --- | --- |
| [rforbes](/user_profile?user_id=411311) | sec-bounty | + |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |
|  | qe-verify |  |

## Crash Data

Signature:

[[@ memcpy | nsAString\_internal::Assign(unsigned short const\*, unsigned int) ]](https://crash-stats.mozilla.org/signature/?signature=memcpy%20%7C%20nsAString_internal%3A%3AAssign%28unsigned%20short%20const%2A%2C%20unsigned%20int%29)

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (2 files)

| [testcase to crash Firefox 6](/attachment.cgi?id=556407)  [13 years ago](#c0)  [Rh0](/user_profile?user_id=410033)   372 bytes, text/html |  | [Details](/attachment.cgi?id=556407&action=edit) |
| --- | --- | --- |
| [fix](/attachment.cgi?id=563014)  [13 years ago](#c4)  [Michal Novotny [:michal]](/user_profile?user_id=268625)   1.65 KB, patch | jst : [review+](#c6 "13 years ago")  jaas : [superreview+](#a2769693_18821 "13 years ago")  blizzard : [approval-mozilla-aurora+](#c12 "13 years ago")  blizzard : [approval-mozilla-beta+](#c12 "13 years ago") | [Details](/attachment.cgi?id=563014&action=edit) | [Diff](/attachment.cgi?id=563014&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=682727&attachment=563014) |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Rh0](/user_profile?user_id=410033)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=682727#c0)• 13 years ago |
|  | |

Attached file
[testcase to crash Firefox 6](attachment.cgi?id=556407)
— [Details](attachment.cgi?id=556407&action=edit)

When running the attached testcase on a native WinXP SP3 installation (not in VirtualBox)with Firefox 6, it crashes during a datamove at memcpy in method nsAString\_internal::Assign(unsigned short const\*, unsigned int).
Crash IDs:
[bp-61c8c0ae-0b67-4063-bd2b-906392110828](https://crash-stats.mozilla.org/report/index/61c8c0ae-0b67-4063-bd2b-906392110828)
[bp-5534e024-7733-42bd-a565-464ce2110828](https://crash-stats.mozilla.org/report/index/5534e024-7733-42bd-a565-464ce2110828)
WinDBG states this as Probably Exploitable. This memcpy crash seems similar to the one in [bug 505305](/show_bug.cgi?id=505305 "RESOLVED FIXED - Probably Exploitable - Read Access Violation on Block Data Move starting at MSVCR80D!memcpy+0x000000000000005a") ([sg:critical?]). The testcase is based on the testcase of [bug 651990](/show_bug.cgi?id=651990 "RESOLVED FIXED - Investigate crash [@ js_TraceScript]").
Steps to reproduce:
1. Open testcase in Fx6
2. Click the button
Greetings,
Rh0

|  | [Rh0](/user_profile?user_id=410033)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=682727#a195_410033)• 13 years ago |

Crash Signature: bp-61c8c0ae-0b67-4063-bd2b-906392110828
bp-5534e024-7733-42bd-a565-464ce2110828

|  | [Bob Clary [:bc] (inactive)](/user_profile?user_id=23402) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=682727#a1866_23402)• 13 years ago |

Crash Signature: bp-61c8c0ae-0b67-4063-bd2b-906392110828
bp-5534e024-7733-42bd-a565-464ce2110828 → [@ memcpy | nsAString\_internal::Assign(unsigned short const\*, unsigned int) ]

|  | [Bob Clary [:bc] (inactive)](/user_profile?user_id=23402) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=682727#a1909_23402)• 13 years ago |

[Attachment #556407](/attachment.cgi?id=556407&action=edit "testcase to crash Firefox 6") -
Attachment mime type: text/plain → text/html

|  | [Bob Clary [:bc] (inactive)](/user_profile?user_id=23402) |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=682727#c1)• 13 years ago |
|  | |

WinXP w/1G ram
Debug Nightly/Aurora/Beta crashed but MSVC was unable to capture the crash.
Beta/7
[bp-8541ebe3-25e1-4b5e-896c-59ea42110828](https://crash-stats.mozilla.org/report/index/8541ebe3-25e1-4b5e-896c-59ea42110828) (no signature)
Aurora/8
[bp-731b301b-ada4-45ff-9bd8-2af542110828](https://crash-stats.mozilla.org/report/index/731b301b-ada4-45ff-9bd8-2af542110828)
[@ nsAString\_internal::Assign(nsAString\_internal const&) ]
Nightly/9
[bp-66d68216-8e2e-4b84-8a47-cdcce2110828](https://crash-stats.mozilla.org/report/index/66d68216-8e2e-4b84-8a47-cdcce2110828)
[@ memcpy | nsAString\_internal::Assign(wchar\_t const\*, unsigned int) ]Status: UNCONFIRMED → NEW
[status-firefox6](/buglist.cgi?f1=cf_status_firefox6&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox6&o1=equals&v1=affected)
[status-firefox7](/buglist.cgi?f1=cf_status_firefox7&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox7&o1=equals&v1=affected)
[status-firefox8](/buglist.cgi?f1=cf_status_firefox8&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox8&o1=equals&v1=affected)
[status-firefox9](/buglist.cgi?f1=cf_status_firefox9&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=affected)Ever confirmed: trueVersion: 6 Branch → Trunk

|  | [Bob Clary [:bc] (inactive)](/user_profile?user_id=23402) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=682727#a5764_23402)• 13 years ago |

Component: General → Networking: CacheProduct: Firefox → CoreQA Contact: general → networking.cacheWhiteboard: [sg:critical?]

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=682727#c3)• 13 years ago |
|  | |

Not realistic to squeeze into Firefox 7, targeting the next release.Assignee: nobody → michal.novotny
[tracking-firefox6](/buglist.cgi?f1=cf_tracking_firefox6&o1=isnotempty):
--- → [-](/buglist.cgi?f1=cf_tracking_firefox6&o1=equals&v1=-)
[tracking-firefox7](/buglist.cgi?f1=cf_tracking_firefox7&o1=isnotempty):
--- → [-](/buglist.cgi?f1=cf_tracking_firefox7&o1=equals&v1=-)
[tracking-firefox8](/buglist.cgi?f1=cf_tracking_firefox8&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox8&o1=equals&v1=%2B)
[tracking-firefox9](/buglist.cgi?f1=cf_tracking_firefox9&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox9&o1=equals&v1=%2B)

|  | [Josh Aas](/user_profile?user_id=18821) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=682727#a1584412_18821)• 13 years ago |

Whiteboard: [sg:critical?] → [sg:critical]

|  | [Michal Novotny [:michal]](/user_profile?user_id=268625)  Assignee |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=682727#c4)• 13 years ago |
|  | |

Attached patch

[fix](attachment.cgi?id=563014&action=diff)
— [Details](attachment.cgi?id=563014&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=682727&attachment=563014)

The problem is that the allocation of the buffer fails while flattening the string at <http://hg.mozilla.org/mozilla-central/annotate/7f4867717226/js/src/vm/String.cpp#l207> but we don't set mValid=false in xpc\_qsDOMString/xpc\_qsAUTF8String.
[Attachment #563014](/attachment.cgi?id=563014&action=edit "fix") -
Flags: review?(jst)

|  | [Michal Novotny [:michal]](/user_profile?user_id=268625)  Assignee |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=682727#c5)• 13 years ago |
|  | |

Pushed to tryserver <https://tbpl.mozilla.org/?tree=Try&usebuildbot=1&rev=d78227785476>

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=682727#c6)• 13 years ago |
|  | |

Comment on [attachment 563014](/attachment.cgi?id=563014 "fix") [[details]](/attachment.cgi?id=563014&action=edit "fix") [[diff]](/attachment.cgi?id=563014&action=diff "fix") [[review]](/page.cgi?id=splinter.html&ignore=&bug=682727&attachment=563014)
fix
Good find, Michal! r=jst
[Attachment #563014](/attachment.cgi?id=563014&action=edit "fix") -
Flags: review?(jst) → review+

|  | [Michal Novotny [:michal]](/user_profile?user_id=268625)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=682727#a2726971_268625)• 13 years ago |

[Attachment #563014](/attachment.cgi?id=563014&action=edit "fix") -
Flags: superreview?(joshmoz)

|  | [Josh Aas](/user_profile?user_id=18821) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=682727#c7)• 13 years ago |
|  | |

Comment on [attachment 563014](/attachment.cgi?id=563014 "fix") [[details]](/attachment.cgi?id=563014&action=edit "fix") [[diff]](/attachment.cgi?id=563014&action=diff "fix") [[review]](/page.cgi?id=splinter.html&ignore=&bug=682727&attachment=563014)
fix
> JSString \*s = InitOrStringify<traits>(cx, v, pval, nullBehavior,
> undefinedBehavior);
> if (!s)
> return;
...
> JSString \*s = InitOrStringify<traits>(cx, v, pval, eNull, eNull);
> if (!s)
> return;
I don't know this code at all but I want to make sure we don't also need to set mValid to JS\_FALSE in the early returns prior to the ones you patched.

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=682727#c8)• 13 years ago |
|  | |

InitOrStringify() already set mValid to false in all error cases, so don't need to set it again in those cases.

|  | [Josh Aas](/user_profile?user_id=18821) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=682727#a2769693_18821)• 13 years ago |

[Attachment #563014](/attachment.cgi?id=563014&action=edit "fix") -
Flags: superreview?(joshmoz) → superreview+

|  | [Michal Novotny [:michal]](/user_profile?user_id=268625)  Assignee |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=682727#c9)• 13 years ago |
|  | |

<http://hg.mozilla.org/integration/mozilla-inbound/rev/dd0cc50e9fe6>Whiteboard: [sg:critical] → [sg:critical] [inbound]Target Milestone: --- → mozilla10

|  | [Jesse Ruderman](/user_profile?user_id=11608) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=682727#c10)• 13 years ago |
|  | |

<http://hg.mozilla.org/mozilla-central/rev/dd0cc50e9fe6>Status: NEW → RESOLVEDClosed: 13 years agoResolution: --- → FIXEDWhiteboard: [sg:critical] [inbound] → [sg:critical][oom]

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=682727#a3378528_12352)• 13 years ago |

[Attachment #563014](/attachment.cgi?id=563014&action=edit "fix") -
Flags: approval-mozilla-beta?
[Attachment #563014](/attachment.cgi?id=563014&action=edit "fix") -
Flags: approval-mozilla-aurora?

|  | [Marcia Knous [:marcia]](/user_profile?user_id=8519) |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=682727#c11)• 13 years ago |
|  | |

I tried verifying this in a Win XP VM and on a Win 7 machine using Mozilla/5.0 (Windows NT 6.1; rv:10.0a1) Gecko/20111006 Firefox/10.0a1, but in both cases Firefox stops responding but no crash reporter comes up.

|  | [Christopher Blizzard (:blizzard)](/user_profile?user_id=14701) |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=682727#c12)• 13 years ago |
|  | |

Comment on [attachment 563014](/attachment.cgi?id=563014 "fix") [[details]](/attachment.cgi?id=563014&action=edit "fix") [[diff]](/attachment.cgi?id=563014&action=diff "fix") [[review]](/page.cgi?id=splinter.html&ignore=&bug=682727&attachment=563014)
fix
Approved for Aurora (Update 9) and Beta (Update 8). Please land as soon as appropriate.
[Attachment #563014](/attachment.cgi?id=563014&action=edit "fix") -
Flags: approval-mozilla-beta?
[Attachment #563014](/attachment.cgi?id=563014&action=edit "fix") -
Flags: approval-mozilla-beta+
[Attachment #563014](/attachment.cgi?id=563014&action=edit "fix") -
Flags: approval-mozilla-aurora?
[Attachment #563014](/attachment.cgi?id=563014&action=edit "fix") -
Flags: approval-mozilla-aurora+

|  | [Rh0](/user_profile?user_id=410033)  Reporter |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=682727#c13)• 13 years ago |
|  | |

To [comment 11](/show_bug.cgi?id=682727#c11 "RESOLVED FIXED - Crash during datamove (ACCESS VIOLATION READ) [@ memcpy | nsAString_internal::Assign(unsigned short const*, unsigned int)]") :
Using XP and Firefox 6 in my testings, the crash appeared only on native installations of XP and not in VMs running in VirtualBox.

|  | [Marcia Knous [:marcia]](/user_profile?user_id=8519) |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=682727#c14)• 13 years ago |
|  | |

I used both a VM and real hardware to test, and got the same result - the nightly stopped responding. So it does not seem that the patch really fixes the issue unless I am misunderstanding something.
(In reply to Rh0 from [comment #13](/show_bug.cgi?id=682727#c13 "RESOLVED FIXED - Crash during datamove (ACCESS VIOLATION READ) [@ memcpy | nsAString_internal::Assign(unsigned short const*, unsigned int)]"))
> To [comment 11](/show_bug.cgi?id=682727#c11 "RESOLVED FIXED - Crash during datamove (ACCESS VIOLATION READ) [@ memcpy | nsAString_internal::Assign(unsigned short const*, unsigned int)]") :
> Using XP and Firefox 6 in my testings, the crash appeared only on native
> installations of XP and not in VMs running in VirtualBox.

|  | [Marcia Knous [:marcia]](/user_profile?user_id=8519) |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=682727#c15)• 13 years ago |
|  | |

I don't have access to Win hardware at the moment, so I would prefer if we could hold off checking this in until QA can do some more testing on Windows hardware in the lab. Thanks.

|  | [juan becerra [:juanb]](/user_profile?user_id=241759) |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=682727#c16)• 13 years ago |
|  | |

I tried reproducing this problem on Fx5, 7.0.1, and the most recent Nightly on a Win7 machine. In all three the testcase crashes the application. It takes a while, but they all crash.
When I try to look at the crash reports, they can't be found: [bp-1dbea091-1abf-448b-8fbb-313ad2111006](https://crash-stats.mozilla.org/report/index/1dbea091-1abf-448b-8fbb-313ad2111006)
It could be that this is now crashing in a different place, but without seeing the crash signature I can't tell. I'll re-open as soon as the crash report shows up, or after consulting with someone in the security team.

|  | [Marcia Knous [:marcia]](/user_profile?user_id=8519) |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=682727#c17)• 13 years ago |
|  | |

I was able to crash again, but I get a different signature:
<https://crash-stats.mozilla.com/report/index/bp-29f53417-90cb-44c6-9459-c185f2111007>
Should I file new bug for this crash and should it be security sensitive?

|  | [Michal Novotny [:michal]](/user_profile?user_id=268625)  Assignee |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=682727#c18)• 13 years ago |
|  | |

(In reply to Marcia Knous [:marcia] from [comment #17](/show_bug.cgi?id=682727#c17 "RESOLVED FIXED - Crash during datamove (ACCESS VIOLATION READ) [@ memcpy | nsAString_internal::Assign(unsigned short const*, unsigned int)]"))
> I was able to crash again, but I get a different signature:
> <https://crash-stats.mozilla.com/report/index/bp-29f53417-90cb-44c6-9459>-
> c185f2111007
>
> Should I file new bug for this crash and should it be security sensitive?
No, this is an intentional crash in OOM situation.

|  | [Rh0](/user_profile?user_id=410033)  Reporter |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=682727#c19)• 13 years ago |
|  | |

(In reply to juan becerra [:juanb] from [comment #16](/show_bug.cgi?id=682727#c16 "RESOLVED FIXED - Crash during datamove (ACCESS VIOLATION READ) [@ memcpy | nsAString_internal::Assign(unsigned short const*, unsigned int)]"))
> I tried reproducing this problem on Fx5, 7.0.1, and the most recent Nightly
> on a Win7 machine. In all three the testcase crashes the application. It
> takes a while, but they all crash.
>
> When I try to look at the crash reports, they can't be found:
> [bp-1dbea091-1abf-448b-8fbb-313ad2111006](https://crash-stats.mozilla.org/report/index/1dbea091-1abf-448b-8fbb-313ad2111006)
>
> It could be that this is now crashing in a different place, but without
> seeing the crash signature I can't tell. I'll re-open as soon as the crash
> report shows up, or after consulting with someone in the security team.
With Fx7.0.1 in WinXP/2GB RAM running in the latest VirtualBox (4.1.4), I get the crash at memcpy:
[bp-4ec14c4f-b56e-4e44-b194-520422111007](https://crash-stats.mozilla.org/report/index/4ec14c4f-b56e-4e44-b194-520422111007)
but also another one ( [@ js\_NextActiveContext(JSRuntime\*, JSContext\*)] ):
[bp-6015acf5-0c04-467a-88ad-365f82111007](https://crash-stats.mozilla.org/report/index/6015acf5-0c04-467a-88ad-365f82111007)
Fx10.0a1 crashes as well, but I cannot get a signature, too:
[bp-3f3d522c-282d-4f15-a872-f07152111007](https://crash-stats.mozilla.org/report/index/3f3d522c-282d-4f15-a872-f07152111007)
In this case Firefox can be started in WinDBG (Windows Debugger) to check the crash. In my case I get for Fx10.0a1 this exception:
(f60.e58): Break instruction exception - code 80000003 (first chance)
eax=00000000 ebx=7d929740 ecx=7817a4c8 edx=781c3c70 esi=7813e457 edi=7817a392
eip=00a8193d esp=001275b8 ebp=7f9f9470 iopl=0 nv up ei pl nz na pe nc
cs=001b ss=0023 ds=0023 es=0023 fs=003b gs=0000 efl=00000206
mozalloc!mozalloc\_abort+0x2b:
00a8193d cc int 3
And this call stack (obtained with command "kc 10" in WinDBG):
mozalloc!mozalloc\_abort
mozalloc!mozalloc\_handle\_oom
xul!nsTArray\_base<nsTArrayDefaultAllocator>::EnsureCapacity
xul!gfxTextRun::CopyGlyphDataFrom
xul!TextRunWordCache::LookupWord
xul!TextRunWordCache::MakeTextRun
xul!MakeTextRun
xul!BuildTextRunsScanner::BuildTextRunForFrames
xul!BuildTextRunsScanner::FlushFrames
xul!BuildTextRuns
xul!nsIFrame::InvalidateInternal
xul!nsIFrame::InvalidateInternal
xul!nsIFrame::InvalidateInternal
xul!nsBlockFrame::InvalidateInternal
xul!nsLayoutUtils::IntrinsicForContainer
xul!nsTableCellFrame::GetMinWidth
I think this a crash/break on purpose due to OOM.

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=682727#c20)• 13 years ago |
|  | |

<https://hg.mozilla.org/releases/mozilla-aurora/rev/433458808fbe>
<https://hg.mozilla.org/releases/mozilla-beta/rev/890a66b91702>
[status-firefox10](/buglist.cgi?f1=cf_status_firefox10&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=fixed)
[status-firefox6](/buglist.cgi?f1=cf_status_firefox6&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox6&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox6&o1=equals&v1=wontfix)
[status-firefox7](/buglist.cgi?f1=cf_status_firefox7&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox7&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox7&o1=equals&v1=wontfix)
[status-firefox8](/buglist.cgi?f1=cf_status_firefox8&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox8&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox8&o1=equals&v1=fixed)
[status-firefox9](/buglist.cgi?f1=cf_status_firefox9&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=fixed)
[tracking-firefox10](/buglist.cgi?f1=cf_tracking_firefox10&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox10&o1=equals&v1=%2B)

|  | [u279076](/user_profile?user_id=279076) |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=682727#c21)• 13 years ago |
|  | |

Is the attached testcase only usable in a debug build? Can QA verify this fix on a "normal" build?Whiteboard: [sg:critical][oom] → [sg:critical][oom][qa?]

|  | [Michal Novotny [:michal]](/user_profile?user_id=268625)  Assignee |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=682727#c22)• 13 years ago |
|  | |

(In reply to Anthony Hughes, Mozilla QA (irc: ashughes) from [comment #21](/show_bug.cgi?id=682727#c21 "RESOLVED FIXED - Crash during datamove (ACCESS VIOLATION READ) [@ memcpy | nsAString_internal::Assign(unsigned short const*, unsigned int)]"))
> Is the attached testcase only usable in a debug build? Can QA verify this
> fix on a "normal" build?
Yes, and even with debug build the crash is not 100% reproducible. It depends on what is in the uninitialized buffer and if GC runs during the test.

|  | [u279076](/user_profile?user_id=279076) |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=682727#c23)• 13 years ago |
|  | |

I assume "yes" refers to whether or not this needs a debug build. Based on [comment 22](/show_bug.cgi?id=682727#c22 "RESOLVED FIXED - Crash during datamove (ACCESS VIOLATION READ) [@ memcpy | nsAString_internal::Assign(unsigned short const*, unsigned int)]"), I don't see how QA will be able to reliable verify this fix.

|  | [Michal Novotny [:michal]](/user_profile?user_id=268625)  Assignee |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=682727#c24)• 13 years ago |
|  | |

Branch 1.9.2 isn't affected and doesn't need this patch. Member variable mValid seems to be set correctly in all 3 classes (xpc\_qsDOMString, xpc\_qsAString, xpc\_qsACString).
[status1.9.2](/buglist.cgi?f1=cf_status_192&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_192&o1=equals&v1=unaffected)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=682727#a6179147_1689)• 13 years ago |

Alias: CVE-2011-3652

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=682727#a12446132_1689)• 13 years ago |

Group: core-security

|  | [Raymond Forbes[:rforbes]](/user_profile?user_id=411311) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=682727#a59724098_411311)• 12 years ago |

Flags: sec-bounty+

|  | [David Lawrence [:dkl]](/user_profile?user_id=5898) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=682727#a402468390_5898)• 8 months ago |

Keywords: [reporter-external](/buglist.cgi?keywords=reporter-external&resolution=---)
You need to [log in](/show_bug.cgi?id=682727&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Rh0](/user_profile?user_id=410033)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from bugzilla.mozilla.org_8a81e3fe_20250125_045800.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/676918)
* [XML](/show_bug.cgi?ctype=xml&id=676918)

Closed
[Bug 676918](/show_bug.cgi?id=676918)

Opened 13 years ago
Closed 13 years ago

# [ANGLE] crash from CanvasLayerD3D9::UpdateSurface [@ gl::Context::readPixels(int, int, int, int, unsigned int, unsigned int, void\*) ]

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

[ANGLE] crash from CanvasLayerD3D9::UpdateSurface [@ gl::Context::readPixels(int, int, int, int, unsigned int, unsigned int, void\*) ]

## Categories

### (Core :: Graphics: CanvasWebGL, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=Graphics%3A%20CanvasWebGL#Graphics%3A%20CanvasWebGL)

Graphics: CanvasWebGL
▾

Core :: Graphics: CanvasWebGL
Bugs with the WebGL Canvas Context.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=Graphics%3A%20CanvasWebGL&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=Graphics%3A%20CanvasWebGL&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=Graphics%3A%20CanvasWebGL)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

unspecified

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

x86

Windows XP

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

normal

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla8

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| a11y-review | --- |
| --- | --- |
| Accessibility Severity | --- |
| Webcompat Score | --- |
| Performance Impact | --- |
| Webcompat Priority | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox7 | [-](/buglist.cgi?f1=cf_tracking_firefox7&o1=equals&v1=-) | [wontfix](/buglist.cgi?f1=cf_status_firefox7&o1=equals&v1=wontfix) |
| firefox8 | [+](/buglist.cgi?f1=cf_tracking_firefox8&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox8&o1=equals&v1=fixed) |
| firefox9 | [+](/buglist.cgi?f1=cf_tracking_firefox9&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=fixed) |
| firefox10 | [+](/buglist.cgi?f1=cf_tracking_firefox10&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=fixed) |
| status1.9.2 | --- | [unaffected](/buglist.cgi?f1=cf_status_192&o1=equals&v1=unaffected) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox7 | - | wontfix |
| firefox8 | + | fixed |
| firefox9 | + | fixed |
| firefox10 | + | fixed |
| status1.9.2 |  | unaffected |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: bjacob, Unassigned)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

*Unassigned*

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/8f64ddf291d83cdc891c05ee5d5cc5dc?d=mm&size=40)  [bjacob](/user_profile?user_id=382769)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/ca6a57abf052ac63d917d5dae1cc0f00?d=mm&size=40)  [jgilbert](/user_profile?user_id=419431)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

5 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

[code.google.com/p/angleproject/issues...](http://code.google.com/p/angleproject/issues/detail?id=194 "http://code.google.com/p/angleproject/issues/detail?id=194")

## Details

### (Keywords: crash, Whiteboard: [sg:high?][qa?])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[crash](/buglist.cgi?keywords=crash&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[sg:high?][qa?]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=676918#c0)• 13 years ago |
|  | |

I got this following the STR from [bug 675634](/show_bug.cgi?id=675634 "RESOLVED WORKSFORME - Firefox crashes while on a page that uses WebGL [@ gl::VertexDataConverter<float, gl::WidenRule<int, 2>, gl::ConversionRule<int, 0, int>, gl::DefaultVertexValues<float, int> >::convertArray(void const*, unsigned int, unsigned int, void*) ]"), having locked my screen as suggested in [bug 675634 comment 7](/show_bug.cgi?id=675634#c7 "RESOLVED WORKSFORME - Firefox crashes while on a page that uses WebGL [@ gl::VertexDataConverter<float, gl::WidenRule<int, 2>, gl::ConversionRule<int, 0, int>, gl::DefaultVertexValues<float, int> >::convertArray(void const*, unsigned int, unsigned int, void*) ]"). The crash occured some time after unlocking. Instead of getting [bug 675634](/show_bug.cgi?id=675634 "RESOLVED WORKSFORME - Firefox crashes while on a page that uses WebGL [@ gl::VertexDataConverter<float, gl::WidenRule<int, 2>, gl::ConversionRule<int, 0, int>, gl::DefaultVertexValues<float, int> >::convertArray(void const*, unsigned int, unsigned int, void*) ]"), I got this new one.
Crash link:
<https://crash-stats.mozilla.com/report/index/bp-b97104c7-6074-4ff8-b13f-f33742110805>
Crash Reason EXCEPTION\_ACCESS\_VIOLATION\_READ
Crash Address 0xffffffffc2782607
0 libGLESv2.dll gl::Context::readPixels gfx/angle/src/libglesv2/Context.cpp:2128
1 libGLESv2.dll glReadPixels gfx/angle/src/libglesv2/libGLESv2.cpp:3956
2 xul.dll mozilla::gl::GLContext::ReadPixelsIntoImageSurface gfx/thebes/GLContext.cpp:1223
3 xul.dll mozilla::layers::CanvasLayerD3D9::UpdateSurface gfx/layers/d3d9/CanvasLayerD3D9.cpp:131
4 xul.dll mozilla::layers::CanvasLayerD3D9::RenderLayer gfx/layers/d3d9/CanvasLayerD3D9.cpp:211
The crash line is:
<http://hg.mozilla.org/releases/mozilla-beta/file/f327eb465d32/gfx/angle/src/libGLESv2/Context.cpp#l2128>
2109 IDirect3DSurface9 \*systemSurface;
2110 HRESULT result = device->CreateOffscreenPlainSurface(desc.Width, desc.Height, desc.Format, D3DPOOL\_SYSTEMMEM, &systemSurface, NULL);
2111
2112 if (result == D3DERR\_OUTOFVIDEOMEMORY || result == E\_OUTOFMEMORY)
2113 {
2114 return error(GL\_OUT\_OF\_MEMORY);
2115 }
2116
2117 ASSERT(SUCCEEDED(result));
2118
2119 if (desc.MultiSampleType != D3DMULTISAMPLE\_NONE)
2120 {
2121 UNIMPLEMENTED(); // FIXME: Requires resolve using StretchRect into non-multisampled render target
2122 }
2123
2124 result = device->GetRenderTargetData(renderTarget, systemSurface);
2125
2126 if (FAILED(result))
2127 {
2128 systemSurface->Release(); ////// <--- CRASH HERE
So maybe we need to check that CreateOffscreenPlainSurface succeeded?

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Reporter |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=676918#c1)• 13 years ago |
|  | |

Filed <http://code.google.com/p/angleproject/issues/detail?id=194>

|  | [daniel-bzmz](/user_profile?user_id=404905) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=676918#c2)• 13 years ago |
|  | |

Checks improved in ANGLE r719.

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=676918#c3)• 13 years ago |
|  | |

Not sure of the severity here, potentially reading data off other pages/tabs you have open?Keywords: [crash](/buglist.cgi?keywords=crash&resolution=---)See Also: → <http://code.google.com/p/angleproject/issues/detail?id=194>Whiteboard: [sg:high?]

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Reporter |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=676918#c4)• 13 years ago |
|  | |

Maybe, yes. Though for that you would have to trigger this bug without crashing. Will import ANGLE r719.

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Reporter |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=676918#c5)• 13 years ago |
|  | |

Imported ANGLE r719:
<http://hg.mozilla.org/mozilla-central/rev/ddf7263c56d7>Status: NEW → RESOLVEDClosed: 13 years agoResolution: --- → FIXED

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=676918#a5964659_12352)• 13 years ago |

[status-firefox10](/buglist.cgi?f1=cf_status_firefox10&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=fixed)
[status-firefox7](/buglist.cgi?f1=cf_status_firefox7&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox7&o1=equals&v1=wontfix)
[status-firefox8](/buglist.cgi?f1=cf_status_firefox8&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox8&o1=equals&v1=fixed)
[status-firefox9](/buglist.cgi?f1=cf_status_firefox9&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=fixed)
[tracking-firefox10](/buglist.cgi?f1=cf_tracking_firefox10&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox10&o1=equals&v1=%2B)
[tracking-firefox7](/buglist.cgi?f1=cf_tracking_firefox7&o1=isnotempty):
--- → [-](/buglist.cgi?f1=cf_tracking_firefox7&o1=equals&v1=-)
[tracking-firefox8](/buglist.cgi?f1=cf_tracking_firefox8&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox8&o1=equals&v1=%2B)
[tracking-firefox9](/buglist.cgi?f1=cf_tracking_firefox9&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox9&o1=equals&v1=%2B)Target Milestone: --- → mozilla8

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=676918#a6495362_1689)• 13 years ago |

[status1.9.2](/buglist.cgi?f1=cf_status_192&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_192&o1=equals&v1=unaffected)

|  | [u279076](/user_profile?user_id=279076) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=676918#c6)• 13 years ago |
|  | |

How widespread/reproducible is this crash? Is there something QA can do to verify the fix?Whiteboard: [sg:high?] → [sg:high?][qa?]

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=676918#a14426739_1689)• 13 years ago |

Group: core-security
You need to [log in](/show_bug.cgi?id=676918&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑



=== Content from bugzilla.mozilla.org_221bd634_20250125_045803.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/679593)
* [XML](/show_bug.cgi?ctype=xml&id=679593)

Closed
[Bug 679593](/show_bug.cgi?id=679593)

Opened 13 years ago
Closed 13 years ago

# Possible JSScript double-free

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Possible JSScript double-free

## Categories

### (Core :: JavaScript Engine, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=JavaScript%20Engine#JavaScript%20Engine)

JavaScript Engine
▾

Core :: JavaScript Engine
The interpreter engine for the core JavaScript language, independent of the browser's object model. File ONLY core JavaScript language bugs in this category. For bugs involving browser objects such as "window" and "document", use the "DOM" component. For bugs involving calls between JavaScript and C++, use the "XPConnect" component.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=JavaScript%20Engine&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=JavaScript%20Engine&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=JavaScript%20Engine)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

All

All

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

normal

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

---

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Webcompat Priority | --- |
| --- | --- |
| Webcompat Score | --- |
| Performance Impact | --- |
| a11y-review | --- |
| Accessibility Severity | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox5 | [-](/buglist.cgi?f1=cf_tracking_firefox5&o1=equals&v1=-) | [wontfix](/buglist.cgi?f1=cf_status_firefox5&o1=equals&v1=wontfix) |
| firefox6 | [-](/buglist.cgi?f1=cf_tracking_firefox6&o1=equals&v1=-) | [wontfix](/buglist.cgi?f1=cf_status_firefox6&o1=equals&v1=wontfix) |
| firefox7 | [-](/buglist.cgi?f1=cf_tracking_firefox7&o1=equals&v1=-) | [wontfix](/buglist.cgi?f1=cf_status_firefox7&o1=equals&v1=wontfix) |
| firefox8 | [+](/buglist.cgi?f1=cf_tracking_firefox8&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox8&o1=equals&v1=fixed) |
| firefox9 | [+](/buglist.cgi?f1=cf_tracking_firefox9&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=fixed) |
| status1.9.2 | --- | [unaffected](/buglist.cgi?f1=cf_status_192&o1=equals&v1=unaffected) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox5 | - | wontfix |
| firefox6 | - | wontfix |
| firefox7 | - | wontfix |
| firefox8 | + | fixed |
| firefox9 | + | fixed |
| status1.9.2 |  | unaffected |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: billm, Assigned: billm)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/81db2831554209472ec9b0d5485ca1c9?d=mm&size=40)  [billm](/user_profile?user_id=389993)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/81db2831554209472ec9b0d5485ca1c9?d=mm&size=40)  [billm](/user_profile?user_id=389993)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/4fe52ee1503aecf7b6c976b8eb7c1753?d=mm&size=40)  [willyelm](/user_profile?user_id=714609)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

5 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Whiteboard: [sg:critical?], wanted-standalone-js [qa-])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

---

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[sg:critical?], wanted-standalone-js [qa-]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (1 file)

| [fix](/attachment.cgi?id=554933)  [13 years ago](#c1)  [Bill McCloskey [inactive unless it's an emergency] (:billm)](/user_profile?user_id=389993)   874 bytes, patch | dmandelin : [review+](#a489747_294323 "13 years ago")  asa : [approval-mozilla-aurora+](#a754355_5003 "13 years ago")  asa : [approval-mozilla-beta-](#a754355_5003 "13 years ago") | [Details](/attachment.cgi?id=554933&action=edit) | [Diff](/attachment.cgi?id=554933&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=679593&attachment=554933) |
| --- | --- | --- |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Bill McCloskey [inactive unless it's an emergency] (:billm)](/user_profile?user_id=389993)  Assignee |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=679593#c0)• 13 years ago |
|  | |

The problem is in js\_CloneFunctionObject. Consider the cross-compartment case where we're clonging |fun|. We create a new function |cfun| and do:
cfun->u = fun->getFunctionPrivate()->u;
For an interpreted script, this makes cfun->script() == fun->script(). Then we do
JSScript \*cscript = js\_CloneScript(cx, script);
and, after a null check on cscript, make |cfun->script() == cscript|.
Say that we fail to allocate cscript. Then we'll have two allocated function objects, in different compartments, pointing to the same script. This is bad because of the compartment thing and also because each function object finalizer will free the script, so it will be freed twice.

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=679593#a72761_1689)• 13 years ago |

Assignee: general → wmccloskeyWhiteboard: [sg:critical?]

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=679593#a145522_12352)• 13 years ago |

[status-firefox5](/buglist.cgi?f1=cf_status_firefox5&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox5&o1=equals&v1=wontfix)
[status-firefox6](/buglist.cgi?f1=cf_status_firefox6&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox6&o1=equals&v1=wontfix)
[status-firefox7](/buglist.cgi?f1=cf_status_firefox7&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox7&o1=equals&v1=affected)
[status-firefox8](/buglist.cgi?f1=cf_status_firefox8&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox8&o1=equals&v1=affected)
[status-firefox9](/buglist.cgi?f1=cf_status_firefox9&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=affected)
[tracking-firefox5](/buglist.cgi?f1=cf_tracking_firefox5&o1=isnotempty):
--- → [-](/buglist.cgi?f1=cf_tracking_firefox5&o1=equals&v1=-)
[tracking-firefox6](/buglist.cgi?f1=cf_tracking_firefox6&o1=isnotempty):
--- → [-](/buglist.cgi?f1=cf_tracking_firefox6&o1=equals&v1=-)
[tracking-firefox7](/buglist.cgi?f1=cf_tracking_firefox7&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox7&o1=equals&v1=%2B)
[tracking-firefox8](/buglist.cgi?f1=cf_tracking_firefox8&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox8&o1=equals&v1=%2B)
[tracking-firefox9](/buglist.cgi?f1=cf_tracking_firefox9&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox9&o1=equals&v1=%2B)

|  | [Bill McCloskey [inactive unless it's an emergency] (:billm)](/user_profile?user_id=389993)  Assignee |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=679593#c1)• 13 years ago |
|  | |

Attached patch

[fix](attachment.cgi?id=554933&action=diff)
— [Details](attachment.cgi?id=554933&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=679593&attachment=554933)

This was totally my fault. I changed this recently and it was a bad idea. This should fix it.
[Attachment #554933](/attachment.cgi?id=554933&action=edit "fix") -
Flags: review?(dmandelin)

|  | [David Mandelin [:dmandelin]](/user_profile?user_id=294323) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=679593#a489747_294323)• 13 years ago |

[Attachment #554933](/attachment.cgi?id=554933&action=edit "fix") -
Flags: review?(dmandelin) → review+

|  | [Bill McCloskey [inactive unless it's an emergency] (:billm)](/user_profile?user_id=389993)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=679593#a496228_389993)• 13 years ago |

Whiteboard: [sg:critical?] → [sg:critical?][inbound]

|  | [Mounir Lamouri (:mounir)](/user_profile?user_id=342786) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=679593#c2)• 13 years ago |
|  | |

<http://hg.mozilla.org/mozilla-central/rev/c8eea83232b2>Status: NEW → RESOLVEDClosed: 13 years agoOS: Linux → AllHardware: x86 → AllResolution: --- → FIXEDWhiteboard: [sg:critical?][inbound] → [sg:critical?]Version: unspecified → Trunk

|  | [Mounir Lamouri (:mounir)](/user_profile?user_id=342786) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=679593#a536021_342786)• 13 years ago |

[status-firefox9](/buglist.cgi?f1=cf_status_firefox9&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=fixed)

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=679593#c3)• 13 years ago |
|  | |

Is this patch good for aurora and beta? If so, please request approvals.

|  | [Bill McCloskey [inactive unless it's an emergency] (:billm)](/user_profile?user_id=389993)  Assignee |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=679593#c4)• 13 years ago |
|  | |

Comment on [attachment 554933](/attachment.cgi?id=554933 "fix") [[details]](/attachment.cgi?id=554933&action=edit "fix") [[diff]](/attachment.cgi?id=554933&action=diff "fix") [[review]](/page.cgi?id=splinter.html&ignore=&bug=679593&attachment=554933)
fix
There's a very slight possibility that this is broken in beta. It's definitely broken in aurora. I'm not sure how significant a problem this actually is, but it's unlikely to regress anything so we should probably get it in.
[Attachment #554933](/attachment.cgi?id=554933&action=edit "fix") -
Flags: approval-mozilla-beta?
[Attachment #554933](/attachment.cgi?id=554933&action=edit "fix") -
Flags: approval-mozilla-aurora?

|  | [Asa Dotzler [:asa]](/user_profile?user_id=5003) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=679593#a754355_5003)• 13 years ago |

[Attachment #554933](/attachment.cgi?id=554933&action=edit "fix") -
Flags: approval-mozilla-beta?
[Attachment #554933](/attachment.cgi?id=554933&action=edit "fix") -
Flags: approval-mozilla-beta-
[Attachment #554933](/attachment.cgi?id=554933&action=edit "fix") -
Flags: approval-mozilla-aurora?
[Attachment #554933](/attachment.cgi?id=554933&action=edit "fix") -
Flags: approval-mozilla-aurora+

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=679593#a1356363_12352)• 13 years ago |

[status-firefox7](/buglist.cgi?f1=cf_status_firefox7&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox7&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox7&o1=equals&v1=wontfix)
[tracking-firefox7](/buglist.cgi?f1=cf_tracking_firefox7&o1=isnotempty):
[+](/buglist.cgi?f1=cf_tracking_firefox7&o1=equals&v1=%2B) → [-](/buglist.cgi?f1=cf_tracking_firefox7&o1=equals&v1=-)

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=679593#c5)• 13 years ago |
|  | |

Bill, can you get this landed on aurora, we've only got a few days left!

|  | [Bill McCloskey [inactive unless it's an emergency] (:billm)](/user_profile?user_id=389993)  Assignee |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=679593#c6)• 13 years ago |
|  | |

Sorry, forgot about this.
<https://hg.mozilla.org/releases/mozilla-aurora/rev/391c8ebfa0a6>

|  | [Wesley W. Garland](/user_profile?user_id=122472) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=679593#a3403467_122472)• 13 years ago |

Whiteboard: [sg:critical?] → [sg:critical?], wanted-standalone-js

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=679593#c7)• 13 years ago |
|  | |

This landed in aurora before the most recent uplift, which means it's fixed for 8! Marking so.
[status-firefox8](/buglist.cgi?f1=cf_status_firefox8&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox8&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox8&o1=equals&v1=fixed)

|  | [u279076](/user_profile?user_id=279076) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=679593#c8)• 13 years ago |
|  | |

qa- as nothing to do for QA fix verification -- please set to qa+ if this is not the case.Whiteboard: [sg:critical?], wanted-standalone-js → [sg:critical?], wanted-standalone-js [qa-]

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=679593#c9)• 13 years ago |
|  | |

The 1.9.2 code is significantly different and there's no testcase, assuming 3.6.x is OK.
[status1.9.2](/buglist.cgi?f1=cf_status_192&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_192&o1=equals&v1=unaffected)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=679593#a13448600_1689)• 13 years ago |

Group: core-security
You need to [log in](/show_bug.cgi?id=679593&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Bill McCloskey [inactive unless it's an emergency] (:billm)](/user_profile?user_id=389993)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from bugzilla.mozilla.org_ae1f4e91_20250125_045802.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/677847)
* [XML](/show_bug.cgi?ctype=xml&id=677847)

Closed
[Bug 677847](/show_bug.cgi?id=677847)

Opened 13 years ago
Closed 13 years ago

# Crash [@ nsContentUtils::IsEventAttributeName ] at address 0x55555555 with malloc scribble

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Crash [@ nsContentUtils::IsEventAttributeName ] at address 0x55555555 with malloc scribble

## Categories

### (Core :: General, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=General#General)

General
▾

Core :: General
For bugs in Core which do not fit into other more specific Core components
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=General&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=General&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=General)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

x86

All

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

blocker

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla8

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Accessibility Severity | --- |
| --- | --- |
| a11y-review | --- |
| Performance Impact | --- |
| Webcompat Score | --- |
| Webcompat Priority | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox7 | --- | [unaffected](/buglist.cgi?f1=cf_status_firefox7&o1=equals&v1=unaffected) |
| firefox8 | [+](/buglist.cgi?f1=cf_tracking_firefox8&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox8&o1=equals&v1=fixed) |
| firefox9 | [+](/buglist.cgi?f1=cf_tracking_firefox9&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=fixed) |
| status1.9.2 | --- | [unaffected](/buglist.cgi?f1=cf_status_192&o1=equals&v1=unaffected) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox7 |  | unaffected |
| firefox8 | + | fixed |
| firefox9 | + | fixed |
| status1.9.2 |  | unaffected |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: bc, Assigned: smaug)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/056757eff6ed7c8ec26f61e3bf7695fe?d=mm&size=40)  [smaug](/user_profile?user_id=39966)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/ee4c7c6351b45c4655e16993a29979b0?d=mm&size=40)  [bc](/user_profile?user_id=23402)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/819fa8210bf0480993fed2d597565a52?d=mm&size=40)  [plawless](/user_profile?user_id=628136)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

9 people

## References

### ( [URL](http://vnexpress.net/RSS/GL/trang-chu.rss "http://vnexpress.net/RSS/GL/trang-chu.rss") )

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[482909](/show_bug.cgi?id=482909 "RESOLVED FIXED - [HTML5] Re-implement HTML sanitizer using the HTML5 parser")

Dependency [tree](/showdependencytree.cgi?id=677847&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=677847)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[vnexpress.net/RSS/GL/trang-chu.rss](http://vnexpress.net/RSS/GL/trang-chu.rss "http://vnexpress.net/RSS/GL/trang-chu.rss")

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (5 keywords, Whiteboard: [sg:critical?][qa!])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[crash](/buglist.cgi?keywords=crash&resolution=---),
[regression](/buglist.cgi?keywords=regression&resolution=---),
[reproducible](/buglist.cgi?keywords=reproducible&resolution=---),
[verified-aurora](/buglist.cgi?keywords=verified-aurora&resolution=---),
[verified-beta](/buglist.cgi?keywords=verified-beta&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[sg:critical?][qa!]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |
|  | qe-verify |  |

## Crash Data

Signature:

[[@ nsContentUtils::IsEventAttributeName ]](https://crash-stats.mozilla.org/signature/?signature=nsContentUtils%3A%3AIsEventAttributeName)

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (3 files)

| [stack](/attachment.cgi?id=552026)  [13 years ago](#c0)  [Bob Clary [:bc] (inactive)](/user_profile?user_id=23402)   17.40 KB, text/plain |  | [Details](/attachment.cgi?id=552026&action=edit) |
| --- | --- | --- |
| [linux valgrind log](/attachment.cgi?id=552031)  [13 years ago](#c2)  [Bob Clary [:bc] (inactive)](/user_profile?user_id=23402)   27.34 KB, text/plain |  | [Details](/attachment.cgi?id=552031&action=edit) |
| [patch](/attachment.cgi?id=552044)  [13 years ago](#c5)  [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966)   978 bytes, patch | jst : [review+](#c7 "13 years ago") | [Details](/attachment.cgi?id=552044&action=edit) | [Diff](/attachment.cgi?id=552044&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=677847&attachment=552044) |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Bob Clary [:bc] (inactive)](/user_profile?user_id=23402)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=677847#c0)• 13 years ago |
|  | |

Attached file
[stack](attachment.cgi?id=552026)
— [Details](attachment.cgi?id=552026&action=edit)

1. enable scribble on mac
2. <http://vnexpress.net/RSS/GL/trang-chu.rss>
or
[http://ax.itunes.apple.com/WebObjects/MZStoreServices.woa/ws/RSS/topsongs/limit=25/xml](http://ax.itunes.apple.com/WebObjects/MZStoreServices.woa/ws/RSS/topsongs/limit%3D25/xml)
Program received signal EXC\_BAD\_ACCESS, Could not access memory.
Reason: KERN\_INVALID\_ADDRESS at address: 0x55555555
0x054461ec in nsContentUtils::IsEventAttributeName (aName=0x25b84380, aType=1) at /work/mozilla/builds/nightly/mozilla/content/base/src/nsContentUtils.cpp:2919
2919 if (name[0] != 'o' || name[1] != 'n')
0x55 is deleted memory in scribble
[bug 675437](/show_bug.cgi?id=675437 "VERIFIED FIXED - crash nsContentUtils::IsEventAttributeName") supposedly fixed the crash.
Windows crashes with address 0xffffffffdddddddd (also deleted memory). I don't see this on Linux.

|  | [Bob Clary [:bc] (inactive)](/user_profile?user_id=23402)  Reporter |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=677847#c1)• 13 years ago |
|  | |

sorry, my linux workers are backed up building atm and haven't gotten to trying to reproduce these urls. I'll check them in a moment.

|  | [Bob Clary [:bc] (inactive)](/user_profile?user_id=23402)  Reporter |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=677847#c2)• 13 years ago |
|  | |

Attached file
[linux valgrind log](attachment.cgi?id=552031)
— [Details](attachment.cgi?id=552031&action=edit)

==2569== Invalid read of size 4
==2569== at 0x8E02B92: nsIAtom::GetUTF16String() (nsIAtom.h:53)
==2569== Invalid read of size 2
==2569== at 0x91E6343: nsContentUtils::IsEventAttributeName(nsIAtom\*, int) (nsContentUtils.cpp:2919)
==2569== Invalid read of size 4
==2569== at 0xA6DD6A0: js::MarkRangeConservatively(JSTracer\*, unsigned int const\*, unsigned int const\*) (jsgc.cpp:817)

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966)  Assignee |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=677847#c3)• 13 years ago |
|  | |

I think I see what the problem is - haven't even tried to reproduce this yet though.
Attribute has been removed from mAttrsAndChildren, and then we call
AfterSetAttr. Nothing guarantees that nsIAtom is still alive.
The normal rules say that caller must keep the object alive,
so in this case nsTreeSanitizer, but perhaps in this case UnsetAttr
could do it. Investigating.Assignee: nobody → Olli.Pettay

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966)  Assignee |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=677847#c4)• 13 years ago |
|  | |

I'm going to fix this the usual way: caller needs to keep atom alive.
I checked other callers of UnsetAttr and they are safe.
<http://mxr.mozilla.org/mozilla-central/source/content/xbl/src/nsXBLBinding.cpp#812>
looks very much like this.

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966)  Assignee |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=677847#c5)• 13 years ago |
|  | |

Attached patch

[patch](attachment.cgi?id=552044&action=diff)
— [Details](attachment.cgi?id=552044&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=677847&attachment=552044)

Bob, could you try this patch?
[Attachment #552044](/attachment.cgi?id=552044&action=edit "patch") -
Flags: review?(jst)
[Attachment #552044](/attachment.cgi?id=552044&action=edit "patch") -
Flags: feedback?(bclary)

|  | [Bob Clary [:bc] (inactive)](/user_profile?user_id=23402)  Reporter |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=677847#c6)• 13 years ago |
|  | |

Looks ok on mac with either of the urls.

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=677847#c7)• 13 years ago |
|  | |

Comment on [attachment 552044](/attachment.cgi?id=552044 "patch") [[details]](/attachment.cgi?id=552044&action=edit "patch") [[diff]](/attachment.cgi?id=552044&action=diff "patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=677847&attachment=552044)
patch
r=jst
[Attachment #552044](/attachment.cgi?id=552044&action=edit "patch") -
Flags: review?(jst) → review+

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=677847#a53761_39966)• 13 years ago |

[Attachment #552044](/attachment.cgi?id=552044&action=edit "patch") -
Flags: feedback?(bclary)

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966)  Assignee |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=677847#c8)• 13 years ago |
|  | |

<http://hg.mozilla.org/mozilla-central/rev/52c4a8829da3>Status: NEW → RESOLVEDClosed: 13 years agoResolution: --- → FIXED

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=677847#a121576_20209)• 13 years ago |

Blocks: [482909](/show_bug.cgi?id=482909 "RESOLVED FIXED - [HTML5] Re-implement HTML sanitizer using the HTML5 parser")

|  | [Jesse Ruderman](/user_profile?user_id=11608) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=677847#a1036283_11608)• 13 years ago |

Whiteboard: [sg:critical?]

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=677847#a5585195_1689)• 13 years ago |

[status-firefox8](/buglist.cgi?f1=cf_status_firefox8&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox8&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox8&o1=equals&v1=fixed)
[status-firefox9](/buglist.cgi?f1=cf_status_firefox9&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=fixed)
[tracking-firefox8](/buglist.cgi?f1=cf_tracking_firefox8&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox8&o1=equals&v1=%2B)
[tracking-firefox9](/buglist.cgi?f1=cf_tracking_firefox9&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox9&o1=equals&v1=%2B)Keywords: [regression](/buglist.cgi?keywords=regression&resolution=---)Target Milestone: --- → mozilla8

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=677847#a6116062_1689)• 13 years ago |

[status1.9.2](/buglist.cgi?f1=cf_status_192&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_192&o1=equals&v1=unaffected)

|  | [u279076](/user_profile?user_id=279076) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=677847#a8968288_279076)• 13 years ago |

Whiteboard: [sg:critical?] → [sg:critical?][qa+]

|  | [Tracy Walker [:tracy]](/user_profile?user_id=18566) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=677847#c9)• 13 years ago |
|  | |

given urls don't crash on 9, 10 or 11Status: RESOLVED → VERIFIEDKeywords: [verified-aurora](/buglist.cgi?keywords=verified-aurora&resolution=---),
[verified-beta](/buglist.cgi?keywords=verified-beta&resolution=---)Whiteboard: [sg:critical?][qa+] → [sg:critical?][qa!]

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=677847#a14046917_1689)• 13 years ago |

Group: core-security
You need to [log in](/show_bug.cgi?id=677847&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Bob Clary [:bc] (inactive)](/user_profile?user_id=23402)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from bugzilla.mozilla.org_d345e7f3_20250125_045756.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/671160)
* [XML](/show_bug.cgi?ctype=xml&id=671160)

Closed
[Bug 671160](/show_bug.cgi?id=671160)

Opened 14 years ago
Closed 14 years ago

# ASSERTION: Uh, inner window set as event target!

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

ASSERTION: Uh, inner window set as event target!

## Categories

### (Toolkit :: Password Manager, defect, P1)

[Product:](/describecomponents.cgi?product=Toolkit)

Toolkit
▾

Toolkit
The Mozilla Toolkit is a set of APIs, built on top of Gecko, which provide advanced services to XUL applications. These services include Profile Management, Chrome Registration, Browsing History, Extension and Theme Management, Application Update Service, and Safe Mode. ([More info](https://wiki.mozilla.org/Modules/Toolkit))
[See Open Bugs in This Product](/buglist.cgi?product=Toolkit&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Toolkit)
Watch This Product

[Component:](/describecomponents.cgi?product=Toolkit&component=Password%20Manager#Password%20Manager)

Password Manager
▾

Toolkit :: Password Manager
Remembers usernames and passwords on sites and fills them when the user returns to the site. [Debug Logging](https://wiki.mozilla.org/Firefox%3APassword_Manager_Debugging) can help diagnose problems.
[See Open Bugs in This Component](/buglist.cgi?product=Toolkit&component=Password%20Manager&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Toolkit&component=Password%20Manager&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Toolkit&component=Password%20Manager)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

x86\_64

Linux

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

P1

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

normal

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla8

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Webcompat Score | --- |
| --- | --- |
| Performance Impact | --- |
| a11y-review | --- |
| Accessibility Severity | --- |
| Webcompat Priority | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox5 | --- | [unaffected](/buglist.cgi?f1=cf_status_firefox5&o1=equals&v1=unaffected) |
| firefox6 | --- | [unaffected](/buglist.cgi?f1=cf_status_firefox6&o1=equals&v1=unaffected) |
| firefox7 | --- | [unaffected](/buglist.cgi?f1=cf_status_firefox7&o1=equals&v1=unaffected) |
| firefox8 | [+](/buglist.cgi?f1=cf_tracking_firefox8&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox8&o1=equals&v1=fixed) |
| firefox9 | [+](/buglist.cgi?f1=cf_tracking_firefox9&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=fixed) |
| firefox10 | [+](/buglist.cgi?f1=cf_tracking_firefox10&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=fixed) |
| status1.9.2 | --- | [unaffected](/buglist.cgi?f1=cf_status_192&o1=equals&v1=unaffected) |
| status1.9.1 | --- | [unaffected](/buglist.cgi?f1=cf_status_191&o1=equals&v1=unaffected) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox5 |  | unaffected |
| firefox6 |  | unaffected |
| firefox7 |  | unaffected |
| firefox8 | + | fixed |
| firefox9 | + | fixed |
| firefox10 | + | fixed |
| status1.9.2 |  | unaffected |
| relnote-firefox |  | --- |
| status1.9.1 |  | unaffected |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: MatsPalmgren\_bugz, Assigned: bzbarsky)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](extensions/Gravatar/web/default.jpg)  [bzbarsky](/user_profile?user_id=20209)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/e7ca93d447a86b3e78cdf42d361b4d3a?d=mm&size=40)  [MatsPalmgren\_bugz](/user_profile?user_id=5168)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

---

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

8 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[648045](/show_bug.cgi?id=648045 "RESOLVED FIXED - Mark the active tab in minimized windows as inactive")

Dependency [tree](/showdependencytree.cgi?id=671160&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=671160)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[Duplicates:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#duplicates)

[671392](/show_bug.cgi?id=671392 "RESOLVED DUPLICATE - Unknown protocol in iframe triggers \"ASSERTION: Uh, inner window set as event target!\""), [671688](/show_bug.cgi?id=671688 "RESOLVED DUPLICATE - nsAutoWindowStateHelper.cpp DOM notifications trigger \"###!!! ASSERTION: Uh, inner window set as event target!: '!win || !win->IsInnerWindow()', file nsDOMEvent.cpp, line 878\"")

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: assertion, regression, Whiteboard: [sg:high][qa-])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[assertion](/buglist.cgi?keywords=assertion&resolution=---),
[regression](/buglist.cgi?keywords=regression&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[sg:high][qa-]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [bzbarsky](/user_profile?user_id=20209) | [in-testsuite](#c8 "14 years ago") | ? |
| --- | --- | --- |
| [bzbarsky](/user_profile?user_id=20209) | in-testsuite | ? |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (2 files)

| [stack at the assertion](/attachment.cgi?id=545641)  [14 years ago](#c2)  [Mats Palmgren (inactive)](/user_profile?user_id=5168)   25.39 KB, text/plain |  | [Details](/attachment.cgi?id=545641&action=edit) |
| --- | --- | --- |
| [Fix](/attachment.cgi?id=545692)  [14 years ago](#c4)  [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)   1.11 KB, patch | smaug : [review+](#a56698_39966 "14 years ago") | [Details](/attachment.cgi?id=545692&action=edit) | [Diff](/attachment.cgi?id=545692&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=671160&attachment=545692) |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=671160#c0)• 14 years ago |
|  | |

STEPS TO REPRODUCE
1. run mochitest toolkit/components/passwordmgr/test/test\_master\_password.html
ACTUAL RESULTS
###!!! ASSERTION: Uh, inner window set as event target!: '!win || !win->IsInnerWindow()', file content/events/src/nsDOMEvent.cpp, line 878
PLATFORMS AND BUILDS TESTED
Bug occurs in a local mozilla-central DEBUG build on Linux x86-64

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966) |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=671160#c1)• 14 years ago |
|  | |

Can't reproduce. Can you get the stack?

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168)  Reporter |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=671160#c2)• 14 years ago |
|  | |

Attached file
[stack at the assertion](attachment.cgi?id=545641)
— [Details](attachment.cgi?id=545641&action=edit)

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=671160#c3)• 14 years ago |
|  | |

Bz, probably a regression from nsGlobalWindow::DispatchCustomEvent change.
We should dispatch the event to outer window.
Sorry, I should have noticed the problem when reviewing.
We could either just fix this bug, or make
event dispatching to handle this case.
I think I prefer the first option, since that forces caller to think about
whether to use inner or outer window.Assignee: nobody → bzbarsky

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=671160#a55325_20209)• 14 years ago |

Blocks: [648045](/show_bug.cgi?id=648045 "RESOLVED FIXED - Mark the active tab in minimized windows as inactive")

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=671160#c4)• 14 years ago |
|  | |

Attached patch

[Fix](attachment.cgi?id=545692&action=diff)
— [Details](attachment.cgi?id=545692&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=671160&attachment=545692)

[Attachment #545692](/attachment.cgi?id=545692&action=edit "Fix") -
Flags: review?(Olli.Pettay)

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=671160#a56159_20209)• 14 years ago |

Priority: -- → P1Whiteboard: [need review]

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=671160#a56698_39966)• 14 years ago |

[Attachment #545692](/attachment.cgi?id=545692&action=edit "Fix") -
Flags: review?(Olli.Pettay) → review+

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=671160#a57051_20209)• 14 years ago |

Whiteboard: [need review] → [need landing]

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=671160#a80763_1689)• 14 years ago |

[status1.9.1](/buglist.cgi?f1=cf_status_191&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_191&o1=equals&v1=unaffected)
[status1.9.2](/buglist.cgi?f1=cf_status_192&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_192&o1=equals&v1=unaffected)
[status-firefox5](/buglist.cgi?f1=cf_status_firefox5&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_firefox5&o1=equals&v1=unaffected)
[status-firefox6](/buglist.cgi?f1=cf_status_firefox6&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_firefox6&o1=equals&v1=unaffected)
[status-firefox7](/buglist.cgi?f1=cf_status_firefox7&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_firefox7&o1=equals&v1=unaffected)
[status-firefox8](/buglist.cgi?f1=cf_status_firefox8&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox8&o1=equals&v1=affected)Keywords: [regression](/buglist.cgi?keywords=regression&resolution=---)Whiteboard: [need landing] → [sg:high]

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=671160#c5)• 14 years ago |
|  | |

Daniel, please don't nuke my status whiteboard annotations? I actually use them to track what I need to do...Whiteboard: [sg:high] → [sg:high][need landing]

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=671160#c8)• 14 years ago |
|  | |

<http://hg.mozilla.org/integration/mozilla-inbound/rev/553625d7875d>Flags: in-testsuite?Whiteboard: [sg:high][need landing] → [sg:high]Target Milestone: --- → mozilla8

|  | [(no longer active)](/user_profile?user_id=251051) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=671160#c9)• 14 years ago |
|  | |

<http://hg.mozilla.org/mozilla-central/rev/553625d7875d>Status: NEW → RESOLVEDClosed: 14 years agoResolution: --- → FIXED

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=671160#a8017279_12352)• 13 years ago |

[status-firefox10](/buglist.cgi?f1=cf_status_firefox10&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=fixed)
[status-firefox8](/buglist.cgi?f1=cf_status_firefox8&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox8&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox8&o1=equals&v1=fixed)
[status-firefox9](/buglist.cgi?f1=cf_status_firefox9&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=fixed)
[tracking-firefox10](/buglist.cgi?f1=cf_tracking_firefox10&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox10&o1=equals&v1=%2B)
[tracking-firefox8](/buglist.cgi?f1=cf_tracking_firefox8&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox8&o1=equals&v1=%2B)
[tracking-firefox9](/buglist.cgi?f1=cf_tracking_firefox9&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox9&o1=equals&v1=%2B)

|  | [u279076](/user_profile?user_id=279076) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=671160#c10)• 13 years ago |
|  | |

Is there something QA can do to verify this fix? If not, could you verify the fix Mats?Whiteboard: [sg:high] → [sg:high][qa?]

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168)  Reporter |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=671160#c11)• 13 years ago |
|  | |

The test pass with no assertions in my local debug build on Linux64.
Backing out the fix brings it back.Status: RESOLVED → VERIFIED

|  | [u279076](/user_profile?user_id=279076) |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=671160#c12)• 13 years ago |
|  | |

Thanks Mats.Whiteboard: [sg:high][qa?] → [sg:high][qa-]

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=671160#a16479855_1689)• 13 years ago |

Group: core-security
You need to [log in](/show_bug.cgi?id=671160&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Mats Palmgren (inactive)](/user_profile?user_id=5168)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from bugzilla.novell.com_6fd7e390_20250126_060800.html ===




=== Content from bugzilla.mozilla.org_ddb9602f_20250125_045758.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/672892)
* [XML](/show_bug.cgi?ctype=xml&id=672892)

Closed
[Bug 672892](/show_bug.cgi?id=672892)

Opened 14 years ago
Closed 13 years ago

# Crash [@ JSParseNode::append] or "Assertion failure: !pn->pn\_defn,"

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Crash [@ JSParseNode::append] or "Assertion failure: !pn->pn\_defn,"

## Categories

### (Core :: JavaScript Engine, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=JavaScript%20Engine#JavaScript%20Engine)

JavaScript Engine
▾

Core :: JavaScript Engine
The interpreter engine for the core JavaScript language, independent of the browser's object model. File ONLY core JavaScript language bugs in this category. For bugs involving browser objects such as "window" and "document", use the "DOM" component. For bugs involving calls between JavaScript and C++, use the "XPConnect" component.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=JavaScript%20Engine&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=JavaScript%20Engine&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=JavaScript%20Engine)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

All

All

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

critical

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

---

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Webcompat Priority | --- |
| --- | --- |
| Accessibility Severity | --- |
| a11y-review | --- |
| Performance Impact | --- |
| Webcompat Score | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox5 | [-](/buglist.cgi?f1=cf_tracking_firefox5&o1=equals&v1=-) | [wontfix](/buglist.cgi?f1=cf_status_firefox5&o1=equals&v1=wontfix) |
| firefox6 | [-](/buglist.cgi?f1=cf_tracking_firefox6&o1=equals&v1=-) | [wontfix](/buglist.cgi?f1=cf_status_firefox6&o1=equals&v1=wontfix) |
| firefox7 | [-](/buglist.cgi?f1=cf_tracking_firefox7&o1=equals&v1=-) | [unaffected](/buglist.cgi?f1=cf_status_firefox7&o1=equals&v1=unaffected) |
| firefox8 | [+](/buglist.cgi?f1=cf_tracking_firefox8&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox8&o1=equals&v1=fixed) |
| firefox9 | [+](/buglist.cgi?f1=cf_tracking_firefox9&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=fixed) |
| status1.9.2 | --- | [unaffected](/buglist.cgi?f1=cf_status_192&o1=equals&v1=unaffected) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox5 | - | wontfix |
| firefox6 | - | wontfix |
| firefox7 | - | unaffected |
| firefox8 | + | fixed |
| firefox9 | + | fixed |
| status1.9.2 |  | unaffected |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: decoder, Assigned: jorendorff)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/5a83f46f9f97d184457cb2dedfa19173?d=mm&size=40)  [jorendorff](/user_profile?user_id=281791)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/b29b83d12aba827b8ff68296e473bec5?d=mm&size=40)  [decoder](/user_profile?user_id=395101)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/4fe52ee1503aecf7b6c976b8eb7c1753?d=mm&size=40)  [willyelm](/user_profile?user_id=714609)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

16 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[648175](/show_bug.cgi?id=648175 "RESOLVED FIXED - Get rid of JSOP_FOR* opcodes"), [673954](/show_bug.cgi?id=673954 "RESOLVED DUPLICATE - TI: \"Assertion failure: !pn->pn_defn,\"")

Dependency [tree](/showdependencytree.cgi?id=672892&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=672892)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[Duplicates:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#duplicates)

[673954](/show_bug.cgi?id=673954 "RESOLVED DUPLICATE - TI: \"Assertion failure: !pn->pn_defn,\"")

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (4 keywords, Whiteboard: [sg:critical?][js-triage-done][qa!])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[assertion](/buglist.cgi?keywords=assertion&resolution=---),
[crash](/buglist.cgi?keywords=crash&resolution=---),
[regression](/buglist.cgi?keywords=regression&resolution=---),
[testcase](/buglist.cgi?keywords=testcase&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[sg:critical?][js-triage-done][qa!]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [decoder](/user_profile?user_id=395101) | [in-testsuite](#c31 "12 years ago") | + |
| --- | --- | --- |
| [decoder](/user_profile?user_id=395101) | in-testsuite | + |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | qe-verify |  |

## Crash Data

Signature:

[[@ JSParseNode::append ]](https://crash-stats.mozilla.org/signature/?signature=JSParseNode%3A%3Aappend)

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (3 files)

| [stack](/attachment.cgi?id=549662)  [13 years ago](#c5)  [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034)   2.46 KB, text/plain |  | [Details](/attachment.cgi?id=549662&action=edit) |
| --- | --- | --- |
| [Assert earlier!](/attachment.cgi?id=552146)  [13 years ago](#c11)  [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)   927 bytes, patch |  | [Details](/attachment.cgi?id=552146&action=edit) | [Diff](/attachment.cgi?id=552146&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=672892&attachment=552146) |
| [fix](/attachment.cgi?id=552243)  [13 years ago](#c14)  [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)   2.10 KB, patch | dvander : [review+](#a1978397_309316 "13 years ago") | [Details](/attachment.cgi?id=552243&action=edit) | [Diff](/attachment.cgi?id=552243&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=672892&attachment=552243) |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=672892#c0)• 14 years ago |
|  | |

The following test asserts on mozilla-central revision c9cdc5df55f4 (no options required):
with(startTest){
for(var TITLE=0 in startTest)
SECTION('huh');
}

|  | [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034) |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=672892#c1)• 14 years ago |
|  | |

There's another testcase in [bug 673954](/show_bug.cgi?id=673954 "RESOLVED DUPLICATE - TI: \"Assertion failure: !pn->pn_defn,\"").

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=672892#a519694_281791)• 14 years ago |

Whiteboard: js-triage-needed → [js-triage-needed][mentor=jorendorff]

|  | [Eddy Bruel [:ejpbruel]](/user_profile?user_id=417505) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=672892#a664814_417505)• 13 years ago |

Assignee: general → ejpbruel

|  | [Eddy Bruel [:ejpbruel]](/user_profile?user_id=417505) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=672892#c2)• 13 years ago |
|  | |

From what I can tell so far, this is caused by Compiler::compileScript calling RecycleTree in jsparse.cpp:1056, with the tree being recycled containing a definition node. AddNodeToFreeList does not allow definition nodes to be recycled in this way, because "It's too hard to clear these nodes from the AtomDefnMaps, etc.". Furthermore, it states that is the caller's job to recognize and process these.
I am not yet sure how Compiler::compileScript is supposed to recognize definition nodes at this point in the code (and why it doesn't), nor do I know how it the caller is supposed to process these nodes when it does recognize them. Can anyone shed some light on this?

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)  Assignee |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=672892#c3)• 13 years ago |
|  | |

Cc-ing brendan and Waldo. Please see [comment 2](/show_bug.cgi?id=672892#c2 "VERIFIED FIXED - Crash [@ JSParseNode::append] or \"Assertion failure: !pn->pn_defn,\"").

|  | [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=672892#c4)• 13 years ago |
|  | |

with({
e: (7)
})
for (var b = (7) ? ['' + (d)] : [] in <x/> )
this
try {
t(b, 5)
} catch (e) {}
function v() {
p[[]], \*
}
crashes m-i changeset b4165ae3685f without any CLI flags when the testcase passed in as a CLI argument, and asserts similarly.
Seems to be a null-deref, but locking just-in-case.Group: core-securityCrash Signature: [@ JSParseNode::append]OS: Linux → AllHardware: x86\_64 → AllSummary: TM: Assertion failure: !pn->pn\_defn, at jsparse.cpp:382 → Crash [@ JSParseNode::append] or "Assertion failure: !pn->pn\_defn,"

|  | [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=672892#c5)• 13 years ago |
|  | |

Attached file
[stack](attachment.cgi?id=549662)
— [Details](attachment.cgi?id=549662&action=edit)

Tested on Mac OS X 10.6 js opt shell.

|  | [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=672892#c6)• 13 years ago |
|  | |

(not sure if this is entirely correct)
autoBisect shows this is probably related to the following changeset:
The first bad revision is:
changeset: 73021:938c1a177114
user: Jason Orendorff
date: Tue Jul 19 11:00:43 2011 -0500
summary: [Bug 648175](/show_bug.cgi?id=648175 "RESOLVED FIXED - Get rid of JSOP_FOR* opcodes") - Remove JSOP\_FOR\*. Second second landing, to coin a phrase. r=dvander.Blocks: [648175](/show_bug.cgi?id=648175 "RESOLVED FIXED - Get rid of JSOP_FOR* opcodes")

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)  Assignee |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=672892#c7)• 13 years ago |
|  | |

The test case in [comment 4](/show_bug.cgi?id=672892#c4 "VERIFIED FIXED - Crash [@ JSParseNode::append] or \"Assertion failure: !pn->pn_defn,\"") reduces to exactly the same thing as the one in [comment 0](/show_bug.cgi?id=672892#c0 "VERIFIED FIXED - Crash [@ JSParseNode::append] or \"Assertion failure: !pn->pn_defn,\""):
with (0)
for (var b = 0 in 0)
;

|  | [Eddy Bruel [:ejpbruel]](/user_profile?user_id=417505) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=672892#c8)• 13 years ago |
|  | |

Tracing revealed that a node with token kind TOK\_NUMBER is added to the list of nodes to be recycled twice. In debug mode, when RecycleTree tries to free it for the second time, it contains poisoned data, causing the assertion.

|  | [Brendan Eich [:brendan]](/user_profile?user_id=1214) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=672892#c9)• 13 years ago |
|  | |

Cc'ing jimb and igor who wrote and r +'ed the last re-do of recycling, IIRC.
/be

|  | [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=672892#c10)• 13 years ago |
|  | |

(In reply to [comment #9](/show_bug.cgi?id=672892#c9 "VERIFIED FIXED - Crash [@ JSParseNode::append] or \"Assertion failure: !pn->pn_defn,\""))
> Cc'ing jimb and igor who wrote and r +'ed the last re-do of recycling, IIRC.
I'm seeing this bug (and its many variants) happening really often in fuzzers. Could someone knowledgeable please weigh in on this?

|  | [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=672892#a1535196_132034)• 13 years ago |

[tracking-firefox8](/buglist.cgi?f1=cf_tracking_firefox8&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox8&o1=equals&v1=%3F)

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)  Assignee |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=672892#c11)• 13 years ago |
|  | |

Attached patch

[Assert earlier!](attachment.cgi?id=552146&action=diff)
— [Details](attachment.cgi?id=552146&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=672892&attachment=552146)

Stealing this bug at Gary's request.
Gary, try this patch. It doesn't fix the bug, but it should turn almost all of the crash signatures into the same assertion failure:
Assertion failure: pn != freepn, at js/src/jsparse.cpp:376Assignee: ejpbruel → jorendorff

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)  Assignee |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=672892#c12)• 13 years ago |
|  | |

The parse tree for this:
with (1) for (var b = 2 in 3) ;
looks like this:
(with 1
(seq
(var (name b 2))
(for (in #null (name b 2) 3)
(semi #null))))
Those two "name" nodes have distinct addresses (one is a clone of the other, I guess) but both refer to the same TOK\_NUMBER 2 node.

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)  Assignee |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=672892#c13)• 13 years ago |
|  | |

The node I write as (name b 2) is the result of parsing `b = 2`.
It has these fields:
.pn\_arity = PN\_NAME,
.pn\_used = false,
.pn\_defn = false,
.pn\_op = JSOP\_SETNAME,
.pn\_u.name.expr = <pointer to the shared TOK\_NUMBER node>
I think pn\_used=true would mean that the parser has already bound the name to a JSDefinition. In this case, that hasn't happened, I guess because of the with-block. (I don't know in detail how `var b = 2` is supposed to work inside a with block, but I trust it's crazy.)
The intention of CloneLeftHandSide is for the new clone node to represent `b`, not `b = 2`: the result should have null pn\_expr. It's not doing that.
Patch coming.

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)  Assignee |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=672892#c14)• 13 years ago |
|  | |

Attached patch

[fix](attachment.cgi?id=552243&action=diff)
— [Details](attachment.cgi?id=552243&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=672892&attachment=552243)

dvander, feel free to shift this to someone who knows about PN\_NAME nodes. I sure don't--but I don't know who does, except Brendan.
[Attachment #552243](/attachment.cgi?id=552243&action=edit "fix") -
Flags: review?(dvander)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=672892#a1831433_1689)• 13 years ago |

Blocks: [673954](/show_bug.cgi?id=673954 "RESOLVED DUPLICATE - TI: \"Assertion failure: !pn->pn_defn,\"")

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=672892#c15)• 13 years ago |
|  | |

From the patch (making sure "pn->pn\_expr = NULL;" is called) it looks like uninitialized memory. What can pn\_expr do if an attacker controls it?Whiteboard: [js-triage-needed][mentor=jorendorff] → [sg:critical?][js-triage-needed][mentor=jorendorff]

|  | [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=672892#a1842315_132034)• 13 years ago |

Keywords: [crash](/buglist.cgi?keywords=crash&resolution=---),
[regression](/buglist.cgi?keywords=regression&resolution=---)

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)  Assignee |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=672892#c17)• 13 years ago |
|  | |

(In reply to Daniel Veditz from [comment #15](/show_bug.cgi?id=672892#c15 "VERIFIED FIXED - Crash [@ JSParseNode::append] or \"Assertion failure: !pn->pn_defn,\""))
> From the patch (making sure "pn->pn\_expr = NULL;" is called) it looks like
> uninitialized memory. What can pn\_expr do if an attacker controls it?
The preceding statement "pn->pn\_u.name = opn->pn\_u.name;" populates that field. pn->pn\_expr expands to pn->pn\_u.name.expr. So it's not uninitialized memory.
But that's little comfort. This kind of double free puts the node onto the freelist twice. New nodes are allocated from the freelist. So you can probably get pretty much any two nodes to be allocated in the same location. You might be able to write arbitrary memory with that, by causing a double to be interpreted as a pointer. Maybe. It'd be tricky, but I wouldn't bet against it.
sg-critical? seems about right.

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=672892#a1905925_12352)• 13 years ago |

[status-firefox5](/buglist.cgi?f1=cf_status_firefox5&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox5&o1=equals&v1=wontfix)
[status-firefox6](/buglist.cgi?f1=cf_status_firefox6&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox6&o1=equals&v1=wontfix)
[status-firefox7](/buglist.cgi?f1=cf_status_firefox7&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox7&o1=equals&v1=affected)
[status-firefox8](/buglist.cgi?f1=cf_status_firefox8&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox8&o1=equals&v1=affected)
[tracking-firefox5](/buglist.cgi?f1=cf_tracking_firefox5&o1=isnotempty):
--- → [-](/buglist.cgi?f1=cf_tracking_firefox5&o1=equals&v1=-)
[tracking-firefox6](/buglist.cgi?f1=cf_tracking_firefox6&o1=isnotempty):
--- → [-](/buglist.cgi?f1=cf_tracking_firefox6&o1=equals&v1=-)
[tracking-firefox7](/buglist.cgi?f1=cf_tracking_firefox7&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox7&o1=equals&v1=%2B)
[tracking-firefox8](/buglist.cgi?f1=cf_tracking_firefox8&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox8&o1=equals&v1=%3F) → [+](/buglist.cgi?f1=cf_tracking_firefox8&o1=equals&v1=%2B)

|  | [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034) |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=672892#c18)• 13 years ago |
|  | |

(In reply to Jason Orendorff [:jorendorff] from [comment #14](/show_bug.cgi?id=672892#c14 "VERIFIED FIXED - Crash [@ JSParseNode::append] or \"Assertion failure: !pn->pn_defn,\""))
> Created [attachment 552243](/attachment.cgi?id=552243 "fix") [[details]](/attachment.cgi?id=552243&action=edit "fix") [[diff]](/attachment.cgi?id=552243&action=diff "fix") [[review]](/page.cgi?id=splinter.html&ignore=&bug=672892&attachment=552243)
> fix
>
> dvander, feel free to shift this to someone who knows about PN\_NAME nodes. I
> sure don't--but I don't know who does, except Brendan.
Preliminary testing shows that this patch does fix most of the issues for me.

|  | [David Anderson [:dvander] - inactive, e-mail if emergency](/user_profile?user_id=309316) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=672892#a1978397_309316)• 13 years ago |

[Attachment #552243](/attachment.cgi?id=552243&action=edit "fix") -
Flags: review?(dvander) → review+

|  | [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034) |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=672892#c19)• 13 years ago |
|  | |

Landed on mozilla-inbound:
<http://hg.mozilla.org/integration/mozilla-inbound/rev/5ca0d6677b2c>
and landed on mozilla-central:
<http://hg.mozilla.org/mozilla-central/rev/5ca0d6677b2c>Status: NEW → RESOLVEDClosed: 13 years agoResolution: --- → FIXEDWhiteboard: [sg:critical?][js-triage-needed][mentor=jorendorff] → [sg:critical?][js-triage-done][mentor=jorendorff][inbound]

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=672892#a2218819_281791)• 13 years ago |

Whiteboard: [sg:critical?][js-triage-done][mentor=jorendorff][inbound] → [sg:critical?][js-triage-done]

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)  Assignee |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=672892#c20)• 13 years ago |
|  | |

The test doesn't assert in Aurora, which is unsurprising because the regressing changeset isn't in Aurora. I think we're done here.

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=672892#c21)• 13 years ago |
|  | |

(In reply to Gary Kwong [:gkw, :nth10sd] from [comment #18](/show_bug.cgi?id=672892#c18 "VERIFIED FIXED - Crash [@ JSParseNode::append] or \"Assertion failure: !pn->pn_defn,\""))
> Preliminary testing shows that this patch does fix most of the issues for me.
Are there bugs filed on the remaining issues?

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=672892#c22)• 13 years ago |
|  | |

Jason, is the fix good for 7 (beta), if so, please request approval.
[status-firefox8](/buglist.cgi?f1=cf_status_firefox8&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox8&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox8&o1=equals&v1=fixed)
[status-firefox9](/buglist.cgi?f1=cf_status_firefox9&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=fixed)
[tracking-firefox9](/buglist.cgi?f1=cf_tracking_firefox9&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox9&o1=equals&v1=%2B)

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)  Assignee |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=672892#c23)• 13 years ago |
|  | |

The regressing changeset isn't in 7.

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=672892#a2515182_281791)• 13 years ago |

[status-firefox7](/buglist.cgi?f1=cf_status_firefox7&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox7&o1=equals&v1=affected) → [unaffected](/buglist.cgi?f1=cf_status_firefox7&o1=equals&v1=unaffected)

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=672892#c24)• 13 years ago |
|  | |

Does that mean that 5 and 6 are unaffected as well?
[tracking-firefox7](/buglist.cgi?f1=cf_tracking_firefox7&o1=isnotempty):
[+](/buglist.cgi?f1=cf_tracking_firefox7&o1=equals&v1=%2B) → [-](/buglist.cgi?f1=cf_tracking_firefox7&o1=equals&v1=-)

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)  Assignee |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=672892#c25)• 13 years ago |
|  | |

Yes.

|  | [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034) |  |
| --- | --- | --- |
| [Comment 26](/show_bug.cgi?id=672892#c26)• 13 years ago |
|  | |

(In reply to Daniel Veditz from [comment #21](/show_bug.cgi?id=672892#c21 "VERIFIED FIXED - Crash [@ JSParseNode::append] or \"Assertion failure: !pn->pn_defn,\""))
> (In reply to Gary Kwong [:gkw, :nth10sd] from [comment #18](/show_bug.cgi?id=672892#c18 "VERIFIED FIXED - Crash [@ JSParseNode::append] or \"Assertion failure: !pn->pn_defn,\""))
> > Preliminary testing shows that this patch does fix most of the issues for me.
>
> Are there bugs filed on the remaining issues?
Turns out the other issues were TI or unrelated ones.

|  | [u279076](/user_profile?user_id=279076) |  |
| --- | --- | --- |
| [Comment 27](/show_bug.cgi?id=672892#c27)• 13 years ago |
|  | |

qa- as nothing to do for QA verification -- please reset to qa+ if this is not the case.Whiteboard: [sg:critical?][js-triage-done] → [sg:critical?][js-triage-done][qa-]

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 28](/show_bug.cgi?id=672892#c28)• 13 years ago |
|  | |

[comment 0](/show_bug.cgi?id=672892#c0 "VERIFIED FIXED - Crash [@ JSParseNode::append] or \"Assertion failure: !pn->pn_defn,\""), [comment 1](/show_bug.cgi?id=672892#c1 "VERIFIED FIXED - Crash [@ JSParseNode::append] or \"Assertion failure: !pn->pn_defn,\""), and [comment 4](/show_bug.cgi?id=672892#c4 "VERIFIED FIXED - Crash [@ JSParseNode::append] or \"Assertion failure: !pn->pn_defn,\"") contain testcases: this can be verified.Whiteboard: [sg:critical?][js-triage-done][qa-] → [sg:critical?][js-triage-done][qa+]

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)  Assignee |  |
| --- | --- | --- |
| [Comment 29](/show_bug.cgi?id=672892#c29)• 13 years ago |
|  | |

I have not tested this in FF3.6, and I can’t now get the 1.9.2 tree to build locally, but given that the bug is not in FF5, FF6, or FF7, I'm pretty sure it isn’t in FF3.6 either.
Also presumably unaffected are FF4, FF3.5, FF1-3, Mosaic, IE3, iTunes, Minesweeper, Altair Basic, French, subspace oscillations, preparedness, the digits of pi, and our Purity of Essence. However there are no guarantees.
[status1.9.2](/buglist.cgi?f1=cf_status_192&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_192&o1=equals&v1=unaffected)

|  | [u279076](/user_profile?user_id=279076) |  |
| --- | --- | --- |
| [Comment 30](/show_bug.cgi?id=672892#c30)• 13 years ago |
|  | |

Unable to reproduce this crash on Firefox 9.0 Debug from 2011-12-08.Status: RESOLVED → VERIFIEDWhiteboard: [sg:critical?][js-triage-done][qa+] → [sg:critical?][js-triage-done][qa!]

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=672892#a15812402_1689)• 13 years ago |

Group: core-security

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Comment 31](/show_bug.cgi?id=672892#c31)• 12 years ago |
|  | |

A testcase for this bug was automatically identified at js/src/tests/js1\_8\_5/regress/regress-672892.js.Flags: in-testsuite+
You need to [log in](/show_bug.cgi?id=672892&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from bugzilla.mozilla.org_b3e634ba_20250125_045804.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/686044)
* [XML](/show_bug.cgi?ctype=xml&id=686044)

Closed
[Bug 686044](/show_bug.cgi?id=686044)

Opened 13 years ago
Closed 13 years ago

# Crash with after path.pathSegList.appendItem and GC

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Crash with after path.pathSegList.appendItem and GC

## Categories

### (Core :: SVG, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=SVG#SVG)

SVG
▾

Core :: SVG

Issues with the layout or rendering of SVG content and interacting with the SVG DOM.

Example bugs:

* SVG marker can not be clipped with clip-path
* x position adjustments of SVG vertical text on a path moves in the wrong direction

Specifications covered:

* SVG

[See Open Bugs in This Component](/buglist.cgi?product=Core&component=SVG&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=SVG&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=SVG)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

x86\_64

All

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

critical

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla9

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| a11y-review | --- |
| --- | --- |
| Accessibility Severity | --- |
| Webcompat Score | --- |
| Performance Impact | --- |
| Webcompat Priority | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox7 | [-](/buglist.cgi?f1=cf_tracking_firefox7&o1=equals&v1=-) | [affected](/buglist.cgi?f1=cf_status_firefox7&o1=equals&v1=affected) |
| firefox8 | [+](/buglist.cgi?f1=cf_tracking_firefox8&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox8&o1=equals&v1=fixed) |
| firefox9 | [+](/buglist.cgi?f1=cf_tracking_firefox9&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=fixed) |
| firefox10 | [+](/buglist.cgi?f1=cf_tracking_firefox10&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=fixed) |
| status1.9.2 | --- | [unaffected](/buglist.cgi?f1=cf_status_192&o1=equals&v1=unaffected) |
| status1.9.1 | --- | [unaffected](/buglist.cgi?f1=cf_status_191&o1=equals&v1=unaffected) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox7 | - | affected |
| firefox8 | + | fixed |
| firefox9 | + | fixed |
| firefox10 | + | fixed |
| status1.9.2 |  | unaffected |
| relnote-firefox |  | --- |
| status1.9.1 |  | unaffected |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: jruderman, Assigned: dholbert)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/cd9b85b2e112bd7941b21ad03f42604e?d=mm&size=40)  [dholbert](/user_profile?user_id=278074)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/d2dc9227eafcd0ec5ba3712ee4f19b75?d=mm&size=40)  [jruderman](/user_profile?user_id=11608)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](extensions/Gravatar/web/default.jpg)  [jwatt](/user_profile?user_id=32767)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

10 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

[669584](/show_bug.cgi?id=669584 "RESOLVED FIXED - The fix for bug 639728 forgot that items are created lazily")

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[344905](/show_bug.cgi?id=344905 "RESOLVED FIXED - [meta] SVG Element and Attribute fuzzer")

Dependency [tree](/showdependencytree.cgi?id=686044&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=686044)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (4 keywords, Whiteboard: [sg:critical][qa!])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[crash](/buglist.cgi?keywords=crash&resolution=---),
[testcase](/buglist.cgi?keywords=testcase&resolution=---),
[verified-aurora](/buglist.cgi?keywords=verified-aurora&resolution=---),
[verified-beta](/buglist.cgi?keywords=verified-beta&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[sg:critical][qa!]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |
|  | qe-verify |  |

## Crash Data

Signature:

[[@ mozilla::DOMSVGPathSegList::InternalListWillChangeTo ]](https://crash-stats.mozilla.org/signature/?signature=mozilla%3A%3ADOMSVGPathSegList%3A%3AInternalListWillChangeTo)

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (3 files, 1 obsolete file)

| [testcase (crashes Firefox within a few seconds)](/attachment.cgi?id=559609)  [13 years ago](#c0)  [Jesse Ruderman](/user_profile?user_id=11608)   474 bytes, image/svg+xml |  | [Details](/attachment.cgi?id=559609&action=edit) |
| --- | --- | --- |
| [stack trace](/attachment.cgi?id=559610)  [13 years ago](#c1)  [Jesse Ruderman](/user_profile?user_id=11608)   42.72 KB, text/plain |  | [Details](/attachment.cgi?id=559610&action=edit) |
| [fix](/attachment.cgi?id=559646)  [13 years ago](#c8)  [Daniel Holbert [:dholbert]](/user_profile?user_id=278074)   1.16 KB, patch | jwatt : [review+](#c10 "13 years ago") | [Details](/attachment.cgi?id=559646&action=edit) | [Diff](/attachment.cgi?id=559646&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=686044&attachment=559646) |
| [fix w/ added comment [r=jwatt]](/attachment.cgi?id=560424)  [13 years ago](#c11)  [Daniel Holbert [:dholbert]](/user_profile?user_id=278074)   1.89 KB, patch | johnath : [approval-mozilla-aurora+](#a1115935_210757 "13 years ago")  christian : [approval-mozilla-beta-](#a1463446_482154 "13 years ago") | [Details](/attachment.cgi?id=560424&action=edit) | [Diff](/attachment.cgi?id=560424&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=686044&attachment=560424) |

Show Obsolete

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Jesse Ruderman](/user_profile?user_id=11608)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=686044#c0)• 13 years ago |
|  | |

Attached image
[testcase (crashes Firefox within a few seconds)](attachment.cgi?id=559609)
— [Details](attachment.cgi?id=559609&action=edit)

Security-sensitive becase:
\* It's scary that GC is involved,
\* the reduced testcase mysteriously requires a loop,
\* I saw an (unsafe) "invalid array index" once.

|  | [Jesse Ruderman](/user_profile?user_id=11608)  Reporter |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=686044#c1)• 13 years ago |
|  | |

Attached file
[stack trace](attachment.cgi?id=559610)
— [Details](attachment.cgi?id=559610&action=edit)

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074)  Assignee |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=686044#c2)• 13 years ago |
|  | |

(In reply to Jesse Ruderman from [comment #0](/show_bug.cgi?id=686044#c0 "VERIFIED FIXED - Crash with after path.pathSegList.appendItem and GC"))
> \* It's scary that GC is involved,
(BTW: presumably this requires <https://www.squarefree.com/extensions/domFuzzLite.xpi> to reliably trigger the crash, given the fuzzPriv.GC() call)

|  | [Jesse Ruderman](/user_profile?user_id=11608)  Reporter |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=686044#c3)• 13 years ago |
|  | |

<https://www.squarefree.com/extensions/domFuzzLite2.xpi>, yeah.

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074)  Assignee |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=686044#c4)• 13 years ago |
|  | |

I can repro on Linux64 with the XPI from [comment 3](/show_bug.cgi?id=686044#c3 "VERIFIED FIXED - Crash with after path.pathSegList.appendItem and GC"). (Sorry for the outdated link in [comment 2](/show_bug.cgi?id=686044#c2 "VERIFIED FIXED - Crash with after path.pathSegList.appendItem and GC").)
So far, it always crashes for me when i hits 39, in the testcase's loop. (i.e. it crashes after "39" has been printed to my terminal).OS: Mac OS X → All

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074)  Assignee |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=686044#c5)• 13 years ago |
|  | |

So, in this chunk of code (with aValue == "M4,4")...
> 51 SVGAnimatedPathSegList::SetBaseValueString(const nsAString& aValue)
> 52 {
[...]
> 67 DOMSVGPathSegList \*baseValWrapper =
> 68 DOMSVGPathSegList::GetDOMWrapperIfExists(GetBaseValKey());
> 69 if (baseValWrapper) {
> 70 baseValWrapper->InternalListWillChangeTo(newBaseValue);
> 71 }
<https://mxr.mozilla.org/mozilla-central/source/content/svg/content/src/SVGAnimatedPathSegList.cpp#67>
What's happening is:
- We do have an existing baseValWrapper.
- We hit line 70, the call to InternalListWillChangeTo.
- This removes the last reference to |baseValWrapper|
- In so doing, we call RemovingFromList() on its only entry, and remove the last reference to it. (see code below)
- So |baseValWrapper| dies while we're still in the middle of a method running on it.
We actually have code for a kung-fu death-grip in place here, but we're not activating the death-grip because our new list's length (3) is larger than our old length (1), so we think it's unnecessary:
> 158 nsRefPtr<DOMSVGPathSegList> kungFuDeathGrip;
> 159 if (aNewValue.Length() < length) {
> 160 // RemovingFromList() might clear last reference to |this|.
> 161 // Retain a temporary reference to keep from dying before returning.
> 162 kungFuDeathGrip = this;
> 163 }
> 164
> 165 while (index < length && dataIndex < dataLength) {
> 166 newSegType = SVGPathSegUtils::DecodeType(aNewValue.mData[dataIndex]);
> 167 if (ItemAt(index) && ItemAt(index)->Type() != newSegType) {
> 168 ItemAt(index)->RemovingFromList();
<https://mxr.mozilla.org/mozilla-central/source/content/svg/content/src/DOMSVGPathSegList.cpp#158>
I don't immediately remember why we think the death-grip is unnecessary in that case, though... Clearly it would help to prevent the crash in this testcase. (maybe that's because something else is failing too, though.)

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074)  Assignee |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=686044#c6)• 13 years ago |
|  | |

(In reply to Daniel Holbert [:dholbert] (vacation 9/17-9/24) from [comment #5](/show_bug.cgi?id=686044#c5 "VERIFIED FIXED - Crash with after path.pathSegList.appendItem and GC"))
> What's happening is:
> - We do have an existing baseValWrapper.
> - We hit line 70, the call to InternalListWillChangeTo.
> - This removes the last reference to |baseValWrapper|
> - In so doing, we call RemovingFromList() on its only entry, and remove the
> last reference to it. (see code below)
> - So |baseValWrapper| dies while we're still in the middle of a method
> running on it.
(Sorry, ignore the 3rd bullet-point there ("This removes the last...") -- I clarified what I meant by it in the 4th bullet point, and then forgot to delete the original un-clarified version.)

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074)  Assignee |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=686044#c7)• 13 years ago |
|  | |

As noted in [bug 669584 comment #0](/show_bug.cgi?id=669584#c0 "RESOLVED FIXED - The fix for bug 639728 forgot that items are created lazily"):
> The fix for [bug 639728](/show_bug.cgi?id=639728 "RESOLVED FIXED - Crash [@ mozilla::DOMSVGPathSegList::ItemAt] with GC") forgot that items are created lazily. Checking that
> the list length is going to change to zero is not enough. The last remaining
> reference to the object may be a single item at an arbitrary index
[...NOTE: that's true here -- and the arbitrary index happens to be index 0...]
> so really we have to check whether the list length is decreasing.
In this case, there's the additional complication that we \*\*drop\*\* the old DOMSVGPathSeg if the segment type has changed, per line 167 quoted in [comment 5](/show_bug.cgi?id=686044#c5 "VERIFIED FIXED - Crash with after path.pathSegList.appendItem and GC"). (We don't do that for other list-types, because they don't have the "different segment types have different data lengths" complication that paths have.)
So I suspect that for DOMSVGPathSegList, we want to \*always\* use a death-grip, regardless of whether the list-length is decreasing or increasing.

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074)  Assignee |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=686044#c8)• 13 years ago |
|  | |

Attached patch

[fix](attachment.cgi?id=559646&action=diff) (obsolete)
— [Details](attachment.cgi?id=559646&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=686044&attachment=559646)

(In reply to Daniel Holbert [:dholbert] (vacation 9/17-9/24) from [comment #7](/show_bug.cgi?id=686044#c7 "VERIFIED FIXED - Crash with after path.pathSegList.appendItem and GC"))
> So I suspect that for DOMSVGPathSegList, we want to \*always\* use a
> death-grip, regardless of whether the list-length is decreasing or
> increasing.
Actually not quite "always" -- we only want the death-grip if we've got a nonzero length. (If we deathgrip unconditionally, we delete ourselves while we're still inside in our constructor -- because we hit this code & add/remove the deathgrip & delete ourselves, all before the code that created us has gotten a chance to |NS\_ADDREF| the newly-constructed object)
So -- this patch adds a deathgrip if(length).
[Attachment #559646](/attachment.cgi?id=559646&action=edit "fix") -
Flags: review?(jwatt)

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074)  Assignee |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=686044#c9)• 13 years ago |
|  | |

(Marking "depends-on" [bug 669584](/show_bug.cgi?id=669584 "RESOLVED FIXED - The fix for bug 639728 forgot that items are created lazily"). Absolutely not a regression from that bug, but still related, as the patch here further-relaxes an "if" check that was partially-relaxed in that bug.)Assignee: nobody → dholbertDepends on: [669584](/show_bug.cgi?id=669584 "RESOLVED FIXED - The fix for bug 639728 forgot that items are created lazily")Whiteboard: [sg:critical]

|  | [Jonathan Watt [:jwatt]](/user_profile?user_id=32767) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=686044#c10)• 13 years ago |
|  | |

Comment on [attachment 559646](/attachment.cgi?id=559646 "fix") [[details]](/attachment.cgi?id=559646&action=edit "fix") [[diff]](/attachment.cgi?id=559646&action=diff "fix") [[review]](/page.cgi?id=splinter.html&ignore=&bug=686044&attachment=559646)
fix
r=jwatt with f2f comments addressed (see upcoming commit from dholbert).
[Attachment #559646](/attachment.cgi?id=559646&action=edit "fix") -
Flags: review?(jwatt) → review+

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074)  Assignee |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=686044#c11)• 13 years ago |
|  | |

Attached patch

[fix w/ added comment [r=jwatt]](attachment.cgi?id=560424&action=diff)
— [Details](attachment.cgi?id=560424&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=686044&attachment=560424)

Added explanatory comment per jwatt's request.
I'll land this later today. (It's currently going through TryServer with another patch I want to land, just as an absolute sanity-check since I can't treewatch-after-landing effectively during the F2F. :))
[Attachment #559646](/attachment.cgi?id=559646&action=edit "fix") -
Attachment is obsolete: true

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074)  Assignee |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=686044#c12)• 13 years ago |
|  | |

<https://hg.mozilla.org/integration/mozilla-inbound/rev/6806beccdeaf>Status: NEW → ASSIGNEDTarget Milestone: --- → mozilla9

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=686044#a516692_278074)• 13 years ago |

Whiteboard: [sg:critical] → [sg:critical][inbound]

|  | [(no longer active)](/user_profile?user_id=251051) |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=686044#c13)• 13 years ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/6806beccdeaf>Status: ASSIGNED → RESOLVEDClosed: 13 years agoResolution: --- → FIXEDWhiteboard: [sg:critical][inbound] → [sg:critical]

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074)  Assignee |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=686044#c14)• 13 years ago |
|  | |

Comment on [attachment 560424](/attachment.cgi?id=560424 "fix w/ added comment [r=jwatt]") [[details]](/attachment.cgi?id=560424&action=edit "fix w/ added comment [r=jwatt]") [[diff]](/attachment.cgi?id=560424&action=diff "fix w/ added comment [r=jwatt]") [[review]](/page.cgi?id=splinter.html&ignore=&bug=686044&attachment=560424)
fix w/ added comment [r=jwatt]
Requesting approval to land on Beta & Aurora channels.
Risk Assessment:
- Targeted fix (one-liner, ignoring comments)
- Basically as low-risk as it gets. As noted in [bug 639728 comment 20](/show_bug.cgi?id=639728#c20 "RESOLVED FIXED - Crash [@ mozilla::DOMSVGPathSegList::ItemAt] with GC") (which added the original code that this bug extends), this has zero expected behavior-change, aside from fixing crashes. It just adds a kungFuDeathGrip in one (non-recursive) function, to keep something alive until the function returns.
Reward:
- Fixes an sg:crit, which is probably unlikely to be triggered by "real" web content, but which bad guys could be poking at now that this has landed on trunk.
I know release-train-bump-day is coming up in just over a week -- if we haven't already spun up our final Firefox 7 builds (or if we have, but we end up respinning them), it would be great to get this in.
(Minor logistical complication: I'm about to leave on a camping trip in an off-the-grid backwoodsy area, so I won't be able to land this on the branches myself, once approval is granted. I'm hoping jwatt or someone else can take care of that for me. :))
[Attachment #560424](/attachment.cgi?id=560424&action=edit "fix w/ added comment [r=jwatt]") -
Flags: approval-mozilla-beta?
[Attachment #560424](/attachment.cgi?id=560424&action=edit "fix w/ added comment [r=jwatt]") -
Flags: approval-mozilla-aurora?

|  | [LegNeato](/user_profile?user_id=482154) |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=686044#c15)• 13 years ago |
|  | |

Unless there is a reason why we would expect this to discovered externally we will wait as we are late in the game for Firefox 7 on beta. Denying approval for beta
[status-firefox7](/buglist.cgi?f1=cf_status_firefox7&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox7&o1=equals&v1=wontfix)

|  | [LegNeato](/user_profile?user_id=482154) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=686044#a857390_482154)• 13 years ago |

[Attachment #560424](/attachment.cgi?id=560424&action=edit "fix w/ added comment [r=jwatt]") -
Flags: approval-mozilla-beta? → approval-mozilla-beta-

|  | [Johnathan Nightingale [:johnath]](/user_profile?user_id=210757) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=686044#a1115935_210757)• 13 years ago |

[Attachment #560424](/attachment.cgi?id=560424&action=edit "fix w/ added comment [r=jwatt]") -
Flags: approval-mozilla-aurora? → approval-mozilla-aurora+

|  | [Jonathan Watt [:jwatt]](/user_profile?user_id=32767) |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=686044#c16)• 13 years ago |
|  | |

Pushed <https://hg.mozilla.org/releases/mozilla-aurora/rev/3d09765cc32f>

|  | [Jonathan Watt [:jwatt]](/user_profile?user_id=32767) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=686044#a1168840_32767)• 13 years ago |

[Attachment #560424](/attachment.cgi?id=560424&action=edit "fix w/ added comment [r=jwatt]") -
Flags: approval-mozilla-beta- → approval-mozilla-beta?

|  | [Jonathan Watt [:jwatt]](/user_profile?user_id=32767) |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=686044#c17)• 13 years ago |
|  | |

(In reply to Christian Legnitto [:LegNeato] from [comment #15](/show_bug.cgi?id=686044#c15 "VERIFIED FIXED - Crash with after path.pathSegList.appendItem and GC"))
> Unless there is a reason why we would expect this to discovered externally
> we will wait as we are late in the game for Firefox 7 on beta. Denying
> approval for beta
It seems to me that the push to aurora makes this very discoverable externally. We're pretty sure that malicious people are monitoring pushes containing bug numbers that can't be accessed (a good indication of a security fix), and reverse engineering exploits from those pushes. Hence renominating for beta. As Daniel said, this should be zero risk.
[status-firefox7](/buglist.cgi?f1=cf_status_firefox7&o1=isnotempty):
[wontfix](/buglist.cgi?f1=cf_status_firefox7&o1=equals&v1=wontfix) → [affected](/buglist.cgi?f1=cf_status_firefox7&o1=equals&v1=affected)

|  | [Jonathan Watt [:jwatt]](/user_profile?user_id=32767) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=686044#a1179671_32767)• 13 years ago |

[status-firefox8](/buglist.cgi?f1=cf_status_firefox8&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox8&o1=equals&v1=fixed)
[status-firefox9](/buglist.cgi?f1=cf_status_firefox9&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=fixed)
[tracking-firefox7](/buglist.cgi?f1=cf_tracking_firefox7&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox7&o1=equals&v1=%3F)

|  | [LegNeato](/user_profile?user_id=482154) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=686044#a1463446_482154)• 13 years ago |

[Attachment #560424](/attachment.cgi?id=560424&action=edit "fix w/ added comment [r=jwatt]") -
Flags: approval-mozilla-beta? → approval-mozilla-beta-

|  | [LegNeato](/user_profile?user_id=482154) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=686044#a1463698_482154)• 13 years ago |

[tracking-firefox7](/buglist.cgi?f1=cf_tracking_firefox7&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox7&o1=equals&v1=%3F) → [-](/buglist.cgi?f1=cf_tracking_firefox7&o1=equals&v1=-)

|  | [u279076](/user_profile?user_id=279076) |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=686044#c18)• 13 years ago |
|  | |

qa+ for verification in Firefox 8 and 9 using the attached testcase.Whiteboard: [sg:critical] → [sg:critical][qa+]

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=686044#a2929378_12352)• 13 years ago |

[status-firefox10](/buglist.cgi?f1=cf_status_firefox10&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=fixed)
[tracking-firefox10](/buglist.cgi?f1=cf_tracking_firefox10&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox10&o1=equals&v1=%2B)
[tracking-firefox8](/buglist.cgi?f1=cf_tracking_firefox8&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox8&o1=equals&v1=%2B)
[tracking-firefox9](/buglist.cgi?f1=cf_tracking_firefox9&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox9&o1=equals&v1=%2B)

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074)  Assignee |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=686044#c19)• 13 years ago |
|  | |

Note: as with related [bug 669584](/show_bug.cgi?id=669584 "RESOLVED FIXED - The fix for bug 639728 forgot that items are created lazily") & [bug 639728](/show_bug.cgi?id=639728 "RESOLVED FIXED - Crash [@ mozilla::DOMSVGPathSegList::ItemAt] with GC"), this shouldn't affect 3.6.x. These are all bugs in SVG list code that was completely rewritten for Firefox 4.
Hence, setting status-1.9.\* = unaffected.
[status1.9.1](/buglist.cgi?f1=cf_status_191&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_191&o1=equals&v1=unaffected)
[status1.9.2](/buglist.cgi?f1=cf_status_192&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_192&o1=equals&v1=unaffected)

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074)  Assignee |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=686044#c20)• 13 years ago |
|  | |

FWIW, I tried to test this in Firefox 3.6.x to be absoulutely-positively sure of [Comment 19](/show_bug.cgi?id=686044#c19 "VERIFIED FIXED - Crash with after path.pathSegList.appendItem and GC"), but I can't, because dom fuzz lite doesn't support 3.6.x. (However, Jesse did give me a custom dom fuzz lite to try[1], with a different GC command[2], and I didn't hit the bug with that.)
From reading through the analogous 3.6.x code[3], it looks like our internal SVG list objects are the same as the heavyweight DOM objects -- whereas in Firefox >4, we create tearoffs when necessary for DOM objects. Without the on-the-fly tearoffs being created, there's no chance of this bug happening.
So, I'm confident that 1.9.\*=unaffected is correct.
[1] <https://www.squarefree.com/extensions/domFuzzLite-for-firefox-3.6.xpi>
[2] var evt = document.createEvent("Events"); evt.initEvent("please-gc", true, false); document.dispatchEvent(evt);
[3] <http://mxr.mozilla.org/firefox/source/content/svg/content/src/nsSVGPathSegList.cpp>

|  | [Martijn Wargers (dead)](/user_profile?user_id=55600) |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=686044#c21)• 13 years ago |
|  | |

Verified fixed in 11.0a1 (2011-12-01).Status: RESOLVED → VERIFIED

|  | [Martijn Wargers (dead)](/user_profile?user_id=55600) |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=686044#c22)• 13 years ago |
|  | |

Verified fixed in Mozilla/5.0 (Windows NT 6.1; rv:9.0) Gecko/20100101 Firefox/9.0Keywords: [verified-beta](/buglist.cgi?keywords=verified-beta&resolution=---)

|  | [Martijn Wargers (dead)](/user_profile?user_id=55600) |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=686044#c23)• 13 years ago |
|  | |

Verified fixed in Mozilla/5.0 (Windows NT 6.1; rv:10.0a2) Gecko/20111205 Firefox/10.0a2Keywords: [verified-aurora](/buglist.cgi?keywords=verified-aurora&resolution=---)

|  | [Martijn Wargers (dead)](/user_profile?user_id=55600) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=686044#a7494412_55600)• 13 years ago |

Whiteboard: [sg:critical][qa+] → [sg:critical][qa!]

|  | [Martijn Wargers (dead)](/user_profile?user_id=55600) |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=686044#c24)• 13 years ago |
|  | |

Fwiw, it's better to have testcase to not rely on extensions. It makes testing in older builds, across version, etc, easier.

|  | [Jesse Ruderman](/user_profile?user_id=11608)  Reporter |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=686044#c25)• 13 years ago |
|  | |

Martijn, how do you recommend forcing GC from a testcase?

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=686044#a11390875_1689)• 13 years ago |

Group: core-security
You need to [log in](/show_bug.cgi?id=686044&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Jesse Ruderman](/user_profile?user_id=11608)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from bugzilla.mozilla.org_391e7e93_20250126_060757.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Sat Jan 25 2025 22:07:56 PST

* **Bug ID:**
  646968,
  652054,
  665070,
  671160,
  672892,
  674843,
  675515,
  676918,
  677847,
  679593,
  686044

---

11 bugs found.

| [ID](/buglist.cgi?bug_id=646968%2C652054%2C665070%2C671160%2C672892%2C674843%2C675515%2C676918%2C677847%2C679593%2C686044&query_format=advanced&order=bug_id%20DESC&query_based_on=) | [Type](/buglist.cgi?bug_id=646968%2C652054%2C665070%2C671160%2C672892%2C674843%2C675515%2C676918%2C677847%2C679593%2C686044&query_format=advanced&order=bug_type%2Cbug_status%2Cpriority%2Cassigned_to%2Cbug_id&query_based_on=) | [Summary](/buglist.cgi?bug_id=646968%2C652054%2C665070%2C671160%2C672892%2C674843%2C675515%2C676918%2C677847%2C679593%2C686044&query_format=advanced&order=short_desc%2Cbug_status%2Cpriority%2Cassigned_to%2Cbug_id&query_based_on=) | [Product](/buglist.cgi?bug_id=646968%2C652054%2C665070%2C671160%2C672892%2C674843%2C675515%2C676918%2C677847%2C679593%2C686044&query_format=advanced&order=product%2Cbug_status%2Cpriority%2Cassigned_to%2Cbug_id&query_based_on=) | [Comp](/buglist.cgi?bug_id=646968%2C652054%2C665070%2C671160%2C672892%2C674843%2C675515%2C676918%2C677847%2C679593%2C686044&query_format=advanced&order=component%2Cbug_status%2Cpriority%2Cassigned_to%2Cbug_id&query_based_on=) | [Assignee▲](/buglist.cgi?bug_id=646968%2C652054%2C665070%2C671160%2C672892%2C674843%2C675515%2C676918%2C677847%2C679593%2C686044&query_format=advanced&order=assigned_to%20DESC%2Cbug_status%2Cpriority%2Cbug_id&query_based_on=) | [Status▲](/buglist.cgi?bug_id=646968%2C652054%2C665070%2C671160%2C672892%2C674843%2C675515%2C676918%2C677847%2C679593%2C686044&query_format=advanced&order=bug_status%20DESC%2Cpriority%2Cassigned_to%2Cbug_id&query_based_on=) | [Resolution](/buglist.cgi?bug_id=646968%2C652054%2C665070%2C671160%2C672892%2C674843%2C675515%2C676918%2C677847%2C679593%2C686044&query_format=advanced&order=resolution%2Cbug_status%2Cpriority%2Cassigned_to%2Cbug_id&query_based_on=) | [Updated](/buglist.cgi?bug_id=646968%2C652054%2C665070%2C671160%2C672892%2C674843%2C675515%2C676918%2C677847%2C679593%2C686044&query_format=advanced&order=changeddate%2Cbug_status%2Cpriority%2Cassigned_to%2Cbug_id&query_based_on=) |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |
| [679593](/show_bug.cgi?id=679593 "RESOLVED FIXED - Possible JSScript double-free") |  | [Possible JSScript double-free](/show_bug.cgi?id=679593) | Core | JavaScript Engine | bill.mccloskey | RESO | FIXE | 2012-01-19 |
| [665070](/show_bug.cgi?id=665070 "RESOLVED FIXED - WebGL functions allocating buffers/textures must check that the GL call succeeded, to prevent allowing context to make out-of-bounds accesses") |  | [WebGL functions allocating buffers/textures must check that the GL call succeeded, to prevent allowing context to make out-of-bounds accesses](/show_bug.cgi?id=665070) | Core | Graphics: CanvasWebG | jacob.benoit.1 | RESO | FIXE | 2015-10-16 |
| [646968](/show_bug.cgi?id=646968 "RESOLVED FIXED - let-block variable initializers are statically outside the let-scope but dynamically inside it") |  | [let-block variable initializers are statically outside the let-scope but dynamically inside it](/show_bug.cgi?id=646968) | Core | JavaScript Engine | jorendorff | RESO | FIXE | 2015-10-16 |
| [676918](/show_bug.cgi?id=676918 "RESOLVED FIXED - [ANGLE] crash from CanvasLayerD3D9::UpdateSurface [@ gl::Context::readPixels(int, int, int, int, unsigned int, unsigned int, void*) ]") |  | [[ANGLE] crash from CanvasLayerD3D9::UpdateSurface [@ gl::Context::readPixels(int, int, int, int, unsigned int, unsigned int, void\*) ]](/show_bug.cgi?id=676918) | Core | Graphics: CanvasWebG | nobody | RESO | FIXE | 2012-01-19 |
| [671160](/show_bug.cgi?id=671160 "VERIFIED FIXED - ASSERTION: Uh, inner window set as event target!") |  | [ASSERTION: Uh, inner window set as event target!](/show_bug.cgi?id=671160) | Toolkit | Password Manager | bzbarsky | VERI | FIXE | 2012-01-19 |
| [686044](/show_bug.cgi?id=686044 "VERIFIED FIXED - Crash with after path.pathSegList.appendItem and GC") |  | [Crash with after path.pathSegList.appendItem and GC](/show_bug.cgi?id=686044) | Core | SVG | dholbert | VERI | FIXE | 2012-01-19 |
| [652054](/show_bug.cgi?id=652054 "VERIFIED FIXED - Crash running jellyfish demo on 64-bit") |  | [Crash running jellyfish demo on 64-bit](/show_bug.cgi?id=652054) | Core | JavaScript Engine | dmandelin | VERI | FIXE | 2013-01-14 |
| [672892](/show_bug.cgi?id=672892 "VERIFIED FIXED - Crash [@ JSParseNode::append] or \"Assertion failure: !pn->pn_defn,\"") |  | [Crash [@ JSParseNode::append] or "Assertion failure: !pn->pn\_defn,"](/show_bug.cgi?id=672892) | Core | JavaScript Engine | jorendorff | VERI | FIXE | 2013-01-04 |
| [674843](/show_bug.cgi?id=674843 "VERIFIED FIXED - TM: Assertion failure: (ptrBits & 0x7) == 0 or Crash [@ js::gc::ArenaHeader::allocated]") |  | [TM: Assertion failure: (ptrBits & 0x7) == 0 or Crash [@ js::gc::ArenaHeader::allocated]](/show_bug.cgi?id=674843) | Core | JavaScript Engine | mail | VERI | FIXE | 2013-01-19 |
| [677847](/show_bug.cgi?id=677847 "VERIFIED FIXED - Crash [@ nsContentUtils::IsEventAttributeName ] at address 0x55555555 with malloc scribble") |  | [Crash [@ nsContentUtils::IsEventAttributeName ] at address 0x55555555 with malloc scribble](/show_bug.cgi?id=677847) | Core | General | smaug | VERI | FIXE | 2020-12-10 |
| [675515](/show_bug.cgi?id=675515 "VERIFIED FIXED - Crash [@ TextUpdater::DoUpdate] with long text node") |  | [Crash [@ TextUpdater::DoUpdate] with long text node](/show_bug.cgi?id=675515) | Core | Disability Access AP | surkov.alexander | VERI | FIXE | 2012-01-19 |

11 bugs found.

|  |  | [REST](/rest/bug?include_fields=id,summary,status&bug_id=646968%2C652054%2C665070%2C671160%2C672892%2C674843%2C675515%2C676918%2C677847%2C679593%2C686044 "Query as a REST API request") | [CSV](/buglist.cgi?bug_id=646968%2C652054%2C665070%2C671160%2C672892%2C674843%2C675515%2C676918%2C677847%2C679593%2C686044&query_format=advanced&ctype=csv&human=1) | [Feed](/buglist.cgi?bug_id=646968%2C652054%2C665070%2C671160%2C672892%2C674843%2C675515%2C676918%2C677847%2C679593%2C686044&query_format=advanced&title=Bug%20List&ctype=atom) | [iCalendar](/buglist.cgi?bug_id=646968%2C652054%2C665070%2C671160%2C672892%2C674843%2C675515%2C676918%2C677847%2C679593%2C686044&query_format=advanced&ctype=ics)  [Change Columns](/colchange.cgi?bug_id=646968%2C652054%2C665070%2C671160%2C672892%2C674843%2C675515%2C676918%2C677847%2C679593%2C686044&query_format=advanced&query_based_on=) | [Edit Search](/query.cgi?bug_id=646968%2C652054%2C665070%2C671160%2C672892%2C674843%2C675515%2C676918%2C677847%2C679593%2C686044&query_format=advanced) |  | as |
| --- | --- | --- | --- | --- | --- |



=== Content from lists.opensuse.org_6a163f8b_20250125_045746.html ===


[![openSUSE](https://static.opensuse.org/favicon.svg)
Mailing Lists](/archives/ "openSUSE Mailing Lists")

[Sign In](/accounts/login/?next=/archives/list/security-announce%40lists.opensuse.org/message/53HPEPJ3B5HA7F2UY5QE6TNIHQTHO6CE/)
[Sign Up](/accounts/signup/?next=/archives/list/security-announce%40lists.opensuse.org/message/53HPEPJ3B5HA7F2UY5QE6TNIHQTHO6CE/)

[Manage this list](/manage/lists/security-announce.lists.opensuse.org/)
[Sign In](/accounts/login/?next=/archives/list/security-announce%40lists.opensuse.org/message/53HPEPJ3B5HA7F2UY5QE6TNIHQTHO6CE/)
[Sign Up](/accounts/signup/?next=/archives/list/security-announce%40lists.opensuse.org/message/53HPEPJ3B5HA7F2UY5QE6TNIHQTHO6CE/)

×
#### Keyboard Shortcuts

### Thread View

* `j`: Next unread message
* `k`: Previous unread message
* `j a`: Jump to all threads* `j l`: Jump to MailingList overview

[thread](/archives/list/security-announce%40lists.opensuse.org/thread/53HPEPJ3B5HA7F2UY5QE6TNIHQTHO6CE/#53HPEPJ3B5HA7F2UY5QE6TNIHQTHO6CE)

# [security-announce] SUSE-SU-2011:1256-1: critical: Security update for Mozilla Firefox

![](https://seccdn.libravatar.org/avatar/099a17325bdf082b643d1a6bbacde279.jpg?s=120&d=mm&r=g)
## [opensuse-security＠opensuse.org](/archives/users/1b72def497ef4503896cd7a5fe9fb8e0/ "See the profile for opensuse-security＠opensuse.org")

17 Nov
2011

17 Nov
'11

22:08

SUSE Security Update: Security update for Mozilla Firefox
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
Announcement ID: SUSE-SU-2011:1256-1
Rating: critical
References: #726096 #728520
Cross-References: CVE-2011-2372 CVE-2011-2996 CVE-2011-2998
CVE-2011-2999 CVE-2011-3000 CVE-2011-3001
CVE-2011-3647 CVE-2011-3648 CVE-2011-3649
CVE-2011-3650 CVE-2011-3651 CVE-2011-3653
CVE-2011-3655
Affected Products:
SUSE Linux Enterprise Software Development Kit 11 SP1
SUSE Linux Enterprise Server 11 SP1 for VMware
SUSE Linux Enterprise Server 11 SP1
SUSE Linux Enterprise Desktop 11 SP1
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
An update that fixes 13 vulnerabilities is now available.
It includes three new package versions.
Description:
MozillaFirefox has been updated to version 1.9.2.24
(bnc#728520) to fix the following security issues:
\* MFSA 2011-46/CVE-2011-3647 (bmo#680880) loadSubScript
unwraps XPCNativeWrapper scope parameter
\* MFSA 2011-47/CVE-2011-3648 (bmo#690225) Potential XSS
against sites using Shift-JIS
\* MFSA 2011-49/CVE-2011-3650 (bmo#674776) Memory
corruption while profiling using Firebug
Security Issue references:
\* CVE-2011-3648
<<http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2011-3648>

...

\* CVE-2011-3000
<<http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2011-3000>

...

\* CVE-2011-3001
<<http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2011-3001>

...

\* CVE-2011-3647
<<http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2011-3647>

...

\* CVE-2011-2372
<<http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2011-2372>

...

\* CVE-2011-2999
<<http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2011-2999>

...

\* CVE-2011-3650
<<http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2011-3650>

...

\* CVE-2011-2998
<<http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2011-2998>

...

\* CVE-2011-2996
<<http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2011-2996>

...

\* CVE-2011-3655
<<http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2011-3655>

...

\* CVE-2011-3653
<<http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2011-3653>

...

\* CVE-2011-3649
<<http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2011-3649>

...

\* CVE-2011-3651
<<http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2011-3651>

...

Patch Instructions:
To install this SUSE Security Update use YaST online\_update.
Alternatively you can run the command listed for your product:
- SUSE Linux Enterprise Software Development Kit 11 SP1:
zypper in -t patch sdksp1-MozillaFirefox-5429
- SUSE Linux Enterprise Server 11 SP1 for VMware:
zypper in -t patch slessp1-MozillaFirefox-5429
- SUSE Linux Enterprise Server 11 SP1:
zypper in -t patch slessp1-MozillaFirefox-5429
- SUSE Linux Enterprise Desktop 11 SP1:
zypper in -t patch sledsp1-MozillaFirefox-5429
To bring your system up-to-date, use "zypper patch".
Package List:
- SUSE Linux Enterprise Software Development Kit 11 SP1 (i586 ia64 ppc64 s390x x86\_64) [New Version: 1.9.2.24 and 3.13.1]:
mozilla-nss-devel-3.13.1-0.2.1
mozilla-xulrunner192-devel-1.9.2.24-0.3.1
- SUSE Linux Enterprise Software Development Kit 11 SP1 (s390x x86\_64) [New Version: 1.9.2.24]:
mozilla-xulrunner192-gnome-32bit-1.9.2.24-0.3.1
mozilla-xulrunner192-translations-32bit-1.9.2.24-0.3.1
- SUSE Linux Enterprise Software Development Kit 11 SP1 (ppc64) [New Version: 1.9.2.24]:
mozilla-xulrunner192-gnome-32bit-1.9.2.24-0.3.2
mozilla-xulrunner192-translations-32bit-1.9.2.24-0.3.2
- SUSE Linux Enterprise Software Development Kit 11 SP1 (ia64) [New Version: 1.9.2.24]:
mozilla-xulrunner192-gnome-x86-1.9.2.24-0.3.1
mozilla-xulrunner192-translations-x86-1.9.2.24-0.3.1
- SUSE Linux Enterprise Server 11 SP1 for VMware (i586 x86\_64) [New Version: 3.13.1 and 3.6.24]:
MozillaFirefox-3.6.24-0.3.1
MozillaFirefox-translations-3.6.24-0.3.1
libfreebl3-3.13.1-0.2.1
mozilla-nss-3.13.1-0.2.1
mozilla-nss-tools-3.13.1-0.2.1
mozilla-xulrunner192-1.9.2.24-0.3.1
mozilla-xulrunner192-gnome-1.9.2.24-0.3.1
mozilla-xulrunner192-translations-1.9.2.24-0.3.1
- SUSE Linux Enterprise Server 11 SP1 for VMware (x86\_64) [New Version: 3.13.1]:
libfreebl3-32bit-3.13.1-0.2.1
mozilla-nss-32bit-3.13.1-0.2.1
mozilla-xulrunner192-32bit-1.9.2.24-0.3.1
- SUSE Linux Enterprise Server 11 SP1 (i586 ia64 ppc64 s390x x86\_64) [New Version: 1.9.2.24,3.13.1 and 3.6.24]:
MozillaFirefox-3.6.24-0.3.1
MozillaFirefox-translations-3.6.24-0.3.1
libfreebl3-3.13.1-0.2.1
mozilla-nss-3.13.1-0.2.1
mozilla-nss-tools-3.13.1-0.2.1
mozilla-xulrunner192-1.9.2.24-0.3.1
mozilla-xulrunner192-gnome-1.9.2.24-0.3.1
mozilla-xulrunner192-translations-1.9.2.24-0.3.1
- SUSE Linux Enterprise Server 11 SP1 (ppc64 s390x x86\_64) [New Version: 3.13.1]:
libfreebl3-32bit-3.13.1-0.2.1
mozilla-nss-32bit-3.13.1-0.2.1
- SUSE Linux Enterprise Server 11 SP1 (s390x x86\_64) [New Version: 1.9.2.24]:
mozilla-xulrunner192-32bit-1.9.2.24-0.3.1
- SUSE Linux Enterprise Server 11 SP1 (ppc64) [New Version: 1.9.2.24]:
mozilla-xulrunner192-32bit-1.9.2.24-0.3.2
- SUSE Linux Enterprise Server 11 SP1 (ia64) [New Version: 1.9.2.24 and 3.13.1]:
libfreebl3-x86-3.13.1-0.2.1
mozilla-nss-x86-3.13.1-0.2.1
mozilla-xulrunner192-x86-1.9.2.24-0.3.1
- SUSE Linux Enterprise Desktop 11 SP1 (i586 x86\_64) [New Version: 1.9.2.24,3.13.1 and 3.6.24]:
MozillaFirefox-3.6.24-0.3.1
MozillaFirefox-translations-3.6.24-0.3.1
libfreebl3-3.13.1-0.2.1
mozilla-nss-3.13.1-0.2.1
mozilla-nss-tools-3.13.1-0.2.1
mozilla-xulrunner192-1.9.2.24-0.3.1
mozilla-xulrunner192-gnome-1.9.2.24-0.3.1
mozilla-xulrunner192-translations-1.9.2.24-0.3.1
- SUSE Linux Enterprise Desktop 11 SP1 (x86\_64) [New Version: 1.9.2.24 and 3.13.1]:
libfreebl3-32bit-3.13.1-0.2.1
mozilla-nss-32bit-3.13.1-0.2.1
mozilla-xulrunner192-32bit-1.9.2.24-0.3.1
mozilla-xulrunner192-gnome-32bit-1.9.2.24-0.3.1
mozilla-xulrunner192-translations-32bit-1.9.2.24-0.3.1
References:
<http://support.novell.com/security/cve/CVE-2011-2372.html>
<http://support.novell.com/security/cve/CVE-2011-2996.html>
<http://support.novell.com/security/cve/CVE-2011-2998.html>
<http://support.novell.com/security/cve/CVE-2011-2999.html>
<http://support.novell.com/security/cve/CVE-2011-3000.html>
<http://support.novell.com/security/cve/CVE-2011-3001.html>
<http://support.novell.com/security/cve/CVE-2011-3647.html>
<http://support.novell.com/security/cve/CVE-2011-3648.html>
<http://support.novell.com/security/cve/CVE-2011-3649.html>
<http://support.novell.com/security/cve/CVE-2011-3650.html>
<http://support.novell.com/security/cve/CVE-2011-3651.html>
<http://support.novell.com/security/cve/CVE-2011-3653.html>
<http://support.novell.com/security/cve/CVE-2011-3655.html>
<https://bugzilla.novell.com/726096>
<https://bugzilla.novell.com/728520>
[http://download.novell.com/patch/finder/?keywords=c78d5ba357ca9d7cf302f1609e...](http://download.novell.com/patch/finder/?keywords=c78d5ba357ca9d7cf302f1609efa467f)
--
To unsubscribe, e-mail: opensuse-security-announce+unsubscribe@opensuse.org
For additional commands, e-mail: opensuse-security-announce+help@opensuse.org

[0](#like "You must be logged-in to vote.")
[0](#dislike "You must be logged-in to vote.")

Reply

[Sign in to reply online](/accounts/login/?next=/archives/list/security-announce%40lists.opensuse.org/message/53HPEPJ3B5HA7F2UY5QE6TNIHQTHO6CE/)
Use email software

[Back to the thread](/archives/list/security-announce%40lists.opensuse.org/thread/53HPEPJ3B5HA7F2UY5QE6TNIHQTHO6CE/#53HPEPJ3B5HA7F2UY5QE6TNIHQTHO6CE)

[Back to the list](/archives/list/security-announce%40lists.opensuse.org/)

![HyperKitty](/static/hyperkitty/img/logo.png)
Powered by [HyperKitty](http://hyperkitty.readthedocs.org) version 1.3.12.



=== Content from bugzilla.mozilla.org_04d4c200_20250125_045753.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/652054)
* [XML](/show_bug.cgi?ctype=xml&id=652054)

Closed
[Bug 652054](/show_bug.cgi?id=652054)

Opened 14 years ago
Closed 13 years ago

# Crash running jellyfish demo on 64-bit

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Crash running jellyfish demo on 64-bit

## Categories

### (Core :: JavaScript Engine, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=JavaScript%20Engine#JavaScript%20Engine)

JavaScript Engine
▾

Core :: JavaScript Engine
The interpreter engine for the core JavaScript language, independent of the browser's object model. File ONLY core JavaScript language bugs in this category. For bugs involving browser objects such as "window" and "document", use the "DOM" component. For bugs involving calls between JavaScript and C++, use the "XPConnect" component.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=JavaScript%20Engine&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=JavaScript%20Engine&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=JavaScript%20Engine)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

x86\_64

macOS

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

critical

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla9

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Webcompat Priority | --- |
| --- | --- |
| Performance Impact | --- |
| Webcompat Score | --- |
| a11y-review | --- |
| Accessibility Severity | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox5 | [-](/buglist.cgi?f1=cf_tracking_firefox5&o1=equals&v1=-) | [wontfix](/buglist.cgi?f1=cf_status_firefox5&o1=equals&v1=wontfix) |
| firefox6 | [-](/buglist.cgi?f1=cf_tracking_firefox6&o1=equals&v1=-) | [wontfix](/buglist.cgi?f1=cf_status_firefox6&o1=equals&v1=wontfix) |
| firefox7 | [+](/buglist.cgi?f1=cf_tracking_firefox7&o1=equals&v1=%2B) | [wontfix](/buglist.cgi?f1=cf_status_firefox7&o1=equals&v1=wontfix) |
| firefox8 | [+](/buglist.cgi?f1=cf_tracking_firefox8&o1=equals&v1=%2B) | [verified](/buglist.cgi?f1=cf_status_firefox8&o1=equals&v1=verified) |
| firefox9 | [+](/buglist.cgi?f1=cf_tracking_firefox9&o1=equals&v1=%2B) | [verified](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=verified) |
| firefox10 | [+](/buglist.cgi?f1=cf_tracking_firefox10&o1=equals&v1=%2B) | [verified](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=verified) |
| status1.9.2 | --- | [unaffected](/buglist.cgi?f1=cf_status_192&o1=equals&v1=unaffected) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox5 | - | wontfix |
| firefox6 | - | wontfix |
| firefox7 | + | wontfix |
| firefox8 | + | verified |
| firefox9 | + | verified |
| firefox10 | + | verified |
| status1.9.2 |  | unaffected |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: bzbarsky, Assigned: dmandelin)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/a86fae4b06c1570a6c1a1bc1c5a6c1f6?d=mm&size=40)  [dmandelin](/user_profile?user_id=294323)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](extensions/Gravatar/web/default.jpg)  [bzbarsky](/user_profile?user_id=20209)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/4fe52ee1503aecf7b6c976b8eb7c1753?d=mm&size=40)  [willyelm](/user_profile?user_id=714609)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

15 people

## References

### ( [URL](http://chrysaora.com/ "http://chrysaora.com/") )

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[chrysaora.com](http://chrysaora.com/ "http://chrysaora.com/")

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: crash, testcase, verified-beta, Whiteboard: [sg:critical?], [qa!])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[crash](/buglist.cgi?keywords=crash&resolution=---),
[testcase](/buglist.cgi?keywords=testcase&resolution=---),
[verified-beta](/buglist.cgi?keywords=verified-beta&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[sg:critical?], [qa!]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [decoder](/user_profile?user_id=395101) | [in-testsuite](#c51 "12 years ago") | + |
| --- | --- | --- |
| [decoder](/user_profile?user_id=395101) | in-testsuite | + |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (3 files, 2 obsolete files)

| [Test case for browser](/attachment.cgi?id=533033)  [14 years ago](#c6)  [Christian Holler (:decoder)](/user_profile?user_id=395101)   3.32 KB, text/html |  | [Details](/attachment.cgi?id=533033&action=edit) |
| --- | --- | --- |
| [Test case for shell (run with -j -m)](/attachment.cgi?id=533072)  [14 years ago](#c8)  [Christian Holler (:decoder)](/user_profile?user_id=395101)   2.28 KB, application/javascript |  | [Details](/attachment.cgi?id=533072&action=edit) |
| [Patch](/attachment.cgi?id=533504)  [14 years ago](#c12)  [David Mandelin [:dmandelin]](/user_profile?user_id=294323)   3.08 KB, patch | n.nethercote : [review+](#c16 "14 years ago")  christian : [approval-mozilla-aurora+](#a11294299_482154 "13 years ago") | [Details](/attachment.cgi?id=533504&action=edit) | [Diff](/attachment.cgi?id=533504&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=652054&attachment=533504) |
| [Test case for shell (run with -j -m)](/attachment.cgi?id=556712)  [13 years ago](#c31)  [Christian Holler (:decoder)](/user_profile?user_id=395101)   69 bytes, application/javascript |  | [Details](/attachment.cgi?id=556712&action=edit) |
| [Test case for shell (run with -j -m)](/attachment.cgi?id=556714)  [13 years ago](#c32)  [Christian Holler (:decoder)](/user_profile?user_id=395101)   1.26 KB, application/javascript |  | [Details](/attachment.cgi?id=556714&action=edit) |

Show Obsolete

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=652054#c0)• 14 years ago |
|  | |

BUILD: Current trunk nightly and my optimized self-build
STEPS TO REPRODUCE:
1) Disable content methodjit
2) Load <http://chrysaora.com/>
EXPECTED RESULTS: no crash
ACTUAL RESULTS: crash
ADDITIONAL INFORMATION: I submitted some nightly crash reports:
<https://crash-stats.mozilla.com/report/index/bp-f730c485-b35c-4ba7-92dd-7793b2110421>
<https://crash-stats.mozilla.com/report/index/d66398e6-085a-4218-b732-dcaab2110421>
<https://crash-stats.mozilla.com/report/index/674db722-65e2-4950-bd31-f30272110421>
Looks like a null-deref, but can't say more than that. We're definitely crashing on trace. Interestingly, my 32-bit debug build does NOT hit the crash. My 64-bit builds do.
I don't quite know where the null-deref comes from. Some info from gdb:
Program received signal EXC\_BAD\_ACCESS, Could not access memory.
Reason: 13 at address: 0x0000000000000000
0x0000000126ab3759 in ?? ()
(gdb) p $pc
$4 = (void (\*)(void)) 0x126ab3759
(gdb) disas $pc-50 $pc+20
Dump of assembler code from 0x126ab3727 to 0x126ab376d:
0x0000000126ab3727: add %al,(%rax)
0x0000000126ab3729: sbb %al,0x66(%rax)
0x0000000126ab372c: movd %rsi,%mm4
0x0000000126ab3730: mulsd %xmm7,%xmm2
0x0000000126ab3734: addsd %xmm2,%xmm15
0x0000000126ab3739: mov $0x7ff8000000000000,%rsi
0x0000000126ab3743: movd %rsi,%xmm2
0x0000000126ab3748: mulsd %xmm5,%xmm1
0x0000000126ab374c: addsd %xmm1,%xmm15
0x0000000126ab3751: xorps %xmm1,%xmm1
0x0000000126ab3754: cvtsd2ss %xmm15,%xmm1
0x0000000126ab3759: movss %xmm1,0x0(%rsi)
0x0000000126ab375e: mov $0x0,%esi
0x0000000126ab3763: movd %rsi,%xmm1
0x0000000126ab3768: lea 0x34(%rbx),%rsi
0x0000000126ab376c: lea 0x3c(%rbx),%rsi
(gdb) info reg rsi
rsi 0x7ff8000000000000 9221120237041090560
I guess 0x7ff8000000000000 is a non-canonical address and chances are that's what's killing us.... But not sure.
I can reproduce this at will, so if there's something else useful I can report, please let me know.

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Reporter |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=652054#c1)• 14 years ago |
|  | |

Relevant "native,afterdce" output:
------------------------------ # JSOP\_ADD
addd34 = addd addd35, muld72
0x11ceab899 addsd xmm15, xmm2
0x11ceab89e movq rsi, 0x7ff8000000000000
0x11ceab8a8 movq xmm2, rsi <= restore immd1/\*nan\*/
------------------------------ # JSOP\_GETLOCAL
------------------------------ # JSOP\_GETLOCAL
------------------------------ # JSOP\_MUL
muld71 = muld cmovd203, cmovd191
0x11ceab8ad mulsd xmm1, xmm5
------------------------------ # JSOP\_ADD
addd33 = addd addd34, muld71
0x11ceab8b1 addsd xmm15, xmm1
------------------------------ # JSOP\_SETELEM
std2f.tdata addq242[0] = addd33
0x11ceab8b6 xorps xmm1, xmm1
0x11ceab8b9 cvtsd2ss cl, xmm15
0x11ceab8be movss 0(rsi), xmm1
0x11ceab8c3 movl esi, 0
0x11ceab8c8 movq xmm1, rsi
0x11ceab8cd leaq rsi, 52(rbx) <= restore addq242
0x11ceab8d1 leaq rsi, 60(rbx) <= restore addq240
In this case the crash is on 0x11ceab8be.
Note those restores, which come \_after\_ we try to write to rsi(0). Our earlier computation of addq242 looked like this:
------------------------------ # JSOP\_GETELEM
inRange533 = gtui typedArrayLength56, immi10/\*13\*/
xf831: xf inRange533 -> exit=0x1270ab0c0 pc=0x11986ee0a imacpc=0x0 sp+368 rp+16 BRANCH
0x11ce6b37f cmpl edi, 13
0x11ce6b382 jna 0x11ce83601
----------------------------------- ## BEGIN exit block (LIR\_xt|LIR\_xf)
...
----------------------------------- ## END exit block 0x106ad1460
addq242 = addq typedElems56, immq4/\*52LL\*/
0x11ce6b388 movq r9, rbx
0x11ce6b38b addq r9, 52
(I'm not sure why we do that, since the next thing we do is to load 0(r9) into xmm5, but whatever. In any case, it looks like the restore is restoring the right thing... but too late.

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Reporter |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=652054#c2)• 14 years ago |
|  | |

Looking back at the readlir output, the place where we compute addq242 is:
21074: ------------------------------ # JSOP\_GETELEM
21075: inRange533 = gtui typedArrayLength56, immi10/\*13\*/
21076: xf829: xf inRange533 -> exit=0x128c5c948 pc=0x11986ee0a imacpc=0x0 sp+368 rp+16 BRANCH
21077: addq242 = addq typedElems56, immq4/\*52LL\*/
21078: ldf2d193 = ldf2d.tdata addq242[0]
and then we have 600-some LIR instructions before the next use of addq242:
21712: ------------------------------ # JSOP\_SETELEM
21713: std2f.tdata addq242[0] = addd33
which is the thing that ends up crashing.

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Reporter |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=652054#c3)• 14 years ago |
|  | |

I tried logging regalloc while running this, but 40 minutes later there's still no crash, so either it's just being too slow or it's not crashing when logging regalloc.... I think the former; it didn't crash on TMFLAGS=full either.

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=652054#a1514697_20209)• 14 years ago |

Hardware: x86 → x86\_64

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=652054#c4)• 14 years ago |
|  | |

I was able to reproduce this, although loading takes a while with pure software rendering. I'll try to minimize this a bit now.

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=652054#c5)• 14 years ago |
|  | |

It takes quite a while to reproduce this because it requires WebGL and I only have software rendering available on the host machine. One automatic test takes approximately 1 minute right now inside an Xvfb. Delta is currently running on the javascripts inside the page to get rid of the unnecessary code.

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=652054#c6)• 14 years ago |
|  | |

Attached file
[Test case for browser](attachment.cgi?id=533033)
— [Details](attachment.cgi?id=533033&action=edit)

Here is the reduced testcase, I couldn't get it much smaller with my automatic tools. This should crash instantly (1-2 seconds).

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Reporter |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=652054#c7)• 14 years ago |
|  | |

Yep, so it does.
It crashes Fx4 as well...
How can we get someone to look at this? This crash is looking really scary to me.Keywords: [crash](/buglist.cgi?keywords=crash&resolution=---)

|  | [Jesse Ruderman](/user_profile?user_id=11608) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=652054#a2212914_11608)• 14 years ago |

Group: core-security

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=652054#c8)• 14 years ago |
|  | |

Attached file
[Test case for shell (run with -j -m)](attachment.cgi?id=533072) (obsolete)
— [Details](attachment.cgi?id=533072&action=edit)

I made it to turn the test into a shell testcase and reduced it further with LangDDMin. This test crashes even with methodjit enabled. S-s until this is resolved or confirmed harmless.
Backtrace:
==32287== Invalid write of size 4
==32287== at 0x41CC833: ???
==32287== by 0x5D55C8: js::ExecuteTrace(JSContext\*, js::TraceMonitor\*, nanojit::Fragment\*, js::TracerState&) (jstracer.cpp:6517)
==32287== by 0x5D5BE5: js::ExecuteTree(JSContext\*, js::TraceMonitor\*, js::TreeFragment\*, unsigned int&, js::VMSideExit\*\*, js::VMSideExit\*\*) (jstracer.cpp:6623)
==32287== by 0x5D73B5: js::RecordLoopEdge(JSContext\*, js::TraceMonitor\*, unsigned int&) (jstracer.cpp:7163)
==32287== by 0x601709: js::MonitorLoopEdge(JSContext\*, unsigned int&, js::InterpMode) (jstracer.cpp:17447)
==32287== by 0x6F5D77: js::Interpret(JSContext\*, js::StackFrame\*, unsigned int, js::InterpMode) (jsinterp.cpp:3469)
==32287== by 0x5FEA19: js::RecordTracePoint(JSContext\*, js::TraceMonitor\*, unsigned int&, bool\*, bool) (jstracer.cpp:16810)
==32287== by 0x5FF209: js::MonitorTracePoint(JSContext\*, unsigned int&, bool\*, void\*\*, unsigned int\*, unsigned int\*, unsigned int) (jstracer.cpp:16967)
==32287== by 0x6C2F6A: RunTracer(js::VMFrame&, js::mjit::ic::TraceICInfo&) (InvokeHelpers.cpp:967)
==32287== by 0x6C324C: js::mjit::stubs::InvokeTracer(js::VMFrame&, js::mjit::ic::TraceICInfo\*) (InvokeHelpers.cpp:1057)
==32287== by 0x41B601B: ???
==32287== by 0x654831: js::mjit::EnterMethodJIT(JSContext\*, js::StackFrame\*, void\*, js::Value\*) (MethodJIT.cpp:685)
==32287== Address 0x7ff8000000000000 is not stack'd, malloc'd or (recently) free'd
==32287==
==32287==
==32287== Process terminating with default action of signal 11 (SIGSEGV)
==32287== General Protection Fault

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Reporter |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=652054#c9)• 14 years ago |
|  | |

OK. Given that, I'm picking a random assignee. Please reassign as needed or prove this is not exploitable...Assignee: general → dvander

|  | [David Mandelin [:dmandelin]](/user_profile?user_id=294323)  Assignee |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=652054#c10)• 14 years ago |
|  | |

David's busy with IonMonkey. If you need a random assignee for JS bugs, pick me.Assignee: dvander → dmandelin

|  | [David Mandelin [:dmandelin]](/user_profile?user_id=294323)  Assignee |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=652054#c11)• 14 years ago |
|  | |

OK, here's the bug. First, bz's spew, with some comments. Read the comments from bottom to top, since that's the way nanojit generates code:
------------------------------ # JSOP\_ADD
addd34 = addd addd35, muld72
0x11ceab899 addsd xmm15, xmm2
0x11ceab89e movq rsi, 0x7ff8000000000000
0x11ceab8a8 movq xmm2, rsi <= restore immd1/\*nan\*/
// 6. rsi is free, so feel free to grab it as a temporary. This clobbers
// addq242.
------------------------------ # JSOP\_GETLOCAL
------------------------------ # JSOP\_GETLOCAL
------------------------------ # JSOP\_MUL
muld71 = muld cmovd203, cmovd191
0x11ceab8ad mulsd xmm1, xmm5
------------------------------ # JSOP\_ADD
addd33 = addd addd34, muld71
0x11ceab8b1 addsd xmm15, xmm1
// 5. At this point, the register state (not shown here) thinks rsi is free.
------------------------------ # JSOP\_SETELEM
std2f.tdata addq242[0] = addd33
0x11ceab8b6 xorps xmm1, xmm1
0x11ceab8b9 cvtsd2ss cl, xmm15
0x11ceab8be movss 0(rsi), xmm1
// 4. Store to the array using rsi. This is supposed to represent addq242.
// We restore addq242. Clearly, someone has evicted addq242, but they
// generated the restore code for addq242 \*below\* its first use.
0x11ceab8c3 movl esi, 0
0x11ceab8c8 movq xmm1, rsi
// 3. Above 2 instructions use rsi as a temp to load a value into xmm1.
// This is actually restore code for xmm1, which we are also taking
// here (all fp regs are in use).
0x11ceab8cd leaq rsi, 52(rbx) <= restore addq242
// 2. Now, restore rsi again. That makes no sense. Anyway, we are restoring
// addq242 here, so remember that.
0x11ceab8d1 leaq rsi, 60(rbx) <= restore addq240
// 1. Above, restore rsi for later use, since we're about to take it here.
// That makes sense.
The bug is at point 2: restoring rsi \*after\* its use instead of just before. The cause is in Assembler::asm\_store64, the LIR\_std2f case. I annotate to show what happens here.
case LIR\_std2f: {
// 1. getBaseReg picks rax. This will be used for the base
// address for the store. This also happens to be addq242.
// Fine so far.
Register b = getBaseReg(base, d, BaseRegs);
// 2. findRegFor gets an fp reg.
Register r = findRegFor(value, FpRegs);
// 3. registerAllocTmp wants another fp reg. But there are
// now none left. So it evicts xmm1. In order to do this,
// it must generate the restore code. xmm1 holds the
// value 0, so it generates
// 0x11ceab8c3 movl esi, 0
// 0x11ceab8c8 movq xmm1, rsi
// But it needs a gp temp reg for that code first. evict
// calls registerAllocTmp to do this. That picks rax,
// evicts it, and generates spill code. But we're about
// to use rax, so that loses.
Register t = registerAllocTmp(FpRegs & ~rmask(r));
MOVSSMR(t, d, b); // store
CVTSD2SS(t, r); // cvt to single-precision
XORPS(t); // break dependency chains
break;

|  | [David Mandelin [:dmandelin]](/user_profile?user_id=294323)  Assignee |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=652054#c12)• 14 years ago |
|  | |

Attached patch

[Patch](attachment.cgi?id=533504&action=diff)
— [Details](attachment.cgi?id=533504&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=652054&attachment=533504)

Simple fix. Boiled down from the previous comment, the problem is that regsterAllocTmp(FpRegs), if it needs to spill, can take a GpReg as a temporary, which may clobber the assignment made by getBaseReg(..., BaseRegs). By putting the call to getBaseReg last, we fix this, because getBaseReg(..., BaseRegs) cannot evict an FpReg (so the call to findRegFor is OK).
This prevents the crash in this test case. I didn't add it as a new test in the patch because it seems to run a long time.
I also fixed a spew bug in CVTSD2SS.
[Attachment #533504](/attachment.cgi?id=533504&action=edit "Patch") -
Flags: review?(nnethercote)

|  | [Nicholas Nethercote [inactive]](/user_profile?user_id=334849) |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=652054#c13)• 14 years ago |
|  | |

Comment on [attachment 533504](/attachment.cgi?id=533504 "Patch") [[details]](/attachment.cgi?id=533504&action=edit "Patch") [[diff]](/attachment.cgi?id=533504&action=diff "Patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=652054&attachment=533504)
Patch
Review of [attachment 533504](/attachment.cgi?id=533504 "Patch") [[details]](/attachment.cgi?id=533504&action=edit "Patch") [[diff]](/attachment.cgi?id=533504&action=diff "Patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=652054&attachment=533504):
-----------------------------------------------------------------
The change is unsafe, see below.
::: js/src/nanojit/NativeX64.cpp
@@ +1726,2 @@
> Register r = findRegFor(value, FpRegs);
> Register t = registerAllocTmp(FpRegs & ~rmask(r));
The comment on registerAllocTmp() says this:
"Finds a register in 'allow' to store a temporary value (one not
associated with a particular LIns), evicting one if necessary. The
returned register is marked as being free and so can only be safely
used for code generation purposes until the regstate is next inspected
or updated."
getBaseReg() inspects and updates the regstate, so reordering is not safe
here.
I think the proper fix might be to keep the current order, but exclude |b|
from registerAllocTmp()'s allow set, eg:
Register t = registerAllocTmp(FpRegs & ~(rmask(r)|rmask(b)));
Can you try that? Hopefully it'll work. If not, things get more
complicated... a call to registerAllocTmp() causing another call to
registerAllocTmp() makes me nervous.
@@ +1726,3 @@
> Register r = findRegFor(value, FpRegs);
> Register t = registerAllocTmp(FpRegs & ~rmask(r));
> + Register b = getBaseReg(base, d, BaseRegs);
The comment on registerAllocTmp() says this:
"Finds a register in 'allow' to store a temporary value (one not
associated with a particular LIns), evicting one if necessary. The
returned register is marked as being free and so can only be safely
used for code generation purposes until the regstate is next inspected
or updated."
[Attachment #533504](/attachment.cgi?id=533504&action=edit "Patch") -
Flags: review?(nnethercote) → review-

|  | [Nicholas Nethercote [inactive]](/user_profile?user_id=334849) |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=652054#c14)• 14 years ago |
|  | |

Apologies for the repetition in that previous comment.

|  | [David Mandelin [:dmandelin]](/user_profile?user_id=294323)  Assignee |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=652054#c15)• 14 years ago |
|  | |

(In reply to [comment #13](/show_bug.cgi?id=652054#c13 "VERIFIED FIXED - Crash running jellyfish demo on 64-bit"))
> Comment on [attachment 533504](/attachment.cgi?id=533504 "Patch") [[details]](/attachment.cgi?id=533504&action=edit "Patch") [[diff]](/attachment.cgi?id=533504&action=diff "Patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=652054&attachment=533504) [review]
> Patch
>
> Review of [attachment 533504](/attachment.cgi?id=533504 "Patch") [[details]](/attachment.cgi?id=533504&action=edit "Patch") [[diff]](/attachment.cgi?id=533504&action=diff "Patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=652054&attachment=533504) [review]:
> -----------------------------------------------------------------
>
> The change is unsafe, see below.
>
> ::: js/src/nanojit/NativeX64.cpp
> @@ +1726,2 @@
> > Register r = findRegFor(value, FpRegs);
> > Register t = registerAllocTmp(FpRegs & ~rmask(r));
>
> The comment on registerAllocTmp() says this:
>
> "Finds a register in 'allow' to store a temporary value (one not
> associated with a particular LIns), evicting one if necessary. The
> returned register is marked as being free and so can only be safely
> used for code generation purposes until the regstate is next inspected
> or updated."
>
> getBaseReg() inspects and updates the regstate, so reordering is not safe
> here.
I believe it does happen to be safe here, because the call to getBaseReg only updates the integer regs part of the regstate, and |r| is an FpReg. But I agree that the code is pretty twitchy and a deeper fix may be wanted.
> I think the proper fix might be to keep the current order, but exclude |b|
> from registerAllocTmp()'s allow set, eg:
>
> Register t = registerAllocTmp(FpRegs & ~(rmask(r)|rmask(b)));
>
> Can you try that? Hopefully it'll work.
That doesn't work: b is an int reg, so subtracting it from FpRegs has no effect. (And I tested just to be sure.)
> If not, things get more
> complicated... a call to registerAllocTmp() causing another call to
> registerAllocTmp() makes me nervous.
Definitely. Besides the reordering, the other immediate idea I had was to add a parameter |forbiddenReg| to registerAllocTmp, with the meaning that registerAllocTmp is not allowed to evict |forbiddenReg| via any recursive call. That would then have to be pushed down through registerAlloc and evict.

|  | [Nicholas Nethercote [inactive]](/user_profile?user_id=334849) |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=652054#c16)• 14 years ago |
|  | |

Comment on [attachment 533504](/attachment.cgi?id=533504 "Patch") [[details]](/attachment.cgi?id=533504&action=edit "Patch") [[diff]](/attachment.cgi?id=533504&action=diff "Patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=652054&attachment=533504)
Patch
> I believe it does happen to be safe here, because the call to getBaseReg only
> updates the integer regs part of the regstate, and |r| is an FpReg.
Hmm, true, I give r+ so long as you write a comment explaining and include a pointer to this bug :)
[Attachment #533504](/attachment.cgi?id=533504&action=edit "Patch") -
Flags: review- → review+

|  | [Nicholas Nethercote [inactive]](/user_profile?user_id=334849) |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=652054#c17)• 14 years ago |
|  | |

Hmm, since it's a security bug, don't worry about the pointer to this bug.

|  | [David Anderson [:dvander] - inactive, e-mail if emergency](/user_profile?user_id=309316) |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=652054#c18)• 14 years ago |
|  | |

Or maybe mask out the temp reg from the other functions, just to be safe/explicit.

|  | [David Mandelin [:dmandelin]](/user_profile?user_id=294323)  Assignee |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=652054#c19)• 14 years ago |
|  | |

<http://hg.mozilla.org/tracemonkey/rev/354f0ee56b8e>Status: NEW → ASSIGNEDWhiteboard: fixed-in-tracemonkey

|  | [Chris Leary [:cdleary] (not checking bugmail)](/user_profile?user_id=374575) |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=652054#c20)• 14 years ago |
|  | |

cdleary-bot mozilla-central merge info:
<http://hg.mozilla.org/mozilla-central/rev/354f0ee56b8e>

|  | [Chris Leary [:cdleary] (not checking bugmail)](/user_profile?user_id=374575) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=652054#a2730925_374575)• 14 years ago |

Status: ASSIGNED → RESOLVEDClosed: 14 years agoResolution: --- → FIXED

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101) |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=652054#c21)• 13 years ago |
|  | |

My testcase from [comment #8](/show_bug.cgi?id=652054#c8 "VERIFIED FIXED - Crash running jellyfish demo on 64-bit") still crashes mozilla-central, mozilla-inbound and tracemonkey shells. Reopening this bug, as it doesn't seem to be fixed.Status: RESOLVED → REOPENEDResolution: FIXED → ---

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=652054#c22)• 13 years ago |
|  | |

Are you getting the same exploitable-looking symptoms from [comment 8](/show_bug.cgi?id=652054#c8 "VERIFIED FIXED - Crash running jellyfish demo on 64-bit") or is it possibly a different crash?

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=652054#a9565470_1689)• 13 years ago |

Whiteboard: fixed-in-tracemonkey → [sg:critical?] fixed-in-tracemonkey

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101) |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=652054#c23)• 13 years ago |
|  | |

Yes, the backtrace is exactly the same as in [comment 8](/show_bug.cgi?id=652054#c8 "VERIFIED FIXED - Crash running jellyfish demo on 64-bit"), involving 0x7ff8000000000000.

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101) |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=652054#c24)• 13 years ago |
|  | |

I analyzed this further, the patch was probably accidentally reverted here:
changeset: 70616:a163ff4b8bf1
user: Rick Reitmaier <rreitmai@adobe.com>
date: Fri May 20 16:01:11 2011 -0700
summary: [Bug 609393](/show_bug.cgi?id=609393 "RESOLVED FIXED - resourceConsistencyCheck x87 stack assert can fire") - resourceConsistencyCheck x87 stack assert can fire (r+wmaddox)
Also, the test should be included in the JS testsuite to avoid such situations.

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=652054#c25)• 13 years ago |
|  | |

This seems sg:moderate given that this is in a non-default configuration.
[status-firefox5](/buglist.cgi?f1=cf_status_firefox5&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox5&o1=equals&v1=wontfix)
[status-firefox6](/buglist.cgi?f1=cf_status_firefox6&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox6&o1=equals&v1=wontfix)
[status-firefox7](/buglist.cgi?f1=cf_status_firefox7&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox7&o1=equals&v1=affected)
[status-firefox8](/buglist.cgi?f1=cf_status_firefox8&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox8&o1=equals&v1=affected)
[tracking-firefox5](/buglist.cgi?f1=cf_tracking_firefox5&o1=isnotempty):
--- → [-](/buglist.cgi?f1=cf_tracking_firefox5&o1=equals&v1=-)
[tracking-firefox6](/buglist.cgi?f1=cf_tracking_firefox6&o1=isnotempty):
--- → [-](/buglist.cgi?f1=cf_tracking_firefox6&o1=equals&v1=-)
[tracking-firefox7](/buglist.cgi?f1=cf_tracking_firefox7&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox7&o1=equals&v1=%2B)
[tracking-firefox8](/buglist.cgi?f1=cf_tracking_firefox8&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox8&o1=equals&v1=%2B)Whiteboard: [sg:critical?] fixed-in-tracemonkey → [sg:moderate]

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101) |  |
| --- | --- | --- |
| [Comment 26](/show_bug.cgi?id=652054#c26)• 13 years ago |
|  | |

The shell testcase I posted in [comment 8](/show_bug.cgi?id=652054#c8 "VERIFIED FIXED - Crash running jellyfish demo on 64-bit") works with both JITs enabled, unlike the original website problem reported here. So this affects the default configuration, as far as I can see.

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Comment 27](/show_bug.cgi?id=652054#c27)• 13 years ago |
|  | |

Ok, sg:critical? it is, again, then. Should the title be updated here then too?Whiteboard: [sg:moderate] → [sg:critical?]

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101) |  |
| --- | --- | --- |
| [Comment 28](/show_bug.cgi?id=652054#c28)• 13 years ago |
|  | |

(In reply to Johnny Stenback (:jst, jst@mozilla.com) from [comment #27](/show_bug.cgi?id=652054#c27 "VERIFIED FIXED - Crash running jellyfish demo on 64-bit"))
> Ok, sg:critical? it is, again, then. Should the title be updated here then
> too?
True :) Removed the misleading title.Keywords: [testcase](/buglist.cgi?keywords=testcase&resolution=---)Summary: Crash running jellyfish demo with methodjit disabled on 64-bit → Crash running jellyfish demo on 64-bit

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Reporter |  |
| --- | --- | --- |
| [Comment 29](/show_bug.cgi?id=652054#c29)• 13 years ago |
|  | |

The title was based on the simplest steps to reproduce. But yes, this can trigger any time we're tracing....

|  | [David Mandelin [:dmandelin]](/user_profile?user_id=294323)  Assignee |  |
| --- | --- | --- |
| [Comment 30](/show_bug.cgi?id=652054#c30)• 13 years ago |
|  | |

(In reply to Christian Holler (:decoder) from [comment #24](/show_bug.cgi?id=652054#c24 "VERIFIED FIXED - Crash running jellyfish demo on 64-bit"))
> Also, the test should be included in the JS testsuite to avoid such
> situations.
The test seems to be very long-running or even infinite? Do you have a fast version? I thought about it while writing the patch but the bug is very subtle and writing a short JS program to expose it seems hard.

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101) |  |
| --- | --- | --- |
| [Comment 31](/show_bug.cgi?id=652054#c31)• 13 years ago |
|  | |

Attached file
[Test case for shell (run with -j -m)](attachment.cgi?id=556712) (obsolete)
— [Details](attachment.cgi?id=556712&action=edit)

Here's a much shorter testcase. Additionally, this test case does not loop infinitely with the fix applied. On both crashing and fixed version, it should terminate immediately.
[Attachment #533072](/attachment.cgi?id=533072&action=edit "Test case for shell (run with -j -m)") -
Attachment is obsolete: true

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101) |  |
| --- | --- | --- |
| [Comment 32](/show_bug.cgi?id=652054#c32)• 13 years ago |
|  | |

Attached file
[Test case for shell (run with -j -m)](attachment.cgi?id=556714)
— [Details](attachment.cgi?id=556714&action=edit)

Had the wrong file attached, this should be the right one...
[Attachment #556712](/attachment.cgi?id=556712&action=edit "Test case for shell (run with -j -m)") -
Attachment is obsolete: true

|  | [David Mandelin [:dmandelin]](/user_profile?user_id=294323)  Assignee |  |
| --- | --- | --- |
| [Comment 33](/show_bug.cgi?id=652054#c33)• 13 years ago |
|  | |

Relanded the right way:
<http://hg.mozilla.org/projects/nanojit-central/rev/e9ffcbaa90bc>

|  | [David Mandelin [:dmandelin]](/user_profile?user_id=294323)  Assignee |  |
| --- | --- | --- |
| [Comment 34](/show_bug.cgi?id=652054#c34)• 13 years ago |
|  | |

Relanded to m-i with test case, so it's fixed right away and for the test case.Whiteboard: [sg:critical?] → [sg:critical?][inbound]

|  | [David Mandelin [:dmandelin]](/user_profile?user_id=294323)  Assignee |  |
| --- | --- | --- |
| [Comment 35](/show_bug.cgi?id=652054#c35)• 13 years ago |
|  | |

The patch wasn't backed out before Beta, but it was for Aurora.
[status-firefox8](/buglist.cgi?f1=cf_status_firefox8&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox8&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox8&o1=equals&v1=fixed)

|  | [David Mandelin [:dmandelin]](/user_profile?user_id=294323)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=652054#a11215208_294323)• 13 years ago |

[Attachment #533504](/attachment.cgi?id=533504&action=edit "Patch") -
Flags: approval-mozilla-aurora?

|  | [LegNeato](/user_profile?user_id=482154) |  |
| --- | --- | --- |
| [Comment 36](/show_bug.cgi?id=652054#c36)• 13 years ago |
|  | |

It isn't clear from this bug what the proper action is. From the comments and status flags it sounds like you might want to be asking for approval on beta instead?

|  | [David Mandelin [:dmandelin]](/user_profile?user_id=294323)  Assignee |  |
| --- | --- | --- |
| [Comment 37](/show_bug.cgi?id=652054#c37)• 13 years ago |
|  | |

(In reply to Christian Legnitto [:LegNeato] from [comment #36](/show_bug.cgi?id=652054#c36 "VERIFIED FIXED - Crash running jellyfish demo on 64-bit"))
> It isn't clear from this bug what the proper action is. From the comments
> and status flags it sounds like you might want to be asking for approval on
> beta instead?
The bug was fixed, and then the fix was unintentionally reverted. The fix made it to Beta, but not the revert. Both the fix and the revert made it to Aurora. So only Aurora needs a relanding.

|  | [LegNeato](/user_profile?user_id=482154) |  |
| --- | --- | --- |
| [Comment 38](/show_bug.cgi?id=652054#c38)• 13 years ago |
|  | |

Ok, then the status flags were flipped, causing the confusion. Approved for aurora and I flipped the flags
[status-firefox7](/buglist.cgi?f1=cf_status_firefox7&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox7&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox7&o1=equals&v1=fixed)
[status-firefox8](/buglist.cgi?f1=cf_status_firefox8&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox8&o1=equals&v1=fixed) → [affected](/buglist.cgi?f1=cf_status_firefox8&o1=equals&v1=affected)

|  | [LegNeato](/user_profile?user_id=482154) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=652054#a11294299_482154)• 13 years ago |

[Attachment #533504](/attachment.cgi?id=533504&action=edit "Patch") -
Flags: approval-mozilla-aurora? → approval-mozilla-aurora+

|  | [David Mandelin [:dmandelin]](/user_profile?user_id=294323)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=652054#a11469449_294323)• 13 years ago |

Status: REOPENED → RESOLVEDClosed: 14 years ago → 13 years agoResolution: --- → FIXED

|  | [David Mandelin [:dmandelin]](/user_profile?user_id=294323)  Assignee |  |
| --- | --- | --- |
| [Comment 39](/show_bug.cgi?id=652054#c39)• 13 years ago |
|  | |

<http://hg.mozilla.org/releases/mozilla-aurora/rev/96c12e1c1c80>
[status-firefox8](/buglist.cgi?f1=cf_status_firefox8&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox8&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox8&o1=equals&v1=fixed)

|  | [(no longer active)](/user_profile?user_id=251051) |  |
| --- | --- | --- |
| [Comment 40](/show_bug.cgi?id=652054#c40)• 13 years ago |
|  | |

<http://hg.mozilla.org/mozilla-central/rev/663af1e15f0f>Whiteboard: [sg:critical?][inbound] → [sg:critical?]Target Milestone: --- → mozilla9

|  | [juan becerra [:juanb]](/user_profile?user_id=241759) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=652054#a12150706_241759)• 13 years ago |

Whiteboard: [sg:critical?] → [sg:critical?], [qa+]

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=652054#a12904434_1689)• 13 years ago |

[status1.9.2](/buglist.cgi?f1=cf_status_192&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_192&o1=equals&v1=unaffected)

|  | [u279076](/user_profile?user_id=279076) |  |
| --- | --- | --- |
| [Comment 41](/show_bug.cgi?id=652054#c41)• 13 years ago |
|  | |

(In reply to Boris Zbarsky (:bz) from [comment #0](/show_bug.cgi?id=652054#c0 "VERIFIED FIXED - Crash running jellyfish demo on 64-bit"))
> BUILD: Current trunk nightly and my optimized self-build
>
> STEPS TO REPRODUCE:
> 1) Disable content methodjit
> 2) Load <http://chrysaora.com/>
Given this testcase, is it possible to verify this in Firefox 7.0RC?

|  | [u279076](/user_profile?user_id=279076) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=652054#a13600158_279076)• 13 years ago |

Whiteboard: [sg:critical?], [qa+] → [sg:critical?], [qa?]

|  | [Martin Stránský [:stransky] (ni? me)](/user_profile?user_id=263117) |  |
| --- | --- | --- |
| [Comment 42](/show_bug.cgi?id=652054#c42)• 13 years ago |
|  | |

The testcase still crashes for me, Firefox 7.0RC, Fedora15/x86\_64, built with --disable-methodjit.

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101) |  |
| --- | --- | --- |
| [Comment 43](/show_bug.cgi?id=652054#c43)• 13 years ago |
|  | |

(In reply to David Mandelin from [comment #35](/show_bug.cgi?id=652054#c35 "VERIFIED FIXED - Crash running jellyfish demo on 64-bit"))
> The patch wasn't backed out before Beta, but it was for Aurora.
I'm not sure if that is correct. I just retested Aurora, Beta (Aurora in that comment and Release (Beta in that comment) JS shells.
Aurora and Beta are ok, Release (Fx7) still crashes on this.Status: RESOLVED → REOPENEDResolution: FIXED → ---

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 44](/show_bug.cgi?id=652054#c44)• 13 years ago |
|  | |

Unless you're saying Nightly is busted we should leave the bug "fixed" and use the branch "status" fields to note this fix didn't land on the "7" branch.
(In reply to Anthony Hughes, Mozilla QA (irc: ashughes) from [comment #41](/show_bug.cgi?id=652054#c41 "VERIFIED FIXED - Crash running jellyfish demo on 64-bit"))
> (In reply to Boris Zbarsky (:bz) from [comment #0](/show_bug.cgi?id=652054#c0 "VERIFIED FIXED - Crash running jellyfish demo on 64-bit"))
> > STEPS TO REPRODUCE:
> > 1) Disable content methodjit
> > 2) Load <http://chrysaora.com/>
>
> Given this testcase, is it possible to verify this in Firefox 7.0RC?
Never pay too much attention to any [comment 0](/show_bug.cgi?id=652054#c0 "VERIFIED FIXED - Crash running jellyfish demo on 64-bit"). In this case it's bz so more reliable than your average bug author, but the bug did spring two additional minimized testcases ([comment 6](/show_bug.cgi?id=652054#c6 "VERIFIED FIXED - Crash running jellyfish demo on 64-bit"), [comment 8](/show_bug.cgi?id=652054#c8 "VERIFIED FIXED - Crash running jellyfish demo on 64-bit")).Status: REOPENED → RESOLVEDClosed: 13 years ago → 13 years ago
[status-firefox7](/buglist.cgi?f1=cf_status_firefox7&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox7&o1=equals&v1=fixed) → [affected](/buglist.cgi?f1=cf_status_firefox7&o1=equals&v1=affected)Resolution: --- → FIXED

|  | [u279076](/user_profile?user_id=279076) |  |
| --- | --- | --- |
| [Comment 45](/show_bug.cgi?id=652054#c45)• 13 years ago |
|  | |

Thanks Daniel.
qa+ for verification in Firefox 8 with the testcase in [comment 6](/show_bug.cgi?id=652054#c6 "VERIFIED FIXED - Crash running jellyfish demo on 64-bit").Whiteboard: [sg:critical?], [qa?] → [sg:critical?], [qa+]

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101) |  |
| --- | --- | --- |
| [Comment 46](/show_bug.cgi?id=652054#c46)• 13 years ago |
|  | |

(In reply to Anthony Hughes, Mozilla QA (irc: ashughes) from [comment #45](/show_bug.cgi?id=652054#c45 "VERIFIED FIXED - Crash running jellyfish demo on 64-bit"))
> qa+ for verification in Firefox 8 with the testcase in [comment 6](/show_bug.cgi?id=652054#c6 "VERIFIED FIXED - Crash running jellyfish demo on 64-bit").
You should also consider using the test from [comment 31](/show_bug.cgi?id=652054#c31 "VERIFIED FIXED - Crash running jellyfish demo on 64-bit"). It is the same as in [comment 8](/show_bug.cgi?id=652054#c8 "VERIFIED FIXED - Crash running jellyfish demo on 64-bit") (JS shell test, not requiring a browser at all), but it terminates unlike the one in [comment 8](/show_bug.cgi?id=652054#c8 "VERIFIED FIXED - Crash running jellyfish demo on 64-bit"). This test is already in our test suite (jit-test/tests/basic/[bug652054](/show_bug.cgi?id=652054 "VERIFIED FIXED - Crash running jellyfish demo on 64-bit").js).

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=652054#a13873007_12352)• 13 years ago |

[status-firefox10](/buglist.cgi?f1=cf_status_firefox10&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=fixed)
[status-firefox7](/buglist.cgi?f1=cf_status_firefox7&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox7&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox7&o1=equals&v1=wontfix)
[status-firefox9](/buglist.cgi?f1=cf_status_firefox9&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=fixed)
[tracking-firefox10](/buglist.cgi?f1=cf_tracking_firefox10&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox10&o1=equals&v1=%2B)
[tracking-firefox9](/buglist.cgi?f1=cf_tracking_firefox9&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox9&o1=equals&v1=%2B)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=652054#a23546867_1689)• 13 years ago |

Group: core-security

|  | [Vlad [QA]](/user_profile?user_id=408941) |  |
| --- | --- | --- |
| [Comment 47](/show_bug.cgi?id=652054#c47)• 13 years ago |
|  | |

Hi guys.
I wanted to test this using the testcase from [comment 6](/show_bug.cgi?id=652054#c6 "VERIFIED FIXED - Crash running jellyfish demo on 64-bit") and Firefox freezes every time.
This happened with Firefox 7.0.1, 8.0.1, 9.0.1 and also on Firefox 10b6.
I've done the test on MacOS X 10.6.8.
There is another test case that I should use?
Thanks

|  | [u279076](/user_profile?user_id=279076) |  |
| --- | --- | --- |
| [Comment 48](/show_bug.cgi?id=652054#c48)• 13 years ago |
|  | |

(In reply to Vlad [QA] from [comment #47](/show_bug.cgi?id=652054#c47 "VERIFIED FIXED - Crash running jellyfish demo on 64-bit"))
> Hi guys.
> I wanted to test this using the testcase from [comment 6](/show_bug.cgi?id=652054#c6 "VERIFIED FIXED - Crash running jellyfish demo on 64-bit") and Firefox freezes
> every time.
> This happened with Firefox 7.0.1, 8.0.1, 9.0.1 and also on Firefox 10b6.
> I've done the test on MacOS X 10.6.8.
> There is another test case that I should use?
>
> Thanks
If Firefox is freezing every time you try to load this test it's probably worth a follow-up bug. As long as it doesn't trigger Breakpad this is likely resolved.
@Johnny, can you comment on this ^

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Comment 49](/show_bug.cgi?id=652054#c49)• 13 years ago |
|  | |

Yeah, that sounds like a different bug.

|  | [Vlad [QA]](/user_profile?user_id=408941) |  |
| --- | --- | --- |
| [Comment 50](/show_bug.cgi?id=652054#c50)• 13 years ago |
|  | |

I have retested this on:
Mozilla/5.0 (Macintosh; Intel Mac OS X 10.6; rv:8.0.1) Gecko/20100101 Firefox/8.0.1
Mozilla/5.0 (Macintosh; Intel Mac OS X 10.6; rv:9.0.1) Gecko/20100101 Firefox/9.0.1
Mozilla/5.0 (Macintosh; Intel Mac OS X 10.6; rv:10.0) Gecko/20100101 Firefox/10.0 beta 6
On each build I get an "Unresponsive script" error and if I choose to continue the script Firefox freezes but no Brackpad dialog appears.
Considering this and the comments from above, setting resolution to Verified Fixed.
Should I file a new bug regarding the freezes ?Status: RESOLVED → VERIFIED
[status-firefox10](/buglist.cgi?f1=cf_status_firefox10&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=verified)
[status-firefox8](/buglist.cgi?f1=cf_status_firefox8&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox8&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox8&o1=equals&v1=verified)
[status-firefox9](/buglist.cgi?f1=cf_status_firefox9&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=verified)Keywords: [verified-beta](/buglist.cgi?keywords=verified-beta&resolution=---)Whiteboard: [sg:critical?], [qa+] → [sg:critical?], [qa!]

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101) |  |
| --- | --- | --- |
| [Comment 51](/show_bug.cgi?id=652054#c51)• 12 years ago |
|  | |

A testcase for this bug was automatically identified at js/src/jit-test/tests/basic/[bug652054](/show_bug.cgi?id=652054 "VERIFIED FIXED - Crash running jellyfish demo on 64-bit").js.Flags: in-testsuite+
You need to [log in](/show_bug.cgi?id=652054&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Christian Holler (:decoder)](/user_profile?user_id=395101)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from bugzilla.novell.com_e1631e3c_20250126_060803.html ===




=== Content from bugzilla.mozilla.org_df7fe31e_20250125_045754.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/665070)
* [XML](/show_bug.cgi?ctype=xml&id=665070)

Closed
[Bug 665070](/show_bug.cgi?id=665070)

Opened 14 years ago
Closed 14 years ago

# WebGL functions allocating buffers/textures must check that the GL call succeeded, to prevent allowing context to make out-of-bounds accesses

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

WebGL functions allocating buffers/textures must check that the GL call succeeded, to prevent allowing context to make out-of-bounds accesses

## Categories

### (Core :: Graphics: CanvasWebGL, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=Graphics%3A%20CanvasWebGL#Graphics%3A%20CanvasWebGL)

Graphics: CanvasWebGL
▾

Core :: Graphics: CanvasWebGL
Bugs with the WebGL Canvas Context.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=Graphics%3A%20CanvasWebGL&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=Graphics%3A%20CanvasWebGL&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=Graphics%3A%20CanvasWebGL)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

unspecified

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

All

All

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

normal

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla8

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| a11y-review | --- |
| --- | --- |
| Accessibility Severity | --- |
| Webcompat Score | --- |
| Performance Impact | --- |
| Webcompat Priority | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox5 | [-](/buglist.cgi?f1=cf_tracking_firefox5&o1=equals&v1=-) | [affected](/buglist.cgi?f1=cf_status_firefox5&o1=equals&v1=affected) |
| firefox6 | [-](/buglist.cgi?f1=cf_tracking_firefox6&o1=equals&v1=-) | [affected](/buglist.cgi?f1=cf_status_firefox6&o1=equals&v1=affected) |
| firefox7 | [-](/buglist.cgi?f1=cf_tracking_firefox7&o1=equals&v1=-) | [affected](/buglist.cgi?f1=cf_status_firefox7&o1=equals&v1=affected) |
| firefox8 | [+](/buglist.cgi?f1=cf_tracking_firefox8&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox8&o1=equals&v1=fixed) |
| firefox9 | [+](/buglist.cgi?f1=cf_tracking_firefox9&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=fixed) |
| firefox10 | [+](/buglist.cgi?f1=cf_tracking_firefox10&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=fixed) |
| status1.9.2 | --- | [unaffected](/buglist.cgi?f1=cf_status_192&o1=equals&v1=unaffected) |
| status1.9.1 | --- | [unaffected](/buglist.cgi?f1=cf_status_191&o1=equals&v1=unaffected) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox5 | - | affected |
| firefox6 | - | affected |
| firefox7 | - | affected |
| firefox8 | + | fixed |
| firefox9 | + | fixed |
| firefox10 | + | fixed |
| status1.9.2 |  | unaffected |
| relnote-firefox |  | --- |
| status1.9.1 |  | unaffected |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: bjacob, Assigned: bjacob)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/8f64ddf291d83cdc891c05ee5d5cc5dc?d=mm&size=40)  [bjacob](/user_profile?user_id=382769)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/8f64ddf291d83cdc891c05ee5d5cc5dc?d=mm&size=40)  [bjacob](/user_profile?user_id=382769)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/ca6a57abf052ac63d917d5dae1cc0f00?d=mm&size=40)  [jgilbert](/user_profile?user_id=419431)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

14 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

[bugs.webkit.org/show\_bug.cgi?id=62902](https://bugs.webkit.org/show_bug.cgi?id=62902 "https://bugs.webkit.org/show_bug.cgi?id=62902")

## Details

### (Whiteboard: [sg:high][qa?] moderate?)

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

---

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[sg:high][qa?] moderate?

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (13 files, 9 obsolete files)

| [part 1: implement GLContext::GetAndClearError](/attachment.cgi?id=541174)  [14 years ago](#c2)  [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)   1.76 KB, patch | jrmuizel : [review+](#c4 "14 years ago") | [Details](/attachment.cgi?id=541174&action=edit) | [Diff](/attachment.cgi?id=541174&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=665070&attachment=541174) |
| --- | --- | --- |
| [part 2: use GetAndClearError in WebGL initialization](/attachment.cgi?id=541175)  [14 years ago](#c3)  [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)   9.50 KB, patch | jrmuizel : [review-](#c7 "14 years ago") | [Details](/attachment.cgi?id=541175&action=edit) | [Diff](/attachment.cgi?id=541175&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=665070&attachment=541175) |
| [part 3: use GetAndClearError in WebGLContext::GetError](/attachment.cgi?id=541176)  [14 years ago](#c5)  [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)   926 bytes, patch | jrmuizel : [review+](#c8 "14 years ago") | [Details](/attachment.cgi?id=541176&action=edit) | [Diff](/attachment.cgi?id=541176&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=665070&attachment=541176) |
| [part 4: rename mSynthesizedGLError to mWebGLError](/attachment.cgi?id=541178)  [14 years ago](#c6)  [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)   4.11 KB, patch | jrmuizel : [review+](#a442018_309398 "14 years ago") | [Details](/attachment.cgi?id=541178&action=edit) | [Diff](/attachment.cgi?id=541178&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=665070&attachment=541178) |
| [part 5: implement WebGLContext::UpdateWebGLErrorAndClearGLError](/attachment.cgi?id=541179)  [14 years ago](#c9)  [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)   2.71 KB, patch | jrmuizel : [review+](#a949566_309398 "14 years ago") | [Details](/attachment.cgi?id=541179&action=edit) | [Diff](/attachment.cgi?id=541179&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=665070&attachment=541179) |
| [part 6: update SynthesizeGLError](/attachment.cgi?id=541180)  [14 years ago](#c10)  [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)   1.03 KB, patch | jrmuizel : [review+](#a950333_309398 "14 years ago") | [Details](/attachment.cgi?id=541180&action=edit) | [Diff](/attachment.cgi?id=541180&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=665070&attachment=541180) |
| [part 2: use GetAndClearError in WebGL initialization (v2)](/attachment.cgi?id=541182)  [14 years ago](#c11)  [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)   2.26 KB, patch | jrmuizel : [review+](#a609571_309398 "14 years ago") | [Details](/attachment.cgi?id=541182&action=edit) | [Diff](/attachment.cgi?id=541182&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=665070&attachment=541182) |
| [part 7: add WebGLScopedConditionalCheck](/attachment.cgi?id=541183)  [14 years ago](#c12)  [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)   1.91 KB, patch |  | [Details](/attachment.cgi?id=541183&action=edit) | [Diff](/attachment.cgi?id=541183&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=665070&attachment=541183) |
| [part 8: add ErrorName helper](/attachment.cgi?id=541184)  [14 years ago](#c13)  [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)   2.13 KB, patch | jrmuizel : [review+](#a935316_309398 "14 years ago") | [Details](/attachment.cgi?id=541184&action=edit) | [Diff](/attachment.cgi?id=541184&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=665070&attachment=541184) |
| [part 9: check error in bufferData](/attachment.cgi?id=541187)  [14 years ago](#c14)  [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)   3.91 KB, patch |  | [Details](/attachment.cgi?id=541187&action=edit) | [Diff](/attachment.cgi?id=541187&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=665070&attachment=541187) |
| [part 10: check error in renderbufferStorage](/attachment.cgi?id=541189)  [14 years ago](#c15)  [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)   2.48 KB, patch |  | [Details](/attachment.cgi?id=541189&action=edit) | [Diff](/attachment.cgi?id=541189&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=665070&attachment=541189) |
| [part 11: check error in texImage2D](/attachment.cgi?id=541191)  [14 years ago](#c16)  [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)   7.44 KB, patch |  | [Details](/attachment.cgi?id=541191&action=edit) | [Diff](/attachment.cgi?id=541191&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=665070&attachment=541191) |
| [part 12: textures are not RectangleObjects, but framebuffer attachments are](/attachment.cgi?id=541816)  [14 years ago](#c25)  [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)   12.63 KB, patch |  | [Details](/attachment.cgi?id=541816&action=edit) | [Diff](/attachment.cgi?id=541816&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=665070&attachment=541816) |
| [part 12: textures are not RectangleObjects, but framebuffer attachments are](/attachment.cgi?id=541818)  [14 years ago](#c26)  [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)   9.81 KB, patch | jrmuizel : [review+](#a1564920_309398 "14 years ago") | [Details](/attachment.cgi?id=541818&action=edit) | [Diff](/attachment.cgi?id=541818&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=665070&attachment=541818) |
| [part 13: require all framebuffer attachments to have same size](/attachment.cgi?id=541821)  [14 years ago](#c27)  [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)   2.34 KB, patch | jrmuizel : [review+](#a1564484_309398 "14 years ago") | [Details](/attachment.cgi?id=541821&action=edit) | [Diff](/attachment.cgi?id=541821&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=665070&attachment=541821) |
| [part 14: check error in copyTexImage2D](/attachment.cgi?id=541955)  [14 years ago](#c29)  [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)   7.39 KB, patch |  | [Details](/attachment.cgi?id=541955&action=edit) | [Diff](/attachment.cgi?id=541955&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=665070&attachment=541955) |
| [part 9: check error in bufferData](/attachment.cgi?id=543052)  [14 years ago](#c40)  [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)   6.87 KB, patch | jrmuizel : [review+](#c46 "14 years ago") | [Details](/attachment.cgi?id=543052&action=edit) | [Diff](/attachment.cgi?id=543052&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=665070&attachment=543052) |
| [part 10: check error in renderbufferStorage](/attachment.cgi?id=543053)  [14 years ago](#c41)  [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)   2.61 KB, patch | jrmuizel : [review+](#c47 "14 years ago") | [Details](/attachment.cgi?id=543053&action=edit) | [Diff](/attachment.cgi?id=543053&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=665070&attachment=543053) |
| [part 11: check error in texImage2D](/attachment.cgi?id=543054)  [14 years ago](#c42)  [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)   8.90 KB, patch | jrmuizel : [review+](#a1563563_309398 "14 years ago") | [Details](/attachment.cgi?id=543054&action=edit) | [Diff](/attachment.cgi?id=543054&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=665070&attachment=543054) |
| [part 14: check error in copyTexImage2D](/attachment.cgi?id=543055)  [14 years ago](#c43)  [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)   12.54 KB, patch |  | [Details](/attachment.cgi?id=543055&action=edit) | [Diff](/attachment.cgi?id=543055&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=665070&attachment=543055) |
| [part 14: check error in copyTexImage2D](/attachment.cgi?id=543221)  [14 years ago](#c44)  [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)   10.76 KB, patch |  | [Details](/attachment.cgi?id=543221&action=edit) | [Diff](/attachment.cgi?id=543221&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=665070&attachment=543221) |
| [part 14: check error in copyTexImage2D](/attachment.cgi?id=543260)  [14 years ago](#c45)  [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)   9.57 KB, patch | jrmuizel : [review+](#a1564033_309398 "14 years ago") | [Details](/attachment.cgi?id=543260&action=edit) | [Diff](/attachment.cgi?id=543260&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=665070&attachment=543260) |

Show Obsolete

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=665070#c0)• 14 years ago |
|  | |

Thanks a lot to Gregg Tavares at Google for reporting this:
=== BEGIN EMAIL ===
Hi Guys,
While I was looking into some perf issues I found what I think is a security issue in both Firefox and WebKit implementations of WebGL
The issue is that neither of these implementations check for errors on glBufferData, glTexImage2D or glCopyTexImage2D
So for example if a user does this
buf = gl.createBuffer();
gl.bindBuffer(gl.ARRAY\_BUFFER, buf);
gl.bufferData(gl.ARRAY\_BUFFER, veryLargeSizeThatRunsOutOfMemoryOrIsTooLargeForDriver, gl.STATIC\_DRAW); // assume this fails
At this point, because neither WebKit nor Firefox check for error they think the buffer is veryLargeSize...
So, for example, validating indices when calling gl.drawElements will be wrong.
For textures, the same issues would exist. For example, create a texture that is too big, creation fails but browser thinks the texture is large since it did not check for error. Now bind that texture to an FBO and call readPixels. You can now read pixels outside the bounds of the texture since the implementation will not be clearing past the bounds.
=== END EMAIL ===

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=665070#c1)• 14 years ago |
|  | |

WebKit bug: <https://bugs.webkit.org/show_bug.cgi?id=62902>

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=665070#c2)• 14 years ago |
|  | |

Attached patch

[part 1: implement GLContext::GetAndClearError](attachment.cgi?id=541174&action=diff)
— [Details](attachment.cgi?id=541174&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=665070&attachment=541174)

Extra thin patches to maximize your reviewing pleasure.Assignee: nobody → bjacobStatus: NEW → ASSIGNED
[Attachment #541174](/attachment.cgi?id=541174&action=edit "part 1: implement GLContext::GetAndClearError") -
Flags: review?(jmuizelaar)

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=665070#c3)• 14 years ago |
|  | |

Attached patch

[part 2: use GetAndClearError in WebGL initialization](attachment.cgi?id=541175&action=diff) (obsolete)
— [Details](attachment.cgi?id=541175&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=665070&attachment=541175)

[Attachment #541175](/attachment.cgi?id=541175&action=edit "part 2: use GetAndClearError in WebGL initialization") -
Flags: review?(jmuizelaar)

|  | [Jeff Muizelaar [:jrmuizel]](/user_profile?user_id=309398) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=665070#c4)• 14 years ago |
|  | |

Comment on [attachment 541174](/attachment.cgi?id=541174 "part 1: implement GLContext::GetAndClearError") [[details]](/attachment.cgi?id=541174&action=edit "part 1: implement GLContext::GetAndClearError") [[diff]](/attachment.cgi?id=541174&action=diff "part 1: implement GLContext::GetAndClearError") [[review]](/page.cgi?id=splinter.html&ignore=&bug=665070&attachment=541174)
part 1: implement GLContext::GetAndClearError
>
> public:
>+
>+ /\*\* \returns the first GL error, and guarantees that all GL error flags are cleared,
>+ \* i.e. that a subsequent GetError call will return NO\_ERROR
>+ \*/
>+ GLenum GetAndClearError() {
>+ // the first error is what we want to return
>+ GLenum error = fGetError();
>+
>+ if (error) {
>+ // clear all pending errors
>+ while(fGetError()) {}
add a space after 'while'
>+ }
>+
>+ return error;
>+ }
>
> GLenum mGLError;
>
> public:
>+
gratuitous whitespace change.
[Attachment #541174](/attachment.cgi?id=541174&action=edit "part 1: implement GLContext::GetAndClearError") -
Flags: review?(jmuizelaar) → review+

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=665070#c5)• 14 years ago |
|  | |

Attached patch

[part 3: use GetAndClearError in WebGLContext::GetError](attachment.cgi?id=541176&action=diff)
— [Details](attachment.cgi?id=541176&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=665070&attachment=541176)

[Attachment #541176](/attachment.cgi?id=541176&action=edit "part 3: use GetAndClearError in WebGLContext::GetError") -
Flags: review?(jmuizelaar)

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=665070#c6)• 14 years ago |
|  | |

Attached patch

[part 4: rename mSynthesizedGLError to mWebGLError](attachment.cgi?id=541178&action=diff)
— [Details](attachment.cgi?id=541178&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=665070&attachment=541178)

mSynthesizedGLError started as something only for webgl-specific errors that we generated by hand. But really what we need it to be is a data member that stores the WebGL error state irrespective of GL error state.
[Attachment #541178](/attachment.cgi?id=541178&action=edit "part 4: rename mSynthesizedGLError to mWebGLError") -
Flags: review?(jmuizelaar)

|  | [Jeff Muizelaar [:jrmuizel]](/user_profile?user_id=309398) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=665070#c7)• 14 years ago |
|  | |

Comment on [attachment 541175](/attachment.cgi?id=541175 "part 2: use GetAndClearError in WebGL initialization") [[details]](/attachment.cgi?id=541175&action=edit "part 2: use GetAndClearError in WebGL initialization") [[diff]](/attachment.cgi?id=541175&action=diff "part 2: use GetAndClearError in WebGL initialization") [[review]](/page.cgi?id=splinter.html&ignore=&bug=665070&attachment=541175)
part 2: use GetAndClearError in WebGL initialization
It looks like there's a bunch of unrelated change in this patch.
[Attachment #541175](/attachment.cgi?id=541175&action=edit "part 2: use GetAndClearError in WebGL initialization") -
Flags: review?(jmuizelaar) → review-

|  | [Jeff Muizelaar [:jrmuizel]](/user_profile?user_id=309398) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=665070#c8)• 14 years ago |
|  | |

Comment on [attachment 541176](/attachment.cgi?id=541176 "part 3: use GetAndClearError in WebGLContext::GetError") [[details]](/attachment.cgi?id=541176&action=edit "part 3: use GetAndClearError in WebGLContext::GetError") [[diff]](/attachment.cgi?id=541176&action=diff "part 3: use GetAndClearError in WebGLContext::GetError") [[review]](/page.cgi?id=splinter.html&ignore=&bug=665070&attachment=541176)
part 3: use GetAndClearError in WebGLContext::GetError
>
>- // Always call glGetError to clear any pending
>+ // Always call GetAndClearError to clear any pending
> // real GL error.
to clear all pending real GL errors.
[Attachment #541176](/attachment.cgi?id=541176&action=edit "part 3: use GetAndClearError in WebGLContext::GetError") -
Flags: review?(jmuizelaar) → review+

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=665070#c9)• 14 years ago |
|  | |

Attached patch

[part 5: implement WebGLContext::UpdateWebGLErrorAndClearGLError](attachment.cgi?id=541179&action=diff)
— [Details](attachment.cgi?id=541179&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=665070&attachment=541179)

Explained in a comment. This function's semantics are very convenient: you can call it anywhere, as many times as you want, the WebGL error state remains coherent. The signature taking a GLenum\* is useful when you want to know if a new GL error showed up.
[Attachment #541179](/attachment.cgi?id=541179&action=edit "part 5: implement WebGLContext::UpdateWebGLErrorAndClearGLError") -
Flags: review?(jmuizelaar)

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=665070#c10)• 14 years ago |
|  | |

Attached patch

[part 6: update SynthesizeGLError](attachment.cgi?id=541180&action=diff)
— [Details](attachment.cgi?id=541180&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=665070&attachment=541180)

[Attachment #541180](/attachment.cgi?id=541180&action=edit "part 6: update SynthesizeGLError") -
Flags: review?(jmuizelaar)

|  | [Jeff Muizelaar [:jrmuizel]](/user_profile?user_id=309398) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=665070#a442018_309398)• 14 years ago |

[Attachment #541178](/attachment.cgi?id=541178&action=edit "part 4: rename mSynthesizedGLError to mWebGLError") -
Flags: review?(jmuizelaar) → review+

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=665070#c11)• 14 years ago |
|  | |

Attached patch

[part 2: use GetAndClearError in WebGL initialization (v2)](attachment.cgi?id=541182&action=diff)
— [Details](attachment.cgi?id=541182&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=665070&attachment=541182)

Sorry... I'm starting to wonder if there's a bug in my version of hg/mq.
[Attachment #541175](/attachment.cgi?id=541175&action=edit "part 2: use GetAndClearError in WebGL initialization") -
Attachment is obsolete: true
[Attachment #541182](/attachment.cgi?id=541182&action=edit "part 2: use GetAndClearError in WebGL initialization (v2)") -
Flags: review?(jmuizelaar)

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=665070#c12)• 14 years ago |
|  | |

Attached patch

[part 7: add WebGLScopedConditionalCheck](attachment.cgi?id=541183&action=diff) (obsolete)
— [Details](attachment.cgi?id=541183&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=665070&attachment=541183)

This RAII device limits somewhat the risks of bugs, given that we will have to use it at least 6 times.
The 'conditional' part is because we will try to avoid doing this check based on certain conditions, to avoid losing performance when we can. For example, in TexImage2D, if the texture dimensions and format doesn't change, there's no need to do the check as out-of-bounds access would not happen anyway. The check is really expensive, as I'm afraid that in order to know if we're out of video memory the driver needs to sync with the GPU. The idea of this optimization comes from Ken.
[Attachment #541183](/attachment.cgi?id=541183&action=edit "part 7: add WebGLScopedConditionalCheck") -
Flags: review?(jmuizelaar)

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=665070#a442591_382769)• 14 years ago |

[Attachment #541183](/attachment.cgi?id=541183&action=edit "part 7: add WebGLScopedConditionalCheck") -
Attachment description: add WebGLScopedConditionalCheck → part 7: add WebGLScopedConditionalCheck

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=665070#c13)• 14 years ago |
|  | |

Attached patch

[part 8: add ErrorName helper](attachment.cgi?id=541184&action=diff)
— [Details](attachment.cgi?id=541184&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=665070&attachment=541184)

[Attachment #541184](/attachment.cgi?id=541184&action=edit "part 8: add ErrorName helper") -
Flags: review?(jmuizelaar)

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=665070#c14)• 14 years ago |
|  | |

Attached patch

[part 9: check error in bufferData](attachment.cgi?id=541187&action=diff) (obsolete)
— [Details](attachment.cgi?id=541187&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=665070&attachment=541187)

[Attachment #541187](/attachment.cgi?id=541187&action=edit "part 9: check error in bufferData") -
Flags: review?(jmuizelaar)

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=665070#c15)• 14 years ago |
|  | |

Attached patch

[part 10: check error in renderbufferStorage](attachment.cgi?id=541189&action=diff) (obsolete)
— [Details](attachment.cgi?id=541189&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=665070&attachment=541189)

[Attachment #541189](/attachment.cgi?id=541189&action=edit "part 10: check error in renderbufferStorage") -
Flags: review?(jmuizelaar)

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=665070#c16)• 14 years ago |
|  | |

Attached patch

[part 11: check error in texImage2D](attachment.cgi?id=541191&action=diff) (obsolete)
— [Details](attachment.cgi?id=541191&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=665070&attachment=541191)

[Attachment #541191](/attachment.cgi?id=541191&action=edit "part 11: check error in texImage2D") -
Flags: review?(jmuizelaar)

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=665070#c17)• 14 years ago |
|  | |

Note: copyTexImage2D still missing, coming tomorrow, requires a little bit more work as I found another bug we have: we don't properly record the format of textures created by copyTexImage2D.

|  | [Gregg Tavares](/user_profile?user_id=353355) |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=665070#c18)• 14 years ago |
|  | |

I noticed another issue.
The error system in OpenGL is a set of bits. One bit for each type of error. (INVALID\_ENUM, INVALID\_VALUE, etc...)
glGetError returns one of those errors and the clears the bit for that error which is not what your implementation is emulating
Note: this was news to me too when I was implementing the Chrome version.
I added a WebGL conformance test to check for this when I saw your patch.
<https://cvs.khronos.org/svn/repos/registry/trunk/public/webgl/sdk/tests/conformance/gl-geterror.html>
Maybe you want a separate issue for that?

|  | [Gregg Tavares](/user_profile?user_id=353355) |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=665070#c19)• 14 years ago |
|  | |

And one more? Sorry, Benoit's comment about recording the format of textures created by copyTexImage2D scared me since you need to copy the format of each level of a texture. There is no overall format for the texture. So I checked the code just to double check. Yea, you guys are storing a format per level
but....
Assuming this is the latest code
<http://hg.mozilla.org/releases/mozilla-aurora/file/c64b52363a1b/content/canvas/src/WebGLContextGL.cpp>
I just thought I'd ask, what's line 4277
tex->setDimensions(width, height);
for? It looks like that line is called for every level of the texture but it's only stored once per texture. That means that value is rarely valid. For example if I had a 4x4 texture and set levels 0, 1, 2 the width and height would be set to 1x1 where as if I set levels 2, 1, 0 it would be 4x4!?!?
Is it used for something that I'm not understanding?

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=665070#c21)• 14 years ago |
|  | |

Can this be worse than reading from/writing to someone else's GPU memory? If it can interfere with executable code or data on the heap it's probably sg:critical instead of sg:high.Whiteboard: [sg:high]

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=665070#c22)• 14 years ago |
|  | |

(In reply to [comment #19](/show_bug.cgi?id=665070#c19 "RESOLVED FIXED - WebGL functions allocating buffers/textures must check that the GL call succeeded, to prevent allowing context to make out-of-bounds accesses"))
> And one more? Sorry, Benoit's comment about recording the format of textures
> created by copyTexImage2D scared me since you need to copy the format of
> each level of a texture. There is no overall format for the texture. So I
> checked the code just to double check. Yea, you guys are storing a format
> per level
>
> but....
>
> Assuming this is the latest code
> <http://hg.mozilla.org/releases/mozilla-aurora/file/c64b52363a1b/content/>
> canvas/src/WebGLContextGL.cpp
>
> I just thought I'd ask, what's line 4277
>
> tex->setDimensions(width, height);
>
> for? It looks like that line is called for every level of the texture but
> it's only stored once per texture.
Yep, good catch, actually I had noticed the same thing today while working on this code. This is a remnant of old code, will take care of it ASAP.

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=665070#c23)• 14 years ago |
|  | |

(In reply to [comment #18](/show_bug.cgi?id=665070#c18 "RESOLVED FIXED - WebGL functions allocating buffers/textures must check that the GL call succeeded, to prevent allowing context to make out-of-bounds accesses"))
> I noticed another issue.
>
> The error system in OpenGL is a set of bits. One bit for each type of error.
> (INVALID\_ENUM, INVALID\_VALUE, etc...)
>
> glGetError returns one of those errors and the clears the bit for that error
> which is not what your implementation is emulating
>
> Note: this was news to me too when I was implementing the Chrome version.
>
> I added a WebGL conformance test to check for this when I saw your patch.
> <https://cvs.khronos.org/svn/repos/registry/trunk/public/webgl/sdk/tests/>
> conformance/gl-geterror.html
>
> Maybe you want a separate issue for that?
Thanks a lot for that, this had totally escaped me (I never understood what the 'there may be multiple error flags' story really was about).

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=665070#c24)• 14 years ago |
|  | |

(In reply to [comment #21](/show_bug.cgi?id=665070#c21 "RESOLVED FIXED - WebGL functions allocating buffers/textures must check that the GL call succeeded, to prevent allowing context to make out-of-bounds accesses"))
> Can this be worse than reading from/writing to someone else's GPU memory? If
> it can interfere with executable code or data on the heap it's probably
> sg:critical instead of sg:high.
No, at this point there is no reason to believe there that might be a code execution risk here. "Only" accessing video memory. (That's already a terrible thing to happen)

|  | [Jeff Muizelaar [:jrmuizel]](/user_profile?user_id=309398) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=665070#a609571_309398)• 14 years ago |

[Attachment #541182](/attachment.cgi?id=541182&action=edit "part 2: use GetAndClearError in WebGL initialization (v2)") -
Flags: review?(jmuizelaar) → review+

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=665070#c25)• 14 years ago |
|  | |

Attached patch

[part 12: textures are not RectangleObjects, but framebuffer attachments are](attachment.cgi?id=541816&action=diff) (obsolete)
— [Details](attachment.cgi?id=541816&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=665070&attachment=541816)

As discussed above with Gregg. It doesn't make sense to talk about the width and height of a texture because that can be different for each (mipmap) level and (cube map) face. However, framebuffer attachments have well-defined dimensions. When a texture is attached to a framebuffer, it's a specific level and face that's attached. So the WebGLRectangleObject inheritance moves to WebGLFramebufferAttachment.
Regarding WebGLFramebuffer, well it does have the dimensions of its color attachment whenever it's complete, but I don't want them to be stored a second time as that adds redundant state, so width() and height() just return the dimensions of the color attachment.
[Attachment #541816](/attachment.cgi?id=541816&action=edit "part 12: textures are not RectangleObjects, but framebuffer attachments are") -
Flags: review?(jmuizelaar)

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 26](/show_bug.cgi?id=665070#c26)• 14 years ago |
|  | |

Attached patch

[part 12: textures are not RectangleObjects, but framebuffer attachments are](attachment.cgi?id=541818&action=diff)
— [Details](attachment.cgi?id=541818&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=665070&attachment=541818)

unwanted stuff in previous patch
[Attachment #541816](/attachment.cgi?id=541816&action=edit "part 12: textures are not RectangleObjects, but framebuffer attachments are") -
Attachment is obsolete: true
[Attachment #541816](/attachment.cgi?id=541816&action=edit "part 12: textures are not RectangleObjects, but framebuffer attachments are") -
Flags: review?(jmuizelaar)
[Attachment #541818](/attachment.cgi?id=541818&action=edit "part 12: textures are not RectangleObjects, but framebuffer attachments are") -
Flags: review?(jmuizelaar)

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 27](/show_bug.cgi?id=665070#c27)• 14 years ago |
|  | |

Attached patch

[part 13: require all framebuffer attachments to have same size](attachment.cgi?id=541821&action=diff)
— [Details](attachment.cgi?id=541821&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=665070&attachment=541821)

While I'm at it, it seems like a good idea to explicitly require all framebuffer attachments to have the same size in order for the framebuffer to be considered complete. IMO, OpenGL framebuffer completeness rules are too foggy to rely on for something that could conceivably be an area where driver bugs allow reading back video memory.
[Attachment #541821](/attachment.cgi?id=541821&action=edit "part 13: require all framebuffer attachments to have same size") -
Flags: review?(jmuizelaar)

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 28](/show_bug.cgi?id=665070#c28)• 14 years ago |
|  | |

(In reply to [comment #18](/show_bug.cgi?id=665070#c18 "RESOLVED FIXED - WebGL functions allocating buffers/textures must check that the GL call succeeded, to prevent allowing context to make out-of-bounds accesses"))
> I added a WebGL conformance test to check for this when I saw your patch.
> <https://cvs.khronos.org/svn/repos/registry/trunk/public/webgl/sdk/tests/>
> conformance/gl-geterror.html
Thanks a lot for writing the test.
Is this intentional:
shouldBeTrue('err1 != err2 != err3');
Do the semantics of != in JS really allow that?
> Maybe you want a separate issue for that?
Filed [bug 667084](/show_bug.cgi?id=667084 "RESOLVED INVALID - Implement correct WebGL error semantics").

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 29](/show_bug.cgi?id=665070#c29)• 14 years ago |
|  | |

Attached patch

[part 14: check error in copyTexImage2D](attachment.cgi?id=541955&action=diff) (obsolete)
— [Details](attachment.cgi?id=541955&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=665070&attachment=541955)

And this completes the patch series. This part was easier than I somehow feared, because the texture format is just the |internalformat| parameter and the type is always GL\_UNSIGNED\_BYTE.
This patch also has some changes on WebGLTexture::ImageInfo: it was allowing not specifying format and type, leaving them as '0', and that doesn't make any sense.
Good news: we now pass 2 more WebGL test pages!
[Attachment #541955](/attachment.cgi?id=541955&action=edit "part 14: check error in copyTexImage2D") -
Flags: review?(jmuizelaar)

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 30](/show_bug.cgi?id=665070#c30)• 14 years ago |
|  | |

Gregg, do you have a test for this issue already, or should I write one?

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 31](/show_bug.cgi?id=665070#c31)• 14 years ago |
|  | |

(the 2 test pages that we now pass are not related to the actual security issue)

|  | [:Gavin Sharp [email: gavin@gavinsharp.com]](/user_profile?user_id=103593) |  |
| --- | --- | --- |
| [Comment 32](/show_bug.cgi?id=665070#c32)• 14 years ago |
|  | |

(In reply to [comment #28](/show_bug.cgi?id=665070#c28 "RESOLVED FIXED - WebGL functions allocating buffers/textures must check that the GL call succeeded, to prevent allowing context to make out-of-bounds accesses"))
> shouldBeTrue('err1 != err2 != err3');
>
> Do the semantics of != in JS really allow that?
No, they don't - that looks broken. (I also wonder why this test harness seems to use eval()ed strings, seems horribly hacky)

|  | [Gregg Tavares](/user_profile?user_id=353355) |  |
| --- | --- | --- |
| [Comment 33](/show_bug.cgi?id=665070#c33)• 14 years ago |
|  | |

(In reply to [comment #30](/show_bug.cgi?id=665070#c30 "RESOLVED FIXED - WebGL functions allocating buffers/textures must check that the GL call succeeded, to prevent allowing context to make out-of-bounds accesses"))
> Gregg, do you have a test for this issue already, or should I write one?
For which one? I wrote a test that getError works. I'll fix the err1 != err2 != err3 if that's not valid jS.
I'll try writing one to test the other issues.

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 34](/show_bug.cgi?id=665070#c34)• 14 years ago |
|  | |

I mean a test for the original bug reported here i.e. the need to get for errors after glTexImage2D and friends.

|  | [Gregg Tavares](/user_profile?user_id=353355) |  |
| --- | --- | --- |
| [Comment 35](/show_bug.cgi?id=665070#c35)• 14 years ago |
|  | |

I'm not sure how I would test that. The only way I can think of is to allocate textures until WebGL runs out of memory but that doesn't seem like something you can do in a conformance test. It could run out of memory for other reasons.
I can't try allocating a texture that's too large since it shouldn't even get to glTexImage2D in that case (assuming the WebGL implementation is validating width and height before calling glTexImage2D which I think it's already doing. Similarly any other error (mis-matching internal format with format or type, border != 0, level out of range, all of those are validated before calling glTexImage2D.
I can write the out of memory test just to do it but I'm not sure we can include it in the list of must pass tests. Any other ideas?

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 36](/show_bug.cgi?id=665070#c36)• 14 years ago |
|  | |

Indeed, I hadn't thought of that, but it's not easy to write a reliable test.
Maybe bufferData is easier to test since one can request a 4G buffer which should always fail on current hardware, though it might start failing to fail in the near future.

|  | [Jeff Muizelaar [:jrmuizel]](/user_profile?user_id=309398) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=665070#a935316_309398)• 14 years ago |

[Attachment #541184](/attachment.cgi?id=541184&action=edit "part 8: add ErrorName helper") -
Flags: review?(jmuizelaar) → review+

|  | [Jeff Muizelaar [:jrmuizel]](/user_profile?user_id=309398) |  |
| --- | --- | --- |
| [Comment 37](/show_bug.cgi?id=665070#c37)• 14 years ago |
|  | |

Benoit, I haven't checked if it's there now or after these changes, but it's probably worth putting a short summary of how the gl error handling interacts with the webgl bindings near the declaration of the member variables involved.

|  | [Jeff Muizelaar [:jrmuizel]](/user_profile?user_id=309398) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=665070#a949566_309398)• 14 years ago |

[Attachment #541179](/attachment.cgi?id=541179&action=edit "part 5: implement WebGLContext::UpdateWebGLErrorAndClearGLError") -
Flags: review?(jmuizelaar) → review+

|  | [Jeff Muizelaar [:jrmuizel]](/user_profile?user_id=309398) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=665070#a950333_309398)• 14 years ago |

[Attachment #541180](/attachment.cgi?id=541180&action=edit "part 6: update SynthesizeGLError") -
Flags: review?(jmuizelaar) → review+

|  | [Jeff Muizelaar [:jrmuizel]](/user_profile?user_id=309398) |  |
| --- | --- | --- |
| [Comment 38](/show_bug.cgi?id=665070#c38)• 14 years ago |
|  | |

Benoit and I decided to drop WebGLScopedConditionalGLErrorCheck.

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 39](/show_bug.cgi?id=665070#c39)• 14 years ago |
|  | |

Comment on [attachment 541183](/attachment.cgi?id=541183 "part 7: add WebGLScopedConditionalCheck") [[details]](/attachment.cgi?id=541183&action=edit "part 7: add WebGLScopedConditionalCheck") [[diff]](/attachment.cgi?id=541183&action=diff "part 7: add WebGLScopedConditionalCheck") [[review]](/page.cgi?id=splinter.html&ignore=&bug=665070&attachment=541183)
part 7: add WebGLScopedConditionalCheck
Part 7 is obsolete, there is no part 7 anymore.
[Attachment #541183](/attachment.cgi?id=541183&action=edit "part 7: add WebGLScopedConditionalCheck") -
Attachment is obsolete: true
[Attachment #541183](/attachment.cgi?id=541183&action=edit "part 7: add WebGLScopedConditionalCheck") -
Flags: review?(jmuizelaar)

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 40](/show_bug.cgi?id=665070#c40)• 14 years ago |
|  | |

Attached patch

[part 9: check error in bufferData](attachment.cgi?id=543052&action=diff)
— [Details](attachment.cgi?id=543052&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=665070&attachment=543052)

[Attachment #541187](/attachment.cgi?id=541187&action=edit "part 9: check error in bufferData") -
Attachment is obsolete: true
[Attachment #541187](/attachment.cgi?id=541187&action=edit "part 9: check error in bufferData") -
Flags: review?(jmuizelaar)
[Attachment #543052](/attachment.cgi?id=543052&action=edit "part 9: check error in bufferData") -
Flags: review?(jmuizelaar)

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 41](/show_bug.cgi?id=665070#c41)• 14 years ago |
|  | |

Attached patch

[part 10: check error in renderbufferStorage](attachment.cgi?id=543053&action=diff)
— [Details](attachment.cgi?id=543053&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=665070&attachment=543053)

[Attachment #541189](/attachment.cgi?id=541189&action=edit "part 10: check error in renderbufferStorage") -
Attachment is obsolete: true
[Attachment #541189](/attachment.cgi?id=541189&action=edit "part 10: check error in renderbufferStorage") -
Flags: review?(jmuizelaar)
[Attachment #543053](/attachment.cgi?id=543053&action=edit "part 10: check error in renderbufferStorage") -
Flags: review?(jmuizelaar)

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 42](/show_bug.cgi?id=665070#c42)• 14 years ago |
|  | |

Attached patch

[part 11: check error in texImage2D](attachment.cgi?id=543054&action=diff)
— [Details](attachment.cgi?id=543054&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=665070&attachment=543054)

[Attachment #541191](/attachment.cgi?id=541191&action=edit "part 11: check error in texImage2D") -
Attachment is obsolete: true
[Attachment #541191](/attachment.cgi?id=541191&action=edit "part 11: check error in texImage2D") -
Flags: review?(jmuizelaar)
[Attachment #543054](/attachment.cgi?id=543054&action=edit "part 11: check error in texImage2D") -
Flags: review?(jmuizelaar)

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 43](/show_bug.cgi?id=665070#c43)• 14 years ago |
|  | |

Attached patch

[part 14: check error in copyTexImage2D](attachment.cgi?id=543055&action=diff) (obsolete)
— [Details](attachment.cgi?id=543055&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=665070&attachment=543055)

Up for review again.
[Attachment #541955](/attachment.cgi?id=541955&action=edit "part 14: check error in copyTexImage2D") -
Attachment is obsolete: true
[Attachment #541955](/attachment.cgi?id=541955&action=edit "part 14: check error in copyTexImage2D") -
Flags: review?(jmuizelaar)
[Attachment #543055](/attachment.cgi?id=543055&action=edit "part 14: check error in copyTexImage2D") -
Flags: review?(jmuizelaar)

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 44](/show_bug.cgi?id=665070#c44)• 14 years ago |
|  | |

Attached patch

[part 14: check error in copyTexImage2D](attachment.cgi?id=543221&action=diff) (obsolete)
— [Details](attachment.cgi?id=543221&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=665070&attachment=543221)

[Attachment #543055](/attachment.cgi?id=543055&action=edit "part 14: check error in copyTexImage2D") -
Attachment is obsolete: true
[Attachment #543055](/attachment.cgi?id=543055&action=edit "part 14: check error in copyTexImage2D") -
Flags: review?(jmuizelaar)
[Attachment #543221](/attachment.cgi?id=543221&action=edit "part 14: check error in copyTexImage2D") -
Flags: review?(jmuizelaar)

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 45](/show_bug.cgi?id=665070#c45)• 14 years ago |
|  | |

Attached patch

[part 14: check error in copyTexImage2D](attachment.cgi?id=543260&action=diff)
— [Details](attachment.cgi?id=543260&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=665070&attachment=543260)

[Attachment #543221](/attachment.cgi?id=543221&action=edit "part 14: check error in copyTexImage2D") -
Attachment is obsolete: true
[Attachment #543221](/attachment.cgi?id=543221&action=edit "part 14: check error in copyTexImage2D") -
Flags: review?(jmuizelaar)
[Attachment #543260](/attachment.cgi?id=543260&action=edit "part 14: check error in copyTexImage2D") -
Flags: review?(jmuizelaar)

|  | [Jeff Muizelaar [:jrmuizel]](/user_profile?user_id=309398) |  |
| --- | --- | --- |
| [Comment 46](/show_bug.cgi?id=665070#c46)• 14 years ago |
|  | |

Comment on [attachment 543052](/attachment.cgi?id=543052 "part 9: check error in bufferData") [[details]](/attachment.cgi?id=543052&action=edit "part 9: check error in bufferData") [[diff]](/attachment.cgi?id=543052&action=diff "part 9: check error in bufferData") [[review]](/page.cgi?id=splinter.html&ignore=&bug=665070&attachment=543052)
part 9: check error in bufferData
>
> if (!boundBuffer)
> return ErrorInvalidOperation("BufferData: no buffer bound!");
>
> MakeContextCurrent();
>+
>+ // [bug 665070](/show_bug.cgi?id=665070 "RESOLVED FIXED - WebGL functions allocating buffers/textures must check that the GL call succeeded, to prevent allowing context to make out-of-bounds accesses"). if we try to increase the buffer size and that fails, we must
>+ // catch that GL error and avoid wrongly believing that we have a larger buffer
It's probably good to drop the "and avoid wrongly believ.." to avoid exposing the security problem more than necessary.
[Attachment #543052](/attachment.cgi?id=543052&action=edit "part 9: check error in bufferData") -
Flags: review?(jmuizelaar) → review+

|  | [Jeff Muizelaar [:jrmuizel]](/user_profile?user_id=309398) |  |
| --- | --- | --- |
| [Comment 47](/show_bug.cgi?id=665070#c47)• 14 years ago |
|  | |

Comment on [attachment 543053](/attachment.cgi?id=543053 "part 10: check error in renderbufferStorage") [[details]](/attachment.cgi?id=543053&action=edit "part 10: check error in renderbufferStorage") [[diff]](/attachment.cgi?id=543053&action=diff "part 10: check error in renderbufferStorage") [[review]](/page.cgi?id=splinter.html&ignore=&bug=665070&attachment=543053)
part 10: check error in renderbufferStorage
>- gl->fRenderbufferStorage(target, internalformatForGL, width, height);
>+ MakeContextCurrent();
>+
>+ // [bug 665070](/show_bug.cgi?id=665070 "RESOLVED FIXED - WebGL functions allocating buffers/textures must check that the GL call succeeded, to prevent allowing context to make out-of-bounds accesses"). if we try to increase the buffer size and that fails, we must
>+ // catch that GL error and avoid wrongly believing that we have a larger buffer
Same as last patch.
[Attachment #543053](/attachment.cgi?id=543053&action=edit "part 10: check error in renderbufferStorage") -
Flags: review?(jmuizelaar) → review+

|  | [Jeff Muizelaar [:jrmuizel]](/user_profile?user_id=309398) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=665070#a1563563_309398)• 14 years ago |

[Attachment #543054](/attachment.cgi?id=543054&action=edit "part 11: check error in texImage2D") -
Flags: review?(jmuizelaar) → review+

|  | [Jeff Muizelaar [:jrmuizel]](/user_profile?user_id=309398) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=665070#a1564033_309398)• 14 years ago |

[Attachment #543260](/attachment.cgi?id=543260&action=edit "part 14: check error in copyTexImage2D") -
Flags: review?(jmuizelaar) → review+

|  | [Jeff Muizelaar [:jrmuizel]](/user_profile?user_id=309398) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=665070#a1564484_309398)• 14 years ago |

[Attachment #541821](/attachment.cgi?id=541821&action=edit "part 13: require all framebuffer attachments to have same size") -
Flags: review?(jmuizelaar) → review+

|  | [Jeff Muizelaar [:jrmuizel]](/user_profile?user_id=309398) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=665070#a1564920_309398)• 14 years ago |

[Attachment #541818](/attachment.cgi?id=541818&action=edit "part 12: textures are not RectangleObjects, but framebuffer attachments are") -
Flags: review?(jmuizelaar) → review+

|  | [Jeff Muizelaar [:jrmuizel]](/user_profile?user_id=309398) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=665070#a1564989_309398)• 14 years ago |

[tracking-firefox6](/buglist.cgi?f1=cf_tracking_firefox6&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox6&o1=equals&v1=%3F)
[tracking-firefox7](/buglist.cgi?f1=cf_tracking_firefox7&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox7&o1=equals&v1=%3F)
[tracking-firefox8](/buglist.cgi?f1=cf_tracking_firefox8&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox8&o1=equals&v1=%3F)

|  | [Asa Dotzler [:asa]](/user_profile?user_id=5003) |  |
| --- | --- | --- |
| [Comment 48](/show_bug.cgi?id=665070#c48)• 14 years ago |
|  | |

release drivers don't need to track 8 until it's uplifted to Aurora (6 weeks from today)
[tracking-firefox6](/buglist.cgi?f1=cf_tracking_firefox6&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox6&o1=equals&v1=%3F) → [+](/buglist.cgi?f1=cf_tracking_firefox6&o1=equals&v1=%2B)
[tracking-firefox7](/buglist.cgi?f1=cf_tracking_firefox7&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox7&o1=equals&v1=%3F) → [+](/buglist.cgi?f1=cf_tracking_firefox7&o1=equals&v1=%2B)
[tracking-firefox8](/buglist.cgi?f1=cf_tracking_firefox8&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox8&o1=equals&v1=%3F) → ---

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 49](/show_bug.cgi?id=665070#c49)• 14 years ago |
|  | |

<http://hg.mozilla.org/mozilla-central/rev/3d83c40b3590>
<http://hg.mozilla.org/mozilla-central/rev/3f0dd23263f2>
<http://hg.mozilla.org/mozilla-central/rev/2cb699b370e3>
<http://hg.mozilla.org/mozilla-central/rev/01a20b627def>
<http://hg.mozilla.org/mozilla-central/rev/de9daaa5585b>
<http://hg.mozilla.org/mozilla-central/rev/d302c1e3b975>
<http://hg.mozilla.org/mozilla-central/rev/3afd6f9d83cf>
<http://hg.mozilla.org/mozilla-central/rev/4f053dfe1b7d>
<http://hg.mozilla.org/mozilla-central/rev/b318f43fcd21>
<http://hg.mozilla.org/mozilla-central/rev/4fd3ac440415>
<http://hg.mozilla.org/mozilla-central/rev/afdbe635bde8>
<http://hg.mozilla.org/mozilla-central/rev/a56cd1f418fe>
<http://hg.mozilla.org/mozilla-central/rev/93f7d12c49bf>Status: ASSIGNED → RESOLVEDClosed: 14 years agoResolution: --- → FIXED

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 50](/show_bug.cgi?id=665070#c50)• 14 years ago |
|  | |

(In reply to [comment #48](/show_bug.cgi?id=665070#c48 "RESOLVED FIXED - WebGL functions allocating buffers/textures must check that the GL call succeeded, to prevent allowing context to make out-of-bounds accesses"))
> release drivers don't need to track 8 until it's uplifted to Aurora (6 weeks
> from today)
The security team needs to track that this was fixed in 8 though (through the status fields, not the "tracking" ones).
[status1.9.1](/buglist.cgi?f1=cf_status_191&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_191&o1=equals&v1=unaffected)
[status1.9.2](/buglist.cgi?f1=cf_status_192&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_192&o1=equals&v1=unaffected)
[status-firefox5](/buglist.cgi?f1=cf_status_firefox5&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox5&o1=equals&v1=affected)
[status-firefox6](/buglist.cgi?f1=cf_status_firefox6&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox6&o1=equals&v1=affected)
[status-firefox7](/buglist.cgi?f1=cf_status_firefox7&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox7&o1=equals&v1=affected)
[status-firefox8](/buglist.cgi?f1=cf_status_firefox8&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox8&o1=equals&v1=fixed)Keywords: [testcase-wanted](/buglist.cgi?keywords=testcase-wanted&resolution=---)See Also: → <https://bugs.webkit.org/show_bug.cgi?id=62902>Target Milestone: --- → mozilla8

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 51](/show_bug.cgi?id=665070#c51)• 14 years ago |
|  | |

This seems like a lot of code change to shoe-horn into Beta. Bumping back to a nomination. Also not sure about the sg:high rating: if you don't think you can write a reliable testcase to demonstrate the problem is it exploitable in practice, or just in special targeted situations?
[tracking-firefox5](/buglist.cgi?f1=cf_tracking_firefox5&o1=isnotempty):
--- → [-](/buglist.cgi?f1=cf_tracking_firefox5&o1=equals&v1=-)
[tracking-firefox6](/buglist.cgi?f1=cf_tracking_firefox6&o1=isnotempty):
[+](/buglist.cgi?f1=cf_tracking_firefox6&o1=equals&v1=%2B) → [?](/buglist.cgi?f1=cf_tracking_firefox6&o1=equals&v1=%3F)Whiteboard: [sg:high] → [sg:high] moderate?

|  | [Asa Dotzler [:asa]](/user_profile?user_id=5003) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=665070#a2689504_5003)• 14 years ago |

[tracking-firefox6](/buglist.cgi?f1=cf_tracking_firefox6&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox6&o1=equals&v1=%3F) → [-](/buglist.cgi?f1=cf_tracking_firefox6&o1=equals&v1=-)

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 52](/show_bug.cgi?id=665070#c52)• 14 years ago |
|  | |

Regarding reproducibility, AFAICR the conversation stalled after [comment 36](/show_bug.cgi?id=665070#c36 "RESOLVED FIXED - WebGL functions allocating buffers/textures must check that the GL call succeeded, to prevent allowing context to make out-of-bounds accesses"):
(In reply to [comment #36](/show_bug.cgi?id=665070#c36 "RESOLVED FIXED - WebGL functions allocating buffers/textures must check that the GL call succeeded, to prevent allowing context to make out-of-bounds accesses"))
> Indeed, I hadn't thought of that, but it's not easy to write a reliable test.
>
> Maybe bufferData is easier to test since one can request a 4G buffer which
> should always fail on current hardware, though it might start failing to
> fail in the near future.
While there's agreement that this is not practical to put in a testcase (high risk of intermittent failure/unexpected-success), the idea proposed in [comment 36](/show_bug.cgi?id=665070#c36 "RESOLVED FIXED - WebGL functions allocating buffers/textures must check that the GL call succeeded, to prevent allowing context to make out-of-bounds accesses"), i.e. calling bufferData with size=4G, would be a quite sure way of triggering this bug on most common hardware.
So I would recommend this at least for Aurora. I agree that this is bigger than what we like to take in Beta, so I won't push it for Beta. I could make a smaller, more self-contained hotfix for Beta, but that would only be trading size for untestedness and incompleteness.

|  | [LegNeato](/user_profile?user_id=482154) |  |
| --- | --- | --- |
| [Comment 53](/show_bug.cgi?id=665070#c53)• 13 years ago |
|  | |

We are no longer tracking this for Firefox 7. It should come up naturally in Firefox 8
[tracking-firefox7](/buglist.cgi?f1=cf_tracking_firefox7&o1=isnotempty):
[+](/buglist.cgi?f1=cf_tracking_firefox7&o1=equals&v1=%2B) → [-](/buglist.cgi?f1=cf_tracking_firefox7&o1=equals&v1=-)

|  | [u279076](/user_profile?user_id=279076) |  |
| --- | --- | --- |
| [Comment 55](/show_bug.cgi?id=665070#c55)• 13 years ago |
|  | |

As per testcase-wanted keyword, is there something QA can do to verify this fix?Whiteboard: [sg:high] moderate? → [sg:high][qa?] moderate?

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=665070#a10202039_12352)• 13 years ago |

[status-firefox10](/buglist.cgi?f1=cf_status_firefox10&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox10&o1=equals&v1=fixed)
[status-firefox9](/buglist.cgi?f1=cf_status_firefox9&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=fixed)
[tracking-firefox10](/buglist.cgi?f1=cf_tracking_firefox10&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox10&o1=equals&v1=%2B)
[tracking-firefox9](/buglist.cgi?f1=cf_tracking_firefox9&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox9&o1=equals&v1=%2B)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=665070#a10224450_1689)• 13 years ago |

[tracking-firefox8](/buglist.cgi?f1=cf_tracking_firefox8&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox8&o1=equals&v1=%2B)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=665070#a18664289_1689)• 13 years ago |

Group: core-security

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=665070#a136684285_75935)• 9 years ago |

Keywords: [testcase-wanted](/buglist.cgi?keywords=testcase-wanted&resolution=---)
You need to [log in](/show_bug.cgi?id=665070&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from bugzilla.mozilla.org_9206c3a2_20250125_045759.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/675515)
* [XML](/show_bug.cgi?ctype=xml&id=675515)

Closed
[Bug 675515](/show_bug.cgi?id=675515)

Opened 13 years ago
Closed 13 years ago

# Crash [@ TextUpdater::DoUpdate] with long text node

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Crash [@ TextUpdater::DoUpdate] with long text node

## Categories

### (Core :: Disability Access APIs, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=Disability%20Access%20APIs#Disability%20Access%20APIs)

Disability Access APIs
▾

Core :: Disability Access APIs
Description: This component relates to bugs in our support for accessibility APIs on the various platforms. Accessibility APIs allow 3rd party products, such as screen readers used by visually impaired users, to communicate with our content and UI. The APIs we support specifically are MSAA on Windows and
ATK on UNIX/Linux (Apple has not yet published specs for an accessibility API on OS X). This component is not for keyboard, focus or any accessibility bugs other than those relating to the APIs we export.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=Disability%20Access%20APIs&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=Disability%20Access%20APIs&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=Disability%20Access%20APIs)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

All

All

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

critical

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla8

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Webcompat Priority | --- |
| --- | --- |
| Performance Impact | --- |
| Webcompat Score | --- |
| Accessibility Severity | --- |
| a11y-review | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox8 | [+](/buglist.cgi?f1=cf_tracking_firefox8&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox8&o1=equals&v1=fixed) |
| firefox9 | [+](/buglist.cgi?f1=cf_tracking_firefox9&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=fixed) |
| status1.9.2 | --- | [unaffected](/buglist.cgi?f1=cf_status_192&o1=equals&v1=unaffected) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox8 | + | fixed |
| firefox9 | + | fixed |
| status1.9.2 |  | unaffected |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: jruderman, Assigned: surkov)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/e675fc38177990b696f3b055d3a34c4a?d=mm&size=40)  [surkov](/user_profile?user_id=88369)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/d2dc9227eafcd0ec5ba3712ee4f19b75?d=mm&size=40)  [jruderman](/user_profile?user_id=11608)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/5405533dede5f504c103ccd0627c568b?d=mm&size=40)  [ayeddi](/user_profile?user_id=699708)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

9 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[textfuzzer](/show_bug.cgi?id=377438 "RESOLVED FIXED - [meta] Text fuzzer")

Dependency [tree](/showdependencytree.cgi?id=675515&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=675515)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: crash, testcase, Whiteboard: [sg:critical?][qa!])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[crash](/buglist.cgi?keywords=crash&resolution=---),
[testcase](/buglist.cgi?keywords=testcase&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[sg:critical?][qa!]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [surkov](/user_profile?user_id=88369) | [in-testsuite](#c36 "13 years ago") | + |
| --- | --- | --- |
| [surkov](/user_profile?user_id=88369) | in-testsuite | + |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | qe-verify |  |

## Crash Data

Signature:

[[@ TextUpdater::DoUpdate ]](https://crash-stats.mozilla.org/signature/?signature=TextUpdater%3A%3ADoUpdate)

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (3 files, 2 obsolete files)

| [testcase (crashes Firefox debug builds, if accessibility is enabled)](/attachment.cgi?id=549679)  [13 years ago](#c0)  [Jesse Ruderman](/user_profile?user_id=11608)   573 bytes, application/xhtml+xml |  | [Details](/attachment.cgi?id=549679&action=edit) |
| --- | --- | --- |
| [stack trace](/attachment.cgi?id=549680)  [13 years ago](#c1)  [Jesse Ruderman](/user_profile?user_id=11608)   4.16 KB, text/plain |  | [Details](/attachment.cgi?id=549680&action=edit) |
| [patch](/attachment.cgi?id=549727)  [13 years ago](#c2)  [alexander :surkov (:asurkov)](/user_profile?user_id=88369)   5.83 KB, patch |  | [Details](/attachment.cgi?id=549727&action=edit) | [Diff](/attachment.cgi?id=549727&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=675515&attachment=549727) |
| [patch2](/attachment.cgi?id=549758)  [13 years ago](#c5)  [alexander :surkov (:asurkov)](/user_profile?user_id=88369)   7.30 KB, patch |  | [Details](/attachment.cgi?id=549758&action=edit) | [Diff](/attachment.cgi?id=549758&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=675515&attachment=549758) |
| [patch3](/attachment.cgi?id=550335)  [13 years ago](#c28)  [alexander :surkov (:asurkov)](/user_profile?user_id=88369)   10.01 KB, patch | tbsaunde : [review+](#a263822_401086 "13 years ago")  neil : [superreview+](#c29 "13 years ago") | [Details](/attachment.cgi?id=550335&action=edit) | [Diff](/attachment.cgi?id=550335&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=675515&attachment=550335) |

Show Obsolete

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Jesse Ruderman](/user_profile?user_id=11608)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=675515#c0)• 13 years ago |
|  | |

Attached file
[testcase (crashes Firefox debug builds, if accessibility is enabled)](attachment.cgi?id=549679)
— [Details](attachment.cgi?id=549679&action=edit)

1. Start a debug build of Firefox.
2. Enable accessibility, e.g. by pasting the following into the js console:
Components.classes["@mozilla.org/accessibilityService;1"]
.getService(Components.interfaces.nsIAccessibleRetrieval);
3. Load the testcase.
Result: Crash [@ TextUpdater::DoUpdate] trying to access e.g. 0x24db0000.

|  | [Jesse Ruderman](/user_profile?user_id=11608)  Reporter |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=675515#c1)• 13 years ago |
|  | |

Attached file
[stack trace](attachment.cgi?id=549680)
— [Details](attachment.cgi?id=549680&action=edit)

|  | [alexander :surkov (:asurkov)](/user_profile?user_id=88369)  Assignee |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=675515#c2)• 13 years ago |
|  | |

Attached patch

[patch](attachment.cgi?id=549727&action=diff) (obsolete)
— [Details](attachment.cgi?id=549727&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=675515&attachment=549727)

Assignee: nobody → surkov.alexanderStatus: NEW → ASSIGNED
[Attachment #549727](/attachment.cgi?id=549727&action=edit "patch") -
Flags: superreview?(neil)
[Attachment #549727](/attachment.cgi?id=549727&action=edit "patch") -
Flags: review?(trev.saunders)

|  | [neil@parkwaycc.co.uk](/user_profile?user_id=14006) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=675515#c3)• 13 years ago |
|  | |

Comment on [attachment 549727](/attachment.cgi?id=549727 "patch") [[details]](/attachment.cgi?id=549727&action=edit "patch") [[diff]](/attachment.cgi?id=549727&action=diff "patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=675515&attachment=549727)
patch
I'm not sure this does the right thing when one of the lengths is zero. The old code would have ended up firing one of the two events, although somewhat inefficiently. However this code looks as if it always fires both events. But the good news is that having fixed that you can then special-case on one of the lengths being zero and take this "fast" path.
> // Increase offset of the text leaf on skipped characters amount.
> mTextOffset += aSkipStart;
>
>+ if (strLen1 > kMaxStrLen || strLen2 > kMaxStrLen) {
>+ // Fire text change event for insertion and removal.
At first I wondered why you did that at this particular point in the code but then I realised that you don't fire the insertion or removal for the coinciding initial and final characters :-)
>+ const static PRUint32 kMaxStrLen = 2 << 6;
Did you mean 2^6? That's actually written 1 << 6. (I'm assuming you have a good feel as to how big a string you normally encounter in practice.)

|  | [alexander :surkov (:asurkov)](/user_profile?user_id=88369)  Assignee |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=675515#c4)• 13 years ago |
|  | |

(In reply to [comment #3](/show_bug.cgi?id=675515#c3 "VERIFIED FIXED - Crash [@ TextUpdater::DoUpdate] with long text node"))rz;
> >+ const static PRUint32 kMaxStrLen = 2 << 6;
> Did you mean 2^6? That's actually written 1 << 6. (I'm assuming you have a
> good feel as to how big a string you normally encounter in practice.)
Yes, I meant 2^6. It doesn't sound like the user can change the text twice in one processing, i.e. in case where AT would want to announce user actions. For other changes I think it's ok if AT just updates the text on its side. The used number is rough approximation where it can be too expensive to start the string difference algorithm. I don't have enough data for fair judgement, I think we can tweak it in the future.

|  | [alexander :surkov (:asurkov)](/user_profile?user_id=88369)  Assignee |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=675515#c5)• 13 years ago |
|  | |

Attached patch

[patch2](attachment.cgi?id=549758&action=diff) (obsolete)
— [Details](attachment.cgi?id=549758&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=675515&attachment=549758)

[Attachment #549727](/attachment.cgi?id=549727&action=edit "patch") -
Attachment is obsolete: true
[Attachment #549727](/attachment.cgi?id=549727&action=edit "patch") -
Flags: superreview?(neil)
[Attachment #549727](/attachment.cgi?id=549727&action=edit "patch") -
Flags: review?(trev.saunders)
[Attachment #549758](/attachment.cgi?id=549758&action=edit "patch2") -
Flags: superreview?(neil)
[Attachment #549758](/attachment.cgi?id=549758&action=edit "patch2") -
Flags: review?(trev.saunders)

|  | [Jesse Ruderman](/user_profile?user_id=11608)  Reporter |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=675515#c6)• 13 years ago |
|  | |

Can you explain what causes the crash and why adding this seemingly-arbitrary limit fixes it?

|  | [alexander :surkov (:asurkov)](/user_profile?user_id=88369)  Assignee |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=675515#c7)• 13 years ago |
|  | |

(In reply to [comment #6](/show_bug.cgi?id=675515#c6 "VERIFIED FIXED - Crash [@ TextUpdater::DoUpdate] with long text node"))
> Can you explain what causes the crash and why adding this
> seemingly-arbitrary limit fixes it?
The problem is it's supposed that the array should be larger than address space (while it's not). So while the array is iterated then you get the case when \*(pointer+=increment) doesn't point to any array item.

|  | [Jesse Ruderman](/user_profile?user_id=11608)  Reporter |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=675515#c8)• 13 years ago |
|  | |

What array? How could it possibly be larger than my 2^64 address space?

|  | [alexander :surkov (:asurkov)](/user_profile?user_id=88369)  Assignee |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=675515#c9)• 13 years ago |
|  | |

I don't know much about internals, so it's likely guesses reasonable at some precision.
I started from the point that entries array
PRUint32 len1 = 2^16, len2 = 2^16 + delta;
PRUint32\* entries = new PRUint32[len1 \* len2];
can't be larger than 2^32. I guessed that result len1 \* len2 is casted to PRUint32 (the same time not sure though whether arrays larger than 2^32 are allowed in 32 builds).
And then when you iterate it
PRUint32\* iter = entries;
for (PRUint32 i = 0; i < len2; i++) {
iter += len1;
for (PRUint32 j = 0; j < len1; j ++) {
\*(iter + j) should through us out of array
}
}
sine it should be equivalent to PRUint32\* iter = entries + (2^32 + something) what is overflow.

|  | [Jesse Ruderman](/user_profile?user_id=11608)  Reporter |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=675515#c10)• 13 years ago |
|  | |

Ok, that makes sense.
What is the impact on accessibility to only compute the edit distance for tiny strings? Is there a bug on switching to a more efficient Levenshtein distance algorithm?

|  | [alexander :surkov (:asurkov)](/user_profile?user_id=88369)  Assignee |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=675515#c11)• 13 years ago |
|  | |

(In reply to [comment #10](/show_bug.cgi?id=675515#c10 "VERIFIED FIXED - Crash [@ TextUpdater::DoUpdate] with long text node"))
> What is the impact on accessibility to only compute the edit distance for
> tiny strings?
I think it shouldn't end up with broken AT user experience (I put some thoughts in [comment #4](/show_bug.cgi?id=675515#c4 "VERIFIED FIXED - Crash [@ TextUpdater::DoUpdate] with long text node")).
> Is there a bug on switching to a more efficient Levenshtein
> distance algorithm?
there's no bug, I appreciate if you could file it and share ideas.

|  | [Jesse Ruderman](/user_profile?user_id=11608)  Reporter |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=675515#c12)• 13 years ago |
|  | |

Filed [bug 675685](/show_bug.cgi?id=675685 "NEW - TextUpdater::DoUpdate computes Levenshtein Edit Distance inefficiently").

|  | [neil@parkwaycc.co.uk](/user_profile?user_id=14006) |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=675515#c13)• 13 years ago |
|  | |

Even in 64-bit builds the calculation is done in 32 bits. So for instance using the test case you get 0x10001 \* 0x10003 = 0x40003, not 0x100040003 (which would at least not crash, although I guess it would be somewhat slow...)

|  | [neil@parkwaycc.co.uk](/user_profile?user_id=14006) |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=675515#c14)• 13 years ago |
|  | |

Comment on [attachment 549758](/attachment.cgi?id=549758 "patch2") [[details]](/attachment.cgi?id=549758&action=edit "patch2") [[diff]](/attachment.cgi?id=549758&action=diff "patch2") [[review]](/page.cgi?id=splinter.html&ignore=&bug=675515&attachment=549758)
patch2
>+ if (strLen1 > kMaxStrLen || strLen2 > kMaxStrLen) {
Nit: could check for either length being zero here as well, since in that case the edit is the obvious edit anyway.
>+ const static PRUint32 kMaxStrLen = 2 << 6;
I thought we had agreed on 2^6...

|  | [Trevor Saunders (:tbsaunde)](/user_profile?user_id=401086) |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=675515#c15)• 13 years ago |
|  | |

(In reply to [comment #14](/show_bug.cgi?id=675515#c14 "VERIFIED FIXED - Crash [@ TextUpdater::DoUpdate] with long text node"))
> >+ const static PRUint32 kMaxStrLen = 2 << 6;
> I thought we had agreed on 2^6...
personally I think I'd like something a little larger than 64 characters in the longer string, probably in the range 2^7 - 2^10, but I agree 2 << 6 is a odd way to write it, I'd probably use 0x80, just 128, or as Neil sad 1 << 7.

|  | [Trevor Saunders (:tbsaunde)](/user_profile?user_id=401086) |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=675515#c16)• 13 years ago |
|  | |

(In reply to [comment #14](/show_bug.cgi?id=675515#c14 "VERIFIED FIXED - Crash [@ TextUpdater::DoUpdate] with long text node"))
> Comment on [attachment 549758](/attachment.cgi?id=549758 "patch2") [[details]](/attachment.cgi?id=549758&action=edit "patch2") [[diff]](/attachment.cgi?id=549758&action=diff "patch2") [[review]](/page.cgi?id=splinter.html&ignore=&bug=675515&attachment=549758) [diff] [details] [review]
> patch2
>
> >+ if (strLen1 > kMaxStrLen || strLen2 > kMaxStrLen) {
> Nit: could check for either length being zero here as well, since in that
> case the edit is the obvious edit anyway.
uh, I don't think it should ever be 0 therebecause of the checks we do earlier see line 92 or so.

|  | [Trevor Saunders (:tbsaunde)](/user_profile?user_id=401086) |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=675515#c17)• 13 years ago |
|  | |

Comment on [attachment 549758](/attachment.cgi?id=549758 "patch2") [[details]](/attachment.cgi?id=549758&action=edit "patch2") [[diff]](/attachment.cgi?id=549758&action=diff "patch2") [[review]](/page.cgi?id=splinter.html&ignore=&bug=675515&attachment=549758)
patch2
>+ if (strLen1 > kMaxStrLen || strLen2 > kMaxStrLen) {
>+ if (strLen1 > 0) {
isn't this always true because of the checks we do for a only appen case around line 91?
>+ // Fire text change event for removal.
>+ nsRefPtr<AccEvent> textRemoveEvent =
>+ new AccTextChangeEvent(mHyperText, mTextOffset, str1, PR\_FALSE);
>+ mDocument->FireDelayedAccessibleEvent(textRemoveEvent);
why not use the UpdateTextnFireEvent method?
>+ }
>+
>+ if (strLen2 > 0) {
>+ // Fire text change event for insertion.
>+ nsRefPtr<AccEvent> textInsertEvent =
>+ new AccTextChangeEvent(mHyperText, mTextOffset, str2, PR\_TRUE);
>+ mDocument->FireDelayedAccessibleEvent(textInsertEvent);
same, I gues it would mean to value change events, and a second update to our internal string, I'm not usre if that's a bad thing though since with the 2 text change events we're sort of claiming what happened was a remove and insert, so maybe we should infact fire 2 value change events.
>+ /\*\*
>+ \* The constant used to skip string difference calculation in case of long
>+ \* strings.
>+ \*/
>+ const static PRUint32 kMaxStrLen = 2 << 6;
in addition to the existing discussion of this why not make it private?
>+ var eventItem = aEventList[i];
I'd probably name it just event, but its not particularly clear to me that its nicer than just using aEventList[i].

|  | [neil@parkwaycc.co.uk](/user_profile?user_id=14006) |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=675515#c18)• 13 years ago |
|  | |

(In reply to [comment #16](/show_bug.cgi?id=675515#c16 "VERIFIED FIXED - Crash [@ TextUpdater::DoUpdate] with long text node"))
>(In reply to [comment #14](/show_bug.cgi?id=675515#c14 "VERIFIED FIXED - Crash [@ TextUpdater::DoUpdate] with long text node"))
>>(From update of [attachment 549758](/attachment.cgi?id=549758 "patch2") [[details]](/attachment.cgi?id=549758&action=edit "patch2") [[diff]](/attachment.cgi?id=549758&action=diff "patch2") [[review]](/page.cgi?id=splinter.html&ignore=&bug=675515&attachment=549758))
>>>+ if (strLen1 > kMaxStrLen || strLen2 > kMaxStrLen) {
>>Nit: could check for either length being zero here as well, since in that
>>case the edit is the obvious edit anyway.
>uh, I don't think it should ever be 0 therebecause of the checks we do
>earlier see line 92 or so.
I don't think that applies in the case of "XZ" -> "XYYY...YYYZ" does it?

|  | [Trevor Saunders (:tbsaunde)](/user_profile?user_id=401086) |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=675515#c19)• 13 years ago |
|  | |

(In reply to [comment #18](/show_bug.cgi?id=675515#c18 "VERIFIED FIXED - Crash [@ TextUpdater::DoUpdate] with long text node"))
> (In reply to [comment #16](/show_bug.cgi?id=675515#c16 "VERIFIED FIXED - Crash [@ TextUpdater::DoUpdate] with long text node"))
> >(In reply to [comment #14](/show_bug.cgi?id=675515#c14 "VERIFIED FIXED - Crash [@ TextUpdater::DoUpdate] with long text node"))
> >>(From update of [attachment 549758](/attachment.cgi?id=549758 "patch2") [[details]](/attachment.cgi?id=549758&action=edit "patch2") [[diff]](/attachment.cgi?id=549758&action=diff "patch2") [[review]](/page.cgi?id=splinter.html&ignore=&bug=675515&attachment=549758) [diff] [details] [review])
> >>>+ if (strLen1 > kMaxStrLen || strLen2 > kMaxStrLen) {
> >>Nit: could check for either length being zero here as well, since in that
> >>case the edit is the obvious edit anyway.
> >uh, I don't think it should ever be 0 therebecause of the checks we do
> >earlier see line 92 or so.
> I don't think that applies in the case of "XZ" -> "XYYY...YYYZ" does it?
if you mean the case of "xy" -> "xay" then yes, I think the current code issies the fast path possible, but I think the check at line 113 can be changed to take aSkipStart into account to fix that.

|  | [neil@parkwaycc.co.uk](/user_profile?user_id=14006) |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=675515#c20)• 13 years ago |
|  | |

(In reply to [comment #19](/show_bug.cgi?id=675515#c19 "VERIFIED FIXED - Crash [@ TextUpdater::DoUpdate] with long text node"))
> (In reply to [comment #18](/show_bug.cgi?id=675515#c18 "VERIFIED FIXED - Crash [@ TextUpdater::DoUpdate] with long text node"))
> > I don't think that applies in the case of "XZ" -> "XYYY...YYYZ" does it?
>
> if you mean the case of "xy" -> "xay" then yes, I think the current code
> issies the fast path possible, but I think the check at line 113 can be
> changed to take aSkipStart into account to fix that.
In the case of "xy" -> "xay" then aSkipStart is 1 and skipEnd is 1 but minLen is 2 so neither branch is taken.

|  | [Trevor Saunders (:tbsaunde)](/user_profile?user_id=401086) |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=675515#c21)• 13 years ago |
|  | |

(In reply to [comment #20](/show_bug.cgi?id=675515#c20 "VERIFIED FIXED - Crash [@ TextUpdater::DoUpdate] with long text node"))
> (In reply to [comment #19](/show_bug.cgi?id=675515#c19 "VERIFIED FIXED - Crash [@ TextUpdater::DoUpdate] with long text node"))
> > (In reply to [comment #18](/show_bug.cgi?id=675515#c18 "VERIFIED FIXED - Crash [@ TextUpdater::DoUpdate] with long text node"))
> > > I don't think that applies in the case of "XZ" -> "XYYY...YYYZ" does it?
> >
> > if you mean the case of "xy" -> "xay" then yes, I think the current code
> > issies the fast path possible, but I think the check at line 113 can be
> > changed to take aSkipStart into account to fix that.
>
> In the case of "xy" -> "xay" then aSkipStart is 1 and skipEnd is 1 but
> minLen is 2 so neither branch is taken.
yes, that's why I said could be changed, not currently does :-)

|  | [alexander :surkov (:asurkov)](/user_profile?user_id=88369)  Assignee |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=675515#c22)• 13 years ago |
|  | |

(In reply to [comment #14](/show_bug.cgi?id=675515#c14 "VERIFIED FIXED - Crash [@ TextUpdater::DoUpdate] with long text node"))
> Comment on [attachment 549758](/attachment.cgi?id=549758 "patch2") [[details]](/attachment.cgi?id=549758&action=edit "patch2") [[diff]](/attachment.cgi?id=549758&action=diff "patch2") [[review]](/page.cgi?id=splinter.html&ignore=&bug=675515&attachment=549758) [diff] [details] [review]
> patch2
>
> >+ if (strLen1 > kMaxStrLen || strLen2 > kMaxStrLen) {
> Nit: could check for either length being zero here as well, since in that
> case the edit is the obvious edit anyway.
Either length can be zero so that insert or delete or both events can be fired. I didn't catch your idea, could you give details please?
> >+ const static PRUint32 kMaxStrLen = 2 << 6;
> I thought we had agreed on 2^6...
Sorry, I missed correction when read it.

|  | [alexander :surkov (:asurkov)](/user_profile?user_id=88369)  Assignee |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=675515#c23)• 13 years ago |
|  | |

(In reply to [comment #21](/show_bug.cgi?id=675515#c21 "VERIFIED FIXED - Crash [@ TextUpdater::DoUpdate] with long text node"))
> > In the case of "xy" -> "xay" then aSkipStart is 1 and skipEnd is 1 but
> > minLen is 2 so neither branch is taken.
>
> yes, that's why I said could be changed, not currently does :-)
this should require us to change the whole logic, currently we just fall out into levenshtein algorithm what's not expensive in case of single insertion or deletion.

|  | [alexander :surkov (:asurkov)](/user_profile?user_id=88369)  Assignee |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=675515#c24)• 13 years ago |
|  | |

(In reply to [comment #13](/show_bug.cgi?id=675515#c13 "VERIFIED FIXED - Crash [@ TextUpdater::DoUpdate] with long text node"))
> Even in 64-bit builds the calculation is done in 32 bits. So for instance
> using the test case you get 0x10001 \* 0x10003 = 0x40003, not 0x100040003
> (which would at least not crash, although I guess it would be somewhat
> slow...)
Thank you, that's why we get out of range of the array.

|  | [neil@parkwaycc.co.uk](/user_profile?user_id=14006) |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=675515#c25)• 13 years ago |
|  | |

(In reply to [comment #22](/show_bug.cgi?id=675515#c22 "VERIFIED FIXED - Crash [@ TextUpdater::DoUpdate] with long text node"))
>(In reply to [comment #14](/show_bug.cgi?id=675515#c14 "VERIFIED FIXED - Crash [@ TextUpdater::DoUpdate] with long text node"))
>>(From update of [attachment 549758](/attachment.cgi?id=549758 "patch2") [[details]](/attachment.cgi?id=549758&action=edit "patch2") [[diff]](/attachment.cgi?id=549758&action=diff "patch2") [[review]](/page.cgi?id=splinter.html&ignore=&bug=675515&attachment=549758))
>>>+ if (strLen1 > kMaxStrLen || strLen2 > kMaxStrLen) {
>>Nit: could check for either length being zero here as well, since in that
>>case the edit is the obvious edit anyway.
>Either length can be zero so that insert or delete or both events can be
>fired. I didn't catch your idea, could you give details please?
Well, you're adding some code which handles the case "xaaa...aaay" -> "xbbb...bbby". You're doing this when a and b are large because the distance is too inefficient to compute. However you of course have to be careful to handle the two cases "xaaa...aaay" -> "xy" and "xy" -> "xbbb...bbby", which are a single delete and single insert respectively, but a and b are still large. I'm just pointing out that you can also use this block for the "xay" -> "xy" and "xy" -> "xby" cases even when a and b are not large, but the other is zero.
[In fact, having done this, you can even get rid of the "xa" <-> "x" and the "x" <-> "bx" special cases, but that's beyond the scope of this bug.]

|  | [alexander :surkov (:asurkov)](/user_profile?user_id=88369)  Assignee |  |
| --- | --- | --- |
| [Comment 26](/show_bug.cgi?id=675515#c26)• 13 years ago |
|  | |

New code works for:
"xaaa...aaay" -> "xbbb...bbby" (removal for bbb...bbb, insertion for aaa...aaa)
"xaaa...aaay" -> "xy" (removal for aaa...aaa)
"xy" -> "xbbb...bbby" (insertion for bbb...bbb)
also for cases like
"xaaa...coincidence...aaay" -> "xbbb...coincidence...bbby"
(removal for aaa...coincidence...aaa, insertion for bbb...coincidence...bbb
to make this code working for "xay" -> "xy" and "xy" -> "xby" (when a and b are small) I should check if a and b doesn't have common parts (for example, if these aren't two insertions). Maybe it's ok to continue Levenstain algorithm usage to keep these cases.
I'd be nice to get rid "xa" <-> "x" and the "x" <-> "bx" special cases, but currently they serve to protect from case when endSkipOffset < skipStartOffset.
I'm still not sure what's the best way to implement your suggestion.

|  | [neil@parkwaycc.co.uk](/user_profile?user_id=14006) |  |
| --- | --- | --- |
| [Comment 27](/show_bug.cgi?id=675515#c27)• 13 years ago |
|  | |

(In reply to [comment #26](/show_bug.cgi?id=675515#c26 "VERIFIED FIXED - Crash [@ TextUpdater::DoUpdate] with long text node"))
> to make this code working for "xay" -> "xy" and "xy" -> "xby" (when a and b
> are small) I should check if a and b doesn't have common parts (for example,
> if these aren't two insertions).
I think you might have misunderstood me; x and y denote the common parts; a and b have nothing in common with either x or y (or each other, but then again these are separate cases, not to be confused with "xay" -> "xby").

|  | [alexander :surkov (:asurkov)](/user_profile?user_id=88369)  Assignee |  |
| --- | --- | --- |
| [Comment 28](/show_bug.cgi?id=675515#c28)• 13 years ago |
|  | |

Attached patch

[patch3](attachment.cgi?id=550335&action=diff)
— [Details](attachment.cgi?id=550335&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=675515&attachment=550335)

[Attachment #549758](/attachment.cgi?id=549758&action=edit "patch2") -
Attachment is obsolete: true
[Attachment #549758](/attachment.cgi?id=549758&action=edit "patch2") -
Flags: superreview?(neil)
[Attachment #549758](/attachment.cgi?id=549758&action=edit "patch2") -
Flags: review?(trev.saunders)
[Attachment #550335](/attachment.cgi?id=550335&action=edit "patch3") -
Flags: superreview?(neil)
[Attachment #550335](/attachment.cgi?id=550335&action=edit "patch3") -
Flags: review?(trev.saunders)

|  | [neil@parkwaycc.co.uk](/user_profile?user_id=14006) |  |
| --- | --- | --- |
| [Comment 29](/show_bug.cgi?id=675515#c29)• 13 years ago |
|  | |

Comment on [attachment 550335](/attachment.cgi?id=550335 "patch3") [[details]](/attachment.cgi?id=550335&action=edit "patch3") [[diff]](/attachment.cgi?id=550335&action=diff "patch3") [[review]](/page.cgi?id=splinter.html&ignore=&bug=675515&attachment=550335)
patch3
I didn't realise you could eliminate UpdateTextNFireEvent too :-)
[Attachment #550335](/attachment.cgi?id=550335&action=edit "patch3") -
Flags: superreview?(neil) → superreview+

|  | [alexander :surkov (:asurkov)](/user_profile?user_id=88369)  Assignee |  |
| --- | --- | --- |
| [Comment 30](/show_bug.cgi?id=675515#c30)• 13 years ago |
|  | |

(In reply to [comment #29](/show_bug.cgi?id=675515#c29 "VERIFIED FIXED - Crash [@ TextUpdater::DoUpdate] with long text node"))
> Comment on [attachment 550335](/attachment.cgi?id=550335 "patch3") [[details]](/attachment.cgi?id=550335&action=edit "patch3") [[diff]](/attachment.cgi?id=550335&action=diff "patch3") [[review]](/page.cgi?id=splinter.html&ignore=&bug=675515&attachment=550335) [diff] [details] [review]
> patch3
>
> I didn't realise you could eliminate UpdateTextNFireEvent too :-)
I didn't too until I understood what you talk about :)

|  | [Trevor Saunders (:tbsaunde)](/user_profile?user_id=401086) |  |
| --- | --- | --- |
| [Comment 31](/show_bug.cgi?id=675515#c31)• 13 years ago |
|  | |

> >+ /\*\*
> >+ \* The constant used to skip string difference calculation in case of long
> >+ \* strings.
> >+ \*/
> >+ const static PRUint32 kMaxStrLen = 2 << 6;
>
> in addition to the existing discussion of this why not make it private?
>
> >+ var eventItem = aEventList[i];
>
> I'd probably name it just event, but its not particularly clear to me that
> its nicer than just using aEventList[i].
Alex, what about these two comments?

|  | [Trevor Saunders (:tbsaunde)](/user_profile?user_id=401086) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=675515#a263822_401086)• 13 years ago |

[Attachment #550335](/attachment.cgi?id=550335&action=edit "patch3") -
Flags: review?(trev.saunders) → review+

|  | [alexander :surkov (:asurkov)](/user_profile?user_id=88369)  Assignee |  |
| --- | --- | --- |
| [Comment 32](/show_bug.cgi?id=675515#c32)• 13 years ago |
|  | |

(In reply to [comment #31](/show_bug.cgi?id=675515#c31 "VERIFIED FIXED - Crash [@ TextUpdater::DoUpdate] with long text node"))
> > >+ /\*\*
> > >+ \* The constant used to skip string difference calculation in case of long
> > >+ \* strings.
> > >+ \*/
> > >+ const static PRUint32 kMaxStrLen = 2 << 6;
> >
> > in addition to the existing discussion of this why not make it private?
because it is private :)
> > >+ var eventItem = aEventList[i];
> >
> > I'd probably name it just event, but its not particularly clear to me that
> > its nicer than just using aEventList[i].
fine with me
> Alex, what about these two comments?
thank you for pointing it out, sorry I didn't addressed them early

|  | [alexander :surkov (:asurkov)](/user_profile?user_id=88369)  Assignee |  |
| --- | --- | --- |
| [Comment 33](/show_bug.cgi?id=675515#c33)• 13 years ago |
|  | |

(In reply to [comment #15](/show_bug.cgi?id=675515#c15 "VERIFIED FIXED - Crash [@ TextUpdater::DoUpdate] with long text node"))
> (In reply to [comment #14](/show_bug.cgi?id=675515#c14 "VERIFIED FIXED - Crash [@ TextUpdater::DoUpdate] with long text node"))
> > >+ const static PRUint32 kMaxStrLen = 2 << 6;
> > I thought we had agreed on 2^6...
>
> personally I think I'd like something a little larger than 64 characters in
> the longer string, probably in the range 2^7 - 2^10, but I agree 2 << 6 is a
> odd way to write it, I'd probably use 0x80, just 128, or as Neil sad 1 << 7.
let's keep it small for now, we could tweak it based on telemetry results (if it makes sense)

|  | [alexander :surkov (:asurkov)](/user_profile?user_id=88369)  Assignee |  |
| --- | --- | --- |
| [Comment 34](/show_bug.cgi?id=675515#c34)• 13 years ago |
|  | |

(In reply to [comment #17](/show_bug.cgi?id=675515#c17 "VERIFIED FIXED - Crash [@ TextUpdater::DoUpdate] with long text node"))
> same, I gues it would mean to value change events, and a second update to
> our internal string, I'm not usre if that's a bad thing though since with
> the 2 text change events we're sort of claiming what happened was a remove
> and insert, so maybe we should infact fire 2 value change events.
no, it doesn't matter how many times it was changed, all AT needs to know that value is different now (btw, they will be coalesced)

|  | [Trevor Saunders (:tbsaunde)](/user_profile?user_id=401086) |  |
| --- | --- | --- |
| [Comment 35](/show_bug.cgi?id=675515#c35)• 13 years ago |
|  | |

(In reply to [comment #32](/show_bug.cgi?id=675515#c32 "VERIFIED FIXED - Crash [@ TextUpdater::DoUpdate] with long text node"))
> (In reply to [comment #31](/show_bug.cgi?id=675515#c31 "VERIFIED FIXED - Crash [@ TextUpdater::DoUpdate] with long text node"))
> > > >+ /\*\*
> > > >+ \* The constant used to skip string difference calculation in case of long
> > > >+ \* strings.
> > > >+ \*/
> > > >+ const static PRUint32 kMaxStrLen = 2 << 6;
> > >
> > > in addition to the existing discussion of this why not make it private?
>
> because it is private :)
Oh, I see, we have a redundant private: right after it.

|  | [alexander :surkov (:asurkov)](/user_profile?user_id=88369)  Assignee |  |
| --- | --- | --- |
| [Comment 36](/show_bug.cgi?id=675515#c36)• 13 years ago |
|  | |

inbound land <http://hg.mozilla.org/integration/mozilla-inbound/rev/75c8a2eb9f87>Flags: in-testsuite+OS: Mac OS X → AllHardware: x86\_64 → AllWhiteboard: [sg:critical?] → [sg:critical?] [inbound]

|  | [alexander :surkov (:asurkov)](/user_profile?user_id=88369)  Assignee |  |
| --- | --- | --- |
| [Comment 37](/show_bug.cgi?id=675515#c37)• 13 years ago |
|  | |

landed <http://hg.mozilla.org/mozilla-central/rev/75c8a2eb9f87>Status: ASSIGNED → RESOLVEDClosed: 13 years agoResolution: --- → FIXEDWhiteboard: [sg:critical?] [inbound] → [sg:critical?]Target Milestone: --- → mozilla8

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=675515#a6398019_1689)• 13 years ago |

blocking1.9.2: --- → ?
[status-firefox8](/buglist.cgi?f1=cf_status_firefox8&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox8&o1=equals&v1=fixed)
[status-firefox9](/buglist.cgi?f1=cf_status_firefox9&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=fixed)
[tracking-firefox8](/buglist.cgi?f1=cf_tracking_firefox8&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox8&o1=equals&v1=%2B)
[tracking-firefox9](/buglist.cgi?f1=cf_tracking_firefox9&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox9&o1=equals&v1=%2B)

|  | [alexander :surkov (:asurkov)](/user_profile?user_id=88369)  Assignee |  |
| --- | --- | --- |
| [Comment 38](/show_bug.cgi?id=675515#c38)• 13 years ago |
|  | |

Firefox 3.6 is not affected because the patched code path was introduced as part of Firefox 4 big a11y rework: technically Firefox 4 started to cache the rendered text and operate on it. This problem appears when this text is long enough and thus this bug can't exists in Firefox 3.6.

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=675515#a7593836_425645)• 13 years ago |

blocking1.9.2: ? → ---
[status1.9.2](/buglist.cgi?f1=cf_status_192&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_192&o1=equals&v1=unaffected)

|  | [u279076](/user_profile?user_id=279076) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=675515#a9779863_279076)• 13 years ago |

Whiteboard: [sg:critical?] → [sg:critical?][qa+]

|  | [Henrik Skupin [:whimboo][⌚️UTC+2]](/user_profile?user_id=76551) |  |
| --- | --- | --- |
| [Comment 39](/show_bug.cgi?id=675515#c39)• 13 years ago |
|  | |

I'm trying to verify this fix but when I execute the code from [comment 0](/show_bug.cgi?id=675515#c0 "VERIFIED FIXED - Crash [@ TextUpdater::DoUpdate] with long text node") in the JS console I only get an error that it is undefined. Can't I use a debug nightly build from the FTP server for testing?

|  | [alexander :surkov (:asurkov)](/user_profile?user_id=88369)  Assignee |  |
| --- | --- | --- |
| [Comment 40](/show_bug.cgi?id=675515#c40)• 13 years ago |
|  | |

(In reply to Henrik Skupin (:whimboo) from [comment #39](/show_bug.cgi?id=675515#c39 "VERIFIED FIXED - Crash [@ TextUpdater::DoUpdate] with long text node"))
> I'm trying to verify this fix but when I execute the code from [comment 0](/show_bug.cgi?id=675515#c0 "VERIFIED FIXED - Crash [@ TextUpdater::DoUpdate] with long text node") in
> the JS console I only get an error that it is undefined. Can't I use a debug
> nightly build from the FTP server for testing?
If you do that on mac then yes since accessibility is not a part of default build.

|  | [Henrik Skupin [:whimboo][⌚️UTC+2]](/user_profile?user_id=76551) |  |
| --- | --- | --- |
| [Comment 41](/show_bug.cgi?id=675515#c41)• 13 years ago |
|  | |

How do I enable accessibility in debug builds? Which flag do I have to set?

|  | [Jesse Ruderman](/user_profile?user_id=11608)  Reporter |  |
| --- | --- | --- |
| [Comment 42](/show_bug.cgi?id=675515#c42)• 13 years ago |
|  | |

1. In mozconfig:
ac\_add\_options --enable-accessibility
(It's disabled by default on Mac, but Tinderbox has a special mozconfig that turns it on for Mac debug builds. So you could download a Tinderbox debug build.)
2. At runtime, paste into the Error Console:
Components.classes["@mozilla.org/accessibilityService;1"]
.getService(Components.interfaces.nsIAccessibleRetrieval);
If you get an [xpconnect wrapped nsIAccessibleRetrieval], it worked.

|  | [Henrik Skupin [:whimboo][⌚️UTC+2]](/user_profile?user_id=76551) |  |
| --- | --- | --- |
| [Comment 43](/show_bug.cgi?id=675515#c43)• 13 years ago |
|  | |

Thanks for the Tinderbox hint, Jesse! I was optimistic that it [1] will work but sadly it doesn't. I still get the undefined error. I will now rebuilt my local debug build with the make option set.
[1] <http://ftp.mozilla.org/pub/mozilla.org/firefox/tinderbox-builds/mozilla-central-macosx-debug/1323288955/>

|  | [Jesse Ruderman](/user_profile?user_id=11608)  Reporter |  |
| --- | --- | --- |
| [Comment 44](/show_bug.cgi?id=675515#c44)• 13 years ago |
|  | |

Try a 64-bit Mac Tinderbox build.
<http://mxr.mozilla.org/mozilla-central/search?string=enable-accessibility>

|  | [Henrik Skupin [:whimboo][⌚️UTC+2]](/user_profile?user_id=76551) |  |
| --- | --- | --- |
| [Comment 45](/show_bug.cgi?id=675515#c45)• 13 years ago |
|  | |

Verified fixed with:
Mozilla/5.0 (Macintosh; Intel Mac OS X 10.7; rv:9.0) Gecko/20111206 Firefox/9.0
Mozilla/5.0 (Windows NT 5.1; rv:8.0.1) Gecko/20100101 Firefox/8.0.1
Mozilla/5.0 (X11; Linux i686; rv:8.0.1) Gecko/20100101 Firefox/8.0.1
Can't test with the Firefox 8.0 release debug build on OS X because I still get the undefined error. But the 9.0 beta works pretty well and doesn't crash.Status: RESOLVED → VERIFIEDWhiteboard: [sg:critical?][qa+] → [sg:critical?][qa!]

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=675515#a14860163_1689)• 13 years ago |

Group: core-security
You need to [log in](/show_bug.cgi?id=675515&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Jesse Ruderman](/user_profile?user_id=11608)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from secunia.com_a24bb08b_20250125_045747.html ===


[Skip to main content](#main-content)
[![Home](/themes/custom/flexera/images/logo.svg)](https://www.flexera.com/)

[![Home](/themes/custom/flexera/images/logo.svg)](https://www.flexera.com/)

Search

## Main navigation

* Solutions
  + Column 1
    - Business challenge
      * [Software renewals and audits](https://www.flexera.com/solutions/software-renewals-audits)
      * [Software license management and optimization](https://www.flexera.com/solutions/software-usage-costs)
      * [SaaS spend management](https://www.flexera.com/solutions/saas-spend)
      * [Cloud cost management](https://www.flexera.com/solutions/cloud-cost)
      * [IT asset lifecycle management](https://www.flexera.com/solutions/it-asset-lifecycle)
      * [CMDB data quality](https://www.flexera.com/solutions/cmdb-data-quality)
      * [Accurate IT inventory](https://www.flexera.com/solutions/it-inventory)
      * [Security and regulatory risk management](https://www.flexera.com/solutions/it-security-regulatory-risk)
      * [Sustainable IT](https://www.flexera.com/solutions/sustainable-it)
      * [AI-powered transformation](https://www.flexera.com/solutions/ai-powered-transformation)
      * [Public sector](https://www.flexera.com/solutions/public-sector)
  + Column 2
    - Spend management by vendor
      * [IBM](https://www.flexera.com/solutions/vendor/ibm)
      * [Oracle](https://www.flexera.com/solutions/vendor/oracle)
      * [Microsoft](https://www.flexera.com/solutions/vendor/microsoft)
      * [SAP](https://www.flexera.com/solutions/vendor/sap)
      * [VMware](https://www.flexera.com/solutions/vendor/vmware)
      * [ServiceNow](https://www.flexera.com/solutions/vendor/servicenow)
      * [AWS](https://www.flexera.com/solutions/vendor/aws)
      * [Salesforce](https://www.flexera.com/solutions/vendor/salesforce)
      * [BMC](https://www.flexera.com/solutions/cmdb-data-quality/bmc)
      * [Adobe](https://www.flexera.com/solutions/vendor/adobe)

  ### Achieve more through a united FinOps and ITAM function

  The future is hybrid. Break down the walls between ITAM and FinOps to drive more revenue, more customer growth and more innovation.

  [Discover More](https://www.flexera.com/resources/hybrid-itam-finops)
* Products
  + Column 1
    - [Flexera One](https://www.flexera.com/products/flexera-one)
      * [IT Visibility](https://www.flexera.com/products/flexera-one/it-visibility)
      * [ITAM](https://www.flexera.com/products/flexera-one/it-asset-management)
      * [SaaS Management](https://www.flexera.com/products/flexera-one/saas-management)
      * [FinOps](https://www.flexera.com/products/flexera-one/finops)
      * [Technology Intelligence Platform](https://www.flexera.com/products/flexera-one/technology-intelligence-platform)
  + Column 2
    - [Snow Atlas](https://www.flexera.com/products/snow-atlas)
      * [Snow Spend Optimizer](https://www.flexera.com/products/snow-atlas/snow-spend-optimizer)
      * [Snow SaaS Management](https://www.flexera.com/products/snow-atlas/snow-saas-management)
  + Column 3
    - Hide group
      * [Security](https://www.flexera.com/products/security)
      * [Application Readiness](https://www.flexera.com/products/adminstudio)
      * [All products](https://www.flexera.com/products)
      * [All Snow products](https://www.flexera.com/products/snow)
      * [Integrations](https://www.flexera.com/products/integrations)

  ### Flexera 2024 State of the Cloud Report

  What do transformative initiatives such as GenAI, machine learning and sustainability mean for the cloud? Check out the 2024 State of the Cloud Report to find the answer as well as all the latest cloud computing trends.

  [View Report](https://info.flexera.com/CM-REPORT-State-of-the-Cloud)
* Success
  + Column 1
    - [Customer success](https://www.flexera.com/customer-success)
      * Support
        + [Flexera support portal](https://community.flexera.com/s/support-hub)
        + [Flexera product documentation](https://docs.flexera.com)
        + [Snow product documentation](https://docs.snowsoftware.io/)
      * Services and training
        + [Services](https://www.flexera.com/customer-success/services)
        + [Training](https://www.flexera.com/customer-success/training)
  + Column 2
    - Hide group
      * [Technology Intelligence Awards](https://www.flexera.com/customer-success/awards)
      * [Flexera community](https://community.flexera.com/s/)

  ### Insights from Gartner®

  Find a curated series of actionable and objective insights for IT executives and their teams. Get expert insights from valued analysts, courtesy of Flexera.

  [Discover More](https://www.flexera.com/resources/gartner-analyst-research)
* Resources
  + Column 1
    - [Resources](https://www.flexera.com/resources)
      * [Webinars](https://www.flexera.com/resources?type%5Bwebinar%5D=webinar)
      * [Videos](https://www.flexera.com/resources?type%5Bvideo%5D=video)
      * [Datasheets](https://www.flexera.com/resources?type%5Bdatasheet%5D=datasheet)
      * [White papers & reports](https://www.flexera.com/resources?type%5Bwhite-paper-industry-report%5D=white-paper-industry-report)
  + Column 2
    - Hide group
      * [Blog](/blog/)
      * [Case studies](https://www.flexera.com/resources/case-studies)
      * [Events](https://www.flexera.com/resources?type%5Bevent%5D=event)
      * [Analyst Research](https://www.flexera.com/resources/gartner-analyst-research)
      * [Glossary](https://www.flexera.com/resources/glossary)
      * [Demos & trials](https://www.flexera.com/resources?type%5Bdemo-trials%5D=demo-trials)
      * [Business value calculator](https://www.flexera.com/resources/business-value-calculator)

  ### Flexera 2025 IT Priorities Report

  Insights from Flexera’s 2025 IT Priorities Report highlight what’s top of mind for IT decision makers in the year ahead. Discover the challenges, priorities and opportunities that will shape the future IT landscape.

  [View Report](https://info.flexera.com/ITV-REPORT-IT-Priorities)
* About
  + Column 1
    - [Company](https://www.flexera.com/about-us)
      * [About](https://www.flexera.com/about-us)
      * [Careers](https://www.flexera.com/about-us/careers)
      * [Contact](https://www.flexera.com/about-us/contact-us)
      * [Leadership](https://www.flexera.com/about-us/leadership)
    - [Partners](https://www.flexera.com/about-us/partners)
      * [Partner program](https://www.flexera.com/about-us/partners/partner-program)
      * [Partner directory](https://www.flexera.com/about-us/partners/directory)
  + Column 2
    - [Press center](https://www.flexera.com/about-us/press-center)
      * [Press releases](https://www.flexera.com/about-us/all-press-releases)
      * [Awards](https://www.flexera.com/about-us/press-center#awards)
      * [Articles](https://www.flexera.com/about-us/all-articles)
    - Hide group
      * Social responsibility
        + [ESG](https://www.flexera.com/about-us/environmental-social-governance)
        + [Diversity](https://www.flexera.com/about-us/diversity)

  ### More value with technology intelligence

  The unparalleled synergy of Flexera and Snow provides the Technology Intelligence you need for more efficiency, insight and governance than ever before.

  [Discover More](https://www.flexera.com/more-value-with-technology-intelligence)

Search

en

* [English](https://www.flexera.com/products/security/software-vulnerability-research/secunia-research?referrer=secunia)
* [Deutsch](https://www.flexera.de/products/security/software-vulnerability-research/secunia-research?referrer=secunia)

## External Links

* External Links
  + [Community](https://community.flexera.com/)
  + [Product Access](https://app.flexera.com/login)
  + [Partner Portal](https://flexera.channeltivity.com/Login)

[Book a demo](/about-us/contact-us?C_Interest1=sales)

# Secunia Research

## The world’s best vulnerability intelligence

The Secunia Research team from Flexera provides the most accurate and reliable source of vulnerability intelligence.

[Contact Us](https://www.flexera.com/about-us/contact-us?C_Interest1=sales&C_SolutionInterest=SVM)
Watch video (0:29)

Related links

* [Anatomy of a security advisory](https://www.flexera.com/resources/infographics/anatomy-of-a-security-advisory)
* [Software Vulnerability Research](https://www.flexera.com/products/software-vulnerability-research)
* [Software Vulnerability Manager](/products/software-vulnerability-manager)
* [Security advisories from Secunia Research](https://www.flexera.com/products/security/software-vulnerability-advisories)
* [Report a vulnerability](https://www.flexera.com/about-us/contact-us/report-vulnerability)

 ![Secunia Research](/sites/default/files/2022-04/hero-secunia-research-bg.jpg)

Featured Details

## Multiple ways to consume Secunia Research

Secunia delivers software security research that provides reliable, curated and actionable vulnerability intelligence. Organizations can expect to receive standardized, validated and enriched vulnerability research on a specific version of a software product. Secunia Research supports four solutions:

![Software Vulnerability Research](/sites/default/files/2022-04/icon-secunia-research-svr.svg)

### [Software Vulnerability Research](https://www.flexera.com/products/software-vulnerability-research)

Software Vulnerability Research utilizes Secunia Research to drive awareness of vulnerabilities matching your specified criteria

[Learn More](https://www.flexera.com/products/software-vulnerability-research)

![Software Vulnerability Manager](/sites/default/files/2022-04/icon-secunia-research-svm.svg)

### [Software Vulnerability Manager](/products/software-vulnerability-manager)

Software Vulnerability Manager uses Secunia Research data to identify, prioritize and patch known vulnerable software detected in your environment

[Learn More](/products/software-vulnerability-manager)

![Data Platform](/sites/default/files/2022-04/icon-secunia-research-dp.svg)

### [Data Platform](https://www.flexera.com/products/data-platform)

Data Platform leverages Secunia Research to provide high-level insights based on major or minor versions of software in your normalized inventory

[Learn More](https://www.flexera.com/products/data-platform)

![Flexera One](/sites/default/files/2022-04/icon-secunia-research-flexera-one.svg)

### [Flexera One](/flexera-one)

Flexera One utilizes Secunia Research (alongside public NVD data) to provide more granular matching of build-level versions of software in your normalized inventory within its IT Asset Management and IT Visibility solutions

[Learn More](/flexera-one)

How it works

## Accurate, reliable vulnerability insights at your fingertips

The Secunia Research team from Flexera is comprised of several security specialists who conduct vulnerability research in various products in addition to testing, verifying and validating public vulnerability reports. Since its inception in 2002, the goal of the Secunia Research team is to provide the most accurate and reliable source of vulnerability intelligence.

Delivering the world’s best vulnerability intelligence requires skill and passion. Team members continually develop their skills exploring various high-profile closed and open-source software using a variety of approaches, focusing chiefly on thorough code audits and binary analysis. The team has received industry recognition, including naming members to [Microsoft’s Most Valuable Security Researchers](https://msrc-blog.microsoft.com/2019/08/07/announcing-2019-msrc-most-valuable-security-researchers/) list.

Secunia researchers discover hard-to-find vulnerabilities that aren’t normally identified with techniques such as fuzzing, and the results have been impressive. Members of the Secunia Research team have discovered critical vulnerabilities in products from vendors including Microsoft, Symantec, IBM, Adobe, RealNetworks, Trend Micro, HP, Blue Coat, Samba, CA, Mozilla and Apple.

The team produces invaluable security advisories based on research of the vulnerabilities affecting any given software update. Sometimes a single update can address multiple vulnerabilities of varying criticalities and threats; but these advisories aggregate and distill findings down to a single advisory perfect for the prioritization of patching efforts within [Software Vulnerability Manager](/products/software-vulnerability-manager). Criticality scores are consistently applied along with details around attack vector and other valuable details within [Software Vulnerability Research](/products/software-vulnerability-research/secunia-research). Illegitimate vulnerability reports are also investigated and rejected so you can focus only on what truly matters.

Informing IT, Transforming IT

## Industry insights to help keep you informed

[#### Webinar

### Stay Ahead of Cyber Threats: Flexera's Latest Vulnerability Insights

Join us for this session where we'll explore the latest findings from the Flexera Monthly Vulnerability Insights Report.](https://info.flexera.com/SVM-WBNR-Vulnerability-Insights-Roundtable)

[#### Webinar

### Dive deeper into the Flexera Annual Vulnerability Insights

We'll explore the key findings from the Flexera Annual Vulnerability Insights Report. Learn about the latest cybersecurity trends, the most targeted industries, the types of vulnerabilities, plus management and mitigation strategies.](https://info.flexera.com/SVM-WBNR-Flexera-Annual-Vulnerability-Insights?lead_source=Website%20Visitor&id=Flexera.com-Resources)

#### Video

### Close the Risk Window with Software Vulnerability Manager

Stop reacting. Gain control. Stay secure. Build a more effective risk mitigation process leveraging Secunia Research vulnerability intelligence and the largest repository of third-party patch data in the industry.

Remote video URL

[#### Trial

### Software Vulnerability Manager Assessment free trial

Get access to the complete set of modules of Software Vulnerability Manager: Research, Assessment and Patching](https://info.flexera.com/SVM-EVAL-Software-Vulnerability-Manager)

[#### Datasheet

### Protect your ServiceNow® investment with the highest quality data

IT Visibility offers certified ServiceNow integrations that accelerate platform expansion, improve ROI and increase efficiencies across ITIL processes by delivering clean software and hardware asset data directly.](/sites/default/files/datasheet-itv-maximize-servicenow-investment.pdf)

[#### Blog

### Avoid missing crucial vulnerability intelligence amid NVD backlog

Recent developments regarding the National Vulnerability Database (NVD) have some technology leaders on edge. Since February, the U.S. National Institute of Standards and Technology (NIST) has almost completely stopped enriching software vulnerabi...](https://www.flexera.com/blog/vulnerability-management/avoid-missing-crucial-vulnerability-intelligence-amid-nvd-backlog/)

[View all resources](https://www.flexera.com/resources?category%5Bsoftware-vulnerability-management%5D=software-vulnerability-management)

## Footer Menu

* Column
  + Business challenge
    - [Software renewals and audits](https://www.flexera.com/solutions/software-renewals-audits)
    - [Software license management and optimization](https://www.flexera.com/solutions/software-usage-costs)
    - [SaaS spend management](https://www.flexera.com/solutions/saas-spend)
    - [Cloud cost management](https://www.flexera.com/solutions/cloud-cost)
    - [IT asset lifecycle management](https://www.flexera.com/solutions/it-asset-lifecycle)
    - [CMDB data quality](https://www.flexera.com/solutions/cmdb-data-quality)
    - [Accurate IT inventory](https://www.flexera.com/solutions/it-inventory)
    - [Security and regulatory risk management](https://www.flexera.com/solutions/it-security-regulatory-risk)
    - [Sustainable IT](https://www.flexera.com/solutions/sustainable-it)
    - [AI-powered transformation](https://www.flexera.com/solutions/ai-powered-transformation)
    - [Public sector](https://www.flexera.com/solutions/public-sector)
* Column
  + Spend management by vendor
    - [IBM](https://www.flexera.com/solutions/vendor/ibm)
    - [Oracle](https://www.flexera.com/solutions/vendor/oracle)
    - [Microsoft](https://www.flexera.com/solutions/vendor/microsoft)
    - [SAP](https://www.flexera.com/solutions/vendor/sap)
    - [VMware](https://www.flexera.com/solutions/vendor/vmware)
    - [ServiceNow](https://www.flexera.com/solutions/vendor/servicenow)
    - [AWS](https://www.flexera.com/solutions/vendor/aws)
    - [Salesforce](https://www.flexera.com/solutions/vendor/salesforce)
    - [BMC](https://www.flexera.com/solutions/cmdb-data-quality/bmc)
    - [Adobe](https://www.flexera.com/solutions/vendor/adobe)
* Column
  + Products
    - [Flexera One](https://www.flexera.com/products/flexera-one)
    - [Snow Atlas](https://www.flexera.com/products/snow-atlas)
    - [Security](https://www.flexera.com/products/security)
    - [Application Readiness](https://www.flexera.com/products/adminstudio)
    - [All products](https://www.flexera.com/products)
    - [All Snow products](https://www.flexera.com/products/snow)
    - [Integrations](https://www.flexera.com/products/integrations)
* Column
  + Company
    - [About](https://www.flexera.com/about-us)
    - [Careers](https://www.flexera.com/about-us/careers)
    - [Leadership](https://www.flexera.com/about-us/leadership)
    - [Contact us](https://www.flexera.com/about-us/contact-us)
    - [Media / press center](https://www.flexera.com/about-us/press-center)
    - [Revenera.com](https://www.revenera.com)

 +1.800.374.4353

en

* [English](https://www.flexera.com/products/security/software-vulnerability-research/secunia-research?referrer=secunia)
* [Deutsch](https://www.flexera.de/products/security/software-vulnerability-research/secunia-research?referrer=secunia)

 [![Home](/themes/custom/flexera/images/logo.svg)](https://www.flexera.com/)

© 2025 Flexera. All Rights Reserved.

## Footer

* [Privacy Policy](https://www.flexera.com/legal/privacy-policy)
* [Terms and conditions](https://www.flexera.com/legal)
* [Contact Us](https://www.flexera.com/about-us/contact-us)
* [Impressum](https://www.flexera.com/about-us/impressum)
* [Site Map](https://www.flexera.com/sitemap)

#####

×

...


