=== Content from bugs.chromium.org_216a5855_20250125_040858.html ===



=== Content from trac.webkit.org_6df93cd4_20250125_040831.html ===


[![WebKit Trac](/chrome/site/favicon.png)](http://www.webkit.org/)

Search:

* [Login](/login)
* [Preferences](/prefs)
* [Forgot your password?](/reset_password)

* [Wiki](/wiki)
* [Timeline](/timeline)
* [Browse Source](/browser)
* [Search](/search)

## Context Navigation

* ← [Previous Changeset](/changeset/80578/webkit "Changeset 80578")
* [Next Changeset](/changeset/80580/webkit "Changeset 80580") →

---

# Changeset 80579 in webkit

View differences
inline
side by side

Show
lines around each change

Show the changes in full context

Ignore:

Blank lines

Case changes

White space changes

Timestamp:
Mar 8, 2011, 12:07:00 PM
([14 years](/timeline?from=2011-03-08T12%3A07%3A00-08%3A00&precision=second "See timeline at Mar 8, 2011, 12:07:00 PM") ago)
Author:
thakis@chromium.org
Message:

2011-03-08 Nico Weber <​thakis@chromium.org>

> Reviewed by James Robinson.

> Crash on big blur radius with canvas
>
> [​https://bugs.webkit.org/show\_bug.cgi?id=55951](https://bugs.webkit.org/show_bug.cgi?id=55951)

* fast/canvas/shadow-huge-blur-expected.txt: Added.
* fast/canvas/shadow-huge-blur.html: Added.

2011-03-08 Nico Weber <​thakis@chromium.org>

> Reviewed by James Robinson.

> Crash on big blur radius with canvas
>
> [​https://bugs.webkit.org/show\_bug.cgi?id=55951](https://bugs.webkit.org/show_bug.cgi?id=55951)

> Move the clamping code out of an if branch, so that it happens in the
>
> canvas case as well.

> Test: fast/canvas/shadow-huge-blur.html

* platform/graphics/cg/GraphicsContextCG.cpp:
  (WebCore::GraphicsContext::setPlatformShadow):

Location:
[trunk](/browser/webkit/trunk?rev=80579)
Files:

2 added
3 edited

* [LayoutTests/ChangeLog](/browser/webkit/trunk/LayoutTests/ChangeLog?rev=80579 "Show entry in browser")
  (modified)
  ([1 diff](#file0 "Show differences"))
* [LayoutTests/fast/canvas/shadow-huge-blur-expected.txt](/browser/webkit/trunk/LayoutTests/fast/canvas/shadow-huge-blur-expected.txt?rev=80579 "Show entry in browser")
  (added)
* [LayoutTests/fast/canvas/shadow-huge-blur.html](/browser/webkit/trunk/LayoutTests/fast/canvas/shadow-huge-blur.html?rev=80579 "Show entry in browser")
  (added)
* [Source/WebCore/ChangeLog](/browser/webkit/trunk/Source/WebCore/ChangeLog?rev=80579 "Show entry in browser")
  (modified)
  ([1 diff](#file3 "Show differences"))
* [Source/WebCore/platform/graphics/cg/GraphicsContextCG.cpp](/browser/webkit/trunk/Source/WebCore/platform/graphics/cg/GraphicsContextCG.cpp?rev=80579 "Show entry in browser")
  (modified)
  ([2 diffs](#file4 "Show differences"))

### Legend:

Unmodified
Added
Removed

* ## [trunk/LayoutTests/ChangeLog](/changeset/80579/webkit/trunk/LayoutTests/ChangeLog "Show the changeset 80579 restricted to trunk/LayoutTests/ChangeLog")

  | [r80576](/browser/webkit/trunk/LayoutTests/ChangeLog?rev=80576#L1 "Show revision 80576 of this file in browser") | [r80579](/browser/webkit/trunk/LayoutTests/ChangeLog?rev=80579#L1 "Show revision 80579 of this file in browser") |  |
  | --- | --- | --- |
  |  | 1 | 2011-03-08  Nico Weber  <thakis@chromium.org> |
  |  | 2 |  |
  |  | 3 | Reviewed by James Robinson. |
  |  | 4 |  |
  |  | 5 | Crash on big blur radius with canvas |
  |  | 6 | https://bugs.webkit.org/show\_bug.cgi?id=55951 |
  |  | 7 |  |
  |  | 8 | \* fast/canvas/shadow-huge-blur-expected.txt: Added. |
  |  | 9 | \* fast/canvas/shadow-huge-blur.html: Added. |
  |  | 10 |  |
  | 1 | 11 | 2011-03-08  Tony Chang  <tony@chromium.org> |
  | 2 | 12 |  |
* ## [trunk/Source/WebCore/ChangeLog](/changeset/80579/webkit/trunk/Source/WebCore/ChangeLog "Show the changeset 80579 restricted to trunk/Source/WebCore/ChangeLog")

  | [r80578](/browser/webkit/trunk/Source/WebCore/ChangeLog?rev=80578#L1 "Show revision 80578 of this file in browser") | [r80579](/browser/webkit/trunk/Source/WebCore/ChangeLog?rev=80579#L1 "Show revision 80579 of this file in browser") |  |
  | --- | --- | --- |
  |  | 1 | 2011-03-08  Nico Weber  <thakis@chromium.org> |
  |  | 2 |  |
  |  | 3 | Reviewed by James Robinson. |
  |  | 4 |  |
  |  | 5 | Crash on big blur radius with canvas |
  |  | 6 | https://bugs.webkit.org/show\_bug.cgi?id=55951 |
  |  | 7 |  |
  |  | 8 | Move the clamping code out of an if branch, so that it happens in the |
  |  | 9 | canvas case as well. |
  |  | 10 |  |
  |  | 11 | Test: fast/canvas/shadow-huge-blur.html |
  |  | 12 |  |
  |  | 13 | \* platform/graphics/cg/GraphicsContextCG.cpp: |
  |  | 14 | (WebCore::GraphicsContext::setPlatformShadow): |
  |  | 15 |  |
  | 1 | 16 | 2011-03-08  Chris Fleizach  <cfleizach@apple.com> |
  | 2 | 17 |  |
* ## [trunk/Source/WebCore/platform/graphics/cg/GraphicsContextCG.cpp](/changeset/80579/webkit/trunk/Source/WebCore/platform/graphics/cg/GraphicsContextCG.cpp "Show the changeset 80579 restricted to trunk/Source/WebCore/platform/graphics/cg/GraphicsContextCG.cpp")

  | [r80515](/browser/webkit/trunk/Source/WebCore/platform/graphics/cg/GraphicsContextCG.cpp?rev=80515#L930 "Show revision 80515 of this file in browser") | [r80579](/browser/webkit/trunk/Source/WebCore/platform/graphics/cg/GraphicsContextCG.cpp?rev=80579#L930 "Show revision 80579 of this file in browser") |  |
  | --- | --- | --- |
  | 930 | 930 | CGFloat smallEigenvalue = narrowPrecisionToCGFloat(sqrt(0.5 \* ((A + D) - sqrt(4 \* B \* C + (A - D) \* (A - D))))); |
  | 931 | 931 |  |
  | 932 |  | // Extreme "blur" values can make text drawing crash or take crazy long times, so clamp |
  | 933 |  | blurRadius = min(blur \* smallEigenvalue, narrowPrecisionToCGFloat(1000.0)); |
  |  | 932 | blurRadius = blur \* smallEigenvalue; |
  | 934 | 933 |  |
  | 935 | 934 | CGSize offsetInBaseSpace = CGSizeApplyAffineTransform(offset, userToBaseCTM); |
  | […](/browser/webkit/trunk/Source/WebCore/platform/graphics/cg/GraphicsContextCG.cpp?rev=80515#L938) | […](/browser/webkit/trunk/Source/WebCore/platform/graphics/cg/GraphicsContextCG.cpp?rev=80579#L937) |  |
  | 938 | 937 | yOffset = offsetInBaseSpace.height; |
  | 939 | 938 | } |
  |  | 939 |  |
  |  | 940 | // Extreme "blur" values can make text drawing crash or take crazy long times, so clamp |
  |  | 941 | blurRadius = min(blurRadius, narrowPrecisionToCGFloat(1000.0)); |
  | 940 | 942 |  |
  | 941 | 943 | // Work around <rdar://problem/5539388> by ensuring that the offsets will get truncated |
**Note:**
See [TracChangeset](/wiki/TracChangeset)
for help on using the changeset viewer.

### Download in other formats:

* [Unified Diff](?format=diff&new=80579)
* [Zip Archive](?format=zip&new=80579)

---

[![Trac Powered](/chrome/common/trac_logo_mini.png)](https://trac.edgewall.org/)

Powered by [**Trac 1.5.4**](/about)

By [Edgewall Software](http://www.edgewall.org/)
.

Hosted by [Apple](http://www.apple.com/)


