=== Content from scarybeastsecurity.blogspot.com_72808297_20250124_160313.html ===


# [Security](https://scarybeastsecurity.blogspot.com/)

Hacking everything, by Chris Evans / scarybeasts

## Wednesday, March 9, 2011

### Multi-browser heap address leak in XSLT

It's not often that I find a bug that affects multiple different codebases in the same way, but here is an interesting info-leak bug that is currently unpatched in Firefox, Internet Explorer and Safari.

I'm releasing it now for a few reasons:

1. The bug was already publicly noted [here](http://git.gnome.org/browse/libxslt/commit/?id=ecb6bcb8d1b7e44842edde3929f412d46b40c89f).

3. This bug cannot damage anyone in and of itself; it's a low severity info-leak that does not corrupt anything. It needs to be paired with other bugs, perhaps as an exploit aid against ASLR.

5. This is a rare and unique opportunity to directly compare vendor responses and response times for a near-identical bug. It's nice that this is a lower-severity issue as all vendors tend to treat critical issues with at least some urgency; lower severity issues serve as a better differentiator.

**The bug**
The bug is in the generate-id() XPath function, and is sometimes used in XSL transforms. Here's an web page that simply calls generate-id() and renders the result as a web page:

<https://cevans-app.appspot.com/static/genid.xml>

Let's see how this renders in different browsers:

**Firefox** (64-bit Linux)
`id0x00007fbac51c1000`

There is no "obfuscation" that this is a raw heap address. Since Firefox is open source, we can go and look at the source code to find that indeed, the string is generated from a pointer (txXPathNodeUtils::getXSLTId):
```
const char gPrintfFmt[] = "id0x%016p";
```

**Internet Explorer 8** (Windows 7)
`IDAW0MLB`

Doesn't look like a heap address, does it? If, however, you strip off the "ID" prefix and treat the string as a [A-Z0-5] base32 encoded "little endian" string, you resolve to a nice heap address. At that address is a pointer in msxml.dll, possibly the address of a vtable for some internal xml node class.

**Safari 5** (Mac OS X)
`id35865226`

Also does not immediately look like a heap address, but libxslt is doing a simple transform on a heap address:
```

    val = (unsigned long)((char *)cur - (char *)0);
    val /= sizeof(xmlNode);
    sprintf((char *)str, "id%ld", val);

```

**Opera**
`o14022440`
`o2148150600`
These object ids bounce around all over the place. I don't know what is going on so I'm not making the claim that Opera is affected.

**Chrome**
Latest stable Chrome (Chrome 10) is not affected. It has been removed from the "time to fix" competition in order to keep things fair.

It's on!! Who will fix it first and who will be the security laggard? Updates to be provided via Twitter: [@scarybeasts](http://twitter.com/#!/scarybeasts)

Posted by

[Chris Evans](https://www.blogger.com/profile/01004765479735675808 "author profile")

at

[10:10 AM](https://scarybeastsecurity.blogspot.com/2011/03/multi-browser-heap-address-leak-in-xslt.html "permanent link")

[![](https://resources.blogblog.com/img/icon18_edit_allbkg.gif)](https://www.blogger.com/post-edit.g?blogID=3024470480937744884&postID=6483071935887850597&from=pencil "Edit Post")

#### 9 comments:

![](//resources.blogblog.com/img/blank.gif "Anonymous")

Anonymous
said...

I think the code is doing exactly what the programmers intended, so it's not technically a bug.

[March 9, 2011 at 5:05 PM](https://scarybeastsecurity.blogspot.com/2011/03/multi-browser-heap-address-leak-in-xslt.html?showComment=1299719106686#c7944277690918831169 "comment permalink")
[![](https://resources.blogblog.com/img/icon_delete13.gif)](https://www.blogger.com/delete-comment.g?blogID=3024470480937744884&postID=7944277690918831169 "Delete Comment")

![](//resources.blogblog.com/img/blank.gif "Anonymous")

Anonymous
said...

re: Anonymous

This IS a security mistake and should be fixed. All object ids should not release information about their low end C/C++ implementation as this could be used to infer the memory layout at the moment of exploiting a vuln or even plainly bypass ASLR if the address used is inside some loaded module, for example.

From a user perspective, there's always a layer of abstraction from the back end implementation and the front end language (JS/XSLT/VB/whatever).

pablo.

[March 10, 2011 at 4:59 AM](https://scarybeastsecurity.blogspot.com/2011/03/multi-browser-heap-address-leak-in-xslt.html?showComment=1299761969476#c7548950047991954891 "comment permalink")
[![](https://resources.blogblog.com/img/icon_delete13.gif)](https://www.blogger.com/delete-comment.g?blogID=3024470480937744884&postID=7548950047991954891 "Delete Comment")

![](//resources.blogblog.com/img/blank.gif "Anonymous")

Anonymous
said...

How do you translate IDAW0MLB
into a heap address in details?

[March 10, 2011 at 12:53 PM](https://scarybeastsecurity.blogspot.com/2011/03/multi-browser-heap-address-leak-in-xslt.html?showComment=1299790416062#c6785615150014429181 "comment permalink")
[![](https://resources.blogblog.com/img/icon_delete13.gif)](https://www.blogger.com/delete-comment.g?blogID=3024470480937744884&postID=6785615150014429181 "Delete Comment")

![](//resources.blogblog.com/img/blank.gif "Jonas Sicking")

Jonas Sicking
said...

Thanks for finding this!

Unfortunately it appears that the fix for libxslt contains a couple of bugs. The patch does indeed fix the leak of heap addresses, but it in the process breaks the functionality of the generate-id function.

The point of the generate-id function is that it's supposed to generate unique strings for each node. This string needs to remain unique for a given transformation.

However, the patch can generate the same id for two different nodes in two ways:

First off, the string it returns appears to be the difference between a node and its owner document. However since multiple documents can be in an XSLT transformation, this can generate the same value for two different nodes with different owner documents.

Second, it appears that in an effort to avoid dealing with negative values, the code uses the absolute value of this difference. Meaning that a node that is located 100 bytes after its owner document and a node that is located 100 bytes before its owner document, will get the same generated id.

Would be lovely to see that fixed as to avoid having transforms break more or less randomly in libxslt based XSLT implementations.

/ Jonas

[March 16, 2011 at 3:57 PM](https://scarybeastsecurity.blogspot.com/2011/03/multi-browser-heap-address-leak-in-xslt.html?showComment=1300316266360#c2056272859641747240 "comment permalink")
[![](https://resources.blogblog.com/img/icon_delete13.gif)](https://www.blogger.com/delete-comment.g?blogID=3024470480937744884&postID=2056272859641747240 "Delete Comment")

[![](//www.blogger.com/img/blogger_logo_round_35.png "Chris Evans")](https://www.blogger.com/profile/01004765479735675808)
[Chris Evans](https://www.blogger.com/profile/01004765479735675808)
said...

@Jonas: the second case is actually OK. The id prefix varies between "idp" and "idm" depending on whether the delta was positive or negative.

I'm less qualified to comment on the first case, but I believe the libxslt maintainer consulted the spec and noted that generate-id() only guarantees the id to be unique within the current document.

Perhaps something to be continued over e-mail? I can do intros.

[March 16, 2011 at 4:41 PM](https://scarybeastsecurity.blogspot.com/2011/03/multi-browser-heap-address-leak-in-xslt.html?showComment=1300318899386#c2104988718019194559 "comment permalink")
[![](https://resources.blogblog.com/img/icon_delete13.gif)](https://www.blogger.com/delete-comment.g?blogID=3024470480937744884&postID=2104988718019194559 "Delete Comment")

![](//resources.blogblog.com/img/blank.gif "Jonas Sicking")

Jonas Sicking
said...

Yes, please lets chat about this over email. I think that is not a correct interpretation.

You can find my email in the bugzilla bug (https://bugzilla.mozilla.org/show\_bug.cgi?id=640339)

[April 6, 2011 at 9:41 AM](https://scarybeastsecurity.blogspot.com/2011/03/multi-browser-heap-address-leak-in-xslt.html?showComment=1302108066744#c8461086077980370111 "comment permalink")
[![](https://resources.blogblog.com/img/icon_delete13.gif)](https://www.blogger.com/delete-comment.g?blogID=3024470480937744884&postID=8461086077980370111 "Delete Comment")

![](//resources.blogblog.com/img/blank.gif "Anonymous")

Anonymous
said...

I can't believe that they would bother to allocate additional memory to generate an ID, when keeping a single pointer which you increment each time it's called would have worked perfectly fine.

[April 11, 2011 at 3:52 PM](https://scarybeastsecurity.blogspot.com/2011/03/multi-browser-heap-address-leak-in-xslt.html?showComment=1302562330932#c2146554562292471364 "comment permalink")
[![](https://resources.blogblog.com/img/icon_delete13.gif)](https://www.blogger.com/delete-comment.g?blogID=3024470480937744884&postID=2146554562292471364 "Delete Comment")

[![](//resources.blogblog.com/img/blank.gif "Steffen")](http://pideco.de)
[Steffen](http://pideco.de)
said...

I dont think that any holes are closed. This smells like a begin from a big thing. Leave on it.

[February 14, 2013 at 11:36 AM](https://scarybeastsecurity.blogspot.com/2011/03/multi-browser-heap-address-leak-in-xslt.html?showComment=1360870608642#c2196575047638872893 "comment permalink")
[![](https://resources.blogblog.com/img/icon_delete13.gif)](https://www.blogger.com/delete-comment.g?blogID=3024470480937744884&postID=2196575047638872893 "Delete Comment")

[![](//www.blogger.com/img/blogger_logo_round_35.png "Margarita Matthews")](https://www.blogger.com/profile/16654951545088940080)
[Margarita Matthews](https://www.blogger.com/profile/16654951545088940080)
said...

This was such an uplifting read! I’m grateful for the positivity and knowledge you share. Can’t wait for more!

[October 12, 2024 at 4:47 AM](https://scarybeastsecurity.blogspot.com/2011/03/multi-browser-heap-address-leak-in-xslt.html?showComment=1728733660750#c6895339551465785129 "comment permalink")
[![](https://resources.blogblog.com/img/icon_delete13.gif)](https://www.blogger.com/delete-comment.g?blogID=3024470480937744884&postID=6895339551465785129 "Delete Comment")

[Post a Comment](https://www.blogger.com/comment/fullpage/post/3024470480937744884/6483071935887850597)

[Newer Post](https://scarybeastsecurity.blogspot.com/2011/04/fiddling-with-chromiums-new-certificate.html "Newer Post")

[Older Post](https://scarybeastsecurity.blogspot.com/2011/03/busy-chrome-day.html "Older Post")

[Home](https://scarybeastsecurity.blogspot.com/)

Subscribe to:
[Post Comments (Atom)](https://scarybeastsecurity.blogspot.com/feeds/6483071935887850597/comments/default)

Subscribe to my Twitter feed: [@scarybeasts](https://twitter.com/scarybeasts).

## Subscribe To ScarybeastSecurity

![](https://resources.blogblog.com/img/widgets/arrow_dropdown.gif)
![](https://resources.blogblog.com/img/icon_feed12.png)
Posts

[![](https://resources.blogblog.com/img/widgets/subscribe-netvibes.png)](https://www.netvibes.com/subscribe.php?url=https%3A%2F%2Fscarybeastsecurity.blogspot.com%2Ffeeds%2Fposts%2Fdefault)
[![](https://resources.blogblog.com/img/widgets/subscribe-yahoo.png)](https://add.my.yahoo.com/content?url=https%3A%2F%2Fscarybeastsecurity.blogspot.com%2Ffeeds%2Fposts%2Fdefault)
[![](https://resources.blogblog.com/img/icon_feed12.png)
Atom](https://scarybeastsecurity.blogspot.com/feeds/posts/default)

![](https://resources.blogblog.com/img/widgets/arrow_dropdown.gif)
![](https://resources.blogblog.com/img/icon_feed12.png)
Posts

![](https://resources.blogblog.com/img/widgets/arrow_dropdown.gif)
![](https://resources.blogblog.com/img/icon_feed12.png)
Comments

[![](https://resources.blogblog.com/img/widgets/subscribe-netvibes.png)](https://www.netvibes.com/subscribe.php?url=https%3A%2F%2Fscarybeastsecurity.blogspot.com%2Ffeeds%2F6483071935887850597%2Fcomments%2Fdefault)
[![](https://resources.blogblog.com/img/widgets/subscribe-yahoo.png)](https://add.my.yahoo.com/content?url=https%3A%2F%2Fscarybeastsecurity.blogspot.com%2Ffeeds%2F6483071935887850597%2Fcomments%2Fdefault)
[![](https://resources.blogblog.com/img/icon_feed12.png)
Atom](https://scarybeastsecurity.blogspot.com/feeds/6483071935887850597/comments/default)

![](https://resources.blogblog.com/img/widgets/arrow_dropdown.gif)
![](https://resources.blogblog.com/img/icon_feed12.png)
Comments

## Blog Archive

* ►
  [2021](https://scarybeastsecurity.blogspot.com/2021/)
  (1)
  + ►
    [May](https://scarybeastsecurity.blogspot.com/2021/05/)
    (1)

* ►
  [2020](https://scarybeastsecurity.blogspot.com/2020/)
  (7)
  + ►
    [December](https://scarybeastsecurity.blogspot.com/2020/12/)
    (1)
  + ►
    [November](https://scarybeastsecurity.blogspot.com/2020/11/)
    (1)
  + ►
    [July](https://scarybeastsecurity.blogspot.com/2020/07/)
    (1)
  + ►
    [June](https://scarybeastsecurity.blogspot.com/2020/06/)
    (3)
  + ►
    [April](https://scarybeastsecurity.blogspot.com/2020/04/)
    (1)

* ►
  [2017](https://scarybeastsecurity.blogspot.com/2017/)
  (10)
  + ►
    [September](https://scarybeastsecurity.blogspot.com/2017/09/)
    (1)
  + ►
    [June](https://scarybeastsecurity.blogspot.com/2017/06/)
    (1)
  + ►
    [May](https://scarybeastsecurity.blogspot.com/2017/05/)
    (7)
  + ►
    [March](https://scarybeastsecurity.blogspot.com/2017/03/)
    (1)

* ►
  [2016](https://scarybeastsecurity.blogspot.com/2016/)
  (7)
  + ►
    [December](https://scarybeastsecurity.blogspot.com/2016/12/)
    (3)
  + ►
    [November](https://scarybeastsecurity.blogspot.com/2016/11/)
    (4)

* ►
  [2015](https://scarybeastsecurity.blogspot.com/2015/)
  (1)
  + ►
    [July](https://scarybeastsecurity.blogspot.com/2015/07/)
    (1)

* ►
  [2014](https://scarybeastsecurity.blogspot.com/2014/)
  (5)
  + ►
    [September](https://scarybeastsecurity.blogspot.com/2014/09/)
    (2)
  + ►
    [June](https://scarybeastsecurity.blogspot.com/2014/06/)
    (1)
  + ►
    [March](https://scarybeastsecurity.blogspot.com/2014/03/)
    (1)
  + ►
    [February](https://scarybeastsecurity.blogspot.com/2014/02/)
    (1)

* ►
  [2013](https://scarybeastsecurity.blogspot.com/2013/)
  (2)
  + ►
    [December](https://scarybeastsecurity.blogspot.com/2013/12/)
    (1)
  + ►
    [February](https://scarybeastsecurity.blogspot.com/2013/02/)
    (1)

* ►
  [2012](https://scarybeastsecurity.blogspot.com/2012/)
  (9)
  + ►
    [September](https://scarybeastsecurity.blogspot.com/2012/09/)
    (1)
  + ►
    [July](https://scarybeastsecurity.blogspot.com/2012/07/)
    (1)
  + ►
    [April](https://scarybeastsecurity.blogspot.com/2012/04/)
    (2)
  + ►
    [March](https://scarybeastsecurity.blogspot.com/2012/03/)
    (3)
  + ►
    [February](https://scarybeastsecurity.blogspot.com/2012/02/)
    (1)
  + ►
    [January](https://scarybeastsecurity.blogspot.com/2012/01/)
    (1)

* ▼
  [2011](https://scarybeastsecurity.blogspot.com/2011/)
  (10)
  + ►
    [July](https://scarybeastsecurity.blogspot.com/2011/07/)
    (1)
  + ►
    [May](https://scarybeastsecurity.blogspot.com/2011/05/)
    (2)
  + ►
    [April](https://scarybeastsecurity.blogspot.com/2011/04/)
    (1)
  + ▼
    [March](https://scarybeastsecurity.blogspot.com/2011/03/)
    (3)
    - [Multi-browser heap address leak in XSLT](https://scarybeastsecurity.blogspot.com/2011/03/multi-browser-heap-address-leak-in-xslt.html)
    - [Busy Chrome day...](https://scarybeastsecurity.blogspot.com/2011/03/busy-chrome-day.html)
    - [Dangerous file write bug in Foxit PDF Reader](https://scarybeastsecurity.blogspot.com/2011/03/dangerous-file-write-bug-in-foxit-pdf.html)
  + ►
    [February](https://scarybeastsecurity.blogspot.com/2011/02/)
    (2)
  + ►
    [January](https://scarybeastsecurity.blogspot.com/2011/01/)
    (1)

* ►
  [2010](https://scarybeastsecurity.blogspot.com/2010/)
  (11)
  + ►
    [October](https://scarybeastsecurity.blogspot.com/2010/10/)
    (1)
  + ►
    [September](https://scarybeastsecurity.blogspot.com/2010/09/)
    (1)
  + ►
    [August](https://scarybeastsecurity.blogspot.com/2010/08/)
    (1)
  + ►
    [July](https://scarybeastsecurity.blogspot.com/2010/07/)
    (3)
  + ►
    [June](https://scarybeastsecurity.blogspot.com/2010/06/)
    (1)
  + ►
    [March](https://scarybeastsecurity.blogspot.com/2010/03/)
    (1)
  + ►
    [January](https://scarybeastsecurity.blogspot.com/2010/01/)
    (3)

* ►
  [2009](https://scarybeastsecurity.blogspot.com/2009/)
  (29)
  + ►
    [December](https://scarybeastsecurity.blogspot.com/2009/12/)
    (3)
  + ►
    [November](https://scarybeastsecurity.blogspot.com/2009/11/)
    (2)
  + ►
    [October](https://scarybeastsecurity.blogspot.com/2009/10/)
    (3)
  + ►
    [September](https://scarybeastsecurity.blogspot.com/2009/09/)
    (1)
  + ►
    [August](https://scarybeastsecurity.blogspot.com/2009/08/)
    (2)
  + ►
    [July](https://scarybeastsecurity.blogspot.com/2009/07/)
    (3)
  + ►
    [June](https://scarybeastsecurity.blogspot.com/2009/06/)
    (4)
  + ►
    [May](https://scarybeastsecurity.blogspot.com/2009/05/)
    (3)
  + ►
    [March](https://scarybeastsecurity.blogspot.com/2009/03/)
    (3)
  + ►
    [February](https://scarybeastsecurity.blogspot.com/2009/02/)
    (4)
  + ►
    [January](https://scarybeastsecurity.blogspot.com/2009/01/)
    (1)

* ►
  [2008](https://scarybeastsecurity.blogspot.com/2008/)
  (20)
  + ►
    [December](https://scarybeastsecurity.blogspot.com/2008/12/)
    (2)
  + ►
    [November](https://scarybeastsecurity.blogspot.com/2008/11/)
    (5)
  + ►
    [October](https://scarybeastsecurity.blogspot.com/2008/10/)
    (1)
  + ►
    [August](https://scarybeastsecurity.blogspot.com/2008/08/)
    (3)
  + ►
    [July](https://scarybeastsecurity.blogspot.com/2008/07/)
    (5)
  + ►
    [March](https://scarybeastsecurity.blogspot.com/2008/03/)
    (1)
  + ►
    [February](https://scarybeastsecurity.blogspot.com/2008/02/)
    (3)

## My other stuff

* [My security advisories](http://scary.beasts.org/)
* [vsftpd home page](http://vsftpd.beasts.org/)
* [Tavis' security advisories](http://taviso.decsystem.org/research.html)

|  |  |
| --- | --- |

Simple theme. Theme images by [gaffera](https://www.istockphoto.com/googleimages.php?id=4072573&platform=blogger&langregion=en). Powered by [Blogger](https://www.blogger.com).


