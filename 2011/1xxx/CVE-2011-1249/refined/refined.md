Based on the provided content, here's a breakdown of the vulnerability associated with CVE-2011-1249:

**Root Cause of Vulnerability:**
- The vulnerability stems from the Ancillary Function Driver (AFD), `afd.sys`, improperly validating input passed from user mode to the kernel. This occurs when user-supplied data is not correctly checked before being processed by the kernel.

**Weaknesses/Vulnerabilities Present:**
- Improper input validation: The driver fails to properly sanitize data received from user-mode applications before passing it to the kernel. This allows attackers to send specially crafted inputs that can cause unintended behavior.

**Impact of Exploitation:**
- Elevation of Privilege: Successful exploitation allows an attacker to execute arbitrary code in kernel mode, gaining SYSTEM-level privileges.
- Full System Control: With SYSTEM privileges, an attacker can take complete control of the affected system, including:
    - Installing programs
    - Viewing, changing, or deleting data
    - Creating new accounts with full user rights

**Attack Vectors:**
- Local Access: An attacker must have valid logon credentials and be able to log on locally to the system to exploit the vulnerability.
- Crafted Application: The attacker needs to run a specially crafted application that can leverage the vulnerability.

**Required Attacker Capabilities/Position:**
- Valid logon credentials to the target system
- Ability to log on locally to the target system
- Ability to execute a custom application on the target system

**Additional Technical Details:**
- The vulnerability is present in `afd.sys`, which is responsible for managing Winsock TCP/IP communications.
- The vulnerability can be triggered through a specially crafted I/O control (IOCTL) request to the AFD driver.
- Exploits often overwrite the HalDispatchTable to redirect execution to attacker-controlled code.
- The exploit needs to locate the base address of kernel modules (`ntoskrnl.exe` or `ntkrnlpa.exe`) and the address of `HalDispatchTable` in kernel space.
- The exploit often involves creating a shellcode to escalate privileges by stealing the system token from the SYSTEM process.

**Affected Systems:**
The vulnerability affects multiple Windows versions including:
- Windows XP SP3
- Windows XP Professional x64 Edition SP2
- Windows Server 2003 SP2
- Windows Server 2003 x64 Edition SP2
- Windows Server 2003 with SP2 for Itanium-based Systems
- Windows Vista SP1 and SP2
- Windows Vista x64 Edition SP1 and SP2
- Windows Server 2008 (all editions)
- Windows 7 (all editions)
- Windows Server 2008 R2 (all editions)

**Mitigation:**
- The vulnerability is addressed by Microsoft Security Update MS11-046 (KB2503665). Applying this update corrects how AFD validates input, preventing exploitation.

**Exploit Code Examples:**
- The provided exploit code examples demonstrate how to connect to a socket, overwrite the HalDispatchTable with a shellcode that steals system token, and then trigger the vulnerability.
- The shellcode is injected into memory with RWX permissions and designed to replace the token of the current process with the SYSTEM process token.

**Notes:**
- Several security patches might have replaced the original patch over time (MS11-046, MS11-080, MS12-009, MS13-093, MS14-040)
- Some exploits cause BSOD on shutdown/reset
- Windows 7 64-bit systems are not vulnerable to this specific exploit

This information is extracted from the multiple sources provided.