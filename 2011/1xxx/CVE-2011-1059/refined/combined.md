=== Content from code.google.com_36aa7141_20250124_154003.html ===



=== Content from bugs.webkit.org_e668e9e5_20250124_154020.html ===

 [WebKit Bugzilla](./)

* [New](enter_bug.cgi)
* [Browse](describecomponents.cgi)
* Log In
  ×

  Sign in with GitHub

  or

   Remember my login
  [Create Account](/createaccount.cgi)
  ·
  [Forgot Password](show_bug.cgi?id=52819&GoAheadAndLogIn=1#forgot)

  ## Forgotten password account recovery

RESOLVED
FIXED
[52819](show_bug.cgi?id=52819)

Crash in WebCore::HistoryController::itemsAreClones
```
https://bugs.webkit.org/show_bug.cgi?id=52819
```

[Summary](page.cgi?id=fields.html#short_desc "The bug summary is a short sentence which succinctly describes what the bug is about.")
Crash in WebCore::HistoryController::itemsAreClones

Tony Gentilcore

[Reported](show_bug.cgi?id=52819#c0)
2011-01-20 09:37:56 PST

This is the most popular crasher on the Chromium dev channel. <http://trac.webkit.org/changeset/76205> seems to be in the right area and timeframe.
0x021d5555 [chrome.dll - historycontroller.cpp:669] WebCore::HistoryController::itemsAreClones(WebCore::HistoryItem \*,WebCore::HistoryItem \*)
0x021d537b [chrome.dll - historycontroller.cpp:614] WebCore::HistoryController::recursiveSetProvisionalItem(WebCore::HistoryItem \*,WebCore::HistoryItem \*,WebCore::FrameLoadType)
0x021d540d [chrome.dll - historycontroller.cpp:627] WebCore::HistoryController::recursiveSetProvisionalItem(WebCore::HistoryItem \*,WebCore::HistoryItem \*,WebCore::FrameLoadType)
0x021d4a1a [chrome.dll - historycontroller.cpp:248] WebCore::HistoryController::goToItem(WebCore::HistoryItem \*,WebCore::FrameLoadType)
0x024b1b36 [chrome.dll - webframeimpl.cpp:898] WebKit::WebFrameImpl::loadHistoryItem(WebKit::WebHistoryItem const &)
0x01d373fd [chrome.dll - render\_view.cc:1450] RenderView::OnNavigate(ViewMsg\_Navigate\_Params const &)
0x00000005

| Attachments | | |
| --- | --- | --- |
| [**Patch**](attachment.cgi?id=79788 "View the content of the attachment") (3.18 KB, patch)  [2011-01-21 14:02 PST](#attach_79788 "Go to the comment associated with the attachment"), Charles Reis | *no flags* | [Details](attachment.cgi?id=79788&action=edit)[Formatted Diff](attachment.cgi?id=79788&action=prettypatch)[Diff](attachment.cgi?id=79788&action=diff) |
| [**Patch**](attachment.cgi?id=80874 "View the content of the attachment") (10.82 KB, patch)  [2011-02-01 19:02 PST](#attach_80874 "Go to the comment associated with the attachment"), Charles Reis | *no flags* | [Details](attachment.cgi?id=80874&action=edit)[Formatted Diff](attachment.cgi?id=80874&action=prettypatch)[Diff](attachment.cgi?id=80874&action=diff) |
| [**Patch**](attachment.cgi?id=81018 "View the content of the attachment") (11.55 KB, patch)  [2011-02-02 18:08 PST](#attach_81018 "Go to the comment associated with the attachment"), Charles Reis | *no flags* | [Details](attachment.cgi?id=81018&action=edit)[Formatted Diff](attachment.cgi?id=81018&action=prettypatch)[Diff](attachment.cgi?id=81018&action=diff) |
| [**Patch**](attachment.cgi?id=81128 "View the content of the attachment") (11.65 KB, patch)  [2011-02-03 15:49 PST](#attach_81128 "Go to the comment associated with the attachment"), Charles Reis | *no flags* | [Details](attachment.cgi?id=81128&action=edit)[Formatted Diff](attachment.cgi?id=81128&action=prettypatch)[Diff](attachment.cgi?id=81128&action=diff) |
| [**Patch**](attachment.cgi?id=81286 "View the content of the attachment") (11.63 KB, patch)  [2011-02-04 14:32 PST](#attach_81286 "Go to the comment associated with the attachment"), Charles Reis | *no flags* | [Details](attachment.cgi?id=81286&action=edit)[Formatted Diff](attachment.cgi?id=81286&action=prettypatch)[Diff](attachment.cgi?id=81286&action=diff) |
| [Show Obsolete](#a0) (4) [View All](attachment.cgi?bugid=52819&action=viewall&hide_obsolete=1)  [Add attachment](attachment.cgi?bugid=52819&action=enter) *proposed patch, testcase, etc.* | | |

Mihai Parparita

[Comment 1](show_bug.cgi?id=52819#c1)
2011-01-20 09:40:49 PST

I think you meant <http://trac.webkit.org/changeset/75336>.

Charles Reis

[Comment 2](show_bug.cgi?id=52819#c2)
2011-01-20 10:15:23 PST

Interesting. There's an ASSERT on both arguments in recursiveSetProvisionalItem, but it turns out ASSERTs are compiled out of release builds:
<http://webkit.org/coding/assertion-guidelines.html>
It's possible the crash happens if both item1 and item2 are null. We should still see the ASSERT failing even in debug builds if that's the case-- we just have to find out the repro steps.
Here's the crashing code, for reference:
bool HistoryController::itemsAreClones(HistoryItem\* item1, HistoryItem\* item2) const
{
// If the item we're going to is a clone of the item we're at, then we do
// not need to load it again. The current frame tree and the frame tree
// snapshot in the item have to match.
// Note: Some clients treat a navigation to the current history item as
// a reload. Thus, if item1 and item2 are the same, we need to create a
// new document and should not consider them clones.
// (See [http://webkit.org/b/35532](show_bug.cgi?id=35532 "RESOLVED FIXED - REGRESSION: [view goToBackForwardItem:[[view backForwardList] currentItem]] is broken") for details.)
return item1 != item2
&& item1->itemSequenceNumber() == item2->itemSequenceNumber()
&& currentFramesMatchItem(item1)
&& item2->hasSameFrames(item1);
}

Mihai Parparita

[Comment 3](show_bug.cgi?id=52819#c3)
2011-01-20 13:56:33 PST

BTW, from looking at about a dozen crash reports, these were all long-lived renderer processes, so this isn't happening during session restore (the comment at <http://trac.webkit.org/browser/trunk/Source/WebKit/chromium/src/WebFrameImpl.cpp#L887> suggests that this is one case where currentItem can be null).

Charles Reis

[Comment 4](show_bug.cgi?id=52819#c4)
2011-01-21 11:57:41 PST

Here's what we know so far.
The crash happens when recursiveSetProvisionalItem passes null for either "item" or "fromItem" (but not both) to itemsAreClones. (If both were null, itemsAreClones would just return false before crashing.)
The crash only happens on recursive calls of depth 2 or more, meaning there has to be at least one subframe involved. For example, we'll see this stack trace if we go back or forward to a page with frames (or on a subframe navigation).
If "item" is null, that means the original destination item had a null value in its HistoryItemVector of children. Maybe that's possible?
If "fromItem" is null, that means fromItem->childItemWithTarget(frameName) returned null in the previous call. That seems unlikely, because we know from the previous call to itemsAreClones that the frame trees of the current and destination item match.
Either way, I'm surprised we're not seeing crashes from debug builds due to recursiveSetProvisionalItem's ASSERTs. I haven't figured out how to reproduce the crash yet, but I could put in some defensive code to help us find it.

Charles Reis

[Comment 5](show_bug.cgi?id=52819#c5)
2011-01-21 13:01:24 PST

Just discovered another crash report from the same logic in recursiveGoToItem before I split it out into itemsAreClones in <http://trac.webkit.org/changeset/75336>. Still trying to nail down the repro case, but this suggests that the underlying cause could be outside this patch.
My current theory is that we're passing in a corrupt history item with null as one of the child items. That would lead to the stack trace in this crash, both before and after the 75336 patch.

Charles Reis

[Comment 6](show_bug.cgi?id=52819#c6)
2011-01-21 14:02:39 PST

Created [attachment 79788](attachment.cgi?id=79788&action=diff "Patch") [[details]](attachment.cgi?id=79788&action=edit "Patch")
Patch

WebKit Commit Bot

[Comment 7](show_bug.cgi?id=52819#c7)
2011-01-21 15:47:08 PST

Comment on [attachment 79788](attachment.cgi?id=79788&action=diff "Patch") [[details]](attachment.cgi?id=79788&action=edit "Patch")
Patch
Clearing flags on attachment: 79788
Committed [r76406](https://commits.webkit.org/r76406): <<http://trac.webkit.org/changeset/76406>>

WebKit Commit Bot

[Comment 8](show_bug.cgi?id=52819#c8)
2011-01-21 15:47:15 PST

All reviewed patches have been landed. Closing bug.

Mihai Parparita

[Comment 9](show_bug.cgi?id=52819#c9)
2011-01-21 15:59:06 PST

Reopening since this bug isn't actually fixed.
Charlie, you can ping someone (adele?) in #webkit to get Bugzilla editing privileges even before you get committer. Also, for cases like this you can also open another bug with your small change and mark it as blocking this bug (IIRC, there's a historical preference for having one commit per bug).

Charles Reis

[Comment 10](show_bug.cgi?id=52819#c10)
2011-01-28 13:08:15 PST

I found a plausible way this bug could be happening, but I haven't found exact repro steps yet.
From the crash dumps, it turns out that item2 (i.e., fromItem) is actually null, not item1. In [comment #4](show_bug.cgi?id=52819#c4), I noted this was unlikely because the previous call to itemsAreClones told us the frame tree match, but it turns out that logic is buggy.
HistoryItem::hasSameFrames(otherItem) checks that the target name of every child in the current HistoryItem shows up in one of the children of otherItem. It does not check the reverse, meaning that the current HistoryItem could have two children with target "foo" and otherItem could have one child with "foo" and another with "bar".
If we get into that state, we'll see this crash when we go back in frame "foo". In that case, we'll try to call recursiveSetProvisionalItem on frame "bar", end up with NULL for fromItem, and crash in itemsAreClones.
Now we just need to figure out how the target of the current HistoryItem's children could get corrupted.

Brady Eidson

[Comment 11](show_bug.cgi?id=52819#c11)
2011-01-31 12:31:22 PST

In radar as <rdar://problem/8938557>

Charles Reis

[Comment 12](show_bug.cgi?id=52819#c12)
2011-02-01 19:02:20 PST

Created [attachment 80874](attachment.cgi?id=80874&action=diff "Patch") [[details]](attachment.cgi?id=80874&action=edit "Patch")
Patch

Charles Reis

[Comment 13](show_bug.cgi?id=52819#c13)
2011-02-01 19:06:28 PST

Comment on [attachment 80874](attachment.cgi?id=80874&action=diff "Patch") [[details]](attachment.cgi?id=80874&action=edit "Patch")
Patch
I'm having trouble getting the layout test to reproduce the crash. Going back twice with the back button reliably crashes in recursiveSetProvisionalItem, but neither queueBackNavigation nor history.back hit that code. Is there another way I can tell the browser to go back in a layout test?

Darin Fisher (:fishd, Google)

[Comment 14](show_bug.cgi?id=52819#c14)
2011-02-01 21:27:09 PST

queueBackNavigation is the layout test specific method for requesting a back navigation. that will wait until the page is fully loaded before processing the back navigation. maybe that is related to why this isn't reproducible?

Charles Reis

[Comment 15](show_bug.cgi?id=52819#c15)
2011-02-02 13:43:48 PST

(In reply to [comment #14](show_bug.cgi?id=52819#c14))
> queueBackNavigation is the layout test specific method for requesting a back navigation. that will wait until the page is fully loaded before processing the back navigation. maybe that is related to why this isn't reproducible?
Actually, it's much more subtle! It turns out history.back() does get to recursiveSetProvisionalItem, just like the back button. It even has a memory error, but it happens not to crash.
We already figured out that we crash when we hit the back button because we delete fromItem after calling itemsAreClones (on the m\_provisionalItem = item line, since fromItem and m\_provisionalItem are the same in this case). On the recursive call, fromItem is 0-- boom.
If we call history.back() instead, we delete that item \*before\* we get to itemsAreClones, back in HistoryController::goToItem() (when we call setGlobalHistoryItem). Even though we're still using a deleted pointer in that case, we don't happen to crash. Instead, itemsAreClones returns false when it notices fromItem doesn't have any children. This is still bad, because it doesn't update the provisional item.
Either way, I noticed a flaw in my expectations file-- after going back twice, we should be at the original HistoryItem, not the second one.
All this boils down to the fact that we're not clearing the provisional item after getting to an error page (like the confirm form resubmission page in this test).
Question: what's the intended behavior for an error page? Should we commit the provisional item and make it the last committed item? Or should we cancel the provisional item and act like we didn't go anywhere? (More specifically in this case, if I get an error page when I click back, what's supposed to happen if I click back again?) I'm guessing we want to commit it, but that isn't currently happening.

Darin Fisher (:fishd, Google)

[Comment 16](show_bug.cgi?id=52819#c16)
2011-02-02 13:46:44 PST

In Chromium (in render\_view.cc), it takes care to load the error page with the "replace" parameter set to true when the error page should be shown in place of a back/forward entry. It only sets replace to false when we need to show an error page for a new navigation that failed to complete.
In other words, I believe that in the back/forward case, the error page should take the place of the page you were trying to navigate back to.

Charles Reis

[Comment 17](show_bug.cgi?id=52819#c17)
2011-02-02 18:01:41 PST

(In reply to [comment #16](show_bug.cgi?id=52819#c16))
> In Chromium (in render\_view.cc), it takes care to load the error page with the "replace" parameter set to true when the error page should be shown in place of a back/forward entry. It only sets replace to false when we need to show an error page for a new navigation that failed to complete.
>
> In other words, I believe that in the back/forward case, the error page should take the place of the page you were trying to navigate back to.
Thanks-- that helps. I was able to get the error page to commit by changing HistoryController::updateForCommit. (It needed to commit for FrameLoadTypeReplace in addition to the back/forward load types.)
After that, Chrome seems to work properly. I needed another change to test\_shell, so that it doesn't forget the page ID when we do the load (of the error page). test\_shell is now working.
Unfortunately, DumpRenderTree is also still behaving incorrectly-- it doesn't commit when we go back or forward to an error page. I'll probably need to update that as well. I'll upload the patch of what I have so far for feedback, and I'll work on DumpRenderTree in the mean time.

Charles Reis

[Comment 18](show_bug.cgi?id=52819#c18)
2011-02-02 18:08:19 PST

Created [attachment 81018](attachment.cgi?id=81018&action=diff "Patch") [[details]](attachment.cgi?id=81018&action=edit "Patch")
Patch

Darin Fisher (:fishd, Google)

[Comment 19](show_bug.cgi?id=52819#c19)
2011-02-02 22:02:53 PST

Comment on [attachment 81018](attachment.cgi?id=81018&action=diff "Patch") [[details]](attachment.cgi?id=81018&action=edit "Patch")
Patch
This change makes sense to me.

Brady Eidson

[Comment 20](show_bug.cgi?id=52819#c20)
2011-02-03 08:52:25 PST

Comment on [attachment 81018](attachment.cgi?id=81018&action=diff "Patch") [[details]](attachment.cgi?id=81018&action=edit "Patch")
Patch
View in context: <https://bugs.webkit.org/attachment.cgi?id=81018&action=review>
I understand the goal is to keep certain items Ref'ed, as previously they were being destroyed before last-use. However this is mis-using (Pass)RefPtrs.
PassRefPtr is for transferring ownership, which you're not actually doing (except for the one case I pointed out).
If that one case is the only one necessary to change, then that's all you should change.
If the other changes are necessary, you need to leave them as raw pointers and simply RefPtr<> them within the function body where you think they might unintentionally be destroyed.
> Source/WebCore/loader/HistoryController.cpp:613
> {
With item, you are potentially passing ownership, and it makes sense to use a PassRefPtr. For fromItem, I only see a .get() comparison, so the PassRefPtr isn't needed.
> Source/WebCore/loader/HistoryController.cpp:621
>
m\_provisionalItem is already a RefPtr - Why do you need the extra targetItem RefPtr here? You're adding ref-count churn which is surprisingly bad for performance.
> Source/WebCore/loader/HistoryController.cpp:640
> {
Same thing here - PassRefPtrs are for actually passing ownership, and I don't see that you are passing ownership in this method.

Brady Eidson

[Comment 21](show_bug.cgi?id=52819#c21)
2011-02-03 08:53:27 PST

(In reply to [comment #20](show_bug.cgi?id=52819#c20))
> (From update of [attachment 81018](attachment.cgi?id=81018&action=diff "Patch") [[details]](attachment.cgi?id=81018&action=edit "Patch"))
> View in context: <https://bugs.webkit.org/attachment.cgi?id=81018&action=review>
>
> I understand the goal is to keep certain items Ref'ed, as previously they were being destroyed before last-use. However this is mis-using (Pass)RefPtrs.
>
> PassRefPtr is for transferring ownership, which you're not actually doing (except for the one case I pointed out).
>
> If that one case is the only one necessary to change, then that's all you should change.
>
> If the other changes are necessary, you need to leave them as raw pointers and simply RefPtr<> them within the function body where you think they might unintentionally be destroyed.
>
> > Source/WebCore/loader/HistoryController.cpp:613
> > {
>
> With item, you are potentially passing ownership, and it makes sense to use a PassRefPtr. For fromItem, I only see a .get() comparison, so the PassRefPtr isn't needed.
>
> > Source/WebCore/loader/HistoryController.cpp:621
> >
>
> m\_provisionalItem is already a RefPtr - Why do you need the extra targetItem RefPtr here? You're adding ref-count churn which is surprisingly bad for performance.
>
> > Source/WebCore/loader/HistoryController.cpp:640
> > {
>
> Same thing here - PassRefPtrs are for actually passing ownership, and I don't see that you are passing ownership in this method.
Sorry for the commenting fail here - the inline review comments feature never does what I intend. sigh. Hopefully lining up the line numbers manually will make it obvious what I meant.

Eric Seidel (no email)

[Comment 22](show_bug.cgi?id=52819#c22)
2011-02-03 12:18:41 PST

Maybe Adam or Ojan can fix the review tool to do what you intend? Can you be more specific?

Adam Barth

[Comment 23](show_bug.cgi?id=52819#c23)
2011-02-03 12:29:46 PST

> Hopefully lining up the line numbers manually will make it obvious what I meant.
You can also use the "view in context" link to have the review tool line up the comments with the lines for you.

Charles Reis

[Comment 24](show_bug.cgi?id=52819#c24)
2011-02-03 15:02:52 PST

Comment on [attachment 81018](attachment.cgi?id=81018&action=diff "Patch") [[details]](attachment.cgi?id=81018&action=edit "Patch")
Patch
View in context: <https://bugs.webkit.org/attachment.cgi?id=81018&action=review>
Thanks. I've got an improved fix but my approach on the layout test isn't going to work. (DumpRenderTree doesn't show error pages in either Chromium or WebKit.) Thankfully, there's another set of repro steps in [bug 53708](show_bug.cgi?id=53708 "RESOLVED FIXED - HistoryController does not commit provisional item on same document navigation in subframe"). I think I'll try to fix that issue here, since the layout test for that works here as well.
>>> Source/WebCore/loader/HistoryController.cpp:613
>>> {
>>
>> With item, you are potentially passing ownership, and it makes sense to use a PassRefPtr. For fromItem, I only see a .get() comparison, so the PassRefPtr isn't needed.
>
> Sorry for the commenting fail here - the inline review comments feature never does what I intend. sigh. Hopefully lining up the line numbers manually will make it obvious what I meant.
The bug was that m\_provisionalItem and fromItem were the same, so that assigning item to m\_provisionalItem deleted the old value (i.e., fromItem) while we still needed it. I was using PassRefPtr for fromItem to prevent this, but you're right that it's incorrect. All we need is to change currentItem to a RefPtr in goToItem (above) to ensure it doesn't get deleted here.
As you mentioned, we're potentially passing ownership of item, but we received it as a raw pointer anyway (in goToItem). In retrospect, I don't think we need PassRefPtr even there.

Charles Reis

[Comment 25](show_bug.cgi?id=52819#c25)
2011-02-03 15:49:15 PST

Created [attachment 81128](attachment.cgi?id=81128&action=diff "Patch") [[details]](attachment.cgi?id=81128&action=edit "Patch")
Patch

Charles Reis

[Comment 26](show_bug.cgi?id=52819#c26)
2011-02-03 15:50:32 PST

Comment on [attachment 81128](attachment.cgi?id=81128&action=diff "Patch") [[details]](attachment.cgi?id=81128&action=edit "Patch")
Patch
This patch fixes the memory error (with a RefPtr in goToItem), the issue that going back to an error page needs to be committed (in updateForCommit), and the issue that going back to a hash in a frame needs to be committed (in updateForSameDocumentNavigation).
As I mentioned, DumpRenderTree doesn't show error pages, so the layout test covers the memory error and the commit of subframe hash navigations.

Charles Reis

[Comment 27](show_bug.cgi?id=52819#c27)
2011-02-04 12:47:00 PST

Comment on [attachment 81128](attachment.cgi?id=81128&action=diff "Patch") [[details]](attachment.cgi?id=81128&action=edit "Patch")
Patch
Anyone have a chance to look at this today? If it looks good, it'd be great to get the crash fix in before the weekend.

Mihai Parparita

[Comment 28](show_bug.cgi?id=52819#c28)
2011-02-04 13:45:30 PST

Comment on [attachment 81128](attachment.cgi?id=81128&action=diff "Patch") [[details]](attachment.cgi?id=81128&action=edit "Patch")
Patch
View in context: <https://bugs.webkit.org/attachment.cgi?id=81128&action=review>
> LayoutTests/fast/history/history-back-forward-within-subframe-hash.html:3
> +onload = function() {
Nit: There isn't a formal style guide for JavaScript used in layout tests, but generally the convention is to follow the WebKit C++ style (four space indents, function braces on their own line).
> LayoutTests/fast/history/resources/history-back-forward-within-subframe-hash-2.html:15
> + parent.document.getElementById("result").innerText = "First visit";
If you use the js-test framework (see same-document-iframes-changing-fragment.html, history-traversal-is-asynchronous.html, and a few other tests in the directory), then you can turn these into log statements instead of replacing the result text. That makes failures easier to debug, since you can more clearly see at what stage the actual output started to deviate from the expected one.

Charles Reis

[Comment 29](show_bug.cgi?id=52819#c29)
2011-02-04 14:32:36 PST

Created [attachment 81286](attachment.cgi?id=81286&action=diff "Patch") [[details]](attachment.cgi?id=81286&action=edit "Patch")
Patch

WebKit Commit Bot

[Comment 30](show_bug.cgi?id=52819#c30)
2011-02-04 16:46:38 PST

The commit-queue encountered the following flaky tests while processing [attachment 81286](attachment.cgi?id=81286&action=diff "Patch") [[details]](attachment.cgi?id=81286&action=edit "Patch"):
http/tests/websocket/tests/multiple-connections.html [bug 53825](show_bug.cgi?id=53825 "RESOLVED INVALID - Flaky Test: http/tests/websocket/tests/multiple-connections.html") (author: abarth@webkit.org)
The commit-queue is continuing to process your patch.

WebKit Commit Bot

[Comment 31](show_bug.cgi?id=52819#c31)
2011-02-04 16:48:42 PST

Comment on [attachment 81286](attachment.cgi?id=81286&action=diff "Patch") [[details]](attachment.cgi?id=81286&action=edit "Patch")
Patch
Clearing flags on attachment: 81286
Committed [r77705](https://commits.webkit.org/r77705): <<http://trac.webkit.org/changeset/77705>>

WebKit Commit Bot

[Comment 32](show_bug.cgi?id=52819#c32)
2011-02-04 16:48:50 PST

All reviewed patches have been landed. Closing bug.

WebKit Review Bot

[Comment 33](show_bug.cgi?id=52819#c33)
2011-02-04 18:32:39 PST

<http://trac.webkit.org/changeset/77705> might have broken GTK Linux 64-bit Debug

Note
You need to
[log in](show_bug.cgi?id=52819&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

 [Status](page.cgi?id=fields.html#bug_status "A bug may be in any of a number of states.") |RESOLVED

resolved as
 [Resolution](page.cgi?id=fields.html#resolution "If a bug is in a resolved state, then one of these reasons will be given for its resolution.") |FIXED

 [Priority](page.cgi?id=fields.html#priority "Engineers prioritize their bugs using this field.") |P2

 [Severity](page.cgi?id=fields.html#bug_severity "How severe the bug is, or whether it's an enhancement.") |Normal

 [Classification](page.cgi?id=fields.html#classification "Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation.") |Unclassified

 [Version](page.cgi?id=fields.html#version "The version field defines the version of the software the bug was found in.") | 528+ (Nightly build) |
 [Hardware](page.cgi?id=fields.html#rep_platform "The hardware platform the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") |All

 [OS](page.cgi?id=fields.html#op_sys "The operating system the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") |All

 [Product](describecomponents.cgi "Bugs are categorised into Products and Components.") |WebKit

 [Component](describecomponents.cgi?product=WebKit "Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.") |WebCore Misc.

 [Assignee](page.cgi?id=fields.html#assigned_to "The person in charge of resolving the bug.") |Nobody

Reported

2011-01-20 09:37 PST

Modified

2011-02-04 18:32 PST
[History](show_activity.cgi?id=52819)

CC List

11
users
Show

abarth
ap
beidson
commit-queue
creis
eric
fishd
mihaip
ojan
priyajeet.hora
webkit.review.bot

 [URL](page.cgi?id=fields.html#bug_file_loc "Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.") |
  |

 [Keywords](describekeywords.cgi "You can add keywords from a defined list to bugs, in order to easily identify and group them.") |InRadar

 [Depends on](page.cgi?id=fields.html#dependson "The bugs listed here must be resolved before this bug can be resolved.") |

[53402](show_bug.cgi?id=53402 "RESOLVED FIXED - Add sanity check to help diagnose bug 52819")

 [Blocks](page.cgi?id=fields.html#blocked "This bug must be resolved before the bugs listed in this field can be resolved.") |

Dependencies
[tree](showdependencytree.cgi?id=52819&hide_resolved=1)[graph](showdependencygraph.cgi?id=52819)

 [See Also](page.cgi?id=fields.html#see_also "This allows you to refer to bugs in other installations. You can enter a URL to a bug in the 'Add Bug URLs' field to note that that bug is related to this one. You can enter multiple URLs at once by separating them with whitespace. You should normally use this field to refer to bugs in other installations. For bugs in this installation, it is better to use the Depends on and Blocks fields.") |

 [Alias](page.cgi?id=fields.html#alias "A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.") |
None

---

* Top of Page
* [Format For Printing](show_bug.cgi?format=multiple&id=52819)
* [XML](show_bug.cgi?ctype=xml&id=52819)
* [Clone This Bug](enter_bug.cgi?cloned_bug_id=52819)

* + [New](enter_bug.cgi)
  + [Browse](describecomponents.cgi)
  + [Reports](report.cgi)
  + [Requests](request.cgi)



=== Content from googlechromereleases.blogspot.com_53352530_20250124_154006.html ===


![](https://ad.doubleclick.net/ddm/activity/src=2542116;type=gblog;cat=googl0;ord=1?)

[![](https://www.gstatic.com/images/branding/googlelogo/2x/googlelogo_color_284x96dp.png)](https://chromereleases.googleblog.com/)
[## Chrome Releases](/.)

Release updates from the Chrome team

## [Dev Channel Update](https://chromereleases.googleblog.com/2011/02/dev-channel-update_17.html "Dev Channel Update")

Thursday, February 17, 2011

The Dev channel has been updated to 11.0.672.2 for Mac, Windows and Linux platforms

**All**

* Updated V8 - 3.1.4.0
* Fixed the crash when loading tabbed options in some cases.
* Fixed a crash triggered when canceling a download. (Issue [70592](http://code.google.com/p/chromium/issues/detail?id=70592))
* Fixed a crash triggered by form resubmissions. (Issue [70315](http://code.google.com/p/chromium/issues/detail?id=70315))
* FTP: fixed a compatibility issue. (Issue [70394](http://code.google.com/p/chromium/issues/detail?id=70394))
* XSS Auditor re-designed and enabled by default. It’s still experimental (and there are known bypasses), but we’re looking for feedback about false positives.

**Mac**

* Fixed a crash during plugin shutdown
* Tab overview mode is on by default.
* Added unspoofable infobars. (Issue [57106](http://code.google.com/p/chromium/issues/detail?id=57106))
* Accelerometer data is more reliable.

**Known Issues**

* Temporarily dropped support for building with system sqlite: (Issues [70589](http://code.google.com/p/chromium/issues/detail?id=70589) and [22208](http://code.google.com/p/chromium/issues/detail?id=22208))

More details about additional changes are available in the [log of all revisions.](http://build.chromium.org/buildbot/perf/dashboard/ui/changelog.html?url=/trunk/src&range=74924:72316&mode=html "log of all revision")

You can find out about getting on the Dev channel here: <http://dev.chromium.org/getting-involved/dev-channel>.

If you find new issues, please let us know by filing a bug at <http://code.google.com/p/chromium/issues/entry>

Karen Grunberg

Google Chrome

![Share on Twitter](https://www.gstatic.com/images/icons/material/system/2x/post_twitter_black_24dp.png)

![Share on Facebook](https://www.gstatic.com/images/icons/material/system/2x/post_facebook_black_24dp.png)

[Google](https://plus.google.com/112374322230920073195)

[**](https://chromereleases.googleblog.com/)
[**](https://chromereleases.googleblog.com/2011/02/chrome-beta-release.html "Newer Post")

[**](https://chromereleases.googleblog.com/2011/02/dev-channel-update_16.html "Older Post")

![](data:image/png;base64...)
## Labels

**

* [Admin Console](https://chromereleases.googleblog.com/search/label/Admin%20Console)
  43
* [Android WebView](https://chromereleases.googleblog.com/search/label/Android%20WebView)
  19
* [Beta](https://chromereleases.googleblog.com/search/label/Beta)
  21
* [Beta update](https://chromereleases.googleblog.com/search/label/Beta%20update)
  4
* [Beta updates](https://chromereleases.googleblog.com/search/label/Beta%20updates)
  2037
* [chrome](https://chromereleases.googleblog.com/search/label/chrome)
  15
* [Chrome Dev for Android](https://chromereleases.googleblog.com/search/label/Chrome%20Dev%20for%20Android)
  135
* [Chrome for Android](https://chromereleases.googleblog.com/search/label/Chrome%20for%20Android)
  964
* [Chrome for iOS](https://chromereleases.googleblog.com/search/label/Chrome%20for%20iOS)
  388
* [Chrome for Meetings](https://chromereleases.googleblog.com/search/label/Chrome%20for%20Meetings)
  5
* [Chrome OS](https://chromereleases.googleblog.com/search/label/Chrome%20OS)
  1150
* [Chrome OS Flex](https://chromereleases.googleblog.com/search/label/Chrome%20OS%20Flex)
  24
* [Chrome OS Management](https://chromereleases.googleblog.com/search/label/Chrome%20OS%20Management)
  12
* [Chromecast Update](https://chromereleases.googleblog.com/search/label/Chromecast%20Update)
  6
* [ChromeOS](https://chromereleases.googleblog.com/search/label/ChromeOS)
  217
* [ChromeOS Flex](https://chromereleases.googleblog.com/search/label/ChromeOS%20Flex)
  213
* [Desktop Update](https://chromereleases.googleblog.com/search/label/Desktop%20Update)
  1132
* [dev update](https://chromereleases.googleblog.com/search/label/dev%20update)
  266
* [Dev updates](https://chromereleases.googleblog.com/search/label/Dev%20updates)
  1517
* [Early Stable Updates](https://chromereleases.googleblog.com/search/label/Early%20Stable%20Updates)
  50
* [Extended Stable updates](https://chromereleases.googleblog.com/search/label/Extended%20Stable%20updates)
  134
* [Flash Player update](https://chromereleases.googleblog.com/search/label/Flash%20Player%20update)
  5
* [Flex](https://chromereleases.googleblog.com/search/label/Flex)
  1
* [Hangouts Meet hardware](https://chromereleases.googleblog.com/search/label/Hangouts%20Meet%20hardware)
  5
* [LTS](https://chromereleases.googleblog.com/search/label/LTS)
  91
* [stable](https://chromereleases.googleblog.com/search/label/stable)
  11
* [Stable updates](https://chromereleases.googleblog.com/search/label/Stable%20updates)
  1260

**
## Archive

**

* **

  **
  [2025](https://chromereleases.googleblog.com/2025/)

  + [Jan](https://chromereleases.googleblog.com/2025/01/)

* **

  **
  [2024](https://chromereleases.googleblog.com/2024/)

  + [Dec](https://chromereleases.googleblog.com/2024/12/)
  + [Nov](https://chromereleases.googleblog.com/2024/11/)
  + [Oct](https://chromereleases.googleblog.com/2024/10/)
  + [Sep](https://chromereleases.googleblog.com/2024/09/)
  + [Aug](https://chromereleases.googleblog.com/2024/08/)
  + [Jul](https://chromereleases.googleblog.com/2024/07/)
  + [Jun](https://chromereleases.googleblog.com/2024/06/)
  + [May](https://chromereleases.googleblog.com/2024/05/)
  + [Apr](https://chromereleases.googleblog.com/2024/04/)
  + [Mar](https://chromereleases.googleblog.com/2024/03/)
  + [Feb](https://chromereleases.googleblog.com/2024/02/)
  + [Jan](https://chromereleases.googleblog.com/2024/01/)

* **

  **
  [2023](https://chromereleases.googleblog.com/2023/)

  + [Dec](https://chromereleases.googleblog.com/2023/12/)
  + [Nov](https://chromereleases.googleblog.com/2023/11/)
  + [Oct](https://chromereleases.googleblog.com/2023/10/)
  + [Sep](https://chromereleases.googleblog.com/2023/09/)
  + [Aug](https://chromereleases.googleblog.com/2023/08/)
  + [Jul](https://chromereleases.googleblog.com/2023/07/)
  + [Jun](https://chromereleases.googleblog.com/2023/06/)
  + [May](https://chromereleases.googleblog.com/2023/05/)
  + [Apr](https://chromereleases.googleblog.com/2023/04/)
  + [Mar](https://chromereleases.googleblog.com/2023/03/)
  + [Feb](https://chromereleases.googleblog.com/2023/02/)
  + [Jan](https://chromereleases.googleblog.com/2023/01/)

* **

  **
  [2022](https://chromereleases.googleblog.com/2022/)

  + [Dec](https://chromereleases.googleblog.com/2022/12/)
  + [Nov](https://chromereleases.googleblog.com/2022/11/)
  + [Oct](https://chromereleases.googleblog.com/2022/10/)
  + [Sep](https://chromereleases.googleblog.com/2022/09/)
  + [Aug](https://chromereleases.googleblog.com/2022/08/)
  + [Jul](https://chromereleases.googleblog.com/2022/07/)
  + [Jun](https://chromereleases.googleblog.com/2022/06/)
  + [May](https://chromereleases.googleblog.com/2022/05/)
  + [Apr](https://chromereleases.googleblog.com/2022/04/)
  + [Mar](https://chromereleases.googleblog.com/2022/03/)
  + [Feb](https://chromereleases.googleblog.com/2022/02/)
  + [Jan](https://chromereleases.googleblog.com/2022/01/)

* **

  **
  [2021](https://chromereleases.googleblog.com/2021/)

  + [Dec](https://chromereleases.googleblog.com/2021/12/)
  + [Nov](https://chromereleases.googleblog.com/2021/11/)
  + [Oct](https://chromereleases.googleblog.com/2021/10/)
  + [Sep](https://chromereleases.googleblog.com/2021/09/)
  + [Aug](https://chromereleases.googleblog.com/2021/08/)
  + [Jul](https://chromereleases.googleblog.com/2021/07/)
  + [Jun](https://chromereleases.googleblog.com/2021/06/)
  + [May](https://chromereleases.googleblog.com/2021/05/)
  + [Apr](https://chromereleases.googleblog.com/2021/04/)
  + [Mar](https://chromereleases.googleblog.com/2021/03/)
  + [Feb](https://chromereleases.googleblog.com/2021/02/)
  + [Jan](https://chromereleases.googleblog.com/2021/01/)

* **

  **
  [2020](https://chromereleases.googleblog.com/2020/)

  + [Dec](https://chromereleases.googleblog.com/2020/12/)
  + [Nov](https://chromereleases.googleblog.com/2020/11/)
  + [Oct](https://chromereleases.googleblog.com/2020/10/)
  + [Sep](https://chromereleases.googleblog.com/2020/09/)
  + [Aug](https://chromereleases.googleblog.com/2020/08/)
  + [Jul](https://chromereleases.googleblog.com/2020/07/)
  + [Jun](https://chromereleases.googleblog.com/2020/06/)
  + [May](https://chromereleases.googleblog.com/2020/05/)
  + [Apr](https://chromereleases.googleblog.com/2020/04/)
  + [Mar](https://chromereleases.googleblog.com/2020/03/)
  + [Feb](https://chromereleases.googleblog.com/2020/02/)
  + [Jan](https://chromereleases.googleblog.com/2020/01/)

* **

  **
  [2019](https://chromereleases.googleblog.com/2019/)

  + [Dec](https://chromereleases.googleblog.com/2019/12/)
  + [Nov](https://chromereleases.googleblog.com/2019/11/)
  + [Oct](https://chromereleases.googleblog.com/2019/10/)
  + [Sep](https://chromereleases.googleblog.com/2019/09/)
  + [Aug](https://chromereleases.googleblog.com/2019/08/)
  + [Jul](https://chromereleases.googleblog.com/2019/07/)
  + [Jun](https://chromereleases.googleblog.com/2019/06/)
  + [May](https://chromereleases.googleblog.com/2019/05/)
  + [Apr](https://chromereleases.googleblog.com/2019/04/)
  + [Mar](https://chromereleases.googleblog.com/2019/03/)
  + [Feb](https://chromereleases.googleblog.com/2019/02/)
  + [Jan](https://chromereleases.googleblog.com/2019/01/)

* **

  **
  [2018](https://chromereleases.googleblog.com/2018/)

  + [Dec](https://chromereleases.googleblog.com/2018/12/)
  + [Nov](https://chromereleases.googleblog.com/2018/11/)
  + [Oct](https://chromereleases.googleblog.com/2018/10/)
  + [Sep](https://chromereleases.googleblog.com/2018/09/)
  + [Aug](https://chromereleases.googleblog.com/2018/08/)
  + [Jul](https://chromereleases.googleblog.com/2018/07/)
  + [Jun](https://chromereleases.googleblog.com/2018/06/)
  + [May](https://chromereleases.googleblog.com/2018/05/)
  + [Apr](https://chromereleases.googleblog.com/2018/04/)
  + [Mar](https://chromereleases.googleblog.com/2018/03/)
  + [Feb](https://chromereleases.googleblog.com/2018/02/)
  + [Jan](https://chromereleases.googleblog.com/2018/01/)

* **

  **
  [2017](https://chromereleases.googleblog.com/2017/)

  + [Dec](https://chromereleases.googleblog.com/2017/12/)
  + [Nov](https://chromereleases.googleblog.com/2017/11/)
  + [Oct](https://chromereleases.googleblog.com/2017/10/)
  + [Sep](https://chromereleases.googleblog.com/2017/09/)
  + [Aug](https://chromereleases.googleblog.com/2017/08/)
  + [Jul](https://chromereleases.googleblog.com/2017/07/)
  + [Jun](https://chromereleases.googleblog.com/2017/06/)
  + [May](https://chromereleases.googleblog.com/2017/05/)
  + [Apr](https://chromereleases.googleblog.com/2017/04/)
  + [Mar](https://chromereleases.googleblog.com/2017/03/)
  + [Feb](https://chromereleases.googleblog.com/2017/02/)
  + [Jan](https://chromereleases.googleblog.com/2017/01/)

* **

  **
  [2016](https://chromereleases.googleblog.com/2016/)

  + [Dec](https://chromereleases.googleblog.com/2016/12/)
  + [Nov](https://chromereleases.googleblog.com/2016/11/)
  + [Oct](https://chromereleases.googleblog.com/2016/10/)
  + [Sep](https://chromereleases.googleblog.com/2016/09/)
  + [Aug](https://chromereleases.googleblog.com/2016/08/)
  + [Jul](https://chromereleases.googleblog.com/2016/07/)
  + [Jun](https://chromereleases.googleblog.com/2016/06/)
  + [May](https://chromereleases.googleblog.com/2016/05/)
  + [Apr](https://chromereleases.googleblog.com/2016/04/)
  + [Mar](https://chromereleases.googleblog.com/2016/03/)
  + [Feb](https://chromereleases.googleblog.com/2016/02/)
  + [Jan](https://chromereleases.googleblog.com/2016/01/)

* **

  **
  [2015](https://chromereleases.googleblog.com/2015/)

  + [Dec](https://chromereleases.googleblog.com/2015/12/)
  + [Nov](https://chromereleases.googleblog.com/2015/11/)
  + [Oct](https://chromereleases.googleblog.com/2015/10/)
  + [Sep](https://chromereleases.googleblog.com/2015/09/)
  + [Aug](https://chromereleases.googleblog.com/2015/08/)
  + [Jul](https://chromereleases.googleblog.com/2015/07/)
  + [Jun](https://chromereleases.googleblog.com/2015/06/)
  + [May](https://chromereleases.googleblog.com/2015/05/)
  + [Apr](https://chromereleases.googleblog.com/2015/04/)
  + [Mar](https://chromereleases.googleblog.com/2015/03/)
  + [Feb](https://chromereleases.googleblog.com/2015/02/)
  + [Jan](https://chromereleases.googleblog.com/2015/01/)

* **

  **
  [2014](https://chromereleases.googleblog.com/2014/)

  + [Dec](https://chromereleases.googleblog.com/2014/12/)
  + [Nov](https://chromereleases.googleblog.com/2014/11/)
  + [Oct](https://chromereleases.googleblog.com/2014/10/)
  + [Sep](https://chromereleases.googleblog.com/2014/09/)
  + [Aug](https://chromereleases.googleblog.com/2014/08/)
  + [Jul](https://chromereleases.googleblog.com/2014/07/)
  + [Jun](https://chromereleases.googleblog.com/2014/06/)
  + [May](https://chromereleases.googleblog.com/2014/05/)
  + [Apr](https://chromereleases.googleblog.com/2014/04/)
  + [Mar](https://chromereleases.googleblog.com/2014/03/)
  + [Feb](https://chromereleases.googleblog.com/2014/02/)
  + [Jan](https://chromereleases.googleblog.com/2014/01/)

* **

  **
  [2013](https://chromereleases.googleblog.com/2013/)

  + [Dec](https://chromereleases.googleblog.com/2013/12/)
  + [Nov](https://chromereleases.googleblog.com/2013/11/)
  + [Oct](https://chromereleases.googleblog.com/2013/10/)
  + [Sep](https://chromereleases.googleblog.com/2013/09/)
  + [Aug](https://chromereleases.googleblog.com/2013/08/)
  + [Jul](https://chromereleases.googleblog.com/2013/07/)
  + [Jun](https://chromereleases.googleblog.com/2013/06/)
  + [May](https://chromereleases.googleblog.com/2013/05/)
  + [Apr](https://chromereleases.googleblog.com/2013/04/)
  + [Mar](https://chromereleases.googleblog.com/2013/03/)
  + [Feb](https://chromereleases.googleblog.com/2013/02/)
  + [Jan](https://chromereleases.googleblog.com/2013/01/)

* **

  **
  [2012](https://chromereleases.googleblog.com/2012/)

  + [Dec](https://chromereleases.googleblog.com/2012/12/)
  + [Nov](https://chromereleases.googleblog.com/2012/11/)
  + [Oct](https://chromereleases.googleblog.com/2012/10/)
  + [Sep](https://chromereleases.googleblog.com/2012/09/)
  + [Aug](https://chromereleases.googleblog.com/2012/08/)
  + [Jul](https://chromereleases.googleblog.com/2012/07/)
  + [Jun](https://chromereleases.googleblog.com/2012/06/)
  + [May](https://chromereleases.googleblog.com/2012/05/)
  + [Apr](https://chromereleases.googleblog.com/2012/04/)
  + [Mar](https://chromereleases.googleblog.com/2012/03/)
  + [Feb](https://chromereleases.googleblog.com/2012/02/)
  + [Jan](https://chromereleases.googleblog.com/2012/01/)

* **

  **
  [2011](https://chromereleases.googleblog.com/2011/)

  + [Dec](https://chromereleases.googleblog.com/2011/12/)
  + [Nov](https://chromereleases.googleblog.com/2011/11/)
  + [Oct](https://chromereleases.googleblog.com/2011/10/)
  + [Sep](https://chromereleases.googleblog.com/2011/09/)
  + [Aug](https://chromereleases.googleblog.com/2011/08/)
  + [Jul](https://chromereleases.googleblog.com/2011/07/)
  + [Jun](https://chromereleases.googleblog.com/2011/06/)
  + [May](https://chromereleases.googleblog.com/2011/05/)
  + [Apr](https://chromereleases.googleblog.com/2011/04/)
  + [Mar](https://chromereleases.googleblog.com/2011/03/)
  + [Feb](https://chromereleases.googleblog.com/2011/02/)
  + [Jan](https://chromereleases.googleblog.com/2011/01/)

* **

  **
  [2010](https://chromereleases.googleblog.com/2010/)

  + [Dec](https://chromereleases.googleblog.com/2010/12/)
  + [Nov](https://chromereleases.googleblog.com/2010/11/)
  + [Oct](https://chromereleases.googleblog.com/2010/10/)
  + [Sep](https://chromereleases.googleblog.com/2010/09/)
  + [Aug](https://chromereleases.googleblog.com/2010/08/)
  + [Jul](https://chromereleases.googleblog.com/2010/07/)
  + [Jun](https://chromereleases.googleblog.com/2010/06/)
  + [May](https://chromereleases.googleblog.com/2010/05/)
  + [Apr](https://chromereleases.googleblog.com/2010/04/)
  + [Mar](https://chromereleases.googleblog.com/2010/03/)
  + [Feb](https://chromereleases.googleblog.com/2010/02/)
  + [Jan](https://chromereleases.googleblog.com/2010/01/)

* **

  **
  [2009](https://chromereleases.googleblog.com/2009/)

  + [Dec](https://chromereleases.googleblog.com/2009/12/)
  + [Nov](https://chromereleases.googleblog.com/2009/11/)
  + [Oct](https://chromereleases.googleblog.com/2009/10/)
  + [Sep](https://chromereleases.googleblog.com/2009/09/)
  + [Aug](https://chromereleases.googleblog.com/2009/08/)
  + [Jul](https://chromereleases.googleblog.com/2009/07/)
  + [Jun](https://chromereleases.googleblog.com/2009/06/)
  + [May](https://chromereleases.googleblog.com/2009/05/)
  + [Apr](https://chromereleases.googleblog.com/2009/04/)
  + [Mar](https://chromereleases.googleblog.com/2009/03/)
  + [Feb](https://chromereleases.googleblog.com/2009/02/)
  + [Jan](https://chromereleases.googleblog.com/2009/01/)

* **

  **
  [2008](https://chromereleases.googleblog.com/2008/)

  + [Dec](https://chromereleases.googleblog.com/2008/12/)
  + [Nov](https://chromereleases.googleblog.com/2008/11/)
  + [Oct](https://chromereleases.googleblog.com/2008/10/)
  + [Sep](https://chromereleases.googleblog.com/2008/09/)

Give us feedback in our
 [Product Forums](http://support.google.com/bin/static.py?hl=en&page=portal_groups.cs).

[![](data:image/png;base64...)](//www.google.com/)

* [Google](//www.google.com/)
* [Privacy](//www.google.com/policies/privacy/)
* [Terms](//www.google.com/policies/terms/)



=== Content from trac.webkit.org_a1e1fe2a_20250124_154019.html ===


[![WebKit Trac](/chrome/site/favicon.png)](http://www.webkit.org/)

Search:

* [Login](/login)
* [Preferences](/prefs)
* [Forgot your password?](/reset_password)

* [Wiki](/wiki)
* [Timeline](/timeline)
* [Browse Source](/browser)
* [Search](/search)

## Context Navigation

* ← [Previous Changeset](/changeset/77704/webkit "Changeset 77704")
* [Next Changeset](/changeset/77706/webkit "Changeset 77706") →

---

# Changeset 77705 in webkit

View differences
inline
side by side

Show
lines around each change

Show the changes in full context

Ignore:

Blank lines

Case changes

White space changes

Timestamp:
Feb 4, 2011, 4:48:31 PM
([14 years](/timeline?from=2011-02-04T16%3A48%3A31-08%3A00&precision=second "See timeline at Feb 4, 2011, 4:48:31 PM") ago)
Author:
commit-queue@webkit.org
Message:

2011-02-04 Charlie Reis <​creis@chromium.org>

> Reviewed by Mihai Parparita.

> Crash in WebCore::HistoryController::itemsAreClones
>
> [​https://bugs.webkit.org/show\_bug.cgi?id=52819](https://bugs.webkit.org/show_bug.cgi?id=52819)

> Tests that navigating back and forward between hash items works.

* fast/history/history-back-forward-within-subframe-hash.html: Added.
* fast/history/history-back-forward-within-subframe-hash-expected.txt: Added.

2011-02-04 Charlie Reis <​creis@chromium.org>

> Reviewed by Mihai Parparita.

> Crash in WebCore::HistoryController::itemsAreClones
>
> [​https://bugs.webkit.org/show\_bug.cgi?id=52819](https://bugs.webkit.org/show_bug.cgi?id=52819)

> Avoids deleting the current HistoryItem while it is still in use.
>
> Ensures that provisional items are committed for same document navigations.
>
> Ensures that error pages are committed on back/forward navigations.
>
> Also removes unneeded sanity checks used for diagnosing the problem.

* loader/HistoryController.cpp:
* loader/HistoryController.h:

2011-02-04 Charlie Reis <​creis@chromium.org>

> Reviewed by Mihai Parparita.

> Crash in WebCore::HistoryController::itemsAreClones
>
> [​https://bugs.webkit.org/show\_bug.cgi?id=52819](https://bugs.webkit.org/show_bug.cgi?id=52819)

> Removes unneeded sanity checks used for diagnosing a memory error.

* src/WebFrameImpl.cpp:

Location:
[trunk](/browser/webkit/trunk?rev=77705)
Files:

2 added
6 edited

* [LayoutTests/ChangeLog](/browser/webkit/trunk/LayoutTests/ChangeLog?rev=77705 "Show entry in browser")
  (modified)
  ([1 diff](#file0 "Show differences"))
* [LayoutTests/fast/history/history-back-forward-within-subframe-hash-expected.txt](/browser/webkit/trunk/LayoutTests/fast/history/history-back-forward-within-subframe-hash-expected.txt?rev=77705 "Show entry in browser")
  (added)
* [LayoutTests/fast/history/history-back-forward-within-subframe-hash.html](/browser/webkit/trunk/LayoutTests/fast/history/history-back-forward-within-subframe-hash.html?rev=77705 "Show entry in browser")
  (added)
* [Source/WebCore/ChangeLog](/browser/webkit/trunk/Source/WebCore/ChangeLog?rev=77705 "Show entry in browser")
  (modified)
  ([1 diff](#file3 "Show differences"))
* [Source/WebCore/loader/HistoryController.cpp](/browser/webkit/trunk/Source/WebCore/loader/HistoryController.cpp?rev=77705 "Show entry in browser")
  (modified)
  ([7 diffs](#file4 "Show differences"))
* [Source/WebCore/loader/HistoryController.h](/browser/webkit/trunk/Source/WebCore/loader/HistoryController.h?rev=77705 "Show entry in browser")
  (modified)
  ([1 diff](#file5 "Show differences"))
* [Source/WebKit/chromium/ChangeLog](/browser/webkit/trunk/Source/WebKit/chromium/ChangeLog?rev=77705 "Show entry in browser")
  (modified)
  ([1 diff](#file6 "Show differences"))
* [Source/WebKit/chromium/src/WebFrameImpl.cpp](/browser/webkit/trunk/Source/WebKit/chromium/src/WebFrameImpl.cpp?rev=77705 "Show entry in browser")
  (modified)
  ([1 diff](#file7 "Show differences"))

### Legend:

Unmodified
Added
Removed

* ## [trunk/LayoutTests/ChangeLog](/changeset/77705/webkit/trunk/LayoutTests/ChangeLog "Show the changeset 77705 restricted to trunk/LayoutTests/ChangeLog")

  | [r77704](/browser/webkit/trunk/LayoutTests/ChangeLog?rev=77704#L1 "Show revision 77704 of this file in browser") | [r77705](/browser/webkit/trunk/LayoutTests/ChangeLog?rev=77705#L1 "Show revision 77705 of this file in browser") |  |
  | --- | --- | --- |
  |  | 1 | 2011-02-04  Charlie Reis  <creis@chromium.org> |
  |  | 2 |  |
  |  | 3 | Reviewed by Mihai Parparita. |
  |  | 4 |  |
  |  | 5 | Crash in WebCore::HistoryController::itemsAreClones |
  |  | 6 | https://bugs.webkit.org/show\_bug.cgi?id=52819 |
  |  | 7 |  |
  |  | 8 | Tests that navigating back and forward between hash items works. |
  |  | 9 |  |
  |  | 10 | \* fast/history/history-back-forward-within-subframe-hash.html: Added. |
  |  | 11 | \* fast/history/history-back-forward-within-subframe-hash-expected.txt: Added. |
  |  | 12 |  |
  | 1 | 13 | 2011-02-04  Dimitri Glazkov  <dglazkov@chromium.org> |
  | 2 | 14 |  |
* ## [trunk/Source/WebCore/ChangeLog](/changeset/77705/webkit/trunk/Source/WebCore/ChangeLog "Show the changeset 77705 restricted to trunk/Source/WebCore/ChangeLog")

  | [r77702](/browser/webkit/trunk/Source/WebCore/ChangeLog?rev=77702#L1 "Show revision 77702 of this file in browser") | [r77705](/browser/webkit/trunk/Source/WebCore/ChangeLog?rev=77705#L1 "Show revision 77705 of this file in browser") |  |
  | --- | --- | --- |
  |  | 1 | 2011-02-04  Charlie Reis  <creis@chromium.org> |
  |  | 2 |  |
  |  | 3 | Reviewed by Mihai Parparita. |
  |  | 4 |  |
  |  | 5 | Crash in WebCore::HistoryController::itemsAreClones |
  |  | 6 | https://bugs.webkit.org/show\_bug.cgi?id=52819 |
  |  | 7 |  |
  |  | 8 | Avoids deleting the current HistoryItem while it is still in use. |
  |  | 9 | Ensures that provisional items are committed for same document navigations. |
  |  | 10 | Ensures that error pages are committed on back/forward navigations. |
  |  | 11 | Also removes unneeded sanity checks used for diagnosing the problem. |
  |  | 12 |  |
  |  | 13 | \* loader/HistoryController.cpp: |
  |  | 14 | \* loader/HistoryController.h: |
  |  | 15 |  |
  | 1 | 16 | 2011-02-04  Carol Szabo  <carol.szabo@nokia.com> |
  | 2 | 17 |  |
* ## [trunk/Source/WebCore/loader/HistoryController.cpp](/changeset/77705/webkit/trunk/Source/WebCore/loader/HistoryController.cpp "Show the changeset 77705 restricted to trunk/Source/WebCore/loader/HistoryController.cpp")

  | [r77210](/browser/webkit/trunk/Source/WebCore/loader/HistoryController.cpp?rev=77210#L237 "Show revision 77210 of this file in browser") | [r77705](/browser/webkit/trunk/Source/WebCore/loader/HistoryController.cpp?rev=77705#L237 "Show revision 77705 of this file in browser") |  |
  | --- | --- | --- |
  | 237 | 237 | // - plus, it only makes sense for the top level of the operation through the frametree, |
  | 238 | 238 | // as opposed to happening for some/one of the page commits that might happen soon |
  | 239 |  | ~~HistoryItem\* currentItem = page->backForward()->currentItem();~~ |
  |  | 239 | RefPtr<HistoryItem> currentItem = page->backForward()->currentItem(); |
  | 240 | 240 | page->backForward()->setCurrentItem(targetItem); |
  | 241 | 241 | Settings\* settings = m\_frame->settings(); |
  | […](/browser/webkit/trunk/Source/WebCore/loader/HistoryController.cpp?rev=77210#L246) | […](/browser/webkit/trunk/Source/WebCore/loader/HistoryController.cpp?rev=77705#L246) |  |
  | 246 | 246 | // navigations can commit immediately (such as about:blank).  We must be sure that |
  | 247 | 247 | // all frames have provisional items set before the commit. |
  | 248 |  | recursiveSetProvisionalItem(targetItem, currentItem, type); |
  |  | 248 | recursiveSetProvisionalItem(targetItem, currentItem.get(), type); |
  | 249 | 249 | // Now that all other frames have provisional items, do the actual navigation. |
  | 250 |  | recursiveGoToItem(targetItem, currentItem, type); |
  |  | 250 | recursiveGoToItem(targetItem, currentItem.get(), type); |
  | 251 | 251 | } |
  | 252 | 252 |  |
  | […](/browser/webkit/trunk/Source/WebCore/loader/HistoryController.cpp?rev=77210#L403) | […](/browser/webkit/trunk/Source/WebCore/loader/HistoryController.cpp?rev=77705#L403) |  |
  | 403 | 403 | #endif |
  | 404 | 404 | FrameLoadType type = frameLoader->loadType(); |
  | 405 |  | if (isBackForwardLoadType(type) || |
  | 406 |  | ((type == FrameLoadTypeReload || type == FrameLoadTypeReloadFromOrigin) && !frameLoader->provisionalDocumentLoader()->unreachableURL().isEmpty())) { |
  |  | 405 | if (isBackForwardLoadType(type) |
  |  | 406 | || isReplaceLoadTypeWithProvisionalItem(type) |
  |  | 407 | || ((type == FrameLoadTypeReload || type == FrameLoadTypeReloadFromOrigin) && !frameLoader->provisionalDocumentLoader()->unreachableURL().isEmpty())) { |
  | 407 | 408 | // Once committed, we want to use current item for saving DocState, and |
  | 408 | 409 | // the provisional item for restoring state. |
  | […](/browser/webkit/trunk/Source/WebCore/loader/HistoryController.cpp?rev=77210#L424) | […](/browser/webkit/trunk/Source/WebCore/loader/HistoryController.cpp?rev=77705#L425) |  |
  | 424 | 425 | } |
  | 425 | 426 |  |
  |  | 427 | bool HistoryController::isReplaceLoadTypeWithProvisionalItem(FrameLoadType type) |
  |  | 428 | { |
  |  | 429 | // Going back to an error page in a subframe can trigger a FrameLoadTypeReplace |
  |  | 430 | // while m\_provisionalItem is set, so we need to commit it. |
  |  | 431 | return type == FrameLoadTypeReplace && m\_provisionalItem; |
  |  | 432 | } |
  |  | 433 |  |
  | 426 | 434 | void HistoryController::recursiveUpdateForCommit() |
  | 427 | 435 | { |
  | […](/browser/webkit/trunk/Source/WebCore/loader/HistoryController.cpp?rev=77210#L472) | […](/browser/webkit/trunk/Source/WebCore/loader/HistoryController.cpp?rev=77705#L480) |  |
  | 472 | 480 |  |
  | 473 | 481 | addVisitedLink(page, m\_frame->document()->url()); |
  |  | 482 | page->mainFrame()->loader()->history()->recursiveUpdateForSameDocumentNavigation(); |
  |  | 483 | } |
  |  | 484 |  |
  |  | 485 | void HistoryController::recursiveUpdateForSameDocumentNavigation() |
  |  | 486 | { |
  |  | 487 | // The frame that navigated will now have a null provisional item. |
  |  | 488 | // Ignore it and its children. |
  |  | 489 | if (!m\_provisionalItem) |
  |  | 490 | return; |
  |  | 491 |  |
  |  | 492 | // Commit the provisional item. |
  |  | 493 | m\_frameLoadComplete = false; |
  |  | 494 | m\_previousItem = m\_currentItem; |
  |  | 495 | m\_currentItem = m\_provisionalItem; |
  |  | 496 | m\_provisionalItem = 0; |
  |  | 497 |  |
  |  | 498 | // Iterate over the rest of the tree. |
  |  | 499 | for (Frame\* child = m\_frame->tree()->firstChild(); child; child = child->tree()->nextSibling()) |
  |  | 500 | child->loader()->history()->recursiveUpdateForSameDocumentNavigation(); |
  | 474 | 501 | } |
  | 475 | 502 |  |
  | […](/browser/webkit/trunk/Source/WebCore/loader/HistoryController.cpp?rev=77210#L621) | […](/browser/webkit/trunk/Source/WebCore/loader/HistoryController.cpp?rev=77705#L648) |  |
  | 621 | 648 |  |
  | 622 | 649 | int size = childItems.size(); |
  | 623 |  |  |
  | 624 |  | ~~// Sanity checks for http://webkit.org/b/52819.~~ |
  | 625 |  | ~~if (size > 0) {~~ |
  | 626 |  | ~~// fromItem should have same number of children according to hasSameFrames,~~ |
  | 627 |  | ~~// but crash dumps suggest it might have 0.~~ |
  | 628 |  | ~~if (!fromItem->children().size())~~ |
  | 629 |  | ~~CRASH();~~ |
  | 630 |  | ~~// itemsAreClones checked fromItem->hasSameFrames(item). Check vice versa.~~ |
  | 631 |  | ~~if (!item->hasSameFrames(fromItem))~~ |
  | 632 |  | ~~CRASH();~~ |
  | 633 |  | ~~}~~ |
  | 634 | 650 |  |
  | 635 | 651 | for (int i = 0; i < size; ++i) { |
  | […](/browser/webkit/trunk/Source/WebCore/loader/HistoryController.cpp?rev=77210#L671) | […](/browser/webkit/trunk/Source/WebCore/loader/HistoryController.cpp?rev=77705#L687) |  |
  | 671 | 687 | bool HistoryController::itemsAreClones(HistoryItem\* item1, HistoryItem\* item2) const |
  | 672 | 688 | { |
  | 673 |  | ~~// It appears that one of the items can be null in release builds, leading~~ |
  | 674 |  | ~~// to the crashes seen in http://webkit.org/b/52819.  For now, try to~~ |
  | 675 |  | ~~// narrow it down with a more specific crash.~~ |
  | 676 |  | ~~if (!item1)~~ |
  | 677 |  | ~~CRASH();~~ |
  | 678 |  | ~~if (!item2)~~ |
  | 679 |  | ~~CRASH();~~ |
  | 680 |  |  |
  | 681 | 689 | // If the item we're going to is a clone of the item we're at, then we do |
  | 682 | 690 | // not need to load it again.  The current frame tree and the frame tree |
* ## [trunk/Source/WebCore/loader/HistoryController.h](/changeset/77705/webkit/trunk/Source/WebCore/loader/HistoryController.h "Show the changeset 77705 restricted to trunk/Source/WebCore/loader/HistoryController.h")

  | [r76248](/browser/webkit/trunk/Source/WebCore/loader/HistoryController.h?rev=76248#L92 "Show revision 76248 of this file in browser") | [r77705](/browser/webkit/trunk/Source/WebCore/loader/HistoryController.h?rev=77705#L92 "Show revision 77705 of this file in browser") |  |
  | --- | --- | --- |
  | 92 | 92 | void recursiveSetProvisionalItem(HistoryItem\*, HistoryItem\*, FrameLoadType); |
  | 93 | 93 | void recursiveGoToItem(HistoryItem\*, HistoryItem\*, FrameLoadType); |
  |  | 94 | bool isReplaceLoadTypeWithProvisionalItem(FrameLoadType); |
  | 94 | 95 | void recursiveUpdateForCommit(); |
  |  | 96 | void recursiveUpdateForSameDocumentNavigation(); |
  | 95 | 97 | bool itemsAreClones(HistoryItem\*, HistoryItem\*) const; |
  | 96 | 98 | bool currentFramesMatchItem(HistoryItem\*) const; |
* ## [trunk/Source/WebKit/chromium/ChangeLog](/changeset/77705/webkit/trunk/Source/WebKit/chromium/ChangeLog "Show the changeset 77705 restricted to trunk/Source/WebKit/chromium/ChangeLog")

  | [r77687](/browser/webkit/trunk/Source/WebKit/chromium/ChangeLog?rev=77687#L1 "Show revision 77687 of this file in browser") | [r77705](/browser/webkit/trunk/Source/WebKit/chromium/ChangeLog?rev=77705#L1 "Show revision 77705 of this file in browser") |  |
  | --- | --- | --- |
  |  | 1 | 2011-02-04  Charlie Reis  <creis@chromium.org> |
  |  | 2 |  |
  |  | 3 | Reviewed by Mihai Parparita. |
  |  | 4 |  |
  |  | 5 | Crash in WebCore::HistoryController::itemsAreClones |
  |  | 6 | https://bugs.webkit.org/show\_bug.cgi?id=52819 |
  |  | 7 |  |
  |  | 8 | Removes unneeded sanity checks used for diagnosing a memory error. |
  |  | 9 |  |
  |  | 10 | \* src/WebFrameImpl.cpp: |
  |  | 11 |  |
  | 1 | 12 | 2011-02-04  Daniel Cheng  <dcheng@chromium.org> |
  | 2 | 13 |  |
* ## [trunk/Source/WebKit/chromium/src/WebFrameImpl.cpp](/changeset/77705/webkit/trunk/Source/WebKit/chromium/src/WebFrameImpl.cpp "Show the changeset 77705 restricted to trunk/Source/WebKit/chromium/src/WebFrameImpl.cpp")

  | [r77687](/browser/webkit/trunk/Source/WebKit/chromium/src/WebFrameImpl.cpp?rev=77687#L882 "Show revision 77687 of this file in browser") | [r77705](/browser/webkit/trunk/Source/WebKit/chromium/src/WebFrameImpl.cpp?rev=77705#L882 "Show revision 77705 of this file in browser") |  |
  | --- | --- | --- |
  | 882 | 882 | ASSERT(historyItem.get()); |
  | 883 | 883 |  |
  | 884 |  | ~~// Sanity check for http://webkit.org/b/52819.  It appears that some child~~ |
  | 885 |  | ~~// items of this item might be null.  Try validating just the first set of~~ |
  | 886 |  | ~~// children in an attempt to catch it early.~~ |
  | 887 |  | ~~const HistoryItemVector& childItems = historyItem->children();~~ |
  | 888 |  | ~~int size = childItems.size();~~ |
  | 889 |  | ~~for (int i = 0; i < size; ++i) {~~ |
  | 890 |  | ~~RefPtr<HistoryItem> childItem = childItems[i].get();~~ |
  | 891 |  | ~~if (!childItem.get())~~ |
  | 892 |  | ~~CRASH();~~ |
  | 893 |  | ~~}~~ |
  | 894 |  |  |
  | 895 | 884 | // If there is no currentItem, which happens when we are navigating in |
  | 896 | 885 | // session history after a crash, we need to manufacture one otherwise WebKit |
**Note:**
See [TracChangeset](/wiki/TracChangeset)
for help on using the changeset viewer.

### Download in other formats:

* [Unified Diff](?format=diff&new=77705)
* [Zip Archive](?format=zip&new=77705)

---

[![Trac Powered](/chrome/common/trac_logo_mini.png)](https://trac.edgewall.org/)

Powered by [**Trac 1.5.4**](/about)

By [Edgewall Software](http://www.edgewall.org/)
.

Hosted by [Apple](http://www.apple.com/)


