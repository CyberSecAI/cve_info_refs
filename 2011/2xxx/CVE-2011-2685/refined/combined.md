=== Content from www.openwall.com_0cc33459_20250124_215424.html ===


| [Openwall](/) * [Products](/)   + [Openwall GNU/\*/Linux   *server OS*](/Owl/)+ [Linux Kernel Runtime Guard](/lkrg/)+ [John the Ripper   *password cracker*](/john/)         - [Free & Open Source for any platform](/john/)- [in the cloud](/john/cloud/)- [Pro for Linux](/john/pro/linux/)- [Pro for macOS](/john/pro/macosx/)+ [Wordlists   *for password cracking*](/wordlists/)+ [passwdqc   *policy enforcement*](/passwdqc/)             - [Free & Open Source for Unix](/passwdqc/)- [Pro for Windows (Active Directory)](/passwdqc/windows/)+ [yescrypt   *KDF & password hashing*](/yescrypt/)+ [yespower   *Proof-of-Work (PoW)*](/yespower/)+ [crypt\_blowfish   *password hashing*](/crypt/)+ [phpass   *ditto in PHP*](/phpass/)+ [tcb   *better password shadowing*](/tcb/)+ [Pluggable Authentication Modules](/pam/)+ [scanlogd   *port scan detector*](/scanlogd/)+ [popa3d   *tiny POP3 daemon*](/popa3d/)+ [blists   *web interface to mailing lists*](/blists/)+ [msulogin   *single user mode login*](/msulogin/)+ [php\_mt\_seed   *mt\_rand() cracker*](/php_mt_seed/)* [Services](/services/)* Publications       + [Articles](/articles/)+ [Presentations](/presentations/)* Resources         + [Mailing lists](/lists/)+ [Community wiki](https://openwall.info/wiki/)+ [Source code repositories (GitHub)](https://github.com/openwall)+ [Source code repositories (CVSweb)](https://cvsweb.openwall.com)+ [File archive & mirrors](/mirrors/)+ [How to verify digital signatures](/signatures/)+ [OVE IDs](/ove/)* [What's new](/news) | |
| --- | --- |

| | [Hash Suite - Windows password security audit tool. GUI, reports in PDF.](https://hashsuite.openwall.net) | | --- | |
| --- | --- |

[[<prev]](12) [[next>]](14) [[thread-next>]](../../../2011/07/12/13) [[day]](.) [[month]](..) [[year]](../..) [[list]](../../..)
```

Message-ID: <20110706201406.GD26418@ngolde.de>
Date: Wed, 6 Jul 2011 22:14:06 +0200
From: Nico Golde <oss-security+ml@...lde.de>
To: oss-security@...ts.openwall.com
Subject: libreoffice/openoffice.org CVE id request

Hi,
can someone assign a CVE id (or multiple) to:
<http://www.kb.cert.org/vuls/id/953183>?

Kind regards
Nico

--
Nico Golde - <http://www.ngolde.de> - nion@...ber.ccc.de - GPG: 0xA0A0AAAA
For security reasons, all text in this mail is double-rot13 encrypted.

Content of type "application/pgp-signature" skipped

```

[Powered by blists](https://www.openwall.com/blists/) - [more mailing lists](https://lists.openwall.net)

Please check out the
[Open Source Software Security Wiki](https://oss-security.openwall.org/wiki/), which is counterpart to this
[mailing list](https://oss-security.openwall.org/wiki/mailing-lists/oss-security).

Confused about [mailing lists](/lists/) and their use?
[Read about mailing lists on Wikipedia](https://en.wikipedia.org/wiki/Electronic_mailing_list)
and check out these
[guidelines on proper formatting of your messages](https://www.complang.tuwien.ac.at/anton/mail-news-errors.html).



=== Content from cgit.freedesktop.org_2c1afcfb_20250124_215419.html ===


| [cgit logo](/) | [index](/) : [libreoffice/filters](/libreoffice/filters/) | feature/bootstrap-build feature/calc-multiline-input feature/currency-64bit feature/gnumake4 feature/gnumake4\_writerfilter feature/gsoc2011\_wizards feature/helppack feature/layout feature/onemsi feature/pptx-export-ooxml11 feature/rodatastrings feature/winshrink gr2 integration/dev300\_m101 integration/dev300\_m106 integration/dev300\_m98 libreoffice-3-3 libreoffice-3-3-0 libreoffice-3-3-1 libreoffice-3-3-2 libreoffice-3-3-3 libreoffice-3-3-4 libreoffice-3-4 libreoffice-3-4-0 libreoffice-3-4-1 libreoffice-3-4-2 libreoffice-3-4-3 libreoffice-3-4-4 libreoffice-3-4-5 libreoffice-3-4-6 master master-backup master-deleted warning |
| --- | --- | --- |
| obsolete from 3.5 - Import and export filters | root |

| [summary](/libreoffice/filters/)[refs](/libreoffice/filters/refs/?id=278831e37a23e9e2e29ca811c3a5398b7c67464d)[log](/libreoffice/filters/log/)[tree](/libreoffice/filters/tree/?id=278831e37a23e9e2e29ca811c3a5398b7c67464d)[commit](/libreoffice/filters/commit/?id=278831e37a23e9e2e29ca811c3a5398b7c67464d)[diff](/libreoffice/filters/diff/?id=278831e37a23e9e2e29ca811c3a5398b7c67464d) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Caolán McNamara <caolanm@redhat.com> | 2011-04-11 21:19:54 +0100 |
| --- | --- | --- |
| committer | Caolán McNamara <caolanm@redhat.com> | 2011-04-11 21:41:57 +0100 |
| commit | [278831e37a23e9e2e29ca811c3a5398b7c67464d](/libreoffice/filters/commit/?id=278831e37a23e9e2e29ca811c3a5398b7c67464d) ([patch](/libreoffice/filters/patch/?id=278831e37a23e9e2e29ca811c3a5398b7c67464d)) | |
| tree | [203ea28c54dcd469bc8b384053e305c2c775ee92](/libreoffice/filters/tree/?id=278831e37a23e9e2e29ca811c3a5398b7c67464d) | |
| parent | [03894d18889d7bc79b3d4f000c0df7065ea81ee2](/libreoffice/filters/commit/?id=03894d18889d7bc79b3d4f000c0df7065ea81ee2) ([diff](/libreoffice/filters/diff/?id=278831e37a23e9e2e29ca811c3a5398b7c67464d&id2=03894d18889d7bc79b3d4f000c0df7065ea81ee2)) | |

fix what there is to fix[Diffstat](/libreoffice/filters/diff/?id=278831e37a23e9e2e29ca811c3a5398b7c67464d)

| -rw-r--r-- | [lotuswordpro/source/filter/LotusWordProImportFilter.cxx](/libreoffice/filters/diff/lotuswordpro/source/filter/LotusWordProImportFilter.cxx?id=278831e37a23e9e2e29ca811c3a5398b7c67464d) | 47 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |
| -rw-r--r-- | [lotuswordpro/source/filter/benlist.cxx](/libreoffice/filters/diff/lotuswordpro/source/filter/benlist.cxx?id=278831e37a23e9e2e29ca811c3a5398b7c67464d) | 5 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [lotuswordpro/source/filter/lwp9reader.cxx](/libreoffice/filters/diff/lotuswordpro/source/filter/lwp9reader.cxx?id=278831e37a23e9e2e29ca811c3a5398b7c67464d) | 33 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [lotuswordpro/source/filter/lwpbulletstylemgr.cxx](/libreoffice/filters/diff/lotuswordpro/source/filter/lwpbulletstylemgr.cxx?id=278831e37a23e9e2e29ca811c3a5398b7c67464d) | 6 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [lotuswordpro/source/filter/lwpcelllayout.cxx](/libreoffice/filters/diff/lotuswordpro/source/filter/lwpcelllayout.cxx?id=278831e37a23e9e2e29ca811c3a5398b7c67464d) | 37 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [lotuswordpro/source/filter/lwpchangemgr.cxx](/libreoffice/filters/diff/lotuswordpro/source/filter/lwpchangemgr.cxx?id=278831e37a23e9e2e29ca811c3a5398b7c67464d) | 40 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [lotuswordpro/source/filter/lwpchartstreamtools.cxx](/libreoffice/filters/diff/lotuswordpro/source/filter/lwpchartstreamtools.cxx?id=278831e37a23e9e2e29ca811c3a5398b7c67464d) | 6 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [lotuswordpro/source/filter/lwpcontent.hxx](/libreoffice/filters/diff/lotuswordpro/source/filter/lwpcontent.hxx?id=278831e37a23e9e2e29ca811c3a5398b7c67464d) | 2 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [lotuswordpro/source/filter/lwpdivinfo.hxx](/libreoffice/filters/diff/lotuswordpro/source/filter/lwpdivinfo.hxx?id=278831e37a23e9e2e29ca811c3a5398b7c67464d) | 2 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [lotuswordpro/source/filter/lwpdoc.cxx](/libreoffice/filters/diff/lotuswordpro/source/filter/lwpdoc.cxx?id=278831e37a23e9e2e29ca811c3a5398b7c67464d) | 98 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [lotuswordpro/source/filter/lwpdoc.hxx](/libreoffice/filters/diff/lotuswordpro/source/filter/lwpdoc.hxx?id=278831e37a23e9e2e29ca811c3a5398b7c67464d) | 4 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [lotuswordpro/source/filter/lwpfilter.cxx](/libreoffice/filters/diff/lotuswordpro/source/filter/lwpfilter.cxx?id=278831e37a23e9e2e29ca811c3a5398b7c67464d) | 94 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [lotuswordpro/source/filter/lwpfilter.hxx](/libreoffice/filters/diff/lotuswordpro/source/filter/lwpfilter.hxx?id=278831e37a23e9e2e29ca811c3a5398b7c67464d) | 3 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [lotuswordpro/source/filter/lwpfont.cxx](/libreoffice/filters/diff/lotuswordpro/source/filter/lwpfont.cxx?id=278831e37a23e9e2e29ca811c3a5398b7c67464d) | 17 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [lotuswordpro/source/filter/lwpfootnote.cxx](/libreoffice/filters/diff/lotuswordpro/source/filter/lwpfootnote.cxx?id=278831e37a23e9e2e29ca811c3a5398b7c67464d) | 10 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [lotuswordpro/source/filter/lwpfoundry.cxx](/libreoffice/filters/diff/lotuswordpro/source/filter/lwpfoundry.cxx?id=278831e37a23e9e2e29ca811c3a5398b7c67464d) | 15 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [lotuswordpro/source/filter/lwpfoundry.hxx](/libreoffice/filters/diff/lotuswordpro/source/filter/lwpfoundry.hxx?id=278831e37a23e9e2e29ca811c3a5398b7c67464d) | 1 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [lotuswordpro/source/filter/lwpframelayout.cxx](/libreoffice/filters/diff/lotuswordpro/source/filter/lwpframelayout.cxx?id=278831e37a23e9e2e29ca811c3a5398b7c67464d) | 15 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [lotuswordpro/source/filter/lwpfrib.cxx](/libreoffice/filters/diff/lotuswordpro/source/filter/lwpfrib.cxx?id=278831e37a23e9e2e29ca811c3a5398b7c67464d) | 36 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [lotuswordpro/source/filter/lwpfribframe.cxx](/libreoffice/filters/diff/lotuswordpro/source/filter/lwpfribframe.cxx?id=278831e37a23e9e2e29ca811c3a5398b7c67464d) | 27 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [lotuswordpro/source/filter/lwpfribmark.cxx](/libreoffice/filters/diff/lotuswordpro/source/filter/lwpfribmark.cxx?id=278831e37a23e9e2e29ca811c3a5398b7c67464d) | 10 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [lotuswordpro/source/filter/lwpfribptr.cxx](/libreoffice/filters/diff/lotuswordpro/source/filter/lwpfribptr.cxx?id=278831e37a23e9e2e29ca811c3a5398b7c67464d) | 30 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [lotuswordpro/source/filter/lwpgrfobj.cxx](/libreoffice/filters/diff/lotuswordpro/source/filter/lwpgrfobj.cxx?id=278831e37a23e9e2e29ca811c3a5398b7c67464d) | 48 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [lotuswordpro/source/filter/lwpidxmgr.cxx](/libreoffice/filters/diff/lotuswordpro/source/filter/lwpidxmgr.cxx?id=278831e37a23e9e2e29ca811c3a5398b7c67464d) | 25 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [lotuswordpro/source/filter/lwplayout.cxx](/libreoffice/filters/diff/lotuswordpro/source/filter/lwplayout.cxx?id=278831e37a23e9e2e29ca811c3a5398b7c67464d) | 240 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [lotuswordpro/source/filter/lwplayout.hxx](/libreoffice/filters/diff/lotuswordpro/source/filter/lwplayout.hxx?id=278831e37a23e9e2e29ca811c3a5398b7c67464d) | 2 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [lotuswordpro/source/filter/lwpmarker.cxx](/libreoffice/filters/diff/lotuswordpro/source/filter/lwpmarker.cxx?id=278831e37a23e9e2e29ca811c3a5398b7c67464d) | 5 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [lotuswordpro/source/filter/lwpmarker.hxx](/libreoffice/filters/diff/lotuswordpro/source/filter/lwpmarker.hxx?id=278831e37a23e9e2e29ca811c3a5398b7c67464d) | 1 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [lotuswordpro/source/filter/lwpobjfactory.cxx](/libreoffice/filters/diff/lotuswordpro/source/filter/lwpobjfactory.cxx?id=278831e37a23e9e2e29ca811c3a5398b7c67464d) | 54 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [lotuswordpro/source/filter/lwpobjfactory.hxx](/libreoffice/filters/diff/lotuswordpro/source/filter/lwpobjfactory.hxx?id=278831e37a23e9e2e29ca811c3a5398b7c67464d) | 4 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [lotuswordpro/source/filter/lwpobjhdr.cxx](/libreoffice/filters/diff/lotuswordpro/source/filter/lwpobjhdr.cxx?id=278831e37a23e9e2e29ca811c3a5398b7c67464d) | 7 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [lotuswordpro/source/filter/lwpobjhdr.hxx](/libreoffice/filters/diff/lotuswordpro/source/filter/lwpobjhdr.hxx?id=278831e37a23e9e2e29ca811c3a5398b7c67464d) | 2 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [lotuswordpro/source/filter/lwpobjstrm.cxx](/libreoffice/filters/diff/lotuswordpro/source/filter/lwpobjstrm.cxx?id=278831e37a23e9e2e29ca811c3a5398b7c67464d) | 21 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [lotuswordpro/source/filter/lwpoverride.cxx](/libreoffice/filters/diff/lotuswordpro/source/filter/lwpoverride.cxx?id=278831e37a23e9e2e29ca811c3a5398b7c67464d) | 2 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [lotuswordpro/source/filter/lwppagelayout.cxx](/libreoffice/filters/diff/lotuswordpro/source/filter/lwppagelayout.cxx?id=278831e37a23e9e2e29ca811c3a5398b7c67464d) | 42 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [lotuswordpro/source/filter/lwppara.cxx](/libreoffice/filters/diff/lotuswordpro/source/filter/lwppara.cxx?id=278831e37a23e9e2e29ca811c3a5398b7c67464d) | 36 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [lotuswordpro/source/filter/lwppara.hxx](/libreoffice/filters/diff/lotuswordpro/source/filter/lwppara.hxx?id=278831e37a23e9e2e29ca811c3a5398b7c67464d) | 2 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [lotuswordpro/source/filter/lwppara1.cxx](/libreoffice/filters/diff/lotuswordpro/source/filter/lwppara1.cxx?id=278831e37a23e9e2e29ca811c3a5398b7c67464d) | 118 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [lotuswordpro/source/filter/lwpparaproperty.cxx](/libreoffice/filters/diff/lotuswordpro/source/filter/lwpparaproperty.cxx?id=278831e37a23e9e2e29ca811c3a5398b7c67464d) | 86 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [lotuswordpro/source/filter/lwpparastyle.cxx](/libreoffice/filters/diff/lotuswordpro/source/filter/lwpparastyle.cxx?id=278831e37a23e9e2e29ca811c3a5398b7c67464d) | 116 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [lotuswordpro/source/filter/lwprowlayout.cxx](/libreoffice/filters/diff/lotuswordpro/source/filter/lwprowlayout.cxx?id=278831e37a23e9e2e29ca811c3a5398b7c67464d) | 18 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [lotuswordpro/source/filter/lwprowlayout.hxx](/libreoffice/filters/diff/lotuswordpro/source/filter/lwprowlayout.hxx?id=278831e37a23e9e2e29ca811c3a5398b7c67464d) | 2 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [lotuswordpro/source/filter/lwpsection.hxx](/libreoffice/filters/diff/lotuswordpro/source/filter/lwpsection.hxx?id=278831e37a23e9e2e29ca811c3a5398b7c67464d) | 2 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [lotuswordpro/source/filter/lwpsilverbullet.cxx](/libreoffice/filters/diff/lotuswordpro/source/filter/lwpsilverbullet.cxx?id=278831e37a23e9e2e29ca811c3a5398b7c67464d) | 20 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [lotuswordpro/source/filter/lwpstory.cxx](/libreoffice/filters/diff/lotuswordpro/source/filter/lwpstory.cxx?id=278831e37a23e9e2e29ca811c3a5398b7c67464d) | 67 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [lotuswordpro/source/filter/lwptable.cxx](/libreoffice/filters/diff/lotuswordpro/source/filter/lwptable.cxx?id=278831e37a23e9e2e29ca811c3a5398b7c67464d) | 4 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [lotuswordpro/source/filter/lwptablelayout.cxx](/libreoffice/filters/diff/lotuswordpro/source/filter/lwptablelayout.cxx?id=278831e37a23e9e2e29ca811c3a5398b7c67464d) | 40 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [lotuswordpro/source/filter/lwptabrack.cxx](/libreoffice/filters/diff/lotuswordpro/source/filter/lwptabrack.cxx?id=278831e37a23e9e2e29ca811c3a5398b7c67464d) | 2 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [lotuswordpro/source/filter/lwptoc.cxx](/libreoffice/filters/diff/lotuswordpro/source/filter/lwptoc.cxx?id=278831e37a23e9e2e29ca811c3a5398b7c67464d) | 8 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [lotuswordpro/source/filter/lwptools.hxx](/libreoffice/filters/diff/lotuswordpro/source/filter/lwptools.hxx?id=278831e37a23e9e2e29ca811c3a5398b7c67464d) | 13 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [lotuswordpro/source/filter/utlist.cxx](/libreoffice/filters/diff/lotuswordpro/source/filter/utlist.cxx?id=278831e37a23e9e2e29ca811c3a5398b7c67464d) | 7 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [lotuswordpro/source/filter/utlist.hxx](/libreoffice/filters/diff/lotuswordpro/source/filter/utlist.hxx?id=278831e37a23e9e2e29ca811c3a5398b7c67464d) | 5 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [lotuswordpro/source/filter/xfilter/xfimage.cxx](/libreoffice/filters/diff/lotuswordpro/source/filter/xfilter/xfimage.cxx?id=278831e37a23e9e2e29ca811c3a5398b7c67464d) | 2 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [lotuswordpro/source/filter/xfilter/xfsaxstream.cxx](/libreoffice/filters/diff/lotuswordpro/source/filter/xfilter/xfsaxstream.cxx?id=278831e37a23e9e2e29ca811c3a5398b7c67464d) | 15 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [lotuswordpro/util/makefile.mk](/libreoffice/filters/diff/lotuswordpro/util/makefile.mk?id=278831e37a23e9e2e29ca811c3a5398b7c67464d) | 8 | |  |  |  | | --- | --- | --- | |

55 files changed, 751 insertions, 811 deletions

| diff --git a/lotuswordpro/source/filter/LotusWordProImportFilter.cxx b/lotuswordpro/source/filter/LotusWordProImportFilter.cxxindex 374965d58..47bb7a1f9 100644--- a/[lotuswordpro/source/filter/LotusWordProImportFilter.cxx](/libreoffice/filters/tree/lotuswordpro/source/filter/LotusWordProImportFilter.cxx?id=03894d18889d7bc79b3d4f000c0df7065ea81ee2)+++ b/[lotuswordpro/source/filter/LotusWordProImportFilter.cxx](/libreoffice/filters/tree/lotuswordpro/source/filter/LotusWordProImportFilter.cxx?id=278831e37a23e9e2e29ca811c3a5398b7c67464d)@@ -256,23 +256,13 @@ sal\_Bool SAL\_CALL LotusWordProImportFilter::importImpl( const Sequence< ::com::s sal\_Int32 nLength = aDescriptor.getLength(); const PropertyValue \* pValue = aDescriptor.getConstArray(); OUString sURL;- uno::Reference < XInputStream > xInputStream; for ( sal\_Int32 i = 0 ; i < nLength; i++) {- if ( pValue[i].Name.equalsAsciiL ( RTL\_CONSTASCII\_STRINGPARAM ( "InputStream" ) ) )- pValue[i].Value >>= xInputStream;- else if ( pValue[i].Name.equalsAsciiL ( RTL\_CONSTASCII\_STRINGPARAM ( "URL" ) ) )- pValue[i].Value >>= sURL;- }- if ( !xInputStream.is() )- {- OSL\_ASSERT( 0 );- return sal\_False;+ //Note, we should attempt to use InputStream here first!+ if ( pValue[i].Name.equalsAsciiL ( RTL\_CONSTASCII\_STRINGPARAM ( "URL" ) ) )+ pValue[i].Value >>= sURL; } - OString sFileName;- sFileName = OUStringToOString(sURL, RTL\_TEXTENCODING\_INFO\_ASCII);- SvFileStream inputStream( sURL, STREAM\_READ ); if ( inputStream.IsEof() || ( inputStream.GetError() != SVSTREAM\_OK ) ) return sal\_False;@@ -282,13 +272,10 @@ sal\_Bool SAL\_CALL LotusWordProImportFilter::importImpl( const Sequence< ::com::s  uno::Reference< XDocumentHandler > xInternalHandler( mxMSF->createInstance( sXMLImportService ), UNO\_QUERY ); uno::Reference < XImporter > xImporter(xInternalHandler, UNO\_QUERY);+ if (xImporter.is()) xImporter->setTargetDocument(mxDoc);-/\*- SimpleXMLImporter xmlImporter( xInternalHandler, inputStream );- xmlImporter.import();- return sal\_True;-\*/- return ( ReadWordproFile( &inputStream, xInternalHandler) == 0 );++ return ( ReadWordproFile( inputStream, xInternalHandler) == 0 );  } @@ -333,18 +320,18 @@ OUString SAL\_CALL LotusWordProImportFilter::detect( com::sun::star::uno::Sequenc uno::Reference< com::sun::star::ucb::XCommandEnvironment > xEnv; if (!xInputStream.is()) {- try- {- ::ucbhelper::Content aContent(sURL, xEnv);- xInputStream = aContent.openStream();- }- catch ( Exception& )- {- return ::rtl::OUString();- }+ try+ {+ ::ucbhelper::Content aContent(sURL, xEnv);+ xInputStream = aContent.openStream();+ }+ catch ( Exception& )+ {+ return ::rtl::OUString();+ } - if (!xInputStream.is())- return ::rtl::OUString();+ if (!xInputStream.is())+ return ::rtl::OUString(); }  Sequence< ::sal\_Int8 > aData;diff --git a/lotuswordpro/source/filter/benlist.cxx b/lotuswordpro/source/filter/benlist.cxxindex 506bb8f21..c2ec12351 100644--- a/[lotuswordpro/source/filter/benlist.cxx](/libreoffice/filters/tree/lotuswordpro/source/filter/benlist.cxx?id=03894d18889d7bc79b3d4f000c0df7065ea81ee2)+++ b/[lotuswordpro/source/filter/benlist.cxx](/libreoffice/filters/tree/lotuswordpro/source/filter/benlist.cxx?id=278831e37a23e9e2e29ca811c3a5398b7c67464d)@@ -68,14 +68,9 @@ FindNamedObject(pCUtList pList, const char \* sName, pCBenNamedObjectListElmt pCurrNamedObjectListElmt = (pCBenNamedObjectListElmt) pCurr; -- //Old code-// int Comp = strcmp(sName, pCurrNamedObjectListElmt->GetNamedObject()->-// GetName()); int Comp = strcmp(sName, pCurrNamedObjectListElmt->GetNamedObject()-> GetNameCStr()); - if (Comp == 0) return pCurrNamedObjectListElmt->GetNamedObject(); else if (Comp < 0)diff --git a/lotuswordpro/source/filter/lwp9reader.cxx b/lotuswordpro/source/filter/lwp9reader.cxxindex ac9ca62a1..5cbce8df7 100644--- a/[lotuswordpro/source/filter/lwp9reader.cxx](/libreoffice/filters/tree/lotuswordpro/source/filter/lwp9reader.cxx?id=03894d18889d7bc79b3d4f000c0df7065ea81ee2)+++ b/[lotuswordpro/source/filter/lwp9reader.cxx](/libreoffice/filters/tree/lotuswordpro/source/filter/lwp9reader.cxx?id=278831e37a23e9e2e29ca811c3a5398b7c67464d)@@ -77,18 +77,22 @@ Lwp9Reader::Lwp9Reader (LwpSvStream\* pInputStream, IXFStream\* pStream) void Lwp9Reader::Read() { LwpGlobalMgr\* pGlobal = LwpGlobalMgr::GetInstance(m\_pDocStream);- m\_pObjMgr = pGlobal->GetLwpObjFactory();-- //Commented out by , 10/26/2005- //Read Ole object in LwpOleObject::XFConverter to support Ole in Linux- //ReadOleObjects();+ try+ {+ m\_pObjMgr = pGlobal->GetLwpObjFactory(); - ReadFileHeader();- //Does not support Word Pro 96 and previous versions- if(LwpFileHeader::m\_nFileRevision>=0x000B)+ ReadFileHeader();+ //Does not support Word Pro 96 and previous versions+ if(LwpFileHeader::m\_nFileRevision>=0x000B)+ {+ ReadIndex();+ ParseDocument();+ }+ }+ catch(...) {- ReadIndex();- ParseDocument();+ LwpGlobalMgr::DeleteInstance();+ throw; } LwpGlobalMgr::DeleteInstance(); }@@ -181,14 +185,15 @@ void Lwp9Reader::ParseDocument() WriteDocHeader();  //Get root document- LwpDocument\* doc = static\_cast<LwpDocument\*> ( m\_LwpFileHdr.GetDocID()->obj() );+ LwpDocument\* doc = dynamic\_cast<LwpDocument\*> ( m\_LwpFileHdr.GetDocID()->obj() );++ if (!doc)+ return;  //Parse Doc Data- LwpDocData \*pDocData = static\_cast<LwpDocData\*>((doc->GetDocData())->obj());+ LwpDocData \*pDocData = dynamic\_cast<LwpDocData\*>((doc->GetDocData())->obj()); if (pDocData!=NULL)- { pDocData->Parse(m\_pStream);- }  //Register Styles RegisteArrowStyles();diff --git a/lotuswordpro/source/filter/lwpbulletstylemgr.cxx b/lotuswordpro/source/filter/lwpbulletstylemgr.cxxindex 08304de47..4fc74cddf 100644--- a/[lotuswordpro/source/filter/lwpbulletstylemgr.cxx](/libreoffice/filters/tree/lotuswordpro/source/filter/lwpbulletstylemgr.cxx?id=03894d18889d7bc79b3d4f000c0df7065ea81ee2)+++ b/[lotuswordpro/source/filter/lwpbulletstylemgr.cxx](/libreoffice/filters/tree/lotuswordpro/source/filter/lwpbulletstylemgr.cxx?id=278831e37a23e9e2e29ca811c3a5398b7c67464d)@@ -547,7 +547,9 @@ rtl::OUString LwpBulletStyleMgr::GetDivisionName() LwpObjectID\* pID = pDoc->GetDivInfoID(); if (!pID->IsNull()) {- aRet = static\_cast<LwpDivInfo\*>(pID->obj(VO\_DIVISIONINFO))->GetDivName();+ LwpDivInfo \*pInfo = dynamic\_cast<LwpDivInfo\*>(pID->obj(VO\_DIVISIONINFO));+ if (pInfo)+ aRet = pInfo->GetDivName(); } } @@ -562,7 +564,7 @@ rtl::OUString LwpBulletStyleMgr::GetSectionName(LwpPara\* pPara) return rtl::OUString(); } - LwpStory\* pStory = static\_cast<LwpStory\*>(pStoryID->obj(VO\_STORY));+ LwpStory\* pStory = dynamic\_cast<LwpStory\*>(pStoryID->obj(VO\_STORY)); if (!pStory) { return rtl::OUString();diff --git a/lotuswordpro/source/filter/lwpcelllayout.cxx b/lotuswordpro/source/filter/lwpcelllayout.cxxindex 9c10b6d7c..434cd3208 100644--- a/[lotuswordpro/source/filter/lwpcelllayout.cxx](/libreoffice/filters/tree/lotuswordpro/source/filter/lwpcelllayout.cxx?id=03894d18889d7bc79b3d4f000c0df7065ea81ee2)+++ b/[lotuswordpro/source/filter/lwpcelllayout.cxx](/libreoffice/filters/tree/lotuswordpro/source/filter/lwpcelllayout.cxx?id=278831e37a23e9e2e29ca811c3a5398b7c67464d)@@ -91,7 +91,7 @@ LwpCellLayout::~LwpCellLayout() \*/ LwpTableLayout \* LwpCellLayout::GetTableLayout() {- LwpRowLayout \* pRow = static\_cast<LwpRowLayout \*>(GetParent()->obj());+ LwpRowLayout \* pRow = dynamic\_cast<LwpRowLayout \*>(GetParent()->obj()); if(!pRow) { return NULL;@@ -265,14 +265,14 @@ void LwpCellLayout::ApplyBackColor(XFCellStyle \*pCellStyle) \*/ void LwpCellLayout::ApplyFmtStyle(XFCellStyle \*pCellStyle) {- LwpLayoutNumerics\* pLayoutNumerics =(LwpLayoutNumerics\*)cLayNumerics.obj();+ LwpLayoutNumerics\* pLayoutNumerics = dynamic\_cast<LwpLayoutNumerics\*>(cLayNumerics.obj()); if (!pLayoutNumerics) { // if current layout doesn't have format, go to based on layout- LwpCellLayout\* pCellLayout = (LwpCellLayout\*)m\_BasedOnStyle.obj();+ LwpCellLayout\* pCellLayout = dynamic\_cast<LwpCellLayout\*>(m\_BasedOnStyle.obj()); if (pCellLayout) {- pLayoutNumerics = (LwpLayoutNumerics\*)pCellLayout->GetNumericsObject()->obj();+ pLayoutNumerics = dynamic\_cast<LwpLayoutNumerics\*>(pCellLayout->GetNumericsObject()->obj()); } } @@ -314,7 +314,7 @@ XFCell\* LwpCellLayout::ConvertCell(LwpObjectID aTableID, sal\_uInt16 nRow, sal\_uI { // if cell layout is aTableID's default cell layout // it can't have any content, bypass these code- LwpTable \* pTable = static\_cast<LwpTable \*>(aTableID.obj());+ LwpTable \* pTable = dynamic\_cast<LwpTable \*>(aTableID.obj()); if (!pTable) { assert(sal\_False);@@ -331,7 +331,7 @@ XFCell\* LwpCellLayout::ConvertCell(LwpObjectID aTableID, sal\_uInt16 nRow, sal\_uI }  // content of cell- LwpStory\* pStory =(LwpStory\*) m\_Content.obj();+ LwpStory\* pStory = dynamic\_cast<LwpStory\*>(m\_Content.obj()); if (pStory) { pStory->XFConvert(pXFCell);@@ -347,8 +347,8 @@ LwpPara\* LwpCellLayout::GetLastParaOfPreviousStory() LwpObjectID\* pPreStoryID = this->GetPreviousCellStory(); if (pPreStoryID && !(pPreStoryID->IsNull())) {- LwpStory\* pPreStory = static\_cast<LwpStory\*>(pPreStoryID->obj(VO\_STORY));- return static\_cast<LwpPara\*>(pPreStory->GetLastPara()->obj(VO\_PARA));+ LwpStory\* pPreStory = dynamic\_cast<LwpStory\*>(pPreStoryID->obj(VO\_STORY));+ return dynamic\_cast<LwpPara\*>(pPreStory->GetLastPara()->obj(VO\_PARA)); } else {@@ -571,7 +571,7 @@ void LwpCellLayout::RegisterDefaultCell() \*/ void LwpCellLayout::RegisterStyle() {- LwpVirtualLayout \* pParent = static\_cast<LwpVirtualLayout \*>(GetParent()->obj());+ LwpVirtualLayout \* pParent = dynamic\_cast<LwpVirtualLayout \*>(GetParent()->obj()); if (!pParent || pParent->GetLayoutType() != LWP\_ROW\_LAYOUT) { // default cell layout, we must register 4 styles for it@@ -604,15 +604,6 @@ void LwpCellLayout::RegisterStyle()  //register child layout style RegisterChildStyle();- /\*- LwpVirtualLayout\* pLayout = static\_cast<LwpVirtualLayout\*>(GetChildHead()->obj());- while(pLayout)- {- pLayout->SetFoundry(m\_pFoundry);- pLayout->RegisterStyle();- pLayout = static\_cast<LwpVirtualLayout\*>(pLayout->GetNext()->obj());- }- \*/ } /\*\* \* @short Read cell layout@@ -687,7 +678,7 @@ void LwpCellLayout::ApplyProtect(XFCell \* pCell, LwpObjectID aTableID) else { // judge base on- LwpCellLayout \* pBase = static\_cast<LwpCellLayout \*>(m\_BasedOnStyle.obj());+ LwpCellLayout \* pBase = dynamic\_cast<LwpCellLayout \*>(m\_BasedOnStyle.obj()); if (pBase && pBase->IsProtected()) { bProtected = sal\_True;@@ -695,7 +686,7 @@ void LwpCellLayout::ApplyProtect(XFCell \* pCell, LwpObjectID aTableID) else { // judge whole table- LwpTable \* pTable = static\_cast<LwpTable \*>(aTableID.obj());+ LwpTable \* pTable = dynamic\_cast<LwpTable \*>(aTableID.obj()); LwpTableLayout \* pTableLayout = static\_cast<LwpTableLayout \*>(pTable->GetTableLayout()); LwpSuperTableLayout \* pSuper = pTableLayout->GetSuperTableLayout(); if (pSuper && pSuper->IsProtected())@@ -907,17 +898,17 @@ XFCell\* LwpHiddenCellLayout::ConvertCell(LwpObjectID aTableID, sal\_uInt16 nRow, { if (!cconnectedlayout.obj()) return NULL;- LwpConnectedCellLayout\* pConnCell = static\_cast<LwpConnectedCellLayout\* >(cconnectedlayout.obj());+ LwpConnectedCellLayout\* pConnCell = dynamic\_cast<LwpConnectedCellLayout\* >(cconnectedlayout.obj());  if (nRow < (pConnCell->GetNumrows()+pConnCell->GetRowID())) return NULL; // if the hidden cell should be displayed for limit of SODC // use the default cell layout XFCell\* pXFCell = NULL;- LwpTable \*pTable = static\_cast<LwpTable \*>(aTableID.obj());+ LwpTable \*pTable = dynamic\_cast<LwpTable \*>(aTableID.obj()); if (pTable) {- LwpCellLayout \*pDefault = static\_cast<LwpCellLayout \*>(pTable->GetDefaultCellStyle()->obj());+ LwpCellLayout \*pDefault = dynamic\_cast<LwpCellLayout \*>(pTable->GetDefaultCellStyle()->obj()); if (pDefault) { pXFCell = pDefault->ConvertCell(aTableID, nRow, nCol);diff --git a/lotuswordpro/source/filter/lwpchangemgr.cxx b/lotuswordpro/source/filter/lwpchangemgr.cxxindex c43a50be1..37036dfe2 100644--- a/[lotuswordpro/source/filter/lwpchangemgr.cxx](/libreoffice/filters/tree/lotuswordpro/source/filter/lwpchangemgr.cxx?id=03894d18889d7bc79b3d4f000c0df7065ea81ee2)+++ b/[lotuswordpro/source/filter/lwpchangemgr.cxx](/libreoffice/filters/tree/lotuswordpro/source/filter/lwpchangemgr.cxx?id=278831e37a23e9e2e29ca811c3a5398b7c67464d)@@ -229,45 +229,7 @@ void LwpChangeMgr::ConvertFribContent(XFContentContainer\* pCont, LwpFrib\* pFrib) } } break;-/\* case FRIB\_TAG\_SECTION:- {- delete pXFPara;- LwpFribSection\* pSectionFrib = static\_cast<LwpFribSection\*>(pFrib);- pSectionFrib->ParseSection();- }- break;- case FRIB\_TAG\_PAGEBREAK:- {- LwpFribPageBreak\* pPageBreak = static\_cast<LwpFribPageBreak\*>(pFrib);- LwpPageLayout\* pLayout = static\_cast<LwpPageLayout\*>(pPageBreak->GetLayout()->obj());- if(pLayout)- {- pPageBreak->ParseLayout();- }- else- {- if (pPageBreak->IsLastFrib() == sal\_True)- {- pXFPara->SetStyleName( pPageBreak->GetStyleName() );- }- else- {- //parse pagebreak- XFParagraph \*pNewPara = new XFParagraph();- pNewPara->SetStyleName(pFrib->GetStyleName());- pPara->AddXFContent(pNewPara);- }- }- }- break;- case FRIB\_TAG\_COLBREAK:- {- XFParagraph \*pNewPara = new XFParagraph();- pNewPara->SetStyleName(pFrib->GetStyleName());- pPara->AddXFContent(pNewPara);- }- break;-\*/ case FRIB\_TAG\_LINEBREAK:+ case FRIB\_TAG\_LINEBREAK: { XFLineBreak \*pLineBreak = new XFLineBreak(); pXFPara->Add(pLineBreak);diff --git a/lotuswordpro/source/filter/lwpchartstreamtools.cxx b/lotuswordpro/source/filter/lwpchartstreamtools.cxxindex a50e86127..3dfb96287 100644--- a/[lotuswordpro/source/filter/lwpchartstreamtools.cxx](/libreoffice/filters/tree/lotuswordpro/source/filter/lwpchartstreamtools.cxx?id=03894d18889d7bc79b3d4f000c0df7065ea81ee2)+++ b/[lotuswordpro/source/filter/lwpchartstreamtools.cxx](/libreoffice/filters/tree/lotuswordpro/source/filter/lwpchartstreamtools.cxx?id=278831e37a23e9e2e29ca811c3a5398b7c67464d)@@ -85,11 +85,9 @@ SvStream\* LwpChartStreamTools::GetChartStream(LwpSvStream\* pDocStream, const cha SvStream\* pStream = NULL; pSvStream->Seek(0); OpenStormBento::LtcBenContainer\* pContainer = NULL;;- ULONG nRet = OpenStormBento::BenOpenContainer(pSvStream,&pContainer);- if ( 0==nRet )- {+ sal\_uLong nRet = OpenStormBento::BenOpenContainer(pSvStream,&pContainer);+ if (nRet != OpenStormBento::BenErr\_OK) pStream = pContainer->FindValueStreamWithPropertyName(pChartName);- } return pStream; } diff --git a/lotuswordpro/source/filter/lwpcontent.hxx b/lotuswordpro/source/filter/lwpcontent.hxxindex eeaf7c241..d447d9ccd 100644--- a/[lotuswordpro/source/filter/lwpcontent.hxx](/libreoffice/filters/tree/lotuswordpro/source/filter/lwpcontent.hxx?id=03894d18889d7bc79b3d4f000c0df7065ea81ee2)+++ b/[lotuswordpro/source/filter/lwpcontent.hxx](/libreoffice/filters/tree/lotuswordpro/source/filter/lwpcontent.hxx?id=278831e37a23e9e2e29ca811c3a5398b7c67464d)@@ -141,7 +141,7 @@ inline OUString LwpContent::GetClassName()  inline LwpContent\* LwpContent::GetNextEnumerated() {- return static\_cast<LwpContent\*>(m\_NextEnumerated.obj());+ return dynamic\_cast<LwpContent\*>(m\_NextEnumerated.obj()); } /\*\* \* @briefdiff --git a/lotuswordpro/source/filter/lwpdivinfo.hxx b/lotuswordpro/source/filter/lwpdivinfo.hxxindex 459d56c5f..1e3c931a5 100644--- a/[lotuswordpro/source/filter/lwpdivinfo.hxx](/libreoffice/filters/tree/lotuswordpro/source/filter/lwpdivinfo.hxx?id=03894d18889d7bc79b3d4f000c0df7065ea81ee2)+++ b/[lotuswordpro/source/filter/lwpdivinfo.hxx](/libreoffice/filters/tree/lotuswordpro/source/filter/lwpdivinfo.hxx?id=278831e37a23e9e2e29ca811c3a5398b7c67464d)@@ -162,7 +162,7 @@ inline sal\_Bool LwpDivInfo::IsGotoable()  inline LwpDocument\* LwpDivInfo::GetDivision() {- return static\_cast<LwpDocument\*>(m\_ParentID.obj());+ return dynamic\_cast<LwpDocument\*>(m\_ParentID.obj()); } #endif diff --git a/lotuswordpro/source/filter/lwpdoc.cxx b/lotuswordpro/source/filter/lwpdoc.cxxindex 1444440cc..ebe982248 100644--- a/[lotuswordpro/source/filter/lwpdoc.cxx](/libreoffice/filters/tree/lotuswordpro/source/filter/lwpdoc.cxx?id=03894d18889d7bc79b3d4f000c0df7065ea81ee2)+++ b/[lotuswordpro/source/filter/lwpdoc.cxx](/libreoffice/filters/tree/lotuswordpro/source/filter/lwpdoc.cxx?id=278831e37a23e9e2e29ca811c3a5398b7c67464d)@@ -71,7 +71,7 @@ #endif  LwpDocument::LwpDocument(LwpObjectHeader& objHdr, LwpSvStream\* pStrm)- : LwpDLNFPVList(objHdr, pStrm), m\_pLnOpts(NULL)+ : LwpDLNFPVList(objHdr, pStrm), m\_pOwnedFoundry(NULL), m\_pLnOpts(NULL) {}  LwpDocument::~LwpDocument()@@ -80,9 +80,9 @@ LwpDocument::~LwpDocument() { delete m\_pLnOpts; }- if(m\_pFoundry)+ if(m\_pOwnedFoundry) {- delete m\_pFoundry;+ delete m\_pOwnedFoundry; } } /\*\*@@ -115,7 +115,7 @@ void LwpDocument::Read() LwpPrinterInfo m\_PrtInfo( m\_pObjStrm ); } - m\_pFoundry = new LwpFoundry(m\_pObjStrm, this);+ m\_pFoundry = m\_pOwnedFoundry = new LwpFoundry(m\_pObjStrm, this);  m\_DivOpts.ReadIndexed(m\_pObjStrm); @@ -171,7 +171,7 @@ sal\_Bool LwpDocument::IsSkippedDivision() { OUString sDivName; sal\_uInt8 ret = sal\_False;- LwpDivInfo\* pDiv = static\_cast<LwpDivInfo\*>(GetDivInfoID()->obj(VO\_DIVISIONINFO));+ LwpDivInfo\* pDiv = dynamic\_cast<LwpDivInfo\*>(GetDivInfoID()->obj(VO\_DIVISIONINFO)); if (pDiv == NULL) return sal\_True; sDivName = pDiv->GetDivName();@@ -183,10 +183,10 @@ sal\_Bool LwpDocument::IsSkippedDivision() || strClassName.equals(A2OUSTR(STR\_DivisionGroupEndnote)) || strClassName.equals(A2OUSTR(STR\_DocumentEndnote))) {- LwpPageLayout\* pPageLayout =static\_cast<LwpPageLayout\*>(pDiv->GetInitialLayoutID()->obj(VO\_PAGELAYOUT));+ LwpPageLayout\* pPageLayout = dynamic\_cast<LwpPageLayout\*>(pDiv->GetInitialLayoutID()->obj(VO\_PAGELAYOUT)); if(pPageLayout) {- LwpStory\* pStory = static\_cast<LwpStory\*>(pPageLayout->GetContent()->obj(VO\_STORY));+ LwpStory\* pStory = dynamic\_cast<LwpStory\*>(pPageLayout->GetContent()->obj(VO\_STORY)); if(pStory) { //This judgement maybe have problem. If there is only one para in the story,@@ -230,15 +230,15 @@ void LwpDocument::RegisterStyle() void LwpDocument::RegisterTextStyles() { //Register all text styles: para styles, character styles- LwpDLVListHeadHolder\* pParaStyleHolder = static\_cast<LwpDLVListHeadHolder\*>(m\_pFoundry->GetTextStyleHead()->obj());+ LwpDLVListHeadHolder\* pParaStyleHolder = dynamic\_cast<LwpDLVListHeadHolder\*>(m\_pFoundry->GetTextStyleHead()->obj()); if(pParaStyleHolder) {- LwpTextStyle\* pParaStyle = static\_cast<LwpTextStyle\*> (pParaStyleHolder->GetHeadID()->obj());+ LwpTextStyle\* pParaStyle = dynamic\_cast<LwpTextStyle\*> (pParaStyleHolder->GetHeadID()->obj()); while(pParaStyle) { pParaStyle->SetFoundry(m\_pFoundry); pParaStyle->RegisterStyle();- pParaStyle = static\_cast<LwpParaStyle\*>(pParaStyle->GetNext()->obj());+ pParaStyle = dynamic\_cast<LwpParaStyle\*>(pParaStyle->GetNext()->obj()); } } ChangeStyleName();//add by ,for click here block,05/5/26@@ -253,15 +253,15 @@ void LwpDocument::RegisterLayoutStyles() m\_pFoundry->RegisterAllLayouts();  //set initial pagelayout in story for parsing pagelayout- LwpDivInfo\* pDivInfo = static\_cast<LwpDivInfo\*> (m\_DivInfo.obj( VO\_DIVISIONINFO));+ LwpDivInfo\* pDivInfo = dynamic\_cast<LwpDivInfo\*> (m\_DivInfo.obj( VO\_DIVISIONINFO)); LwpPageLayout\* pPageLayout = NULL; if(pDivInfo) {- pPageLayout =static\_cast<LwpPageLayout\*>(pDivInfo->GetInitialLayoutID()->obj(VO\_PAGELAYOUT));+ pPageLayout = dynamic\_cast<LwpPageLayout\*>(pDivInfo->GetInitialLayoutID()->obj(VO\_PAGELAYOUT)); if(pPageLayout) { //In Ole division, the content of pagelayout is VO\_OLEOBJECT- LwpStory\* pStory = static\_cast<LwpStory\*>(pPageLayout->GetContent()->obj(VO\_STORY));+ LwpStory\* pStory = dynamic\_cast<LwpStory\*>(pPageLayout->GetContent()->obj(VO\_STORY)); if(pStory) { //add all the pagelayout in order into the pagelayout list;@@ -277,16 +277,16 @@ void LwpDocument::RegisterLayoutStyles() void LwpDocument::RegisterStylesInPara() { //Register all automatic styles in para- LwpHeadContent\* pContent = static\_cast<LwpHeadContent\*> (m\_pFoundry->GetContentManager()->GetContentList()->obj());+ LwpHeadContent\* pContent = dynamic\_cast<LwpHeadContent\*> (m\_pFoundry->GetContentManager()->GetContentList()->obj()); if(pContent) {- LwpStory\* pStory = static\_cast<LwpStory\*>(pContent->GetChildHead()->obj(VO\_STORY));+ LwpStory\* pStory = dynamic\_cast<LwpStory\*>(pContent->GetChildHead()->obj(VO\_STORY)); while(pStory) { //Register the child para pStory->SetFoundry(m\_pFoundry); pStory->RegisterStyle();- pStory = static\_cast<LwpStory\*>(pStory->GetNext()->obj(VO\_STORY));+ pStory = dynamic\_cast<LwpStory\*>(pStory->GetNext()->obj(VO\_STORY)); } } }@@ -296,17 +296,17 @@ void LwpDocument::RegisterStylesInPara() void LwpDocument::RegisterBulletStyles() { //Register bullet styles- LwpDLVListHeadHolder\* mBulletHead = static\_cast<LwpDLVListHeadHolder\*>+ LwpDLVListHeadHolder\* mBulletHead = dynamic\_cast<LwpDLVListHeadHolder\*> (m\_pFoundry->GetBulletManagerID()->obj(VO\_HEADHOLDER)); if( mBulletHead ) {- LwpSilverBullet\* pBullet = static\_cast<LwpSilverBullet\*>+ LwpSilverBullet\* pBullet = dynamic\_cast<LwpSilverBullet\*> (mBulletHead->GetHeadID()->obj()); while(pBullet) { pBullet->SetFoundry(m\_pFoundry); pBullet->RegisterStyle();- pBullet = static\_cast<LwpSilverBullet\*> (pBullet->GetNext()->obj());+ pBullet = dynamic\_cast<LwpSilverBullet\*> (pBullet->GetNext()->obj()); } } }@@ -341,7 +341,7 @@ void LwpDocument::RegisterFootnoteStyles() //Register footnote and endnote configuration for the entire document if(!m\_FootnoteOpts.IsNull()) {- LwpFootnoteOptions\* pFootnoteOpts = static\_cast<LwpFootnoteOptions\*>(m\_FootnoteOpts.obj());+ LwpFootnoteOptions\* pFootnoteOpts = dynamic\_cast<LwpFootnoteOptions\*>(m\_FootnoteOpts.obj()); if (pFootnoteOpts) { pFootnoteOpts->SetMasterPage(A2OUSTR("Endnote"));@@ -353,13 +353,13 @@ void LwpDocument::RegisterFootnoteStyles() LwpDocument\* pEndnoteDiv = GetLastDivisionThatHasEndnote(); if(this == pEndnoteDiv) {- LwpDLVListHeadTailHolder\* pHeadTail = static\_cast<LwpDLVListHeadTailHolder\*>(GetPageHintsID()->obj());+ LwpDLVListHeadTailHolder\* pHeadTail = dynamic\_cast<LwpDLVListHeadTailHolder\*>(GetPageHintsID()->obj()); if(pHeadTail) {- LwpPageHint\* pPageHint =static\_cast<LwpPageHint\*>(pHeadTail->GetTail()->obj());+ LwpPageHint\* pPageHint = dynamic\_cast<LwpPageHint\*>(pHeadTail->GetTail()->obj()); if(pPageHint && !pPageHint->GetPageLayoutID()->IsNull()) {- LwpPageLayout\* pPageLayout = static\_cast<LwpPageLayout\*>(pPageHint->GetPageLayoutID()->obj());+ LwpPageLayout\* pPageLayout = dynamic\_cast<LwpPageLayout\*>(pPageHint->GetPageLayoutID()->obj()); if(pPageLayout) { pPageLayout->SetFoundry(GetFoundry());@@ -383,7 +383,7 @@ void LwpDocument::RegisterDefaultParaStyles() LwpDocument\* pFirstDoc = GetFirstDivisionWithContentsThatIsNotOLE(); if(pFirstDoc) {- LwpVerDocument\* pVerDoc = static\_cast<LwpVerDocument\*>(pFirstDoc->GetVerDoc()->obj());+ LwpVerDocument\* pVerDoc = dynamic\_cast<LwpVerDocument\*>(pFirstDoc->GetVerDoc()->obj()); if(pVerDoc) { pVerDoc->RegisterStyle();@@ -400,7 +400,7 @@ void LwpDocument::RegisterDefaultParaStyles() void LwpDocument::ParseDocContent(IXFStream\* pOutputStream) { //Parse content in PageLayout- LwpDivInfo\* pDivInfo = static\_cast<LwpDivInfo\*> (m\_DivInfo.obj());+ LwpDivInfo\* pDivInfo = dynamic\_cast<LwpDivInfo\*> (m\_DivInfo.obj()); if(pDivInfo==NULL) return;  LwpObject\* pLayoutObj = pDivInfo->GetInitialLayoutID()->obj();@@ -419,7 +419,7 @@ void LwpDocument::ParseDocContent(IXFStream\* pOutputStream) \*/ void LwpDocument::ParseMasterDoc(IXFStream\* pOutputStream) {- LwpDivInfo\* pDivInfo = static\_cast<LwpDivInfo\*> (m\_DivInfo.obj());+ LwpDivInfo\* pDivInfo = dynamic\_cast<LwpDivInfo\*> (m\_DivInfo.obj()); if(pDivInfo==NULL) return; LwpAtomHolder\* pExternal = pDivInfo->GetExternalName(); if(pExternal && pExternal->HasValue())@@ -450,7 +450,7 @@ LwpObjectID\* LwpDocument::GetValidFootnoteOpts() \*/ sal\_uInt16 LwpDocument::GetEndnoteType() {- LwpDivInfo\* pDivInfo =static\_cast<LwpDivInfo\*>(GetDivInfoID()->obj());+ LwpDivInfo\* pDivInfo = dynamic\_cast<LwpDivInfo\*>(GetDivInfoID()->obj()); if (!pDivInfo) return FN\_DONTCARE; OUString strClassName = pDivInfo->GetClassName();@@ -467,10 +467,10 @@ sal\_uInt16 LwpDocument::GetEndnoteType() \*/ LwpDocument\* LwpDocument::GetPreviousDivision() {- LwpDocSock\* pDocSock = static\_cast<LwpDocSock\*>(GetSocket()->obj());+ LwpDocSock\* pDocSock = dynamic\_cast<LwpDocSock\*>(GetSocket()->obj()); if(pDocSock) {- return static\_cast<LwpDocument\*>(pDocSock->GetPrevious()->obj());+ return dynamic\_cast<LwpDocument\*>(pDocSock->GetPrevious()->obj()); } return NULL; }@@ -479,10 +479,10 @@ LwpDocument\* LwpDocument::GetPreviousDivision() \*/ LwpDocument\* LwpDocument::GetNextDivision() {- LwpDocSock\* pDocSock = static\_cast<LwpDocSock\*>(GetSocket()->obj());+ LwpDocSock\* pDocSock = dynamic\_cast<LwpDocSock\*>(GetSocket()->obj()); if(pDocSock) {- return static\_cast<LwpDocument\*>(pDocSock->GetNext()->obj());+ return dynamic\_cast<LwpDocument\*>(pDocSock->GetNext()->obj()); } return NULL; }@@ -491,10 +491,10 @@ LwpDocument\* LwpDocument::GetPreviousDivision() \*/ LwpDocument\* LwpDocument::GetParentDivision() {- LwpDocSock\* pDocSock = static\_cast<LwpDocSock\*>(GetSocket()->obj());+ LwpDocSock\* pDocSock = dynamic\_cast<LwpDocSock\*>(GetSocket()->obj()); if(pDocSock) {- return static\_cast<LwpDocument\*>(pDocSock->GetParent()->obj());+ return dynamic\_cast<LwpDocument\*>(pDocSock->GetParent()->obj()); } return NULL; }@@ -507,7 +507,7 @@ LwpDocument\* LwpDocument::GetPreviousDivision()  for (pPrev = GetPreviousDivision(); pPrev; pPrev = pPrev->GetPreviousDivision()) {- LwpDivInfo\* pDivInfo =static\_cast<LwpDivInfo\*>(pPrev->GetDivInfoID()->obj());+ LwpDivInfo\* pDivInfo = dynamic\_cast<LwpDivInfo\*>(pPrev->GetDivInfoID()->obj()); if(pDivInfo && pDivInfo->HasContents()) return pPrev; }@@ -522,7 +522,7 @@ LwpDocument\* LwpDocument::GetPreviousDivision()  for (pNext = GetNextDivision(); pNext; pNext = pNext->GetNextDivision()) {- LwpDivInfo\* pDivInfo =static\_cast<LwpDivInfo\*>(pNext->GetDivInfoID()->obj());+ LwpDivInfo\* pDivInfo = dynamic\_cast<LwpDivInfo\*>(pNext->GetDivInfoID()->obj()); if(pDivInfo && pDivInfo->HasContents()) return pNext; }@@ -549,7 +549,7 @@ LwpDocument\* LwpDocument::GetPreviousDivision() \*/ LwpDocument\* LwpDocument::GetLastDivisionWithContents() {- LwpDivInfo\* pDivInfo =static\_cast<LwpDivInfo\*>(GetDivInfoID()->obj());+ LwpDivInfo\* pDivInfo = dynamic\_cast<LwpDivInfo\*>(GetDivInfoID()->obj()); if(pDivInfo && pDivInfo->HasContents()) { return this;@@ -580,7 +580,7 @@ LwpDocument\* LwpDocument::GetPreviousDivision()  while (pNext) {- LwpDivInfo\* pDivInfo =static\_cast<LwpDivInfo\*>(pNext->GetDivInfoID()->obj());+ LwpDivInfo\* pDivInfo = dynamic\_cast<LwpDivInfo\*>(pNext->GetDivInfoID()->obj()); if (pDivInfo && pDivInfo->HasContents()) pLast = pNext; pNext = pNext->GetNextInGroup();@@ -594,9 +594,9 @@ LwpDocument\* LwpDocument::GetPreviousDivision() \*/ LwpDocument\* LwpDocument::GetLastDivision() {- LwpDocSock\* pDocSock = static\_cast<LwpDocSock\*>(GetSocket()->obj());+ LwpDocSock\* pDocSock = dynamic\_cast<LwpDocSock\*>(GetSocket()->obj()); if(pDocSock)- return static\_cast<LwpDocument\*>(pDocSock->GetChildTail()->obj());+ return dynamic\_cast<LwpDocument\*>(pDocSock->GetChildTail()->obj()); return NULL; } @@ -605,9 +605,9 @@ LwpDocument\* LwpDocument::GetPreviousDivision() \*/ LwpDocument\* LwpDocument::GetFirstDivision() {- LwpDocSock\* pDocSock = static\_cast<LwpDocSock\*>(GetSocket()->obj());+ LwpDocSock\* pDocSock = dynamic\_cast<LwpDocSock\*>(GetSocket()->obj()); if(pDocSock)- return static\_cast<LwpDocument\*>(pDocSock->GetChildHead()->obj());+ return dynamic\_cast<LwpDocument\*>(pDocSock->GetChildHead()->obj()); return NULL; } @@ -630,7 +630,7 @@ LwpDocument\* LwpDocument::GetPreviousDivision() \*/ LwpDocument\* LwpDocument::GetFirstDivisionWithContentsThatIsNotOLE() {- LwpDivInfo\* pDivInfo =static\_cast<LwpDivInfo\*>(GetDivInfoID()->obj());+ LwpDivInfo\* pDivInfo = dynamic\_cast<LwpDivInfo\*>(GetDivInfoID()->obj()); if(pDivInfo && pDivInfo->HasContents() && !pDivInfo->IsOleDivision()) return this;@@ -669,7 +669,7 @@ LwpDocument\* LwpDocument::GetPreviousDivision() \*/ LwpVirtualLayout\* LwpDocument::GetEnSuperTableLayout() {- LwpHeadLayout\* pHeadLayout =static\_cast<LwpHeadLayout\*>(GetFoundry()->GetLayout()->obj());+ LwpHeadLayout\* pHeadLayout = dynamic\_cast<LwpHeadLayout\*>(GetFoundry()->GetLayout()->obj()); if(pHeadLayout) { return pHeadLayout->FindEnSuperTableLayout();@@ -685,7 +685,7 @@ LwpDocument\* LwpDocument::GetPreviousDivision() if(this == pEndDivision) return sal\_True; - LwpDivInfo\* pDivInfo = static\_cast<LwpDivInfo\*>(m\_DivInfo.obj());+ LwpDivInfo\* pDivInfo = dynamic\_cast<LwpDivInfo\*>(m\_DivInfo.obj()); if(pDivInfo) { pDivInfo->GetNumberOfPages(nCount);@@ -728,7 +728,7 @@ sal\_uInt16 LwpDocument::GetNumberOfPagesBefore() { LwpDocument\* pDivision = GetFirstDivision(); - LwpDivInfo\* pDivInfo = static\_cast<LwpDivInfo\*>(m\_DivInfo.obj());+ LwpDivInfo\* pDivInfo = dynamic\_cast<LwpDivInfo\*>(m\_DivInfo.obj()); if(pDivInfo) nNumPages += pDivInfo->GetMaxNumberOfPages(); while(pDivision)@@ -761,13 +761,13 @@ void LwpDocument::XFConvertFrameInPage(XFContentContainer \* pCont) { LwpDocument\* pDivision = GetFirstDivision(); - LwpDivInfo\* pDivInfo = static\_cast<LwpDivInfo\*> (GetDivInfoID()->obj());+ LwpDivInfo\* pDivInfo = dynamic\_cast<LwpDivInfo\*> (GetDivInfoID()->obj()); if(pDivInfo) {- LwpPageLayout\* pPageLayout =static\_cast<LwpPageLayout\*>(pDivInfo->GetInitialLayoutID()->obj());+ LwpPageLayout\* pPageLayout = dynamic\_cast<LwpPageLayout\*>(pDivInfo->GetInitialLayoutID()->obj()); if(pPageLayout) {- LwpStory\* pStory = static\_cast<LwpStory\*>(pPageLayout->GetContent()->obj());+ LwpStory\* pStory = dynamic\_cast<LwpStory\*>(pPageLayout->GetContent()->obj()); if(pStory) pStory->XFConvertFrameInPage(pCont); }@@ -784,7 +784,7 @@ void LwpDocument::XFConvertFrameInPage(XFContentContainer \* pCont) void LwpDocument::ChangeStyleName() { XFStyleManager\* pXFStyleManager = LwpGlobalMgr::GetInstance()->GetXFStyleManager();- XFTextStyle\* pStyle = static\_cast<XFTextStyle\*>(pXFStyleManager->FindStyle(A2OUSTR("ClickHere")));+ XFTextStyle\* pStyle = dynamic\_cast<XFTextStyle\*>(pXFStyleManager->FindStyle(A2OUSTR("ClickHere"))); if (pStyle) { pStyle->SetStyleName(A2OUSTR("Placeholder"));diff --git a/lotuswordpro/source/filter/lwpdoc.hxx b/lotuswordpro/source/filter/lwpdoc.hxxindex 1ed45d3dc..fdceee715 100644--- a/[lotuswordpro/source/filter/lwpdoc.hxx](/libreoffice/filters/tree/lotuswordpro/source/filter/lwpdoc.hxx?id=03894d18889d7bc79b3d4f000c0df7065ea81ee2)+++ b/[lotuswordpro/source/filter/lwpdoc.hxx](/libreoffice/filters/tree/lotuswordpro/source/filter/lwpdoc.hxx?id=278831e37a23e9e2e29ca811c3a5398b7c67464d)@@ -89,6 +89,8 @@ public: ~LwpDocument();  private:+ LwpFoundry\* m\_pOwnedFoundry;+ //Data members in file format LwpObjectID m\_DocSockID; sal\_uInt16 m\_nFlags;@@ -185,7 +187,7 @@ private: void MaxNumberOfPages(sal\_uInt16& nNumPages); void XFConvertFrameInPage(XFContentContainer\* pCont); void ChangeStyleName();- sal\_Bool IsSkippedDivision();//add by+ sal\_Bool IsSkippedDivision(); };  inline sal\_Bool LwpDocument::IsChildDoc()diff --git a/lotuswordpro/source/filter/lwpfilter.cxx b/lotuswordpro/source/filter/lwpfilter.cxxindex 7701a600a..37db2dd3f 100644--- a/[lotuswordpro/source/filter/lwpfilter.cxx](/libreoffice/filters/tree/lotuswordpro/source/filter/lwpfilter.cxx?id=03894d18889d7bc79b3d4f000c0df7065ea81ee2)+++ b/[lotuswordpro/source/filter/lwpfilter.cxx](/libreoffice/filters/tree/lotuswordpro/source/filter/lwpfilter.cxx?id=278831e37a23e9e2e29ca811c3a5398b7c67464d)@@ -82,6 +82,8 @@ #include <tools/stream.hxx> #include <sfx2/docfile.hxx> +#include <boost/scoped\_ptr.hpp>+ using namespace ::cppu; using namespace ::com::sun::star::lang; using namespace ::com::sun::star::frame;@@ -109,31 +111,19 @@ LWPFilterReader::~LWPFilterReader() sal\_Bool LWPFilterReader::filter( const Sequence< PropertyValue >& aDescriptor ) throw( RuntimeException ) {- uno::Reference< XInputStream> xInputStream;- ::rtl::OUString sURL;+ ::rtl::OUString sURL; for( sal\_Int32 i = 0; i < aDescriptor.getLength(); i++ ) {- if( aDescriptor[i].Name == OUString(RTL\_CONSTASCII\_USTRINGPARAM("InputStream")) )- aDescriptor[i].Value >>= xInputStream;+ //Note we should attempt to use "InputStream" if it exists first! if( aDescriptor[i].Name == OUString(RTL\_CONSTASCII\_USTRINGPARAM("URL")) ) aDescriptor[i].Value >>= sURL; } - if ( !xInputStream.is() )- {- OSL\_ASSERT( 0 );- return sal\_False;- }-- OString sFileName;- sFileName = ::rtl::OUStringToOString(sURL, RTL\_TEXTENCODING\_INFO\_ASCII);- SvFileStream inputStream( sURL, STREAM\_READ ); if ( inputStream.IsEof() || ( inputStream.GetError() != SVSTREAM\_OK ) ) return sal\_False; -- return (ReadWordproFile( &inputStream ,m\_DocumentHandler) == 0);+ return (ReadWordproFile(inputStream, m\_DocumentHandler) == 0); }  void LWPFilterReader::cancel() throw (com::sun::star::uno::RuntimeException)@@ -332,41 +322,39 @@ Sequence< OUString> LWPFilterImportFilter::getSupportedServiceNames( void ) thro #include "bento.hxx" using namespace OpenStormBento; #include "explode.hxx"- sal\_Bool Decompress(SvStream \*pCompressed, SvStream \* & pDecompressed)+ sal\_Bool Decompress(SvStream \*pCompressed, SvStream \* & pOutDecompressed) { pCompressed->Seek(0);- pDecompressed = new SvMemoryStream(4096, 4096);+ std::auto\_ptr<SvStream> aDecompressed(new SvMemoryStream(4096, 4096)); unsigned char buffer[512]; pCompressed->Read(buffer, 16);- pDecompressed->Write(buffer, 16);+ aDecompressed->Write(buffer, 16); - LwpSvStream \* pLwpStream = new LwpSvStream(pCompressed);+ boost::scoped\_ptr<LwpSvStream> aLwpStream(new LwpSvStream(pCompressed)); LtcBenContainer\* pBentoContainer;- /\*ULONG ulRet = \*/ BenOpenContainer(pLwpStream, &pBentoContainer);- LtcUtBenValueStream \* pWordProData = (LtcUtBenValueStream \*)pBentoContainer->FindValueStreamWithPropertyName("WordProData");+ sal\_uLong ulRet = BenOpenContainer(aLwpStream.get(), &pBentoContainer);+ if (ulRet != BenErr\_OK)+ return sal\_False;++ boost::scoped\_ptr<LtcUtBenValueStream> aWordProData((LtcUtBenValueStream \*)pBentoContainer->FindValueStreamWithPropertyName("WordProData"));++ if (!aWordProData.get())+ return sal\_False;  // decompressing- Decompression decompress(pWordProData, pDecompressed);+ Decompression decompress(aWordProData.get(), aDecompressed.get()); if (0!= decompress.explode())- {- delete pDecompressed;- pDecompressed = NULL;- delete pWordProData;- delete pLwpStream; return sal\_False;- } - sal\_uInt32 nPos = pWordProData->GetSize();+ sal\_uInt32 nPos = aWordProData->GetSize(); nPos += 0x10;  pCompressed->Seek(nPos); while (sal\_uInt32 iRead = pCompressed->Read(buffer, 512))- {- pDecompressed->Write(buffer, iRead);- }+ aDecompressed->Write(buffer, iRead); - delete pWordProData;- delete pLwpStream;+ //transfer ownership of aDecompressed's ptr+ pOutDecompressed = aDecompressed.release(); return sal\_True; } @@ -410,40 +398,38 @@ using namespace OpenStormBento; } return bCompressed; }-int ReadWordproFile(SvStream\* pStream, uno::Reference<XDocumentHandler>& xHandler)+int ReadWordproFile(SvStream &rStream, uno::Reference<XDocumentHandler>& xHandler) { try {- LwpSvStream \*pLwpSvStream = NULL;- SvStream \* pDecompressed = NULL;- if ( GetLwpSvStream(pStream, pLwpSvStream) && pLwpSvStream)+ LwpSvStream \*pRawLwpSvStream = NULL;+ boost::scoped\_ptr<LwpSvStream> aLwpSvStream;+ boost::scoped\_ptr<LwpSvStream> aCompressedLwpSvStream;+ boost::scoped\_ptr<SvStream> aDecompressed;+ if (GetLwpSvStream(&rStream, pRawLwpSvStream) && pRawLwpSvStream) {- pDecompressed = pLwpSvStream->GetStream();+ SvStream \*pDecompressed = pRawLwpSvStream->GetStream();+ if (pDecompressed)+ {+ aDecompressed.reset(pDecompressed);+ aCompressedLwpSvStream.reset(pRawLwpSvStream->GetCompressedStream());+ } }- if (!pLwpSvStream)++ if (!pRawLwpSvStream) { // nothing returned, fail when uncompressing return 1; } - IXFStream \*pStrm = new XFSaxStream(xHandler);- Lwp9Reader reader(pLwpSvStream, pStrm);+ aLwpSvStream.reset(pRawLwpSvStream);++ boost::scoped\_ptr<IXFStream> pStrm(new XFSaxStream(xHandler));+ Lwp9Reader reader(aLwpSvStream.get(), pStrm.get()); //Reset all static objects,because this function may be called many times. XFGlobalReset(); reader.Read(); - // added by-- if (pDecompressed)- {- delete pDecompressed;- LwpSvStream \* pTemp = pLwpSvStream->GetCompressedStream();- delete pTemp;- }- delete pLwpSvStream;- // end added by-- delete pStrm; return 0; } catch (...)diff --git a/lotuswordpro/source/filter/lwpfilter.hxx b/lotuswordpro/source/filter/lwpfilter.hxxindex ebd0fd417..866d3a010 100644--- a/[lotuswordpro/source/filter/lwpfilter.hxx](/libreoffice/filters/tree/lotuswordpro/source/filter/lwpfilter.hxx?id=03894d18889d7bc79b3d4f000c0df7065ea81ee2)+++ b/[lotuswordpro/source/filter/lwpfilter.hxx](/libreoffice/filters/tree/lotuswordpro/source/filter/lwpfilter.hxx?id=278831e37a23e9e2e29ca811c3a5398b7c67464d)@@ -174,9 +174,8 @@ public: uno::Reference< XImporter > rImporter; }; -int ReadWordproFile(String& strName,uno::Reference<XDocumentHandler>& XDoc); //test code-int ReadWordproFile(SvStream\* pStream, uno::Reference<XDocumentHandler>& XDoc);+int ReadWordproFile(SvStream &rStream, uno::Reference<XDocumentHandler>& XDoc);  #endif diff --git a/lotuswordpro/source/filter/lwpfont.cxx b/lotuswordpro/source/filter/lwpfont.cxxindex 4e2903b34..cc28d0662 100644--- a/[lotuswordpro/source/filter/lwpfont.cxx](/libreoffice/filters/tree/lotuswordpro/source/filter/lwpfont.cxx?id=03894d18889d7bc79b3d4f000c0df7065ea81ee2)+++ b/[lotuswordpro/source/filter/lwpfont.cxx](/libreoffice/filters/tree/lotuswordpro/source/filter/lwpfont.cxx?id=278831e37a23e9e2e29ca811c3a5398b7c67464d)@@ -247,7 +247,8 @@ void LwpFontTableEntry::RegisterFontDecl() }  LwpFontTable::LwpFontTable()- : m\_pFontEntries(NULL)+ : m\_nCount(0)+ , m\_pFontEntries(NULL) {}  void LwpFontTable::Read(LwpObjectStream \*pStrm)@@ -267,10 +268,8 @@ void LwpFontTable::Read(LwpObjectStream \*pStrm)  OUString LwpFontTable::GetFaceName(sal\_uInt16 index) //index: start from 1 {- assert(index>0);- if (index < 1)//add for fix crash- return OUString();- return m\_pFontEntries[index-1].GetFaceName();+ assert(index <= m\_nCount && index > 0);+ return (index <= m\_nCount && index > 0) ? m\_pFontEntries[index-1].GetFaceName() : OUString(); }  LwpFontTable::~LwpFontTable()@@ -398,7 +397,9 @@ void LwpFontNameManager::Read(LwpObjectStream \*pStrm) void LwpFontNameManager::Override(sal\_uInt16 index, XFFont\* pFont) //index: start from 1 {- if(index<1) return;+ if (index > m\_nCount || index < 1)+ return ;+ m\_pFontNames[index-1].Override(pFont); if(m\_pFontNames[index-1].IsFaceNameOverridden()) pFont->SetFontName(m\_FontTbl.GetFaceName(m\_pFontNames[index-1].GetFaceID()));@@ -436,7 +437,9 @@ void LwpFontAttrManager::Read(LwpObjectStream \*pStrm) { void LwpFontAttrManager::Override(sal\_uInt16 index, XFFont\* pFont) //index: start from 1 {- if(index<1) return;+ if (index > m\_nCount || index < 1)+ return ;+ m\_pFontAttrs[index-1].Override(pFont); } diff --git a/lotuswordpro/source/filter/lwpfootnote.cxx b/lotuswordpro/source/filter/lwpfootnote.cxxindex be3888d05..b9af6dae5 100644--- a/[lotuswordpro/source/filter/lwpfootnote.cxx](/libreoffice/filters/tree/lotuswordpro/source/filter/lwpfootnote.cxx?id=03894d18889d7bc79b3d4f000c0df7065ea81ee2)+++ b/[lotuswordpro/source/filter/lwpfootnote.cxx](/libreoffice/filters/tree/lotuswordpro/source/filter/lwpfootnote.cxx?id=278831e37a23e9e2e29ca811c3a5398b7c67464d)@@ -141,7 +141,7 @@ void LwpFribFootnote::XFConvert(XFContentContainer\* pCont) \*/ LwpFootnote\* LwpFribFootnote::GetFootnote() {- return static\_cast<LwpFootnote\*>(m\_Footnote.obj());+ return dynamic\_cast<LwpFootnote\*>(m\_Footnote.obj()); }  @@ -211,7 +211,7 @@ LwpCellLayout\* LwpFootnote::GetCellLayout() LwpRowLayout\* pRowLayout = pTableLayout->GetRowLayout(m\_nRow); if(pRowLayout) {- return static\_cast<LwpCellLayout\*>(pRowLayout->GetChildHead()->obj());+ return dynamic\_cast<LwpCellLayout\*>(pRowLayout->GetChildHead()->obj()); } } }@@ -410,7 +410,7 @@ LwpTable\* LwpFootnote::GetFootnoteTable(LwpEnSuperTableLayout \* pLayout) { LwpEndnoteLayout\* pEndnoteLayout = static\_cast<LwpEndnoteLayout\*>(pLayout->GetMainTableLayout()); if(pEndnoteLayout)- return static\_cast<LwpTable\*>(pEndnoteLayout->GetContent()->obj());+ return dynamic\_cast<LwpTable\*>(pEndnoteLayout->GetContent()->obj()); } return NULL; }@@ -420,7 +420,7 @@ LwpTable\* LwpFootnote::GetFootnoteTable(LwpEnSuperTableLayout \* pLayout) \*/ LwpContent\* LwpFootnote::FindFootnoteContent() {- LwpContent\* pContent = static\_cast<LwpContent\*>(m\_Content.obj());+ LwpContent\* pContent = dynamic\_cast<LwpContent\*>(m\_Content.obj()); //if the content has layout, the content has footnote contents; //or looking for the celllayout and return the footnote contents. if(pContent && pContent->GetLayout(NULL))@@ -429,7 +429,7 @@ LwpContent\* LwpFootnote::FindFootnoteContent() LwpCellLayout\* pCellLayout = GetCellLayout(); if(pCellLayout) {- pContent =static\_cast<LwpContent\*>(pCellLayout->GetContent()->obj());+ pContent = dynamic\_cast<LwpContent\*>(pCellLayout->GetContent()->obj()); }  return pContent;diff --git a/lotuswordpro/source/filter/lwpfoundry.cxx b/lotuswordpro/source/filter/lwpfoundry.cxxindex e009f18e4..875446999 100644--- a/[lotuswordpro/source/filter/lwpfoundry.cxx](/libreoffice/filters/tree/lotuswordpro/source/filter/lwpfoundry.cxx?id=03894d18889d7bc79b3d4f000c0df7065ea81ee2)+++ b/[lotuswordpro/source/filter/lwpfoundry.cxx](/libreoffice/filters/tree/lotuswordpro/source/filter/lwpfoundry.cxx?id=278831e37a23e9e2e29ca811c3a5398b7c67464d)@@ -75,7 +75,10 @@ #include "lwpglobalmgr.hxx"  LwpFoundry::LwpFoundry(LwpObjectStream \*pStrm, LwpDocument\* pDoc)- : m\_pDoc(pDoc), m\_pPieceMgr(NULL), m\_pStyleMgr(NULL)+ : m\_pDoc(pDoc)+ , m\_bRegisteredAll(false)+ , m\_pPieceMgr(NULL)+ , m\_pStyleMgr(NULL) { Read(pStrm); m\_pDropcapMgr = new LwpDropcapMgr;@@ -184,6 +187,14 @@ void LwpFoundry::ReadStyles(LwpObjectStream \*pStrm)  void LwpFoundry::RegisterAllLayouts() {+ if (m\_bRegisteredAll)+ {+ OSL\_FAIL("recursive LwpFoundry::RegisterAllLayouts!\n");+ return;+ }++ m\_bRegisteredAll = true;+ //Register CellStyle LwpObject\* pStyle = m\_CellStyle.obj(); if( pStyle )@@ -193,7 +204,7 @@ void LwpFoundry::RegisterAllLayouts() }  //register content page layout list: Layout- pStyle = m\_Layout.obj();+ pStyle = m\_Layout.obj(); if( pStyle ) { pStyle->SetFoundry(this);diff --git a/lotuswordpro/source/filter/lwpfoundry.hxx b/lotuswordpro/source/filter/lwpfoundry.hxxindex 563c68912..e10b6c1b7 100644--- a/[lotuswordpro/source/filter/lwpfoundry.hxx](/libreoffice/filters/tree/lotuswordpro/source/filter/lwpfoundry.hxx?id=03894d18889d7bc79b3d4f000c0df7065ea81ee2)+++ b/[lotuswordpro/source/filter/lwpfoundry.hxx](/libreoffice/filters/tree/lotuswordpro/source/filter/lwpfoundry.hxx?id=278831e37a23e9e2e29ca811c3a5398b7c67464d)@@ -221,6 +221,7 @@ public: void RegisterAllLayouts(); private: LwpDocument\* m\_pDoc;+ bool m\_bRegisteredAll; private: //file members LwpVersionManager m\_VerMgr; LwpObjectManager m\_ObjMgr;diff --git a/lotuswordpro/source/filter/lwpframelayout.cxx b/lotuswordpro/source/filter/lwpframelayout.cxxindex 6f427afad..efc863f1f 100644--- a/[lotuswordpro/source/filter/lwpframelayout.cxx](/libreoffice/filters/tree/lotuswordpro/source/filter/lwpframelayout.cxx?id=03894d18889d7bc79b3d4f000c0df7065ea81ee2)+++ b/[lotuswordpro/source/filter/lwpframelayout.cxx](/libreoffice/filters/tree/lotuswordpro/source/filter/lwpframelayout.cxx?id=278831e37a23e9e2e29ca811c3a5398b7c67464d)@@ -888,11 +888,16 @@ OUString LwpFrameLayout::GetNextLinkName() LwpObjectID\* pObjectID = m\_Link.GetNextLayout(); if(!pObjectID->IsNull()) {- LwpLayout\* pLayout = static\_cast<LwpLayout\*>(pObjectID->obj());- aName = pLayout->GetName()->str();- //for division name confict- if(pLayout->GetStyleName().getLength() > 0)- aName = pLayout->GetStyleName();+ LwpLayout\* pLayout = dynamic\_cast<LwpLayout\*>(pObjectID->obj());+ if (pLayout)+ {+ LwpAtomHolder \*pHolder = pLayout->GetName();+ if (pHolder)+ aName = pHolder->str();+ //for division name confict+ if(pLayout->GetStyleName().getLength() > 0)+ aName = pLayout->GetStyleName();+ } } return aName; }diff --git a/lotuswordpro/source/filter/lwpfrib.cxx b/lotuswordpro/source/filter/lwpfrib.cxxindex 583eab525..ad9dbc0aa 100644--- a/[lotuswordpro/source/filter/lwpfrib.cxx](/libreoffice/filters/tree/lotuswordpro/source/filter/lwpfrib.cxx?id=03894d18889d7bc79b3d4f000c0df7065ea81ee2)+++ b/[lotuswordpro/source/filter/lwpfrib.cxx](/libreoffice/filters/tree/lotuswordpro/source/filter/lwpfrib.cxx?id=278831e37a23e9e2e29ca811c3a5398b7c67464d)@@ -337,26 +337,33 @@ void LwpFrib::RegisterStyle(LwpFoundry\* pFoundry)  void LwpFrib::ReadModifiers(LwpObjectStream\* pObjStrm,ModifierInfo\* pModInfo) {- sal\_uInt8 Modifier;- sal\_uInt8 len;-// sal\_Bool ModifyFlag = sal\_False;- for(;;) {+ sal\_uInt8 Modifier(0);+ sal\_uInt8 len(0);+ // Get the modifier type- pObjStrm->QuickRead(&Modifier, sizeof(Modifier));+ if (pObjStrm->QuickRead(&Modifier, sizeof(Modifier)) != sizeof(Modifier))+ break;  // Stop when we hit the last modifier if (Modifier == FRIB\_MTAG\_NONE) break;-// ModifyFlag = sal\_True;+ // Get the modifier length- pObjStrm->QuickRead(&len, sizeof(len));+ if (pObjStrm->QuickRead(&len, sizeof(len)) != sizeof(len))+ break;  switch (Modifier) { case FRIB\_MTAG\_FONT:- pObjStrm->QuickRead(&pModInfo->FontID,len);+ if (len > sizeof(pModInfo->FontID))+ {+ OSL\_FAIL("FRIB\_MTAG\_FONT entry wrong size\n");+ pObjStrm->SeekRel(len);+ }+ else+ pObjStrm->QuickRead(&pModInfo->FontID,len); break; case FRIB\_MTAG\_CHARSTYLE: pModInfo->HasCharStyle = sal\_True;@@ -367,15 +374,19 @@ void LwpFrib::ReadModifiers(LwpObjectStream\* pObjStrm,ModifierInfo\* pModInfo) pModInfo->Language.Read(pObjStrm); break; case FRIB\_MTAG\_CODEPAGE:- pObjStrm->QuickRead(&pModInfo->CodePage,len);+ if (len > sizeof(pModInfo->CodePage))+ {+ OSL\_FAIL("FRIB\_MTAG\_CODEPAGE entry wrong size\n");+ pObjStrm->SeekRel(len);+ }+ else+ pObjStrm->QuickRead(&pModInfo->CodePage,len); break;- //add by , 02/22/2005 case FRIB\_MTAG\_ATTRIBUTE: pModInfo->aTxtAttrOverride.Read(pObjStrm); if (pModInfo->aTxtAttrOverride.IsHighLight()) pModInfo->HasHighLight = sal\_True; break;- //end add case FRIB\_MTAG\_REVISION: pModInfo->RevisionType = pObjStrm->QuickReaduInt8(); pModInfo->RevisionFlag = sal\_True;@@ -385,10 +396,7 @@ void LwpFrib::ReadModifiers(LwpObjectStream\* pObjStrm,ModifierInfo\* pModInfo) break; } // TODO: read the modifier data- // pObjStrm->SeekRel(len);- }- }  //do nothingdiff --git a/lotuswordpro/source/filter/lwpfribframe.cxx b/lotuswordpro/source/filter/lwpfribframe.cxxindex f3fa7a186..e95190e45 100644--- a/[lotuswordpro/source/filter/lwpfribframe.cxx](/libreoffice/filters/tree/lotuswordpro/source/filter/lwpfribframe.cxx?id=03894d18889d7bc79b3d4f000c0df7065ea81ee2)+++ b/[lotuswordpro/source/filter/lwpfribframe.cxx](/libreoffice/filters/tree/lotuswordpro/source/filter/lwpfribframe.cxx?id=278831e37a23e9e2e29ca811c3a5398b7c67464d)@@ -92,14 +92,21 @@ LwpObject\* LwpFribFrame::GetLayout() \*/ void LwpFribFrame::RegisterStyle(LwpFoundry\* pFoundry) {- if (m\_objLayout.obj()->GetTag() == VO\_DROPCAPLAYOUT)+ LwpObject \*pObject = m\_objLayout.obj();++ if (pObject && pObject->GetTag() == VO\_DROPCAPLAYOUT) {- static\_cast<LwpDropcapLayout\*>(m\_objLayout.obj())->RegisterStyle(pFoundry);+ LwpDropcapLayout \*pLayout = dynamic\_cast<LwpDropcapLayout\*>(pObject);+ if (!pLayout)+ return;+ pLayout->RegisterStyle(pFoundry); } else {- //register frame style, , 04/07/2005- LwpPlacableLayout\* pLayout = static\_cast<LwpPlacableLayout\*>(m\_objLayout.obj());+ //register frame style+ LwpPlacableLayout\* pLayout = dynamic\_cast<LwpPlacableLayout\*>(pObject);+ if (!pLayout)+ return; pLayout->SetFoundry(pFoundry); pLayout->RegisterStyle(); @@ -125,10 +132,12 @@ void LwpFribFrame::RegisterStyle(LwpFoundry\* pFoundry) } void LwpFribFrame::SetParaDropcap(LwpPara\* pPara) {- if (m\_objLayout.obj()->GetTag() == VO\_DROPCAPLAYOUT)+ LwpObject \*pObject = m\_objLayout.obj();++ if (pObject && pObject->GetTag() == VO\_DROPCAPLAYOUT) { pPara->SetParaDropcap(sal\_True);- pPara->SetDropcapLayout(static\_cast<LwpDropcapLayout\*>(m\_objLayout.obj()));+ pPara->SetDropcapLayout(dynamic\_cast<LwpDropcapLayout\*>(pObject)); } else pPara->SetParaDropcap(sal\_False);@@ -141,7 +150,9 @@ void LwpFribFrame::SetParaDropcap(LwpPara\* pPara) void LwpFribFrame::XFConvert(XFContentContainer\* pCont) { XFContentContainer\* pXFContentContainer = pCont;- LwpVirtualLayout\* pLayout = static\_cast<LwpVirtualLayout\*>(GetLayout());+ LwpVirtualLayout\* pLayout = dynamic\_cast<LwpVirtualLayout\*>(GetLayout());+ if (!pLayout)+ return; sal\_uInt8 nType = pLayout->GetRelativeType(); if( LwpLayoutRelativityGuts::LAY\_PARA\_RELATIVE == nType) {@@ -232,7 +243,7 @@ void LwpFribRubyFrame::XFConvert(XFContentContainer\* /\*pCont\*/)  LwpRubyLayout\* LwpFribRubyFrame::GetLayout() {- return static\_cast<LwpRubyLayout\*>(m\_objLayout.obj());+ return dynamic\_cast<LwpRubyLayout\*>(m\_objLayout.obj()); }  /\* vim:set shiftwidth=4 softtabstop=4 expandtab: \*/diff --git a/lotuswordpro/source/filter/lwpfribmark.cxx b/lotuswordpro/source/filter/lwpfribmark.cxxindex 3499f7945..3d377a163 100644--- a/[lotuswordpro/source/filter/lwpfribmark.cxx](/libreoffice/filters/tree/lotuswordpro/source/filter/lwpfribmark.cxx?id=03894d18889d7bc79b3d4f000c0df7065ea81ee2)+++ b/[lotuswordpro/source/filter/lwpfribmark.cxx](/libreoffice/filters/tree/lotuswordpro/source/filter/lwpfribmark.cxx?id=278831e37a23e9e2e29ca811c3a5398b7c67464d)@@ -94,7 +94,7 @@ void LwpFribCHBlock::Read(LwpObjectStream\* pObjStrm, sal\_uInt16 /\*len\*/)  LwpCHBlkMarker\* LwpFribCHBlock::GetMarker() {- return static\_cast<LwpCHBlkMarker\*>(m\_objMarker.obj());+ return dynamic\_cast<LwpCHBlkMarker\*>(m\_objMarker.obj()); }  void LwpFribCHBlock::XFConvert(XFContentContainer\* pXFPara,LwpStory\* pStory)@@ -147,7 +147,9 @@ void LwpFribBookMark::RegisterStyle(LwpFoundry\* pFoundry) LwpObjectID\* pID = pDoc->GetDivInfoID(); if (!pID->IsNull()) {- sDivision = static\_cast<LwpDivInfo\*>(pID->obj(VO\_DIVISIONINFO))->GetDivName();+ LwpDivInfo \*pDivInvo = dynamic\_cast<LwpDivInfo\*>(pID->obj(VO\_DIVISIONINFO));+ if (pDivInvo)+ sDivision = pDivInvo->GetDivName(); } } @@ -230,7 +232,7 @@ void LwpFribField::Read(LwpObjectStream\* pObjStrm, sal\_uInt16 /\*len\*/)  LwpFieldMark\* LwpFribField::GetMarker() {- return static\_cast<LwpFieldMark\*>(m\_objMarker.obj());+ return dynamic\_cast<LwpFieldMark\*>(m\_objMarker.obj()); }  void LwpFribField::XFConvert(XFContentContainer\* pXFPara)@@ -1421,7 +1423,7 @@ LwpFribRubyMarker::LwpFribRubyMarker( LwpPara\* pPara ): LwpFrib(pPara)  LwpRubyMarker\* LwpFribRubyMarker::GetMarker() {- return static\_cast<LwpRubyMarker\*>(m\_objMarker.obj(VO\_RUBYMARKER));+ return dynamic\_cast<LwpRubyMarker\*>(m\_objMarker.obj(VO\_RUBYMARKER)); }  void LwpFribRubyMarker::Read(LwpObjectStream\* pObjStrm, sal\_uInt16 /\*len\*/)diff --git a/lotuswordpro/source/filter/lwpfribptr.cxx b/lotuswordpro/source/filter/lwpfribptr.cxxindex 61e31137f..b58e26970 100644--- a/[lotuswordpro/source/filter/lwpfribptr.cxx](/libreoffice/filters/tree/lotuswordpro/source/filter/lwpfribptr.cxx?id=03894d18889d7bc79b3d4f000c0df7065ea81ee2)+++ b/[lotuswordpro/source/filter/lwpfribptr.cxx](/libreoffice/filters/tree/lotuswordpro/source/filter/lwpfribptr.cxx?id=278831e37a23e9e2e29ca811c3a5398b7c67464d)@@ -90,7 +90,8 @@  LwpFribPtr::LwpFribPtr() : m\_pFribs(NULL),m\_pXFPara(NULL),m\_pPara(NULL)-{}+{+}  LwpFribPtr::~LwpFribPtr() {@@ -226,7 +227,7 @@ void LwpFribPtr::XFConvert() case FRIB\_TAG\_PAGEBREAK: { LwpFribPageBreak\* pPageBreak = static\_cast<LwpFribPageBreak\*>(pFrib);- LwpPageLayout\* pLayout = static\_cast<LwpPageLayout\*>(pPageBreak->GetLayout()->obj());+ LwpPageLayout\* pLayout = dynamic\_cast<LwpPageLayout\*>(pPageBreak->GetLayout()->obj()); if(pLayout) { pPageBreak->ParseLayout();@@ -291,13 +292,8 @@ void LwpFribPtr::XFConvert() { LwpFribFrame\* frameFrib= static\_cast<LwpFribFrame\*>(pFrib); LwpObject\* pLayout = frameFrib->GetLayout();- if (pLayout->GetTag() == VO\_DROPCAPLAYOUT)- {+ if (pLayout && pLayout->GetTag() == VO\_DROPCAPLAYOUT) m\_pPara->GetFoundry()->GetDropcapMgr()->SetXFPara(m\_pXFPara);- //LwpObject\* pDropCap = frameFrib->GetLayout();- //pDropCap ->XFConvert(m\_pXFPara);- }- //pLayout->XFConvert(m\_pXFPara); frameFrib->XFConvert(m\_pXFPara); } break;@@ -406,8 +402,9 @@ void LwpFribPtr::FindLayouts() //StartWithinColume type not support now break; }- LwpStory\* pStory = static\_cast<LwpStory\*>(m\_pPara->GetStoryID()->obj());- pStory->AddPageLayout(pSection->GetPageLayout());+ LwpStory\* pStory = dynamic\_cast<LwpStory\*>(m\_pPara->GetStoryID()->obj());+ if (pStory)+ pStory->AddPageLayout(pSection->GetPageLayout()); } } @@ -416,11 +413,12 @@ void LwpFribPtr::FindLayouts() case FRIB\_TAG\_PAGEBREAK: { LwpFribPageBreak\* pPageBreak = static\_cast<LwpFribPageBreak\*>(pFrib);- LwpPageLayout\* pLayout = static\_cast<LwpPageLayout\*>(pPageBreak->GetLayout()->obj());+ LwpPageLayout\* pLayout = dynamic\_cast<LwpPageLayout\*>(pPageBreak->GetLayout()->obj()); if(pLayout) {- LwpStory\* pStory = static\_cast<LwpStory\*>(m\_pPara->GetStoryID()->obj());- pStory->AddPageLayout(pLayout);+ LwpStory\* pStory = dynamic\_cast<LwpStory\*>(m\_pPara->GetStoryID()->obj());+ if (pStory)+ pStory->AddPageLayout(pLayout); } break; }@@ -614,9 +612,9 @@ void LwpFribPtr::ProcessDropcap(LwpStory\* pStory,LwpFrib\* pFrib,sal\_uInt32 nLen) XFTextStyle\* pFribStyle = pXFStyleManager->FindTextStyle(pFrib->GetStyleName()); pFribStyle->GetFont()->SetFontSize(0); - LwpObject\* pObj= pStory->GetLayoutsWithMe()->GetOnlyLayout()->obj();+ LwpDropcapLayout\* pObj = dynamic\_cast<LwpDropcapLayout\*>(pStory->GetLayoutsWithMe()->GetOnlyLayout()->obj()); if (pObj)- static\_cast<LwpDropcapLayout\*>(pObj)->SetChars(nLen);+ pObj->SetChars(nLen); } } }@@ -649,7 +647,7 @@ sal\_Bool LwpFribPtr::ComparePagePosition(LwpVirtualLayout\* pPreLayout, LwpVirtua case FRIB\_TAG\_PAGEBREAK: { LwpFribPageBreak\* pPageBreak = static\_cast<LwpFribPageBreak\*>(pFrib);- pLayout = static\_cast<LwpVirtualLayout\*>(pPageBreak->GetLayout()->obj());+ pLayout = dynamic\_cast<LwpVirtualLayout\*>(pPageBreak->GetLayout()->obj()); break; } default:diff --git a/lotuswordpro/source/filter/lwpgrfobj.cxx b/lotuswordpro/source/filter/lwpgrfobj.cxxindex efc8a0e01..72503aa6a 100644--- a/[lotuswordpro/source/filter/lwpgrfobj.cxx](/libreoffice/filters/tree/lotuswordpro/source/filter/lwpgrfobj.cxx?id=03894d18889d7bc79b3d4f000c0df7065ea81ee2)+++ b/[lotuswordpro/source/filter/lwpgrfobj.cxx](/libreoffice/filters/tree/lotuswordpro/source/filter/lwpgrfobj.cxx?id=278831e37a23e9e2e29ca811c3a5398b7c67464d)@@ -94,6 +94,8 @@ LwpGraphicObject::LwpGraphicObject(LwpObjectHeader &objHdr, LwpSvStream\* pStrm) , m\_bIsLinked(0) , m\_bCompressed(0) {+ memset(m\_sDataFormat, 0, sizeof(m\_sDataFormat));+ memset(m\_sServerContextFormat, 0, sizeof(m\_sServerContextFormat)); } LwpGraphicObject::~LwpGraphicObject() {@@ -207,21 +209,6 @@ void LwpGraphicObject::XFConvert (XFContentContainer\* pCont) { if ((m\_sServerContextFormat[1]=='s'&&m\_sServerContextFormat[2]=='d'&&m\_sServerContextFormat[3]=='w')) {-/\* LwpSvStream\* pStream = m\_pStrm;- //test code- OpenStormBento::LtcBenContainer\* pBentoContainer;- ULONG ulRet = OpenStormBento::BenOpenContainer(pStream, &pBentoContainer);- std::vector<SvStream\*> vStream;- std::vector<SvStream\*>::iterator iter;- pBentoContainer->CreateGraphicStreams(&vStream);- for (iter=vStream.begin();iter!=vStream.end();iter++)- {- LwpSdwFileLoader fileLoader(\*iter,pOutputStream);- fileLoader.LoadObjectList();- delete \*iter;- }- vStream.clear();\*/- //XFParagraph\* pPara = new XFParagraph(); std::vector <XFFrame\*>::iterator iter; for (iter = m\_vXFDrawObjects.begin(); iter != m\_vXFDrawObjects.end(); ++iter)@@ -375,24 +362,7 @@ void LwpGraphicObject::RegisterStyle() { this->CreateGrafObject(); }-/\* if (m\_sServerContextFormat[1]=='s'&&m\_sServerContextFormat[2]=='d'&&m\_sServerContextFormat[3]=='w')- {- LwpSvStream\* pStream = m\_pStrm;- //test code- OpenStormBento::LtcBenContainer\* pBentoContainer;- ULONG ulRet = OpenStormBento::BenOpenContainer(pStream, &pBentoContainer);- std::vector<SvStream\*> vStream;- std::vector<SvStream\*>::iterator iter;- pBentoContainer->CreateGraphicStreams(&vStream);- for (iter=vStream.begin();iter!=vStream.end();iter++)- {- LwpSdwFileLoader fileLoader(\*iter);- fileLoader.RegisterStyle();- delete \*iter;- }- vStream.clear(); - }\*/ if (m\_sServerContextFormat[1]=='l'&&m\_sServerContextFormat[2]=='c'&&m\_sServerContextFormat[3]=='h') { LwpVirtualLayout\* pMyLayout = GetLayout(NULL);@@ -418,7 +388,10 @@ void LwpGraphicObject::CreateDrawObjects() LwpSvStream\* pStream = m\_pStrm->GetCompressedStream() ? m\_pStrm->GetCompressedStream(): m\_pStrm;  OpenStormBento::LtcBenContainer\* pBentoContainer;- /\*ULONG ulRet =\*/ OpenStormBento::BenOpenContainer(pStream, &pBentoContainer);+ sal\_uLong ulRet = OpenStormBento::BenOpenContainer(pStream, &pBentoContainer);+ if (ulRet != OpenStormBento::BenErr\_OK)+ return;+ SvStream\* pDrawObjStream = NULL;  // get graphic object's bento objet name@@ -463,7 +436,10 @@ sal\_uInt32 LwpGraphicObject::GetRawGrafData(sal\_uInt8\*& pGrafData) LwpSvStream\* pStream = m\_pStrm->GetCompressedStream() ? m\_pStrm->GetCompressedStream(): m\_pStrm;  OpenStormBento::LtcBenContainer\* pBentoContainer;- /\*ULONG ulRet =\*/ OpenStormBento::BenOpenContainer(pStream, &pBentoContainer);+ sal\_uLong ulRet = OpenStormBento::BenOpenContainer(pStream, &pBentoContainer);+ if (ulRet != OpenStormBento::BenErr\_OK)+ return 0;+ SvStream\* pGrafStream = NULL;  // get graphic object's bento objet name@@ -503,7 +479,9 @@ sal\_uInt32 LwpGraphicObject::GetGrafData(sal\_uInt8\*& pGrafData) LwpSvStream\* pStream = m\_pStrm->GetCompressedStream() ? m\_pStrm->GetCompressedStream(): m\_pStrm;  OpenStormBento::LtcBenContainer\* pBentoContainer;- /\*ULONG ulRet =\*/ OpenStormBento::BenOpenContainer(pStream, &pBentoContainer);+ sal\_uLong ulRet = OpenStormBento::BenOpenContainer(pStream, &pBentoContainer);+ if (ulRet != OpenStormBento::BenErr\_OK)+ return 0;  SvStream\* pGrafStream = NULL; diff --git a/lotuswordpro/source/filter/lwpidxmgr.cxx b/lotuswordpro/source/filter/lwpidxmgr.cxxindex da9ca4fe3..f4b68c623 100644--- a/[lotuswordpro/source/filter/lwpidxmgr.cxx](/libreoffice/filters/tree/lotuswordpro/source/filter/lwpidxmgr.cxx?id=03894d18889d7bc79b3d4f000c0df7065ea81ee2)+++ b/[lotuswordpro/source/filter/lwpidxmgr.cxx](/libreoffice/filters/tree/lotuswordpro/source/filter/lwpidxmgr.cxx?id=278831e37a23e9e2e29ca811c3a5398b7c67464d)@@ -69,6 +69,7 @@ \*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*/  #include "lwpidxmgr.hxx"+#include "lwptools.hxx"  const sal\_uInt8 LwpIndexManager::MAXOBJECTIDS = 255; @@ -122,8 +123,11 @@ void LwpIndexManager::Read(LwpSvStream\* pStrm) for (sal\_uInt16 k = 0; k < m\_nLeafCount; k++) { //Read leaf- pStrm->Seek(m\_ChildIndex[k]+LwpSvStream::LWP\_STREAM\_BASE);+ sal\_Int64 nPos = m\_ChildIndex[k]+LwpSvStream::LWP\_STREAM\_BASE;+ sal\_Int64 nActualPos = pStrm->Seek(nPos); + if (nPos != nActualPos)+ throw BadSeek();  //Old Code //ReadLeafIndex(pStrm);@@ -150,7 +154,7 @@ void LwpIndexManager::ReadRootData(LwpObjectStream\* pObjStrm)  sal\_uInt16 KeyCount = 0; pObjStrm->QuickRead(&KeyCount, sizeof(KeyCount));- m\_nLeafCount = KeyCount + 1;+ m\_nLeafCount = KeyCount ? KeyCount + 1 : 0;  if(KeyCount) {@@ -160,7 +164,6 @@ void LwpIndexManager::ReadRootData(LwpObjectStream\* pObjStrm) m\_RootObjs.push\_back(akey);  - //sal\_uInt8 k = 0; sal\_uInt16 k = 0;  for (k = 1; k < KeyCount; k++)@@ -216,7 +219,9 @@ void LwpIndexManager::ReadObjIndexData(LwpObjectStream\* pObjStrm) }  for (k = 0; k < KeyCount; k++)+ { pObjStrm->QuickRead(&(vObjIndexs[k]->offset), sizeof(sal\_uInt32));+ }  for (k = 0; k < LeafCount; k++) pObjStrm->QuickRead(&(m\_TempVec[k]), sizeof(sal\_uInt32));@@ -224,7 +229,13 @@ void LwpIndexManager::ReadObjIndexData(LwpObjectStream\* pObjStrm)  for( sal\_uInt16 j=0; j<LeafCount; j++ ) {- pObjStrm->GetStream()->Seek( m\_TempVec[j]+LwpSvStream::LWP\_STREAM\_BASE);+ sal\_Int64 nPos = m\_TempVec[j]+LwpSvStream::LWP\_STREAM\_BASE;+ sal\_Int64 nActualPos = pObjStrm->GetStream()->Seek(nPos);++ if (nPos != nActualPos)+ throw BadSeek();++ ReadLeafIndex(pObjStrm->GetStream());  if(j!=LeafCount-1)@@ -283,7 +294,7 @@ void LwpIndexManager::ReadLeafIndex( LwpSvStream \*pStrm ) \*/ void LwpIndexManager::ReadLeafData( LwpObjectStream \*pObjStrm ) {- sal\_uInt16 KeyCount;+ sal\_uInt16 KeyCount=0; pObjStrm->QuickRead(&KeyCount, sizeof(KeyCount));  if(KeyCount)@@ -296,13 +307,13 @@ void LwpIndexManager::ReadLeafData( LwpObjectStream \*pObjStrm ) for (sal\_uInt8 k = 1; k < KeyCount; k++) { akey = new LwpKey();- akey->id.ReadCompressed(pObjStrm, m\_ObjectKeys[m\_nKeyCount+k-1]->id);+ akey->id.ReadCompressed(pObjStrm, m\_ObjectKeys.at(m\_nKeyCount+k-1)->id); m\_ObjectKeys.push\_back(akey); }  for (sal\_uInt8 j = 0; j < KeyCount; j++) {- pObjStrm->QuickRead(&(m\_ObjectKeys[m\_nKeyCount+j]->offset), sizeof(sal\_uInt32));+ pObjStrm->QuickRead(&(m\_ObjectKeys.at(m\_nKeyCount+j)->offset), sizeof(sal\_uInt32)); } } m\_nKeyCount += KeyCount;diff --git a/lotuswordpro/source/filter/lwplayout.cxx b/lotuswordpro/source/filter/lwplayout.cxxindex 01004894b..f4f3472ce 100644--- a/[lotuswordpro/source/filter/lwplayout.cxx](/libreoffice/filters/tree/lotuswordpro/source/filter/lwplayout.cxx?id=03894d18889d7bc79b3d4f000c0df7065ea81ee2)+++ b/[lotuswordpro/source/filter/lwplayout.cxx](/libreoffice/filters/tree/lotuswordpro/source/filter/lwplayout.cxx?id=278831e37a23e9e2e29ca811c3a5398b7c67464d)@@ -80,7 +80,8 @@  LwpVirtualLayout::LwpVirtualLayout(LwpObjectHeader &objHdr, LwpSvStream\* pStrm) : LwpDLNFPVList(objHdr, pStrm)-{}+{+}  void LwpVirtualLayout::Read() {@@ -138,7 +139,7 @@ sal\_Bool LwpVirtualLayout::HonorProtection() if(!(m\_nAttributes2 & STYLE2\_HONORPROTECTION)) return sal\_False; - LwpVirtualLayout\* pParent = static\_cast<LwpVirtualLayout\*> (GetParent()->obj());+ LwpVirtualLayout\* pParent = dynamic\_cast<LwpVirtualLayout\*> (GetParent()->obj()); if(pParent && !pParent->IsHeader()) { return pParent->HonorProtection();@@ -166,7 +167,7 @@ sal\_Bool LwpVirtualLayout::IsProtected() { sal\_Bool bProtected = (m\_nAttributes & STYLE\_PROTECTED)!=0; - LwpVirtualLayout\* pParent = static\_cast<LwpVirtualLayout\*> (GetParent()->obj());+ LwpVirtualLayout\* pParent = dynamic\_cast<LwpVirtualLayout\*> (GetParent()->obj()); if(pParent && !pParent->IsHeader()) { if(pParent->HonorProtection()&&(pParent->HasProtection()||bProtected))@@ -198,7 +199,7 @@ sal\_Bool LwpVirtualLayout::HasProtection() if(m\_nAttributes & STYLE\_PROTECTED) return sal\_True; - LwpVirtualLayout\* pParent = static\_cast<LwpVirtualLayout\*> (GetParent()->obj());+ LwpVirtualLayout\* pParent = dynamic\_cast<LwpVirtualLayout\*> (GetParent()->obj()); if(pParent && !pParent->IsHeader()) { return pParent->HasProtection();@@ -229,7 +230,7 @@ LwpUseWhen\* LwpVirtualLayout::GetUseWhen() if(GetLayoutType()!=LWP\_PAGE\_LAYOUT) { //get parent- LwpVirtualLayout\* pParent = static\_cast<LwpVirtualLayout\*> (GetParent()->obj());+ LwpVirtualLayout\* pParent = dynamic\_cast<LwpVirtualLayout\*> (GetParent()->obj()); if(pParent && !pParent->IsHeader()&& (pParent->GetLayoutType()!=LWP\_PAGE\_LAYOUT)) return pParent->GetUseWhen(); @@ -341,7 +342,7 @@ sal\_Bool LwpVirtualLayout::IsMinimumHeight() \*/ LwpVirtualLayout\* LwpVirtualLayout::GetParentLayout() {- return static\_cast<LwpVirtualLayout\*> (GetParent()->obj());+ return dynamic\_cast<LwpVirtualLayout\*> (GetParent()->obj()); }  /\*\*@@ -351,12 +352,12 @@ LwpVirtualLayout\* LwpVirtualLayout::GetParentLayout() void LwpVirtualLayout::RegisterChildStyle() { //Register all children styles- LwpVirtualLayout\* pLayout = static\_cast<LwpVirtualLayout\*>(GetChildHead()->obj());+ LwpVirtualLayout\* pLayout = dynamic\_cast<LwpVirtualLayout\*>(GetChildHead()->obj()); while(pLayout) { pLayout->SetFoundry(m\_pFoundry); pLayout->RegisterStyle();- pLayout = static\_cast<LwpVirtualLayout\*>(pLayout->GetNext()->obj());+ pLayout = dynamic\_cast<LwpVirtualLayout\*>(pLayout->GetNext()->obj()); } } @@ -370,7 +371,7 @@ sal\_Bool LwpVirtualLayout::IsStyleLayout() if (m\_nAttributes3 & STYLE3\_STYLELAYOUT) return sal\_True; - LwpVirtualLayout\* pParent =static\_cast<LwpVirtualLayout\*>(GetParent()->obj());+ LwpVirtualLayout\* pParent = dynamic\_cast<LwpVirtualLayout\*>(GetParent()->obj()); if (pParent) return pParent->IsStyleLayout(); return sal\_False;@@ -386,7 +387,7 @@ LwpVirtualLayout\* LwpVirtualLayout::FindChildByType(LWP\_LAYOUT\_TYPE eType)  while(pID && !pID->IsNull()) {- LwpVirtualLayout \* pLayout = static\_cast<LwpVirtualLayout \*>(pID->obj());+ LwpVirtualLayout \* pLayout = dynamic\_cast<LwpVirtualLayout \*>(pID->obj()); if(!pLayout) { break;@@ -446,30 +447,30 @@ LwpVirtualLayout\* LwpAssociatedLayouts::GetLayout(LwpVirtualLayout \*pStartLayout  if (!pStartLayout && !m\_OnlyLayout.IsNull()) /\* Looking for the first layout and there's only one layout in the list.\*/- return static\_cast<LwpVirtualLayout\*>(m\_OnlyLayout.obj());+ return dynamic\_cast<LwpVirtualLayout\*>(m\_OnlyLayout.obj()); - LwpObjectHolder\* pObjHolder =static\_cast<LwpObjectHolder\*>(m\_Layouts.GetHead()->obj());+ LwpObjectHolder\* pObjHolder = dynamic\_cast<LwpObjectHolder\*>(m\_Layouts.GetHead()->obj()); if(pObjHolder) {- pLayout = static\_cast<LwpVirtualLayout\*>(pObjHolder->GetObject()->obj());+ pLayout = dynamic\_cast<LwpVirtualLayout\*>(pObjHolder->GetObject()->obj()); if(!pStartLayout ) return pLayout;  while(pObjHolder && pStartLayout != pLayout) {- pObjHolder = static\_cast<LwpObjectHolder\*>(pObjHolder->GetNext()->obj());+ pObjHolder = dynamic\_cast<LwpObjectHolder\*>(pObjHolder->GetNext()->obj()); if(pObjHolder) {- pLayout = static\_cast<LwpVirtualLayout\*>(pObjHolder->GetObject()->obj());+ pLayout = dynamic\_cast<LwpVirtualLayout\*>(pObjHolder->GetObject()->obj()); } }  if(pObjHolder) {- pObjHolder = static\_cast<LwpObjectHolder\*>(pObjHolder->GetNext()->obj());+ pObjHolder = dynamic\_cast<LwpObjectHolder\*>(pObjHolder->GetNext()->obj()); if(pObjHolder) {- pLayout = static\_cast<LwpVirtualLayout\*>(pObjHolder->GetObject()->obj());+ pLayout = dynamic\_cast<LwpVirtualLayout\*>(pObjHolder->GetObject()->obj()); return pLayout; } }@@ -496,16 +497,27 @@ void LwpHeadLayout::Read() void LwpHeadLayout::RegisterStyle() { //Register all children styles- LwpVirtualLayout\* pLayout = static\_cast<LwpVirtualLayout\*>(GetChildHead()->obj());+ LwpVirtualLayout\* pLayout = dynamic\_cast<LwpVirtualLayout\*>(GetChildHead()->obj()); while(pLayout) { pLayout->SetFoundry(m\_pFoundry); //if the layout is relative to para, the layout will be registered in para if(!pLayout->IsRelativeAnchored()) {+ if (pLayout == this)+ {+ OSL\_FAIL("Layout points to itself");+ break;+ } pLayout->RegisterStyle(); }- pLayout = static\_cast<LwpVirtualLayout\*>(pLayout->GetNext()->obj());+ LwpVirtualLayout \*pNext = dynamic\_cast<LwpVirtualLayout\*>(pLayout->GetNext()->obj());+ if (pNext == pLayout)+ {+ OSL\_FAIL("Layout points to itself");+ break;+ }+ pLayout = pNext; } } @@ -515,14 +527,14 @@ void LwpHeadLayout::RegisterStyle() \*/ LwpVirtualLayout\* LwpHeadLayout::FindEnSuperTableLayout() {- LwpVirtualLayout\* pLayout = static\_cast<LwpVirtualLayout\*>(GetChildHead()->obj());+ LwpVirtualLayout\* pLayout = dynamic\_cast<LwpVirtualLayout\*>(GetChildHead()->obj()); while(pLayout) { if(pLayout->GetLayoutType() == LWP\_ENDNOTE\_SUPERTABLE\_LAYOUT) { return pLayout; }- pLayout = static\_cast<LwpVirtualLayout\*>(pLayout->GetNext()->obj());+ pLayout = dynamic\_cast<LwpVirtualLayout\*>(pLayout->GetNext()->obj()); } return NULL; }@@ -645,12 +657,12 @@ LwpLayoutGeometry\* LwpMiddleLayout::GetGeometry() { if( !m\_LayGeometry.IsNull() ) {- return ( static\_cast<LwpLayoutGeometry\*> (m\_LayGeometry.obj()) );+ return ( dynamic\_cast<LwpLayoutGeometry\*> (m\_LayGeometry.obj()) ); } else if( !m\_BasedOnStyle.IsNull() ) {- LwpMiddleLayout\* pLay = static\_cast<LwpMiddleLayout\*> ( m\_BasedOnStyle.obj() );- return pLay->GetGeometry();+ LwpMiddleLayout\* pLay = dynamic\_cast<LwpMiddleLayout\*> ( m\_BasedOnStyle.obj() );+ return pLay ? pLay->GetGeometry() : NULL; } return NULL; }@@ -697,8 +709,9 @@ sal\_Bool LwpMiddleLayout::MarginsSameAsParent() } if(!m\_BasedOnStyle.IsNull()) {- LwpVirtualLayout\* play = static\_cast<LwpVirtualLayout\*> (m\_BasedOnStyle.obj());- play->MarginsSameAsParent();+ LwpVirtualLayout\* pLay = dynamic\_cast<LwpVirtualLayout\*> (m\_BasedOnStyle.obj());+ if (pLay)+ pLay->MarginsSameAsParent(); } return LwpVirtualLayout::MarginsSameAsParent(); @@ -715,7 +728,7 @@ double LwpMiddleLayout::GetMarginsValue(const sal\_uInt8 &nWhichSide) { if ( MarginsSameAsParent() ) {- LwpVirtualLayout\* pParent = static\_cast<LwpVirtualLayout\*> (GetParent()->obj());+ LwpVirtualLayout\* pParent = dynamic\_cast<LwpVirtualLayout\*> (GetParent()->obj()); if(pParent && !pParent->IsHeader()) { fValue = pParent->GetMarginsValue(nWhichSide);@@ -726,14 +739,14 @@ double LwpMiddleLayout::GetMarginsValue(const sal\_uInt8 &nWhichSide)  if(m\_nOverrideFlag & OVER\_MARGINS) {- LwpLayoutMargins\* pMar1 = static\_cast<LwpLayoutMargins\*> (m\_LayMargins.obj());+ LwpLayoutMargins\* pMar1 = dynamic\_cast<LwpLayoutMargins\*> (m\_LayMargins.obj()); if(pMar1) { fValue = pMar1->GetMargins()->GetMarginsValue(nWhichSide); return fValue; } }- LwpVirtualLayout\* pStyle = static\_cast<LwpVirtualLayout\*> (m\_BasedOnStyle.obj());+ LwpVirtualLayout\* pStyle = dynamic\_cast<LwpVirtualLayout\*> (m\_BasedOnStyle.obj()); if(pStyle) { fValue = pStyle->GetMarginsValue(nWhichSide);@@ -752,14 +765,14 @@ double LwpMiddleLayout::GetExtMarginsValue(const sal\_uInt8 &nWhichSide) double fValue = 0; if(m\_nOverrideFlag & OVER\_MARGINS) {- LwpLayoutMargins\* pMar1 = static\_cast<LwpLayoutMargins\*> (m\_LayMargins.obj());+ LwpLayoutMargins\* pMar1 = dynamic\_cast<LwpLayoutMargins\*> (m\_LayMargins.obj()); if(pMar1) { fValue = pMar1->GetExtMargins()->GetMarginsValue(nWhichSide); return fValue; } }- LwpVirtualLayout\* pStyle = static\_cast<LwpVirtualLayout\*> (m\_BasedOnStyle.obj());+ LwpVirtualLayout\* pStyle = dynamic\_cast<LwpVirtualLayout\*> (m\_BasedOnStyle.obj()); if(pStyle) { fValue = pStyle->GetExtMarginsValue(nWhichSide);@@ -777,13 +790,13 @@ LwpBorderStuff\* LwpMiddleLayout::GetBorderStuff() { if(m\_nOverrideFlag & OVER\_BORDERS) {- LwpLayoutBorder\* pLayoutBorder = static\_cast<LwpLayoutBorder\*>(m\_LayBorderStuff.obj());- return pLayoutBorder->GetBorderStuff();+ LwpLayoutBorder\* pLayoutBorder = dynamic\_cast<LwpLayoutBorder\*>(m\_LayBorderStuff.obj());+ return pLayoutBorder ? pLayoutBorder->GetBorderStuff() : NULL; } else if( !m\_BasedOnStyle.IsNull() ) {- LwpMiddleLayout\* pLay = static\_cast<LwpMiddleLayout\*> ( m\_BasedOnStyle.obj() );- return pLay->GetBorderStuff();+ LwpMiddleLayout\* pLay = dynamic\_cast<LwpMiddleLayout\*> ( m\_BasedOnStyle.obj() );+ return pLay ? pLay->GetBorderStuff() : NULL; } return NULL; }@@ -798,13 +811,13 @@ LwpBackgroundStuff\* LwpMiddleLayout::GetBackgroundStuff() { if(m\_nOverrideFlag & OVER\_BACKGROUND) {- LwpLayoutBackground\* pLayoutBackground = static\_cast<LwpLayoutBackground\*>(m\_LayBackgroundStuff.obj());- return pLayoutBackground->GetBackgoudStuff();+ LwpLayoutBackground\* pLayoutBackground = dynamic\_cast<LwpLayoutBackground\*>(m\_LayBackgroundStuff.obj());+ return pLayoutBackground ? pLayoutBackground->GetBackgoudStuff() : NULL; } else if( !m\_BasedOnStyle.IsNull() ) {- LwpMiddleLayout\* pLay = static\_cast<LwpMiddleLayout\*> ( m\_BasedOnStyle.obj() );- return pLay->GetBackgroundStuff();+ LwpMiddleLayout\* pLay = dynamic\_cast<LwpMiddleLayout\*> ( m\_BasedOnStyle.obj() );+ return pLay ? pLay->GetBackgroundStuff() : NULL; } return NULL; }@@ -905,13 +918,13 @@ LwpTabOverride\* LwpMiddleLayout::GetTabOverride() if(m\_nAttributes & OVER\_TABS) { if(!m\_TabPiece.IsNull())- return (LwpTabOverride\*)static\_cast<LwpTabPiece\*>(m\_TabPiece.obj())->GetOverride();+ return (LwpTabOverride\*) dynamic\_cast<LwpTabPiece\*>(m\_TabPiece.obj())->GetOverride(); return NULL; } else if( !m\_BasedOnStyle.IsNull() ) {- LwpMiddleLayout\* pLay = static\_cast<LwpMiddleLayout\*> ( m\_BasedOnStyle.obj() );- return pLay->GetTabOverride();+ LwpMiddleLayout\* pLay = dynamic\_cast<LwpMiddleLayout\*> ( m\_BasedOnStyle.obj() );+ return pLay ? pLay->GetTabOverride() : NULL; } return NULL; }@@ -927,7 +940,7 @@ sal\_uInt16 LwpMiddleLayout::GetScaleMode(void) if ((m\_nOverrideFlag & OVER\_SCALING) && m\_LayScale.obj()) return GetLayoutScale()->GetScaleMode(); else if (m\_BasedOnStyle.obj())- return static\_cast<LwpMiddleLayout\*>(m\_BasedOnStyle.obj())->GetScaleMode();+ return dynamic\_cast<LwpMiddleLayout\*>(m\_BasedOnStyle.obj())->GetScaleMode(); else return (LwpLayoutScale::FIT\_IN\_FRAME | LwpLayoutScale::MAINTAIN\_ASPECT\_RATIO); }@@ -945,7 +958,7 @@ sal\_uInt16 LwpMiddleLayout::GetScaleTile(void) return (GetLayoutScale()->GetPlacement() & LwpLayoutScale::TILED) ? 1 : 0; else if (m\_BasedOnStyle.obj())- return static\_cast<LwpMiddleLayout\*>(m\_BasedOnStyle.obj())->GetScaleTile();+ return dynamic\_cast<LwpMiddleLayout\*>(m\_BasedOnStyle.obj())->GetScaleTile(); else return 0; }@@ -965,7 +978,7 @@ sal\_uInt16 LwpMiddleLayout::GetScaleCenter(void) return (GetLayoutScale()->GetPlacement() & LwpLayoutScale::CENTERED) ? 1 : 0; else if (m\_BasedOnStyle.obj())- return static\_cast<LwpMiddleLayout\*>(m\_BasedOnStyle.obj())->GetScaleCenter();+ return dynamic\_cast<LwpMiddleLayout\*>(m\_BasedOnStyle.obj())->GetScaleCenter(); else return 0; }@@ -984,7 +997,7 @@ sal\_uInt32 LwpMiddleLayout::GetScalePercentage(void) if ((m\_nOverrideFlag & OVER\_SCALING) && m\_LayScale.obj()) return GetLayoutScale()->GetScalePercentage()/10;//m\_nScalePercentage 1000 = 100% else if (m\_BasedOnStyle.obj())- return static\_cast<LwpMiddleLayout\*>(m\_BasedOnStyle.obj())->GetScalePercentage();+ return dynamic\_cast<LwpMiddleLayout\*>(m\_BasedOnStyle.obj())->GetScalePercentage(); else return 100; }@@ -1000,7 +1013,7 @@ double LwpMiddleLayout::GetScaleWidth(void) if ((m\_nOverrideFlag & OVER\_SCALING) && m\_LayScale.obj()) return LwpTools::ConvertFromUnits(GetLayoutScale()->GetScaleWidth()); else if (m\_BasedOnStyle.obj())- return static\_cast<LwpMiddleLayout\*>(m\_BasedOnStyle.obj())->GetScaleWidth();+ return dynamic\_cast<LwpMiddleLayout\*>(m\_BasedOnStyle.obj())->GetScaleWidth(); else return 0; }@@ -1016,7 +1029,7 @@ double LwpMiddleLayout::GetScaleHeight(void) if ((m\_nOverrideFlag & OVER\_SCALING) && m\_LayScale.obj()) return LwpTools::ConvertFromUnits(GetLayoutScale()->GetScaleHeight()); else if (m\_BasedOnStyle.obj())- return static\_cast<LwpMiddleLayout\*>(m\_BasedOnStyle.obj())->GetScaleHeight();+ return dynamic\_cast<LwpMiddleLayout\*>(m\_BasedOnStyle.obj())->GetScaleHeight(); else return 0; }@@ -1073,8 +1086,8 @@ sal\_Bool LwpMiddleLayout::IsSizeRightToContainer(void) } else if (m\_BasedOnStyle.obj()) {- LwpMiddleLayout \* pLayout = static\_cast<LwpMiddleLayout \*>(m\_BasedOnStyle.obj());- return pLayout->IsSizeRightToContainer();+ LwpMiddleLayout \* pLayout = dynamic\_cast<LwpMiddleLayout \*>(m\_BasedOnStyle.obj());+ return pLayout ? pLayout->IsSizeRightToContainer() : sal\_False; } else return sal\_False;@@ -1092,8 +1105,8 @@ sal\_Bool LwpMiddleLayout::IsSizeRightToContent(void) } else if (m\_BasedOnStyle.obj()) {- LwpMiddleLayout \* pLayout = static\_cast<LwpMiddleLayout \*>(m\_BasedOnStyle.obj());- return pLayout->IsSizeRightToContent();+ LwpMiddleLayout \* pLayout = dynamic\_cast<LwpMiddleLayout \*>(m\_BasedOnStyle.obj());+ return pLayout ? pLayout->IsSizeRightToContent() : sal\_False; } else return sal\_False;@@ -1191,8 +1204,8 @@ sal\_Bool LwpMiddleLayout::IsAutoGrow() } else if( !m\_BasedOnStyle.IsNull() ) {- LwpMiddleLayout\* pLay = static\_cast<LwpMiddleLayout\*> ( m\_BasedOnStyle.obj() );- return pLay->IsAutoGrow();+ LwpMiddleLayout\* pLay = dynamic\_cast<LwpMiddleLayout\*> ( m\_BasedOnStyle.obj() );+ return pLay ? pLay->IsAutoGrow() : sal\_False; } return LwpVirtualLayout::IsAutoGrow(); }@@ -1209,8 +1222,8 @@ sal\_Bool LwpMiddleLayout::IsAutoGrowDown() } else if( !m\_BasedOnStyle.IsNull() ) {- LwpMiddleLayout\* pLay = static\_cast<LwpMiddleLayout\*> ( m\_BasedOnStyle.obj() );- return pLay->IsAutoGrowDown();+ LwpMiddleLayout\* pLay = dynamic\_cast<LwpMiddleLayout\*> ( m\_BasedOnStyle.obj() );+ return pLay ? pLay->IsAutoGrowDown() : sal\_False; } return LwpVirtualLayout::IsAutoGrowDown(); }@@ -1227,8 +1240,8 @@ sal\_Bool LwpMiddleLayout::IsAutoGrowUp() } else if( !m\_BasedOnStyle.IsNull() ) {- LwpMiddleLayout\* pLay = static\_cast<LwpMiddleLayout\*> ( m\_BasedOnStyle.obj() );- return pLay->IsAutoGrowUp();+ LwpMiddleLayout\* pLay = dynamic\_cast<LwpMiddleLayout\*> ( m\_BasedOnStyle.obj() );+ return pLay ? pLay->IsAutoGrowUp() : sal\_False; } return LwpVirtualLayout::IsAutoGrowUp(); }@@ -1245,8 +1258,9 @@ sal\_Bool LwpMiddleLayout::IsAutoGrowLeft() } else if( !m\_BasedOnStyle.IsNull() ) {- LwpMiddleLayout\* pLay = static\_cast<LwpMiddleLayout\*> ( m\_BasedOnStyle.obj() );- return pLay->IsAutoGrowLeft();+ LwpMiddleLayout\* pLay = dynamic\_cast<LwpMiddleLayout\*> ( m\_BasedOnStyle.obj() );+ if (pLay)+ return pLay->IsAutoGrowLeft(); } return LwpVirtualLayout::IsAutoGrowLeft(); }@@ -1263,8 +1277,8 @@ sal\_Bool LwpMiddleLayout::IsAutoGrowRight() } else if( !m\_BasedOnStyle.IsNull() ) {- LwpMiddleLayout\* pLay = static\_cast<LwpMiddleLayout\*> ( m\_BasedOnStyle.obj() );- return pLay->IsAutoGrowRight();+ LwpMiddleLayout\* pLay = dynamic\_cast<LwpMiddleLayout\*> ( m\_BasedOnStyle.obj() );+ return pLay ? pLay->IsAutoGrowRight() : sal\_False; } return LwpVirtualLayout::IsAutoGrowRight(); }@@ -1279,13 +1293,15 @@ sal\_uInt8 LwpMiddleLayout::GetContentOrientation() //content orientation in Graphic objects and OLE objects not supported now if((m\_nOverrideFlag & OVER\_ROTATION)&& !m\_LayGeometry.IsNull()) {- LwpLayoutGeometry\* pLayGeometry = static\_cast<LwpLayoutGeometry\*> (m\_LayGeometry.obj());- return pLayGeometry->GetContentOrientation();+ LwpLayoutGeometry\* pLayGeometry = dynamic\_cast<LwpLayoutGeometry\*> (m\_LayGeometry.obj());+ if (pLayGeometry)+ return pLayGeometry->GetContentOrientation(); } else if( !m\_BasedOnStyle.IsNull() ) {- LwpMiddleLayout\* pLay = static\_cast<LwpMiddleLayout\*> ( m\_BasedOnStyle.obj() );- return pLay->GetContentOrientation();+ LwpMiddleLayout\* pLay = dynamic\_cast<LwpMiddleLayout\*> ( m\_BasedOnStyle.obj() );+ if (pLay)+ return pLay->GetContentOrientation(); } return LwpVirtualLayout::GetContentOrientation(); }@@ -1301,7 +1317,7 @@ sal\_Bool LwpMiddleLayout::HonorProtection() if(!(m\_nAttributes2 & STYLE2\_HONORPROTECTION)) return sal\_False; - LwpVirtualLayout\* pParent = static\_cast<LwpVirtualLayout\*> (GetParent()->obj());+ LwpVirtualLayout\* pParent = dynamic\_cast<LwpVirtualLayout\*> (GetParent()->obj()); if(pParent && !pParent->IsHeader()) { return pParent->HonorProtection();@@ -1318,8 +1334,9 @@ sal\_Bool LwpMiddleLayout::HonorProtection() } else if( !m\_BasedOnStyle.IsNull() ) {- LwpMiddleLayout\* pLay = static\_cast<LwpMiddleLayout\*> ( m\_BasedOnStyle.obj() );- return pLay->HonorProtection();+ LwpMiddleLayout\* pLay = dynamic\_cast<LwpMiddleLayout\*> ( m\_BasedOnStyle.obj() );+ if (pLay)+ return pLay->HonorProtection(); }  return LwpVirtualLayout::HonorProtection();@@ -1338,13 +1355,13 @@ sal\_Bool LwpMiddleLayout::IsProtected() } else if( !m\_BasedOnStyle.IsNull() ) {- LwpMiddleLayout\* pLay = static\_cast<LwpMiddleLayout\*> ( m\_BasedOnStyle.obj() );- bProtected = pLay->IsProtected();+ LwpMiddleLayout\* pLay = dynamic\_cast<LwpMiddleLayout\*> ( m\_BasedOnStyle.obj() );+ bProtected = pLay ? pLay->IsProtected() : sal\_False; } else bProtected = LwpVirtualLayout::IsProtected(); - LwpVirtualLayout\* pParent = static\_cast<LwpVirtualLayout\*> (GetParent()->obj());+ LwpVirtualLayout\* pParent = dynamic\_cast<LwpVirtualLayout\*> (GetParent()->obj()); if(pParent && !pParent->IsHeader()) { /\* If a parent's protected then none of its children can be accessed. \*/@@ -1380,14 +1397,14 @@ sal\_Bool LwpMiddleLayout::IsProtected() \*/ LwpVirtualLayout\* LwpMiddleLayout::GetWaterMarkLayout() {- LwpVirtualLayout\* pLay = static\_cast<LwpVirtualLayout\*>(GetChildHead()->obj());+ LwpVirtualLayout\* pLay = dynamic\_cast<LwpVirtualLayout\*>(GetChildHead()->obj()); while(pLay) { if( pLay->IsForWaterMark()) { return pLay; }- pLay = static\_cast<LwpVirtualLayout\*> (pLay->GetNext()->obj());+ pLay = dynamic\_cast<LwpVirtualLayout\*> (pLay->GetNext()->obj()); } return NULL; }@@ -1402,7 +1419,7 @@ XFBGImage\* LwpMiddleLayout::GetXFBGImage() if(pLay) { //test BGImage- LwpGraphicObject\* pGrfObj = static\_cast<LwpGraphicObject\*>(pLay->GetContent()->obj());+ LwpGraphicObject\* pGrfObj = dynamic\_cast<LwpGraphicObject\*>(pLay->GetContent()->obj()); if(pGrfObj) { XFBGImage\* pXFBGImage = new XFBGImage();@@ -1465,8 +1482,8 @@ sal\_Bool LwpMiddleLayout::GetUsePrinterSettings() } else if( !m\_BasedOnStyle.IsNull() ) {- LwpMiddleLayout\* pLay = static\_cast<LwpMiddleLayout\*> ( m\_BasedOnStyle.obj() );- return pLay->GetUsePrinterSettings();+ LwpMiddleLayout\* pLay = dynamic\_cast<LwpMiddleLayout\*> ( m\_BasedOnStyle.obj() );+ return pLay ? pLay->GetUsePrinterSettings() : sal\_False; } return sal\_False; }@@ -1541,14 +1558,14 @@ sal\_uInt16 LwpLayout::GetNumCols() { if(m\_nOverrideFlag & OVER\_COLUMNS) {- LwpLayoutColumns\* pLayColumns = static\_cast<LwpLayoutColumns\*>(m\_LayColumns.obj());+ LwpLayoutColumns\* pLayColumns = dynamic\_cast<LwpLayoutColumns\*>(m\_LayColumns.obj()); if(pLayColumns) { return pLayColumns->GetNumCols(); } } - LwpVirtualLayout\* pStyle = static\_cast<LwpVirtualLayout\*> (m\_BasedOnStyle.obj());+ LwpVirtualLayout\* pStyle = dynamic\_cast<LwpVirtualLayout\*> (m\_BasedOnStyle.obj()); if(pStyle) { return pStyle->GetNumCols();@@ -1566,14 +1583,14 @@ double LwpLayout::GetColWidth(sal\_uInt16 nIndex) { if((m\_nOverrideFlag & OVER\_COLUMNS)||(m\_nAttributes2 & STYLE2\_LOCALCOLUMNINFO)) {- LwpLayoutColumns\* pLayColumns = static\_cast<LwpLayoutColumns\*>(m\_LayColumns.obj());+ LwpLayoutColumns\* pLayColumns = dynamic\_cast<LwpLayoutColumns\*>(m\_LayColumns.obj()); if(pLayColumns) { return pLayColumns->GetColWidth(nIndex); } } - LwpVirtualLayout\* pStyle = static\_cast<LwpVirtualLayout\*> (m\_BasedOnStyle.obj());+ LwpVirtualLayout\* pStyle = dynamic\_cast<LwpVirtualLayout\*> (m\_BasedOnStyle.obj()); if(pStyle) { return pStyle->GetColWidth(nIndex);@@ -1591,14 +1608,14 @@ double LwpLayout::GetColGap(sal\_uInt16 nIndex) { if((m\_nOverrideFlag & OVER\_COLUMNS)||(m\_nAttributes2 & STYLE2\_LOCALCOLUMNINFO)) {- LwpLayoutColumns\* pLayColumns = static\_cast<LwpLayoutColumns\*>(m\_LayColumns.obj());+ LwpLayoutColumns\* pLayColumns = dynamic\_cast<LwpLayoutColumns\*>(m\_LayColumns.obj()); if(pLayColumns) { return pLayColumns->GetColGap(nIndex); } } - LwpVirtualLayout\* pStyle = static\_cast<LwpVirtualLayout\*> (m\_BasedOnStyle.obj());+ LwpVirtualLayout\* pStyle = dynamic\_cast<LwpVirtualLayout\*> (m\_BasedOnStyle.obj()); if(pStyle) { return pStyle->GetColGap(nIndex);@@ -1667,7 +1684,7 @@ XFColumnSep\* LwpLayout::GetColumnSep() {  //Get LwpLayoutGutters- LwpLayoutGutters\* pLayoutGutters = static\_cast<LwpLayoutGutters\*>(m\_LayGutterStuff.obj());+ LwpLayoutGutters\* pLayoutGutters = dynamic\_cast<LwpLayoutGutters\*>(m\_LayGutterStuff.obj()); if(!pLayoutGutters) { return NULL;@@ -1750,8 +1767,8 @@ sal\_uInt16 LwpLayout::GetUsePage() } else if( !m\_BasedOnStyle.IsNull() ) {- LwpLayout\* pLay = static\_cast<LwpLayout\*> ( m\_BasedOnStyle.obj() );- return pLay->GetUsePage();+ LwpLayout\* pLay = dynamic\_cast<LwpLayout\*> ( m\_BasedOnStyle.obj() );+ return pLay ? pLay->GetUsePage() : 0; } return 0; }@@ -1768,8 +1785,8 @@ LwpUseWhen\* LwpLayout::VirtualGetUseWhen() } else if( !m\_BasedOnStyle.IsNull() ) {- LwpLayout\* pLay = static\_cast<LwpLayout\*> ( m\_BasedOnStyle.obj() );- return pLay->VirtualGetUseWhen();+ LwpLayout\* pLay = dynamic\_cast<LwpLayout\*> ( m\_BasedOnStyle.obj() );+ return pLay ? pLay->VirtualGetUseWhen() : NULL; } return LwpVirtualLayout::VirtualGetUseWhen(); }@@ -1790,8 +1807,9 @@ sal\_Bool LwpLayout::IsUseOnAllPages() } else if( !m\_BasedOnStyle.IsNull() ) {- LwpLayout\* pLay = static\_cast<LwpLayout\*> ( m\_BasedOnStyle.obj() );- return pLay->IsUseOnAllPages();+ LwpLayout\* pLay = dynamic\_cast<LwpLayout\*> ( m\_BasedOnStyle.obj() );+ if (pLay)+ return pLay->IsUseOnAllPages(); } return LwpVirtualLayout::IsUseOnAllPages(); }@@ -1812,8 +1830,9 @@ sal\_Bool LwpLayout::IsUseOnAllEvenPages() } else if( !m\_BasedOnStyle.IsNull() ) {- LwpLayout\* pLay = static\_cast<LwpLayout\*> ( m\_BasedOnStyle.obj() );- return pLay->IsUseOnAllEvenPages();+ LwpLayout\* pLay = dynamic\_cast<LwpLayout\*> ( m\_BasedOnStyle.obj() );+ if (pLay)+ return pLay->IsUseOnAllEvenPages(); } return LwpVirtualLayout::IsUseOnAllEvenPages(); }@@ -1834,8 +1853,9 @@ sal\_Bool LwpLayout::IsUseOnAllOddPages() } else if( !m\_BasedOnStyle.IsNull() ) {- LwpLayout\* pLay = static\_cast<LwpLayout\*> ( m\_BasedOnStyle.obj() );- return pLay->IsUseOnAllOddPages();+ LwpLayout\* pLay = dynamic\_cast<LwpLayout\*> ( m\_BasedOnStyle.obj() );+ if (pLay)+ return pLay->IsUseOnAllOddPages(); } return LwpVirtualLayout::IsUseOnAllOddPages(); }@@ -1856,8 +1876,9 @@ sal\_Bool LwpLayout::IsUseOnPage() } else if( !m\_BasedOnStyle.IsNull() ) {- LwpLayout\* pLay = static\_cast<LwpLayout\*> ( m\_BasedOnStyle.obj() );- return pLay->IsUseOnPage();+ LwpLayout\* pLay = dynamic\_cast<LwpLayout\*> ( m\_BasedOnStyle.obj() );+ if (pLay)+ return pLay->IsUseOnPage(); } return LwpVirtualLayout::IsUseOnPage(); }@@ -1872,13 +1893,13 @@ LwpShadow\* LwpLayout::GetShadow() { if(m\_nOverrideFlag & OVER\_SHADOW) {- LwpLayoutShadow\* pLayoutShadow = static\_cast<LwpLayoutShadow\*>(m\_LayShadow.obj());- return pLayoutShadow->GetShadow();+ LwpLayoutShadow\* pLayoutShadow = dynamic\_cast<LwpLayoutShadow\*>(m\_LayShadow.obj());+ return pLayoutShadow ? pLayoutShadow->GetShadow() : NULL; } else if( !m\_BasedOnStyle.IsNull() ) {- LwpLayout\* pLay = static\_cast<LwpLayout\*> ( m\_BasedOnStyle.obj() );- return pLay->GetShadow();+ LwpLayout\* pLay = dynamic\_cast<LwpLayout\*> ( m\_BasedOnStyle.obj() );+ return pLay ? pLay->GetShadow() : NULL; } return NULL; }@@ -1946,11 +1967,11 @@ LwpVirtualLayout\* LwpLayout::GetContainerLayout() if(IsRelativeAnchored()) { //get position- LwpPara\* pPara = static\_cast<LwpPara\*>(GetPosition()->obj());+ LwpPara\* pPara = dynamic\_cast<LwpPara\*>(GetPosition()->obj()); if(pPara) { LwpStory\* pStory = pPara->GetStory();- return pStory->GetTabLayout();+ return pStory ? pStory->GetTabLayout() : NULL; } } return GetParentLayout();@@ -2022,8 +2043,9 @@ sal\_uInt8 LwpPlacableLayout::GetWrapType() } else if( !m\_BasedOnStyle.IsNull() ) {- LwpPlacableLayout\* pLay = static\_cast<LwpPlacableLayout\*> ( m\_BasedOnStyle.obj() );- return pLay->GetWrapType();+ LwpPlacableLayout\* pLay = dynamic\_cast<LwpPlacableLayout\*> ( m\_BasedOnStyle.obj() );+ if (pLay)+ return pLay->GetWrapType(); } return LAY\_WRAP\_AROUND; }@@ -2039,13 +2061,13 @@ LwpLayoutRelativity\* LwpPlacableLayout::GetRelativityPiece() { if(m\_nOverrideFlag & OVER\_PLACEMENT) {- return static\_cast<LwpLayoutRelativity\*>(m\_LayRelativity.obj());+ return dynamic\_cast<LwpLayoutRelativity\*>(m\_LayRelativity.obj()); } } else if( !m\_BasedOnStyle.IsNull() ) {- LwpPlacableLayout\* pLay = static\_cast<LwpPlacableLayout\*> ( m\_BasedOnStyle.obj() );- return pLay->GetRelativityPiece();+ LwpPlacableLayout\* pLay = dynamic\_cast<LwpPlacableLayout\*> ( m\_BasedOnStyle.obj() );+ return pLay ? pLay->GetRelativityPiece() : NULL; } return NULL; }@@ -2139,8 +2161,8 @@ sal\_Int32 LwpPlacableLayout::GetBaseLineOffset() } else if( !m\_BasedOnStyle.IsNull() ) {- LwpPlacableLayout\* pLay = static\_cast<LwpPlacableLayout\*> ( m\_BasedOnStyle.obj() );- return pLay->GetBaseLineOffset();+ LwpPlacableLayout\* pLay = dynamic\_cast<LwpPlacableLayout\*> ( m\_BasedOnStyle.obj() );+ return pLay ? pLay->GetBaseLineOffset() : 0; } return 0; diff --git a/lotuswordpro/source/filter/lwplayout.hxx b/lotuswordpro/source/filter/lwplayout.hxxindex 509d3e699..12e3832f4 100644--- a/[lotuswordpro/source/filter/lwplayout.hxx](/libreoffice/filters/tree/lotuswordpro/source/filter/lwplayout.hxx?id=03894d18889d7bc79b3d4f000c0df7065ea81ee2)+++ b/[lotuswordpro/source/filter/lwplayout.hxx](/libreoffice/filters/tree/lotuswordpro/source/filter/lwplayout.hxx?id=278831e37a23e9e2e29ca811c3a5398b7c67464d)@@ -303,7 +303,7 @@ public: XFBGImage\* GetXFBGImage(); virtual sal\_Bool GetUsePrinterSettings(); - LwpLayoutScale\* GetLayoutScale(){return static\_cast<LwpLayoutScale\*>(m\_LayScale.obj());}+ LwpLayoutScale\* GetLayoutScale(){return dynamic\_cast<LwpLayoutScale\*>(m\_LayScale.obj());} sal\_uInt16 GetScaleMode(void); void SetScaleMode(sal\_uInt16 nVal); sal\_uInt16 GetScaleTile(void);diff --git a/lotuswordpro/source/filter/lwpmarker.cxx b/lotuswordpro/source/filter/lwpmarker.cxxindex b32737d41..155dc32e7 100644--- a/[lotuswordpro/source/filter/lwpmarker.cxx](/libreoffice/filters/tree/lotuswordpro/source/filter/lwpmarker.cxx?id=03894d18889d7bc79b3d4f000c0df7065ea81ee2)+++ b/[lotuswordpro/source/filter/lwpmarker.cxx](/libreoffice/filters/tree/lotuswordpro/source/filter/lwpmarker.cxx?id=278831e37a23e9e2e29ca811c3a5398b7c67464d)@@ -137,7 +137,7 @@ OUString LwpCHBlkMarker::GetPromptText() { LwpStory\* pStory = NULL; if (m\_objPromptStory.obj())- pStory = static\_cast<LwpStory\*>(m\_objPromptStory.obj());+ pStory = dynamic\_cast<LwpStory\*>(m\_objPromptStory.obj()); if (pStory) return pStory->GetContentText(); return A2OUSTR("");@@ -380,6 +380,9 @@ sal\_Bool LwpBookMark::IsRightName(OUString sName)  LwpFieldMark::LwpFieldMark(LwpObjectHeader &objHdr, LwpSvStream \*pStrm) : LwpStoryMarker(objHdr,pStrm)+ , m\_nExtra(0)+ , m\_nFlag(0)+ , m\_nFieldType(0) , m\_bHasStyle(sal\_False) , m\_bHasStart(sal\_False) , m\_pFrib(NULL)diff --git a/lotuswordpro/source/filter/lwpmarker.hxx b/lotuswordpro/source/filter/lwpmarker.hxxindex a687d71a1..772e65532 100644--- a/[lotuswordpro/source/filter/lwpmarker.hxx](/libreoffice/filters/tree/lotuswordpro/source/filter/lwpmarker.hxx?id=03894d18889d7bc79b3d4f000c0df7065ea81ee2)+++ b/[lotuswordpro/source/filter/lwpmarker.hxx](/libreoffice/filters/tree/lotuswordpro/source/filter/lwpmarker.hxx?id=278831e37a23e9e2e29ca811c3a5398b7c67464d)@@ -203,7 +203,6 @@ public: void Read(); void ParseIndex(OUString& sKey1,OUString& sKey2); void ParseTOC(OUString& sLevel,OUString& sText);-// sal\_uInt8 ParseCrossRef(OUString& sMarkName); sal\_uInt16 GetFieldType(){return m\_nFieldType;} sal\_Bool IsFormulaInsert(); sal\_Bool IsDateTimeField(sal\_uInt8& type,OUString& formula);diff --git a/lotuswordpro/source/filter/lwpobjfactory.cxx b/lotuswordpro/source/filter/lwpobjfactory.cxxindex 0f53e2812..2043c31ad 100644--- a/[lotuswordpro/source/filter/lwpobjfactory.cxx](/libreoffice/filters/tree/lotuswordpro/source/filter/lwpobjfactory.cxx?id=03894d18889d7bc79b3d4f000c0df7065ea81ee2)+++ b/[lotuswordpro/source/filter/lwpobjfactory.cxx](/libreoffice/filters/tree/lotuswordpro/source/filter/lwpobjfactory.cxx?id=278831e37a23e9e2e29ca811c3a5398b7c67464d)@@ -110,44 +110,28 @@ LwpObjectFactory::LwpObjectFactory(LwpSvStream\* pSvStream) : m\_nNumObjs(0), m\_pSvStream(pSvStream) {- m\_ObjList.clear();+ m\_IdToObjList.clear(); }  LwpObjectFactory::~LwpObjectFactory() {-// m\_pMgr = NULL;- if(!m\_ObjList.empty())+ if(!m\_IdToObjList.empty()) ClearObjectMap(); }  /\*\*- \* @descr create the single object factory-\*/-/\*-LwpObjectFactory\* LwpObjectFactory::Instance(LwpSvStream\* pStream)-{- if(m\_pMgr == NULL)- {- if(pStream)- {- m\_pMgr = new LwpObjectFactory(pStream);- }- }- return(m\_pMgr);-}\*/-/\*\* \* @descr clear object map and delete all objects \*/ void LwpObjectFactory::ClearObjectMap() {- LwpObjMap::iterator it = m\_ObjList.begin();- while( it!=m\_ObjList.end() )+ LwpIdToObjMap::iterator it = m\_IdToObjList.begin();+ while( it!=m\_IdToObjList.end() ) {- delete (\*it).second;- (\*it).second = NULL;+ delete it->second;+ it->second = NULL; ++it; }- m\_ObjList.clear();+ m\_IdToObjList.clear(); } /\*\* \* @descr read the index manager@@ -713,7 +697,7 @@ LwpObject\* LwpObjectFactory::CreateObject(sal\_uInt32 type, LwpObjectHeader &objH if(newObj) { newObj->QuickRead();- m\_ObjList.insert(LwpObjMap::value\_type(\*objHdr.GetID(), newObj));+ m\_IdToObjList.insert(LwpIdToObjMap::value\_type(\*objHdr.GetID(), newObj)); }  return(newObj);@@ -730,12 +714,22 @@ LwpObject\* LwpObjectFactory::QueryObject(const LwpObjectID &objID) //Read the object from file sal\_uInt32 nStreamOffset = m\_IndexMgr.GetObjOffset(objID); if(nStreamOffset == BAD\_OFFSET) //does not find the offset in index manager+ return NULL;++ sal\_Int64 nDesiredPos = nStreamOffset + LwpSvStream::LWP\_STREAM\_BASE;+ if (nDesiredPos != m\_pSvStream->Seek(nDesiredPos))+ return NULL;+ LwpObjectHeader objHdr;+ if (!objHdr.Read(\*m\_pSvStream))+ return NULL;++ LwpObjectID\* pId = objHdr.GetID();+ if (pId && (\*pId != objID)) {+ OSL\_FAIL("apparently incorrect objid, invalidating"); return NULL; }- m\_pSvStream->Seek( nStreamOffset + LwpSvStream::LWP\_STREAM\_BASE );- LwpObjectHeader objHdr;- objHdr.Read(\*m\_pSvStream);+ obj = CreateObject(objHdr.GetTag(), objHdr); } return obj;@@ -746,8 +740,8 @@ LwpObject\* LwpObjectFactory::QueryObject(const LwpObjectID &objID) \*/ LwpObject\* LwpObjectFactory::FindObject(const LwpObjectID &objID) {- LwpObjMap::const\_iterator it = m\_ObjList.find(objID);- if (it != m\_ObjList.end()) {+ LwpIdToObjMap::const\_iterator it = m\_IdToObjList.find(objID);+ if (it != m\_IdToObjList.end()) { return((\*it).second); } else@@ -761,7 +755,7 @@ LwpObject\* LwpObjectFactory::FindObject(const LwpObjectID &objID) void LwpObjectFactory::ReleaseObject(const LwpObjectID &objID) { LwpObject\* obj = FindObject( objID );- m\_ObjList.erase(objID);+ m\_IdToObjList.erase(objID); if( obj ) delete obj; }diff --git a/lotuswordpro/source/filter/lwpobjfactory.hxx b/lotuswordpro/source/filter/lwpobjfactory.hxxindex f30e9e346..f9a25e8bb 100644--- a/[lotuswordpro/source/filter/lwpobjfactory.hxx](/libreoffice/filters/tree/lotuswordpro/source/filter/lwpobjfactory.hxx?id=03894d18889d7bc79b3d4f000c0df7065ea81ee2)+++ b/[lotuswordpro/source/filter/lwpobjfactory.hxx](/libreoffice/filters/tree/lotuswordpro/source/filter/lwpobjfactory.hxx?id=278831e37a23e9e2e29ca811c3a5398b7c67464d)@@ -101,8 +101,8 @@ private: return(rKey1==rKey2); } };- typedef boost::unordered\_map<LwpObjectID, LwpObject \*, hashFunc, eqFunc> LwpObjMap;- LwpObjMap m\_ObjList;+ typedef boost::unordered\_map<LwpObjectID, LwpObject \*, hashFunc, eqFunc> LwpIdToObjMap;+ LwpIdToObjMap m\_IdToObjList; LwpIndexManager m\_IndexMgr; void ClearObjectMap(); diff --git a/lotuswordpro/source/filter/lwpobjhdr.cxx b/lotuswordpro/source/filter/lwpobjhdr.cxxindex 2e706d422..7103b577c 100644--- a/[lotuswordpro/source/filter/lwpobjhdr.cxx](/libreoffice/filters/tree/lotuswordpro/source/filter/lwpobjhdr.cxx?id=03894d18889d7bc79b3d4f000c0df7065ea81ee2)+++ b/[lotuswordpro/source/filter/lwpobjhdr.cxx](/libreoffice/filters/tree/lotuswordpro/source/filter/lwpobjhdr.cxx?id=278831e37a23e9e2e29ca811c3a5398b7c67464d)@@ -74,9 +74,8 @@ LwpObjectHeader::LwpObjectHeader() /\*\* \* @descr read header from stream \*/-void LwpObjectHeader::Read(LwpSvStream &rStrm)+bool LwpObjectHeader::Read(LwpSvStream &rStrm) {- sal\_uInt8 nFlagBits = 0; sal\_uInt32 nVersionID = 0; sal\_uInt32 nRefCount = 0;@@ -84,6 +83,8 @@ void LwpObjectHeader::Read(LwpSvStream &rStrm) sal\_uInt32 nNextVersionID = 0; sal\_uInt32 nHeaderSize = 0; + sal\_Int64 nStartPos = rStrm.Tell();+ if ( LwpFileHeader::m\_nFileRevision < 0x000B) { rStrm.Read(&m\_nTag, sizeof(m\_nTag));@@ -196,6 +197,8 @@ void LwpObjectHeader::Read(LwpSvStream &rStrm) m\_bCompressed = sal\_True; } }+ sal\_Int64 nEndPos = rStrm.Tell();+ return (nStartPos + nHeaderSize == nEndPos); }  /\* vim:set shiftwidth=4 softtabstop=4 expandtab: \*/diff --git a/lotuswordpro/source/filter/lwpobjhdr.hxx b/lotuswordpro/source/filter/lwpobjhdr.hxxindex a36564acd..bb80a1d13 100644--- a/[lotuswordpro/source/filter/lwpobjhdr.hxx](/libreoffice/filters/tree/lotuswordpro/source/filter/lwpobjhdr.hxx?id=03894d18889d7bc79b3d4f000c0df7065ea81ee2)+++ b/[lotuswordpro/source/filter/lwpobjhdr.hxx](/libreoffice/filters/tree/lotuswordpro/source/filter/lwpobjhdr.hxx?id=278831e37a23e9e2e29ca811c3a5398b7c67464d)@@ -112,7 +112,7 @@ private: };  public:- void Read(LwpSvStream &pStrm);+ bool Read(LwpSvStream &pStrm); inline sal\_uInt32 GetTag(); inline sal\_uInt32 GetSize(); inline LwpObjectID\* GetID();diff --git a/lotuswordpro/source/filter/lwpobjstrm.cxx b/lotuswordpro/source/filter/lwpobjstrm.cxxindex 8e61d444e..9d8f3d23b 100644--- a/[lotuswordpro/source/filter/lwpobjstrm.cxx](/libreoffice/filters/tree/lotuswordpro/source/filter/lwpobjstrm.cxx?id=03894d18889d7bc79b3d4f000c0df7065ea81ee2)+++ b/[lotuswordpro/source/filter/lwpobjstrm.cxx](/libreoffice/filters/tree/lotuswordpro/source/filter/lwpobjstrm.cxx?id=278831e37a23e9e2e29ca811c3a5398b7c67464d)@@ -100,6 +100,7 @@ void LwpObjectStream::Read2Buffer() if( m\_bCompressed ) { sal\_uInt8\* pCompressBuffer = new sal\_uInt8[m\_nBufSize];+ memset(pCompressBuffer, 0, m\_nBufSize); m\_pStrm->Read(pCompressBuffer, m\_nBufSize);  sal\_uInt8 pTempDst[IO\_BUFFERSIZE];@@ -165,6 +166,7 @@ void LwpObjectStream::ReleaseBuffer() \*/ sal\_uInt16 LwpObjectStream::QuickRead(void\* buf, sal\_uInt16 len) {+ memset(buf, 0, len); if( len > m\_nBufSize - m\_nReadPos ) { assert(false);@@ -304,6 +306,8 @@ sal\_uInt16 LwpObjectStream::DecompressBuffer(sal\_uInt8\* pDst, sal\_uInt8\* pSrc, s // where zzzzzz is the count - 1 of compressed 0 bytes  Cnt = (\*pSrc++ & 0x3F) + 1;+ if (DstSize+Cnt >= IO\_BUFFERSIZE)+ throw BadDecompress(); memset(pDst, 0, Cnt); pDst += Cnt; DstSize += Cnt;@@ -317,15 +321,21 @@ sal\_uInt16 LwpObjectStream::DecompressBuffer(sal\_uInt8\* pDst, sal\_uInt8\* pSrc, s // and nnn is the count - 1 of following non-zero bytes  Cnt = ((\*pSrc & 0x38) >> 3) + 1;+ if (DstSize+Cnt >= IO\_BUFFERSIZE)+ throw BadDecompress(); memset(pDst, 0, Cnt); pDst += Cnt; DstSize += Cnt; Cnt = (\*pSrc++ & 0x07) + 1;+ if (Size < Cnt + 1)+ throw BadDecompress();+ Size -= Cnt + 1;+ if (DstSize+Cnt >= IO\_BUFFERSIZE)+ throw BadDecompress(); memcpy(pDst, pSrc, Cnt); pDst += Cnt; DstSize += Cnt; pSrc += Cnt;- Size -= Cnt + 1; break;  case 0x80:@@ -344,14 +354,21 @@ sal\_uInt16 LwpObjectStream::DecompressBuffer(sal\_uInt8\* pDst, sal\_uInt8\* pSrc, s // nnnnnn is the count less 1 of following non-zero bytes  Cnt = (\*pSrc++ & 0x3F) + 1;+ if (Size < Cnt + 1)+ throw BadDecompress();+ Size -= Cnt + 1;+ if (DstSize+Cnt >= IO\_BUFFERSIZE)+ throw BadDecompress(); memcpy(pDst, pSrc, Cnt); pDst += Cnt; DstSize += Cnt; pSrc += Cnt;- Size -= Cnt + 1; break; } assert(DstSize < IO\_BUFFERSIZE);+ if (DstSize >= IO\_BUFFERSIZE)+ throw BadDecompress();+ } return(static\_cast<sal\_uInt16>(DstSize)); }diff --git a/lotuswordpro/source/filter/lwpoverride.cxx b/lotuswordpro/source/filter/lwpoverride.cxxindex 326346149..032ac03b5 100644--- a/[lotuswordpro/source/filter/lwpoverride.cxx](/libreoffice/filters/tree/lotuswordpro/source/filter/lwpoverride.cxx?id=03894d18889d7bc79b3d4f000c0df7065ea81ee2)+++ b/[lotuswordpro/source/filter/lwpoverride.cxx](/libreoffice/filters/tree/lotuswordpro/source/filter/lwpoverride.cxx?id=278831e37a23e9e2e29ca811c3a5398b7c67464d)@@ -612,8 +612,6 @@ void LwpIndentOverride::OverrideRelative(sal\_uInt16 relative)  void LwpSpacingOverride::Override(LwpSpacingOverride\* other) {-// if (IsAlwaysOverridden())-// other->SetAlways(IsAlways());//To be done if (other) { m\_pSpacing->Override(other->GetSpacing());diff --git a/lotuswordpro/source/filter/lwppagelayout.cxx b/lotuswordpro/source/filter/lwppagelayout.cxxindex 296196111..f2cca6176 100644--- a/[lotuswordpro/source/filter/lwppagelayout.cxx](/libreoffice/filters/tree/lotuswordpro/source/filter/lwppagelayout.cxx?id=03894d18889d7bc79b3d4f000c0df7065ea81ee2)+++ b/[lotuswordpro/source/filter/lwppagelayout.cxx](/libreoffice/filters/tree/lotuswordpro/source/filter/lwppagelayout.cxx?id=278831e37a23e9e2e29ca811c3a5398b7c67464d)@@ -269,7 +269,9 @@ void LwpPageLayout::ParseFootNoteSeparator(XFPageMaster \* pm1) LwpDocument\* pDocument = m\_pFoundry->GetDocument(); if(pDocument) {- LwpFootnoteOptions\* pFootnoteOpts = static\_cast<LwpFootnoteOptions\*>(pDocument->GetValidFootnoteOpts()->obj());+ LwpObjectID\* pFontnodeId = pDocument->GetValidFootnoteOpts();++ LwpFootnoteOptions\* pFootnoteOpts = pFontnodeId ? dynamic\_cast<LwpFootnoteOptions\*>(pFontnodeId->obj()) : NULL; if(pFootnoteOpts) { LwpFootnoteSeparatorOptions\* pFootnoteSep = pFootnoteOpts->GetFootnoteSeparator();@@ -476,8 +478,8 @@ void LwpPageLayout::ConvertFillerPageText(XFContentContainer\* pCont) { //get filerpage story from division info LwpDocument\* pDoc = m\_pFoundry->GetDocument();- LwpDivInfo\* pDivInfo = static\_cast<LwpDivInfo\*>(pDoc->GetDivInfoID()->obj());- LwpStory\* pStory = static\_cast<LwpStory\*>(pDivInfo->GetFillerPageTextID()->obj());+ LwpDivInfo\* pDivInfo = dynamic\_cast<LwpDivInfo\*>(pDoc->GetDivInfoID()->obj());+ LwpStory\* pStory = dynamic\_cast<LwpStory\*>(pDivInfo->GetFillerPageTextID()->obj());  //parse fillerpage story if(pStory)@@ -500,24 +502,24 @@ void LwpPageLayout::ResetXFColumns()  LwpHeaderLayout\* LwpPageLayout::GetHeaderLayout() {- LwpVirtualLayout\* pLay = static\_cast<LwpVirtualLayout\*>(GetChildHead()->obj());+ LwpVirtualLayout\* pLay = dynamic\_cast<LwpVirtualLayout\*>(GetChildHead()->obj()); while(pLay) { if( pLay->GetLayoutType() == LWP\_HEADER\_LAYOUT ) return ( static\_cast<LwpHeaderLayout\*> (pLay) );- pLay = static\_cast<LwpVirtualLayout\*> (pLay->GetNext()->obj());+ pLay = dynamic\_cast<LwpVirtualLayout\*> (pLay->GetNext()->obj()); } return NULL; }  LwpFooterLayout\* LwpPageLayout::GetFooterLayout() {- LwpVirtualLayout\* pLay = static\_cast<LwpVirtualLayout\*>(GetChildHead()->obj());+ LwpVirtualLayout\* pLay = dynamic\_cast<LwpVirtualLayout\*>(GetChildHead()->obj()); while(pLay) { if( pLay->GetLayoutType() == LWP\_FOOTER\_LAYOUT ) return ( static\_cast<LwpFooterLayout\*> (pLay) );- pLay = static\_cast<LwpVirtualLayout\*> (pLay->GetNext()->obj());+ pLay = dynamic\_cast<LwpVirtualLayout\*> (pLay->GetNext()->obj()); } return NULL; }@@ -530,7 +532,7 @@ LwpPageLayout\* LwpPageLayout::GetOddChildLayout() { if(IsComplex()) {- LwpVirtualLayout\* pLay = static\_cast<LwpVirtualLayout\*>(GetChildHead()->obj());+ LwpVirtualLayout\* pLay = dynamic\_cast<LwpVirtualLayout\*>(GetChildHead()->obj()); while(pLay) { if( pLay->GetLayoutType() == LWP\_PAGE\_LAYOUT )@@ -542,7 +544,7 @@ LwpPageLayout\* LwpPageLayout::GetOddChildLayout() return pPageLayout; } }- pLay = static\_cast<LwpVirtualLayout\*> (pLay->GetNext()->obj());+ pLay = dynamic\_cast<LwpVirtualLayout\*> (pLay->GetNext()->obj()); } } return NULL;@@ -574,11 +576,11 @@ sal\_Int32 LwpPageLayout::GetPageNumber(sal\_uInt16 nLayoutNumber) sal\_Int16 nPageNumber = -1; LwpFoundry\* pFoundry = this->GetFoundry(); LwpDocument\* pDoc = pFoundry->GetDocument();- LwpDLVListHeadTailHolder\* pHeadTail = static\_cast<LwpDLVListHeadTailHolder\*>(pDoc->GetPageHintsID()->obj());+ LwpDLVListHeadTailHolder\* pHeadTail = dynamic\_cast<LwpDLVListHeadTailHolder\*>(pDoc->GetPageHintsID()->obj()); if(!pHeadTail) return nPageNumber;  //get first pagehint- LwpPageHint\* pPageHint =static\_cast<LwpPageHint\*>(pHeadTail->GetHead()->obj());+ LwpPageHint\* pPageHint = dynamic\_cast<LwpPageHint\*>(pHeadTail->GetHead()->obj()); while(pPageHint) { if(\*(this->GetObjectID()) == \*(pPageHint->GetPageLayoutID()))@@ -608,7 +610,7 @@ sal\_Int32 LwpPageLayout::GetPageNumber(sal\_uInt16 nLayoutNumber) }  }- pPageHint = static\_cast<LwpPageHint\*>(pPageHint->GetNext()->obj());+ pPageHint = dynamic\_cast<LwpPageHint\*>(pPageHint->GetNext()->obj()); } if(nPageNumber>=0) {@@ -709,7 +711,7 @@ sal\_Bool LwpPageLayout::operator<(LwpPageLayout& Other) \*/ LwpPara\* LwpPageLayout::GetPagePosition() {- LwpPara\* pPara = static\_cast<LwpPara\*>(GetPosition()->obj());+ LwpPara\* pPara = dynamic\_cast<LwpPara\*>(GetPosition()->obj()); if(pPara) return pPara; //Get the position from its related section@@ -720,7 +722,7 @@ LwpPara\* LwpPageLayout::GetPagePosition() while( (pSection = pFoundry->EnumSections(pSection)) ) { if(pSection->GetPageLayout() == this)- return static\_cast<LwpPara\*>(pSection->GetPosition()->obj());+ return dynamic\_cast<LwpPara\*>(pSection->GetPosition()->obj()); } } @@ -784,15 +786,15 @@ void LwpHeaderLayout::ParseMargins(XFHeaderStyle\* ph1) }  //Set left,right,bottom margins- LwpMiddleLayout\* parent = static\_cast<LwpMiddleLayout\*> (GetParent()->obj());+ LwpMiddleLayout\* parent = dynamic\_cast<LwpMiddleLayout\*> (GetParent()->obj()); //left margin in SODC: the space from the left edge of body to the left edge of header- double left = GetMarginsValue(MARGIN\_LEFT) - parent->GetMarginsValue(MARGIN\_LEFT);+ double left = GetMarginsValue(MARGIN\_LEFT) - (parent ? parent->GetMarginsValue(MARGIN\_LEFT) : 0); if(left<=0) //The left margin in SODC can not be minus value { left = -1; } //left margin in SODC: the space from the right edge of header to the right edge of body- double right = GetMarginsValue(MARGIN\_RIGHT) - parent->GetMarginsValue(MARGIN\_RIGHT);+ double right = GetMarginsValue(MARGIN\_RIGHT) - (parent ? parent->GetMarginsValue(MARGIN\_RIGHT) : 0); if(right<=0)//The right margin in SODC can not be minus value { right = -1;@@ -952,13 +954,13 @@ void LwpFooterLayout::ParseMargins(XFFooterStyle\* pFooterStyle) }  //Set left,right,top margins- LwpMiddleLayout\* parent = static\_cast<LwpMiddleLayout\*> (GetParent()->obj());- double left = GetMarginsValue(MARGIN\_LEFT) - parent->GetMarginsValue(MARGIN\_LEFT);+ LwpMiddleLayout\* parent = dynamic\_cast<LwpMiddleLayout\*> (GetParent()->obj());+ double left = GetMarginsValue(MARGIN\_LEFT) - (parent ? parent->GetMarginsValue(MARGIN\_LEFT) : 0); if(left<=0) //The left margin in SODC can not be minus value { left = -1; }- double right = GetMarginsValue(MARGIN\_RIGHT) - parent->GetMarginsValue(MARGIN\_RIGHT);+ double right = GetMarginsValue(MARGIN\_RIGHT) - (parent ? parent->GetMarginsValue(MARGIN\_RIGHT) : 0); if(right<=0)//The left margin in SODC can not be minus value { right = -1;diff --git a/lotuswordpro/source/filter/lwppara.cxx b/lotuswordpro/source/filter/lwppara.cxxindex 358d9da81..2c5d70992 100644--- a/[lotuswordpro/source/filter/lwppara.cxx](/libreoffice/filters/tree/lotuswordpro/source/filter/lwppara.cxx?id=03894d18889d7bc79b3d4f000c0df7065ea81ee2)+++ b/[lotuswordpro/source/filter/lwppara.cxx](/libreoffice/filters/tree/lotuswordpro/source/filter/lwppara.cxx?id=278831e37a23e9e2e29ca811c3a5398b7c67464d)@@ -260,12 +260,11 @@ void LwpPara::XFConvert(XFContentContainer\* pCont) { m\_pXFContainer = pCont; - if (static\_cast<LwpStory\*>(m\_Story.obj())->GetDropcapFlag() == sal\_True)+ LwpStory \*pStory = dynamic\_cast<LwpStory\*>(m\_Story.obj());++ if (pStory && pStory->GetDropcapFlag() == sal\_True) { ParseDropcapContent();- /\*LwpObject\* pNextPara = GetNext()->obj();- if(pNextPara)- pNextPara->XFConvert(pCont);\*/ return; } @@ -280,8 +279,8 @@ void LwpPara::XFConvert(XFContentContainer\* pCont) if(m\_SectionStyleName.getLength()>0) { XFSection\* pSection = CreateXFSection();- LwpStory\* pStory = static\_cast<LwpStory\*> ( m\_Story.obj() );- pStory->AddXFContent(pSection);+ if (pStory)+ pStory->AddXFContent(pSection); //pSection->Add(pPara); m\_pXFContainer = pSection; }@@ -310,24 +309,15 @@ void LwpPara::XFConvert(XFContentContainer\* pCont)  if (m\_pBreaks) AddBreakAfter(m\_pXFContainer);-- // maybe useful for futer version- // deleted by- // AddTabStopForTOC();-- //Caller is responsible for calling the next para object- /\*LwpObject\* pNextPara = GetNext()->obj();- if(pNextPara)- pNextPara->XFConvert( m\_pXFContainer );\*/ }  sal\_Bool LwpPara::RegisterMasterPage(XFParaStyle\* pBaseStyle) { sal\_Bool bSuccess = sal\_False; //get story- LwpStory\* pStory = static\_cast<LwpStory\*>(m\_Story.obj());+ LwpStory\* pStory = dynamic\_cast<LwpStory\*>(m\_Story.obj()); //if pagelayout is modified, register the pagelayout- if(pStory->IsPMModified())+ if(pStory && pStory->IsPMModified()) { sal\_Bool bNewSection = sal\_False; bNewSection = pStory->IsNeedSection();@@ -386,7 +376,7 @@ void LwpPara::RegisterStyle() pOverStyle->SetStyleName(A2OUSTR("")); LwpParaProperty\* pProps = m\_pProps; sal\_uInt32 PropType;- LwpParaStyle\* pParaStyle = static\_cast<LwpParaStyle\*>(m\_ParaStyle.obj());+ LwpParaStyle\* pParaStyle = dynamic\_cast<LwpParaStyle\*>(m\_ParaStyle.obj()); while(pProps) { PropType = pProps->GetType();@@ -700,7 +690,7 @@ void LwpPara::RegisterStyle() }  if (pPara && pPara->GetPrevious())- pPrePara = static\_cast<LwpPara\*>(pPara->GetPrevious()->obj(VO\_PARA));+ pPrePara = dynamic\_cast<LwpPara\*>(pPara->GetPrevious()->obj(VO\_PARA)); else pPrePara=NULL; @@ -759,7 +749,7 @@ void LwpPara::RegisterStyle()  if (noSpacing && GetPrevious()) {- LwpPara\* pPrePara = static\_cast<LwpPara\*>(GetPrevious()->obj());+ LwpPara\* pPrePara = dynamic\_cast<LwpPara\*>(GetPrevious()->obj()); if (pPrePara && pPrePara->GetBelowSpacing()!=0) { pOverStyle = new XFParaStyle;@@ -840,8 +830,8 @@ void LwpPara::RegisterTabStyle(XFParaStyle\* pXFParaStyle) LwpTabOverride aFinaOverride; LwpTabOverride\* pBase = NULL; //get the tabrack from the current layout- LwpStory\* pStory = static\_cast<LwpStory\*>(m\_Story.obj());- LwpMiddleLayout\* pLayout = pStory->GetTabLayout();+ LwpStory\* pStory = dynamic\_cast<LwpStory\*>(m\_Story.obj());+ LwpMiddleLayout\* pLayout = pStory ? pStory->GetTabLayout() : NULL; if(pLayout) { pBase = pLayout->GetTabOverride();@@ -925,7 +915,7 @@ LwpVirtualLayout\* LwpPara::GetLayoutWithMyStory() LwpStory\* pMyStory = NULL; if (!m\_Story.IsNull()) {- pMyStory = static\_cast<LwpStory\*>(m\_Story.obj(VO\_STORY));+ pMyStory = dynamic\_cast<LwpStory\*>(m\_Story.obj(VO\_STORY)); if (!pMyStory) { return NULL;diff --git a/lotuswordpro/source/filter/lwppara.hxx b/lotuswordpro/source/filter/lwppara.hxxindex b381d686c..537b72a9f 100644--- a/[lotuswordpro/source/filter/lwppara.hxx](/libreoffice/filters/tree/lotuswordpro/source/filter/lwppara.hxx?id=03894d18889d7bc79b3d4f000c0df7065ea81ee2)+++ b/[lotuswordpro/source/filter/lwppara.hxx](/libreoffice/filters/tree/lotuswordpro/source/filter/lwppara.hxx?id=278831e37a23e9e2e29ca811c3a5398b7c67464d)@@ -386,7 +386,7 @@ inline LwpObjectID\* LwpPara::GetStoryID() inline LwpStory\* LwpPara::GetStory() { if (m\_Story.obj())- return static\_cast<LwpStory\*>(m\_Story.obj());+ return dynamic\_cast<LwpStory\*>(m\_Story.obj()); return NULL; } diff --git a/lotuswordpro/source/filter/lwppara1.cxx b/lotuswordpro/source/filter/lwppara1.cxxindex 957dbea32..6a6184ce8 100644--- a/[lotuswordpro/source/filter/lwppara1.cxx](/libreoffice/filters/tree/lotuswordpro/source/filter/lwppara1.cxx?id=03894d18889d7bc79b3d4f000c0df7065ea81ee2)+++ b/[lotuswordpro/source/filter/lwppara1.cxx](/libreoffice/filters/tree/lotuswordpro/source/filter/lwppara1.cxx?id=278831e37a23e9e2e29ca811c3a5398b7c67464d)@@ -175,13 +175,13 @@ LwpPara\* LwpPara::GetParent()  if (level != 1) {- pPara = static\_cast<LwpPara\*>(GetPrevious()->obj());+ pPara = dynamic\_cast<LwpPara\*>(GetPrevious()->obj()); while (pPara) { otherlevel = pPara->GetLevel(); if ((otherlevel < level) || (otherlevel && (level == 0))) return pPara;- pPara = static\_cast<LwpPara\*>(pPara->GetPrevious()->obj());+ pPara = dynamic\_cast<LwpPara\*>(pPara->GetPrevious()->obj()); } } return NULL;@@ -237,12 +237,12 @@ void LwpPara::GetParaNumber(sal\_uInt16 nPosition, ParaNumbering\* pParaNumbering) //get suffix text frib if ( (pFrib = pFrib->GetNext()) ) {-// if((pFrib->GetType() == FRIB\_TAG\_TEXT) &&-// (pFrib->GetModifiers()->aTxtAttrOverride.GetHideLevels() == nHideLevels)) if( pFrib->GetType() == FRIB\_TAG\_TEXT ) {- if ((pFrib->GetNext()->GetType() == FRIB\_TAG\_TEXT ) ||- (pFrib->GetModifiers()->aTxtAttrOverride.GetHideLevels() == nHideLevels))+ if (+ (pFrib->GetNext() && pFrib->GetNext()->GetType() == FRIB\_TAG\_TEXT) ||+ (pFrib->GetModifiers()->aTxtAttrOverride.GetHideLevels() == nHideLevels)+ ) { pParaNumbering->pSuffix = static\_cast<LwpFribText\*>(pFrib); }@@ -323,21 +323,21 @@ void LwpPara::OverrideSpacing(LwpSpacingOverride\* base,LwpSpacingOverride\* over, { if (base)//the latter two parameter never be null {- over->Override(base);+ if (over)+ over->Override(base); LwpParaStyle::ApplySpacing(this,pOverStyle,base); } else LwpParaStyle::ApplySpacing(this,pOverStyle,over); } -//add by , 01/25/2005 /\*\* \* @short: Get parastyle object according to the objID. \* @return: pointer to the parastyle. \*/ LwpParaStyle\* LwpPara::GetParaStyle() {- return static\_cast<LwpParaStyle\*>(m\_ParaStyle.obj(VO\_PARASTYLE));+ return dynamic\_cast<LwpParaStyle\*>(m\_ParaStyle.obj(VO\_PARASTYLE)); }  /\*\*@@ -488,8 +488,9 @@ void LwpPara::OverrideParaBullet(LwpParaProperty\* pProps) m\_pBullOver = pFinalBullet.release(); if (!aSilverBulletID.IsNull()) {- m\_pSilverBullet = static\_cast<LwpSilverBullet\*>(aSilverBulletID.obj(VO\_SILVERBULLET));- m\_pSilverBullet->SetFoundry(m\_pFoundry);+ m\_pSilverBullet = dynamic\_cast<LwpSilverBullet\*>(aSilverBulletID.obj(VO\_SILVERBULLET));+ if (m\_pSilverBullet)+ m\_pSilverBullet->SetFoundry(m\_pFoundry); }  m\_aSilverBulletID = aSilverBulletID;@@ -506,8 +507,9 @@ void LwpPara::OverrideParaBullet(LwpParaProperty\* pProps) { m\_bHasBullet = sal\_True; - m\_pSilverBullet = static\_cast<LwpSilverBullet\*>(m\_aSilverBulletID.obj(VO\_SILVERBULLET));- m\_pSilverBullet->SetFoundry(m\_pFoundry);+ m\_pSilverBullet = dynamic\_cast<LwpSilverBullet\*>(m\_aSilverBulletID.obj(VO\_SILVERBULLET));+ if (m\_pSilverBullet)+ m\_pSilverBullet->SetFoundry(m\_pFoundry); }  std::auto\_ptr<LwpBulletOverride> pBulletOverride(pBullOver->clone());@@ -578,7 +580,7 @@ void LwpPara::FindLayouts() { m\_Fribs.SetPara(this); m\_Fribs.FindLayouts();- LwpPara\* pNextPara = static\_cast<LwpPara\*>(GetNext()->obj());+ LwpPara\* pNextPara = dynamic\_cast<LwpPara\*>(GetNext()->obj()); if(pNextPara) { pNextPara->FindLayouts();@@ -640,96 +642,15 @@ sal\_Bool LwpPara::ComparePagePosition(LwpVirtualLayout \* pPreLayout, LwpVirtualL m\_Fribs.SetPara(this); return m\_Fribs.ComparePagePosition(pPreLayout, pNextLayout); }-/\*-sal\_Bool LwpPara::IsNeedTabForTOC()-{- LwpStory\* pStory = GetStory();- if(pStory)- {- if(GetNext()->IsNull())- {- LwpVirtualLayout\* pLayout = pStory->GetLayout(NULL);- if(pLayout && pLayout->IsCell())- {- LwpCellLayout \* pCell = static\_cast<LwpCellLayout \*>(pStory->GetLayout(NULL));- if (pCell->GetLeaderChar() == 0)- {- return sal\_False;- }- return sal\_True;- }- }- }- return sal\_False;-}--void LwpPara::AddTabStyleForTOC( )-{- if(IsNeedTabForTOC())- {- XFParaStyle\* pParaStyle = new XFParaStyle;- \*pParaStyle = \*GetXFParaStyle();- pParaStyle->ClearTabStyles();- //Add Tab Style;- enumXFTab eType = enumXFTabRight;-- LwpCellLayout \* pCell = static\_cast<LwpCellLayout \*>(GetStory()->GetLayout(NULL));- double dLen = pCell->GetActualWidth(); /// todo: get from table- sal\_Unicode cLeader = static\_cast<sal\_Unicode>(pCell->GetLeaderChar());- pParaStyle->AddTabStyle(eType, dLen, cLeader );- m\_StyleName = XFStyleManager::AddStyle(pParaStyle)->GetStyleName();-- // Get font info of default text style and set into tab style- XFParaStyle\* pBaseStyle = static\_cast<XFParaStyle\*>(m\_pFoundry->GetStyleManager()->GetStyle(\*m\_pFoundry->GetDefaultTextStyle()));- XFTextStyle\*pTextStyle = new XFTextStyle;- pTextStyle->SetFont(pBaseStyle->GetFont()); // who delete this font?????- m\_TabStyleName = XFStyleManager::AddStyle(pTextStyle)->GetStyleName();- }-} -void LwpPara::AddTabStopForTOC()-{- if(IsNeedTabForTOC())- {- XFParagraph\* pXFPara = GetFribs()->GetXFPara();- pXFPara->SetStyleName(m\_StyleName);-- XFParaStyle\* pParaStyle = static\_cast<XFParaStyle\*>(XFStyleManager::FindStyle(m\_StyleName));- if(pParaStyle)- {- XFTextSpan \*pSpan = new XFTextSpan;- XFTabStop \*pTab = new XFTabStop;- pSpan->Add(pTab);- pSpan->SetStyleName(m\_TabStyleName);- enumXFAlignType eType = pParaStyle->GetAlighType();-- if(eType == enumXFAlignStart || eType == enumXFAlignJustify || eType == enumXFAlignNone)- {- pXFPara->Add(pSpan);- }- else if(eType == enumXFAlignEnd)- {- pXFPara->InsertAtBegin(pSpan);- }- else- {- delete pSpan; // pTabl will be delete inside XFTextSpan- }-- }-- }-}-\*/ /\*\* \* @short check paragraph alignment \*/ sal\_Bool LwpPara::IsNumberRight() {- LwpObject\* pObj = m\_ParaStyle.obj();- if (pObj)+ LwpParaStyle\* pStyle = dynamic\_cast<LwpParaStyle\*>(m\_ParaStyle.obj());+ if (pStyle) {- LwpParaStyle\* pStyle = static\_cast<LwpParaStyle\*>(pObj); return pStyle->IsNumberRight(); } else@@ -740,7 +661,8 @@ sal\_Bool LwpPara::IsNumberRight() \*/ sal\_Bool LwpPara::IsInCell() {- LwpVirtualLayout\* pLayout = GetStory()->GetLayout(NULL);+ LwpStory \*pStory = GetStory();+ LwpVirtualLayout\* pLayout = pStory ? pStory->GetLayout(NULL) : NULL; if(pLayout && pLayout->IsCell()) return sal\_True; return sal\_False;diff --git a/lotuswordpro/source/filter/lwpparaproperty.cxx b/lotuswordpro/source/filter/lwpparaproperty.cxxindex 6303244fe..509b06aaa 100644--- a/[lotuswordpro/source/filter/lwpparaproperty.cxx](/libreoffice/filters/tree/lotuswordpro/source/filter/lwpparaproperty.cxx?id=03894d18889d7bc79b3d4f000c0df7065ea81ee2)+++ b/[lotuswordpro/source/filter/lwpparaproperty.cxx](/libreoffice/filters/tree/lotuswordpro/source/filter/lwpparaproperty.cxx?id=278831e37a23e9e2e29ca811c3a5398b7c67464d)@@ -74,13 +74,19 @@ LwpParaProperty\* LwpParaProperty::ReadPropertyList(LwpObjectStream\* pFile,LwpObj  for(;;) {- pFile->QuickRead(&tag,sizeof(sal\_uInt32));- // Keep reading properties until we hit the end tag- if (tag == TAG\_ENDSUBOBJ)+ sal\_uInt16 nRead;++ nRead = pFile->QuickRead(&tag,sizeof(sal\_uInt32));+ // Keep reading properties until we hit the end tag or+ // the stream ends+ if (tag == TAG\_ENDSUBOBJ || nRead != sizeof(sal\_uInt32)) break;  // Get the length of this property- pFile->QuickRead(&Len,sizeof(sal\_uInt16));+ nRead = pFile->QuickRead(&Len,sizeof(sal\_uInt16));++ if (nRead != sizeof(sal\_uInt16))+ break;  // Create whatever kind of tag we just found switch (tag)@@ -121,21 +127,8 @@ LwpParaProperty\* LwpParaProperty::ReadPropertyList(LwpObjectStream\* pFile,LwpObj case TAG\_PARA\_TAB: NewProp = new LwpParaTabRackProperty(pFile); break;-/\*-#ifdef KINSOKU- case TAG\_PARA\_KINSOKU:- NewProp = new CParaKinsokuProperty(pFile);- break;-#endif - case TAG\_PARA\_PROPLIST:- NewProp = new CParaPropListProperty(pFile,Whole);- break;-- case TAG\_PARA\_SHOW:- case TAG\_PARA\_HIDE:- // Ignore these properties-\*/ default:+ default: pFile->SeekRel(Len); NewProp = NULL; break;@@ -152,24 +145,12 @@ LwpParaProperty\* LwpParaProperty::ReadPropertyList(LwpObjectStream\* pFile,LwpObj  LwpParaAlignProperty::LwpParaAlignProperty(LwpObjectStream\* pFile) {-// pFile->SeekRel(3);- LwpObjectID align;- align.ReadIndexed(pFile);- m\_pAlignment =static\_cast<LwpAlignmentOverride\*>- (static\_cast<LwpAlignmentPiece\*>(align.obj(VO\_ALIGNMENTPIECE))->GetOverride());-/\* if(pFile->GetFileRevision() < 0x000b)- {- CAlignmentPieceGuts guts;- CAlignmentPiece::QuickReadGuts(pFile, &guts);- cAlignment = GetPieceManager()->GetAlignmentPiece(&guts);- }- else- {- LwpFoundry\* OldFoundry = pFile->GetFoundry();- pFile->SetFoundry(GetPieceManager()->GetFoundry());- cAlignment.QuickRead(pFile);- pFile->SetFoundry(OldFoundry);- } \*/+ LwpObjectID align;+ align.ReadIndexed(pFile);++ LwpAlignmentPiece \*pAlignmentPiece = dynamic\_cast<LwpAlignmentPiece\*>(align.obj(VO\_ALIGNMENTPIECE));+ m\_pAlignment = pAlignmentPiece ? dynamic\_cast<LwpAlignmentOverride\*>(pAlignmentPiece->GetOverride()) : NULL;+ }  LwpParaAlignProperty::~LwpParaAlignProperty(void)@@ -183,10 +164,10 @@ sal\_uInt32 LwpParaAlignProperty::GetType(void)  LwpParaIndentProperty::LwpParaIndentProperty(LwpObjectStream\* pFile) {-// LwpObjectID indent; m\_aIndentID.ReadIndexed(pFile);- m\_pIndent = static\_cast<LwpIndentOverride\*>- (static\_cast<LwpIndentPiece\*>(m\_aIndentID.obj(VO\_INDENTPIECE))->GetOverride());++ LwpIndentPiece \*pIndentPiece = dynamic\_cast<LwpIndentPiece\*>(m\_aIndentID.obj(VO\_INDENTPIECE));+ m\_pIndent = pIndentPiece ? dynamic\_cast<LwpIndentOverride\*>(pIndentPiece->GetOverride()) : NULL; }  LwpParaIndentProperty::~LwpParaIndentProperty(void)@@ -202,8 +183,9 @@ LwpParaSpacingProperty::LwpParaSpacingProperty(LwpObjectStream\* pFile) { LwpObjectID spacing; spacing.ReadIndexed(pFile);- m\_pSpacing = static\_cast<LwpSpacingOverride\*>- (static\_cast<LwpSpacingPiece\*>(spacing.obj(VO\_SPACINGPIECE))->GetOverride());++ LwpSpacingPiece \*pSpacingPiece = dynamic\_cast<LwpSpacingPiece\*>(spacing.obj(VO\_SPACINGPIECE));+ m\_pSpacing = pSpacingPiece ? dynamic\_cast<LwpSpacingOverride\*>(pSpacingPiece->GetOverride()) : NULL; }  LwpParaSpacingProperty::~LwpParaSpacingProperty(void)@@ -224,8 +206,8 @@ m\_pParaBorderOverride(NULL)  if (!aParaBorder.IsNull()) {- m\_pParaBorderOverride = static\_cast<LwpParaBorderOverride\*>- (static\_cast<LwpParaBorderPiece\*>(aParaBorder.obj())->GetOverride());+ LwpParaBorderPiece \*pParaBorderPiece = dynamic\_cast<LwpParaBorderPiece\*>(aParaBorder.obj());+ m\_pParaBorderOverride = pParaBorderPiece ? dynamic\_cast<LwpParaBorderOverride\*>(pParaBorderPiece->GetOverride()) : NULL; } } @@ -237,8 +219,8 @@ m\_pBreaks(NULL)  if (!aBreaks.IsNull()) {- m\_pBreaks = static\_cast<LwpBreaksOverride\*>- (static\_cast<LwpBreaksPiece\*>(aBreaks.obj())->GetOverride());+ LwpBreaksPiece \*pBreaksPiece = dynamic\_cast<LwpBreaksPiece\*>(aBreaks.obj());+ m\_pBreaks = pBreaksPiece ? dynamic\_cast<LwpBreaksOverride\*>(pBreaksPiece->GetOverride()) : NULL; } } @@ -265,9 +247,8 @@ LwpParaNumberingProperty::LwpParaNumberingProperty(LwpObjectStream \* pStrm) return; } - m\_pNumberingOverride = static\_cast<LwpNumberingOverride\*>- (static\_cast<LwpNumberingPiece\*>(aNumberingPiece.obj(VO\_NUMBERINGPIECE))->GetOverride());-+ LwpNumberingPiece \*pNumberingPiece = dynamic\_cast<LwpNumberingPiece\*>(aNumberingPiece.obj(VO\_NUMBERINGPIECE));+ m\_pNumberingOverride = pNumberingPiece ? dynamic\_cast<LwpNumberingOverride\*>(pNumberingPiece->GetOverride()) : NULL; } //end////////////////////////////////////////////////////////////////////// @@ -275,7 +256,9 @@ LwpParaTabRackProperty::LwpParaTabRackProperty(LwpObjectStream\* pFile) { LwpObjectID aTabRack; aTabRack.ReadIndexed(pFile);- m\_pTabOverride =static\_cast<LwpTabOverride\*>(static\_cast<LwpTabPiece\*>(aTabRack.obj())->GetOverride());++ LwpTabPiece \*pTabPiece = dynamic\_cast<LwpTabPiece\*>(aTabRack.obj());+ m\_pTabOverride = pTabPiece ? dynamic\_cast<LwpTabOverride\*>(pTabPiece->GetOverride()) : NULL; }  LwpParaTabRackProperty::~LwpParaTabRackProperty()@@ -286,8 +269,9 @@ LwpParaBackGroundProperty::LwpParaBackGroundProperty(LwpObjectStream\* pFile) { LwpObjectID background; background.ReadIndexed(pFile);- m\_pBackground = static\_cast<LwpBackgroundOverride\*>(- static\_cast<LwpBackgroundPiece\*>(background.obj())->GetOverride());++ LwpBackgroundPiece \*pBackgroundPiece = dynamic\_cast<LwpBackgroundPiece\*>(background.obj());+ m\_pBackground = pBackgroundPiece ? dynamic\_cast<LwpBackgroundOverride\*>(pBackgroundPiece->GetOverride()) : NULL; }  LwpParaBackGroundProperty::~LwpParaBackGroundProperty()diff --git a/lotuswordpro/source/filter/lwpparastyle.cxx b/lotuswordpro/source/filter/lwpparastyle.cxxindex ddc23ac10..392f6dab7 100644--- a/[lotuswordpro/source/filter/lwpparastyle.cxx](/libreoffice/filters/tree/lotuswordpro/source/filter/lwpparastyle.cxx?id=03894d18889d7bc79b3d4f000c0df7065ea81ee2)+++ b/[lotuswordpro/source/filter/lwpparastyle.cxx](/libreoffice/filters/tree/lotuswordpro/source/filter/lwpparastyle.cxx?id=278831e37a23e9e2e29ca811c3a5398b7c67464d)@@ -157,24 +157,27 @@ void LwpParaStyle::Read() } } -void LwpParaStyle::Apply(XFParaStyle \*pParaStyle)+void LwpParaStyle::Apply(XFParaStyle \*pParaStyle) { assert(pParaStyle);+ if (!pParaStyle)+ return;+ LwpVirtualPiece \*pPiece = NULL; //alignment:- pPiece = (LwpVirtualPiece\*)m\_AlignmentStyle.obj();+ pPiece = dynamic\_cast<LwpVirtualPiece\*>(m\_AlignmentStyle.obj()); if( pPiece ) {- LwpAlignmentOverride \*pAlign = (LwpAlignmentOverride\*)pPiece->GetOverride();+ LwpAlignmentOverride \*pAlign = dynamic\_cast<LwpAlignmentOverride\*>(pPiece->GetOverride()); if( pAlign ) ApplyAlignment(pParaStyle,pAlign); }  //don't known top and bottom indent now.- pPiece = (LwpVirtualPiece\*)m\_IndentStyle.obj();+ pPiece = dynamic\_cast<LwpVirtualPiece\*>(m\_IndentStyle.obj()); if( pPiece ) {- LwpIndentOverride \*pIndent = (LwpIndentOverride\*)pPiece->GetOverride();+ LwpIndentOverride \*pIndent = dynamic\_cast<LwpIndentOverride\*>(pPiece->GetOverride()); if( pIndent ) { if (!m\_pBulletOverride->IsInValid())//Add by ,for remove bullet indent in named bullet style@@ -189,29 +192,29 @@ void LwpParaStyle::Apply(XFParaStyle \*pParaStyle) } } //shadow & borders.- pPiece = (LwpVirtualPiece\*)m\_BorderStyle.obj();+ pPiece = dynamic\_cast<LwpVirtualPiece\*>(m\_BorderStyle.obj()); if( pPiece ) {- LwpParaBorderOverride \*pBorder = (LwpParaBorderOverride\*)pPiece->GetOverride();+ LwpParaBorderOverride \*pBorder = dynamic\_cast<LwpParaBorderOverride\*>(pPiece->GetOverride()); if( pBorder ) { this->ApplyParaBorder(pParaStyle, pBorder); } } - pPiece = (LwpVirtualPiece\*)m\_SpacingStyle.obj();+ pPiece = dynamic\_cast<LwpVirtualPiece\*>(m\_SpacingStyle.obj()); if (pPiece) {- LwpSpacingOverride \*pSpacing = (LwpSpacingOverride\*)pPiece->GetOverride();+ LwpSpacingOverride \*pSpacing = dynamic\_cast<LwpSpacingOverride\*>(pPiece->GetOverride()); if( pSpacing) ApplySpacing(NULL,pParaStyle,pSpacing); }  //paragraph background.- pPiece = (LwpVirtualPiece\*)m\_BackgroundStyle.obj();+ pPiece = dynamic\_cast<LwpVirtualPiece\*>(m\_BackgroundStyle.obj()); if( pPiece ) {- LwpBackgroundOverride \*pBack = (LwpBackgroundOverride\*)pPiece->GetOverride();+ LwpBackgroundOverride \*pBack = dynamic\_cast<LwpBackgroundOverride\*>(pPiece->GetOverride()); if( pBack ) { LwpColor color = pBack->GetBackColor();@@ -222,19 +225,19 @@ void LwpParaStyle::Apply(XFParaStyle \*pParaStyle)   //add tab style- pPiece = (LwpVirtualPiece\*)m\_TabStyle.obj();+ pPiece = dynamic\_cast<LwpVirtualPiece\*>(m\_TabStyle.obj()); if( pPiece ) {- LwpTabOverride \*pTab=(LwpTabOverride\*)pPiece->GetOverride();+ LwpTabOverride \*pTab = dynamic\_cast<LwpTabOverride\*>(pPiece->GetOverride()); if(pTab) { ApplyTab(pParaStyle,pTab); } }- pPiece = (LwpVirtualPiece\*)m\_BreaksStyle.obj();+ pPiece = dynamic\_cast<LwpVirtualPiece\*>(m\_BreaksStyle.obj()); if( pPiece ) {- LwpBreaksOverride \*pBreak=(LwpBreaksOverride\*)pPiece->GetOverride();+ LwpBreaksOverride \*pBreak = dynamic\_cast<LwpBreaksOverride\*>(pPiece->GetOverride()); if(pBreak) { ApplyBreaks(pParaStyle,pBreak);@@ -587,7 +590,7 @@ void LwpParaStyle::ApplySpacing(LwpPara\* pPara, XFParaStyle\* pParaStyle, LwpSpac { if (below\_val != -1) pPara->SetBelowSpacing(below\_val);- LwpPara\* pPrePara = static\_cast<LwpPara\*>(pPara->GetPrevious()->obj());+ LwpPara\* pPrePara = dynamic\_cast<LwpPara\*>(pPara->GetPrevious()->obj()); if (pPrePara && above\_val != -1) { above\_val += pPrePara->GetBelowSpacing();@@ -613,7 +616,7 @@ void LwpParaStyle::ApplyTab(XFParaStyle \*pParaStyle, LwpTabOverride \*pTabOverRid return; } - LwpTabRack\* pTabRack = static\_cast<LwpTabRack\*>(pTabRackID->obj());+ LwpTabRack\* pTabRack = dynamic\_cast<LwpTabRack\*>(pTabRackID->obj()); if(!pTabRack) { //assert(false);@@ -701,58 +704,61 @@ void LwpParaStyle::RegisterStyle() //Add style LwpStyleManager\* pStyleMgr = m\_pFoundry->GetStyleManager(); pStyleMgr->AddStyle(\*GetObjectID(), pStyle);--/\* // add list style for bullet- if (!m\_pBulletOverride)- {- return;- }- LwpSilverBullet\* pSilverBullet = static\_cast<LwpSilverBullet\*>(m\_pBulletOverride->GetSilverBullet().obj());- if (!pSilverBullet)- {- return;- }-- pSilverBullet->SetFoundry(m\_pFoundry);- pSilverBullet->RegisterStyle();\*/ }  LwpAlignmentOverride\* LwpParaStyle::GetAlignment() {- if (m\_AlignmentStyle.obj()!= NULL)- return static\_cast<LwpAlignmentOverride\*>(static\_cast<LwpAlignmentPiece\*>(m\_AlignmentStyle.obj())->GetOverride());- else+ if (m\_AlignmentStyle.obj() == NULL) return NULL;++ LwpAlignmentPiece \*pPiece = dynamic\_cast<LwpAlignmentPiece\*>(m\_AlignmentStyle.obj());+ if (pPiece)+ return dynamic\_cast<LwpAlignmentOverride\*>(pPiece->GetOverride());+ return NULL; }  LwpIndentOverride\* LwpParaStyle::GetIndent() {- if (m\_IndentStyle.obj() != NULL)- return static\_cast<LwpIndentOverride\*>(static\_cast<LwpIndentPiece\*>(m\_IndentStyle.obj())->GetOverride());- else+ if (m\_IndentStyle.obj() == NULL) return NULL;++ LwpIndentPiece \*pPiece = dynamic\_cast<LwpIndentPiece\*>(m\_IndentStyle.obj());+ if (pPiece)+ return dynamic\_cast<LwpIndentOverride\*>(pPiece->GetOverride());+ return NULL; }  LwpSpacingOverride\* LwpParaStyle::GetSpacing() {- if (m\_SpacingStyle.obj() != NULL)- return static\_cast<LwpSpacingOverride\*>(static\_cast<LwpSpacingPiece\*>(m\_SpacingStyle.obj())->GetOverride());- else+ if (m\_SpacingStyle.obj() == NULL) return NULL;++ LwpSpacingPiece \*pPiece = dynamic\_cast<LwpSpacingPiece\*>(m\_SpacingStyle.obj());+ if (pPiece)+ return dynamic\_cast<LwpSpacingOverride\*>(pPiece->GetOverride());+ return NULL; }  LwpParaBorderOverride\* LwpParaStyle::GetParaBorder() const {- if(m\_BorderStyle.IsNull()) return NULL;- return static\_cast<LwpParaBorderOverride\*>- (static\_cast<LwpParaBorderPiece\*>(m\_BorderStyle.obj(VO\_PARABORDERPIECE))->GetOverride());+ if(m\_BorderStyle.IsNull())+ return NULL;++ LwpParaBorderPiece \*pPiece = dynamic\_cast<LwpParaBorderPiece\*>(m\_BorderStyle.obj(VO\_PARABORDERPIECE));+ if (pPiece)+ return dynamic\_cast<LwpParaBorderOverride\*>(pPiece->GetOverride());+ return NULL; }  LwpBreaksOverride\* LwpParaStyle::GetBreaks() const {- if(m\_BreaksStyle.IsNull()) return NULL;- return static\_cast<LwpBreaksOverride\*>- (static\_cast<LwpBreaksPiece\*>(m\_BreaksStyle.obj(VO\_BREAKSPIECE))->GetOverride());+ if(m\_BreaksStyle.IsNull())+ return NULL;++ LwpBreaksPiece \*pPiece = dynamic\_cast<LwpBreaksPiece\*>(m\_BreaksStyle.obj(VO\_BREAKSPIECE));+ if (pPiece)+ return dynamic\_cast<LwpBreaksOverride\*>(pPiece->GetOverride());+ return NULL; }  LwpBulletOverride\* LwpParaStyle::GetBulletOverride() const@@ -762,9 +768,13 @@ LwpBulletOverride\* LwpParaStyle::GetBulletOverride() const  LwpNumberingOverride\* LwpParaStyle::GetNumberingOverride() const {- if(m\_NumberingStyle.IsNull()) return NULL;- return static\_cast<LwpNumberingOverride\*>- (static\_cast<LwpNumberingPiece\*>(m\_NumberingStyle.obj(VO\_NUMBERINGPIECE))->GetOverride());+ if(m\_NumberingStyle.IsNull())+ return NULL;++ LwpNumberingPiece \*pPiece = dynamic\_cast<LwpNumberingPiece\*>(m\_NumberingStyle.obj(VO\_NUMBERINGPIECE));+ if (pPiece)+ return dynamic\_cast<LwpNumberingOverride\*>(pPiece->GetOverride());+ return NULL; }  @@ -777,10 +787,12 @@ LwpNumberingOverride\* LwpParaStyle::GetNumberingOverride() const \*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*/ LwpTabOverride\* LwpParaStyle::GetTabOverride() const {- if(m\_TabStyle.obj() != NULL)- return (LwpTabOverride\*)static\_cast<LwpTabPiece\*>(m\_TabStyle.obj())->GetOverride();- else+ if(m\_TabStyle.obj() == NULL) return NULL;+ LwpTabPiece \*pPiece = dynamic\_cast<LwpTabPiece\*>(m\_TabStyle.obj());+ if (pPiece)+ return dynamic\_cast<LwpTabOverride\*>(pPiece->GetOverride());+ return NULL; }  sal\_Bool LwpParaStyle::IsNumberRight()diff --git a/lotuswordpro/source/filter/lwprowlayout.cxx b/lotuswordpro/source/filter/lwprowlayout.cxxindex f97e3d921..7aab8f795 100644--- a/[lotuswordpro/source/filter/lwprowlayout.cxx](/libreoffice/filters/tree/lotuswordpro/source/filter/lwprowlayout.cxx?id=03894d18889d7bc79b3d4f000c0df7065ea81ee2)+++ b/[lotuswordpro/source/filter/lwprowlayout.cxx](/libreoffice/filters/tree/lotuswordpro/source/filter/lwprowlayout.cxx?id=278831e37a23e9e2e29ca811c3a5398b7c67464d)@@ -91,14 +91,14 @@ LwpRowLayout::~LwpRowLayout() void LwpRowLayout::SetRowMap(void) { LwpObjectID \*pCellID= GetChildHead();- LwpCellLayout \* pCellLayout = static\_cast<LwpCellLayout \*>(pCellID->obj());+ LwpCellLayout \* pCellLayout = dynamic\_cast<LwpCellLayout \*>(pCellID->obj());  while(pCellLayout) { pCellLayout->SetCellMap();  pCellID = pCellLayout->GetNext();- pCellLayout = static\_cast<LwpCellLayout \*>(pCellID->obj());+ pCellLayout = dynamic\_cast<LwpCellLayout \*>(pCellID->obj()); } } /\*\*@@ -131,14 +131,14 @@ void LwpRowLayout::RegisterStyle() } // register cells' style LwpObjectID \*pCellID= GetChildHead();- LwpCellLayout \* pCellLayout = static\_cast<LwpCellLayout \*>(pCellID->obj());+ LwpCellLayout \* pCellLayout = dynamic\_cast<LwpCellLayout \*>(pCellID->obj());  while(pCellLayout) { pCellLayout->SetFoundry(m\_pFoundry); pCellLayout->RegisterStyle(); pCellID = pCellLayout->GetNext();- pCellLayout = static\_cast<LwpCellLayout \*>(pCellID->obj());+ pCellLayout = dynamic\_cast<LwpCellLayout \*>(pCellID->obj()); }  }@@ -375,7 +375,7 @@ void LwpRowLayout::ConvertCommonRow(XFTable\* pXFTable,sal\_uInt8 nStartCol,sal\_uI { // add row to table LwpObjectID \*pCellID= GetChildHead();- LwpCellLayout \* pCellLayout = static\_cast<LwpCellLayout \*>(pCellID->obj());+ LwpCellLayout \* pCellLayout = dynamic\_cast<LwpCellLayout \*>(pCellID->obj()); nCellStartCol = i;//mark the begin position of cell nCellEndCol = i;//mark the end position of cell while(pCellLayout)@@ -392,7 +392,7 @@ void LwpRowLayout::ConvertCommonRow(XFTable\* pXFTable,sal\_uInt8 nStartCol,sal\_uI break; } pCellID = pCellLayout->GetNext();- pCellLayout = static\_cast<LwpCellLayout \*>(pCellID->obj());+ pCellLayout = dynamic\_cast<LwpCellLayout \*>(pCellID->obj()); } if (!pCellLayout) {@@ -423,7 +423,7 @@ void LwpRowLayout::ConvertCommonRow(XFTable\* pXFTable,sal\_uInt8 nStartCol,sal\_uI void LwpRowLayout::CollectMergeInfo() { LwpObjectID \*pCellID= GetChildHead();- LwpCellLayout \* pCellLayout = static\_cast<LwpCellLayout \*>(pCellID->obj());+ LwpCellLayout \* pCellLayout = dynamic\_cast<LwpCellLayout \*>(pCellID->obj());  while(pCellLayout) {@@ -433,7 +433,7 @@ void LwpRowLayout::CollectMergeInfo() m\_ConnCellList.push\_back(pConnCell); } pCellID = pCellLayout->GetNext();- pCellLayout = static\_cast<LwpCellLayout \*>(pCellID->obj());+ pCellLayout = dynamic\_cast<LwpCellLayout \*>(pCellID->obj()); } } /\*\*@@ -481,7 +481,7 @@ void LwpRowHeadingLayout::Read()  LwpRowLayout \* LwpRowHeadingLayout::GetRowLayout() {- LwpRowLayout \* pRow = static\_cast<LwpRowLayout \*>(cRowLayout.obj());+ LwpRowLayout \* pRow = dynamic\_cast<LwpRowLayout \*>(cRowLayout.obj()); return pRow; } diff --git a/lotuswordpro/source/filter/lwprowlayout.hxx b/lotuswordpro/source/filter/lwprowlayout.hxxindex 8cc58c280..88c4ee67b 100644--- a/[lotuswordpro/source/filter/lwprowlayout.hxx](/libreoffice/filters/tree/lotuswordpro/source/filter/lwprowlayout.hxx?id=03894d18889d7bc79b3d4f000c0df7065ea81ee2)+++ b/[lotuswordpro/source/filter/lwprowlayout.hxx](/libreoffice/filters/tree/lotuswordpro/source/filter/lwprowlayout.hxx?id=278831e37a23e9e2e29ca811c3a5398b7c67464d)@@ -85,7 +85,7 @@ public: virtual LWP\_LAYOUT\_TYPE GetLayoutType () { return LWP\_ROW\_LAYOUT;} sal\_uInt16 GetRowID() { return crowid;} virtual void RegisterStyle();- inline LwpTableLayout \* GetParentTableLayout(){return static\_cast<LwpTableLayout \*>(GetParent()->obj());}+ inline LwpTableLayout \* GetParentTableLayout(){return dynamic\_cast<LwpTableLayout \*>(GetParent()->obj());} void SetRowMap(void); protected: void Read();diff --git a/lotuswordpro/source/filter/lwpsection.hxx b/lotuswordpro/source/filter/lwpsection.hxxindex d401d826f..0d0109891 100644--- a/[lotuswordpro/source/filter/lwpsection.hxx](/libreoffice/filters/tree/lotuswordpro/source/filter/lwpsection.hxx?id=03894d18889d7bc79b3d4f000c0df7065ea81ee2)+++ b/[lotuswordpro/source/filter/lwpsection.hxx](/libreoffice/filters/tree/lotuswordpro/source/filter/lwpsection.hxx?id=278831e37a23e9e2e29ca811c3a5398b7c67464d)@@ -127,7 +127,7 @@ inline sal\_uInt16 LwpSection::GetFlags() \*/ inline LwpPageLayout\* LwpSection::GetPageLayout() {- return static\_cast<LwpPageLayout\*>(m\_PageLayout.obj());+ return dynamic\_cast<LwpPageLayout\*>(m\_PageLayout.obj()); }  /\*\*diff --git a/lotuswordpro/source/filter/lwpsilverbullet.cxx b/lotuswordpro/source/filter/lwpsilverbullet.cxxindex ae2904c3e..9f022c855 100644--- a/[lotuswordpro/source/filter/lwpsilverbullet.cxx](/libreoffice/filters/tree/lotuswordpro/source/filter/lwpsilverbullet.cxx?id=03894d18889d7bc79b3d4f000c0df7065ea81ee2)+++ b/[lotuswordpro/source/filter/lwpsilverbullet.cxx](/libreoffice/filters/tree/lotuswordpro/source/filter/lwpsilverbullet.cxx?id=278831e37a23e9e2e29ca811c3a5398b7c67464d)@@ -245,13 +245,13 @@ LwpPara\* LwpSilverBullet::GetBulletPara() { if (!m\_pBulletPara) {- LwpStory\* pStory = static\_cast<LwpStory\*>(m\_aStory.obj(VO\_STORY));+ LwpStory\* pStory = dynamic\_cast<LwpStory\*>(m\_aStory.obj(VO\_STORY)); if (!pStory) { return NULL; } - m\_pBulletPara = static\_cast<LwpPara\*>(pStory->GetFirstPara()->obj(VO\_PARA));+ m\_pBulletPara = dynamic\_cast<LwpPara\*>(pStory->GetFirstPara()->obj(VO\_PARA)); }  return m\_pBulletPara;@@ -333,7 +333,15 @@ rtl::OUString LwpSilverBullet::GetNumCharByStyleID(LwpFribParaNumber\* pParaNumbe \*/ sal\_Bool LwpSilverBullet::IsBulletOrdered() {- return (sal\_Bool)(m\_pBulletPara->GetFribs()->HasFrib(FRIB\_TAG\_PARANUMBER) != NULL);+ if (!m\_pBulletPara)+ return sal\_False;++ LwpFribPtr\* pFribs = m\_pBulletPara->GetFribs();++ if (!pFribs)+ return sal\_False;++ return (sal\_Bool)(pFribs->HasFrib(FRIB\_TAG\_PARANUMBER) != NULL); }  /\*\*@@ -434,7 +442,9 @@ rtl::OUString LwpSilverBullet::GetDivisionName() LwpObjectID\* pID = pDoc->GetDivInfoID(); if (!pID->IsNull()) {- aRet = static\_cast<LwpDivInfo\*>(pID->obj(VO\_DIVISIONINFO))->GetDivName();+ LwpDivInfo \*pInfo = dynamic\_cast<LwpDivInfo\*>(pID->obj(VO\_DIVISIONINFO));+ if (pInfo)+ aRet = pInfo->GetDivName(); } } @@ -443,7 +453,7 @@ rtl::OUString LwpSilverBullet::GetDivisionName()  rtl::OUString LwpSilverBullet::GetSectionName() {- LwpStory\* pStory = static\_cast<LwpStory\*>(m\_aStory.obj(VO\_STORY));+ LwpStory\* pStory = dynamic\_cast<LwpStory\*>(m\_aStory.obj(VO\_STORY)); if (!pStory) { return rtl::OUString();diff --git a/lotuswordpro/source/filter/lwpstory.cxx b/lotuswordpro/source/filter/lwpstory.cxxindex 9e9109d84..4cbd0ccaf 100644--- a/[lotuswordpro/source/filter/lwpstory.cxx](/libreoffice/filters/tree/lotuswordpro/source/filter/lwpstory.cxx?id=03894d18889d7bc79b3d4f000c0df7065ea81ee2)+++ b/[lotuswordpro/source/filter/lwpstory.cxx](/libreoffice/filters/tree/lotuswordpro/source/filter/lwpstory.cxx?id=278831e37a23e9e2e29ca811c3a5398b7c67464d)@@ -99,7 +99,7 @@ void LwpStory::XFConvert(XFContentContainer\* pCont) XFConvertFrameInFrame(pCont); //process para list XFContentContainer\* pParaCont = pCont;- LwpPara\* pPara = static\_cast<LwpPara\*> ( GetFirstPara()->obj() );+ LwpPara\* pPara = dynamic\_cast<LwpPara\*> ( GetFirstPara()->obj() ); while(pPara) { pPara->SetFoundry(m\_pFoundry);@@ -107,7 +107,7 @@ void LwpStory::XFConvert(XFContentContainer\* pCont)  //Get the xfcontainer for the next para pParaCont = pPara->GetXFContainer();- pPara = static\_cast<LwpPara\*> ( pPara->GetNext()->obj() );+ pPara = dynamic\_cast<LwpPara\*> ( pPara->GetNext()->obj() ); }  //process frame which anchor is to cell after converter all the para@@ -115,12 +115,12 @@ void LwpStory::XFConvert(XFContentContainer\* pCont) XFConvertFrameInHeaderFooter(pCont);  //Release Lwp Objects- LwpPara\* pCur = static\_cast<LwpPara\*> (GetFirstPara()->obj());+ LwpPara\* pCur = dynamic\_cast<LwpPara\*> (GetFirstPara()->obj()); LwpPara\* pNext; while(pCur) { pCur->Release();- pNext = static\_cast<LwpPara\*> ( pCur->GetNext()->obj() );+ pNext = dynamic\_cast<LwpPara\*> ( pCur->GetNext()->obj() ); LwpGlobalMgr\* pGlobal = LwpGlobalMgr::GetInstance(); LwpObjectFactory\* pObjMgr = pGlobal->GetLwpObjFactory(); pObjMgr->ReleaseObject(\*pCur->GetObjectID());@@ -130,12 +130,12 @@ void LwpStory::XFConvert(XFContentContainer\* pCont)  void LwpStory::RegisterStyle() {- LwpPara\* pPara = static\_cast<LwpPara\*>( GetFirstPara()->obj() );+ LwpPara\* pPara = dynamic\_cast<LwpPara\*>( GetFirstPara()->obj() ); while(pPara) { pPara->SetFoundry(m\_pFoundry); pPara->RegisterStyle();- pPara = static\_cast<LwpPara\*>(pPara->GetNext()->obj());+ pPara = dynamic\_cast<LwpPara\*>(pPara->GetNext()->obj()); } } @@ -232,7 +232,7 @@ void LwpStory::SortPageLayout() LwpLayout::UseWhenType eSectionType = static\_cast<LwpPageLayout\*>(pLayout)->GetUseWhenType(); //for mirror page, the child is pagelayout LwpVirtualLayout\* pParent = pLayout->GetParentLayout();- if(eSectionType != LwpLayout::StartWithinColume && !pParent->IsPage())+ if(eSectionType != LwpLayout::StartWithinColume && pParent && !pParent->IsPage()) { aLayoutList.push\_back(static\_cast<LwpPageLayout\*>(pLayout)); }@@ -240,22 +240,23 @@ void LwpStory::SortPageLayout() pLayout = GetLayout(pLayout); } // sort the pagelayout according to their position- LwpPageLayout\* pTemp = NULL; std::vector<LwpPageLayout\*>::iterator aIt;- std::vector<LwpPageLayout\*>::iterator bIt;- for( aIt = aLayoutList.begin(); aIt != aLayoutList.end() -1; ++aIt)+ if (!aLayoutList.empty()) {- for( bIt = aIt +1; bIt != aLayoutList.end(); ++bIt )+ for( aIt = aLayoutList.begin(); aIt != aLayoutList.end() -1; ++aIt) {- if(\*\*aIt < \*\*bIt)+ for( std::vector<LwpPageLayout\*>::iterator bIt = aIt +1; bIt != aLayoutList.end(); ++bIt ) {- continue;- }- else- {- pTemp = \*aIt;- \*aIt = \*bIt;- \*bIt = pTemp;+ if(\*\*aIt < \*\*bIt)+ {+ continue;+ }+ else+ {+ LwpPageLayout\* pTemp = \*aIt;+ \*aIt = \*bIt;+ \*bIt = pTemp;+ } } } }@@ -333,7 +334,7 @@ void LwpStory::XFConvertFrame(XFContentContainer\* pCont) LwpVirtualLayout\* pLayout = GetLayout(NULL); while(pLayout) {- LwpVirtualLayout\* pFrameLayout = static\_cast<LwpVirtualLayout\*>(pLayout->GetChildHead()->obj());+ LwpVirtualLayout\* pFrameLayout = dynamic\_cast<LwpVirtualLayout\*>(pLayout->GetChildHead()->obj()); while(pFrameLayout) { if((pFrameLayout->IsAnchorPage()&&(pFrameLayout->IsFrame()||pFrameLayout->IsSuperTable()||pFrameLayout->IsGroupHead()))@@ -341,7 +342,7 @@ void LwpStory::XFConvertFrame(XFContentContainer\* pCont) { pFrameLayout->XFConvert(pCont); }- pFrameLayout = static\_cast<LwpVirtualLayout\*>(pFrameLayout->GetNext()->obj());+ pFrameLayout = dynamic\_cast<LwpVirtualLayout\*>(pFrameLayout->GetNext()->obj()); } pLayout = GetLayout(pLayout); }@@ -357,7 +358,7 @@ void LwpStory::XFConvertFrameInCell(XFContentContainer\* pCont) LwpVirtualLayout\* pLayout = GetLayout(NULL); while(pLayout) {- LwpVirtualLayout\* pFrameLayout = static\_cast<LwpVirtualLayout\*>(pLayout->GetChildHead()->obj());+ LwpVirtualLayout\* pFrameLayout = dynamic\_cast<LwpVirtualLayout\*>(pLayout->GetChildHead()->obj()); while(pFrameLayout) { @@ -369,7 +370,7 @@ void LwpStory::XFConvertFrameInCell(XFContentContainer\* pCont) if(pXFFirtPara) pFrameLayout->XFConvert(pXFFirtPara); }- pFrameLayout = static\_cast<LwpVirtualLayout\*>(pFrameLayout->GetNext()->obj());+ pFrameLayout = dynamic\_cast<LwpVirtualLayout\*>(pFrameLayout->GetNext()->obj()); } pLayout = GetLayout(pLayout); }@@ -386,7 +387,7 @@ void LwpStory::XFConvertFrameInPage(XFContentContainer\* pCont) LwpVirtualLayout\* pLayout = GetLayout(NULL); while(pLayout) {- LwpVirtualLayout\* pFrameLayout = static\_cast<LwpVirtualLayout\*>(pLayout->GetChildHead()->obj());+ LwpVirtualLayout\* pFrameLayout = dynamic\_cast<LwpVirtualLayout\*>(pLayout->GetChildHead()->obj()); while(pFrameLayout) { if((pFrameLayout->IsAnchorPage()@@ -396,7 +397,7 @@ void LwpStory::XFConvertFrameInPage(XFContentContainer\* pCont) { pFrameLayout->XFConvert(pCont); }- pFrameLayout = static\_cast<LwpVirtualLayout\*>(pFrameLayout->GetNext()->obj());+ pFrameLayout = dynamic\_cast<LwpVirtualLayout\*>(pFrameLayout->GetNext()->obj()); } pLayout = GetLayout(pLayout); }@@ -412,14 +413,14 @@ void LwpStory::XFConvertFrameInFrame(XFContentContainer\* pCont) LwpVirtualLayout\* pLayout = GetLayout(NULL); while(pLayout) {- LwpVirtualLayout\* pFrameLayout = static\_cast<LwpVirtualLayout\*>(pLayout->GetChildHead()->obj());+ LwpVirtualLayout\* pFrameLayout = dynamic\_cast<LwpVirtualLayout\*>(pLayout->GetChildHead()->obj()); while(pFrameLayout) { if(pFrameLayout->IsAnchorFrame()) { pFrameLayout->XFConvert(pCont); }- pFrameLayout = static\_cast<LwpVirtualLayout\*>(pFrameLayout->GetNext()->obj());+ pFrameLayout = dynamic\_cast<LwpVirtualLayout\*>(pFrameLayout->GetNext()->obj()); } pLayout = GetLayout(pLayout); }@@ -435,7 +436,7 @@ void LwpStory::XFConvertFrameInHeaderFooter(XFContentContainer\* pCont) LwpVirtualLayout\* pLayout = GetLayout(NULL); while(pLayout) {- LwpVirtualLayout\* pFrameLayout = static\_cast<LwpVirtualLayout\*>(pLayout->GetChildHead()->obj());+ LwpVirtualLayout\* pFrameLayout = dynamic\_cast<LwpVirtualLayout\*>(pLayout->GetChildHead()->obj()); while(pFrameLayout) { if(pFrameLayout->IsAnchorPage() && (pLayout->IsHeader() || pLayout->IsFooter()))@@ -445,7 +446,7 @@ void LwpStory::XFConvertFrameInHeaderFooter(XFContentContainer\* pCont) if(pXFFirtPara) pFrameLayout->XFConvert(pXFFirtPara); }- pFrameLayout = static\_cast<LwpVirtualLayout\*>(pFrameLayout->GetNext()->obj());+ pFrameLayout = dynamic\_cast<LwpVirtualLayout\*>(pFrameLayout->GetNext()->obj()); } pLayout = GetLayout(pLayout); }@@ -487,12 +488,12 @@ OUString LwpStory::GetContentText(sal\_Bool bAllText) { OUString sText = A2OUSTR(""); //process para list- LwpPara\* pPara = static\_cast<LwpPara\*>(GetFirstPara()->obj());+ LwpPara\* pPara = dynamic\_cast<LwpPara\*>(GetFirstPara()->obj()); while (pPara) { pPara->SetFoundry(m\_pFoundry); sText += pPara->GetContentText(sal\_True);- pPara = static\_cast<LwpPara\*>(pPara->GetNext()->obj());+ pPara = dynamic\_cast<LwpPara\*>(pPara->GetNext()->obj()); } return sText; }@@ -501,7 +502,7 @@ OUString LwpStory::GetContentText(sal\_Bool bAllText) LwpObject\* pObj = GetFirstPara()->obj(); if(pObj) {- LwpPara\* pPara = static\_cast<LwpPara\*>(pObj);+ LwpPara\* pPara = dynamic\_cast<LwpPara\*>(pObj); if (pPara->GetNext()->obj() != NULL) return A2OUSTR(""); pPara->SetFoundry(m\_pFoundry);@@ -513,7 +514,7 @@ OUString LwpStory::GetContentText(sal\_Bool bAllText) } OUString LwpStory::RegisterFirstFribStyle() {- LwpPara\* pPara = static\_cast<LwpPara\*>(GetFirstPara()->obj());+ LwpPara\* pPara = dynamic\_cast<LwpPara\*>(GetFirstPara()->obj()); pPara->SetFoundry(m\_pFoundry); LwpFribPtr\* pFribs = pPara->GetFribs(); if (pFribs)diff --git a/lotuswordpro/source/filter/lwptable.cxx b/lotuswordpro/source/filter/lwptable.cxxindex 61dca7e92..6d63ee0d0 100644--- a/[lotuswordpro/source/filter/lwptable.cxx](/libreoffice/filters/tree/lotuswordpro/source/filter/lwptable.cxx?id=03894d18889d7bc79b3d4f000c0df7065ea81ee2)+++ b/[lotuswordpro/source/filter/lwptable.cxx](/libreoffice/filters/tree/lotuswordpro/source/filter/lwptable.cxx?id=278831e37a23e9e2e29ca811c3a5398b7c67464d)@@ -135,9 +135,9 @@ void LwpTable::Parse(IXFStream\* /\*pOutputStream\*/)  LwpSuperTableLayout\* LwpTable::GetSuperTableLayout() {- LwpTableLayout\* pLayout = static\_cast<LwpTableLayout\*>(m\_Layout.obj());+ LwpTableLayout\* pLayout = dynamic\_cast<LwpTableLayout\*>(m\_Layout.obj()); if(pLayout)- return static\_cast<LwpSuperTableLayout\*>(pLayout->GetParent()->obj());+ return dynamic\_cast<LwpSuperTableLayout\*>(pLayout->GetParent()->obj());  return NULL; }diff --git a/lotuswordpro/source/filter/lwptablelayout.cxx b/lotuswordpro/source/filter/lwptablelayout.cxxindex db5e5abd0..f16b74eb8 100644--- a/[lotuswordpro/source/filter/lwptablelayout.cxx](/libreoffice/filters/tree/lotuswordpro/source/filter/lwptablelayout.cxx?id=03894d18889d7bc79b3d4f000c0df7065ea81ee2)+++ b/[lotuswordpro/source/filter/lwptablelayout.cxx](/libreoffice/filters/tree/lotuswordpro/source/filter/lwptablelayout.cxx?id=278831e37a23e9e2e29ca811c3a5398b7c67464d)@@ -118,14 +118,14 @@ LwpTableLayout\* LwpSuperTableLayout::GetTableLayout()  while(pID && !pID->IsNull()) {- LwpVirtualLayout \* pLayout = static\_cast<LwpVirtualLayout \*>(pID->obj());+ LwpLayout\* pLayout = dynamic\_cast<LwpLayout\*>(pID->obj()); if (!pLayout) { break; } if (pLayout->GetLayoutType() == LWP\_TABLE\_LAYOUT) {- return static\_cast<LwpTableLayout \*>(pLayout);+ return dynamic\_cast<LwpTableLayout \*>(pLayout); } pID = pLayout->GetPrevious(); }@@ -142,7 +142,7 @@ LwpTableHeadingLayout\* LwpSuperTableLayout::GetTableHeadingLayout()  while(pID && !pID->IsNull()) {- LwpVirtualLayout \* pLayout = static\_cast<LwpVirtualLayout \*>(pID->obj());+ LwpLayout \* pLayout = dynamic\_cast<LwpLayout \*>(pID->obj()); if (!pLayout) { break;@@ -150,7 +150,7 @@ LwpTableHeadingLayout\* LwpSuperTableLayout::GetTableHeadingLayout()  if (pLayout->GetLayoutType() == LWP\_TABLE\_HEADING\_LAYOUT) {- return static\_cast<LwpTableHeadingLayout \*>(pLayout);+ return dynamic\_cast<LwpTableHeadingLayout \*>(pLayout); } pID = pLayout->GetPrevious(); }@@ -235,7 +235,7 @@ double LwpSuperTableLayout::GetTableWidth() for(sal\_uInt16 i =0; i< nCol; i++) { LwpObjectID \*pColumnID = pTableLayout->GetColumnLayoutHead();- LwpColumnLayout \* pColumnLayout = static\_cast<LwpColumnLayout \*>(pColumnID->obj());+ LwpColumnLayout \* pColumnLayout = dynamic\_cast<LwpColumnLayout \*>(pColumnID->obj()); double dColumnWidth = dDefaultWidth; while (pColumnLayout) {@@ -245,7 +245,7 @@ double LwpSuperTableLayout::GetTableWidth() break; } pColumnID = pColumnLayout->GetNext();- pColumnLayout = static\_cast<LwpColumnLayout \*>(pColumnID->obj());+ pColumnLayout = dynamic\_cast<LwpColumnLayout \*>(pColumnID->obj()); } dWidth += dColumnWidth; }@@ -476,7 +476,7 @@ void LwpTableLayout::TraverseTable()  // set value LwpObjectID \*pRowID = GetChildHead();- LwpRowLayout \* pRowLayout = static\_cast<LwpRowLayout \*>(pRowID->obj());+ LwpRowLayout \* pRowLayout = dynamic\_cast<LwpRowLayout \*>(pRowID->obj()); while (pRowLayout) { pRowLayout->SetRowMap();@@ -487,7 +487,7 @@ void LwpTableLayout::TraverseTable() // end for 's analysis  pRowID = pRowLayout->GetNext();- pRowLayout = static\_cast<LwpRowLayout \*>(pRowID->obj());+ pRowLayout = dynamic\_cast<LwpRowLayout \*>(pRowID->obj()); } } @@ -525,7 +525,7 @@ LwpObjectID \* LwpTableLayout::SearchCellStoryMap(sal\_uInt16 nRow, sal\_uInt16 nCo \*/ LwpSuperTableLayout \* LwpTableLayout::GetSuperTableLayout() {- return static\_cast<LwpSuperTableLayout \*>(GetParent()->obj());+ return dynamic\_cast<LwpSuperTableLayout \*>(GetParent()->obj()); } /\*\* \* @short Get table pointer@@ -533,7 +533,7 @@ LwpSuperTableLayout \* LwpTableLayout::GetSuperTableLayout() \*/ LwpTable \* LwpTableLayout::GetTable() {- LwpTable \*pTable = static\_cast<LwpTable \*>(m\_Content.obj());+ LwpTable \*pTable = dynamic\_cast<LwpTable \*>(m\_Content.obj()); return pTable; } /\*\*@@ -585,7 +585,7 @@ void LwpTableLayout::RegisterColumns() // Get total width of justifiable columns // NOTICE: all default columns are regarded as justifiable columns LwpObjectID \*pColumnID = GetColumnLayoutHead();- LwpColumnLayout \* pColumnLayout = static\_cast<LwpColumnLayout \*>(pColumnID->obj());+ LwpColumnLayout \* pColumnLayout = dynamic\_cast<LwpColumnLayout \*>(pColumnID->obj()); while (pColumnLayout) { m\_pColumns[pColumnLayout->GetColumnID()] = pColumnLayout;@@ -597,7 +597,7 @@ void LwpTableLayout::RegisterColumns() }  pColumnID = pColumnLayout->GetNext();- pColumnLayout = static\_cast<LwpColumnLayout \*>(pColumnID->obj());+ pColumnLayout = dynamic\_cast<LwpColumnLayout \*>(pColumnID->obj()); }  // if all columns are not justifiable, the rightmost column will be changed to justifiable@@ -676,14 +676,14 @@ void LwpTableLayout::RegisterRows()  // register style of rows LwpObjectID \* pRowID = GetChildHead();- LwpRowLayout \* pRowLayout = static\_cast<LwpRowLayout \*>(pRowID->obj());+ LwpRowLayout \* pRowLayout = dynamic\_cast<LwpRowLayout \*>(pRowID->obj()); while (pRowLayout) { pRowLayout->SetFoundry(m\_pFoundry); pRowLayout->RegisterStyle();  pRowID = pRowLayout->GetNext();- pRowLayout = static\_cast<LwpRowLayout \*>(pRowID->obj());+ pRowLayout = dynamic\_cast<LwpRowLayout \*>(pRowID->obj()); } } /\*\*@@ -716,7 +716,7 @@ void LwpTableLayout::RegisterStyle() LwpObjectID \* pID= pTable->GetDefaultCellStyle(); if (pID) {- m\_pDefaultCellLayout = static\_cast<LwpCellLayout \*>(pID->obj());+ m\_pDefaultCellLayout = dynamic\_cast<LwpCellLayout \*>(pID->obj()); }  // register columns styles@@ -1261,7 +1261,7 @@ void LwpTableLayout::ConvertColumn(XFTable \*pXFTable,sal\_uInt8 nStartCol,sal\_uIn { // add row to table LwpObjectID \*pColID = GetColumnLayoutHead();- LwpColumnLayout \* pColumnLayout = static\_cast<LwpColumnLayout \*>(pColID->obj());+ LwpColumnLayout \* pColumnLayout = dynamic\_cast<LwpColumnLayout \*>(pColID->obj()); while (pColumnLayout) { if (pColumnLayout->GetColumnID() == (iLoop+nStartCol))@@ -1270,7 +1270,7 @@ void LwpTableLayout::ConvertColumn(XFTable \*pXFTable,sal\_uInt8 nStartCol,sal\_uIn break; } pColID = pColumnLayout->GetNext();- pColumnLayout = static\_cast<LwpColumnLayout \*>(pColID->obj());+ pColumnLayout = dynamic\_cast<LwpColumnLayout \*>(pColID->obj()); } if (!pColumnLayout) {@@ -1403,14 +1403,14 @@ XFCell\* LwpTableLayout::GetCellsMap(sal\_uInt16 nRow,sal\_uInt8 nCol) LwpRowLayout\* LwpTableLayout::GetRowLayout(sal\_uInt16 nRow) { LwpObjectID \*pRowID = GetChildHead();- LwpRowLayout \* pRowLayout = static\_cast<LwpRowLayout \*>(pRowID->obj());+ LwpRowLayout \* pRowLayout = dynamic\_cast<LwpRowLayout \*>(pRowID->obj()); while (pRowLayout) { if(pRowLayout->GetRowID() == nRow) return pRowLayout;  pRowID = pRowLayout->GetNext();- pRowLayout = static\_cast<LwpRowLayout \*>(pRowID->obj());+ pRowLayout = dynamic\_cast<LwpRowLayout \*>(pRowID->obj()); } return NULL; }@@ -1488,7 +1488,7 @@ LwpRowHeadingLayout \* LwpTableHeadingLayout::GetFirstRowHeadingLayout() LwpObjectID \*pID = GetChildHead(); if(pID && !pID->IsNull()) {- LwpRowHeadingLayout \* pHeadingRow = static\_cast<LwpRowHeadingLayout \*>(pID->obj());+ LwpRowHeadingLayout \* pHeadingRow = dynamic\_cast<LwpRowHeadingLayout \*>(pID->obj()); return pHeadingRow; } return NULL;diff --git a/lotuswordpro/source/filter/lwptabrack.cxx b/lotuswordpro/source/filter/lwptabrack.cxxindex ac4a01d94..b29952a6b 100644--- a/[lotuswordpro/source/filter/lwptabrack.cxx](/libreoffice/filters/tree/lotuswordpro/source/filter/lwptabrack.cxx?id=03894d18889d7bc79b3d4f000c0df7065ea81ee2)+++ b/[lotuswordpro/source/filter/lwptabrack.cxx](/libreoffice/filters/tree/lotuswordpro/source/filter/lwptabrack.cxx?id=278831e37a23e9e2e29ca811c3a5398b7c67464d)@@ -116,7 +116,7 @@ LwpTab\* LwpTabRack::Lookup(sal\_uInt16 nIndex)  LwpTabRack\* LwpTabRack::GetNext() {- LwpTabRack\* pTabRack = static\_cast<LwpTabRack\*>(m\_NextID.obj());+ LwpTabRack\* pTabRack = dynamic\_cast<LwpTabRack\*>(m\_NextID.obj()); return pTabRack; } diff --git a/lotuswordpro/source/filter/lwptoc.cxx b/lotuswordpro/source/filter/lwptoc.cxxindex 143d390a3..6d9c13c0f 100644--- a/[lotuswordpro/source/filter/lwptoc.cxx](/libreoffice/filters/tree/lotuswordpro/source/filter/lwptoc.cxx?id=03894d18889d7bc79b3d4f000c0df7065ea81ee2)+++ b/[lotuswordpro/source/filter/lwptoc.cxx](/libreoffice/filters/tree/lotuswordpro/source/filter/lwptoc.cxx?id=278831e37a23e9e2e29ca811c3a5398b7c67464d)@@ -377,7 +377,7 @@ sal\_uInt16 LwpTocSuperLayout::GetSeparatorType(sal\_uInt16 index) LwpTocLevelData \* LwpTocSuperLayout::GetSearchLevelPtr(sal\_uInt16 index) { LwpObjectID \* pID = m\_SearchItems.GetHead(); // not necessary to check pID NULL or not- LwpTocLevelData \* pObj = static\_cast<LwpTocLevelData \*>(pID->obj());+ LwpTocLevelData \* pObj = dynamic\_cast<LwpTocLevelData \*>(pID->obj());  while(pObj) {@@ -387,7 +387,7 @@ LwpTocLevelData \* LwpTocSuperLayout::GetSearchLevelPtr(sal\_uInt16 index) }  pID = pObj->GetNext(); // not necessary to check pID NULL or not- pObj = static\_cast<LwpTocLevelData \*>(pID->obj());+ pObj = dynamic\_cast<LwpTocLevelData \*>(pID->obj()); }  return NULL;@@ -401,7 +401,7 @@ LwpTocLevelData \* LwpTocSuperLayout::GetSearchLevelPtr(sal\_uInt16 index) LwpTocLevelData \* LwpTocSuperLayout::GetNextSearchLevelPtr(sal\_uInt16 index, LwpTocLevelData \* pCurData) { LwpObjectID \* pID = pCurData->GetNext();- LwpTocLevelData \* pObj = static\_cast<LwpTocLevelData \*>(pID->obj());+ LwpTocLevelData \* pObj = dynamic\_cast<LwpTocLevelData \*>(pID->obj());  while(pObj) {@@ -411,7 +411,7 @@ LwpTocLevelData \* LwpTocSuperLayout::GetNextSearchLevelPtr(sal\_uInt16 index, Lwp }  pID = pObj->GetNext(); // not necessary to check pID NULL or not- pObj = static\_cast<LwpTocLevelData \*>(pID->obj());+ pObj = dynamic\_cast<LwpTocLevelData \*>(pID->obj()); }  return NULL;diff --git a/lotuswordpro/source/filter/lwptools.hxx b/lotuswordpro/source/filter/lwptools.hxxindex 996ec176f..750010d2a 100644--- a/[lotuswordpro/source/filter/lwptools.hxx](/libreoffice/filters/tree/lotuswordpro/source/filter/lwptools.hxx?id=03894d18889d7bc79b3d4f000c0df7065ea81ee2)+++ b/[lotuswordpro/source/filter/lwptools.hxx](/libreoffice/filters/tree/lotuswordpro/source/filter/lwptools.hxx?id=278831e37a23e9e2e29ca811c3a5398b7c67464d)@@ -71,6 +71,7 @@ #include "xfilter/xfdatestyle.hxx" #include "xfilter/xftimestyle.hxx" #include <rtl/textenc.h>+#include <stdexcept>  // 01/19/2005 const sal\_uInt32 UNITS\_PER\_INCH = 65536L \* 72L;@@ -141,6 +142,18 @@ inline sal\_Bool LwpTools::IsEvenNumber(sal\_uInt16& nNumber) return nNumber%2? sal\_False : sal\_True; } +class BadSeek : public std::runtime\_error+{+public:+ BadSeek() : std::runtime\_error("Lotus Word Pro Bad Seek") { }+};++class BadDecompress : public std::runtime\_error+{+public:+ BadDecompress() : std::runtime\_error("Lotus Word Pro Bad Decompress") { }+};+ #endif  /\* vim:set shiftwidth=4 softtabstop=4 expandtab: \*/diff --git a/lotuswordpro/source/filter/utlist.cxx b/lotuswordpro/source/filter/utlist.cxxindex 0acd2db39..d68b49cbe 100644--- a/[lotuswordpro/source/filter/utlist.cxx](/libreoffice/filters/tree/lotuswordpro/source/filter/utlist.cxx?id=03894d18889d7bc79b3d4f000c0df7065ea81ee2)+++ b/[lotuswordpro/source/filter/utlist.cxx](/libreoffice/filters/tree/lotuswordpro/source/filter/utlist.cxx?id=278831e37a23e9e2e29ca811c3a5398b7c67464d)@@ -59,10 +59,11 @@ namespace OpenStormBento {  CUtListElmt::CUtListElmt(pCUtList pList)+ : cpNext(NULL)+ , cpPrev(NULL) {- if (pList == NULL)- cpNext = NULL;- else InsertAfter(pList->GetLast());+ if (pList != NULL)+ InsertAfter(pList->GetLast()); }  CUtListElmt::~CUtListElmt()diff --git a/lotuswordpro/source/filter/utlist.hxx b/lotuswordpro/source/filter/utlist.hxxindex ef76588a3..8f3f90d7b 100644--- a/[lotuswordpro/source/filter/utlist.hxx](/libreoffice/filters/tree/lotuswordpro/source/filter/utlist.hxx?id=03894d18889d7bc79b3d4f000c0df7065ea81ee2)+++ b/[lotuswordpro/source/filter/utlist.hxx](/libreoffice/filters/tree/lotuswordpro/source/filter/utlist.hxx?id=278831e37a23e9e2e29ca811c3a5398b7c67464d)@@ -69,7 +69,10 @@ UtDefClassP(CUtComparableListElmt); class CUtListElmt { public: // Methods- CUtListElmt() { cpNext = NULL; }+ CUtListElmt()+ : cpNext(NULL)+ , cpPrev(NULL)+ {} CUtListElmt(pCUtListElmt pPrev) { InsertAfter(pPrev); } CUtListElmt(pCUtList pList); virtual ~CUtListElmt();diff --git a/lotuswordpro/source/filter/xfilter/xfimage.cxx b/lotuswordpro/source/filter/xfilter/xfimage.cxxindex aef5459a9..10c21fcfc 100644--- a/[lotuswordpro/source/filter/xfilter/xfimage.cxx](/libreoffice/filters/tree/lotuswordpro/source/filter/xfilter/xfimage.cxx?id=03894d18889d7bc79b3d4f000c0df7065ea81ee2)+++ b/[lotuswordpro/source/filter/xfilter/xfimage.cxx](/libreoffice/filters/tree/lotuswordpro/source/filter/xfilter/xfimage.cxx?id=278831e37a23e9e2e29ca811c3a5398b7c67464d)@@ -60,7 +60,7 @@ #include "xfimage.hxx" #include "xfbase64.hxx" -XFImage::XFImage()+XFImage::XFImage() : m\_bUseLink(sal\_False) { m\_eType = enumXFFrameImage; m\_strName = XFGlobal::GenImageName();diff --git a/lotuswordpro/source/filter/xfilter/xfsaxstream.cxx b/lotuswordpro/source/filter/xfilter/xfsaxstream.cxxindex ca3150451..1d4986230 100644--- a/[lotuswordpro/source/filter/xfilter/xfsaxstream.cxx](/libreoffice/filters/tree/lotuswordpro/source/filter/xfilter/xfsaxstream.cxx?id=03894d18889d7bc79b3d4f000c0df7065ea81ee2)+++ b/[lotuswordpro/source/filter/xfilter/xfsaxstream.cxx](/libreoffice/filters/tree/lotuswordpro/source/filter/xfilter/xfsaxstream.cxx?id=278831e37a23e9e2e29ca811c3a5398b7c67464d)@@ -94,23 +94,27 @@ XFSaxStream::~XFSaxStream()  void XFSaxStream::StartDocument() {- m\_aHandler->startDocument();+ if (m\_aHandler.is())+ m\_aHandler->startDocument(); }  void XFSaxStream::EndDocument() {- m\_aHandler->endDocument();+ if (m\_aHandler.is())+ m\_aHandler->endDocument(); }  void XFSaxStream::StartElement(const rtl::OUString& oustr) {- m\_aHandler->startElement( oustr, m\_pAttrList->GetAttributeList() );+ if (m\_aHandler.is())+ m\_aHandler->startElement( oustr, m\_pAttrList->GetAttributeList() ); m\_pAttrList->Clear(); }  void XFSaxStream::EndElement(const rtl::OUString& oustr) {- m\_aHandler->endElement(oustr);+ if (m\_aHandler.is())+ m\_aHandler->endElement(oustr);  if( m\_pAttrList ) m\_pAttrList->Clear();@@ -118,7 +122,8 @@ void XFSaxStream::EndElement(const rtl::OUString& oustr)  void XFSaxStream::Characters(const rtl::OUString& oustr) {- m\_aHandler->characters(oustr);+ if (m\_aHandler.is())+ m\_aHandler->characters(oustr); }  IXFAttrList\* XFSaxStream::GetAttrList()diff --git a/lotuswordpro/util/makefile.mk b/lotuswordpro/util/makefile.mkindex 640ba297a..b150cc673 100644--- a/[lotuswordpro/util/makefile.mk](/libreoffice/filters/tree/lotuswordpro/util/makefile.mk?id=03894d18889d7bc79b3d4f000c0df7065ea81ee2)+++ b/[lotuswordpro/util/makefile.mk](/libreoffice/filters/tree/lotuswordpro/util/makefile.mk?id=278831e37a23e9e2e29ca811c3a5398b7c67464d)@@ -36,10 +36,16 @@ DEF1NAME=$(SHL1TARGET)  .INCLUDE : target.mk -ALLTAR : $(MISC)/lwpfilter.component+ALLTAR : $(MISC)/lwpfilter.component $(MISC)/qa\_lwpfilter.component  $(MISC)/lwpfilter.component .ERRREMOVE : $(SOLARENV)/bin/createcomponent.xslt \ lwpfilter.component $(XSLTPROC) --nonet --stringparam uri \ '$(COMPONENTPREFIX\_BASIS\_NATIVE)$(SHL1TARGETN:f)' -o $@ \ $(SOLARENV)/bin/createcomponent.xslt lwpfilter.component++$(MISC)/qa\_lwpfilter.component .ERRREMOVE : $(SOLARENV)/bin/createcomponent.xslt \+ lwpfilter.component+ $(XSLTPROC) --nonet --stringparam uri \+ '$(COMPONENTPREFIX\_INBUILD\_NATIVE)$(SHL1TARGETN:f)' -o $@ \+ $(SOLARENV)/bin/createcomponent.xslt lwpfilter.component |
| --- |

generated by [cgit v1.2.3](https://git.zx2c4.com/cgit/about/) ([git 2.39.1](https://git-scm.com/)) at 2025-01-24 21:54:17 +0000



=== Content from lists.opensuse.org_de345ccc_20250124_215420.html ===


[![openSUSE](https://static.opensuse.org/favicon.svg)
Mailing Lists](/archives/ "openSUSE Mailing Lists")

[Sign In](/accounts/login/?next=/archives/list/updates%40lists.opensuse.org/message/DN5HCWP27NIY62OGOCIWL3LSHZR3E7TJ/)
[Sign Up](/accounts/signup/?next=/archives/list/updates%40lists.opensuse.org/message/DN5HCWP27NIY62OGOCIWL3LSHZR3E7TJ/)

[Manage this list](/manage/lists/updates.lists.opensuse.org/)
[Sign In](/accounts/login/?next=/archives/list/updates%40lists.opensuse.org/message/DN5HCWP27NIY62OGOCIWL3LSHZR3E7TJ/)
[Sign Up](/accounts/signup/?next=/archives/list/updates%40lists.opensuse.org/message/DN5HCWP27NIY62OGOCIWL3LSHZR3E7TJ/)

×
#### Keyboard Shortcuts

### Thread View

* `j`: Next unread message
* `k`: Previous unread message
* `j a`: Jump to all threads* `j l`: Jump to MailingList overview

[thread](/archives/list/updates%40lists.opensuse.org/thread/DN5HCWP27NIY62OGOCIWL3LSHZR3E7TJ/#DN5HCWP27NIY62OGOCIWL3LSHZR3E7TJ)

# openSUSE-SU-2011:1143-2: moderate: libreoffice to 3.4

![](https://seccdn.libravatar.org/avatar/099a17325bdf082b643d1a6bbacde279.jpg?s=120&d=mm&r=g)
## [opensuse-security＠opensuse.org](/archives/users/1b72def497ef4503896cd7a5fe9fb8e0/ "See the profile for opensuse-security＠opensuse.org")

17 Oct
2011

17 Oct
'11

23:08

openSUSE Security Update: libreoffice to 3.4
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
Announcement ID: openSUSE-SU-2011:1143-2
Rating: moderate
References: #647959 #650049 #651250 #652562 #653662 #663622
#665112 #675868 #675961 #676858 #678998 #680272
#681738 #683578 #684784 #693238 #693477 #694119
#694344 #695479 #696630 #702506 #704311 #704639
#704642 #705949 #706792 #707486 #707779 #708137
#708518 #710061 #710920 #711977 #712358 #715268
#715416 #715856 #715931 #717262
Cross-References: CVE-2011-2685 CVE-2011-2713
Affected Products:
openSUSE 11.4
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
An update that solves two vulnerabilities and has 38 fixes
is now available. It includes two new package versions.
Description:
LibreOffice 3.4 includes new interesting features and
fixes, see
<http://www.libreoffice.org/download/3-4-new-features-and-fix>
es/
The update fixes the following security issue:
- 704311: libreoffice Lotus Word Pro filter multiple
vulnerabilities (CVE-2011-2685)
- 722075: LibreOffice: Out-of-bounds read in DOC sprm
(CVE-2011-2713)
This update also fixes the following non-security issues:
- 647959: LibO has a regression problem to show emf charts
properly.
- 650049: pptx presentation has text in boxes and circles.
Only text is displayed.
- 651250: Video and Audio does not play in slide show mode
of LibO Impress.
- 652562: LibreOffice crashes on start on 11.4-MS3 NET/DVD
install
- 653662: libreoffice build calls mkbundle2 (deprecated)
instead of mkbundle
- 663622: Writer crash during document save
- 665112: could not type or edit office document
- 675868: eliminate wording of ooconvert existed in
loconvert --help
- 675961: Libreoffice Copy paste of formula in Writer
tables does not work as expected
- 676858: Document with full page graphic in header will
not allow click-drag or right-click.
- 678998: Libre Office 3.3.1 does not detect KDE3
- 680272: Deleting multiple sheets results in run-time
error/crash
- 681738: DDE link is lost when .xls file is opened/saved
in Calc.
- 683578: Large xlsx file takes extremely long to open with
Libreoffice calc
- 684784: Microsoft Office spreadsheet does not display
anything
- 693238: Column format in docx file is not displayed
correctly.
- 693477: Format of Word .doc file from HP is bad.
- 694119: Using File-->Send-->Document as E-mail will crash
Impress
- 694344: 3rd level bulleted items are not displayed
properly.
- 695479: L3: RTF file is not displayed correctly by Writer.
- 696630: DDE link from Calc to Excel needs Excel open to
update link in Calc.
- 702506: Writer crashes when opening docx files.
- 704639: HTML document appearance changes when opened in
open office vs LibreOffice
- 704642: 16 digit numbers change in LibreOffice when
opening a file created in MS Excel
- 705949: Information missing from MS Word document when
opened in LibreOffice (w:sdt)
- 706792: PTF 3.3.1-21 introduced a crash when opening a
pptx presentation.
- 707486: Macro from excel fails on Selection.Copy when run
in Calc.
- 707779: Disappearing text
- 708137: xls spreadsheet is extremely slow to open and
check boxes are broken.
- 708518: Bullet symbol is not rendered correctly in a
specific slide.
- 710061: ODP export to PDF produces broken images
- 710920: RPM installation ending with redundant error.
- 711977: File association for fod\* files are missing.
- 712358: Some extensions broken after upgrading.
- 715268: Command libreoffice --help does not work when
LibreOffice is already started
- 715856: LibreOffice:Stable/libreoffice-converter: Bug
- 715416: Impress crashes starting Slide show in the
context of dual monitors extension mode.
- 715931: failed to save an odp file.
- 717262: libtool adds /usr/lib64 into rpath
Special Instructions and Notes:
Please reboot the system after installing this update.
Patch Instructions:
To install this openSUSE Security Update use YaST online\_update.
Alternatively you can run the command listed for your product:
- openSUSE 11.4:
zypper in -t patch libreoffice-34-5253
To bring your system up-to-date, use "zypper patch".
Package List:
- openSUSE 11.4 (i586 x86\_64) [New Version: 3.4.2.6]:
libreoffice-3.4.2.6-2.3.1
libreoffice-base-3.4.2.6-2.3.1
libreoffice-base-drivers-mysql-3.4.2.6-2.3.1
libreoffice-base-drivers-postgresql-3.4.2.6-2.3.1
libreoffice-base-extensions-3.4.2.6-2.3.1
libreoffice-calc-3.4.2.6-2.3.1
libreoffice-calc-extensions-3.4.2.6-2.3.1
libreoffice-draw-3.4.2.6-2.3.1
libreoffice-draw-extensions-3.4.2.6-2.3.1
libreoffice-filters-optional-3.4.2.6-2.3.1
libreoffice-gnome-3.4.2.6-2.3.1
libreoffice-icon-themes-prebuilt-3.4.2.6-2.3.1
libreoffice-impress-3.4.2.6-2.3.1
libreoffice-impress-extensions-3.4.2.6-2.3.1
libreoffice-kde4-3.4.2.6-2.3.1
libreoffice-l10n-prebuilt-3.4.2.6-2.3.1
libreoffice-mailmerge-3.4.2.6-2.3.1
libreoffice-math-3.4.2.6-2.3.1
libreoffice-officebean-3.4.2.6-2.3.1
libreoffice-pyuno-3.4.2.6-2.3.1
libreoffice-testtool-3.4.2.6-2.3.1
libreoffice-writer-3.4.2.6-2.3.1
libreoffice-writer-extensions-3.4.2.6-2.3.1
- openSUSE 11.4 (noarch) [New Version: 1.4 and 3.4.2.6]:
libreoffice-branding-upstream-3.4.2.6-2.3.1
libreoffice-converter-3.3-1.4.1
libreoffice-help-cs-3.4.2.6-2.3.1
libreoffice-help-da-3.4.2.6-2.3.1
libreoffice-help-de-3.4.2.6-2.3.1
libreoffice-help-en-GB-3.4.2.6-2.3.1
libreoffice-help-en-US-3.4.2.6-2.3.1
libreoffice-help-en-ZA-3.4.2.6-2.3.1
libreoffice-help-es-3.4.2.6-2.3.1
libreoffice-help-et-3.4.2.6-2.3.1
libreoffice-help-fr-3.4.2.6-2.3.1
libreoffice-help-gl-3.4.2.6-2.3.1
libreoffice-help-gu-IN-3.4.2.6-2.3.1
libreoffice-help-hi-IN-3.4.2.6-2.3.1
libreoffice-help-hu-3.4.2.6-2.3.1
libreoffice-help-it-3.4.2.6-2.3.1
libreoffice-help-ja-3.4.2.6-2.3.1
libreoffice-help-km-3.4.2.6-2.3.1
libreoffice-help-ko-3.4.2.6-2.3.1
libreoffice-help-nl-3.4.2.6-2.3.1
libreoffice-help-pl-3.4.2.6-2.3.1
libreoffice-help-pt-3.4.2.6-2.3.1
libreoffice-help-pt-BR-3.4.2.6-2.3.1
libreoffice-help-ru-3.4.2.6-2.3.1
libreoffice-help-sl-3.4.2.6-2.3.1
libreoffice-help-sv-3.4.2.6-2.3.1
libreoffice-help-zh-CN-3.4.2.6-2.3.1
libreoffice-help-zh-TW-3.4.2.6-2.3.1
libreoffice-icon-theme-crystal-3.4.2.6-1.3.1
libreoffice-icon-theme-galaxy-3.4.2.6-1.3.1
libreoffice-icon-theme-hicontrast-3.4.2.6-1.3.1
libreoffice-icon-theme-oxygen-3.4.2.6-1.3.1
libreoffice-icon-theme-tango-3.4.2.6-1.3.1
libreoffice-l10n-af-3.4.2.6-1.3.1
libreoffice-l10n-ar-3.4.2.6-1.3.1
libreoffice-l10n-be-BY-3.4.2.6-1.3.1
libreoffice-l10n-bg-3.4.2.6-1.3.1
libreoffice-l10n-br-3.4.2.6-1.3.1
libreoffice-l10n-ca-3.4.2.6-1.3.1
libreoffice-l10n-cs-3.4.2.6-1.3.1
libreoffice-l10n-cy-3.4.2.6-1.3.1
libreoffice-l10n-da-3.4.2.6-1.3.1
libreoffice-l10n-de-3.4.2.6-1.3.1
libreoffice-l10n-el-3.4.2.6-1.3.1
libreoffice-l10n-en-GB-3.4.2.6-1.3.1
libreoffice-l10n-en-ZA-3.4.2.6-1.3.1
libreoffice-l10n-es-3.4.2.6-1.3.1
libreoffice-l10n-et-3.4.2.6-1.3.1
libreoffice-l10n-fi-3.4.2.6-1.3.1
libreoffice-l10n-fr-3.4.2.6-1.3.1
libreoffice-l10n-ga-3.4.2.6-1.3.1
libreoffice-l10n-gl-3.4.2.6-1.3.1
libreoffice-l10n-gu-IN-3.4.2.6-1.3.1
libreoffice-l10n-he-3.4.2.6-1.3.1
libreoffice-l10n-hi-IN-3.4.2.6-1.3.1
libreoffice-l10n-hr-3.4.2.6-1.3.1
libreoffice-l10n-hu-3.4.2.6-1.3.1
libreoffice-l10n-it-3.4.2.6-1.3.1
libreoffice-l10n-ja-3.4.2.6-1.3.1
libreoffice-l10n-ka-3.4.2.6-1.3.1
libreoffice-l10n-km-3.4.2.6-1.3.1
libreoffice-l10n-ko-3.4.2.6-1.3.1
libreoffice-l10n-lt-3.4.2.6-1.3.1
libreoffice-l10n-mk-3.4.2.6-1.3.1
libreoffice-l10n-nb-3.4.2.6-1.3.1
libreoffice-l10n-nl-3.4.2.6-1.3.1
libreoffice-l10n-nn-3.4.2.6-1.3.1
libreoffice-l10n-nr-3.4.2.6-1.3.1
libreoffice-l10n-pa-IN-3.4.2.6-1.3.1
libreoffice-l10n-pl-3.4.2.6-1.3.1
libreoffice-l10n-pt-3.4.2.6-1.3.1
libreoffice-l10n-pt-BR-3.4.2.6-1.3.1
libreoffice-l10n-ru-3.4.2.6-1.3.1
libreoffice-l10n-rw-3.4.2.6-1.3.1
libreoffice-l10n-sh-3.4.2.6-1.3.1
libreoffice-l10n-sk-3.4.2.6-1.3.1
libreoffice-l10n-sl-3.4.2.6-1.3.1
libreoffice-l10n-sr-3.4.2.6-1.3.1
libreoffice-l10n-ss-3.4.2.6-1.3.1
libreoffice-l10n-st-3.4.2.6-1.3.1
libreoffice-l10n-sv-3.4.2.6-1.3.1
libreoffice-l10n-tg-3.4.2.6-1.3.1
libreoffice-l10n-th-3.4.2.6-1.3.1
libreoffice-l10n-tr-3.4.2.6-1.3.1
libreoffice-l10n-ts-3.4.2.6-1.3.1
libreoffice-l10n-uk-3.4.2.6-1.3.1
libreoffice-l10n-ve-3.4.2.6-1.3.1
libreoffice-l10n-vi-3.4.2.6-1.3.1
libreoffice-l10n-xh-3.4.2.6-1.3.1
libreoffice-l10n-zh-CN-3.4.2.6-1.3.1
libreoffice-l10n-zh-TW-3.4.2.6-1.3.1
libreoffice-l10n-zu-3.4.2.6-1.3.1
libreoffice-languagetool-1.4-2.2.1
libreoffice-languagetool-ca-1.4-2.2.1
libreoffice-languagetool-de-1.4-2.2.1
libreoffice-languagetool-en-1.4-2.2.1
libreoffice-languagetool-es-1.4-2.2.1
libreoffice-languagetool-fr-1.4-2.2.1
libreoffice-languagetool-gl-1.4-2.2.1
libreoffice-languagetool-it-1.4-2.2.1
libreoffice-languagetool-nl-1.4-2.2.1
libreoffice-languagetool-pl-1.4-2.2.1
libreoffice-languagetool-ro-1.4-2.2.1
libreoffice-languagetool-ru-1.4-2.2.1
libreoffice-languagetool-sk-1.4-2.2.1
libreoffice-languagetool-sv-1.4-2.2.1
libreoffice-openclipart-3.4-1.3.1
References:
<http://support.novell.com/security/cve/CVE-2011-2685.html>
<http://support.novell.com/security/cve/CVE-2011-2713.html>
<https://bugzilla.novell.com/647959>
<https://bugzilla.novell.com/650049>
<https://bugzilla.novell.com/651250>
<https://bugzilla.novell.com/652562>
<https://bugzilla.novell.com/653662>
<https://bugzilla.novell.com/663622>
<https://bugzilla.novell.com/665112>
<https://bugzilla.novell.com/675868>
<https://bugzilla.novell.com/675961>
<https://bugzilla.novell.com/676858>
<https://bugzilla.novell.com/678998>
<https://bugzilla.novell.com/680272>
<https://bugzilla.novell.com/681738>
<https://bugzilla.novell.com/683578>
<https://bugzilla.novell.com/684784>
<https://bugzilla.novell.com/693238>
<https://bugzilla.novell.com/693477>
<https://bugzilla.novell.com/694119>
<https://bugzilla.novell.com/694344>
<https://bugzilla.novell.com/695479>
<https://bugzilla.novell.com/696630>
<https://bugzilla.novell.com/702506>
<https://bugzilla.novell.com/704311>
<https://bugzilla.novell.com/704639>
<https://bugzilla.novell.com/704642>
<https://bugzilla.novell.com/705949>
<https://bugzilla.novell.com/706792>
<https://bugzilla.novell.com/707486>
<https://bugzilla.novell.com/707779>
<https://bugzilla.novell.com/708137>
<https://bugzilla.novell.com/708518>
<https://bugzilla.novell.com/710061>
<https://bugzilla.novell.com/710920>
<https://bugzilla.novell.com/711977>
<https://bugzilla.novell.com/712358>
<https://bugzilla.novell.com/715268>
<https://bugzilla.novell.com/715416>
<https://bugzilla.novell.com/715856>
<https://bugzilla.novell.com/715931>
<https://bugzilla.novell.com/717262>

[0](#like "You must be logged-in to vote.")
[0](#dislike "You must be logged-in to vote.")

Reply

[Sign in to reply online](/accounts/login/?next=/archives/list/updates%40lists.opensuse.org/message/DN5HCWP27NIY62OGOCIWL3LSHZR3E7TJ/)
Use email software

[Back to the thread](/archives/list/updates%40lists.opensuse.org/thread/DN5HCWP27NIY62OGOCIWL3LSHZR3E7TJ/#DN5HCWP27NIY62OGOCIWL3LSHZR3E7TJ)

[Back to the list](/archives/list/updates%40lists.opensuse.org/)

![HyperKitty](/static/hyperkitty/img/logo.png)
Powered by [HyperKitty](http://hyperkitty.readthedocs.org) version 1.3.12.



=== Content from bugzilla.novell.com_bef55f0c_20250126_034728.html ===




=== Content from www.kb.cert.org_a94531a9_20250124_215421.html ===


search

menu

icon-carat-right

cmu-wordmark

* ×
* [Home](/vuls/)
* [Notes](/vuls/bypublished/desc/)
* [Search](/vuls/search/)
* [Report a Vulnerability](/vuls/report/)
* [Disclosure Guidance](/vuls/guidance/)
* [VINCE](/vince/)

[[Carnegie Mellon University](https://www.cmu.edu)](https://www.cmu.edu/)

# [Software Engineering Institute](https://www.sei.cmu.edu/)

## CERT Coordination Center

* [Home](/vuls/)
* [Notes](/vuls/bypublished/desc/)
* [Search](/vuls/search/)
* [Report a Vulnerability](/vuls/report/)
* [Disclosure Guidance](/vuls/guidance/)
* [VINCE](/vince/)

* [Home](/vuls/)
* [Notes](/vuls/bypublished/desc/)
* Current:  VU#953183

## LibreOffice 3.3 'Lotus Word Pro' document import filter contains multiple vulnerabilities

#### Vulnerability Note VU#953183

Original Release Date: 2011-06-22 | Last Revised: 2012-03-28

---

### Overview

LibreOffice 3.3.2 includes a feature to import 'Lotus Word Pro' (.lwp) documents. This import filter contains multiple vulnerabilities. CERT/CC has confirmed that code execution is possible by exploiting a stack buffer overflow.

### Description

| LibreOffice 3.3.2, 3.3.1, and possibly earlier versions fail to properly handle 'Lotus Word Pro' (.lwp) documents. The (.lwp) format is the native file format for Lotus Word Pro that is a word processor developed by IBM's Lotus Software group. More details can be found by reviewing the following patch commits: [Commit 1](http://cgit.freedesktop.org/libreoffice/filters/commit/?id=d93fa011d713100775cd3ac88c468b6830d48877) and [Commit 2](http://cgit.freedesktop.org/libreoffice/filters/commit/?id=278831e37a23e9e2e29ca811c3a5398b7c67464d). |
| --- |

### Impact

| By convincing a user to open a specifically crafted 'Lotus Word Pro' (.lwp) document, an attacker may be able to execute arbitrary code. |
| --- |

### Solution

| **Apply an Update**  [LibreOffice 3.3.3 and 3.4.0](http://www.libreoffice.org/download/) both address these vulnerabilities. |
| --- |

### Vendor Information

953183
Filter by status:
All
Affected
Not Affected
Unknown

Filter by content:
 Additional information available

 Sort by:
Status
Alphabetical

Expand all

**Javascript is disabled. Click [here](/vuls/vendor/VU%23953183/) to view vendors.**
### [LibreOffice](#MAPG-8FNL3X) Affected

Notified:  April 06, 2011  Updated: June 06, 2011

### Status

Affected

### Vendor Statement

We have not received a statement from the vendor.

### Vendor Information

We are not aware of further vendor information regarding this vulnerability.

### CVSS Metrics

| Group | Score | Vector |
| --- | --- | --- |
| Base | 9 | AV:N/AC:M/Au:N/C:C/I:C/A:P |
| Temporal | 7 | E:POC/RL:OF/RC:C |
| Environmental | 7 | CDP:ND/TD:ND/CR:ND/IR:ND/AR:ND |

### References

* <http://www.libreoffice.org/advisories/cve-2011-2685/>
* <http://www.libreoffice.org/download/>
* <http://cgit.freedesktop.org/libreoffice/filters/commit/?id=d93fa011d713100775cd3ac88c468b6830d48877>
* <http://cgit.freedesktop.org/libreoffice/filters/commit/?id=278831e37a23e9e2e29ca811c3a5398b7c67464d>
### Acknowledgements

Thanks to Will Dormann and Jared Allar of the CERT/CC for reporting these vulnerabilities.

This document was written by Jared Allar.

### Other Information

| **CVE IDs:** | [CVE-2011-2685](http://web.nvd.nist.gov/vuln/detail/CVE-2011-2685) |
| --- | --- |
| **Severity Metric:** | 0.20 |
| **Date Public:** | 2011-06-16 |
| **Date First Published:** | 2011-06-22 |
| **Date Last Updated:** | 2012-03-28 15:15 UTC |
| **Document Revision:** | 23 |

* [About vulnerability notes](https://vuls.cert.org/confluence/display/VIN/Vulnerability%2BNote%2BHelp)
* Contact us about this vulnerability
* [Provide a vendor statement](https://vuls.cert.org/confluence/display/VIN/Case%2BHandling#CaseHandling-Givingavendorstatusandstatement)

Sponsored by [CISA.](https://www.cisa.gov/cybersecurity)

 [Download PGP Key](https://vuls.cert.org/confluence/pages/viewpage.action?pageId=25985026)

[Read CERT/CC Blog](https://insights.sei.cmu.edu/cert/)

[Learn about Vulnerability Analysis](https://www.sei.cmu.edu/research-capabilities/all-work/display.cfm?customel_datapageid_4050=21304)

Carnegie Mellon University

Software Engineering Institute

4500 Fifth Avenue

Pittsburgh, PA 15213-2612

412-268-5800

[Office Locations](http://www.sei.cmu.edu/locations/index.cfm) | [Additional Sites Directory](http://www.sei.cmu.edu/additional-sites-directory/index.cfm) | [Legal](https://vuls.cert.org/confluence/display/VIN/VINCE%2BCode%2Bof%2BConduct#VINCECodeofConduct-TermsofUse) | [Privacy Notice](https://www.sei.cmu.edu/legal/privacy-notice/index.cfm) | [CMU Ethics Hotline](https://www.cmu.edu/hr/ethics-hotline/) | [www.sei.cmu.edu](http://www.sei.cmu.edu)

Â©2022 Carnegie Mellon University

[Contact SEI](https://www.sei.cmu.edu/contact-us/)
#### Contact CERT/CC

 412-268-5800



=== Content from bugzilla.novell.com_d18ce4c7_20250126_034733.html ===




=== Content from www.openwall.com_cbffd405_20250124_215425.html ===


| [Openwall](/) * [Products](/)   + [Openwall GNU/\*/Linux   *server OS*](/Owl/)+ [Linux Kernel Runtime Guard](/lkrg/)+ [John the Ripper   *password cracker*](/john/)         - [Free & Open Source for any platform](/john/)- [in the cloud](/john/cloud/)- [Pro for Linux](/john/pro/linux/)- [Pro for macOS](/john/pro/macosx/)+ [Wordlists   *for password cracking*](/wordlists/)+ [passwdqc   *policy enforcement*](/passwdqc/)             - [Free & Open Source for Unix](/passwdqc/)- [Pro for Windows (Active Directory)](/passwdqc/windows/)+ [yescrypt   *KDF & password hashing*](/yescrypt/)+ [yespower   *Proof-of-Work (PoW)*](/yespower/)+ [crypt\_blowfish   *password hashing*](/crypt/)+ [phpass   *ditto in PHP*](/phpass/)+ [tcb   *better password shadowing*](/tcb/)+ [Pluggable Authentication Modules](/pam/)+ [scanlogd   *port scan detector*](/scanlogd/)+ [popa3d   *tiny POP3 daemon*](/popa3d/)+ [blists   *web interface to mailing lists*](/blists/)+ [msulogin   *single user mode login*](/msulogin/)+ [php\_mt\_seed   *mt\_rand() cracker*](/php_mt_seed/)* [Services](/services/)* Publications       + [Articles](/articles/)+ [Presentations](/presentations/)* Resources         + [Mailing lists](/lists/)+ [Community wiki](https://openwall.info/wiki/)+ [Source code repositories (GitHub)](https://github.com/openwall)+ [Source code repositories (CVSweb)](https://cvsweb.openwall.com)+ [File archive & mirrors](/mirrors/)+ [How to verify digital signatures](/signatures/)+ [OVE IDs](/ove/)* [What's new](/news) | |
| --- | --- |

| | [Hash Suite - Windows password security audit tool. GUI, reports in PDF.](https://hashsuite.openwall.net) | | --- | |
| --- | --- |

[[<prev]](12) [[next>]](14) [[<thread-prev]](../../../2011/07/06/13) [[day]](.) [[month]](..) [[year]](../..) [[list]](../../..)
```

Message-ID: <1520941642.1274184.1310499116751.JavaMail.root@zmail01.collab.prod.int.phx2.redhat.com>
Date: Tue, 12 Jul 2011 15:31:56 -0400 (EDT)
From: Josh Bressers <bressers@...hat.com>
To: oss-security@...ts.openwall.com
Cc: coley <coley@...re.org>
Subject: Re: libreoffice/openoffice.org CVE id request

----- Original Message -----
> Hi,
> can someone assign a CVE id (or multiple) to:
> <http://www.kb.cert.org/vuls/id/953183>?
>

Please use CVE-2011-2685

Thanks.

--
    JB

```

[Powered by blists](https://www.openwall.com/blists/) - [more mailing lists](https://lists.openwall.net)

Please check out the
[Open Source Software Security Wiki](https://oss-security.openwall.org/wiki/), which is counterpart to this
[mailing list](https://oss-security.openwall.org/wiki/mailing-lists/oss-security).

Confused about [mailing lists](/lists/) and their use?
[Read about mailing lists on Wikipedia](https://en.wikipedia.org/wiki/Electronic_mailing_list)
and check out these
[guidelines on proper formatting of your messages](https://www.complang.tuwien.ac.at/anton/mail-news-errors.html).



=== Content from www.mandriva.com_670baffb_20250124_215423.html ===


* [Tuxedo.org](https://tuxedo.org/ "Go to: Tuxedo")
* Store
* Mandriva Linux
* Enterprise Solutions
* Contact Us
* Language ![](/sites/all/themes/mandriva_customer/images/arrow-grey-bottom.gif)
  + English (International)
  + Français
  + Ð ÑÑÑÐºÐ¸Ð¹

# [Mandriva](/mandriva/)

* Download
* Mandriva Linux
* Community
* Help

## One

### The Linux desktopthat's easy to try and easy to keep

Download
![Mandriva One](/sites/all/themes/mandriva_customer/images/front/packshot_Mandriva_One.png)

## Powerpack

### Mandriva Linux- and more

Download
![Mandriva Linux Powerpack](/sites/all/themes/mandriva_customer/images/front/en-49.png)

## Mandriva Flash

### The mobile and installable Linux desktopon a USB key

Buy on Store
![Mandriva Flash](/sites/all/themes/mandriva_customer/images/front/mandriva-flash2.png)

### [Community](community)

* User Forums
* Support - FAQ
* Free Software
* Become a member

### Enterprise Solutions

* Enterprise Linux Products
* Asset Management Solution
* Professional Services
* Support & Maintenance

* Go to site »

### Mandriva Partners

* Worldwide offices
* Partner Program
* Technology Partners
* OEM
* Classmate PC with Mandriva Linux

### News

* Mandriva presents the launch of its new mobile desktop: Mandriva Flash 2008 Spring
* Speaking about Mandriva Linux 2008 Spring in media
* Speaking about Mandriva Linux 2008 Spring in media
* Mandriva presents its latest distribution: Mandriva Linux 2008 Spring
* Mandriva and Novatice Technologies present Edutice, The ready to use solution dedicated to educationand multimedia spaces
* # [Top 50 Online Casinos UK in 2023](https://montycasinos.com/online-casinos/)

more

* Download
  + Mandriva Linux 2008
  + Writing an ISO image
* Mandriva Linux
  + One
  + Powerpack
  + Mandriva Flash
* Community
  + Start
  + Register
  + Stay informed
  + Participate
  + Free software
* Help
  + Getting help
  + Knowledge Base
  + Documentation
  + Forums
  + Support Requests
  + Customer Care
  + Enterprise Support
* Enterprise Solutions
  + Products
  + Support
  + Services
  + Partners
  + Go to site »

Language
English (International)
Français
Ð ÑÑÑÐºÐ¸Ð¹

* © 2007 Mandriva S.A.
* About Us
* Legal Information
* Privacy Policy
* Contact Us



=== Content from bugzilla.novell.com_8639db3a_20250126_034731.html ===




=== Content from www.openwall.com_ff0141a7_20250126_034743.html ===


| [Openwall](/) * [Products](/)   + [Openwall GNU/\*/Linux   *server OS*](/Owl/)+ [Linux Kernel Runtime Guard](/lkrg/)+ [John the Ripper   *password cracker*](/john/)         - [Free & Open Source for any platform](/john/)- [in the cloud](/john/cloud/)- [Pro for Linux](/john/pro/linux/)- [Pro for macOS](/john/pro/macosx/)+ [Wordlists   *for password cracking*](/wordlists/)+ [passwdqc   *policy enforcement*](/passwdqc/)             - [Free & Open Source for Unix](/passwdqc/)- [Pro for Windows (Active Directory)](/passwdqc/windows/)+ [yescrypt   *KDF & password hashing*](/yescrypt/)+ [yespower   *Proof-of-Work (PoW)*](/yespower/)+ [crypt\_blowfish   *password hashing*](/crypt/)+ [phpass   *ditto in PHP*](/phpass/)+ [tcb   *better password shadowing*](/tcb/)+ [Pluggable Authentication Modules](/pam/)+ [scanlogd   *port scan detector*](/scanlogd/)+ [popa3d   *tiny POP3 daemon*](/popa3d/)+ [blists   *web interface to mailing lists*](/blists/)+ [msulogin   *single user mode login*](/msulogin/)+ [php\_mt\_seed   *mt\_rand() cracker*](/php_mt_seed/)* [Services](/services/)* Publications       + [Articles](/articles/)+ [Presentations](/presentations/)* Resources         + [Mailing lists](/lists/)+ [Community wiki](https://openwall.info/wiki/)+ [Source code repositories (GitHub)](https://github.com/openwall)+ [Source code repositories (CVSweb)](https://cvsweb.openwall.com)+ [File archive & mirrors](/mirrors/)+ [How to verify digital signatures](/signatures/)+ [OVE IDs](/ove/)* [What's new](/news) | |
| --- | --- |

| | [Hash Suite - Windows password security audit tool. GUI, reports in PDF.](https://hashsuite.openwall.net) | | --- | |
| --- | --- |

# blists - web interface to mailing list archives

blists is a web interface to mailing list archives that works off indexed mbox files.
There are two programs: *bindex* and *bit*.
*bindex* generates or updates the index file (yes, incremental updates are supported).
*bit* is a CGI/SSI program that generates web pages on the fly.
Both programs are written in C and are very fast.

You can view the latest <README> file,
which describes blists in more detail and provides installation instructions.
It is also included in the archive below.

Download ([release notes](/lists/announce/2017/11/19/1)):

* [blists 2.0](blists-2.0.tar.gz) and
  its [signature](blists-2.0.tar.gz.sign)* [blists 1.0](blists-1.0.tar.gz) and
    its [signature](blists-1.0.tar.gz.sign)

These files are also
[available from the Openwall file archive](https://download.openwall.net/pub/projects/blists/).
The source code of blists can be browsed on
[GitHub](https://github.com/openwall/blists) or via
[CVSweb](https://cvsweb.openwall.com/blists).

Follow [this link](/signatures/) for information on verifying the signatures.

To see blists in action, check out our
[Open Source and information security mailing list archives](https://lists.openwall.net).

blists is a registered project with
[Open Hub](https://www.openhub.net/p/blists).

Quick Comment:

413271



=== Content from cgit.freedesktop.org_3e036c9c_20250124_215419.html ===


| [cgit logo](/) | [index](/) : [libreoffice/filters](/libreoffice/filters/) | feature/bootstrap-build feature/calc-multiline-input feature/currency-64bit feature/gnumake4 feature/gnumake4\_writerfilter feature/gsoc2011\_wizards feature/helppack feature/layout feature/onemsi feature/pptx-export-ooxml11 feature/rodatastrings feature/winshrink gr2 integration/dev300\_m101 integration/dev300\_m106 integration/dev300\_m98 libreoffice-3-3 libreoffice-3-3-0 libreoffice-3-3-1 libreoffice-3-3-2 libreoffice-3-3-3 libreoffice-3-3-4 libreoffice-3-4 libreoffice-3-4-0 libreoffice-3-4-1 libreoffice-3-4-2 libreoffice-3-4-3 libreoffice-3-4-4 libreoffice-3-4-5 libreoffice-3-4-6 master master-backup master-deleted warning |
| --- | --- | --- |
| obsolete from 3.5 - Import and export filters | root |

| [summary](/libreoffice/filters/)[refs](/libreoffice/filters/refs/?id=d93fa011d713100775cd3ac88c468b6830d48877)[log](/libreoffice/filters/log/)[tree](/libreoffice/filters/tree/?id=d93fa011d713100775cd3ac88c468b6830d48877)[commit](/libreoffice/filters/commit/?id=d93fa011d713100775cd3ac88c468b6830d48877)[diff](/libreoffice/filters/diff/?id=d93fa011d713100775cd3ac88c468b6830d48877) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Caolán McNamara <caolanm@redhat.com> | 2011-04-06 21:37:47 +0100 |
| --- | --- | --- |
| committer | Caolán McNamara <caolanm@redhat.com> | 2011-04-06 21:37:47 +0100 |
| commit | [d93fa011d713100775cd3ac88c468b6830d48877](/libreoffice/filters/commit/?id=d93fa011d713100775cd3ac88c468b6830d48877) ([patch](/libreoffice/filters/patch/?id=d93fa011d713100775cd3ac88c468b6830d48877)) | |
| tree | [f327e060b1847306f881fe90d0949393c052939d](/libreoffice/filters/tree/?id=d93fa011d713100775cd3ac88c468b6830d48877) | |
| parent | [3940aa73191d27efba9c70331d6460b78fe9320a](/libreoffice/filters/commit/?id=3940aa73191d27efba9c70331d6460b78fe9320a) ([diff](/libreoffice/filters/diff/?id=d93fa011d713100775cd3ac88c468b6830d48877&id2=3940aa73191d27efba9c70331d6460b78fe9320a)) | |

avoid possibility of accessing out of range ObjTimes[Diffstat](/libreoffice/filters/diff/?id=d93fa011d713100775cd3ac88c468b6830d48877)

| -rw-r--r-- | [lotuswordpro/source/filter/lwpidxmgr.hxx](/libreoffice/filters/diff/lotuswordpro/source/filter/lwpidxmgr.hxx?id=d93fa011d713100775cd3ac88c468b6830d48877) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |
| -rw-r--r-- | [lotuswordpro/source/filter/lwpobjid.cxx](/libreoffice/filters/diff/lotuswordpro/source/filter/lwpobjid.cxx?id=d93fa011d713100775cd3ac88c468b6830d48877) | 4 | |  |  |  | | --- | --- | --- | |

2 files changed, 3 insertions, 3 deletions

| diff --git a/lotuswordpro/source/filter/lwpidxmgr.hxx b/lotuswordpro/source/filter/lwpidxmgr.hxxindex 54b88d853..9fa607468 100644--- a/[lotuswordpro/source/filter/lwpidxmgr.hxx](/libreoffice/filters/tree/lotuswordpro/source/filter/lwpidxmgr.hxx?id=3940aa73191d27efba9c70331d6460b78fe9320a)+++ b/[lotuswordpro/source/filter/lwpidxmgr.hxx](/libreoffice/filters/tree/lotuswordpro/source/filter/lwpidxmgr.hxx?id=d93fa011d713100775cd3ac88c468b6830d48877)@@ -112,7 +112,7 @@ protected: public: void Read( LwpSvStream \*pStrm ); sal\_uInt32 GetObjOffset( LwpObjectID objid );- sal\_uInt32 GetObjTime( sal\_uInt16 index ) { return m\_TimeTable[index-1]; }+ sal\_uInt32 GetObjTime( sal\_uInt16 index ) { return m\_TimeTable.at(index-1); } }; #endif diff --git a/lotuswordpro/source/filter/lwpobjid.cxx b/lotuswordpro/source/filter/lwpobjid.cxxindex 61d99b434..0a76504af 100644--- a/[lotuswordpro/source/filter/lwpobjid.cxx](/libreoffice/filters/tree/lotuswordpro/source/filter/lwpobjid.cxx?id=3940aa73191d27efba9c70331d6460b78fe9320a)+++ b/[lotuswordpro/source/filter/lwpobjid.cxx](/libreoffice/filters/tree/lotuswordpro/source/filter/lwpobjid.cxx?id=d93fa011d713100775cd3ac88c468b6830d48877)@@ -148,11 +148,11 @@ sal\_uInt32 LwpObjectID::ReadIndexed(LwpObjectStream \*pStrm) LwpGlobalMgr\* pGlobal = LwpGlobalMgr::GetInstance(); LwpObjectFactory\* pFactory = pGlobal->GetLwpObjFactory(); LwpIndexManager\* pIdxMgr = pFactory->GetIndexManager();- m\_nLow = pIdxMgr->GetObjTime( (sal\_uInt16)m\_nIndex);+ m\_nLow = pIdxMgr->GetObjTime( (sal\_uInt16)m\_nIndex); } else {- pStrm->QuickRead(&m\_nLow, sizeof(m\_nLow));+ pStrm->QuickRead(&m\_nLow, sizeof(m\_nLow)); } pStrm->QuickRead(&m\_nHigh, sizeof(m\_nHigh)); return DiskSizeIndexed(); |
| --- |

generated by [cgit v1.2.3](https://git.zx2c4.com/cgit/about/) ([git 2.39.1](https://git-scm.com/)) at 2025-01-24 21:54:19 +0000



=== Content from lists.openwall.net_ae5d8845_20250126_034733.html ===


| [lists.openwall.net](https://lists.openwall.net) [lists](/)  /  [announce](https://www.openwall.com/lists/announce/)  [owl-users](https://www.openwall.com/lists/owl-users/)  [owl-dev](https://www.openwall.com/lists/owl-dev/)  [john-users](https://www.openwall.com/lists/john-users/)  [john-dev](https://www.openwall.com/lists/john-dev/)  [passwdqc-users](https://www.openwall.com/lists/passwdqc-users/)  [yescrypt](https://www.openwall.com/lists/yescrypt/)  [popa3d-users](https://www.openwall.com/lists/popa3d-users/)  /  [oss-security](https://www.openwall.com/lists/oss-security/)  [kernel-hardening](https://www.openwall.com/lists/kernel-hardening/)  [musl](https://www.openwall.com/lists/musl/)  [sabotage](https://www.openwall.com/lists/sabotage/)  [tlsify](https://www.openwall.com/lists/tlsify/)  [passwords](https://www.openwall.com/lists/passwords/)  /  [crypt-dev](https://www.openwall.com/lists/crypt-dev/)  [xvendor](https://www.openwall.com/lists/xvendor/)  /  [Bugtraq](/bugtraq/)  [Full-Disclosure](/full-disclosure/)  [linux-kernel](/linux-kernel/)  linux-[netdev](/netdev/)  [linux-ext4](/linux-ext4/)  [linux-hardening](/linux-hardening/)  [linux-cve-announce](/linux-cve-announce/)  [PHC](/phc-discussions/)| *Open Source and information security mailing list archives*|  | | | | |
| --- | --- | --- | --- | --- |

| | [Hash Suite: Windows password security audit tool. GUI, reports in PDF.](https://hashsuite.openwall.net) | | --- | |
| --- | --- |

# Open Source and information security mailing list archives

### Openwall-hosted community mailing lists

* [oss-security](https://www.openwall.com/lists/oss-security/)
  ([info](https://oss-security.openwall.org/wiki/mailing-lists/oss-security)) -
  Open Source software security discussions
  (there's also a [wiki](https://oss-security.openwall.org/wiki/))* [kernel-hardening](https://www.openwall.com/lists/kernel-hardening/) -
    Linux kernel security hardening discussions (see also linux-hardening below)* [libc-coord](https://www.openwall.com/lists/libc-coord/) -
      [coordination of work on standard C libraries (libc)](https://www.openwall.com/lists/libc-coord/2020/01/30/1)* [musl](https://www.openwall.com/lists/musl/) - discussions around
        [musl](https://www.musl-libc.org),
        a new standard C library for Linux* [passwords](https://www.openwall.com/lists/passwords/) - discussions on anything related to passwords
          except what better fits on other mailing lists* [sabotage](https://www.openwall.com/lists/sabotage/) -
            discussions around Sabotage Linux,
            an experimental distribution based on musl and BusyBox* [tlsify](https://www.openwall.com/lists/tlsify/) - [a TLS API](https://www.openwall.com/lists/tlsify/2015/09/28/1)
              for file-descriptor-oriented applications to make use of secure (TLS) sockets
              without invasive changes to their programming model

### Openwall mailing lists

* [announce](https://www.openwall.com/lists/announce/) - announcements only, very low traffic* [owl-users](https://www.openwall.com/lists/owl-users/) -
    [Openwall GNU/\*/Linux](https://www.openwall.com/Owl/) (Owl) user discussions* [owl-dev](https://www.openwall.com/lists/owl-dev/) - Owl development discussions* [lkrg-users](https://www.openwall.com/lists/lkrg-users/) -
        [Linux Kernel Runtime Guard](https://www.openwall.com/lkrg/) user discussions* [john-users](https://www.openwall.com/lists/john-users/) -
          [John the Ripper](https://www.openwall.com/john/) password cracker user discussions

          See also:
          [selected most useful and currently relevant postings](https://openwall.info/wiki/john/mailing-list-excerpts)* [john-dev](https://www.openwall.com/lists/john-dev/) -
            John the Ripper development discussions* [passwdqc-users](https://www.openwall.com/lists/passwdqc-users/) -
              [passwdqc](https://www.openwall.com/passwdqc/)
              password/passphrase strength checking and policy enforcement toolset user discussions* [yescrypt](https://www.openwall.com/lists/yescrypt/) -
                discussions around [yescrypt](https://www.openwall.com/yescrypt/) KDF and password hashing scheme* [popa3d-users](https://www.openwall.com/lists/popa3d-users/) -
                  [popa3d](https://www.openwall.com/popa3d/) Unix POP3 daemon user discussions

### Obsolete/inactive Openwall(-hosted) mailing lists

* [crypt-dev](https://www.openwall.com/lists/crypt-dev/) -
  [design and implementation of a new password hashing method for servers](https://www.openwall.com/lists/crypt-dev/2011/04/05/2)* [xvendor](https://www.openwall.com/lists/xvendor/)
    ([info](https://www.openwall.com/community/xvendor)) -
    collaboration and information exchange between OS distribution vendors
    (mostly Linux) on non-security topics

### Other (third-party) mailing lists

* [Bugtraq](bugtraq/) -
  security vulnerability announcements and discussions, pre-moderated* [Full-Disclosure](full-disclosure/) -
    security vulnerability announcements and discussions, originally not moderated but now also pre-moderated* [linux-kernel](linux-kernel/) -
      Linux kernel development discussions, very high volume* [netdev](netdev/) -
        Linux networking subsystem development discussions, high volume* [linux-ext4](linux-ext4/) -
          Linux ext4 filesystem development* [linux-hardening](linux-hardening/) -
            Linux kernel security hardening discussions (focused on upstream maintenance of the changes)* [linux-cve-announce](linux-cve-announce/) -
              [Linux kernel CVE announcements](https://docs.kernel.org/process/cve.html)* [PHC discussions](phc-discussions/) -
                [Password Hashing Competition](https://password-hashing.net)
                discussions

Quick Comment:

| [Powered by Openwall GNU/*/Linux](https://www.openwall.com/Owl/ "Powered by Openwall GNU/*/Linux - security-enhanced \"Linux distribution\"") [Powered by OpenVZ](https://openvz.org "Powered by OpenVZ - OS virtualization solution for Linux") 783624 | |
| --- | --- |


