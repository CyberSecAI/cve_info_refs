=== Content from bugzilla.mozilla.org_9320c092_20250125_210156.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/658864)
* [XML](/show_bug.cgi?ctype=xml&id=658864)

Closed
[Bug 658864](/show_bug.cgi?id=658864)

Opened 14 years ago
Closed 14 years ago

# The GC can still happen when reporting OOM

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

The GC can still happen when reporting OOM

## Categories

### (Core :: JavaScript Engine, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=JavaScript%20Engine#JavaScript%20Engine)

JavaScript Engine
▾

Core :: JavaScript Engine
The interpreter engine for the core JavaScript language, independent of the browser's object model. File ONLY core JavaScript language bugs in this category. For bugs involving browser objects such as "window" and "document", use the "DOM" component. For bugs involving calls between JavaScript and C++, use the "XPConnect" component.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=JavaScript%20Engine&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=JavaScript%20Engine&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=JavaScript%20Engine)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

unspecified

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

All

All

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

normal

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

---

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Webcompat Priority | --- |
| --- | --- |
| a11y-review | --- |
| Accessibility Severity | --- |
| Performance Impact | --- |
| Webcompat Score | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox5 | [-](/buglist.cgi?f1=cf_tracking_firefox5&o1=equals&v1=-) | [wontfix](/buglist.cgi?f1=cf_status_firefox5&o1=equals&v1=wontfix) |
| firefox6 | [-](/buglist.cgi?f1=cf_tracking_firefox6&o1=equals&v1=-) | [wontfix](/buglist.cgi?f1=cf_status_firefox6&o1=equals&v1=wontfix) |
| firefox7 | [+](/buglist.cgi?f1=cf_tracking_firefox7&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox7&o1=equals&v1=fixed) |
| status1.9.2 | --- | [wontfix](/buglist.cgi?f1=cf_status_192&o1=equals&v1=wontfix) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox5 | - | wontfix |
| firefox6 | - | wontfix |
| firefox7 | + | fixed |
| status1.9.2 |  | wontfix |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: igor, Assigned: igor)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/78556976aa7c7e7980d6865f27df11b8?d=mm&size=40)  [igor](/user_profile?user_id=50763)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/78556976aa7c7e7980d6865f27df11b8?d=mm&size=40)  [igor](/user_profile?user_id=50763)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/4fe52ee1503aecf7b6c976b8eb7c1753?d=mm&size=40)  [willyelm](/user_profile?user_id=714609)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

12 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[640265](/show_bug.cgi?id=640265 "RESOLVED FIXED - GC during cx->calloc can cause invalid shape in a new JSObject")

Dependency [tree](/showdependencytree.cgi?id=658864&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=658864)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Whiteboard: [sg:critical?] fixed-in-tracemonkey [qa-])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

---

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[sg:critical?] fixed-in-tracemonkey [qa-]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (1 file)

| [v1](/attachment.cgi?id=534304)  [14 years ago](#c2)  [Igor Bukanov](/user_profile?user_id=50763)   5.55 KB, patch | gwagner : [review+](#a276288_314734 "14 years ago") | [Details](/attachment.cgi?id=534304&action=edit) | [Diff](/attachment.cgi?id=534304&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=658864&attachment=534304) |
| --- | --- | --- |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Igor Bukanov](/user_profile?user_id=50763)  Assignee |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=658864#c0)• 14 years ago |
|  | |

The [bug 640265](/show_bug.cgi?id=640265 "RESOLVED FIXED - GC during cx->calloc can cause invalid shape in a new JSObject") tries to prevent the GC from happening when reporting OOM. Hover, the implemented fix has a race that still allows to run the GC under OOM. The problem comes from using the global boolean JSRuntime::inOOMReport flag that is updated and checked outside a lock. As such the check in the js\_GC for the flag can happen after an OOM also happens on another thread which can clear the flag before js\_GC accesses it.

|  | [Igor Bukanov](/user_profile?user_id=50763)  Assignee |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=658864#c1)• 14 years ago |
|  | |

There is yet another problem. The error reporter for DOM workers suspends the current request even for OOM error, see <http://hg.mozilla.org/tracemonkey/file/57412df720cf/dom/src/threads/nsDOMThreadService.cpp#l630>. So what can happen is that the main thread waits in js\_GC for a worker request to complete, then the worker gets OOM and suspend the request in the error reporter. Then the GC on the main thread starts resulting in GC during memory allocation.
To fix both this and the problem from the [comment 0](/show_bug.cgi?id=658864#c0 "RESOLVED FIXED - The GC can still happen when reporting OOM") I plan to use atomic increment/decrement to set the OOM reporting flag and move the flag check after the GC has waited for other threads to suspend the requests.Assignee: general → igor

|  | [Igor Bukanov](/user_profile?user_id=50763)  Assignee |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=658864#c2)• 14 years ago |
|  | |

Attached patch

[v1](attachment.cgi?id=534304&action=diff)
— [Details](attachment.cgi?id=534304&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=658864&attachment=534304)

The patch implements the plan from the [comment 1](/show_bug.cgi?id=658864#c1 "RESOLVED FIXED - The GC can still happen when reporting OOM").
[Attachment #534304](/attachment.cgi?id=534304&action=edit "v1") -
Flags: review?(anygregor)

|  | [Gregor Wagner [:gwagner]](/user_profile?user_id=314734) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=658864#a276288_314734)• 14 years ago |

[Attachment #534304](/attachment.cgi?id=534304&action=edit "v1") -
Flags: review?(anygregor) → review+

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=658864#c3)• 14 years ago |
|  | |

severity rating based on [bug 640265](/show_bug.cgi?id=640265 "RESOLVED FIXED - GC during cx->calloc can cause invalid shape in a new JSObject")Whiteboard: [sg:critical?]

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=658864#a1588340_12352)• 14 years ago |

[status-firefox5](/buglist.cgi?f1=cf_status_firefox5&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox5&o1=equals&v1=wontfix)
[status-firefox6](/buglist.cgi?f1=cf_status_firefox6&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox6&o1=equals&v1=affected)
[status-firefox7](/buglist.cgi?f1=cf_status_firefox7&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox7&o1=equals&v1=affected)
[tracking-firefox5](/buglist.cgi?f1=cf_tracking_firefox5&o1=isnotempty):
--- → [-](/buglist.cgi?f1=cf_tracking_firefox5&o1=equals&v1=-)
[tracking-firefox6](/buglist.cgi?f1=cf_tracking_firefox6&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox6&o1=equals&v1=%2B)
[tracking-firefox7](/buglist.cgi?f1=cf_tracking_firefox7&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox7&o1=equals&v1=%2B)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=658864#c4)• 14 years ago |
|  | |

Igor: any progress on this one?

|  | [Igor Bukanov](/user_profile?user_id=50763)  Assignee |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=658864#c5)• 14 years ago |
|  | |

<http://hg.mozilla.org/mozilla-central/rev/87cb1807aab9>
- I forgot to mark the bug fixed-in-tracemonkey after landing it for some time. Sorry about that.Status: NEW → RESOLVEDClosed: 14 years agoResolution: --- → FIXEDWhiteboard: [sg:critical?] → [sg:critical?] fixed-in-tracemonkey

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=658864#a2795996_1689)• 14 years ago |

[status-firefox7](/buglist.cgi?f1=cf_status_firefox7&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox7&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox7&o1=equals&v1=fixed)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=658864#c6)• 14 years ago |
|  | |

Merged to mozilla-central on June 6 so it made mozilla7 but not mozilla6. Luke asserts backporting isn't really necessary here, it's an extremely low probability condition to exploit.
[status-firefox6](/buglist.cgi?f1=cf_status_firefox6&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox6&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox6&o1=equals&v1=wontfix)
[tracking-firefox6](/buglist.cgi?f1=cf_tracking_firefox6&o1=isnotempty):
[+](/buglist.cgi?f1=cf_tracking_firefox6&o1=equals&v1=%2B) → [-](/buglist.cgi?f1=cf_tracking_firefox6&o1=equals&v1=-)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=658864#c7)• 13 years ago |
|  | |

I don't know if this applies to the 1.9.2 branch, but we're unlikely to fix it even if it does.
[status1.9.2](/buglist.cgi?f1=cf_status_192&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_192&o1=equals&v1=wontfix)

|  | [u279076](/user_profile?user_id=279076) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=658864#c8)• 13 years ago |
|  | |

qa-: does not seem to be anything QA can do to verify this fixWhiteboard: [sg:critical?] fixed-in-tracemonkey → [sg:critical?] fixed-in-tracemonkey [qa-]

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=658864#a15312994_1689)• 13 years ago |

Group: core-security
You need to [log in](/show_bug.cgi?id=658864&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Igor Bukanov](/user_profile?user_id=50763)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from bugzilla.mozilla.org_9a47ccf6_20250125_210200.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/664930)
* [XML](/show_bug.cgi?ctype=xml&id=664930)

Closed
[Bug 664930](/show_bug.cgi?id=664930)

Opened 14 years ago
Closed 13 years ago

# Crash [@ \_cairo\_bentley\_ottmann\_tessellate\_rectangular]

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Crash [@ \_cairo\_bentley\_ottmann\_tessellate\_rectangular]

## Categories

### (Core :: Graphics, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=Graphics#Graphics)

Graphics
▾

Core :: Graphics
Mapping of cross platform rendering interfaces to various 2D graphics APIs
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=Graphics&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=Graphics&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=Graphics)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

x86\_64

macOS

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

critical

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

---

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Accessibility Severity | --- |
| --- | --- |
| a11y-review | --- |
| Webcompat Score | --- |
| Webcompat Priority | --- |
| Performance Impact | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox5 | [-](/buglist.cgi?f1=cf_tracking_firefox5&o1=equals&v1=-) | [wontfix](/buglist.cgi?f1=cf_status_firefox5&o1=equals&v1=wontfix) |
| firefox6 | [-](/buglist.cgi?f1=cf_tracking_firefox6&o1=equals&v1=-) | [wontfix](/buglist.cgi?f1=cf_status_firefox6&o1=equals&v1=wontfix) |
| firefox7 | [+](/buglist.cgi?f1=cf_tracking_firefox7&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox7&o1=equals&v1=fixed) |
| firefox8 | [+](/buglist.cgi?f1=cf_tracking_firefox8&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox8&o1=equals&v1=fixed) |
| firefox9 | [+](/buglist.cgi?f1=cf_tracking_firefox9&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=fixed) |
| status1.9.2 | --- | [unaffected](/buglist.cgi?f1=cf_status_192&o1=equals&v1=unaffected) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox5 | - | wontfix |
| firefox6 | - | wontfix |
| firefox7 | + | fixed |
| firefox8 | + | fixed |
| firefox9 | + | fixed |
| status1.9.2 |  | unaffected |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: jruderman, Assigned: jrmuizel)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/ad916833cb7747e6939d576f34df1daa?d=mm&size=40)  [jrmuizel](/user_profile?user_id=309398)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/d2dc9227eafcd0ec5ba3712ee4f19b75?d=mm&size=40)  [jruderman](/user_profile?user_id=11608)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/17436ade8da1b23d42b3df05b9c4fc77?d=mm&size=40)  [bhood](/user_profile?user_id=697075)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

5 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

[678505](/show_bug.cgi?id=678505 "RESOLVED WONTFIX - Back out cairo update for FF7")

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[randomstyles](/show_bug.cgi?id=306939 "RESOLVED INACTIVE - [meta] Bugs found by Random Styles (adding random style properties to DOM elements)")

Dependency [tree](/showdependencytree.cgi?id=664930&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=664930)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (4 keywords, Whiteboard: [sg:critical][qa!])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[crash](/buglist.cgi?keywords=crash&resolution=---),
[testcase](/buglist.cgi?keywords=testcase&resolution=---),
[verified-aurora](/buglist.cgi?keywords=verified-aurora&resolution=---),
[verified-beta](/buglist.cgi?keywords=verified-beta&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[sg:critical][qa!]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |
|  | qe-verify |  |

## Crash Data

Signature:

[[@ \_cairo\_bentley\_ottmann\_tessellate\_rectangular ]](https://crash-stats.mozilla.org/signature/?signature=_cairo_bentley_ottmann_tessellate_rectangular)

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (4 files, 2 obsolete files)

| [testcase (crashes Firefox when loaded)](/attachment.cgi?id=539998)  [14 years ago](#c0)  [Jesse Ruderman](/user_profile?user_id=11608)   75 bytes, text/html |  | [Details](/attachment.cgi?id=539998&action=edit) |
| --- | --- | --- |
| [stack trace](/attachment.cgi?id=539999)  [14 years ago](#c1)  [Jesse Ruderman](/user_profile?user_id=11608)   10.18 KB, text/plain |  | [Details](/attachment.cgi?id=539999&action=edit) |
| [Standalone cairo test case that reproduces the problem](/attachment.cgi?id=549274)  [13 years ago](#c10)  [Jeff Muizelaar [:jrmuizel]](/user_profile?user_id=309398)   645 bytes, text/x-csrc |  | [Details](/attachment.cgi?id=549274&action=edit) |
| [Handle the case where an edge lies at the left most coordinate](/attachment.cgi?id=549389)  [13 years ago](#c11)  [Jeff Muizelaar [:jrmuizel]](/user_profile?user_id=309398)   822 bytes, patch |  | [Details](/attachment.cgi?id=549389&action=edit) | [Diff](/attachment.cgi?id=549389&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=664930&attachment=549389) |
| [Handle the case where an edge lies at the left most coordinate and initialize the rest of the data](/attachment.cgi?id=551582)  [13 years ago](#c16)  [Jeff Muizelaar [:jrmuizel]](/user_profile?user_id=309398)   1.98 KB, patch | bjacob : [review+](#c17 "13 years ago") | [Details](/attachment.cgi?id=551582&action=edit) | [Diff](/attachment.cgi?id=551582&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=664930&attachment=551582) |
| [Handle the case where an edge lies at the left most coordinate and initialize the rest of the data v2](/attachment.cgi?id=552727)  [13 years ago](#c18)  [Jeff Muizelaar [:jrmuizel]](/user_profile?user_id=309398)   2.18 KB, patch | christian : [approval-mozilla-beta+](#c22 "13 years ago") | [Details](/attachment.cgi?id=552727&action=edit) | [Diff](/attachment.cgi?id=552727&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=664930&attachment=552727) |

Show Obsolete

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Jesse Ruderman](/user_profile?user_id=11608)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=664930#c0)• 14 years ago |
|  | |

Attached file
[testcase (crashes Firefox when loaded)](attachment.cgi?id=539998)
— [Details](attachment.cgi?id=539998&action=edit)

Possibly a regression from the recent cairo update?
<http://hg.mozilla.org/mozilla-central/pushloghtml?changeset=102be3d1f103>

|  | [Jesse Ruderman](/user_profile?user_id=11608)  Reporter |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=664930#c1)• 14 years ago |
|  | |

Attached file
[stack trace](attachment.cgi?id=539999)
— [Details](attachment.cgi?id=539999&action=edit)

|  | [Jesse Ruderman](/user_profile?user_id=11608)  Reporter |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=664930#c2)• 14 years ago |
|  | |

Security-sensitive because it often crashes trying to access 0x1e7c2f8 rather than something near 0x0.

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=664930#c3)• 14 years ago |
|  | |

Jeff, this sounds like something that came in with your most recent cairo import.Assignee: nobody → jmuizelaar
[status-firefox5](/buglist.cgi?f1=cf_status_firefox5&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox5&o1=equals&v1=wontfix)
[status-firefox6](/buglist.cgi?f1=cf_status_firefox6&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox6&o1=equals&v1=affected)
[status-firefox7](/buglist.cgi?f1=cf_status_firefox7&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox7&o1=equals&v1=affected)
[tracking-firefox5](/buglist.cgi?f1=cf_tracking_firefox5&o1=isnotempty):
--- → [-](/buglist.cgi?f1=cf_tracking_firefox5&o1=equals&v1=-)
[tracking-firefox6](/buglist.cgi?f1=cf_tracking_firefox6&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox6&o1=equals&v1=%2B)
[tracking-firefox7](/buglist.cgi?f1=cf_tracking_firefox7&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox7&o1=equals&v1=%2B)

|  | [Jeff Muizelaar [:jrmuizel]](/user_profile?user_id=309398)  Assignee |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=664930#c4)• 14 years ago |
|  | |

 pos->prev->next = edge;
pos->prev is bogus. Not sure why yet. It looks like this is caused by an overflow of some value.

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=664930#c5)• 14 years ago |
|  | |

Does this affect Aurora? if it's a regression from the changeset in [comment 0](/show_bug.cgi?id=664930#c0 "VERIFIED FIXED - Crash [@ _cairo_bentley_ottmann_tessellate_rectangular]") then it should be in Aurora, but we need to test

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=664930#c6)• 14 years ago |
|  | |

Jeff, any updates here? It's getting late for 6, but if we can get a safe fix for 6 soon we'd still consider it.

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=664930#c7)• 14 years ago |
|  | |

No updates so I don't think we can take this for 6 any more.
[status-firefox6](/buglist.cgi?f1=cf_status_firefox6&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox6&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox6&o1=equals&v1=wontfix)
[tracking-firefox6](/buglist.cgi?f1=cf_tracking_firefox6&o1=isnotempty):
[+](/buglist.cgi?f1=cf_tracking_firefox6&o1=equals&v1=%2B) → [-](/buglist.cgi?f1=cf_tracking_firefox6&o1=equals&v1=-)

|  | [Jeff Muizelaar [:jrmuizel]](/user_profile?user_id=309398)  Assignee |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=664930#c8)• 14 years ago |
|  | |

This shouldn't affect 6.

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=664930#a3594759_1689)• 13 years ago |

[status-firefox5](/buglist.cgi?f1=cf_status_firefox5&o1=isnotempty):
[wontfix](/buglist.cgi?f1=cf_status_firefox5&o1=equals&v1=wontfix) → [unaffected](/buglist.cgi?f1=cf_status_firefox5&o1=equals&v1=unaffected)
[status-firefox6](/buglist.cgi?f1=cf_status_firefox6&o1=isnotempty):
[wontfix](/buglist.cgi?f1=cf_status_firefox6&o1=equals&v1=wontfix) → [unaffected](/buglist.cgi?f1=cf_status_firefox6&o1=equals&v1=unaffected)Keywords: [regression](/buglist.cgi?keywords=regression&resolution=---),
[regressionwindow-wanted](/buglist.cgi?keywords=regressionwindow-wanted&resolution=---)

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=664930#c9)• 13 years ago |
|  | |

Jeff, any progress here? This has seemingly been sitting untouched for a while...
[status-firefox5](/buglist.cgi?f1=cf_status_firefox5&o1=isnotempty):
[unaffected](/buglist.cgi?f1=cf_status_firefox5&o1=equals&v1=unaffected) → [wontfix](/buglist.cgi?f1=cf_status_firefox5&o1=equals&v1=wontfix)
[status-firefox6](/buglist.cgi?f1=cf_status_firefox6&o1=isnotempty):
[unaffected](/buglist.cgi?f1=cf_status_firefox6&o1=equals&v1=unaffected) → [wontfix](/buglist.cgi?f1=cf_status_firefox6&o1=equals&v1=wontfix)Keywords: [regression](/buglist.cgi?keywords=regression&resolution=---),
[regressionwindow-wanted](/buglist.cgi?keywords=regressionwindow-wanted&resolution=---)

|  | [Jeff Muizelaar [:jrmuizel]](/user_profile?user_id=309398)  Assignee |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=664930#c10)• 13 years ago |
|  | |

Attached file
[Standalone cairo test case that reproduces the problem](attachment.cgi?id=549274)
— [Details](attachment.cgi?id=549274&action=edit)

|  | [Jeff Muizelaar [:jrmuizel]](/user_profile?user_id=309398)  Assignee |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=664930#c11)• 13 years ago |
|  | |

Attached patch

[Handle the case where an edge lies at the left most coordinate](attachment.cgi?id=549389&action=diff) (obsolete)
— [Details](attachment.cgi?id=549389&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=664930&attachment=549389)

This patch fixes the issue. The issue also appears to be just a NULL deference and so wouldn't be exploitable.

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=664930#c12)• 13 years ago |
|  | |

Removing sg:critical severity then to trigger a re-triage, with the likely outcome being that we'll open this bug up.Whiteboard: [sg:critical?]

|  | [Jesse Ruderman](/user_profile?user_id=11608)  Reporter |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=664930#c13)• 13 years ago |
|  | |

See [comment 2](/show_bug.cgi?id=664930#c2 "VERIFIED FIXED - Crash [@ _cairo_bentley_ottmann_tessellate_rectangular]") for why I initially marked the bug as sg:critical ...

|  | [Jeff Muizelaar [:jrmuizel]](/user_profile?user_id=309398)  Assignee |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=664930#c14)• 13 years ago |
|  | |

(In reply to [comment #13](/show_bug.cgi?id=664930#c13 "VERIFIED FIXED - Crash [@ _cairo_bentley_ottmann_tessellate_rectangular]"))
> See [comment 2](/show_bug.cgi?id=664930#c2 "VERIFIED FIXED - Crash [@ _cairo_bentley_ottmann_tessellate_rectangular]") for why I initially marked the bug as sg:critical ...
Hmm... that's interesting. I didn't see how that could happen with the thing that I fixed. It might be worth waiting a bit before opening this up.

|  | [Jeff Muizelaar [:jrmuizel]](/user_profile?user_id=309398)  Assignee |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=664930#c15)• 13 years ago |
|  | |

I took a closer look at this. The NULL dereference is not actually a NULL it's uninitialized stack memory so this is more severe than I originally thought. It's not clear if the unintialized value is controllable by content but we might as well assume that it is.

|  | [Jeff Muizelaar [:jrmuizel]](/user_profile?user_id=309398)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=664930#a4548728_309398)• 13 years ago |

Whiteboard: [sg:critical]

|  | [Jeff Muizelaar [:jrmuizel]](/user_profile?user_id=309398)  Assignee |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=664930#c16)• 13 years ago |
|  | |

Attached patch

[Handle the case where an edge lies at the left most coordinate and initialize the rest of the data](attachment.cgi?id=551582&action=diff) (obsolete)
— [Details](attachment.cgi?id=551582&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=664930&attachment=551582)

[Attachment #549389](/attachment.cgi?id=549389&action=edit "Handle the case where an edge lies at the left most coordinate") -
Attachment is obsolete: true
[Attachment #551582](/attachment.cgi?id=551582&action=edit "Handle the case where an edge lies at the left most coordinate and initialize the rest of the data") -
Flags: review?

|  | [Jeff Muizelaar [:jrmuizel]](/user_profile?user_id=309398)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=664930#a4552510_309398)• 13 years ago |

[Attachment #551582](/attachment.cgi?id=551582&action=edit "Handle the case where an edge lies at the left most coordinate and initialize the rest of the data") -
Flags: review? → review?(bjacob)

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769) |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=664930#c17)• 13 years ago |
|  | |

Comment on [attachment 551582](/attachment.cgi?id=551582 "Handle the case where an edge lies at the left most coordinate and initialize the rest of the data") [[details]](/attachment.cgi?id=551582&action=edit "Handle the case where an edge lies at the left most coordinate and initialize the rest of the data") [[diff]](/attachment.cgi?id=551582&action=diff "Handle the case where an edge lies at the left most coordinate and initialize the rest of the data") [[review]](/page.cgi?id=splinter.html&ignore=&bug=664930&attachment=551582)
Handle the case where an edge lies at the left most coordinate and initialize the rest of the data
r=me with the following change:
>+ /\* we need to initialize prev so that we can check
>+ \* if this edge is the left most and make sure
>+ \* we always insert to the right of it, even if
>+ \* our x coordinate matches \*/
>+ sweep\_line->head.prev = NULL;
Please initialize head.next = NULL too...
>-
>- pos->prev->next = edge;
>- edge->prev = pos->prev;
>- edge->next = pos;
>- pos->prev = edge;
>+ if (pos->prev) {
>+ pos->prev->next = edge;
>+ edge->prev = pos->prev;
>+ edge->next = pos;
>+ pos->prev = edge;
>+ } else {
>+ /\* we have edge that shares an x coordinate with the left most sentinal.
>+ \* instead of inserting before pos and ruining our sentinal we insert after pos. \*/
>+ pos->next->prev = edge;
So that if there ever is a weird case (zero-length list?) where there wouldn't be a pos->next here, at least we'd get a good null deref instead of an uninitialized pointer deref.
[Attachment #551582](/attachment.cgi?id=551582&action=edit "Handle the case where an edge lies at the left most coordinate and initialize the rest of the data") -
Flags: review?(bjacob) → review+

|  | [Jeff Muizelaar [:jrmuizel]](/user_profile?user_id=309398)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=664930#a4883996_309398)• 13 years ago |

Depends on: [678505](/show_bug.cgi?id=678505 "RESOLVED WONTFIX - Back out cairo update for FF7")

|  | [Jeff Muizelaar [:jrmuizel]](/user_profile?user_id=309398)  Assignee |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=664930#c18)• 13 years ago |
|  | |

Attached patch

[Handle the case where an edge lies at the left most coordinate and initialize the rest of the data v2](attachment.cgi?id=552727&action=diff)
— [Details](attachment.cgi?id=552727&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=664930&attachment=552727)

Adjusts to match review comments.
[Attachment #551582](/attachment.cgi?id=551582&action=edit "Handle the case where an edge lies at the left most coordinate and initialize the rest of the data") -
Attachment is obsolete: true

|  | [Jeff Muizelaar [:jrmuizel]](/user_profile?user_id=309398)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=664930#a4884869_309398)• 13 years ago |

[Attachment #552727](/attachment.cgi?id=552727&action=edit "Handle the case where an edge lies at the left most coordinate and initialize the rest of the data v2") -
Flags: approval-mozilla-aurora?

|  | [(no longer active)](/user_profile?user_id=251051) |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=664930#c19)• 13 years ago |
|  | |

Landed on inbound.

|  | [Jeff Muizelaar [:jrmuizel]](/user_profile?user_id=309398)  Assignee |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=664930#c20)• 13 years ago |
|  | |

<http://hg.mozilla.org/mozilla-central/rev/1fc015db1f6f>Status: NEW → RESOLVEDClosed: 13 years agoResolution: --- → FIXED

|  | [Asa Dotzler [:asa]](/user_profile?user_id=5003) |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=664930#c21)• 13 years ago |
|  | |

Comment on [attachment 552727](/attachment.cgi?id=552727 "Handle the case where an edge lies at the left most coordinate and initialize the rest of the data v2") [[details]](/attachment.cgi?id=552727&action=edit "Handle the case where an edge lies at the left most coordinate and initialize the rest of the data v2") [[diff]](/attachment.cgi?id=552727&action=diff "Handle the case where an edge lies at the left most coordinate and initialize the rest of the data v2") [[review]](/page.cgi?id=splinter.html&ignore=&bug=664930&attachment=552727)
Handle the case where an edge lies at the left most coordinate and initialize the rest of the data v2
Aurora [7] window has closed. Moving approval request to Beta.
[Attachment #552727](/attachment.cgi?id=552727&action=edit "Handle the case where an edge lies at the left most coordinate and initialize the rest of the data v2") -
Flags: approval-mozilla-aurora? → approval-mozilla-beta?

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=664930#a5408387_12352)• 13 years ago |

[status-firefox8](/buglist.cgi?f1=cf_status_firefox8&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox8&o1=equals&v1=fixed)
[status-firefox9](/buglist.cgi?f1=cf_status_firefox9&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=fixed)
[tracking-firefox8](/buglist.cgi?f1=cf_tracking_firefox8&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox8&o1=equals&v1=%2B)
[tracking-firefox9](/buglist.cgi?f1=cf_tracking_firefox9&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox9&o1=equals&v1=%2B)

|  | [LegNeato](/user_profile?user_id=482154) |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=664930#c22)• 13 years ago |
|  | |

Comment on [attachment 552727](/attachment.cgi?id=552727 "Handle the case where an edge lies at the left most coordinate and initialize the rest of the data v2") [[details]](/attachment.cgi?id=552727&action=edit "Handle the case where an edge lies at the left most coordinate and initialize the rest of the data v2") [[diff]](/attachment.cgi?id=552727&action=diff "Handle the case where an edge lies at the left most coordinate and initialize the rest of the data v2") [[review]](/page.cgi?id=splinter.html&ignore=&bug=664930&attachment=552727)
Handle the case where an edge lies at the left most coordinate and initialize the rest of the data v2
Approved for mozilla-beta
[Attachment #552727](/attachment.cgi?id=552727&action=edit "Handle the case where an edge lies at the left most coordinate and initialize the rest of the data v2") -
Flags: approval-mozilla-beta? → approval-mozilla-beta+

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=664930#a5757103_1689)• 13 years ago |

[status1.9.2](/buglist.cgi?f1=cf_status_192&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_192&o1=equals&v1=unaffected)

|  | [Jeff Muizelaar [:jrmuizel]](/user_profile?user_id=309398)  Assignee |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=664930#c23)• 13 years ago |
|  | |

<http://hg.mozilla.org/releases/mozilla-beta/rev/2347184b3d96>
[status-firefox7](/buglist.cgi?f1=cf_status_firefox7&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox7&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox7&o1=equals&v1=fixed)

|  | [u279076](/user_profile?user_id=279076) |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=664930#c24)• 13 years ago |
|  | |

qa+ for verification with Firefox 7.Whiteboard: [sg:critical] → [sg:critical][qa+]

|  | [u279076](/user_profile?user_id=279076) |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=664930#c25)• 13 years ago |
|  | |

Mozilla/5.0 (Macintosh; Intel Mac OS X 10.6; rv:7.0) Gecko/20100101 Firefox/7.0 ID:20110922153450
Mozilla/5.0 (Macintosh; Intel Mac OS X 10.6; rv:8.0a2) Gecko/20110926 Firefox/8.0a2 ID:20110926042011
Mozilla/5.0 (Macintosh; Intel Mac OS X 10.6; rv:9.0a1) Gecko/20110926 Firefox/9.0a1 ID:20110926030901
Using the attached testcase I am unable to reproduce this crash. Marking verified.Status: RESOLVED → VERIFIEDKeywords: [verified-aurora](/buglist.cgi?keywords=verified-aurora&resolution=---),
[verified-beta](/buglist.cgi?keywords=verified-beta&resolution=---)Whiteboard: [sg:critical][qa+] → [sg:critical][qa!]

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=664930#a18706761_1689)• 13 years ago |

Group: core-security
You need to [log in](/show_bug.cgi?id=664930&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Jesse Ruderman](/user_profile?user_id=11608)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from bugzilla.mozilla.org_db10971a_20250125_210201.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/667011)
* [XML](/show_bug.cgi?ctype=xml&id=667011)

Closed
[Bug 667011](/show_bug.cgi?id=667011)

Opened 14 years ago
Closed 14 years ago

# WeakMap values can be incorrectly classified as garbage by cycle collector

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

WeakMap values can be incorrectly classified as garbage by cycle collector

## Categories

### (Core :: XPConnect, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=XPConnect#XPConnect)

XPConnect
▾

Core :: XPConnect
Facilitates calling between JavaScript and XPCOM components.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=XPConnect&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=XPConnect&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=XPConnect)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

All

All

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

critical

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla7

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Performance Impact | --- |
| --- | --- |
| a11y-review | --- |
| Webcompat Priority | --- |
| Webcompat Score | --- |
| Accessibility Severity | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox5 | --- | [unaffected](/buglist.cgi?f1=cf_status_firefox5&o1=equals&v1=unaffected) |
| firefox6 | --- | [unaffected](/buglist.cgi?f1=cf_status_firefox6&o1=equals&v1=unaffected) |
| firefox7 | --- | [fixed](/buglist.cgi?f1=cf_status_firefox7&o1=equals&v1=fixed) |
| status1.9.2 | --- | [unaffected](/buglist.cgi?f1=cf_status_192&o1=equals&v1=unaffected) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox5 |  | unaffected |
| firefox6 |  | unaffected |
| firefox7 |  | fixed |
| status1.9.2 |  | unaffected |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: mccr8, Assigned: mccr8)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/0a70c84cd33dba0151fe15f2f8773137?d=mm&size=40)  [mccr8](/user_profile?user_id=406194)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/0a70c84cd33dba0151fe15f2f8773137?d=mm&size=40)  [mccr8](/user_profile?user_id=406194)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/5111b810214a00377104f5ad3efefa26?d=mm&size=40)  [sefeng](/user_profile?user_id=625922)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

8 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[653248](/show_bug.cgi?id=653248 "RESOLVED FIXED - WeakMap values reachable only from DOM are marked black")

Dependency [tree](/showdependencytree.cgi?id=667011&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=667011)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: regression, Whiteboard: [sg:critical][qa-])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[regression](/buglist.cgi?keywords=regression&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[sg:critical][qa-]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (1 file)

| [test behavior of weak map and GC](/attachment.cgi?id=542186)  [14 years ago](#c3)  [Andrew McCreight [:mccr8]](/user_profile?user_id=406194)   1.66 KB, application/x-javascript |  | [Details](/attachment.cgi?id=542186&action=edit) |
| --- | --- | --- |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194)  Assignee |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=667011#c0)• 14 years ago |
|  | |

Igor pointed out that the patch in [Bug 653248](/show_bug.cgi?id=653248 "RESOLVED FIXED - WeakMap values reachable only from DOM are marked black") will probably lead to the cycle collector sometimes classifying reachable JS objects as unreachable, which in turn will lead to the CC incorrectly freeing DOM objects that are reachable from JS side. I'm not sure what exactly happens, but I'd imagine that in the worst case it could make freed memory reachable from JS, potentially leading to crashes and other badness.
The scenario he came up with is this: a WeakMap m is reachable from JS roots, and m contains a key k and value v which are reachable only from DOM. After the patch in [Bug 653248](/show_bug.cgi?id=653248 "RESOLVED FIXED - WeakMap values reachable only from DOM are marked black"), the GC will mark m black, and k and v grey. When the cycle collector runs, its graph will have an edge from m to v, but not from k to v (which is wrong). Because m is marked black, the CC will not traverse it. If v is part of what looks like a garbage cycle through DOM, then the CC will mark v as garbage, as it doesn't see that k is holding on to v. The DOM part of the cycle involving v will be freed, but this is still reachable from JS via m and k.
With the previous behavior, the GC would mark the value black if either the map or the key is reachable in any way (ie are marked black or grey). This leaks, as it will never free cycles that pass through a WeakMap value, but is safe because it ensures that anything reachable from a reachable value is never freed.
The short term solution is to back out the patch in [Bug 653248](/show_bug.cgi?id=653248 "RESOLVED FIXED - WeakMap values reachable only from DOM are marked black").
Longer term, the cycle collector needs a more accurate picture of the weak map edges. It seems likely this will require making the cycle collector actually aware of WeakMaps. The basic problem is that most edges act like an "or": if an object is reachable from any incoming edge, it is reachable. For a weak map, the map and key act more like "and" wrt the value: both map and key must be reachable for the value to be reachable via the weak map.
I'll try to come up with a test for this.

|  | [Andreas Gal :gal](/user_profile?user_id=310943) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=667011#a344_310943)• 14 years ago |

[status-firefox5](/buglist.cgi?f1=cf_status_firefox5&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_firefox5&o1=equals&v1=unaffected)
[status-firefox6](/buglist.cgi?f1=cf_status_firefox6&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox6&o1=equals&v1=affected)
[status-firefox7](/buglist.cgi?f1=cf_status_firefox7&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox7&o1=equals&v1=affected)Whiteboard: [sg:crit]

|  | [Jesse Ruderman](/user_profile?user_id=11608) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=667011#a480_11608)• 14 years ago |

Whiteboard: [sg:crit] → [sg:critical]

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194)  Assignee |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=667011#c1)• 14 years ago |
|  | |

I believe that the behavior before [Bug 653248](/show_bug.cgi?id=653248 "RESOLVED FIXED - WeakMap values reachable only from DOM are marked black") landed is safe (but leaky), so this should only affect Firefox 7.
If I want to back out that patch, should I put up a patch in here to do that for review or what?Assignee: nobody → continuation

|  | [Andreas Gal :gal](/user_profile?user_id=310943) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=667011#a1280_310943)• 14 years ago |

[status-firefox6](/buglist.cgi?f1=cf_status_firefox6&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox6&o1=equals&v1=affected) → [unaffected](/buglist.cgi?f1=cf_status_firefox6&o1=equals&v1=unaffected)

|  | [Andreas Gal :gal](/user_profile?user_id=310943) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=667011#c2)• 14 years ago |
|  | |

FF7 hasn't branched yet, so we should try to fix it for real (without a leak).

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194)  Assignee |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=667011#c3)• 14 years ago |
|  | |

Attached file
[test behavior of weak map and GC](attachment.cgi?id=542186)
— [Details](attachment.cgi?id=542186&action=edit)

As part of looking at fixing the interaction of WeakMaps and the cycle collector, I've started working on some exhaustive tests. To start with, I have this test, that tests the interaction of WeakMaps with the JS GC. It tests out various combinations of the WeakMap and key being alive or dead, and sees if the value is alive or not. The value is reachable only via the WeakMap. The only time the value should be live is when both the WeakMap and the key are alive. I do this by using finalizeCount().
Of the four combinations, most work as expected, but oddly when the WeakMap is dead but the key is live the value is not being collected. It looks like this is because the WeakMap itself is not being collected. I don't know if this is a problem with the handling of WeakMaps or (more likely...) some kind of problem with my test, as this is basically the first JS test I have written. I'm not really sure offhand how this could happen, as I'd think that if the map is unreachable that the WeakMap code wouldn't even be invoked.

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194)  Assignee |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=667011#c4)• 14 years ago |
|  | |

Oh, and I meant to add, is there any way to examine the JS GC behavior in a script that also has DOM nodes around? I want to observe the behavior of WeakMaps when grey objects are involved (eg reachable from XPCOM). It looks like finalizeCount is only available in jstests... can those interact with the DOM? At least when being tested with the browser, of course.
In the short term, I can dump cycle collector graphs and examine those to figure out what is happening, but I wouldn't want to use those for automated regression testing.

|  | [Andreas Gal :gal](/user_profile?user_id=310943) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=667011#c5)• 14 years ago |
|  | |

I am guessing the stack scanner is keeping your weak map alive.

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194)  Assignee |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=667011#c6)• 14 years ago |
|  | |

I return from the function where the weak map is defined, and overwrite the value in the local before I leave in an attempt to combat this, but I guess junk could still be hanging around somewhere the stack scanner would find it? I could try adding a random recursive loop to overwrite the stack if that might help.

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194)  Assignee |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=667011#c7)• 14 years ago |
|  | |

Hmm. Does look like it is something along those lines. I get this when I run that same function over and over again:
counts: 0 --> 0
counts: 0 --> 1
counts: 1 --> 2
counts: 2 --> 3
counts: 3 --> 4
counts: 4 --> 5
counts: 5 --> 6
counts: 6 --> 8
First time, the value is not freed, then 1 value is freed every call, then two values are freed at the end. (This is also with a function that recurses to a depth of 1000 in an apparently vain attempt to clear out the stack.) So I guess it works out at the end.

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194)  Assignee |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=667011#c8)• 14 years ago |
|  | |

Hmm. I think that contrary to what I said earlier the original behavior was not safe either. Consider the following slight variation on Igor's original scenario: map is marked black, key is marked grey. Value will be (incorrectly) marked black. Value connects to an object that is part of a cycle that passes through DOM, but otherwise has no references.
As in Igor's scenario, the CC will not trace through the value, because it is marked. Thus, the CC thinks that the cycle the value connects to is garbage, and collects the DOM part of it, and we end up with the same sort of dangling pointer into DOM-land.
[status-firefox6](/buglist.cgi?f1=cf_status_firefox6&o1=isnotempty):
[unaffected](/buglist.cgi?f1=cf_status_firefox6&o1=equals&v1=unaffected) → [affected](/buglist.cgi?f1=cf_status_firefox6&o1=equals&v1=affected)

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194)  Assignee |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=667011#c9)• 14 years ago |
|  | |

Wait, no, I am dumb. In that case, the JS GC will mark the cycle that the value is connected to black, so the CC won't free it. Sorry for the bugspam.
[status-firefox6](/buglist.cgi?f1=cf_status_firefox6&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox6&o1=equals&v1=affected) → [unaffected](/buglist.cgi?f1=cf_status_firefox6&o1=equals&v1=unaffected)

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194)  Assignee |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=667011#c10)• 14 years ago |
|  | |

I'm going to back out [Bug 653248](/show_bug.cgi?id=653248 "RESOLVED FIXED - WeakMap values reachable only from DOM are marked black") today to fix this until we can get the CC-WeakMap interaction fixed.

|  | [Peter Van der Beken [:peterv]](/user_profile?user_id=24295) |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=667011#c11)• 14 years ago |
|  | |

I don't see a solution for this without actually recording the edges m->v and k->v (which is why we needed [bug 548733](/show_bug.cgi?id=548733 "RESOLVED WONTFIX - use a self-terminating edge list for the cycle collector"), no?).

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194)  Assignee |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=667011#c12)• 14 years ago |
|  | |

Adding m->v and k->v edges to the graph doesn't actually give us the right results. That will make v black if either m or k are black, whereas we need v to be black only if both m and k are black.
Igor had an idea that sounds reasonable to me. First, don't add any edges to the CC graph for WeakMaps. Then, after ScanRoots() has run, iterate over all of the WeakMaps. If a WeakMap and a key were marked black, flood black on the value (if it isn't black already). Otherwise, flood white (if the value is grey). Like the GC's WeakMap algorithm, if you end up doing anything during a scan, you must rescan the WeakMap list, because you may have changed the color of a WeakMap.
The only modification to his idea that I think we need is that we need to add all of the WeakMap values (and anything reachable from there) to the CC graph while we are building it, because objects may be reachable only via the WeakMap, and we don't want to have to add them later. We don't have to add the map or key, but when we're scanning the WeakMap list we need to handle the case where the key or value are not in the graph, which is the same as them being marked white.
We could also add another optimization that we only add a WeakMap value if both the map and key are in the graph (after we've otherwise finished building the graph), but this will require the same sort of doing another pass over the WeakMaps if something is changed.

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194)  Assignee |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=667011#c13)• 14 years ago |
|  | |

Backout has landed in moz-central, so I'm marking Firefox 7 as unaffected.
[status-firefox7](/buglist.cgi?f1=cf_status_firefox7&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox7&o1=equals&v1=affected) → [unaffected](/buglist.cgi?f1=cf_status_firefox7&o1=equals&v1=unaffected)

|  | [Peter Van der Beken [:peterv]](/user_profile?user_id=24295) |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=667011#c14)• 14 years ago |
|  | |

(In reply to [comment #12](/show_bug.cgi?id=667011#c12 "RESOLVED FIXED - WeakMap values can be incorrectly classified as garbage by cycle collector"))
> The only modification to his idea that I think we need is that we need to
> add all of the WeakMap values (and anything reachable from there) to the CC
> graph while we are building it, because objects may be reachable only via
> the WeakMap, and we don't want to have to add them later.
Only if they're not black though, right?

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194)  Assignee |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=667011#c15)• 14 years ago |
|  | |

Do you mean, we don't want to add the value if it has been marked black by the JS GC? That's a good point.

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194)  Assignee |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=667011#c16)• 14 years ago |
|  | |

Also, we'll need to update the CC graph dumping code to do WeakMaps correctly.

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=667011#c17)• 14 years ago |
|  | |

The backout "fixes" this bug (on 7/central). When [bug 653248](/show_bug.cgi?id=653248 "RESOLVED FIXED - WeakMap values reachable only from DOM are marked black") finally lands it should incorporate fixes required to make this bug not happen again.Blocks: [653248](/show_bug.cgi?id=653248 "RESOLVED FIXED - WeakMap values reachable only from DOM are marked black")Status: NEW → RESOLVEDClosed: 14 years ago
[status-firefox7](/buglist.cgi?f1=cf_status_firefox7&o1=isnotempty):
[unaffected](/buglist.cgi?f1=cf_status_firefox7&o1=equals&v1=unaffected) → [fixed](/buglist.cgi?f1=cf_status_firefox7&o1=equals&v1=fixed)Resolution: --- → FIXED

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194)  Assignee |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=667011#c18)• 14 years ago |
|  | |

I filed [Bug 668855](/show_bug.cgi?id=668855 "RESOLVED FIXED - add WeakMap support to the cycle collector") for general discussion of making the cycle collector work with WeakMaps. This bug is mostly about how half a fix causes dangling pointers.

|  | [Jesse Ruderman](/user_profile?user_id=11608) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=667011#a736306_11608)• 14 years ago |

Group: core-security

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=667011#a1716165_1689)• 14 years ago |

Keywords: [regression](/buglist.cgi?keywords=regression&resolution=---)Target Milestone: --- → mozilla7

|  | [Mihaela Velimiroviciu (:mihaelav)](/user_profile?user_id=421899) |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=667011#c19)• 13 years ago |
|  | |

Can anyone please provide a test case or with STR / guidelines that I can use to verify this fix? Do I need to create any specific environment to test the fix?
Thanks!

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194)  Assignee |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=667011#c20)• 13 years ago |
|  | |

We never had a test case. This was more of a theoretical problem.

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=667011#a7416319_1689)• 13 years ago |

[status1.9.2](/buglist.cgi?f1=cf_status_192&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_192&o1=equals&v1=unaffected)

|  | [u279076](/user_profile?user_id=279076) |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=667011#c21)• 13 years ago |
|  | |

qa- as no QA verification neededWhiteboard: [sg:critical] → [sg:critical][qa-]
You need to [log in](/show_bug.cgi?id=667011&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Andrew McCreight [:mccr8]](/user_profile?user_id=406194)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from bugzilla.mozilla.org_c2dbaac1_20250125_210158.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/661567)
* [XML](/show_bug.cgi?ctype=xml&id=661567)

Closed
[Bug 661567](/show_bug.cgi?id=661567)

Opened 14 years ago
Closed 14 years ago

# WeakMap uses a ContextAllocPolicy, should use a SystemAllocPolicy

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

WeakMap uses a ContextAllocPolicy, should use a SystemAllocPolicy

## Categories

### (Core :: JavaScript Engine, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=JavaScript%20Engine#JavaScript%20Engine)

JavaScript Engine
▾

Core :: JavaScript Engine
The interpreter engine for the core JavaScript language, independent of the browser's object model. File ONLY core JavaScript language bugs in this category. For bugs involving browser objects such as "window" and "document", use the "DOM" component. For bugs involving calls between JavaScript and C++, use the "XPConnect" component.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=JavaScript%20Engine&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=JavaScript%20Engine&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=JavaScript%20Engine)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Other Branch

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

All

All

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

normal

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla7

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Webcompat Priority | --- |
| --- | --- |
| a11y-review | --- |
| Performance Impact | --- |
| Webcompat Score | --- |
| Accessibility Severity | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox5 | [-](/buglist.cgi?f1=cf_tracking_firefox5&o1=equals&v1=-) | [wontfix](/buglist.cgi?f1=cf_status_firefox5&o1=equals&v1=wontfix) |
| firefox6 | [-](/buglist.cgi?f1=cf_tracking_firefox6&o1=equals&v1=-) | [wontfix](/buglist.cgi?f1=cf_status_firefox6&o1=equals&v1=wontfix) |
| firefox7 | [+](/buglist.cgi?f1=cf_tracking_firefox7&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox7&o1=equals&v1=fixed) |
| status1.9.2 | --- | [unaffected](/buglist.cgi?f1=cf_status_192&o1=equals&v1=unaffected) |
| status1.9.1 | --- | [unaffected](/buglist.cgi?f1=cf_status_191&o1=equals&v1=unaffected) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox5 | - | wontfix |
| firefox6 | - | wontfix |
| firefox7 | + | fixed |
| status1.9.2 |  | unaffected |
| relnote-firefox |  | --- |
| status1.9.1 |  | unaffected |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: jorendorff, Assigned: jimb)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/26684b295a47bf5a82b22010a9427ade?d=mm&size=40)  [jimb](/user_profile?user_id=298765)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/5a83f46f9f97d184457cb2dedfa19173?d=mm&size=40)  [jorendorff](/user_profile?user_id=281791)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/4fe52ee1503aecf7b6c976b8eb7c1753?d=mm&size=40)  [willyelm](/user_profile?user_id=714609)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

9 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Whiteboard: [sg:moderate], [landed m-c 6/20] fixed-in-tracemonkey [qa-])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

---

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[sg:moderate], [landed m-c 6/20] fixed-in-tracemonkey [qa-]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (3 files, 1 obsolete file)

| [Use ObjectValueMap typedef name where appropriate.](/attachment.cgi?id=536932)  [14 years ago](#c4)  [Jim Blandy :jimb](/user_profile?user_id=298765)   2.68 KB, patch | gal : [review+](#a343908_310943 "14 years ago") | [Details](/attachment.cgi?id=536932&action=edit) | [Diff](/attachment.cgi?id=536932&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=661567&attachment=536932) |
| --- | --- | --- |
| [Use SystemAllocPolicy in JS WeakMap objects, not ContextAllocPolicy.](/attachment.cgi?id=536933)  [14 years ago](#c5)  [Jim Blandy :jimb](/user_profile?user_id=298765)   1.49 KB, patch | gal : [review+](#c12 "14 years ago") | [Details](/attachment.cgi?id=536933&action=edit) | [Diff](/attachment.cgi?id=536933&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=661567&attachment=536933) |
| [Implement RuntimeAllocPolicy, providing proper memory accounting in GC'd objects that live longer than a JSContext.](/attachment.cgi?id=537604)  [14 years ago](#c14)  [Jim Blandy :jimb](/user_profile?user_id=298765)   1.37 KB, patch | luke : [review+](#a433329_347312 "14 years ago") | [Details](/attachment.cgi?id=537604&action=edit) | [Diff](/attachment.cgi?id=537604&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=661567&attachment=537604) |
| [Use RuntimeAllocPolicy in JS WeakMap objects, not ContextAllocPolicy.](/attachment.cgi?id=537605)  [14 years ago](#c15)  [Jim Blandy :jimb](/user_profile?user_id=298765)   826 bytes, patch | jorendorff : [review+](#c23 "14 years ago") | [Details](/attachment.cgi?id=537605&action=edit) | [Diff](/attachment.cgi?id=537605&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=661567&attachment=537605) |

Show Obsolete

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=661567#c0)• 14 years ago |
|  | |

Each WeakMap object keeps a pointer to the JSContext in which it was created. It's used to report OOM errors.
Possible consequences:
\* This could cause an OOM error to be reported in the wrong context, which
is not so bad.
\* This could cause us to try to report OOM in a context that has been
destroyed, which might be exploitable (we call through a function
pointer cx->errorReporter).

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)  Reporter |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=661567#c1)• 14 years ago |
|  | |

I don't know if there are ways for content to cause a cx to be destroyed. If, say, each document gets its own cx then it's probably pretty easy.
I also don't know how easy it is to get an OOM to be reported. Also probably easy on some platforms.

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=661567#a329_281791)• 14 years ago |

[tracking-firefox5](/buglist.cgi?f1=cf_tracking_firefox5&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox5&o1=equals&v1=%3F)

|  | [Jim Blandy :jimb](/user_profile?user_id=298765)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=661567#a429_298765)• 14 years ago |

Assignee: general → jimb

|  | [Andreas Gal :gal](/user_profile?user_id=310943) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=661567#c2)• 14 years ago |
|  | |

The lifetime of global objects and contexts matches, and the weak map holds the global object alive. I don't think this can be exploited. Would be good to double check with jst/mrbkap/peterv.

|  | [Andreas Gal :gal](/user_profile?user_id=310943) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=661567#c3)• 14 years ago |
|  | |

I am not opposed to the system alloc policy, but we might want to manually report the memory use then so GCs happen (want to make a patch jorendorff?).

|  | [Jim Blandy :jimb](/user_profile?user_id=298765)  Assignee |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=661567#c4)• 14 years ago |
|  | |

Attached patch

[Use ObjectValueMap typedef name where appropriate.](attachment.cgi?id=536932&action=diff)
— [Details](attachment.cgi?id=536932&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=661567&attachment=536932)

[Attachment #536932](/attachment.cgi?id=536932&action=edit "Use ObjectValueMap typedef name where appropriate.") -
Flags: review?(jorendorff)

|  | [Jim Blandy :jimb](/user_profile?user_id=298765)  Assignee |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=661567#c5)• 14 years ago |
|  | |

Attached patch

[Use SystemAllocPolicy in JS WeakMap objects, not ContextAllocPolicy.](attachment.cgi?id=536933&action=diff) (obsolete)
— [Details](attachment.cgi?id=536933&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=661567&attachment=536933)

[Attachment #536933](/attachment.cgi?id=536933&action=edit "Use SystemAllocPolicy in JS WeakMap objects, not ContextAllocPolicy.") -
Flags: review?

|  | [Jim Blandy :jimb](/user_profile?user_id=298765)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=661567#a2211_298765)• 14 years ago |

[Attachment #536933](/attachment.cgi?id=536933&action=edit "Use SystemAllocPolicy in JS WeakMap objects, not ContextAllocPolicy.") -
Flags: review? → review?(jorendorff)

|  | [Jim Blandy :jimb](/user_profile?user_id=298765)  Assignee |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=661567#c6)• 14 years ago |
|  | |

(In reply to [comment #2](/show_bug.cgi?id=661567#c2 "RESOLVED FIXED - WeakMap uses a ContextAllocPolicy, should use a SystemAllocPolicy"))
> The lifetime of global objects and contexts matches, and the weak map holds
> the global object alive. I don't think this can be exploited. Would be good
> to double check with jst/mrbkap/peterv.
Either way, if there's no need to have the object hold a JSContext reference, that's kind of unusual, and it would be nice to avoid it.

|  | [Luke Wagner [:luke]](/user_profile?user_id=347312) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=661567#c7)• 14 years ago |
|  | |

This bug makes a strong argument for taking away the alloc policy of HashMap/Set.

|  | [Jim Blandy :jimb](/user_profile?user_id=298765)  Assignee |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=661567#c8)• 14 years ago |
|  | |

I agree.

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=661567#c9)• 14 years ago |
|  | |

Assuming sg:critical worst case based on [comment 0](/show_bug.cgi?id=661567#c0 "RESOLVED FIXED - WeakMap uses a ContextAllocPolicy, should use a SystemAllocPolicy"), please lower if Andreas's [comment 2](/show_bug.cgi?id=661567#c2 "RESOLVED FIXED - WeakMap uses a ContextAllocPolicy, should use a SystemAllocPolicy") turns out to be correct.
[status-firefox5](/buglist.cgi?f1=cf_status_firefox5&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox5&o1=equals&v1=affected)
[status-firefox6](/buglist.cgi?f1=cf_status_firefox6&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox6&o1=equals&v1=affected)
[status-firefox7](/buglist.cgi?f1=cf_status_firefox7&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox7&o1=equals&v1=affected)
[tracking-firefox5](/buglist.cgi?f1=cf_tracking_firefox5&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox5&o1=equals&v1=%3F) → [+](/buglist.cgi?f1=cf_tracking_firefox5&o1=equals&v1=%2B)
[tracking-firefox6](/buglist.cgi?f1=cf_tracking_firefox6&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox6&o1=equals&v1=%2B)
[tracking-firefox7](/buglist.cgi?f1=cf_tracking_firefox7&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox7&o1=equals&v1=%2B)Keywords: [testcase-wanted](/buglist.cgi?keywords=testcase-wanted&resolution=---)Whiteboard: [sg:critical?]

|  | [Jim Blandy :jimb](/user_profile?user_id=298765)  Assignee |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=661567#c10)• 14 years ago |
|  | |

I'll be on PTO Friday, June 3. If the fix looks correct and it needs to land before I'm back on Monday, please feel free to take care of it.
[status-firefox5](/buglist.cgi?f1=cf_status_firefox5&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox5&o1=equals&v1=affected) → ---
[status-firefox6](/buglist.cgi?f1=cf_status_firefox6&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox6&o1=equals&v1=affected) → ---
[status-firefox7](/buglist.cgi?f1=cf_status_firefox7&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox7&o1=equals&v1=affected) → ---
[tracking-firefox5](/buglist.cgi?f1=cf_tracking_firefox5&o1=isnotempty):
[+](/buglist.cgi?f1=cf_tracking_firefox5&o1=equals&v1=%2B) → [?](/buglist.cgi?f1=cf_tracking_firefox5&o1=equals&v1=%3F)
[tracking-firefox6](/buglist.cgi?f1=cf_tracking_firefox6&o1=isnotempty):
[+](/buglist.cgi?f1=cf_tracking_firefox6&o1=equals&v1=%2B) → ---
[tracking-firefox7](/buglist.cgi?f1=cf_tracking_firefox7&o1=isnotempty):
[+](/buglist.cgi?f1=cf_tracking_firefox7&o1=equals&v1=%2B) → ---

|  | [Jim Blandy :jimb](/user_profile?user_id=298765)  Assignee |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=661567#c11)• 14 years ago |
|  | |

Comment on [attachment 536932](/attachment.cgi?id=536932 "Use ObjectValueMap typedef name where appropriate.") [[details]](/attachment.cgi?id=536932&action=edit "Use ObjectValueMap typedef name where appropriate.") [[diff]](/attachment.cgi?id=536932&action=diff "Use ObjectValueMap typedef name where appropriate.") [[review]](/page.cgi?id=splinter.html&ignore=&bug=661567&attachment=536932)
Use ObjectValueMap typedef name where appropriate.
Hi, Andreas. Jason is out for the week; could you review this?
[Attachment #536932](/attachment.cgi?id=536932&action=edit "Use ObjectValueMap typedef name where appropriate.") -
Flags: review?(jorendorff) → review?(gal)

|  | [Jim Blandy :jimb](/user_profile?user_id=298765)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=661567#a335170_298765)• 14 years ago |

[Attachment #536933](/attachment.cgi?id=536933&action=edit "Use SystemAllocPolicy in JS WeakMap objects, not ContextAllocPolicy.") -
Flags: review?(jorendorff) → review?(gal)

|  | [Andreas Gal :gal](/user_profile?user_id=310943) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=661567#a343908_310943)• 14 years ago |

[Attachment #536932](/attachment.cgi?id=536932&action=edit "Use ObjectValueMap typedef name where appropriate.") -
Flags: review?(gal) → review+

|  | [Andreas Gal :gal](/user_profile?user_id=310943) |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=661567#c12)• 14 years ago |
|  | |

Comment on [attachment 536933](/attachment.cgi?id=536933 "Use SystemAllocPolicy in JS WeakMap objects, not ContextAllocPolicy.") [[details]](/attachment.cgi?id=536933&action=edit "Use SystemAllocPolicy in JS WeakMap objects, not ContextAllocPolicy.") [[diff]](/attachment.cgi?id=536933&action=diff "Use SystemAllocPolicy in JS WeakMap objects, not ContextAllocPolicy.") [[review]](/page.cgi?id=splinter.html&ignore=&bug=661567&attachment=536933)
Use SystemAllocPolicy in JS WeakMap objects, not ContextAllocPolicy.
Please add proper malloc bytes accounting for the current cx, with that r=me.
[Attachment #536933](/attachment.cgi?id=536933&action=edit "Use SystemAllocPolicy in JS WeakMap objects, not ContextAllocPolicy.") -
Flags: review?(gal) → review+

|  | [Jim Blandy :jimb](/user_profile?user_id=298765)  Assignee |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=661567#c13)• 14 years ago |
|  | |

(In reply to [comment #7](/show_bug.cgi?id=661567#c7 "RESOLVED FIXED - WeakMap uses a ContextAllocPolicy, should use a SystemAllocPolicy"))
> This bug makes a strong argument for taking away the alloc policy of
> HashMap/Set.
Or possibly it makes an argument for having 'add' and anything else that can allocate take a policy-related argument as well. (Sounds like a pain.)

|  | [Jim Blandy :jimb](/user_profile?user_id=298765)  Assignee |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=661567#c14)• 14 years ago |
|  | |

Attached patch

[Implement RuntimeAllocPolicy, providing proper memory accounting in GC'd objects that live longer than a JSContext.](attachment.cgi?id=537604&action=diff)
— [Details](attachment.cgi?id=537604&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=661567&attachment=537604)

[Attachment #537604](/attachment.cgi?id=537604&action=edit "Implement RuntimeAllocPolicy, providing proper memory accounting in GC'd objects that live longer than a JSContext.") -
Flags: review?(luke)

|  | [Jim Blandy :jimb](/user_profile?user_id=298765)  Assignee |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=661567#c15)• 14 years ago |
|  | |

Attached patch

[Use RuntimeAllocPolicy in JS WeakMap objects, not ContextAllocPolicy.](attachment.cgi?id=537605&action=diff)
— [Details](attachment.cgi?id=537605&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=661567&attachment=537605)

[Attachment #536933](/attachment.cgi?id=536933&action=edit "Use SystemAllocPolicy in JS WeakMap objects, not ContextAllocPolicy.") -
Attachment is obsolete: true
[Attachment #537605](/attachment.cgi?id=537605&action=edit "Use RuntimeAllocPolicy in JS WeakMap objects, not ContextAllocPolicy.") -
Flags: review?(gal)

|  | [Luke Wagner [:luke]](/user_profile?user_id=347312) |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=661567#c16)• 14 years ago |
|  | |

Comment on [attachment 537604](/attachment.cgi?id=537604 "Implement RuntimeAllocPolicy, providing proper memory accounting in GC'd objects that live longer than a JSContext.") [[details]](/attachment.cgi?id=537604&action=edit "Implement RuntimeAllocPolicy, providing proper memory accounting in GC'd objects that live longer than a JSContext.") [[diff]](/attachment.cgi?id=537604&action=diff "Implement RuntimeAllocPolicy, providing proper memory accounting in GC'd objects that live longer than a JSContext.") [[review]](/page.cgi?id=splinter.html&ignore=&bug=661567&attachment=537604)
Implement RuntimeAllocPolicy, providing proper memory accounting in GC'd objects that live longer than a JSContext.
Review of [attachment 537604](/attachment.cgi?id=537604 "Implement RuntimeAllocPolicy, providing proper memory accounting in GC'd objects that live longer than a JSContext.") [[details]](/attachment.cgi?id=537604&action=edit "Implement RuntimeAllocPolicy, providing proper memory accounting in GC'd objects that live longer than a JSContext.") [[diff]](/attachment.cgi?id=537604&action=diff "Implement RuntimeAllocPolicy, providing proper memory accounting in GC'd objects that live longer than a JSContext.") [[review]](/page.cgi?id=splinter.html&ignore=&bug=661567&attachment=537604):
-----------------------------------------------------------------
::: js/src/jscntxt.h
@@ +1440,5 @@
> + \* Since it doesn't hold a JSContext (those may not live long enough), it
> + \* can't report out-of-memory conditions itself; the caller must check for
> + \* OOM and take the appropriate action.
> + \*/
> +class RuntimeAllocPolicy
Can you put this decl in jsalloc.h next to ContextAllocPolicy?
@@ +1448,5 @@
> + /\*
> + \* Non-inline helper to call JSRuntime::onOutOfMemory with minimal
> + \* code bloat.
> + \*/
> + JS\_FRIEND\_API(void \*) onOutOfMemory(void \*p, size\_t nbytes);
I think this is a dead decl.

|  | [Jim Blandy :jimb](/user_profile?user_id=298765)  Assignee |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=661567#c17)• 14 years ago |
|  | |

(In reply to [comment #16](/show_bug.cgi?id=661567#c16 "RESOLVED FIXED - WeakMap uses a ContextAllocPolicy, should use a SystemAllocPolicy"))
> Comment on [attachment 537604](/attachment.cgi?id=537604 "Implement RuntimeAllocPolicy, providing proper memory accounting in GC'd objects that live longer than a JSContext.") [[details]](/attachment.cgi?id=537604&action=edit "Implement RuntimeAllocPolicy, providing proper memory accounting in GC'd objects that live longer than a JSContext.") [[diff]](/attachment.cgi?id=537604&action=diff "Implement RuntimeAllocPolicy, providing proper memory accounting in GC'd objects that live longer than a JSContext.") [[review]](/page.cgi?id=splinter.html&ignore=&bug=661567&attachment=537604) [review]
> Implement RuntimeAllocPolicy, providing proper memory accounting in GC'd
> objects that live longer than a JSContext.
>
> Review of [attachment 537604](/attachment.cgi?id=537604 "Implement RuntimeAllocPolicy, providing proper memory accounting in GC'd objects that live longer than a JSContext.") [[details]](/attachment.cgi?id=537604&action=edit "Implement RuntimeAllocPolicy, providing proper memory accounting in GC'd objects that live longer than a JSContext.") [[diff]](/attachment.cgi?id=537604&action=diff "Implement RuntimeAllocPolicy, providing proper memory accounting in GC'd objects that live longer than a JSContext.") [[review]](/page.cgi?id=splinter.html&ignore=&bug=661567&attachment=537604) [review]:
> -----------------------------------------------------------------
>
> ::: js/src/jscntxt.h
> @@ +1440,5 @@
> > + \* Since it doesn't hold a JSContext (those may not live long enough), it
> > + \* can't report out-of-memory conditions itself; the caller must check for
> > + \* OOM and take the appropriate action.
> > + \*/
> > +class RuntimeAllocPolicy
>
> Can you put this decl in jsalloc.h next to ContextAllocPolicy?
I tried that first, but I'd like to actually use the context in the inline functions. Is it okay to #include "jscntxt.h" in "jsalloc.h"? I had the impression it was supposed to be a lighter header than that.
>
> @@ +1448,5 @@
> > + /\*
> > + \* Non-inline helper to call JSRuntime::onOutOfMemory with minimal
> > + \* code bloat.
> > + \*/
> > + JS\_FRIEND\_API(void \*) onOutOfMemory(void \*p, size\_t nbytes);
>
> I think this is a dead decl.
Sloppy. Thanks, fixed.

|  | [Luke Wagner [:luke]](/user_profile?user_id=347312) |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=661567#c18)• 14 years ago |
|  | |

(In reply to [comment #17](/show_bug.cgi?id=661567#c17 "RESOLVED FIXED - WeakMap uses a ContextAllocPolicy, should use a SystemAllocPolicy"))
> > Can you put this decl in jsalloc.h next to ContextAllocPolicy?
>
> I tried that first, but I'd like to actually use the context in the inline
> functions. Is it okay to #include "jscntxt.h" in "jsalloc.h"? I had the
> impression it was supposed to be a lighter header than that.
Ah, of course; jscntxt.h seems fine.

|  | [Luke Wagner [:luke]](/user_profile?user_id=347312) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=661567#a433329_347312)• 14 years ago |

[Attachment #537604](/attachment.cgi?id=537604&action=edit "Implement RuntimeAllocPolicy, providing proper memory accounting in GC'd objects that live longer than a JSContext.") -
Flags: review?(luke) → review+

|  | [Brendan Eich [:brendan]](/user_profile?user_id=1214) |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=661567#c19)• 14 years ago |
|  | |

(In reply to [comment #3](/show_bug.cgi?id=661567#c3 "RESOLVED FIXED - WeakMap uses a ContextAllocPolicy, should use a SystemAllocPolicy"))
> I am not opposed to the system alloc policy, but we might want to manually
> report the memory use then so GCs happen (want to make a patch jorendorff?).
No JS-heap-entangled data structure in the core engine should keep a JSContext pointer. nsJSContext in the DOM does but that's an exception to the rule even if you consider it core.
We're moving JSContext (stack of 'em I guess) to TLS, I hear, so we can get away from the general problem of needing a cx and not having one. We'll have the wrong cx (dynamic scope) problem, though, which can be really bad. I've discussed this briefly with dmandelin.
/be

|  | [Jim Blandy :jimb](/user_profile?user_id=298765)  Assignee |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=661567#c20)• 14 years ago |
|  | |

(In reply to [comment #19](/show_bug.cgi?id=661567#c19 "RESOLVED FIXED - WeakMap uses a ContextAllocPolicy, should use a SystemAllocPolicy"))
> No JS-heap-entangled data structure in the core engine should keep a
> JSContext pointer. nsJSContext in the DOM does but that's an exception to
> the rule even if you consider it core.
Yeah. The present patch holds no JSContext pointers; instead, users of the RuntimeAllocPolicy hold a pointer to their Runtime, which seems fine for JavaScript objects.

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=661567#a449099_1689)• 14 years ago |

[status-firefox5](/buglist.cgi?f1=cf_status_firefox5&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox5&o1=equals&v1=affected)
[status-firefox6](/buglist.cgi?f1=cf_status_firefox6&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox6&o1=equals&v1=affected)
[status-firefox7](/buglist.cgi?f1=cf_status_firefox7&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox7&o1=equals&v1=affected)
[tracking-firefox6](/buglist.cgi?f1=cf_tracking_firefox6&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox6&o1=equals&v1=%2B)
[tracking-firefox7](/buglist.cgi?f1=cf_tracking_firefox7&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox7&o1=equals&v1=%2B)

|  | [David Baron :dbaron: (⌚️UTC-4, no longer working on Mozilla)](/user_profile?user_id=3881) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=661567#a449119_3881)• 14 years ago |

[tracking-firefox5](/buglist.cgi?f1=cf_tracking_firefox5&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox5&o1=equals&v1=%3F) → [+](/buglist.cgi?f1=cf_tracking_firefox5&o1=equals&v1=%2B)

|  | [LegNeato](/user_profile?user_id=482154) |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=661567#c21)• 14 years ago |
|  | |

Would it be ok to ship Fx5 with this issue or is it bad enough we either need to wait for this fix or back out / turn off WeakMap?

|  | [Jim Blandy :jimb](/user_profile?user_id=298765)  Assignee |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=661567#c22)• 14 years ago |
|  | |

Nobody knows of any exploits. It's just bad design, as far as we know.

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=661567#a615310_12352)• 14 years ago |

[tracking-firefox5](/buglist.cgi?f1=cf_tracking_firefox5&o1=isnotempty):
[+](/buglist.cgi?f1=cf_tracking_firefox5&o1=equals&v1=%2B) → [-](/buglist.cgi?f1=cf_tracking_firefox5&o1=equals&v1=-)

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=661567#a615334_12352)• 14 years ago |

[status-firefox5](/buglist.cgi?f1=cf_status_firefox5&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox5&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox5&o1=equals&v1=wontfix)
[tracking-firefox5](/buglist.cgi?f1=cf_tracking_firefox5&o1=isnotempty):
[-](/buglist.cgi?f1=cf_tracking_firefox5&o1=equals&v1=-) → [+](/buglist.cgi?f1=cf_tracking_firefox5&o1=equals&v1=%2B)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=661567#a615434_1689)• 14 years ago |

[status1.9.1](/buglist.cgi?f1=cf_status_191&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_191&o1=equals&v1=unaffected)
[status1.9.2](/buglist.cgi?f1=cf_status_192&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_192&o1=equals&v1=unaffected)

|  | [Asa Dotzler [:asa]](/user_profile?user_id=5003) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=661567#a968455_5003)• 14 years ago |

[tracking-firefox5](/buglist.cgi?f1=cf_tracking_firefox5&o1=isnotempty):
[+](/buglist.cgi?f1=cf_tracking_firefox5&o1=equals&v1=%2B) → [-](/buglist.cgi?f1=cf_tracking_firefox5&o1=equals&v1=-)

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)  Reporter |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=661567#c23)• 14 years ago |
|  | |

Comment on [attachment 537605](/attachment.cgi?id=537605 "Use RuntimeAllocPolicy in JS WeakMap objects, not ContextAllocPolicy.") [[details]](/attachment.cgi?id=537605&action=edit "Use RuntimeAllocPolicy in JS WeakMap objects, not ContextAllocPolicy.") [[diff]](/attachment.cgi?id=537605&action=diff "Use RuntimeAllocPolicy in JS WeakMap objects, not ContextAllocPolicy.") [[review]](/page.cgi?id=splinter.html&ignore=&bug=661567&attachment=537605)
Use RuntimeAllocPolicy in JS WeakMap objects, not ContextAllocPolicy.
r=me.
Andreas asked about adding cx-accounting for mallocs under WeakMap operations, but it seems like a totally orthogonal concern. Follow-up bug, Andreas?
[Attachment #537605](/attachment.cgi?id=537605&action=edit "Use RuntimeAllocPolicy in JS WeakMap objects, not ContextAllocPolicy.") -
Flags: review?(gal) → review+

|  | [Jim Blandy :jimb](/user_profile?user_id=298765)  Assignee |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=661567#c24)• 14 years ago |
|  | |

(In reply to [comment #23](/show_bug.cgi?id=661567#c23 "RESOLVED FIXED - WeakMap uses a ContextAllocPolicy, should use a SystemAllocPolicy"))
> Andreas asked about adding cx-accounting for mallocs under WeakMap
> operations, but it seems like a totally orthogonal concern. Follow-up bug,
> Andreas?
The RuntimeAllocPolicy does all the accounting Andreas was hoping for, so this should be okay.

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)  Reporter |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=661567#c25)• 14 years ago |
|  | |

Yes. Right. Carry on.

|  | [Andreas Gal :gal](/user_profile?user_id=310943) |  |
| --- | --- | --- |
| [Comment 26](/show_bug.cgi?id=661567#c26)• 14 years ago |
|  | |

This code is racy with workers, but we are about to make those 1-per-runtime so I think thats ok.

|  | [Jim Blandy :jimb](/user_profile?user_id=298765)  Assignee |  |
| --- | --- | --- |
| [Comment 27](/show_bug.cgi?id=661567#c27)• 14 years ago |
|  | |

<http://hg.mozilla.org/tracemonkey/rev/666e14265c6b>
[status1.9.1](/buglist.cgi?f1=cf_status_191&o1=isnotempty):
[unaffected](/buglist.cgi?f1=cf_status_191&o1=equals&v1=unaffected) → ---
[status1.9.2](/buglist.cgi?f1=cf_status_192&o1=isnotempty):
[unaffected](/buglist.cgi?f1=cf_status_192&o1=equals&v1=unaffected) → ---
[status-firefox5](/buglist.cgi?f1=cf_status_firefox5&o1=isnotempty):
[wontfix](/buglist.cgi?f1=cf_status_firefox5&o1=equals&v1=wontfix) → ---
[status-firefox6](/buglist.cgi?f1=cf_status_firefox6&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox6&o1=equals&v1=affected) → ---
[status-firefox7](/buglist.cgi?f1=cf_status_firefox7&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox7&o1=equals&v1=affected) → ---
[tracking-firefox5](/buglist.cgi?f1=cf_tracking_firefox5&o1=isnotempty):
[-](/buglist.cgi?f1=cf_tracking_firefox5&o1=equals&v1=-) → [?](/buglist.cgi?f1=cf_tracking_firefox5&o1=equals&v1=%3F)
[tracking-firefox6](/buglist.cgi?f1=cf_tracking_firefox6&o1=isnotempty):
[+](/buglist.cgi?f1=cf_tracking_firefox6&o1=equals&v1=%2B) → ---
[tracking-firefox7](/buglist.cgi?f1=cf_tracking_firefox7&o1=isnotempty):
[+](/buglist.cgi?f1=cf_tracking_firefox7&o1=equals&v1=%2B) → ---Whiteboard: [sg:critical?] → [sg:critical?], fixed-in-tracemonkey

|  | [Jim Blandy :jimb](/user_profile?user_id=298765)  Assignee |  |
| --- | --- | --- |
| [Comment 28](/show_bug.cgi?id=661567#c28)• 14 years ago |
|  | |

I'm not sure what to do with the testcase-wanted. We don't know any exploits, which means we don't know how to provoke the erroneous behavior externally.

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)  Reporter |  |
| --- | --- | --- |
| [Comment 29](/show_bug.cgi?id=661567#c29)• 14 years ago |
|  | |

jimb did this:
What |Removed |Added
----------------------------------------------------------------------------
status-firefox7|affected |---
status-firefox6|affected |---
tracking-firefox5|- |?
status1.9.1|unaffected |---
tracking-firefox6|+ |---
status1.9.2|unaffected |---
tracking-firefox7|+ |---
Status Whiteboard|[sg:critical?] |[sg:critical?],
| |fixed-in-tracemonkey
status-firefox5|wontfix |---
I don't think he intended most of that; now idea how or why that happens.
Removing testcase-wanted (intentionally) because I don't think we want one bad enough for people to spend time on it.Keywords: [testcase-wanted](/buglist.cgi?keywords=testcase-wanted&resolution=---)

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)  Reporter |  |
| --- | --- | --- |
| [Comment 30](/show_bug.cgi?id=661567#c30)• 14 years ago |
|  | |

(In reply to [comment #26](/show_bug.cgi?id=661567#c26 "RESOLVED FIXED - WeakMap uses a ContextAllocPolicy, should use a SystemAllocPolicy"))
> This code is racy with workers, but we are about to make those 1-per-runtime
> so I think thats ok.
You mean the malloc accounting races? I think that's the case already with malloc accounting generally, whether it's cx-based or rt-based. There's a comment:
void updateMallocCounter(size\_t nbytes) {
/\* We tolerate any thread races when updating gcMallocBytes. \*/
...

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=661567#a1222284_1689)• 14 years ago |

[status1.9.1](/buglist.cgi?f1=cf_status_191&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_191&o1=equals&v1=unaffected)
[status1.9.2](/buglist.cgi?f1=cf_status_192&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_192&o1=equals&v1=unaffected)
[status-firefox5](/buglist.cgi?f1=cf_status_firefox5&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox5&o1=equals&v1=wontfix)
[status-firefox6](/buglist.cgi?f1=cf_status_firefox6&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox6&o1=equals&v1=affected)
[status-firefox7](/buglist.cgi?f1=cf_status_firefox7&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox7&o1=equals&v1=affected)
[tracking-firefox5](/buglist.cgi?f1=cf_tracking_firefox5&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox5&o1=equals&v1=%3F) → [-](/buglist.cgi?f1=cf_tracking_firefox5&o1=equals&v1=-)
[tracking-firefox6](/buglist.cgi?f1=cf_tracking_firefox6&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox6&o1=equals&v1=%2B)
[tracking-firefox7](/buglist.cgi?f1=cf_tracking_firefox7&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox7&o1=equals&v1=%2B)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 31](/show_bug.cgi?id=661567#c31)• 14 years ago |
|  | |

Since we don't know how to demonstrate even symptoms of this problem it's hard to justify an sg:critical rating.Whiteboard: [sg:critical?], fixed-in-tracemonkey → [sg:moderate], fixed-in-tracemonkey

|  | [Chris Leary [:cdleary] (not checking bugmail)](/user_profile?user_id=374575) |  |
| --- | --- | --- |
| [Comment 32](/show_bug.cgi?id=661567#c32)• 14 years ago |
|  | |

cdleary-bot mozilla-central merge info:
<http://hg.mozilla.org/mozilla-central/rev/fda88360e14f>
<http://hg.mozilla.org/mozilla-central/rev/89c54bd5bcb2>
<http://hg.mozilla.org/mozilla-central/rev/666e14265c6b>

|  | [Chris Leary [:cdleary] (not checking bugmail)](/user_profile?user_id=374575) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=661567#a1579828_374575)• 14 years ago |

Status: NEW → RESOLVEDClosed: 14 years agoResolution: --- → FIXED

|  | [Asa Dotzler [:asa]](/user_profile?user_id=5003) |  |
| --- | --- | --- |
| [Comment 33](/show_bug.cgi?id=661567#c33)• 14 years ago |
|  | |

This bug is currently tracking-firefox6+ Are the patches here candidates for Firefox 6 Beta? (well tested, low risk, safe :)Whiteboard: [sg:moderate], fixed-in-tracemonkey → [sg:moderate], [landed m-c 6/20] fixed-in-tracemonkey

|  | [Andreas Gal :gal](/user_profile?user_id=310943) |  |
| --- | --- | --- |
| [Comment 34](/show_bug.cgi?id=661567#c34)• 14 years ago |
|  | |

Pretty trivial patch. Unlikely to break anything.

|  | [LegNeato](/user_profile?user_id=482154) |  |
| --- | --- | --- |
| [Comment 35](/show_bug.cgi?id=661567#c35)• 13 years ago |
|  | |

sg-moderate seems not worth it, we'll wait for the next go round.

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 36](/show_bug.cgi?id=661567#c36)• 13 years ago |
|  | |

(In reply to [comment #29](/show_bug.cgi?id=661567#c29 "RESOLVED FIXED - WeakMap uses a ContextAllocPolicy, should use a SystemAllocPolicy"))
> I don't think he intended most of that; no idea how or why that happens.
If someone changes the bug while you've got it open normally you will get a "mid-air collision" warning. If, however, you RELOAD after the other person changes the bug then there will be no warning, but the state of the fields in your bug will persist and eventually overwrite the changes. This happens in practice when people have bugs open in long-lived tabs.
To avoid this problem you must SHIFT-RELOAD. People are reluctant to do that if they've made edits since that will undo the edits they wanted in addition to resetting the other fields. If you RELOAD without doing a SHIFT-RELOAD you are defeating the mid-air-warning protection and MUST check the bug history after you submit to make sure you didn't change things you didn't intend. The "Bugzilla Tweaks" add-on makes this a little easier: those changes will be displayed in-line so you don't have to click the "History" link in the bug.
Changing gears, this landed on m-c on 6/20 so it's fixed in Fx7: updating flags to reflect that. "wontfix" in Fx6.
[status-firefox6](/buglist.cgi?f1=cf_status_firefox6&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox6&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox6&o1=equals&v1=wontfix)
[status-firefox7](/buglist.cgi?f1=cf_status_firefox7&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox7&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox7&o1=equals&v1=fixed)
[tracking-firefox6](/buglist.cgi?f1=cf_tracking_firefox6&o1=isnotempty):
[+](/buglist.cgi?f1=cf_tracking_firefox6&o1=equals&v1=%2B) → [-](/buglist.cgi?f1=cf_tracking_firefox6&o1=equals&v1=-)Target Milestone: --- → mozilla7

|  | [u279076](/user_profile?user_id=279076) |  |
| --- | --- | --- |
| [Comment 37](/show_bug.cgi?id=661567#c37)• 13 years ago |
|  | |

qa-: no QA verification necessaryWhiteboard: [sg:moderate], [landed m-c 6/20] fixed-in-tracemonkey → [sg:moderate], [landed m-c 6/20] fixed-in-tracemonkey [qa-]

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=661567#a19963752_1689)• 13 years ago |

Group: core-security
You need to [log in](/show_bug.cgi?id=661567&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Jim Blandy :jimb](/user_profile?user_id=298765)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from secunia.com_9aae0117_20250125_210144.html ===


[Skip to main content](#main-content)
[![Home](/themes/custom/flexera/images/logo.svg)](https://www.flexera.com/)

[![Home](/themes/custom/flexera/images/logo.svg)](https://www.flexera.com/)

Search

## Main navigation

* Solutions
  + Column 1
    - Business challenge
      * [Software renewals and audits](https://www.flexera.com/solutions/software-renewals-audits)
      * [Software license management and optimization](https://www.flexera.com/solutions/software-usage-costs)
      * [SaaS spend management](https://www.flexera.com/solutions/saas-spend)
      * [Cloud cost management](https://www.flexera.com/solutions/cloud-cost)
      * [IT asset lifecycle management](https://www.flexera.com/solutions/it-asset-lifecycle)
      * [CMDB data quality](https://www.flexera.com/solutions/cmdb-data-quality)
      * [Accurate IT inventory](https://www.flexera.com/solutions/it-inventory)
      * [Security and regulatory risk management](https://www.flexera.com/solutions/it-security-regulatory-risk)
      * [Sustainable IT](https://www.flexera.com/solutions/sustainable-it)
      * [AI-powered transformation](https://www.flexera.com/solutions/ai-powered-transformation)
      * [Public sector](https://www.flexera.com/solutions/public-sector)
  + Column 2
    - Spend management by vendor
      * [IBM](https://www.flexera.com/solutions/vendor/ibm)
      * [Oracle](https://www.flexera.com/solutions/vendor/oracle)
      * [Microsoft](https://www.flexera.com/solutions/vendor/microsoft)
      * [SAP](https://www.flexera.com/solutions/vendor/sap)
      * [VMware](https://www.flexera.com/solutions/vendor/vmware)
      * [ServiceNow](https://www.flexera.com/solutions/vendor/servicenow)
      * [AWS](https://www.flexera.com/solutions/vendor/aws)
      * [Salesforce](https://www.flexera.com/solutions/vendor/salesforce)
      * [BMC](https://www.flexera.com/solutions/cmdb-data-quality/bmc)
      * [Adobe](https://www.flexera.com/solutions/vendor/adobe)

  ### Achieve more through a united FinOps and ITAM function

  The future is hybrid. Break down the walls between ITAM and FinOps to drive more revenue, more customer growth and more innovation.

  [Discover More](https://www.flexera.com/resources/hybrid-itam-finops)
* Products
  + Column 1
    - [Flexera One](https://www.flexera.com/products/flexera-one)
      * [IT Visibility](https://www.flexera.com/products/flexera-one/it-visibility)
      * [ITAM](https://www.flexera.com/products/flexera-one/it-asset-management)
      * [SaaS Management](https://www.flexera.com/products/flexera-one/saas-management)
      * [FinOps](https://www.flexera.com/products/flexera-one/finops)
      * [Technology Intelligence Platform](https://www.flexera.com/products/flexera-one/technology-intelligence-platform)
  + Column 2
    - [Snow Atlas](https://www.flexera.com/products/snow-atlas)
      * [Snow Spend Optimizer](https://www.flexera.com/products/snow-atlas/snow-spend-optimizer)
      * [Snow SaaS Management](https://www.flexera.com/products/snow-atlas/snow-saas-management)
  + Column 3
    - Hide group
      * [Security](https://www.flexera.com/products/security)
      * [Application Readiness](https://www.flexera.com/products/adminstudio)
      * [All products](https://www.flexera.com/products)
      * [All Snow products](https://www.flexera.com/products/snow)
      * [Integrations](https://www.flexera.com/products/integrations)

  ### Flexera 2024 State of the Cloud Report

  What do transformative initiatives such as GenAI, machine learning and sustainability mean for the cloud? Check out the 2024 State of the Cloud Report to find the answer as well as all the latest cloud computing trends.

  [View Report](https://info.flexera.com/CM-REPORT-State-of-the-Cloud)
* Success
  + Column 1
    - [Customer success](https://www.flexera.com/customer-success)
      * Support
        + [Flexera support portal](https://community.flexera.com/s/support-hub)
        + [Flexera product documentation](https://docs.flexera.com)
        + [Snow product documentation](https://docs.snowsoftware.io/)
      * Services and training
        + [Services](https://www.flexera.com/customer-success/services)
        + [Training](https://www.flexera.com/customer-success/training)
  + Column 2
    - Hide group
      * [Technology Intelligence Awards](https://www.flexera.com/customer-success/awards)
      * [Flexera community](https://community.flexera.com/s/)

  ### Insights from Gartner®

  Find a curated series of actionable and objective insights for IT executives and their teams. Get expert insights from valued analysts, courtesy of Flexera.

  [Discover More](https://www.flexera.com/resources/gartner-analyst-research)
* Resources
  + Column 1
    - [Resources](https://www.flexera.com/resources)
      * [Webinars](https://www.flexera.com/resources?type%5Bwebinar%5D=webinar)
      * [Videos](https://www.flexera.com/resources?type%5Bvideo%5D=video)
      * [Datasheets](https://www.flexera.com/resources?type%5Bdatasheet%5D=datasheet)
      * [White papers & reports](https://www.flexera.com/resources?type%5Bwhite-paper-industry-report%5D=white-paper-industry-report)
  + Column 2
    - Hide group
      * [Blog](/blog/)
      * [Case studies](https://www.flexera.com/resources/case-studies)
      * [Events](https://www.flexera.com/resources?type%5Bevent%5D=event)
      * [Analyst Research](https://www.flexera.com/resources/gartner-analyst-research)
      * [Glossary](https://www.flexera.com/resources/glossary)
      * [Demos & trials](https://www.flexera.com/resources?type%5Bdemo-trials%5D=demo-trials)
      * [Business value calculator](https://www.flexera.com/resources/business-value-calculator)

  ### Flexera 2025 IT Priorities Report

  Insights from Flexera’s 2025 IT Priorities Report highlight what’s top of mind for IT decision makers in the year ahead. Discover the challenges, priorities and opportunities that will shape the future IT landscape.

  [View Report](https://info.flexera.com/ITV-REPORT-IT-Priorities)
* About
  + Column 1
    - [Company](https://www.flexera.com/about-us)
      * [About](https://www.flexera.com/about-us)
      * [Careers](https://www.flexera.com/about-us/careers)
      * [Contact](https://www.flexera.com/about-us/contact-us)
      * [Leadership](https://www.flexera.com/about-us/leadership)
    - [Partners](https://www.flexera.com/about-us/partners)
      * [Partner program](https://www.flexera.com/about-us/partners/partner-program)
      * [Partner directory](https://www.flexera.com/about-us/partners/directory)
  + Column 2
    - [Press center](https://www.flexera.com/about-us/press-center)
      * [Press releases](https://www.flexera.com/about-us/all-press-releases)
      * [Awards](https://www.flexera.com/about-us/press-center#awards)
      * [Articles](https://www.flexera.com/about-us/all-articles)
    - Hide group
      * Social responsibility
        + [ESG](https://www.flexera.com/about-us/environmental-social-governance)
        + [Diversity](https://www.flexera.com/about-us/diversity)

  ### More value with technology intelligence

  The unparalleled synergy of Flexera and Snow provides the Technology Intelligence you need for more efficiency, insight and governance than ever before.

  [Discover More](https://www.flexera.com/more-value-with-technology-intelligence)

Search

en

* [English](https://www.flexera.com/products/security/software-vulnerability-research/secunia-research?referrer=secunia)
* [Deutsch](https://www.flexera.de/products/security/software-vulnerability-research/secunia-research?referrer=secunia)

## External Links

* External Links
  + [Community](https://community.flexera.com/)
  + [Product Access](https://app.flexera.com/login)
  + [Partner Portal](https://flexera.channeltivity.com/Login)

[Book a demo](/about-us/contact-us?C_Interest1=sales)

# Secunia Research

## The world’s best vulnerability intelligence

The Secunia Research team from Flexera provides the most accurate and reliable source of vulnerability intelligence.

[Contact Us](https://www.flexera.com/about-us/contact-us?C_Interest1=sales&C_SolutionInterest=SVM)
Watch video (0:29)

Related links

* [Anatomy of a security advisory](https://www.flexera.com/resources/infographics/anatomy-of-a-security-advisory)
* [Software Vulnerability Research](https://www.flexera.com/products/software-vulnerability-research)
* [Software Vulnerability Manager](/products/software-vulnerability-manager)
* [Security advisories from Secunia Research](https://www.flexera.com/products/security/software-vulnerability-advisories)
* [Report a vulnerability](https://www.flexera.com/about-us/contact-us/report-vulnerability)

 ![Secunia Research](/sites/default/files/2022-04/hero-secunia-research-bg.jpg)

Featured Details

## Multiple ways to consume Secunia Research

Secunia delivers software security research that provides reliable, curated and actionable vulnerability intelligence. Organizations can expect to receive standardized, validated and enriched vulnerability research on a specific version of a software product. Secunia Research supports four solutions:

![Software Vulnerability Research](/sites/default/files/2022-04/icon-secunia-research-svr.svg)

### [Software Vulnerability Research](https://www.flexera.com/products/software-vulnerability-research)

Software Vulnerability Research utilizes Secunia Research to drive awareness of vulnerabilities matching your specified criteria

[Learn More](https://www.flexera.com/products/software-vulnerability-research)

![Software Vulnerability Manager](/sites/default/files/2022-04/icon-secunia-research-svm.svg)

### [Software Vulnerability Manager](/products/software-vulnerability-manager)

Software Vulnerability Manager uses Secunia Research data to identify, prioritize and patch known vulnerable software detected in your environment

[Learn More](/products/software-vulnerability-manager)

![Data Platform](/sites/default/files/2022-04/icon-secunia-research-dp.svg)

### [Data Platform](https://www.flexera.com/products/data-platform)

Data Platform leverages Secunia Research to provide high-level insights based on major or minor versions of software in your normalized inventory

[Learn More](https://www.flexera.com/products/data-platform)

![Flexera One](/sites/default/files/2022-04/icon-secunia-research-flexera-one.svg)

### [Flexera One](/flexera-one)

Flexera One utilizes Secunia Research (alongside public NVD data) to provide more granular matching of build-level versions of software in your normalized inventory within its IT Asset Management and IT Visibility solutions

[Learn More](/flexera-one)

How it works

## Accurate, reliable vulnerability insights at your fingertips

The Secunia Research team from Flexera is comprised of several security specialists who conduct vulnerability research in various products in addition to testing, verifying and validating public vulnerability reports. Since its inception in 2002, the goal of the Secunia Research team is to provide the most accurate and reliable source of vulnerability intelligence.

Delivering the world’s best vulnerability intelligence requires skill and passion. Team members continually develop their skills exploring various high-profile closed and open-source software using a variety of approaches, focusing chiefly on thorough code audits and binary analysis. The team has received industry recognition, including naming members to [Microsoft’s Most Valuable Security Researchers](https://msrc-blog.microsoft.com/2019/08/07/announcing-2019-msrc-most-valuable-security-researchers/) list.

Secunia researchers discover hard-to-find vulnerabilities that aren’t normally identified with techniques such as fuzzing, and the results have been impressive. Members of the Secunia Research team have discovered critical vulnerabilities in products from vendors including Microsoft, Symantec, IBM, Adobe, RealNetworks, Trend Micro, HP, Blue Coat, Samba, CA, Mozilla and Apple.

The team produces invaluable security advisories based on research of the vulnerabilities affecting any given software update. Sometimes a single update can address multiple vulnerabilities of varying criticalities and threats; but these advisories aggregate and distill findings down to a single advisory perfect for the prioritization of patching efforts within [Software Vulnerability Manager](/products/software-vulnerability-manager). Criticality scores are consistently applied along with details around attack vector and other valuable details within [Software Vulnerability Research](/products/software-vulnerability-research/secunia-research). Illegitimate vulnerability reports are also investigated and rejected so you can focus only on what truly matters.

Informing IT, Transforming IT

## Industry insights to help keep you informed

[#### Webinar

### Stay Ahead of Cyber Threats: Flexera's Latest Vulnerability Insights

Join us for this session where we'll explore the latest findings from the Flexera Monthly Vulnerability Insights Report.](https://info.flexera.com/SVM-WBNR-Vulnerability-Insights-Roundtable)

[#### Webinar

### Dive deeper into the Flexera Annual Vulnerability Insights

We'll explore the key findings from the Flexera Annual Vulnerability Insights Report. Learn about the latest cybersecurity trends, the most targeted industries, the types of vulnerabilities, plus management and mitigation strategies.](https://info.flexera.com/SVM-WBNR-Flexera-Annual-Vulnerability-Insights?lead_source=Website%20Visitor&id=Flexera.com-Resources)

#### Video

### Close the Risk Window with Software Vulnerability Manager

Stop reacting. Gain control. Stay secure. Build a more effective risk mitigation process leveraging Secunia Research vulnerability intelligence and the largest repository of third-party patch data in the industry.

Remote video URL

[#### Trial

### Software Vulnerability Manager Assessment free trial

Get access to the complete set of modules of Software Vulnerability Manager: Research, Assessment and Patching](https://info.flexera.com/SVM-EVAL-Software-Vulnerability-Manager)

[#### Datasheet

### Protect your ServiceNow® investment with the highest quality data

IT Visibility offers certified ServiceNow integrations that accelerate platform expansion, improve ROI and increase efficiencies across ITIL processes by delivering clean software and hardware asset data directly.](/sites/default/files/datasheet-itv-maximize-servicenow-investment.pdf)

[#### Blog

### Avoid missing crucial vulnerability intelligence amid NVD backlog

Recent developments regarding the National Vulnerability Database (NVD) have some technology leaders on edge. Since February, the U.S. National Institute of Standards and Technology (NIST) has almost completely stopped enriching software vulnerabi...](https://www.flexera.com/blog/vulnerability-management/avoid-missing-crucial-vulnerability-intelligence-amid-nvd-backlog/)

[View all resources](https://www.flexera.com/resources?category%5Bsoftware-vulnerability-management%5D=software-vulnerability-management)

## Footer Menu

* Column
  + Business challenge
    - [Software renewals and audits](https://www.flexera.com/solutions/software-renewals-audits)
    - [Software license management and optimization](https://www.flexera.com/solutions/software-usage-costs)
    - [SaaS spend management](https://www.flexera.com/solutions/saas-spend)
    - [Cloud cost management](https://www.flexera.com/solutions/cloud-cost)
    - [IT asset lifecycle management](https://www.flexera.com/solutions/it-asset-lifecycle)
    - [CMDB data quality](https://www.flexera.com/solutions/cmdb-data-quality)
    - [Accurate IT inventory](https://www.flexera.com/solutions/it-inventory)
    - [Security and regulatory risk management](https://www.flexera.com/solutions/it-security-regulatory-risk)
    - [Sustainable IT](https://www.flexera.com/solutions/sustainable-it)
    - [AI-powered transformation](https://www.flexera.com/solutions/ai-powered-transformation)
    - [Public sector](https://www.flexera.com/solutions/public-sector)
* Column
  + Spend management by vendor
    - [IBM](https://www.flexera.com/solutions/vendor/ibm)
    - [Oracle](https://www.flexera.com/solutions/vendor/oracle)
    - [Microsoft](https://www.flexera.com/solutions/vendor/microsoft)
    - [SAP](https://www.flexera.com/solutions/vendor/sap)
    - [VMware](https://www.flexera.com/solutions/vendor/vmware)
    - [ServiceNow](https://www.flexera.com/solutions/vendor/servicenow)
    - [AWS](https://www.flexera.com/solutions/vendor/aws)
    - [Salesforce](https://www.flexera.com/solutions/vendor/salesforce)
    - [BMC](https://www.flexera.com/solutions/cmdb-data-quality/bmc)
    - [Adobe](https://www.flexera.com/solutions/vendor/adobe)
* Column
  + Products
    - [Flexera One](https://www.flexera.com/products/flexera-one)
    - [Snow Atlas](https://www.flexera.com/products/snow-atlas)
    - [Security](https://www.flexera.com/products/security)
    - [Application Readiness](https://www.flexera.com/products/adminstudio)
    - [All products](https://www.flexera.com/products)
    - [All Snow products](https://www.flexera.com/products/snow)
    - [Integrations](https://www.flexera.com/products/integrations)
* Column
  + Company
    - [About](https://www.flexera.com/about-us)
    - [Careers](https://www.flexera.com/about-us/careers)
    - [Leadership](https://www.flexera.com/about-us/leadership)
    - [Contact us](https://www.flexera.com/about-us/contact-us)
    - [Media / press center](https://www.flexera.com/about-us/press-center)
    - [Revenera.com](https://www.revenera.com)

 +1.800.374.4353

en

* [English](https://www.flexera.com/products/security/software-vulnerability-research/secunia-research?referrer=secunia)
* [Deutsch](https://www.flexera.de/products/security/software-vulnerability-research/secunia-research?referrer=secunia)

 [![Home](/themes/custom/flexera/images/logo.svg)](https://www.flexera.com/)

© 2025 Flexera. All Rights Reserved.

## Footer

* [Privacy Policy](https://www.flexera.com/legal/privacy-policy)
* [Terms and conditions](https://www.flexera.com/legal)
* [Contact Us](https://www.flexera.com/about-us/contact-us)
* [Impressum](https://www.flexera.com/about-us/impressum)
* [Site Map](https://www.flexera.com/sitemap)

#####

×

...



=== Content from bugzilla.mozilla.org_9263622b_20250125_210207.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/670319)
* [XML](/show_bug.cgi?ctype=xml&id=670319)

Closed
[Bug 670319](/show_bug.cgi?id=670319)

Opened 14 years ago
Closed 13 years ago

# "ASSERTION: function object has parent of unknown class"

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

"ASSERTION: function object has parent of unknown class"

## Categories

### (Core :: XPConnect, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=XPConnect#XPConnect)

XPConnect
▾

Core :: XPConnect
Facilitates calling between JavaScript and XPCOM components.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=XPConnect&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=XPConnect&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=XPConnect)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

x86\_64

macOS

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

critical

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla9

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Accessibility Severity | --- |
| --- | --- |
| Performance Impact | --- |
| a11y-review | --- |
| Webcompat Score | --- |
| Webcompat Priority | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox5 | [-](/buglist.cgi?f1=cf_tracking_firefox5&o1=equals&v1=-) | [wontfix](/buglist.cgi?f1=cf_status_firefox5&o1=equals&v1=wontfix) |
| firefox6 | [-](/buglist.cgi?f1=cf_tracking_firefox6&o1=equals&v1=-) | [wontfix](/buglist.cgi?f1=cf_status_firefox6&o1=equals&v1=wontfix) |
| firefox7 | [+](/buglist.cgi?f1=cf_tracking_firefox7&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox7&o1=equals&v1=fixed) |
| firefox8 | [+](/buglist.cgi?f1=cf_tracking_firefox8&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox8&o1=equals&v1=fixed) |
| firefox9 | [+](/buglist.cgi?f1=cf_tracking_firefox9&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=fixed) |
| status1.9.2 | --- | [unaffected](/buglist.cgi?f1=cf_status_192&o1=equals&v1=unaffected) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox5 | - | wontfix |
| firefox6 | - | wontfix |
| firefox7 | + | fixed |
| firefox8 | + | fixed |
| firefox9 | + | fixed |
| status1.9.2 |  | unaffected |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: jruderman, Assigned: mrbkap)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/89d2149736265010bfe669ce8c3075c0?d=mm&size=40)  [mrbkap](/user_profile?user_id=69426)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/d2dc9227eafcd0ec5ba3712ee4f19b75?d=mm&size=40)  [jruderman](/user_profile?user_id=11608)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/5111b810214a00377104f5ad3efefa26?d=mm&size=40)  [sefeng](/user_profile?user_id=625922)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

7 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: assertion, testcase, Whiteboard: [sg:critical?][qa-])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[assertion](/buglist.cgi?keywords=assertion&resolution=---),
[testcase](/buglist.cgi?keywords=testcase&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[sg:critical?][qa-]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (3 files)

| [testcase (asserts fatally when loaded)](/attachment.cgi?id=544955)  [14 years ago](#c0)  [Jesse Ruderman](/user_profile?user_id=11608)   168 bytes, text/html |  | [Details](/attachment.cgi?id=544955&action=edit) |
| --- | --- | --- |
| [stack trace](/attachment.cgi?id=544956)  [14 years ago](#c1)  [Jesse Ruderman](/user_profile?user_id=11608)   4.77 KB, text/plain |  | [Details](/attachment.cgi?id=544956&action=edit) |
| [Proposed fix](/attachment.cgi?id=556740)  [13 years ago](#c6)  [Blake Kaplan (:mrbkap) (inactive)](/user_profile?user_id=69426)   1.02 KB, patch | jst : [review+](#a4527648_12352 "13 years ago")  johnath : [approval-mozilla-aurora+](#c10 "13 years ago")  johnath : [approval-mozilla-beta+](#c10 "13 years ago") | [Details](/attachment.cgi?id=556740&action=edit) | [Diff](/attachment.cgi?id=556740&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=670319&attachment=556740) |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Jesse Ruderman](/user_profile?user_id=11608)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=670319#c0)• 14 years ago |
|  | |

Attached file
[testcase (asserts fatally when loaded)](attachment.cgi?id=544955)
— [Details](attachment.cgi?id=544955&action=edit)

###!!! ASSERTION: function object has parent of unknown class!: 'Error', file js/src/xpconnect/src/xpcwrappednative.cpp, line 1759
###!!! ABORT: should have a slim wrapper: '!mFlattenedJSObject || IS\_SLIM\_WRAPPER(mFlattenedJSObject)', file js/src/xpconnect/src/xpccallcontext.cpp, line 199
Doesn't crash in opt. But the messages are scary, so security-sensitive for now.

|  | [Jesse Ruderman](/user_profile?user_id=11608)  Reporter |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=670319#c1)• 14 years ago |
|  | |

Attached file
[stack trace](attachment.cgi?id=544956)
— [Details](attachment.cgi?id=544956&action=edit)

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=670319#c2)• 14 years ago |
|  | |

In particular, funobj->getParent() is a vanilla Object in this case.
|obj| is a Proxy.
We're coming through XPC\_WN\_CallMethod here, not quickstubs.

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=670319#c3)• 14 years ago |
|  | |

Blake, any idea whether this is exploitable?Assignee: nobody → mrbkap

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=670319#a1012128_1689)• 14 years ago |

Whiteboard: [need answer from mrbkap]

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=670319#a2824938_1689)• 13 years ago |

Whiteboard: [need answer from mrbkap] → [sg:critical?][need answer from mrbkap]

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=670319#a2899240_12352)• 13 years ago |

[status-firefox5](/buglist.cgi?f1=cf_status_firefox5&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox5&o1=equals&v1=wontfix)
[status-firefox6](/buglist.cgi?f1=cf_status_firefox6&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox6&o1=equals&v1=wontfix)
[status-firefox7](/buglist.cgi?f1=cf_status_firefox7&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox7&o1=equals&v1=affected)
[status-firefox8](/buglist.cgi?f1=cf_status_firefox8&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox8&o1=equals&v1=affected)
[tracking-firefox5](/buglist.cgi?f1=cf_tracking_firefox5&o1=isnotempty):
--- → [-](/buglist.cgi?f1=cf_tracking_firefox5&o1=equals&v1=-)
[tracking-firefox6](/buglist.cgi?f1=cf_tracking_firefox6&o1=isnotempty):
--- → [-](/buglist.cgi?f1=cf_tracking_firefox6&o1=equals&v1=-)
[tracking-firefox7](/buglist.cgi?f1=cf_tracking_firefox7&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox7&o1=equals&v1=%2B)
[tracking-firefox8](/buglist.cgi?f1=cf_tracking_firefox8&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox8&o1=equals&v1=%2B)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=670319#c4)• 13 years ago |
|  | |

jst says mrbkap agreed with the sg:critical? rating.Whiteboard: [sg:critical?][need answer from mrbkap] → [sg:critical?]

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=670319#c5)• 13 years ago |
|  | |

Blake, this bug has been sitting for a while, what's the next step here?
[status-firefox9](/buglist.cgi?f1=cf_status_firefox9&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=affected)
[tracking-firefox9](/buglist.cgi?f1=cf_tracking_firefox9&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox9&o1=equals&v1=%2B)

|  | [Blake Kaplan (:mrbkap) (inactive)](/user_profile?user_id=69426)  Assignee |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=670319#c6)• 13 years ago |
|  | |

Attached patch

[Proposed fix](attachment.cgi?id=556740&action=diff)
— [Details](attachment.cgi?id=556740&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=670319&attachment=556740)

The parent of the function object has to be either the security wrapper or the object itself. It can't be higher up on the prototype chain.
[Attachment #556740](/attachment.cgi?id=556740&action=edit "Proposed fix") -
Flags: review?(jst)

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=670319#a4527648_12352)• 13 years ago |

[Attachment #556740](/attachment.cgi?id=556740&action=edit "Proposed fix") -
Flags: review?(jst) → review+

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=670319#c7)• 13 years ago |
|  | |

mrbkap, can you get this landed, we'd like to consider this for branches too, and we're running really low on time for 7.

|  | [Blake Kaplan (:mrbkap) (inactive)](/user_profile?user_id=69426)  Assignee |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=670319#c8)• 13 years ago |
|  | |

Sorry, this actually landed the other day:
<http://hg.mozilla.org/mozilla-central/rev/ec2131a5351d>Status: NEW → RESOLVEDClosed: 13 years agoResolution: --- → FIXED

|  | [Blake Kaplan (:mrbkap) (inactive)](/user_profile?user_id=69426)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=670319#a4732972_69426)• 13 years ago |

Target Milestone: --- → mozilla9

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=670319#c9)• 13 years ago |
|  | |

Comment on [attachment 556740](/attachment.cgi?id=556740 "Proposed fix") [[details]](/attachment.cgi?id=556740&action=edit "Proposed fix") [[diff]](/attachment.cgi?id=556740&action=diff "Proposed fix") [[review]](/page.cgi?id=splinter.html&ignore=&bug=670319&attachment=556740)
Proposed fix
Assuming this just needs branch approvals? Or is there a compatibility reason you didn't request it?
[Attachment #556740](/attachment.cgi?id=556740&action=edit "Proposed fix") -
Flags: approval-mozilla-beta?
[Attachment #556740](/attachment.cgi?id=556740&action=edit "Proposed fix") -
Flags: approval-mozilla-aurora?

|  | [Johnathan Nightingale [:johnath]](/user_profile?user_id=210757) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=670319#c10)• 13 years ago |
|  | |

Comment on [attachment 556740](/attachment.cgi?id=556740 "Proposed fix") [[details]](/attachment.cgi?id=556740&action=edit "Proposed fix") [[diff]](/attachment.cgi?id=556740&action=diff "Proposed fix") [[review]](/page.cgi?id=splinter.html&ignore=&bug=670319&attachment=556740)
Proposed fix
We discussed this in triage and agreed to approve it for both, but we're worried, purely because of the code it touches. Can we get some deep thinking about how to QA possible failure scenarios, and what (if anything) Cheng might watch for in feedback?
[Attachment #556740](/attachment.cgi?id=556740&action=edit "Proposed fix") -
Flags: approval-mozilla-beta?
[Attachment #556740](/attachment.cgi?id=556740&action=edit "Proposed fix") -
Flags: approval-mozilla-beta+
[Attachment #556740](/attachment.cgi?id=556740&action=edit "Proposed fix") -
Flags: approval-mozilla-aurora?
[Attachment #556740](/attachment.cgi?id=556740&action=edit "Proposed fix") -
Flags: approval-mozilla-aurora+

|  | [LegNeato](/user_profile?user_id=482154) |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=670319#c11)• 13 years ago |
|  | |

Poke?

|  | [Blake Kaplan (:mrbkap) (inactive)](/user_profile?user_id=69426)  Assignee |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=670319#c12)• 13 years ago |
|  | |

<https://hg.mozilla.org/releases/mozilla-aurora/rev/009c64b64cf3>
<https://hg.mozilla.org/releases/mozilla-beta/rev/bca60a88782d>
[status-firefox7](/buglist.cgi?f1=cf_status_firefox7&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox7&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox7&o1=equals&v1=fixed)
[status-firefox8](/buglist.cgi?f1=cf_status_firefox8&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox8&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox8&o1=equals&v1=fixed)
[status-firefox9](/buglist.cgi?f1=cf_status_firefox9&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=fixed)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=670319#a6164266_1689)• 13 years ago |

[status1.9.2](/buglist.cgi?f1=cf_status_192&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_192&o1=equals&v1=unaffected)

|  | [u279076](/user_profile?user_id=279076) |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=670319#c13)• 13 years ago |
|  | |

qa- as no QA fix verification neededWhiteboard: [sg:critical?] → [sg:critical?][qa-]

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=670319#a16803868_1689)• 13 years ago |

Group: core-security
You need to [log in](/show_bug.cgi?id=670319&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Jesse Ruderman](/user_profile?user_id=11608)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from www.mozilla.org_8869abd6_20250125_210150.html ===


## Help us improve your Mozilla experience

In addition to Cookies necessary for this site to function, we’d like your permission to set some additional Cookies to better understand your browsing needs and improve your experience. Rest assured — we value your privacy.

Accept All Additional Cookies

Reject All Additional Cookies

[Cookie settings](/en-US/privacy/websites/cookie-settings/)

Menu
[![Mozilla](https://www.mozilla.org/media/img/logos/m24/lockup-black.f2ddba3f0724.svg)](/en-US/)

* [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
  Firefox browsers](/en-US/firefox/)
  Close Firefox browsers menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Desktop](/en-US/firefox/new/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for iOS](/en-US/firefox/browsers/mobile/ios/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Android](/en-US/firefox/browsers/mobile/android/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/focus/logo.aac3e33175cb.svg)
    ## Firefox Focus](/en-US/firefox/browsers/mobile/focus/)
  + [## Firefox blog](https://blog.mozilla.org/firefox/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=firefox)
* [Products](/en-US/products/)
  Close Products menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/mozilla/vpn/logo.c648f487bfb8.svg)
    ## Mozilla VPN](/en-US/products/vpn/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/monitor/logo.d97e5516f9e6.svg)
    ## Mozilla Monitor](https://monitor.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/relay/logo-white.d42a8b52e44c.svg)
    ## Firefox Relay](https://relay.firefox.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/pocket/logo.17446bc33a5d.svg)
    ## Pocket](https://getpocket.com/firefox_learnmore/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/nav/icons/icon-mdn-plus.f54475f980ab.svg)
    ## MDN Plus](https://developer.mozilla.org/plus?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/fakespot/logo-blue.3973b8fe9631.svg)
    ## Fakespot](https://fakespot.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/thunderbird/logo-thunderbird.121e9c0fed45.svg)
    ## Thunderbird](https://www.thunderbird.net/)

  [All products](/en-US/products/)
* [About us](/en-US/about/)
  Close About us menu

  Our Mission

  + [## About Mozilla](/en-US/about/)
  + [## The Mozilla Manifesto](/en-US/about/manifesto/)
  + [## Get Involved](/en-US/contribute/)
  + [## Innovation Projects](https://future.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Blog](https://blog.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)

  Our Work

  + [## Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla.ai](https://www.mozilla.ai/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Ventures](https://mozilla.vc/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Advertising](/en-US/advertising/)

## Menu

* Mozilla Security

## [Mozilla Security](/en-US/security/)

* [Advisories](/en-US/security/advisories/)
* [Known Vulnerabilities](/en-US/security/known-vulnerabilities/)
* [Mozilla Security Blog](https://blog.mozilla.com/security/)
* [Security Bug Bounty](/en-US/security/bug-bounty/)
* [Third-party Injection Policy](/en-US/security/third-party-software-injection/)

## [Client Bug Bounty](/en-US/security/client-bug-bounty/)

* [Frequently Asked Questions](/en-US/security/bug-bounty/faq/)
* [Hall of Fame](/en-US/security/bug-bounty/hall-of-fame/)

## [Web Bug Bounty](/en-US/security/web-bug-bounty/)

* [Eligible Websites](/en-US/security/bug-bounty/web-eligible-sites/)
* [Frequently Asked Questions](/en-US/security/bug-bounty/faq-webapp/)
* [Hall of Fame](/en-US/security/bug-bounty/web-hall-of-fame/)

# Mozilla Foundation Security Advisory 2011-36

## Miscellaneous memory safety hazards (rv:7.0 / rv:1.9.2.23)

Announced
September 27, 2011
Reporter
Mozilla developers and community
Impact
Critical
Products
Firefox, SeaMonkey, Thunderbird
Fixed in

* Firefox 3.6.23
* Firefox 7
* SeaMonkey 2.4
* Thunderbird 3.1.15
* Thunderbird 7

### Description

Mozilla developers identified and fixed several memory safety bugs
in the browser engine used in Firefox and other Mozilla-based
products. Some of these bugs showed evidence of memory corruption
under certain circumstances, and we presume that with enough effort at
least some of these could be exploited to run arbitrary code.

In general these flaws cannot be exploited through email in the Thunderbird
and SeaMonkey products because scripting is disabled,, but are potentially a risk
in browser or browser-like contexts in those products.

### References

Benjamin Smedberg, Bob Clary, and Jesse Ruderman reported
memory safety problems that affected Firefox 3.6 and Firefox 6.

* [Memory safety bugs fixed in Firefox 3.6.23 and Firefox 7](https://bugzilla.mozilla.org/buglist.cgi?bug_id=655098,660453,662215,665360)
* [CVE-2011-2995](http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2011-2995)

Josh Aas reported a potential crash in the plugin API that affected Firefox 3.6 only.

* [uninitialized nsChildView](https://bugzilla.mozilla.org/show_bug.cgi?id=555018)
* [CVE-2011-2996](http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2011-2996)

Bob Clary, Andrew McCreight, Andreas Gal, Gary Kwong, Igor Bukanov,
Jason Orendorff, Jesse Ruderman, and Marcia Knous
reported memory safety problems that affected Firefox 6, fixed in Firefox 7.

* [Memory safety bugs fixed in Firefox 7](https://bugzilla.mozilla.org/buglist.cgi?bug_id=672436,667011,671756,657198,667507,658864,661567,664930,668941,669228,670319,673757,678818,552002)
* [CVE-2011-2997](http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2011-2997)

## Company

* [Leadership](/about/leadership/)
* [Press Center](https://blog.mozilla.org/category/mozilla/news/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=company)
* [Careers](/en-US/careers/)
* [Contact](/en-US/contact/)

## Support

* [Product Help](https://support.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [File a Bug](https://bugzilla.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [Localize Mozilla](https://pontoon.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)

## Resources

* [Advertise with Mozilla](/en-US/advertising/)
* [Firefox Release Notes](/firefox/134.0.2/releasenotes/)

## Developers

* [Developer Edition](/en-US/firefox/developer/)
* [Enterprise](/en-US/firefox/enterprise/)
* [Tools](https://firefox-source-docs.mozilla.org/devtools-user/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=developers)
* [MDN](https://developer.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer)

## Follow @Mozilla

* [X (formerly Twitter) (@mozilla)](https://twitter.com/mozilla)
* [Instagram (@mozilla)](https://www.instagram.com/mozilla/)
* [LinkedIn (@mozilla)](https://www.linkedin.com/company/mozilla-corporation/)
* [TikTok (@mozilla)](https://www.tiktok.com/%40mozilla)
* [Spotify (@mozilla)](https://open.spotify.com/show/0vT7LJMeVDxyQ2ZamHKu08?si=_uDRD6bRR_6M5YZyISGXgA)

## Follow @Firefox

* [X (formerly Twitter) (@firefox)](https://twitter.com/firefox)
* [Instagram (@firefox)](https://www.instagram.com/firefox/)
* [YouTube (@firefoxchannel)](https://www.youtube.com/user/firefoxchannel)
* [TikTok (@firefox)](https://www.tiktok.com/%40firefox)

[Donate](https://foundation.mozilla.org/?form=moco-donate-footer)

Visit [Mozilla Corporation’s](/en-US/) not-for-profit parent, the [Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer).

Portions of this content are ©1998–2025 by individual mozilla.org contributors. Content available under a [Creative Commons license](/en-US/foundation/licensing/website-content/).

* [Website Privacy Notice](/en-US/privacy/websites/)
* [Cookies](/en-US/privacy/websites/cookie-settings/)
* [Legal](/en-US/about/legal/)
* [Community Participation Guidelines](/en-US/about/governance/policies/participation/)
* [About this site](/en-US/about/this-site/)

![](https://www.mozilla.org/media/img/logos/m24/wordmark-white.2d673bb5b33a.svg)



=== Content from bugzilla.mozilla.org_e9c53101_20250125_210208.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/671756)
* [XML](/show_bug.cgi?ctype=xml&id=671756)

Closed
[Bug 671756](/show_bug.cgi?id=671756)

Opened 14 years ago
Closed 13 years ago

# crash via mozilla::gl::GLContext::UploadSurfaceToTexture on mac playing a video

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

crash via mozilla::gl::GLContext::UploadSurfaceToTexture on mac playing a video

## Categories

### (Core :: Graphics, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=Graphics#Graphics)

Graphics
▾

Core :: Graphics
Mapping of cross platform rendering interfaces to various 2D graphics APIs
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=Graphics&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=Graphics&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=Graphics)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

unspecified

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

x86

macOS

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

normal

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla8

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Accessibility Severity | --- |
| --- | --- |
| a11y-review | --- |
| Performance Impact | --- |
| Webcompat Priority | --- |
| Webcompat Score | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox5 | [-](/buglist.cgi?f1=cf_tracking_firefox5&o1=equals&v1=-) | [unaffected](/buglist.cgi?f1=cf_status_firefox5&o1=equals&v1=unaffected) |
| firefox6 | --- | [unaffected](/buglist.cgi?f1=cf_status_firefox6&o1=equals&v1=unaffected) |
| firefox7 | [+](/buglist.cgi?f1=cf_tracking_firefox7&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox7&o1=equals&v1=fixed) |
| firefox8 | [+](/buglist.cgi?f1=cf_tracking_firefox8&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox8&o1=equals&v1=fixed) |
| status1.9.2 | --- | [unaffected](/buglist.cgi?f1=cf_status_192&o1=equals&v1=unaffected) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox5 | - | unaffected |
| firefox6 |  | unaffected |
| firefox7 | + | fixed |
| firefox8 | + | fixed |
| status1.9.2 |  | unaffected |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: gal, Unassigned)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

*Unassigned*

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/86d014603512abf3c5966ea995551a53?d=mm&size=40)  [gal](/user_profile?user_id=310943)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/17436ade8da1b23d42b3df05b9c4fc77?d=mm&size=40)  [bhood](/user_profile?user_id=697075)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

6 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

[670573](/show_bug.cgi?id=670573 "VERIFIED FIXED - Corrupted (skewed) video when using OpenGL layers; crashes on OS X in libGLImage@0xaddress")

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[656185](/show_bug.cgi?id=656185 "RESOLVED FIXED - Consolidate YUV data copying code and handle odd sized images correctly.")

Dependency [tree](/showdependencytree.cgi?id=671756&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=671756)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: regression, Whiteboard: [sg:critical?][qa-])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[regression](/buglist.cgi?keywords=regression&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[sg:critical?][qa-]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |
|  | qe-verify |  |

## Crash Data

Signature:

[[@ libGLImage.dylib@0x4caf ]](https://crash-stats.mozilla.org/signature/?signature=libGLImage.dylib%400x4caf)

## Security

### (public)

This bug is publicly visible.

## User Story

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Andreas Gal :gal](/user_profile?user_id=310943)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=671756#c0)• 14 years ago |
|  | |

Playing the video at <https://browserid.org/users> reliably crashes my MacOSX nightly build. Crash address looks random, so this might be exploitable.
<https://crash-stats.mozilla.com/report/index/bp-a32bd99f-d985-46f4-ba3f-7ce132110714>

|  | [Andreas Gal :gal](/user_profile?user_id=310943)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=671756#a12_310943)• 14 years ago |

Whiteboard: [sg:critical?]

|  | [Robert O'Callahan (:roc) (email my personal email if necessary)](/user_profile?user_id=5038) |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=671756#c1)• 14 years ago |
|  | |

Probably a dup of [bug 670573](/show_bug.cgi?id=670573 "VERIFIED FIXED - Corrupted (skewed) video when using OpenGL layers; crashes on OS X in libGLImage@0xaddress").Depends on: [670573](/show_bug.cgi?id=670573 "VERIFIED FIXED - Corrupted (skewed) video when using OpenGL layers; crashes on OS X in libGLImage@0xaddress")

|  | [Marcia Knous [:marcia]](/user_profile?user_id=8519) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=671756#a577265_8519)• 14 years ago |

Crash Signature: [@ libGLImage.dylib@0x4caf ]

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=671756#a577639_12352)• 14 years ago |

[status-firefox5](/buglist.cgi?f1=cf_status_firefox5&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox5&o1=equals&v1=wontfix)
[status-firefox6](/buglist.cgi?f1=cf_status_firefox6&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox6&o1=equals&v1=affected)
[status-firefox7](/buglist.cgi?f1=cf_status_firefox7&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox7&o1=equals&v1=affected)
[status-firefox8](/buglist.cgi?f1=cf_status_firefox8&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox8&o1=equals&v1=affected)
[tracking-firefox5](/buglist.cgi?f1=cf_tracking_firefox5&o1=isnotempty):
--- → [-](/buglist.cgi?f1=cf_tracking_firefox5&o1=equals&v1=-)
[tracking-firefox6](/buglist.cgi?f1=cf_tracking_firefox6&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox6&o1=equals&v1=%2B)
[tracking-firefox7](/buglist.cgi?f1=cf_tracking_firefox7&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox7&o1=equals&v1=%2B)
[tracking-firefox8](/buglist.cgi?f1=cf_tracking_firefox8&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox8&o1=equals&v1=%2B)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=671756#c2)• 13 years ago |
|  | |

If this is a dupe of [bug 670573](/show_bug.cgi?id=670573 "VERIFIED FIXED - Corrupted (skewed) video when using OpenGL layers; crashes on OS X in libGLImage@0xaddress") then Firefox 5 and 6 should not be affected.
qawanted: test this video on Firefox 5, 6, and 7Keywords: [qawanted](/buglist.cgi?keywords=qawanted&resolution=---)

|  | [Marcia Knous [:marcia]](/user_profile?user_id=8519) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=671756#c3)• 13 years ago |
|  | |

Tested this video using:
Mozilla/5.0 (Macintosh; Intel Mac OS X 10.6; rv:5.0.1) Gecko/20100101 Firefox/5.0.1
Mozilla/5.0 (Macintosh; Intel Mac OS X 10.6; rv:6.0) Gecko/20100101 Firefox/6.0
Mozilla/5.0 (Macintosh; Intel Mac OS X 10.6; rv:7.0a2) Gecko/20110804 Firefox/7.0a2
and was not able to crash playing the video.Keywords: [qawanted](/buglist.cgi?keywords=qawanted&resolution=---)

|  | [LegNeato](/user_profile?user_id=482154) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=671756#c4)• 13 years ago |
|  | |

And this should be resolved everywhere because [bug 670573](/show_bug.cgi?id=670573 "VERIFIED FIXED - Corrupted (skewed) video when using OpenGL layers; crashes on OS X in libGLImage@0xaddress") landed on mozilla-central and mozila-aurora and mozilla-beta was unaffected. If it still happens anywhere it isn't a strict dupe of [bug 670573](/show_bug.cgi?id=670573 "VERIFIED FIXED - Corrupted (skewed) video when using OpenGL layers; crashes on OS X in libGLImage@0xaddress").
Clearing the tracking for Firefox 6.
[status-firefox6](/buglist.cgi?f1=cf_status_firefox6&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox6&o1=equals&v1=affected) → ---
[status-firefox7](/buglist.cgi?f1=cf_status_firefox7&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox7&o1=equals&v1=affected) → ---
[status-firefox8](/buglist.cgi?f1=cf_status_firefox8&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox8&o1=equals&v1=affected) → ---
[tracking-firefox6](/buglist.cgi?f1=cf_tracking_firefox6&o1=isnotempty):
[+](/buglist.cgi?f1=cf_tracking_firefox6&o1=equals&v1=%2B) → ---
[tracking-firefox7](/buglist.cgi?f1=cf_tracking_firefox7&o1=isnotempty):
[+](/buglist.cgi?f1=cf_tracking_firefox7&o1=equals&v1=%2B) → ---

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=671756#a2392672_1689)• 13 years ago |

Group: core-security
[status-firefox5](/buglist.cgi?f1=cf_status_firefox5&o1=isnotempty):
[wontfix](/buglist.cgi?f1=cf_status_firefox5&o1=equals&v1=wontfix) → [unaffected](/buglist.cgi?f1=cf_status_firefox5&o1=equals&v1=unaffected)
[status-firefox6](/buglist.cgi?f1=cf_status_firefox6&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_firefox6&o1=equals&v1=unaffected)
[status-firefox7](/buglist.cgi?f1=cf_status_firefox7&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox7&o1=equals&v1=fixed)
[status-firefox8](/buglist.cgi?f1=cf_status_firefox8&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox8&o1=equals&v1=fixed)Target Milestone: --- → mozilla8

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=671756#a2392694_1689)• 13 years ago |

Keywords: [regression](/buglist.cgi?keywords=regression&resolution=---)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=671756#a2392809_1689)• 13 years ago |

Blocks: [656185](/show_bug.cgi?id=656185 "RESOLVED FIXED - Consolidate YUV data copying code and handle odd sized images correctly.")

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=671756#a2392886_1689)• 13 years ago |

Status: NEW → RESOLVEDClosed: 13 years agoResolution: --- → FIXED

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=671756#a2392921_1689)• 13 years ago |

[tracking-firefox7](/buglist.cgi?f1=cf_tracking_firefox7&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox7&o1=equals&v1=%2B)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=671756#a5653855_1689)• 13 years ago |

[status1.9.2](/buglist.cgi?f1=cf_status_192&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_192&o1=equals&v1=unaffected)

|  | [u279076](/user_profile?user_id=279076) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=671756#c5)• 13 years ago |
|  | |

qa- as QA was unable to reproduce this bug originally. Andreas, please verify this bug is fixed in Firefox 7 and 8.Whiteboard: [sg:critical?] → [sg:critical?][qa-]
You need to [log in](/show_bug.cgi?id=671756&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑



=== Content from blog.mozilla.org_0753cb36_20250126_115545.html ===

[Skip to content](#content)

[Mozilla](https://blog.mozilla.org/en/)

![search](https://blog.mozilla.org/wp-content/themes/foxtail/assets/images/icons/search.svg)

* [Internet Culture](https://blog.mozilla.org/en/category/internet-culture/)
  + [Deep Dives](https://blog.mozilla.org/en/category/internet-culture/deep-dives/)
  + [Mozilla Explains](https://blog.mozilla.org/en/category/internet-culture/mozilla-explains/)
  + [Interviews](https://blog.mozilla.org/en/category/internet-culture/interviews/)
  + [Videos](https://blog.mozilla.org/en/category/videos/)
* [Privacy & Security](https://blog.mozilla.org/en/category/privacy-security/)
* [Products](https://blog.mozilla.org/en/category/products/)
  + [Firefox](https://blog.mozilla.org/en/category/products/firefox/)
  + [Pocket](https://blog.mozilla.org/en/category/products/pocket/)
  + [Mozilla VPN](https://blog.mozilla.org/en/category/products/mozilla-vpn/)
* [Mozilla](https://blog.mozilla.org/en/category/mozilla/)
  + [News](https://blog.mozilla.org/en/category/mozilla/news/)
  + [Internet Policy](https://blog.mozilla.org/en/category/mozilla/internet-policy/)
  + [Leadership](https://blog.mozilla.org/en/category/mozilla/leadership/)
    - [Mitchell Baker, CEO](https://blog.mozilla.org/en/author/mitchellmozillacom/)
    - [Mark Surman, ED Foundation](https://blog.mozilla.org/en/author/markmozillafoundation-org/)
    - [Eric Rescorla, Firefox CTO](https://blog.mozilla.org/en/author/ekrmozilla-com/)

[Download Firefox](https://www.mozilla.org/firefox/new/?utm_source=blog.mozilla.org&utm_medium=referral&utm_campaign=blog-nav)

![search](https://blog.mozilla.org/wp-content/themes/foxtail/assets/images/icons/search.svg)

#### Search

Search for:

![](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2019/01/mozilla-logo-bw-rgb.png)
## News

Official announcements and press releases

[![Room filled with people listening to a speaker on stage. Demo Day visual image in the background.](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2024/12/Demo_Day_Blog_Header_-1-800x800.jpg)
Mozilla
## Mozilla Builders: Celebrating community-driven innovation in AI

Read More](https://blog.mozilla.org/en/mozilla/mozilla-builders-demo-day/)

[![The Mozilla logo in green on a black background](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2024/12/logo-lockup-video-poster-800x800.png)
Mozilla
## Mozilla welcomes new executive team members

Read More](https://blog.mozilla.org/en/mozilla/new-executives/)

[![Decorative image of wrapped gifts in front of an iphone](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2023/11/moz_header_holiday_firefox-phone-gifts_blue-03.png-800x800.png)
Products
## Shopping for everyone? We’ve got you covered with the Fakespot Holiday Gift Guide 2024

Read More](https://blog.mozilla.org/en/products/shopping-for-everyone-weve-got-you-covered-with-the-fakespot-holiday-gift-guide-2024/)

[![Text: Mozilla Builders](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2024/06/Blog-16_9-1920x1080-1-800x800.png)
Mozilla
## 14 AI projects to watch: Mozilla’s first Builders Accelerator cohort kicks off

Read More](https://blog.mozilla.org/en/mozilla/14-ai-projects-to-watch-mozillas-first-builders-accelerator-cohort-kicks-off/)

[![A check mark next to the text "Fakespot."](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2023/07/Fakespot_ProductBlog-2-800x800.jpg)
News
## Fakespot’s guide to trending back-to-school products

Read More](https://blog.mozilla.org/en/mozilla/news/fakespots-guide-to-trending-back-to-school-products/)

[![](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2024/06/IG_Highlights_Icon-800x800.png)
Mozilla
## BAFTA Award-Winner Siobhán McSweeney to host Mozilla’s 2nd Annual Rise25 Awards in Dublin, Ireland on Aug. 13

Read More](https://blog.mozilla.org/en/mozilla/bafta-award-winner-siobhan-mcsweeney-to-host-mozillas-2nd-annual-rise25-awards-in-dublin-ireland-on-august-13/)

[![](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2024/05/fx_website_meta-image_tips-tricks_alt-04-1-800x800.webp)
Mozilla
## Here’s what we’re working on in Firefox

Read More](https://blog.mozilla.org/en/mozilla/heres-what-were-working-on-in-firefox/)

[![A check mark next to the text "Fakespot."](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2023/07/Fakespot_ProductBlog-2-800x800.jpg)
News
## Fakespot reveals the product categories with the most and least reliable product reviews

Read More](https://blog.mozilla.org/en/mozilla/news/fakespot-reveals-the-product-categories-with-the-most-and-least-reliable-product-reviews-for-summer-and-back-to-school-shopping/)

[![A dark blue speech bubble with horizontal purple and red bars on a pink background.](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2020/03/fx_blog_header_announcements_001_1920x1080-800x800.jpg)
Firefox
## Engaging with our Firefox community: Highlights from our recent AMA

Read More](https://blog.mozilla.org/en/products/firefox/engaging-with-our-firefox-community-highlights-from-our-recent-ama/)

[![](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2024/06/IG_Highlights_Icon-800x800.png)
Mozilla
## Mozilla announces finalists for the 2nd annual Rise25 Awards

Read More](https://blog.mozilla.org/en/mozilla/mozilla-announces-finalists-for-the-2nd-annual-rise25-awards/)

[![Mozilla and Anonym logos](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2024/06/blog_1200x800_v2-800x800.png)
Mozilla
## Introducing Anonym: Raising the bar for privacy-preserving digital advertising

Read More](https://blog.mozilla.org/en/mozilla/mozilla-anonym-raising-the-bar-for-privacy-preserving-digital-advertising/)

[![logo - zero with a diagonal line through it, and the letters D, I, N](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2024/06/odintbanner-500x500.png)
Mozilla
## Keeping GenAI technologies secure is a shared responsibility

Read More](https://blog.mozilla.org/en/mozilla/keeping-genai-technologies-secure-is-a-shared-responsibility/)

1
[2](https://blog.mozilla.org/en/category/mozilla/news/page/2?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=compan)
[3](https://blog.mozilla.org/en/category/mozilla/news/page/3?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=compan)
…
[24](https://blog.mozilla.org/en/category/mozilla/news/page/24?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=compan)
[next](https://blog.mozilla.org/en/category/mozilla/news/page/2?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=compan)

![newsletter](https://blog.mozilla.org/wp-content/themes/foxtail/assets/images/newsletter.png)

### Keep up with all things Firefox

Get how-tos, advice and news to make your Firefox experience work best for you.

Your e-mail address

Country
- select -
Afghanistan
Akrotiri
Albania
Algeria
American Samoa
Andorra
Angola
Anguilla
Antarctica
Antigua and Barbuda
Argentina
Armenia
Aruba
Ashmore and Cartier Islands
Australia
Austria
Azerbaijan
Bahamas, The
Bahrain
Baker Island
Bangladesh
Barbados
Bassas da India
Belarus
Belgium
Belize
Benin
Bermuda
Bhutan
Bolivia
Bonaire, Sint Eustatius, and Saba
Bosnia and Herzegovina
Botswana
Bouvet Island
Brazil
British Indian Ocean Territory
Brunei
Bulgaria
Burkina Faso
Burma
Burundi
Cabo Verde
Cambodia
Cameroon
Canada
Cayman Islands
Central African Republic
Chad
Chile
China
Christmas Island
Clipperton Island
Cocos (Keeling) Islands
Colombia
Comoros
Congo (Brazzaville)
Congo (Kinshasa)
Cook Islands
Coral Sea Islands
Costa Rica
Croatia
Cuba
Curaçao
Cyprus
Czech Republic
Côte d’Ivoire
Denmark
Dhekelia
Diego Garcia
Djibouti
Dominica
Dominican Republic
Ecuador
Egypt
El Salvador
Equatorial Guinea
Eritrea
Estonia
Ethiopia
Europa Island
Falkland Islands (Islas Malvinas)
Faroe Islands
Fiji
Finland
France
French Guiana
French Polynesia
French Southern and Antarctic Lands
Gabon
Gambia, The
Gaza Strip
Georgia
Germany
Ghana
Gibraltar
Glorioso Islands
Greece
Greenland
Grenada
Guadeloupe
Guam
Guatemala
Guernsey
Guinea
Guinea-Bissau
Guyana
Haiti
Heard Island and McDonald Islands
Honduras
Hong Kong
Howland Island
Hungary
Iceland
India
Indonesia
Iran
Iraq
Ireland
Isle of Man
Israel
Italy
Jamaica
Jan Mayen
Japan
Jarvis Island
Jersey
Johnston Atoll
Jordan
Juan de Nova Island
Kazakhstan
Kenya
Kingman Reef
Kiribati
Korea, North
Korea, South
Kosovo
Kuwait
Kyrgyzstan
Laos
Latvia
Lebanon
Lesotho
Liberia
Libya
Liechtenstein
Lithuania
Luxembourg
Macau
Macedonia
Madagascar
Malawi
Malaysia
Maldives
Mali
Malta
Marshall Islands
Martinique
Mauritania
Mauritius
Mayotte
Mexico
Micronesia, Federated States of
Midway Islands
Moldova
Monaco
Mongolia
Montenegro
Montserrat
Morocco
Mozambique
Namibia
Nauru
Navassa Island
Nepal
Netherlands
New Caledonia
New Zealand
Nicaragua
Niger
Nigeria
Niue
Norfolk Island
Northern Mariana Islands
Norway
Oman
Pakistan
Palau
Palmyra Atoll
Panama
Papua New Guinea
Paracel Islands
Paraguay
Peru
Philippines
Pitcairn Islands
Poland
Portugal
Puerto Rico
Qatar
Reunion
Romania
Russia
Rwanda
Saint Barthelemy
Saint Helena, Ascension, and Tristan da Cunha
Saint Kitts and Nevis
Saint Lucia
Saint Martin
Saint Pierre and Miquelon
Saint Vincent and the Grenadines
Samoa
San Marino
Sao Tome and Principe
Saudi Arabia
Senegal
Serbia
Seychelles
Sierra Leone
Singapore
Sint Maarten
Slovakia
Slovenia
Solomon Islands
Somalia
South Africa
South Georgia and South Sandwich Islands
South Sudan
Spain
Spratly Islands
Sri Lanka
Sudan
Suriname
Svalbard
Swaziland
Sweden
Switzerland
Syria
Taiwan
Tajikistan
Tanzania
Thailand
Timor-Leste
Togo
Tokelau
Tonga
Trinidad and Tobago
Tromelin Island
Tunisia
Turkey
Turkmenistan
Turks and Caicos Islands
Tuvalu
Uganda
Ukraine
United Arab Emirates
United Kingdom
United States
Uruguay
Uzbekistan
Vanuatu
Vatican City
Venezuela
Vietnam
Virgin Islands, British
Virgin Islands, U.S.
Wake Island
Wallis and Futuna
West Bank
Western Sahara
Yemen
Zambia
Zimbabwe

Language
English
Bahasa Indonesia
Deutsch
Español
Français
Polski
Português
Русский
正體中文

Format

 HTML

 Text

I’m okay with Mozilla handling my info as explained in this [Privacy Policy](https://www.mozilla.org/privacy/).

Sign up now
We will only send you
Mozilla-related information.

## Thanks!

If you haven’t previously confirmed a subscription to a Mozilla-related newsletter you may have to do so. Please check your inbox or your spam filter for an e-mail from us.

[Mozilla](https://www.mozilla.org/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)

##### Mozilla

* [About](https://www.mozilla.org/about/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Contact Us](https://www.mozilla.org/contact/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Donate](https://donate.mozilla.org/?presets=50,30,20,10&amount=30¤cy=usd&utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)

##### Firefox

* [Download Firefox](https://www.mozilla.org/firefox/new/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Desktop](https://www.mozilla.org/firefox/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Mobile](https://www.mozilla.org/firefox/mobile/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Features](https://www.mozilla.org/firefox/features/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Beta, Nightly, Developer Edition](https://www.mozilla.org/firefox/channel/desktop/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)

##### Resources

* [Privacy Hub](https://www.mozilla.org/privacy/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Browser Comparison](https://www.mozilla.org/firefox/browsers/compare/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Brand Standards](https://mozilla.design/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)

##### Social

Follow @Firefox

* [Twitter (@mozilla)](https://twitter.com/firefox)
* [Instagram (@mozilla)](https://www.instagram.com/firefox/)
* [YouTube (@firefoxchannel)](https://www.youtube.com/user/firefoxchannel)

Follow @Mozilla

* [Twitter (@mozilla)](https://twitter.com/mozilla)
* [Instagram (@mozilla)](https://www.instagram.com/mozilla/)

* [Website Privacy Notice](https://www.mozilla.org/privacy/websites/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Legal](https://www.mozilla.org/about/legal/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)



=== Content from lists.opensuse.org_98758376_20250125_210143.html ===


[![openSUSE](https://static.opensuse.org/favicon.svg)
Mailing Lists](/archives/ "openSUSE Mailing Lists")

[Sign In](/accounts/login/?next=/archives/list/updates%40lists.opensuse.org/message/PQJ4AEC4ZW2VXWYAAE3A2P7UTU2JWZW4/)
[Sign Up](/accounts/signup/?next=/archives/list/updates%40lists.opensuse.org/message/PQJ4AEC4ZW2VXWYAAE3A2P7UTU2JWZW4/)

[Manage this list](/manage/lists/updates.lists.opensuse.org/)
[Sign In](/accounts/login/?next=/archives/list/updates%40lists.opensuse.org/message/PQJ4AEC4ZW2VXWYAAE3A2P7UTU2JWZW4/)
[Sign Up](/accounts/signup/?next=/archives/list/updates%40lists.opensuse.org/message/PQJ4AEC4ZW2VXWYAAE3A2P7UTU2JWZW4/)

×
#### Keyboard Shortcuts

### Thread View

* `j`: Next unread message
* `k`: Previous unread message
* `j a`: Jump to all threads* `j l`: Jump to MailingList overview

[thread](/archives/list/updates%40lists.opensuse.org/thread/PQJ4AEC4ZW2VXWYAAE3A2P7UTU2JWZW4/#PQJ4AEC4ZW2VXWYAAE3A2P7UTU2JWZW4)

# openSUSE-SU-2011:1076-2: important: MozillaThunderbird: Update to Mozilla Thunderbird 3.1.14

![](https://seccdn.libravatar.org/avatar/099a17325bdf082b643d1a6bbacde279.jpg?s=120&d=mm&r=g)
## [opensuse-security＠opensuse.org](/archives/users/1b72def497ef4503896cd7a5fe9fb8e0/ "See the profile for opensuse-security＠opensuse.org")

4 Oct
2011

4 Oct
'11

13:08

openSUSE Security Update: MozillaThunderbird: Update to Mozilla Thunderbird 3.1.14
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
Announcement ID: openSUSE-SU-2011:1076-2
Rating: important
References: #720264
Affected Products:
openSUSE 11.4
openSUSE 11.3
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
An update that contains security fixes can now be
installed. It includes two new package versions.
Description:
Mozilla Thunderbird was updated to version 3.1.14, fixing
various bugs and security issues.
MFSA 2011-36: Mozilla developers identified and fixed
several memory safety bugs in the browser engine used in
Firefox and other Mozilla-based products. Some of these
bugs showed evidence of memory corruption under certain
circumstances, and we presume that with enough effort at
least some of these could be exploited to run arbitrary
code.
In general these flaws cannot be exploited through email in
the Thunderbird and SeaMonkey products because scripting is
disabled, but are potentially a risk in browser or
browser-like contexts in those products.
Benjamin Smedberg, Bob Clary, and Jesse Ruderman reported
memory safety problems that affected Firefox 3.6 and
Firefox 6. (CVE-2011-2995)
Bob Clary, Andrew McCreight, Andreas Gal, Gary Kwong, Igor
Bukanov, Jason Orendorff, Jesse Ruderman, and Marcia Knous
reported memory safety problems that affected Firefox 6,
fixed in Firefox 7. (CVE-2011-2997)
MFSA 2011-38: Mozilla developer Boris Zbarsky reported that
a frame named "location" could shadow the window.location
object unless a script in a page grabbed a reference to the
true object before the frame was created. Because some
plugins use the value of window.location to determine the
page origin this could fool the plugin into granting the
plugin content access to another site or the local file
system in violation of the Same Origin Policy. This flaw
allows circumvention of the fix added for MFSA 2010-10.
(CVE-2011-2999)
MFSA 2011-39: Ian Graham of Citrix Online reported that
when multiple Location headers were present in a redirect
response Mozilla behavior differed from other browsers:
Mozilla would use the second Location header while Chrome
and Internet Explorer would use the first. Two copies of
this header with different values could be a symptom of a
CRLF injection attack against a vulnerable server. Most
commonly it is the Location header itself that is
vulnerable to the response splitting and therefore the copy
preferred by Mozilla is more likely to be the malicious
one. It is possible, however, that the first copy was the
injected one depending on the nature of the server
vulnerability.
The Mozilla browser engine has been changed to treat two
copies of this header with different values as an error
condition. The same has been done with the headers
Content-Length and Content-Disposition. (CVE-2011-3000)
MFSA 2011-40: Mariusz Mlynski reported that if you could
convince a user to hold down the Enter key--as part of a
game or test, perhaps--a malicious page could pop up a
download dialog where the held key would then activate the
default Open action. For some file types this would be
merely annoying (the equivalent of a pop-up) but other file
types have powerful scripting capabilities. And this would
provide an avenue for an attacker to exploit a
vulnerability in applications not normally exposed to
potentially hostile internet content.
Mariusz also reported a similar flaw with manual plugin
installation using the PLUGINSPAGE attribute. It was
possible to create an internal error that suppressed a
confirmation dialog, such that holding enter would lead to
the installation of an arbitrary add-on. (This variant did
not affect Firefox 3.6)
Holding enter allows arbitrary code execution due to
Download Manager (CVE-2011-2372)
Holding enter allows arbitrary extension installation
(CVE-2011-3001)
MFSA 2011-42: Security researcher Aki Helin reported a
potentially exploitable crash in the YARR regular
expression library used by JavaScript. (CVE-2011-3232)
MFSA 2011-44: sczimmer reported that Firefox crashed when
loading a particular .ogg file. This was due to a
use-after-free condition and could potentially be exploited
to install malware. (CVE-2011-3005)
This vulnerability does not affect Firefox 3.6 or earlier.
Patch Instructions:
To install this openSUSE Security Update use YaST online\_update.
Alternatively you can run the command listed for your product:
- openSUSE 11.4:
zypper in -t patch MozillaThunderbird-5204
- openSUSE 11.3:
zypper in -t patch MozillaThunderbird-5204
To bring your system up-to-date, use "zypper patch".
Package List:
- openSUSE 11.4 (i586 x86\_64) [New Version: 3.1.15]:
MozillaThunderbird-3.1.15-0.17.1
MozillaThunderbird-buildsymbols-3.1.15-0.17.1
MozillaThunderbird-devel-3.1.15-0.17.1
MozillaThunderbird-translations-common-3.1.15-0.17.1
MozillaThunderbird-translations-other-3.1.15-0.17.1
enigmail-1.1.2+3.1.15-0.17.1
- openSUSE 11.3 (i586 x86\_64) [New Version: 3.1.15]:
MozillaThunderbird-3.1.15-0.21.1
MozillaThunderbird-devel-3.1.15-0.21.1
MozillaThunderbird-translations-common-3.1.15-0.21.1
MozillaThunderbird-translations-other-3.1.15-0.21.1
enigmail-1.1.2+3.1.15-0.21.1
References:
<https://bugzilla.novell.com/720264>

[0](#like "You must be logged-in to vote.")
[0](#dislike "You must be logged-in to vote.")

Reply

[Sign in to reply online](/accounts/login/?next=/archives/list/updates%40lists.opensuse.org/message/PQJ4AEC4ZW2VXWYAAE3A2P7UTU2JWZW4/)
Use email software

[Back to the thread](/archives/list/updates%40lists.opensuse.org/thread/PQJ4AEC4ZW2VXWYAAE3A2P7UTU2JWZW4/#PQJ4AEC4ZW2VXWYAAE3A2P7UTU2JWZW4)

[Back to the list](/archives/list/updates%40lists.opensuse.org/)

![HyperKitty](/static/hyperkitty/img/logo.png)
Powered by [HyperKitty](http://hyperkitty.readthedocs.org) version 1.3.12.



=== Content from www.mandriva.com_9b28f0c1_20250125_210148.html ===


* [Tuxedo.org](https://tuxedo.org/ "Go to: Tuxedo")
* Store
* Mandriva Linux
* Enterprise Solutions
* Contact Us
* Language ![](/sites/all/themes/mandriva_customer/images/arrow-grey-bottom.gif)
  + English (International)
  + Français
  + Ð ÑÑÑÐºÐ¸Ð¹

# [Mandriva](/mandriva/)

* Download
* Mandriva Linux
* Community
* Help

## One

### The Linux desktopthat's easy to try and easy to keep

Download
![Mandriva One](/sites/all/themes/mandriva_customer/images/front/packshot_Mandriva_One.png)

## Powerpack

### Mandriva Linux- and more

Download
![Mandriva Linux Powerpack](/sites/all/themes/mandriva_customer/images/front/en-49.png)

## Mandriva Flash

### The mobile and installable Linux desktopon a USB key

Buy on Store
![Mandriva Flash](/sites/all/themes/mandriva_customer/images/front/mandriva-flash2.png)

### [Community](community)

* User Forums
* Support - FAQ
* Free Software
* Become a member

### Enterprise Solutions

* Enterprise Linux Products
* Asset Management Solution
* Professional Services
* Support & Maintenance

* Go to site »

### Mandriva Partners

* Worldwide offices
* Partner Program
* Technology Partners
* OEM
* Classmate PC with Mandriva Linux

### News

* Mandriva presents the launch of its new mobile desktop: Mandriva Flash 2008 Spring
* Speaking about Mandriva Linux 2008 Spring in media
* Speaking about Mandriva Linux 2008 Spring in media
* Mandriva presents its latest distribution: Mandriva Linux 2008 Spring
* Mandriva and Novatice Technologies present Edutice, The ready to use solution dedicated to educationand multimedia spaces
* # [Top 50 Online Casinos UK in 2023](https://montycasinos.com/online-casinos/)

more

* Download
  + Mandriva Linux 2008
  + Writing an ISO image
* Mandriva Linux
  + One
  + Powerpack
  + Mandriva Flash
* Community
  + Start
  + Register
  + Stay informed
  + Participate
  + Free software
* Help
  + Getting help
  + Knowledge Base
  + Documentation
  + Forums
  + Support Requests
  + Customer Care
  + Enterprise Support
* Enterprise Solutions
  + Products
  + Support
  + Services
  + Partners
  + Go to site »

Language
English (International)
Français
Ð ÑÑÑÐºÐ¸Ð¹

* © 2007 Mandriva S.A.
* About Us
* Legal Information
* Privacy Policy
* Contact Us



=== Content from blog.mozilla.org_02ca07ef_20250126_115543.html ===

[Skip to content](#content)

[Mozilla](https://blog.mozilla.org/en/)

![search](https://blog.mozilla.org/wp-content/themes/foxtail/assets/images/icons/search.svg)

* [Internet Culture](https://blog.mozilla.org/en/category/internet-culture/)
  + [Deep Dives](https://blog.mozilla.org/en/category/internet-culture/deep-dives/)
  + [Mozilla Explains](https://blog.mozilla.org/en/category/internet-culture/mozilla-explains/)
  + [Interviews](https://blog.mozilla.org/en/category/internet-culture/interviews/)
  + [Videos](https://blog.mozilla.org/en/category/videos/)
* [Privacy & Security](https://blog.mozilla.org/en/category/privacy-security/)
* [Products](https://blog.mozilla.org/en/category/products/)
  + [Firefox](https://blog.mozilla.org/en/category/products/firefox/)
  + [Pocket](https://blog.mozilla.org/en/category/products/pocket/)
  + [Mozilla VPN](https://blog.mozilla.org/en/category/products/mozilla-vpn/)
* [Mozilla](https://blog.mozilla.org/en/category/mozilla/)
  + [News](https://blog.mozilla.org/en/category/mozilla/news/)
  + [Internet Policy](https://blog.mozilla.org/en/category/mozilla/internet-policy/)
  + [Leadership](https://blog.mozilla.org/en/category/mozilla/leadership/)
    - [Mitchell Baker, CEO](https://blog.mozilla.org/en/author/mitchellmozillacom/)
    - [Mark Surman, ED Foundation](https://blog.mozilla.org/en/author/markmozillafoundation-org/)
    - [Eric Rescorla, Firefox CTO](https://blog.mozilla.org/en/author/ekrmozilla-com/)

[Download Firefox](https://www.mozilla.org/firefox/new/?utm_source=blog.mozilla.org&utm_medium=referral&utm_campaign=blog-nav)

![search](https://blog.mozilla.org/wp-content/themes/foxtail/assets/images/icons/search.svg)

#### Search

Search for:

![](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2019/01/mozilla-logo-bw-rgb.png)
## News

Official announcements and press releases

[![Room filled with people listening to a speaker on stage. Demo Day visual image in the background.](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2024/12/Demo_Day_Blog_Header_-1-800x800.jpg)
Mozilla
## Mozilla Builders: Celebrating community-driven innovation in AI

Read More](https://blog.mozilla.org/en/mozilla/mozilla-builders-demo-day/)

[![The Mozilla logo in green on a black background](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2024/12/logo-lockup-video-poster-800x800.png)
Mozilla
## Mozilla welcomes new executive team members

Read More](https://blog.mozilla.org/en/mozilla/new-executives/)

[![Decorative image of wrapped gifts in front of an iphone](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2023/11/moz_header_holiday_firefox-phone-gifts_blue-03.png-800x800.png)
Products
## Shopping for everyone? We’ve got you covered with the Fakespot Holiday Gift Guide 2024

Read More](https://blog.mozilla.org/en/products/shopping-for-everyone-weve-got-you-covered-with-the-fakespot-holiday-gift-guide-2024/)

[![Text: Mozilla Builders](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2024/06/Blog-16_9-1920x1080-1-800x800.png)
Mozilla
## 14 AI projects to watch: Mozilla’s first Builders Accelerator cohort kicks off

Read More](https://blog.mozilla.org/en/mozilla/14-ai-projects-to-watch-mozillas-first-builders-accelerator-cohort-kicks-off/)

[![A check mark next to the text "Fakespot."](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2023/07/Fakespot_ProductBlog-2-800x800.jpg)
News
## Fakespot’s guide to trending back-to-school products

Read More](https://blog.mozilla.org/en/mozilla/news/fakespots-guide-to-trending-back-to-school-products/)

[![](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2024/06/IG_Highlights_Icon-800x800.png)
Mozilla
## BAFTA Award-Winner Siobhán McSweeney to host Mozilla’s 2nd Annual Rise25 Awards in Dublin, Ireland on Aug. 13

Read More](https://blog.mozilla.org/en/mozilla/bafta-award-winner-siobhan-mcsweeney-to-host-mozillas-2nd-annual-rise25-awards-in-dublin-ireland-on-august-13/)

[![](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2024/05/fx_website_meta-image_tips-tricks_alt-04-1-800x800.webp)
Mozilla
## Here’s what we’re working on in Firefox

Read More](https://blog.mozilla.org/en/mozilla/heres-what-were-working-on-in-firefox/)

[![A check mark next to the text "Fakespot."](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2023/07/Fakespot_ProductBlog-2-800x800.jpg)
News
## Fakespot reveals the product categories with the most and least reliable product reviews

Read More](https://blog.mozilla.org/en/mozilla/news/fakespot-reveals-the-product-categories-with-the-most-and-least-reliable-product-reviews-for-summer-and-back-to-school-shopping/)

[![A dark blue speech bubble with horizontal purple and red bars on a pink background.](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2020/03/fx_blog_header_announcements_001_1920x1080-800x800.jpg)
Firefox
## Engaging with our Firefox community: Highlights from our recent AMA

Read More](https://blog.mozilla.org/en/products/firefox/engaging-with-our-firefox-community-highlights-from-our-recent-ama/)

[![](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2024/06/IG_Highlights_Icon-800x800.png)
Mozilla
## Mozilla announces finalists for the 2nd annual Rise25 Awards

Read More](https://blog.mozilla.org/en/mozilla/mozilla-announces-finalists-for-the-2nd-annual-rise25-awards/)

[![Mozilla and Anonym logos](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2024/06/blog_1200x800_v2-800x800.png)
Mozilla
## Introducing Anonym: Raising the bar for privacy-preserving digital advertising

Read More](https://blog.mozilla.org/en/mozilla/mozilla-anonym-raising-the-bar-for-privacy-preserving-digital-advertising/)

[![logo - zero with a diagonal line through it, and the letters D, I, N](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2024/06/odintbanner-500x500.png)
Mozilla
## Keeping GenAI technologies secure is a shared responsibility

Read More](https://blog.mozilla.org/en/mozilla/keeping-genai-technologies-secure-is-a-shared-responsibility/)

1
[2](https://blog.mozilla.org/en/category/mozilla/news/page/2?utm_source=www.mozilla.o)
[3](https://blog.mozilla.org/en/category/mozilla/news/page/3?utm_source=www.mozilla.o)
…
[24](https://blog.mozilla.org/en/category/mozilla/news/page/24?utm_source=www.mozilla.o)
[next](https://blog.mozilla.org/en/category/mozilla/news/page/2?utm_source=www.mozilla.o)

![newsletter](https://blog.mozilla.org/wp-content/themes/foxtail/assets/images/newsletter.png)

### Keep up with all things Firefox

Get how-tos, advice and news to make your Firefox experience work best for you.

Your e-mail address

Country
- select -
Afghanistan
Akrotiri
Albania
Algeria
American Samoa
Andorra
Angola
Anguilla
Antarctica
Antigua and Barbuda
Argentina
Armenia
Aruba
Ashmore and Cartier Islands
Australia
Austria
Azerbaijan
Bahamas, The
Bahrain
Baker Island
Bangladesh
Barbados
Bassas da India
Belarus
Belgium
Belize
Benin
Bermuda
Bhutan
Bolivia
Bonaire, Sint Eustatius, and Saba
Bosnia and Herzegovina
Botswana
Bouvet Island
Brazil
British Indian Ocean Territory
Brunei
Bulgaria
Burkina Faso
Burma
Burundi
Cabo Verde
Cambodia
Cameroon
Canada
Cayman Islands
Central African Republic
Chad
Chile
China
Christmas Island
Clipperton Island
Cocos (Keeling) Islands
Colombia
Comoros
Congo (Brazzaville)
Congo (Kinshasa)
Cook Islands
Coral Sea Islands
Costa Rica
Croatia
Cuba
Curaçao
Cyprus
Czech Republic
Côte d’Ivoire
Denmark
Dhekelia
Diego Garcia
Djibouti
Dominica
Dominican Republic
Ecuador
Egypt
El Salvador
Equatorial Guinea
Eritrea
Estonia
Ethiopia
Europa Island
Falkland Islands (Islas Malvinas)
Faroe Islands
Fiji
Finland
France
French Guiana
French Polynesia
French Southern and Antarctic Lands
Gabon
Gambia, The
Gaza Strip
Georgia
Germany
Ghana
Gibraltar
Glorioso Islands
Greece
Greenland
Grenada
Guadeloupe
Guam
Guatemala
Guernsey
Guinea
Guinea-Bissau
Guyana
Haiti
Heard Island and McDonald Islands
Honduras
Hong Kong
Howland Island
Hungary
Iceland
India
Indonesia
Iran
Iraq
Ireland
Isle of Man
Israel
Italy
Jamaica
Jan Mayen
Japan
Jarvis Island
Jersey
Johnston Atoll
Jordan
Juan de Nova Island
Kazakhstan
Kenya
Kingman Reef
Kiribati
Korea, North
Korea, South
Kosovo
Kuwait
Kyrgyzstan
Laos
Latvia
Lebanon
Lesotho
Liberia
Libya
Liechtenstein
Lithuania
Luxembourg
Macau
Macedonia
Madagascar
Malawi
Malaysia
Maldives
Mali
Malta
Marshall Islands
Martinique
Mauritania
Mauritius
Mayotte
Mexico
Micronesia, Federated States of
Midway Islands
Moldova
Monaco
Mongolia
Montenegro
Montserrat
Morocco
Mozambique
Namibia
Nauru
Navassa Island
Nepal
Netherlands
New Caledonia
New Zealand
Nicaragua
Niger
Nigeria
Niue
Norfolk Island
Northern Mariana Islands
Norway
Oman
Pakistan
Palau
Palmyra Atoll
Panama
Papua New Guinea
Paracel Islands
Paraguay
Peru
Philippines
Pitcairn Islands
Poland
Portugal
Puerto Rico
Qatar
Reunion
Romania
Russia
Rwanda
Saint Barthelemy
Saint Helena, Ascension, and Tristan da Cunha
Saint Kitts and Nevis
Saint Lucia
Saint Martin
Saint Pierre and Miquelon
Saint Vincent and the Grenadines
Samoa
San Marino
Sao Tome and Principe
Saudi Arabia
Senegal
Serbia
Seychelles
Sierra Leone
Singapore
Sint Maarten
Slovakia
Slovenia
Solomon Islands
Somalia
South Africa
South Georgia and South Sandwich Islands
South Sudan
Spain
Spratly Islands
Sri Lanka
Sudan
Suriname
Svalbard
Swaziland
Sweden
Switzerland
Syria
Taiwan
Tajikistan
Tanzania
Thailand
Timor-Leste
Togo
Tokelau
Tonga
Trinidad and Tobago
Tromelin Island
Tunisia
Turkey
Turkmenistan
Turks and Caicos Islands
Tuvalu
Uganda
Ukraine
United Arab Emirates
United Kingdom
United States
Uruguay
Uzbekistan
Vanuatu
Vatican City
Venezuela
Vietnam
Virgin Islands, British
Virgin Islands, U.S.
Wake Island
Wallis and Futuna
West Bank
Western Sahara
Yemen
Zambia
Zimbabwe

Language
English
Bahasa Indonesia
Deutsch
Español
Français
Polski
Português
Русский
正體中文

Format

 HTML

 Text

I’m okay with Mozilla handling my info as explained in this [Privacy Policy](https://www.mozilla.org/privacy/).

Sign up now
We will only send you
Mozilla-related information.

## Thanks!

If you haven’t previously confirmed a subscription to a Mozilla-related newsletter you may have to do so. Please check your inbox or your spam filter for an e-mail from us.

[Mozilla](https://www.mozilla.org/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)

##### Mozilla

* [About](https://www.mozilla.org/about/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Contact Us](https://www.mozilla.org/contact/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Donate](https://donate.mozilla.org/?presets=50,30,20,10&amount=30¤cy=usd&utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)

##### Firefox

* [Download Firefox](https://www.mozilla.org/firefox/new/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Desktop](https://www.mozilla.org/firefox/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Mobile](https://www.mozilla.org/firefox/mobile/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Features](https://www.mozilla.org/firefox/features/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Beta, Nightly, Developer Edition](https://www.mozilla.org/firefox/channel/desktop/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)

##### Resources

* [Privacy Hub](https://www.mozilla.org/privacy/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Browser Comparison](https://www.mozilla.org/firefox/browsers/compare/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Brand Standards](https://mozilla.design/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)

##### Social

Follow @Firefox

* [Twitter (@mozilla)](https://twitter.com/firefox)
* [Instagram (@mozilla)](https://www.instagram.com/firefox/)
* [YouTube (@firefoxchannel)](https://www.youtube.com/user/firefoxchannel)

Follow @Mozilla

* [Twitter (@mozilla)](https://twitter.com/mozilla)
* [Instagram (@mozilla)](https://www.instagram.com/mozilla/)

* [Website Privacy Notice](https://www.mozilla.org/privacy/websites/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Legal](https://www.mozilla.org/about/legal/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)



=== Content from bugzilla.mozilla.org_0316753f_20250125_210213.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/678818)
* [XML](/show_bug.cgi?ctype=xml&id=678818)

Closed
[Bug 678818](/show_bug.cgi?id=678818)

Opened 13 years ago
Closed 13 years ago

# "ASSERTION: Window still registered with device motion" and crash

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

"ASSERTION: Window still registered with device motion" and crash

## Categories

### (Core :: DOM: Events, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=DOM%3A%20Events#DOM%3A%20Events)

DOM: Events
▾

Core :: DOM: Events
This component includes bugs for DOM events from [https://dom.spec.whatwg.org](https://dom.spec.whatwg.org/).
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=DOM%3A%20Events&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=DOM%3A%20Events&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=DOM%3A%20Events)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

x86\_64

macOS

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

critical

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

---

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| a11y-review | --- |
| --- | --- |
| Accessibility Severity | --- |
| Webcompat Score | --- |
| Performance Impact | --- |
| Webcompat Priority | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox5 | [-](/buglist.cgi?f1=cf_tracking_firefox5&o1=equals&v1=-) | [wontfix](/buglist.cgi?f1=cf_status_firefox5&o1=equals&v1=wontfix) |
| firefox6 | [-](/buglist.cgi?f1=cf_tracking_firefox6&o1=equals&v1=-) | [wontfix](/buglist.cgi?f1=cf_status_firefox6&o1=equals&v1=wontfix) |
| firefox7 | [+](/buglist.cgi?f1=cf_tracking_firefox7&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox7&o1=equals&v1=fixed) |
| firefox8 | [+](/buglist.cgi?f1=cf_tracking_firefox8&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox8&o1=equals&v1=fixed) |
| firefox9 | [+](/buglist.cgi?f1=cf_tracking_firefox9&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=fixed) |
| status1.9.2 | --- | [unaffected](/buglist.cgi?f1=cf_status_192&o1=equals&v1=unaffected) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox5 | - | wontfix |
| firefox6 | - | wontfix |
| firefox7 | + | fixed |
| firefox8 | + | fixed |
| firefox9 | + | fixed |
| status1.9.2 |  | unaffected |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: jruderman, Assigned: dougt)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/c4f245bb4b1441900aba849213666b04?d=mm&size=40)  [dougt](/user_profile?user_id=302291)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/d2dc9227eafcd0ec5ba3712ee4f19b75?d=mm&size=40)  [jruderman](/user_profile?user_id=11608)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/5111b810214a00377104f5ad3efefa26?d=mm&size=40)  [sefeng](/user_profile?user_id=625922)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

4 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: assertion, crash, testcase, Whiteboard: [sg:critical?][qa-])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[assertion](/buglist.cgi?keywords=assertion&resolution=---),
[crash](/buglist.cgi?keywords=crash&resolution=---),
[testcase](/buglist.cgi?keywords=testcase&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[sg:critical?][qa-]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |
|  | qe-verify |  |

## Crash Data

Signature:

[[@ nsDeviceMotion::DeviceMotionChanged ]](https://crash-stats.mozilla.org/signature/?signature=nsDeviceMotion%3A%3ADeviceMotionChanged)

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (3 files)

| [testcase (crashes Firefox after closed)](/attachment.cgi?id=552965)  [13 years ago](#c0)  [Jesse Ruderman](/user_profile?user_id=11608)   331 bytes, text/html |  | [Details](/attachment.cgi?id=552965&action=edit) |
| --- | --- | --- |
| [stack traces](/attachment.cgi?id=552966)  [13 years ago](#c1)  [Jesse Ruderman](/user_profile?user_id=11608)   4.19 KB, text/plain |  | [Details](/attachment.cgi?id=552966&action=edit) |
| [patch v.1](/attachment.cgi?id=553001)  [13 years ago](#c2)  [Doug Turner (:dougt)](/user_profile?user_id=302291)   1.57 KB, patch | jst : [review+](#a388723_12352 "13 years ago")  blizzard : [approval-mozilla-aurora+](#c5 "13 years ago")  blizzard : [approval-mozilla-beta+](#c5 "13 years ago") | [Details](/attachment.cgi?id=553001&action=edit) | [Diff](/attachment.cgi?id=553001&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=678818&attachment=553001) |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Jesse Ruderman](/user_profile?user_id=11608)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=678818#c0)• 13 years ago |
|  | |

Attached file
[testcase (crashes Firefox after closed)](attachment.cgi?id=552965)
— [Details](attachment.cgi?id=552965&action=edit)

Steps to reproduce:
1. Load the testcase.
2. Quit Firefox. (Or, close the tab and click the MP button in about:memory.)
Result:
An assertion fails during GC:
###!!! ASSERTION: Window still registered with device motion.: '!mHasDeviceMotion', file dom/base/nsGlobalWindow.cpp, line 1039
Which is soon followed by:
Invalid read of freed memory [@ nsDeviceMotion::DeviceMotionChanged] in order to make a virtual function call.
(Beware: [bp-4cdef108-d00e-4b39-8e21-d86152110813](https://crash-stats.mozilla.org/report/index/4cdef108-d00e-4b39-8e21-d86152110813) makes it look like a null deref, but it is actually a more serious bug.)

|  | [Jesse Ruderman](/user_profile?user_id=11608)  Reporter |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=678818#c1)• 13 years ago |
|  | |

Attached file
[stack traces](attachment.cgi?id=552966)
— [Details](attachment.cgi?id=552966&action=edit)

|  | [Doug Turner (:dougt)](/user_profile?user_id=302291)  Assignee |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=678818#c2)• 13 years ago |
|  | |

Attached patch

[patch v.1](attachment.cgi?id=553001&action=diff)
— [Details](attachment.cgi?id=553001&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=678818&attachment=553001)

We are starting up the device motion after Cleanup() is called. This patch ensure that the device motion is disabled during the global window destructor.Assignee: nobody → doug.turner

|  | [Doug Turner (:dougt)](/user_profile?user_id=302291)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=678818#a134596_302291)• 13 years ago |

[Attachment #553001](/attachment.cgi?id=553001&action=edit "patch v.1") -
Flags: review?(jst)

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=678818#a370833_12352)• 13 years ago |

[status-firefox5](/buglist.cgi?f1=cf_status_firefox5&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox5&o1=equals&v1=wontfix)
[status-firefox6](/buglist.cgi?f1=cf_status_firefox6&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox6&o1=equals&v1=wontfix)
[status-firefox7](/buglist.cgi?f1=cf_status_firefox7&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox7&o1=equals&v1=affected)
[status-firefox8](/buglist.cgi?f1=cf_status_firefox8&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox8&o1=equals&v1=affected)
[status-firefox9](/buglist.cgi?f1=cf_status_firefox9&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=affected)
[tracking-firefox5](/buglist.cgi?f1=cf_tracking_firefox5&o1=isnotempty):
--- → [-](/buglist.cgi?f1=cf_tracking_firefox5&o1=equals&v1=-)
[tracking-firefox6](/buglist.cgi?f1=cf_tracking_firefox6&o1=isnotempty):
--- → [-](/buglist.cgi?f1=cf_tracking_firefox6&o1=equals&v1=-)
[tracking-firefox7](/buglist.cgi?f1=cf_tracking_firefox7&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox7&o1=equals&v1=%2B)
[tracking-firefox8](/buglist.cgi?f1=cf_tracking_firefox8&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox8&o1=equals&v1=%2B)
[tracking-firefox9](/buglist.cgi?f1=cf_tracking_firefox9&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox9&o1=equals&v1=%2B)

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=678818#a388723_12352)• 13 years ago |

[Attachment #553001](/attachment.cgi?id=553001&action=edit "patch v.1") -
Flags: review?(jst) → review+

|  | [Doug Turner (:dougt)](/user_profile?user_id=302291)  Assignee |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=678818#c3)• 13 years ago |
|  | |

<http://hg.mozilla.org/integration/mozilla-inbound/rev/1ac35ad29f03>

|  | [Doug Turner (:dougt)](/user_profile?user_id=302291)  Assignee |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=678818#c4)• 13 years ago |
|  | |

<http://hg.mozilla.org/mozilla-central/rev/1ac35ad29f03>

|  | [Doug Turner (:dougt)](/user_profile?user_id=302291)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=678818#a788294_302291)• 13 years ago |

[Attachment #553001](/attachment.cgi?id=553001&action=edit "patch v.1") -
Flags: approval-mozilla-beta?
[Attachment #553001](/attachment.cgi?id=553001&action=edit "patch v.1") -
Flags: approval-mozilla-aurora?

|  | [Doug Turner (:dougt)](/user_profile?user_id=302291)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=678818#a788306_302291)• 13 years ago |

Status: NEW → RESOLVEDClosed: 13 years agoResolution: --- → FIXED

|  | [Christopher Blizzard (:blizzard)](/user_profile?user_id=14701) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=678818#c5)• 13 years ago |
|  | |

Comment on [attachment 553001](/attachment.cgi?id=553001 "patch v.1") [[details]](/attachment.cgi?id=553001&action=edit "patch v.1") [[diff]](/attachment.cgi?id=553001&action=diff "patch v.1") [[review]](/page.cgi?id=splinter.html&ignore=&bug=678818&attachment=553001)
patch v.1
Approved for Aurora (Update 8) and Beta (Update 7.) Please land it as soon as possible.
[Attachment #553001](/attachment.cgi?id=553001&action=edit "patch v.1") -
Flags: approval-mozilla-beta?
[Attachment #553001](/attachment.cgi?id=553001&action=edit "patch v.1") -
Flags: approval-mozilla-beta+
[Attachment #553001](/attachment.cgi?id=553001&action=edit "patch v.1") -
Flags: approval-mozilla-aurora?
[Attachment #553001](/attachment.cgi?id=553001&action=edit "patch v.1") -
Flags: approval-mozilla-aurora+

|  | [Kyle Huey (Exited; not receiving bugmail, old account, do not use)](/user_profile?user_id=336670) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=678818#c6)• 13 years ago |
|  | |

<http://hg.mozilla.org/releases/mozilla-aurora/rev/f717ca3b24e7>
This patch doesn't apply to beta ...
[status-firefox8](/buglist.cgi?f1=cf_status_firefox8&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox8&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox8&o1=equals&v1=fixed)
[status-firefox9](/buglist.cgi?f1=cf_status_firefox9&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox9&o1=equals&v1=fixed)

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=678818#c7)• 13 years ago |
|  | |

Doug, can you merge this fix to beta? Probably some silly context differences that causes it not to apply... And we're running out of time for 7...

|  | [Doug Turner (:dougt)](/user_profile?user_id=302291)  Assignee |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=678818#c8)• 13 years ago |
|  | |

<http://hg.mozilla.org/releases/mozilla-beta/rev/69750db9e4fa>
[status-firefox7](/buglist.cgi?f1=cf_status_firefox7&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox7&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox7&o1=equals&v1=fixed)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=678818#a3028310_1689)• 13 years ago |

[status1.9.2](/buglist.cgi?f1=cf_status_192&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_192&o1=equals&v1=unaffected)

|  | [u279076](/user_profile?user_id=279076) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=678818#c9)• 13 years ago |
|  | |

qa- as no QA fix verification neededWhiteboard: [sg:critical?] → [sg:critical?][qa-]

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=678818#a13671519_1689)• 13 years ago |

Group: core-security
You need to [log in](/show_bug.cgi?id=678818&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Jesse Ruderman](/user_profile?user_id=11608)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from bugzilla.mozilla.org_4ca5d5f7_20250125_210202.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/667507)
* [XML](/show_bug.cgi?ctype=xml&id=667507)

Closed
[Bug 667507](/show_bug.cgi?id=667507)

Opened 14 years ago
Closed 14 years ago

# TM/JM: "Assertion failure: shape->previous() == obj->lastProperty()," with gc

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

TM/JM: "Assertion failure: shape->previous() == obj->lastProperty()," with gc

## Categories

### (Core :: JavaScript Engine, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=JavaScript%20Engine#JavaScript%20Engine)

JavaScript Engine
▾

Core :: JavaScript Engine
The interpreter engine for the core JavaScript language, independent of the browser's object model. File ONLY core JavaScript language bugs in this category. For bugs involving browser objects such as "window" and "document", use the "DOM" component. For bugs involving calls between JavaScript and C++, use the "XPConnect" component.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=JavaScript%20Engine&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=JavaScript%20Engine&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=JavaScript%20Engine)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

x86

macOS

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

critical

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla8

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Accessibility Severity | --- |
| --- | --- |
| Webcompat Score | --- |
| Performance Impact | --- |
| a11y-review | --- |
| Webcompat Priority | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox5 | [-](/buglist.cgi?f1=cf_tracking_firefox5&o1=equals&v1=-) | [unaffected](/buglist.cgi?f1=cf_status_firefox5&o1=equals&v1=unaffected) |
| firefox6 | [-](/buglist.cgi?f1=cf_tracking_firefox6&o1=equals&v1=-) | [unaffected](/buglist.cgi?f1=cf_status_firefox6&o1=equals&v1=unaffected) |
| firefox7 | [+](/buglist.cgi?f1=cf_tracking_firefox7&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox7&o1=equals&v1=fixed) |
| status1.9.2 | --- | [unaffected](/buglist.cgi?f1=cf_status_192&o1=equals&v1=unaffected) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox5 | - | unaffected |
| firefox6 | - | unaffected |
| firefox7 | + | fixed |
| status1.9.2 |  | unaffected |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: gkw, Assigned: igor)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/78556976aa7c7e7980d6865f27df11b8?d=mm&size=40)  [igor](/user_profile?user_id=50763)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](extensions/Gravatar/web/default.jpg)  [gkw](/user_profile?user_id=132034)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/4fe52ee1503aecf7b6c976b8eb7c1753?d=mm&size=40)  [willyelm](/user_profile?user_id=714609)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

10 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[630996](/show_bug.cgi?id=630996 "RESOLVED FIXED - A tool for stress testing objects and PIC's"), [657198](/show_bug.cgi?id=657198 "VERIFIED FIXED - TM: \"Assertion failure: shape->previous() == obj->lastProperty(),\" with gc")

Dependency [tree](/showdependencytree.cgi?id=667507&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=667507)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: assertion, regression, testcase, Whiteboard: [sg:critical?][needs aurora landing for Fx7][qa-])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[assertion](/buglist.cgi?keywords=assertion&resolution=---),
[regression](/buglist.cgi?keywords=regression&resolution=---),
[testcase](/buglist.cgi?keywords=testcase&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[sg:critical?][needs aurora landing for Fx7][qa-]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [gkw](/user_profile?user_id=132034) | [in-testsuite](#c14 "13 years ago") | + |
| --- | --- | --- |
| [gkw](/user_profile?user_id=132034) | in-testsuite | + |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (2 files)

| [stack](/attachment.cgi?id=542188)  [14 years ago](#c0)  [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034)   5.33 KB, text/plain |  | [Details](/attachment.cgi?id=542188&action=edit) |
| --- | --- | --- |
| [v1](/attachment.cgi?id=543785)  [14 years ago](#c3)  [Igor Bukanov](/user_profile?user_id=50763)   3.97 KB, patch | gal : [review+](#c4 "14 years ago")  christian : [approval-mozilla-aurora+](#c8 "13 years ago") | [Details](/attachment.cgi?id=543785&action=edit) | [Diff](/attachment.cgi?id=543785&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=667507&attachment=543785) |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=667507#c0)• 14 years ago |
|  | |

Attached file
[stack](attachment.cgi?id=542188)
— [Details](attachment.cgi?id=542188&action=edit)

for (i = 0; i < 10; i++) {
Object.defineProperty({}, "", {
get: function() {}
})
gc()
}
asserts js debug shell on TM changeset bf147b22f72c with -m, -a and -j at Assertion failure: shape->previous() == obj->lastProperty(),
Locking s-s because this involves gc and just-to-be-safe.
autoBisect shows this is probably related to the following changeset:
The first bad revision is:
changeset: 71353:dc137da5a3b4
user: Igor Bukanov
date: Tue May 31 10:01:09 2011 +0200
summary: [Bug 657198](/show_bug.cgi?id=657198 "VERIFIED FIXED - TM: \"Assertion failure: shape->previous() == obj->lastProperty(),\" with gc") - improving unreachable GC things detection in traces. r=gal

|  | [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034)  Reporter |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=667507#c1)• 14 years ago |
|  | |

Tested on 64-bit shell on Mac.

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=667507#c2)• 14 years ago |
|  | |

Guessing at severity. Igor, please correct if I'm overly pessimisticAssignee: general → igorWhiteboard: [sg:critical?]

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=667507#a271532_12352)• 14 years ago |

[status-firefox5](/buglist.cgi?f1=cf_status_firefox5&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_firefox5&o1=equals&v1=unaffected)
[status-firefox6](/buglist.cgi?f1=cf_status_firefox6&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox6&o1=equals&v1=affected)
[status-firefox7](/buglist.cgi?f1=cf_status_firefox7&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox7&o1=equals&v1=affected)
[tracking-firefox5](/buglist.cgi?f1=cf_tracking_firefox5&o1=isnotempty):
--- → [-](/buglist.cgi?f1=cf_tracking_firefox5&o1=equals&v1=-)
[tracking-firefox6](/buglist.cgi?f1=cf_tracking_firefox6&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox6&o1=equals&v1=%2B)
[tracking-firefox7](/buglist.cgi?f1=cf_tracking_firefox7&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox7&o1=equals&v1=%2B)

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=667507#a271760_12352)• 14 years ago |

[status-firefox6](/buglist.cgi?f1=cf_status_firefox6&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox6&o1=equals&v1=affected) → [unaffected](/buglist.cgi?f1=cf_status_firefox6&o1=equals&v1=unaffected)
[tracking-firefox6](/buglist.cgi?f1=cf_tracking_firefox6&o1=isnotempty):
[+](/buglist.cgi?f1=cf_tracking_firefox6&o1=equals&v1=%2B) → [-](/buglist.cgi?f1=cf_tracking_firefox6&o1=equals&v1=-)

|  | [Igor Bukanov](/user_profile?user_id=50763)  Assignee |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=667507#c3)• 14 years ago |
|  | |

Attached patch

[v1](attachment.cgi?id=543785&action=diff)
— [Details](attachment.cgi?id=543785&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=667507&attachment=543785)

When fixing [bug 657198](/show_bug.cgi?id=657198 "VERIFIED FIXED - TM: \"Assertion failure: shape->previous() == obj->lastProperty(),\" with gc") I have missed that under recording fragment's code is yet set. So my patch their ignored the recording fragment when scanning for GC things. This should fix the issue.
[Attachment #543785](/attachment.cgi?id=543785&action=edit "v1") -
Flags: review?(gal)

|  | [Andreas Gal :gal](/user_profile?user_id=310943) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=667507#c4)• 14 years ago |
|  | |

Comment on [attachment 543785](/attachment.cgi?id=543785 "v1") [[details]](/attachment.cgi?id=543785&action=edit "v1") [[diff]](/attachment.cgi?id=543785&action=diff "v1") [[review]](/page.cgi?id=splinter.html&ignore=&bug=667507&attachment=543785)
v1
IsFragmentGraphWithUnreachableGCThingImpl is a terrible name. At least take Impl off. How about ContainsUnrechableGCThing() ? r+ either way though. Try to pick a better name at your leisure.
[Attachment #543785](/attachment.cgi?id=543785&action=edit "v1") -
Flags: review?(gal) → review+

|  | [Igor Bukanov](/user_profile?user_id=50763)  Assignee |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=667507#c5)• 14 years ago |
|  | |

<http://hg.mozilla.org/integration/mozilla-inbound/rev/eb800178da45> - pushed with extra comments and the suggested name change.Whiteboard: [sg:critical?] → [sg:critical?] [inbound]

|  | [(no longer active)](/user_profile?user_id=251051) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=667507#c6)• 14 years ago |
|  | |

<http://hg.mozilla.org/mozilla-central/rev/eb800178da45>Status: NEW → RESOLVEDClosed: 14 years agoResolution: --- → FIXEDWhiteboard: [sg:critical?] [inbound] → [sg:critical?]Target Milestone: --- → mozilla8

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=667507#c7)• 13 years ago |
|  | |

Is this patch good for 7? If so, please request aurora approval.

|  | [Igor Bukanov](/user_profile?user_id=50763)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=667507#a3296290_50763)• 13 years ago |

[Attachment #543785](/attachment.cgi?id=543785&action=edit "v1") -
Flags: approval-mozilla-aurora?

|  | [LegNeato](/user_profile?user_id=482154) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=667507#c8)• 13 years ago |
|  | |

Comment on [attachment 543785](/attachment.cgi?id=543785 "v1") [[details]](/attachment.cgi?id=543785&action=edit "v1") [[diff]](/attachment.cgi?id=543785&action=diff "v1") [[review]](/page.cgi?id=splinter.html&ignore=&bug=667507&attachment=543785)
v1
Approved for releases/mozilla-aurora. Please land ASAP.
[Attachment #543785](/attachment.cgi?id=543785&action=edit "v1") -
Flags: approval-mozilla-aurora? → approval-mozilla-aurora+

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=667507#a3900657_1689)• 13 years ago |

Whiteboard: [sg:critical?] → [sg:critical?][needs aurora landing for Fx7]

|  | [David Mandelin [:dmandelin]](/user_profile?user_id=294323) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=667507#c9)• 13 years ago |
|  | |

<http://hg.mozilla.org/releases/mozilla-aurora/rev/a1adc68984e1>

|  | [David Mandelin [:dmandelin]](/user_profile?user_id=294323) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=667507#a3915352_294323)• 13 years ago |

[status-firefox7](/buglist.cgi?f1=cf_status_firefox7&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox7&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox7&o1=equals&v1=fixed)

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=667507#c10)• 13 years ago |
|  | |

Marking fixed for 7 now that this landed on Aurora!

|  | [LegNeato](/user_profile?user_id=482154) |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=667507#c11)• 13 years ago |
|  | |

Does this affect 1.9.2? If so we'll need to take it for 1.9.2.21

|  | [Igor Bukanov](/user_profile?user_id=50763)  Assignee |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=667507#c12)• 13 years ago |
|  | |

(In reply to Christian Legnitto [:LegNeato] from [comment #11](/show_bug.cgi?id=667507#c11 "VERIFIED FIXED - TM/JM: \"Assertion failure: shape->previous() == obj->lastProperty(),\" with gc"))
> Does this affect 1.9.2?
No - the bug is a regression from the [bug 657198](/show_bug.cgi?id=657198 "VERIFIED FIXED - TM: \"Assertion failure: shape->previous() == obj->lastProperty(),\" with gc") which is in turn a regression from the [bug 597736](/show_bug.cgi?id=597736 "RESOLVED FIXED - TM: TreeFragment leak"). And that bug (a leak) is wontfix for 1.9.2.

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=667507#a7164113_1689)• 13 years ago |

[status1.9.2](/buglist.cgi?f1=cf_status_192&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_192&o1=equals&v1=unaffected)

|  | [u279076](/user_profile?user_id=279076) |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=667507#c13)• 13 years ago |
|  | |

qa- as no QA fix verification neededWhiteboard: [sg:critical?][needs aurora landing for Fx7] → [sg:critical?][needs aurora landing for Fx7][qa-]

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=667507#a17803854_1689)• 13 years ago |

Group: core-security

|  | [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034)  Reporter |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=667507#c14)• 13 years ago |
|  | |

Test committed with fix, marking verified based on that.Status: RESOLVED → VERIFIEDFlags: in-testsuite+
You need to [log in](/show_bug.cgi?id=667507&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from www.mandriva.com_e0fb52a8_20250125_210146.html ===


* [Tuxedo.org](https://tuxedo.org/ "Go to: Tuxedo")
* Store
* Mandriva Linux
* Enterprise Solutions
* Contact Us
* Language ![](/sites/all/themes/mandriva_customer/images/arrow-grey-bottom.gif)
  + English (International)
  + Français
  + Ð ÑÑÑÐºÐ¸Ð¹

# [Mandriva](/mandriva/)

* Download
* Mandriva Linux
* Community
* Help

## One

### The Linux desktopthat's easy to try and easy to keep

Download
![Mandriva One](/sites/all/themes/mandriva_customer/images/front/packshot_Mandriva_One.png)

## Powerpack

### Mandriva Linux- and more

Download
![Mandriva Linux Powerpack](/sites/all/themes/mandriva_customer/images/front/en-49.png)

## Mandriva Flash

### The mobile and installable Linux desktopon a USB key

Buy on Store
![Mandriva Flash](/sites/all/themes/mandriva_customer/images/front/mandriva-flash2.png)

### [Community](community)

* User Forums
* Support - FAQ
* Free Software
* Become a member

### Enterprise Solutions

* Enterprise Linux Products
* Asset Management Solution
* Professional Services
* Support & Maintenance

* Go to site »

### Mandriva Partners

* Worldwide offices
* Partner Program
* Technology Partners
* OEM
* Classmate PC with Mandriva Linux

### News

* Mandriva presents the launch of its new mobile desktop: Mandriva Flash 2008 Spring
* Speaking about Mandriva Linux 2008 Spring in media
* Speaking about Mandriva Linux 2008 Spring in media
* Mandriva presents its latest distribution: Mandriva Linux 2008 Spring
* Mandriva and Novatice Technologies present Edutice, The ready to use solution dedicated to educationand multimedia spaces
* # [Top 50 Online Casinos UK in 2023](https://montycasinos.com/online-casinos/)

more

* Download
  + Mandriva Linux 2008
  + Writing an ISO image
* Mandriva Linux
  + One
  + Powerpack
  + Mandriva Flash
* Community
  + Start
  + Register
  + Stay informed
  + Participate
  + Free software
* Help
  + Getting help
  + Knowledge Base
  + Documentation
  + Forums
  + Support Requests
  + Customer Care
  + Enterprise Support
* Enterprise Solutions
  + Products
  + Support
  + Services
  + Partners
  + Go to site »

Language
English (International)
Français
Ð ÑÑÑÐºÐ¸Ð¹

* © 2007 Mandriva S.A.
* About Us
* Legal Information
* Privacy Policy
* Contact Us



=== Content from bugzilla.mozilla.org_2c45077a_20250125_210212.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/673757)
* [XML](/show_bug.cgi?ctype=xml&id=673757)

Closed
[Bug 673757](/show_bug.cgi?id=673757)

Opened 14 years ago
Closed 14 years ago

# Out-of-bounds array access in nsDocAccessible::CacheChildrenInSubtree

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Out-of-bounds array access in nsDocAccessible::CacheChildrenInSubtree

## Categories

### (Core :: Disability Access APIs, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=Disability%20Access%20APIs#Disability%20Access%20APIs)

Disability Access APIs
▾

Core :: Disability Access APIs
Description: This component relates to bugs in our support for accessibility APIs on the various platforms. Accessibility APIs allow 3rd party products, such as screen readers used by visually impaired users, to communicate with our content and UI. The APIs we support specifically are MSAA on Windows and
ATK on UNIX/Linux (Apple has not yet published specs for an accessibility API on OS X). This component is not for keyboard, focus or any accessibility bugs other than those relating to the APIs we export.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=Disability%20Access%20APIs&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=Disability%20Access%20APIs&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=Disability%20Access%20APIs)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

All

All

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

critical

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla8

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Accessibility Severity | --- |
| --- | --- |
| Webcompat Score | --- |
| Performance Impact | --- |
| a11y-review | --- |
| Webcompat Priority | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox5 | --- | [unaffected](/buglist.cgi?f1=cf_status_firefox5&o1=equals&v1=unaffected) |
| firefox6 | --- | [affected](/buglist.cgi?f1=cf_status_firefox6&o1=equals&v1=affected) |
| firefox7 | --- | [fixed](/buglist.cgi?f1=cf_status_firefox7&o1=equals&v1=fixed) |
| firefox8 | --- | [fixed](/buglist.cgi?f1=cf_status_firefox8&o1=equals&v1=fixed) |
| status2.0 | --- | [unaffected](/buglist.cgi?f1=cf_status_20&o1=equals&v1=unaffected) |
| status1.9.2 | --- | [unaffected](/buglist.cgi?f1=cf_status_192&o1=equals&v1=unaffected) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox5 |  | unaffected |
| firefox6 |  | affected |
| firefox7 |  | fixed |
| firefox8 |  | fixed |
| status2.0 |  | unaffected |
| status1.9.2 |  | unaffected |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: jruderman, Assigned: surkov)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/e675fc38177990b696f3b055d3a34c4a?d=mm&size=40)  [surkov](/user_profile?user_id=88369)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/d2dc9227eafcd0ec5ba3712ee4f19b75?d=mm&size=40)  [jruderman](/user_profile?user_id=11608)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/5405533dede5f504c103ccd0627c568b?d=mm&size=40)  [ayeddi](/user_profile?user_id=699708)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

9 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[343943](/show_bug.cgi?id=343943 "RESOLVED INACTIVE - [meta] HTML Element and Attribute fuzzer"), [659633](/show_bug.cgi?id=659633 "VERIFIED FIXED - Pseudo-hang when a XUL tree element is instantiated")

Dependency [tree](/showdependencytree.cgi?id=673757&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=673757)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[Duplicates:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#duplicates)

[680838](/show_bug.cgi?id=680838 "RESOLVED DUPLICATE - crash nsAccessNode::IsContent")

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (4 keywords, Whiteboard: [sg:critical?][qa-])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[assertion](/buglist.cgi?keywords=assertion&resolution=---),
[crash](/buglist.cgi?keywords=crash&resolution=---),
[regression](/buglist.cgi?keywords=regression&resolution=---),
[testcase](/buglist.cgi?keywords=testcase&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[sg:critical?][qa-]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [surkov](/user_profile?user_id=88369) | [in-testsuite](#c9 "14 years ago") | + |
| --- | --- | --- |
| [surkov](/user_profile?user_id=88369) | in-testsuite | + |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | qe-verify |  |

## Crash Data

Signature:

[[@ nsDocAccessible::CacheChildrenInSubtree ]](https://crash-stats.mozilla.org/signature/?signature=nsDocAccessible%3A%3ACacheChildrenInSubtree)

[[@ nsAccessNode::IsContent ]](https://crash-stats.mozilla.org/signature/?signature=nsAccessNode%3A%3AIsContent)

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (3 files, 3 obsolete files)

| [testcase (crashes Firefox when loaded, if accessibility is enabled)](/attachment.cgi?id=547987)  [14 years ago](#c0)  [Jesse Ruderman](/user_profile?user_id=11608)   161 bytes, text/html |  | [Details](/attachment.cgi?id=547987&action=edit) |
| --- | --- | --- |
| [stack traces](/attachment.cgi?id=547988)  [14 years ago](#c1)  [Jesse Ruderman](/user_profile?user_id=11608)   5.96 KB, text/plain |  | [Details](/attachment.cgi?id=547988&action=edit) |
| [patch](/attachment.cgi?id=548011)  [14 years ago](#c2)  [alexander :surkov (:asurkov)](/user_profile?user_id=88369)   8.00 KB, patch |  | [Details](/attachment.cgi?id=548011&action=edit) | [Diff](/attachment.cgi?id=548011&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=673757&attachment=548011) |
| [patch2](/attachment.cgi?id=548012)  [14 years ago](#c3)  [alexander :surkov (:asurkov)](/user_profile?user_id=88369)   10.46 KB, patch |  | [Details](/attachment.cgi?id=548012&action=edit) | [Diff](/attachment.cgi?id=548012&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=673757&attachment=548012) |
| [patch3](/attachment.cgi?id=548026)  [14 years ago](#c5)  [alexander :surkov (:asurkov)](/user_profile?user_id=88369)   10.46 KB, patch |  | [Details](/attachment.cgi?id=548026&action=edit) | [Diff](/attachment.cgi?id=548026&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=673757&attachment=548026) |
| [patch4](/attachment.cgi?id=548027)  [14 years ago](#c6)  [alexander :surkov (:asurkov)](/user_profile?user_id=88369)   8.26 KB, patch | tbsaunde : [review+](#c7 "14 years ago")  asa : [approval-mozilla-beta+](#a3160424_5003 "14 years ago") | [Details](/attachment.cgi?id=548027&action=edit) | [Diff](/attachment.cgi?id=548027&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=673757&attachment=548027) |

Show Obsolete

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Jesse Ruderman](/user_profile?user_id=11608)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=673757#c0)• 14 years ago |
|  | |

Attached file
[testcase (crashes Firefox when loaded, if accessibility is enabled)](attachment.cgi?id=547987)
— [Details](attachment.cgi?id=547987&action=edit)

1. Enable accessibility, e.g. by pasting the following into the js console:
Components.classes["@mozilla.org/accessibilityService;1"]
.getService(Components.interfaces.nsIAccessibleRetrieval);
2. Load the testcase.
Result: "ASSERTION: invalid array index" in nsTArray::ElementAt (nb: NOT SafeElementAt) followed by a crash [@ nsAccessNode::IsContent].
Both are called by nsDocAccessible::CacheChildrenInSubtree, so I assume that's closer to where the bug is.
In debug builds it usually crashes near 0x0, but in opt builds it's clearly exploitable ([bp-aad90a7b-4402-40f4-bd6d-92a4d2110724](https://crash-stats.mozilla.org/report/index/aad90a7b-4402-40f4-bd6d-92a4d2110724)).

|  | [Jesse Ruderman](/user_profile?user_id=11608)  Reporter |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=673757#c1)• 14 years ago |
|  | |

Attached file
[stack traces](attachment.cgi?id=547988)
— [Details](attachment.cgi?id=547988&action=edit)

|  | [alexander :surkov (:asurkov)](/user_profile?user_id=88369)  Assignee |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=673757#c2)• 14 years ago |
|  | |

Attached patch

[patch](attachment.cgi?id=548011&action=diff) (obsolete)
— [Details](attachment.cgi?id=548011&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=673757&attachment=548011)

the problem is the invalidation list processing alters the cached tree while its subtree is created.Assignee: nobody → surkov.alexanderStatus: NEW → ASSIGNED
[Attachment #548011](/attachment.cgi?id=548011&action=edit "patch") -
Flags: review?(trev.saunders)

|  | [alexander :surkov (:asurkov)](/user_profile?user_id=88369)  Assignee |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=673757#c3)• 14 years ago |
|  | |

Attached patch

[patch2](attachment.cgi?id=548012&action=diff) (obsolete)
— [Details](attachment.cgi?id=548012&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=673757&attachment=548012)

previous one is wrong (one of early versions)
[Attachment #548011](/attachment.cgi?id=548011&action=edit "patch") -
Attachment is obsolete: true
[Attachment #548011](/attachment.cgi?id=548011&action=edit "patch") -
Flags: review?(trev.saunders)
[Attachment #548012](/attachment.cgi?id=548012&action=edit "patch2") -
Flags: review?(trev.saunders)

|  | [alexander :surkov (:asurkov)](/user_profile?user_id=88369)  Assignee |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=673757#c4)• 14 years ago |
|  | |

regression from [bug 659633](/show_bug.cgi?id=659633 "VERIFIED FIXED - Pseudo-hang when a XUL tree element is instantiated") which bared problem, mozilla 7 and mozilla 6 are affected

|  | [alexander :surkov (:asurkov)](/user_profile?user_id=88369)  Assignee |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=673757#c5)• 14 years ago |
|  | |

Attached patch

[patch3](attachment.cgi?id=548026&action=diff) (obsolete)
— [Details](attachment.cgi?id=548026&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=673757&attachment=548026)

updated patch summary and name
[Attachment #548012](/attachment.cgi?id=548012&action=edit "patch2") -
Attachment is obsolete: true
[Attachment #548012](/attachment.cgi?id=548012&action=edit "patch2") -
Flags: review?(trev.saunders)
[Attachment #548026](/attachment.cgi?id=548026&action=edit "patch3") -
Flags: review?(trev.saunders)

|  | [alexander :surkov (:asurkov)](/user_profile?user_id=88369)  Assignee |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=673757#c6)• 14 years ago |
|  | |

Attached patch

[patch4](attachment.cgi?id=548027&action=diff)
— [Details](attachment.cgi?id=548027&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=673757&attachment=548027)

patch3 was wrong one, sorry for the spam
[Attachment #548026](/attachment.cgi?id=548026&action=edit "patch3") -
Attachment is obsolete: true
[Attachment #548026](/attachment.cgi?id=548026&action=edit "patch3") -
Flags: review?(trev.saunders)
[Attachment #548027](/attachment.cgi?id=548027&action=edit "patch4") -
Flags: review?(trev.saunders)

|  | [Trevor Saunders (:tbsaunde)](/user_profile?user_id=401086) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=673757#c7)• 14 years ago |
|  | |

Comment on [attachment 548027](/attachment.cgi?id=548027 "patch4") [[details]](/attachment.cgi?id=548027&action=edit "patch4") [[diff]](/attachment.cgi?id=548027&action=diff "patch4") [[review]](/page.cgi?id=splinter.html&ignore=&bug=673757&attachment=548027)
patch4
while doing a quick debug to understand this I noticed that xul menu buttons can cause accessibles to be removed while in CacheChildren() called by CacheChildrenInSubtree() we should look for other cases of this behavior, but this patch clearly gets rid of the worst way of this happening, and generally makes things better so r=me
[Attachment #548027](/attachment.cgi?id=548027&action=edit "patch4") -
Flags: review?(trev.saunders) → review+

|  | [Trevor Saunders (:tbsaunde)](/user_profile?user_id=401086) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=673757#c8)• 14 years ago |
|  | |

Comment on [attachment 548027](/attachment.cgi?id=548027 "patch4") [[details]](/attachment.cgi?id=548027&action=edit "patch4") [[diff]](/attachment.cgi?id=548027&action=diff "patch4") [[review]](/page.cgi?id=splinter.html&ignore=&bug=673757&attachment=548027)
patch4
requesting approval for aurora and beta per [comment 3](/show_bug.cgi?id=673757#c3 "RESOLVED FIXED - Out-of-bounds array access in nsDocAccessible::CacheChildrenInSubtree") saying they're effected and its possibly exploitable. I'm not sure how easy this would be to weaponize. since I suspect the only control of the address isthrough masaging the heap, and even if you can control the address I'm not sure the crash is trying to run code / get a vfunc from the address. However I'm willing to believe with a bit of work its likely doable. SO I think we want to ake this on aurora and beta.
[Attachment #548027](/attachment.cgi?id=548027&action=edit "patch4") -
Flags: approval-mozilla-beta?
[Attachment #548027](/attachment.cgi?id=548027&action=edit "patch4") -
Flags: approval-mozilla-aurora?

|  | [alexander :surkov (:asurkov)](/user_profile?user_id=88369)  Assignee |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=673757#c9)• 14 years ago |
|  | |

landed <http://hg.mozilla.org/mozilla-central/rev/4f38df646524>Status: ASSIGNED → RESOLVEDClosed: 14 years agoFlags: in-testsuite+Resolution: --- → FIXEDTarget Milestone: --- → mozilla8

|  | [alexander :surkov (:asurkov)](/user_profile?user_id=88369)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=673757#a71471_88369)• 14 years ago |

OS: Linux → AllHardware: x86\_64 → All

|  | [alexander :surkov (:asurkov)](/user_profile?user_id=88369)  Assignee |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=673757#c10)• 14 years ago |
|  | |

(In reply to [comment #7](/show_bug.cgi?id=673757#c7 "RESOLVED FIXED - Out-of-bounds array access in nsDocAccessible::CacheChildrenInSubtree"))
> Comment on [attachment 548027](/attachment.cgi?id=548027 "patch4") [[details]](/attachment.cgi?id=548027&action=edit "patch4") [[diff]](/attachment.cgi?id=548027&action=diff "patch4") [[review]](/page.cgi?id=splinter.html&ignore=&bug=673757&attachment=548027) [review]
> patch4
>
> while doing a quick debug to understand this I noticed that xul menu buttons
> can cause accessibles to be removed while in CacheChildren() called by
> CacheChildrenInSubtree()
Can you give me a stack because at quick glance I don't see how it can happen?

|  | [Trevor Saunders (:tbsaunde)](/user_profile?user_id=401086) |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=673757#c11)• 14 years ago |
|  | |

(In reply to [comment #10](/show_bug.cgi?id=673757#c10 "RESOLVED FIXED - Out-of-bounds array access in nsDocAccessible::CacheChildrenInSubtree"))
> (In reply to [comment #7](/show_bug.cgi?id=673757#c7 "RESOLVED FIXED - Out-of-bounds array access in nsDocAccessible::CacheChildrenInSubtree"))
> > Comment on [attachment 548027](/attachment.cgi?id=548027 "patch4") [[details]](/attachment.cgi?id=548027&action=edit "patch4") [[diff]](/attachment.cgi?id=548027&action=diff "patch4") [[review]](/page.cgi?id=splinter.html&ignore=&bug=673757&attachment=548027) [review] [review]
> > patch4
> >
> > while doing a quick debug to understand this I noticed that xul menu buttons
> > can cause accessibles to be removed while in CacheChildren() called by
> > CacheChildrenInSubtree()
>
> Can you give me a stack because at quick glance I don't see how it can
> happen?
I was talking about xul/nsXULFormcontrolAccesible.cpp:214Status: RESOLVED → UNCONFIRMEDEver confirmed: falseOS: All → LinuxHardware: All → x86\_64Resolution: FIXED → ---Target Milestone: mozilla8 → ---

|  | [alexander :surkov (:asurkov)](/user_profile?user_id=88369)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=673757#a79681_88369)• 14 years ago |

Status: UNCONFIRMED → RESOLVEDClosed: 14 years ago → 14 years agoOS: Linux → AllHardware: x86\_64 → AllResolution: --- → FIXEDTarget Milestone: --- → mozilla8

|  | [alexander :surkov (:asurkov)](/user_profile?user_id=88369)  Assignee |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=673757#c12)• 14 years ago |
|  | |

(In reply to [comment #11](/show_bug.cgi?id=673757#c11 "RESOLVED FIXED - Out-of-bounds array access in nsDocAccessible::CacheChildrenInSubtree"))
> I was talking about xul/nsXULFormcontrolAccesible.cpp:214
I assumed this line confuses you but my question isn't answered because this method doesn't change the tree explicitly, so that's why I asked for a stack.

|  | [Trevor Saunders (:tbsaunde)](/user_profile?user_id=401086) |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=673757#c13)• 14 years ago |
|  | |

(In reply to [comment #12](/show_bug.cgi?id=673757#c12 "RESOLVED FIXED - Out-of-bounds array access in nsDocAccessible::CacheChildrenInSubtree"))
> (In reply to [comment #11](/show_bug.cgi?id=673757#c11 "RESOLVED FIXED - Out-of-bounds array access in nsDocAccessible::CacheChildrenInSubtree"))
>
> > I was talking about xul/nsXULFormcontrolAccesible.cpp:214
>
> I assumed this line confuses you but my question isn't answered because this
> method doesn't change the tree explicitly, so that's why I asked for a stack.
OK

|  | [Marco Zehe (:MarcoZ)](/user_profile?user_id=285656) |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=673757#c14)• 14 years ago |
|  | |

I support the approval requests for Mozilla-Aurora and Mozilla-Beta. [Comment #4](/show_bug.cgi?id=673757#c4 "RESOLVED FIXED - Out-of-bounds array access in nsDocAccessible::CacheChildrenInSubtree") gives the explanation and bug that affects this one.

|  | [LegNeato](/user_profile?user_id=482154) |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=673757#c15)• 14 years ago |
|  | |

Comment on [attachment 548027](/attachment.cgi?id=548027 "patch4") [[details]](/attachment.cgi?id=548027&action=edit "patch4") [[diff]](/attachment.cgi?id=548027&action=diff "patch4") [[review]](/page.cgi?id=splinter.html&ignore=&bug=673757&attachment=548027)
patch4
We will not be taking this in beta as we are concerned about the risk. As this was internally found and the crashes are low we will wait for normal uplift to the beta channel
[Attachment #548027](/attachment.cgi?id=548027&action=edit "patch4") -
Flags: approval-mozilla-beta? → approval-mozilla-beta-

|  | [Asa Dotzler [:asa]](/user_profile?user_id=5003) |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=673757#c16)• 14 years ago |
|  | |

Alexander Surkov, would it be reasonable to back out the patch that exposed this rather than taking the rather large fix here?

|  | [alexander :surkov (:asurkov)](/user_profile?user_id=88369)  Assignee |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=673757#c17)• 13 years ago |
|  | |

(In reply to [comment #16](/show_bug.cgi?id=673757#c16 "RESOLVED FIXED - Out-of-bounds array access in nsDocAccessible::CacheChildrenInSubtree"))
> Alexander Surkov, would it be reasonable to back out the patch that exposed
> this rather than taking the rather large fix here?
I wouldn't back out [bug 659633](/show_bug.cgi?id=659633 "VERIFIED FIXED - Pseudo-hang when a XUL tree element is instantiated") because of Firefox bad reputation as a slow browser. For example, per report in [bug 659633](/show_bug.cgi?id=659633 "VERIFIED FIXED - Pseudo-hang when a XUL tree element is instantiated") AddBlock Plus extension makes Firefox hang for several seconds, also that bug can affect on pure Firefox in bookmarks dialog and about:config, i.e. whenever XUL tree is used and accessibility is enabled occasionally, also Thunderbird is affected.

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=673757#a396139_1689)• 13 years ago |

Blocks: [659633](/show_bug.cgi?id=659633 "VERIFIED FIXED - Pseudo-hang when a XUL tree element is instantiated")
[status2.0](/buglist.cgi?f1=cf_status_20&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_20&o1=equals&v1=unaffected)
[status-firefox5](/buglist.cgi?f1=cf_status_firefox5&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_firefox5&o1=equals&v1=unaffected)
[status-firefox6](/buglist.cgi?f1=cf_status_firefox6&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox6&o1=equals&v1=affected)
[status-firefox7](/buglist.cgi?f1=cf_status_firefox7&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox7&o1=equals&v1=affected)
[status-firefox8](/buglist.cgi?f1=cf_status_firefox8&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox8&o1=equals&v1=fixed)Keywords: [regression](/buglist.cgi?keywords=regression&resolution=---)Whiteboard: [sg:critical] → [sg:critical?]

|  | [Asa Dotzler [:asa]](/user_profile?user_id=5003) |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=673757#c18)• 13 years ago |
|  | |

Comment on [attachment 548027](/attachment.cgi?id=548027 "patch4") [[details]](/attachment.cgi?id=548027&action=edit "patch4") [[diff]](/attachment.cgi?id=548027&action=diff "patch4") [[review]](/page.cgi?id=splinter.html&ignore=&bug=673757&attachment=548027)
patch4
I don't think we want this kind of change landing this late in beta. We should either back out the change that opened up this crasher and security hole or we should live with it.
[Attachment #548027](/attachment.cgi?id=548027&action=edit "patch4") -
Flags: approval-mozilla-aurora? → approval-mozilla-aurora-

|  | [u217243](/user_profile?user_id=217243) |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=673757#c20)• 13 years ago |
|  | |

According to the reports, this crash is happening at our Mozilla Japan site.
<https://crash-stats.mozilla.com/report/index/eb6fa35a-637d-4657-b25f-5a2632110819>
I hope this would get fixed in Beta = Firefox 7.

|  | [Asa Dotzler [:asa]](/user_profile?user_id=5003) |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=673757#c21)• 13 years ago |
|  | |

Comment on [attachment 548027](/attachment.cgi?id=548027 "patch4") [[details]](/attachment.cgi?id=548027&action=edit "patch4") [[diff]](/attachment.cgi?id=548027&action=diff "patch4") [[review]](/page.cgi?id=splinter.html&ignore=&bug=673757&attachment=548027)
patch4
Kohei sent email to release drivers asking us to re-consider this because it crashes at mozilla.jp and may crash at mozilla.com:
"We've heard some users are encountering crash on the Mozilla Japan site (mozilla.jp) with Firefox 6 and came down to this bug.... As the portion of our WAI-ARIA implementation has been ported to mozilla.com, the same crash potentially occur on mozilla.com."
I'm reverting the minus back to a question mark for aurora and beta so Release Drivers will re-evaluate.
[Attachment #548027](/attachment.cgi?id=548027&action=edit "patch4") -
Flags: approval-mozilla-beta?
[Attachment #548027](/attachment.cgi?id=548027&action=edit "patch4") -
Flags: approval-mozilla-beta-
[Attachment #548027](/attachment.cgi?id=548027&action=edit "patch4") -
Flags: approval-mozilla-aurora?
[Attachment #548027](/attachment.cgi?id=548027&action=edit "patch4") -
Flags: approval-mozilla-aurora-

|  | [David Bolter [:davidb] (NeedInfo me for attention)](/user_profile?user_id=152868) |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=673757#c22)• 13 years ago |
|  | |

Comment on [attachment 548027](/attachment.cgi?id=548027 "patch4") [[details]](/attachment.cgi?id=548027&action=edit "patch4") [[diff]](/attachment.cgi?id=548027&action=diff "patch4") [[review]](/page.cgi?id=splinter.html&ignore=&bug=673757&attachment=548027)
patch4
Un-asking for aurora approval since this fix is already in current aurora (FF8) -- am I correct in doing this?
Alexander, Trevor, if you can please add opinions here on potential risks taking this patch in beta.
[Attachment #548027](/attachment.cgi?id=548027&action=edit "patch4") -
Flags: approval-mozilla-aurora?

|  | [alexander :surkov (:asurkov)](/user_profile?user_id=88369)  Assignee |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=673757#c23)• 13 years ago |
|  | |

(In reply to David Bolter [:davidb] from [comment #22](/show_bug.cgi?id=673757#c22 "RESOLVED FIXED - Out-of-bounds array access in nsDocAccessible::CacheChildrenInSubtree"))
> Alexander, Trevor, if you can please add opinions here on potential risks
> taking this patch in beta.
It's potentially risky because it touches core stuffs (accessible tree creation/invalidation). The same time I'm sure the patch is correct. The patch was on trunk and aurora for a while and there's no known regressions caused by it. That makes me think we won't get any regressions until we release (because a11y doesn't have strong alpha/beta testing community, basically all we have is QA), so my thumb up to port it to beta to make release closer.

|  | [Asa Dotzler [:asa]](/user_profile?user_id=5003) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=673757#a3160424_5003)• 13 years ago |

[Attachment #548027](/attachment.cgi?id=548027&action=edit "patch4") -
Flags: approval-mozilla-beta? → approval-mozilla-beta+

|  | [Marco Zehe (:MarcoZ)](/user_profile?user_id=285656) |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=673757#c24)• 13 years ago |
|  | |

Landed on mozilla-beta: <http://hg.mozilla.org/releases/mozilla-beta/rev/455584906d41> (sorry I messed up a bit during qrefresh to add the approval info, accidentally omitted the bug number :( ).
[status-firefox7](/buglist.cgi?f1=cf_status_firefox7&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox7&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox7&o1=equals&v1=fixed)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=673757#a4867555_1689)• 13 years ago |

Crash Signature: [@ nsDocAccessible::CacheChildrenInSubtree]
[@ nsAccessNode::IsContent] → [@ nsDocAccessible::CacheChildrenInSubtree ]
[@ nsAccessNode::IsContent ]
[status1.9.2](/buglist.cgi?f1=cf_status_192&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_192&o1=equals&v1=unaffected)

|  | [u279076](/user_profile?user_id=279076) |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=673757#c25)• 13 years ago |
|  | |

qa- as no QA fix verification neededWhiteboard: [sg:critical?] → [sg:critical?][qa-]

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=673757#a15505491_1689)• 13 years ago |

Group: core-security
You need to [log in](/show_bug.cgi?id=673757&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Jesse Ruderman](/user_profile?user_id=11608)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from bugzilla.mozilla.org_8d081638_20250126_115544.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Sun Jan 26 2025 03:55:43 PST

* **Bug ID:**
  672436,
  667011,
  671756,
  657198,
  667507,
  658864,
  661567,
  664930,
  668941,
  669228,
  670319,
  673757,
  678818,
  552002

---

14 bugs found.

| [ID](/buglist.cgi?bug_id=672436%2C667011%2C671756%2C657198%2C667507%2C658864%2C661567%2C664930%2C668941%2C669228%2C670319%2C673757%2C678818%2C552002&query_format=advanced&order=bug_id%20DESC&query_based_on=) | [Type](/buglist.cgi?bug_id=672436%2C667011%2C671756%2C657198%2C667507%2C658864%2C661567%2C664930%2C668941%2C669228%2C670319%2C673757%2C678818%2C552002&query_format=advanced&order=bug_type%2Cbug_status%2Cpriority%2Cassigned_to%2Cbug_id&query_based_on=) | [Summary](/buglist.cgi?bug_id=672436%2C667011%2C671756%2C657198%2C667507%2C658864%2C661567%2C664930%2C668941%2C669228%2C670319%2C673757%2C678818%2C552002&query_format=advanced&order=short_desc%2Cbug_status%2Cpriority%2Cassigned_to%2Cbug_id&query_based_on=) | [Product](/buglist.cgi?bug_id=672436%2C667011%2C671756%2C657198%2C667507%2C658864%2C661567%2C664930%2C668941%2C669228%2C670319%2C673757%2C678818%2C552002&query_format=advanced&order=product%2Cbug_status%2Cpriority%2Cassigned_to%2Cbug_id&query_based_on=) | [Comp](/buglist.cgi?bug_id=672436%2C667011%2C671756%2C657198%2C667507%2C658864%2C661567%2C664930%2C668941%2C669228%2C670319%2C673757%2C678818%2C552002&query_format=advanced&order=component%2Cbug_status%2Cpriority%2Cassigned_to%2Cbug_id&query_based_on=) | [Assignee▲](/buglist.cgi?bug_id=672436%2C667011%2C671756%2C657198%2C667507%2C658864%2C661567%2C664930%2C668941%2C669228%2C670319%2C673757%2C678818%2C552002&query_format=advanced&order=assigned_to%20DESC%2Cbug_status%2Cpriority%2Cbug_id&query_based_on=) | [Status▲](/buglist.cgi?bug_id=672436%2C667011%2C671756%2C657198%2C667507%2C658864%2C661567%2C664930%2C668941%2C669228%2C670319%2C673757%2C678818%2C552002&query_format=advanced&order=bug_status%20DESC%2Cpriority%2Cassigned_to%2Cbug_id&query_based_on=) | [Resolution](/buglist.cgi?bug_id=672436%2C667011%2C671756%2C657198%2C667507%2C658864%2C661567%2C664930%2C668941%2C669228%2C670319%2C673757%2C678818%2C552002&query_format=advanced&order=resolution%2Cbug_status%2Cpriority%2Cassigned_to%2Cbug_id&query_based_on=) | [Updated](/buglist.cgi?bug_id=672436%2C667011%2C671756%2C657198%2C667507%2C658864%2C661567%2C664930%2C668941%2C669228%2C670319%2C673757%2C678818%2C552002&query_format=advanced&order=changeddate%2Cbug_status%2Cpriority%2Cassigned_to%2Cbug_id&query_based_on=) |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |
| [667011](/show_bug.cgi?id=667011 "RESOLVED FIXED - WeakMap values can be incorrectly classified as garbage by cycle collector") |  | [WeakMap values can be incorrectly classified as garbage by cycle collector](/show_bug.cgi?id=667011) | Core | XPConnect | continuation | RESO | FIXE | 2011-09-22 |
| [678818](/show_bug.cgi?id=678818 "RESOLVED FIXED - \"ASSERTION: Window still registered with device motion\" and crash") |  | ["ASSERTION: Window still registered with device motion" and crash](/show_bug.cgi?id=678818) | Core | DOM: Events | doug.turner | RESO | FIXE | 2012-01-19 |
| [658864](/show_bug.cgi?id=658864 "RESOLVED FIXED - The GC can still happen when reporting OOM") |  | [The GC can still happen when reporting OOM](/show_bug.cgi?id=658864) | Core | JavaScript Engine | igor | RESO | FIXE | 2011-11-15 |
| [661567](/show_bug.cgi?id=661567 "RESOLVED FIXED - WeakMap uses a ContextAllocPolicy, should use a SystemAllocPolicy") |  | [WeakMap uses a ContextAllocPolicy, should use a SystemAllocPolicy](/show_bug.cgi?id=661567) | Core | JavaScript Engine | jimb | RESO | FIXE | 2013-12-27 |
| [672436](/show_bug.cgi?id=672436 "RESOLVED FIXED - Assertion failure: priv->stackElems + stackDepth == elem") |  | [Assertion failure: priv->stackElems + stackDepth == elem](/show_bug.cgi?id=672436) | Core | JavaScript Engine | mail | RESO | FIXE | 2015-10-16 |
| [669228](/show_bug.cgi?id=669228 "RESOLVED FIXED - Crash with InstallTrigger, mozRequestAnimationFrame, throwing proxy") |  | [Crash with InstallTrigger, mozRequestAnimationFrame, throwing proxy](/show_bug.cgi?id=669228) | Core | XPConnect | mrbkap | RESO | FIXE | 2013-12-27 |
| [670319](/show_bug.cgi?id=670319 "RESOLVED FIXED - \"ASSERTION: function object has parent of unknown class\"") |  | ["ASSERTION: function object has parent of unknown class"](/show_bug.cgi?id=670319) | Core | XPConnect | mrbkap | RESO | FIXE | 2012-01-19 |
| [552002](/show_bug.cgi?id=552002 "RESOLVED FIXED - Crash in [@ nsDOMEvent::QueryInterface(nsID const&, void**) ]") |  | [Crash in [@ nsDOMEvent::QueryInterface(nsID const&, void\*\*) ]](/show_bug.cgi?id=552002) | Core Graveyard | Plug-ins | nobody | RESO | FIXE | 2022-05-16 |
| [671756](/show_bug.cgi?id=671756 "RESOLVED FIXED - crash via mozilla::gl::GLContext::UploadSurfaceToTexture on mac playing a video") |  | [crash via mozilla::gl::GLContext::UploadSurfaceToTexture on mac playing a video](/show_bug.cgi?id=671756) | Core | Graphics | nobody | RESO | FIXE | 2011-09-22 |
| [668941](/show_bug.cgi?id=668941 "RESOLVED FIXED - \"ASSERTION: frame crosses fixed continuation boundary\" with rtl, pre-wrap, :first-letter") |  | ["ASSERTION: frame crosses fixed continuation boundary" with rtl, pre-wrap, :first-letter](/show_bug.cgi?id=668941) | Core | Layout: Text and Fon | smontagu | RESO | FIXE | 2013-12-27 |
| [673757](/show_bug.cgi?id=673757 "RESOLVED FIXED - Out-of-bounds array access in nsDocAccessible::CacheChildrenInSubtree") |  | [Out-of-bounds array access in nsDocAccessible::CacheChildrenInSubtree](/show_bug.cgi?id=673757) | Core | Disability Access AP | surkov.alexander | RESO | FIXE | 2013-12-27 |
| [657198](/show_bug.cgi?id=657198 "VERIFIED FIXED - TM: \"Assertion failure: shape->previous() == obj->lastProperty(),\" with gc") |  | [TM: "Assertion failure: shape->previous() == obj->lastProperty()," with gc](/show_bug.cgi?id=657198) | Core | JavaScript Engine | igor | VERI | FIXE | 2013-02-25 |
| [667507](/show_bug.cgi?id=667507 "VERIFIED FIXED - TM/JM: \"Assertion failure: shape->previous() == obj->lastProperty(),\" with gc") |  | [TM/JM: "Assertion failure: shape->previous() == obj->lastProperty()," with gc](/show_bug.cgi?id=667507) | Core | JavaScript Engine | igor | VERI | FIXE | 2012-03-23 |
| [664930](/show_bug.cgi?id=664930 "VERIFIED FIXED - Crash [@ _cairo_bentley_ottmann_tessellate_rectangular]") |  | [Crash [@ \_cairo\_bentley\_ottmann\_tessellate\_rectangular]](/show_bug.cgi?id=664930) | Core | Graphics | jmuizelaar | VERI | FIXE | 2012-01-19 |

14 bugs found.

|  |  | [REST](/rest/bug?include_fields=id,summary,status&bug_id=672436%2C667011%2C671756%2C657198%2C667507%2C658864%2C661567%2C664930%2C668941%2C669228%2C670319%2C673757%2C678818%2C552002 "Query as a REST API request") | [CSV](/buglist.cgi?bug_id=672436%2C667011%2C671756%2C657198%2C667507%2C658864%2C661567%2C664930%2C668941%2C669228%2C670319%2C673757%2C678818%2C552002&query_format=advanced&ctype=csv&human=1) | [Feed](/buglist.cgi?bug_id=672436%2C667011%2C671756%2C657198%2C667507%2C658864%2C661567%2C664930%2C668941%2C669228%2C670319%2C673757%2C678818%2C552002&query_format=advanced&title=Bug%20List&ctype=atom) | [iCalendar](/buglist.cgi?bug_id=672436%2C667011%2C671756%2C657198%2C667507%2C658864%2C661567%2C664930%2C668941%2C669228%2C670319%2C673757%2C678818%2C552002&query_format=advanced&ctype=ics)  [Change Columns](/colchange.cgi?bug_id=672436%2C667011%2C671756%2C657198%2C667507%2C658864%2C661567%2C664930%2C668941%2C669228%2C670319%2C673757%2C678818%2C552002&query_format=advanced&query_based_on=) | [Edit Search](/query.cgi?bug_id=672436%2C667011%2C671756%2C657198%2C667507%2C658864%2C661567%2C664930%2C668941%2C669228%2C670319%2C673757%2C678818%2C552002&query_format=advanced) |  | as |
| --- | --- | --- | --- | --- | --- |



=== Content from bugzilla.mozilla.org_0b506d3a_20250125_210155.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/657198)
* [XML](/show_bug.cgi?ctype=xml&id=657198)

Closed
[Bug 657198](/show_bug.cgi?id=657198)

Opened 14 years ago
Closed 14 years ago

# TM: "Assertion failure: shape->previous() == obj->lastProperty()," with gc

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

TM: "Assertion failure: shape->previous() == obj->lastProperty()," with gc

## Categories

### (Core :: JavaScript Engine, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=JavaScript%20Engine#JavaScript%20Engine)

JavaScript Engine
▾

Core :: JavaScript Engine
The interpreter engine for the core JavaScript language, independent of the browser's object model. File ONLY core JavaScript language bugs in this category. For bugs involving browser objects such as "window" and "document", use the "DOM" component. For bugs involving calls between JavaScript and C++, use the "XPConnect" component.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=JavaScript%20Engine&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=JavaScript%20Engine&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=JavaScript%20Engine)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

x86

macOS

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

critical

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

---

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Performance Impact | --- |
| --- | --- |
| Webcompat Score | --- |
| a11y-review | --- |
| Webcompat Priority | --- |
| Accessibility Severity | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox5 | [-](/buglist.cgi?f1=cf_tracking_firefox5&o1=equals&v1=-) | [wontfix](/buglist.cgi?f1=cf_status_firefox5&o1=equals&v1=wontfix) |
| firefox6 | [-](/buglist.cgi?f1=cf_tracking_firefox6&o1=equals&v1=-) | [wontfix](/buglist.cgi?f1=cf_status_firefox6&o1=equals&v1=wontfix) |
| firefox7 | [+](/buglist.cgi?f1=cf_tracking_firefox7&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox7&o1=equals&v1=fixed) |
| blocking2.0 | --- | [-](/buglist.cgi?f1=cf_blocking_20&o1=equals&v1=-) |
| status2.0 | --- | [wanted](/buglist.cgi?f1=cf_status_20&o1=equals&v1=wanted) |
| status1.9.2 | --- | [unaffected](/buglist.cgi?f1=cf_status_192&o1=equals&v1=unaffected) |
| status1.9.1 | --- | [unaffected](/buglist.cgi?f1=cf_status_191&o1=equals&v1=unaffected) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox5 | - | wontfix |
| firefox6 | - | wontfix |
| firefox7 | + | fixed |
| blocking2.0 |  | - |
| status2.0 |  | wanted |
| status1.9.2 |  | unaffected |
| relnote-firefox |  | --- |
| status1.9.1 |  | unaffected |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: gkw, Assigned: igor)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/78556976aa7c7e7980d6865f27df11b8?d=mm&size=40)  [igor](/user_profile?user_id=50763)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](extensions/Gravatar/web/default.jpg)  [gkw](/user_profile?user_id=132034)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/4fe52ee1503aecf7b6c976b8eb7c1753?d=mm&size=40)  [willyelm](/user_profile?user_id=714609)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

11 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

[667507](/show_bug.cgi?id=667507 "VERIFIED FIXED - TM/JM: \"Assertion failure: shape->previous() == obj->lastProperty(),\" with gc"), [697155](/show_bug.cgi?id=697155 "VERIFIED WONTFIX - TM: \"Assertion failure: shape->previous() == obj->lastProperty(),\" with gc")

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[597736](/show_bug.cgi?id=597736 "RESOLVED FIXED - TM: TreeFragment leak"), [630996](/show_bug.cgi?id=630996 "RESOLVED FIXED - A tool for stress testing objects and PIC's")

Dependency [tree](/showdependencytree.cgi?id=657198&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=657198)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: assertion, regression, testcase, Whiteboard: [ccbr][sg:critical?] fixed-in-tracemonkey [qa-])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[assertion](/buglist.cgi?keywords=assertion&resolution=---),
[regression](/buglist.cgi?keywords=regression&resolution=---),
[testcase](/buglist.cgi?keywords=testcase&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[ccbr][sg:critical?] fixed-in-tracemonkey [qa-]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [decoder](/user_profile?user_id=395101) | [in-testsuite](#c28 "14 years ago") | - |
| --- | --- | --- |
| [decoder](/user_profile?user_id=395101) | in-testsuite | - |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (2 files, 1 obsolete file)

| [stack](/attachment.cgi?id=532498)  [14 years ago](#c0)  [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034)   3.46 KB, text/plain |  | [Details](/attachment.cgi?id=532498&action=edit) |
| --- | --- | --- |
| [v1](/attachment.cgi?id=535498)  [14 years ago](#c12)  [Igor Bukanov](/user_profile?user_id=50763)   2.15 KB, patch |  | [Details](/attachment.cgi?id=535498&action=edit) | [Diff](/attachment.cgi?id=535498&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=657198&attachment=535498) |
| [v2](/attachment.cgi?id=541428)  [14 years ago](#c16)  [Igor Bukanov](/user_profile?user_id=50763)   8.16 KB, patch | gal : [review+](#a3415863_310943 "14 years ago") | [Details](/attachment.cgi?id=541428&action=edit) | [Diff](/attachment.cgi?id=541428&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=657198&attachment=541428) |

Show Obsolete

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=657198#c0)• 14 years ago |
|  | |

Attached file
[stack](attachment.cgi?id=532498)
— [Details](attachment.cgi?id=532498&action=edit)

eval("")
o15 = {}
function f11(o) {
props = Object.getOwnPropertyNames(o)
prop = props.length ? prop[prop.e] + "" : ""
o[prop] = 3
}
function f12(o) {
\_someglobal\_ = o;
for (j = 0; j < 5; j++) {
for (x in {
x: {
x: function() {
return \_someglobal\_
}
}.x()
}.x) {
({
x: {
x: function() {}
}.x()
}[x])
}
gc()
}
} {
for (i = 0; i < 100; i++) {
f12(o15)
f11(o15)
}
}
asserts js debug shell on TM changeset 599d1c6cba63 with -j at Assertion failure: shape->previous() == obj->lastProperty(), setting s-s just-in-case because this involves gc.
autoBisect shows this is probably related to the following changeset:
The first bad revision is:
changeset: 54718:b079aae53212
user: Igor Bukanov
date: Tue Sep 21 14:58:19 2010 +0200
summary: [bug 597736](/show_bug.cgi?id=597736 "RESOLVED FIXED - TM: TreeFragment leak") - fixing TreeFragment leak. r=gal

|  | [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034)  Reporter |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=657198#c1)• 14 years ago |
|  | |

Assuming [sg:critical?] unless otherwise known.blocking2.0: --- → ?
[tracking-firefox5](/buglist.cgi?f1=cf_tracking_firefox5&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox5&o1=equals&v1=%3F)
[tracking-firefox6](/buglist.cgi?f1=cf_tracking_firefox6&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox6&o1=equals&v1=%3F)Whiteboard: [ccbr][sg:critical?]

|  | [Igor Bukanov](/user_profile?user_id=50763)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=657198#a9730_50763)• 14 years ago |

Assignee: general → igor

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=657198#c2)• 14 years ago |
|  | |

We might take this in Fx5 if we get a safe patch, but likely the next release since we're already in the beta period.blocking2.0: ? → -
[status1.9.1](/buglist.cgi?f1=cf_status_191&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_191&o1=equals&v1=unaffected)
[status1.9.2](/buglist.cgi?f1=cf_status_192&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_192&o1=equals&v1=unaffected)
[status2.0](/buglist.cgi?f1=cf_status_20&o1=isnotempty):
--- → [wanted](/buglist.cgi?f1=cf_status_20&o1=equals&v1=wanted)
[status-firefox5](/buglist.cgi?f1=cf_status_firefox5&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox5&o1=equals&v1=affected)
[tracking-firefox5](/buglist.cgi?f1=cf_tracking_firefox5&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox5&o1=equals&v1=%3F) → [-](/buglist.cgi?f1=cf_tracking_firefox5&o1=equals&v1=-)
[tracking-firefox6](/buglist.cgi?f1=cf_tracking_firefox6&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox6&o1=equals&v1=%3F) → [+](/buglist.cgi?f1=cf_tracking_firefox6&o1=equals&v1=%2B)

|  | [Igor Bukanov](/user_profile?user_id=50763)  Assignee |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=657198#c3)• 14 years ago |
|  | |

I cannot reproduce this on TM tip with 64 bit Linux and GCC 4.4, apparently the changeset
changeset: 58554:52d20032116a
user: Jason Orendorff <jorendorff@mozilla.com>
date: Thu Dec 09 12:04:35 2010 -0600
summary: [Bug 614051](/show_bug.cgi?id=614051 "RESOLVED FIXED - TM: wrong behavior setting existing properties to joined function object values again") - TM: wrong behavior setting existing properties to joined function object values again. r=brendan.
fixes the bug.

|  | [Igor Bukanov](/user_profile?user_id=50763)  Assignee |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=657198#c4)• 14 years ago |
|  | |

Gary: on what platform do you see the crash with TM tip?

|  | [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034)  Reporter |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=657198#c5)• 14 years ago |
|  | |

(In reply to [comment #4](/show_bug.cgi?id=657198#c4 "VERIFIED FIXED - TM: \"Assertion failure: shape->previous() == obj->lastProperty(),\" with gc"))
> Gary: on what platform do you see the crash with TM tip?
Still asserts for me on TM changeset dba38247d691 with -j on a 32-bit js debug shell on Mac OS X 10.6 at Assertion failure: shape->previous() == obj->lastProperty()

|  | [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034)  Reporter |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=657198#c6)• 14 years ago |
|  | |

A 64-bit js shell off JM changeset 4c7ebbb52876 with -j on Mac also asserts identically.

|  | [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034)  Reporter |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=657198#c7)• 14 years ago |
|  | |

(In reply to [comment #6](/show_bug.cgi?id=657198#c6 "VERIFIED FIXED - TM: \"Assertion failure: shape->previous() == obj->lastProperty(),\" with gc"))
> A 64-bit js shell off JM changeset 4c7ebbb52876 with -j on Mac also asserts
> identically.
So does a 32-bit js shell off the same changeset with -j on Linux using gcc 4.5.2 (Ubuntu Linux 11.04).

|  | [Jesse Ruderman](/user_profile?user_id=11608) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=657198#c8)• 14 years ago |
|  | |

I can reproduce on TM tip (rev 6c5ed6692f96, Mac OS X 10.6, 64-bit).

|  | [David Mandelin [:dmandelin]](/user_profile?user_id=294323) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=657198#c9)• 14 years ago |
|  | |

Igor, can you reproduce this with a 32-bit Linux build?

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=657198#a1002960_12352)• 14 years ago |

[status-firefox6](/buglist.cgi?f1=cf_status_firefox6&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox6&o1=equals&v1=affected)
[status-firefox7](/buglist.cgi?f1=cf_status_firefox7&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox7&o1=equals&v1=affected)
[tracking-firefox7](/buglist.cgi?f1=cf_tracking_firefox7&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox7&o1=equals&v1=%2B)

|  | [Igor Bukanov](/user_profile?user_id=50763)  Assignee |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=657198#c10)• 14 years ago |
|  | |

(In reply to [comment #9](/show_bug.cgi?id=657198#c9 "VERIFIED FIXED - TM: \"Assertion failure: shape->previous() == obj->lastProperty(),\" with gc"))
> Igor, can you reproduce this with a 32-bit Linux build?
Yes.

|  | [Igor Bukanov](/user_profile?user_id=50763)  Assignee |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=657198#c11)• 14 years ago |
|  | |

What happens is that for some reason TraceMonitor::sweep() does not remove all the traces that contain a dead shape. Investigating.

|  | [Igor Bukanov](/user_profile?user_id=50763)  Assignee |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=657198#c12)• 14 years ago |
|  | |

Attached patch

[v1](attachment.cgi?id=535498&action=diff) (obsolete)
— [Details](attachment.cgi?id=535498&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=657198&attachment=535498)

When implementing HasUnreachableGCThings I have missed that we must search the whole tree for GC things, not just the tree root.
[Attachment #535498](/attachment.cgi?id=535498&action=edit "v1") -
Flags: review?(gal)

|  | [Igor Bukanov](/user_profile?user_id=50763)  Assignee |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=657198#c13)• 14 years ago |
|  | |

Comment on [attachment 535498](/attachment.cgi?id=535498 "v1") [[details]](/attachment.cgi?id=535498&action=edit "v1") [[diff]](/attachment.cgi?id=535498&action=diff "v1") [[review]](/page.cgi?id=splinter.html&ignore=&bug=657198&attachment=535498)
v1
The patch is bogus and lead to infinite recursion in HasUnreachableGCThings as dependent/linked tree may point back to the original tree fragment.
[Attachment #535498](/attachment.cgi?id=535498&action=edit "v1") -
Attachment is obsolete: true
[Attachment #535498](/attachment.cgi?id=535498&action=edit "v1") -
Flags: review?(gal)

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=657198#c14)• 14 years ago |
|  | |

Igor, any updates on a new patch for this?

|  | [Igor Bukanov](/user_profile?user_id=50763)  Assignee |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=657198#c15)• 14 years ago |
|  | |

(In reply to [comment #14](/show_bug.cgi?id=657198#c14 "VERIFIED FIXED - TM: \"Assertion failure: shape->previous() == obj->lastProperty(),\" with gc"))
> Igor, any updates on a new patch for this?
Sorry, but I could not make it before 2011-06-15 as I need to travel for personal reasons and will be mostly offline until 2011-06-14.

|  | [Igor Bukanov](/user_profile?user_id=50763)  Assignee |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=657198#c16)• 14 years ago |
|  | |

Attached patch

[v2](attachment.cgi?id=541428&action=diff)
— [Details](attachment.cgi?id=541428&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=657198&attachment=541428)

The new version navigates the whole trace tree searching for dead GC things. To detect cycles in the linked traces the patch adds a flag per fragment that is cleared after the trace is visited.
It is possible to minimize the number if times a trace fragment is visited, but that complicates the code and I opted for simplicity here.
[Attachment #541428](/attachment.cgi?id=541428&action=edit "v2") -
Flags: review?(gal)

|  | [Andreas Gal :gal](/user_profile?user_id=310943) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=657198#a3415863_310943)• 14 years ago |

[Attachment #541428](/attachment.cgi?id=541428&action=edit "v2") -
Flags: review?(gal) → review+

|  | [Igor Bukanov](/user_profile?user_id=50763)  Assignee |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=657198#c17)• 14 years ago |
|  | |

<http://hg.mozilla.org/tracemonkey/rev/dc137da5a3b4>Whiteboard: [ccbr][sg:critical?] → [ccbr][sg:critical?] fixed-in-tracemonkey

|  | [Igor Bukanov](/user_profile?user_id=50763)  Assignee |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=657198#c18)• 14 years ago |
|  | |

(In reply to [comment #17](/show_bug.cgi?id=657198#c17 "VERIFIED FIXED - TM: \"Assertion failure: shape->previous() == obj->lastProperty(),\" with gc"))
> <http://hg.mozilla.org/tracemonkey/rev/dc137da5a3b4>
This is landed without the test case. Do we have a way to flag the bug to add the test case when FF with the fix is released?

|  | [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=657198#a3472888_132034)• 14 years ago |

Flags: in-testsuite?

|  | [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=657198#a3754606_132034)• 14 years ago |

Depends on: [667507](/show_bug.cgi?id=667507 "VERIFIED FIXED - TM/JM: \"Assertion failure: shape->previous() == obj->lastProperty(),\" with gc")

|  | [Chris Leary [:cdleary] (not checking bugmail)](/user_profile?user_id=374575) |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=657198#c19)• 14 years ago |
|  | |

cdleary-bot mozilla-central merge info:
<http://hg.mozilla.org/mozilla-central/rev/dc137da5a3b4>

|  | [Chris Leary [:cdleary] (not checking bugmail)](/user_profile?user_id=374575) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=657198#a3759605_374575)• 14 years ago |

Status: NEW → RESOLVEDClosed: 14 years agoResolution: --- → FIXED

|  | [David Mandelin [:dmandelin]](/user_profile?user_id=294323) |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=657198#c20)• 14 years ago |
|  | |

(In reply to [comment #18](/show_bug.cgi?id=657198#c18 "VERIFIED FIXED - TM: \"Assertion failure: shape->previous() == obj->lastProperty(),\" with gc"))
> (In reply to [comment #17](/show_bug.cgi?id=657198#c17 "VERIFIED FIXED - TM: \"Assertion failure: shape->previous() == obj->lastProperty(),\" with gc"))
> > <http://hg.mozilla.org/tracemonkey/rev/dc137da5a3b4>
>
> This is landed without the test case. Do we have a way to flag the bug to
> add the test case when FF with the fix is released?
That's a good question. I don't think we have a convenient way to track things like that. Do we?

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=657198#c21)• 14 years ago |
|  | |

Can the fix for this land for 6? If so, please request approval for beta!
[status-firefox5](/buglist.cgi?f1=cf_status_firefox5&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox5&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox5&o1=equals&v1=wontfix)
[status-firefox7](/buglist.cgi?f1=cf_status_firefox7&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox7&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox7&o1=equals&v1=fixed)

|  | [Igor Bukanov](/user_profile?user_id=50763)  Assignee |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=657198#c22)• 14 years ago |
|  | |

(In reply to [comment #21](/show_bug.cgi?id=657198#c21 "VERIFIED FIXED - TM: \"Assertion failure: shape->previous() == obj->lastProperty(),\" with gc"))
> Can the fix for this land for 6? If so, please request approval for beta!
I need to land the [bug 667507](/show_bug.cgi?id=667507 "VERIFIED FIXED - TM/JM: \"Assertion failure: shape->previous() == obj->lastProperty(),\" with gc") first as the patch here introduced a regression.

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=657198#c23)• 14 years ago |
|  | |

Seems unlikely we'd get [bug 667507](/show_bug.cgi?id=667507 "VERIFIED FIXED - TM/JM: \"Assertion failure: shape->previous() == obj->lastProperty(),\" with gc") through the process in time to make Firefox 6 safely. Messing with this area of the code has already caused that one regression, safer to just leave this for Firefox 7.
[status-firefox6](/buglist.cgi?f1=cf_status_firefox6&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox6&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox6&o1=equals&v1=wontfix)
[tracking-firefox6](/buglist.cgi?f1=cf_tracking_firefox6&o1=isnotempty):
[+](/buglist.cgi?f1=cf_tracking_firefox6&o1=equals&v1=%2B) → [-](/buglist.cgi?f1=cf_tracking_firefox6&o1=equals&v1=-)

|  | [u279076](/user_profile?user_id=279076) |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=657198#c24)• 13 years ago |
|  | |

qa-: fix verification not neededWhiteboard: [ccbr][sg:critical?] fixed-in-tracemonkey → [ccbr][sg:critical?] fixed-in-tracemonkey [qa-]

|  | [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=657198#a14121295_132034)• 13 years ago |

Depends on: [697155](/show_bug.cgi?id=697155 "VERIFIED WONTFIX - TM: \"Assertion failure: shape->previous() == obj->lastProperty(),\" with gc")

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=657198#a21558454_1689)• 13 years ago |

Group: core-security

|  | [Kyle Huey (Exited; not receiving bugmail, old account, do not use)](/user_profile?user_id=336670) |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=657198#c25)• 13 years ago |
|  | |

Did the testcase for this ever land?

|  | [David Mandelin [:dmandelin]](/user_profile?user_id=294323) |  |
| --- | --- | --- |
| [Comment 26](/show_bug.cgi?id=657198#c26)• 13 years ago |
|  | |

(In reply to Kyle Huey [:khuey] (khuey@mozilla.com) from [comment #25](/show_bug.cgi?id=657198#c25 "VERIFIED FIXED - TM: \"Assertion failure: shape->previous() == obj->lastProperty(),\" with gc"))
> Did the testcase for this ever land?
This was a tracer bug so I don't think we need the test case.

|  | [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034)  Reporter |  |
| --- | --- | --- |
| [Comment 27](/show_bug.cgi?id=657198#c27)• 13 years ago |
|  | |

Testcase needs tracer (-j) to trigger, tracer is long gone.
-> VERIFIED.Status: RESOLVED → VERIFIED

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101) |  |
| --- | --- | --- |
| [Comment 28](/show_bug.cgi?id=657198#c28)• 12 years ago |
|  | |

Bug in removed tracer code, setting in-testsuite- flag.Flags: in-testsuite? → in-testsuite-
You need to [log in](/show_bug.cgi?id=657198&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from bugzilla.mozilla.org_4f7527d7_20250125_210209.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/672436)
* [XML](/show_bug.cgi?ctype=xml&id=672436)

Closed
[Bug 672436](/show_bug.cgi?id=672436)

Opened 14 years ago
Closed 14 years ago

# Assertion failure: priv->stackElems + stackDepth == elem

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Assertion failure: priv->stackElems + stackDepth == elem

## Categories

### (Core :: JavaScript Engine, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=JavaScript%20Engine#JavaScript%20Engine)

JavaScript Engine
▾

Core :: JavaScript Engine
The interpreter engine for the core JavaScript language, independent of the browser's object model. File ONLY core JavaScript language bugs in this category. For bugs involving browser objects such as "window" and "document", use the "DOM" component. For bugs involving calls between JavaScript and C++, use the "XPConnect" component.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=JavaScript%20Engine&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=JavaScript%20Engine&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=JavaScript%20Engine)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

7 Branch

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

x86

All

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

critical

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

---

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Webcompat Priority | --- |
| --- | --- |
| a11y-review | --- |
| Accessibility Severity | --- |
| Webcompat Score | --- |
| Performance Impact | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox7 | --- | [fixed](/buglist.cgi?f1=cf_status_firefox7&o1=equals&v1=fixed) |
| firefox8 | --- | [fixed](/buglist.cgi?f1=cf_status_firefox8&o1=equals&v1=fixed) |
| status1.9.2 | --- | [unaffected](/buglist.cgi?f1=cf_status_192&o1=equals&v1=unaffected) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox7 |  | fixed |
| firefox8 |  | fixed |
| status1.9.2 |  | unaffected |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: bc, Assigned: luke)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](extensions/Gravatar/web/default.jpg)  [luke](/user_profile?user_id=347312)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/ee4c7c6351b45c4655e16993a29979b0?d=mm&size=40)  [bc](/user_profile?user_id=23402)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/4fe52ee1503aecf7b6c976b8eb7c1753?d=mm&size=40)  [willyelm](/user_profile?user_id=714609)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

10 people

## References

### ( [URL](http://www.android-destek.com/?p=429]...........xrecovery-root "http://www.android-destek.com/?p=429]...........xrecovery-root") )

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[Duplicates:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#duplicates)

[675966](/show_bug.cgi?id=675966 "RESOLVED DUPLICATE - with \"ghostery\" addon installed, startup crash in aurora=ff7, beta=ff6 works fine")

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[android-destek.com/?p=429]..............](http://www.android-destek.com/?p=429]...........xrecovery-root "http://www.android-destek.com/?p=429]...........xrecovery-root")

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: assertion, regression, reproducible, Whiteboard: [sg:critical?] js-triage-done [qa-])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[assertion](/buglist.cgi?keywords=assertion&resolution=---),
[regression](/buglist.cgi?keywords=regression&resolution=---),
[reproducible](/buglist.cgi?keywords=reproducible&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[sg:critical?] js-triage-done [qa-]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |
|  | qe-verify |  |

## Crash Data

Signature:

[[@ WrappedNativeProtoMarker ]](https://crash-stats.mozilla.org/signature/?signature=WrappedNativeProtoMarker)

[[@ JSCompartment::purge(JSContext\*) ]](https://crash-stats.mozilla.org/signature/?signature=JSCompartment%3A%3Apurge%28JSContext%2A%29)

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (6 files)

| [nightly debug stack](/attachment.cgi?id=546704)  [14 years ago](#c0)  [Bob Clary [:bc] (inactive)](/user_profile?user_id=23402)   8.62 KB, text/plain |  | [Details](/attachment.cgi?id=546704&action=edit) |
| --- | --- | --- |
| [somewhat reduced testcase](/attachment.cgi?id=547482)  [14 years ago](#c1)  [Bas Hickendorff](/user_profile?user_id=315166)   181.99 KB, text/plain |  | [Details](/attachment.cgi?id=547482&action=edit) |
| [fix and test](/attachment.cgi?id=548272)  [14 years ago](#c8)  [Luke Wagner [:luke]](/user_profile?user_id=347312)   2.25 KB, patch | dvander : [review+](#c9 "14 years ago")  christian : [approval-mozilla-aurora+](#c21 "14 years ago") | [Details](/attachment.cgi?id=548272&action=edit) | [Diff](/attachment.cgi?id=548272&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=672436&attachment=548272) |
| [Patch merged to aurora7](/attachment.cgi?id=550129)  [13 years ago](#c18)  [Kai Engert [:KaiE:]](/user_profile?user_id=36541)   1.60 KB, patch |  | [Details](/attachment.cgi?id=550129&action=edit) | [Diff](/attachment.cgi?id=550129&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=672436&attachment=550129) |
| [beta stack (mac os x)](/attachment.cgi?id=556875)  [13 years ago](#c24)  [Bob Clary [:bc] (inactive)](/user_profile?user_id=23402)   30.00 KB, text/plain |  | [Details](/attachment.cgi?id=556875&action=edit) |
| [testcase for comment 24](/attachment.cgi?id=557125)  [13 years ago](#c28)  [Bob Clary [:bc] (inactive)](/user_profile?user_id=23402)   1.11 KB, text/html |  | [Details](/attachment.cgi?id=557125&action=edit) |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Bob Clary [:bc] (inactive)](/user_profile?user_id=23402)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=672436#c0)• 14 years ago |
|  | |

Attached file
[nightly debug stack](attachment.cgi?id=546704)
— [Details](attachment.cgi?id=546704&action=edit)

1. <http://www.android-destek.com/?p=429]...........xrecovery-root>
2. Assertion failure: priv->stackElems + stackDepth == elem, at /work/mozilla/builds/nightly/mozilla/js/src/jsexn.cpp:363
reproduced on Mac, Win Nightly and Aurora. Opt Aurora build didn't crash fwiw.
dmandelin, gal: lots of tracing on the stack.

|  | [David Mandelin [:dmandelin]](/user_profile?user_id=294323) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=672436#a64235_294323)• 14 years ago |

Whiteboard: js-triage-needed

|  | [Bas Hickendorff](/user_profile?user_id=315166) |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=672436#c1)• 14 years ago |
|  | |

Attached file
[somewhat reduced testcase](attachment.cgi?id=547482)
— [Details](attachment.cgi?id=547482&action=edit)

I have tried to reduce the test case, but I didn't manage to get it really small. I guess the problem depends on the size of the page. However I managed to remove a lot of the external references and scripts (apart from the Google translate stuff, it seems necessary to trigger this).
Although its still a big page, Google Chrome has no problem with it at all and loads the page almost instantly (but I guess the assertion already tells us it is a Firefox problem...)
The hang is unfortunately not 100% reproducible on the testcase, but when you ctrl-F5 several times (2 to 3 times is usually enough for me here, sometimes up to 5 times) it really hangs, the other times, it is just slow.
This testcase still gives the assertion when it gives a real hang:
Assertion failure: priv->stackElems + stackDepth == elem, at /home/bas/mozilla/src/js/src/jsexn.cpp:363
When it is just slow, I don't get the assertion...
I was able to remove about 70% of the size of the testcase. I hope this helps at least a bit with debugging.

|  | [Bob Clary [:bc] (inactive)](/user_profile?user_id=23402)  Reporter |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=672436#c2)• 14 years ago |
|  | |

[bp-a947dcaa-2018-46c8-b443-b71ff2110723](https://crash-stats.mozilla.org/report/index/a947dcaa-2018-46c8-b443-b71ff2110723) winxp nightly/8
[@ WrappedNativeProtoMarker ]
[bp-6acc476e-b0d5-4d25-b1f8-e1a352110723](https://crash-stats.mozilla.org/report/index/6acc476e-b0d5-4d25-b1f8-e1a352110723) winxp aurora/7
[@ JSCompartment::purge(JSContext\*) ]
note the socorro signatures associated with this assertion are js::gc::PushMarkStack which is filed as [Bug 654903](/show_bug.cgi?id=654903 "RESOLVED WORKSFORME - Firefox Crash Report [@ js::gc::PushMarkStack ]")Crash Signature: [@ WrappedNativeProtoMarker ] [@ JSCompartment::purge(JSContext\*) ]

|  | [Bill McCloskey [inactive unless it's an emergency] (:billm)](/user_profile?user_id=389993) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=672436#c3)• 14 years ago |
|  | |

Thanks so much for this report! Bob, could you elaborate on [comment 2](/show_bug.cgi?id=672436#c2 "RESOLVED FIXED - Assertion failure: priv->stackElems + stackDepth == elem")? Does that mean that when you visited this page in an opt build, you crashed with those three signatures? I happened to crash in js::PropertyTable::search.
Based on the assertion, here's what I think is happening. When we fill out the exception object, we stop prematurely if we hit a stack frame from another compartment. Unfortunately, that leaves the rest of the exception object undefined (we do malloc instead of calloc in this case). Then if we trace through that exception object, we will try to "mark" through invalid pointers, which I'm guessing just causes us to corrupt arbitrary memory.
I'll take a closer look on Monday. Marking security sensitive due to the possible memory corruption.Group: core-security

|  | [Bob Clary [:bc] (inactive)](/user_profile?user_id=23402)  Reporter |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=672436#c4)• 14 years ago |
|  | |

Bill, re [comment 2](/show_bug.cgi?id=672436#c2 "RESOLVED FIXED - Assertion failure: priv->stackElems + stackDepth == elem") those two socorro reports/signatures were from current opt (nightly) builds for Aurora/Firefox 7 and Nightly/Firefox 8 that I downloaded just prior to testing.

|  | [Bill McCloskey [inactive unless it's an emergency] (:billm)](/user_profile?user_id=389993) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=672436#c5)• 14 years ago |
|  | |

I was wrong in [comment 3](/show_bug.cgi?id=672436#c3 "RESOLVED FIXED - Assertion failure: priv->stackElems + stackDepth == elem"). We're not hitting the assert because we break out of the loop when the compartment is different. I didn't notice that the previous loop also breaks out under the same condition, and it's the one that determines stackDepth. So that seems okay.
What's going on here is a little weirder. Basically, there are two loops that look like this:
FrameRegsIter firstPass(cx);
for (; !firstPass.done(); ++firstPass) { ...break at some point... }
for (FrameRegsIter iter(cx); iter != firstPass; ++iter) { ... }
The assumption is that they will iterate over the exact same set of stack frames. The reason we assert is that they don't. The second loop sometimes includes an extra stack frame that the first one didn't see. This can lead to memory corruption and other bad stuff.
I instrumented the code to print the stack frames visited. In the bad case, it looks like this:
first loop: B,C,D
second loop: A,B,C,D
Then I added some code to print out when the top stack frame changes from B to A. It happens in the first iteration of the first loop, when we call checkAccess. This is some sort of security callback (nsScriptSecurityManager::CheckObjectAccess).
Some questions:
1. Is it reasonable for this CheckObjectAccess thing to add an extra stack frame to the current cx?
2. We call InitExnPrivate a lot on this web page. I noticed that in every single case except the bad one, we see the stack frames A,B,C,D (i.e., they're exactly the same addresses every time). Why is it that in this one case, we don't see A? Does this just mean that the stacks are usually of the same height when InitExnPrivate is called?
Maybe I'm being paranoid. It would be easy to "fix" this problem by saving the stack frames we see in a vector so we don't have to loop over them twice, or something like that. However, I want to make sure we're not papering over a deeper problem. It seems really weird to me that CheckObjectAccess is adding a frame. Could this be some kind of threading issue, where two threads are touching cx at the same time?
Luke, could you take a look at this? There's a lot I don't understand here (stack iteration, security checks).Whiteboard: js-triage-needed → js-triage-done

|  | [Luke Wagner [:luke]](/user_profile?user_id=347312)  Assignee |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=672436#c6)• 14 years ago |
|  | |

Security pushes dummy frames (or maybe even real JS frames if somehow JS gets run), but this should definitely be done stack-ily such that the stack is the same before and after. The underlying bug is probably an un-matched pop (e.g., JS\_EnterCrossCompartmentCall without JS\_LeaveCrossCompartmentCall).

|  | [Luke Wagner [:luke]](/user_profile?user_id=347312)  Assignee |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=672436#c7)• 14 years ago |
|  | |

Oh yeah, forgot to say, I'll take this; thanks for the triage.

|  | [Luke Wagner [:luke]](/user_profile?user_id=347312)  Assignee |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=672436#c8)• 14 years ago |
|  | |

Attached patch

[fix and test](attachment.cgi?id=548272&action=diff)
— [Details](attachment.cgi?id=548272&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=672436&attachment=548272)

Man, reproducible test cases are great.
The bug is that there are a few paths into InitExnPrivate which haven't called LeaveTrace. Then the checkAccess hook causes LeaveTrace to be called so the stack changes size. I think the cleanest fix is just to put LeaveTrace in StackIter.Assignee: general → lukeStatus: NEW → ASSIGNED
[Attachment #548272](/attachment.cgi?id=548272&action=edit "fix and test") -
Flags: review?(dvander)

|  | [David Anderson [:dvander] - inactive, e-mail if emergency](/user_profile?user_id=309316) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=672436#c9)• 14 years ago |
|  | |

Comment on [attachment 548272](/attachment.cgi?id=548272 "fix and test") [[details]](/attachment.cgi?id=548272&action=edit "fix and test") [[diff]](/attachment.cgi?id=548272&action=diff "fix and test") [[review]](/page.cgi?id=splinter.html&ignore=&bug=672436&attachment=548272)
fix and test
Review of [attachment 548272](/attachment.cgi?id=548272 "fix and test") [[details]](/attachment.cgi?id=548272&action=edit "fix and test") [[diff]](/attachment.cgi?id=548272&action=diff "fix and test") [[review]](/page.cgi?id=splinter.html&ignore=&bug=672436&attachment=548272):
-----------------------------------------------------------------
[Attachment #548272](/attachment.cgi?id=548272&action=edit "fix and test") -
Flags: review?(dvander) → review+

|  | [Luke Wagner [:luke]](/user_profile?user_id=347312)  Assignee |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=672436#c10)• 14 years ago |
|  | |

Comment on [attachment 548272](/attachment.cgi?id=548272 "fix and test") [[details]](/attachment.cgi?id=548272&action=edit "fix and test") [[diff]](/attachment.cgi?id=548272&action=diff "fix and test") [[review]](/page.cgi?id=splinter.html&ignore=&bug=672436&attachment=548272)
fix and test
This should go on aurora.
[Attachment #548272](/attachment.cgi?id=548272&action=edit "fix and test") -
Flags: approval-mozilla-aurora?

|  | [Luke Wagner [:luke]](/user_profile?user_id=347312)  Assignee |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=672436#c11)• 14 years ago |
|  | |

<http://hg.mozilla.org/mozilla-central/rev/714d30924fc5>Status: ASSIGNED → RESOLVEDClosed: 14 years agoResolution: --- → FIXED

|  | [LegNeato](/user_profile?user_id=482154) |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=672436#c12)• 13 years ago |
|  | |

Comment on [attachment 548272](/attachment.cgi?id=548272 "fix and test") [[details]](/attachment.cgi?id=548272&action=edit "fix and test") [[diff]](/attachment.cgi?id=548272&action=diff "fix and test") [[review]](/page.cgi?id=splinter.html&ignore=&bug=672436&attachment=548272)
fix and test
We're going to let this one bubble up from central. Will this be a regression we'll ship in 7? How would this show up? If you can give us more context that would change our decision please nominate.
[Attachment #548272](/attachment.cgi?id=548272&action=edit "fix and test") -
Flags: approval-mozilla-aurora? → approval-mozilla-aurora-

|  | [Luke Wagner [:luke]](/user_profile?user_id=347312)  Assignee |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=672436#c13)• 13 years ago |
|  | |

Comment on [attachment 548272](/attachment.cgi?id=548272 "fix and test") [[details]](/attachment.cgi?id=548272&action=edit "fix and test") [[diff]](/attachment.cgi?id=548272&action=diff "fix and test") [[review]](/page.cgi?id=splinter.html&ignore=&bug=672436&attachment=548272)
fix and test
The patch may be big but, as for the bits that ship, its a one line fix and the risk is low. The bug would manifest itself as random crashes due to apparent JS corruption. We know this hits (the test case is from the real web). I think we should definitely take this.
[Attachment #548272](/attachment.cgi?id=548272&action=edit "fix and test") -
Flags: approval-mozilla-aurora- → approval-mozilla-aurora?

|  | [Luke Wagner [:luke]](/user_profile?user_id=347312)  Assignee |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=672436#c15)• 13 years ago |
|  | |

This is hitting, can we get this approved for aurora?

|  | [Kai Engert [:KaiE:]](/user_profile?user_id=36541) |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=672436#c16)• 13 years ago |
|  | |

Luke, I wanted to test the fix on aurora.
Unfortunately, the changes to file js.cpp don't apply cleanly to the aurora branch. Will you attach a merged patch?

|  | [Kai Engert [:KaiE:]](/user_profile?user_id=36541) |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=672436#c17)• 13 years ago |
|  | |

Changing version to 7, because I get this assertion on the Aurora7 branch.Version: Trunk → 7 Branch

|  | [Kai Engert [:KaiE:]](/user_profile?user_id=36541) |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=672436#c18)• 13 years ago |
|  | |

Attached patch

[Patch merged to aurora7](attachment.cgi?id=550129&action=diff)
— [Details](attachment.cgi?id=550129&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=672436&attachment=550129)

This is my attempt to merge the patch to aurora branch.
I confirm this patch fixes the aurora crash that I reported in [bug 675966](/show_bug.cgi?id=675966 "RESOLVED DUPLICATE - with \"ghostery\" addon installed, startup crash in aurora=ff7, beta=ff6 works fine").

|  | [Bob Clary [:bc] (inactive)](/user_profile?user_id=23402)  Reporter |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=672436#c19)• 13 years ago |
|  | |

(In reply to [comment #17](/show_bug.cgi?id=672436#c17 "RESOLVED FIXED - Assertion failure: priv->stackElems + stackDepth == elem"))
> Changing version to 7, because I get this assertion on the Aurora7 branch.
Kai, I'm confused by the version change. Yes, this exists on 7 which is reflected in the status-firefox7 flag but the bug is marked fixed since it was fixed on trunk/8 not on aurora/7. Wouldn't it be more appropriate for the version to remain on trunk with status-firefox8 set to fixed and status-firefox7 set to affected?

|  | [Kai Engert [:KaiE:]](/user_profile?user_id=36541) |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=672436#c20)• 13 years ago |
|  | |

Hi Bob, I don't want to confuse things. I assumed the version field is set to the earliest version where the bug can be seen. If my understanding is wrong, please revert to trunk. Thanks.

|  | [LegNeato](/user_profile?user_id=482154) |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=672436#c21)• 13 years ago |
|  | |

Comment on [attachment 548272](/attachment.cgi?id=548272 "fix and test") [[details]](/attachment.cgi?id=548272&action=edit "fix and test") [[diff]](/attachment.cgi?id=548272&action=diff "fix and test") [[review]](/page.cgi?id=splinter.html&ignore=&bug=672436&attachment=548272)
fix and test
Approved for releases/mozilla-aurora
[Attachment #548272](/attachment.cgi?id=548272&action=edit "fix and test") -
Flags: approval-mozilla-aurora? → approval-mozilla-aurora+

|  | [Luke Wagner [:luke]](/user_profile?user_id=347312)  Assignee |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=672436#c22)• 13 years ago |
|  | |

<http://hg.mozilla.org/releases/mozilla-aurora/rev/d30981d54470>

|  | [Luke Wagner [:luke]](/user_profile?user_id=347312)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=672436#a1887361_347312)• 13 years ago |

[status-firefox7](/buglist.cgi?f1=cf_status_firefox7&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox7&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox7&o1=equals&v1=fixed)
[status-firefox8](/buglist.cgi?f1=cf_status_firefox8&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox8&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox8&o1=equals&v1=fixed)

|  | [LegNeato](/user_profile?user_id=482154) |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=672436#c23)• 13 years ago |
|  | |

Does this apply to 1.9.2 as well? If so we'll want this for 1.9.2.21

|  | [Bob Clary [:bc] (inactive)](/user_profile?user_id=23402)  Reporter |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=672436#c24)• 13 years ago |
|  | |

Attached file
[beta stack (mac os x)](attachment.cgi?id=556875)
— [Details](attachment.cgi?id=556875&action=edit)

I can still see this assertion with a somewhat different but related stack on Beta/7 Win/Mac/Linux. I have three urls (one with personally identifiable information and two nsfw) that reproduce the assertion but that don't crash the nightly Beta. I'll try to get a reduced test case.

|  | [Luke Wagner [:luke]](/user_profile?user_id=347312)  Assignee |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=672436#c25)• 13 years ago |
|  | |

Bob: that assertion is different than the one in this bug. (It's also less bad; in the past the fix has just been tweaks to satisfy the assert.) Nonetheless, we do want to get them fixed; do the asserts reproduce on nightly?

|  | [Bob Clary [:bc] (inactive)](/user_profile?user_id=23402)  Reporter |  |
| --- | --- | --- |
| [Comment 26](/show_bug.cgi?id=672436#c26)• 13 years ago |
|  | |

Luke, this appears to be Beta only. New bug? Security Sensitive?

|  | [Luke Wagner [:luke]](/user_profile?user_id=347312)  Assignee |  |
| --- | --- | --- |
| [Comment 27](/show_bug.cgi?id=672436#c27)• 13 years ago |
|  | |

You've found several testcases that have triggered this particular assert and, IIRC, for some of them (the ones where there was no real problem in release builds) we decided to not land on branches and wait for the fixes to bubble up naturally. So I would say no new bug and not security sensitive.

|  | [Bob Clary [:bc] (inactive)](/user_profile?user_id=23402)  Reporter |  |
| --- | --- | --- |
| [Comment 28](/show_bug.cgi?id=672436#c28)• 13 years ago |
|  | |

Attached file
[testcase for comment 24](attachment.cgi?id=557125)
— [Details](attachment.cgi?id=557125&action=edit)

|  | [LegNeato](/user_profile?user_id=482154) |  |
| --- | --- | --- |
| [Comment 29](/show_bug.cgi?id=672436#c29)• 13 years ago |
|  | |

Any chance of a 3.6 patch for this? Is it affected? We don't want to announce this fix in 7 only to zero-day Firefox 3.6 users. Thanks!

|  | [Luke Wagner [:luke]](/user_profile?user_id=347312)  Assignee |  |
| --- | --- | --- |
| [Comment 30](/show_bug.cgi?id=672436#c30)• 13 years ago |
|  | |

3.6 is not affected.

|  | [Bob Clary [:bc] (inactive)](/user_profile?user_id=23402)  Reporter |  |
| --- | --- | --- |
| [Comment 31](/show_bug.cgi?id=672436#c31)• 13 years ago |
|  | |

I have never seen this specific assertion on 1.9.2 nor has 1.9.2 crashed on the url.

|  | [LegNeato](/user_profile?user_id=482154) |  |
| --- | --- | --- |
| [Comment 32](/show_bug.cgi?id=672436#c32)• 13 years ago |
|  | |

Yay, thanks! Marking as such.
[status1.9.2](/buglist.cgi?f1=cf_status_192&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_192&o1=equals&v1=unaffected)

|  | [u279076](/user_profile?user_id=279076) |  |
| --- | --- | --- |
| [Comment 33](/show_bug.cgi?id=672436#c33)• 13 years ago |
|  | |

qa- as no QA fix verification is neededWhiteboard: js-triage-done → js-triage-done [qa-]

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=672436#a6057007_1689)• 13 years ago |

Keywords: [regression](/buglist.cgi?keywords=regression&resolution=---)Whiteboard: js-triage-done [qa-] → [sg:critical?] js-triage-done [qa-]

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=672436#a15951344_1689)• 13 years ago |

Group: core-security

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=672436#a133973457_75935)• 9 years ago |

Keywords: [testcase-wanted](/buglist.cgi?keywords=testcase-wanted&resolution=---)
You need to [log in](/show_bug.cgi?id=672436&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Bob Clary [:bc] (inactive)](/user_profile?user_id=23402)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from bugzilla.mozilla.org_395b8110_20250125_210153.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/552002)
* [XML](/show_bug.cgi?ctype=xml&id=552002)

Closed
[Bug 552002](/show_bug.cgi?id=552002)

Opened 15 years ago
Closed 13 years ago

# Crash in [@ nsDOMEvent::QueryInterface(nsID const&, void\*\*) ]

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Crash in [@ nsDOMEvent::QueryInterface(nsID const&, void\*\*) ]

## Categories

### (Core Graveyard :: Plug-ins, defect)

[Product:](/describecomponents.cgi?product=Core%20Graveyard)

Core Graveyard
▾

Core Graveyard
Old, retired Core components
[See Open Bugs in This Product](/buglist.cgi?product=Core%20Graveyard&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core%20Graveyard)
Watch This Product

[Component:](/describecomponents.cgi?product=Core%20Graveyard&component=Plug-ins#Plug-ins)

Plug-ins
▾

Core Graveyard :: Plug-ins
Bugs in core Mozilla code that supports registering and using plug-ins. For bugs in specific plugins, please file those bugs under External Software Affecting Firefox.
[See Open Bugs in This Component](/buglist.cgi?product=Core%20Graveyard&component=Plug-ins&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core%20Graveyard&component=Plug-ins&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core%20Graveyard&component=Plug-ins)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

1.9.2 Branch

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

All

All

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

critical

## Tracking

### (firefox5- wontfix, firefox6- wontfix, firefox7+ fixed, firefox8+ fixed, blocking2.0 -, status2.0 wontfix, status1.9.2 wontfix, status1.9.1 wontfix)

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Webcompat Priority | --- |
| --- | --- |
| Accessibility Severity | --- |
| Performance Impact | --- |
| Webcompat Score | --- |
| a11y-review | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox5 | [-](/buglist.cgi?f1=cf_tracking_firefox5&o1=equals&v1=-) | [wontfix](/buglist.cgi?f1=cf_status_firefox5&o1=equals&v1=wontfix) |
| firefox6 | [-](/buglist.cgi?f1=cf_tracking_firefox6&o1=equals&v1=-) | [wontfix](/buglist.cgi?f1=cf_status_firefox6&o1=equals&v1=wontfix) |
| firefox7 | [+](/buglist.cgi?f1=cf_tracking_firefox7&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox7&o1=equals&v1=fixed) |
| firefox8 | [+](/buglist.cgi?f1=cf_tracking_firefox8&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox8&o1=equals&v1=fixed) |
| blocking2.0 | --- | [-](/buglist.cgi?f1=cf_blocking_20&o1=equals&v1=-) |
| status2.0 | --- | [wontfix](/buglist.cgi?f1=cf_status_20&o1=equals&v1=wontfix) |
| status1.9.2 | --- | [wontfix](/buglist.cgi?f1=cf_status_192&o1=equals&v1=wontfix) |
| status1.9.1 | --- | [wontfix](/buglist.cgi?f1=cf_status_191&o1=equals&v1=wontfix) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox5 | - | wontfix |
| firefox6 | - | wontfix |
| firefox7 | + | fixed |
| firefox8 | + | fixed |
| blocking2.0 |  | - |
| status2.0 |  | wontfix |
| status1.9.2 |  | wontfix |
| status1.9.1 |  | wontfix |

## People

### (Reporter: marcia, Unassigned)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

*Unassigned*

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/cf7a6485ad75c35d66da0af6c88515d5?d=mm&size=40)  [marcia](/user_profile?user_id=8519)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](extensions/Gravatar/web/default.jpg)  [jimm](/user_profile?user_id=279663)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

16 people

## References

### ( [URL](http://www.scribd.com/doc/25368889/Tina-Konyvek-Csodaszep-es-finom-tortak-sutemenyek "http://www.scribd.com/doc/25368889/Tina-Konyvek-Csodaszep-es-finom-tortak-sutemenyek") )

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

[449129](/show_bug.cgi?id=449129 "RESOLVED FIXED - \"ASSERTION: constructing frames in the middle of a paint\" with flash slow script dialog [OOPP version]"), [591409](/show_bug.cgi?id=591409 "RESOLVED FIXED - \"ASSERTION: constructing frames in the middle of a paint\" with flash slow script dialog"), [598425](/show_bug.cgi?id=598425 "RESOLVED FIXED - Asynchronous layer-based plugin painting on Mac")

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

Dependency [tree](/showdependencytree.cgi?id=552002&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=552002)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[scribd.com/doc/25368889/Tina-Konyvek-...](http://www.scribd.com/doc/25368889/Tina-Konyvek-Csodaszep-es-finom-tortak-sutemenyek "http://www.scribd.com/doc/25368889/Tina-Konyvek-Csodaszep-es-finom-tortak-sutemenyek")

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: crash, Whiteboard: [sg:critical?][to be fixed by asynchronous plugin painting][qa?])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[crash](/buglist.cgi?keywords=crash&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[sg:critical?][to be fixed by asynchronous plugin painting][qa?]

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |
|  | qe-verify |  |

## Crash Data

Signature:

[[@ nsDOMEvent::QueryInterface(nsID const&, void\*\*) ]](https://crash-stats.mozilla.org/signature/?signature=nsDOMEvent%3A%3AQueryInterface%28nsID%20const%26%2C%20void%2A%2A%29)

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (1 file)

| [stack from debug build](/attachment.cgi?id=432428)  [15 years ago](#c7)  [Martijn Wargers (dead)](/user_profile?user_id=55600)   27.29 KB, text/plain |  | [Details](/attachment.cgi?id=432428&action=edit) |
| --- | --- | --- |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Marcia Knous [:marcia]](/user_profile?user_id=8519)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=552002#c0)• 15 years ago |
|  | |

Seen while reviewing crash data and 100% reproducible on the site in the URL using Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10.6; en-US; rv:1.9.3a3pre) Gecko/20100312 Minefield/3.7a3pre
STR:
1. Load site in URL
2. Perform and right click event and then scroll. Crash.
<https://crash-stats.mozilla.com/report/index/36fa4e87-e61f-42cc-abce-b6cc92100312>
<https://crash-stats.mozilla.com/report/index/762c0b32-8f02-4c28-9f83-ac3852100312>
<https://crash-stats.mozilla.com/report/index/bp-85a1d79c-5fb1-4364-9e00-b14092100312>
are my three crash reports and my flash version is below.
File: Flash Player.plugin
Version: 10.1.51.95
Shockwave Flash 10.1 d51

|  | [Marcia Knous [:marcia]](/user_profile?user_id=8519)  Reporter |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=552002#c1)• 15 years ago |
|  | |

I am able to reproduce the crash on Windows using Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.9.3a3pre) but I do get a completely different stack than Mac: <http://crash-stats.mozilla.com/report/index/32439b8a-6242-44dc-922d-4291c2100312> where I crash in [@ \_filbuf ].
Version: 10.0.45.2
Shockwave Flash 10.0 r45OS: Mac OS X → AllHardware: x86 → All

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=552002#c2)• 15 years ago |
|  | |

Smells like memory corruption of some sort... :(Whiteboard: [sg:investigate]

|  | [Jesse Ruderman](/user_profile?user_id=11608) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=552002#c3)• 15 years ago |
|  | |

We're not using [sg:investigate] any more. Please use [sg:critical] or [sg:critical?] for scary crashes with testcases, like this one.
(There's no special marking for "this crash would be scary if it had a testcase". We want those bugs to be public to give them a shot at being fixed, but we don't want to draw too much evil attention to them.)Group: core-securityKeywords: [testcase-wanted](/buglist.cgi?keywords=testcase-wanted&resolution=---)Whiteboard: [sg:investigate] → [sg:critical?]

|  | [Jesse Ruderman](/user_profile?user_id=11608) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=552002#c4)• 15 years ago |
|  | |

I'm having trouble reproducing on Mac OS X 10.5. Which is sad, because it's a platform where Valgrind works, and Valgrind is good at tracking down the source of memory corruption.
Am I supposed to right-click on the Flash? And then scroll with the mouse wheel / trackpad? While the context menu is still up?

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=552002#c5)• 15 years ago |
|  | |

Is this a trunk only problem?

|  | [Martijn Wargers (dead)](/user_profile?user_id=55600) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=552002#c6)• 15 years ago |
|  | |

I can reproduce this, I haven't been able to reproduce this in a 2010-03-11 build. There I get flash context menus that get 'stuck' and a Minefield that is basically unusable.
In a debug build, I see this in a debug build before the crash
###!!! ASSERTION: Adding a script runner when that is prevented!: 'Error', file
c:/mozilla-build/src/content/base/src/nsContentUtils.cpp, line 4599

|  | [Martijn Wargers (dead)](/user_profile?user_id=55600) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=552002#c7)• 15 years ago |
|  | |

Attached file
[stack from debug build](attachment.cgi?id=432428)
— [Details](attachment.cgi?id=432428&action=edit)

|  | [Martijn Wargers (dead)](/user_profile?user_id=55600) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=552002#c8)• 15 years ago |
|  | |

I forgot, I had to disable html5 rendering, because it interfered with the page, somehow, causing a blank page.

|  | [Martijn Wargers (dead)](/user_profile?user_id=55600) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=552002#c9)• 15 years ago |
|  | |

I'm seeing these crashes too on <http://www.vanderaa.net/afterlife-video-trailer>
When right-clicking on one of the "audio excerpts" flash things (they are also flashing in a weird way, I suspect that is a direct2d bug of some sort).
I also managed once to crash with a different stack on that site:
<http://crash-stats.mozilla.com/report/index/bp-19419c7f-f8ea-42d8-a7ac-b653a2100314>
I think (tentative) steps to reproduce: right-click on the main video, then minimize window, then close tab or something.

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=552002#c10)• 15 years ago |
|  | |

Over to bent who will have a look at this...Assignee: nobody → bent.mozilla

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966) |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=552002#c11)• 15 years ago |
|  | |

This looks like a bug in plugin code, not in DOM events.
But feel free to change back the component and assign this bug to me if
the bug is somewhere in events code.Component: DOM: Events → Plug-insQA Contact: events → plugins

|  | [Ben Turner (not reading bugmail, use the needinfo flag!)](/user_profile?user_id=200444) |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=552002#c12)• 15 years ago |
|  | |

I think this is going to end up a dup of [bug 535651](/show_bug.cgi?id=535651 "RESOLVED DUPLICATE - Plugins can use NPRuntime during painting") or [bug 449129](/show_bug.cgi?id=449129 "RESOLVED FIXED - \"ASSERTION: constructing frames in the middle of a paint\" with flash slow script dialog [OOPP version]"). In this case I think we're running NPRuntime stuff inside a paint.

|  | [Marcia Knous [:marcia]](/user_profile?user_id=8519)  Reporter |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=552002#c13)• 15 years ago |
|  | |

I cannot reproduce this using Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10.6; en-US; rv:1.9.2.3) Gecko/20100401 Firefox/3.6.3, but it easily reproduced on the trunk nightly.
(In reply to [comment #5](/show_bug.cgi?id=552002#c5 "RESOLVED FIXED - Crash in [@ nsDOMEvent::QueryInterface(nsID const&, void**) ]"))
> Is this a trunk only problem?

|  | [Marcia Knous [:marcia]](/user_profile?user_id=8519)  Reporter |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=552002#c14)• 15 years ago |
|  | |

Martijn: Are you still able to crash on the sites you mention in [Comment 9](/show_bug.cgi?id=552002#c9 "RESOLVED FIXED - Crash in [@ nsDOMEvent::QueryInterface(nsID const&, void**) ]")?

|  | [Martijn Wargers (dead)](/user_profile?user_id=55600) |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=552002#c15)• 15 years ago |
|  | |

No, I can't reproduce those anymore with the latest trunk build.

|  | [Damon Sicore (:damons)](/user_profile?user_id=269330) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=552002#a3980303_269330)• 15 years ago |

Whiteboard: [sg:critical?] → [sg:critical?][critsmash:investigating]

|  | [Marcia Knous [:marcia]](/user_profile?user_id=8519)  Reporter |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=552002#c16)• 15 years ago |
|  | |

marcia will try to reproduce using the branch build tomorrow.

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966) |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=552002#c17)• 15 years ago |
|  | |

(In reply to [comment #6](/show_bug.cgi?id=552002#c6 "RESOLVED FIXED - Crash in [@ nsDOMEvent::QueryInterface(nsID const&, void**) ]"))
> In a debug build, I see this in a debug build before the crash
> ###!!! ASSERTION: Adding a script runner when that is prevented!: 'Error', file
> c:/mozilla-build/src/content/base/src/nsContentUtils.cpp, line 4599
Jonas, Roc, I never really understood why nsContentUtils::AddScriptBlockerAndPreventAddingRunners()
is ok.
The assertion was added in <http://hg.mozilla.org/mozilla-central/rev/9584d6bce9c1>

|  | [Jonas Sicking (:sicking) No longer reading bugmail consistently](/user_profile?user_id=9186) |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=552002#c18)• 15 years ago |
|  | |

IIRC the idea was that it marks a section where we really should never be adding any script runners. I.e. a section where script blockers technically shouldn't even be needed.
However if we get something wrong and do accidentally attempt to add a scriptrunner, then we'll simply not run the runner. In an attempt to avoid exploitable crashes. I.e. we're attempting to turn an exploitable crash into a mere broken functionality.

|  | [Robert O'Callahan (:roc) (email my personal email if necessary)](/user_profile?user_id=5038) |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=552002#c19)• 15 years ago |
|  | |

That's part of the truth.
See
<http://mxr.mozilla.org/mozilla-central/source/layout/generic/nsGfxScrollFrame.cpp#1740>
The main reason is that blocking script execution suppresses flushing in nsPresShell, so we want to be able to add a script blocker to do that, but we want to be able to remove that blocker at a time when it is actually not safe to run scripts.

|  | [Jonas Sicking (:sicking) No longer reading bugmail consistently](/user_profile?user_id=9186) |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=552002#c20)• 15 years ago |
|  | |

Roc, if the main purpose is to suppress flushing, not suppress scripts, then would it make sense to instead add a flag to nsPresShell which disabled flushing and temporarily set that?

|  | [Robert O'Callahan (:roc) (email my personal email if necessary)](/user_profile?user_id=5038) |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=552002#c21)• 15 years ago |
|  | |

We actually need to do both. I don't really know what crazy stuff Windows might do here.

|  | [Marcia Knous [:marcia]](/user_profile?user_id=8519)  Reporter |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=552002#c22)• 15 years ago |
|  | |

I cannot reproduce this issue using Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10.6; en-US; rv:1.9.2.4) Gecko/20100413 Firefox/3.6.4 or the equivalent Windows 3.6.4 version.
(In reply to [comment #16](/show_bug.cgi?id=552002#c16 "RESOLVED FIXED - Crash in [@ nsDOMEvent::QueryInterface(nsID const&, void**) ]"))
> marcia will try to reproduce using the branch build tomorrow.

|  | [Jesse Ruderman](/user_profile?user_id=11608) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=552002#a5189845_11608)• 15 years ago |

Depends on: [449129](/show_bug.cgi?id=449129 "RESOLVED FIXED - \"ASSERTION: constructing frames in the middle of a paint\" with flash slow script dialog [OOPP version]")Whiteboard: [sg:critical?][critsmash:investigating] → [sg:critical?][critsmash:depends on 449129]

|  | [Damon Sicore (:damons)](/user_profile?user_id=269330) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=552002#a7004414_269330)• 15 years ago |

Whiteboard: [sg:critical?][critsmash:depends on 449129] → [sg:critical?][critsmash:investigating] depends on bug 449129

|  | [Marcia Knous [:marcia]](/user_profile?user_id=8519)  Reporter |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=552002#c23)• 15 years ago |
|  | |

<http://tinyurl.com/3xmcm7z> indicates there were several crashes with the 20100611 build, so apparently people are still hitting it in low volume.

|  | [Jesse Ruderman](/user_profile?user_id=11608) |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=552002#c24)• 15 years ago |
|  | |

Did the fix for [bug 449129](/show_bug.cgi?id=449129 "RESOLVED FIXED - \"ASSERTION: constructing frames in the middle of a paint\" with flash slow script dialog [OOPP version]") take care of this case? Note that you'll still experience the plugin bug as a crash, but it will be a safe NS\_RUNTIMEABORT in RPCChannel::SpinInternalEventLoop rather than a possibly exploitable crash in some random DOM code.

|  | [Damon Sicore (:damons)](/user_profile?user_id=269330) |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=552002#c25)• 14 years ago |
|  | |

Blocking final here until we have some sort of resolution.blocking2.0: --- → final+

|  | [Marcia Knous [:marcia]](/user_profile?user_id=8519)  Reporter |  |
| --- | --- | --- |
| [Comment 26](/show_bug.cgi?id=552002#c26)• 14 years ago |
|  | |

The site in the URL has changed quite a bit since the initial crash and I am not able to crash using either Windows or Mac latest trunk nightly.
Of late, the 3.6.x branch is showing 23 Windows crashes - <http://tinyurl.com/234c4ls>, but the branch does not have the patch in [Bug 449129](/show_bug.cgi?id=449129 "RESOLVED FIXED - \"ASSERTION: constructing frames in the middle of a paint\" with flash slow script dialog [OOPP version]") yet.

|  | [Jesse Ruderman](/user_profile?user_id=11608) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=552002#a13051283_11608)• 14 years ago |

Whiteboard: [sg:critical?][critsmash:investigating] depends on bug 449129 → [sg:critical?][critsmash:investigating] waiting for firefox 4 to ship to get data to decide whether to take a branch fix

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=552002#a14512657_1689)• 14 years ago |

Depends on: [591409](/show_bug.cgi?id=591409 "RESOLVED FIXED - \"ASSERTION: constructing frames in the middle of a paint\" with flash slow script dialog")

|  | [Damon Sicore (:damons)](/user_profile?user_id=269330) |  |
| --- | --- | --- |
| [Comment 27](/show_bug.cgi?id=552002#c27)• 14 years ago |
|  | |

Do we need to do what Roc says in [Comment 21](/show_bug.cgi?id=552002#c21 "RESOLVED FIXED - Crash in [@ nsDOMEvent::QueryInterface(nsID const&, void**) ]")?

|  | [Jesse Ruderman](/user_profile?user_id=11608) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=552002#a17889319_11608)• 14 years ago |

blocking2.0: final+ → ---Whiteboard: [sg:critical?][critsmash:investigating] waiting for firefox 4 to ship to get data to decide whether to take a branch fix → [sg:critical?][critsmash:investigating][1.9.2 branch and older] waiting for firefox 4 to ship to get data to decide whether to take a branch fixVersion: Trunk → 1.9.2 Branch

|  | [Ben Turner (not reading bugmail, use the needinfo flag!)](/user_profile?user_id=200444) |  |
| --- | --- | --- |
| [Comment 28](/show_bug.cgi?id=552002#c28)• 14 years ago |
|  | |

This needs a new owner.Assignee: bent.mozilla → nobody

|  | [Damon Sicore (:damons)](/user_profile?user_id=269330) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=552002#a19098644_269330)• 14 years ago |

Whiteboard: [sg:critical?][critsmash:investigating][1.9.2 branch and older] waiting for firefox 4 to ship to get data to decide whether to take a branch fix → [sg:critical?][critsmash:investigating][1.9.2 branch and older][waiting on async plugins]waiting for firefox 4 to ship to get data to decide whether to take a branch fix

|  | [Damon Sicore (:damons)](/user_profile?user_id=269330) |  |
| --- | --- | --- |
| [Comment 29](/show_bug.cgi?id=552002#c29)• 14 years ago |
|  | |

Talking about this more:
1) This is to be fixed by async plugin painting,
2) This is wontfix on branches.

|  | [Jesse Ruderman](/user_profile?user_id=11608) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=552002#a19098879_11608)• 14 years ago |

[status1.9.1](/buglist.cgi?f1=cf_status_191&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_191&o1=equals&v1=wontfix)
[status1.9.2](/buglist.cgi?f1=cf_status_192&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_192&o1=equals&v1=wontfix)Whiteboard: [sg:critical?][critsmash:investigating][1.9.2 branch and older][waiting on async plugins]waiting for firefox 4 to ship to get data to decide whether to take a branch fix → [sg:critical?][to be fixed by asynchronous plugin painting]

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=552002#a25871439_12352)• 14 years ago |

blocking2.0: --- → -

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=552002#a27137702_12352)• 14 years ago |

Depends on: [598425](/show_bug.cgi?id=598425 "RESOLVED FIXED - Asynchronous layer-based plugin painting on Mac")

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=552002#a35601575_12352)• 14 years ago |

[tracking-firefox6](/buglist.cgi?f1=cf_tracking_firefox6&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox6&o1=equals&v1=%2B)

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=552002#a35601590_12352)• 14 years ago |

[status-firefox5](/buglist.cgi?f1=cf_status_firefox5&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox5&o1=equals&v1=wontfix)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=552002#a35601755_1689)• 14 years ago |

[status2.0](/buglist.cgi?f1=cf_status_20&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_20&o1=equals&v1=wontfix)
[tracking-firefox5](/buglist.cgi?f1=cf_tracking_firefox5&o1=isnotempty):
--- → [-](/buglist.cgi?f1=cf_tracking_firefox5&o1=equals&v1=-)

|  | [Benjamin Smedberg](/user_profile?user_id=7044) |  |
| --- | --- | --- |
| [Comment 30](/show_bug.cgi?id=552002#c30)• 14 years ago |
|  | |

There's nothing to track for Firefox 6 here, mac async painting is going to land for 7.

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=552002#a38626840_12352)• 14 years ago |

[status-firefox6](/buglist.cgi?f1=cf_status_firefox6&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox6&o1=equals&v1=affected)
[tracking-firefox6](/buglist.cgi?f1=cf_tracking_firefox6&o1=isnotempty):
[+](/buglist.cgi?f1=cf_tracking_firefox6&o1=equals&v1=%2B) → [-](/buglist.cgi?f1=cf_tracking_firefox6&o1=equals&v1=-)
[tracking-firefox7](/buglist.cgi?f1=cf_tracking_firefox7&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox7&o1=equals&v1=%2B)

|  | [Nobody; OK to take it and work on it](/user_profile?user_id=1)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=552002#a39564239_1)• 14 years ago |

Crash Signature: [@ nsDOMEvent::QueryInterface(nsID const&, void\*\*) ]

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Comment 31](/show_bug.cgi?id=552002#c31)• 13 years ago |
|  | |

[Bug 598425](/show_bug.cgi?id=598425 "RESOLVED FIXED - Asynchronous layer-based plugin painting on Mac") landed in early June, so this is fixed in 7 and beyond!Status: NEW → RESOLVEDClosed: 13 years ago
[status-firefox6](/buglist.cgi?f1=cf_status_firefox6&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox6&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox6&o1=equals&v1=wontfix)
[status-firefox7](/buglist.cgi?f1=cf_status_firefox7&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox7&o1=equals&v1=fixed)
[status-firefox8](/buglist.cgi?f1=cf_status_firefox8&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox8&o1=equals&v1=fixed)
[tracking-firefox8](/buglist.cgi?f1=cf_tracking_firefox8&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox8&o1=equals&v1=%2B)Resolution: --- → FIXED

|  | [u279076](/user_profile?user_id=279076) |  |
| --- | --- | --- |
| [Comment 32](/show_bug.cgi?id=552002#c32)• 13 years ago |
|  | |

As per testcase-wanted keyword, is there something QA can do to verify this fix (apart from checking Socorro)?Whiteboard: [sg:critical?][to be fixed by asynchronous plugin painting] → [sg:critical?][to be fixed by asynchronous plugin painting][qa?]

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=552002#a115432123_1689)• 11 years ago |

Group: core-security

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=552002#a176601099_75935)• 9 years ago |

Keywords: [testcase-wanted](/buglist.cgi?keywords=testcase-wanted&resolution=---)

|  | [BMO Automation](/user_profile?user_id=546015) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=552002#a384310399_546015)• 3 years ago |

Product: Core → Core Graveyard
You need to [log in](/show_bug.cgi?id=552002&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Martijn Wargers (dead)](/user_profile?user_id=55600)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from bugzilla.mozilla.org_6551b307_20250125_210204.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/668941)
* [XML](/show_bug.cgi?ctype=xml&id=668941)

Closed
[Bug 668941](/show_bug.cgi?id=668941)

Opened 14 years ago
Closed 14 years ago

# "ASSERTION: frame crosses fixed continuation boundary" with rtl, pre-wrap, :first-letter

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

"ASSERTION: frame crosses fixed continuation boundary" with rtl, pre-wrap, :first-letter

## Categories

### (Core :: Layout: Text and Fonts, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=Layout%3A%20Text%20and%20Fonts#Layout%3A%20Text%20and%20Fonts)

Layout: Text and Fonts
▾

Core :: Layout: Text and Fonts

Issues with CSS font selection, font loading, text shaping and glyph selection, breaking, text decorations, bidirectional text processing, and white space processing. For issues with glyph rendering and font format support, see the Graphics: Text component.

Example bugs:

* line-breaking code does not handle supplementary-plane characters properly
* double or wavy decoration lines are not repainted correctly if specified on floating first letter

Specifications covered:

* CSS Fonts
* CSS Size Adjustment
* CSS Text
* CSS Text Decoration

[See Open Bugs in This Component](/buglist.cgi?product=Core&component=Layout%3A%20Text%20and%20Fonts&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=Layout%3A%20Text%20and%20Fonts&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=Layout%3A%20Text%20and%20Fonts)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

x86\_64

macOS

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

normal

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

---

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Performance Impact | --- |
| --- | --- |
| Webcompat Score | --- |
| Accessibility Severity | --- |
| a11y-review | --- |
| Webcompat Priority | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox5 | --- | [unaffected](/buglist.cgi?f1=cf_status_firefox5&o1=equals&v1=unaffected) |
| firefox7 | [+](/buglist.cgi?f1=cf_tracking_firefox7&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox7&o1=equals&v1=fixed) |
| firefox8 | --- | [fixed](/buglist.cgi?f1=cf_status_firefox8&o1=equals&v1=fixed) |
| status1.9.2 | --- | [unaffected](/buglist.cgi?f1=cf_status_192&o1=equals&v1=unaffected) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox5 |  | unaffected |
| firefox7 | + | fixed |
| firefox8 |  | fixed |
| status1.9.2 |  | unaffected |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: jruderman, Assigned: smontagu)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/0e30ca39ed75c9efeb4369d80a83b15a?d=mm&size=40)  [smontagu](/user_profile?user_id=11171)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/d2dc9227eafcd0ec5ba3712ee4f19b75?d=mm&size=40)  [jruderman](/user_profile?user_id=11608)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/e0f9759e1d7514ae4adfd806869e3c5d?d=mm&size=40)  [jfkthame](/user_profile?user_id=329583)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

1 person

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[263359](/show_bug.cgi?id=263359 "RESOLVED FIXED - bidi algorithm implementation inconsistent with msie (newlines in <pre>)"), [randomstyles](/show_bug.cgi?id=306939 "RESOLVED INACTIVE - [meta] Bugs found by Random Styles (adding random style properties to DOM elements)"), [randomclasses](/show_bug.cgi?id=331889 "RESOLVED INACTIVE - [meta] Bugs found with \"Random Classes\" (adding random CSS stylesheets)"), [665837](/show_bug.cgi?id=665837 "RESOLVED FIXED - \"ASSERTION: negative length\" with -moz-column, rtl, pre-line")

Dependency [tree](/showdependencytree.cgi?id=668941&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=668941)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: assertion, regression, testcase, Whiteboard: [sg:critical?] [landed m-c 7/12][qa-])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[assertion](/buglist.cgi?keywords=assertion&resolution=---),
[regression](/buglist.cgi?keywords=regression&resolution=---),
[testcase](/buglist.cgi?keywords=testcase&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[sg:critical?] [landed m-c 7/12][qa-]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [smontagu](/user_profile?user_id=11171) | [in-testsuite](#c5 "14 years ago") | + |
| --- | --- | --- |
| [smontagu](/user_profile?user_id=11171) | in-testsuite | + |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (2 files)

| [testcase](/attachment.cgi?id=543561)  [14 years ago](#c0)  [Jesse Ruderman](/user_profile?user_id=11608)   435 bytes, application/xhtml+xml |  | [Details](/attachment.cgi?id=543561&action=edit) |
| --- | --- | --- |
| [Patch](/attachment.cgi?id=544746)  [14 years ago](#c2)  [Simon Montagu :smontagu](/user_profile?user_id=11171)   4.26 KB, patch | roc : [review+](#c4 "14 years ago")  asa : [approval-mozilla-aurora+](#a1538569_5003 "14 years ago") | [Details](/attachment.cgi?id=544746&action=edit) | [Diff](/attachment.cgi?id=544746&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=668941&attachment=544746) |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Jesse Ruderman](/user_profile?user_id=11608)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=668941#c0)• 14 years ago |
|  | |

Attached file
[testcase](attachment.cgi?id=543561)
— [Details](attachment.cgi?id=543561&action=edit)

###!!! ASSERTION: frame tree not empty, but caller reported complete status: 'aSubtreeRoot->GetPrevInFlow()', file layout/base/nsLayoutUtils.cpp, line 4124
###!!! ASSERTION: frame crosses fixed continuation boundary: 'flowLength->mEndFlowOffset >= GetContentEnd()', file layout/generic/nsTextFrameThebes.cpp, line 643
The first bad revision is:
changeset: 99c270809649
user: Simon Montagu
date: Mon Jun 27 19:30:04 2011 +0300
summary: Don't overshoot the end of the sibling chain when copying text for bidi resolution. [Bug 665837](/show_bug.cgi?id=665837 "RESOLVED FIXED - \"ASSERTION: negative length\" with -moz-column, rtl, pre-line"), r=roc
Security-sensitive because there related testcases trigger scarier assertions, and because the regressor was security sensitive.

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=668941#c1)• 14 years ago |
|  | |

do regressions from such a simple fix mean we didn't really understand what was going on in [bug 665837](/show_bug.cgi?id=665837 "RESOLVED FIXED - \"ASSERTION: negative length\" with -moz-column, rtl, pre-line")? Assuming the worst because frames scare me, although this assertion may simply mean there are frames we're not displaying when we should.
Maybe we need different macros for that kind of "assertion" so we can tell the difference.
[status-firefox5](/buglist.cgi?f1=cf_status_firefox5&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_firefox5&o1=equals&v1=unaffected)
[status-firefox7](/buglist.cgi?f1=cf_status_firefox7&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox7&o1=equals&v1=affected)
[tracking-firefox6](/buglist.cgi?f1=cf_tracking_firefox6&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox6&o1=equals&v1=%2B)
[tracking-firefox7](/buglist.cgi?f1=cf_tracking_firefox7&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox7&o1=equals&v1=%2B)Whiteboard: [sg:critical?]

|  | [Simon Montagu :smontagu](/user_profile?user_id=11171)  Assignee |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=668941#c2)• 14 years ago |
|  | |

Attached patch

[Patch](attachment.cgi?id=544746&action=diff)
— [Details](attachment.cgi?id=544746&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=668941&attachment=544746)

Assignee: nobody → smontagu
[Attachment #544746](/attachment.cgi?id=544746&action=edit "Patch") -
Flags: review?(roc)

|  | [Simon Montagu :smontagu](/user_profile?user_id=11171)  Assignee |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=668941#c3)• 14 years ago |
|  | |

(In reply to [comment #1](/show_bug.cgi?id=668941#c1 "RESOLVED FIXED - \"ASSERTION: frame crosses fixed continuation boundary\" with rtl, pre-wrap, :first-letter"))
> do regressions from such a simple fix mean we didn't really understand what
> was going on in [bug 665837](/show_bug.cgi?id=665837 "RESOLVED FIXED - \"ASSERTION: negative length\" with -moz-column, rtl, pre-line")?
No, the fix for [bug 665837](/show_bug.cgi?id=665837 "RESOLVED FIXED - \"ASSERTION: negative length\" with -moz-column, rtl, pre-line") exposed a regression (silly mistake) in one of the patches for [bug 263359](/show_bug.cgi?id=263359 "RESOLVED FIXED - bidi algorithm implementation inconsistent with msie (newlines in <pre>)"): in <https://bugzilla.mozilla.org/attachment.cgi?id=498455&action=diff#a/layout/base/nsBidiPresUtils.cpp_sec3>, I didn't take into account that adding a condition to the if would sometimes incorrectly activate the else-clause. That caused the situation which triggers the assert: a first-letter frame with a fluid continuation whose child text frame has a fixed continuation.

|  | [Robert O'Callahan (:roc) (email my personal email if necessary)](/user_profile?user_id=5038) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=668941#c4)• 14 years ago |
|  | |

Comment on [attachment 544746](/attachment.cgi?id=544746 "Patch") [[details]](/attachment.cgi?id=544746&action=edit "Patch") [[diff]](/attachment.cgi?id=544746&action=diff "Patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=668941&attachment=544746)
Patch
Review of [attachment 544746](/attachment.cgi?id=544746 "Patch") [[details]](/attachment.cgi?id=544746&action=edit "Patch") [[diff]](/attachment.cgi?id=544746&action=diff "Patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=668941&attachment=544746):
-----------------------------------------------------------------
[Attachment #544746](/attachment.cgi?id=544746&action=edit "Patch") -
Flags: review?(roc) → review+

|  | [Simon Montagu :smontagu](/user_profile?user_id=11171)  Assignee |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=668941#c5)• 14 years ago |
|  | |

<http://hg.mozilla.org/mozilla-central/rev/f7f3f4ad573c>Status: NEW → RESOLVEDClosed: 14 years agoFlags: in-testsuite+Resolution: --- → FIXED

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=668941#a1103459_1689)• 14 years ago |

[status-firefox8](/buglist.cgi?f1=cf_status_firefox8&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox8&o1=equals&v1=fixed)

|  | [Asa Dotzler [:asa]](/user_profile?user_id=5003) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=668941#c6)• 14 years ago |
|  | |

Should this patch land on Aurora and or Beta? If so, can someone nominate?Whiteboard: [sg:critical?] → [sg:critical?] [landed m-c 7/12]

|  | [Simon Montagu :smontagu](/user_profile?user_id=11171)  Assignee |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=668941#c7)• 14 years ago |
|  | |

Comment on [attachment 544746](/attachment.cgi?id=544746 "Patch") [[details]](/attachment.cgi?id=544746&action=edit "Patch") [[diff]](/attachment.cgi?id=544746&action=diff "Patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=668941&attachment=544746)
Patch
This fixes a regression from [bug 263357](/show_bug.cgi?id=263357 "RESOLVED INVALID - P2P becomes Too slow if not stopped !!") and [bug 665837](/show_bug.cgi?id=665837 "RESOLVED FIXED - \"ASSERTION: negative length\" with -moz-column, rtl, pre-line") which were checked in on Aurora, so the fix should go on Aurora too. Beta is unaffected.
[Attachment #544746](/attachment.cgi?id=544746&action=edit "Patch") -
Flags: approval-mozilla-aurora?

|  | [Asa Dotzler [:asa]](/user_profile?user_id=5003) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=668941#a1538555_5003)• 14 years ago |

[status-firefox6](/buglist.cgi?f1=cf_status_firefox6&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_firefox6&o1=equals&v1=unaffected)
[tracking-firefox6](/buglist.cgi?f1=cf_tracking_firefox6&o1=isnotempty):
[+](/buglist.cgi?f1=cf_tracking_firefox6&o1=equals&v1=%2B) → ---

|  | [Asa Dotzler [:asa]](/user_profile?user_id=5003) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=668941#a1538569_5003)• 14 years ago |

[Attachment #544746](/attachment.cgi?id=544746&action=edit "Patch") -
Flags: approval-mozilla-aurora? → approval-mozilla-aurora+

|  | [[:Cww]](/user_profile?user_id=297228) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=668941#c8)• 14 years ago |
|  | |

smontagu, the first bug you referenced was last touched (and marked INVA) over 4 years ago, probably a typo?

|  | [Simon Montagu :smontagu](/user_profile?user_id=11171)  Assignee |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=668941#c9)• 14 years ago |
|  | |

(In reply to [comment #8](/show_bug.cgi?id=668941#c8 "RESOLVED FIXED - \"ASSERTION: frame crosses fixed continuation boundary\" with rtl, pre-wrap, :first-letter"))
> smontagu, the first bug you referenced was last touched (and marked INVA)
> over 4 years ago, probably a typo?
Yes, typo for [bug 263359](/show_bug.cgi?id=263359 "RESOLVED FIXED - bidi algorithm implementation inconsistent with msie (newlines in <pre>)")

|  | [Simon Montagu :smontagu](/user_profile?user_id=11171)  Assignee |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=668941#c10)• 14 years ago |
|  | |

<http://hg.mozilla.org/releases/mozilla-aurora/rev/ef4909389600>
[status-firefox6](/buglist.cgi?f1=cf_status_firefox6&o1=isnotempty):
[unaffected](/buglist.cgi?f1=cf_status_firefox6&o1=equals&v1=unaffected) → ---
[status-firefox7](/buglist.cgi?f1=cf_status_firefox7&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox7&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox7&o1=equals&v1=fixed)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=668941#a5065166_1689)• 13 years ago |

Blocks: [263359](/show_bug.cgi?id=263359 "RESOLVED FIXED - bidi algorithm implementation inconsistent with msie (newlines in <pre>)")

|  | [LegNeato](/user_profile?user_id=482154) |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=668941#c11)• 13 years ago |
|  | |

It looks like this regression was only on trunk and mozilla-aurora. If this doesn't apply to 1.9.2 please mark the status1.9.2 as unaffected. If it does, we'd like this in 1.9.2.21

|  | [Simon Montagu :smontagu](/user_profile?user_id=11171)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=668941#a5073191_11171)• 13 years ago |

[status1.9.2](/buglist.cgi?f1=cf_status_192&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_192&o1=equals&v1=unaffected)

|  | [u279076](/user_profile?user_id=279076) |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=668941#c12)• 13 years ago |
|  | |

qa- as no QA verification neededWhiteboard: [sg:critical?] [landed m-c 7/12] → [sg:critical?] [landed m-c 7/12][qa-]

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=668941#a17424995_1689)• 13 years ago |

Group: core-security
You need to [log in](/show_bug.cgi?id=668941&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Jesse Ruderman](/user_profile?user_id=11608)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from bugzilla.mozilla.org_d353956d_20250125_210205.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/669228)
* [XML](/show_bug.cgi?ctype=xml&id=669228)

Closed
[Bug 669228](/show_bug.cgi?id=669228)

Opened 14 years ago
Closed 13 years ago

# Crash with InstallTrigger, mozRequestAnimationFrame, throwing proxy

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Crash with InstallTrigger, mozRequestAnimationFrame, throwing proxy

## Categories

### (Core :: XPConnect, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=XPConnect#XPConnect)

XPConnect
▾

Core :: XPConnect
Facilitates calling between JavaScript and XPCOM components.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=XPConnect&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=XPConnect&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=XPConnect)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

x86\_64

macOS

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

critical

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla8

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Accessibility Severity | --- |
| --- | --- |
| Performance Impact | --- |
| Webcompat Priority | --- |
| Webcompat Score | --- |
| a11y-review | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox5 | [-](/buglist.cgi?f1=cf_tracking_firefox5&o1=equals&v1=-) | [wontfix](/buglist.cgi?f1=cf_status_firefox5&o1=equals&v1=wontfix) |
| firefox6 | [-](/buglist.cgi?f1=cf_tracking_firefox6&o1=equals&v1=-) | [wontfix](/buglist.cgi?f1=cf_status_firefox6&o1=equals&v1=wontfix) |
| firefox7 | [+](/buglist.cgi?f1=cf_tracking_firefox7&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox7&o1=equals&v1=fixed) |
| firefox8 | [+](/buglist.cgi?f1=cf_tracking_firefox8&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox8&o1=equals&v1=fixed) |
| blocking2.0 | --- | [-](/buglist.cgi?f1=cf_blocking_20&o1=equals&v1=-) |
| status2.0 | --- | [wontfix](/buglist.cgi?f1=cf_status_20&o1=equals&v1=wontfix) |
| status1.9.2 | --- | [unaffected](/buglist.cgi?f1=cf_status_192&o1=equals&v1=unaffected) |
| status1.9.1 | --- | [unaffected](/buglist.cgi?f1=cf_status_191&o1=equals&v1=unaffected) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox5 | - | wontfix |
| firefox6 | - | wontfix |
| firefox7 | + | fixed |
| firefox8 | + | fixed |
| blocking2.0 |  | - |
| status2.0 |  | wontfix |
| status1.9.2 |  | unaffected |
| relnote-firefox |  | --- |
| status1.9.1 |  | unaffected |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: jruderman, Assigned: mrbkap)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/89d2149736265010bfe669ce8c3075c0?d=mm&size=40)  [mrbkap](/user_profile?user_id=69426)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/d2dc9227eafcd0ec5ba3712ee4f19b75?d=mm&size=40)  [jruderman](/user_profile?user_id=11608)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/5111b810214a00377104f5ad3efefa26?d=mm&size=40)  [sefeng](/user_profile?user_id=625922)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

11 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: assertion, crash, testcase, Whiteboard: [sg:critical?][needs aurora landing for Fx7][qa-])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[assertion](/buglist.cgi?keywords=assertion&resolution=---),
[crash](/buglist.cgi?keywords=crash&resolution=---),
[testcase](/buglist.cgi?keywords=testcase&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[sg:critical?][needs aurora landing for Fx7][qa-]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |
|  | qe-verify |  |

## Crash Data

Signature:

[[@ GetContextFromObject ]](https://crash-stats.mozilla.org/signature/?signature=GetContextFromObject)

[[@ XPCWrappedNativeScope::GetContext ]](https://crash-stats.mozilla.org/signature/?signature=XPCWrappedNativeScope%3A%3AGetContext)

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (2 files, 1 obsolete file)

| [testcase (crashes Firefox when loaded)](/attachment.cgi?id=543838)  [14 years ago](#c0)  [Jesse Ruderman](/user_profile?user_id=11608)   379 bytes, text/html |  | [Details](/attachment.cgi?id=543838&action=edit) |
| --- | --- | --- |
| [Hacky fix](/attachment.cgi?id=544386)  [14 years ago](#c4)  [Blake Kaplan (:mrbkap) (inactive)](/user_profile?user_id=69426)   3.11 KB, patch |  | [Details](/attachment.cgi?id=544386&action=edit) | [Diff](/attachment.cgi?id=544386&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=669228&attachment=544386) |
| [Proposed fix v2](/attachment.cgi?id=548644)  [14 years ago](#c10)  [Blake Kaplan (:mrbkap) (inactive)](/user_profile?user_id=69426)   6.66 KB, patch | jorendorff : [review+](#c11 "14 years ago")  asa : [approval-mozilla-aurora+](#c15 "13 years ago")  asa : [approval-mozilla-beta-](#c15 "13 years ago") | [Details](/attachment.cgi?id=548644&action=edit) | [Diff](/attachment.cgi?id=548644&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=669228&attachment=548644) |

Show Obsolete

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Jesse Ruderman](/user_profile?user_id=11608)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=669228#c0)• 14 years ago |
|  | |

Attached file
[testcase (crashes Firefox when loaded)](attachment.cgi?id=543838)
— [Details](attachment.cgi?id=543838&action=edit)

###!!! ASSERTION: No scope has this global object!: 'OKIfNotInitialized', file /builds/slave/m-cen-osx64-dbg/build/js/src/xpconnect/src/xpcwrappednativescope.cpp, line 840
>XPCWrappedNativeScope::FindInJSObjectScope [js/src/xpconnect/src/xpcwrappednativescope.cpp:841]
>XPCWrappedNativeScope::FindInJSObjectScope [js/src/xpconnect/src/xpcprivate.h:1503]
>GetContextFromObject [js/src/xpconnect/src/xpcwrappedjsclass.cpp:574]
>nsXPCWrappedJSClass::CallMethod [js/src/xpconnect/src/xpcwrappedjsclass.cpp:1289]
>nsXPCWrappedJS::CallMethod [js/src/xpconnect/src/xpcwrappedjs.cpp:585]
>PrepareAndDispatch [xpcom/reflect/xptcall/src/md/unix/xptcstubs\_x86\_64\_darwin.cpp:153]
Debug crash: [@ XPCWrappedNativeScope::GetContext | GetContextFromObject]
Opt crash: [bp-be925f53-6a18-40b4-9829-a9a0a2110704](https://crash-stats.mozilla.org/report/index/be925f53-6a18-40b4-9829-a9a0a2110704)
Security-sensitive for now because this involves a chrome-content boundary.

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=669228#c1)• 14 years ago |
|  | |

So we end up passing the Proxy to FindInJSObjectScope. The parent of the Proxy is an object with JSClass "jdummy", which has no parent. So that's the global we find....
It looks like this global would come from a JS\_EnterCrossCompartmentCallScript when target->u.object is null.
The places where we do this are:
1) evalInSandbox, apparently.
2) XPCThrower::ThrowBadParam calling XPCThrower::BuildAndThrowException which
tries to create an exception, which calls nsXPConnect::GetCurrentJSStack
which calls XPCJSStackFrame::CreateStack which tries to enter a
compartment.
#2 is where the global object in question comes from....
Is the issue here that we're pushing a null JSContext on the stack when invoking requestAnimationFrame callbacks and that gets XPConnect confused after all?

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=669228#c2)• 14 years ago |
|  | |

Blake, can you have a look here?Assignee: nobody → mrbkapWhiteboard: [sg:critical?]

|  | [Blake Kaplan (:mrbkap) (inactive)](/user_profile?user_id=69426)  Assignee |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=669228#c3)• 14 years ago |
|  | |

This was a bit of a pain to track down. The testcase, as written is actually "fixed" by [bug 634156](/show_bug.cgi?id=634156 "RESOLVED FIXED - ConsoleAPI.js and InstallTrigger.js should not use sandboxes"). However, that fix is a workaround for the real problem (which I'm not yet sure how to fix). the problem, as bz found, is that we're ending up with a proxy whose parent is not an XPConnect global object. Then, later, we attempt to "call" the proxy, and XPConnect crashes.
The way that we end up with a proxy parented to a jdummy is that we have an exception on the stack when XPConnect calls JS\_EnterCrossCompartmentCallScript. That, in turn calls wrapPendingException which, in order to avoids leaks, calls setParent on the proxy.
The easiest short-term fix is to avoid the setParent call when we're about to use the jdummy global. The longer-term fix would be to not give proxies parents at all (which will actually be possible with compartment-per-global).

|  | [Blake Kaplan (:mrbkap) (inactive)](/user_profile?user_id=69426)  Assignee |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=669228#c4)• 14 years ago |
|  | |

Attached patch

[Hacky fix](attachment.cgi?id=544386&action=diff) (obsolete)
— [Details](attachment.cgi?id=544386&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=669228&attachment=544386)

I don't know of a way to test this... and it's pretty ugly.
[Attachment #544386](/attachment.cgi?id=544386&action=edit "Hacky fix") -
Flags: review?(gal)

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=669228#a249655_12352)• 14 years ago |

blocking2.0: --- → -
[status1.9.1](/buglist.cgi?f1=cf_status_191&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_191&o1=equals&v1=unaffected)
[status1.9.2](/buglist.cgi?f1=cf_status_192&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_192&o1=equals&v1=unaffected)
[status2.0](/buglist.cgi?f1=cf_status_20&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_20&o1=equals&v1=wontfix)
[status-firefox5](/buglist.cgi?f1=cf_status_firefox5&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox5&o1=equals&v1=wontfix)
[status-firefox6](/buglist.cgi?f1=cf_status_firefox6&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox6&o1=equals&v1=affected)
[status-firefox7](/buglist.cgi?f1=cf_status_firefox7&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox7&o1=equals&v1=affected)
[status-firefox8](/buglist.cgi?f1=cf_status_firefox8&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox8&o1=equals&v1=affected)
[tracking-firefox5](/buglist.cgi?f1=cf_tracking_firefox5&o1=isnotempty):
--- → [-](/buglist.cgi?f1=cf_tracking_firefox5&o1=equals&v1=-)
[tracking-firefox6](/buglist.cgi?f1=cf_tracking_firefox6&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox6&o1=equals&v1=%2B)
[tracking-firefox7](/buglist.cgi?f1=cf_tracking_firefox7&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox7&o1=equals&v1=%2B)
[tracking-firefox8](/buglist.cgi?f1=cf_tracking_firefox8&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox8&o1=equals&v1=%2B)

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=669228#c5)• 14 years ago |
|  | |

Andreas, can you review this security bug?

|  | [Asa Dotzler [:asa]](/user_profile?user_id=5003) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=669228#c6)• 14 years ago |
|  | |

Dveditz, would we consider a "pretty ugly" fix that's difficult to test for Firefox 6 with only a few weeks to go in the cycle?

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=669228#a1461863_1689)• 14 years ago |

Whiteboard: [sg:critical?] → [sg:critical?][needs r+ from gal]

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=669228#c7)• 14 years ago |
|  | |

Comment on [attachment 544386](/attachment.cgi?id=544386 "Hacky fix") [[details]](/attachment.cgi?id=544386&action=edit "Hacky fix") [[diff]](/attachment.cgi?id=544386&action=diff "Hacky fix") [[review]](/page.cgi?id=splinter.html&ignore=&bug=669228&attachment=544386)
Hacky fix
Jason, could you help review this sg:critical bug please? Andreas is overloaded atm.
[Attachment #544386](/attachment.cgi?id=544386&action=edit "Hacky fix") -
Flags: review?(gal) → review?(jorendorff)

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=669228#c8)• 14 years ago |
|  | |

Bear with me -- I don't really understand what's going on here, so I have a bunch of dumb questions.
Was Proxy.create necessary to trigger this? Why?
From what I can gather, the problem is that XPConnect crashes when it tries to call a certain kind of wrapped JSObject. If that's right, here are two approaches I might have tried:
- Make it an invariant of nsXPCWrappedJS that the wrapped JSObject is
parented to an XPConnect global. So, make the constructor fail gracefully
if it is asked to wrap an object like this one.
- Make nsXPCWrappedJS able to rwap such objects safely. So, make something
under nsXPCWrappedJS::CallMethod detect this case and fail gracefully.
It looks like this patch is trying to make such objects not exist. Is that right?
Precisely what kind of JSObject is problematic? \*Any\* object that's not parented to an XPConnect global?

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=669228#c9)• 14 years ago |
|  | |

So the answer to the main point in [comment 8](/show_bug.cgi?id=669228#c8 "RESOLVED FIXED - Crash with InstallTrigger, mozRequestAnimationFrame, throwing proxy") (about invariants) is that XPConnect assumes that all objects are parented to globals it knows about. It's a deeply rooted assumption. It would be totally impractical to enforce it at runtime every place any code passes a JSObject to XPConnect.
mrbkap and I talked about this at some length, and we ended up here:
<jorendorff> how about just getting rid of the AutoEnterScriptCompartment
use in XPCJSStackFrame?
<jorendorff> mrbkap: seems like you could expose AutoEnterFrameCompartment
instead, which could use the frame's scope chain instead (?)
<mrbkap> mm
<mrbkap> jorendorff: how about both?
<jorendorff> mrbkap: yeah, ok
<jorendorff> mrbkap: definitely
<jorendorff> the other AutoEnterScriptCompartment user is jsd, so
<jorendorff> we'll get there
<jorendorff> mrbkap: jdummy's days being numbered seems like a necessary
ingredient to me
<jorendorff> but in the meantime, we'll be extra careful with it -- fair
enough
<mrbkap> jorendorff: so, with compartment per global, we might be able
to get rid of parent for proxies altogether.
<mrbkap> Yeah.

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=669228#a1551970_281791)• 14 years ago |

[Attachment #544386](/attachment.cgi?id=544386&action=edit "Hacky fix") -
Flags: review?(jorendorff)

|  | [Blake Kaplan (:mrbkap) (inactive)](/user_profile?user_id=69426)  Assignee |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=669228#c10)• 14 years ago |
|  | |

Attached patch

[Proposed fix v2](attachment.cgi?id=548644&action=diff)
— [Details](attachment.cgi?id=548644&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=669228&attachment=548644)

I think this addresses your comments, jason. Let me know if I forgot anything.
I also went back and forth on how/where to expose JS\_EnterCrossCompartmentCallFrame/AutoEnterFramecompartment. Let me know if you have any comments on that. Is this going to get better with jsdbgapi2?
[Attachment #544386](/attachment.cgi?id=544386&action=edit "Hacky fix") -
Attachment is obsolete: true
[Attachment #548644](/attachment.cgi?id=548644&action=edit "Proposed fix v2") -
Flags: review?(jorendorff)

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791) |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=669228#c11)• 14 years ago |
|  | |

Comment on [attachment 548644](/attachment.cgi?id=548644 "Proposed fix v2") [[details]](/attachment.cgi?id=548644&action=edit "Proposed fix v2") [[diff]](/attachment.cgi?id=548644&action=diff "Proposed fix v2") [[review]](/page.cgi?id=splinter.html&ignore=&bug=669228&attachment=548644)
Proposed fix v2
Yep, that's it.
No comments on AutoEnterFrameCompartment; this seems fine.
Removing JSD will get rid of the one remaining use of AutoEnterScriptCompartment. So jsdbg2 is moving us in that direction. Separately, compartment-per-global would kill this problem. So either one.
[Attachment #548644](/attachment.cgi?id=548644&action=edit "Proposed fix v2") -
Flags: review?(jorendorff) → review+

|  | [Blake Kaplan (:mrbkap) (inactive)](/user_profile?user_id=69426)  Assignee |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=669228#c12)• 14 years ago |
|  | |

<http://hg.mozilla.org/integration/mozilla-inbound/rev/26e80814276e>Whiteboard: [sg:critical?][needs r+ from gal] → [sg:critical?][inbound]

|  | [(no longer active)](/user_profile?user_id=251051) |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=669228#c13)• 13 years ago |
|  | |

<http://hg.mozilla.org/mozilla-central/rev/26e80814276e>Status: NEW → RESOLVEDClosed: 13 years agoResolution: --- → FIXEDWhiteboard: [sg:critical?][inbound] → [sg:critical?]Target Milestone: --- → mozilla8

|  | [Blake Kaplan (:mrbkap) (inactive)](/user_profile?user_id=69426)  Assignee |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=669228#c14)• 13 years ago |
|  | |

Comment on [attachment 548644](/attachment.cgi?id=548644 "Proposed fix v2") [[details]](/attachment.cgi?id=548644&action=edit "Proposed fix v2") [[diff]](/attachment.cgi?id=548644&action=diff "Proposed fix v2") [[review]](/page.cgi?id=splinter.html&ignore=&bug=669228&attachment=548644)
Proposed fix v2
This patch should be safe enough to take on the branches.
[Attachment #548644](/attachment.cgi?id=548644&action=edit "Proposed fix v2") -
Flags: approval-mozilla-beta?
[Attachment #548644](/attachment.cgi?id=548644&action=edit "Proposed fix v2") -
Flags: approval-mozilla-aurora?

|  | [Asa Dotzler [:asa]](/user_profile?user_id=5003) |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=669228#c15)• 13 years ago |
|  | |

Comment on [attachment 548644](/attachment.cgi?id=548644 "Proposed fix v2") [[details]](/attachment.cgi?id=548644&action=edit "Proposed fix v2") [[diff]](/attachment.cgi?id=548644&action=diff "Proposed fix v2") [[review]](/page.cgi?id=splinter.html&ignore=&bug=669228&attachment=548644)
Proposed fix v2
Please land this on Aurora after it's had a few more days on m-c. I was gonna hold off until the next triage on Tuesday to mark it but we can all save a little time if I go ahead and mark it now. Thanks.
[Attachment #548644](/attachment.cgi?id=548644&action=edit "Proposed fix v2") -
Flags: approval-mozilla-beta?
[Attachment #548644](/attachment.cgi?id=548644&action=edit "Proposed fix v2") -
Flags: approval-mozilla-beta-
[Attachment #548644](/attachment.cgi?id=548644&action=edit "Proposed fix v2") -
Flags: approval-mozilla-aurora?
[Attachment #548644](/attachment.cgi?id=548644&action=edit "Proposed fix v2") -
Flags: approval-mozilla-aurora+

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=669228#c16)• 13 years ago |
|  | |

Since the beta approval for the fix was denied we won't be fixing this for 6.
[status-firefox6](/buglist.cgi?f1=cf_status_firefox6&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox6&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox6&o1=equals&v1=wontfix)
[tracking-firefox6](/buglist.cgi?f1=cf_tracking_firefox6&o1=isnotempty):
[+](/buglist.cgi?f1=cf_tracking_firefox6&o1=equals&v1=%2B) → [-](/buglist.cgi?f1=cf_tracking_firefox6&o1=equals&v1=-)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=669228#a3275438_1689)• 13 years ago |

Whiteboard: [sg:critical?] → [sg:critical?][needs aurora landing for Fx7]

|  | [Blake Kaplan (:mrbkap) (inactive)](/user_profile?user_id=69426)  Assignee |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=669228#c17)• 13 years ago |
|  | |

<http://hg.mozilla.org/releases/mozilla-aurora/rev/25b41e0dcd7d>
Also marking as being fixed in Firefox 8, since this is fixed on trunk.
[status-firefox7](/buglist.cgi?f1=cf_status_firefox7&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox7&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox7&o1=equals&v1=fixed)
[status-firefox8](/buglist.cgi?f1=cf_status_firefox8&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox8&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox8&o1=equals&v1=fixed)

|  | [u279076](/user_profile?user_id=279076) |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=669228#c18)• 13 years ago |
|  | |

qa- as no QA fix verification neededWhiteboard: [sg:critical?][needs aurora landing for Fx7] → [sg:critical?][needs aurora landing for Fx7][qa-]

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=669228#a17178640_1689)• 13 years ago |

Group: core-security

|  | [Kyle Huey (Exited; not receiving bugmail, old account, do not use)](/user_profile?user_id=336670) |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=669228#c19)• 13 years ago |
|  | |

Did the testcase land?
You need to [log in](/show_bug.cgi?id=669228&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Jesse Ruderman](/user_profile?user_id=11608)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review


