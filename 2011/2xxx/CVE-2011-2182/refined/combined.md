=== Content from www.openwall.com_7f33e8ad_20250125_102043.html ===


| [Openwall](/) * [Products](/)   + [Openwall GNU/\*/Linux   *server OS*](/Owl/)+ [Linux Kernel Runtime Guard](/lkrg/)+ [John the Ripper   *password cracker*](/john/)         - [Free & Open Source for any platform](/john/)- [in the cloud](/john/cloud/)- [Pro for Linux](/john/pro/linux/)- [Pro for macOS](/john/pro/macosx/)+ [Wordlists   *for password cracking*](/wordlists/)+ [passwdqc   *policy enforcement*](/passwdqc/)             - [Free & Open Source for Unix](/passwdqc/)- [Pro for Windows (Active Directory)](/passwdqc/windows/)+ [yescrypt   *KDF & password hashing*](/yescrypt/)+ [yespower   *Proof-of-Work (PoW)*](/yespower/)+ [crypt\_blowfish   *password hashing*](/crypt/)+ [phpass   *ditto in PHP*](/phpass/)+ [tcb   *better password shadowing*](/tcb/)+ [Pluggable Authentication Modules](/pam/)+ [scanlogd   *port scan detector*](/scanlogd/)+ [popa3d   *tiny POP3 daemon*](/popa3d/)+ [blists   *web interface to mailing lists*](/blists/)+ [msulogin   *single user mode login*](/msulogin/)+ [php\_mt\_seed   *mt\_rand() cracker*](/php_mt_seed/)* [Services](/services/)* Publications       + [Articles](/articles/)+ [Presentations](/presentations/)* Resources         + [Mailing lists](/lists/)+ [Community wiki](https://openwall.info/wiki/)+ [Source code repositories (GitHub)](https://github.com/openwall)+ [Source code repositories (CVSweb)](https://cvsweb.openwall.com)+ [File archive & mirrors](/mirrors/)+ [How to verify digital signatures](/signatures/)+ [OVE IDs](/ove/)* [What's new](/news) | |
| --- | --- |

| | [Hash Suite - Windows password security audit tool. GUI, reports in PDF.](https://hashsuite.openwall.net) | | --- | |
| --- | --- |

[[<prev]](../../../2011/06/04/3) [[next>]](../../../2011/06/06/1) [[<thread-prev]](../../../2011/06/03/3) [[day]](.) [[month]](..) [[year]](../..) [[list]](../../..)
```

Message-ID: <4DEB724D.5000602@pre-sense.de>
Date: Sun, 05 Jun 2011 14:10:53 +0200
From: Timo Warns <warns@...-sense.de>
To: oss-security@...ts.openwall.com
CC: Eugene Teo <eugene@...hat.com>, Josh Bressers <bressers@...hat.com>,
 coley <coley@...re.org>
Subject: Re: CVE request: kernel: fs/partitions: Kernel heap
 overflow via corrupted LDM partition tables

On 03.06.2011 08:47, Eugene Teo wrote:
> On 02/25/2011 04:22 AM, Josh Bressers wrote:
>>
>> ----- Original Message -----
>>> On Thu, 2011-02-24 at 09:25 +0800, Eugene Teo wrote:
>>>> On 02/24/2011 03:59 AM, Josh Bressers wrote:
>>>>> ----- Original Message -----
>>>>>>
>>>>>> The kernel automatically evaluates partition tables of storage
>>>>>> devices.  The code for evaluating LDM partitions (in
>>>>>> fs/partitions/ldm.c) contains a bug that allows to overflow the
>>>>>> kernel heap. It may be possible to escalate privileges by exploiting
>>>>>> this bug.
> [...]
>> I would still like something along the lines of a proposed patch. I believe
>> you folks (as you're much brighter than me), but I still don't quite grasp
>> the difference. I suspect there is enough public information for MITRE to
>> public a CVE though, so please use CVE-2011-1017.
>
> It was reported that the fix for this is insufficient. I have assigned
> CVE-2011-2182 to this. See <https://lkml.org/lkml/2011/5/6/407>.
>
> Timo, can you please post the patch here once you have submitted it to
> lkml for review. Thanks.

Greg has posted the patch to LKML (<http://lkml.org/lkml/2011/6/1/119>).

The patch:

commit cae13fe4cc3f24820ffb990c09110626837e85d4 upstream.

As Ben Hutchings discovered [1], the patch for CVE-2011-1017 (buffer
overflow in ldm_frag_add) is not sufficient.  The original patch in
commit c340b1d64000 ("fs/partitions/ldm.c: fix oops caused by corrupted
partition table") does not consider that, for subsequent fragments,
previously allocated memory is used.

[1] <http://lkml.org/lkml/2011/5/6/407>

Reported-by: Ben Hutchings <ben@...adent.org.uk>
Signed-off-by: Timo Warns <warns@...-sense.de>
Signed-off-by: Linus Torvalds <torvalds@...ux-foundation.org>
Signed-off-by: Greg Kroah-Hartman <gregkh@...e.de>

---
 fs/partitions/ldm.c |    5 +++++
 1 file changed, 5 insertions(+)
--- a/fs/partitions/ldm.c
+++ b/fs/partitions/ldm.c
@@ -1335,6 +1335,11 @@ static bool ldm_frag_add (const u8 *data

 	list_add_tail (&f->list, frags);
 found:
+	if (rec >= f->num) {
+		ldm_error("REC value (%d) exceeds NUM value (%d)", rec, f->num);
+		return false;
+	}
+
 	if (f->map & (1 << rec)) {
 		ldm_error ("Duplicate VBLK, part %d.", rec);
 		f->map &= 0x7F;			/* Mark the group as broken */

```

[Powered by blists](https://www.openwall.com/blists/) - [more mailing lists](https://lists.openwall.net)

Please check out the
[Open Source Software Security Wiki](https://oss-security.openwall.org/wiki/), which is counterpart to this
[mailing list](https://oss-security.openwall.org/wiki/mailing-lists/oss-security).

Confused about [mailing lists](/lists/) and their use?
[Read about mailing lists on Wikipedia](https://en.wikipedia.org/wiki/Electronic_mailing_list)
and check out these
[guidelines on proper formatting of your messages](https://www.complang.tuwien.ac.at/anton/mail-news-errors.html).



=== Content from lkml.org_9e140155_20250126_075810.html ===


| [lkml.org](/) | Â | [[lkml]](/lkml) Â  [[2011]](/lkml/2011) Â  [[May]](/lkml/2011/5) Â  [[6]](/lkml/2011/5/6) Â  [[last100]](/lkml/last100) Â  [RSS Feed](/rss.php)Views: [wrap][no wrap] Â  [[headers]](/lkml/mheaders/2011/5/6/407)Â  [[forward]](/lkml/bounce/2011/5/6/407)Â | Â |
| --- | --- | --- | --- |
| Messages in this thread  * [First message in thread](/lkml/2011/5/5/341) * [Greg KH](/lkml/2011/5/5/341)   + [Greg KH](/lkml/2011/5/5/307)   + [Greg KH](/lkml/2011/5/5/308)   + [Greg KH](/lkml/2011/5/5/309)   + [Greg KH](/lkml/2011/5/5/310)   + [Greg KH](/lkml/2011/5/5/311)   + [Greg KH](/lkml/2011/5/5/312)   + [Greg KH](/lkml/2011/5/5/313)   + [Greg KH](/lkml/2011/5/5/314)     - [Ben Hutchings](/lkml/2011/5/6/395)       * [Jesper Juhl](/lkml/2011/5/9/322)         + [Ben Hutchings](/lkml/2011/5/9/344)   + [Greg KH](/lkml/2011/5/5/315)   + [Greg KH](/lkml/2011/5/5/316)   + [Greg KH](/lkml/2011/5/5/317)   + [Greg KH](/lkml/2011/5/5/318)   + [Greg KH](/lkml/2011/5/5/319)   + [Greg KH](/lkml/2011/5/5/320)   + [Greg KH](/lkml/2011/5/5/321)     - [Ben Hutchings](/lkml/2011/5/9/207)       * [Timo Warns](/lkml/2011/5/9/207)   + [Greg KH](/lkml/2011/5/5/322)   + [Greg KH](/lkml/2011/5/5/323)   + [Greg KH](/lkml/2011/5/5/324)   + [Greg KH](/lkml/2011/5/5/325)   + [Greg KH](/lkml/2011/5/5/326)   + [Greg KH](/lkml/2011/5/5/327)   + [Greg KH](/lkml/2011/5/5/328)   + [Greg KH](/lkml/2011/5/5/329)   + [Greg KH](/lkml/2011/5/5/330)   + [Greg KH](/lkml/2011/5/5/331)   + [Greg KH](/lkml/2011/5/5/332)   + [Greg KH](/lkml/2011/5/5/333)   + [Greg KH](/lkml/2011/5/5/334)   + [Greg KH](/lkml/2011/5/5/335)   + [Greg KH](/lkml/2011/5/5/336)   + [Greg KH](/lkml/2011/5/5/337)   + [Greg KH](/lkml/2011/5/5/338)   + [Greg KH](/lkml/2011/5/5/339)   + [Greg KH](/lkml/2011/5/5/340)   + [Greg KH](/lkml/2011/5/5/342)   + [Greg KH](/lkml/2011/5/5/343)     - ["Jim Schutt"](/lkml/2011/5/6/169)       * [Greg KH](/lkml/2011/5/6/205)         + [James Bottomley](/lkml/2011/5/6/207)         + [Chuck Ebbert](/lkml/2011/5/7/55)   + [Greg KH](/lkml/2011/5/5/344)   + [Greg KH](/lkml/2011/5/5/345)   + [Chuck Ebbert](/lkml/2011/5/6/32)     - [David Miller](/lkml/2011/5/6/33)       * [Greg KH](/lkml/2011/5/9/332)   + [Chuck Ebbert](/lkml/2011/5/9/245)     - [Greg KH](/lkml/2011/5/9/333) | / | | | From | Ben Hutchings <> | | --- | --- | | Date | Sat, 07 May 2011 03:24:11 +0100 | | Subject | Re: [Stable-review] [patch 35/38] fs/partitions/ldm.c: fix oops caused by corrupted partition table | |  | | --- | --- | --- | --- | --- | --- | --- | --- |  ``` On Thu, 2011-05-05 at 17:11 -0700, Greg KH wrote:> 2.6.38-stable review patch.  If anyone has any objections, please let us know.> > ------------------> > From: Timo Warns <Warns@pre-sense.de>> > commit c340b1d640001c8c9ecff74f68fd90422ae2448a upstream.> > The kernel automatically evaluates partition tables of storage devices.> The code for evaluating LDM partitions (in fs/partitions/ldm.c) contains> a bug that causes a kernel oops on certain corrupted LDM partitions.> A kernel subsystem seems to crash, because, after the oops, the kernel no> longer recognizes newly connected storage devices.> > The patch validates the value of vblk_size.I don't think this actually fixes the vulnerability, and I don't thinkthis code works at all.> [akpm@linux-foundation.org: coding-style fixes]> Signed-off-by: Timo Warns <warns@pre-sense.de>> Cc: Eugene Teo <eugeneteo@kernel.sg>> Cc: Harvey Harrison <harvey.harrison@gmail.com>> Cc: Richard Russon <rich@flatcap.org>> Signed-off-by: Andrew Morton <akpm@linux-foundation.org>> Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>> Signed-off-by: Greg Kroah-Hartman <gregkh@suse.de>> > --->  fs/partitions/ldm.c |   16 ++++++++++++---->  1 file changed, 12 insertions(+), 4 deletions(-)> > --- a/fs/partitions/ldm.c> +++ b/fs/partitions/ldm.c> @@ -1299,6 +1299,11 @@ static bool ldm_frag_add (const u8 *data> >  	BUG_ON (!data || !frags);> > +	if (size < 2 * VBLK_SIZE_HEAD) {> +		ldm_error("Value of size is to small.");> +		return false;> +	}> +>  	group = get_unaligned_be32(data + 0x08);>  	rec   = get_unaligned_be16(data + 0x0C);>  	num   = get_unaligned_be16(data + 0x0E);> @@ -1306,6 +1311,10 @@ static bool ldm_frag_add (const u8 *data>  		ldm_error ("A VBLK claims to have %d parts.", num);>  		return false;>  	}> +	if (rec >= num) {> +		ldm_error("REC value (%d) exceeds NUM value (%d)", rec, num);> +		return false;> +	}This is fine for the first fragment we find, when we allocate memorybased on 'num'.  However, when we add another fragment, we need tocompare with f->num.  So there still seems to be the possibility of abuffer overflow.>  	list_for_each (item, frags) {>  		f = list_entry (item, struct frag, list);> @@ -1334,10 +1343,9 @@ found:> >  	f->map |= (1 << rec);> > -	if (num > 0) {> -		data += VBLK_SIZE_HEAD;> -		size -= VBLK_SIZE_HEAD;> -	}> +	data += VBLK_SIZE_HEAD;> +	size -= VBLK_SIZE_HEAD;> +>>  	memcpy (f->data+rec*(size-VBLK_SIZE_HEAD)+VBLK_SIZE_HEAD, data, size);> >  	return true;The offset used for the destination means that the first VBLK_SIZE_HEADbytes of f->data are never initialised!I suspect (without any knowledge of LDM) that the intent was to use theheader from the first fragment and drop it from the subsequentfragments, like this:	if (rec == 0)		memcpy(f->data, data, VBLK_SIZE_HEAD);	data += VBLK_SIZE_HEAD;	size -= VBLK_SIZE_HEAD;	memcpy(f->data + VBLK_SIZE_HEAD + rec * size, data, size);Ben.-- Ben HutchingsOnce a job is fouled up, anything done to improve it makes it worse.[unhandled content-type:application/pgp-signature] ``` | \ |
| Â |
| Â | \ | Â | / |
| Â | | Last update: 2011-05-07 04:27 Â Â  [from the cache]Â©2003-2020 [Jasper Spaans](http://blog.jasper.es/)|hosted at [Digital Ocean](https://www.digitalocean.com/?refcode=9a8e99d24cf9) and my Meterkast|[Read the blog](http://blog.jasper.es/categories.html#lkml-ref) | Â |



=== Content from github.com_a3c30e17_20250125_102044.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftorvalds%2Flinux%2Fcommit%2Fcae13fe4cc3f24820ffb990c09110626837e85d4)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftorvalds%2Flinux%2Fcommit%2Fcae13fe4cc3f24820ffb990c09110626837e85d4)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=torvalds%2Flinux)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[torvalds](/torvalds)
/
**[linux](/torvalds/linux)**
Public

* [Notifications](/login?return_to=%2Ftorvalds%2Flinux) You must be signed in to change notification settings
* [Fork
  54.9k](/login?return_to=%2Ftorvalds%2Flinux)
* [Star
   186k](/login?return_to=%2Ftorvalds%2Flinux)

* [Code](/torvalds/linux)
* [Pull requests
  437](/torvalds/linux/pulls)
* [Actions](/torvalds/linux/actions)
* [Projects
  0](/torvalds/linux/projects)
* [Security](/torvalds/linux/security)
* [Insights](/torvalds/linux/pulse)

Additional navigation options

* [Code](/torvalds/linux)
* [Pull requests](/torvalds/linux/pulls)
* [Actions](/torvalds/linux/actions)
* [Projects](/torvalds/linux/projects)
* [Security](/torvalds/linux/security)
* [Insights](/torvalds/linux/pulse)

## Commit

[Permalink](/torvalds/linux/commit/cae13fe4cc3f24820ffb990c09110626837e85d4)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Fix for buffer overflow in ldm\_frag\_add not sufficient

[Browse files](/torvalds/linux/tree/cae13fe4cc3f24820ffb990c09110626837e85d4)
Browse the repository at this point in the history

```
As Ben Hutchings discovered [1], the patch for [CVE-2011-1017](https://github.com/advisories/GHSA-2j53-64jx-6w47 "CVE-2011-1017") (buffer
overflow in ldm_frag_add) is not sufficient.  The original patch in
commit [c340b1d](https://github.com/torvalds/linux/commit/c340b1d640001c8c9ecff74f68fd90422ae2448a) ("fs/partitions/ldm.c: fix oops caused by corrupted
partition table") does not consider that, for subsequent fragments,
previously allocated memory is used.

[1] <http://lkml.org/lkml/2011/5/6/407>

Reported-by: Ben Hutchings <ben@decadent.org.uk>
Signed-off-by: Timo Warns <warns@pre-sense.de>
Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
```

* Loading branch information

[![@torvalds](https://avatars.githubusercontent.com/u/1024025?s=40&v=4)](/torvalds)

Timo Warns
authored and
[torvalds](/torvalds/linux/commits?author=torvalds "View all commits by torvalds")
committed
May 20, 2011

1 parent
[e6c9366](/torvalds/linux/commit/e6c9366b2adb52cba64b359b3050200743c7568c)

commit cae13fe

Showing
**1 changed file**
with
**5 additions**
and
**0 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

## There are no files selected for viewing

5 changes: 5 additions & 0 deletions

5
[fs/partitions/ldm.c](#diff-6785582ddc760735ea647b2956ca61b713d91142a736a5725a92f3e87d2032a0 "fs/partitions/ldm.c")

Show comments

[View file](/torvalds/linux/blob/cae13fe4cc3f24820ffb990c09110626837e85d4/fs/partitions/ldm.c)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -1335,6 +1335,11 @@ static bool ldm\_frag\_add (const u8 \*data, int size, struct list\_head \*frags) |
|  |  |  |
|  |  | list\_add\_tail (&f->list, frags); |
|  |  | found: |
|  |  | if (rec >= f->num) { |
|  |  | ldm\_error("REC value (%d) exceeds NUM value (%d)", rec, f->num); |
|  |  | return false; |
|  |  | } |
|  |  |  |
|  |  | if (f->map & (1 << rec)) { |
|  |  | ldm\_error ("Duplicate VBLK, part %d.", rec); |
|  |  | f->map &= 0x7F; /\* Mark the group as broken \*/ |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `cae13fe`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftorvalds%2Flinux%2Fcommit%2Fcae13fe4cc3f24820ffb990c09110626837e85d4) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


