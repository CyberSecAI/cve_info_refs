=== Content from hg.prosody.im_d11b1203_20250125_113212.html ===

[Toggle navigation](#navbar)
[Prosody IM](/)

* [Download](//prosody.im/download)
* [Documentation](//prosody.im/doc)
* [Support](//prosody.im/discuss)
* [Issues](//prosody.im/bugs)
* [Source](//prosody.im/source)
* [Dev docs](//prosody.im/doc/developers)

üîç
[?](/0.8/help/revsets)

# Prosody IM 0.8

* [summary](/0.8/)
* [browse](/0.8/file/5305a665bdd4)
* [changes](/0.8/shortlog/5305a665bdd4)
* [graph](/0.8/graph/5305a665bdd4)

### changeset 5305a665bdd4

util.xmppstream: Reject XML comments, processing instructions and (if supported by LuaExpat) DTDs. If not supported, log a warning.

author
Matthew Wild
date
2011-06-01
parents
[403aba5e49d5](/0.8/rev/403aba5e49d5)
children
 [67ce42aa7419](/0.8/rev/67ce42aa7419)
topic
[?](https://bz.mercurial-scm.org/show_bug.cgi?id=6826)
files

* [util/xmppstream.lua](/0.8/file/5305a665bdd4/util/xmppstream.lua)

#### 1 files changed, 21 insertions(+), 0 deletions(-)

[‚Üì Download patch](/0.8/raw-rev/5305a665bdd4)

| [util/xmppstream.lua](#l1.1) | 21 |  |
| --- | --- | --- |

```

--- a/util/xmppstream.lua	Wed May 04 23:12:53 2011 +0100
+++ b/util/xmppstream.lua	Wed Jun 01 23:02:10 2011 +0100
@@ -16,6 +16,16 @@

 local default_log = require "util.logger".init("xmppstream");

+-- COMPAT: w/LuaExpat 1.1.0
+local lxp_supports_doctype = pcall(lxp.new, { StartDoctypeDecl = false });
+
+if not lxp_supports_doctype then
+	default_log("warn", "The version of LuaExpat on your system leaves Prosody "
+		.."vulnerable to denial-of-service attacks. You should upgrade to "
+		.."LuaExpat 1.1.1 or higher as soon as possible. See "
+		.."http://prosody.im/doc/depends#luaexpat for more information.");
+end
+
 local error = error;

 module "xmppstream"
@@ -150,6 +160,17 @@
 		end
 	end

+	local function restricted_handler()
+		cb_error(session, "parse-error", "restricted-xml", "Restricted XML, see RFC 6120 section 11.1.");
+	end
+
+	if lxp_supports_doctype then
+		xml_handlers.StartDoctypeDecl = restricted_handler;
+	end
+	xml_handlers.Comment = restricted_handler;
+	xml_handlers.StartCdataSection = restricted_handler;
+	xml_handlers.ProcessingInstruction = restricted_handler;
+
 	local function reset()
 		stanza, chardata = nil, {};
 	end
```



=== Content from hg.prosody.im_01f48ff4_20250125_113212.html ===

[Toggle navigation](#navbar)
[Prosody IM](/)

* [Download](//prosody.im/download)
* [Documentation](//prosody.im/doc)
* [Support](//prosody.im/discuss)
* [Issues](//prosody.im/bugs)
* [Source](//prosody.im/source)
* [Dev docs](//prosody.im/doc/developers)

üîç
[?](/0.8/help/revsets)

# Prosody IM 0.8

* [summary](/0.8/)
* [browse](/0.8/file/ee6a18f10a8d)
* [changes](/0.8/shortlog/ee6a18f10a8d)
* [graph](/0.8/graph/ee6a18f10a8d)

### changeset ee6a18f10a8d

xmlhandlers/xmppstream: Stop the parser when encountering restricted XML, completing the fix for the billion laughs attack

author
Matthew Wild
date
2011-06-02
parents
[65e2c089d138](/0.8/rev/65e2c089d138)
children
 [8fde6b6b4919](/0.8/rev/8fde6b6b4919)
topic
[?](https://bz.mercurial-scm.org/show_bug.cgi?id=6826)
files

* [core/xmlhandlers.lua](/0.8/file/ee6a18f10a8d/core/xmlhandlers.lua)

#### 1 files changed, 4 insertions(+), 1 deletions(-)

[‚Üì Download patch](/0.8/raw-rev/ee6a18f10a8d)

| [core/xmlhandlers.lua](#l1.1) | 5 |  |
| --- | --- | --- |

```

--- a/core/xmlhandlers.lua	Thu Jun 02 00:23:41 2011 +0100
+++ b/core/xmlhandlers.lua	Thu Jun 02 15:19:05 2011 +0100
@@ -145,8 +145,11 @@
 			end
 		end

-		local function restricted_handler()
+		local function restricted_handler(parser)
 			cb_error(session, "parse-error", "restricted-xml", "Restricted XML, see RFC 6120 section 11.1.");
+			if not parser:stop() then
+				error("Failed to abort parsing");
+			end
 		end

 		if lxp_supports_doctype then
```



=== Content from www.openwall.com_ffa4cf82_20250125_113213.html ===


| [Openwall](/) * [Products](/)   + [Openwall GNU/\*/Linux ¬† *server OS*](/Owl/)+ [Linux Kernel Runtime Guard](/lkrg/)+ [John the Ripper ¬† *password cracker*](/john/)         - [Free & Open Source for any platform](/john/)- [in the cloud](/john/cloud/)- [Pro for Linux](/john/pro/linux/)- [Pro for macOS](/john/pro/macosx/)+ [Wordlists ¬† *for password cracking*](/wordlists/)+ [passwdqc ¬† *policy enforcement*](/passwdqc/)             - [Free & Open Source for Unix](/passwdqc/)- [Pro for Windows (Active Directory)](/passwdqc/windows/)+ [yescrypt ¬† *KDF & password hashing*](/yescrypt/)+ [yespower ¬† *Proof-of-Work (PoW)*](/yespower/)+ [crypt\_blowfish ¬† *password hashing*](/crypt/)+ [phpass ¬† *ditto in PHP*](/phpass/)+ [tcb ¬† *better password shadowing*](/tcb/)+ [Pluggable Authentication Modules](/pam/)+ [scanlogd ¬† *port scan detector*](/scanlogd/)+ [popa3d ¬† *tiny POP3 daemon*](/popa3d/)+ [blists ¬† *web interface to mailing lists*](/blists/)+ [msulogin ¬† *single user mode login*](/msulogin/)+ [php\_mt\_seed ¬† *mt\_rand() cracker*](/php_mt_seed/)* [Services](/services/)* Publications       + [Articles](/articles/)+ [Presentations](/presentations/)* Resources         + [Mailing lists](/lists/)+ [Community wiki](https://openwall.info/wiki/)+ [Source code repositories (GitHub)](https://github.com/openwall)+ [Source code repositories (CVSweb)](https://cvsweb.openwall.com)+ [File archive & mirrors](/mirrors/)+ [How to verify digital signatures](/signatures/)+ [OVE IDs](/ove/)* [What's new](/news) | |
| --- | --- |

| | [Hash Suite - Windows password security audit tool. GUI, reports in PDF.](https://hashsuite.openwall.net) | | --- | |
| --- | --- |

[[<prev]](5) [[next>]](../../../2011/06/15/1) [[thread-next>]](../../../2011/06/15/5) [[day]](.) [[month]](..) [[year]](../..) [[list]](../../..)
```

Message-ID: <BANLkTi=GRtrzKW=oGkS=4TJrN7PnvmJA1Q@mail.gmail.com>
Date: Tue, 14 Jun 2011 22:50:32 +0200
From: Wouter Coekaerts <wouter@...kaerts.be>
To: oss-security@...ts.openwall.com
Cc: Yann Kerherve <yann.kerherve@...il.com>, Matthew Wild <matthew@...sody.im>
Subject: CVE Request: prosody DoS, djabberd external entity injection

Hi,

As far as I know, there's no CVE for these ones yet. Could you assign one?
* prosody billion laughs DoS: <http://blog.prosody.im/prosody-0-8-1-released/>
* djabberd external entity injection:
[http://groups.google.com/group/djabberd/browse_thread/thread/47974331c37e54c5#](http://groups.google.com/group/djabberd/browse_thread/thread/47974331c37e54c5)

Btw, a blog post about these and the other recent jabber billion
laughs vulnerabilities:
<http://wouter.coekaerts.be/2011/jabber-dos>

Regards,

Wouter.

```

[Powered by blists](https://www.openwall.com/blists/) - [more mailing lists](https://lists.openwall.net)

Please check out the
[Open Source Software Security Wiki](https://oss-security.openwall.org/wiki/), which is counterpart to this
[mailing list](https://oss-security.openwall.org/wiki/mailing-lists/oss-security).

Confused about [mailing lists](/lists/) and their use?
[Read about mailing lists on Wikipedia](https://en.wikipedia.org/wiki/Electronic_mailing_list)
and check out these
[guidelines on proper formatting of your messages](https://www.complang.tuwien.ac.at/anton/mail-news-errors.html).



=== Content from prosody.im_7c745707_20250125_113212.html ===

[Toggle navigation](#navbar)
[Prosody IM](/)

* [Download](//prosody.im/download)
* [Documentation](//prosody.im/doc)
* [Support](//prosody.im/discuss)
* [Issues](//prosody.im/bugs)
* [Source](//prosody.im/source)
* [Dev docs](//prosody.im/doc/developers)
* [@prosodyim](https://fosstodon.org/%40prosodyim)
* [Table of contents](#TOC)

# 0.8.1 Release Notes

*Released 2011-06-03*

This is a security and bugfix release for the 0.8 branch. This
release contains fixes for a couple of major issues, and it is strongly
recommended that you upgrade.

Some of you may already be aware of the "billion laughs"
denial-of-service attack which was discovered to work against a number
of XMPP servers recently. Due to accidental oversight the Prosody team
was not notified ahead of the issue being made public, so we have worked
hard the past couple of days to prepare this release as soon as we
could.

In addition to upgrading Prosody, you **MUST** also
upgrade the LuaExpat library to 1.2.0 to prevent the attack - this
should hopefully be arriving in your distribution shortly, alternatively
it can be installed using [luarocks](https://luarocks.org/).
See [here](/doc/depends#luaexpat) for details.

A summary of changes in this release:

* Reject XML DTDs, comments and processing instructions, preventing
  the "billion laughs" attack
* Switch to MEDIUMTEXT in the schema for MySQL to avoid truncating
  large data (such as large avatars)
* Prosody automatically upgrades the table in-place if possible, see:
  <http://prosody.im/doc/mysql>
* Fix for endless loop when parsing certain invalid JSON
* Fix PostgreSQL compatibility in prosody-migrator
* Fix timestamp parsing for DST (affecting MUC scrollback
  retrieval)
* mod\_legacyauth now correctly disabled for unencrypted connections by
  default
* Components properly inherit SSL settings and certificates from their
  'parent' hosts
* Prevent startup with no VirtualHost entries in the config file

# Backporting

We have selected all of the changes in 0.8.1 to be only those
important enough to be distributed to all users of 0.8.0. However if you
are a packager looking to backport **only** the urgent
security fixes, these are the patches you need:

## 0.8

* Billion laughs: [5305a665bdd4](https://hg.prosody.im/0.8/rev/5305a665bdd4), [65e2c089d138](https://hg.prosody.im/0.8/rev/65e2c089d138), [ee6a18f10a8d](https://hg.prosody.im/0.8/rev/ee6a18f10a8d)
* MySQL truncation: [c806a599224a](https://hg.prosody.im/0.8/rev/c806a599224a), [d2406f0ce8a5](https://hg.prosody.im/0.8/rev/d2406f0ce8a5)
* JSON parsing: [20979f124ad9](https://hg.prosody.im/0.8/rev/20979f124ad9)

The last 2 issues above are specific to 0.8 and potentially allow
remote DoS when combined.

## 0.7

* Billion laughs: <http://prosody.im/patches/prosody-0.7.0-billion-laughs.patch>

## 0.6

* Billion laughs: <http://prosody.im/patches/prosody-0.6.2-billion-laughs.patch>

## Table of contents

* [Backporting](#backporting)
  + [0.8](#section08)
  + [0.7](#section07)
  + [0.6](#section06)

License
[cc-by-sa](http://creativecommons.org/licenses/by-sa/4.0/ "Creative Commons Attribution-ShareAlike 4.0 International License.")

Last change
2022-03-29

Page source
[doc/release/0.8.1.md](//hg.prosody.im/site/file/ade91c53d99c/doc/release/0.8.1.md)



=== Content from blog.prosody.im_df5cbfa7_20250125_113211.html ===


* [Prosodical Thoughts](https://blog.prosody.im/)
* [Main site](https://prosody.im/)
* [Documentation](https://prosody.im/doc)
* [Support](https://prosody.im/discuss)
* [Issues](https://prosody.im/bugs)
* [Source](https://prosody.im/source)
* [Dev docs](https://prosody.im/doc/developers)
* [Download](https://prosody.im/download)

# [Prosodical Thoughts](https://blog.prosody.im/)

News, announcements and thoughts from the Prosody IM team

# [Prosody 0.8.1 released](https://blog.prosody.im/prosody-0-8-1-released/)

2011-06-04
 by The Prosody Team

**Tags:**
[release](/tags/release)
,
[security](/tags/security)

This is a security and bugfix release for the 0.8 branch. This release contains fixes for a
couple of major issues, and it is strongly recommended that you upgrade.

![](/files/drama.jpg)

Some of you may already be aware of the ‚Äúbillion laughs‚Äù denial-of-service attack which was
discovered to work against a number of XMPP servers recently. Due to accidental oversight the
Prosody team was not notified ahead of the issue being made public, so we have worked hard the
past few days to prepare this release as soon as we could.

In addition to upgrading Prosody, you MUST also upgrade the [LuaExpat](http://www.keplerproject.org/luaexpat/)
library to [1.2.0](http://article.gmane.org/gmane.comp.lang.lua.general/79336) to prevent
the attack - this should hopefully be arriving in your distribution shortly, alternatively it can
be installed using [luarocks](http://luarocks.org/). See our
[dependencies page](http://prosody.im/doc/depends#luaexpat) for details.

If you are a packager and are looking for backported patches to older Prosody versions, please
see the [0.8.1 release notes](http://prosody.im/doc/release/0.8.1#backporting).

A summary of changes in this release:

* Reject XML DTDs, comments and processing instructions, preventing the ‚Äúbillion laughs‚Äù attack
* Switch to MEDIUMTEXT in the schema for MySQL to avoid truncating large data (such as large avatars)
  Prosody automatically upgrades the table in-place if possible, see our [MySQL documentation](http://prosody.im/doc/mysql)
  for more information.
* Fix for endless loop when parsing certain invalid JSON
* Fix PostgreSQL compatibility in prosody-migrator
* Fix timestamp parsing for DST (affecting MUC scrollback retrieval)
* mod\_legacyauth now correctly disabled for unencrypted connections by default
* Components properly inherit SSL settings and certificates from their ‚Äòparent‚Äô hosts
* Prevent startup with no VirtualHost entries in the config file

As usual if you need help or have any questions about installing/upgrading, feel
free to [ask](http://prosody.im/discuss).

## Download

**Windows**: [Installer](http://prosody.im/downloads/windows/ProsodySetup-0.8.1.exe) | [Zip](http://prosody.im/downloads/windows/Prosody-0.8.1.zip)

**Debian/Ubuntu**: [32-bit](http://prosody.im/downloads/debian/prosody_0.8.1-1_i386.deb) | [64-bit](http://prosody.im/downloads/debian/prosody_0.8.1-1_amd64.deb)

**Source tarball**: [prosody-0.8.1.tar.gz](http://prosody.im/downloads/source/prosody-0.8.1.tar.gz)

---

#### About

Prosody is a lightweight and flexible XMPP server designed with ease-of-use and extensibility in mind.

[‚öõÔ∏è Atom feed](/index.xml "Atom feed for Prosodical Thoughts: Prosody Team Blog")

#### Recent Posts

* [Prosody 0.12.5 released](/prosody-0.12.5-released/)
* [New server, new sponsor](/new-server-new-sponsor/)
* [Prosody 0.12.4 released](/prosody-0.12.4-released/)
* [Prosody 0.12.3 released](/prosody-0.12.3-released/)
* [Prosody 0.12.2 released](/prosody-0.12.2-released/)

Except where otherwise noted, content on this site is licensed under a [Creative Commons Attribution Share Alike 4.0 International license](https://creativecommons.org/licenses/by-sa/4.0/).

[Back to top](https://blog.prosody.im/prosody-0-8-1-released/)



=== Content from www.openwall.com_df8b0057_20250125_113213.html ===


| [Openwall](/) * [Products](/)   + [Openwall GNU/\*/Linux ¬† *server OS*](/Owl/)+ [Linux Kernel Runtime Guard](/lkrg/)+ [John the Ripper ¬† *password cracker*](/john/)         - [Free & Open Source for any platform](/john/)- [in the cloud](/john/cloud/)- [Pro for Linux](/john/pro/linux/)- [Pro for macOS](/john/pro/macosx/)+ [Wordlists ¬† *for password cracking*](/wordlists/)+ [passwdqc ¬† *policy enforcement*](/passwdqc/)             - [Free & Open Source for Unix](/passwdqc/)- [Pro for Windows (Active Directory)](/passwdqc/windows/)+ [yescrypt ¬† *KDF & password hashing*](/yescrypt/)+ [yespower ¬† *Proof-of-Work (PoW)*](/yespower/)+ [crypt\_blowfish ¬† *password hashing*](/crypt/)+ [phpass ¬† *ditto in PHP*](/phpass/)+ [tcb ¬† *better password shadowing*](/tcb/)+ [Pluggable Authentication Modules](/pam/)+ [scanlogd ¬† *port scan detector*](/scanlogd/)+ [popa3d ¬† *tiny POP3 daemon*](/popa3d/)+ [blists ¬† *web interface to mailing lists*](/blists/)+ [msulogin ¬† *single user mode login*](/msulogin/)+ [php\_mt\_seed ¬† *mt\_rand() cracker*](/php_mt_seed/)* [Services](/services/)* Publications       + [Articles](/articles/)+ [Presentations](/presentations/)* Resources         + [Mailing lists](/lists/)+ [Community wiki](https://openwall.info/wiki/)+ [Source code repositories (GitHub)](https://github.com/openwall)+ [Source code repositories (CVSweb)](https://cvsweb.openwall.com)+ [File archive & mirrors](/mirrors/)+ [How to verify digital signatures](/signatures/)+ [OVE IDs](/ove/)* [What's new](/news) | |
| --- | --- |

| | [Hash Suite - Windows password security audit tool. GUI, reports in PDF.](https://hashsuite.openwall.net) | | --- | |
| --- | --- |

[[<prev]](4) [[next>]](6) [[<thread-prev]](../../../2011/06/14/6) [[day]](.) [[month]](..) [[year]](../..) [[list]](../../..)
```

Message-ID: <1126598848.703491.1308145575400.JavaMail.root@zmail01.collab.prod.int.phx2.redhat.com>
Date: Wed, 15 Jun 2011 09:46:15 -0400 (EDT)
From: Josh Bressers <bressers@...hat.com>
To: oss-security@...ts.openwall.com
Cc: Yann Kerherve <yann.kerherve@...il.com>, Matthew Wild <matthew@...sody.im>
Subject: Re: CVE Request: prosody DoS, djabberd external
 entity injection

----- Original Message -----
> Hi,
>
> As far as I know, there's no CVE for these ones yet. Could you assign
> one?
> * prosody billion laughs DoS:
> <http://blog.prosody.im/prosody-0-8-1-released/>

Use CVE-2011-2205 for this.

> * djabberd external entity injection:
> [http://groups.google.com/group/djabberd/browse_thread/thread/47974331c37e54c5#](http://groups.google.com/group/djabberd/browse_thread/thread/47974331c37e54c5)
>

Use CVE-2011-2206

Thanks.

--
    JB

```

[Powered by blists](https://www.openwall.com/blists/) - [more mailing lists](https://lists.openwall.net)

Please check out the
[Open Source Software Security Wiki](https://oss-security.openwall.org/wiki/), which is counterpart to this
[mailing list](https://oss-security.openwall.org/wiki/mailing-lists/oss-security).

Confused about [mailing lists](/lists/) and their use?
[Read about mailing lists on Wikipedia](https://en.wikipedia.org/wiki/Electronic_mailing_list)
and check out these
[guidelines on proper formatting of your messages](https://www.complang.tuwien.ac.at/anton/mail-news-errors.html).


