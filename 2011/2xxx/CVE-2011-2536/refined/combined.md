=== Content from downloads.asterisk.org_88b89204_20250125_185816.html ===
Index: channels/chan\_sip.c
===================================================================
--- channels/chan\_sip.c (revision 324848)
+++ channels/chan\_sip.c (working copy)
@@ -14067,9 +14067,9 @@
{
/\* We have to emulate EXACTLY what we'd get with a good peer
\* and a bad password, or else we leak information. \*/
- const char \*response = "407 Proxy Authentication Required";
- const char \*reqheader = "Proxy-Authorization";
- const char \*respheader = "Proxy-Authenticate";
+ const char \*response = "401 Unauthorized";
+ const char \*reqheader = "Authorization";
+ const char \*respheader = "WWW-Authenticate";
const char \*authtoken;
struct ast\_str \*buf;
char \*c;
@@ -14084,23 +14084,18 @@
[K\_LAST] = { NULL, NULL}
};
- if (sipmethod == SIP\_REGISTER || sipmethod == SIP\_SUBSCRIBE) {
- response = "401 Unauthorized";
- reqheader = "Authorization";
- respheader = "WWW-Authenticate";
- }
authtoken = get\_header(req, reqheader);
if (req->ignore && !ast\_strlen\_zero(p->randdata) && ast\_strlen\_zero(authtoken)) {
/\* This is a retransmitted invite/register/etc, don't reconstruct authentication
\* information \*/
- transmit\_response\_with\_auth(p, response, req, p->randdata, 0, respheader, 0);
+ transmit\_response\_with\_auth(p, response, req, p->randdata, reliable, respheader, 0);
/\* Schedule auto destroy in 32 seconds (according to RFC 3261) \*/
sip\_scheddestroy(p, DEFAULT\_TRANS\_TIMEOUT);
return;
} else if (ast\_strlen\_zero(p->randdata) || ast\_strlen\_zero(authtoken)) {
/\* We have no auth, so issue challenge and request authentication \*/
set\_nonce\_randdata(p, 1);
- transmit\_response\_with\_auth(p, response, req, p->randdata, 0, respheader, 0);
+ transmit\_response\_with\_auth(p, response, req, p->randdata, reliable, respheader, 0);
/\* Schedule auto destroy in 32 seconds \*/
sip\_scheddestroy(p, DEFAULT\_TRANS\_TIMEOUT);
return;
@@ -14346,7 +14341,7 @@
ao2\_unlock(peer);
}
}
- if (!peer && sip\_cfg.alwaysauthreject) {
+ if (!peer && sip\_cfg.alwaysauthreject && ast\_test\_flag(&p->flags[1], SIP\_PAGE2\_REGISTERTRYING)) {
/\* If we found a peer, we transmit a 100 Trying. Therefore, if we're
\* trying to avoid leaking information, we MUST also transmit the same
\* response when we DON'T find a peer. \*/


=== Content from downloads.asterisk.org_43a44712_20250125_185817.html ===


Asterisk
Project Security Advisory - AST-2011-011

| **Product** | Asterisk |
| **Summary** | Possible enumeration of SIP users due to differing authentication responses |
| **Nature of Advisory** | Unauthorized data disclosure |
| **Susceptibility** | Remote unauthenticated sessions |
| **Severity** | Moderate |
| **Exploits Known** | No |
| **Reported On** | June 11, 2011 |
| **Reported By** |  |
| **Posted On** | June 28, 2011 |
| **Last Updated On** | June 28, 2011 |
| **Advisory Contact** | Terry Wilson <twilson@digium.com> |
| **CVE Name** | CVE-2011-2536 |

| **Description** | Asterisk may respond differently to SIP requests from an invalid SIP user than it does to a user configured on the system, even when the alwaysauthreject option is set in the configuration. This can leak information about what SIP users are valid on the Asterisk system. |

| **Resolution** | Respond to SIP requests from invalid and valid SIP users in the same way. Asterisk 1.4 and 1.6.2 do not respond identically by default due to backward-compatibility reasons, and must have alwaysauthreject=yes set in sip.conf. Asterisk 1.8 defaults to alwaysauthreject=yes.    IT IS ABSOLUTELY IMPERATIVE that users of Asterisk 1.4 and 1.6.2 set alwaysauthreject=yes in the general section of sip.conf. |

| **Affected Versions** | | |
| **Product** | **Release Series** |  |
| Asterisk Open Source | 1.4.x | All versions |
| Asterisk Open Source | 1.6.2.x | All versions |
| Asterisk Open Source | 1.8.x | All versions |
| Asterisk Business Edition | C.3.x | All versions |

| **Corrected In** | |
| **Product** | **Release** |
| Asterisk Open Source | 1.4.41.2, 1.6.2.18.2, 1.8.4.4 |
| Asterisk Business Edition | C.3.7.3 |
|  |  |

| **Patches** | |
| **Download URL** | **Revision** |
| http://downloads.asterisk.org/pub/security/AST-2011-011-1.4.diff | 1.4 |
| http://downloads.asterisk.org/pub/security/AST-2011-011-1.6.2.diff | 1.6.2 |
| http://downloads.asterisk.org/pub/security/AST-2011-011-1.8.diff | 1.8 |

| **Links** |  |

| Asterisk Project Security Advisories are posted at <http://www.asterisk.org/security>  This document may be superseded by later versions; if so, the latest version will be posted at http://downloads.digium.com/pub/security/AST-2011-011.pdf and http://downloads.digium.com/pub/security/AST-2011-011.html |

| **Revision History** | | |
| **Date** | **Editor** | **Revisions Made** |
|  |  |  |

Asterisk
Project Security Advisory - AST-2011-011
Copyright
Â© 2011
Digium, Inc. All Rights Reserved.
Permission is hereby granted
to distribute and publish this advisory in its original, unaltered
form.


