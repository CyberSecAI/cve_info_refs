=== Content from www.wordfence.com_52a1102f_20250114_184003.html ===


[![](https://www.wordfence.com/img/wordfence-intelligence-logo.svg)](/threat-intel/)

Have you found a vulnerability in a WordPress plugin or theme? Report vulnerabilities in WordPress plugins and themes through our [bug bounty program](https://www.wordfence.com/threat-intel/bug-bounty-program) and earn a bounty on all in-scope submissions, while we handle the responsible disclosure process on your behalf.

As a reminder, the Wordfence Intelligence Vulnerability Database API is completely free to query and utilize, both personally and commercially, and contains all the same vulnerability data as the user interface. Please review the API documentation and Webhook documentation for more information on how to query the vulnerability API endpoints and configure webhooks utilizing all the same data present in the Wordfence Intelligence user interface.

# xili-tidy-tags <= 1.12.04 - Reflected Cross-Site Scripting

 [Wordfence Intelligence](https://www.wordfence.com/threat-intel)   >    [Vulnerability Database](https://www.wordfence.com/threat-intel/vulnerabilities)   >   xili-tidy-tags <= 1.12.04 - Reflected Cross-Site Scripting

6.1

**Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')**
**CVSS Vector**
[CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N)

| CVE | [CVE-2024-9357](https://www.cve.org/CVERecord?id=CVE-2024-9357) |
| --- | --- |
| CVSS | 6.1 (Medium) |
| Publicly Published | November 11, 2024 |
| Last Updated | November 12, 2024 |
| Researcher | [vgo0](https://www.wordfence.com/threat-intel/vulnerabilities/researchers/dale-mavers) |

### Description

The xili-tidy-tags plugin for WordPress is vulnerable to Reflected Cross-Site Scripting via the 'action' parameter in all versions up to, and including, 1.12.04 due to insufficient input sanitization and output escaping. This makes it possible for unauthenticated attackers to inject arbitrary web scripts in pages that execute if they can successfully trick a user into performing an action such as clicking on a link.

#### References

* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/browser/xili-tidy-tags/tags/1.12.04/xili-includes/class-xili-tidy-tags-admin.php#L156)
* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/changeset?old_path=/xili-tidy-tags/tags/1.12.04&new_path=/xili-tidy-tags/tags/1.12.05&sfp_email=&sfph_mail=)

#### Share

[Facebook](https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fxili-tidy-tags%2Fxili-tidy-tags-11204-reflected-cross-site-scripting&t=xili-tidy-tags%20%3C%3D%201.12.04%20-%20Reflected%20Cross-Site%20Scripting "Facebook")
[Twitter](https://twitter.com/share?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fxili-tidy-tags%2Fxili-tidy-tags-11204-reflected-cross-site-scripting&text=xili-tidy-tags%20%3C%3D%201.12.04%20-%20Reflected%20Cross-Site%20Scripting "Twitter")
[LinkedIn](https://www.linkedin.com/shareArticle?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fxili-tidy-tags%2Fxili-tidy-tags-11204-reflected-cross-site-scripting "LinkedIn")
Email

## Vulnerability Details for xili-tidy-tags

#### [xili-tidy-tags](https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/xili-tidy-tags)

| Software Type | Plugin |
| --- | --- |
| Software Slug | xili-tidy-tags [(view on wordpress.org)](https://wordpress.org/plugins/xili-tidy-tags) |
| Patched? | Yes |
| Remediation | Update to version 1.12.05, or a newer patched version |
| Affected Version | * <= 1.12.04 |
| Patched Version | * 1.12.05 |

This record contains material that is subject to copyright.

**Copyright 2012-2025 Defiant Inc.**

**License:**
Defiant hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute this software vulnerability information. Any copy of the software vulnerability information you make for such purposes is authorized provided that you include a hyperlink to this vulnerability record and reproduce Defiant's copyright designation and this license in any such copy.
**[Read more.](https://www.wordfence.com/wordfence-intelligence-terms-and-conditions/)**

**Copyright 1999-2025 The MITRE Corporation**

**License:**
CVE Usage: MITRE hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute Common Vulnerabilities and Exposures (CVE®). Any copy you make for such purposes is authorized provided that you reproduce MITRE's copyright designation and this license in any such copy.
**[Read more.](https://www.cve.org/Legal/TermsOfUse)**

Have information to add, or spot any errors? Contact us at wfi-support@wordfence.com so we can make any appropriate adjustments.

Did you know Wordfence Intelligence provides free personal and commercial API access to our comprehensive WordPress vulnerability database, along with a free webhook integration to stay on top of the latest vulnerabilities added and updated in the database? Get started today!

Learn more

Want to get notified of the latest vulnerabilities that may affect your WordPress site?
 Install Wordfence on your site today to get notified immediately if your site is affected by a vulnerability that has been added to our database.

Get Wordfence

The Wordfence Intelligence WordPress vulnerability database is completely free to access and query via API. Please review the documentation on how to access and consume the vulnerability data via API.

Documentation



=== Content from plugins.trac.wordpress.org_517c3fb9_20250114_183957.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fchangeset%3Fnew_path%3D%252Fxili-tidy-tags%252Ftags%252F1.12.05%26old_path%3D%252Fxili-tidy-tags%252Ftags%252F1.12.04)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* [Reverse Diff](/changeset/3222436/xili-tidy-tags/tags/1.12.04?old=3222436&old_path=%2Fxili-tidy-tags%2Ftags%2F1.12.05)

---

# Changes from [xili-tidy-tags/tags/1.12.04](/browser/xili-tidy-tags/tags/1.12.04?rev=3222436 "Show entry in browser") at [r3222436](/changeset/3222436 "Show full changeset") to [xili-tidy-tags/tags/1.12.05](/browser/xili-tidy-tags/tags/1.12.05?rev=3222436 "Show entry in browser") at [r3222436](/changeset/3222436 "Show full changeset")

View differences
inline
side by side

Show
lines around each change

Show the changes in full context

Ignore:

Blank lines

Case changes

White space changes

Location:
[xili-tidy-tags/tags/1.12.05](/browser/xili-tidy-tags/tags/1.12.05?rev=3222436)
Files:

29 edited

* [class-xili-tidy-tags.php](/browser/xili-tidy-tags/tags/1.12.05/class-xili-tidy-tags.php?rev=3182914 "Show entry in browser")
  (modified)
  ([1 prop](#file0 "Show differences"))
* [css/jquery.dataTables.css](/browser/xili-tidy-tags/tags/1.12.05/css/jquery.dataTables.css?rev=3182914 "Show entry in browser")
  (modified)
  ([1 prop](#file1 "Show differences"))
* [css/jquery.dataTables.min.css](/browser/xili-tidy-tags/tags/1.12.05/css/jquery.dataTables.min.css?rev=3182914 "Show entry in browser")
  (modified)
  ([1 prop](#file2 "Show differences"))
* [images/back\_disabled.png](/browser/xili-tidy-tags/tags/1.12.05/images/back_disabled.png?rev=3182914 "Show entry in browser")
  (modified)
  ([previous](/browser/xili-tidy-tags/tags/1.12.04/images/back_disabled.png?rev=2945812 "Show previous version in browser"))
* [images/back\_enabled.png](/browser/xili-tidy-tags/tags/1.12.05/images/back_enabled.png?rev=3182914 "Show entry in browser")
  (modified)
  ([previous](/browser/xili-tidy-tags/tags/1.12.04/images/back_enabled.png?rev=2945812 "Show previous version in browser"))
* [images/back\_enabled\_hover.png](/browser/xili-tidy-tags/tags/1.12.05/images/back_enabled_hover.png?rev=3182914 "Show entry in browser")
  (modified)
  ([previous](/browser/xili-tidy-tags/tags/1.12.04/images/back_enabled_hover.png?rev=2945812 "Show previous version in browser"))
* [images/forward\_disabled.png](/browser/xili-tidy-tags/tags/1.12.05/images/forward_disabled.png?rev=3182914 "Show entry in browser")
  (modified)
  ([previous](/browser/xili-tidy-tags/tags/1.12.04/images/forward_disabled.png?rev=2945812 "Show previous version in browser"))
* [images/forward\_enabled.png](/browser/xili-tidy-tags/tags/1.12.05/images/forward_enabled.png?rev=3182914 "Show entry in browser")
  (modified)
  ([previous](/browser/xili-tidy-tags/tags/1.12.04/images/forward_enabled.png?rev=2945812 "Show previous version in browser"))
* [images/forward\_enabled\_hover.png](/browser/xili-tidy-tags/tags/1.12.05/images/forward_enabled_hover.png?rev=3182914 "Show entry in browser")
  (modified)
  ([previous](/browser/xili-tidy-tags/tags/1.12.04/images/forward_enabled_hover.png?rev=2945812 "Show previous version in browser"))
* [images/sort\_asc.png](/browser/xili-tidy-tags/tags/1.12.05/images/sort_asc.png?rev=3182914 "Show entry in browser")
  (modified)
  ([previous](/browser/xili-tidy-tags/tags/1.12.04/images/sort_asc.png?rev=2945812 "Show previous version in browser"))
* [images/sort\_asc\_disabled.png](/browser/xili-tidy-tags/tags/1.12.05/images/sort_asc_disabled.png?rev=3182914 "Show entry in browser")
  (modified)
  ([previous](/browser/xili-tidy-tags/tags/1.12.04/images/sort_asc_disabled.png?rev=2945812 "Show previous version in browser"))
* [images/sort\_both.png](/browser/xili-tidy-tags/tags/1.12.05/images/sort_both.png?rev=3182914 "Show entry in browser")
  (modified)
  ([previous](/browser/xili-tidy-tags/tags/1.12.04/images/sort_both.png?rev=2945812 "Show previous version in browser"))
* [images/sort\_desc.png](/browser/xili-tidy-tags/tags/1.12.05/images/sort_desc.png?rev=3182914 "Show entry in browser")
  (modified)
  ([previous](/browser/xili-tidy-tags/tags/1.12.04/images/sort_desc.png?rev=2945812 "Show previous version in browser"))
* [images/sort\_desc\_disabled.png](/browser/xili-tidy-tags/tags/1.12.05/images/sort_desc_disabled.png?rev=3182914 "Show entry in browser")
  (modified)
  ([previous](/browser/xili-tidy-tags/tags/1.12.04/images/sort_desc_disabled.png?rev=2945812 "Show previous version in browser"))
* [images/xilitidy-logo-16.png](/browser/xili-tidy-tags/tags/1.12.05/images/xilitidy-logo-16.png?rev=3182914 "Show entry in browser")
  (modified)
  ([previous](/browser/xili-tidy-tags/tags/1.12.04/images/xilitidy-logo-16.png?rev=2945812 "Show previous version in browser"))
* [images/xilitidy-logo-32.png](/browser/xili-tidy-tags/tags/1.12.05/images/xilitidy-logo-32.png?rev=3182914 "Show entry in browser")
  (modified)
  ([previous](/browser/xili-tidy-tags/tags/1.12.04/images/xilitidy-logo-32.png?rev=2945812 "Show previous version in browser"))
* [js/jquery.dataTables.js](/browser/xili-tidy-tags/tags/1.12.05/js/jquery.dataTables.js?rev=3182914 "Show entry in browser")
  (modified)
  ([1 prop](#file16 "Show differences"))
* [js/jquery.dataTables.min.js](/browser/xili-tidy-tags/tags/1.12.05/js/jquery.dataTables.min.js?rev=3182914 "Show entry in browser")
  (modified)
  ([1 prop](#file17 "Show differences"))
* [languages/xili-tidy-tags-es\_ES.mo](/browser/xili-tidy-tags/tags/1.12.05/languages/xili-tidy-tags-es_ES.mo?rev=3182914 "Show entry in browser")
  (modified)
  ([previous](/browser/xili-tidy-tags/tags/1.12.04/languages/xili-tidy-tags-es_ES.mo?rev=2945812 "Show previous version in browser"))
* [languages/xili-tidy-tags-es\_ES.po](/browser/xili-tidy-tags/tags/1.12.05/languages/xili-tidy-tags-es_ES.po?rev=3182914 "Show entry in browser")
  (modified)
  ([1 prop](#file19 "Show differences"))
* [languages/xili-tidy-tags-fr\_FR.mo](/browser/xili-tidy-tags/tags/1.12.05/languages/xili-tidy-tags-fr_FR.mo?rev=3182914 "Show entry in browser")
  (modified)
  ([previous](/browser/xili-tidy-tags/tags/1.12.04/languages/xili-tidy-tags-fr_FR.mo?rev=2945812 "Show previous version in browser"))
* [languages/xili-tidy-tags-fr\_FR.po](/browser/xili-tidy-tags/tags/1.12.05/languages/xili-tidy-tags-fr_FR.po?rev=3182914 "Show entry in browser")
  (modified)
  ([1 prop](#file21 "Show differences"))
* [languages/xili-tidy-tags-sr\_RS.mo](/browser/xili-tidy-tags/tags/1.12.05/languages/xili-tidy-tags-sr_RS.mo?rev=3182914 "Show entry in browser")
  (modified)
  ([previous](/browser/xili-tidy-tags/tags/1.12.04/languages/xili-tidy-tags-sr_RS.mo?rev=2945812 "Show previous version in browser"))
* [languages/xili-tidy-tags-sr\_RS.po](/browser/xili-tidy-tags/tags/1.12.05/languages/xili-tidy-tags-sr_RS.po?rev=3182914 "Show entry in browser")
  (modified)
  ([1 prop](#file23 "Show differences"))
* [languages/xili-tidy-tags.pot](/browser/xili-tidy-tags/tags/1.12.05/languages/xili-tidy-tags.pot?rev=3182914 "Show entry in browser")
  (modified)
  ([1 prop](#file24 "Show differences"))
* [readme.txt](/browser/xili-tidy-tags/tags/1.12.05/readme.txt?rev=3184893 "Show entry in browser")
  (modified)
  ([3 diffs, 1 prop](#file25 "Show differences"))
* [xili-includes/class-xili-tidy-tags-admin.php](/browser/xili-tidy-tags/tags/1.12.05/xili-includes/class-xili-tidy-tags-admin.php?rev=3182914 "Show entry in browser")
  (modified)
  ([3 diffs, 1 prop](#file26 "Show differences"))
* [xili-includes/class-xili-tidy-tags-cloud-multiple-widgets.php](/browser/xili-tidy-tags/tags/1.12.05/xili-includes/class-xili-tidy-tags-cloud-multiple-widgets.php?rev=3182914 "Show entry in browser")
  (modified)
  ([1 prop](#file27 "Show differences"))
* [xili-tidy-tags.php](/browser/xili-tidy-tags/tags/1.12.05/xili-tidy-tags.php?rev=3182914 "Show entry in browser")
  (modified)
  ([3 diffs, 1 prop](#file28 "Show differences"))

### Legend:

Unmodified
Added
Removed

* ## [xili-tidy-tags/tags/1.12.05/class-xili-tidy-tags.php](/changeset/3182914/xili-tidy-tags/tags/1.12.05/class-xili-tidy-tags.php?old=2945812&old_path=xili-tidy-tags%2Ftags%2F1.12.04%2Fclass-xili-tidy-tags.php "Show the [3222436:3222436] differences restricted to xili-tidy-tags/tags/1.12.05/class-xili-tidy-tags.php")

  + Property
    **svn:eol-style**
    set to
    *`native`*
* ## [xili-tidy-tags/tags/1.12.05/css/jquery.dataTables.css](/changeset/3182914/xili-tidy-tags/tags/1.12.05/css/jquery.dataTables.css?old=2945812&old_path=xili-tidy-tags%2Ftags%2F1.12.04%2Fcss%2Fjquery.dataTables.css "Show the [3222436:3222436] differences restricted to xili-tidy-tags/tags/1.12.05/css/jquery.dataTables.css")

  + Property
    **svn:eol-style**
    set to
    *`native`*
* ## [xili-tidy-tags/tags/1.12.05/css/jquery.dataTables.min.css](/changeset/3182914/xili-tidy-tags/tags/1.12.05/css/jquery.dataTables.min.css?old=2945812&old_path=xili-tidy-tags%2Ftags%2F1.12.04%2Fcss%2Fjquery.dataTables.min.css "Show the [3222436:3222436] differences restricted to xili-tidy-tags/tags/1.12.05/css/jquery.dataTables.min.css")

  + Property
    **svn:eol-style**
    set to
    *`native`*
* ## [xili-tidy-tags/tags/1.12.05/js/jquery.dataTables.js](/changeset/3182914/xili-tidy-tags/tags/1.12.05/js/jquery.dataTables.js?old=2945812&old_path=xili-tidy-tags%2Ftags%2F1.12.04%2Fjs%2Fjquery.dataTables.js "Show the [3222436:3222436] differences restricted to xili-tidy-tags/tags/1.12.05/js/jquery.dataTables.js")

  + Property
    **svn:eol-style**
    set to
    *`native`*
* ## [xili-tidy-tags/tags/1.12.05/js/jquery.dataTables.min.js](/changeset/3182914/xili-tidy-tags/tags/1.12.05/js/jquery.dataTables.min.js?old=2945812&old_path=xili-tidy-tags%2Ftags%2F1.12.04%2Fjs%2Fjquery.dataTables.min.js "Show the [3222436:3222436] differences restricted to xili-tidy-tags/tags/1.12.05/js/jquery.dataTables.min.js")

  + Property
    **svn:eol-style**
    set to
    *`native`*
* ## [xili-tidy-tags/tags/1.12.05/languages/xili-tidy-tags-es\_ES.po](/changeset/3182914/xili-tidy-tags/tags/1.12.05/languages/xili-tidy-tags-es_ES.po?old=2945812&old_path=xili-tidy-tags%2Ftags%2F1.12.04%2Flanguages%2Fxili-tidy-tags-es_ES.po "Show the [3222436:3222436] differences restricted to xili-tidy-tags/tags/1.12.05/languages/xili-tidy-tags-es_ES.po")

  + Property
    **svn:eol-style**
    set to
    *`native`*
* ## [xili-tidy-tags/tags/1.12.05/languages/xili-tidy-tags-fr\_FR.po](/changeset/3182914/xili-tidy-tags/tags/1.12.05/languages/xili-tidy-tags-fr_FR.po?old=2945812&old_path=xili-tidy-tags%2Ftags%2F1.12.04%2Flanguages%2Fxili-tidy-tags-fr_FR.po "Show the [3222436:3222436] differences restricted to xili-tidy-tags/tags/1.12.05/languages/xili-tidy-tags-fr_FR.po")

  + Property
    **svn:eol-style**
    set to
    *`native`*
* ## [xili-tidy-tags/tags/1.12.05/languages/xili-tidy-tags-sr\_RS.po](/changeset/3182914/xili-tidy-tags/tags/1.12.05/languages/xili-tidy-tags-sr_RS.po?old=2945812&old_path=xili-tidy-tags%2Ftags%2F1.12.04%2Flanguages%2Fxili-tidy-tags-sr_RS.po "Show the [3222436:3222436] differences restricted to xili-tidy-tags/tags/1.12.05/languages/xili-tidy-tags-sr_RS.po")

  + Property
    **svn:eol-style**
    set to
    *`native`*
* ## [xili-tidy-tags/tags/1.12.05/languages/xili-tidy-tags.pot](/changeset/3182914/xili-tidy-tags/tags/1.12.05/languages/xili-tidy-tags.pot?old=2945812&old_path=xili-tidy-tags%2Ftags%2F1.12.04%2Flanguages%2Fxili-tidy-tags.pot "Show the [3222436:3222436] differences restricted to xili-tidy-tags/tags/1.12.05/languages/xili-tidy-tags.pot")

  + Property
    **svn:eol-style**
    set to
    *`native`*
* ## [xili-tidy-tags/tags/1.12.05/readme.txt](/changeset/3184893/xili-tidy-tags/tags/1.12.05/readme.txt?old=2945812&old_path=xili-tidy-tags%2Ftags%2F1.12.04%2Freadme.txt "Show the [3222436:3222436] differences restricted to xili-tidy-tags/tags/1.12.05/readme.txt")

  + Property
    **svn:eol-style**
    set to
    *`native`*

  | [r3222436](/browser/xili-tidy-tags/tags/1.12.04/readme.txt?rev=2945812#L5 "Show revision 3222436 of this file in browser") | [r3222436](/browser/xili-tidy-tags/tags/1.12.05/readme.txt?rev=3184893#L5 "Show revision 3222436 of this file in browser") |  |
  | --- | --- | --- |
  | 5 | 5 | Requires at least: 4.6 |
  | 6 | 6 | Tested up to: 6.2 |
  | 7 |  | Stable tag: 1.12.0~~4~~ |
  |  | 7 | Stable tag: 1.12.05 |
  | 8 | 8 | License: GPLv2 |
  | 9 | 9 |  |
  | […](/browser/xili-tidy-tags/tags/1.12.04/readme.txt?rev=2945812#L56) | […](/browser/xili-tidy-tags/tags/1.12.05/readme.txt?rev=3184893#L56) |  |
  | 56 | 56 | \* more function for grouping new features introducted in version 1.9 |
  | 57 | 57 |  |
  |  | 58 | = Version 1.12.05 = |
  |  | 59 | \* fixes forgotten sanitize - thanks to vgo0 (report by WordFence) |
  |  | 60 | \* Last Updated 2024-11-04 |
  | 58 | 61 | = Version 1.12.04 = |
  | 59 |  | \* fixes forg~~et~~ nounce |
  |  | 62 | \* fixes forgotten nounce |
  | 60 | 63 | \* Last Updated 2023-08-01 |
  | 61 | 64 | = Version 1.12.01 = |
  | […](/browser/xili-tidy-tags/tags/1.12.04/readme.txt?rev=2945812#L154) | […](/browser/xili-tidy-tags/tags/1.12.05/readme.txt?rev=3184893#L157) |  |
  | 154 | 157 |  |
  | 155 | 158 | == Changelog == |
  |  | 159 | = Version 1.12.05 = |
  |  | 160 | \* fixes forgotten sanitize - thanks to vgo0 (report by WordFence) |
  |  | 161 | \* Last Updated 2024-11-04 |
  |  | 162 | = Version 1.12.04 = |
  |  | 163 | \* fixes forget nounce |
  | 156 | 164 | = 1.12.01 - (2019-05-18) = |
  | 157 | 165 | \* rewritten with WPCS rules |
* ## [xili-tidy-tags/tags/1.12.05/xili-includes/class-xili-tidy-tags-admin.php](/changeset/3182914/xili-tidy-tags/tags/1.12.05/xili-includes/class-xili-tidy-tags-admin.php?old=2945812&old_path=xili-tidy-tags%2Ftags%2F1.12.04%2Fxili-includes%2Fclass-xili-tidy-tags-admin.php "Show the [3222436:3222436] differences restricted to xili-tidy-tags/tags/1.12.05/xili-includes/class-xili-tidy-tags-admin.php")

  + Property
    **svn:eol-style**
    set to
    *`native`*

  | [r3222436](/browser/xili-tidy-tags/tags/1.12.04/xili-includes/class-xili-tidy-tags-admin.php?rev=2945812#L27 "Show revision 3222436 of this file in browser") | [r3222436](/browser/xili-tidy-tags/tags/1.12.05/xili-includes/class-xili-tidy-tags-admin.php?rev=3182914#L27 "Show revision 3222436 of this file in browser") |  |
  | --- | --- | --- |
  | 27 | 27 | \* 1.12.03 - 200805 - fixes input of group tags |
  | 28 | 28 | \* 1.12.04 - 230731 - fix forgotten nonce in $\_GET in group part - add hidden field ! |
  |  | 29 | \* 1.12.05 - 241104 - fix forgotten sanitize - thanks to vgo0 |
  | 29 | 30 | \*/ |
  | 30 | 31 | class Xili\_Tidy\_Tags\_Admin extends Xili\_Tidy\_Tags { |
  | […](/browser/xili-tidy-tags/tags/1.12.04/xili-includes/class-xili-tidy-tags-admin.php?rev=2945812#L142) | […](/browser/xili-tidy-tags/tags/1.12.05/xili-includes/class-xili-tidy-tags-admin.php?rev=3182914#L143) |  |
  | 142 | 143 | $tagsgroup = null; |
  | 143 | 144 | $term\_id = 0; |
  |  | 145 |  |
  |  | 146 | // 241003 - IE fixes with $title = sanitize\_text\_field( $\_POST['title'] ); |
  | 144 | 147 | if ( isset( $\_POST['reset'] ) ) { |
  | 145 | 148 | $action = $\_POST['reset']; |
  | […](/browser/xili-tidy-tags/tags/1.12.04/xili-includes/class-xili-tidy-tags-admin.php?rev=2945812#L152) | […](/browser/xili-tidy-tags/tags/1.12.05/xili-includes/class-xili-tidy-tags-admin.php?rev=3182914#L155) |  |
  | 152 | 155 | } elseif ( isset( $\_POST['editor\_caps\_submit'] ) ) { /\* 0.9.5 capabilities \*/ |
  | 153 | 156 | $action = 'editor\_caps\_submit'; |
  | 154 |  | } elseif ( isset( $\_POST['sendmail'] ) ) { //1.5.4 |
  |  | 157 | } elseif ( isset( $\_POST['sendmail'] ) ) { // 1.5.4 |
  | 155 | 158 | $action = 'sendmail'; |
  | 156 | 159 | } elseif ( isset( $\_POST['action'] ) ) { |
  | 157 |  | $action = ~~$\_POST['action']~~; |
  |  | 160 | $action = sanitize\_text\_field( wp\_unslash( $\_POST['action'] ) ); |
  | 158 | 161 | } |
  | 159 | 162 |  |
  | 160 | 163 | if ( isset( $\_GET['action'] ) ) : |
  | 161 |  | if ( isset(~~$\_GET['my\_nonce']) && wp\_verify\_nonce( $\_GET['my\_nonce'], 'doing\_settings')~~) { |
  |  | 164 | if ( isset( $\_GET['my\_nonce'] ) && wp\_verify\_nonce( $\_GET['my\_nonce'], 'doing\_settings' ) ) { |
  | 162 | 165 |  |
  | 163 | 166 | $action = $\_GET['action']; |
* ## [xili-tidy-tags/tags/1.12.05/xili-includes/class-xili-tidy-tags-cloud-multiple-widgets.php](/changeset/3182914/xili-tidy-tags/tags/1.12.05/xili-includes/class-xili-tidy-tags-cloud-multiple-widgets.php?old=2945812&old_path=xili-tidy-tags%2Ftags%2F1.12.04%2Fxili-includes%2Fclass-xili-tidy-tags-cloud-multiple-widgets.php "Show the [3222436:3222436] differences restricted to xili-tidy-tags/tags/1.12.05/xili-includes/class-xili-tidy-tags-cloud-multiple-widgets.php")

  + Property
    **svn:eol-style**
    set to
    *`native`*
* ## [xili-tidy-tags/tags/1.12.05/xili-tidy-tags.php](/changeset/3182914/xili-tidy-tags/tags/1.12.05/xili-tidy-tags.php?old=2945812&old_path=xili-tidy-tags%2Ftags%2F1.12.04%2Fxili-tidy-tags.php "Show the [3222436:3222436] differences restricted to xili-tidy-tags/tags/1.12.05/xili-tidy-tags.php")

  + Property
    **svn:eol-style**
    set to
    *`native`*

  | [r3222436](/browser/xili-tidy-tags/tags/1.12.04/xili-tidy-tags.php?rev=2945812#L5 "Show revision 3222436 of this file in browser") | [r3222436](/browser/xili-tidy-tags/tags/1.12.05/xili-tidy-tags.php?rev=3182914#L5 "Show revision 3222436 of this file in browser") |  |
  | --- | --- | --- |
  | 5 | 5 | Description: xili-tidy-tags is a tool for grouping tags by language or semantic group. Initially developed to enrich xili-language plugin and usable in all sites (CMS) and bbPress forum or others custom taxonomies. |
  | 6 | 6 | Author: dev.xiligroup.com - MS |
  | 7 |  | Version: 1.12.0~~4~~ |
  |  | 7 | Version: 1.12.05 |
  | 8 | 8 | Author URI: http://dev.xiligroup.com |
  | 9 | 9 | License: GPLv2 |
  | […](/browser/xili-tidy-tags/tags/1.12.04/xili-tidy-tags.php?rev=2945812#L12) | […](/browser/xili-tidy-tags/tags/1.12.05/xili-tidy-tags.php?rev=3182914#L12) |  |
  | 12 | 12 | \*/ |
  | 13 | 13 |  |
  |  | 14 | # 1.12.05 - 202411 - fixes forget sanitize (vgo0 wordfence) |
  | 14 | 15 | # 1.12.04 - 202307 - fixes forget nonce (WP - patchstack) |
  | 15 | 16 | # 1.12.03 - 200805 - fixes input of group tags |
  | […](/browser/xili-tidy-tags/tags/1.12.04/xili-tidy-tags.php?rev=2945812#L91) | […](/browser/xili-tidy-tags/tags/1.12.05/xili-tidy-tags.php?rev=3182914#L92) |  |
  | 91 | 92 | # Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA |
  | 92 | 93 |  |
  | 93 |  | define( 'XILITIDYTAGS\_VER', '1.12.0~~4~~' ); /\* used in admin UI \*/ |
  |  | 94 | define( 'XILITIDYTAGS\_VER', '1.12.05' ); /\* used in admin UI \*/ |
  | 94 | 95 |  |
  | 95 | 96 | define( 'XILITIDYTAGS\_PLUGIN\_DIR', plugin\_dir\_path( \_\_FILE\_\_ ) ); |

**Note:** See [TracChangeset](/wiki/TracChangeset)
for help on using the changeset viewer.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Unified Diff](?format=diff&new=3222436&old=3222436&new_path=%2Fxili-tidy-tags%2Ftags%2F1.12.05&old_path=%2Fxili-tidy-tags%2Ftags%2F1.12.04)
* [Zip Archive](?format=zip&new=3222436&old=3222436&new_path=%2Fxili-tidy-tags%2Ftags%2F1.12.05&old_path=%2Fxili-tidy-tags%2Ftags%2F1.12.04)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from plugins.trac.wordpress.org_8bacf917_20250114_183954.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fbrowser%2Fxili-tidy-tags%2Ftags%2F1.12.04%2Fxili-includes%2Fclass-xili-tidy-tags-admin.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* [Blame](/browser/xili-tidy-tags/tags/1.12.04/xili-includes/class-xili-tidy-tags-admin.php?annotate=blame "Annotate each line with the last changed revision (this can be time consuming...)")
* [Revision Log](/log/xili-tidy-tags/tags/1.12.04/xili-includes/class-xili-tidy-tags-admin.php)

---

# [source:](/browser?order=name "Go to repository root") [xili-tidy-tags](/browser/xili-tidy-tags?order=name "View xili-tidy-tags")/[tags](/browser/xili-tidy-tags/tags?order=name "View tags")/[1.12.04](/browser/xili-tidy-tags/tags/1.12.04?order=name "View 1.12.04")/[xili-includes](/browser/xili-tidy-tags/tags/1.12.04/xili-includes?order=name "View xili-includes")/[class-xili-tidy-tags-admin.php](/browser/xili-tidy-tags/tags/1.12.04/xili-includes/class-xili-tidy-tags-admin.php?order=name "View class-xili-tidy-tags-admin.php")

View diff against:

View revision:

| [Last change](/changeset/2945812/xili-tidy-tags/tags/1.12.04/xili-includes/class-xili-tidy-tags-admin.php "View differences") on this file was [2945812](/changeset/2945812/ "View changeset 2945812"), checked in by michelwppi, [18 months ago](/timeline?from=2023-08-01T06%3A38%3A58Z&precision=second "See timeline at 08/01/2023 06:38:58 AM") |
| --- |
| fixes after message of WP and PatchStack |
| **File size:** 94.1 KB | |

| Line |  |
| --- | --- |
| [1](#L1) | <?php |
| [2](#L2) | /\*\* |
| [3](#L3) | \* XTT admin class |
| [4](#L4) | \* |
| [5](#L5) | \* @package Xili-Tidy-Tags |
| [6](#L6) | \* @subpackage core |
| [7](#L7) | \* @since 1.12 |
| [8](#L8) | \*/ |
| [9](#L9) |  |
| [10](#L10) | /\*\* |
| [11](#L11) | \* Xili-tidy-tags class admin (now separated file since 1.8.0) - 1.8.1 fixes - 1.8.2 (s)- |
| [12](#L12) | \* |
| [13](#L13) | \* 1.8.3 - Add errors management to detect bad instancing with other tag (custom taxonomy) ... |
| [14](#L14) | \* 1.8.7 - Tags grouping via alias - fixes errors when no declared taxonomy and more... |
| [15](#L15) | \* 1.9.1 - WP 3.8 updated message |
| [16](#L16) | \* 1.9.2 - WP 3.9-b1 updated notice message prepare |
| [17](#L17) | \* 1.9.3 - 141128 - Fixes $news\_id pointer in admin |
| [18](#L18) | \* 1.10.0 - 141219 - Fixes editing alias tags |
| [19](#L19) | \* 1.10.1 - 150228 - pre-tested WP 4.2-alpha - rewrite selected(), checked() |
| [20](#L20) | \* 1.10.2 - 150322 - new datatables JS+CSS (1.10.5) |
| [21](#L21) | \* 1.10.3 - 150408 - fixes notice with constante line 61 |
| [22](#L22) | \* 1.11.0 - 150703 - datatables js 1.10.7 updated WP 43 + debug |
| [23](#L23) | \* 1.11.4 - 160722 - insert commits of Naja |
| [24](#L24) | \* 1.11.5 - 170620 - fixes group sorting |
| [25](#L25) | \* 1.12.0 - 190517 - Code sources rewritting with WPCS |
| [26](#L26) | \* 1.12.02 - 200619 - fixes links in group admin... |
| [27](#L27) | \* 1.12.03 - 200805 - fixes input of group tags |
| [28](#L28) | \* 1.12.04 - 230731 - fix forgotten nonce in $\_GET in group part - add hidden field ! |
| [29](#L29) | \*/ |
| [30](#L30) | class Xili\_Tidy\_Tags\_Admin extends Xili\_Tidy\_Tags { |
| [31](#L31) |  |
| [32](#L32) | public $subselect = 0; /\* selected parent group \*/ |
| [33](#L33) | public $fromgroupselect = 0; /\* group in which belong tags \*/ |
| [34](#L34) | public $groupexclude = false; /\* exclude group from the query \*/ |
| [35](#L35) | public $uncheckedtags = false; /\* exclude uncheckedtags from the query if false \*/ |
| [36](#L36) | public $onlyuncheckedtags = false; /\* for general query to see only unchecked \*/ |
| [37](#L37) | public $onlyparent = false; /\* when a group is parent, show all tags of childs of the group \*/ |
| [38](#L38) | public $news\_id = 0; //for multi pointers |
| [39](#L39) |  |
| [40](#L40) | /\*\* |
| [41](#L41) | \* PHP 5 Constructor |
| [42](#L42) | \*/ |
| [43](#L43) | public function \_\_construct( $xtt\_parent, $post\_tag = 'post\_tag', $post\_tag\_post\_type = 'post' ) { |
| [44](#L44) |  |
| [45](#L45) | $this->parent = $xtt\_parent; // to keep values built in parent filters... |
| [46](#L46) |  |
| [47](#L47) | parent::\_\_construct( $post\_tag, $post\_tag\_post\_type, true );  // need parent constructed values (third param - tell coming admin-class //2.6 |
| [48](#L48) | add\_action( 'admin\_init', array( &$this, 'admin\_init' ) ); // 1.5.0 |
| [49](#L49) | add\_action( 'admin\_menu', array( &$this, 'xili\_add\_pages' ) ); |
| [50](#L50) |  |
| [51](#L51) | add\_action( $this->post\_tag . '\_add\_form', array( &$this, 'xili\_add\_tag\_form' ) ); /\* to choose a group for a new tag \*/ |
| [52](#L52) | add\_action( $this->post\_tag . '\_add\_form\_fields', array( &$this, 'xili\_add\_tag\_alias' ) ); /\* to assign a tag as alias - 1.8.7 \*/ |
| [53](#L53) | add\_action( $this->post\_tag . '\_edit\_form', array( &$this, 'xili\_edit\_tag\_form' ) ); |
| [54](#L54) | add\_action( $this->post\_tag . '\_edit\_form', array( &$this, 'xili\_add\_tag\_alias' ) ); /\* to assign a tag as alias - 1.8.7 \*/ |
| [55](#L55) |  |
| [56](#L56) | /\*  edit-tags table \*/ |
| [57](#L57) | add\_filter( 'manage\_edit-' . $this->post\_tag . '\_columns', array( &$this, 'xili\_manage\_tax\_column\_name' ) ); |
| [58](#L58) | add\_filter( 'manage\_' . $this->post\_tag . '\_custom\_column', array( &$this, 'xili\_manage\_tax\_column' ), 10, 3 ); // 2.6 |
| [59](#L59) |  |
| [60](#L60) | /\* actions for post and page admin UI \*/ |
| [61](#L61) | add\_action( 'save\_post', array( &$this, 'xili\_tags\_grouping' ), 50 ); /\* to affect tags to lang of saved post \*/ |
| [62](#L62) |  |
| [63](#L63) | add\_action( 'created\_term', array( &$this, 'xili\_created\_term' ), 9, 2 ); /\* a new term was created \*/ |
| [64](#L64) | add\_action( 'edited\_term', array( &$this, 'xili\_edited\_term' ), 9, 2 ); /\* a term was edited \*/ |
| [65](#L65) |  |
| [66](#L66) | /\* plugin list \*/ |
| [67](#L67) | add\_filter( 'plugin\_action\_links', array( &$this, 'xili\_filter\_plugin\_actions' ), 100, 2 ); |
| [68](#L68) | /\* help \*/ |
| [69](#L69) | add\_action( 'contextual\_help', array( &$this, 'add\_help\_text' ), 10, 3 ); /\* 1.5.0 \*/ |
| [70](#L70) | } |
| [71](#L71) |  |
| [72](#L72) | public function admin\_init() { |
| [73](#L73) | $suffix = ( defined( 'SCRIPT\_DEBUG' ) && SCRIPT\_DEBUG ) ? '' : '.min'; |
| [74](#L74) | /\* Register our script. \*/ |
| [75](#L75) | wp\_register\_script( 'datatables-v10', plugins\_url( 'js/jquery.dataTables' . $suffix . '.js', $this->file\_file ), array( 'jquery' ), '1.10.7', true ); |
| [76](#L76) |  |
| [77](#L77) | wp\_register\_style( 'table\_style-v10', plugins\_url( '/css/jquery.dataTables' . $suffix . '.css', $this->file\_file ), array(), '1.10.7', 'screen' ); |
| [78](#L78) | } |
| [79](#L79) |  |
| [80](#L80) | /\*\* |
| [81](#L81) | \* add admin menu and associated pages of admin UI tools page xili\_tidy\_editor\_set |
| [82](#L82) | \* |
| [83](#L83) | \* @since 0.8.0 |
| [84](#L84) | \* @updated 0.9.5 - menu without repeat of main title, levels with new caps set by plugin array( &$this, 'top\_tidy\_menu\_title' ) |
| [85](#L85) | \* @updated 1.0.1 - favicon.ico for menu title - 1.3.4 Special window for Super User |
| [86](#L86) | \*/ |
| [87](#L87) | public function xili\_add\_pages() { |
| [88](#L88) |  |
| [89](#L89) | $taxo\_tag = get\_taxonomy( $this->post\_tag ); |
| [90](#L90) | $this->tags\_name = ( isset( $taxo\_tag->labels->name ) ) ? $taxo\_tag->labels->name : $this->post\_tag; |
| [91](#L91) | $this->singular\_name = ( isset( $taxo\_tag->labels->singular\_name ) ) ? $taxo\_tag->labels->singular\_name : $this->post\_tag; // 1.8.6 |
| [92](#L92) |  |
| [93](#L93) | $pre = ( 'post\_tag' == $this->post\_tag ) ? '' : '\_' . $this->post\_tag; |
| [94](#L94) | /\* translators: \*/ |
| [95](#L95) | $this->thehook0 = add\_menu\_page( sprintf( \_\_( '%s groups', 'xili-tidy-tags' ), $this->tags\_name ), sprintf( \_\_( 'Tidy %s', 'xili-tidy-tags' ), $this->tags\_name ), '', 'xili-tidy-tags' . $pre, array( &$this, 'top\_tidy\_menu\_title' ), plugins\_url( 'images/xilitidy-logo-16.png', $this->file\_file ) ); //1.5.5 |
| [96](#L96) | /\* translators: \*/ |
| [97](#L97) | $this->thehooka = add\_submenu\_page( 'xili-tidy-tags' . $pre, sprintf( \_\_( '%s groups', 'xili-tidy-tags' ), $this->tags\_name ), \_\_( 'Info for SuperAdmin', 'xili-tidy-tags' ), '', 'xili-tidy-tags' . $pre, array( &$this, 'top\_tidy\_menu\_title' ) ); |
| [98](#L98) | /\* translators: \*/ |
| [99](#L99) | $this->thehook = add\_submenu\_page( 'xili-tidy-tags' . $pre, sprintf( \_\_( '%s groups', 'xili-tidy-tags' ), $this->tags\_name ), sprintf( \_\_( 'Tidy %s settings', 'xili-tidy-tags' ), $this->tags\_name ), 'xili\_tidy\_editor\_set', 'xili\_tidy\_tags\_settings' . $pre, array( &$this, 'xili\_tidy\_tags\_settings' )); |
| [100](#L100) | add\_action( 'load-' . $this->thehook, array( &$this, 'on\_load\_page' ) ); |
| [101](#L101) |  |
| [102](#L102) | /\* sub-page \*/ |
| [103](#L103) | /\* translators: \*/ |
| [104](#L104) | $this->thehook2 = add\_submenu\_page( 'xili-tidy-tags' . $pre, sprintf( \_\_( 'Tidy %s', 'xili-tidy-tags' ), $this->tags\_name ), sprintf( \_\_( 'Tidy %s assign', 'xili-tidy-tags' ), $this->tags\_name ), 'xili\_tidy\_editor\_group', 'xili\_tidy\_tags\_assign' . $pre, array( &$this, 'xili\_tidy\_tags\_assign' )); |
| [105](#L105) |  |
| [106](#L106) | add\_action( 'load-' . $this->thehook2, array( &$this, 'on\_load\_page2' ) ); |
| [107](#L107) |  |
| [108](#L108) | add\_action( 'admin\_print\_scripts-' . $this->thehook2, array( &$this, 'admin\_enqueue\_scripts' ) ); |
| [109](#L109) | add\_action( 'admin\_print\_styles-' . $this->thehook2, array( &$this, 'admin\_enqueue\_styles' ) ); |
| [110](#L110) |  |
| [111](#L111) | $this->insert\_news\_pointer( 'xtt\_new\_version' ); // pointer in menu for updated version |
| [112](#L112) | add\_action( 'admin\_print\_footer\_scripts', array( &$this, 'print\_the\_pointers\_js' ) ); |
| [113](#L113) | // 1.5 |
| [114](#L114) | } |
| [115](#L115) |  |
| [116](#L116) | public function top\_tidy\_menu\_title() { |
| [117](#L117) | // again with wp3.0 instead '' call v1.3.4 |
| [118](#L118) | $pre = ( 'post\_tag' == $this->post\_tag ) ? '' : '\_' . $this->post\_tag; |
| [119](#L119) | ?> |
| [120](#L120) | <div class='wrap'> |
| [121](#L121) | <h2><?php printf( esc\_html\_\_( 'Tidy %s settings', 'xili-tidy-tags' ), $this->tags\_name ); ?></h2> |
| [122](#L122) | <h4><?php esc\_html\_e( 'This window is reserved for future settings in multisite mode (wpmu) for administrator like SuperAdmin... ', 'xili-tidy-tags' ); ?></h4> |
| [123](#L123) | <p><?php printf( esc\_html\_\_( 'Link to set tidy %s in current site', 'xili-tidy-tags' ), $this->tags\_name ); ?>: <a href="<?php echo 'admin.php?page=xili\_tidy\_tags\_settings' . $pre; ?>" title="xili-tidy-tags settings" ><?php /\* translators: \*/ printf( esc\_html\_\_( 'To create groups of %s', 'xili-tidy-tags' ), $this->tags\_name ); ?></a></p> |
| [124](#L124) | <p><?php printf( esc\_html\_\_( 'Link to assign tidy %s in current site', 'xili-tidy-tags' ), $this->tags\_name ); ?>: <a href="<?php echo 'admin.php?page=xili\_tidy\_tags\_assign' . $pre; ?>" title="xili-tidy-tags assign"><?php /\* translators: \*/ printf( esc\_html\_\_( 'To assign a group to %s', 'xili-tidy-tags' ), $this->tags\_name ); ?></a></p> |
| [125](#L125) |  |
| [126](#L126) | <h4><a href="http://dev.xiligroup.com/xili-tidy-tags" title="Plugin page and docs" target="\_blank" style="text-decoration:none" ><img style="vertical-align:middle" src="<?php echo plugins\_url( 'images/xilitidy-logo-32.png', $this->file\_file ); ?>" alt="xili-tidy-tags logo"/></a> - © <a href="http://dev.xiligroup.com" target="\_blank" title="<?php esc\_html\_e( 'Author' ); ?>" >xiligroup.com</a>™ - msc 2009-20 - v. <?php echo XILITIDYTAGS\_VER; ?></h4> |
| [127](#L127) | </div> |
| [128](#L128) | <?php |
| [129](#L129) | } |
| [130](#L130) |  |
| [131](#L131) | /\* Dashboard - Manage - Tidy tags \*/ |
| [132](#L132) | public function xili\_tidy\_tags\_settings() { |
| [133](#L133) | global $wp\_version; |
| [134](#L134) |  |
| [135](#L135) | $xili\_tidy\_tags\_page = 'settings'; |
| [136](#L136) | $formtitle = \_\_( 'Add a group', 'xili-tidy-tags' ); /\* translated in form \*/ |
| [137](#L137) | $submit\_text = \_\_( 'Add &raquo;', 'xili-tidy-tags' ); |
| [138](#L138) | $cancel\_text = \_\_( 'Cancel' ); |
| [139](#L139) | $action = ''; |
| [140](#L140) | $optionmessage = ''; |
| [141](#L141) | $emessage = ''; |
| [142](#L142) | $tagsgroup = null; |
| [143](#L143) | $term\_id = 0; |
| [144](#L144) | if ( isset( $\_POST['reset'] ) ) { |
| [145](#L145) | $action = $\_POST['reset']; |
| [146](#L146) | } elseif ( isset( $\_POST['updateoptions'] ) ) { |
| [147](#L147) | $action = 'updateoptions'; |
| [148](#L148) | } elseif ( isset( $\_POST['importxililanguages'] ) ) { |
| [149](#L149) | $action = 'importxililanguages'; |
| [150](#L150) | } elseif ( isset( $\_POST['importacat'] ) ) { |
| [151](#L151) | $action = 'importacat'; |
| [152](#L152) | } elseif ( isset( $\_POST['editor\_caps\_submit'] ) ) { /\* 0.9.5 capabilities \*/ |
| [153](#L153) | $action = 'editor\_caps\_submit'; |
| [154](#L154) | } elseif ( isset( $\_POST['sendmail'] ) ) { //1.5.4 |
| [155](#L155) | $action = 'sendmail'; |
| [156](#L156) | } elseif ( isset( $\_POST['action'] ) ) { |
| [157](#L157) | $action = $\_POST['action']; |
| [158](#L158) | } |
| [159](#L159) |  |
| [160](#L160) | if ( isset( $\_GET['action'] ) ) : |
| [161](#L161) | if ( isset($\_GET['my\_nonce']) && wp\_verify\_nonce( $\_GET['my\_nonce'], 'doing\_settings')) { |
| [162](#L162) |  |
| [163](#L163) | $action = $\_GET['action']; |
| [164](#L164) | $term\_id = $\_GET['term\_id']; |
| [165](#L165) | } else { |
| [166](#L166) | $message = " NO NONCE !!!! "; |
| [167](#L167) | } |
| [168](#L168) | endif; |
| [169](#L169) |  |
| [170](#L170) | $message .= $action; |
| [171](#L171) | $msg = 0; |
| [172](#L172) | switch ( $action ) { |
| [173](#L173) | case 'editor\_caps\_submit': |
| [174](#L174) | check\_admin\_referer( 'xilitagsettings' ); |
| [175](#L175) | $new\_cap = $\_POST['editor\_caps']; |
| [176](#L176) |  |
| [177](#L177) | $this->xili\_settings['editor\_caps'] = $new\_cap; |
| [178](#L178) | $this->xili\_settings['datatable\_js'] = ( isset( $\_POST['datatable\_js'] ) ) ? $\_POST['datatable\_js'] : ''; // 1.5.3.1 |
| [179](#L179) |  |
| [180](#L180) | update\_option( 'xili\_tidy\_tags\_settings', $this->xili\_settings ); |
| [181](#L181) |  |
| [182](#L182) | $actiontype = 'add'; |
| [183](#L183) | $message .= ' - ' . \_\_( 'Editor Capabilities changed to: ', 'xili-tidy-tags' ) . ' (' . $new\_cap . ') '; |
| [184](#L184) | $optionmessage = $message; |
| [185](#L185) | $msg = 6; |
| [186](#L186) | break; |
| [187](#L187) | case 'importacat': |
| [188](#L188) | check\_admin\_referer( 'xilitagsettings' ); |
| [189](#L189) | $chosencatid = $\_POST['catsforgroup']; |
| [190](#L190) | $chosenparent = $\_POST['tags\_parent']; |
| [191](#L191) | $chosencat = get\_category( $chosencatid ); |
| [192](#L192) | $desc = \_\_( 'Group for: ', 'xili-tidy-tags' ) . $chosencat->name . ' ' . \_\_( 'category', 'xili-tidy-tags' ); |
| [193](#L193) | $args = array( |
| [194](#L194) | 'alias\_of' => '', |
| [195](#L195) | 'description' => $desc, |
| [196](#L196) | 'parent' => (int) $\_POST['tags\_parent'], |
| [197](#L197) | ); |
| [198](#L198) | $theids = wp\_insert\_term( $chosencat->name, $this->tidy\_taxonomy, $args ); |
| [199](#L199) | if ( ! is\_wp\_error( $theids ) ) { |
| [200](#L200) | wp\_set\_object\_terms( $theids['term\_id'], (int) $\_POST['tags\_parent'], $this->tidy\_taxonomy ); |
| [201](#L201) | } |
| [202](#L202) |  |
| [203](#L203) | $actiontype = 'add'; |
| [204](#L204) | $message .= ' - ' . \_\_( 'This group was added: ', 'xili-tidy-tags' ) . ' (' . $chosencatid . ') parent = ' . $chosenparent; |
| [205](#L205) | break; |
| [206](#L206) |  |
| [207](#L207) | case 'importxililanguages': |
| [208](#L208) | check\_admin\_referer( 'xilitagsettings' ); |
| [209](#L209) | $this->xili\_langs\_import\_terms(); |
| [210](#L210) | $actiontype = 'add'; |
| [211](#L211) | $message .= ' - ' . \_\_( 'The languages groups was added. ', 'xili-tidy-tags' ); |
| [212](#L212) | $msg = 5; |
| [213](#L213) | break; |
| [214](#L214) |  |
| [215](#L215) | case 'add': |
| [216](#L216) | check\_admin\_referer( 'xilitagsettings' ); |
| [217](#L217) | $term = $\_POST['tagsgroup\_name']; |
| [218](#L218) | if ( '' != $term ) { |
| [219](#L219) | $args = array( |
| [220](#L220) | 'alias\_of' => '', |
| [221](#L221) | 'description' => $\_POST['tagsgroup\_description'], |
| [222](#L222) | 'parent' => (int) $\_POST['tagsgroup\_parent'], |
| [223](#L223) | 'slug' => $\_POST['tagsgroup\_nicename'], |
| [224](#L224) | ); |
| [225](#L225) | $theids = wp\_insert\_term( $term, $this->tidy\_taxonomy, $args ); |
| [226](#L226) | if ( ! is\_wp\_error( $theids ) ) { |
| [227](#L227) | wp\_set\_object\_terms( $theids['term\_id'], (int) $\_POST['tagsgroup\_parent'], $this->tidy\_taxonomy ); |
| [228](#L228) | $message .= ' - ' . \_\_( 'A new group was added. ', 'xili-tidy-tags' ); |
| [229](#L229) | $msg = 1; |
| [230](#L230) | } else { |
| [231](#L231) | $message .= ' - Error DB: ' . serialize( $theids ); |
| [232](#L232) | $msg = 2; |
| [233](#L233) | } |
| [234](#L234) | $actiontype = 'add'; |
| [235](#L235) |  |
| [236](#L236) | } else { |
| [237](#L237) | $actiontype = 'add'; |
| [238](#L238) | $message .= ' - ' . esc\_html\_\_( 'NO new group was added. ', 'xili-tidy-tags' ); |
| [239](#L239) | $msg = 2; |
| [240](#L240) | } |
| [241](#L241) | break; |
| [242](#L242) |  |
| [243](#L243) | case 'edit': |
| [244](#L244) | $actiontype = 'edited'; |
| [245](#L245) | $tagsgroup = get\_term( (int) $term\_id, $this->tidy\_taxonomy, OBJECT, 'edit' ); |
| [246](#L246) | $submit\_text = esc\_html\_\_( 'Update &raquo;', 'xili-tidy-tags' ); |
| [247](#L247) | $formtitle =  esc\_html\_\_( 'Edit Group', 'xili-tidy-tags' ); |
| [248](#L248) | $message .= ' - ' . esc\_html\_\_( 'Group to update. ', 'xili-tidy-tags' ); |
| [249](#L249) | break; |
| [250](#L250) |  |
| [251](#L251) | case 'edited': |
| [252](#L252) | check\_admin\_referer( 'xilitagsettings' ); |
| [253](#L253) | $actiontype = 'add'; |
| [254](#L254) | $term\_id = $\_POST['tagsgroup\_term\_id']; |
| [255](#L255) | $term\_name = $\_POST['tagsgroup\_name']; // fixed 1.6.0 |
| [256](#L256) | $args = array( |
| [257](#L257) | 'name' => $term\_name, |
| [258](#L258) | 'alias\_of' => '', |
| [259](#L259) | 'description' => $\_POST['tagsgroup\_description'], |
| [260](#L260) | 'parent' => (int)$\_POST['tagsgroup\_parent'], |
| [261](#L261) | 'slug' =>$\_POST['tagsgroup\_nicename'], |
| [262](#L262) | ); |
| [263](#L263) | $theids = wp\_update\_term( $term\_id, $this->tidy\_taxonomy, $args ); |
| [264](#L264) | $message .= ' - ' .\_\_( 'A group was updated. ', 'xili-tidy-tags' ); |
| [265](#L265) | $msg = 3; |
| [266](#L266) | break; |
| [267](#L267) |  |
| [268](#L268) | case 'delete': |
| [269](#L269) | $actiontype = 'deleting'; |
| [270](#L270) | $submit\_text = \_\_( 'Delete &raquo;', 'xili-tidy-tags' ); |
| [271](#L271) | $formtitle = \_\_( 'Delete group', 'xili-tidy-tags' ); |
| [272](#L272) | $tagsgroup = get\_term( (int) $term\_id, $this->tidy\_taxonomy, OBJECT, 'edit' ); |
| [273](#L273) | $message .= ' - ' . \_\_( 'A group to delete. ', 'xili-tidy-tags' ); |
| [274](#L274) | break; |
| [275](#L275) |  |
| [276](#L276) | case 'deleting': |
| [277](#L277) | check\_admin\_referer( 'xilitagsettings' ); |
| [278](#L278) | $actiontype = 'add'; |
| [279](#L279) | $term = $\_POST['tagsgroup\_term\_id']; |
| [280](#L280) | wp\_delete\_term( $term, $this->tidy\_taxonomy ); // 1.8.1 |
| [281](#L281) | $message .= ' - ' . \_\_( 'A group was deleted. ', 'xili-tidy-tags' ); |
| [282](#L282) | $msg = 4; |
| [283](#L283) | break; |
| [284](#L284) |  |
| [285](#L285) | case 'reset': |
| [286](#L286) | $actiontype = 'add'; |
| [287](#L287) | break; |
| [288](#L288) |  |
| [289](#L289) | case 'sendmail': |
| [290](#L290) | // 1.5.4 |
| [291](#L291) | check\_admin\_referer( 'xilitagsettings' ); |
| [292](#L292) | $this->xili\_settings['url'] = ( isset( $\_POST['urlenable'] ) ) ? $\_POST['urlenable'] : ''; |
| [293](#L293) | $this->xili\_settings['theme'] = ( isset( $\_POST['themeenable'] ) ) ? $\_POST['themeenable'] : ''; |
| [294](#L294) | $this->xili\_settings['wplang'] = ( isset( $\_POST['wplangenable'] ) ) ? $\_POST['wplangenable'] : ''; |
| [295](#L295) | $this->xili\_settings['version-wp'] = ( isset( $\_POST['versionenable'] ) ) ? $\_POST['versionenable'] : ''; |
| [296](#L296) | $this->xili\_settings['xiliplug'] = ( isset( $\_POST['xiliplugenable'] ) ) ? $\_POST['xiliplugenable'] : ''; |
| [297](#L297) | $this->xili\_settings['webmestre-level'] = $\_POST['webmestre']; // 1.8.2 |
| [298](#L298) | update\_option( 'xili\_tidy\_tags\_settings', $this->xili\_settings ); |
| [299](#L299) | $contextual\_arr = array(); |
| [300](#L300) | if ( 'enable' == $this->xili\_settings['url'] ) { |
| [301](#L301) | $contextual\_arr[] = 'url=[ ' . get\_bloginfo( 'url' ) . ' ]'; |
| [302](#L302) | } |
| [303](#L303) | if ( isset( $\_POST['onlocalhost'] ) ) { |
| [304](#L304) | $contextual\_arr[] = 'url=local'; |
| [305](#L305) | } |
| [306](#L306) | if ( 'enable' == $this->xili\_settings['theme'] ) { |
| [307](#L307) | $contextual\_arr[] = 'theme=[ ' . get\_option( 'stylesheet' ) . ' ]'; |
| [308](#L308) | } |
| [309](#L309) | if ( 'enable' == $this->xili\_settings['wplang'] ) { |
| [310](#L310) | $contextual\_arr[] = 'WPLANG=[ ' . $this->get\_wplang() . ' ]'; |
| [311](#L311) | } |
| [312](#L312) | if ( 'enable' == $this->xili\_settings['version-wp'] ) { |
| [313](#L313) | $contextual\_arr[] = 'WP version=[ ' . $wp\_version . ' ]'; |
| [314](#L314) | } |
| [315](#L315) | if ( 'enable' == $this->xili\_settings['xiliplug'] ) { |
| [316](#L316) | $contextual\_arr[] = 'xiliplugins=[ ' . $this->check\_other\_xili\_plugins() . ' ]'; |
| [317](#L317) | } |
| [318](#L318) |  |
| [319](#L319) | $contextual\_arr[] = $this->xili\_settings['webmestre-level'];  // 1.9.1 |
| [320](#L320) |  |
| [321](#L321) | $headers = 'From: xili-tidy-tags plugin page <' . get\_bloginfo( 'admin\_email' ) . '>' . "\r\n"; |
| [322](#L322) | if ( '' != $\_POST['ccmail'] ) { |
| [323](#L323) | $headers .= 'Cc: <' . $\_POST['ccmail'] . '>' . "\r\n"; |
| [324](#L324) | $headers .= 'Reply-To: <' . $\_POST['ccmail'] . '>' . "\r\n"; |
| [325](#L325) | } |
| [326](#L326) | $headers .= '\\'; |
| [327](#L327) | $message = 'Message sent by: ' . get\_bloginfo( 'admin\_email' ) . "\n\n"; |
| [328](#L328) | $message .= 'Subject: ' . $\_POST['subject'] . "\n\n"; |
| [329](#L329) | $message .= 'Topic: ' . $\_POST['thema'] . "\n\n"; |
| [330](#L330) | $message .= 'Content: ' . $\_POST['mailcontent'] . "\n\n"; |
| [331](#L331) | $message .= 'Checked contextual infos: ' . implode( ', ', $contextual\_arr ) . "\n\n"; |
| [332](#L332) | $message .= 'This message was sent by webmaster in xili-tidy-tags plugin settings page' . "\n\n"; |
| [333](#L333) | $message .= "\n\n"; |
| [334](#L334) | $result = wp\_mail( 'contact@xiligroup.com', $\_POST['thema'] . ' from xili-tidy-tags v. ' . XILITIDYTAGS\_VER . ' plugin settings page. ', $message, $headers ); |
| [335](#L335) | $message = \_\_( 'Email sent. ', 'xili-tidy-tags' ); |
| [336](#L336) | $msg = 7; |
| [337](#L337) | /\* translators: \*/ |
| [338](#L338) | $emessage = sprintf( \_\_( 'Thanks for your email. A copy was sent to %s (%s)', 'xili-tidy-tags' ), $\_POST['ccmail'], $result ); |
| [339](#L339) | $actiontype = 'add'; |
| [340](#L340) | break; |
| [341](#L341) |  |
| [342](#L342) | default: |
| [343](#L343) | $actiontype = 'add'; |
| [344](#L344) | /\* translators: \*/ |
| [345](#L345) | $message .= sprintf( \_\_( 'Find the list of groups for %s. ', 'xili-tidy-tags' ), $this->tags\_name ); |
| [346](#L346) | } |
| [347](#L347) |  |
| [348](#L348) | /\* register the main boxes always available \*/ |
| [349](#L349) | /\* translators: \*/ |
| [350](#L350) | add\_meta\_box( 'xili\_tidy\_tags-normal-group-tags-list', sprintf( \_\_( 'Groups of %s', 'xili-tidy-tags' ), $this->tags\_name ), array( &$this, 'on\_normal\_group\_tags\_list\_content' ), $this->thehook, 'normal', 'core' ); /\* list of groups\*/ |
| [351](#L351) |  |
| [352](#L352) | add\_meta\_box( 'xili\_tidy\_tags-normal-form', \_\_( 'The group', 'xili-tidy-tags' ), array( &$this, 'on\_normal\_group\_form\_content' ), $this->thehook, 'normal', 'core' ); /\* the group\*/ |
| [353](#L353) | add\_meta\_box( 'xili\_tidy\_tags-sidebox-import', \_\_( 'Actions', 'xili-tidy-tags' ), array( &$this, 'on\_sidebox\_import\_content' ), $this->thehook, 'side', 'core' ); /\* Actions \*/ |
| [354](#L354) |  |
| [355](#L355) | $themessages[1] = \_\_( 'A new group was added. ', 'xili-tidy-tags' ); |
| [356](#L356) | $themessages[2] = \_\_( 'NO new group was added. ', 'xili-tidy-tags' ); |
| [357](#L357) | $themessages[3] = \_\_( 'A group was updated. ', 'xili-tidy-tags' ); |
| [358](#L358) | $themessages[4] = \_\_( 'A group was deleted. ', 'xili-tidy-tags' ); |
| [359](#L359) | $themessages[5] = \_\_( 'The languages groups was added. ', 'xili-tidy-tags' ); |
| [360](#L360) | $themessages[6] = $optionmessage; |
| [361](#L361) | $themessages[7] = \_\_( 'Email sent. ', 'xili-tidy-tags' ); |
| [362](#L362) |  |
| [363](#L363) | /\* form datas in array for do\_meta\_boxes() \*/ |
| [364](#L364) | $data = array( |
| [365](#L365) | 'xili\_tidy\_tags\_page' => $xili\_tidy\_tags\_page, |
| [366](#L366) | 'message' => $message, |
| [367](#L367) | 'action' => $action, |
| [368](#L368) | 'formtitle' => $formtitle, |
| [369](#L369) | 'tagsgroup' => $tagsgroup, |
| [370](#L370) | 'submit\_text' => $submit\_text, |
| [371](#L371) | 'cancel\_text' => $cancel\_text, |
| [372](#L372) | 'term\_id' => $term\_id, |
| [373](#L373) | 'emessage' => $emessage, |
| [374](#L374) | ); |
| [375](#L375) | ?> |
| [376](#L376) | <div id="xili-tidy-tags-settings" class="wrap columns-2" style="min-width:880px"> |
| [377](#L377) |  |
| [378](#L378) | <h2><?php /\* translators: \*/ printf( esc\_html\_\_( 'Tidy %s groups', 'xili-tidy-tags' ), $this->tags\_name ); ?></h2> |
| [379](#L379) | <?php |
| [380](#L380) | if ( 0 != $msg ) { |
| [381](#L381) | ?> |
| [382](#L382) | <div id="message" class="updated fade"><p><?php echo $themessages[ $msg ]; ?></p></div> |
| [383](#L383) | <?php |
| [384](#L384) | } |
| [385](#L385) | $pre = ( 'post\_tag' == $this->post\_tag ) ? 'xili\_tidy\_tags\_settings' : 'xili\_tidy\_tags\_settings\_' . $this->post\_tag; |
| [386](#L386) | ?> |
| [387](#L387) | <form name='add' id='add' method="post" action="admin.php?page=<?php echo $pre; ?>"> |
| [388](#L388) | <input type="hidden" name="action" value="<?php echo $actiontype; ?>" /> |
| [389](#L389) | <?php wp\_nonce\_field( 'xili-tidy-tags-settings' ); ?> |
| [390](#L390) | <?php wp\_nonce\_field( 'closedpostboxes', 'closedpostboxesnonce', false ); ?> |
| [391](#L391) | <?php |
| [392](#L392) | wp\_nonce\_field( 'meta-box-order', 'meta-box-order-nonce', false ); |
| [393](#L393) | /\* 0.9.3 add has-right-sidebar for next wp 2.8\*/ |
| [394](#L394) |  |
| [395](#L395) | global $wp\_version; |
| [396](#L396) | if ( version\_compare( $wp\_version, '3.3.9', '<' ) ) { |
| [397](#L397) | $poststuff\_class = 'class="metabox-holder has-right-sidebar"'; |
| [398](#L398) | $postbody\_class = ''; |
| [399](#L399) | $postleft\_id = ''; |
| [400](#L400) | $postright\_id = 'side-info-column'; |
| [401](#L401) | $postleft\_class = ''; |
| [402](#L402) | $postright\_class = 'inner-sidebar'; |
| [403](#L403) | } else { // 3.4 |
| [404](#L404) | $poststuff\_class = ''; |
| [405](#L405) | $postbody\_class = 'class="metabox-holder columns-2"'; |
| [406](#L406) | $postleft\_id = 'id="postbox-container-2"'; |
| [407](#L407) | $postright\_id = 'postbox-container-1'; |
| [408](#L408) | $postleft\_class = 'class="postbox-container"'; |
| [409](#L409) | $postright\_class = 'postbox-container'; |
| [410](#L410) | } |
| [411](#L411) | ?> |
| [412](#L412) | <div id="poststuff" <?php echo $poststuff\_class; ?>> |
| [413](#L413) | <div id="post-body" <?php echo $postbody\_class; ?> > |
| [414](#L414) | <div id="<?php echo $postright\_id; ?>" class="<?php echo $postright\_class; ?>"> |
| [415](#L415) | <?php do\_meta\_boxes( $this->thehook, 'side', $data ); ?> |
| [416](#L416) | </div> |
| [417](#L417) | <div id="post-body-content"> |
| [418](#L418) | <div <?php echo $postleft\_id; ?> <?php echo $postleft\_class; ?> style="min-width:580px"> |
| [419](#L419) | <?php do\_meta\_boxes( $this->thehook, 'normal', $data ); ?> |
| [420](#L420) | </div> |
| [421](#L421) |  |
| [422](#L422) | <h4><a href="http://dev.xiligroup.com/xili-tidy-tags" title="Plugin page and docs" target="\_blank" style="text-decoration:none" ><img style="vertical-align:middle" src="<?php echo plugins\_url( 'images/xilitidy-logo-32.png', $this->file\_file ); ?>" alt="xili-tidy-tags logo"/></a> - © <a href="http://dev.xiligroup.com" target="\_blank" title="<?php esc\_html\_e( 'Author' ); ?>" >xiligroup.com</a>™ - msc 2009-20 - v. <?php echo XILITIDYTAGS\_VER; ?></h4> |
| [423](#L423) |  |
| [424](#L424) | </div> |
| [425](#L425) | </div> |
| [426](#L426) | <br class="clear" /> |
| [427](#L427) | </div> |
| [428](#L428) | <?php wp\_nonce\_field( 'xilitagsettings' ); ?> |
| [429](#L429) | </form> |
| [430](#L430) | </div> |
| [431](#L431) | <script type="text/javascript"> |
| [432](#L432) | //<![CDATA[ |
| [433](#L433) | jQuery(document).ready( function( $) { |
| [434](#L434) |  |
| [435](#L435) | // close postboxes that should be closed |
| [436](#L436) | $( ' .if-js-closed' ).removeClass( 'if-js-closed' ).addClass( 'closed' ); |
| [437](#L437) | // postboxes setup |
| [438](#L438) | postboxes.add\_postbox\_toggles( '<?php echo $this->thehook; ?>' ); |
| [439](#L439) | }); |
| [440](#L440) | //]]> |
| [441](#L441) | </script> |
| [442](#L442) |  |
| [443](#L443) | <?php |
| [444](#L444) | } |
| [445](#L445) |  |
| [446](#L446) | public function on\_load\_page() { |
| [447](#L447) | wp\_enqueue\_script( 'common' ); |
| [448](#L448) | wp\_enqueue\_script( 'wp-lists' ); |
| [449](#L449) | wp\_enqueue\_script( 'postbox' ); |
| [450](#L450) |  |
| [451](#L451) | $pre = ( 'post\_tag' == $this->post\_tag ) ? '' : $this->post\_tag . '\_'; |
| [452](#L452) | add\_meta\_box( 'xili\_tidy\_tags-sidebox-1', \_\_( 'Message', 'xili-tidy-tags' ), array( &$this, 'on\_sidebox\_msg\_content' ), $this->thehook, 'side', 'core' ); |
| [453](#L453) | add\_meta\_box( $pre . 'xili\_tidy\_tags-sidebox-3', \_\_( 'Info', 'xili-tidy-tags' ), array( &$this, 'on\_sidebox\_info\_content' ), $this->thehook, 'side', 'core' ); |
| [454](#L454) | add\_meta\_box( $pre . 'xili\_tidy\_tags-sidebox-mail', \_\_( 'Mail & Support', 'xili-tidy-tags' ), array( &$this, 'on\_sidebox\_mail\_content' ), $this->thehook, 'normal', 'low' ); |
| [455](#L455) | if ( current\_user\_can( 'xili\_tidy\_admin\_set' ) ) { |
| [456](#L456) | add\_meta\_box( $pre . 'xili\_tidy\_tags-sidebox-4', \_\_( 'Capabilities', 'xili-tidy-tags' ), array( &$this, 'on\_sidebox\_admin\_content' ), $this->thehook, 'side', 'core' ); |
| [457](#L457) | } |
| [458](#L458) |  |
| [459](#L459) | } |
| [460](#L460) |  |
| [461](#L461) | /\* page for tags assign to (a) group(s) \*/ |
| [462](#L462) | public function xili\_tidy\_tags\_assign() { |
| [463](#L463) |  |
| [464](#L464) | $current\_taxonomy = get\_taxonomy( $this->post\_tag ); |
| [465](#L465) | if ( false == $current\_taxonomy || ! in\_array( $this->post\_tag\_post\_type, $current\_taxonomy->object\_type ) ) { |
| [466](#L466) | $msg = 3; |
| [467](#L467) | } |
| [468](#L468) |  |
| [469](#L469) | $action = ''; |
| [470](#L470) | $msg = ''; |
| [471](#L471) | $term\_id = ''; |
| [472](#L472) | $tagsnamelike = ''; |
| [473](#L473) | $tagsnamesearch = ''; |
| [474](#L474) | $xili\_tidy\_tags\_page = 'assign'; |
| [475](#L475) | $submit\_text = \_\_( 'Update', 'xili-tidy-tags' ); |
| [476](#L476) | $cancel\_text = \_\_( 'Cancel' ); |
| [477](#L477) | $tagsnamelike = ( isset( $\_POST['tagsnamelike'] ) ) ? $\_POST['tagsnamelike'] : ''; |
| [478](#L478) | $tagsnamesearch = ( isset( $\_POST['tagsnamesearch'] ) ) ? $\_POST['tagsnamesearch'] : ''; |
| [479](#L479) | if ( isset( $\_POST['update'] ) ) { |
| [480](#L480) | $action = 'update'; |
| [481](#L481) | } |
| [482](#L482) | /\* since 1.3.0 \*/ |
| [483](#L483) | if ( isset( $\_POST['tagsgroup\_from\_select'] ) && 'no\_select' != $\_POST['tagsgroup\_from\_select'] ) { |
| [484](#L484) | $this->fromgroupselect = (int) $\_POST['tagsgroup\_from\_select']; |
| [485](#L485) | } elseif ( isset( $\_GET['tps'] ) && 'no\_select' != $\_GET['tps'] ) { |
| [486](#L486) | $this->fromgroupselect = (int) $\_GET['tps']; |
| [487](#L487) | } else { |
| [488](#L488) | $this->fromgroupselect = 0; |
| [489](#L489) | } |
| [490](#L490) |  |
| [491](#L491) | $this->onlyuncheckedtags = ( isset( $\_POST['tagsgroup\_from\_select'] ) && 'onlyuncheckedtags' == $\_POST['tagsgroup\_from\_select'] ) ? true : false; |
| [492](#L492) | $this->onlyparent = ( isset( $\_POST['xili\_group\_only\_parent'] ) && 'onlyparent' == $\_POST['xili\_group\_only\_parent'] ) ? true : false; |
| [493](#L493) | $this->groupexclude = ( isset( $\_POST['xili\_group\_not\_select'] ) && 'not' == $\_POST['xili\_group\_not\_select'] ) ? true : false; |
| [494](#L494) | $this->uncheckedtags = ( isset( $\_POST['xili\_uncheckedtags'] ) && 'include' == $\_POST['xili\_uncheckedtags'] ) ? true : false; |
| [495](#L495) | $subselectgroups = array(); |
| [496](#L496) | if ( isset( $\_POST['tagsgroup\_parent\_select'] ) && 'no\_select'  != $\_POST['tagsgroup\_parent\_select'] ) { |
| [497](#L497) | $this->subselect = (int) $\_POST['tagsgroup\_parent\_select']; |
| [498](#L498) | } else { |
| [499](#L499) | $this->subselect = 0; |
| [500](#L500) | } |
| [501](#L501) |  |
| [502](#L502) | if ( isset( $\_GET['tps'] ) ) { // 1.7 |
| [503](#L503) | $action = 'subselectiong'; |
| [504](#L504) | } |
| [505](#L505) | if ( isset( $\_POST['subselection'] ) ) { |
| [506](#L506) | $action = 'subselection'; |
| [507](#L507) | } |
| [508](#L508) | if ( isset( $\_POST['notagssublist'] ) ) { |
| [509](#L509) | $action = 'notagssublist'; |
| [510](#L510) | } |
| [511](#L511) | if ( isset( $\_POST['tagssublist'] ) ) { |
| [512](#L512) | $action = 'tagssublist'; |
| [513](#L513) | } |
| [514](#L514) |  |
| [515](#L515) | $message = $action; |
| [516](#L516) | switch ( $action ) { |
| [517](#L517) |  |
| [518](#L518) | case 'notagssublist': |
| [519](#L519) | $tagsnamelike = ''; |
| [520](#L520) | $tagsnamesearch = ''; |
| [521](#L521) | $this->fromgroupselect = 0; /\* since 1.3.0 \*/ |
| [522](#L522) | $this->groupexclude = false; |
| [523](#L523) | $message .= ' no sub list of tags'; |
| [524](#L524) | $actiontype = 'add'; |
| [525](#L525) | break; |
| [526](#L526) |  |
| [527](#L527) | case 'tagssublist': |
| [528](#L528) | check\_admin\_referer( 'xilitagassign' ); |
| [529](#L529) | $message .= ' sub list of tags starting with ' . $\_POST['tagsnamelike']; |
| [530](#L530) | $message .= ' . From group ' . $\_POST['tagsgroup\_from\_select']; |
| [531](#L531) | $actiontype = 'add'; |
| [532](#L532) | break; |
| [533](#L533) |  |
| [534](#L534) | case 'subselection': |
| [535](#L535) | check\_admin\_referer( 'xilitagassign' ); |
| [536](#L536) | $tagsnamelike = $\_POST['tagsnamelike']; |
| [537](#L537) | $tagsnamesearch = $\_POST['tagsnamesearch']; |
| [538](#L538) | $message .= ' selection of ' . $\_POST['tagsgroup\_parent\_select']; |
| [539](#L539) | $msg = 2; |
| [540](#L540) | $actiontype = 'add'; |
| [541](#L541) | break; |
| [542](#L542) |  |
| [543](#L543) | case 'subselectiong': // 1.7 |
| [544](#L544) | check\_admin\_referer( 'xtt-tps' ); |
| [545](#L545) | $message .= ' selection of ' . $\_GET['tps']; |
| [546](#L546) | $msg = 2; |
| [547](#L547) | $actiontype = 'add'; |
| [548](#L548) | break; |
| [549](#L549) |  |
| [550](#L550) | case 'update': |
| [551](#L551) | // redundant nonce !! 230801 |
| [552](#L552) | if ( wp\_verify\_nonce( $\_POST['assign\_nonce'], 'update\_checks' ) ) { |
| [553](#L553) | check\_admin\_referer( 'xilitagassign' ); |
| [554](#L554) | $message .= ' ok:: datas are saved... '; |
| [555](#L555) | $message .= $this->checkboxes\_update\_them( $tagsnamelike, $tagsnamesearch ); |
| [556](#L556) | $msg = 1; |
| [557](#L557) | $actiontype = 'add'; |
| [558](#L558) | } else { |
| [559](#L559) | $message = "NONCE error"; |
| [560](#L560) | $msg = 2; |
| [561](#L561) | } |
| [562](#L562) | break; |
| [563](#L563) |  |
| [564](#L564) | case 'reset': |
| [565](#L565) | $actiontype = 'add'; |
| [566](#L566) | break; |
| [567](#L567) |  |
| [568](#L568) | default: |
| [569](#L569) | $actiontype = 'add'; |
| [570](#L570) | /\* translators: \*/ |
| [571](#L571) | $message .= sprintf( \_\_( 'Find the list of %s. ', 'xili-tidy-tags' ), $this->tags\_name ); |
| [572](#L572) | } |
| [573](#L573) | /\* form datas in array for do\_meta\_boxes() \*/ |
| [574](#L574) | $data = array( |
| [575](#L575) | 'xili\_tidy\_tags\_page' => $xili\_tidy\_tags\_page, |
| [576](#L576) | 'message' => $message, |
| [577](#L577) | 'action' => $action, |
| [578](#L578) | 'submit\_text' => $submit\_text, |
| [579](#L579) | 'cancel\_text' => $cancel\_text, |
| [580](#L580) | 'term\_id' => $term\_id, |
| [581](#L581) | 'tagsnamesearch' => $tagsnamesearch, |
| [582](#L582) | 'tagsnamelike' => $tagsnamelike, |
| [583](#L583) | ); |
| [584](#L584) |  |
| [585](#L585) | /\* register the main boxes always available \*/ |
| [586](#L586) | add\_meta\_box( 'xili\_tidy\_tags-sidebox-action', \_\_( 'Actions', 'xili-tidy-tags' ), array( &$this, 'on\_sub\_sidebox\_action\_content' ), $this->thehook2, 'side', 'core' ); /\* Actions \*/ |
| [587](#L587) | /\* translators: \*/ |
| [588](#L588) | add\_meta\_box( 'xili\_tidy\_tags-normal-tags', sprintf( esc\_html\_\_( 'Tidy %s', 'xili-tidy-tags' ), $this->tags\_name ), array( &$this, 'on\_sub\_normal\_tags\_list\_content' ), $this->thehook2, 'normal', 'core' ); /\* list of tags\*/ |
| [589](#L589) |  |
| [590](#L590) | $themessages[1] = \_\_( 'List updated in database !', 'xili-tidy-tags' ); |
| [591](#L591) |  |
| [592](#L592) | $themessages[2] = $message; |
| [593](#L593) | $themessages[3] = \_\_( 'Post Type <strong>not declared</strong> in Custom Taxonomy !', 'xili-tidy-tags' ); |
| [594](#L594) | ?> |
| [595](#L595) | <div id="xili-tidy-tags-assign" class="wrap columns-2" style="min-width:880px"> |
| [596](#L596) |  |
| [597](#L597) | <h2><?php /\* translators: \*/ printf( esc\_html\_\_( '%1$s in group with post type named: %2$s', 'xili-tidy-tags' ), $this->tags\_name, $this->post\_tag\_post\_type); ?></h2> |
| [598](#L598) | <?php |
| [599](#L599) | if ( 0 != $msg && '' != $msg ) { |
| [600](#L600) | ?> |
| [601](#L601) | <div id="message" class="updated fade"><p><?php echo $themessages[ $msg ]; ?></p></div> |
| [602](#L602) | <?php |
| [603](#L603) | } |
| [604](#L604) | $preassign = ( 'post\_tag' == $this->post\_tag ) ? 'xili\_tidy\_tags\_assign' : 'xili\_tidy\_tags\_assign\_' . $this->post\_tag; |
| [605](#L605) | ?> |
| [606](#L606) | <form name='add' id='add' method="post" action="admin.php?page=<?php echo $preassign; ?>"> |
| [607](#L607) | <input type="hidden" name="action" value="<?php echo $actiontype; ?>" /> |
| [608](#L608) | <?php wp\_nonce\_field( 'xili-tidy-tags-settings' ); ?> |
| [609](#L609) | <?php wp\_nonce\_field( 'closedpostboxes', 'closedpostboxesnonce', false ); ?> |
| [610](#L610) | <?php |
| [611](#L611) | wp\_nonce\_field( 'meta-box-order', 'meta-box-order-nonce', false ); |
| [612](#L612) |  |
| [613](#L613) | global $wp\_version; |
| [614](#L614) | if ( version\_compare( $wp\_version, '3.3.9', '<' ) ) { |
| [615](#L615) | $poststuff\_class = 'class="metabox-holder has-right-sidebar"'; |
| [616](#L616) | $postbody\_class = ''; |
| [617](#L617) | $postleft\_id = ''; |
| [618](#L618) | $postright\_id = 'side-info-column'; |
| [619](#L619) | $postleft\_class = ''; |
| [620](#L620) | $postright\_class = 'inner-sidebar'; |
| [621](#L621) | } else { // 3.4 |
| [622](#L622) | $poststuff\_class = ''; |
| [623](#L623) | $postbody\_class = 'class="metabox-holder columns-2"'; |
| [624](#L624) | $postleft\_id = 'id="postbox-container-2"'; |
| [625](#L625) | $postright\_id = 'postbox-container-1'; |
| [626](#L626) | $postleft\_class = 'class="postbox-container"'; |
| [627](#L627) | $postright\_class = 'postbox-container'; |
| [628](#L628) | } |
| [629](#L629) |  |
| [630](#L630) | ?> |
| [631](#L631) | <div id="poststuff" <?php echo $poststuff\_class; ?>> |
| [632](#L632) | <div id="post-body" <?php echo $postbody\_class; ?> > |
| [633](#L633) | <div id="<?php echo $postright\_id; ?>" class="<?php echo $postright\_class; ?>"> |
| [634](#L634) | <?php do\_meta\_boxes( $this->thehook2, 'side', $data); ?> |
| [635](#L635) | </div> |
| [636](#L636) |  |
| [637](#L637) | <div id="post-body-content" > |
| [638](#L638) | <div <?php echo $postleft\_id; ?> <?php echo $postleft\_class; ?> style="min-width:580px"> |
| [639](#L639) | <?php do\_meta\_boxes( $this->thehook2, 'normal', $data ); ?> |
| [640](#L640) | </div> |
| [641](#L641) |  |
| [642](#L642) | <h4><a href="http://dev.xiligroup.com/xili-tidy-tags" title="Plugin page and docs" target="\_blank" style="text-decoration:none" ><img style="vertical-align:middle" src="<?php echo plugins\_url( 'images/xilitidy-logo-32.png', $this->file\_file ); ?>" alt="xili-tidy-tags logo"/></a> - © <a href="http://dev.xiligroup.com" target="\_blank" title="<?php esc\_html\_e( 'Author' ); ?>" >xiligroup.com</a>™ - msc 2009-20 - v. <?php echo XILITIDYTAGS\_VER; ?></h4> |
| [643](#L643) |  |
| [644](#L644) | </div> |
| [645](#L645) | </div> |
| [646](#L646) | <br class="clear" /> |
| [647](#L647) | </div> |
| [648](#L648) | <?php wp\_nonce\_field( 'xilitagassign' ); ?> |
| [649](#L649) | </form> |
| [650](#L650) | </div> |
| [651](#L651) | <script type="text/javascript"> |
| [652](#L652) | //<![CDATA[ |
| [653](#L653) |  |
| [654](#L654) |  |
| [655](#L655) | var assignTable; |
| [656](#L656) | jQuery(document) .ready( function( $) { |
| [657](#L657) | <?php if ( '' == $this->xili\_settings['datatable\_js'] ) { ?> |
| [658](#L658) | $( '#tableupdating' ).hide(); |
| [659](#L659) |  |
| [660](#L660) | var assignTable = $( '#assigntable' ).dataTable( { |
| [661](#L661) | "iDisplayLength": 30, |
| [662](#L662) | "bStateSave": true, |
| [663](#L663) | "sDom": '<"topbanner"ipf>rt<"bottombanner"lp><"clear">', |
| [664](#L664) | "sPaginationType": "full\_numbers", |
| [665](#L665) | "aLengthMenu": [[15, 30, 60, -1], [15, 30, 60, "<?php esc\_html\_e( 'All lines', 'xili-tidy-tags' ); ?>"]], |
| [666](#L666) | "oLanguage": { |
| [667](#L667) | "oPaginate": { |
| [668](#L668) | "sFirst": "<?php esc\_html\_e( 'First', 'xili-tidy-tags' ); ?>", |
| [669](#L669) | "sLast": "<?php esc\_html\_e( 'Last page', 'xili-tidy-tags' ); ?>", |
| [670](#L670) | "sNext": "<?php esc\_html\_e( 'Next', 'xili-tidy-tags' ); ?>", |
| [671](#L671) | "sPrevious": "<?php esc\_html\_e( 'Previous', 'xili-tidy-tags' ); ?>" |
| [672](#L672) | }, |
| [673](#L673) | "sInfo": "<?php printf( esc\_html\_\_( 'Showing (\_START\_ to \_END\_) of \_TOTAL\_ %s', 'xili-tidy-tags' ), $this->tags\_name ); ?>", |
| [674](#L674) | "sInfoFiltered": "<?php esc\_html\_e( '(filtered from \_MAX\_ total entries)', 'xili-tidy-tags' ); ?>", |
| [675](#L675) | "sLengthMenu": "<?php esc\_html\_e( 'Show \_MENU\_ tags', 'xili-tidy-tags' ); ?>", |
| [676](#L676) | "sSearch": "<?php esc\_html\_e( 'Filter tags:', 'xili-tidy-tags' ); ?>" |
| [677](#L677) | }, |
| [678](#L678) | "aaSorting": [[1,'asc']], |
| [679](#L679) | "aoColumns": [ |
| [680](#L680) | { "bSearchable": false }, |
| [681](#L681) | null, |
| [682](#L682) | { "bSortable": false, "bSearchable": false }, |
| [683](#L683) | { "bSortable": false, "bSearchable": false }] |
| [684](#L684) | } ); |
| [685](#L685) |  |
| [686](#L686) | $( '#assigntable' ).css({ visibility:'visible' }); |
| [687](#L687) |  |
| [688](#L688) | $( '#update' ).click( function () { |
| [689](#L689) |  |
| [690](#L690) | $( '#assigntable' ).hide(); |
| [691](#L691) |  |
| [692](#L692) | $( '#tableupdating' ).html("<br /><br /><h1><?php esc\_html\_e( 'Updating table of tags !', 'xili-tidy-tags' ); ?></h1>"); |
| [693](#L693) | $( '#tableupdating' ).show(); |
| [694](#L694) | assignTable.fnDestroy(); |
| [695](#L695) | } ); |
| [696](#L696) | <?php } ?> |
| [697](#L697) | // close postboxes that should be closed |
| [698](#L698) | $( ' .if-js-closed' ).removeClass( 'if-js-closed' ) .addClass( 'closed' ); |
| [699](#L699) | // postboxes setup |
| [700](#L700) | postboxes.add\_postbox\_toggles( '<?php echo $this->thehook2; ?>' ); |
| [701](#L701) | }); |
| [702](#L702) |  |
| [703](#L703) | //]]> |
| [704](#L704) | </script> |
| [705](#L705) | <?php |
| [706](#L706) | } |
| [707](#L707) |  |
| [708](#L708) | /\* |
| [709](#L709) | \* Update the relationships according CheckBoxes |
| [710](#L710) | \* |
| [711](#L711) | \*/ |
| [712](#L712) | public function checkboxes\_update\_them( $tagsnamelike = '', $tagsnamesearch = '' ) { |
| [713](#L713) |  |
| [714](#L714) | $listgroups = get\_terms( |
| [715](#L715) | $this->tidy\_taxonomy, |
| [716](#L716) | array( |
| [717](#L717) | 'hide\_empty' => false, |
| [718](#L718) | 'get' => 'all', |
| [719](#L719) | ) |
| [720](#L720) | ); |
| [721](#L721) |  |
| [722](#L722) | if ( 0 == $this->fromgroupselect && false === $this->onlyuncheckedtags ) { |
| [723](#L723) | $listtags = get\_terms( |
| [724](#L724) | $this->post\_tag, |
| [725](#L725) | array( |
| [726](#L726) | 'hide\_empty' => false, |
| [727](#L727) | 'get' => 'all', |
| [728](#L728) | 'name\_\_like' => $tagsnamelike, |
| [729](#L729) | 'search' => $tagsnamesearch, |
| [730](#L730) | ) |
| [731](#L731) | ); |
| [732](#L732) | } else { |
| [733](#L733) | /\* since 1.3.0 \*/ |
| [734](#L734) | if ( false === $this->onlyuncheckedtags ) { // one group |
| [735](#L735) | $group\_id[] = $this->fromgroupselect; |
| [736](#L736) | if ( false === $this->onlyparent ) { |
| [737](#L737) | $childterms = get\_terms( |
| [738](#L738) | $this->tidy\_taxonomy, |
| [739](#L739) | array( |
| [740](#L740) | 'hide\_empty' => false, |
| [741](#L741) | 'parent' => $this->fromgroupselect, |
| [742](#L742) | ) |
| [743](#L743) | ); |
| [744](#L744) | if ( ! empty( $childterms ) ) { |
| [745](#L745) | foreach ( $childterms as $childterm ) { /\* if group is a parent, add all childs \*/ |
| [746](#L746) | $group\_id[] = $childterm->term\_id; |
| [747](#L747) | } |
| [748](#L748) | } |
| [749](#L749) | } |
| [750](#L750) | } else { // only all unchecked |
| [751](#L751) | $listgroups = get\_terms( |
| [752](#L752) | $this->tidy\_taxonomy, |
| [753](#L753) | array( |
| [754](#L754) | 'hide\_empty' => false, |
| [755](#L755) | 'get' => 'all', |
| [756](#L756) | ) |
| [757](#L757) | ); |
| [758](#L758) | foreach ( $listgroups as $group ) { |
| [759](#L759) | $group\_id[] = $group->term\_id; |
| [760](#L760) | } |
| [761](#L761) | $this->groupexclude = true; |
| [762](#L762) | $this->uncheckedtags = true; |
| [763](#L763) | } |
| [764](#L764) | $listtags = xtt\_get\_terms\_of\_groups\_new( |
| [765](#L765) | $group\_id, |
| [766](#L766) | $this->tidy\_taxonomy, |
| [767](#L767) | $this->post\_tag, |
| [768](#L768) | array( |
| [769](#L769) | 'hide\_empty' => false, |
| [770](#L770) | 'get' => 'all', |
| [771](#L771) | 'name\_\_like' => $tagsnamelike, |
| [772](#L772) | 'search' => $tagsnamesearch, |
| [773](#L773) | 'orderby' => 'name', |
| [774](#L774) | ), |
| [775](#L775) | $this->groupexclude, |
| [776](#L776) | $this->uncheckedtags |
| [777](#L777) | ); |
| [778](#L778) | } |
| [779](#L779) |  |
| [780](#L780) | foreach ( $listtags as $tag ) { |
| [781](#L781) | $groupids = array(); |
| [782](#L782) | foreach ( $listgroups as $group ) { |
| [783](#L783) | $idcheck = 'line-' . $tag->term\_id . '-' . $group->term\_id; |
| [784](#L784) | if ( isset( $\_POST[ $idcheck ] ) ) { |
| [785](#L785) | $groupids[] = (int) $group->term\_id; |
| [786](#L786) | } |
| [787](#L787) | } |
| [788](#L788) | $datavisible = 'hidden\_termid-' . $tag->term\_id; |
| [789](#L789) | // if ( isset( $\_POST[$datavisible] ) ) |
| [790](#L790) | wp\_set\_object\_terms( (int) $tag->term\_id, $groupids, $this->tidy\_taxonomy, false ); |
| [791](#L791) | } |
| [792](#L792) |  |
| [793](#L793) | return; |
| [794](#L794) | } |
| [795](#L795) |  |
| [796](#L796) | public function on\_load\_page2() { |
| [797](#L797) | wp\_enqueue\_script( 'common' ); |
| [798](#L798) | wp\_enqueue\_script( 'wp-lists' ); |
| [799](#L799) | wp\_enqueue\_script( 'postbox' ); |
| [800](#L800) |  |
| [801](#L801) | $pre = ( 'post\_tag' == $this->post\_tag ) ? '' : $this->post\_tag . '\_'; |
| [802](#L802) | add\_meta\_box( $pre . 'xili\_tidy\_tags-sidebox-1', \_\_( 'Message', 'xili-tidy-tags' ), array( &$this, 'on\_sidebox\_msg\_content' ), $this->thehook2, 'side', 'core' ); |
| [803](#L803) | add\_meta\_box( $pre . 'xili\_tidy\_tags-sidebox-3', \_\_( 'Info', 'xili-tidy-tags' ), array( &$this, 'on\_sidebox\_info\_content' ), $this->thehook2, 'side', 'core' ); |
| [804](#L804) | } |
| [805](#L805) |  |
| [806](#L806) | /\*\* |
| [807](#L807) | \* @since 1.5.0 |
| [808](#L808) | \* @updated 2.10.3 |
| [809](#L809) | \*/ |
| [810](#L810) | public function admin\_enqueue\_scripts() { |
| [811](#L811) | wp\_enqueue\_script( 'datatables-v10' ); |
| [812](#L812) | } |
| [813](#L813) |  |
| [814](#L814) | public function admin\_enqueue\_styles() { |
| [815](#L815) | wp\_enqueue\_style( 'table\_style-v10' ); |
| [816](#L816) | } |
| [817](#L817) |  |
| [818](#L818) |  |
| [819](#L819) | /\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\* TAXONOMIES LIST \*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*/ |
| [820](#L820) |  |
| [821](#L821) | /\*\* |
| [822](#L822) | \* add in edit list language column |
| [823](#L823) | \* |
| [824](#L824) | \* @since 1.7 |
| [825](#L825) | \* |
| [826](#L826) | \* |
| [827](#L827) | \*/ |
| [828](#L828) | public function xili\_manage\_tax\_column\_name( $cols ) { |
| [829](#L829) |  |
| [830](#L830) | //if ( class\_exists ( 'xili\_language' ) ) { |
| [831](#L831) | $ends = array( 'posts' ); |
| [832](#L832) | $end = array(); |
| [833](#L833) | foreach ( $cols as $k => $v ) { |
| [834](#L834) | if ( in\_array( $k, $ends ) ) { |
| [835](#L835) | $end[ $k ] = $v; |
| [836](#L836) | unset( $cols[ $k ] ); |
| [837](#L837) | } |
| [838](#L838) | } |
| [839](#L839) | if ( defined( 'TAXONAME' ) ) { |
| [840](#L840) | $cols[ TAXONAME ] = esc\_html\_\_( 'Language', 'xili-language' ); |
| [841](#L841) | } |
| [842](#L842) | // for grouping |
| [843](#L843) | $cols['alias\_of'] = esc\_html\_\_( 'Alias of', 'xili-tidy-tags' ); |
| [844](#L844) | $cols = array\_merge( $cols, $end ); |
| [845](#L845) |  |
| [846](#L846) | ///$this->local\_theme\_mos = $this->get\_localmos\_from\_theme(); |
| [847](#L847) | //} |
| [848](#L848) | return $cols; |
| [849](#L849) | } |
| [850](#L850) |  |
| [851](#L851) | public function xili\_manage\_tax\_column( $dummy, $name, $id ) { |
| [852](#L852) |  |
| [853](#L853) | global $wpdb, $taxonomy; |
| [854](#L854) | $tax = get\_term( (int) $id, $taxonomy ); |
| [855](#L855) | $a = ''; |
| [856](#L856) |  |
| [857](#L857) | if ( defined( 'TAXONAME' ) && TAXONAME == $name ) { |
| [858](#L858) | // loop of languages |
| [859](#L859) | $listlanguages = get\_terms( TAXONAME, array( 'hide\_empty' => false ) ); |
| [860](#L860) |  |
| [861](#L861) | foreach ( $listlanguages as $lang ) { |
| [862](#L862) |  |
| [863](#L863) | // test in group xx\_yy-tidy-languages-group |
| [864](#L864) | if ( is\_object\_in\_term( $id, $this->tidy\_taxonomy, $lang->slug . '-' . $this->xili\_settings['tidylangsgroup'] ) ) { |
| [865](#L865) | // link + class |
| [866](#L866) | $group = term\_exists( $lang->slug . '-' . $this->xili\_settings['tidylangsgroup'], $this->tidy\_taxonomy ); |
| [867](#L867) | $nonce\_url = wp\_nonce\_url( 'admin.php?page=xili\_tidy\_tags\_assign&tps=' . $group['term\_id'], 'xtt-tps' ); // wp-admin/admin.php?page=xili\_tidy\_tags\_assign&tps=8 |
| [868](#L868) | /\* translators: \*/ |
| [869](#L869) | $a .= '<span title="' . sprintf( esc\_html\_\_( 'Tags in %s. ', 'xili-tidy-tags' ), $lang->description ) . '" class="curlang lang-' . $lang->slug . '"><a href="' . $nonce\_url . '" >' . $lang->name . '</a></span>'; |
| [870](#L870) | } |
| [871](#L871) | } |
| [872](#L872) | if ( '' != $a ) { |
| [873](#L873) | $a = '<div class="edittag" >' . \_\_( 'assigned in:', 'xili-tidy-tags' ) . ' ' . $a; |
| [874](#L874) | $a .= '</div>'; |
| [875](#L875) | return $a; |
| [876](#L876) | } |
| [877](#L877) | } else if ( 'alias\_of' == $name ) { |
| [878](#L878) |  |
| [879](#L879) | if ( $tax->term\_group > 0 ) { |
| [880](#L880) | // search terms of same group |
| [881](#L881) | $alias\_group = $wpdb->get\_results( $wpdb->prepare( "SELECT \* FROM $wpdb->terms WHERE term\_group = %s", $tax->term\_group) ); |
| [882](#L882) |  |
| [883](#L883) | if ( $alias\_group ) { |
| [884](#L884) | foreach ( $alias\_group as $one\_alias ) { |
| [885](#L885) | if ( $one\_alias->slug != $tax->slug ) { |
| [886](#L886) | $link = get\_edit\_tag\_link( $one\_alias->term\_id, $taxonomy ); |
| [887](#L887) | $a .= '<a href="' . $link . '">' . $one\_alias->name . '</a>'; |
| [888](#L888) | //if ( class\_exists( 'xili\_language' ) ) { |
| [889](#L889) | if ( $langs = $this->return\_lang\_of\_tag( $one\_alias->term\_id ) ) { |
| [890](#L890) | foreach ( $langs as $lang ) { |
| [891](#L891) | /\* translators: \*/ |
| [892](#L892) | $a .= ' <span title="' . sprintf( esc\_html\_\_( 'Tags in %s. ', 'xili-tidy-tags' ), $lang->description ) . '" class="curlang lang-' . $lang->slug . '"><a href="' . $link . '">' . $lang->name . '</a></span>'; |
| [893](#L893) | } |
| [894](#L894) | } |
| [895](#L895) | //} |
| [896](#L896) | $a .= '<br />'; |
| [897](#L897) | } |
| [898](#L898) | } |
| [899](#L899) | } |
| [900](#L900) | if ( '' != $a ) { |
| [901](#L901) | $a = '<div class="edittag" ><em>' . \_\_( 'Alias:', 'xili-tidy-tags' ) . '</em><br />' . $a; |
| [902](#L902) | $a .= '</div>'; |
| [903](#L903) | return $a; |
| [904](#L904) | } |
| [905](#L905) | } |
| [906](#L906) | return $a; |
| [907](#L907) | } |
| [908](#L908) | } |
| [909](#L909) |  |
| [910](#L910) |  |
| [911](#L911) | /\*\* |
| [912](#L912) | \* in post edit UI if new term was created - give it a group |
| [913](#L913) | \* |
| [914](#L914) | \* @since 0.9.4 |
| [915](#L915) | \* |
| [916](#L916) | \* |
| [917](#L917) | \*/ |
| [918](#L918) | public function xili\_tags\_grouping( $post\_ID ) { |
| [919](#L919) |  |
| [920](#L920) | if ( ! class\_exists( 'xili\_language' ) ) { |
| [921](#L921) | return; /\* only used if present \*/ |
| [922](#L922) | } |
| [923](#L923) |  |
| [924](#L924) | $list\_tags = wp\_get\_object\_terms( $post\_ID, $this->post\_tag ); |
| [925](#L925) | if ( ! $list\_tags ) { |
| [926](#L926) | return; /\* no tag\*/ |
| [927](#L927) | } |
| [928](#L928) | $post\_curlang = get\_cur\_language( $post\_ID ); |
| [929](#L929) |  |
| [930](#L930) | $listlanggroups = get\_terms( |
| [931](#L931) | $this->tidy\_taxonomy, |
| [932](#L932) | array( |
| [933](#L933) | 'hide\_empty' => false, |
| [934](#L934) | 'parent' => $this->langgroupid, |
| [935](#L935) | ) |
| [936](#L936) | ); |
| [937](#L937) | if ( $listlanggroups ) { |
| [938](#L938) | foreach ( $listlanggroups as $curgroup ) { |
| [939](#L939) | $langsgroup[] = $curgroup->term\_id; |
| [940](#L940) | } |
| [941](#L941) | $langsgroup[] = $this->langgroupid; /\* add group parent \*/ |
| [942](#L942) | foreach ( $list\_tags as $tag ) { |
| [943](#L943) | /\* test if the tag is owned by a group \*/ |
| [944](#L944) | $nbchecked = false; |
| [945](#L945) | foreach ( $langsgroup as $onelanggroup ) { |
| [946](#L946) | if ( is\_object\_in\_term( $tag->term\_id, $this->tidy\_taxonomy, $onelanggroup ) ) { |
| [947](#L947) | $nbchecked = true; |
| [948](#L948) | } |
| [949](#L949) | } |
| [950](#L950) | if ( false == $nbchecked ) { |
| [951](#L951) | if ( false == $post\_curlang ) { /\* add to group parent \*/ |
| [952](#L952) | wp\_set\_object\_terms( (int) $tag->term\_id, (int) $this->langgroupid, $this->tidy\_taxonomy, false ); |
| [953](#L953) | } else { |
| [954](#L954) | $res = term\_exists( $post\_curlang, $this->tidy\_taxonomy ); |
| [955](#L955) | wp\_set\_object\_terms( (int) $tag->term\_id, (int) $res ['term\_id'], $this->tidy\_taxonomy, false ); |
| [956](#L956) | } |
| [957](#L957) | } |
| [958](#L958) | } |
| [959](#L959) | } |
| [960](#L960) | } |
| [961](#L961) |  |
| [962](#L962) | /\*\* |
| [963](#L963) | \* a new term was created - grouping is assigned |
| [964](#L964) | \* |
| [965](#L965) | \* @since 0.8.0 |
| [966](#L966) | \* @updated 1.2.1, 1.10 - see xili\_edited\_term |
| [967](#L967) | \* |
| [968](#L968) | \*/ |
| [969](#L969) | public function xili\_created\_term( $term\_id, $tt\_id ) { |
| [970](#L970) | /\* check if it is a term from $this->post\_tag  \*/ |
| [971](#L971) | if ( ! isset( $\_POST['\_inline\_edit'] ) ) { /\* to avoid delete relationship when in quick\_edit (edit-tags.php) \*/ |
| [972](#L972) |  |
| [973](#L973) | $term = get\_term( (int) $term\_id, $this->post\_tag ); |
| [974](#L974) | if ( $term ) { |
| [975](#L975) | $listgroups = get\_terms( |
| [976](#L976) | $this->tidy\_taxonomy, |
| [977](#L977) | array( |
| [978](#L978) | 'hide\_empty' => false, |
| [979](#L979) | 'get' => 'all', |
| [980](#L980) | ) |
| [981](#L981) | ); |
| [982](#L982) | $groupids = array(); |
| [983](#L983) | foreach ( $listgroups as $group ) { |
| [984](#L984) | $idcheck = 'group-' . $group->term\_id; |
| [985](#L985) | if ( isset( $\_POST[ $idcheck ] ) ) { |
| [986](#L986) | $groupids[] = (int) $group->term\_id; |
| [987](#L987) | } |
| [988](#L988) | } |
| [989](#L989) | wp\_set\_object\_terms( $term\_id, $groupids, $this->tidy\_taxonomy, false ); |
| [990](#L990) | } |
| [991](#L991) | } |
| [992](#L992) | } |
| [993](#L993) |  |
| [994](#L994) |  |
| [995](#L995) | /\*\* |
| [996](#L996) | \* a new term was edited - grouping is assigned |
| [997](#L997) | \* |
| [998](#L998) | \* @since 1.10 |
| [999](#L999) | \* |
| [1000](#L1000) | \*/ |
| [1001](#L1001) | public function xili\_edited\_term( $term\_id, $tt\_id ) { |
| [1002](#L1002) | // to avoid calls when aliases are updated |
| [1003](#L1003) | if ( isset( $\_POST['action'] ) && 'add-tag' != $\_POST['action'] ) { |
| [1004](#L1004) | return; // when called in add tag screen |
| [1005](#L1005) | } |
| [1006](#L1006) |  |
| [1007](#L1007) | if ( isset( $\_POST['tag\_ID'] ) && $\_POST['tag\_ID'] != $term\_id ) { |
| [1008](#L1008) | return; // when called in edit tag screen (modify alias) |
| [1009](#L1009) | } |
| [1010](#L1010) |  |
| [1011](#L1011) | /\* check if it is a term from $this->post\_tag  \*/ |
| [1012](#L1012) | if ( ! isset( $\_POST['\_inline\_edit'] ) ) { /\* to avoid delete relationship when in quick\_edit (edit-tags.php) \*/ |
| [1013](#L1013) |  |
| [1014](#L1014) | $term = get\_term( (int) $term\_id, $this->post\_tag ); |
| [1015](#L1015) | if ( $term ) { |
| [1016](#L1016) | $listgroups = get\_terms( |
| [1017](#L1017) | $this->tidy\_taxonomy, |
| [1018](#L1018) | array( |
| [1019](#L1019) | 'hide\_empty' => false, |
| [1020](#L1020) | 'get' => 'all', |
| [1021](#L1021) | ) |
| [1022](#L1022) | ); |
| [1023](#L1023) | $groupids = array(); |
| [1024](#L1024) | foreach ( $listgroups as $group ) { |
| [1025](#L1025) | $idcheck = 'group-' . $group->term\_id; |
| [1026](#L1026) | if ( isset( $\_POST[ $idcheck ] ) ) { |
| [1027](#L1027) | $groupids[] = (int) $group->term\_id; |
| [1028](#L1028) | } |
| [1029](#L1029) | } |
| [1030](#L1030) | wp\_set\_object\_terms( $term\_id, $groupids, $this->tidy\_taxonomy, false ); |
| [1031](#L1031) | } |
| [1032](#L1032) | } |
| [1033](#L1033) | } |
| [1034](#L1034) |  |
| [1035](#L1035) |  |
| [1036](#L1036) | /\*\* |
| [1037](#L1037) | \* add in new tag form to choose a group for a new tag |
| [1038](#L1038) | \* |
| [1039](#L1039) | \* @since 0.8.0 |
| [1040](#L1040) | \* @update 1.6.2 - sorted display |
| [1041](#L1041) | \* |
| [1042](#L1042) | \*/ |
| [1043](#L1043) | public function xili\_add\_tag\_form() { |
| [1044](#L1044) | $listtagsgroups = get\_terms( |
| [1045](#L1045) | $this->tidy\_taxonomy, |
| [1046](#L1046) | array( |
| [1047](#L1047) | 'hide\_empty' => false, |
| [1048](#L1048) | 'get' => 'all', |
| [1049](#L1049) | ) |
| [1050](#L1050) | ); |
| [1051](#L1051) | if ( ! is\_wp\_error( $listtagsgroups ) && $listtagsgroups ) { |
| [1052](#L1052) | $listtagsgroupssorted = $this->create\_taggrouplist\_sorted( walk\_TagGroupList\_sorted( $listtagsgroups, 3, null, null ) ); |
| [1053](#L1053) |  |
| [1054](#L1054) | $checkline = ''; |
| [1055](#L1055) | $i = 0; |
| [1056](#L1056) | foreach ( $listtagsgroupssorted as $group ) { |
| [1057](#L1057) | if ( 0 != $group->parent ) { |
| [1058](#L1058) | $disp\_group = $group->name; |
| [1059](#L1059) | $checkline .= '&nbsp;-&nbsp;'; |
| [1060](#L1060) | } else { |
| [1061](#L1061) | if ( $group->slug == $this->xili\_settings['tidylangsgroup'] ) { |
| [1062](#L1062) | $lang\_class = true; |
| [1063](#L1063) | } else { |
| [1064](#L1064) | $lang\_class = false; |
| [1065](#L1065) | } |
| [1066](#L1066) | $disp\_group = '<strong>' . $group->name . '</strong>'; |
| [1067](#L1067) | if ( 0 != $i ) { |
| [1068](#L1068) | $checkline .= '</br>'; |
| [1069](#L1069) | } |
| [1070](#L1070) | } |
| [1071](#L1071) | if ( $lang\_class ) { |
| [1072](#L1072) | $the\_class = 'class="curlang lang-' . str\_replace( '-' . $this->xili\_settings['tidylangsgroup'], '', $group->slug ) . '"'; |
| [1073](#L1073) | $disp\_group = '<span ' . $the\_class . ' title="' . $group->name . '" >' . $disp\_group . '</span>'; |
| [1074](#L1074) | } |
| [1075](#L1075) | $checkline .= '<input type="checkbox" id="group-' . $group->term\_id . '" name="group-' . $group->term\_id . '" value="' . $group->term\_id . '" />' . $disp\_group; |
| [1076](#L1076) | $i++; |
| [1077](#L1077) | } |
| [1078](#L1078) | /\* translators: \*/ |
| [1079](#L1079) | $checkline .= '<br /><br /><small>' . sprintf( esc\_html\_\_( '© by xili-tidy-tags v. %s', 'xili-tidy-tags' ), XILITIDYTAGS\_VER ) . '</small>'; |
| [1080](#L1080) | /\* translators: \*/ |
| [1081](#L1081) | echo '<div id="xtt-edit-tag" style="max-width:525px; margin:2px 22px 2px 2px; padding:3px; border:1px solid #ccc;"><label>' . sprintf( \_\_( '%s groups', 'xili-tidy-tags' ), $this->tags\_name ) . ':</label><br />' . $checkline . '</div>'; |
| [1082](#L1082) | } else { |
| [1083](#L1083) | echo '<p style="color:red"> ERROR IN xili-tidy-tags TAXONOMY: ' . $this->tidy\_taxonomy . '</p>'; // 1.8.3 |
| [1084](#L1084) | } |
| [1085](#L1085) |  |
| [1086](#L1086) | } |
| [1087](#L1087) |  |
| [1088](#L1088) |  |
| [1089](#L1089) | /\*\* |
| [1090](#L1090) | \* add in edit tag form to choose a group for a edited tag |
| [1091](#L1091) | \* |
| [1092](#L1092) | \* @since 0.8.0 |
| [1093](#L1093) | \* |
| [1094](#L1094) | \* |
| [1095](#L1095) | \*/ |
| [1096](#L1096) | public function xili\_add\_tag\_alias( $tag ) { |
| [1097](#L1097) | global $wpdb; |
| [1098](#L1098) | $checkline = ''; |
| [1099](#L1099) |  |
| [1100](#L1100) | $val = ( is\_string( $tag ) ) ? \_\_( 'new', 'xili-tidy-tags' ) . ' ' : ''; |
| [1101](#L1101) |  |
| [1102](#L1102) | $context = ( class\_exists( 'xili\_language' ) ) ? \_\_( 'in another language', 'xili-tidy-tags' ) : \_\_( 'as synonym', 'xili-tidy-tags' ); |
| [1103](#L1103) | /\* translators: \*/ |
| [1104](#L1104) | $checkline = '<p>' . sprintf( esc\_html\_\_( 'This sub-form contains a field to define alias of this %1$s%2$s. Choose a %2$s already present %3$s. ', 'xili-tidy-tags' ), $val, $this->singular\_name, $context ) . '</p>'; |
| [1105](#L1105) |  |
| [1106](#L1106) | if ( ! is\_string( $tag ) && $tag->term\_group > 0 ) { |
| [1107](#L1107) |  |
| [1108](#L1108) | $alias\_group = $wpdb->get\_results( $wpdb->prepare( "SELECT \* FROM $wpdb->terms WHERE term\_group = %s", $tag->term\_group ) ); |
| [1109](#L1109) |  |
| [1110](#L1110) | if ( $alias\_group ) { |
| [1111](#L1111) | /\* translators: \*/ |
| [1112](#L1112) | $checkline .= '<p><em>' . sprintf( \_\_( 'This %1$s (%2$s) is already present in the group %3$s:', 'xili-tidy-tags' ), $this->singular\_name, $tag->name, \_n( sprintf( \_x( 'of the following %s', 'singular', 'xili-tidy-tags' ), $this->singular\_name ), sprintf( \_x( 'of the following %s', 'plural', 'xili-tidy-tags' ), $this->tags\_name ), count( $alias\_group ) - 1 ) ) . '</em></p>'; |
| [1113](#L1113) | $list = array(); |
| [1114](#L1114) | foreach ( $alias\_group as $one\_alias ) { |
| [1115](#L1115) | if ( $one\_alias->slug != $tag->slug ) { |
| [1116](#L1116) |  |
| [1117](#L1117) | $list[] = $one\_alias->name; |
| [1118](#L1118) | } |
| [1119](#L1119) | } |
| [1120](#L1120) | $checkline .= implode( ' - ', $list ); |
| [1121](#L1121) | $checkline .= '<br /><br />'; |
| [1122](#L1122) | /\* translators: \*/ |
| [1123](#L1123) | $checkline .= '<p><em>' . sprintf( \_\_( 'Select below if you want to change the group of this %1$s (%2$s) . Be careful!', 'xili-tidy-tags' ), $this->singular\_name, $tag->name ) . '</em></p>'; |
| [1124](#L1124) | } |
| [1125](#L1125) | } |
| [1126](#L1126) |  |
| [1127](#L1127) | $checkline .= '<select name="alias\_of" id="alias\_of">'; // to be used when saved id= new field |
| [1128](#L1128) |  |
| [1129](#L1129) | // check another tags |
| [1130](#L1130) | $tags = get\_terms( |
| [1131](#L1131) | $this->post\_tag, |
| [1132](#L1132) | array( |
| [1133](#L1133) | 'hide\_empty' => false, |
| [1134](#L1134) | 'get' => 'all', |
| [1135](#L1135) | ) |
| [1136](#L1136) | ); |
| [1137](#L1137) | if ( ! is\_wp\_error( $tags ) ) { |
| [1138](#L1138) | $checkline .= '<option value="" >' . \_\_( 'Choice alias... ', 'xili-tidy-tags' ) . '</option>'; |
| [1139](#L1139) | foreach ( $tags as $one\_tag ) { |
| [1140](#L1140) |  |
| [1141](#L1141) | if ( class\_exists( 'xili\_language' ) ) { |
| [1142](#L1142) |  |
| [1143](#L1143) | $langs = $this->return\_lang\_of\_tag( $one\_tag->term\_id ); |
| [1144](#L1144) |  |
| [1145](#L1145) | if ( $langs ) { |
| [1146](#L1146) | $listnames  = array(); |
| [1147](#L1147) | foreach ( $langs as $onelang ) { |
| [1148](#L1148) | $listnames[] = $onelang->name; |
| [1149](#L1149) | } |
| [1150](#L1150) | $lang\_line = ' [' . implode( ' | ', $listnames ) . ']'; |
| [1151](#L1151) |  |
| [1152](#L1152) | } else { |
| [1153](#L1153) | $lang\_line = ''; |
| [1154](#L1154) | } |
| [1155](#L1155) | } else { |
| [1156](#L1156) | $lang\_line = ''; |
| [1157](#L1157) | } |
| [1158](#L1158) |  |
| [1159](#L1159) | $checkline .= '<option value="' . $one\_tag->slug . '">' . $one\_tag->name . $lang\_line . '</option>'; |
| [1160](#L1160) | } |
| [1161](#L1161) |  |
| [1162](#L1162) | $checkline .= '</select>'; |
| [1163](#L1163) | } |
| [1164](#L1164) | /\* translators: \*/ |
| [1165](#L1165) | $checkline .= '<br /><br /><small>' . sprintf( esc\_html\_\_( '© by xili-tidy-tags v. %s', 'xili-tidy-tags' ), XILITIDYTAGS\_VER ) . '</small>'; |
| [1166](#L1166) | /\* translators: \*/ |
| [1167](#L1167) | echo '<div id="xtt-edit-tag" style="max-width:525px; margin:2px 22px 2px 2px; padding:3px; border:1px solid #ccc;"><label>' . sprintf( \_\_( 'The %s aliases group', 'xili-tidy-tags' ), $this->tags\_name ) . ':<br /></label><br />' . $checkline . '</div>'; |
| [1168](#L1168) |  |
| [1169](#L1169) | } |
| [1170](#L1170) |  |
| [1171](#L1171) |  |
| [1172](#L1172) | /\*\* |
| [1173](#L1173) | \* add in edit tag form to choose a group for a edited tag |
| [1174](#L1174) | \* |
| [1175](#L1175) | \* @since 0.8.0 |
| [1176](#L1176) | \* |
| [1177](#L1177) | \* |
| [1178](#L1178) | \*/ |
| [1179](#L1179) | public function xili\_edit\_tag\_form( $tag ) { |
| [1180](#L1180) | $listtagsgroups = get\_terms( |
| [1181](#L1181) | $this->tidy\_taxonomy, |
| [1182](#L1182) | array( |
| [1183](#L1183) | 'hide\_empty' => false, |
| [1184](#L1184) | 'get' => 'all', |
| [1185](#L1185) | ) |
| [1186](#L1186) | ); |
| [1187](#L1187) |  |
| [1188](#L1188) | if ( ! is\_wp\_error( $listtagsgroups ) && $listtagsgroups ) { |
| [1189](#L1189) | $listtagsgroupssorted = $this->create\_taggrouplist\_sorted( walk\_TagGroupList\_sorted( $listtagsgroups, 3, null, null ) ); |
| [1190](#L1190) |  |
| [1191](#L1191) | $checkline = ''; |
| [1192](#L1192) | $i = 0; |
| [1193](#L1193) | foreach ( $listtagsgroupssorted as $group ) { |
| [1194](#L1194) | /\* add checked="checked" \*/ |
| [1195](#L1195) | if ( is\_object\_in\_term( $tag->term\_id, $this->tidy\_taxonomy, (int) $group->term\_id ) ) { |
| [1196](#L1196) | $checked = 'checked="checked"'; |
| [1197](#L1197) | } else { |
| [1198](#L1198) | $checked = ''; |
| [1199](#L1199) | } |
| [1200](#L1200) | if ( 0 != $group->parent ) { |
| [1201](#L1201) | $disp\_group = $group->name; |
| [1202](#L1202) | $checkline .= '&nbsp;-&nbsp;'; |
| [1203](#L1203) | } else { |
| [1204](#L1204) |  |
| [1205](#L1205) | if ( $group->slug == $this->xili\_settings['tidylangsgroup'] ) { |
| [1206](#L1206) | $lang\_class = true; |
| [1207](#L1207) | } else { |
| [1208](#L1208) | $lang\_class = false; |
| [1209](#L1209) | } |
| [1210](#L1210) | $disp\_group = '<strong>' . $group->name . '</strong>'; |
| [1211](#L1211) | if ( 0 != $i ) { |
| [1212](#L1212) | $checkline .= '</br>'; |
| [1213](#L1213) | } |
| [1214](#L1214) | } |
| [1215](#L1215) | if ( $lang\_class ) { |
| [1216](#L1216) | $the\_class = 'class="curlang lang-' . str\_replace( '-' . $this->xili\_settings['tidylangsgroup'], '', $group->slug ) . '"'; |
| [1217](#L1217) | $disp\_group = '<span ' . $the\_class . ' title="' . $group->name . '" >' . $disp\_group . '</span>'; |
| [1218](#L1218) | } |
| [1219](#L1219) | $checkline .= '<input type="checkbox" name="group-' . $group->term\_id . '" id="group-' . $group->term\_id . '" value="' . $group->term\_id . '" ' . $checked . ' />' . $disp\_group; |
| [1220](#L1220) | $i++; |
| [1221](#L1221) | } |
| [1222](#L1222) | /\* translators: \*/ |
| [1223](#L1223) | $checkline .= '<br /><br /><small>' . sprintf( esc\_html\_\_( '© by xili-tidy-tags v. %s', 'xili-tidy-tags' ), XILITIDYTAGS\_VER ) . '</small>'; |
| [1224](#L1224) | // display |
| [1225](#L1225) | /\* translators: \*/ |
| [1226](#L1226) | echo '<div id="xtt-edit-tag" style="width:525px; margin:2px; padding:3px; border:1px solid #ccc;"><label>' . sprintf( \_\_( '%s groups', 'xili-tidy-tags' ), $this->tags\_name ) . ':<br /></label><br />' . $checkline . '</div>'; |
| [1227](#L1227) |  |
| [1228](#L1228) | } else { |
| [1229](#L1229) | echo '<p style="color:red"> ERROR IN xili-tidy-tags TAXONOMY: ' . $this->tidy\_taxonomy . '</p>'; // 1.8.3 |
| [1230](#L1230) | /\* translators: \*/ |
| [1231](#L1231) | echo '<br /><br /><small>' . sprintf( esc\_html\_\_( '© by xili-tidy-tags v. %s', 'xili-tidy-tags' ), XILITIDYTAGS\_VER ) . '</small>'; |
| [1232](#L1232) | } |
| [1233](#L1233) | } |
| [1234](#L1234) |  |
| [1235](#L1235) |  |
| [1236](#L1236) |  |
| [1237](#L1237) |  |
| [1238](#L1238) | /\*\* |
| [1239](#L1239) | \* Add action link(s) to plugins page |
| [1240](#L1240) | \* |
| [1241](#L1241) | \* @since 0.8.0 |
| [1242](#L1242) | \* @author MS |
| [1243](#L1243) | \* @copyright Dion Hulse, http://dd32.id.au/wordpress-plugins/?configure-link and scripts@schloebe.de |
| [1244](#L1244) | \* |
| [1245](#L1245) | \* @updated 1.9 - fixes link when instancing... |
| [1246](#L1246) | \*/ |
| [1247](#L1247) | public function xili\_filter\_plugin\_actions( $links, $file ) { |
| [1248](#L1248) | static $this\_plugin; |
| [1249](#L1249) |  |
| [1250](#L1250) | if ( ! $this\_plugin ) { |
| [1251](#L1251) | $this\_plugin = plugin\_basename( $this->file\_file ); |
| [1252](#L1252) | } |
| [1253](#L1253) |  |
| [1254](#L1254) | if ( $file == $this\_plugin ) { |
| [1255](#L1255) | $suffix = ( 'post\_tag' == $this->post\_tag ) ? '' : '\_' . $this->post\_tag; |
| [1256](#L1256) | $title = ( 'post\_tag' == $this->post\_tag ) ? \_\_( 'Settings' ) : \_\_( 'Settings' ) . ': ' . $this->post\_tag; |
| [1257](#L1257) | $settings\_link = '<a title="' . esc\_attr( $title ) . '" href="admin.php?page=xili\_tidy\_tags\_settings' . $suffix . '">' . \_\_( 'Settings' ) . '</a>'; |
| [1258](#L1258) | $links = array\_merge( array( $settings\_link ), $links ); // before other links |
| [1259](#L1259) | } |
| [1260](#L1260) | return $links; |
| [1261](#L1261) | } |
| [1262](#L1262) |  |
| [1263](#L1263) | /\*\* |
| [1264](#L1264) | \* Contextual help |
| [1265](#L1265) | \* |
| [1266](#L1266) | \* @since 1.5.0 |
| [1267](#L1267) | \*/ |
| [1268](#L1268) | public function add\_help\_text( $contextual\_help, $screen\_id, $screen ) { |
| [1269](#L1269) |  |
| [1270](#L1270) | if ( false !== strpos( $screen->id, 'xili\_tidy\_tags\_settings' ) ) { |
| [1271](#L1271) | $to\_remember = |
| [1272](#L1272) | '<p>' . \_\_( 'Things to remember to set xili-tidy-tags:', 'xili-tidy-tags' ) . '</p>' . |
| [1273](#L1273) | '<ul>' . |
| [1274](#L1274) | '<li>' . \_\_( 'If you use it for multilingual website: verify that the xili-language trilogy is active. ', 'xili-tidy-tags' ) . '</li>' . |
| [1275](#L1275) | '<li>' . \_\_( 'Update the list of targeted languages. See Actions left box. ', 'xili-tidy-tags' ) . '</li>' . |
| [1276](#L1276) | '<li>' . \_\_( 'For current site with lot of tags, create group or sub-group and go in assign page. ', 'xili-tidy-tags' ) . '</li>' . |
| [1277](#L1277) | '<li>' . \_\_( 'Don’t forget to activate a tags cloud widget. ', 'xili-tidy-tags' ) . '</li>' . |
| [1278](#L1278) | '<li>' . \_\_( 'In widget: the group for displaying tags in current lang is the\_curlang ', 'xili-tidy-tags' ) . '</li>' . |
| [1279](#L1279) | '<li>' . \_\_( 'In widget: the group to set is the slug - trademark for TradeMark group - if you create one. ', 'xili-tidy-tags' ) . '</li>' . |
| [1280](#L1280) | '</ul>'; |
| [1281](#L1281) |  |
| [1282](#L1282) | $more\_infos = |
| [1283](#L1283) | '<p><strong>' . \_\_( 'For more information:' ) . '</strong></p>' . |
| [1284](#L1284) | '<p>' . \_\_( '<a href="http://dev.xiligroup.com/xili-tidy-tags" target="\_blank">Xili-tidy-tags Plugin Documentation</a>', 'xili-tidy-tags' ) . '</p>' . |
| [1285](#L1285) | '<p>' . \_\_( '<a href="http://codex.wordpress.org/" target="\_blank">WordPress Documentation</a>', 'xili-tidy-tags' ) . '</p>' . |
| [1286](#L1286) | '<p>' . \_\_( '<a href="https://wordpress.org/support/plugin/xili-tidy-tags" target="\_blank">Support Forums</a>', 'xili-tidy-tags' ) . '</p>'; |
| [1287](#L1287) |  |
| [1288](#L1288) | $screen->add\_help\_tab( |
| [1289](#L1289) | array( |
| [1290](#L1290) | 'id' => 'to-remember', |
| [1291](#L1291) | 'title' => \_\_( 'Things to remember', 'xili-tidy-tags' ), |
| [1292](#L1292) | 'content' => $to\_remember, |
| [1293](#L1293) | ) |
| [1294](#L1294) | ); |
| [1295](#L1295) |  |
| [1296](#L1296) | $screen->add\_help\_tab( |
| [1297](#L1297) | array( |
| [1298](#L1298) | 'id' => 'more-infos', |
| [1299](#L1299) | 'title'   => \_\_( 'For more information', 'xili-tidy-tags' ), |
| [1300](#L1300) | 'content' => $more\_infos, |
| [1301](#L1301) | ) |
| [1302](#L1302) | ); |
| [1303](#L1303) |  |
| [1304](#L1304) | } else if ( false !== strpos( $screen->id, 'xili\_tidy\_tags\_assign' ) ) { |
| [1305](#L1305) | $to\_remember = |
| [1306](#L1306) | '<p>' . \_\_( 'Things to remember to assign tags to groups:', 'xili-tidy-tags' ) . '</p>' . |
| [1307](#L1307) | '<ul>' . |
| [1308](#L1308) | '<li>' . \_\_( 'Use features of paginated table. ', 'xili-tidy-tags' ) . '</li>' . |
| [1309](#L1309) | '<li>' . \_\_( 'Don’t forget to update by clicking button in left - Actions - titled meta box. ', 'xili-tidy-tags' ) . '</li>' . |
| [1310](#L1310) | '</ul>'; |
| [1311](#L1311) |  |
| [1312](#L1312) | $more\_infos = |
| [1313](#L1313) | '<p><strong>' . \_\_( 'For more information:' ) . '</strong></p>' . |
| [1314](#L1314) | '<p>' . \_\_( '<a href="http://dev.xiligroup.com/xili-tidy-tags" target="\_blank">Xili-tidy-tags Plugin Documentation</a>', 'xili-tidy-tags' ) . '</p>' . |
| [1315](#L1315) | '<p>' . \_\_( '<a href="http://wiki.xiligroup.org/" target="\_blank">Xili Wiki Documentation</a>', 'xili-tidy-tags' ) . '</p>' . |
| [1316](#L1316) | '<p>' . \_\_( '<a href="https://wordpress.org/support/plugin/xili-tidy-tags" target="\_blank">Support Forums</a>', 'xili-tidy-tags' ) . '</p>' . |
| [1317](#L1317) | '<p>' . \_\_( '<a href="http://codex.wordpress.org/" target="\_blank">WordPress Documentation</a>', 'xili-tidy-tags' ) . '</p>'; |
| [1318](#L1318) |  |
| [1319](#L1319) | $screen->add\_help\_tab( |
| [1320](#L1320) | array( |
| [1321](#L1321) | 'id'      => 'to-remember', |
| [1322](#L1322) | 'title'   => \_\_( 'Things to remember', 'xili-tidy-tags' ), |
| [1323](#L1323) | 'content' => $to\_remember, |
| [1324](#L1324) | ) |
| [1325](#L1325) | ); |
| [1326](#L1326) |  |
| [1327](#L1327) | $screen->add\_help\_tab( |
| [1328](#L1328) | array( |
| [1329](#L1329) | 'id'      => 'more-infos', |
| [1330](#L1330) | 'title'   => \_\_( 'For more information', 'xili-tidy-tags' ), |
| [1331](#L1331) | 'content' => $more\_infos, |
| [1332](#L1332) | ) |
| [1333](#L1333) | ); |
| [1334](#L1334) |  |
| [1335](#L1335) | } |
| [1336](#L1336) | return $contextual\_help; |
| [1337](#L1337) | } |
| [1338](#L1338) |  |
| [1339](#L1339) | // called by each pointer |
| [1340](#L1340) | public function insert\_news\_pointer( $case\_news ) { |
| [1341](#L1341) | wp\_enqueue\_style( 'wp-pointer' ); |
| [1342](#L1342) | wp\_enqueue\_script( 'wp-pointer', false, array( 'jquery' ) ); |
| [1343](#L1343) | ++$this->news\_id; |
| [1344](#L1344) | $this->news\_case[ $this->news\_id ] = $case\_news; |
| [1345](#L1345) | } |
| [1346](#L1346) | // insert the pointers registered before |
| [1347](#L1347) | public function print\_the\_pointers\_js() { |
| [1348](#L1348) | if ( 0 != $this->news\_id ) { |
| [1349](#L1349) | for ( $i = 1; $i <= $this->news\_id; $i++ ) { |
| [1350](#L1350) | $this->print\_pointer\_js( $i ); |
| [1351](#L1351) | } |
| [1352](#L1352) | } |
| [1353](#L1353) | } |
| [1354](#L1354) |  |
| [1355](#L1355) | public function print\_pointer\_js( $indice ) { |
| [1356](#L1356) |  |
| [1357](#L1357) | $args = $this->localize\_admin\_js( $this->news\_case[ $indice ], $indice ); |
| [1358](#L1358) | if ( '' != $args['pointerText'] ) { |
| [1359](#L1359) | // only if user don't read it before |
| [1360](#L1360) | ?> |
| [1361](#L1361) | <script type="text/javascript"> |
| [1362](#L1362) | //<![CDATA[ |
| [1363](#L1363) | jQuery(document).ready( function() { |
| [1364](#L1364) |  |
| [1365](#L1365) | var strings<?php echo $indice; ?> = <?php echo json\_encode( $args ); ?>; |
| [1366](#L1366) |  |
| [1367](#L1367) | <?php /\*\* Check that pointer support exists AND that text is not empty - inspired www.generalthreat.com \*/   ?> |
| [1368](#L1368) |  |
| [1369](#L1369) | if( 'undefined' != typeof(jQuery().pointer) && '' != strings<?php echo $indice; ?>.pointerText ) { |
| [1370](#L1370) | jQuery( strings<?php echo $indice; ?>.pointerDiv ).pointer({ |
| [1371](#L1371) | content : strings<?php echo $indice; ?>.pointerText, |
| [1372](#L1372) | position: { edge: strings<?php echo $indice; ?>.pointerEdge, |
| [1373](#L1373) | at: strings<?php echo $indice; ?>.pointerAt, |
| [1374](#L1374) | my: strings<?php echo $indice; ?>.pointerMy |
| [1375](#L1375) | }, |
| [1376](#L1376) | close : function() { |
| [1377](#L1377) | jQuery.post( ajaxurl, { |
| [1378](#L1378) | pointer: strings<?php echo $indice; ?>.pointerDismiss, |
| [1379](#L1379) | action: 'dismiss-wp-pointer' |
| [1380](#L1380) | }); |
| [1381](#L1381) | } |
| [1382](#L1382) | }).pointer('open'); |
| [1383](#L1383) | } |
| [1384](#L1384) | }); |
| [1385](#L1385) | //]]> |
| [1386](#L1386) | </script> |
| [1387](#L1387) | <?php |
| [1388](#L1388) | //offset: strings echo $indice;  .pointerOffset  // deprecated |
| [1389](#L1389) | } |
| [1390](#L1390) | } |
| [1391](#L1391) |  |
| [1392](#L1392) |  |
| [1393](#L1393) | /\*\* |
| [1394](#L1394) | \* News pointer for tabs |
| [1395](#L1395) | \* |
| [1396](#L1396) | \* @since 2.6.2 |
| [1397](#L1397) | \* |
| [1398](#L1398) | \*/ |
| [1399](#L1399) | public function localize\_admin\_js( $case\_news, $news\_id ) { |
| [1400](#L1400) | $about = \_\_( 'Docs about xili-tidy-tags', 'xili-tidy-tags' ); |
| [1401](#L1401) | $pointer\_edge = ''; |
| [1402](#L1402) | $pointer\_at = ''; |
| [1403](#L1403) | $pointer\_my = ''; |
| [1404](#L1404) | $pre = ( 'post\_tag' == $this->post\_tag ) ? '' : '\_' . $this->post\_tag; |
| [1405](#L1405) |  |
| [1406](#L1406) | switch ( $case\_news ) { |
| [1407](#L1407) |  |
| [1408](#L1408) | case 'xtt\_new\_version': |
| [1409](#L1409) | $pointer\_text = '<h3>' . esc\_js( \_\_( 'xili-tidy-tags updated', 'xili-tidy-tags' ) ) . '</h3>'; |
| [1410](#L1410) | /\* translators: \*/ |
| [1411](#L1411) | $pointer\_text .= '<p>' . esc\_js( sprintf( \_\_( 'xili-tidy-tags was updated to version %s', 'xili-tidy-tags' ), XILITIDYTAGS\_VER ) ) . ' .</p>'; |
| [1412](#L1412) | /\* translators: \*/ |
| [1413](#L1413) | $pointer\_text .= '<p>' . esc\_js( sprintf( \_\_( 'This version %s is pre-tested with WP 6.2', 'xili-tidy-tags' ), XILITIDYTAGS\_VER ) ) . ' .</p>'; |
| [1414](#L1414) | $pointer\_text .= '<p>' . esc\_js( \_\_( 'Now tags can be grouped using alias feature existing in WP taxonomy and two new template tags for theme are available for files tag.php and taxonomy.php. ', 'xili-tidy-tags' ) ) . ',</p>'; |
| [1415](#L1415) |  |
| [1416](#L1416) | $pointer\_text .= '<p>' . esc\_js( \_\_( 'See submenu', 'xili-tidy-tags' ) . ' “<a href="admin.php?page=xili\_tidy\_tags\_settings' . $pre . '">' . \_\_( 'to define groups of tags', 'xili-tidy-tags' ) . "</a>”" ) . ' .</p>'; |
| [1417](#L1417) |  |
| [1418](#L1418) | $pointer\_text .= '<p>' . esc\_js( \_\_( 'See submenu', 'xili-tidy-tags' ) . ' “<a href="admin.php?page=xili\_tidy\_tags\_assign' . $pre . '">' . \_\_( 'to assign tags to group', 'xili-tidy-tags' ) . "</a>”" ) . ' .</p>'; |
| [1419](#L1419) | /\* translators: \*/ |
| [1420](#L1420) | $pointer\_text .= '<p>' . esc\_js( sprintf( esc\_html\_\_( 'Before to question dev.xiligroup support, do not forget to visit %s documentation', 'xili-tidy-tags' ), '<a href="http://wiki.xiligroup.org" title="' . $about . '" >wiki</a>' ) ) . ' .</p>'; |
| [1421](#L1421) |  |
| [1422](#L1422) | $pointer\_dismiss = sanitize\_key( 'xtt-new-version-' . str\_replace( '.', '-', XILITIDYTAGS\_VER ) ); |
| [1423](#L1423) | $pointer\_div = '#toplevel\_page\_xili-tidy-tags'; |
| [1424](#L1424) | $pointer\_offset = '0 0'; |
| [1425](#L1425) | $pointer\_edge = 'left'; |
| [1426](#L1426) | $pointer\_my = 'left'; |
| [1427](#L1427) | $pointer\_at = 'right'; |
| [1428](#L1428) | break; |
| [1429](#L1429) |  |
| [1430](#L1430) | default: // nothing |
| [1431](#L1431) | $pointer\_text = ''; |
| [1432](#L1432) | } |
| [1433](#L1433) |  |
| [1434](#L1434) | // inspired from www.generalthreat.com |
| [1435](#L1435) | // Get the list of dismissed pointers for the user |
| [1436](#L1436) | $dismissed = explode( ',', (string) get\_user\_meta( get\_current\_user\_id(), 'dismissed\_wp\_pointers', true ) ); |
| [1437](#L1437) |  |
| [1438](#L1438) | if ( in\_array( $pointer\_dismiss, $dismissed ) && sanitize\_key( 'xtt-new-version-' . str\_replace( '.', '-', XILITIDYTAGS\_VER ) ) == $pointer\_dismiss ) { |
| [1439](#L1439) | $pointer\_text = ''; |
| [1440](#L1440) | } elseif ( in\_array( $pointer\_dismiss, $dismissed ) ) { |
| [1441](#L1441) | $pointer\_text = ''; |
| [1442](#L1442) | } |
| [1443](#L1443) |  |
| [1444](#L1444) | return array( |
| [1445](#L1445) | 'pointerText' => html\_entity\_decode( (string) $pointer\_text, ENT\_QUOTES, 'UTF-8' ), |
| [1446](#L1446) | 'pointerDismiss' => $pointer\_dismiss, |
| [1447](#L1447) | 'pointerDiv' => $pointer\_div, |
| [1448](#L1448) | 'pointerEdge' => ( '' == $pointer\_edge ) ? 'top' : $pointer\_edge, |
| [1449](#L1449) | 'pointerAt' => ( '' == $pointer\_at ) ? 'left top' : $pointer\_at, |
| [1450](#L1450) | 'pointerMy' => ( '' == $pointer\_my ) ? 'left top' : $pointer\_my, |
| [1451](#L1451) | 'pointerOffset' => $pointer\_offset, |
| [1452](#L1452) | 'newsID' => $news\_id, |
| [1453](#L1453) | ); |
| [1454](#L1454) | } |
| [1455](#L1455) |  |
| [1456](#L1456) | /\*\* |
| [1457](#L1457) | \* private functions for xili-tidy-tags settings |
| [1458](#L1458) | \* |
| [1459](#L1459) | \* @since 0.8.0 |
| [1460](#L1460) | \* |
| [1461](#L1461) | \* fill the content of the boxes (right side and normal) |
| [1462](#L1462) | \* |
| [1463](#L1463) | \*/ |
| [1464](#L1464) | public function on\_sidebox\_msg\_content( $data = array() ) { |
| [1465](#L1465) | extract( $data ); |
| [1466](#L1466) | ?> |
| [1467](#L1467) | <h4><?php esc\_html\_e( 'Note:', 'xili-tidy-tags' ); ?></h4> |
| [1468](#L1468) | <p><?php echo $message; ?></p> |
| [1469](#L1469) | <?php |
| [1470](#L1470) | } |
| [1471](#L1471) |  |
| [1472](#L1472) | public function on\_sidebox\_info\_content( $data = array() ) { |
| [1473](#L1473) | extract( $data); |
| [1474](#L1474) | $allowed\_html = array( |
| [1475](#L1475) | 'a' => array( |
| [1476](#L1476) | 'href' => array(), |
| [1477](#L1477) | 'title' => array(), |
| [1478](#L1478) | ), |
| [1479](#L1479) | 'br' => array(), |
| [1480](#L1480) | 'em' => array(), |
| [1481](#L1481) | 'strong' => array(), |
| [1482](#L1482) | ); |
| [1483](#L1483) | if ( 'settings' == $xili\_tidy\_tags\_page ) { |
| [1484](#L1484) | echo '<p style="margin:2px; padding:3px; border:1px solid #ccc;">' . wp\_kses( \_\_( 'On this page, the tags groups are defined. The special groups for xili-language plugin are importable.<br /> For debug, some technical infos are displayed in the tables or boxes.<br />', 'xili-tidy-tags' ), $allowed\_html ) . '</p>'; |
| [1485](#L1485) | } elseif ( 'assign' == $xili\_tidy\_tags\_page ) { |
| [1486](#L1486) | echo '<p style="margin:2px; padding:3px; border:1px solid #ccc;">' . wp\_kses( \_\_( 'On this page, in a oneshot way, it is possible to assign the tags to one or more groups defined on the other page of <i>xili-tidy-tags</i> plugin. ', 'xili-tidy-tags' ), $allowed\_html ) . '</p>'; |
| [1487](#L1487) | } |
| [1488](#L1488) | ?> |
| [1489](#L1489) | <p><?php echo wp\_kses( \_\_( '<strong>xili-tidy-tags</strong> is a tool for grouping tags by language or semantic group. Initially developed to enrich multilingual website powered by xili-language plugin. ', 'xili-tidy-tags' ), $allowed\_html ); ?></p> |
| [1490](#L1490) | <?php |
| [1491](#L1491) | } |
| [1492](#L1492) |  |
| [1493](#L1493) | /\* |
| [1494](#L1494) | \* Admin capabilities setting box |
| [1495](#L1495) | \* @since 0.9.5 |
| [1496](#L1496) | \* |
| [1497](#L1497) | \* @updated 1.4.0 |
| [1498](#L1498) | \* Only visible if admin (cap : update\_plugins) |
| [1499](#L1499) | \*/ |
| [1500](#L1500) | public function on\_sidebox\_admin\_content( $data = array() ) { |
| [1501](#L1501) | $editor\_set = $this->xili\_settings['editor\_caps']; |
| [1502](#L1502) | $selected2 = ''; |
| [1503](#L1503) | $selected3 = ''; |
| [1504](#L1504) | if ( 'caps\_setting\_grouping' == $editor\_set ) { |
| [1505](#L1505) | $selected3 = ' selected = "selected"'; |
| [1506](#L1506) | } elseif ( 'caps\_grouping' == $editor\_set ) { |
| [1507](#L1507) | $selected2 = ' selected = "selected"'; |
| [1508](#L1508) | } |
| [1509](#L1509) | ?> |
| [1510](#L1510) | <div style="margin:2px; padding:3px; border:1px solid #ccc;"> |
| [1511](#L1511) | <p><?php esc\_html\_e( 'Here, as admin, set capabilities of the editor:', 'xili-tidy-tags' ); ?></p> |
| [1512](#L1512) | <select name="editor\_caps" id="editor\_caps" style="width:80%;"> |
| [1513](#L1513) | <option value="no\_caps" ><?php esc\_html\_e( 'no capability', 'xili-tidy-tags' ); ?></option> |
| [1514](#L1514) | <option value="caps\_grouping" <?php echo $selected2; ?>><?php esc\_html\_e( 'Grouping', 'xili-tidy-tags' ); ?></option> |
| [1515](#L1515) | <option value="caps\_setting\_grouping" <?php echo $selected3; ?>><?php esc\_html\_e( 'Setting and grouping', 'xili-tidy-tags' ); ?></option> |
| [1516](#L1516) | </select><br /><br /> |
| [1517](#L1517) | <label for="datatable\_js"><?php esc\_html\_e( 'Disable Datatable javascript', 'xili-tidy-tags' ); ?> : <input id="datatable\_js" name="datatable\_js" type="checkbox" value="disable" <?php checked( $this->xili\_settings['datatable\_js'], 'disable' ); ?> /></label> |
| [1518](#L1518) |  |
| [1519](#L1519) | <?php |
| [1520](#L1520) | echo '<p class="submit"><input type="submit" name="editor\_caps\_submit" value="' . esc\_html\_\_( 'Set &raquo;', 'xili-tidy-tags' ) . '" /></p></div>'; |
| [1521](#L1521) | } |
| [1522](#L1522) |  |
| [1523](#L1523) | /\*\* |
| [1524](#L1524) | \* Get\_terms without annoying cache |
| [1525](#L1525) | \* |
| [1526](#L1526) | \* @since 1.5.0 |
| [1527](#L1527) | \*/ |
| [1528](#L1528) | public function no\_cache\_get\_terms( $taxonomy, $args ) { |
| [1529](#L1529) | global $wpdb; |
| [1530](#L1530) | $defaults = array( |
| [1531](#L1531) | 'orderby' => 'name', |
| [1532](#L1532) | 'order' => 'ASC', |
| [1533](#L1533) | 'hide\_empty' => true, |
| [1534](#L1534) | 'exclude' => array(), |
| [1535](#L1535) | 'exclude\_tree' => array(), |
| [1536](#L1536) | 'include' => array(), |
| [1537](#L1537) | 'number' => '', |
| [1538](#L1538) | 'fields' => 'all', |
| [1539](#L1539) | 'slug' => '', |
| [1540](#L1540) | 'parent' => '', |
| [1541](#L1541) | 'hierarchical' => true, |
| [1542](#L1542) | 'child\_of' => 0, |
| [1543](#L1543) | 'get' => '', |
| [1544](#L1544) | 'name\_\_like' => '', |
| [1545](#L1545) | 'pad\_counts' => false, |
| [1546](#L1546) | 'offset' => '', |
| [1547](#L1547) | 'search' => '', |
| [1548](#L1548) | ); |
| [1549](#L1549) | $args = wp\_parse\_args( $args, $defaults ); |
| [1550](#L1550) | extract( $args, EXTR\_SKIP ); |
| [1551](#L1551) | $orderby = 't.name'; |
| [1552](#L1552) | if ( ! empty( $orderby ) ) { |
| [1553](#L1553) | $orderby = "ORDER BY $orderby"; |
| [1554](#L1554) | } else { |
| [1555](#L1555) | $order = ''; |
| [1556](#L1556) | } |
| [1557](#L1557) | $where = ''; |
| [1558](#L1558) | if ( '' !== $parent ) { |
| [1559](#L1559) | $parent = (int) $parent; |
| [1560](#L1560) | $where .= " AND tt.parent = '$parent'"; |
| [1561](#L1561) | } |
| [1562](#L1562) |  |
| [1563](#L1563) | $selects = array(); |
| [1564](#L1564) | switch ( $fields ) { |
| [1565](#L1565) | case 'all': |
| [1566](#L1566) | $selects = array( 't.\*', 'tt.\*' ); |
| [1567](#L1567) | break; |
| [1568](#L1568) | case 'ids': |
| [1569](#L1569) | case 'id=>parent': |
| [1570](#L1570) | $selects = array( 't.term\_id', 'tt.parent', 'tt.count' ); |
| [1571](#L1571) | break; |
| [1572](#L1572) | case 'names': |
| [1573](#L1573) | $selects = array( 't.term\_id', 'tt.parent', 'tt.count', 't.name' ); |
| [1574](#L1574) | break; |
| [1575](#L1575) | case 'count': |
| [1576](#L1576) | $orderby = ''; |
| [1577](#L1577) | $order = ''; |
| [1578](#L1578) | $selects = array( 'COUNT(\*)' ); |
| [1579](#L1579) | } |
| [1580](#L1580) | $select\_this = implode( ', ', apply\_filters( 'get\_terms\_fields', $selects, $args ) ); |
| [1581](#L1581) | $query = "SELECT $select\_this FROM $wpdb->terms AS t INNER JOIN $wpdb->term\_taxonomy AS tt ON t.term\_id = tt.term\_id WHERE tt.taxonomy IN ( %s ) $where $orderby $order"; |
| [1582](#L1582) |  |
| [1583](#L1583) | // $taxonomy set as param (wp 3.9 - placeholder notice ) |
| [1584](#L1584) | $terms = $wpdb->get\_results( $wpdb->prepare( $query, $taxonomy ) ); |
| [1585](#L1585) |  |
| [1586](#L1586) | return $terms; |
| [1587](#L1587) | } |
| [1588](#L1588) |  |
| [1589](#L1589) | /\* |
| [1590](#L1590) | \* Action's box |
| [1591](#L1591) | \*/ |
| [1592](#L1592) | public function on\_sidebox\_import\_content( $data = array() ) { |
| [1593](#L1593) | extract( $data ); |
| [1594](#L1594) | if ( 'post\_tag' == $this->post\_tag ) { // 1.5.5 |
| [1595](#L1595) | echo '<div style="margin:2px; padding:3px; border:1px solid #ccc;">'; |
| [1596](#L1596) | echo '<p>' . esc\_html\_\_( 'Add a tag\'s group for a chosen category', 'xili-tidy-tags' ) . '</p>'; |
| [1597](#L1597) | /\* build the selector of available categories \*/ |
| [1598](#L1598) | $categories = get\_categories( array( 'get' => 'all' ) ); /\* even if cat is empty \*/ |
| [1599](#L1599) | echo '<select name="catsforgroup" id="catsforgroup" style="width:100%;">'; |
| [1600](#L1600) | echo '<option value="no" >' . esc\_html\_\_( 'choose a category', 'xili-tidy-tags' ) . '</option>'; |
| [1601](#L1601) | foreach ( $categories as $cat ) { |
| [1602](#L1602) | $catinside = term\_exists( $cat->slug, $this->tidy\_taxonomy ); |
| [1603](#L1603) | if ( 0 == $catinside && 1 != $cat->term\_id ) { |
| [1604](#L1604) | echo '<option value="' . $cat->term\_id . '" >' . $cat->name . '</option>'; |
| [1605](#L1605) | } |
| [1606](#L1606) | } |
| [1607](#L1607) | echo '</select>'; |
| [1608](#L1608) | echo '<p>' . esc\_html\_\_( 'Choose a parent tag\'s group', 'xili-tidy-tags' ) . '</p>'; |
| [1609](#L1609) | $listterms = get\_terms( $this->tidy\_taxonomy, array( 'hide\_empty' => false ) ); |
| [1610](#L1610) | ?> |
| [1611](#L1611) | <select name="tags\_parent" id="tags\_parent" style="width:100%;"> |
| [1612](#L1612) | <option value="no\_parent" ><?php esc\_html\_e( 'no parent', 'xili-tidy-tags' ); ?></option> |
| [1613](#L1613) | <?php |
| [1614](#L1614) |  |
| [1615](#L1615) | foreach ( $listterms as $curterm ) { |
| [1616](#L1616) | if ( 0 == $curterm->parent && $curterm->term\_id != $this->langgroupid ) { |
| [1617](#L1617) | echo '<option value="' . $curterm->term\_id . '" >' . $curterm->name . '</option>'; |
| [1618](#L1618) | } |
| [1619](#L1619) | } |
| [1620](#L1620) | ?> |
| [1621](#L1621) | </select> |
| [1622](#L1622) | <br /> |
| [1623](#L1623) | <?php |
| [1624](#L1624) | echo '<p class="submit"><input type="submit" name="importacat" value="' . esc\_html\_\_( 'Add &raquo;', 'xili-tidy-tags' ) . '" /></p>'; |
| [1625](#L1625) | echo '<p>' . esc\_html\_\_( 'See docs to set xili\_tidy\_tag\_cloud function or widget to implement in theme…', 'xili-tidy-tags' ) . '</p>'; |
| [1626](#L1626) | echo '</div>'; |
| [1627](#L1627) | } |
| [1628](#L1628) | echo '<div style="margin:2px; padding:3px; border:1px solid #ccc;">'; |
| [1629](#L1629) | if ( ! class\_exists( 'xili\_language' ) ) { |
| [1630](#L1630) | ?> |
| [1631](#L1631) | <p class="submit"><?php esc\_html\_e( 'xili-language plugin is not activated. ', 'xili-tidy-tags' ); ?> </p> |
| [1632](#L1632) | <?php |
| [1633](#L1633) | } else { |
| [1634](#L1634) |  |
| [1635](#L1635) | $res = term\_exists( $this->xili\_settings['tidylangsgroupname'], $this->tidy\_taxonomy ); |
| [1636](#L1636) | if ( is\_array( $res ) ) { |
| [1637](#L1637) | $childterms = $this->no\_cache\_get\_terms( |
| [1638](#L1638) | $this->tidy\_taxonomy, |
| [1639](#L1639) | array( |
| [1640](#L1640) | 'hide\_empty' => false, |
| [1641](#L1641) | 'fields' => 'all', |
| [1642](#L1642) | 'parent' => $res['term\_id'], |
| [1643](#L1643) | ) |
| [1644](#L1644) | ); |
| [1645](#L1645) | } |
| [1646](#L1646) | //echo 'nb' .count( $childterms); |
| [1647](#L1647) | if ( $res && ! empty( $childterms ) ) { |
| [1648](#L1648) | ?> |
| [1649](#L1649) | <p><?php esc\_html\_e( 'The group of languages is set for use with xili-language plugin. ', 'xili-tidy-tags' ); ?> </p> |
| [1650](#L1650) | <?php |
| [1651](#L1651) |  |
| [1652](#L1652) | if ( current\_user\_can( 'xili\_tidy\_admin\_set' ) ) { //current\_user\_can( 'xili\_tidy\_admin\_set' ) |
| [1653](#L1653) | $langinxtt = array(); |
| [1654](#L1654) | foreach ( $childterms as $childterm ) { |
| [1655](#L1655) | $langinxtt[] = $childterm->name; |
| [1656](#L1656) | } |
| [1657](#L1657) |  |
| [1658](#L1658) | $langinxl = array(); |
| [1659](#L1659) | $listlanguages = get\_terms( TAXONAME, array( 'hide\_empty' => false ) ); |
| [1660](#L1660) | foreach ( $listlanguages as $language ) { |
| [1661](#L1661) | $langinxl[] = $language->name; |
| [1662](#L1662) | } |
| [1663](#L1663) |  |
| [1664](#L1664) | if ( array\_diff( $langinxl, $langinxtt ) != array() ) { // since 1.5.0 |
| [1665](#L1665) | $s = implode( ', ', array\_diff( $langinxl, $langinxtt ) ); |
| [1666](#L1666) | ?> |
| [1667](#L1667) | <p><?php /\* translators: \*/ printf( esc\_html\_\_( 'The group of languages in xili-language plugin has been changed. ', 'xili-tidy-tags' ) . ' ( %s )', $s ); ?> </p> |
| [1668](#L1668) | <?php |
| [1669](#L1669) | echo '<p class="submit">' . esc\_html\_\_( 'It is possible to update the group of languages. ', 'xili-tidy-tags' ) . '</p>'; |
| [1670](#L1670) | echo '<p class="submit"><input type="submit" name="importxililanguages" value="' . esc\_html\_\_( 'Update &raquo;', 'xili-tidy-tags' ) . '" /></p>'; |
| [1671](#L1671) | } |
| [1672](#L1672) | if ( array() != array\_diff( $langinxtt, $langinxl ) ) { |
| [1673](#L1673) | // ( count( $langinxtt) != count( $langinxl) ) |
| [1674](#L1674) | $s = implode( ', ', array\_diff( $langinxtt, $langinxl ) ); |
| [1675](#L1675) | /\* translators: \*/ |
| [1676](#L1676) | echo '<p class="submit">' . sprintf( esc\_html\_\_( 'One or more language(s) here are not present in active xili-language list. ', 'xili-tidy-tags' ) . ' ( %s )', $s ) . '</p>'; |
| [1677](#L1677) | } |
| [1678](#L1678) | } |
| [1679](#L1679) | } else { /\* since 0.9.5 \*/ |
| [1680](#L1680) | if ( current\_user\_can( 'xili\_tidy\_admin\_set' ) ) { |
| [1681](#L1681) | $count\_xl = wp\_count\_terms( TAXONAME ); /\* count a minima one language \*/ |
| [1682](#L1682) | if ( $count\_xl > 0 ) { |
| [1683](#L1683) | echo '<p class="submit">' . esc\_html\_\_( 'It is possible to import the group of languages. ', 'xili-tidy-tags' ) . '</p>'; |
| [1684](#L1684) | echo '<p class="submit"><input type="submit" name="importxililanguages" value="' . esc\_html\_\_( 'Import…', 'xili-tidy-tags' ) . '" /></p>'; |
| [1685](#L1685) |  |
| [1686](#L1686) | } else { |
| [1687](#L1687) | echo '<p class="submit">' . esc\_html\_\_( 'Go to settings of xili-language plugin and add languages', 'xili-tidy-tags' ) . '</p>'; |
| [1688](#L1688) | } |
| [1689](#L1689) | } else { |
| [1690](#L1690) | echo '<p class="submit">' . esc\_html\_\_( 'See administrator for language settings. ', 'xili-tidy-tags' ) . '</p>'; |
| [1691](#L1691) | } |
| [1692](#L1692) | } |
| [1693](#L1693) | } |
| [1694](#L1694) | echo '</div>'; |
| [1695](#L1695) |  |
| [1696](#L1696) | } |
| [1697](#L1697) |  |
| [1698](#L1698) | public function on\_normal\_group\_tags\_list\_content( $data = array() ) { |
| [1699](#L1699) | extract( $data ); |
| [1700](#L1700) | ?> |
| [1701](#L1701) |  |
| [1702](#L1702) | <table class="widefat" style="clear:none;"> |
| [1703](#L1703) | <thead> |
| [1704](#L1704) | <tr> |
| [1705](#L1705) | <th scope="col" style="text-align: center"><?php esc\_html\_e( 'ID', 'xili-tidy-tags' ); ?></th> |
| [1706](#L1706) | <th scope="col"><?php esc\_html\_e( 'Name', 'xili-tidy-tags' ); ?></th> |
| [1707](#L1707) | <th scope="col"><?php esc\_html\_e( 'Description', 'xili-tidy-tags' ); ?></th> |
| [1708](#L1708) | <th scope="col"><?php esc\_html\_e( 'Group slug', 'xili-tidy-tags' ); ?></th> |
| [1709](#L1709) | <th scope="col"><?php esc\_html\_e( 'Group taxo ID', 'xili-tidy-tags' ); ?></th> |
| [1710](#L1710) | <th scope="col"><?php esc\_html\_e( 'Parent', 'xili-tidy-tags' ); ?></th> |
| [1711](#L1711) | <th scope="col" width="90" style="text-align: center"><?php esc\_html\_e( 'Tags' ); ?></th> |
| [1712](#L1712) | <th colspan="2" style="text-align: center"><?php esc\_html\_e( 'Action' ); ?></th> |
| [1713](#L1713) | </tr> |
| [1714](#L1714) | </thead> |
| [1715](#L1715) | <tbody id="the-list"> |
| [1716](#L1716) | <?php $this->xili\_tags\_group\_row(); /\* the lines \*/ ?> |
| [1717](#L1717) | </tbody> |
| [1718](#L1718) | </table> |
| [1719](#L1719) |  |
| [1720](#L1720) | <?php |
| [1721](#L1721) | } |
| [1722](#L1722) |  |
| [1723](#L1723) | public function on\_normal\_group\_form\_content( $data = array() ) { |
| [1724](#L1724) | extract( $data ); /\* form to add or edit group \*/ |
| [1725](#L1725) | ?> |
| [1726](#L1726) |  |
| [1727](#L1727) | <h2 id="addgroup" <?php if ( $action == 'delete' ) echo 'style="color:#FF1111;"'; ?>><?php echo $formtitle; ?></h2> |
| [1728](#L1728) | <?php if ( 'edit' == $action || 'delete' == $action ) :?> |
| [1729](#L1729) | <input type="hidden" name="tagsgroup\_term\_id" value="<?php echo $tagsgroup->term\_id; ?>" /> |
| [1730](#L1730) | <input type="hidden" name="tagsgroup\_parent" value="<?php echo $tagsgroup->parent; ?>" /> |
| [1731](#L1731) | <?php |
| [1732](#L1732) | endif; |
| [1733](#L1733) | $disabled = ( 'delete' == $action ) ? ' disabled="disabled"' : ''; |
| [1734](#L1734) | ?> |
| [1735](#L1735) | <table class="editform" width="100%" cellspacing="2" cellpadding="5"> |
| [1736](#L1736) | <tr> |
| [1737](#L1737) | <th width="33%" scope="row" valign="top" align="right"><label for="tagsgroup\_name"><?php esc\_html\_e( 'Name', 'xili-tidy-tags' ); ?></label>:&nbsp;</th> |
| [1738](#L1738) | <td width="67%"><input name="tagsgroup\_name" id="tagsgroup\_name" type="text" value="<?php if ( isset( $tagsgroup) ) echo esc\_attr( $tagsgroup->name ); ?>" size="40" <?php echo $disabled; ?> /></td> |
| [1739](#L1739) | </tr> |
| [1740](#L1740) | <tr> |
| [1741](#L1741) | <th scope="row" valign="top" align="right"><label for="tagsgroup\_nicename"><?php esc\_html\_e( 'tags group slug', 'xili-tidy-tags' ); ?></label>:&nbsp;</th> |
| [1742](#L1742) | <td><input name="tagsgroup\_nicename" id="tagsgroup\_nicename" type="text" value="<?php |
| [1743](#L1743) | if ( isset( $tagsgroup ) ) { |
| [1744](#L1744) | echo esc\_attr( $tagsgroup->slug ); |
| [1745](#L1745) | } |
| [1746](#L1746) | ?>" size="40"<?php echo $disabled; ?> /></td> |
| [1747](#L1747) | </tr> |
| [1748](#L1748) | <tr> |
| [1749](#L1749) | <th scope="row" valign="top" align="right"><label for="tagsgroup\_description"><?php esc\_html\_e( 'Description', 'xili-tidy-tags' ); ?></label>:&nbsp;</th> |
| [1750](#L1750) | <td><input name="tagsgroup\_description" id="tagsgroup\_description" size="40" value="<?php if ( isset( $tagsgroup)) echo esc\_attr( $tagsgroup->description ); ?>" <?php echo $disabled; ?> /></td> |
| [1751](#L1751) |  |
| [1752](#L1752) | </tr> |
| [1753](#L1753) | <tr class="form-field"> |
| [1754](#L1754) | <th scope="row" valign="top" align="right"><label for="tagsgroup\_parent"><?php esc\_html\_e( 'kinship', 'xili-tidy-tags' ); ?></label> :&nbsp;</th> |
| [1755](#L1755) | <td> |
| [1756](#L1756) | <?php |
| [1757](#L1757) | if ( isset( $tagsgroup ) ) { |
| [1758](#L1758) | $this->xili\_selectparent\_row( $tagsgroup->term\_id, $tagsgroup, $action ); |
| [1759](#L1759) | /\* choice of parent line\*/ |
| [1760](#L1760) | } else { |
| [1761](#L1761) | $this->xili\_selectparent\_row( 0, $tagsgroup, $action ); |
| [1762](#L1762) | } |
| [1763](#L1763) | ?> |
| [1764](#L1764) | </td> |
| [1765](#L1765) | </tr> |
| [1766](#L1766) | <tr> |
| [1767](#L1767) | <th><p class="submit"><input type="submit" name="reset" value="<?php echo $cancel\_text; ?>" /></p></th> |
| [1768](#L1768) | <td> |
| [1769](#L1769) | <p class="submit"><input type="submit" name="submit" value="<?php echo $submit\_text; ?>" /></p> |
| [1770](#L1770) | </td> |
| [1771](#L1771) | </tr> |
| [1772](#L1772) | </table> |
| [1773](#L1773) | <?php |
| [1774](#L1774) | } |
| [1775](#L1775) |  |
| [1776](#L1776) | public function xili\_selectparent\_row( $term\_id = 0, $tagsgroup, $action ) { |
| [1777](#L1777) | if ( 0 == $term\_id ) { |
| [1778](#L1778) | $listterms = get\_terms( $this->tidy\_taxonomy, array( 'hide\_empty' => false ) ); |
| [1779](#L1779) | ?> |
| [1780](#L1780) | <select name="tagsgroup\_parent" id="tagsgroup\_parent" style="width:100%;"> |
| [1781](#L1781) | <option value="no\_parent" ><?php esc\_html\_e( 'no parent', 'xili-tidy-tags' ); ?></option> |
| [1782](#L1782) | <?php |
| [1783](#L1783) | foreach ( $listterms as $curterm ) { |
| [1784](#L1784) | if ( 0 == $curterm->parent ) { |
| [1785](#L1785) | if ( current\_user\_can( 'xili\_tidy\_admin\_set' ) ) { |
| [1786](#L1786) | $possible = true; |
| [1787](#L1787) | } elseif ( $curterm->term\_id == $this->langgroupid ) { |
| [1788](#L1788) | $possible = false; |
| [1789](#L1789) | } else { |
| [1790](#L1790) | $possible = true; |
| [1791](#L1791) | } |
| [1792](#L1792) | if ( $possible ) { |
| [1793](#L1793) | echo '<option value="' . $curterm->term\_id . '" >' . $curterm->name . '</option>'; |
| [1794](#L1794) | } |
| [1795](#L1795) | } |
| [1796](#L1796) | } |
| [1797](#L1797) | ?> |
| [1798](#L1798) | </select> |
| [1799](#L1799) | <br /> |
| [1800](#L1800) | <?php |
| [1801](#L1801) | esc\_html\_e( 'Select the parent if necessary', 'xili-tidy-tags' ); |
| [1802](#L1802) | } else { |
| [1803](#L1803) | if ( 0 == $tagsgroup->parent ) { |
| [1804](#L1804) | $listterms = get\_terms( |
| [1805](#L1805) | $this->tidy\_taxonomy, |
| [1806](#L1806) | array( |
| [1807](#L1807) | 'hide\_empty' => false, |
| [1808](#L1808) | 'parent' => $term\_id, |
| [1809](#L1809) | ) |
| [1810](#L1810) | ); |
| [1811](#L1811) | // display childs |
| [1812](#L1812) | if ( ! empty( $listterms ) ) { |
| [1813](#L1813) | esc\_html\_e( 'parent of: ', 'xili-tidy-tags' ); |
| [1814](#L1814) | echo '<ul>'; |
| [1815](#L1815) | foreach ( $listterms as $curterm ) { |
| [1816](#L1816) | echo '<li value="' . $curterm->term\_id . '" >' . $curterm->name . '</li>'; |
| [1817](#L1817) | } |
| [1818](#L1818) | echo '</ul>'; |
| [1819](#L1819) | } else { |
| [1820](#L1820) | esc\_html\_e( 'no child now', 'xili-tidy-tags' ) . '<br /><br />'; |
| [1821](#L1821) | } |
| [1822](#L1822) | /\* if modify\*/ |
| [1823](#L1823) | if ( 'edit' == $action ) { |
| [1824](#L1824) | $listterms = get\_terms( $this->tidy\_taxonomy, array( 'hide\_empty' => false ) ); |
| [1825](#L1825) | ?> |
| [1826](#L1826) | <select name="tagsgroup\_parent" id="tagsgroup\_parent" style="width:100%;"> |
| [1827](#L1827) | <option value="no\_parent" ><?php esc\_html\_e( 'no parent', 'xili-tidy-tags' ); ?></option> |
| [1828](#L1828) | <?php |
| [1829](#L1829) | foreach ( $listterms as $curterm ) { |
| [1830](#L1830) | if ( 0 == $curterm->parent && $curterm->term\_id != $term\_id ) { |
| [1831](#L1831) | echo '<option value="' . $curterm->term\_id . '" >' . $curterm->name . '</option>'; |
| [1832](#L1832) | } |
| [1833](#L1833) | } |
| [1834](#L1834) | ?> |
| [1835](#L1835) | </select> |
| [1836](#L1836) | <br /> |
| [1837](#L1837) | <?php |
| [1838](#L1838) | esc\_html\_e( 'Select the parent if necessary', 'xili-tidy-tags' ); |
| [1839](#L1839) | } |
| [1840](#L1840) | } else { |
| [1841](#L1841) | /\* if modify\*/ |
| [1842](#L1842) | $parent\_term = get\_term( (int) $tagsgroup->parent, $this->tidy\_taxonomy, OBJECT, 'edit' ); |
| [1843](#L1843) | if ( 'delete' == $action ) { |
| [1844](#L1844) | esc\_html\_e( 'child of: ', 'xili-tidy-tags' ); |
| [1845](#L1845) | echo $parent\_term->name; |
| [1846](#L1846) | ?> |
| [1847](#L1847) | <input type="hidden" name="tagsgroup\_parent" value="<?php echo $parent\_term->term\_id; ?>" /> |
| [1848](#L1848) | <?php |
| [1849](#L1849) | } else { |
| [1850](#L1850) | $listterms = get\_terms( $this->tidy\_taxonomy, array( 'hide\_empty' => false ) ); |
| [1851](#L1851) | ?> |
| [1852](#L1852) | <select name="tagsgroup\_parent" id="tagsgroup\_parent" style="width:100%;"> |
| [1853](#L1853) | <option value="no\_parent" ><?php esc\_html\_e( 'no parent', 'xili-tidy-tags' ); ?></option> |
| [1854](#L1854) | <?php |
| [1855](#L1855) | foreach ( $listterms as $curterm ) { |
| [1856](#L1856) | if ( 0 == $curterm->parent && $curterm->term\_id != $term\_id ) { |
| [1857](#L1857) | //$checked = ( $parent\_term->term\_id == $curterm->term\_id) ? 'selected="selected"' :''; |
| [1858](#L1858) | echo '<option value="' . $curterm->term\_id . '" ' . selected( $parent\_term->term\_id, $curterm->term\_id, false ) . ' >' . $curterm->name . '</option>'; |
| [1859](#L1859) | } |
| [1860](#L1860) | } |
| [1861](#L1861) | ?> |
| [1862](#L1862) | </select> |
| [1863](#L1863) | <br /> |
| [1864](#L1864) | <?php |
| [1865](#L1865) | esc\_html\_e( 'Modify the parent if necessary', 'xili-tidy-tags' ); |
| [1866](#L1866) | } |
| [1867](#L1867) | } |
| [1868](#L1868) | } |
| [1869](#L1869) | } |
| [1870](#L1870) |  |
| [1871](#L1871) |  |
| [1872](#L1872) |  |
| [1873](#L1873) | /\* |
| [1874](#L1874) | \* Import or update the terms (languages) set by xili-language   \* |
| [1875](#L1875) | \* @updated 1.5.0 |
| [1876](#L1876) | \*/ |
| [1877](#L1877) | public function xili\_langs\_import\_terms() { |
| [1878](#L1878) |  |
| [1879](#L1879) | $term = $this->xili\_settings['tidylangsgroupname']; |
| [1880](#L1880) | $error = false; |
| [1881](#L1881) | $args = array( |
| [1882](#L1882) | 'alias\_of' => '', |
| [1883](#L1883) | 'description' => 'default lang group', |
| [1884](#L1884) | 'parent' => 0, |
| [1885](#L1885) | 'slug' => $this->xili\_settings['tidylangsgroup'], |
| [1886](#L1886) | ); |
| [1887](#L1887) | $theids = term\_exists( $term, $this->tidy\_taxonomy ); // impossible to use get\_term as formerly !!! |
| [1888](#L1888) | if ( ! $theids ) { |
| [1889](#L1889) | $theids = wp\_insert\_term( $term, $this->tidy\_taxonomy, $args ); |
| [1890](#L1890) | if ( ! is\_wp\_error( $theids ) ) { |
| [1891](#L1891) | $this->langgroupid = $theids['term\_id']; |
| [1892](#L1892) | } else { |
| [1893](#L1893) | $error = true; |
| [1894](#L1894) | } |
| [1895](#L1895) | } |
| [1896](#L1896) | if ( $error ) { |
| [1897](#L1897) | return false; |
| [1898](#L1898) | } else { |
| [1899](#L1899) | $listlanguages = get\_terms( TAXONAME, array( 'hide\_empty' => false ) ); |
| [1900](#L1900) | foreach ( $listlanguages as $language ) { |
| [1901](#L1901) | $args = array( |
| [1902](#L1902) | 'alias\_of' => '', |
| [1903](#L1903) | 'description' => $language->description, |
| [1904](#L1904) | 'parent' => $this->langgroupid, |
| [1905](#L1905) | 'slug' => $language->slug . '-' . $this->xili\_settings['tidylangsgroup'], |
| [1906](#L1906) | ); // slug to be compatible with former release of WP |
| [1907](#L1907) |  |
| [1908](#L1908) | $ifhere = term\_exists( $language->name, $this->tidy\_taxonomy ); |
| [1909](#L1909) | if ( ! $ifhere ) { |
| [1910](#L1910) | $res = wp\_insert\_term( $language->name, $this->tidy\_taxonomy, $args ); |
| [1911](#L1911) | } else { |
| [1912](#L1912) | $error = true; |
| [1913](#L1913) | } |
| [1914](#L1914) | } |
| [1915](#L1915) | return ! $error; |
| [1916](#L1916) | } |
| [1917](#L1917) | } |
| [1918](#L1918) |  |
| [1919](#L1919) | /\* |
| [1920](#L1920) | \* Display the rows of group of tags |
| [1921](#L1921) | \* |
| [1922](#L1922) | \* @updated since 1.3.0 - use now walker class to sort Tag's groups |
| [1923](#L1923) | \*/ |
| [1924](#L1924) | public function xili\_tags\_group\_row() { |
| [1925](#L1925) | $listtagsgroups = get\_terms( |
| [1926](#L1926) | $this->tidy\_taxonomy, |
| [1927](#L1927) | array( |
| [1928](#L1928) | 'hide\_empty' => false, |
| [1929](#L1929) | 'get' => 'all', |
| [1930](#L1930) | ) |
| [1931](#L1931) | ); |
| [1932](#L1932) |  |
| [1933](#L1933) | if ( is\_wp\_error( $listtagsgroups ) || array() == $listtagsgroups ) { |
| [1934](#L1934) | /\* import \*/ |
| [1935](#L1935) | if ( class\_exists( 'xili\_language' ) ) { /\* xili-language is present \*/ |
| [1936](#L1936) | $res = $this->xili\_langs\_import\_terms(); |
| [1937](#L1937) |  |
| [1938](#L1938) | } else { |
| [1939](#L1939) | /\*create a default line with the default group\*/ |
| [1940](#L1940) | $term = 'tidy group'; |
| [1941](#L1941) | $args = array( |
| [1942](#L1942) | 'alias\_of' => '', |
| [1943](#L1943) | 'description' => 'default xili tidy tags group', |
| [1944](#L1944) | 'parent' => 0, |
| [1945](#L1945) | ); |
| [1946](#L1946) | $resgroup = wp\_insert\_term( $term, $this->tidy\_taxonomy, $args ); |
| [1947](#L1947) | $res = ! is\_wp\_error( $resgroup ); |
| [1948](#L1948) | } |
| [1949](#L1949) | if ( $res ) { |
| [1950](#L1950) | $listtagsgroups = $this->no\_cache\_get\_terms( |
| [1951](#L1951) | $this->tidy\_taxonomy, |
| [1952](#L1952) | array( |
| [1953](#L1953) | 'hide\_empty' => false, |
| [1954](#L1954) | 'get' => 'all', |
| [1955](#L1955) | ) |
| [1956](#L1956) | ); |
| [1957](#L1957) | } |
| [1958](#L1958) | } else { |
| [1959](#L1959) |  |
| [1960](#L1960) | $listtagsgroupssorted = $this->create\_taggrouplist\_sorted( walk\_TagGroupList\_sorted( $listtagsgroups, 3, null, null ) ); |
| [1961](#L1961) |  |
| [1962](#L1962) | $class = ''; |
| [1963](#L1963) | if ( $listtagsgroupssorted ) { // @since 1.4.2 - no warning if no groups at init |
| [1964](#L1964) | foreach ( $listtagsgroupssorted as $tagsgroup ) { |
| [1965](#L1965) | $class = ( ( defined( 'DOING\_AJAX' ) && DOING\_AJAX ) || " class='alternate'" == $class ) ? '' : " class='alternate'"; |
| [1966](#L1966) |  |
| [1967](#L1967) | $tagsgroup->count = number\_format\_i18n( $tagsgroup->count ); |
| [1968](#L1968) | $posts\_count = ( $tagsgroup->count > 0 ) ? "<a href='edit.php?lang=$tagsgroup->term\_id'>$tagsgroup->count</a>" : $tagsgroup->count; |
| [1969](#L1969) | /\* since 0.9.5 \*/ |
| [1970](#L1970) | if ( current\_user\_can( 'xili\_tidy\_editor\_set' ) ) { /\* all admin only \*/ |
| [1971](#L1971) | $possible = true; |
| [1972](#L1972) | } elseif ( current\_user\_can( 'xili\_tidy\_editor\_set' ) ) { /\* editor if set \*/ |
| [1973](#L1973) | if ( $tagsgroup->term\_id == $this->langgroupid || $tagsgroup->parent == $this->langgroupid ) { |
| [1974](#L1974) | $possible = false; |
| [1975](#L1975) | } else { |
| [1976](#L1976) | $possible = true; |
| [1977](#L1977) | } |
| [1978](#L1978) | } else { |
| [1979](#L1979) | $possible = false; |
| [1980](#L1980) | } |
| [1981](#L1981) | $pre = ( 'post\_tag' == $this->post\_tag ) ? 'xili\_tidy\_tags\_settings' : 'xili\_tidy\_tags\_settings\_' . $this->post\_tag; |
| [1982](#L1982) | if ( true === $possible ) { |
| [1983](#L1983) | //$edit = "<a href='?page=" . $pre . '&amp;action=edit&amp;term\_id=' . $tagsgroup->term\_id . "' >" . \_\_( 'Edit' ) . '</a></td>'; |
| [1984](#L1984) | $link = wp\_nonce\_url(admin\_url('admin.php?page=xili\_tidy\_tags\_settings&amp;action=edit&amp;term\_id=' . $tagsgroup->term\_id ), 'doing\_settings', 'my\_nonce'); |
| [1985](#L1985) |  |
| [1986](#L1986) | $edit = "<a href='" . $link . "' >" . \_\_( 'Edit' ) . '</a></td>'; |
| [1987](#L1987) | /\* delete link &amp;action=edit&amp;term\_id=' . $tagsgroup->term\_id. "\*/ |
| [1988](#L1988) | //$edit .= "<td><a href='?page=" . $pre . '&amp;action=delete&amp;term\_id=' . $tagsgroup->term\_id . "' class='delete'>" . \_\_( 'Delete' ) . '</a>'; |
| [1989](#L1989) | $link = wp\_nonce\_url(admin\_url('admin.php?page=xili\_tidy\_tags\_settings&amp;action=delete&amp;term\_id=' . $tagsgroup->term\_id ), 'doing\_settings', 'my\_nonce'); |
| [1990](#L1990) | $edit .= "<td><a href='" . $link . "' class='delete' >" . \_\_( 'Delete' ) . '</a>'; |
| [1991](#L1991) |  |
| [1992](#L1992) | } else { |
| [1993](#L1993) | $edit = \_\_( 'no capability', 'xili-tidy-tags' ) . '</td><td>'; |
| [1994](#L1994) | } |
| [1995](#L1995) |  |
| [1996](#L1996) | $line = "<tr id='cat-$tagsgroup->term\_id'$class> |
| [1997](#L1997) | <th scope='row' style='text-align: center'>$tagsgroup->term\_id</th> |
| [1998](#L1998) | <td> "; |
| [1999](#L1999) | $tabb = ( 0 != $tagsgroup->parent ) ? ' –' : ''; |
| [2000](#L2000) | $tagsgroupname = ( 0 == $tagsgroup->parent ) ? '<strong>' . $tagsgroup->name . '</strong>' : $tagsgroup->name; |
| [2001](#L2001) | $line .= "$tabb $tagsgroupname</td> |
| [2002](#L2002) | <td>$tagsgroup->description</td> |
| [2003](#L2003) | <td>$tagsgroup->slug</td> |
| [2004](#L2004) | <td>$tagsgroup->term\_taxonomy\_id</td> |
| [2005](#L2005) | <td>$tagsgroup->parent</td> |
| [2006](#L2006) | <td align='center'>$tagsgroup->count</td> |
| [2007](#L2007) | <td>$edit</td>\n\t</tr>\n"; /\*to complete\*/ |
| [2008](#L2008) |  |
| [2009](#L2009) | echo $line; |
| [2010](#L2010) | } |
| [2011](#L2011) | } |
| [2012](#L2012) | } |
| [2013](#L2013) | } |
| [2014](#L2014) |  |
| [2015](#L2015) | /\*\* |
| [2016](#L2016) | \* @updated 1.5.0 with datatables js (ex widefat) |
| [2017](#L2017) | \* |
| [2018](#L2018) | \*/ |
| [2019](#L2019) | public function on\_sub\_normal\_tags\_list\_content( $data = array() ) { |
| [2020](#L2020) | extract( $data ); |
| [2021](#L2021) | ?> |
| [2022](#L2022) |  |
| [2023](#L2023) | <div id="topbanner"> |
| [2024](#L2024) | </div> |
| [2025](#L2025) | <?php if ( '' == $this->xili\_settings['datatable\_js'] ) { ?> |
| [2026](#L2026) | <div id="tableupdating" ><br /><br /><h2><?php esc\_html\_e( 'Creating table of tags !', 'xili-tidy-tags' ); ?></h2> |
| [2027](#L2027) | </div> |
| [2028](#L2028) | <table class="display" id="assigntable" style="visibility:hidden; clear:none; font-size:10px; line-height:1.8em;" > |
| [2029](#L2029) | <?php } else { ?> |
| [2030](#L2030) | <table class="display" id="assigntable" style="visibility:visible; clear:none;"> |
| [2031](#L2031) | <?php } ?> |
| [2032](#L2032) |  |
| [2033](#L2033) | <thead> |
| [2034](#L2034) | <tr> |
| [2035](#L2035) | <th scope="col" class="center colid" ><?php esc\_html\_e( 'ID', 'xili-tidy-tags' ); ?></th> |
| [2036](#L2036) | <th scope="col" class="colname" ><?php esc\_html\_e( 'Name', 'xili-tidy-tags' ); ?></th> |
| [2037](#L2037) | <th scope="col" class="center colposts"><?php esc\_html\_e( 'Posts' ); ?></th> |
| [2038](#L2038) | <th colspan="2" class="colgrouping"><?php esc\_html\_e( 'Group(s) to choose', 'xili-tidy-tags' ); ?></th> |
| [2039](#L2039) | </tr> |
| [2040](#L2040) | </thead> |
| [2041](#L2041) | <tbody id="the-list"> |
| [2042](#L2042) | <?php $this->xili\_tags\_row( $tagsnamelike, $tagsnamesearch ); ?> |
| [2043](#L2043) | </tbody> |
| [2044](#L2044) | <tfoot> |
| [2045](#L2045) | <tr> |
| [2046](#L2046) | <th><?php esc\_html\_e( 'ID', 'xili-tidy-tags' ); ?></th> |
| [2047](#L2047) | <th><?php esc\_html\_e( 'Name', 'xili-tidy-tags' ); ?></th> |
| [2048](#L2048) | <th><?php esc\_html\_e( 'Posts' ); ?></th> |
| [2049](#L2049) | <th><?php esc\_html\_e( 'Group(s) to choose', 'xili-tidy-tags' ); ?></th> |
| [2050](#L2050) | </tr> |
| [2051](#L2051) | </tfoot> |
| [2052](#L2052) | </table> |
| [2053](#L2053) | <div id="bottombanner"> |
| [2054](#L2054) | </div> |
| [2055](#L2055) |  |
| [2056](#L2056) |  |
| [2057](#L2057) | <?php |
| [2058](#L2058) |  |
| [2059](#L2059) | } |
| [2060](#L2060) |  |
| [2061](#L2061) | /\*\* |
| [2062](#L2062) | \* |
| [2063](#L2063) | \* @updated 1.5.3 |
| [2064](#L2064) | \*/ |
| [2065](#L2065) | public function on\_sub\_sidebox\_action\_content( $data = array() ) { |
| [2066](#L2066) | extract( $data ); |
| [2067](#L2067) | wp\_nonce\_field( 'update\_checks', 'assign\_nonce', false ); |
| [2068](#L2068) | ?> |
| [2069](#L2069) | <p><?php esc\_html\_e( 'After checking or unchecking do not forget to click update button !', 'xili-tidy-tags' ); ?></p> |
| [2070](#L2070) | <p class="submit"><input type="submit" class="button-primary" id="update" name="update" value="<?php echo $submit\_text; ?>" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<input type="submit" name="reset" value="<?php echo $cancel\_text; ?>" /></p> |
| [2071](#L2071) |  |
| [2072](#L2072) | <fieldset style="margin:2px; padding:3px; border:1px solid #ccc;"><legend><?php esc\_html\_e( 'Sub list of tags', 'xili-tidy-tags' ); ?></legend> |
| [2073](#L2073) |  |
| [2074](#L2074) | <label for="tagsnamelike"><?php esc\_html\_e( 'Starting with:', 'xili-tidy-tags' ); ?></label> |
| [2075](#L2075) | <input name="tagsnamelike" id="tagsnamelike" type="text" value="<?php echo esc\_attr( $tagsnamelike ); ?>" /><br /> |
| [2076](#L2076) |  |
| [2077](#L2077) | <label for="tagsnamesearch"><?php esc\_html\_e( 'Containing:', 'xili-tidy-tags' ); ?></label> |
| [2078](#L2078) | <input name="tagsnamesearch" id="tagsnamesearch" type="text" value="<?php echo esc\_attr( $tagsnamesearch ); ?>" /><br /><br /> |
| [2079](#L2079) | <label for="tagsfromgroup"><?php esc\_html\_e( 'Choose:', 'xili-tidy-tags' ); ?></label> |
| [2080](#L2080) | <?php |
| [2081](#L2081) | $listtagsgroups = get\_terms( $this->tidy\_taxonomy, array( 'hide\_empty' => false ) ); |
| [2082](#L2082) |  |
| [2083](#L2083) | if ( ! is\_wp\_error( $listtagsgroups ) && array() != $listtagsgroups ) { |
| [2084](#L2084) | $listtagsgroupssorted = $this->create\_taggrouplist\_sorted( walk\_taggrouplist\_sorted( $listtagsgroups, 3, null, null ) ); |
| [2085](#L2085) | //$listtagsgroupssorted = $listtagsgroups; |
| [2086](#L2086) | ?> |
| [2087](#L2087) | <select name="tagsgroup\_from\_select" id="tagsgroup\_from\_select" style="width:45%;"> |
| [2088](#L2088) | <option value="no\_select" ><?php esc\_html\_e( 'every', 'xili-tidy-tags' ); ?></option> |
| [2089](#L2089) | <option value="onlyuncheckedtags" <?php selected( $this->onlyuncheckedtags ); ?>><?php esc\_html\_e( 'Unchecked only', 'xili-tidy-tags' ); ?></option> |
| [2090](#L2090) | <?php |
| [2091](#L2091) | $show = false; |
| [2092](#L2092) |  |
| [2093](#L2093) | foreach ( $listtagsgroupssorted as $curterm ) { |
| [2094](#L2094) | $ttab = ( 0 == $curterm->parent ) ? '' : '– '; |
| [2095](#L2095) | if ( $this->fromgroupselect == $curterm->term\_id ) { |
| [2096](#L2096) | $selected = 'selected="selected"'; |
| [2097](#L2097) | if ( 0 == $curterm->parent ) { |
| [2098](#L2098) | $listlanggroups = get\_terms( |
| [2099](#L2099) | $this->tidy\_taxonomy, |
| [2100](#L2100) | array( |
| [2101](#L2101) | 'hide\_empty' => true, |
| [2102](#L2102) | 'parent' => $curterm->term\_id, |
| [2103](#L2103) | ) |
| [2104](#L2104) | ); |
| [2105](#L2105) | if ( ! is\_wp\_error( $listlanggroups ) && $listlanggroups ) { |
| [2106](#L2106) | $show = true; |
| [2107](#L2107) | } |
| [2108](#L2108) | } |
| [2109](#L2109) | } else { |
| [2110](#L2110) | $selected = ''; |
| [2111](#L2111) | } |
| [2112](#L2112) | echo '<option value="' . $curterm->term\_id . '" ' . $selected . ' >' . $ttab. $curterm->name . '</option>'; |
| [2113](#L2113) |  |
| [2114](#L2114) | } |
| [2115](#L2115) |  |
| [2116](#L2116) | ?> |
| [2117](#L2117) | </select> |
| [2118](#L2118) | <?php |
| [2119](#L2119) | } |
| [2120](#L2120) | if ( false == $this->onlyuncheckedtags && 0 != $this->fromgroupselect ) { |
| [2121](#L2121) | ?> |
| [2122](#L2122) | <br /><label for="xili\_group\_not\_select"><?php esc\_html\_e( 'Exclude this group', 'xili-tidy-tags' ); ?> <input id="xili\_group\_not\_select" name="xili\_group\_not\_select" type="checkbox" value="not" <?php checked( $this->groupexclude, true ); ?> /></label> |
| [2123](#L2123) | <?php if ( $show ) { ?> |
| [2124](#L2124) | &nbsp;–&nbsp;<label for="xili\_group\_only\_parent"><?php esc\_html\_e( 'No childs', 'xili-tidy-tags' ); ?> <input id="xili\_group\_only\_parent" name="xili\_group\_only\_parent" type="checkbox" value="onlyparent" <?php checked( $this->onlyparent, true); ?> /></label> |
| [2125](#L2125) | <?php } ?> |
| [2126](#L2126) | <br /> |
| [2127](#L2127) | <?php |
| [2128](#L2128) | if ( true == $this->groupexclude ) { |
| [2129](#L2129) | ?> |
| [2130](#L2130) | <label for="xili\_uncheckedtags"><?php esc\_html\_e( 'Include unchecked', 'xili-tidy-tags' ); ?> <input id="xili\_uncheckedtags" name="xili\_uncheckedtags" type="checkbox" value="include" <?php checked( $this->uncheckedtags, true ); ?> /></label> |
| [2131](#L2131) | <?php |
| [2132](#L2132) | } |
| [2133](#L2133) | } |
| [2134](#L2134) | ?> |
| [2135](#L2135) | <p class="submit"><input type="submit" id="tagssublist" name="tagssublist" value="<?php esc\_html\_e( 'Sub select…', 'xili-tidy-tags' ); ?>" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<input type="submit" id="notagssublist" name="notagssublist" value="<?php esc\_html\_e( 'No select…', 'xili-tidy-tags' ); ?>" /></p> |
| [2136](#L2136) | </fieldset> |
| [2137](#L2137) | <?php /\* only show one group to select \*/ ?> |
| [2138](#L2138) | <fieldset style="margin:2px; padding:3px; border:1px solid #ccc;"><legend><?php esc\_html\_e( 'Columns: Group selection', 'xili-tidy-tags' ); ?></legend> |
| [2139](#L2139) | <?php |
| [2140](#L2140) | if ( ! is\_wp\_error( $listtagsgroups ) && array() != $listtagsgroups ) { |
| [2141](#L2141) | ?> |
| [2142](#L2142) | <select name="tagsgroup\_parent\_select" id="tagsgroup\_parent\_select" style="width:100%;"> |
| [2143](#L2143) | <option value="no\_select" ><?php esc\_html\_e( 'No sub-selection', 'xili-tidy-tags' ); ?></option> |
| [2144](#L2144) | <?php |
| [2145](#L2145) | foreach ( $listtagsgroups as $curterm ) { |
| [2146](#L2146) | if ( 0 == $curterm->parent ) { |
| [2147](#L2147) | //$checked = ( $this->subselect == $curterm->term\_id) ? 'selected="selected"' :''; |
| [2148](#L2148) | echo '<option value="' . $curterm->term\_id . '" ' . selected( $this->subselect, $curterm->term\_id, false ) . ' >' . $curterm->name . '</option>'; |
| [2149](#L2149) | } |
| [2150](#L2150) | } |
| [2151](#L2151) | ?> |
| [2152](#L2152) | </select> |
| [2153](#L2153) | <?php |
| [2154](#L2154) | } |
| [2155](#L2155) | ?> |
| [2156](#L2156) | <br /> <p class="submit"><input type="submit" id="subselection" name="subselection" value="<?php esc\_html\_e( 'Sub select…', 'xili-tidy-tags' ); ?>" /></p></fieldset> |
| [2157](#L2157) | <?php |
| [2158](#L2158) | } |
| [2159](#L2159) | /\*\* |
| [2160](#L2160) | \* The rows of the tags and checkboxes to assign group(s) |
| [2161](#L2161) | \* |
| [2162](#L2162) | \* @since 0.8.0 |
| [2163](#L2163) | \* @updated 1.3.0 - Call walker instantiation |
| [2164](#L2164) | \* @uses |
| [2165](#L2165) | \* @param |
| [2166](#L2166) | \* @return the rows for admin ui |
| [2167](#L2167) | \*/ |
| [2168](#L2168) | public function xili\_tags\_row( $tagsnamelike = '', $tagsnamesearch = '' ) { |
| [2169](#L2169) | $listgroups = get\_terms( |
| [2170](#L2170) | $this->tidy\_taxonomy, |
| [2171](#L2171) | array( |
| [2172](#L2172) | 'hide\_empty' => false, |
| [2173](#L2173) | 'get' => 'all', |
| [2174](#L2174) | ) |
| [2175](#L2175) | ); |
| [2176](#L2176) |  |
| [2177](#L2177) | if ( ! is\_wp\_error( $listgroups ) && array() != $listgroups ) { |
| [2178](#L2178) | $hiddenline = array(); |
| [2179](#L2179) | $edit = ''; |
| [2180](#L2180) | $i = 0; |
| [2181](#L2181) | $listgroupids = array(); |
| [2182](#L2182) | $sub\_listgroups = array(); |
| [2183](#L2183) | $subselectgroups = array(); |
| [2184](#L2184) | if ( $this->subselect > 0 ) { |
| [2185](#L2185) | $subselectgroups[] = $this->subselect; /\* the parent group and \*/ |
| [2186](#L2186) | /\*childs of \*/ |
| [2187](#L2187) | $listterms = get\_terms( |
| [2188](#L2188) | $this->tidy\_taxonomy, |
| [2189](#L2189) | array( |
| [2190](#L2190) | 'hide\_empty' => false, |
| [2191](#L2191) | 'parent' => $this->subselect, |
| [2192](#L2192) | ) |
| [2193](#L2193) | ); |
| [2194](#L2194) | if ( ! empty( $listterms ) ) { |
| [2195](#L2195) | foreach ( $listterms as $curterm ) { |
| [2196](#L2196) | $subselectgroups[] = $curterm->term\_id; |
| [2197](#L2197) | } |
| [2198](#L2198) | } |
| [2199](#L2199) | } |
| [2200](#L2200) |  |
| [2201](#L2201) | if ( ! empty( $subselectgroups ) ) { |
| [2202](#L2202) | /\* columns sub-selection \*/ |
| [2203](#L2203) | foreach ( $listgroups as $group ) { |
| [2204](#L2204) | $listgroupids[] = $group->term\_id; |
| [2205](#L2205) | if ( in\_array( $group->term\_id, $subselectgroups ) ) { |
| [2206](#L2206) | $sub\_listgroups[] = $group; |
| [2207](#L2207) | } else { |
| [2208](#L2208) | $hiddenline[] = $group->term\_id; /\* keep line values \*/ |
| [2209](#L2209) | } |
| [2210](#L2210) | } |
| [2211](#L2211) | $editformat = walk\_TagGroupList\_tree\_row( $sub\_listgroups, 3, null ); |
| [2212](#L2212) | } else { |
| [2213](#L2213) | foreach ( $listgroups as $group ) { |
| [2214](#L2214) | $listgroupids[] = $group->term\_id; |
| [2215](#L2215) | } |
| [2216](#L2216) | $editformat = walk\_TagGroupList\_tree\_row( $listgroups, 3, null ); |
| [2217](#L2217) | } |
| [2218](#L2218) |  |
| [2219](#L2219) | if ( 0 == $this->fromgroupselect && false === $this->onlyuncheckedtags ) { |
| [2220](#L2220) | $listtags = get\_terms( |
| [2221](#L2221) | $this->post\_tag, |
| [2222](#L2222) | array( |
| [2223](#L2223) | 'hide\_empty' => false, |
| [2224](#L2224) | 'get' => 'all', |
| [2225](#L2225) | 'name\_\_like' => $tagsnamelike, |
| [2226](#L2226) | 'search' => $tagsnamesearch, |
| [2227](#L2227) | ) |
| [2228](#L2228) | ); |
| [2229](#L2229) | } else { /\* since 1.3.0 \*/ |
| [2230](#L2230) | if ( false === $this->onlyuncheckedtags ) { |
| [2231](#L2231) | // one group |
| [2232](#L2232) | $group\_id[] = $this->fromgroupselect; |
| [2233](#L2233) | if ( false === $this->onlyparent ) { |
| [2234](#L2234) | $childterms = get\_terms( |
| [2235](#L2235) | $this->tidy\_taxonomy, |
| [2236](#L2236) | array( |
| [2237](#L2237) | 'hide\_empty' => false, |
| [2238](#L2238) | 'parent' => $this->fromgroupselect, |
| [2239](#L2239) | ) |
| [2240](#L2240) | ); |
| [2241](#L2241) | if ( ! empty( $childterms ) ) { |
| [2242](#L2242) | foreach ( $childterms as $childterm ) { /\* if group is a parent, add all childs \*/ |
| [2243](#L2243) | $group\_id[] = $childterm->term\_id; |
| [2244](#L2244) | } |
| [2245](#L2245) | } |
| [2246](#L2246) | } |
| [2247](#L2247) | } else { |
| [2248](#L2248) | // only unchecked |
| [2249](#L2249) | $listgroups = get\_terms( |
| [2250](#L2250) | $this->tidy\_taxonomy, |
| [2251](#L2251) | array( |
| [2252](#L2252) | 'hide\_empty' => false, |
| [2253](#L2253) | 'get' => 'all', |
| [2254](#L2254) | ) |
| [2255](#L2255) | ); |
| [2256](#L2256) | foreach ( $listgroups as $group ) { |
| [2257](#L2257) | $group\_id[] = $group->term\_id; |
| [2258](#L2258) | } |
| [2259](#L2259) | $this->groupexclude = true; |
| [2260](#L2260) | $this->uncheckedtags = true; |
| [2261](#L2261) | } |
| [2262](#L2262) | $listtags = xtt\_get\_terms\_of\_groups\_new( |
| [2263](#L2263) | $group\_id, |
| [2264](#L2264) | $this->tidy\_taxonomy, |
| [2265](#L2265) | $this->post\_tag, |
| [2266](#L2266) | array( |
| [2267](#L2267) | 'hide\_empty' => false, |
| [2268](#L2268) | 'get' => 'all', |
| [2269](#L2269) | 'name\_\_like' => $tagsnamelike, |
| [2270](#L2270) | 'search' => $tagsnamesearch, |
| [2271](#L2271) | 'orderby' => 'name', |
| [2272](#L2272) | ), |
| [2273](#L2273) | $this->groupexclude, |
| [2274](#L2274) | $this->uncheckedtags |
| [2275](#L2275) | ); |
| [2276](#L2276) | } |
| [2277](#L2277) |  |
| [2278](#L2278) | $class = ''; |
| [2279](#L2279) | if ( ! is\_wp\_error( $listtags ) ) { |
| [2280](#L2280) | foreach ( $listtags as $tag ) { |
| [2281](#L2281) | $class = ( ( defined( 'DOING\_AJAX' ) && DOING\_AJAX ) || " class='alternate'" == $class ) ? '' : " class='alternate'"; |
| [2282](#L2282) | $tag->count = number\_format\_i18n( $tag->count ); |
| [2283](#L2283) |  |
| [2284](#L2284) | if ( 'post\_tag' == $this->post\_tag ) { |
| [2285](#L2285) | $posts\_count = ( $tag->count > 0 ) ? "<a href='edit.php?tag=$tag->name'>$tag->count</a>" : $tag->count; |
| [2286](#L2286) | } else { |
| [2287](#L2287) | $posts\_count = ( $tag->count > 0 ) ? "<a href='edit.php?" . $this->post\_tag . '=' . $tag->name . '&amp;post\_type=' . $this->post\_tag\_post\_type . '>' . $tag->count . '</a>' : $tag->count; |
| [2288](#L2288) | } |
| [2289](#L2289) | $edit = sprintf( $editformat, $tag->term\_id ); |
| [2290](#L2290) | $hiddenlines = ''; |
| [2291](#L2291) | foreach ( $listgroupids as $groupid ) { |
| [2292](#L2292) | if ( is\_object\_in\_term( $tag->term\_id, $this->tidy\_taxonomy, (int) $groupid ) ) { |
| [2293](#L2293) | $edit = str\_replace( '"checked' . $groupid . '"', 'checked="checked"', $edit ); // 1.7 |
| [2294](#L2294) | if ( in\_array( $groupid, $hiddenline ) ) { |
| [2295](#L2295) | $hiddenlines .= '<input type="hidden" name="line-' . $tag->term\_id . '-' . $groupid . '" value="' . $tag->term\_id . '" />'; |
| [2296](#L2296) | } |
| [2297](#L2297) | } else { |
| [2298](#L2298) | $edit = str\_replace( '"checked' . $groupid . '"', '', $edit ); // 1.7 |
| [2299](#L2299) | } |
| [2300](#L2300) | } |
| [2301](#L2301) | // |
| [2302](#L2302) | if ( 'post\_tag' == $this->post\_tag ) { |
| [2303](#L2303) | $what = '&amp;tag\_ID=' . $tag->term\_id; |
| [2304](#L2304) | } else { |
| [2305](#L2305) | $what = '&amp;taxonomy=' . $this->post\_tag . '&amp;tag\_ID=' . $tag->term\_id . '&amp;post\_type=' . $this->post\_tag\_post\_type; |
| [2306](#L2306) | } |
| [2307](#L2307) | $line = "<tr id='cat-$tag->term\_id'$class> |
| [2308](#L2308) | <td class='termid' id='termid-{$tag->term\_id}' scope='row' style='text-align: center'>$tag->term\_id</td> |
| [2309](#L2309) | <td> <a href='edit-tags.php?action=edit" . $what . "'>" . $tag->name . "</a> </td> |
| [2310](#L2310) | <td align='center'>$posts\_count</td> |
| [2311](#L2311) | <td>$edit\n$hiddenlines</td>\n\t</tr>\n"; /\*to complete\*/ |
| [2312](#L2312) | echo $line; |
| [2313](#L2313) | } |
| [2314](#L2314) | } else { |
| [2315](#L2315) | echo '<tr><td>ERROR</td><td> in TAXONOMY: ' . $this->tidy\_taxonomy . '</td><td>ERROR</td><td>ERROR</td></tr>'; |
| [2316](#L2316) | if ( ! taxonomy\_exists( $this->post\_tag ) ) { |
| [2317](#L2317) | echo '<tr><td>ERROR</td><td> TAXONOMY: ' . $this->post\_tag . ' NOT SET</td><td>ERROR</td><td>ERROR</td></tr>'; // 1.9 fixes |
| [2318](#L2318) | } |
| [2319](#L2319) | } |
| [2320](#L2320) | } else { |
| [2321](#L2321) | echo '<tr><td>ERROR</td><td> in TAXONOMY: ' . $this->tidy\_taxonomy . '</td><td>ERROR</td><td>ERROR</td></tr>'; |
| [2322](#L2322) | } |
| [2323](#L2323) | } |
| [2324](#L2324) |  |
| [2325](#L2325) |  |
| [2326](#L2326) |  |
| [2327](#L2327) |  |
| [2328](#L2328) | public function check\_other\_xili\_plugins() { |
| [2329](#L2329) | $list = array(); |
| [2330](#L2330) | //if ( class\_exists( 'xili\_language' ) ) $list[] = 'xili-language'; |
| [2331](#L2331) | if ( class\_exists( 'xili\_language' ) ) { |
| [2332](#L2332) | $list[] = 'xili-language'; |
| [2333](#L2333) | } |
| [2334](#L2334) | if ( class\_exists( 'xili\_dictionary' ) ) { |
| [2335](#L2335) | $list[] = 'xili-dictionary'; |
| [2336](#L2336) | } |
| [2337](#L2337) | if ( class\_exists( 'xilithemeselector' ) ) { |
| [2338](#L2338) | $list[] = 'xilitheme-select'; |
| [2339](#L2339) | } |
| [2340](#L2340) | if ( function\_exists( 'insert\_a\_floom' ) ) { |
| [2341](#L2341) | $list[] = 'xili-floom-slideshow'; |
| [2342](#L2342) | } |
| [2343](#L2343) | if ( class\_exists( 'xili\_postinpost' ) ) { |
| [2344](#L2344) | $list[] = 'xili-postinpost'; |
| [2345](#L2345) | } |
| [2346](#L2346) | return implode( ', ', $list ); |
| [2347](#L2347) | } |
| [2348](#L2348) |  |
| [2349](#L2349) | public function on\_sidebox\_mail\_content( $data ) { |
| [2350](#L2350) | extract( $data ); |
| [2351](#L2351) | global $wp\_version; |
| [2352](#L2352) | $theme = ( isset( $this->xili\_settings['theme'] ) ) ? $this->xili\_settings['theme'] : ''; |
| [2353](#L2353) | $wplang = ( isset( $this->xili\_settings['wplang'] ) ) ? $this->xili\_settings['wplang'] : ''; |
| [2354](#L2354) | $xiliplug = ( isset( $this->xili\_settings['xiliplug'] ) ) ? $this->xili\_settings['xiliplug'] : ''; |
| [2355](#L2355) | if ( '' != $emessage ) { |
| [2356](#L2356) | ?> |
| [2357](#L2357) | <h4><?php esc\_html\_e( 'Note:', 'xili-tidy-tags' ); ?></h4> |
| [2358](#L2358) | <p><strong><?php echo $emessage; ?></strong></p> |
| [2359](#L2359) | <?php |
| [2360](#L2360) | } |
| [2361](#L2361) | ?> |
| [2362](#L2362) | <fieldset style="margin:2px; padding:12px 6px; border:1px solid #ccc;"><legend><?php echo esc\_html\_e( 'Mail to dev.xiligroup', 'xili-tidy-tags' ); ?></legend> |
| [2363](#L2363) | <label for="ccmail"><?php esc\_html\_e( 'Cc: (Reply to:)', 'xili-tidy-tags' ); ?> |
| [2364](#L2364) | <input class="widefat" id="ccmail" name="ccmail" type="text" value="<?php bloginfo( 'admin\_email' ); ?>" /></label><br /><br /> |
| [2365](#L2365) | <?php |
| [2366](#L2366) | if ( false === strpos( get\_bloginfo( 'url' ), 'local' ) ) { |
| [2367](#L2367) | ?> |
| [2368](#L2368) | <label for="urlenable"> |
| [2369](#L2369) | <input type="checkbox" id="urlenable" name="urlenable" value="enable" <?php checked( ( isset( $this->xili\_settings['url'] ) && $this->xili\_settings['url']=='enable' ), true, true ); ?> />&nbsp;<?php bloginfo( 'url' ); ?> |
| [2370](#L2370) | </label><br /> |
| [2371](#L2371) | <?php |
| [2372](#L2372) | } else { |
| [2373](#L2373) | ?> |
| [2374](#L2374) | <input type="hidden" name="onlocalhost" id="onlocalhost" value="localhost" /> |
| [2375](#L2375) | <?php |
| [2376](#L2376) | } |
| [2377](#L2377) | ?> |
| [2378](#L2378) | <br /><em><?php esc\_html\_e( 'When checking and giving detailled infos, support will be better !', 'xili-tidy-tags' ); ?></em><br /> |
| [2379](#L2379) | <label for="themeenable"> |
| [2380](#L2380) | <input type="checkbox" id="themeenable" name="themeenable" value="enable" <?php checked( $theme, 'enable', true ); ?> />&nbsp;<?php echo 'Theme name= ' . get\_option( 'stylesheet' ); ?> |
| [2381](#L2381) | </label><br /> |
| [2382](#L2382) | <?php if ( '' != $this->get\_wplang() ) { ?> |
| [2383](#L2383) | <label for="wplangenable"> |
| [2384](#L2384) | <input type="checkbox" id="wplangenable" name="wplangenable" value="enable" <?php checked( $wplang, 'enable', true ); ?> />&nbsp;<?php echo 'WPLANG= ' . $this->get\_wplang(); ?> |
| [2385](#L2385) | </label><br /> |
| [2386](#L2386) | <?php } ?> |
| [2387](#L2387) | <label for="versionenable"> |
| [2388](#L2388) | <input type="checkbox" id="versionenable" name="versionenable" value="enable" <?php if ( isset( $this->xili\_settings['version-wp'] ) ) checked( $this->xili\_settings['version-wp'],'enable', true); ?> />&nbsp;<?php echo 'WP version: ' . $wp\_version; ?> |
| [2389](#L2389) | </label><br /><br /> |
| [2390](#L2390) | <?php |
| [2391](#L2391) | $list = $this->check\_other\_xili\_plugins(); |
| [2392](#L2392) | if ( '' != $list ) { |
| [2393](#L2393) | ?> |
| [2394](#L2394) | <label for="xiliplugenable"> |
| [2395](#L2395) | <input type="checkbox" id="xiliplugenable" name="xiliplugenable" value="enable" <?php checked( $xiliplug, 'enable', true ); ?> />&nbsp;<?php echo 'Other xili plugins = ' . $list; ?> |
| [2396](#L2396) | </label><br /><br /> |
| [2397](#L2397) | <?php } ?> |
| [2398](#L2398) | <label for="webmestre"><?php esc\_html\_e( 'Type of webmaster:', 'xili-tidy-tags' ); ?> |
| [2399](#L2399) | <select name="webmestre" id="webmestre" style="width:100%;"> |
| [2400](#L2400) | <?php |
| [2401](#L2401) | if ( ! isset( $this->xili\_settings['webmestre-level'] ) ) { |
| [2402](#L2402) | $this->xili\_settings['webmestre-level'] = '?'; |
| [2403](#L2403) | } |
| [2404](#L2404) | ?> |
| [2405](#L2405) | <option value="?" <?php selected( $this->xili\_settings['webmestre-level'], '?' ); ?>><?php esc\_html\_e( 'Define your experience as webmaster…', 'xili-tidy-tags' ); ?></option> |
| [2406](#L2406) | <option value="newbie" <?php selected( $this->xili\_settings['webmestre-level'], 'newbie' ); ?>><?php esc\_html\_e( 'Newbie in WP', 'xili-tidy-tags' ); ?></option> |
| [2407](#L2407) | <option value="wp-php" <?php selected( $this->xili\_settings['webmestre-level'], 'wp-php' ); ?>><?php esc\_html\_e( 'Good knowledge in WP and few in php', 'xili-tidy-tags' ); ?></option> |
| [2408](#L2408) | <option value="wp-php-dev" <?php selected( $this->xili\_settings['webmestre-level'], 'wp-php-dev' ); ?>><?php esc\_html\_e( 'Good knowledge in WP, CMS and good in php', 'xili-tidy-tags' ); ?></option> |
| [2409](#L2409) | <option value="wp-plugin-theme" <?php selected( $this->xili\_settings['webmestre-level'], 'wp-plugin-theme' ); ?>><?php esc\_html\_e( 'WP theme and /or plugin developper', 'xili-tidy-tags' ); ?></option> |
| [2410](#L2410) | </select></label> |
| [2411](#L2411) | <br /><br /> |
| [2412](#L2412) | <label for="subject"><?php esc\_html\_e( 'Subject:', 'xili-tidy-tags' ); ?> |
| [2413](#L2413) | <input class="widefat" id="subject" name="subject" type="text" value='' /></label> |
| [2414](#L2414) | <select name="thema" id="thema" style="width:100%;"> |
| [2415](#L2415) | <option value='' ><?php esc\_html\_e( 'Choose topic... ', 'xili-tidy-tags' ); ?></option> |
| [2416](#L2416) | <option value="Message" ><?php esc\_html\_e( 'Message', 'xili-tidy-tags' ); ?></option> |
| [2417](#L2417) | <option value="Question" ><?php esc\_html\_e( 'Question', 'xili-tidy-tags' ); ?></option> |
| [2418](#L2418) | <option value="Encouragement" ><?php esc\_html\_e( 'Encouragement', 'xili-tidy-tags' ); ?></option> |
| [2419](#L2419) | <option value="Support need" ><?php esc\_html\_e( 'Support need', 'xili-tidy-tags' ); ?></option> |
| [2420](#L2420) | </select> |
| [2421](#L2421) | <textarea class="widefat" rows="5" cols="20" id="mailcontent" name="mailcontent"><?php esc\_html\_e( 'Your message here…', 'xili-tidy-tags' ); ?></textarea> |
| [2422](#L2422) | </fieldset> |
| [2423](#L2423) | <p> |
| [2424](#L2424) | <?php esc\_html\_e( 'Before send the mail, check the infos to be sent and complete textarea. A copy (Cc:) is sent to webmaster email (modify it if needed) . ', 'xili-tidy-tags' ); ?> |
| [2425](#L2425) | </p> |
| [2426](#L2426) | <div class='submit'> |
| [2427](#L2427) | <input id='sendmail' name='sendmail' type='submit' tabindex='6' value="<?php esc\_html\_e( 'Send email', 'xili-tidy-tags' ); ?>" /></div> |
| [2428](#L2428) |  |
| [2429](#L2429) | <div style="clear:both; height:1px"></div> |
| [2430](#L2430) | <?php |
| [2431](#L2431) | } |
| [2432](#L2432) |  |
| [2433](#L2433) | } // end of admin class |

**Note:** See [TracBrowser](/wiki/TracBrowser)
for help on using the repository browser.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Plain Text](/browser/xili-tidy-tags/tags/1.12.04/xili-includes/class-xili-tidy-tags-admin.php?format=txt)
* [Original Format](/export/3222436/xili-tidy-tags/tags/1.12.04/xili-includes/class-xili-tidy-tags-admin.php)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)


