=== Content from plugins.trac.wordpress.org_c17b0d26_20250114_210506.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fbrowser%2Fbranda-white-labeling%2Ftags%2F3.4.19%2Finc%2Fclass-branda-admin.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Revision](/browser/branda-white-labeling/trunk/inc/class-branda-admin.php?rev=3011986 "Revision 3011986")
* [Next Revision](/browser/branda-white-labeling/trunk/inc/class-branda-admin.php?rev=3191895 "Revision 3191895") →
* [Blame](/browser/branda-white-labeling/trunk/inc/class-branda-admin.php?annotate=blame "Annotate each line with the last changed revision (this can be time consuming...)")
* [Revision Log](/log/branda-white-labeling/tags/3.4.19/inc/class-branda-admin.php)

---

# [source:](/browser?order=name "Go to repository root") [branda-white-labeling](/browser/branda-white-labeling?order=name "View branda-white-labeling")/[tags](/browser/branda-white-labeling/tags?order=name "View tags")/[3.4.19](/browser/branda-white-labeling/tags/3.4.19?order=name "View 3.4.19")/[inc](/browser/branda-white-labeling/tags/3.4.19/inc?order=name "View inc")/[class-branda-admin.php](/browser/branda-white-labeling/tags/3.4.19/inc/class-branda-admin.php?order=name "View class-branda-admin.php")

View diff against:

View revision:

| [Last change](/changeset/3042684/branda-white-labeling/trunk/inc/class-branda-admin.php "View differences") on this file was [3042684](/changeset/3042684/ "View changeset 3042684"), checked in by panoslyrakis, [11 months ago](/timeline?from=2024-02-28T15%3A45%3A41Z&precision=second "See timeline at 02/28/2024 03:45:41 PM") |
| --- |
| Update Version 3.4.16 |
| * Property **svn:executable** set to   *`*`* | |
| **File size:** 82.3 KB | |

| Line |  |
| --- | --- |
| [1](#L1) | <?php |
| [2](#L2) | if ( ! class\_exists( 'Branda\_Admin' ) ) { |
| [3](#L3) | require\_once dirname( \_\_FILE\_\_ ) . '/class-branda-base.php'; |
| [4](#L4) | require\_once dirname( \_\_FILE\_\_ ) . '/class-branda-admin-stats.php'; |
| [5](#L5) | class Branda\_Admin extends Branda\_Base { |
| [6](#L6) |  |
| [7](#L7) | var $modules    = array(); |
| [8](#L8) | var $plugin\_msg = array(); |
| [9](#L9) |  |
| [10](#L10) | /\*\* |
| [11](#L11) | \* Default messages. |
| [12](#L12) | \* |
| [13](#L13) | \* @since 1.8.5 |
| [14](#L14) | \*/ |
| [15](#L15) | var $messages = array(); |
| [16](#L16) |  |
| [17](#L17) | /\*\* |
| [18](#L18) | \* Stats |
| [19](#L19) | \* |
| [20](#L20) | \* @since 2.3.0 |
| [21](#L21) | \*/ |
| [22](#L22) | private $stats = null; |
| [23](#L23) |  |
| [24](#L24) | /\*\* |
| [25](#L25) | \* module |
| [26](#L26) | \* |
| [27](#L27) | \* @since 3.0.0 |
| [28](#L28) | \*/ |
| [29](#L29) | private $module = ''; |
| [30](#L30) |  |
| [31](#L31) | /\*\* |
| [32](#L32) | \* Show Welcome Dialog |
| [33](#L33) | \* |
| [34](#L34) | \* @since 3.0.0 |
| [35](#L35) | \*/ |
| [36](#L36) | private $show\_welcome\_dialog = false; |
| [37](#L37) |  |
| [38](#L38) | /\*\* |
| [39](#L39) | \* Top page slug |
| [40](#L40) | \*/ |
| [41](#L41) | private $top\_page\_slug; |
| [42](#L42) |  |
| [43](#L43) | /\*\* |
| [44](#L44) | \* Messages storing |
| [45](#L45) | \* |
| [46](#L46) | \* @since 3.1.0 |
| [47](#L47) | \*/ |
| [48](#L48) | private $messages\_option\_name = 'branda\_messages'; |
| [49](#L49) |  |
| [50](#L50) | /\*\* |
| [51](#L51) | \* Is Branda admin menu shown or not |
| [52](#L52) | \* |
| [53](#L53) | \* @var bool |
| [54](#L54) | \*/ |
| [55](#L55) | private static $is\_show\_admin\_menu = false; |
| [56](#L56) |  |
| [57](#L57) | public function \_\_construct() { |
| [58](#L58) | parent::\_\_construct(); |
| [59](#L59) | /\*\* |
| [60](#L60) | \* set and sanitize variables |
| [61](#L61) | \*/ |
| [62](#L62) | add\_action( 'plugins\_loaded', array( $this, 'set\_and\_sanitize\_variables' ), 2 ); |
| [63](#L63) | /\*\* |
| [64](#L64) | \* run stats |
| [65](#L65) | \*/ |
| [66](#L66) | $this->stats = new Branda\_Admin\_Stats(); |
| [67](#L67) | foreach ( $this->configuration as $key => $data ) { |
| [68](#L68) | $is\_avaialble = $this->can\_load\_module( $data ); |
| [69](#L69) | if ( ! $is\_avaialble ) { |
| [70](#L70) | continue; |
| [71](#L71) | } |
| [72](#L72) | if ( isset( $data['disabled'] ) && $data['disabled'] ) { |
| [73](#L73) | continue; |
| [74](#L74) | } |
| [75](#L75) | $this->modules[ $key ] = $data['module']; |
| [76](#L76) | } |
| [77](#L77) | /\*\* |
| [78](#L78) | \* Filter allow to turn off available modules. |
| [79](#L79) | \* |
| [80](#L80) | \* @since 1.9.4 |
| [81](#L81) | \* |
| [82](#L82) | \* @param array $modules available modules array. |
| [83](#L83) | \*/ |
| [84](#L84) | $this->modules = apply\_filters( 'ultimatebranding\_available\_modules', $this->modules ); |
| [85](#L85) | add\_action( 'plugins\_loaded', array( $this, 'load\_modules' ), 11 ); |
| [86](#L86) | add\_action( 'plugins\_loaded', array( $this, 'setup\_translation' ) ); |
| [87](#L87) | add\_action( 'network\_admin\_menu', array( $this, 'network\_admin\_page' ) ); |
| [88](#L88) | add\_action( 'admin\_menu', array( $this, 'admin\_page' ) ); |
| [89](#L89) | add\_filter( 'admin\_title', array( $this, 'admin\_title' ), 10, 2 ); |
| [90](#L90) | /\*\* |
| [91](#L91) | \* AJAX |
| [92](#L92) | \*/ |
| [93](#L93) | add\_action( 'wp\_ajax\_ultimate\_branding\_toggle\_module', array( $this, 'toggle\_module' ) ); |
| [94](#L94) | add\_action( 'wp\_ajax\_branda\_reset\_module', array( $this, 'ajax\_reset\_module' ) ); |
| [95](#L95) | add\_action( 'wp\_ajax\_branda\_manage\_all\_modules', array( $this, 'ajax\_bulk\_modules' ) ); |
| [96](#L96) | add\_action( 'wp\_ajax\_branda\_module\_copy\_settings', array( $this, 'ajax\_copy\_settings' ) ); |
| [97](#L97) | add\_action( 'wp\_ajax\_branda\_welcome\_get\_modules', array( $this, 'ajax\_welcome' ) ); |
| [98](#L98) | add\_action( 'wp\_ajax\_branda\_dismiss\_black\_friday\_notice', array( $this, 'dismiss\_black\_friday\_2021' ) ); |
| [99](#L99) | add\_filter( 'branda\_admin\_messages\_array', array( $this, 'add\_admin\_notices' ) ); |
| [100](#L100) | add\_action( 'wp\_ajax\_ultimate\_branding\_new\_feature\_dismiss', array( $this, 'new\_feature\_dismiss' ) ); |
| [101](#L101) | /\*\* |
| [102](#L102) | \* default messages |
| [103](#L103) | \*/ |
| [104](#L104) | $this->messages = array( |
| [105](#L105) | 'success'               => \_\_( 'Success! Your changes were successfully saved!', 'ub' ), |
| [106](#L106) | 'fail'                  => \_\_( 'There was an error, please try again.', 'ub' ), |
| [107](#L107) | 'reset-section-success' => \_\_( 'Section was reset to defaults.', 'ub' ), |
| [108](#L108) | 'wrong'                 => \_\_( 'Something went wrong!', 'ub' ), |
| [109](#L109) | 'security'              => \_\_( 'Nope! Security check failed!', 'ub' ), |
| [110](#L110) | 'missing'               => \_\_( 'Missing required data!', 'ub' ), |
| [111](#L111) | 'wrong\_userlogin'       => \_\_( 'This user login doesn\'t exist!', 'ub' ), |
| [112](#L112) | ); |
| [113](#L113) | /\*\* |
| [114](#L114) | \* remove default footer |
| [115](#L115) | \*/ |
| [116](#L116) | add\_filter( 'admin\_footer\_text', array( $this, 'remove\_default\_footer' ), PHP\_INT\_MAX ); |
| [117](#L117) | /\*\* |
| [118](#L118) | \* upgrade |
| [119](#L119) | \* |
| [120](#L120) | \* @since 3.0.0 |
| [121](#L121) | \*/ |
| [122](#L122) | add\_action( 'init', array( $this, 'upgrade' ) ); |
| [123](#L123) | /\*\* |
| [124](#L124) | \* Add branda class to admin body |
| [125](#L125) | \*/ |
| [126](#L126) | add\_filter( 'admin\_body\_class', array( $this, 'add\_branda\_admin\_body\_class' ), PHP\_INT\_MAX ); |
| [127](#L127) | /\*\* |
| [128](#L128) | \* Add import/export modules instantly on |
| [129](#L129) | \*/ |
| [130](#L130) | add\_filter( 'ub\_get\_option-ultimatebranding\_activated\_modules', array( $this, 'add\_instant\_modules' ), 10, 3 ); |
| [131](#L131) | /\*\* |
| [132](#L132) | \* Add sui-wrap classes |
| [133](#L133) | \* |
| [134](#L134) | \* @since 3.0.6 |
| [135](#L135) | \*/ |
| [136](#L136) | add\_filter( 'branda\_sui\_wrap\_class', array( $this, 'add\_sui\_wrap\_classes' ) ); |
| [137](#L137) | /\*\* |
| [138](#L138) | \* Delete image from modules, when it is deleted from WordPress |
| [139](#L139) | \* |
| [140](#L140) | \* @since 3.1.0 |
| [141](#L141) | \*/ |
| [142](#L142) | add\_action( 'delete\_attachment', array( $this, 'delete\_attachment\_from\_configs' ), 10, 1 ); |
| [143](#L143) |  |
| [144](#L144) | // Add additional links on Plugins page |
| [145](#L145) | global $branda\_plugin\_file; |
| [146](#L146) | add\_filter( "plugin\_action\_links\_{$branda\_plugin\_file}", array( $this, 'add\_plugin\_action\_links' ), 10, 4 ); |
| [147](#L147) | add\_filter( "network\_admin\_plugin\_action\_links\_{$branda\_plugin\_file}", array( $this, 'add\_plugin\_action\_links' ), 10, 4 ); |
| [148](#L148) | add\_filter( 'plugin\_row\_meta', array( $this, 'plugin\_row\_meta' ), 10, 4 ); |
| [149](#L149) | } |
| [150](#L150) |  |
| [151](#L151) | public function dismiss\_black\_friday\_2021() { |
| [152](#L152) | update\_site\_option( 'branda\_black\_friday\_2021\_dismissed', 1 ); |
| [153](#L153) | } |
| [154](#L154) |  |
| [155](#L155) | /\*\* |
| [156](#L156) | \* Load Permissions for checking access to modules |
| [157](#L157) | \*/ |
| [158](#L158) | private function load\_permissions() { |
| [159](#L159) | if ( ! class\_exists( 'Branda\_Permissions' ) ) { |
| [160](#L160) | branda\_load\_single\_module( 'utilities/permissions.php' ); |
| [161](#L161) | } |
| [162](#L162) | Branda\_Permissions::get\_instance(); |
| [163](#L163) | } |
| [164](#L164) |  |
| [165](#L165) | /\*\* |
| [166](#L166) | \* Faked instant on modules as active. |
| [167](#L167) | \* |
| [168](#L168) | \* @since 3.0.0 |
| [169](#L169) | \*/ |
| [170](#L170) | public function add\_instant\_modules( $value, $option, $default ) { |
| [171](#L171) | if ( ! is\_array( $value ) ) { |
| [172](#L172) | $value = array(); |
| [173](#L173) | } |
| [174](#L174) | foreach ( $this->configuration as $key => $module ) { |
| [175](#L175) | if ( isset( $module['instant'] ) && 'on' === $module['instant'] ) { |
| [176](#L176) | $value[ $key ] = 'yes'; |
| [177](#L177) | } |
| [178](#L178) | } |
| [179](#L179) | return $value; |
| [180](#L180) | } |
| [181](#L181) |  |
| [182](#L182) | /\*\* |
| [183](#L183) | \* Add "Branda" to admin title. |
| [184](#L184) | \* |
| [185](#L185) | \* @since 1.9.8 |
| [186](#L186) | \*/ |
| [187](#L187) | public function admin\_title( $admin\_title, $title ) { |
| [188](#L188) | $screen = get\_current\_screen(); |
| [189](#L189) | if ( is\_a( $screen, 'WP\_Screen' ) && preg\_match( '/\_page\_branding/', $screen->id ) ) { |
| [190](#L190) | $admin\_title = sprintf( |
| [191](#L191) | '%s%s%s', |
| [192](#L192) | \_x( 'Branda', 'admin title', 'ub' ), |
| [193](#L193) | \_x( ' &lsaquo; ', 'admin title separator', 'ub' ), |
| [194](#L194) | $admin\_title |
| [195](#L195) | ); |
| [196](#L196) | if ( ! empty( $this->module ) ) { |
| [197](#L197) | $module\_data = $this->get\_module\_by\_module( $this->module ); |
| [198](#L198) | if ( ! empty( $module\_data ) && isset( $module\_data['group'] ) ) { |
| [199](#L199) | $groups = branda\_get\_groups\_list(); |
| [200](#L200) | if ( isset( $groups[ $module\_data['group'] ] ) ) { |
| [201](#L201) | $admin\_title = sprintf( |
| [202](#L202) | '%s%s%s', |
| [203](#L203) | $groups[ $module\_data['group'] ]['title'], |
| [204](#L204) | \_x( ' &lsaquo; ', 'admin title separator', 'ub' ), |
| [205](#L205) | $admin\_title |
| [206](#L206) | ); |
| [207](#L207) | } |
| [208](#L208) | } |
| [209](#L209) | } |
| [210](#L210) | } |
| [211](#L211) | return $admin\_title; |
| [212](#L212) | } |
| [213](#L213) |  |
| [214](#L214) | /\*\* |
| [215](#L215) | \* Plugin action links |
| [216](#L216) | \* |
| [217](#L217) | \* @param type   $actions |
| [218](#L218) | \* @param string $plugin\_file |
| [219](#L219) | \* @return array |
| [220](#L220) | \*/ |
| [221](#L221) | public function add\_plugin\_action\_links( $actions, $plugin\_file, $plugin\_data, $context ) { |
| [222](#L222) | if ( $this->is\_network && ( is\_main\_site() || is\_plugin\_active\_for\_network( $plugin\_file ) ) ) { |
| [223](#L223) | $admin\_url = network\_admin\_url( 'admin.php' ); |
| [224](#L224) | } elseif ( ! $this->is\_network || self::$is\_show\_admin\_menu ) { |
| [225](#L225) | $admin\_url = admin\_url( 'admin.php' ); |
| [226](#L226) | } |
| [227](#L227) | if ( ! empty( $admin\_url ) ) { |
| [228](#L228) | $dash\_url           = add\_query\_arg( 'page', 'branding', $admin\_url ); |
| [229](#L229) | $links['dashboard'] = '<a href="' . $dash\_url . '">' . \_\_( 'Dashboard', 'ub' ) . '</a>'; |
| [230](#L230) | } |
| [231](#L231) | $links['docs'] = '<a href="https://wpmudev.com/docs/wpmu-dev-plugins/branda/?utm\_source=branda&utm\_medium=plugin&utm\_campaign=branda\_pluginlist\_docs" target="\_blank">' . \_\_( 'Docs', 'ub' ) . '</a>'; |
| [232](#L232) | if ( Branda\_Helper::is\_pro() ) { |
| [233](#L233) | if ( ! Branda\_Helper::is\_member() ) { |
| [234](#L234) | $links['renew'] = '<a href="https://wpmudev.com/project/ultimate-branding/?utm\_source=branda&utm\_medium=plugin&utm\_campaign=branda\_pluginlist\_renew" target="\_blank" style="color: #8D00B1;">' . \_\_( 'Renew Membership', 'ub' ) . '</a>'; |
| [235](#L235) | } |
| [236](#L236) | } else { |
| [237](#L237) | if ( is\_network\_admin() || ! is\_multisite() ) { |
| [238](#L238) | $url              = 'https://wpmudev.com/project/ultimate-branding/?utm\_source=branda&utm\_medium=plugin&utm\_campaign=branda\_pluginlist\_upgrade'; |
| [239](#L239) | $links['upgrade'] = '<a href="' . esc\_url( $url ) . '" aria-label="' . esc\_attr( \_\_( 'Upgrade For 80% Off!', 'ub' ) ) . '" target="\_blank" style="color: #8D00B1;">' . esc\_html\_\_( 'Upgrade For 80% Off!', 'ub' ) . '</a>'; |
| [240](#L240) | } |
| [241](#L241) | } |
| [242](#L242) | $actions = array\_merge( $links, $actions ); |
| [243](#L243) |  |
| [244](#L244) | return $actions; |
| [245](#L245) | } |
| [246](#L246) |  |
| [247](#L247) | /\*\* |
| [248](#L248) | \* Links next to version number |
| [249](#L249) | \* |
| [250](#L250) | \* @global string $branda\_plugin\_file |
| [251](#L251) | \* @param array  $plugin\_meta |
| [252](#L252) | \* @param string $plugin\_file |
| [253](#L253) | \* @return array |
| [254](#L254) | \*/ |
| [255](#L255) | public function plugin\_row\_meta( $plugin\_meta, $plugin\_file, $plugin\_data, $status ) { |
| [256](#L256) | global $branda\_plugin\_file; |
| [257](#L257) | if ( $branda\_plugin\_file === $plugin\_file ) { |
| [258](#L258) | if ( Branda\_Helper::is\_pro() ) { |
| [259](#L259) | $plugin\_meta[2] = '<a href="https://wpmudev.com/project/ultimate-branding/" target="\_blank">' . esc\_html\_\_( 'View Details', 'ub' ) . '</a>'; |
| [260](#L260) | $row\_meta       = array( |
| [261](#L261) | 'support' => '<a href="https://wpmudev.com/hub/support/#wpmud-chat-pre-survey-modal" target="\_blank">' . esc\_html\_\_( 'Premium Support', 'ub' ) . '</a>', |
| [262](#L262) | ); |
| [263](#L263) | } else { |
| [264](#L264) | $plugin\_meta[1] = esc\_html\_\_( 'By', 'ub' ) . ' <a href="https://profiles.wordpress.org/wpmudev/" target="\_blank">WPMU DEV</a>'; |
| [265](#L265) | $row\_meta       = array( |
| [266](#L266) | 'rate'    => '<a href="https://wordpress.org/support/plugin/branda-white-labeling/reviews/#new-post" target="\_blank">' . esc\_html\_\_( 'Rate Branda', 'ub' ) . '</a>', |
| [267](#L267) | 'support' => '<a href="https://wordpress.org/support/plugin/branda-white-labeling/" target="\_blank">' . esc\_html\_\_( 'Support', 'ub' ) . '</a>', |
| [268](#L268) | ); |
| [269](#L269) | } |
| [270](#L270) |  |
| [271](#L271) | $row\_meta['roadmap'] = '<a href="https://wpmudev.com/roadmap/" target="\_blank">' . esc\_html\_\_( 'Roadmap', 'ub' ) . '</a>'; |
| [272](#L272) |  |
| [273](#L273) | $plugin\_meta = array\_merge( $plugin\_meta, $row\_meta ); |
| [274](#L274) | } |
| [275](#L275) |  |
| [276](#L276) | return $plugin\_meta; |
| [277](#L277) | } |
| [278](#L278) |  |
| [279](#L279) | /\*\* |
| [280](#L280) | \* Add message to show |
| [281](#L281) | \*/ |
| [282](#L282) | public function add\_message( $message ) { |
| [283](#L283) | $messages = get\_user\_option( $this->messages\_option\_name ); |
| [284](#L284) |  |
| [285](#L285) | if ( empty( $messages ) ) { |
| [286](#L286) | $messages = array(); |
| [287](#L287) | } |
| [288](#L288) |  |
| [289](#L289) | if ( ! is\_array( $messages ) ) { |
| [290](#L290) | // Here let's check if it's serialized, so we can convert to array. |
| [291](#L291) | $unserialized\_messages = maybe\_unserialize( $messages ); |
| [292](#L292) |  |
| [293](#L293) | $messages = is\_array( $unserialized\_messages ) ? $unserialized\_messages : array(); |
| [294](#L294) | } |
| [295](#L295) |  |
| [296](#L296) | if ( ! in\_array( $message, $messages ) ) { |
| [297](#L297) | $user\_id    = get\_current\_user\_id(); |
| [298](#L298) | $messages[] = $message; |
| [299](#L299) | update\_user\_option( $user\_id, $this->messages\_option\_name, $messages, false ); |
| [300](#L300) | } |
| [301](#L301) | } |
| [302](#L302) |  |
| [303](#L303) | /\*\* |
| [304](#L304) | \* Add admin notice from option. |
| [305](#L305) | \* |
| [306](#L306) | \* @since 3.4 |
| [307](#L307) | \*/ |
| [308](#L308) | public function add\_admin\_notices( $texts ) { |
| [309](#L309) | $screen = get\_current\_screen(); |
| [310](#L310) | if ( ! preg\_match( '/\_page\_branding/', $screen->id ) ) { |
| [311](#L311) | return $texts; |
| [312](#L312) | } |
| [313](#L313) | $messages = get\_user\_option( $this->messages\_option\_name ); |
| [314](#L314) | if ( empty( $messages ) ) { |
| [315](#L315) | return $texts; |
| [316](#L316) | } |
| [317](#L317) | $fire\_delete = false; |
| [318](#L318) | foreach ( $messages as $message ) { |
| [319](#L319) | if ( ! isset( $message['message'] ) || empty( $message['message'] ) ) { |
| [320](#L320) | continue; |
| [321](#L321) | } |
| [322](#L322) | $fire\_delete              = true; |
| [323](#L323) | $texts['admin\_notices'][] = $message; |
| [324](#L324) | } |
| [325](#L325) | if ( $fire\_delete ) { |
| [326](#L326) | add\_action( 'shutdown', array( $this, 'delete\_messages' ) ); |
| [327](#L327) | } |
| [328](#L328) |  |
| [329](#L329) | return $texts; |
| [330](#L330) | } |
| [331](#L331) |  |
| [332](#L332) | /\*\* |
| [333](#L333) | \* delete messages |
| [334](#L334) | \* |
| [335](#L335) | \* @since 3.1.0 |
| [336](#L336) | \*/ |
| [337](#L337) | public function delete\_messages() { |
| [338](#L338) | $user\_id = get\_current\_user\_id(); |
| [339](#L339) | delete\_user\_option( $user\_id, $this->messages\_option\_name, false ); |
| [340](#L340) | } |
| [341](#L341) |  |
| [342](#L342) | public function setup\_translation() { |
| [343](#L343) | // Load up the localization file if we're using WordPress in a different language |
| [344](#L344) | // Place it in this plugin's "languages" folder and name it "mp-[value in wp-config].mo" |
| [345](#L345) | $dir = sprintf( '/%s/languages', basename( branda\_dir( '' ) ) ); |
| [346](#L346) | load\_plugin\_textdomain( 'ub', false, $dir ); |
| [347](#L347) | } |
| [348](#L348) |  |
| [349](#L349) | /\*\* |
| [350](#L350) | \* Check user permissions |
| [351](#L351) | \* |
| [352](#L352) | \* @return boolean |
| [353](#L353) | \*/ |
| [354](#L354) | private function check\_user\_access() { |
| [355](#L355) | return Branda\_Permissions::get\_instance()->current\_user\_has\_access(); |
| [356](#L356) | } |
| [357](#L357) |  |
| [358](#L358) | public function add\_admin\_header\_core() { |
| [359](#L359) | /\*\* |
| [360](#L360) | \* Filter allow to avoid run wp\_enqueue\* functions. |
| [361](#L361) | \* |
| [362](#L362) | \* @since 3.0.0 |
| [363](#L363) | \* @param boolean $add Load assets or not load - it is a question. |
| [364](#L364) | \*/ |
| [365](#L365) | $add = apply\_filters( 'branda\_add\_admin\_header\_core', true ); |
| [366](#L366) | if ( ! $add ) { |
| [367](#L367) | return; |
| [368](#L368) | } |
| [369](#L369) |  |
| [370](#L370) | global $wp\_version; |
| [371](#L371) | if ( version\_compare( $wp\_version, '5.2', '<' ) && ! wp\_script\_is( 'clipboard' ) ) { |
| [372](#L372) | wp\_register\_script( |
| [373](#L373) | 'clipboard', |
| [374](#L374) | branda\_url( 'external/clipboard/clipboard.js' ), |
| [375](#L375) | array(), |
| [376](#L376) | $this->build, |
| [377](#L377) | true |
| [378](#L378) | ); |
| [379](#L379) | } |
| [380](#L380) | wp\_register\_script( |
| [381](#L381) | 'branda-sui-ace', |
| [382](#L382) | branda\_url( 'external/ace/ace.js' ), |
| [383](#L383) | array(), |
| [384](#L384) | $this->build, |
| [385](#L385) | true |
| [386](#L386) | ); |
| [387](#L387) | wp\_register\_script( |
| [388](#L388) | 'branda-sui-a11y-dialog', |
| [389](#L389) | branda\_url( 'external/a11y-dialog/a11y-dialog.js' ), |
| [390](#L390) | array(), |
| [391](#L391) | $this->build, |
| [392](#L392) | true |
| [393](#L393) | ); |
| [394](#L394) | wp\_register\_script( |
| [395](#L395) | 'branda-sui-select2', |
| [396](#L396) | branda\_url( 'external/select2/select2.full.js' ), |
| [397](#L397) | array(), |
| [398](#L398) | $this->build, |
| [399](#L399) | true |
| [400](#L400) | ); |
| [401](#L401) |  |
| [402](#L402) | /\*\* |
| [403](#L403) | \* Shared UI |
| [404](#L404) | \* |
| [405](#L405) | \* @since 3.0.0 |
| [406](#L406) | \*/ |
| [407](#L407) | if ( defined( 'BRANDA\_SUI\_VERSION' ) ) { |
| [408](#L408) | $sanitize\_version = str\_replace( '.', '-', BRANDA\_SUI\_VERSION ); |
| [409](#L409) | $sui\_body\_class   = "sui-$sanitize\_version"; |
| [410](#L410) | wp\_register\_script( |
| [411](#L411) | 'sui-scripts', |
| [412](#L412) | branda\_url( 'assets/js/shared-ui.min.js' ), |
| [413](#L413) | array( 'jquery', 'clipboard', 'branda-sui-ace', 'branda-sui-a11y-dialog', 'branda-sui-select2' ), |
| [414](#L414) | $sui\_body\_class, |
| [415](#L415) | true |
| [416](#L416) | ); |
| [417](#L417) | wp\_enqueue\_style( |
| [418](#L418) | 'sui-styles', |
| [419](#L419) | branda\_url( 'assets/css/shared-ui-style.min.css' ), |
| [420](#L420) | array(), |
| [421](#L421) | $sui\_body\_class |
| [422](#L422) | ); |
| [423](#L423) | } |
| [424](#L424) | // Add in the core CSS file |
| [425](#L425) | $file = branda\_url( 'assets/css/ultimate-branding-admin-style.min.css' ); |
| [426](#L426) | wp\_enqueue\_style( 'branda-admin', $file, array(), $this->build ); |
| [427](#L427) | wp\_enqueue\_script( |
| [428](#L428) | array( |
| [429](#L429) | 'jquery-ui-sortable', |
| [430](#L430) | ) |
| [431](#L431) | ); |
| [432](#L432) | $file = sprintf( 'assets/js/ultimate-branding-admin%s.js', defined( 'WP\_DEBUG' ) && WP\_DEBUG ? '' : '.min' ); |
| [433](#L433) | wp\_enqueue\_script( |
| [434](#L434) | 'ub\_admin', |
| [435](#L435) | branda\_url( $file ), |
| [436](#L436) | array( |
| [437](#L437) | 'jquery', |
| [438](#L438) | 'jquery-effects-highlight', |
| [439](#L439) | 'sui-scripts', |
| [440](#L440) | 'underscore', |
| [441](#L441) | 'wp-util', |
| [442](#L442) | ), |
| [443](#L443) | $this->build, |
| [444](#L444) | true |
| [445](#L445) | ); |
| [446](#L446) | wp\_enqueue\_style( 'wp-color-picker' ); |
| [447](#L447) | $file = branda\_url( 'external/wp-color-picker-alpha/wp-color-picker-alpha.min.js' ); |
| [448](#L448) | wp\_enqueue\_script( 'wp-color-picker-alpha', $file, array( 'wp-color-picker' ), '2.1.3', true ); |
| [449](#L449) | $color\_picker\_strings = array( |
| [450](#L450) | 'clear'            => \_\_( 'Clear', 'ub' ), |
| [451](#L451) | 'clearAriaLabel'   => \_\_( 'Clear color', 'ub' ), |
| [452](#L452) | 'defaultString'    => \_\_( 'Default', 'ub' ), |
| [453](#L453) | 'defaultAriaLabel' => \_\_( 'Select default color', 'ub' ), |
| [454](#L454) | 'pick'             => \_\_( 'Select Color', 'ub' ), |
| [455](#L455) | 'defaultLabel'     => \_\_( 'Color value', 'ub' ), |
| [456](#L456) | ); |
| [457](#L457) | wp\_localize\_script( 'wp-color-picker-alpha', 'wpColorPickerL10n', $color\_picker\_strings ); |
| [458](#L458) |  |
| [459](#L459) | /\*\* |
| [460](#L460) | \* Messages |
| [461](#L461) | \*/ |
| [462](#L462) | $messages = array( |
| [463](#L463) | 'messages' => array( |
| [464](#L464) | 'copy'    => array( |
| [465](#L465) | 'confirm'      => \_\_( 'Are you sure to replace all section data?', 'ub' ), |
| [466](#L466) | 'select\_first' => \_\_( 'Please select a source module first.', 'ub' ), |
| [467](#L467) | ), |
| [468](#L468) | 'reset'   => array( |
| [469](#L469) | 'module' => \_\_( 'Are you sure? This will replace all entered data by defaults.', 'ub' ), |
| [470](#L470) | ), |
| [471](#L471) | 'welcome' => array( |
| [472](#L472) | 'empty' => \_\_( 'Please select some modules first or skip this step.', 'ub' ), |
| [473](#L473) | ), |
| [474](#L474) | 'form'    => array( |
| [475](#L475) | 'number' => array( |
| [476](#L476) | 'max' => \_\_( 'Entered value is above field limit!', 'ub' ), |
| [477](#L477) | 'min' => \_\_( 'Entered value is below field limit!', 'ub' ), |
| [478](#L478) | ), |
| [479](#L479) | ), |
| [480](#L480) | 'unsaved' => \_\_( 'Changes are not saved, are you sure you want to navigate away?', 'ub' ), |
| [481](#L481) | 'feeds'   => array( |
| [482](#L482) | 'fetch' => esc\_html\_\_( 'Try to fetch feeds data, please wait...', 'ub' ), |
| [483](#L483) | 'no'    => esc\_html\_\_( 'No feed found, try to another site or enter data manually.', 'ub' ), |
| [484](#L484) | ), |
| [485](#L485) | 'export'  => array( |
| [486](#L486) | 'not\_json' => esc\_html\_\_( 'Whoops, only .json filetypes are allowed.', 'ub' ), |
| [487](#L487) | ), |
| [488](#L488) | 'common'  => array( |
| [489](#L489) | 'only\_image' => esc\_html\_\_( 'Whoops, only images are allowed.', 'ub' ), |
| [490](#L490) | ), |
| [491](#L491) | ), |
| [492](#L492) | 'buttons'  => array( |
| [493](#L493) | 'save\_changes' => \_\_( 'Save Changes', 'ub' ), |
| [494](#L494) | ), |
| [495](#L495) | ); |
| [496](#L496) | foreach ( $this->messages as $key => $value ) { |
| [497](#L497) | $messages['messages'][ $key ] = $value; |
| [498](#L498) | } |
| [499](#L499) | /\*\* |
| [500](#L500) | \* Filter messages array |
| [501](#L501) | \* |
| [502](#L502) | \* @since 3.0.0 |
| [503](#L503) | \*/ |
| [504](#L504) | $messages = apply\_filters( 'branda\_admin\_messages\_array', $messages ); |
| [505](#L505) | wp\_localize\_script( 'ub\_admin', 'ub\_admin', $messages ); |
| [506](#L506) | } |
| [507](#L507) |  |
| [508](#L508) | public function add\_admin\_header\_branding() { |
| [509](#L509) | $this->add\_admin\_header\_core(); |
| [510](#L510) | do\_action( 'ultimatebranding\_admin\_header\_global' ); |
| [511](#L511) | $update = apply\_filters( 'ultimatebranding\_update\_branding\_page', true ); |
| [512](#L512) | if ( $update ) { |
| [513](#L513) | $this->update\_branding\_page(); |
| [514](#L514) | } |
| [515](#L515) | } |
| [516](#L516) |  |
| [517](#L517) | /\*\* |
| [518](#L518) | \* Set module status from "Manage All Modules" page. |
| [519](#L519) | \* |
| [520](#L520) | \* @since 3.0.0 |
| [521](#L521) | \*/ |
| [522](#L522) | public function ajax\_bulk\_modules() { |
| [523](#L523) | $fields = array( 'branda', 'nonce' ); |
| [524](#L524) | foreach ( $fields as $field ) { |
| [525](#L525) | if ( ! isset( $\_POST[ $field ] ) ) { |
| [526](#L526) | $args = array( |
| [527](#L527) | 'message' => $this->messages['missing'], |
| [528](#L528) | ); |
| [529](#L529) | wp\_send\_json\_error( $args ); |
| [530](#L530) | } |
| [531](#L531) | } |
| [532](#L532) | if ( |
| [533](#L533) | ! wp\_verify\_nonce( $\_POST['nonce'], 'branda-manage-all-modules' ) |
| [534](#L534) | && ! wp\_verify\_nonce( $\_POST['nonce'], 'branda-welcome-activate' ) |
| [535](#L535) | ) { |
| [536](#L536) | $args = array( |
| [537](#L537) | 'message' => $this->messages['security'], |
| [538](#L538) | ); |
| [539](#L539) | wp\_send\_json\_error( $args ); |
| [540](#L540) | } |
| [541](#L541) | $modules = $\_POST['branda']; |
| [542](#L542) | if ( ! is\_array( $modules ) ) { |
| [543](#L543) | $modules = array(); |
| [544](#L544) | } |
| [545](#L545) | $activated = $deactivated = 0; |
| [546](#L546) | foreach ( $this->configuration as $key => $module ) { |
| [547](#L547) | if ( isset( $module['instant'] ) && $module['instant'] ) { |
| [548](#L548) | continue; |
| [549](#L549) | } |
| [550](#L550) | $is\_active = branda\_is\_active\_module( $key ); |
| [551](#L551) | if ( in\_array( $module['module'], $modules ) ) { |
| [552](#L552) | if ( ! $is\_active ) { |
| [553](#L553) | $this->activate\_module( $key ); |
| [554](#L554) | $activated++; |
| [555](#L555) | } |
| [556](#L556) | } else { |
| [557](#L557) | if ( $is\_active ) { |
| [558](#L558) | $this->deactivate\_module( $key ); |
| [559](#L559) | $deactivated++; |
| [560](#L560) | } |
| [561](#L561) | } |
| [562](#L562) | } |
| [563](#L563) | $message = ''; |
| [564](#L564) | if ( 0 < $activated ) { |
| [565](#L565) | $message .= sprintf( |
| [566](#L566) | \_n( |
| [567](#L567) | '%d new module was activated successfully.', |
| [568](#L568) | '%d new modules was activated successfully.', |
| [569](#L569) | $activated, |
| [570](#L570) | 'ub' |
| [571](#L571) | ), |
| [572](#L572) | number\_format\_i18n( $activated ) |
| [573](#L573) | ); |
| [574](#L574) | if ( 0 < $deactivated ) { |
| [575](#L575) | $message .= ' '; |
| [576](#L576) | } |
| [577](#L577) | } |
| [578](#L578) | if ( 0 < $deactivated ) { |
| [579](#L579) | $message .= sprintf( |
| [580](#L580) | \_n( |
| [581](#L581) | '%d module was deactivated successfully.', |
| [582](#L582) | '%d modules was deactivated successfully.', |
| [583](#L583) | $deactivated, |
| [584](#L584) | 'ub' |
| [585](#L585) | ), |
| [586](#L586) | number\_format\_i18n( $deactivated ) |
| [587](#L587) | ); |
| [588](#L588) | } |
| [589](#L589) | /\*\* |
| [590](#L590) | \* Speciall message, when was nothing to do! |
| [591](#L591) | \*/ |
| [592](#L592) | if ( 0 === $activated && 0 === $deactivated ) { |
| [593](#L593) | $args             = array( |
| [594](#L594) | 'type'        => 'info', |
| [595](#L595) | 'can\_dismiss' => true, |
| [596](#L596) | 'message'     => sprintf( |
| [597](#L597) | '<q>%s</q> &mdash; <i>%s</i>', |
| [598](#L598) | esc\_html\_\_( '42: The answer to life, the universe and everything.', 'ub' ), |
| [599](#L599) | esc\_html\_\_( 'Douglas Adams', 'ub' ) |
| [600](#L600) | ), |
| [601](#L601) | ); |
| [602](#L602) | $args['message'] .= '<br >'; |
| [603](#L603) | $args['message'] .= \_\_( 'Nothing was changed, nothing to activate or deactivate.', 'ub' ); |
| [604](#L604) | wp\_send\_json\_error( $args ); |
| [605](#L605) | } |
| [606](#L606) | if ( empty( $message ) ) { |
| [607](#L607) | $args = array( |
| [608](#L608) | 'message' => $this->messages['wrong'], |
| [609](#L609) | ); |
| [610](#L610) | wp\_send\_json\_error( $args ); |
| [611](#L611) | } |
| [612](#L612) | $message = array( |
| [613](#L613) | 'type'    => 'success', |
| [614](#L614) | 'message' => $message, |
| [615](#L615) | ); |
| [616](#L616) | $this->add\_message( $message ); |
| [617](#L617) | wp\_send\_json\_success(); |
| [618](#L618) | } |
| [619](#L619) |  |
| [620](#L620) | /\*\* |
| [621](#L621) | \* Check plugins those will be used if they are active or not |
| [622](#L622) | \*/ |
| [623](#L623) | public function load\_modules() { |
| [624](#L624) | // Configuration has already been set in `Branda\_Loader` class. |
| [625](#L625) | //$this->set\_configuration(); |
| [626](#L626) | $repeat\_config = false; |
| [627](#L627) |  |
| [628](#L628) | // Load our remaining modules here |
| [629](#L629) | foreach ( $this->modules as $module => $plugin ) { |
| [630](#L630) | if ( branda\_is\_active\_module( $module ) ) { |
| [631](#L631) | if ( ! isset( $this->configuration[ $module ] ) ) { |
| [632](#L632) | continue; |
| [633](#L633) | } |
| [634](#L634) | if ( $this->should\_be\_module\_off( $this->configuration[ $module ] ) ) { |
| [635](#L635) | continue; |
| [636](#L636) | } |
| [637](#L637) | branda\_load\_single\_module( $module ); |
| [638](#L638) |  |
| [639](#L639) | if ( 'utilities/text-replacement.php' === $module ) { |
| [640](#L640) | $repeat\_config = true; |
| [641](#L641) | } |
| [642](#L642) | } |
| [643](#L643) | } |
| [644](#L644) |  |
| [645](#L645) | if ( $repeat\_config ) { |
| [646](#L646) | // We can set config again so the plugin's strings get replaced by Text Replacement module. |
| [647](#L647) | $this->set\_configuration(); |
| [648](#L648) | } |
| [649](#L649) |  |
| [650](#L650) | /\*\* |
| [651](#L651) | \* set related |
| [652](#L652) | \* |
| [653](#L653) | \* @since 2.3.0 |
| [654](#L654) | \*/ |
| [655](#L655) | $this->related = apply\_filters( 'ultimate\_branding\_related\_modules', $this->related ); |
| [656](#L656) | } |
| [657](#L657) |  |
| [658](#L658) | /\*\* |
| [659](#L659) | \* add bold |
| [660](#L660) | \* |
| [661](#L661) | \* @since 2.1.0 |
| [662](#L662) | \*/ |
| [663](#L663) | private function bold( $a ) { |
| [664](#L664) | return sprintf( '"<b>%s</b>"', $a ); |
| [665](#L665) | } |
| [666](#L666) |  |
| [667](#L667) | /\*\* |
| [668](#L668) | \* Separate logo |
| [669](#L669) | \* |
| [670](#L670) | \* @since 3.0.0 |
| [671](#L671) | \*/ |
| [672](#L672) | public function get\_u\_logo() { |
| [673](#L673) | $svg = '<svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M17.23 8.06L11.17 2H2V11.1L8.85999 17.2L17.23 8.06ZM0 0H12L20 8L9 20L0 12V0ZM3.66664 3.25281C3.91331 3.08799 4.20334 3 4.50001 3C4.89784 3 5.27938 3.15803 5.56068 3.43933C5.84199 3.72064 6.00001 4.10218 6.00001 4.5C6.00001 4.79667 5.91203 5.0867 5.7472 5.33337C5.58238 5.58005 5.34814 5.77227 5.07405 5.8858C4.79996 5.99933 4.49832 6.02907 4.20735 5.97119C3.91638 5.91331 3.64912 5.77045 3.43934 5.56067C3.22956 5.35089 3.0867 5.08364 3.02882 4.79266C2.97094 4.50169 3.00068 4.20005 3.11421 3.92596C3.22774 3.65188 3.41997 3.41763 3.66664 3.25281Z" fill="#F0F6FC"/></svg>'; |
| [674](#L674) | $icon = 'data:image/svg+xml;base64,' . base64\_encode( $svg ); |
| [675](#L675) | return $icon; // phpcs:ignore -- base64\_encode is harmless here |
| [676](#L676) | } |
| [677](#L677) |  |
| [678](#L678) | /\*\* |
| [679](#L679) | \* Add main menu |
| [680](#L680) | \* |
| [681](#L681) | \* @since 2.0.0 |
| [682](#L682) | \* |
| [683](#L683) | \* @param string $capability Capability. |
| [684](#L684) | \*/ |
| [685](#L685) | private function menu( $capability ) { |
| [686](#L686) | $parent\_menu\_title = Branda\_Helper::is\_pro() ? \_\_( 'Branda Pro', 'ub' ) : \_\_( 'Branda', 'ub' ); |
| [687](#L687) |  |
| [688](#L688) | // Add in our menu page |
| [689](#L689) | $this->top\_page\_slug = add\_menu\_page( |
| [690](#L690) | $parent\_menu\_title, |
| [691](#L691) | $parent\_menu\_title, |
| [692](#L692) | $capability, |
| [693](#L693) | 'branding', |
| [694](#L694) | array( $this, 'handle\_main\_page' ), |
| [695](#L695) | $this->get\_u\_logo() |
| [696](#L696) | ); |
| [697](#L697) | add\_action( 'admin\_init', array( $this, 'add\_action\_hooks' ) ); |
| [698](#L698) | add\_action( 'load-' . $this->top\_page\_slug, array( $this, 'add\_admin\_header\_branding' ) ); |
| [699](#L699) | $menu = add\_submenu\_page( |
| [700](#L700) | 'branding', |
| [701](#L701) | \_\_( 'Dashboard', 'ub' ), |
| [702](#L702) | \_\_( 'Dashboard', 'ub' ), |
| [703](#L703) | $capability, |
| [704](#L704) | 'branding', |
| [705](#L705) | array( $this, 'handle\_main\_page' ) |
| [706](#L706) | ); |
| [707](#L707) | add\_action( 'load-' . $menu, array( $this, 'load\_dashboard' ) ); |
| [708](#L708) | /\*\* |
| [709](#L709) | \* Sort sub menu items. |
| [710](#L710) | \*/ |
| [711](#L711) | uasort( $this->submenu, array( $this, 'sort\_sub\_menus' ) ); |
| [712](#L712) | /\*\* |
| [713](#L713) | \* Add groups submenus |
| [714](#L714) | \*/ |
| [715](#L715) | foreach ( $this->submenu as $key => $data ) { |
| [716](#L716) | $show = true; |
| [717](#L717) | if ( $this->is\_network && ! is\_network\_admin() ) { |
| [718](#L718) | $modules = $this->get\_modules\_by\_group( $key ); |
| [719](#L719) | $show    = apply\_filters( 'branda\_group\_check\_for\_subsite', false, $key, $modules ); |
| [720](#L720) | } |
| [721](#L721) | if ( ! $show ) { |
| [722](#L722) | continue; |
| [723](#L723) | } |
| [724](#L724) | $menu = add\_submenu\_page( |
| [725](#L725) | 'branding', |
| [726](#L726) | $data['title'], |
| [727](#L727) | $data['title'], |
| [728](#L728) | $capability, |
| [729](#L729) | sprintf( 'branding\_group\_%s', esc\_attr( $key ) ), |
| [730](#L730) | array( $this, 'handle\_group' ) |
| [731](#L731) | ); |
| [732](#L732) | add\_action( 'load-' . $menu, array( $this, 'add\_admin\_header\_branding' ) ); |
| [733](#L733) | } |
| [734](#L734) |  |
| [735](#L735) | if ( ! Branda\_Helper::is\_member() ) { |
| [736](#L736) | $menu = add\_submenu\_page( |
| [737](#L737) | 'branding', |
| [738](#L738) | \_\_( 'Branda Pro', 'ub' ), |
| [739](#L739) | \_\_( 'Branda Pro', 'ub' ), |
| [740](#L740) | $capability, |
| [741](#L741) | 'branda\_pro', |
| [742](#L742) | array( $this, 'handle\_branda\_pro' ) |
| [743](#L743) | ); |
| [744](#L744) | add\_action( 'load-' . $menu, array( $this, 'add\_admin\_header\_branding' ) ); |
| [745](#L745) | } |
| [746](#L746) |  |
| [747](#L747) | do\_action( 'ultimate\_branding\_add\_menu\_pages' ); |
| [748](#L748) | } |
| [749](#L749) |  |
| [750](#L750) | /\*\* |
| [751](#L751) | \* Add pages |
| [752](#L752) | \*/ |
| [753](#L753) | public function admin\_page() { |
| [754](#L754) | /\*\* |
| [755](#L755) | \* Check show? |
| [756](#L756) | \*/ |
| [757](#L757) | $show = true; |
| [758](#L758) | if ( $this->is\_network ) { |
| [759](#L759) | $show = false; |
| [760](#L760) | foreach ( $this->submenu as $key => $data ) { |
| [761](#L761) | if ( $show ) { |
| [762](#L762) | continue; |
| [763](#L763) | } |
| [764](#L764) | $modules = $this->get\_modules\_by\_group( $key ); |
| [765](#L765) | $show    = apply\_filters( 'branda\_group\_check\_for\_subsite', false, $key, $modules ); |
| [766](#L766) | } |
| [767](#L767) | } |
| [768](#L768) | if ( $show ) { |
| [769](#L769) | // Check user permissions |
| [770](#L770) | if ( ! $this->check\_user\_access() ) { |
| [771](#L771) | return; |
| [772](#L772) | } |
| [773](#L773) | $this->menu( 'read' ); |
| [774](#L774) | } |
| [775](#L775) | self::$is\_show\_admin\_menu = (bool) $show; |
| [776](#L776) | } |
| [777](#L777) |  |
| [778](#L778) | /\*\* |
| [779](#L779) | \* Add pages |
| [780](#L780) | \*/ |
| [781](#L781) | public function network\_admin\_page() { |
| [782](#L782) | if ( $this->is\_network && $this->check\_user\_access() ) { |
| [783](#L783) | $this->menu( 'read' ); |
| [784](#L784) | } |
| [785](#L785) | } |
| [786](#L786) |  |
| [787](#L787) | /\*\* |
| [788](#L788) | \* Sort admin sub menus. |
| [789](#L789) | \* |
| [790](#L790) | \* We need to make sure the main dashboard menu |
| [791](#L791) | \* gets the first priority. |
| [792](#L792) | \* |
| [793](#L793) | \* @param mixed $a |
| [794](#L794) | \* @param mixed $b |
| [795](#L795) | \* |
| [796](#L796) | \* @return int |
| [797](#L797) | \*/ |
| [798](#L798) | private function sort\_sub\_menus( $a, $b ) { |
| [799](#L799) | if ( isset( $b['menu-position'] ) && 'bottom' === $b['menu-position'] ) { |
| [800](#L800) | return -1; |
| [801](#L801) | } |
| [802](#L802) | if ( isset( $a['menu-position'] ) && 'bottom' === $a['menu-position'] ) { |
| [803](#L803) | return 1; |
| [804](#L804) | } |
| [805](#L805) | return strcasecmp( $a['title'], $b['title'] ); |
| [806](#L806) | } |
| [807](#L807) |  |
| [808](#L808) | public function activate\_module( $module ) { |
| [809](#L809) | $update  = true; |
| [810](#L810) | $modules = get\_branda\_activated\_modules(); |
| [811](#L811) | if ( |
| [812](#L812) | isset( $modules[ $module ] ) |
| [813](#L813) | ) { |
| [814](#L814) | if ( 'yes' !== $modules[ $module ] ) { |
| [815](#L815) | $update             = true; |
| [816](#L816) | $modules[ $module ] = 'yes'; |
| [817](#L817) | } |
| [818](#L818) | } else { |
| [819](#L819) | $update             = true; |
| [820](#L820) | $modules[ $module ] = 'yes'; |
| [821](#L821) | } |
| [822](#L822) | if ( $update ) { |
| [823](#L823) | $modules[ $module ] = 'yes'; |
| [824](#L824) | update\_branda\_activated\_modules( $modules ); |
| [825](#L825) | branda\_load\_single\_module( $module ); |
| [826](#L826) | do\_action( 'branda\_module\_activated', $module ); |
| [827](#L827) | return true; |
| [828](#L828) | } |
| [829](#L829) | return false; |
| [830](#L830) | } |
| [831](#L831) |  |
| [832](#L832) | public function deactivate\_module( $module ) { |
| [833](#L833) | $modules = get\_branda\_activated\_modules(); |
| [834](#L834) | if ( isset( $modules[ $module ] ) ) { |
| [835](#L835) | unset( $modules[ $module ] ); |
| [836](#L836) | update\_branda\_activated\_modules( $modules ); |
| [837](#L837) | do\_action( 'branda\_module\_deactivated', $module ); |
| [838](#L838) | return true; |
| [839](#L839) | } |
| [840](#L840) | return false; |
| [841](#L841) | } |
| [842](#L842) |  |
| [843](#L843) | public function update\_branding\_page() { |
| [844](#L844) | global $action, $page; |
| [845](#L845) | wp\_reset\_vars( array( 'action', 'page' ) ); |
| [846](#L846) | if ( isset( $\_REQUEST['action'] ) && ! empty( $\_REQUEST['action'] ) ) { |
| [847](#L847) | $t = Branda\_Helper::hyphen\_to\_underscore( $this->module ); |
| [848](#L848) | /\*\* |
| [849](#L849) | \* check |
| [850](#L850) | \*/ |
| [851](#L851) | check\_admin\_referer( 'ultimatebranding\_settings\_' . $t ); |
| [852](#L852) | $result = apply\_filters( 'ultimatebranding\_settings\_' . $t . '\_process', true ); |
| [853](#L853) | $url    = wp\_validate\_redirect( wp\_get\_raw\_referer() ); |
| [854](#L854) | if ( is\_array( $result ) ) { |
| [855](#L855) | $url = add\_query\_arg( $result, $url ); |
| [856](#L856) | } |
| [857](#L857) | wp\_safe\_redirect( $url ); |
| [858](#L858) | do\_action( 'ultimatebranding\_settings\_update\_' . $t ); |
| [859](#L859) | } |
| [860](#L860) | } |
| [861](#L861) |  |
| [862](#L862) | /\*\* |
| [863](#L863) | \* Helper to build link |
| [864](#L864) | \* |
| [865](#L865) | \* @since 3.0.0 |
| [866](#L866) | \*/ |
| [867](#L867) | private function get\_module\_link( $module ) { |
| [868](#L868) | $url  = add\_query\_arg( |
| [869](#L869) | array( |
| [870](#L870) | 'page'   => sprintf( 'branding\_group\_%s', $module['group'] ), |
| [871](#L871) | 'module' => $module['module'], |
| [872](#L872) | ), |
| [873](#L873) | is\_network\_admin() ? network\_admin\_url( 'admin.php' ) : admin\_url( 'admin.php' ) |
| [874](#L874) | ); |
| [875](#L875) | $link = sprintf( |
| [876](#L876) | '<a href="%s" class="branda-module branda-module-%s" data-group="%s">%s</a>', |
| [877](#L877) | esc\_url( $url ), |
| [878](#L878) | esc\_attr( $module['module'] ), |
| [879](#L879) | esc\_attr( $module['group'] ), |
| [880](#L880) | esc\_html( $module['name'] ) |
| [881](#L881) | ); |
| [882](#L882) | return $link; |
| [883](#L883) | } |
| [884](#L884) |  |
| [885](#L885) | /\*\* |
| [886](#L886) | \* Helper to get array of modules state. |
| [887](#L887) | \* |
| [888](#L888) | \* @since 3.0.0 |
| [889](#L889) | \* @since 3.2.0 Added $subsite param. |
| [890](#L890) | \* |
| [891](#L891) | \* @param boolean $subsite Subsite mode. |
| [892](#L892) | \* |
| [893](#L893) | \* @return array $modules Array of modules, grupped. |
| [894](#L894) | \*/ |
| [895](#L895) | public function get\_modules\_stats( $subsite = false ) { |
| [896](#L896) | $modules = array(); |
| [897](#L897) | foreach ( $this->configuration as $key => $module ) { |
| [898](#L898) | if ( ! array\_key\_exists( $key, $this->modules ) ) { |
| [899](#L899) | continue; |
| [900](#L900) | } |
| [901](#L901) | /\*\* |
| [902](#L902) | \* check for subsites |
| [903](#L903) | \*/ |
| [904](#L904) | if ( $subsite ) { |
| [905](#L905) | $show = apply\_filters( 'branda\_module\_check\_for\_subsite', false, $key, $module ); |
| [906](#L906) | if ( false === $show ) { |
| [907](#L907) | continue; |
| [908](#L908) | } |
| [909](#L909) | } |
| [910](#L910) | if ( ! isset( $modules[ $module['group'] ] ) ) { |
| [911](#L911) | $modules[ $module['group'] ] = array(); |
| [912](#L912) | } |
| [913](#L913) | $modules[ $module['group'] ]['modules'][ $key ]           = $module; |
| [914](#L914) | $modules[ $module['group'] ]['modules'][ $key ]['status'] = 'inactive'; |
| [915](#L915) | if ( branda\_is\_active\_module( $key ) ) { |
| [916](#L916) | $modules[ $module['group'] ]['modules'][ $key ]['status'] = 'active'; |
| [917](#L917) | } |
| [918](#L918) | } |
| [919](#L919) | foreach ( $modules as $group => $data ) { |
| [920](#L920) | $modules[ $group ]['modules'] = $data['modules']; |
| [921](#L921) | } |
| [922](#L922) | return $modules; |
| [923](#L923) | } |
| [924](#L924) |  |
| [925](#L925) | public function handle\_branda\_pro() { |
| [926](#L926) | add\_filter( 'branda\_show\_manage\_all\_modules\_button', '\_\_return\_false' ); |
| [927](#L927) | $classes  = apply\_filters( 'branda\_sui\_wrap\_class', array(), $this->module ); |
| [928](#L928) | $template = 'admin/branda-pro'; |
| [929](#L929) | printf( |
| [930](#L930) | '<main class="%s">', |
| [931](#L931) | esc\_attr( implode( ' ', $classes ) ) |
| [932](#L932) | ); |
| [933](#L933) | $this->render( $template ); |
| [934](#L934) |  |
| [935](#L935) | $this->footer(); |
| [936](#L936) |  |
| [937](#L937) | echo '</main>'; |
| [938](#L938) | } |
| [939](#L939) |  |
| [940](#L940) | public function handle\_main\_page() { |
| [941](#L941) | if ( $this->is\_network && ! is\_network\_admin() ) { |
| [942](#L942) | $this->handle\_main\_page\_subsite(); |
| [943](#L943) | return; |
| [944](#L944) | } |
| [945](#L945) | $this->handle\_main\_page\_global(); |
| [946](#L946) | } |
| [947](#L947) |  |
| [948](#L948) | private function handle\_main\_page\_global() { |
| [949](#L949) | $stats              = $this->stats->get\_stats(); |
| [950](#L950) | $recently\_activated = $recently\_deactivated = \_\_( 'none', 'ub' ); |
| [951](#L951) | if ( isset( $stats['activites'] ) ) { |
| [952](#L952) | if ( |
| [953](#L953) | isset( $stats['activites']['activate'] ) |
| [954](#L954) | && isset( $this->configuration[ $stats['activites']['activate'] ] ) |
| [955](#L955) | ) { |
| [956](#L956) | $recently\_activated = $this->get\_module\_link( |
| [957](#L957) | $this->configuration[ $stats['activites']['activate'] ] |
| [958](#L958) | ); |
| [959](#L959) | } |
| [960](#L960) | if ( |
| [961](#L961) | isset( $stats['activites']['deactivate'] ) |
| [962](#L962) | && isset( $this->configuration[ $stats['activites']['deactivate'] ] ) |
| [963](#L963) | ) { |
| [964](#L964) | $recently\_deactivated = $this->get\_module\_link( |
| [965](#L965) | $this->configuration[ $stats['activites']['deactivate'] ] |
| [966](#L966) | ); |
| [967](#L967) | } |
| [968](#L968) | } |
| [969](#L969) | $args = array( |
| [970](#L970) | 'stats'                          => array( |
| [971](#L971) | 'active'               => 0, |
| [972](#L972) | 'total'                => 0, |
| [973](#L973) | 'recently\_activated'   => $recently\_activated, |
| [974](#L974) | 'recently\_deactivated' => $recently\_deactivated, |
| [975](#L975) | 'frequently\_used'      => array(), |
| [976](#L976) | 'modules'              => $this->stats->get\_frequently\_used\_modules(), |
| [977](#L977) | 'raw'                  => $this->stats->get\_modules\_raw\_data(), |
| [978](#L978) | ), |
| [979](#L979) | 'show\_manage\_all\_modules\_button' => $this->show\_manage\_all\_modules\_button(), |
| [980](#L980) | 'helps'                          => $this->get\_helps\_list(), |
| [981](#L981) | ); |
| [982](#L982) | if ( $args['stats']['modules'] ) { |
| [983](#L983) | foreach ( $args['stats']['modules'] as $key => $value ) { |
| [984](#L984) | if ( ! array\_key\_exists( $key, $this->modules ) ) { |
| [985](#L985) | continue; |
| [986](#L986) | } |
| [987](#L987) | if ( isset( $this->configuration[ $key ] ) ) { |
| [988](#L988) | $args['stats']['modules'][ $key ]           = $this->configuration[ $key ]; |
| [989](#L989) | $args['stats']['modules'][ $key ]['status'] = 'inactive'; |
| [990](#L990) | if ( branda\_is\_active\_module( $key ) ) { |
| [991](#L991) | $args['stats']['modules'][ $key ]['status'] = 'active'; |
| [992](#L992) | } |
| [993](#L993) | } else { |
| [994](#L994) | unset( $args['stats']['modules'][ $key ] ); |
| [995](#L995) | } |
| [996](#L996) | } |
| [997](#L997) | } |
| [998](#L998) | /\*\* |
| [999](#L999) | \* Count |
| [1000](#L1000) | \*/ |
| [1001](#L1001) | foreach ( $this->configuration as $key => $module ) { |
| [1002](#L1002) | if ( ! array\_key\_exists( $key, $this->modules ) ) { |
| [1003](#L1003) | continue; |
| [1004](#L1004) | } |
| [1005](#L1005) | if ( branda\_is\_active\_module( $key ) ) { |
| [1006](#L1006) | if ( isset( $module['instant'] ) && $module['instant'] ) { |
| [1007](#L1007) | continue; |
| [1008](#L1008) | } |
| [1009](#L1009) | $args['stats']['active']++; |
| [1010](#L1010) | } |
| [1011](#L1011) | $args['stats']['total']++; |
| [1012](#L1012) | } |
| [1013](#L1013) | /\*\* |
| [1014](#L1014) | \* Modules Status |
| [1015](#L1015) | \*/ |
| [1016](#L1016) | $args['modules'] = $this->get\_modules\_stats(); |
| [1017](#L1017) | /\*\* |
| [1018](#L1018) | \* groups |
| [1019](#L1019) | \*/ |
| [1020](#L1020) | $args['groups'] = branda\_get\_groups\_list(); |
| [1021](#L1021) | /\*\* |
| [1022](#L1022) | \* SUI |
| [1023](#L1023) | \*/ |
| [1024](#L1024) | $args['sui']                         = array( |
| [1025](#L1025) | 'summary' => array( |
| [1026](#L1026) | 'style'   => $this->get\_box\_summary\_image\_style(), |
| [1027](#L1027) | 'classes' => array( |
| [1028](#L1028) | 'sui-box', |
| [1029](#L1029) | 'sui-summary', |
| [1030](#L1030) | ), |
| [1031](#L1031) | ), |
| [1032](#L1032) | ); |
| [1033](#L1033) | $args['sui']['summary']['classes'][] = $this->get\_hide\_branding\_class(); |
| [1034](#L1034) | /\*\* |
| [1035](#L1035) | \* render |
| [1036](#L1036) | \*/ |
| [1037](#L1037) | $classes  = apply\_filters( 'branda\_sui\_wrap\_class', array(), $this->module ); |
| [1038](#L1038) | $template = 'admin/dashboard'; |
| [1039](#L1039) | printf( |
| [1040](#L1040) | '<main class="%s">', |
| [1041](#L1041) | implode( ' ', $classes ) |
| [1042](#L1042) | ); |
| [1043](#L1043) | $this->render( $template, $args ); |
| [1044](#L1044) | if ( $this->show\_welcome\_dialog ) { |
| [1045](#L1045) | $args     = array( |
| [1046](#L1046) | 'dialog\_id' => 'branda-welcome', |
| [1047](#L1047) | 'modules'   => $args['modules'], |
| [1048](#L1048) | 'groups'    => branda\_get\_groups\_list(), |
| [1049](#L1049) | ); |
| [1050](#L1050) | $template = 'admin/dashboard/welcome'; |
| [1051](#L1051) | $this->render( $template, $args ); |
| [1052](#L1052) | } |
| [1053](#L1053) | $this->footer(); |
| [1054](#L1054) | echo '</main>'; |
| [1055](#L1055) | } |
| [1056](#L1056) |  |
| [1057](#L1057) | /\*\* |
| [1058](#L1058) | \* Dash integration |
| [1059](#L1059) | \* |
| [1060](#L1060) | \* @since 3.2.0 |
| [1061](#L1061) | \* @return string Class name |
| [1062](#L1062) | \*/ |
| [1063](#L1063) | public function get\_hide\_branding\_class() { |
| [1064](#L1064) | $class          = ''; |
| [1065](#L1065) | $hide\_branding  = apply\_filters( 'wpmudev\_branding\_hide\_branding', $this->hide\_branding ); |
| [1066](#L1066) | $branding\_image = apply\_filters( 'wpmudev\_branding\_hero\_image', null ); |
| [1067](#L1067) | if ( $hide\_branding && ! empty( $branding\_image ) ) { |
| [1068](#L1068) | $class = 'sui-rebranded'; |
| [1069](#L1069) | } elseif ( $hide\_branding && empty( $branding\_image ) ) { |
| [1070](#L1070) | $class = 'sui-unbranded'; |
| [1071](#L1071) | } |
| [1072](#L1072) |  |
| [1073](#L1073) | return $class; |
| [1074](#L1074) | } |
| [1075](#L1075) |  |
| [1076](#L1076) | /\*\* |
| [1077](#L1077) | \* Handle Dashboard for subsites. |
| [1078](#L1078) | \* |
| [1079](#L1079) | \* @since 3.2.0 |
| [1080](#L1080) | \*/ |
| [1081](#L1081) | private function handle\_main\_page\_subsite() { |
| [1082](#L1082) | $modules = $this->get\_modules\_stats( true ); |
| [1083](#L1083) | $count   = 0; |
| [1084](#L1084) | foreach ( $modules as $group ) { |
| [1085](#L1085) | if ( isset( $group['modules'] ) && is\_array( $group['modules'] ) ) { |
| [1086](#L1086) | $count += count( $group['modules'] ); |
| [1087](#L1087) | } |
| [1088](#L1088) | } |
| [1089](#L1089) | $args = array( |
| [1090](#L1090) | 'stats'                          => array( |
| [1091](#L1091) | 'active'               => $count, |
| [1092](#L1092) | 'total'                => 0, |
| [1093](#L1093) | 'recently\_activated'   => '', |
| [1094](#L1094) | 'recently\_deactivated' => '', |
| [1095](#L1095) | 'frequently\_used'      => array(), |
| [1096](#L1096) | 'modules'              => $this->stats->get\_frequently\_used\_modules( 'subsite' ), |
| [1097](#L1097) | 'raw'                  => $this->stats->get\_modules\_raw\_data(), |
| [1098](#L1098) | ), |
| [1099](#L1099) | 'show\_manage\_all\_modules\_button' => $this->show\_manage\_all\_modules\_button(), |
| [1100](#L1100) | 'helps'                          => $this->get\_helps\_list(), |
| [1101](#L1101) | 'groups'                         => branda\_get\_groups\_list(), |
| [1102](#L1102) | 'modules'                        => $modules, |
| [1103](#L1103) | 'message'                        => apply\_filters( |
| [1104](#L1104) | 'branda\_subsites\_dashboard\_message', |
| [1105](#L1105) | array( |
| [1106](#L1106) | 'url'  => $this->get\_network\_permissions\_url(), |
| [1107](#L1107) | 'show' => true, |
| [1108](#L1108) | ) |
| [1109](#L1109) | ), |
| [1110](#L1110) | ); |
| [1111](#L1111) | if ( $args['stats']['modules'] ) { |
| [1112](#L1112) | foreach ( $args['stats']['modules'] as $key => $value ) { |
| [1113](#L1113) | if ( ! array\_key\_exists( $key, $this->modules ) ) { |
| [1114](#L1114) | continue; |
| [1115](#L1115) | } |
| [1116](#L1116) | if ( isset( $this->configuration[ $key ] ) ) { |
| [1117](#L1117) | $args['stats']['modules'][ $key ]           = $this->configuration[ $key ]; |
| [1118](#L1118) | $args['stats']['modules'][ $key ]['status'] = 'inactive'; |
| [1119](#L1119) | if ( branda\_is\_active\_module( $key ) ) { |
| [1120](#L1120) | $args['stats']['modules'][ $key ]['status'] = 'active'; |
| [1121](#L1121) | } |
| [1122](#L1122) | } else { |
| [1123](#L1123) | unset( $args['stats']['modules'][ $key ] ); |
| [1124](#L1124) | } |
| [1125](#L1125) | } |
| [1126](#L1126) | } |
| [1127](#L1127) | /\*\* |
| [1128](#L1128) | \* render |
| [1129](#L1129) | \*/ |
| [1130](#L1130) | $classes  = apply\_filters( 'branda\_sui\_wrap\_class', array(), $this->module ); |
| [1131](#L1131) | $template = 'admin/dashboard/subsite'; |
| [1132](#L1132) | printf( |
| [1133](#L1133) | '<main class="%s">', |
| [1134](#L1134) | implode( ' ', $classes ) |
| [1135](#L1135) | ); |
| [1136](#L1136) | $this->render( $template, $args ); |
| [1137](#L1137) | $this->footer(); |
| [1138](#L1138) | echo '</main>'; |
| [1139](#L1139) | } |
| [1140](#L1140) |  |
| [1141](#L1141) | /\*\* |
| [1142](#L1142) | \* Show group page |
| [1143](#L1143) | \* |
| [1144](#L1144) | \* @since 3.0.0 |
| [1145](#L1145) | \*/ |
| [1146](#L1146) | public function handle\_group() { |
| [1147](#L1147) | $classes = array( |
| [1148](#L1148) | sprintf( 'sui-wrap-branda-module-%s', $this->module ), |
| [1149](#L1149) | ); |
| [1150](#L1150) | $classes = apply\_filters( 'branda\_sui\_wrap\_class', $classes, $this->module ); |
| [1151](#L1151) | printf( '<main class="%s">', implode( ' ', $classes ) ); |
| [1152](#L1152) | $content = apply\_filters( 'branda\_handle\_group\_page', '', $this->module ); |
| [1153](#L1153) | if ( ! empty( $content ) ) { |
| [1154](#L1154) | echo $content; |
| [1155](#L1155) | } else { |
| [1156](#L1156) | /\*\* |
| [1157](#L1157) | \* Common header |
| [1158](#L1158) | \*/ |
| [1159](#L1159) | $args = array( |
| [1160](#L1160) | 'title'                          => $this->get\_current\_group\_title(), |
| [1161](#L1161) | 'show\_manage\_all\_modules\_button' => $this->show\_manage\_all\_modules\_button(), |
| [1162](#L1162) | 'documentation\_chapter'          => $this->get\_current\_group\_documentation\_chapter(), |
| [1163](#L1163) | 'helps'                          => $this->get\_helps\_list(), |
| [1164](#L1164) | ); |
| [1165](#L1165) | $this->render( 'admin/common/header', $args ); |
| [1166](#L1166) | /\*\* |
| [1167](#L1167) | \* Content |
| [1168](#L1168) | \*/ |
| [1169](#L1169) | echo '<div class="sui-row-with-sidenav">'; |
| [1170](#L1170) | echo '<div class="sui-sidenav">'; |
| [1171](#L1171) | $this->group\_tabs( 'menu' ); |
| [1172](#L1172) | echo '</div>'; // sui-sidenav |
| [1173](#L1173) | $this->group\_tabs( 'content' ); |
| [1174](#L1174) | echo '</div>'; // sui-row-with-sidenav |
| [1175](#L1175) | } |
| [1176](#L1176) | $this->footer(); |
| [1177](#L1177) | echo '</main>'; |
| [1178](#L1178) | } |
| [1179](#L1179) |  |
| [1180](#L1180) | /\*\* |
| [1181](#L1181) | \* Helper to show group |
| [1182](#L1182) | \* |
| [1183](#L1183) | \* @since 3.0.0 |
| [1184](#L1184) | \*/ |
| [1185](#L1185) | private function group\_tabs( $type ) { |
| [1186](#L1186) | $modules = $this->get\_modules\_by\_group( null, true ); |
| [1187](#L1187) | if ( is\_wp\_error( $modules ) ) { |
| [1188](#L1188) | if ( 'content' === $type ) { |
| [1189](#L1189) | $error\_string = $modules->get\_error\_message(); |
| [1190](#L1190) | echo '<div class="error"><p>' . $error\_string . '</p></div>'; |
| [1191](#L1191) | } |
| [1192](#L1192) | return; |
| [1193](#L1193) | } |
| [1194](#L1194) | /\*\* |
| [1195](#L1195) | \* Get current module or set first |
| [1196](#L1196) | \*/ |
| [1197](#L1197) | $current = $modules[ key( $modules ) ]['module']; |
| [1198](#L1198) | if ( ! empty( $this->module ) ) { |
| [1199](#L1199) | $current = $this->module; |
| [1200](#L1200) | } |
| [1201](#L1201) | $content = ''; |
| [1202](#L1202) | switch ( $type ) { |
| [1203](#L1203) | case 'menu': |
| [1204](#L1204) | $content = $this->group\_tabs\_menu( $modules, $current ); |
| [1205](#L1205) | break; |
| [1206](#L1206) | case 'content': |
| [1207](#L1207) | $content = $this->group\_tabs\_content( $modules, $current ); |
| [1208](#L1208) | break; |
| [1209](#L1209) | default: |
| [1210](#L1210) | break; |
| [1211](#L1211) | } |
| [1212](#L1212) | echo $content; |
| [1213](#L1213) | } |
| [1214](#L1214) |  |
| [1215](#L1215) | private function group\_tabs\_menu( $modules, $current ) { |
| [1216](#L1216) | $tabs   = ''; |
| [1217](#L1217) | $select = ''; |
| [1218](#L1218) | foreach ( $modules as $id => $module ) { |
| [1219](#L1219) | $slug  = $module['module']; |
| [1220](#L1220) | $title = $module['name']; |
| [1221](#L1221) | if ( isset( $module['title'] ) ) { |
| [1222](#L1222) | $title = $module['title']; |
| [1223](#L1223) | } |
| [1224](#L1224) | if ( isset( $module['menu\_title'] ) ) { |
| [1225](#L1225) | $title = $module['menu\_title']; |
| [1226](#L1226) | } |
| [1227](#L1227) | if ( ! empty( $module['only\_pro'] ) ) { |
| [1228](#L1228) | $icon = Branda\_Helper::maybe\_pro\_tag(); |
| [1229](#L1229) | } else { |
| [1230](#L1230) | unset( $icon ); |
| [1231](#L1231) | } |
| [1232](#L1232) | /\*\* |
| [1233](#L1233) | \* Active? |
| [1234](#L1234) | \*/ |
| [1235](#L1235) | if ( empty( $icon ) ) { |
| [1236](#L1236) | $icon = branda\_is\_active\_module( $id ) ? '<i class="sui-icon-check-tick"></i>' : ''; |
| [1237](#L1237) | } |
| [1238](#L1238) |  |
| [1239](#L1239) | if ( isset( $module['instant'] ) && 'on' === $module['instant'] ) { |
| [1240](#L1240) | $icon = ''; |
| [1241](#L1241) | } |
| [1242](#L1242) | $tabs   .= sprintf( |
| [1243](#L1243) | '<li class="sui-vertical-tab %s"><a href="#" data-tab="%s">%s%s</a></li>', |
| [1244](#L1244) | esc\_attr( $current === $slug ? 'current' : '' ), |
| [1245](#L1245) | sanitize\_title( $slug ), |
| [1246](#L1246) | esc\_html( $title ), |
| [1247](#L1247) | $icon |
| [1248](#L1248) | ); |
| [1249](#L1249) | $select .= sprintf( |
| [1250](#L1250) | '<option %s value="%s">%s</option>', |
| [1251](#L1251) | esc\_attr( $current === $slug ? 'selected="selected' : '' ), |
| [1252](#L1252) | sanitize\_title( $slug ), |
| [1253](#L1253) | esc\_html( $title ) |
| [1254](#L1254) | ); |
| [1255](#L1255) | } |
| [1256](#L1256) | $content  = '<ul class="sui-vertical-tabs sui-sidenav-hide-md">'; |
| [1257](#L1257) | $content .= $tabs; |
| [1258](#L1258) | $content .= '</ul>'; |
| [1259](#L1259) | $content .= '<div class="sui-sidenav-hide-lg">'; |
| [1260](#L1260) | $content .= '<select class="sui-mobile-nav" id="branda-mobile-nav" style="display: none;">'; |
| [1261](#L1261) | $content .= $select; |
| [1262](#L1262) | $content .= '</select>'; |
| [1263](#L1263) | $content .= '</div>'; |
| [1264](#L1264) | return $content; |
| [1265](#L1265) | } |
| [1266](#L1266) |  |
| [1267](#L1267) | private function group\_tabs\_content( $modules, $current ) { |
| [1268](#L1268) | $content               = ''; |
| [1269](#L1269) | $some\_module\_is\_active = false; |
| [1270](#L1270) | $show\_deactivate       = true; |
| [1271](#L1271) | if ( $this->is\_network && ! $this->is\_network\_admin ) { |
| [1272](#L1272) | $show\_deactivate = false; |
| [1273](#L1273) | }; |
| [1274](#L1274) | foreach ( $modules as $id => $module ) { |
| [1275](#L1275) | $slug      = $module['module']; |
| [1276](#L1276) | $is\_active = branda\_is\_active\_module( $module['key'] ); |
| [1277](#L1277) | /\*\* |
| [1278](#L1278) | \* Hide options if subsites configuration |
| [1279](#L1279) | \*/ |
| [1280](#L1280) | $has\_susbsite\_configuration = false; |
| [1281](#L1281) | if ( $this->is\_network && $this->is\_network\_admin ) { |
| [1282](#L1282) | $subsite = apply\_filters( 'branda\_module\_check\_for\_subsite', false, $id, $module ); |
| [1283](#L1283) | if ( $subsite ) { |
| [1284](#L1284) | $has\_susbsite\_configuration = true; |
| [1285](#L1285) | } |
| [1286](#L1286) | } |
| [1287](#L1287) | $module\_name = Branda\_Helper::hyphen\_to\_underscore( $module['module'] ); |
| [1288](#L1288) | $action      = 'ultimatebranding\_settings\_' . $module\_name; |
| [1289](#L1289) | /\*\* |
| [1290](#L1290) | \* Module header |
| [1291](#L1291) | \* |
| [1292](#L1292) | \* hide for instant active modules |
| [1293](#L1293) | \*/ |
| [1294](#L1294) | $show\_module\_header = true; |
| [1295](#L1295) | if ( isset( $module['instant'] ) && 'on' === $module['instant'] ) { |
| [1296](#L1296) | $show\_module\_header = false; |
| [1297](#L1297) | } |
| [1298](#L1298) | if ( $show\_module\_header ) { |
| [1299](#L1299) | $classes = array( |
| [1300](#L1300) | 'sui-box', |
| [1301](#L1301) | 'branda-settings-tab', |
| [1302](#L1302) | sprintf( 'branda-settings-tab-%s', sanitize\_title( $slug ) ), |
| [1303](#L1303) | sprintf( 'branda-settings-tab-title-%s', sanitize\_title( $slug ) ), |
| [1304](#L1304) | 'branda-settings-tab-title', |
| [1305](#L1305) | ); |
| [1306](#L1306) | $buttons = ''; |
| [1307](#L1307) | if ( $is\_active ) { |
| [1308](#L1308) | $template  = 'admin/common/modules/header'; |
| [1309](#L1309) | $classes[] = 'sui-box-sticky'; |
| [1310](#L1310) | /\*\* |
| [1311](#L1311) | \* deactivate button |
| [1312](#L1312) | \*/ |
| [1313](#L1313) | if ( |
| [1314](#L1314) | $show\_deactivate |
| [1315](#L1315) | && ( |
| [1316](#L1316) | ! isset( $module['instant'] ) || 'on' !== $module['instant'] |
| [1317](#L1317) | ) |
| [1318](#L1318) | ) { |
| [1319](#L1319) | $args     = array( |
| [1320](#L1320) | 'data'  => array( |
| [1321](#L1321) | 'nonce' => wp\_create\_nonce( $slug ), |
| [1322](#L1322) | 'slug'  => $slug, |
| [1323](#L1323) | ), |
| [1324](#L1324) | 'class' => 'ub-deactivate-module', |
| [1325](#L1325) | 'text'  => \_\_( 'Deactivate', 'ub' ), |
| [1326](#L1326) | 'sui'   => 'ghost', |
| [1327](#L1327) | ); |
| [1328](#L1328) | $buttons .= $this->button( $args ); |
| [1329](#L1329) | } |
| [1330](#L1330) | /\*\* |
| [1331](#L1331) | \* submit button |
| [1332](#L1332) | \*/ |
| [1333](#L1333) | $filter = $action . '\_process'; |
| [1334](#L1334) | if ( |
| [1335](#L1335) | has\_filter( $filter ) |
| [1336](#L1336) | && apply\_filters( 'ultimatebranding\_settings\_panel\_show\_submit', true, $module ) |
| [1337](#L1337) | ) { |
| [1338](#L1338) | $args     = array( |
| [1339](#L1339) | 'text'  => \_\_( 'Save Changes', 'ub' ), |
| [1340](#L1340) | 'sui'   => 'blue', |
| [1341](#L1341) | 'icon'  => 'save', |
| [1342](#L1342) | 'class' => 'branda-module-save', |
| [1343](#L1343) | ); |
| [1344](#L1344) | $buttons .= $this->button( $args ); |
| [1345](#L1345) | } |
| [1346](#L1346) | } else { |
| [1347](#L1347) | $template = '/admin/modules/' . $module['module'] . '/module-inactive'; |
| [1348](#L1348) | if ( ! self::get\_template\_file\_name( $template ) ) { |
| [1349](#L1349) | // If module custom template doesn't exist - use common one. |
| [1350](#L1350) | $template = 'admin/common/module-inactive'; |
| [1351](#L1351) | } |
| [1352](#L1352) | /\*\* |
| [1353](#L1353) | \* activate button |
| [1354](#L1354) | \*/ |
| [1355](#L1355) | $args    = array( |
| [1356](#L1356) | 'data'  => array( |
| [1357](#L1357) | 'nonce' => wp\_create\_nonce( $slug ), |
| [1358](#L1358) | 'slug'  => $slug, |
| [1359](#L1359) | ), |
| [1360](#L1360) | 'class' => 'ub-activate-module', |
| [1361](#L1361) | 'sui'   => 'blue', |
| [1362](#L1362) | 'text'  => \_\_( 'Activate', 'ub' ), |
| [1363](#L1363) | ); |
| [1364](#L1364) | $buttons = $this->button( $args ); |
| [1365](#L1365) | } |
| [1366](#L1366) | $status\_indicator = isset( $module['status-indicator'] ) ? $module['status-indicator'] : 'show'; |
| [1367](#L1367) | $args             = array( |
| [1368](#L1368) | 'box\_title'                  => isset( $module['name\_alt'] ) ? $module['name\_alt'] : $module['name'], |
| [1369](#L1369) | 'classes'                    => $classes, |
| [1370](#L1370) | 'module'                     => $module, |
| [1371](#L1371) | 'copy\_button'                => $this->get\_copy\_button( $module ), |
| [1372](#L1372) | 'buttons'                    => $buttons, |
| [1373](#L1373) | 'slug'                       => $slug, |
| [1374](#L1374) | 'current'                    => $current, |
| [1375](#L1375) | 'status\_indicator'           => $status\_indicator, |
| [1376](#L1376) | 'has\_susbsite\_configuration' => $has\_susbsite\_configuration, |
| [1377](#L1377) | ); |
| [1378](#L1378) | $content         .= $this->render( $template, $args, true ); |
| [1379](#L1379) | } |
| [1380](#L1380) | /\*\* |
| [1381](#L1381) | \* body |
| [1382](#L1382) | \*/ |
| [1383](#L1383) | if ( $is\_active ) { |
| [1384](#L1384) | $classes  = array( |
| [1385](#L1385) | 'sui-box', |
| [1386](#L1386) | 'branda-settings-tab', |
| [1387](#L1387) | sprintf( 'branda-settings-tab-%s', sanitize\_title( $slug ) ), |
| [1388](#L1388) | 'branda-settings-tab-content', |
| [1389](#L1389) | sprintf( 'branda-settings-tab-content-%s', sanitize\_title( $slug ) ), |
| [1390](#L1390) | ); |
| [1391](#L1391) | $classes  = apply\_filters( 'branda\_settings\_tab\_content\_classes', $classes, $module ); |
| [1392](#L1392) | $content .= sprintf( |
| [1393](#L1393) | '<div class="%s" data-tab="%s"%s>', |
| [1394](#L1394) | esc\_attr( implode( ' ', $classes ) ), |
| [1395](#L1395) | esc\_attr( sanitize\_title( $slug ) ), |
| [1396](#L1396) | $current === $slug ? '' : ' style="display: none;"' |
| [1397](#L1397) | ); |
| [1398](#L1398) | /\*\* |
| [1399](#L1399) | \* Show module content |
| [1400](#L1400) | \*/ |
| [1401](#L1401) | $show\_module\_content = true; |
| [1402](#L1402) | if ( $has\_susbsite\_configuration ) { |
| [1403](#L1403) | $show\_module\_content = false; |
| [1404](#L1404) | } |
| [1405](#L1405) | if ( ! $show\_module\_content ) { |
| [1406](#L1406) | $show\_message = true; |
| [1407](#L1407) | if ( |
| [1408](#L1408) | isset( $module['allow-override-message'] ) |
| [1409](#L1409) | && 'hide' === $module['allow-override-message'] |
| [1410](#L1410) | ) { |
| [1411](#L1411) | $show\_message = false; |
| [1412](#L1412) | } |
| [1413](#L1413) | if ( $show\_message ) { |
| [1414](#L1414) | $template = 'admin/common/modules/subsite-configuration'; |
| [1415](#L1415) | $args     = array( |
| [1416](#L1416) | 'url' => $this->get\_network\_permissions\_url(), |
| [1417](#L1417) | ); |
| [1418](#L1418) | $content .= $this->render( $template, $args, true ); |
| [1419](#L1419) | } |
| [1420](#L1420) | } |
| [1421](#L1421) | $module\_content = $this->get\_module\_content( $module ); |
| [1422](#L1422) | if ( is\_wp\_error( $module\_content ) ) { |
| [1423](#L1423) | $content .= '<div class="sui-box-body">'; |
| [1424](#L1424) | $content .= Branda\_Helper::sui\_notice( $module\_content->get\_error\_message() ); |
| [1425](#L1425) | $content .= '</div>'; // sui-box-body |
| [1426](#L1426) | } else { |
| [1427](#L1427) | $content .= $module\_content; |
| [1428](#L1428) | } |
| [1429](#L1429) | $content .= '</div>'; // sui-box |
| [1430](#L1430) | } |
| [1431](#L1431) | if ( $current === $slug ) { |
| [1432](#L1432) | $some\_module\_is\_active = true; |
| [1433](#L1433) | } |
| [1434](#L1434) | } |
| [1435](#L1435) | if ( ! $some\_module\_is\_active ) { |
| [1436](#L1436) | $template = 'admin/common/no-module'; |
| [1437](#L1437) | $content .= $this->render( $template, array(), true ); |
| [1438](#L1438) | } |
| [1439](#L1439) | return "<div>{$content}</div>"; |
| [1440](#L1440) | } |
| [1441](#L1441) |  |
| [1442](#L1442) | /\*\* |
| [1443](#L1443) | \* Show New feature dialog if it's available to show |
| [1444](#L1444) | \* |
| [1445](#L1445) | \* @return null |
| [1446](#L1446) | \*/ |
| [1447](#L1447) | private function maybe\_show\_new\_feature\_dialog() { |
| [1448](#L1448) | if ( ! Branda\_Helper::is\_full\_pro() ) { |
| [1449](#L1449) | return; |
| [1450](#L1450) | } |
| [1451](#L1451) |  |
| [1452](#L1452) | $major\_minor\_version = $this->get\_major\_minor\_version(); |
| [1453](#L1453) | if ( $this->to\_major\_minor( $this->get\_first\_installed\_version() ) === $major\_minor\_version ) { |
| [1454](#L1454) | // Only need to show after an upgrade, not fresh installation |
| [1455](#L1455) | return; |
| [1456](#L1456) | } |
| [1457](#L1457) |  |
| [1458](#L1458) | $meta\_key = 'branda\_hide\_new\_features'; |
| [1459](#L1459) |  |
| [1460](#L1460) | $dismissed\_dialog\_version = get\_user\_meta( get\_current\_user\_id(), $meta\_key, true ); |
| [1461](#L1461) |  |
| [1462](#L1462) | if ( version\_compare( $major\_minor\_version, $dismissed\_dialog\_version, '<=' ) ) { |
| [1463](#L1463) | return; |
| [1464](#L1464) | } |
| [1465](#L1465) |  |
| [1466](#L1466) | $template\_suffix = str\_replace( '.', '', $major\_minor\_version ); |
| [1467](#L1467) | $template        = 'admin/common/dialogs/show-new-features-' . $template\_suffix; |
| [1468](#L1468) | $this->render( $template, array() ); |
| [1469](#L1469) | } |
| [1470](#L1470) |  |
| [1471](#L1471) | /\*\* |
| [1472](#L1472) | \* Add notice template and footer "In love by WPMU DEV". |
| [1473](#L1473) | \* |
| [1474](#L1474) | \* @since 3.0.0 |
| [1475](#L1475) | \*/ |
| [1476](#L1476) | private function footer() { |
| [1477](#L1477) | $show = $this->show\_manage\_all\_modules\_button(); |
| [1478](#L1478) | if ( $show ) { |
| [1479](#L1479) | /\*\* |
| [1480](#L1480) | \* Modules Status & Manage All Modules |
| [1481](#L1481) | \*/ |
| [1482](#L1482) | $args     = array( |
| [1483](#L1483) | 'modules' => $this->get\_modules\_stats(), |
| [1484](#L1484) | 'groups'  => branda\_get\_groups\_list(), |
| [1485](#L1485) | ); |
| [1486](#L1486) | $template = 'admin/common/dialogs/manage-all-modules'; |
| [1487](#L1487) | $this->render( $template, $args ); |
| [1488](#L1488) | } |
| [1489](#L1489) |  |
| [1490](#L1490) | $this->maybe\_show\_new\_feature\_dialog(); |
| [1491](#L1491) |  |
| [1492](#L1492) | $hide\_footer = false; |
| [1493](#L1493) | $footer\_text = sprintf( \_\_( 'Made with %s by WPMU DEV', 'ub' ), ' <i class="sui-icon-heart"></i>' ); |
| [1494](#L1494) | if ( Branda\_Helper::is\_member() ) { |
| [1495](#L1495) | $hide\_footer = apply\_filters( 'wpmudev\_branding\_change\_footer', $hide\_footer ); |
| [1496](#L1496) | $footer\_text = apply\_filters( 'wpmudev\_branding\_footer\_text', $footer\_text ); |
| [1497](#L1497) | $hide\_footer = apply\_filters( 'branda\_change\_footer', $hide\_footer, $this->module ); |
| [1498](#L1498) | $footer\_text = apply\_filters( 'branda\_footer\_text', $footer\_text, $this->module ); |
| [1499](#L1499) | } |
| [1500](#L1500) | $args     = array( |
| [1501](#L1501) | 'hide\_footer' => $hide\_footer, |
| [1502](#L1502) | 'footer\_text' => $footer\_text, |
| [1503](#L1503) | ); |
| [1504](#L1504) | $template = 'admin/common/footer'; |
| [1505](#L1505) | $this->render( $template, $args ); |
| [1506](#L1506) | do\_action( 'branda\_ubadmin\_footer', $this->module ); |
| [1507](#L1507) | } |
| [1508](#L1508) |  |
| [1509](#L1509) | /\*\* |
| [1510](#L1510) | \* Print button save. |
| [1511](#L1511) | \* |
| [1512](#L1512) | \* @since 1.8.4 |
| [1513](#L1513) | \* @since 3.0.0 returns value instead of print. |
| [1514](#L1514) | \*/ |
| [1515](#L1515) | public function button\_save() { |
| [1516](#L1516) | $content = sprintf( |
| [1517](#L1517) | '<p class="submit"><input type="submit" name="submit" class="button-primary" value="%s" /></p>', |
| [1518](#L1518) | esc\_attr\_\_( 'Save Changes', 'ub' ) |
| [1519](#L1519) | ); |
| [1520](#L1520) | return $content; |
| [1521](#L1521) | } |
| [1522](#L1522) |  |
| [1523](#L1523) | /\*\* |
| [1524](#L1524) | \* Should I show menu in admin subsites? |
| [1525](#L1525) | \* |
| [1526](#L1526) | \* @since 1.8.6 |
| [1527](#L1527) | \*/ |
| [1528](#L1528) | private function check\_show\_in\_subsites() { |
| [1529](#L1529) | if ( is\_multisite() && is\_network\_admin() ) { |
| [1530](#L1530) | return true; |
| [1531](#L1531) | } |
| [1532](#L1532) | $modules = get\_branda\_activated\_modules(); |
| [1533](#L1533) | if ( empty( $modules ) ) { |
| [1534](#L1534) | return false; |
| [1535](#L1535) | } |
| [1536](#L1536) | foreach ( $modules as $module => $state ) { |
| [1537](#L1537) | if ( 'yes' != $state ) { |
| [1538](#L1538) | continue; |
| [1539](#L1539) | } |
| [1540](#L1540) | if ( isset( $this->configuration[ $module ] ) ) { |
| [1541](#L1541) | $state = apply\_filters( 'branda\_module\_check\_for\_subsite', false, $module, $this->configuration[ $module ] ); |
| [1542](#L1542) | if ( $state ) { |
| [1543](#L1543) | return $state; |
| [1544](#L1544) | } |
| [1545](#L1545) | } |
| [1546](#L1546) | } |
| [1547](#L1547) | return false; |
| [1548](#L1548) | } |
| [1549](#L1549) |  |
| [1550](#L1550) | /\*\* |
| [1551](#L1551) | \* Get module by group. |
| [1552](#L1552) | \* |
| [1553](#L1553) | \* @since 3.0.0 |
| [1554](#L1554) | \* @since 3.1.0 |
| [1555](#L1555) | \* |
| [1556](#L1556) | \* @param string $group group. |
| [1557](#L1557) | \*/ |
| [1558](#L1558) | public function get\_modules\_by\_group( $group = null, $filter = false ) { |
| [1559](#L1559) | global $branda\_network; |
| [1560](#L1560) | if ( null === $group ) { |
| [1561](#L1561) | $group = $this->group; |
| [1562](#L1562) | } |
| [1563](#L1563) | $modules = array(); |
| [1564](#L1564) | foreach ( $this->configuration as $key => $module ) { |
| [1565](#L1565) | if ( ! array\_key\_exists( $key, $this->modules ) ) { |
| [1566](#L1566) | continue; |
| [1567](#L1567) | } |
| [1568](#L1568) | if ( ! isset( $module['group'] ) ) { |
| [1569](#L1569) | continue; |
| [1570](#L1570) | } |
| [1571](#L1571) | if ( $group == $module['group'] ) { |
| [1572](#L1572) | $modules[ $key ] = $module; |
| [1573](#L1573) | } |
| [1574](#L1574) | } |
| [1575](#L1575) | /\*\* |
| [1576](#L1576) | \* Filter |
| [1577](#L1577) | \*/ |
| [1578](#L1578) | if ( $branda\_network && $filter ) { |
| [1579](#L1579) | $is\_network\_admin = is\_network\_admin(); |
| [1580](#L1580) | if ( ! $is\_network\_admin ) { |
| [1581](#L1581) | $m = array(); |
| [1582](#L1582) | foreach ( $modules as $key => $module ) { |
| [1583](#L1583) | $show = apply\_filters( 'branda\_module\_check\_for\_subsite', false, $key, $module ); |
| [1584](#L1584) | if ( $show ) { |
| [1585](#L1585) | $m[ $key ] = $module; |
| [1586](#L1586) | } |
| [1587](#L1587) | } |
| [1588](#L1588) | $modules = $m; |
| [1589](#L1589) | } |
| [1590](#L1590) | } |
| [1591](#L1591) | if ( empty( $modules ) ) { |
| [1592](#L1592) | return new WP\_Error( 'error', \_\_( 'There is no modules in selected group!', 'ub' ) ); |
| [1593](#L1593) | } |
| [1594](#L1594) |  |
| [1595](#L1595) | return $modules; |
| [1596](#L1596) | } |
| [1597](#L1597) |  |
| [1598](#L1598) | /\*\* |
| [1599](#L1599) | \* get nonced url |
| [1600](#L1600) | \* |
| [1601](#L1601) | \* @since 1.8.8 |
| [1602](#L1602) | \*/ |
| [1603](#L1603) | private function get\_nonce\_url( $module ) { |
| [1604](#L1604) | $page         = $this->get\_current\_page(); |
| [1605](#L1605) | $is\_active    = branda\_is\_active\_module( $module ); |
| [1606](#L1606) | $url          = add\_query\_arg( |
| [1607](#L1607) | array( |
| [1608](#L1608) | 'page'   => $page, |
| [1609](#L1609) | 'action' => $is\_active ? 'disable' : 'enable', |
| [1610](#L1610) | 'module' => $module, |
| [1611](#L1611) | ), |
| [1612](#L1612) | is\_network\_admin() ? network\_admin\_url( 'admin.php' ) : admin\_url( 'admin.php' ) |
| [1613](#L1613) | ); |
| [1614](#L1614) | $nonce\_action = sprintf( '%s-module-%s', $is\_active ? 'disable' : 'enable', $module ); |
| [1615](#L1615) | $url          = wp\_nonce\_url( $url, $nonce\_action ); |
| [1616](#L1616) | return $url; |
| [1617](#L1617) | } |
| [1618](#L1618) |  |
| [1619](#L1619) | /\*\* |
| [1620](#L1620) | \* Get base url |
| [1621](#L1621) | \* |
| [1622](#L1622) | \* @since 1.8.8 |
| [1623](#L1623) | \*/ |
| [1624](#L1624) | private function get\_base\_url() { |
| [1625](#L1625) | if ( empty( $this->base\_url ) ) { |
| [1626](#L1626) | $page           = $this->get\_current\_page(); |
| [1627](#L1627) | $this->base\_url = add\_query\_arg( |
| [1628](#L1628) | array( |
| [1629](#L1629) | 'page' => $page, |
| [1630](#L1630) | ), |
| [1631](#L1631) | is\_network\_admin() ? network\_admin\_url( 'admin.php' ) : admin\_url( 'admin.php' ) |
| [1632](#L1632) | ); |
| [1633](#L1633) | } |
| [1634](#L1634) | return $this->base\_url; |
| [1635](#L1635) | } |
| [1636](#L1636) |  |
| [1637](#L1637) | /\*\* |
| [1638](#L1638) | \* sanitize variables |
| [1639](#L1639) | \* |
| [1640](#L1640) | \* @since 3.0.0 |
| [1641](#L1641) | \*/ |
| [1642](#L1642) | public function set\_and\_sanitize\_variables() { |
| [1643](#L1643) | $this->load\_permissions(); |
| [1644](#L1644) |  |
| [1645](#L1645) | $this->module = ''; |
| [1646](#L1646) | if ( |
| [1647](#L1647) | isset( $\_REQUEST['page'] ) |
| [1648](#L1648) | && preg\_match( '/branding\_group\_(.+)$/', $\_REQUEST['page'], $matches ) |
| [1649](#L1649) | ) { |
| [1650](#L1650) | if ( array\_key\_exists( $matches[1], $this->submenu ) ) { |
| [1651](#L1651) | $this->group = $matches[1]; |
| [1652](#L1652) | } |
| [1653](#L1653) | } |
| [1654](#L1654) | if ( 'dashboard' === $this->group ) { |
| [1655](#L1655) | return; |
| [1656](#L1656) | } |
| [1657](#L1657) | /\*\* |
| [1658](#L1658) | \* module |
| [1659](#L1659) | \*/ |
| [1660](#L1660) | //$input\_module = filter\_input( INPUT\_POST, 'module', FILTER\_SANITIZE\_STRING ); |
| [1661](#L1661) | $input\_module  = ! empty( $\_POST['module'] ) ? sanitize\_text\_field( $\_POST['module'] ) : null; |
| [1662](#L1662) |  |
| [1663](#L1663) | if ( empty( $input\_module ) ) { |
| [1664](#L1664) | //$input\_module = filter\_input( INPUT\_GET, 'module', FILTER\_SANITIZE\_STRING ); |
| [1665](#L1665) | $input\_module = ! empty( $\_GET[ 'module' ] ) ? sanitize\_text\_field( $\_GET[ 'module' ] ) : null; |
| [1666](#L1666) | } |
| [1667](#L1667) |  |
| [1668](#L1668) | $is\_empty = empty( $input\_module ); |
| [1669](#L1669) | if ( ! $is\_empty ) { |
| [1670](#L1670) | if ( 'dashboard' !== $input\_module ) { |
| [1671](#L1671) | foreach ( $this->configuration as $module ) { |
| [1672](#L1672) | if ( isset( $module['module'] ) && $input\_module === $module['module'] ) { |
| [1673](#L1673) | $this->module = $module['module']; |
| [1674](#L1674) | return; |
| [1675](#L1675) | } |
| [1676](#L1676) | } |
| [1677](#L1677) | } |
| [1678](#L1678) | } |
| [1679](#L1679) | /\*\* |
| [1680](#L1680) | \* module is not requested! |
| [1681](#L1681) | \*/ |
| [1682](#L1682) | $modules = $this->get\_modules\_by\_group( null, true ); |
| [1683](#L1683) | if ( is\_wp\_error( $modules ) ) { |
| [1684](#L1684) | return; |
| [1685](#L1685) | } |
| [1686](#L1686) | /\*\* |
| [1687](#L1687) | \* try to find active one first |
| [1688](#L1688) | \*/ |
| [1689](#L1689) | $mods = $modules; |
| [1690](#L1690) | while ( empty( $this->module ) && $module = array\_shift( $mods ) ) { |
| [1691](#L1691) | $is\_active = branda\_is\_active\_module( $module['key'] ); |
| [1692](#L1692) | if ( $is\_active ) { |
| [1693](#L1693) | $this->module = $module['module']; |
| [1694](#L1694) | } |
| [1695](#L1695) | } |
| [1696](#L1696) | /\*\* |
| [1697](#L1697) | \* Set first module as current module. |
| [1698](#L1698) | \*/ |
| [1699](#L1699) | if ( empty( $this->module ) && is\_array( $modules ) && ! empty( $modules ) ) { |
| [1700](#L1700) | $module\_data  = array\_shift( $modules ); |
| [1701](#L1701) | $this->module = $module\_data['module']; |
| [1702](#L1702) | } |
| [1703](#L1703) | } |
| [1704](#L1704) |  |
| [1705](#L1705) | /\*\* |
| [1706](#L1706) | \* get group |
| [1707](#L1707) | \* |
| [1708](#L1708) | \* @since x.x.x |
| [1709](#L1709) | \*/ |
| [1710](#L1710) | public function get\_current\_group() { |
| [1711](#L1711) | return $this->group; |
| [1712](#L1712) | } |
| [1713](#L1713) |  |
| [1714](#L1714) | /\*\* |
| [1715](#L1715) | \* Dismiss New Feature dialogs. |
| [1716](#L1716) | \*/ |
| [1717](#L1717) | public function new\_feature\_dismiss() { |
| [1718](#L1718) | $dialog\_id = filter\_input( INPUT\_POST, 'id' ); |
| [1719](#L1719) | $nonce     = filter\_input( INPUT\_POST, '\_ajax\_nonce' ); |
| [1720](#L1720) | if ( ! ( $nonce && $dialog\_id ) ) { |
| [1721](#L1721) | wp\_send\_json\_error( array( 'message' => $this->messages['wrong'] ) ); |
| [1722](#L1722) | } |
| [1723](#L1723) |  |
| [1724](#L1724) | check\_ajax\_referer( 'new-feature' ); |
| [1725](#L1725) | $user\_id  = get\_current\_user\_id(); |
| [1726](#L1726) | $meta\_key = 'branda\_hide\_new\_features'; |
| [1727](#L1727) |  |
| [1728](#L1728) | update\_user\_meta( $user\_id, $meta\_key, $this->get\_major\_minor\_version() ); |
| [1729](#L1729) | } |
| [1730](#L1730) |  |
| [1731](#L1731) | private function get\_major\_minor\_version() { |
| [1732](#L1732) | return $this->to\_major\_minor( $this->build ); |
| [1733](#L1733) | } |
| [1734](#L1734) |  |
| [1735](#L1735) | private function to\_major\_minor( $version ) { |
| [1736](#L1736) | if ( substr\_count( $version, '.' ) > 1 ) { |
| [1737](#L1737) | list( $major, $minor, $patch ) = explode( '.', $version ); |
| [1738](#L1738) | return "{$major}.{$minor}"; |
| [1739](#L1739) | } |
| [1740](#L1740) |  |
| [1741](#L1741) | return $version; |
| [1742](#L1742) | } |
| [1743](#L1743) |  |
| [1744](#L1744) | /\*\* |
| [1745](#L1745) | \* Activate/deactivate single module AJAX action. |
| [1746](#L1746) | \* |
| [1747](#L1747) | \* @since 1.9.6 |
| [1748](#L1748) | \*/ |
| [1749](#L1749) | public function toggle\_module() { |
| [1750](#L1750) | if ( |
| [1751](#L1751) | isset( $\_POST['nonce'] ) |
| [1752](#L1752) | && isset( $\_POST['state'] ) |
| [1753](#L1753) | && isset( $\_POST['module'] ) |
| [1754](#L1754) | ) { |
| [1755](#L1755) | /\*\* |
| [1756](#L1756) | \* get module |
| [1757](#L1757) | \*/ |
| [1758](#L1758) | $module\_data = $this->get\_module\_by\_module( sanitize\_key( $\_POST['module'] ) ); |
| [1759](#L1759) | if ( is\_wp\_error( $module\_data ) ) { |
| [1760](#L1760) | $message = array( |
| [1761](#L1761) | 'message' => $module\_data->get\_error\_message(), |
| [1762](#L1762) | ); |
| [1763](#L1763) | wp\_send\_json\_error( $message ); |
| [1764](#L1764) | } |
| [1765](#L1765) | if ( ! wp\_verify\_nonce( $\_POST['nonce'], $module\_data['module'] ) ) { |
| [1766](#L1766) | wp\_send\_json\_error( array( 'message' => \_\_( 'Nope! Security check failed!', 'ub' ) ) ); |
| [1767](#L1767) | } |
| [1768](#L1768) | $result  = false; |
| [1769](#L1769) | $message = array( |
| [1770](#L1770) | 'message' => $this->messages['fail'], |
| [1771](#L1771) | ); |
| [1772](#L1772) | /\*\* |
| [1773](#L1773) | \* try to activate or deactivate |
| [1774](#L1774) | \*/ |
| [1775](#L1775) | if ( 'on' == $\_POST['state'] ) { |
| [1776](#L1776) | $result = $this->activate\_module( $module\_data['key'] ); |
| [1777](#L1777) | if ( $result ) { |
| [1778](#L1778) | $message = array( |
| [1779](#L1779) | 'type'    => 'success', |
| [1780](#L1780) | 'message' => sprintf( |
| [1781](#L1781) | \_\_( '%s module is active now.', 'ub' ), |
| [1782](#L1782) | $this->bold( $module\_data['name'] ) |
| [1783](#L1783) | ), |
| [1784](#L1784) | ); |
| [1785](#L1785) | } |
| [1786](#L1786) | } else { |
| [1787](#L1787) | $result = $this->deactivate\_module( $module\_data['key'] ); |
| [1788](#L1788) | if ( $result ) { |
| [1789](#L1789) | $message = array( |
| [1790](#L1790) | 'type'    => 'success', |
| [1791](#L1791) | 'message' => sprintf( |
| [1792](#L1792) | \_\_( 'Module %s was deactivated without errors.', 'ub' ), |
| [1793](#L1793) | $this->bold( $module\_data['name'] ) |
| [1794](#L1794) | ), |
| [1795](#L1795) | ); |
| [1796](#L1796) | } |
| [1797](#L1797) | } |
| [1798](#L1798) | $this->add\_message( $message ); |
| [1799](#L1799) | $data = array( |
| [1800](#L1800) | 'state'  => $result, |
| [1801](#L1801) | 'module' => sanitize\_key( $\_POST['module'] ), |
| [1802](#L1802) | ); |
| [1803](#L1803) | wp\_send\_json\_success( $data ); |
| [1804](#L1804) | } |
| [1805](#L1805) | wp\_send\_json\_error( array( 'message' => $this->messages['wrong'] ) ); |
| [1806](#L1806) | } |
| [1807](#L1807) |  |
| [1808](#L1808) | /\*\* |
| [1809](#L1809) | \* Sort module by menu\_title or page\_title. |
| [1810](#L1810) | \* |
| [1811](#L1811) | \* @since 2.0.0 |
| [1812](#L1812) | \*/ |
| [1813](#L1813) | public function sort\_modules\_by\_name( $a, $b ) { |
| [1814](#L1814) | $an = $a['name']; |
| [1815](#L1815) | $bn = $b['name']; |
| [1816](#L1816) | if ( isset( $a['menu\_title'] ) ) { |
| [1817](#L1817) | $an = $a['menu\_title']; |
| [1818](#L1818) | } |
| [1819](#L1819) | if ( isset( $b['menu\_title'] ) ) { |
| [1820](#L1820) | $bn = $b['menu\_title']; |
| [1821](#L1821) | } |
| [1822](#L1822) | return strcmp( $an, $bn ); |
| [1823](#L1823) | } |
| [1824](#L1824) |  |
| [1825](#L1825) | private function get\_module\_content( $module ) { |
| [1826](#L1826) | $is\_active = branda\_is\_active\_module( $module['key'] ); |
| [1827](#L1827) | if ( ! $is\_active ) { |
| [1828](#L1828) | return new WP\_Error( 'error', \_\_( 'This module is not active!', 'ub' ) ); |
| [1829](#L1829) | } |
| [1830](#L1830) | /\*\* |
| [1831](#L1831) | \* Turn off Smush scripts |
| [1832](#L1832) | \* |
| [1833](#L1833) | \* @since 3.0.0 |
| [1834](#L1834) | \*/ |
| [1835](#L1835) | add\_filter( 'wp\_smush\_enqueue', '\_\_return\_false' ); |
| [1836](#L1836) | $content = ''; |
| [1837](#L1837) | /\*\* |
| [1838](#L1838) | \* Form encoding type |
| [1839](#L1839) | \*/ |
| [1840](#L1840) | $enctype = apply\_filters( 'ultimatebranding\_settings\_form\_enctype', 'multipart/form-data' ); |
| [1841](#L1841) | if ( ! empty( $enctype ) ) { |
| [1842](#L1842) | $enctype = sprintf( |
| [1843](#L1843) | ' enctype="%s"', |
| [1844](#L1844) | esc\_attr( $enctype ) |
| [1845](#L1845) | ); |
| [1846](#L1846) | } |
| [1847](#L1847) | /\*\* |
| [1848](#L1848) | \* Fields with form |
| [1849](#L1849) | \*/ |
| [1850](#L1850) | $action   = Branda\_Helper::hyphen\_to\_underscore( 'ultimatebranding\_settings\_' . $module['module'] ); |
| [1851](#L1851) | $messages = apply\_filters( $action . '\_messages', $this->messages ); |
| [1852](#L1852) | if ( has\_filter( $action ) ) { |
| [1853](#L1853) | $content .= apply\_filters( 'branda\_before\_module\_form', '', $module ); |
| [1854](#L1854) | /\*\* |
| [1855](#L1855) | \* Filter Branda form classes. |
| [1856](#L1856) | \* |
| [1857](#L1857) | \* @since 3.0.0 |
| [1858](#L1858) | \* |
| [1859](#L1859) | \* @param $classes array Array of Branda form classes. |
| [1860](#L1860) | \* @param $module array Current module data, |
| [1861](#L1861) | \*/ |
| [1862](#L1862) | $classes  = apply\_filters( |
| [1863](#L1863) | 'branda\_form\_classes', |
| [1864](#L1864) | array( |
| [1865](#L1865) | 'branda-form', |
| [1866](#L1866) | sprintf( 'module-%s', sanitize\_title( $module['key'] ) ), |
| [1867](#L1867) | $this->is\_network ? 'branda-network' : 'branda-single', |
| [1868](#L1868) | ), |
| [1869](#L1869) | $module |
| [1870](#L1870) | ); |
| [1871](#L1871) | $content .= sprintf( |
| [1872](#L1872) | '<form action="%s" method="%s" class="module-%s"%s>', |
| [1873](#L1873) | remove\_query\_arg( array( 'module' ) ), |
| [1874](#L1874) | apply\_filters( 'ultimatebranding\_settings\_form\_method', 'post' ), |
| [1875](#L1875) | esc\_attr( implode( ' ', $classes ) ), |
| [1876](#L1876) | $enctype |
| [1877](#L1877) | ); |
| [1878](#L1878) | $content .= $this->hidden( 'module', $module['module'] ); |
| [1879](#L1879) | $content .= $this->hidden( 'page', $this->get\_current\_page() ); |
| [1880](#L1880) | if ( apply\_filters( 'ultimatebranding\_settings\_form\_add\_fields', true ) ) { |
| [1881](#L1881) | $content .= $this->hidden( 'action', 'process' ); |
| [1882](#L1882) | /\*\* |
| [1883](#L1883) | \* nonce |
| [1884](#L1884) | \*/ |
| [1885](#L1885) | $content .= wp\_nonce\_field( $action, '\_wpnonce', false, false ); |
| [1886](#L1886) | } |
| [1887](#L1887) | $content .= apply\_filters( $action, '' ); |
| [1888](#L1888) | /\*\* |
| [1889](#L1889) | \* footer |
| [1890](#L1890) | \*/ |
| [1891](#L1891) | if ( isset( $module['add-bottom-save-button'] ) && $module['add-bottom-save-button'] ) { |
| [1892](#L1892) | $filter = $action . '\_process'; |
| [1893](#L1893) | if ( |
| [1894](#L1894) | has\_filter( $filter ) |
| [1895](#L1895) | && apply\_filters( 'ultimatebranding\_settings\_panel\_show\_submit', true, $module ) |
| [1896](#L1896) | ) { |
| [1897](#L1897) | $content .= '<div class="sui-box-footer">'; |
| [1898](#L1898) | $content .= '<div class="sui-actions-right">'; |
| [1899](#L1899) | $args     = array( |
| [1900](#L1900) | 'text'  => \_\_( 'Save Changes', 'ub' ), |
| [1901](#L1901) | 'sui'   => 'blue', |
| [1902](#L1902) | 'icon'  => 'save', |
| [1903](#L1903) | 'class' => 'branda-module-save', |
| [1904](#L1904) | ); |
| [1905](#L1905) | $args     = apply\_filters( 'branda\_after\_form\_save\_button\_args', $args, $module ); |
| [1906](#L1906) | $content .= $this->button( $args ); |
| [1907](#L1907) | $content .= '</div>'; // sui-actions-right |
| [1908](#L1908) | $content .= '</div>'; // sui-box-header |
| [1909](#L1909) | } |
| [1910](#L1910) | } |
| [1911](#L1911) | $content .= '</form>'; |
| [1912](#L1912) | do\_action( 'branda\_after\_module\_form', $module ); |
| [1913](#L1913) | } else { |
| [1914](#L1914) | $content .= Branda\_Helper::sui\_notice( $this->messages['wrong'] ); |
| [1915](#L1915) | if ( Branda\_Helper::is\_debug() ) { |
| [1916](#L1916) | error\_log( 'Missing action: ' . $action ); |
| [1917](#L1917) | } |
| [1918](#L1918) | } |
| [1919](#L1919) | /\*\* |
| [1920](#L1920) | \* filter module content. |
| [1921](#L1921) | \* |
| [1922](#L1922) | \* @since 3.0.0 |
| [1923](#L1923) | \* |
| [1924](#L1924) | \* @param string $content Current module content. |
| [1925](#L1925) | \* @param array $module Current module. |
| [1926](#L1926) | \*/ |
| [1927](#L1927) | return apply\_filters( 'branda\_get\_module\_content', $content, $module ); |
| [1928](#L1928) | } |
| [1929](#L1929) |  |
| [1930](#L1930) | /\*\* |
| [1931](#L1931) | \* SUI button |
| [1932](#L1932) | \*/ |
| [1933](#L1933) | public function button( $args ) { |
| [1934](#L1934) | $content        = $data = ''; |
| [1935](#L1935) | $add\_sui\_loader = true; |
| [1936](#L1936) | /\*\* |
| [1937](#L1937) | \* add data attributes |
| [1938](#L1938) | \*/ |
| [1939](#L1939) | if ( isset( $args['data'] ) ) { |
| [1940](#L1940) | foreach ( $args['data'] as $key => $value ) { |
| [1941](#L1941) | $data .= sprintf( |
| [1942](#L1942) | ' data-%s="%s"', |
| [1943](#L1943) | sanitize\_title( $key ), |
| [1944](#L1944) | esc\_attr( $value ) |
| [1945](#L1945) | ); |
| [1946](#L1946) | if ( 'modal-open' === $key ) { |
| [1947](#L1947) | $data .= ' data-modal-mask="true"'; |
| [1948](#L1948) | } |
| [1949](#L1949) | } |
| [1950](#L1950) | } |
| [1951](#L1951) | /\*\* |
| [1952](#L1952) | \* add disabled attribute |
| [1953](#L1953) | \*/ |
| [1954](#L1954) | if ( isset( $args['disabled'] ) && $args['disabled'] ) { |
| [1955](#L1955) | $data .= ' disabled="disabled"'; |
| [1956](#L1956) | } |
| [1957](#L1957) | /\*\* |
| [1958](#L1958) | \* add ID attribute |
| [1959](#L1959) | \*/ |
| [1960](#L1960) | if ( isset( $args['id'] ) ) { |
| [1961](#L1961) | $data .= sprintf( ' id="%s"', esc\_attr( $args['id'] ) ); |
| [1962](#L1962) | } |
| [1963](#L1963) | /\*\* |
| [1964](#L1964) | \* add style attribute |
| [1965](#L1965) | \*/ |
| [1966](#L1966) | if ( isset( $args['style'] ) ) { |
| [1967](#L1967) | $data .= sprintf( ' style="%s"', esc\_attr( $args['style'] ) ); |
| [1968](#L1968) | } |
| [1969](#L1969) | /\*\* |
| [1970](#L1970) | \* Build classes |
| [1971](#L1971) | \*/ |
| [1972](#L1972) | $classes = array( |
| [1973](#L1973) | 'sui-button', |
| [1974](#L1974) | ); |
| [1975](#L1975) | if ( isset( $args['only-icon'] ) && true === $args['only-icon'] ) { |
| [1976](#L1976) | $classes        = array(); |
| [1977](#L1977) | $add\_sui\_loader = false; |
| [1978](#L1978) | } |
| [1979](#L1979) | if ( isset( $args['sui'] ) ) { |
| [1980](#L1980) | if ( ! empty( $args['sui'] ) ) { |
| [1981](#L1981) | if ( ! is\_array( $args['sui'] ) ) { |
| [1982](#L1982) | $args['sui'] = array( $args['sui'] ); |
| [1983](#L1983) | } |
| [1984](#L1984) | foreach ( $args['sui'] as $sui ) { |
| [1985](#L1985) | $classes[] = sprintf( 'sui-button-%s', $sui ); |
| [1986](#L1986) | } |
| [1987](#L1987) | } elseif ( false !== $args['sui'] ) { |
| [1988](#L1988) | $classes[] = 'sui-button-blue'; |
| [1989](#L1989) | } |
| [1990](#L1990) | } |
| [1991](#L1991) | if ( ! isset( $args['text'] ) ) { |
| [1992](#L1992) | $classes[] = 'sui-button-icon'; |
| [1993](#L1993) | } |
| [1994](#L1994) | if ( isset( $args['class'] ) ) { |
| [1995](#L1995) | $classes[] = $args['class']; |
| [1996](#L1996) | } |
| [1997](#L1997) | if ( isset( $args['classes'] ) && is\_array( $args['classes'] ) ) { |
| [1998](#L1998) | $classes = array\_merge( $classes, $args['classes'] ); |
| [1999](#L1999) | } |
| [2000](#L2000) | /\*\* |
| [2001](#L2001) | \* Start |
| [2002](#L2002) | \*/ |
| [2003](#L2003) | $content .= sprintf( |
| [2004](#L2004) | '<button class="%s" %s type="%s">', |
| [2005](#L2005) | esc\_attr( implode( ' ', $classes ) ), |
| [2006](#L2006) | $data, |
| [2007](#L2007) | isset( $args['type'] ) ? esc\_attr( $args['type'] ) : 'button' |
| [2008](#L2008) | ); |
| [2009](#L2009) | if ( $add\_sui\_loader ) { |
| [2010](#L2010) | $content .= '<span class="sui-loading-text">'; |
| [2011](#L2011) | } |
| [2012](#L2012) | /\*\* |
| [2013](#L2013) | \* Icon |
| [2014](#L2014) | \*/ |
| [2015](#L2015) | if ( isset( $args['icon'] ) ) { |
| [2016](#L2016) | $content .= sprintf( |
| [2017](#L2017) | '<i class="sui-icon-%s"></i>', |
| [2018](#L2018) | sanitize\_title( $args['icon'] ) |
| [2019](#L2019) | ); |
| [2020](#L2020) | } |
| [2021](#L2021) | if ( isset( $args['text'] ) ) { |
| [2022](#L2022) | $content .= esc\_attr( $args['text'] ); |
| [2023](#L2023) | } elseif ( isset( $args['value'] ) ) { |
| [2024](#L2024) | $content .= esc\_attr( $args['value'] ); |
| [2025](#L2025) | } |
| [2026](#L2026) | if ( $add\_sui\_loader ) { |
| [2027](#L2027) | $content .= '</span>'; |
| [2028](#L2028) | $content .= '<i class="sui-icon-loader sui-loading" aria-hidden="true"></i>'; |
| [2029](#L2029) | } |
| [2030](#L2030) | $content .= '</button>'; |
| [2031](#L2031) | /\*\* |
| [2032](#L2032) | \* Wrap |
| [2033](#L2033) | \*/ |
| [2034](#L2034) | if ( isset( $args['wrap'] ) && is\_string( $args['wrap'] ) ) { |
| [2035](#L2035) | $content = sprintf( |
| [2036](#L2036) | '<div class="%s">%s</div>', |
| [2037](#L2037) | esc\_attr( $args['wrap'] ), |
| [2038](#L2038) | $content |
| [2039](#L2039) | ); |
| [2040](#L2040) | } |
| [2041](#L2041) | return $content; |
| [2042](#L2042) | } |
| [2043](#L2043) |  |
| [2044](#L2044) | /\*\* |
| [2045](#L2045) | \* Helper for hidden field. |
| [2046](#L2046) | \* |
| [2047](#L2047) | \* @since 3.0.0 |
| [2048](#L2048) | \* |
| [2049](#L2049) | \* @input string $name HTML form field name. |
| [2050](#L2050) | \* @input string $value HTML form field value. |
| [2051](#L2051) | \* |
| [2052](#L2052) | \* @return string HTML hidden syntax. |
| [2053](#L2053) | \*/ |
| [2054](#L2054) | private function hidden( $name, $value ) { |
| [2055](#L2055) | return sprintf( |
| [2056](#L2056) | '<input type="hidden" name="%s" value="%s" />', |
| [2057](#L2057) | esc\_attr( $name ), |
| [2058](#L2058) | esc\_attr( $value ) |
| [2059](#L2059) | ); |
| [2060](#L2060) | } |
| [2061](#L2061) |  |
| [2062](#L2062) | /\*\* |
| [2063](#L2063) | \* Remove default footer on Branda screens. |
| [2064](#L2064) | \* |
| [2065](#L2065) | \* @since 3.0.0 |
| [2066](#L2066) | \*/ |
| [2067](#L2067) | public function remove\_default\_footer( $content ) { |
| [2068](#L2068) | $screen = get\_current\_screen(); |
| [2069](#L2069) | if ( |
| [2070](#L2070) | is\_a( $screen, 'WP\_Screen' ) |
| [2071](#L2071) | && preg\_match( '/\_page\_branding/', $screen->id ) |
| [2072](#L2072) | ) { |
| [2073](#L2073) | remove\_filter( 'update\_footer', 'core\_update\_footer' ); |
| [2074](#L2074) | return ''; |
| [2075](#L2075) | } |
| [2076](#L2076) | return $content; |
| [2077](#L2077) | } |
| [2078](#L2078) |  |
| [2079](#L2079) | /\*\* |
| [2080](#L2080) | \* Get current module |
| [2081](#L2081) | \* |
| [2082](#L2082) | \* @since 3.0.0 |
| [2083](#L2083) | \* |
| [2084](#L2084) | \* @return string Current module. |
| [2085](#L2085) | \*/ |
| [2086](#L2086) | public function get\_current\_module() { |
| [2087](#L2087) | return $this->module; |
| [2088](#L2088) | } |
| [2089](#L2089) |  |
| [2090](#L2090) | /\*\* |
| [2091](#L2091) | \* Check is current module? |
| [2092](#L2092) | \* |
| [2093](#L2093) | \* @since 3.0.0 |
| [2094](#L2094) | \*/ |
| [2095](#L2095) | public function is\_current\_module( $module ) { |
| [2096](#L2096) | return $this->module === $module; |
| [2097](#L2097) | } |
| [2098](#L2098) |  |
| [2099](#L2099) | /\*\* |
| [2100](#L2100) | \* reset whole module |
| [2101](#L2101) | \* |
| [2102](#L2102) | \* @since 3.0.0 |
| [2103](#L2103) | \*/ |
| [2104](#L2104) | public function ajax\_reset\_module() { |
| [2105](#L2105) | if ( |
| [2106](#L2106) | isset( $\_POST['\_wpnonce'] ) |
| [2107](#L2107) | && isset( $\_POST['module'] ) |
| [2108](#L2108) | ) { |
| [2109](#L2109) | /\*\* |
| [2110](#L2110) | \* get module |
| [2111](#L2111) | \*/ |
| [2112](#L2112) | $module\_data = $this->get\_module\_by\_module( sanitize\_key( $\_POST['module'] ) ); |
| [2113](#L2113) | if ( is\_wp\_error( $module\_data ) ) { |
| [2114](#L2114) | $message = array( |
| [2115](#L2115) | 'message' => $module\_data->get\_error\_message(), |
| [2116](#L2116) | ); |
| [2117](#L2117) | wp\_send\_json\_error( $message ); |
| [2118](#L2118) | } |
| [2119](#L2119) | if ( ! wp\_verify\_nonce( $\_POST['\_wpnonce'], 'reset-module-' . $module\_data['module'] ) ) { |
| [2120](#L2120) | wp\_send\_json\_error( array( 'message' => $this->messages['security'] ) ); |
| [2121](#L2121) | } |
| [2122](#L2122) | $filter = sprintf( 'ultimatebranding\_settings\_%s\_reset', $module\_data['module'] ); |
| [2123](#L2123) | $status = apply\_filters( $filter, false ); |
| [2124](#L2124) | if ( $status ) { |
| [2125](#L2125) | $message = array( |
| [2126](#L2126) | 'type'    => 'success', |
| [2127](#L2127) | 'message' => sprintf( |
| [2128](#L2128) | \_\_( '%s module was reset.', 'ub' ), |
| [2129](#L2129) | $this->bold( $module\_data['name'] ) |
| [2130](#L2130) | ), |
| [2131](#L2131) | ); |
| [2132](#L2132) | $this->add\_message( $message ); |
| [2133](#L2133) | wp\_send\_json\_success(); |
| [2134](#L2134) | } |
| [2135](#L2135) | } |
| [2136](#L2136) | wp\_send\_json\_error( array( 'message' => $this->messages['wrong'] ) ); |
| [2137](#L2137) | } |
| [2138](#L2138) |  |
| [2139](#L2139) | /\*\* |
| [2140](#L2140) | \* Return messages |
| [2141](#L2141) | \* |
| [2142](#L2142) | \* @since 3.0.0 |
| [2143](#L2143) | \*/ |
| [2144](#L2144) | public function get\_messages() { |
| [2145](#L2145) | return $this->messages; |
| [2146](#L2146) | } |
| [2147](#L2147) |  |
| [2148](#L2148) | /\*\* |
| [2149](#L2149) | \* Map of old -> new modules. |
| [2150](#L2150) | \* |
| [2151](#L2151) | \* @since 3.0.0 |
| [2152](#L2152) | \*/ |
| [2153](#L2153) | private function get\_modules\_map() { |
| [2154](#L2154) | $map = array( |
| [2155](#L2155) | /\*\* |
| [2156](#L2156) | \* Dashboard Widgets |
| [2157](#L2157) | \*/ |
| [2158](#L2158) | 'dashboard-text-widgets/dashboard-text-widgets.php' => 'widgets/dashboard-widgets.php', |
| [2159](#L2159) | 'custom-dashboard-welcome.php'            => 'widgets/dashboard-widgets.php', |
| [2160](#L2160) | 'remove-wp-dashboard-widgets.php'         => 'widgets/dashboard-widgets.php', |
| [2161](#L2161) | 'remove-wp-dashboard-widgets/remove-wp-dashboard-widgets.php' => 'widgets/dashboard-widgets.php', |
| [2162](#L2162) | 'dashboard-widgets/dashboard-widgets.php' => 'widgets/dashboard-widgets.php', |
| [2163](#L2163) | 'dashboard-feeds/dashboard-feeds.php'     => 'widgets/dashboard-feeds.php', |
| [2164](#L2164) | /\*\* |
| [2165](#L2165) | \* Turn on Content Header |
| [2166](#L2166) | \*/ |
| [2167](#L2167) | 'global-header-content.php'               => 'content/header.php', |
| [2168](#L2168) | /\*\* |
| [2169](#L2169) | \* Turn on Content Footer |
| [2170](#L2170) | \*/ |
| [2171](#L2171) | 'global-footer-content.php'               => 'content/footer.php', |
| [2172](#L2172) | /\*\* |
| [2173](#L2173) | \* Turn on Email Header |
| [2174](#L2174) | \*/ |
| [2175](#L2175) | 'custom-email-from.php'                   => 'emails/headers.php', |
| [2176](#L2176) | /\*\* |
| [2177](#L2177) | \* Turn on Registration Emails |
| [2178](#L2178) | \*/ |
| [2179](#L2179) | 'custom-ms-register-emails.php'           => 'emails/registration.php', |
| [2180](#L2180) | /\*\* |
| [2181](#L2181) | \* Text Replacement ( Text Change ) |
| [2182](#L2182) | \*/ |
| [2183](#L2183) | 'site-wide-text-change.php'               => 'utilities/text-replacement.php', |
| [2184](#L2184) | 'text-replacement/text-replacement.php'   => 'utilities/text-replacement.php', |
| [2185](#L2185) | /\*\* |
| [2186](#L2186) | \* Images: Favicons |
| [2187](#L2187) | \* Images: Image upload size |
| [2188](#L2188) | \*/ |
| [2189](#L2189) | 'favicons.php'                            => 'utilities/images.php', |
| [2190](#L2190) | 'image-upload-size.php'                   => 'utilities/images.php', |
| [2191](#L2191) | /\*\* |
| [2192](#L2192) | \* Admin Bar |
| [2193](#L2193) | \* Admin Bar Logo |
| [2194](#L2194) | \*/ |
| [2195](#L2195) | 'custom-admin-bar.php'                    => 'admin/bar.php', |
| [2196](#L2196) | 'admin-bar-logo.php'                      => 'admin/bar.php', |
| [2197](#L2197) | /\*\* |
| [2198](#L2198) | \* Login Screen |
| [2199](#L2199) | \*/ |
| [2200](#L2200) | 'custom-login-screen.php'                 => 'login-screen/login-screen.php', |
| [2201](#L2201) | /\*\* |
| [2202](#L2202) | \* Site Generator |
| [2203](#L2203) | \*/ |
| [2204](#L2204) | 'site-generator-replacement.php'          => 'utilities/site-generator.php', |
| [2205](#L2205) | /\*\* |
| [2206](#L2206) | \* Email Temlate |
| [2207](#L2207) | \*/ |
| [2208](#L2208) | 'htmlemail.php'                           => 'emails/template.php', |
| [2209](#L2209) | /\*\* |
| [2210](#L2210) | \* Blog creation: signup code |
| [2211](#L2211) | \*/ |
| [2212](#L2212) | 'signup-code.php'                         => 'login-screen/signup-code.php', |
| [2213](#L2213) | /\*\* |
| [2214](#L2214) | \* Color Schemes |
| [2215](#L2215) | \*/ |
| [2216](#L2216) | 'ultimate-color-schemes.php'              => 'admin/color-schemes.php', |
| [2217](#L2217) | /\*\* |
| [2218](#L2218) | \* Admin Footer Text |
| [2219](#L2219) | \*/ |
| [2220](#L2220) | 'admin-footer-text.php'                   => 'admin/footer.php', |
| [2221](#L2221) | /\*\* |
| [2222](#L2222) | \* Meta Widget |
| [2223](#L2223) | \*/ |
| [2224](#L2224) | 'rebranded-meta-widget.php'               => 'widgets/meta-widget.php', |
| [2225](#L2225) | /\*\* |
| [2226](#L2226) | \* Admin Custom CSS |
| [2227](#L2227) | \*/ |
| [2228](#L2228) | 'custom-admin-css.php'                    => 'admin/custom-css.php', |
| [2229](#L2229) | /\*\* |
| [2230](#L2230) | \* Admin Message |
| [2231](#L2231) | \*/ |
| [2232](#L2232) | 'admin-message.php'                       => 'admin/message.php', |
| [2233](#L2233) | /\*\* |
| [2234](#L2234) | \* Comments Control |
| [2235](#L2235) | \*/ |
| [2236](#L2236) | 'comments-control.php'                    => 'utilities/comments-control.php', |
| [2237](#L2237) | /\*\* |
| [2238](#L2238) | \* Blog Description on Blog Creation |
| [2239](#L2239) | \*/ |
| [2240](#L2240) | 'signup-blog-description.php'             => 'front-end/signup-blog-description.php', |
| [2241](#L2241) | /\*\* |
| [2242](#L2242) | \* Document |
| [2243](#L2243) | \*/ |
| [2244](#L2244) | 'document.php'                            => 'front-end/document.php', |
| [2245](#L2245) | /\*\* |
| [2246](#L2246) | \* Admin Help Content |
| [2247](#L2247) | \*/ |
| [2248](#L2248) | 'admin-help-content.php'                  => 'admin/help-content.php', |
| [2249](#L2249) | /\*\* |
| [2250](#L2250) | \* ms-site-check |
| [2251](#L2251) | \*/ |
| [2252](#L2252) | 'ms-site-check/ms-site-check.php'         => 'front-end/site-status-page.php', |
| [2253](#L2253) | /\*\* |
| [2254](#L2254) | \* Cookie Notice |
| [2255](#L2255) | \*/ |
| [2256](#L2256) | 'cookie-notice/cookie-notice.php'         => 'front-end/cookie-notice.php', |
| [2257](#L2257) | /\*\* |
| [2258](#L2258) | \* DB Error Page |
| [2259](#L2259) | \*/ |
| [2260](#L2260) | 'db-error-page/db-error-page.php'         => 'front-end/db-error-page.php', |
| [2261](#L2261) | /\*\* |
| [2262](#L2262) | \* Author Box |
| [2263](#L2263) | \*/ |
| [2264](#L2264) | 'author-box/author-box.php'               => 'front-end/author-box.php', |
| [2265](#L2265) | /\*\* |
| [2266](#L2266) | \* SMTP |
| [2267](#L2267) | \*/ |
| [2268](#L2268) | 'smtp/smtp.php'                           => 'emails/smtp.php', |
| [2269](#L2269) | /\*\* |
| [2270](#L2270) | \* Tracking Codes |
| [2271](#L2271) | \*/ |
| [2272](#L2272) | 'tracking-codes/tracking-codes.php'       => 'utilities/tracking-codes.php', |
| [2273](#L2273) | /\*\* |
| [2274](#L2274) | \* Website Mode |
| [2275](#L2275) | \*/ |
| [2276](#L2276) | 'maintenance/maintenance.php'             => 'utilities/maintenance.php', |
| [2277](#L2277) | ); |
| [2278](#L2278) | return $map; |
| [2279](#L2279) | } |
| [2280](#L2280) |  |
| [2281](#L2281) | private function get\_first\_installed\_version() { |
| [2282](#L2282) | return branda\_get\_option( 'branda\_first\_installed\_version', '0' ); |
| [2283](#L2283) | } |
| [2284](#L2284) |  |
| [2285](#L2285) | private function set\_first\_installed\_version() { |
| [2286](#L2286) | branda\_update\_option( 'branda\_first\_installed\_version', $this->build ); |
| [2287](#L2287) | } |
| [2288](#L2288) |  |
| [2289](#L2289) | /\*\* |
| [2290](#L2290) | \* Upgrade |
| [2291](#L2291) | \* |
| [2292](#L2292) | \* @since 3.0.0 |
| [2293](#L2293) | \*/ |
| [2294](#L2294) | public function upgrade() { |
| [2295](#L2295) | $key        = 'branda\_db\_version'; |
| [2296](#L2296) | $db\_version = intval( branda\_get\_option( $key, 0 ) ); |
| [2297](#L2297) |  |
| [2298](#L2298) | if ( empty( $db\_version ) ) { |
| [2299](#L2299) | $this->set\_first\_installed\_version(); |
| [2300](#L2300) | } |
| [2301](#L2301) |  |
| [2302](#L2302) | /\*\* |
| [2303](#L2303) | \* Branda 3.0.0 |
| [2304](#L2304) | \*/ |
| [2305](#L2305) | $value = 20190205; |
| [2306](#L2306) | if ( $value > $db\_version ) { |
| [2307](#L2307) | $modules = get\_branda\_activated\_modules(); |
| [2308](#L2308) | $map     = $this->get\_modules\_map(); |
| [2309](#L2309) | foreach ( $map as $old => $new ) { |
| [2310](#L2310) | if ( |
| [2311](#L2311) | isset( $modules[ $old ] ) |
| [2312](#L2312) | && 'yes' === $modules[ $old ] |
| [2313](#L2313) | ) { |
| [2314](#L2314) | $this->deactivate\_module( $old ); |
| [2315](#L2315) | $this->activate\_module( $new ); |
| [2316](#L2316) | } |
| [2317](#L2317) | } |
| [2318](#L2318) | /\*\* |
| [2319](#L2319) | \* Turn on Registration Emails |
| [2320](#L2320) | \*/ |
| [2321](#L2321) | $module = 'export-import.php'; |
| [2322](#L2322) | if ( |
| [2323](#L2323) | isset( $modules[ $module ] ) |
| [2324](#L2324) | && 'yes' === $modules[ $module ] |
| [2325](#L2325) | ) { |
| [2326](#L2326) | $this->activate\_module( 'utilities/import.php' ); |
| [2327](#L2327) | $this->activate\_module( 'utilities/export.php' ); |
| [2328](#L2328) | $this->deactivate\_module( $module ); |
| [2329](#L2329) | } |
| [2330](#L2330) | /\*\* |
| [2331](#L2331) | \* Turn on Admin Menu |
| [2332](#L2332) | \* |
| [2333](#L2333) | \* Urgent: do not turn off previous modules! |
| [2334](#L2334) | \*/ |
| [2335](#L2335) | $m = array( |
| [2336](#L2336) | 'admin-panel-tips/admin-panel-tips.php', |
| [2337](#L2337) | 'link-manager.php', |
| [2338](#L2338) | 'remove-dashboard-link-for-users-without-site.php', |
| [2339](#L2339) | 'remove-permalinks-menu-item.php', |
| [2340](#L2340) | ); |
| [2341](#L2341) | foreach ( $m as $module ) { |
| [2342](#L2342) | if ( |
| [2343](#L2343) | isset( $modules[ $module ] ) |
| [2344](#L2344) | && 'yes' === $modules[ $module ] |
| [2345](#L2345) | ) { |
| [2346](#L2346) | $this->activate\_module( 'admin/menu.php' ); |
| [2347](#L2347) | } |
| [2348](#L2348) | } |
| [2349](#L2349) | /\*\* |
| [2350](#L2350) | \* update |
| [2351](#L2351) | \*/ |
| [2352](#L2352) | branda\_update\_option( $key, $value ); |
| [2353](#L2353) | } |
| [2354](#L2354) | } |
| [2355](#L2355) |  |
| [2356](#L2356) | /\*\* |
| [2357](#L2357) | \* Add admin body classes |
| [2358](#L2358) | \* |
| [2359](#L2359) | \* @since 3.0.0 |
| [2360](#L2360) | \*/ |
| [2361](#L2361) | public function add\_branda\_admin\_body\_class( $classes ) { |
| [2362](#L2362) | if ( function\_exists( 'get\_current\_screen' ) ) { |
| [2363](#L2363) | $screen = get\_current\_screen(); |
| [2364](#L2364) | if ( |
| [2365](#L2365) | preg\_match( '/page\_branda/', $screen->id ) |
| [2366](#L2366) | || preg\_match( '/page\_branding/', $screen->id ) |
| [2367](#L2367) | ) { |
| [2368](#L2368) | if ( ! is\_string( $classes ) ) { |
| [2369](#L2369) | $classes = ''; |
| [2370](#L2370) | } |
| [2371](#L2371) | $classes .= ' branda-admin-page'; |
| [2372](#L2372) | /\*\* |
| [2373](#L2373) | \* Shared UI |
| [2374](#L2374) | \* Include library version as class on body. |
| [2375](#L2375) | \* |
| [2376](#L2376) | \* @since 3.0.0 |
| [2377](#L2377) | \*/ |
| [2378](#L2378) | if ( defined( 'BRANDA\_SUI\_VERSION' ) ) { |
| [2379](#L2379) | $sanitize\_version = str\_replace( '.', '-', BRANDA\_SUI\_VERSION ); |
| [2380](#L2380) | $classes         .= sprintf( ' sui-%s', $sanitize\_version ); |
| [2381](#L2381) | } |
| [2382](#L2382) | /\*\* |
| [2383](#L2383) | \* add import class |
| [2384](#L2384) | \*/ |
| [2385](#L2385) | if ( 'import' === $this->module ) { |
| [2386](#L2386) | if ( |
| [2387](#L2387) | isset( $\_REQUEST['key'] ) |
| [2388](#L2388) | && 'error' === $\_REQUEST['key'] |
| [2389](#L2389) | ) { |
| [2390](#L2390) | $classes .= ' branda-import'; |
| [2391](#L2391) | } |
| [2392](#L2392) | if ( |
| [2393](#L2393) | isset( $\_REQUEST['step'] ) |
| [2394](#L2394) | && 'import' === $\_REQUEST['step'] |
| [2395](#L2395) | ) { |
| [2396](#L2396) | $classes .= ' branda-import'; |
| [2397](#L2397) | } |
| [2398](#L2398) | } |
| [2399](#L2399) | } |
| [2400](#L2400) | } |
| [2401](#L2401) | return $classes; |
| [2402](#L2402) | } |
| [2403](#L2403) |  |
| [2404](#L2404) | /\*\* |
| [2405](#L2405) | \* Get configuration |
| [2406](#L2406) | \* |
| [2407](#L2407) | \* @since 3.0.0 |
| [2408](#L2408) | \*/ |
| [2409](#L2409) | public function get\_configuration() { |
| [2410](#L2410) | return $this->configuration; |
| [2411](#L2411) | } |
| [2412](#L2412) |  |
| [2413](#L2413) | /\*\* |
| [2414](#L2414) | \* Get modules |
| [2415](#L2415) | \* |
| [2416](#L2416) | \* @since 3.0.0 |
| [2417](#L2417) | \*/ |
| [2418](#L2418) | public function get\_modules() { |
| [2419](#L2419) | return $this->modules; |
| [2420](#L2420) | } |
| [2421](#L2421) |  |
| [2422](#L2422) | /\*\* |
| [2423](#L2423) | \* Set last "write" module usage |
| [2424](#L2424) | \* |
| [2425](#L2425) | \* @since 3.0.0 |
| [2426](#L2426) | \*/ |
| [2427](#L2427) | public function set\_last\_write( $module ) { |
| [2428](#L2428) | $module = $this->get\_module\_by\_module( $module ); |
| [2429](#L2429) | $this->stats->set\_last\_write( $module['key'] ); |
| [2430](#L2430) | } |
| [2431](#L2431) |  |
| [2432](#L2432) | /\*\* |
| [2433](#L2433) | \* Copy settings from another modules. |
| [2434](#L2434) | \* |
| [2435](#L2435) | \* @since 3.0.0 |
| [2436](#L2436) | \*/ |
| [2437](#L2437) | private function get\_copy\_button( $module ) { |
| [2438](#L2438) | $content = ''; |
| [2439](#L2439) | if ( empty( $this->related ) || ! is\_array( $this->related ) ) { |
| [2440](#L2440) | return $content; |
| [2441](#L2441) | } |
| [2442](#L2442) | $module\_module = $module['module']; |
| [2443](#L2443) | $related       = array(); |
| [2444](#L2444) | foreach ( $this->related as $section => $data ) { |
| [2445](#L2445) | if ( array\_key\_exists( $module\_module, $data ) ) { |
| [2446](#L2446) | unset( $data[ $module\_module ] ); |
| [2447](#L2447) | if ( empty( $data ) ) { |
| [2448](#L2448) | continue; |
| [2449](#L2449) | } |
| [2450](#L2450) | $related[ $section ] = $data; |
| [2451](#L2451) | } |
| [2452](#L2452) | } |
| [2453](#L2453) | if ( empty( $related ) ) { |
| [2454](#L2454) | return $content; |
| [2455](#L2455) | } |
| [2456](#L2456) | $trans = array( |
| [2457](#L2457) | 'background'            => \_\_( 'Background', 'ub' ), |
| [2458](#L2458) | 'logo'                  => \_\_( 'Logo', 'ub' ), |
| [2459](#L2459) | 'social\_media\_settings' => \_\_( 'Social Media Settings', 'ub' ), |
| [2460](#L2460) | 'social\_media'          => \_\_( 'Social Media', 'ub' ), |
| [2461](#L2461) | ); |
| [2462](#L2462) | $c     = array(); |
| [2463](#L2463) | foreach ( $related as $section => $section\_data ) { |
| [2464](#L2464) | foreach ( $section\_data as $module\_key => $module\_key\_data ) { |
| [2465](#L2465) | if ( ! isset( $c[ $module\_key ] ) ) { |
| [2466](#L2466) | $c[ $module\_key ]            = $module\_key\_data; |
| [2467](#L2467) | $c[ $module\_key ]['options'] = array(); |
| [2468](#L2468) | } |
| [2469](#L2469) | $c[ $module\_key ]['options'][ $section ] = $trans[ $section ]; |
| [2470](#L2470) | } |
| [2471](#L2471) | } |
| [2472](#L2472) | $args     = array( |
| [2473](#L2473) | 'related' => $c, |
| [2474](#L2474) | 'module'  => $module, |
| [2475](#L2475) | ); |
| [2476](#L2476) | $template = 'admin/common/copy'; |
| [2477](#L2477) | $content .= $this->render( $template, $args, true ); |
| [2478](#L2478) | return $content; |
| [2479](#L2479) | } |
| [2480](#L2480) |  |
| [2481](#L2481) | /\*\* |
| [2482](#L2482) | \* Copy settings from source to target module. |
| [2483](#L2483) | \* |
| [2484](#L2484) | \* @since 3.0.0 |
| [2485](#L2485) | \*/ |
| [2486](#L2486) | public function ajax\_copy\_settings() { |
| [2487](#L2487) | //$target = filter\_input( INPUT\_POST, 'target\_module', FILTER\_SANITIZE\_STRING ); |
| [2488](#L2488) | //$source = filter\_input( INPUT\_POST, 'source\_module', FILTER\_SANITIZE\_STRING ); |
| [2489](#L2489) | //$nonce  = filter\_input( INPUT\_POST, 'nonce', FILTER\_SANITIZE\_STRING ); |
| [2490](#L2490) |  |
| [2491](#L2491) | $target = ! empty( $\_POST['target\_module'] ) ? sanitize\_text\_field( $\_POST['target\_module'] ) : null; |
| [2492](#L2492) | $source = ! empty( $\_POST['source\_module'] ) ? sanitize\_text\_field( $\_POST['source\_module'] ) : null; |
| [2493](#L2493) | $nonce  = ! empty( $\_POST['nonce'] ) ? sanitize\_text\_field( $\_POST['nonce'] ) : null; |
| [2494](#L2494) |  |
| [2495](#L2495) | if ( |
| [2496](#L2496) | empty( $target ) |
| [2497](#L2497) | || empty( $source ) |
| [2498](#L2498) | || empty( $nonce ) |
| [2499](#L2499) | || ! isset( $\_POST['sections'] ) |
| [2500](#L2500) | ) { |
| [2501](#L2501) | wp\_send\_json\_error( array( 'message' => $this->messages['missing'] ) ); |
| [2502](#L2502) | } |
| [2503](#L2503) | $nonce\_action = sprintf( 'branda-copy-settings-%s', $target ); |
| [2504](#L2504) | if ( ! wp\_verify\_nonce( $nonce, $nonce\_action ) ) { |
| [2505](#L2505) | wp\_send\_json\_error( array( 'message' => $this->messages['security'] ) ); |
| [2506](#L2506) | } |
| [2507](#L2507) | $source\_module\_data          = $this->get\_module\_by\_module( $source ); |
| [2508](#L2508) | $target\_module\_data          = $this->get\_module\_by\_module( $target ); |
| [2509](#L2509) | $source\_module\_configuration = branda\_get\_option( $source\_module\_data['options'][0] ); |
| [2510](#L2510) | $target\_module\_configuration = branda\_get\_option( $target\_module\_data['options'][0], array() ); |
| [2511](#L2511) | if ( empty( $source\_module\_configuration ) ) { |
| [2512](#L2512) | wp\_send\_json\_error( array( 'message' => \_\_( 'Please configure source module first!', 'ub' ) ) ); |
| [2513](#L2513) | } |
| [2514](#L2514) | /\*\* |
| [2515](#L2515) | \* |
| [2516](#L2516) | \*/ |
| [2517](#L2517) | if ( ! is\_array( $target\_module\_configuration ) ) { |
| [2518](#L2518) | $target\_module\_configuration = array(); |
| [2519](#L2519) | } |
| [2520](#L2520) | $copy = array( |
| [2521](#L2521) | 'content' => array(), |
| [2522](#L2522) | 'design'  => array(), |
| [2523](#L2523) | 'colors'  => array(), |
| [2524](#L2524) | ); |
| [2525](#L2525) | foreach ( $\_POST['sections'] as $section ) { |
| [2526](#L2526) | switch ( $section ) { |
| [2527](#L2527) | case 'background': |
| [2528](#L2528) | $copy['content'][] = 'content\_background'; |
| [2529](#L2529) | $copy['design'][]  = 'background\_mode'; |
| [2530](#L2530) | $copy['design'][]  = 'background\_duration'; |
| [2531](#L2531) | $copy['design'][]  = 'background\_size'; |
| [2532](#L2532) | $copy['design'][]  = 'background\_size\_width'; |
| [2533](#L2533) | $copy['design'][]  = 'background\_size\_height'; |
| [2534](#L2534) | $copy['design'][]  = 'background\_focal'; |
| [2535](#L2535) | $copy['design'][]  = 'background\_crop'; |
| [2536](#L2536) | $copy['design'][]  = 'background\_crop\_width'; |
| [2537](#L2537) | $copy['design'][]  = 'background\_crop\_height'; |
| [2538](#L2538) | $copy['design'][]  = 'background\_crop\_width\_p'; |
| [2539](#L2539) | $copy['design'][]  = 'background\_crop\_height\_p'; |
| [2540](#L2540) | $copy['design'][]  = 'background\_attachment'; |
| [2541](#L2541) | $copy['design'][]  = 'background\_size'; |
| [2542](#L2542) | $copy['design'][]  = 'background\_size\_width'; |
| [2543](#L2543) | $copy['design'][]  = 'background\_size\_height'; |
| [2544](#L2544) | $copy['design'][]  = 'background\_position\_x'; |
| [2545](#L2545) | $copy['design'][]  = 'background\_position\_x\_custom'; |
| [2546](#L2546) | $copy['design'][]  = 'background\_position\_x\_units'; |
| [2547](#L2547) | $copy['design'][]  = 'background\_position\_y'; |
| [2548](#L2548) | $copy['design'][]  = 'background\_position\_y\_custom'; |
| [2549](#L2549) | $copy['design'][]  = 'background\_position\_y\_units'; |
| [2550](#L2550) | $copy['colors'][]  = 'background\_color'; |
| [2551](#L2551) | $copy['colors'][]  = 'document\_color'; |
| [2552](#L2552) | $copy['colors'][]  = 'document\_background'; |
| [2553](#L2553) | break; |
| [2554](#L2554) | case 'logo': |
| [2555](#L2555) | $copy['content'][] = 'logo\_show'; |
| [2556](#L2556) | $copy['content'][] = 'logo\_image'; |
| [2557](#L2557) | $copy['content'][] = 'logo\_url'; |
| [2558](#L2558) | $copy['content'][] = 'logo\_alt'; |
| [2559](#L2559) | $copy['content'][] = 'logo\_image\_meta'; |
| [2560](#L2560) | $copy['design'][]  = 'logo\_width'; |
| [2561](#L2561) | $copy['design'][]  = 'logo\_opacity'; |
| [2562](#L2562) | $copy['design'][]  = 'logo\_position'; |
| [2563](#L2563) | $copy['design'][]  = 'logo\_margin\_top'; |
| [2564](#L2564) | $copy['design'][]  = 'logo\_margin\_right'; |
| [2565](#L2565) | $copy['design'][]  = 'logo\_margin\_bottom'; |
| [2566](#L2566) | $copy['design'][]  = 'logo\_margin\_left'; |
| [2567](#L2567) | $copy['design'][]  = 'logo\_rounded'; |
| [2568](#L2568) | $copy['colors'][]  = 'document\_color'; |
| [2569](#L2569) | $copy['colors'][]  = 'document\_background'; |
| [2570](#L2570) | break; |
| [2571](#L2571) | case 'social\_media': |
| [2572](#L2572) | if ( |
| [2573](#L2573) | isset( $source\_module\_configuration['content'] ) |
| [2574](#L2574) | && is\_array( $source\_module\_configuration['content'] ) |
| [2575](#L2575) | ) { |
| [2576](#L2576) | foreach ( $source\_module\_configuration['content'] as $key => $value ) { |
| [2577](#L2577) | if ( ! preg\_match( '/^social\_media\_/', $key ) ) { |
| [2578](#L2578) | continue; |
| [2579](#L2579) | } |
| [2580](#L2580) | $target\_module\_configuration['content'][ $key ] = $value; |
| [2581](#L2581) | } |
| [2582](#L2582) | } |
| [2583](#L2583) | break; |
| [2584](#L2584) | case 'social\_media\_settings': |
| [2585](#L2585) | $copy['design'][] = 'social\_media\_show'; |
| [2586](#L2586) | $copy['design'][] = 'social\_media\_target'; |
| [2587](#L2587) | $copy['design'][] = 'social\_media\_colors'; |
| [2588](#L2588) | break; |
| [2589](#L2589) | default: |
| [2590](#L2590) | wp\_send\_json\_error( array( 'message' => $this->messages['wrong'] ) ); |
| [2591](#L2591) | } |
| [2592](#L2592) | } |
| [2593](#L2593) | foreach ( $copy as $group => $data ) { |
| [2594](#L2594) | if ( |
| [2595](#L2595) | ! isset( $target\_module\_configuration[ $group ] ) |
| [2596](#L2596) | || ! is\_array( $target\_module\_configuration[ $group ] ) |
| [2597](#L2597) | ) { |
| [2598](#L2598) | $target\_module\_configuration[ $group ] = array(); |
| [2599](#L2599) | } |
| [2600](#L2600) | foreach ( $data as $option ) { |
| [2601](#L2601) | if ( isset( $source\_module\_configuration[ $group ][ $option ] ) ) { |
| [2602](#L2602) | $target\_module\_configuration[ $group ][ $option ] = $source\_module\_configuration[ $group ][ $option ]; |
| [2603](#L2603) | } |
| [2604](#L2604) | } |
| [2605](#L2605) | } |
| [2606](#L2606) | $message = array( |
| [2607](#L2607) | 'type'    => 'success', |
| [2608](#L2608) | 'message' => sprintf( |
| [2609](#L2609) | \_\_( 'Module %s was updated.', 'ub' ), |
| [2610](#L2610) | $this->bold( $target\_module\_data['name'] ) |
| [2611](#L2611) | ), |
| [2612](#L2612) | ); |
| [2613](#L2613) | $this->add\_message( $message ); |
| [2614](#L2614) | branda\_update\_option( $target\_module\_data['options'][0], $target\_module\_configuration ); |
| [2615](#L2615) | wp\_send\_json\_success(); |
| [2616](#L2616) | } |
| [2617](#L2617) |  |
| [2618](#L2618) | /\*\* |
| [2619](#L2619) | \* Load dashboard |
| [2620](#L2620) | \* |
| [2621](#L2621) | \* @since 3.0.0 |
| [2622](#L2622) | \*/ |
| [2623](#L2623) | public function load\_dashboard() { |
| [2624](#L2624) | $modules = get\_branda\_activated\_modules( 'raw' ); |
| [2625](#L2625) | if ( empty( $modules ) ) { |
| [2626](#L2626) | $user\_id = get\_current\_user\_id(); |
| [2627](#L2627) | $show    = get\_user\_meta( $user\_id, 'show\_welcome\_dialog', true ); |
| [2628](#L2628) | $show    = empty( $show ); |
| [2629](#L2629) | if ( $show ) { |
| [2630](#L2630) | $this->show\_welcome\_dialog = true; |
| [2631](#L2631) | update\_user\_meta( $user\_id, 'show\_welcome\_dialog', 'hide' ); |
| [2632](#L2632) | } |
| [2633](#L2633) | } |
| [2634](#L2634) | } |
| [2635](#L2635) |  |
| [2636](#L2636) | /\*\* |
| [2637](#L2637) | \* Branda Welcome! |
| [2638](#L2638) | \* |
| [2639](#L2639) | \* @since 3.0.0 |
| [2640](#L2640) | \*/ |
| [2641](#L2641) | public function ajax\_welcome() { |
| [2642](#L2642) | //$nonce = filter\_input( INPUT\_POST, 'nonce', FILTER\_SANITIZE\_STRING ); |
| [2643](#L2643) | $nonce = ! empty( $\_POST['nonce'] ) ? sanitize\_text\_field( $\_POST['nonce'] ) : null; |
| [2644](#L2644) |  |
| [2645](#L2645) | if ( ! wp\_verify\_nonce( $nonce, 'branda-welcome-all-modules' ) ) { |
| [2646](#L2646) | $args = array( |
| [2647](#L2647) | 'message' => $this->messages['security'], |
| [2648](#L2648) | ); |
| [2649](#L2649) | wp\_send\_json\_error( $args ); |
| [2650](#L2650) | } |
| [2651](#L2651) | $args     = array( |
| [2652](#L2652) | 'dialog\_id' => 'branda-welcome', |
| [2653](#L2653) | 'modules'   => $this->get\_modules\_stats(), |
| [2654](#L2654) | 'groups'    => branda\_get\_groups\_list(), |
| [2655](#L2655) | ); |
| [2656](#L2656) | $template = 'admin/dashboard/welcome-modules'; |
| [2657](#L2657) | $args     = array( |
| [2658](#L2658) | 'content'     => $this->render( $template, $args, true ), |
| [2659](#L2659) | 'title'       => esc\_html\_\_( 'Activate Modules', 'ub' ), |
| [2660](#L2660) | 'description' => esc\_html\_\_( 'Choose the modules you want to activate. Each module helps you white label a specific part of your website. If you’re not sure or forget to activate any module now, you can always do that later.', 'ub' ), |
| [2661](#L2661) | ); |
| [2662](#L2662) | wp\_send\_json\_success( $args ); |
| [2663](#L2663) | } |
| [2664](#L2664) |  |
| [2665](#L2665) | /\*\* |
| [2666](#L2666) | \* Check if high contrast mode is enabled. |
| [2667](#L2667) | \* |
| [2668](#L2668) | \* For the accessibility support, enable/disable |
| [2669](#L2669) | \* high contrast support on admin area. |
| [2670](#L2670) | \* |
| [2671](#L2671) | \* @since 3.0.0 |
| [2672](#L2672) | \* |
| [2673](#L2673) | \* @return bool |
| [2674](#L2674) | \*/ |
| [2675](#L2675) | private function high\_contrast\_mode() { |
| [2676](#L2676) | // Get accessibility settings. |
| [2677](#L2677) | $accessibility\_options = branda\_get\_option( 'ub\_accessibility', array() ); |
| [2678](#L2678) | if ( isset( $accessibility\_options['accessibility']['high\_contrast'] ) |
| [2679](#L2679) | && 'on' === $accessibility\_options['accessibility']['high\_contrast'] ) { |
| [2680](#L2680) | return true; |
| [2681](#L2681) | } |
| [2682](#L2682) | return false; |
| [2683](#L2683) | } |
| [2684](#L2684) |  |
| [2685](#L2685) | /\*\* |
| [2686](#L2686) | \* Common hooks for all screens |
| [2687](#L2687) | \* |
| [2688](#L2688) | \* @since 3.0.1 |
| [2689](#L2689) | \*/ |
| [2690](#L2690) | public function add\_action\_hooks() { |
| [2691](#L2691) | // Filter built-in wpmudev branding script. |
| [2692](#L2692) | //add\_filter( 'wpmudev\_whitelabel\_plugin\_pages', array( $this, 'builtin\_wpmudev\_branding' ) ); |
| [2693](#L2693) | } |
| [2694](#L2694) |  |
| [2695](#L2695) | /\*\* |
| [2696](#L2696) | \* Add more pages to builtin wpmudev branding. |
| [2697](#L2697) | \* |
| [2698](#L2698) | \* @since 3.0.1 |
| [2699](#L2699) | \* |
| [2700](#L2700) | \* @param array $plugin\_pages Nextgen pages is not introduced in built in wpmudev branding. |
| [2701](#L2701) | \* |
| [2702](#L2702) | \* @return array |
| [2703](#L2703) | \*/ |
| [2704](#L2704) | public function builtin\_wpmudev\_branding( $plugin\_pages ) { |
| [2705](#L2705) | global $hook\_suffix; |
| [2706](#L2706) | if ( strpos( $hook\_suffix, '\_page\_branding' ) ) { |
| [2707](#L2707) | $plugin\_pages[ $hook\_suffix ] = array( |
| [2708](#L2708) | 'wpmudev\_whitelabel\_sui\_plugins\_branding', |
| [2709](#L2709) | 'wpmudev\_whitelabel\_sui\_plugins\_footer', |
| [2710](#L2710) | 'wpmudev\_whitelabel\_sui\_plugins\_doc\_links', |
| [2711](#L2711) | ); |
| [2712](#L2712) | } |
| [2713](#L2713) | return $plugin\_pages; |
| [2714](#L2714) | } |
| [2715](#L2715) |  |
| [2716](#L2716) | /\*\* |
| [2717](#L2717) | \* Handle Branda SUI wrapper container classes. |
| [2718](#L2718) | \* |
| [2719](#L2719) | \* @since 3.0.6 |
| [2720](#L2720) | \*/ |
| [2721](#L2721) | public function add\_sui\_wrap\_classes( $classes ) { |
| [2722](#L2722) | if ( is\_string( $classes ) ) { |
| [2723](#L2723) | $classes = array( $classes ); |
| [2724](#L2724) | } |
| [2725](#L2725) | if ( ! is\_array( $classes ) ) { |
| [2726](#L2726) | $classes = array(); |
| [2727](#L2727) | } |
| [2728](#L2728) | $classes[] = 'sui-wrap'; |
| [2729](#L2729) | $classes[] = 'sui-wrap-branda'; |
| [2730](#L2730) | /\*\* |
| [2731](#L2731) | \* Add high contrast mode. |
| [2732](#L2732) | \*/ |
| [2733](#L2733) | $is\_high\_contrast\_mode = $this->high\_contrast\_mode(); |
| [2734](#L2734) | if ( $is\_high\_contrast\_mode ) { |
| [2735](#L2735) | $classes[] = 'sui-color-accessible'; |
| [2736](#L2736) | } |
| [2737](#L2737) | /\*\* |
| [2738](#L2738) | \* Set hide branding |
| [2739](#L2739) | \* |
| [2740](#L2740) | \* @since 3.0.6 |
| [2741](#L2741) | \*/ |
| [2742](#L2742) | $hide\_branding = apply\_filters( 'wpmudev\_branding\_hide\_branding', $this->hide\_branding ); |
| [2743](#L2743) | if ( $hide\_branding ) { |
| [2744](#L2744) | $classes[] = 'no-branda'; |
| [2745](#L2745) | } |
| [2746](#L2746) | return $classes; |
| [2747](#L2747) | } |
| [2748](#L2748) |  |
| [2749](#L2749) | /\*\* |
| [2750](#L2750) | \* Delete image from modules, when it is deleted from WordPress |
| [2751](#L2751) | \* |
| [2752](#L2752) | \* @since 3.1.0 |
| [2753](#L2753) | \*/ |
| [2754](#L2754) | public function delete\_attachment\_from\_configs( $attachemnt\_id ) { |
| [2755](#L2755) | $affected\_modules = array( |
| [2756](#L2756) | 'admin-bar', |
| [2757](#L2757) | 'db-error-page', |
| [2758](#L2758) | 'login-screen', |
| [2759](#L2759) | 'ms-site-check', |
| [2760](#L2760) | 'images', |
| [2761](#L2761) | 'maintenance', |
| [2762](#L2762) | ); |
| [2763](#L2763) | foreach ( $this->configuration as $module ) { |
| [2764](#L2764) | if ( ! in\_array( $module['module'], $affected\_modules ) ) { |
| [2765](#L2765) | continue; |
| [2766](#L2766) | } |
| [2767](#L2767) | if ( ! isset( $module['options'] ) ) { |
| [2768](#L2768) | continue; |
| [2769](#L2769) | } |
| [2770](#L2770) | foreach ( $module['options'] as $option\_name ) { |
| [2771](#L2771) | $value = branda\_get\_option( $option\_name ); |
| [2772](#L2772) | if ( empty( $value ) ) { |
| [2773](#L2773) | continue; |
| [2774](#L2774) | } |
| [2775](#L2775) | $update = false; |
| [2776](#L2776) | foreach ( $value as $group => $group\_data ) { |
| [2777](#L2777) | if ( ! is\_array( $group\_data ) ) { |
| [2778](#L2778) | continue; |
| [2779](#L2779) | } |
| [2780](#L2780) | foreach ( $group\_data as $key => $field ) { |
| [2781](#L2781) | switch ( $key ) { |
| [2782](#L2782) | /\*\* |
| [2783](#L2783) | \* Single image |
| [2784](#L2784) | \*/ |
| [2785](#L2785) | case 'favicon': |
| [2786](#L2786) | case 'logo\_image': |
| [2787](#L2787) | case 'logo': |
| [2788](#L2788) | $field = intval( $field ); |
| [2789](#L2789) | if ( $attachemnt\_id === $field ) { |
| [2790](#L2790) | $update = true; |
| [2791](#L2791) | unset( $value[ $group ][ $key ] ); |
| [2792](#L2792) | $key .= '\_meta'; |
| [2793](#L2793) | if ( isset( $value[ $group ][ $key ] ) ) { |
| [2794](#L2794) | unset( $value[ $group ][ $key ] ); |
| [2795](#L2795) | } |
| [2796](#L2796) | } |
| [2797](#L2797) | break; |
| [2798](#L2798) | /\*\* |
| [2799](#L2799) | \* Background |
| [2800](#L2800) | \*/ |
| [2801](#L2801) | case 'content\_background': |
| [2802](#L2802) | if ( is\_array( $field ) ) { |
| [2803](#L2803) | foreach ( $field as $index => $one ) { |
| [2804](#L2804) | $id = isset( $one['value'] ) ? intval( $one['value'] ) : 0; |
| [2805](#L2805) | if ( $attachemnt\_id === $id ) { |
| [2806](#L2806) | if ( isset( $value[ $group ][ $key ] ) ) { |
| [2807](#L2807) | $update = true; |
| [2808](#L2808) | unset( $value[ $group ][ $key ][ $index ] ); |
| [2809](#L2809) | } |
| [2810](#L2810) | } |
| [2811](#L2811) | } |
| [2812](#L2812) | } |
| [2813](#L2813) | break; |
| [2814](#L2814) | default: |
| [2815](#L2815) | } |
| [2816](#L2816) | } |
| [2817](#L2817) | } |
| [2818](#L2818) | if ( $update ) { |
| [2819](#L2819) | branda\_update\_option( $option\_name, $value ); |
| [2820](#L2820) | } |
| [2821](#L2821) | } |
| [2822](#L2822) | } |
| [2823](#L2823) | } |
| [2824](#L2824) |  |
| [2825](#L2825) | /\*\* |
| [2826](#L2826) | \* Should be shown "Manage All Modules" button? |
| [2827](#L2827) | \* It's depends. |
| [2828](#L2828) | \* |
| [2829](#L2829) | \* @since 3.2.0 |
| [2830](#L2830) | \* |
| [2831](#L2831) | \* @return boolean $show To show, or not to show, that is the \* question. |
| [2832](#L2832) | \*/ |
| [2833](#L2833) | private function show\_manage\_all\_modules\_button() { |
| [2834](#L2834) | $show = true; |
| [2835](#L2835) | if ( $this->is\_network && ! $this->is\_network\_admin ) { |
| [2836](#L2836) | $show = false; |
| [2837](#L2837) | } |
| [2838](#L2838) | return apply\_filters( 'branda\_show\_manage\_all\_modules\_button', $show ); |
| [2839](#L2839) | } |
| [2840](#L2840) |  |
| [2841](#L2841) | /\*\* |
| [2842](#L2842) | \* Get inline style for box summary-image div |
| [2843](#L2843) | \* |
| [2844](#L2844) | \* @since 3.2.0 |
| [2845](#L2845) | \* @return string |
| [2846](#L2846) | \*/ |
| [2847](#L2847) | public function get\_box\_summary\_image\_style() { |
| [2848](#L2848) | $image\_url = apply\_filters( 'wpmudev\_branding\_hero\_image', null ); |
| [2849](#L2849) | if ( ! empty( $image\_url ) ) { |
| [2850](#L2850) | return 'background-image:url(' . esc\_url( $image\_url ) . ')'; |
| [2851](#L2851) | } |
| [2852](#L2852) | return ''; |
| [2853](#L2853) | } |
| [2854](#L2854) |  |
| [2855](#L2855) | /\*\* |
| [2856](#L2856) | \* Get modules with inline help |
| [2857](#L2857) | \* |
| [2858](#L2858) | \* @since 3.2.0 |
| [2859](#L2859) | \*/ |
| [2860](#L2860) | private function get\_helps\_list() { |
| [2861](#L2861) | $helps = array(); |
| [2862](#L2862) | $show  = true; |
| [2863](#L2863) | if ( $this->is\_network && ! $this->is\_network\_admin ) { |
| [2864](#L2864) | $show = false; |
| [2865](#L2865) | } |
| [2866](#L2866) | if ( $show ) { |
| [2867](#L2867) | $helps[] = 'dashboard'; |
| [2868](#L2868) | } |
| [2869](#L2869) | foreach ( $this->configuration as $id => $module ) { |
| [2870](#L2870) | if ( isset( $module['has-help'] ) && $module['has-help'] ) { |
| [2871](#L2871) | $show = true; |
| [2872](#L2872) | if ( $this->is\_network && ! $this->is\_network\_admin ) { |
| [2873](#L2873) | $show = apply\_filters( 'branda\_module\_check\_for\_subsite', false, $id, $module ); |
| [2874](#L2874) | } |
| [2875](#L2875) | if ( $show ) { |
| [2876](#L2876) | $helps[] = sprintf( 'modules/%s', sanitize\_title( $module['module'] ) ); |
| [2877](#L2877) | } |
| [2878](#L2878) | } |
| [2879](#L2879) | } |
| [2880](#L2880) | return $helps; |
| [2881](#L2881) | } |
| [2882](#L2882) |  |
| [2883](#L2883) | /\*\* |
| [2884](#L2884) | \* Helper to get network admin permissions settings page. |
| [2885](#L2885) | \* |
| [2886](#L2886) | \* @since 3.2.0 |
| [2887](#L2887) | \*/ |
| [2888](#L2888) | private function get\_network\_permissions\_url() { |
| [2889](#L2889) | $url = add\_query\_arg( |
| [2890](#L2890) | array( |
| [2891](#L2891) | 'page'   => 'branding\_group\_data', |
| [2892](#L2892) | 'module' => 'permissions', |
| [2893](#L2893) | ), |
| [2894](#L2894) | network\_admin\_url( 'admin.php' ) |
| [2895](#L2895) | ); |
| [2896](#L2896) | return $url; |
| [2897](#L2897) | } |
| [2898](#L2898) | } |
| [2899](#L2899) | } |

**Note:** See [TracBrowser](/wiki/TracBrowser)
for help on using the repository browser.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Plain Text](/browser/branda-white-labeling/tags/3.4.19/inc/class-branda-admin.php?format=txt)
* [Original Format](/export/3222476/branda-white-labeling/tags/3.4.19/inc/class-branda-admin.php)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from www.wordfence.com_da0cd9a5_20250114_210510.html ===


[![](https://www.wordfence.com/img/wordfence-intelligence-logo.svg)](/threat-intel/)

Have you found a vulnerability in a WordPress plugin or theme? Report vulnerabilities in WordPress plugins and themes through our [bug bounty program](https://www.wordfence.com/threat-intel/bug-bounty-program) and earn a bounty on all in-scope submissions, while we handle the responsible disclosure process on your behalf.

As a reminder, the Wordfence Intelligence Vulnerability Database API is completely free to query and utilize, both personally and commercially, and contains all the same vulnerability data as the user interface. Please review the API documentation and Webhook documentation for more information on how to query the vulnerability API endpoints and configure webhooks utilizing all the same data present in the Wordfence Intelligence user interface.

# Branda – White Label & Branding, Custom Login Page Customizer <= 3.4.19 - Reflected Cross-Site Scripting

 [Wordfence Intelligence](https://www.wordfence.com/threat-intel)   >    [Vulnerability Database](https://www.wordfence.com/threat-intel/vulnerabilities)   >   Branda – White Label & Branding, Custom Login Page Customizer <= 3.4.19 - Reflected Cross-Site Scripting

6.1

**Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')**
**CVSS Vector**
[CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N)

| CVE | [CVE-2024-9371](https://www.cve.org/CVERecord?id=CVE-2024-9371) |
| --- | --- |
| CVSS | 6.1 (Medium) |
| Publicly Published | November 20, 2024 |
| Last Updated | November 21, 2024 |
| Researcher | [vgo0](https://www.wordfence.com/threat-intel/vulnerabilities/researchers/dale-mavers) |

### Description

The Branda – White Label & Branding, Custom Login Page Customizer plugin for WordPress is vulnerable to Reflected Cross-Site Scripting due to the use of remove\_query\_arg without appropriate escaping on the URL in all versions up to, and including, 3.4.19. This makes it possible for unauthenticated attackers to inject arbitrary web scripts in pages that execute if they can successfully trick a user into performing an action such as clicking on a link.

#### References

* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/browser/branda-white-labeling/tags/3.4.19/inc/class-branda-admin.php#L1871)
* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/changeset?sfp_email=&sfph_mail=&reponame=&old=3191895%40branda-white-labeling&new=3191895%40branda-white-labeling&sfp_email=&sfph_mail=)

#### Share

[Facebook](https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fbranda-white-labeling%2Fbranda-white-label-branding-custom-login-page-customizer-3419-reflected-cross-site-scripting&t=Branda%20%E2%80%93%20White%20Label%20%26%20Branding%2C%20Custom%20Login%20Page%20Customizer%20%3C%3D%203.4.19%20-%20Reflected%20Cross-Site%20Scripting "Facebook")
[Twitter](https://twitter.com/share?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fbranda-white-labeling%2Fbranda-white-label-branding-custom-login-page-customizer-3419-reflected-cross-site-scripting&text=Branda%20%E2%80%93%20White%20Label%20%26%20Branding%2C%20Custom%20Login%20Page%20Customizer%20%3C%3D%203.4.19%20-%20Reflected%20Cross-Site%20Scripting "Twitter")
[LinkedIn](https://www.linkedin.com/shareArticle?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fbranda-white-labeling%2Fbranda-white-label-branding-custom-login-page-customizer-3419-reflected-cross-site-scripting "LinkedIn")
Email

## Vulnerability Details for Branda – Branda – White Label & Branding, Custom Login Page Customizer

#### [Branda – Branda – White Label & Branding, Custom Login Page Customizer](https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/branda-white-labeling)

| Software Type | Plugin |
| --- | --- |
| Software Slug | branda-white-labeling [(view on wordpress.org)](https://wordpress.org/plugins/branda-white-labeling) |
| Patched? | Yes |
| Remediation | Update to version 3.4.22, or a newer patched version |
| Affected Version | * <= 3.4.21 |
| Patched Version | * 3.4.22 |

This record contains material that is subject to copyright.

**Copyright 2012-2025 Defiant Inc.**

**License:**
Defiant hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute this software vulnerability information. Any copy of the software vulnerability information you make for such purposes is authorized provided that you include a hyperlink to this vulnerability record and reproduce Defiant's copyright designation and this license in any such copy.
**[Read more.](https://www.wordfence.com/wordfence-intelligence-terms-and-conditions/)**

**Copyright 1999-2025 The MITRE Corporation**

**License:**
CVE Usage: MITRE hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute Common Vulnerabilities and Exposures (CVE®). Any copy you make for such purposes is authorized provided that you reproduce MITRE's copyright designation and this license in any such copy.
**[Read more.](https://www.cve.org/Legal/TermsOfUse)**

Have information to add, or spot any errors? Contact us at wfi-support@wordfence.com so we can make any appropriate adjustments.

Did you know Wordfence Intelligence provides free personal and commercial API access to our comprehensive WordPress vulnerability database, along with a free webhook integration to stay on top of the latest vulnerabilities added and updated in the database? Get started today!

Learn more

Want to get notified of the latest vulnerabilities that may affect your WordPress site?
 Install Wordfence on your site today to get notified immediately if your site is affected by a vulnerability that has been added to our database.

Get Wordfence

The Wordfence Intelligence WordPress vulnerability database is completely free to access and query via API. Please review the documentation on how to access and consume the vulnerability data via API.

Documentation



=== Content from plugins.trac.wordpress.org_047073d2_20250114_210508.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fchangeset%3Fnew%3D3191895%2540branda-white-labeling%26old%3D3191895%2540branda-white-labeling)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Change](/changeset/3185583/branda-white-labeling "Changeset 3185583 for branda-white-labeling")
* [Next Change](/changeset/3191983/branda-white-labeling "Changeset 3191983 for branda-white-labeling") →

---

# Changeset [3191895](/changeset/3191895 "Show full changeset") for [branda-white-labeling](/browser/branda-white-labeling?rev=3191895 "Show entry in browser")

View differences
inline
side by side

Show
lines around each change

Show the changes in full context

Ignore:

Blank lines

Case changes

White space changes

Timestamp:
11/19/2024 07:24:05 AM
([8 weeks](/timeline?from=2024-11-19T07%3A24%3A05Z&precision=second "See timeline at 11/19/2024 07:24:05 AM") ago)

Author:
panoslyrakis
Message:

Update Version 3.4.22

Location:
[branda-white-labeling](/browser/branda-white-labeling?rev=3191895)
Files:

8 edited
1 copied

* [tags/3.4.22](/browser/branda-white-labeling/tags/3.4.22?rev=3191895 "Show entry in browser")
  (copied)
  *(copied from [branda-white-labeling/trunk](/browser/branda-white-labeling/trunk?rev=3185583 "Show original file (revision 3191850)"))*
* [tags/3.4.22/inc/class-branda-admin.php](/browser/branda-white-labeling/tags/3.4.22/inc/class-branda-admin.php?rev=3191895 "Show entry in browser")
  (modified)
  ([1 diff](#file1 "Show differences"))
* [tags/3.4.22/languages/ub.pot](/browser/branda-white-labeling/tags/3.4.22/languages/ub.pot?rev=3191895 "Show entry in browser")
  (modified)
  ([2 diffs](#file2 "Show differences"))
* [tags/3.4.22/readme.txt](/browser/branda-white-labeling/tags/3.4.22/readme.txt?rev=3191895 "Show entry in browser")
  (modified)
  ([3 diffs](#file3 "Show differences"))
* [tags/3.4.22/ultimate-branding.php](/browser/branda-white-labeling/tags/3.4.22/ultimate-branding.php?rev=3191895 "Show entry in browser")
  (modified)
  ([1 diff](#file4 "Show differences"))
* [trunk/inc/class-branda-admin.php](/browser/branda-white-labeling/trunk/inc/class-branda-admin.php?rev=3191895 "Show entry in browser")
  (modified)
  ([1 diff](#file5 "Show differences"))
* [trunk/languages/ub.pot](/browser/branda-white-labeling/trunk/languages/ub.pot?rev=3191895 "Show entry in browser")
  (modified)
  ([2 diffs](#file6 "Show differences"))
* [trunk/readme.txt](/browser/branda-white-labeling/trunk/readme.txt?rev=3191895 "Show entry in browser")
  (modified)
  ([3 diffs](#file7 "Show differences"))
* [trunk/ultimate-branding.php](/browser/branda-white-labeling/trunk/ultimate-branding.php?rev=3191895 "Show entry in browser")
  (modified)
  ([1 diff](#file8 "Show differences"))

### Legend:

Unmodified
Added
Removed

* ## [branda-white-labeling/tags/3.4.22/inc/class-branda-admin.php](/changeset/3191895/branda-white-labeling/tags/3.4.22/inc/class-branda-admin.php "Show the changeset 3191895 restricted to branda-white-labeling/tags/3.4.22/inc/class-branda-admin.php")

  | [r3042684](/browser/branda-white-labeling/trunk/inc/class-branda-admin.php?rev=3042684#L1871 "Show revision 3042684 of this file in browser") | [r3191895](/browser/branda-white-labeling/tags/3.4.22/inc/class-branda-admin.php?rev=3191895#L1871 "Show revision 3191895 of this file in browser") |  |
  | --- | --- | --- |
  | 1871 | 1871 | $content .= sprintf( |
  | 1872 | 1872 | '<form action="%s" method="%s" class="module-%s"%s>', |
  | 1873 |  | ~~remove\_query\_arg( array( 'module'~~ ) ), |
  |  | 1873 | esc\_url( remove\_query\_arg( array( 'module' ) ) ), |
  | 1874 | 1874 | apply\_filters( 'ultimatebranding\_settings\_form\_method', 'post' ), |
  | 1875 | 1875 | esc\_attr( implode( ' ', $classes ) ), |
* ## [branda-white-labeling/tags/3.4.22/languages/ub.pot](/changeset/3191895/branda-white-labeling/tags/3.4.22/languages/ub.pot "Show the changeset 3191895 restricted to branda-white-labeling/tags/3.4.22/languages/ub.pot")

  | [r3185539](/browser/branda-white-labeling/trunk/languages/ub.pot?rev=3185539#L3 "Show revision 3185539 of this file in browser") | [r3191895](/browser/branda-white-labeling/tags/3.4.22/languages/ub.pot?rev=3191895#L3 "Show revision 3191895 of this file in browser") |  |
  | --- | --- | --- |
  | 3 | 3 | msgid "" |
  | 4 | 4 | msgstr "" |
  | 5 |  | "Project-Id-Version: Branda Pro 3.4.2~~1~~\n" |
  |  | 5 | "Project-Id-Version: Branda Pro 3.4.22\n" |
  | 6 | 6 | "Report-Msgid-Bugs-To: https://wordpress.org/support/plugin/ultimate-branding\n" |
  | 7 | 7 | "Last-Translator: FULL NAME <EMAIL@ADDRESS>\n" |
  | […](/browser/branda-white-labeling/trunk/languages/ub.pot?rev=3185539#L10) | […](/browser/branda-white-labeling/tags/3.4.22/languages/ub.pot?rev=3191895#L10) |  |
  | 10 | 10 | "Content-Type: text/plain; charset=UTF-8\n" |
  | 11 | 11 | "Content-Transfer-Encoding: 8bit\n" |
  | 12 |  | "POT-Creation-Date: 2024-11-0~~2T20:38:20~~+00:00\n" |
  |  | 12 | "POT-Creation-Date: 2024-11-03T07:38:22+00:00\n" |
  | 13 | 13 | "PO-Revision-Date: YEAR-MO-DA HO:MI+ZONE\n" |
  | 14 | 14 | "X-Generator: WP-CLI 2.11.0\n" |
* ## [branda-white-labeling/tags/3.4.22/readme.txt](/changeset/3191895/branda-white-labeling/tags/3.4.22/readme.txt "Show the changeset 3191895 restricted to branda-white-labeling/tags/3.4.22/readme.txt")

  | [r3185583](/browser/branda-white-labeling/trunk/readme.txt?rev=3185583#L1 "Show revision 3185583 of this file in browser") | [r3191895](/browser/branda-white-labeling/tags/3.4.22/readme.txt?rev=3191895#L1 "Show revision 3191895 of this file in browser") |  |
  | --- | --- | --- |
  | 1 | 1 | === Branda – Branda – White Label & Branding, Custom Login Page Customizer === |
  | 2 | 2 | Plugin Name: Branda – White Label & Branding, Custom Login Page Customizer |
  | 3 |  | Version: 3.4.2~~1~~ |
  |  | 3 | Version: 3.4.22 |
  | 4 | 4 | Author: WPMU DEV |
  | 5 | 5 | Author URI: https://profiles.wordpress.org/wpmudev/ |
  | […](/browser/branda-white-labeling/trunk/readme.txt?rev=3185583#L7) | […](/browser/branda-white-labeling/tags/3.4.22/readme.txt?rev=3191895#L7) |  |
  | 7 | 7 | Tags: white label wordpress, custom login page, login page customizer, whitelabel, customize system emails, customize default emails, rebrand, rebranding, coming soon page, maintenance mode, under construction page, coming soon template, login screen |
  | 8 | 8 | Requires at least: 6.4 |
  | 9 |  | Tested up to: 6.~~6~~ |
  |  | 9 | Tested up to: 6.7 |
  | 10 | 10 | Stable tag: 3.4.21 |
  | 11 | 11 | Requires PHP: 7.4 |
  | […](/browser/branda-white-labeling/trunk/readme.txt?rev=3185583#L170) | […](/browser/branda-white-labeling/tags/3.4.22/readme.txt?rev=3191895#L170) |  |
  | 170 | 170 |  |
  | 171 | 171 | == Changelog == |
  |  | 172 | = 3.4.22 ( 2024-11-19 ) = |
  |  | 173 | Enhance: Security improvements. |
  |  | 174 |  |
  | 172 | 175 | = 3.4.21 ( 2024-11-11 ) = |
  | 173 | 176 | Fix: SVG warnings in Admin bar logos. |
* ## [branda-white-labeling/tags/3.4.22/ultimate-branding.php](/changeset/3191895/branda-white-labeling/tags/3.4.22/ultimate-branding.php "Show the changeset 3191895 restricted to branda-white-labeling/tags/3.4.22/ultimate-branding.php")

  | [r3185539](/browser/branda-white-labeling/trunk/ultimate-branding.php?rev=3185539#L5 "Show revision 3185539 of this file in browser") | [r3191895](/browser/branda-white-labeling/tags/3.4.22/ultimate-branding.php?rev=3191895#L5 "Show revision 3191895 of this file in browser") |  |
  | --- | --- | --- |
  | 5 | 5 | Description: A complete white label and branding solution for multisite. Login images, favicons, remove WordPress links and branding, and much more. |
  | 6 | 6 | Author: WPMU DEV |
  | 7 |  | Version: 3.4.2~~1~~ |
  |  | 7 | Version: 3.4.22 |
  | 8 | 8 | Author URI: https://profiles.wordpress.org/wpmudev/ |
  | 9 | 9 | Requires PHP: 7.4 |
* ## [branda-white-labeling/trunk/inc/class-branda-admin.php](/changeset/3191895/branda-white-labeling/trunk/inc/class-branda-admin.php "Show the changeset 3191895 restricted to branda-white-labeling/trunk/inc/class-branda-admin.php")

  | [r3042684](/browser/branda-white-labeling/trunk/inc/class-branda-admin.php?rev=3042684#L1871 "Show revision 3042684 of this file in browser") | [r3191895](/browser/branda-white-labeling/trunk/inc/class-branda-admin.php?rev=3191895#L1871 "Show revision 3191895 of this file in browser") |  |
  | --- | --- | --- |
  | 1871 | 1871 | $content .= sprintf( |
  | 1872 | 1872 | '<form action="%s" method="%s" class="module-%s"%s>', |
  | 1873 |  | ~~remove\_query\_arg( array( 'module'~~ ) ), |
  |  | 1873 | esc\_url( remove\_query\_arg( array( 'module' ) ) ), |
  | 1874 | 1874 | apply\_filters( 'ultimatebranding\_settings\_form\_method', 'post' ), |
  | 1875 | 1875 | esc\_attr( implode( ' ', $classes ) ), |
* ## [branda-white-labeling/trunk/languages/ub.pot](/changeset/3191895/branda-white-labeling/trunk/languages/ub.pot "Show the changeset 3191895 restricted to branda-white-labeling/trunk/languages/ub.pot")

  | [r3185539](/browser/branda-white-labeling/trunk/languages/ub.pot?rev=3185539#L3 "Show revision 3185539 of this file in browser") | [r3191895](/browser/branda-white-labeling/trunk/languages/ub.pot?rev=3191895#L3 "Show revision 3191895 of this file in browser") |  |
  | --- | --- | --- |
  | 3 | 3 | msgid "" |
  | 4 | 4 | msgstr "" |
  | 5 |  | "Project-Id-Version: Branda Pro 3.4.2~~1~~\n" |
  |  | 5 | "Project-Id-Version: Branda Pro 3.4.22\n" |
  | 6 | 6 | "Report-Msgid-Bugs-To: https://wordpress.org/support/plugin/ultimate-branding\n" |
  | 7 | 7 | "Last-Translator: FULL NAME <EMAIL@ADDRESS>\n" |
  | […](/browser/branda-white-labeling/trunk/languages/ub.pot?rev=3185539#L10) | […](/browser/branda-white-labeling/trunk/languages/ub.pot?rev=3191895#L10) |  |
  | 10 | 10 | "Content-Type: text/plain; charset=UTF-8\n" |
  | 11 | 11 | "Content-Transfer-Encoding: 8bit\n" |
  | 12 |  | "POT-Creation-Date: 2024-11-0~~2T20:38:20~~+00:00\n" |
  |  | 12 | "POT-Creation-Date: 2024-11-03T07:38:22+00:00\n" |
  | 13 | 13 | "PO-Revision-Date: YEAR-MO-DA HO:MI+ZONE\n" |
  | 14 | 14 | "X-Generator: WP-CLI 2.11.0\n" |
* ## [branda-white-labeling/trunk/readme.txt](/changeset/3191895/branda-white-labeling/trunk/readme.txt "Show the changeset 3191895 restricted to branda-white-labeling/trunk/readme.txt")

  | [r3185583](/browser/branda-white-labeling/trunk/readme.txt?rev=3185583#L1 "Show revision 3185583 of this file in browser") | [r3191895](/browser/branda-white-labeling/trunk/readme.txt?rev=3191895#L1 "Show revision 3191895 of this file in browser") |  |
  | --- | --- | --- |
  | 1 | 1 | === Branda – Branda – White Label & Branding, Custom Login Page Customizer === |
  | 2 | 2 | Plugin Name: Branda – White Label & Branding, Custom Login Page Customizer |
  | 3 |  | Version: 3.4.2~~1~~ |
  |  | 3 | Version: 3.4.22 |
  | 4 | 4 | Author: WPMU DEV |
  | 5 | 5 | Author URI: https://profiles.wordpress.org/wpmudev/ |
  | […](/browser/branda-white-labeling/trunk/readme.txt?rev=3185583#L7) | […](/browser/branda-white-labeling/trunk/readme.txt?rev=3191895#L7) |  |
  | 7 | 7 | Tags: white label wordpress, custom login page, login page customizer, whitelabel, customize system emails, customize default emails, rebrand, rebranding, coming soon page, maintenance mode, under construction page, coming soon template, login screen |
  | 8 | 8 | Requires at least: 6.4 |
  | 9 |  | Tested up to: 6.~~6~~ |
  |  | 9 | Tested up to: 6.7 |
  | 10 | 10 | Stable tag: 3.4.21 |
  | 11 | 11 | Requires PHP: 7.4 |
  | […](/browser/branda-white-labeling/trunk/readme.txt?rev=3185583#L170) | […](/browser/branda-white-labeling/trunk/readme.txt?rev=3191895#L170) |  |
  | 170 | 170 |  |
  | 171 | 171 | == Changelog == |
  |  | 172 | = 3.4.22 ( 2024-11-19 ) = |
  |  | 173 | Enhance: Security improvements. |
  |  | 174 |  |
  | 172 | 175 | = 3.4.21 ( 2024-11-11 ) = |
  | 173 | 176 | Fix: SVG warnings in Admin bar logos. |
* ## [branda-white-labeling/trunk/ultimate-branding.php](/changeset/3191895/branda-white-labeling/trunk/ultimate-branding.php "Show the changeset 3191895 restricted to branda-white-labeling/trunk/ultimate-branding.php")

  | [r3185539](/browser/branda-white-labeling/trunk/ultimate-branding.php?rev=3185539#L5 "Show revision 3185539 of this file in browser") | [r3191895](/browser/branda-white-labeling/trunk/ultimate-branding.php?rev=3191895#L5 "Show revision 3191895 of this file in browser") |  |
  | --- | --- | --- |
  | 5 | 5 | Description: A complete white label and branding solution for multisite. Login images, favicons, remove WordPress links and branding, and much more. |
  | 6 | 6 | Author: WPMU DEV |
  | 7 |  | Version: 3.4.2~~1~~ |
  |  | 7 | Version: 3.4.22 |
  | 8 | 8 | Author URI: https://profiles.wordpress.org/wpmudev/ |
  | 9 | 9 | Requires PHP: 7.4 |

**Note:** See [TracChangeset](/wiki/TracChangeset)
for help on using the changeset viewer.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Unified Diff](?format=diff&new=3191895)
* [Zip Archive](?format=zip&new=3191895)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)


