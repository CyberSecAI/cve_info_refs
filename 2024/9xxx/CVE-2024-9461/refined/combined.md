=== Content from www.wordfence.com_39917046_20250114_191751.html ===


[![](https://www.wordfence.com/img/wordfence-intelligence-logo.svg)](/threat-intel/)

Have you found a vulnerability in a WordPress plugin or theme? Report vulnerabilities in WordPress plugins and themes through our [bug bounty program](https://www.wordfence.com/threat-intel/bug-bounty-program) and earn a bounty on all in-scope submissions, while we handle the responsible disclosure process on your behalf.

As a reminder, the Wordfence Intelligence Vulnerability Database API is completely free to query and utilize, both personally and commercially, and contains all the same vulnerability data as the user interface. Please review the API documentation and Webhook documentation for more information on how to query the vulnerability API endpoints and configure webhooks utilizing all the same data present in the Wordfence Intelligence user interface.

# Total Upkeep <= 1.16.6 - Authenticated (Administrator+) Remote Code Execution via Backup Settings

 [Wordfence Intelligence](https://www.wordfence.com/threat-intel)   >    [Vulnerability Database](https://www.wordfence.com/threat-intel/vulnerabilities)   >   Total Upkeep <= 1.16.6 - Authenticated (Administrator+) Remote Code Execution via Backup Settings

7.2

**Improper Neutralization of Special Elements used in an OS Command ('OS Command Injection')**
**CVSS Vector**
[CVSS:3.1/AV:N/AC:L/PR:H/UI:N/S:U/C:H/I:H/A:H](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:H/UI:N/S:U/C:H/I:H/A:H)

| CVE | [CVE-2024-9461](https://www.cve.org/CVERecord?id=CVE-2024-9461) |
| --- | --- |
| CVSS | 7.2 (High) |
| Publicly Published | November 26, 2024 |
| Last Updated | November 26, 2024 |
| Researcher | [Jonas Benjamin Friedli](https://www.wordfence.com/threat-intel/vulnerabilities/researchers/jonas-benjamin-friedli) |

### Description

The Total Upkeep – WordPress Backup Plugin plus Restore & Migrate by BoldGrid plugin for WordPress is vulnerable to Remote Code Execution in all versions up to, and including, 1.16.6 via the cron\_interval parameter. This is due to missing input validation and sanitization. This makes it possible for authenticated attackers, with Administrator-level access and above, to execute code on the server.

#### References

* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/browser/boldgrid-backup/tags/1.16.5/admin/class-boldgrid-backup-admin-settings.php#L748)

#### Share

[Facebook](https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fboldgrid-backup%2Ftotal-upkeep-1166-authenticated-administrator-remote-code-execution-via-backup-settings&t=Total%20Upkeep%20%3C%3D%201.16.6%20-%20Authenticated%20%28Administrator%2B%29%20Remote%20Code%20Execution%20via%20Backup%20Settings "Facebook")
[Twitter](https://twitter.com/share?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fboldgrid-backup%2Ftotal-upkeep-1166-authenticated-administrator-remote-code-execution-via-backup-settings&text=Total%20Upkeep%20%3C%3D%201.16.6%20-%20Authenticated%20%28Administrator%2B%29%20Remote%20Code%20Execution%20via%20Backup%20Settings "Twitter")
[LinkedIn](https://www.linkedin.com/shareArticle?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fboldgrid-backup%2Ftotal-upkeep-1166-authenticated-administrator-remote-code-execution-via-backup-settings "LinkedIn")
Email

## Vulnerability Details for Total Upkeep – WordPress Backup Plugin plus Restore & Migrate by BoldGrid

#### [Total Upkeep – WordPress Backup Plugin plus Restore & Migrate by BoldGrid](https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/boldgrid-backup)

| Software Type | Plugin |
| --- | --- |
| Software Slug | boldgrid-backup [(view on wordpress.org)](https://wordpress.org/plugins/boldgrid-backup) |
| Patched? | Yes |
| Remediation | Update to version 1.16.7, or a newer patched version |
| Affected Version | * <= 1.16.6 |
| Patched Version | * 1.16.7 |

This record contains material that is subject to copyright.

**Copyright 2012-2025 Defiant Inc.**

**License:**
Defiant hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute this software vulnerability information. Any copy of the software vulnerability information you make for such purposes is authorized provided that you include a hyperlink to this vulnerability record and reproduce Defiant's copyright designation and this license in any such copy.
**[Read more.](https://www.wordfence.com/wordfence-intelligence-terms-and-conditions/)**

**Copyright 1999-2025 The MITRE Corporation**

**License:**
CVE Usage: MITRE hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute Common Vulnerabilities and Exposures (CVE®). Any copy you make for such purposes is authorized provided that you reproduce MITRE's copyright designation and this license in any such copy.
**[Read more.](https://www.cve.org/Legal/TermsOfUse)**

Have information to add, or spot any errors? Contact us at wfi-support@wordfence.com so we can make any appropriate adjustments.

Did you know Wordfence Intelligence provides free personal and commercial API access to our comprehensive WordPress vulnerability database, along with a free webhook integration to stay on top of the latest vulnerabilities added and updated in the database? Get started today!

Learn more

Want to get notified of the latest vulnerabilities that may affect your WordPress site?
 Install Wordfence on your site today to get notified immediately if your site is affected by a vulnerability that has been added to our database.

Get Wordfence

The Wordfence Intelligence WordPress vulnerability database is completely free to access and query via API. Please review the documentation on how to access and consume the vulnerability data via API.

Documentation



=== Content from plugins.trac.wordpress.org_f82acf69_20250114_191749.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fbrowser%2Fboldgrid-backup%2Ftags%2F1.16.5%2Fadmin%2Fclass-boldgrid-backup-admin-settings.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Revision](/browser/boldgrid-backup/tags/1.16.0/admin/class-boldgrid-backup-admin-settings.php?rev=3041523 "Revision 3041523")
* Next Revision →
* [Blame](/browser/boldgrid-backup/tags/1.16.0/admin/class-boldgrid-backup-admin-settings.php?annotate=blame "Annotate each line with the last changed revision (this can be time consuming...)")
* [Revision Log](/log/boldgrid-backup/tags/1.16.5/admin/class-boldgrid-backup-admin-settings.php)

---

# [source:](/browser?order=name "Go to repository root") [boldgrid-backup](/browser/boldgrid-backup?order=name "View boldgrid-backup")/[tags](/browser/boldgrid-backup/tags?order=name "View tags")/[1.16.5](/browser/boldgrid-backup/tags/1.16.5?order=name "View 1.16.5")/[admin](/browser/boldgrid-backup/tags/1.16.5/admin?order=name "View admin")/[class-boldgrid-backup-admin-settings.php](/browser/boldgrid-backup/tags/1.16.5/admin/class-boldgrid-backup-admin-settings.php?order=name "View class-boldgrid-backup-admin-settings.php")

View diff against:

View revision:

| [Last change](/changeset/3041525/boldgrid-backup/tags/1.16.0/admin/class-boldgrid-backup-admin-settings.php "View differences") on this file was [3041525](/changeset/3041525/ "View changeset 3041525"), checked in by boldgrid, [11 months ago](/timeline?from=2024-02-26T20%3A46%3A39Z&precision=second "See timeline at 02/26/2024 08:46:39 PM") |
| --- |
| Release 1.16.0, see readme.txt for the changelog. |
| **File size:** 34.1 KB | |

| Line |  |
| --- | --- |
| [1](#L1) | <?php |
| [2](#L2) | /\*\* |
| [3](#L3) | \* File: class-boldgrid-backup-admin-settings.php |
| [4](#L4) | \* |
| [5](#L5) | \* @link https://www.boldgrid.com |
| [6](#L6) | \* @since 1.0 |
| [7](#L7) | \* |
| [8](#L8) | \* @package    Boldgrid\_Backup |
| [9](#L9) | \* @subpackage Boldgrid\_Backup/admin |
| [10](#L10) | \* @copyright  BoldGrid |
| [11](#L11) | \* @version    $Id$ |
| [12](#L12) | \* @author     BoldGrid <support@boldgrid.com> |
| [13](#L13) | \*/ |
| [14](#L14) |  |
| [15](#L15) | use \Boldgrid\Library\Library\Notice; |
| [16](#L16) |  |
| [17](#L17) | // phpcs:disable WordPress.VIP |
| [18](#L18) |  |
| [19](#L19) | /\*\* |
| [20](#L20) | \* Class: Boldgrid\_Backup\_Admin\_Settings |
| [21](#L21) | \* |
| [22](#L22) | \* @since 1.0 |
| [23](#L23) | \*/ |
| [24](#L24) | class Boldgrid\_Backup\_Admin\_Settings { |
| [25](#L25) | /\*\* |
| [26](#L26) | \* The core class object. |
| [27](#L27) | \* |
| [28](#L28) | \* @since 1.0 |
| [29](#L29) | \* @access private |
| [30](#L30) | \* @var Boldgrid\_Backup\_Admin\_Core |
| [31](#L31) | \*/ |
| [32](#L32) | private $core; |
| [33](#L33) |  |
| [34](#L34) | /\*\* |
| [35](#L35) | \* Whether or not we're in the middle of saving settings from $\_POST. |
| [36](#L36) | \* |
| [37](#L37) | \* @since 1.6.0 |
| [38](#L38) | \* @access public |
| [39](#L39) | \* @var    bool |
| [40](#L40) | \*/ |
| [41](#L41) | public $is\_saving\_settings = false; |
| [42](#L42) |  |
| [43](#L43) | /\*\* |
| [44](#L44) | \* Constructor. |
| [45](#L45) | \* |
| [46](#L46) | \* @since 1.0 |
| [47](#L47) | \* |
| [48](#L48) | \* @param Boldgrid\_Backup\_Admin\_Core $core Core class object. |
| [49](#L49) | \*/ |
| [50](#L50) | public function \_\_construct( $core ) { |
| [51](#L51) | // Save the Boldgrid\_Backup\_Admin\_Core object as a class property. |
| [52](#L52) | $this->core = $core; |
| [53](#L53) |  |
| [54](#L54) | $this->is\_saving\_settings = isset( $\_POST['save\_time'] ); // phpcs:ignore WordPress.CSRF.NonceVerification.NoNonceVerification |
| [55](#L55) | } |
| [56](#L56) |  |
| [57](#L57) | /\*\* |
| [58](#L58) | \* How many days of the week are being saved? |
| [59](#L59) | \* |
| [60](#L60) | \* This method counts the number of $\_POST keys that begin with "dow\_". The count returned by |
| [61](#L61) | \* this method is used to help enforce restrictions on the free version of the plugin. |
| [62](#L62) | \* |
| [63](#L63) | \* @since 1.3.1 |
| [64](#L64) | \* |
| [65](#L65) | \* @return int |
| [66](#L66) | \*/ |
| [67](#L67) | public function get\_dow\_count() { |
| [68](#L68) | $count = 0; |
| [69](#L69) |  |
| [70](#L70) | if ( ! isset( $\_POST ) || ! is\_array( $\_POST ) ) { // phpcs:ignore WordPress.CSRF.NonceVerification.NoNonceVerification |
| [71](#L71) | return 0; |
| [72](#L72) | } |
| [73](#L73) |  |
| [74](#L74) | // Loop through each $\_POST value and check if the key begins with dow\_. |
| [75](#L75) | foreach ( $\_POST as $k => $v ) { // phpcs:ignore WordPress.CSRF.NonceVerification.NoNonceVerification |
| [76](#L76) | if ( substr( $k, 0, 4 ) === 'dow\_' ) { |
| [77](#L77) | $count++; |
| [78](#L78) | } |
| [79](#L79) | } |
| [80](#L80) |  |
| [81](#L81) | return $count; |
| [82](#L82) | } |
| [83](#L83) |  |
| [84](#L84) | /\*\* |
| [85](#L85) | \* Get a setting from the settings. |
| [86](#L86) | \* |
| [87](#L87) | \* @since 1.9.0 |
| [88](#L88) | \* |
| [89](#L89) | \* @param  string $key The setting name. |
| [90](#L90) | \* @return mixed |
| [91](#L91) | \*/ |
| [92](#L92) | public function get\_setting( $key ) { |
| [93](#L93) | $settings = $this->get\_settings(); |
| [94](#L94) |  |
| [95](#L95) | return isset( $settings[ $key ] ) ? $settings[ $key ] : null; |
| [96](#L96) | } |
| [97](#L97) |  |
| [98](#L98) | /\*\* |
| [99](#L99) | \* Get settings using defaults. |
| [100](#L100) | \* |
| [101](#L101) | \* @since 1.0 |
| [102](#L102) | \* |
| [103](#L103) | \* @param  bool $raw Return the raw settings. This would happen very early |
| [104](#L104) | \*                   on in this method, before all of the other checks |
| [105](#L105) | \*                   happen. |
| [106](#L106) | \* @return array     An array of settings. |
| [107](#L107) | \*/ |
| [108](#L108) | public function get\_settings( $raw = false ) { |
| [109](#L109) | // Get settings. |
| [110](#L110) | $settings = get\_site\_option( 'boldgrid\_backup\_settings', [] ); |
| [111](#L111) |  |
| [112](#L112) | if ( $raw ) { |
| [113](#L113) | return $settings; |
| [114](#L114) | } |
| [115](#L115) |  |
| [116](#L116) | // Configure a random minute. 5:4am will fail, but 5:04am will pass. |
| [117](#L117) | $random\_minute = mt\_rand( 1, 59 ); |
| [118](#L118) | $random\_minute = 1 === strlen( $random\_minute ) ? '0' . $random\_minute : $random\_minute; |
| [119](#L119) |  |
| [120](#L120) | // Parse settings. |
| [121](#L121) | if ( ! empty( $settings['schedule'] ) ) { |
| [122](#L122) | // Update schedule format. |
| [123](#L123) | // Days of the week. |
| [124](#L124) | $settings['schedule']['dow\_sunday']    = ( |
| [125](#L125) | ! empty( $settings['schedule']['dow\_sunday'] ) ? 1 : 0 |
| [126](#L126) | ); |
| [127](#L127) | $settings['schedule']['dow\_monday']    = ( |
| [128](#L128) | ! empty( $settings['schedule']['dow\_monday'] ) ? 1 : 0 |
| [129](#L129) | ); |
| [130](#L130) | $settings['schedule']['dow\_tuesday']   = ( |
| [131](#L131) | ! empty( $settings['schedule']['dow\_tuesday'] ) ? 1 : 0 |
| [132](#L132) | ); |
| [133](#L133) | $settings['schedule']['dow\_wednesday'] = ( |
| [134](#L134) | ! empty( $settings['schedule']['dow\_wednesday'] ) ? 1 : 0 |
| [135](#L135) | ); |
| [136](#L136) | $settings['schedule']['dow\_thursday']  = ( |
| [137](#L137) | ! empty( $settings['schedule']['dow\_thursday'] ) ? 1 : 0 |
| [138](#L138) | ); |
| [139](#L139) | $settings['schedule']['dow\_friday']    = ( |
| [140](#L140) | ! empty( $settings['schedule']['dow\_friday'] ) ? 1 : 0 |
| [141](#L141) | ); |
| [142](#L142) | $settings['schedule']['dow\_saturday']  = ( |
| [143](#L143) | ! empty( $settings['schedule']['dow\_saturday'] ) ? 1 : 0 |
| [144](#L144) | ); |
| [145](#L145) |  |
| [146](#L146) | // Time of day. |
| [147](#L147) | $settings['schedule']['tod\_h'] = ( |
| [148](#L148) | ! empty( $settings['schedule']['tod\_h'] ) ? |
| [149](#L149) | $settings['schedule']['tod\_h'] : mt\_rand( 1, 5 ) |
| [150](#L150) | ); |
| [151](#L151) | $settings['schedule']['tod\_m'] = ( |
| [152](#L152) | ! empty( $settings['schedule']['tod\_m'] ) ? |
| [153](#L153) | $settings['schedule']['tod\_m'] : $random\_minute |
| [154](#L154) | ); |
| [155](#L155) | $settings['schedule']['tod\_a'] = ( |
| [156](#L156) | ! empty( $settings['schedule']['tod\_a'] ) ? |
| [157](#L157) | $settings['schedule']['tod\_a'] : 'AM' |
| [158](#L158) | ); |
| [159](#L159) |  |
| [160](#L160) | // Notification settings. |
| [161](#L161) | $settings['notifications']['backup']  = ( |
| [162](#L162) | ! isset( $settings['notifications']['backup'] ) || |
| [163](#L163) | ! empty( $settings['notifications']['backup'] ) ? 1 : 0 |
| [164](#L164) | ); |
| [165](#L165) | $settings['notifications']['restore'] = ( |
| [166](#L166) | ! isset( $settings['notifications']['restore'] ) || |
| [167](#L167) | ! empty( $settings['notifications']['restore'] ) ? 1 : 0 |
| [168](#L168) | ); |
| [169](#L169) |  |
| [170](#L170) | // Notification email address. |
| [171](#L171) | if ( empty( $settings['notification\_email'] ) ) { |
| [172](#L172) | $settings['notification\_email'] = $this->core->config->get\_admin\_email(); |
| [173](#L173) | } |
| [174](#L174) |  |
| [175](#L175) | // Other settings. |
| [176](#L176) | $settings['auto\_backup'] = ( |
| [177](#L177) | ! isset( $settings['auto\_backup'] ) || ! empty( $settings['auto\_backup'] ) ? 1 : 0 |
| [178](#L178) | ); |
| [179](#L179) |  |
| [180](#L180) | $settings['auto\_rollback'] = ( |
| [181](#L181) | ! isset( $settings['auto\_rollback'] ) || ! empty( $settings['auto\_rollback'] ) ? |
| [182](#L182) | 1 : 0 |
| [183](#L183) | ); |
| [184](#L184) |  |
| [185](#L185) | // Get retention count setting.  Limit 1-99, default is from config. |
| [186](#L186) | $settings['retention\_count'] = ( isset( $settings['retention\_count'] ) && |
| [187](#L187) | 99 >= $settings['retention\_count'] ) ? |
| [188](#L188) | $settings['retention\_count'] : $this->core->config->get\_default\_retention(); |
| [189](#L189) |  |
| [190](#L190) | if ( $settings['retention\_count'] > 99 ) { |
| [191](#L191) | $settings['retention\_count'] = 99; |
| [192](#L192) | } |
| [193](#L193) | } else { |
| [194](#L194) | // Define defaults. |
| [195](#L195) | // Days of the week. |
| [196](#L196) | $settings['schedule']['dow\_sunday']    = 0; |
| [197](#L197) | $settings['schedule']['dow\_monday']    = 0; |
| [198](#L198) | $settings['schedule']['dow\_tuesday']   = 0; |
| [199](#L199) | $settings['schedule']['dow\_wednesday'] = 0; |
| [200](#L200) | $settings['schedule']['dow\_thursday']  = 0; |
| [201](#L201) | $settings['schedule']['dow\_friday']    = 0; |
| [202](#L202) | $settings['schedule']['dow\_saturday']  = 0; |
| [203](#L203) |  |
| [204](#L204) | // Time of day. |
| [205](#L205) | $settings['schedule']['tod\_h'] = mt\_rand( 1, 5 ); |
| [206](#L206) | $settings['schedule']['tod\_m'] = $random\_minute; |
| [207](#L207) | $settings['schedule']['tod\_a'] = 'AM'; |
| [208](#L208) |  |
| [209](#L209) | // Other settings. |
| [210](#L210) | $settings['retention\_count']          = $this->core->config->get\_default\_retention(); |
| [211](#L211) | $settings['notification\_email']       = $this->core->config->get\_admin\_email(); |
| [212](#L212) | $settings['notifications']['backup']  = 1; |
| [213](#L213) | $settings['notifications']['restore'] = 1; |
| [214](#L214) | $settings['auto\_backup']              = 1; |
| [215](#L215) | $settings['auto\_rollback']            = 1; |
| [216](#L216) |  |
| [217](#L217) | $settings['remote']['local']['enabled'] = true; |
| [218](#L218) | } |
| [219](#L219) |  |
| [220](#L220) | if ( empty( $settings['remote'] ) ) { |
| [221](#L221) | $settings['remote'] = array(); |
| [222](#L222) | } |
| [223](#L223) |  |
| [224](#L224) | // For consistency, untrailingslashit the backup dir. |
| [225](#L225) | if ( isset( $settings['backup\_directory'] ) ) { |
| [226](#L226) | $settings['backup\_directory'] = untrailingslashit( $settings['backup\_directory'] ); |
| [227](#L227) | } |
| [228](#L228) |  |
| [229](#L229) | if ( empty( $settings['exclude\_tables'] ) ) { |
| [230](#L230) | $settings['exclude\_tables'] = array(); |
| [231](#L231) | } |
| [232](#L232) |  |
| [233](#L233) | // Configure default folder\_exclusion settings. |
| [234](#L234) | $settings['folder\_exclusion\_include'] = $this->core->folder\_exclusion->from\_settings( 'include', $settings ); |
| [235](#L235) | $settings['folder\_exclusion\_exclude'] = $this->core->folder\_exclusion->from\_settings( 'exclude', $settings ); |
| [236](#L236) |  |
| [237](#L237) | // Site Check settings. |
| [238](#L238) | $settings['site\_check']['enabled'] = isset( $settings['site\_check']['enabled'] ) ? |
| [239](#L239) | (bool) $settings['site\_check']['enabled'] : true; |
| [240](#L240) |  |
| [241](#L241) | $settings['site\_check']['logger'] = isset( $settings['site\_check']['logger'] ) ? |
| [242](#L242) | (bool) $settings['site\_check']['logger'] : true; |
| [243](#L243) |  |
| [244](#L244) | $settings['site\_check']['auto\_recovery'] = isset( $settings['site\_check']['auto\_recovery'] ) ? |
| [245](#L245) | (bool) $settings['site\_check']['auto\_recovery'] : false; |
| [246](#L246) |  |
| [247](#L247) | $settings['notifications']['site\_check'] = isset( $settings['notifications']['site\_check'] ) ? |
| [248](#L248) | (bool) $settings['notifications']['site\_check'] : true; |
| [249](#L249) |  |
| [250](#L250) | // Site Check interval (in minutes); 5-59, defaults to 15. |
| [251](#L251) | $settings['site\_check']['interval'] = ( isset( $settings['site\_check']['interval'] ) && |
| [252](#L252) | 4 < $settings['site\_check']['interval'] && 60 > $settings['site\_check']['interval'] ) ? |
| [253](#L253) | $settings['site\_check']['interval'] : 15; |
| [254](#L254) |  |
| [255](#L255) | // Encryption. |
| [256](#L256) | $settings['encrypt\_db'] = isset( $settings['encrypt\_db'] ) ? (bool) $settings['encrypt\_db'] : false; |
| [257](#L257) |  |
| [258](#L258) | // Auto Updates. |
| [259](#L259) | $settings['auto\_update'] = $this->set\_update\_settings( $settings ); |
| [260](#L260) |  |
| [261](#L261) | // Return the settings array. |
| [262](#L262) | return $settings; |
| [263](#L263) | } |
| [264](#L264) |  |
| [265](#L265) | /\*\* |
| [266](#L266) | \* Get the Auto Update Settings. |
| [267](#L267) | \* |
| [268](#L268) | \* With the new changes of wp5.5, there are new changes to the auto update settings. |
| [269](#L269) | \* Moving this to it's own method allows us to isolate that logic from the get\_settings() method |
| [270](#L270) | \* and ensure that the Auto Update Settings retrieved are accurate. |
| [271](#L271) | \* |
| [272](#L272) | \* @since 1.14.3 |
| [273](#L273) | \* |
| [274](#L274) | \* @param  array  $settings The Settings array. |
| [275](#L275) | \* @global string $wp\_version The current version of WordPress. |
| [276](#L276) | \* |
| [277](#L277) | \* @return array |
| [278](#L278) | \*/ |
| [279](#L279) | public function set\_update\_settings( $settings ) { |
| [280](#L280) | global $wp\_version; |
| [281](#L281) |  |
| [282](#L282) | // If the 'auto\_update' settings are not set, add default values, otherwise use values from $settings array.. |
| [283](#L283) | if ( empty( $settings['auto\_update'] ) ) { |
| [284](#L284) | // The value for 'default' was changed from false, to '0' for data type consistency. |
| [285](#L285) | $auto\_update\_settings = array( |
| [286](#L286) | 'days'    => 0, |
| [287](#L287) | 'plugins' => array( |
| [288](#L288) | 'default' => '0', |
| [289](#L289) | ), |
| [290](#L290) | 'themes'  => array( |
| [291](#L291) | 'default' => '0', |
| [292](#L292) | ), |
| [293](#L293) | ); |
| [294](#L294) | } else { |
| [295](#L295) | $auto\_update\_settings = $settings['auto\_update']; |
| [296](#L296) | } |
| [297](#L297) |  |
| [298](#L298) | return $auto\_update\_settings; |
| [299](#L299) | } |
| [300](#L300) |  |
| [301](#L301) | /\*\* |
| [302](#L302) | \* Updates the WordPress auto\_update options. |
| [303](#L303) | \* |
| [304](#L304) | \* This is somewhat the opposite of set\_update\_settings. This is used as necessary |
| [305](#L305) | \* to update the new options added to WP5.5, auto\_update\_plugins and auto\_update\_themes |
| [306](#L306) | \* to make sure that all the settings play nicely together. Anytime we change the update settings |
| [307](#L307) | \* in Total Upkeep, This should run once for themes, and once for plugins to make sure that |
| [308](#L308) | \* the WordPress Options are kept up to date. |
| [309](#L309) | \* |
| [310](#L310) | \* @since 1.4.3 |
| [311](#L311) | \* @global string $wp\_version WordPress Version Number. |
| [312](#L312) | \* |
| [313](#L313) | \* @param array $new\_settings New settings. |
| [314](#L314) | \* @param bool  $is\_theme     Whether or not the settings being updated are for a theme. |
| [315](#L315) | \*/ |
| [316](#L316) | public function update\_autoupdate\_options( $new\_settings, $is\_theme = false ) { |
| [317](#L317) | global $wp\_version; |
| [318](#L318) | // If version is wp\_version is greater than 5.4.99 then it must be 5.5. |
| [319](#L319) | if ( version\_compare( $wp\_version, '5.4.99', 'gt' ) ) { |
| [320](#L320) | // Depending on whether this is being run for themes or plugins, get the correct option table. |
| [321](#L321) | $auto\_update\_field = get\_option( $is\_theme ? 'auto\_update\_themes' : 'auto\_update\_plugins', array() ); |
| [322](#L322) | // For each offer ( theme or plugin ) passed to this function. |
| [323](#L323) | foreach ( $new\_settings[ $is\_theme ? 'themes' : 'plugins' ] as $offer => $enabled ) { |
| [324](#L324) | $offer\_in\_option = array\_search( $offer, $auto\_update\_field, true ); |
| [325](#L325) | if ( '1' === $enabled && false === $offer\_in\_option ) { |
| [326](#L326) | /\* |
| [327](#L327) | \* If auto updates for the plugin / theme are enabled in our settings, but not enabled in |
| [328](#L328) | \* wp option, enable it in the wp option. |
| [329](#L329) | \*/ |
| [330](#L330) | $auto\_update\_field[] = $offer; |
| [331](#L331) | } elseif ( '0' === $enabled && false !== $offer\_in\_option ) { |
| [332](#L332) | /\* |
| [333](#L333) | \* If auto updates for the plugin / theme are disabled in our settings, but not disabled in |
| [334](#L334) | \* the wp option, disable it in the wp option. |
| [335](#L335) | \*/ |
| [336](#L336) | unset( $auto\_update\_field[ $offer\_in\_option ] ); |
| [337](#L337) | } |
| [338](#L338) | } |
| [339](#L339) | // Update the WordPress option with the settings passed to this function. |
| [340](#L340) | update\_option( $is\_theme ? 'auto\_update\_themes' : 'auto\_update\_plugins', $auto\_update\_field ); |
| [341](#L341) | } |
| [342](#L342) | } |
| [343](#L343) |  |
| [344](#L344) | /\*\* |
| [345](#L345) | \* Determine whether or not the user has full site protection. |
| [346](#L346) | \* |
| [347](#L347) | \* Generally, this means they have scheduled backups that upload backups to a remote server. |
| [348](#L348) | \* |
| [349](#L349) | \* @since 1.10.0 |
| [350](#L350) | \* |
| [351](#L351) | \* @return bool |
| [352](#L352) | \*/ |
| [353](#L353) | public function has\_full\_protection() { |
| [354](#L354) | return $this->has\_scheduled\_backups() && $this->has\_remote\_configured(); |
| [355](#L355) | } |
| [356](#L356) |  |
| [357](#L357) | /\*\* |
| [358](#L358) | \* Determine whether or not the user has any remote storage options enabled. |
| [359](#L359) | \* |
| [360](#L360) | \* @since 1.10.0 |
| [361](#L361) | \* |
| [362](#L362) | \* @return bool |
| [363](#L363) | \*/ |
| [364](#L364) | public function has\_remote\_configured() { |
| [365](#L365) | $remotes = $this->get\_setting( 'remote', array() ); |
| [366](#L366) |  |
| [367](#L367) | $has\_remote = false; |
| [368](#L368) |  |
| [369](#L369) | foreach ( $remotes as $id => $config ) { |
| [370](#L370) | if ( 'local' === $id ) { |
| [371](#L371) | continue; |
| [372](#L372) | } |
| [373](#L373) |  |
| [374](#L374) | if ( ! empty( $config['enabled'] ) ) { |
| [375](#L375) | $has\_remote = true; |
| [376](#L376) | } |
| [377](#L377) | } |
| [378](#L378) |  |
| [379](#L379) | return $has\_remote; |
| [380](#L380) | } |
| [381](#L381) |  |
| [382](#L382) | /\*\* |
| [383](#L383) | \* Whether or not the user has backups scheduled. |
| [384](#L384) | \* |
| [385](#L385) | \* This method is not exhaustive, and insteads returns true if the user has any days of the week |
| [386](#L386) | \* selected. |
| [387](#L387) | \* |
| [388](#L388) | \* @since 1.10.0 |
| [389](#L389) | \* |
| [390](#L390) | \* @return bool |
| [391](#L391) | \*/ |
| [392](#L392) | public function has\_scheduled\_backups() { |
| [393](#L393) | $settings = $this->get\_settings(); |
| [394](#L394) |  |
| [395](#L395) | $schedule = empty( $settings['schedule'] ) ? [] : $settings['schedule']; |
| [396](#L396) |  |
| [397](#L397) | $days\_scheduled = 0; |
| [398](#L398) |  |
| [399](#L399) | foreach ( $schedule as $key => $value ) { |
| [400](#L400) | if ( 'dow\_' !== substr( $key, 0, 4 ) ) { |
| [401](#L401) | continue; |
| [402](#L402) | } |
| [403](#L403) |  |
| [404](#L404) | $days\_scheduled += empty( $value ) ? 0 : 1; |
| [405](#L405) | } |
| [406](#L406) |  |
| [407](#L407) | return ! empty( $days\_scheduled ); |
| [408](#L408) | } |
| [409](#L409) |  |
| [410](#L410) | /\*\* |
| [411](#L411) | \* Get the url to the settings pages. |
| [412](#L412) | \* |
| [413](#L413) | \* @since 1.10.1 |
| [414](#L414) | \* |
| [415](#L415) | \* @param  string $section If passed, $section will be appended to the url so it loads that |
| [416](#L416) | \*                         specific section first. |
| [417](#L417) | \* @return string |
| [418](#L418) | \*/ |
| [419](#L419) | public function get\_settings\_url( $section = '' ) { |
| [420](#L420) | $url = admin\_url( 'admin.php?page=boldgrid-backup-settings' ); |
| [421](#L421) |  |
| [422](#L422) | if ( ! empty( $section ) ) { |
| [423](#L423) | $url .= '&section=' . $section; |
| [424](#L424) | } |
| [425](#L425) |  |
| [426](#L426) | return $url; |
| [427](#L427) | } |
| [428](#L428) |  |
| [429](#L429) | /\*\* |
| [430](#L430) | \* Whether or not we are backing up all files, as defined in the settings. |
| [431](#L431) | \* |
| [432](#L432) | \* @since 1.9.0 |
| [433](#L433) | \* |
| [434](#L434) | \* @return bool |
| [435](#L435) | \*/ |
| [436](#L436) | public function is\_all\_files() { |
| [437](#L437) | $is\_all = true; |
| [438](#L438) |  |
| [439](#L439) | $folder\_exclusion\_exclude = $this->get\_setting( 'folder\_exclusion\_exclude' ); |
| [440](#L440) | $folder\_exclusion\_include = $this->get\_setting( 'folder\_exclusion\_include' ); |
| [441](#L441) |  |
| [442](#L442) | if ( $this->core->folder\_exclusion->default\_include !== $folder\_exclusion\_include ) { |
| [443](#L443) | $is\_all = false; |
| [444](#L444) | } |
| [445](#L445) |  |
| [446](#L446) | if ( $this->core->folder\_exclusion->default\_exclude !== $folder\_exclusion\_exclude ) { |
| [447](#L447) | $is\_all = false; |
| [448](#L448) | } |
| [449](#L449) |  |
| [450](#L450) | /\*\* |
| [451](#L451) | \* Filter whether or not the backup is considered backing up all files. |
| [452](#L452) | \* |
| [453](#L453) | \* For example, an advanced user may have custom include / exclude settings, and wants this |
| [454](#L454) | \* to be considered a backup of all their files. |
| [455](#L455) | \* |
| [456](#L456) | \* @since 1.9.0 |
| [457](#L457) | \* |
| [458](#L458) | \* @param bool $is\_all The current value of $is\_all. |
| [459](#L459) | \*/ |
| [460](#L460) | apply\_filters( 'boldgrid\_backup\_settings\_is\_all\_files', $is\_all ); |
| [461](#L461) |  |
| [462](#L462) | return $is\_all; |
| [463](#L463) | } |
| [464](#L464) |  |
| [465](#L465) | /\*\* |
| [466](#L466) | \* Whether or not we are backing up all tables, as defined in the settings. |
| [467](#L467) | \* |
| [468](#L468) | \* @since 1.9.0 |
| [469](#L469) | \* |
| [470](#L470) | \* @return bool |
| [471](#L471) | \*/ |
| [472](#L472) | public function is\_all\_tables() { |
| [473](#L473) | $exclude\_tables = $this->get\_setting( 'exclude\_tables' ); |
| [474](#L474) |  |
| [475](#L475) | return empty( $exclude\_tables ); |
| [476](#L476) | } |
| [477](#L477) |  |
| [478](#L478) | /\*\* |
| [479](#L479) | \* Move backups from one directory to another. |
| [480](#L480) | \* |
| [481](#L481) | \* @since 1.3.2 |
| [482](#L482) | \* |
| [483](#L483) | \* @param string $old\_dir Source directory. |
| [484](#L484) | \* @param string $new\_dir Destination directory. |
| [485](#L485) | \* @return bool TRUE on success / no backups needed to be moved. |
| [486](#L486) | \*/ |
| [487](#L487) | public function move\_backups( $old\_dir, $new\_dir ) { |
| [488](#L488) | $fail\_count = 0; |
| [489](#L489) |  |
| [490](#L490) | $old\_dir = Boldgrid\_Backup\_Admin\_Utility::trailingslashit( $old\_dir ); |
| [491](#L491) | $new\_dir = Boldgrid\_Backup\_Admin\_Utility::trailingslashit( $new\_dir ); |
| [492](#L492) |  |
| [493](#L493) | $archives = $this->core->get\_archive\_list( null, $old\_dir ); |
| [494](#L494) |  |
| [495](#L495) | ignore\_user\_abort( true ); |
| [496](#L496) |  |
| [497](#L497) | // Loop through each archive and move it. |
| [498](#L498) | foreach ( $archives as $archive ) { |
| [499](#L499) | $source      = $archive['filepath']; |
| [500](#L500) | $destination = $new\_dir . $archive['filename']; |
| [501](#L501) |  |
| [502](#L502) | $success = @$this->core->wp\_filesystem->move( $source, $destination ); // phpcs:ignore Generic.PHP.NoSilencedErrors.Discouraged |
| [503](#L503) |  |
| [504](#L504) | if ( ! $success ) { |
| [505](#L505) | $fail\_count++; |
| [506](#L506) | } |
| [507](#L507) | } |
| [508](#L508) |  |
| [509](#L509) | return 0 === $fail\_count; |
| [510](#L510) | } |
| [511](#L511) |  |
| [512](#L512) | /\*\* |
| [513](#L513) | \* Update settings. |
| [514](#L514) | \* |
| [515](#L515) | \* @since 1.0 |
| [516](#L516) | \* @access private |
| [517](#L517) | \* |
| [518](#L518) | \* @see Boldgrid\_Backup\_Admin\_Cron::add\_cron\_entry() |
| [519](#L519) | \* @see Boldgrid\_Backup\_Admin\_Cron::get\_cron\_secret() |
| [520](#L520) | \* |
| [521](#L521) | \* @return bool Update success. |
| [522](#L522) | \*/ |
| [523](#L523) | private function update\_settings() { |
| [524](#L524) | $update\_errors = array(); |
| [525](#L525) |  |
| [526](#L526) | // Check security nonce and referer. |
| [527](#L527) | if ( ! check\_admin\_referer( 'boldgrid-backup-settings', 'settings\_auth' ) ) { |
| [528](#L528) | wp\_send\_json\_error( |
| [529](#L529) | array( |
| [530](#L530) | 'error' => \_\_( 'Security violation! Please try again.', 'boldgrid-backup' ), |
| [531](#L531) | ) |
| [532](#L532) | ); |
| [533](#L533) | } |
| [534](#L534) |  |
| [535](#L535) | // Check for settings update. |
| [536](#L536) | if ( ! empty( $\_POST['save\_time'] ) ) { |
| [537](#L537) | // Get settings. |
| [538](#L538) | $settings = $this->get\_settings(); |
| [539](#L539) |  |
| [540](#L540) | // Initialize $update\_error. |
| [541](#L541) | $update\_error = false; |
| [542](#L542) |  |
| [543](#L543) | // Initialize $days\_scheduled. |
| [544](#L544) | $days\_scheduled = array(); |
| [545](#L545) |  |
| [546](#L546) | // Validate input for schedule. |
| [547](#L547) | $indices = array( |
| [548](#L548) | 'dow\_sunday', |
| [549](#L549) | 'dow\_monday', |
| [550](#L550) | 'dow\_tuesday', |
| [551](#L551) | 'dow\_wednesday', |
| [552](#L552) | 'dow\_thursday', |
| [553](#L553) | 'dow\_friday', |
| [554](#L554) | 'dow\_saturday', |
| [555](#L555) | 'tod\_h', |
| [556](#L556) | 'tod\_m', |
| [557](#L557) | 'tod\_a', |
| [558](#L558) | ); |
| [559](#L559) |  |
| [560](#L560) | foreach ( $indices as $index ) { |
| [561](#L561) | // Determine input type. |
| [562](#L562) | if ( 0 === strpos( $index, 'dow\_' ) ) { |
| [563](#L563) | $type = 'day'; |
| [564](#L564) | } elseif ( 'tod\_h' === $index ) { |
| [565](#L565) | $type = 'h'; |
| [566](#L566) | } elseif ( 'tod\_m' === $index ) { |
| [567](#L567) | $type = 'm'; |
| [568](#L568) | } elseif ( 'tod\_a' === $index ) { |
| [569](#L569) | $type = 'a'; |
| [570](#L570) | } else { |
| [571](#L571) | // Unknown type. |
| [572](#L572) | $type = '?'; |
| [573](#L573) | } |
| [574](#L574) |  |
| [575](#L575) | if ( ! empty( $\_POST[ $index ] ) ) { |
| [576](#L576) | // Validate by type. |
| [577](#L577) | switch ( $type ) { |
| [578](#L578) | case 'day': |
| [579](#L579) | // Convert to integer. |
| [580](#L580) | $\_POST[ $index ] = (int) $\_POST[ $index ]; |
| [581](#L581) |  |
| [582](#L582) | // If day was scheduled, then track it. |
| [583](#L583) | if ( 1 === $\_POST[ $index ] ) { |
| [584](#L584) | $days\_scheduled[] = date( 'w', strtotime( str\_replace( 'dow\_', '', $index ) ) ); |
| [585](#L585) | } |
| [586](#L586) |  |
| [587](#L587) | break; |
| [588](#L588) | case 'h': |
| [589](#L589) | if ( $\_POST[ $index ] < 1 || $\_POST[ $index ] > 12 ) { |
| [590](#L590) | // Error in input. |
| [591](#L591) | $update\_error = true; |
| [592](#L592) | break 2; |
| [593](#L593) | } |
| [594](#L594) |  |
| [595](#L595) | // Convert to integer. |
| [596](#L596) | $\_POST[ $index ] = (int) $\_POST[ $index ]; |
| [597](#L597) |  |
| [598](#L598) | break; |
| [599](#L599) | case 'm': |
| [600](#L600) | if ( $\_POST[ $index ] < 0 || $\_POST[ $index ] > 59 ) { |
| [601](#L601) | // Error in input. |
| [602](#L602) | $update\_error = true; |
| [603](#L603) | break 2; |
| [604](#L604) | } |
| [605](#L605) |  |
| [606](#L606) | // Convert to integer. |
| [607](#L607) | $\_POST[ $index ] = (int) $\_POST[ $index ]; |
| [608](#L608) |  |
| [609](#L609) | // Pad left with 0. |
| [610](#L610) | $\_POST[ $index ] = str\_pad( $\_POST[ $index ], 2, '0', STR\_PAD\_LEFT ); |
| [611](#L611) |  |
| [612](#L612) | break; |
| [613](#L613) | case 'a': |
| [614](#L614) | if ( 'AM' !== $\_POST[ $index ] && 'PM' !== $\_POST[ $index ] ) { |
| [615](#L615) | // Error in input; unknown type. |
| [616](#L616) | $update\_error = true; |
| [617](#L617) | break 2; |
| [618](#L618) | } |
| [619](#L619) |  |
| [620](#L620) | break; |
| [621](#L621) | default: |
| [622](#L622) | // Error in input; unknown type. |
| [623](#L623) | $update\_error = true; |
| [624](#L624) | break 2; |
| [625](#L625) | } |
| [626](#L626) |  |
| [627](#L627) | // Update the setting value provided. |
| [628](#L628) | $settings['schedule'][ $index ] = $\_POST[ $index ]; |
| [629](#L629) | } elseif ( 'day' === $type ) { |
| [630](#L630) | // Unassigned days. |
| [631](#L631) | $settings['schedule'][ $index ] = 0; |
| [632](#L632) | } else { |
| [633](#L633) | // Error in input. |
| [634](#L634) | $update\_error = true; |
| [635](#L635) |  |
| [636](#L636) | break; |
| [637](#L637) | } |
| [638](#L638) | } |
| [639](#L639) |  |
| [640](#L640) | // Validate input for other settings. |
| [641](#L641) | $settings['notifications']['backup'] = isset( $\_POST['notify\_backup'] ) && |
| [642](#L642) | '1' === $\_POST['notify\_backup'] ? 1 : 0; |
| [643](#L643) |  |
| [644](#L644) | $settings['notifications']['restore'] = isset( $\_POST['notify\_restore'] ) && |
| [645](#L645) | '1' === $\_POST['notify\_restore'] ? 1 : 0; |
| [646](#L646) |  |
| [647](#L647) | $settings['notifications']['site\_check'] = isset( $\_POST['notify\_site\_check'] ) && |
| [648](#L648) | '1' === $\_POST['notify\_site\_check']; |
| [649](#L649) |  |
| [650](#L650) | $settings['auto\_backup'] = ! isset( $\_POST['auto\_backup'] ) || |
| [651](#L651) | '1' === $\_POST['auto\_backup'] ? 1 : 0; |
| [652](#L652) |  |
| [653](#L653) | $settings['auto\_rollback'] = ! isset( $\_POST['auto\_rollback'] ) || |
| [654](#L654) | '1' === $\_POST['auto\_rollback'] ? 1 : 0; |
| [655](#L655) |  |
| [656](#L656) | $settings['site\_check']['enabled'] = isset( $\_POST['site\_check'] ) && |
| [657](#L657) | '1' === $\_POST['site\_check']; |
| [658](#L658) |  |
| [659](#L659) | $settings['site\_check']['interval'] = isset( $\_POST['site\_check\_interval'] ) && |
| [660](#L660) | 4 < $\_POST['site\_check\_interval'] && 60 > $\_POST['site\_check\_interval'] ? |
| [661](#L661) | (int) $\_POST['site\_check\_interval'] : 15; |
| [662](#L662) |  |
| [663](#L663) | $settings['site\_check']['logger'] = isset( $\_POST['site\_check\_logger'] ) && |
| [664](#L664) | '1' === $\_POST['site\_check\_logger']; |
| [665](#L665) |  |
| [666](#L666) | $settings['site\_check']['auto\_recovery'] = isset( $\_POST['auto\_recovery'] ) && |
| [667](#L667) | '1' === $\_POST['auto\_recovery']; |
| [668](#L668) |  |
| [669](#L669) | // Update notification email address, if changed. |
| [670](#L670) | if ( isset( $settings['notification\_email'] ) && |
| [671](#L671) | sanitize\_email( $\_POST['notification\_email'] ) !== $settings['notification\_email'] ) { |
| [672](#L672) | $settings['notification\_email'] = sanitize\_email( $\_POST['notification\_email'] ); |
| [673](#L673) | } |
| [674](#L674) |  |
| [675](#L675) | // Database encryption. |
| [676](#L676) | $settings['encrypt\_db'] = isset( $\_POST['encrypt\_db'] ) && '1' === $\_POST['encrypt\_db']; |
| [677](#L677) |  |
| [678](#L678) | /\* |
| [679](#L679) | \* Save compressor settings. |
| [680](#L680) | \* |
| [681](#L681) | \* @since 1.5.1 |
| [682](#L682) | \*/ |
| [683](#L683) | if ( ! empty( $\_POST['compressor'] ) ) { |
| [684](#L684) | $available\_compressors = $this->core->compressors->get\_available(); |
| [685](#L685) | $selected\_compressor   = $\_POST['compressor']; |
| [686](#L686) | if ( in\_array( $selected\_compressor, $available\_compressors, true ) ) { |
| [687](#L687) | $settings['compressor'] = $selected\_compressor; |
| [688](#L688) | } else { |
| [689](#L689) | $update\_error    = true; |
| [690](#L690) | $update\_errors[] = \_\_( 'The compressor you seleted is unavailable. Please select another.', 'boldgrid-backup' ); |
| [691](#L691) | } |
| [692](#L692) | } |
| [693](#L693) |  |
| [694](#L694) | /\* |
| [695](#L695) | \* Save "backup filelist analysis" setting. |
| [696](#L696) | \* |
| [697](#L697) | \* @since 1.14.13 |
| [698](#L698) | \*/ |
| [699](#L699) | $settings['filelist\_analysis'] = ! empty( $\_POST['filelist\_analysis'] ) ? 1 : 0; |
| [700](#L700) |  |
| [701](#L701) | /\* |
| [702](#L702) | \* Save Compression Level Settings. |
| [703](#L703) | \* |
| [704](#L704) | \* @since 1.14.0 |
| [705](#L705) | \*/ |
| [706](#L706) | if ( isset( $\_POST['compression\_level'] ) ) { |
| [707](#L707) | $settings['compression\_level'] = $\_POST['compression\_level']; |
| [708](#L708) | } |
| [709](#L709) |  |
| [710](#L710) | /\* |
| [711](#L711) | \* Save extractor settings. |
| [712](#L712) | \* |
| [713](#L713) | \* At this time, the extractor cannot be selected within the settings. |
| [714](#L714) | \* |
| [715](#L715) | \* @since 1.5.1 |
| [716](#L716) | \*/ |
| [717](#L717) | if ( ! empty( $\_POST['extractor'] ) ) { |
| [718](#L718) | $selected\_extractor = $\_POST['extractor']; |
| [719](#L719) | if ( in\_array( $selected\_extractor, $available\_compressors, true ) ) { |
| [720](#L720) | $settings['extractor'] = $selected\_extractor; |
| [721](#L721) | } else { |
| [722](#L722) | $update\_error    = true; |
| [723](#L723) | $update\_errors[] = \_\_( 'The extractor you seleted is unavailable. Please select another.', 'boldgrid-backup' ); |
| [724](#L724) | } |
| [725](#L725) | } |
| [726](#L726) |  |
| [727](#L727) | /\* |
| [728](#L728) | \* Change the scheduler. |
| [729](#L729) | \* |
| [730](#L730) | \* If the scheduler is indeed changed, clear all prior backup |
| [731](#L731) | \* schedules. |
| [732](#L732) | \* |
| [733](#L733) | \* @since 1.5.1 |
| [734](#L734) | \*/ |
| [735](#L735) | $original\_scheduler   = ! empty( $settings['scheduler'] ) ? $settings['scheduler'] : false; |
| [736](#L736) | $schedulers\_available = $this->core->scheduler->get\_available(); |
| [737](#L737) | $scheduler\_changed    = ! empty( $\_POST['scheduler'] ) && $original\_scheduler !== $\_POST['scheduler']; |
| [738](#L738) | if ( $scheduler\_changed && array\_key\_exists( $\_POST['scheduler'], $schedulers\_available ) ) { |
| [739](#L739) | $settings['scheduler'] = $\_POST['scheduler']; |
| [740](#L740) | } |
| [741](#L741) |  |
| [742](#L742) | /\* |
| [743](#L743) | \* Save cron interval Settings. |
| [744](#L744) | \* |
| [745](#L745) | \* @since 1.16.0 |
| [746](#L746) | \*/ |
| [747](#L747) | if ( isset( $\_POST['cron\_interval'] ) ) { |
| [748](#L748) | $settings['cron\_interval'] = $\_POST['cron\_interval']; |
| [749](#L749) | } |
| [750](#L750) |  |
| [751](#L751) | /\* |
| [752](#L752) | \* Save WP Cron / Crons. |
| [753](#L753) | \* |
| [754](#L754) | \* @since 1.5.1 |
| [755](#L755) | \*/ |
| [756](#L756) | $settings = $this->update\_cron( $settings ); |
| [757](#L757) |  |
| [758](#L758) | // Add a notice if we tried and failed to add crons. |
| [759](#L759) | if ( ! $settings['crons\_added'] ) { |
| [760](#L760) | $update\_error    = true; |
| [761](#L761) | $update\_errors[] = esc\_html\_\_( 'An error occurred when modifying cron jobs. Please try again.', 'boldgrid-backup' ); |
| [762](#L762) | } |
| [763](#L763) |  |
| [764](#L764) | /\* |
| [765](#L765) | \* Save storage locations. |
| [766](#L766) | \* |
| [767](#L767) | \* @since 1.5.2 |
| [768](#L768) | \*/ |
| [769](#L769) | $storage\_locations = ! empty( $settings['remote'] ) ? $settings['remote'] : array(); |
| [770](#L770) |  |
| [771](#L771) | // Start off by disabling each storage location. |
| [772](#L772) | foreach ( $storage\_locations as $remote\_key => $storage\_location ) { |
| [773](#L773) | $settings['remote'][ $remote\_key ]['enabled'] = false; |
| [774](#L774) | } |
| [775](#L775) |  |
| [776](#L776) | // Get the storage location array from POST, then sanitize below. |
| [777](#L777) | $storage\_locations\_save = ! empty( $\_POST['storage\_location'] ) ? |
| [778](#L778) | $\_POST['storage\_location'] : array(); |
| [779](#L779) |  |
| [780](#L780) | // Then enable it only if submitted.  Values are not used, only key/index. |
| [781](#L781) | foreach ( $storage\_locations\_save as $storage\_location => $storage\_location\_enabled ) { |
| [782](#L782) | $storage\_location = sanitize\_key( $storage\_location ); |
| [783](#L783) |  |
| [784](#L784) | /\* |
| [785](#L785) | \* Unless this is the local environment, don't enable a storage location if it has |
| [786](#L786) | \* not yet been setup. Why enable FTP if FTP hasn't been setup yet. |
| [787](#L787) | \*/ |
| [788](#L788) | if ( 'local' === $storage\_location || isset( $settings['remote'][ $storage\_location ] ) ) { |
| [789](#L789) | $settings['remote'][ $storage\_location ]['enabled'] = true; |
| [790](#L790) | } |
| [791](#L791) | } |
| [792](#L792) |  |
| [793](#L793) | /\* |
| [794](#L794) | \* Save tables to include. |
| [795](#L795) | \* |
| [796](#L796) | \* @since 1.5.3 |
| [797](#L797) | \*/ |
| [798](#L798) | $settings['exclude\_tables']      = $this->core->db\_omit->get\_from\_post(); |
| [799](#L799) | $settings['exclude\_tables\_type'] = $this->core->db\_omit->get\_post\_type(); |
| [800](#L800) |  |
| [801](#L801) | /\* |
| [802](#L802) | \* Save folder exclusion settings. |
| [803](#L803) | \* |
| [804](#L804) | \* @since 1.6.0 |
| [805](#L805) | \*/ |
| [806](#L806) | $settings['folder\_exclusion\_include'] = $this->core->folder\_exclusion->from\_post( 'include' ); |
| [807](#L807) | $settings['folder\_exclusion\_exclude'] = $this->core->folder\_exclusion->from\_post( 'exclude' ); |
| [808](#L808) | $settings['folder\_exclusion\_type']    = $this->core->folder\_exclusion->from\_post( 'type' ); |
| [809](#L809) |  |
| [810](#L810) | /\* |
| [811](#L811) | \* Save Auto Update options. |
| [812](#L812) | \* |
| [813](#L813) | \* As of WP5.5 , a new UI for auto updates ws added. |
| [814](#L814) | \* Therefore we have to make sure the 'auto\_update\_plugins' and |
| [815](#L815) | \* 'auto\_update\_themes' option tables are also updated. |
| [816](#L816) | \* |
| [817](#L817) | \* @since 1.14.0 |
| [818](#L818) | \*/ |
| [819](#L819) | if ( ! empty( $\_POST['auto\_update'] ) ) { |
| [820](#L820) | $settings['auto\_update'] = $this->validate\_auto\_update( $\_POST['auto\_update'] ); |
| [821](#L821) | // As of WordPress 5.5 we also have to update the option in the WordPress auto update option as well. |
| [822](#L822) | if ( isset( $\_POST['auto\_update']['plugins'] ) ) { |
| [823](#L823) | $this->update\_autoupdate\_options( $\_POST['auto\_update'] ); |
| [824](#L824) | } |
| [825](#L825) |  |
| [826](#L826) | // This updates the options field for themes as well. |
| [827](#L827) | if ( isset( $\_POST['auto\_update']['themes'] ) ) { |
| [828](#L828) | $this->update\_autoupdate\_options( $\_POST['auto\_update'], true ); |
| [829](#L829) | } |
| [830](#L830) | $update\_error = $settings['auto\_update'] ? $update\_error : true; |
| [831](#L831) | } |
| [832](#L832) |  |
| [833](#L833) | // Read BoldGrid settings form POST request, sanitize, and merge settings with saved. |
| [834](#L834) | $boldgrid\_settings = array\_merge( |
| [835](#L835) | get\_option( 'boldgrid\_settings' ), |
| [836](#L836) | \Boldgrid\Library\Library\Page\Connect::sanitizeSettings( |
| [837](#L837) | array( |
| [838](#L838) | 'autoupdate'            => ! empty( $\_POST['autoupdate'] ) ? |
| [839](#L839) | (array) $\_POST['autoupdate'] : array(), |
| [840](#L840) | 'release\_channel'       => ! empty( $\_POST['plugin\_release\_channel'] ) ? |
| [841](#L841) | sanitize\_key( $\_POST['plugin\_release\_channel'] ) : 'stable', |
| [842](#L842) | 'theme\_release\_channel' => ! empty( $\_POST['theme\_release\_channel'] ) ? |
| [843](#L843) | sanitize\_key( $\_POST['theme\_release\_channel'] ) : 'stable', |
| [844](#L844) | ) |
| [845](#L845) | ) |
| [846](#L846) | ); |
| [847](#L847) |  |
| [848](#L848) | // Cleanup old settings. |
| [849](#L849) | unset( |
| [850](#L850) | $settings['plugin\_autoupdate'], |
| [851](#L851) | $settings['theme\_autoupdate'], |
| [852](#L852) | $boldgrid\_settings['plugin\_autoupdate'], |
| [853](#L853) | $boldgrid\_settings['theme\_autoupdate'] |
| [854](#L854) | ); |
| [855](#L855) |  |
| [856](#L856) | $settings['updated'] = time(); |
| [857](#L857) |  |
| [858](#L858) | // If no errors, then save the settings. |
| [859](#L859) | if ( ! $update\_error ) { |
| [860](#L860) | update\_site\_option( 'boldgrid\_backup\_settings', $settings ); |
| [861](#L861) | update\_option( 'boldgrid\_settings', $boldgrid\_settings ); |
| [862](#L862) | } |
| [863](#L863) | } |
| [864](#L864) |  |
| [865](#L865) | // If there was no error, then show success notice. |
| [866](#L866) | if ( ! $update\_error ) { |
| [867](#L867) | // Success. |
| [868](#L868) | do\_action( |
| [869](#L869) | 'boldgrid\_backup\_notice', |
| [870](#L870) | esc\_html\_\_( 'Settings saved.', 'boldgrid-backup' ), |
| [871](#L871) | 'updated settings-error notice is-dismissible' |
| [872](#L872) | ); |
| [873](#L873) | } elseif ( empty( $update\_errors ) ) { |
| [874](#L874) | $failure\_message = esc\_html\_\_( 'Invalid settings submitted.  Please try again.', 'boldgrid-backup' ); |
| [875](#L875) | } else { |
| [876](#L876) | $failure\_message = sprintf( '<strong>%1$s</strong><br /><br />%2$s', \_\_( 'We were unable to save your settings for the following reason(s):', 'boldgrid-backup' ), implode( '<br /><br />', $update\_errors ) ); |
| [877](#L877) | } |
| [878](#L878) |  |
| [879](#L879) | if ( isset( $failure\_message ) ) { |
| [880](#L880) | do\_action( 'boldgrid\_backup\_notice', $failure\_message ); |
| [881](#L881) | } |
| [882](#L882) |  |
| [883](#L883) | if ( ! $update\_error ) { |
| [884](#L884) | /\*\* |
| [885](#L885) | \* Take action when settings have been updated. |
| [886](#L886) | \* |
| [887](#L887) | \* @since 1.5.3 |
| [888](#L888) | \*/ |
| [889](#L889) | do\_action( 'boldgrid\_backup\_settings\_updated', $settings ); |
| [890](#L890) | } |
| [891](#L891) |  |
| [892](#L892) | // Return success. |
| [893](#L893) | return ! $update\_error; |
| [894](#L894) | } |
| [895](#L895) |  |
| [896](#L896) | /\*\* |
| [897](#L897) | \* Validates the auto\_update submissions. |
| [898](#L898) | \* |
| [899](#L899) | \* @since 1.14.0 |
| [900](#L900) | \* |
| [901](#L901) | \* @param array $posted\_update\_settings Update settings submitted via POST. |
| [902](#L902) | \* |
| [903](#L903) | \* @return array |
| [904](#L904) | \*/ |
| [905](#L905) | public function validate\_auto\_update( $posted\_update\_settings ) { |
| [906](#L906) | $post\_days = isset( $posted\_update\_settings['days'] ) ? $posted\_update\_settings['days'] : null; |
| [907](#L907) |  |
| [908](#L908) | if ( null === $post\_days || ( is\_numeric( $post\_days ) && 0 <= $post\_days && 99 >= $post\_days ) ) { |
| [909](#L909) | return $posted\_update\_settings; |
| [910](#L910) | } |
| [911](#L911) |  |
| [912](#L912) | return false; |
| [913](#L913) | } |
| [914](#L914) |  |
| [915](#L915) | /\*\* |
| [916](#L916) | \* Delete the boldgrid\_backup\_pending\_rollback option. |
| [917](#L917) | \* |
| [918](#L918) | \* @since 1.0.1 |
| [919](#L919) | \*/ |
| [920](#L920) | public function delete\_rollback\_option() { |
| [921](#L921) | delete\_site\_option( 'boldgrid\_backup\_pending\_rollback' ); |
| [922](#L922) | } |
| [923](#L923) |  |
| [924](#L924) | /\*\* |
| [925](#L925) | \* Menu callback to display the Backup schedule page. |
| [926](#L926) | \* |
| [927](#L927) | \* @since 1.0 |
| [928](#L928) | \* |
| [929](#L929) | \* @see Boldgrid\_Backup\_Admin\_Config::get\_is\_premium |
| [930](#L930) | \* @see Boldgrid\_Backup\_Admin\_Config::is\_premium\_active |
| [931](#L931) | \*/ |
| [932](#L932) | public function page\_backup\_settings() { |
| [933](#L933) |  |
| [934](#L934) | $is\_premium           = $this->core->config->get\_is\_premium(); |
| [935](#L935) | $is\_premium\_installed = $this->core->config->is\_premium\_installed; |
| [936](#L936) | $is\_premium\_active    = $this->core->config->is\_premium\_active; |
| [937](#L937) |  |
| [938](#L938) | wp\_enqueue\_style( 'boldgrid-backup-admin-new-thickbox-style' ); |
| [939](#L939) | wp\_enqueue\_style( 'bglib-ui-css' ); |
| [940](#L940) | wp\_enqueue\_script( 'bglib-ui-js' ); |
| [941](#L941) | wp\_enqueue\_script( 'bglib-sticky' ); |
| [942](#L942) | wp\_enqueue\_script( 'bglib-license' ); |
| [943](#L943) |  |
| [944](#L944) | $this->core->auto\_rollback->enqueue\_home\_scripts(); |
| [945](#L945) | $this->core->auto\_rollback->enqueue\_backup\_scripts(); |
| [946](#L946) | $this->core->archive\_actions->enqueue\_scripts(); |
| [947](#L947) |  |
| [948](#L948) | if ( ! $this->is\_saving\_settings ) { |
| [949](#L949) | $is\_functional = $this->core->test->run\_functionality\_tests(); |
| [950](#L950) | } |
| [951](#L951) |  |
| [952](#L952) | // If tests fail, then show an admin notice and abort. |
| [953](#L953) | if ( isset( $is\_functional ) && ! $is\_functional ) { |
| [954](#L954) | do\_action( |
| [955](#L955) | 'boldgrid\_backup\_notice', |
| [956](#L956) | sprintf( |
| [957](#L957) | // translators: 1: HTML anchor link open tag, 2: HTML anchor closing tag. |
| [958](#L958) | \_\_( |
| [959](#L959) | 'Functionality test has failed.  You can go to %1$sFunctionality Test%2$s to view a report.', |
| [960](#L960) | 'boldgrid-backup' |
| [961](#L961) | ), |
| [962](#L962) | '<a href="' . admin\_url( 'admin.php?page=boldgrid-backup-test' ) . '">', |
| [963](#L963) | '</a>' |
| [964](#L964) | ), |
| [965](#L965) | 'notice notice-error is-dismissible' |
| [966](#L966) | ); |
| [967](#L967) | } |
| [968](#L968) |  |
| [969](#L969) | /\* |
| [970](#L970) | \* Display warning on resource usage and backups. |
| [971](#L971) | \* |
| [972](#L972) | \* As of 1.11.6, this notice is dismissable (and won't return). |
| [973](#L973) | \*/ |
| [974](#L974) | $notice\_id = 'bgbkup\_uses\_resources'; |
| [975](#L975) | if ( ! Notice::isDismissed( $notice\_id ) ) { |
| [976](#L976) | $message = '<p>' . esc\_html\_\_( |
| [977](#L977) | 'Warning: Making backups uses resources. When the system is backing up, it will slow down your site for visitors. Furthermore, when the database itself is being copied, your site must “pause” temporarily to preserve data integrity. For most sites, the pause is typically a few seconds and is not noticed by visitors. Large sites take longer though. Please keep the number of backups you have stored and how often you make those backups to a minimum.', |
| [978](#L978) | 'boldgrid-backup' |
| [979](#L979) | ) . '</p>'; |
| [980](#L980) |  |
| [981](#L981) | Notice::show( $message, $notice\_id ); |
| [982](#L982) | } |
| [983](#L983) |  |
| [984](#L984) | // Get BoldGrid reseller settings. |
| [985](#L985) | $boldgrid\_reseller = get\_option( 'boldgrid\_reseller' ); |
| [986](#L986) |  |
| [987](#L987) | /\* |
| [988](#L988) | \* If not part of a reseller, then show the unofficial host notice. |
| [989](#L989) | \* |
| [990](#L990) | \* As of 1.11.6, this notice is dismissable (and won't return). |
| [991](#L991) | \*/ |
| [992](#L992) | $notice\_id = 'bgbkup\_host\_policy'; |
| [993](#L993) | if ( ! Notice::isDismissed( $notice\_id ) && empty( $boldgrid\_reseller ) ) { |
| [994](#L994) | $message = '<p>' . esc\_html\_\_( |
| [995](#L995) | 'Please note that your web hosting provider may have a policy against these types of backups. Please verify with your provider or choose a BoldGrid Official Host.', |
| [996](#L996) | 'boldgrid-backup' |
| [997](#L997) | ) . '</p>'; |
| [998](#L998) |  |
| [999](#L999) | Notice::show( $message, $notice\_id ); |
| [1000](#L1000) | } |
| [1001](#L1001) |  |
| [1002](#L1002) | // Check for settings update. |
| [1003](#L1003) | if ( $this->is\_saving\_settings ) { |
| [1004](#L1004) | // The nonce is verified in the update\_settings method. |
| [1005](#L1005) | $this->update\_settings(); |
| [1006](#L1006) | } |
| [1007](#L1007) |  |
| [1008](#L1008) | // Enqueue CSS for the settings page. |
| [1009](#L1009) | wp\_enqueue\_style( |
| [1010](#L1010) | 'boldgrid-backup-admin-settings', |
| [1011](#L1011) | plugin\_dir\_url( \_\_FILE\_\_ ) . 'css/boldgrid-backup-admin-settings.css', array(), |
| [1012](#L1012) | BOLDGRID\_BACKUP\_VERSION, 'all' |
| [1013](#L1013) | ); |
| [1014](#L1014) |  |
| [1015](#L1015) | // Enqueue the JS for the settings page. |
| [1016](#L1016) | wp\_enqueue\_script( |
| [1017](#L1017) | 'boldgrid-backup-admin-settings', |
| [1018](#L1018) | plugin\_dir\_url( \_\_FILE\_\_ ) . 'js/boldgrid-backup-admin-settings.js', |
| [1019](#L1019) | array( 'jquery' ), |
| [1020](#L1020) | BOLDGRID\_BACKUP\_VERSION, |
| [1021](#L1021) | false |
| [1022](#L1022) | ); |
| [1023](#L1023) |  |
| [1024](#L1024) | wp\_enqueue\_script( |
| [1025](#L1025) | 'boldgrid-backup-admin-settings-autoupdate', |
| [1026](#L1026) | plugin\_dir\_url( \_\_FILE\_\_ ) . 'js/boldgrid-backup-admin-settings-autoupdate.js', |
| [1027](#L1027) | array( 'jquery' ), |
| [1028](#L1028) | BOLDGRID\_BACKUP\_VERSION, |
| [1029](#L1029) | false |
| [1030](#L1030) | ); |
| [1031](#L1031) |  |
| [1032](#L1032) | // Enqueue JS for the toggles on the auto-updates section. |
| [1033](#L1033) | wp\_enqueue\_script( |
| [1034](#L1034) | 'boldgrid-library-connect', |
| [1035](#L1035) | \Boldgrid\Library\Library\Configs::get( 'libraryUrl' ) . 'src/assets/js/connect.js', |
| [1036](#L1036) | array( 'jquery' ), |
| [1037](#L1037) | BOLDGRID\_BACKUP\_VERSION, |
| [1038](#L1038) | false |
| [1039](#L1039) | ); |
| [1040](#L1040) |  |
| [1041](#L1041) | // Enqueue jquery-toggles JS. |
| [1042](#L1042) | wp\_enqueue\_script( |
| [1043](#L1043) | 'jquery-toggles', |
| [1044](#L1044) | \Boldgrid\Library\Library\Configs::get( 'libraryUrl' ) . 'build/toggles.min.js', |
| [1045](#L1045) | array( 'jquery' ), |
| [1046](#L1046) | BOLDGRID\_BACKUP\_VERSION, |
| [1047](#L1047) | true |
| [1048](#L1048) | ); |
| [1049](#L1049) |  |
| [1050](#L1050) | // Enqueue jquery-toggles CSS. |
| [1051](#L1051) | wp\_enqueue\_style( |
| [1052](#L1052) | 'jquery-toggles-full', |
| [1053](#L1053) | \Boldgrid\Library\Library\Configs::get( 'libraryUrl' ) . 'build/toggles-full.css', |
| [1054](#L1054) | array(), |
| [1055](#L1055) | BOLDGRID\_BACKUP\_VERSION |
| [1056](#L1056) | ); |
| [1057](#L1057) |  |
| [1058](#L1058) | $this->core->folder\_exclusion->enqueue\_scripts(); |
| [1059](#L1059) | $this->core->db\_omit->enqueue\_scripts(); |
| [1060](#L1060) |  |
| [1061](#L1061) | $settings = $this->get\_settings(); |
| [1062](#L1062) |  |
| [1063](#L1063) | // If the directory path is not in the settings, then add it for the form. |
| [1064](#L1064) | if ( empty( $settings['backup\_directory'] ) ) { |
| [1065](#L1065) | $settings['backup\_directory'] = $this->core->backup\_dir->get(); |
| [1066](#L1066) | } |
| [1067](#L1067) |  |
| [1068](#L1068) | $available\_compressors = $this->core->compressors->get\_available(); |
| [1069](#L1069) |  |
| [1070](#L1070) | if ( ! $is\_premium || ! $is\_premium\_installed || ! $is\_premium\_active ) { |
| [1071](#L1071) | $settings['encrypt\_db'] = false; |
| [1072](#L1072) | } |
| [1073](#L1073) |  |
| [1074](#L1074) | $in\_modal = true; |
| [1075](#L1075) | $modal    = include BOLDGRID\_BACKUP\_PATH . '/admin/partials/boldgrid-backup-admin-backup-modal.php'; |
| [1076](#L1076) | $in\_modal = false; |
| [1077](#L1077) |  |
| [1078](#L1078) | echo ' |
| [1079](#L1079) | <div class="wrap"> |
| [1080](#L1080) | <div id="bglib-page-container" class="bgbkup-page-container"> |
| [1081](#L1081) | <div id="bglib-page-top"> |
| [1082](#L1082) | <div id="bglib-page-header" class="bglib-has-logo"> |
| [1083](#L1083) | <h1>' . esc\_html\_\_( 'Total Upkeep Backup and Restore Settings', 'boldgrid-backup' ) . '</h1> |
| [1084](#L1084) | <div class="page-title-actions"> |
| [1085](#L1085) | <a href="#TB\_inline?width=800&amp;height=600&amp;inlineId=backup\_now\_content" class="thickbox page-title-action page-title-action-primary">' . |
| [1086](#L1086) | esc\_html\_\_( 'Backup Site Now', 'boldgrid-backup' ) . ' |
| [1087](#L1087) | </a> |
| [1088](#L1088) | <a class="page-title-action add-new">' . esc\_html\_\_( 'Upload Backup', 'boldgrid-backup' ) . '</a> |
| [1089](#L1089) | </div> |
| [1090](#L1090) | </div> |
| [1091](#L1091) | </div> |
| [1092](#L1092) | <div id="bglib-page-content"> |
| [1093](#L1093) | <div class="wp-header-end"></div>'; |
| [1094](#L1094) | echo $modal; //phpcs:ignore WordPress.XSS.EscapeOutput.OutputNotEscaped |
| [1095](#L1095) | include BOLDGRID\_BACKUP\_PATH . '/admin/partials/boldgrid-backup-admin-settings.php'; |
| [1096](#L1096) | echo ' |
| [1097](#L1097) | </div> |
| [1098](#L1098) | </div> |
| [1099](#L1099) | </div>'; |
| [1100](#L1100) | } |
| [1101](#L1101) |  |
| [1102](#L1102) | /\*\* |
| [1103](#L1103) | \* Save our settings. |
| [1104](#L1104) | \* |
| [1105](#L1105) | \* @since 1.5.2 |
| [1106](#L1106) | \* |
| [1107](#L1107) | \* @param  array $settings Settings. |
| [1108](#L1108) | \* @return bool True on success. |
| [1109](#L1109) | \*/ |
| [1110](#L1110) | public function save( $settings ) { |
| [1111](#L1111) | return update\_site\_option( 'boldgrid\_backup\_settings', $settings ); |
| [1112](#L1112) | } |
| [1113](#L1113) |  |
| [1114](#L1114) | /\*\* |
| [1115](#L1115) | \* Update CRON jobs. |
| [1116](#L1116) | \* |
| [1117](#L1117) | \* @since 1.8.0 |
| [1118](#L1118) | \* |
| [1119](#L1119) | \* @param  array $settings Settings. |
| [1120](#L1120) | \* @return array |
| [1121](#L1121) | \*/ |
| [1122](#L1122) | public function update\_cron( array $settings ) { |
| [1123](#L1123) | $settings['crons\_added'] = false; |
| [1124](#L1124) |  |
| [1125](#L1125) | $scheduler = ! empty( $settings['scheduler'] ) ? $settings['scheduler'] : null; |
| [1126](#L1126) |  |
| [1127](#L1127) | if ( 'wp-cron' === $scheduler ) { |
| [1128](#L1128) | $settings['crons\_added'] = $this->core->wp\_cron->add\_all\_crons( $settings ); |
| [1129](#L1129) | } elseif ( 'cron' === $scheduler ) { |
| [1130](#L1130) | $settings['crons\_added']     = $this->core->cron->add\_all\_crons( $settings ); |
| [1131](#L1131) | $settings['crontab\_version'] = $this->core->cron->crontab\_version; |
| [1132](#L1132) | $settings['cron\_secret']     = $this->core->cron->get\_cron\_secret(); |
| [1133](#L1133) | } |
| [1134](#L1134) |  |
| [1135](#L1135) | return $settings; |
| [1136](#L1136) | } |
| [1137](#L1137) | } |

**Note:** See [TracBrowser](/wiki/TracBrowser)
for help on using the repository browser.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Plain Text](/browser/boldgrid-backup/tags/1.16.5/admin/class-boldgrid-backup-admin-settings.php?format=txt)
* [Original Format](/export/3222451/boldgrid-backup/tags/1.16.5/admin/class-boldgrid-backup-admin-settings.php)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)


