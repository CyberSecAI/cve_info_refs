=== Content from plugins.trac.wordpress.org_4c92a845_20250114_224005.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fchangeset%2F3188357%2Fays-popup-box%2Ftags%2F4.9.8%2Fadmin%2Fclass-ays-pb-admin.php%3Fold%3D3186262%26old_path%3Days-popup-box%252Ftags%252F4.9.7%252Fadmin%252Fclass-ays-pb-admin.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* [Reverse Diff](/changeset/3186262/ays-popup-box/tags/4.9.7/admin/class-ays-pb-admin.php?old=3188357&old_path=%2Fays-popup-box%2Ftags%2F4.9.8%2Fadmin%2Fclass-ays-pb-admin.php)

---

# Changes from [ays-popup-box/tags/4.9.7/admin/class-ays-pb-admin.php](/browser/ays-popup-box/tags/4.9.7/admin/class-ays-pb-admin.php?rev=3186262 "Show entry in browser") at [r3186262](/changeset/3186262 "Show full changeset") to [ays-popup-box/tags/4.9.8/admin/class-ays-pb-admin.php](/browser/ays-popup-box/tags/4.9.8/admin/class-ays-pb-admin.php?rev=3188357 "Show entry in browser") at [r3188357](/changeset/3188357 "Show full changeset")

View differences
inline
side by side

Show
lines around each change

Show the changes in full context

Ignore:

Blank lines

Case changes

White space changes

File:

1 edited

* [ays-popup-box/tags/4.9.8/admin/class-ays-pb-admin.php](/browser/ays-popup-box/tags/4.9.8/admin/class-ays-pb-admin.php?rev=3188357 "Show entry in browser")
  (modified)
  ([2 diffs](#file0 "Show differences"))

### Legend:

Unmodified
Added
Removed

* ## [ays-popup-box/tags/4.9.8/admin/class-ays-pb-admin.php](/changeset/3188357/ays-popup-box/tags/4.9.8/admin/class-ays-pb-admin.php?old=3186262&old_path=ays-popup-box%2Ftags%2F4.9.7%2Fadmin%2Fclass-ays-pb-admin.php "Show the [3186262:3188357] differences restricted to ays-popup-box/tags/4.9.8/admin/class-ays-pb-admin.php")

  | [r3186262](/browser/ays-popup-box/tags/4.9.7/admin/class-ays-pb-admin.php?rev=3186262#L589 "Show revision 3186262 of this file in browser") | [r3188357](/browser/ays-popup-box/tags/4.9.8/admin/class-ays-pb-admin.php?rev=3188357#L589 "Show revision 3188357 of this file in browser") |  |
  | --- | --- | --- |
  | 589 | 589 | \*  Documentation : https://codex.wordpress.org/Plugin\_API/Filter\_Reference/plugin\_action\_links\_(plugin\_file\_name) |
  | 590 | 590 | \*/ |
  |  | 591 |  |
  |  | 592 | $popup\_ajax\_deactivate\_plugin\_nonce = wp\_create\_nonce( 'popup-box-ajax-deactivate-plugin-nonce' ); |
  |  | 593 |  |
  | 591 | 594 | $settings\_link = array( |
  | 592 | 595 | '<a href="' . admin\_url( 'options-general.php?page=' . $this->plugin\_name ) . '">' . \_\_('Settings', "ays-popup-box") . '</a>', |
  | 593 | 596 | '<a href="https://ays-demo.com/popup-box-plugin-free-demo/" target="\_blank">' . \_\_('Demo', "ays-popup-box") . '</a>', |
  | 594 |  | '<a id="ays-pb-plugins-buy-now-button" href="https://ays-pro.com/wordpress/popup-box?utm\_source=dashboard&utm\_medium=popup-free&utm\_campaign=plugins-buy-now-button" target="\_blank">' . \_\_('Upgrade 30% Sale', "ays-popup-box") . '</a>', |
  |  | 597 | '<a id="ays-pb-plugins-buy-now-button" href="https://ays-pro.com/wordpress/popup-box?utm\_source=dashboard&utm\_medium=popup-free&utm\_campaign=plugins-buy-now-button" target="\_blank">' . \_\_('Upgrade 30% Sale', "ays-popup-box") . '</a> |
  |  | 598 | <input type="hidden" id="popup\_box\_ajax\_deactivate\_plugin\_nonce" name="popup\_box\_ajax\_deactivate\_plugin\_nonce" value="' . $popup\_ajax\_deactivate\_plugin\_nonce .'">', |
  |  | 599 |  |
  | 595 | 600 | ); |
  | 596 | 601 | return array\_merge(  $settings\_link, $links ); |
  | […](/browser/ays-popup-box/tags/4.9.7/admin/class-ays-pb-admin.php?rev=3186262#L608) | […](/browser/ays-popup-box/tags/4.9.8/admin/class-ays-pb-admin.php?rev=3188357#L613) |  |
  | 608 | 613 |  |
  | 609 | 614 | public function deactivate\_plugin\_option() { |
  | 610 |  | error\_reporting(0); |
  | 611 |  |  |
  | 612 |  | $request\_value = isset( $\_REQUEST['upgrade\_plugin'] ) ? sanitize\_text\_field( $\_REQUEST['upgrade\_plugin'] ) : ''; |
  | 613 |  |  |
  | 614 |  | $upgrade\_option = get\_option( 'ays\_pb\_upgrade\_plugin', '' ); |
  | 615 |  |  |
  | 616 |  | if ( $upgrade\_option === '' ) { |
  | 617 |  | add\_option( 'ays\_pb\_upgrade\_plugin', $request\_value ); |
  |  | 615 | // Run a security check. |
  |  | 616 | check\_ajax\_referer( 'popup-box-ajax-deactivate-plugin-nonce', sanitize\_key( $\_REQUEST['\_ajax\_nonce'] ) ); |
  |  | 617 |  |
  |  | 618 | // Check for permissions. |
  |  | 619 | if ( ! current\_user\_can( 'manage\_options' ) ) { |
  |  | 620 | ob\_end\_clean(); |
  |  | 621 | $ob\_get\_clean = ob\_get\_clean(); |
  |  | 622 | echo json\_encode(array( |
  |  | 623 | 'option' => '' |
  |  | 624 | )); |
  |  | 625 | wp\_die(); |
  |  | 626 | } |
  |  | 627 |  |
  |  | 628 | if( is\_user\_logged\_in() ) { |
  |  | 629 | $request\_value = isset( $\_REQUEST['upgrade\_plugin'] ) ? sanitize\_text\_field( $\_REQUEST['upgrade\_plugin'] ) : ''; |
  |  | 630 | $upgrade\_option = get\_option( 'ays\_pb\_upgrade\_plugin', '' ); |
  |  | 631 |  |
  |  | 632 | if ( $upgrade\_option === '' ) { |
  |  | 633 | add\_option( 'ays\_pb\_upgrade\_plugin', $request\_value ); |
  |  | 634 | } else { |
  |  | 635 | update\_option( 'ays\_pb\_upgrade\_plugin', $request\_value ); |
  |  | 636 | } |
  |  | 637 |  |
  |  | 638 | $response = array( |
  |  | 639 | 'option' => get\_option( 'ays\_pb\_upgrade\_plugin', '' ), |
  |  | 640 | ); |
  |  | 641 |  |
  |  | 642 | wp\_send\_json\_success( $response ); |
  | 618 | 643 | } else { |
  | 619 |  | update\_option( 'ays\_pb\_upgrade\_plugin', $request\_value ); |
  | 620 |  | } |
  | 621 |  |  |
  | 622 |  | $response = array( |
  | 623 |  | 'option' => get\_option( 'ays\_pb\_upgrade\_plugin', '' ), |
  | 624 |  | ); |
  | 625 |  |  |
  | 626 |  | wp\_send\_json\_success( $response ); |
  |  | 644 | ob\_end\_clean(); |
  |  | 645 | $ob\_get\_clean = ob\_get\_clean(); |
  |  | 646 | echo json\_encode(array( |
  |  | 647 | 'option' => '' |
  |  | 648 | )); |
  |  | 649 | wp\_die(); |
  |  | 650 | } |
  | 627 | 651 | } |
  | 628 | 652 |  |

**Note:** See [TracChangeset](/wiki/TracChangeset)
for help on using the changeset viewer.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Unified Diff](?format=diff&new=3188357&old=3186262&new_path=%2Fays-popup-box%2Ftags%2F4.9.8%2Fadmin%2Fclass-ays-pb-admin.php&old_path=%2Fays-popup-box%2Ftags%2F4.9.7%2Fadmin%2Fclass-ays-pb-admin.php)
* [Zip Archive](?format=zip&new=3188357&old=3186262&new_path=%2Fays-popup-box%2Ftags%2F4.9.8%2Fadmin%2Fclass-ays-pb-admin.php&old_path=%2Fays-popup-box%2Ftags%2F4.9.7%2Fadmin%2Fclass-ays-pb-admin.php)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from www.wordfence.com_d54b2d4f_20250114_224008.html ===


[![](https://www.wordfence.com/img/wordfence-intelligence-logo.svg)](/threat-intel/)

Have you found a vulnerability in a WordPress plugin or theme? Report vulnerabilities in WordPress plugins and themes through our [bug bounty program](https://www.wordfence.com/threat-intel/bug-bounty-program) and earn a bounty on all in-scope submissions, while we handle the responsible disclosure process on your behalf.

As a reminder, the Wordfence Intelligence Vulnerability Database API is completely free to query and utilize, both personally and commercially, and contains all the same vulnerability data as the user interface. Please review the API documentation and Webhook documentation for more information on how to query the vulnerability API endpoints and configure webhooks utilizing all the same data present in the Wordfence Intelligence user interface.

# Popup Box – Create Countdown, Coupon, Video, Contact Form Popups <= 4.9.7 - Missing Authorization to Unauthenticated Limited Options Update

 [Wordfence Intelligence](https://www.wordfence.com/threat-intel)   >    [Vulnerability Database](https://www.wordfence.com/threat-intel/vulnerabilities)   >   Popup Box – Create Countdown, Coupon, Video, Contact Form Popups <= 4.9.7 - Missing Authorization to Unauthenticated Limited Options Update

5.3

**Missing Authorization**
**CVSS Vector**
[CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:L/A:N](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:L/A:N)

| CVE | [CVE-2024-10861](https://www.cve.org/CVERecord?id=CVE-2024-10861) |
| --- | --- |
| CVSS | 5.3 (Medium) |
| Publicly Published | November 15, 2024 |
| Last Updated | November 16, 2024 |
| Researcher | [Trương Hữu Phúc (truonghuuphuc)](https://www.wordfence.com/threat-intel/vulnerabilities/researchers/phuc-truong-huu) |

### Description

The Popup Box – Create Countdown, Coupon, Video, Contact Form Popups plugin for WordPress is vulnerable to unauthorized modification of data due to a missing capability check on the deactivate\_plugin\_option() function in all versions up to, and including, 4.9.7. This makes it possible for unauthenticated attackers to update the 'ays\_pb\_upgrade\_plugin' option with arbitrary data.

#### References

* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/browser/ays-popup-box/tags/4.9.2/admin/class-ays-pb-admin.php#L609)
* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/changeset/3188357/ays-popup-box/tags/4.9.8/admin/class-ays-pb-admin.php?old=3186262&old_path=ays-popup-box%2Ftags%2F4.9.7%2Fadmin%2Fclass-ays-pb-admin.php)

#### Share

[Facebook](https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fays-popup-box%2Fpopup-box-create-countdown-coupon-video-contact-form-popups-497-missing-authorization-to-unauthenticated-limited-options-update&t=Popup%20Box%20%E2%80%93%20Create%20Countdown%2C%20Coupon%2C%20Video%2C%20Contact%20Form%20Popups%20%3C%3D%204.9.7%20-%20Missing%20Authorization%20to%20Unauthenticated%20Limited%20Options%20Update "Facebook")
[Twitter](https://twitter.com/share?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fays-popup-box%2Fpopup-box-create-countdown-coupon-video-contact-form-popups-497-missing-authorization-to-unauthenticated-limited-options-update&text=Popup%20Box%20%E2%80%93%20Create%20Countdown%2C%20Coupon%2C%20Video%2C%20Contact%20Form%20Popups%20%3C%3D%204.9.7%20-%20Missing%20Authorization%20to%20Unauthenticated%20Limited%20Options%20Update "Twitter")
[LinkedIn](https://www.linkedin.com/shareArticle?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fays-popup-box%2Fpopup-box-create-countdown-coupon-video-contact-form-popups-497-missing-authorization-to-unauthenticated-limited-options-update "LinkedIn")
Email

## Vulnerability Details for Popup Box – Create Countdown, Coupon, Video, Contact Form Popups

#### [Popup Box – Create Countdown, Coupon, Video, Contact Form Popups](https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/ays-popup-box)

| Software Type | Plugin |
| --- | --- |
| Software Slug | ays-popup-box [(view on wordpress.org)](https://wordpress.org/plugins/ays-popup-box) |
| Patched? | Yes |
| Remediation | Update to version 4.9.8, or a newer patched version |
| Affected Version | * <= 4.9.7 |
| Patched Version | * 4.9.8 |

This record contains material that is subject to copyright.

**Copyright 2012-2025 Defiant Inc.**

**License:**
Defiant hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute this software vulnerability information. Any copy of the software vulnerability information you make for such purposes is authorized provided that you include a hyperlink to this vulnerability record and reproduce Defiant's copyright designation and this license in any such copy.
**[Read more.](https://www.wordfence.com/wordfence-intelligence-terms-and-conditions/)**

**Copyright 1999-2025 The MITRE Corporation**

**License:**
CVE Usage: MITRE hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute Common Vulnerabilities and Exposures (CVE®). Any copy you make for such purposes is authorized provided that you reproduce MITRE's copyright designation and this license in any such copy.
**[Read more.](https://www.cve.org/Legal/TermsOfUse)**

Have information to add, or spot any errors? Contact us at wfi-support@wordfence.com so we can make any appropriate adjustments.

Did you know Wordfence Intelligence provides free personal and commercial API access to our comprehensive WordPress vulnerability database, along with a free webhook integration to stay on top of the latest vulnerabilities added and updated in the database? Get started today!

Learn more

Want to get notified of the latest vulnerabilities that may affect your WordPress site?
 Install Wordfence on your site today to get notified immediately if your site is affected by a vulnerability that has been added to our database.

Get Wordfence

The Wordfence Intelligence WordPress vulnerability database is completely free to access and query via API. Please review the documentation on how to access and consume the vulnerability data via API.

Documentation



=== Content from plugins.trac.wordpress.org_1830b2e0_20250114_224004.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fbrowser%2Fays-popup-box%2Ftags%2F4.9.2%2Fadmin%2Fclass-ays-pb-admin.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* [Blame](/browser/ays-popup-box/tags/4.9.2/admin/class-ays-pb-admin.php?annotate=blame "Annotate each line with the last changed revision (this can be time consuming...)")
* [Revision Log](/log/ays-popup-box/tags/4.9.2/admin/class-ays-pb-admin.php)

---

# [source:](/browser?order=name "Go to repository root") [ays-popup-box](/browser/ays-popup-box?order=name "View ays-popup-box")/[tags](/browser/ays-popup-box/tags?order=name "View tags")/[4.9.2](/browser/ays-popup-box/tags/4.9.2?order=name "View 4.9.2")/[admin](/browser/ays-popup-box/tags/4.9.2/admin?order=name "View admin")/[class-ays-pb-admin.php](/browser/ays-popup-box/tags/4.9.2/admin/class-ays-pb-admin.php?order=name "View class-ays-pb-admin.php")

View diff against:

View revision:

| [Last change](/changeset/3174791/ays-popup-box/tags/4.9.2/admin/class-ays-pb-admin.php "View differences") on this file was [3174791](/changeset/3174791/ "View changeset 3174791"), checked in by ays-pro, [3 months ago](/timeline?from=2024-10-24T08%3A15%3A40Z&precision=second "See timeline at 10/24/2024 08:15:40 AM") |
| --- |
| Delete 4.9.2 version |
| **File size:** 52.2 KB | |

| Line |  |
| --- | --- |
| [1](#L1) | <?php |
| [2](#L2) |  |
| [3](#L3) | /\*\* |
| [4](#L4) | \* The admin-specific functionality of the plugin. |
| [5](#L5) | \* |
| [6](#L6) | \* @link       http://ays-pro.com/ |
| [7](#L7) | \* @since      1.0.0 |
| [8](#L8) | \* |
| [9](#L9) | \* @package    Ays\_Pb |
| [10](#L10) | \* @subpackage Ays\_Pb/admin |
| [11](#L11) | \*/ |
| [12](#L12) |  |
| [13](#L13) | /\*\* |
| [14](#L14) | \* The admin-specific functionality of the plugin. |
| [15](#L15) | \* |
| [16](#L16) | \* Defines the plugin name, version, and two examples hooks for how to |
| [17](#L17) | \* enqueue the admin-specific stylesheet and JavaScript. |
| [18](#L18) | \* |
| [19](#L19) | \* @package    Ays\_Pb |
| [20](#L20) | \* @subpackage Ays\_Pb/admin |
| [21](#L21) | \* @author     AYS Pro LLC <info@ays-pro.com> |
| [22](#L22) | \*/ |
| [23](#L23) | class Ays\_Pb\_Admin { |
| [24](#L24) |  |
| [25](#L25) | /\*\* |
| [26](#L26) | \* The ID of this plugin. |
| [27](#L27) | \* |
| [28](#L28) | \* @since    1.0.0 |
| [29](#L29) | \* @access   private |
| [30](#L30) | \* @var      string    $plugin\_name    The ID of this plugin. |
| [31](#L31) | \*/ |
| [32](#L32) | private $plugin\_name; |
| [33](#L33) |  |
| [34](#L34) | /\*\* |
| [35](#L35) | \* The version of this plugin. |
| [36](#L36) | \* |
| [37](#L37) | \* @since    1.0.0 |
| [38](#L38) | \* @access   private |
| [39](#L39) | \* @var      string    $version    The current version of this plugin. |
| [40](#L40) | \*/ |
| [41](#L41) | private $version; |
| [42](#L42) |  |
| [43](#L43) | private $popupbox\_obj; |
| [44](#L44) | private $settings\_obj; |
| [45](#L45) | private $popup\_categories\_obj; |
| [46](#L46) |  |
| [47](#L47) | /\*\* |
| [48](#L48) | \* Initialize the class and set its properties. |
| [49](#L49) | \* |
| [50](#L50) | \* @since    1.0.0 |
| [51](#L51) | \* @param      string    $plugin\_name       The name of this plugin. |
| [52](#L52) | \* @param      string    $version    The version of this plugin. |
| [53](#L53) | \*/ |
| [54](#L54) | public function \_\_construct($plugin\_name, $version) { |
| [55](#L55) | $this->plugin\_name = $plugin\_name; |
| [56](#L56) | $this->version = $version; |
| [57](#L57) |  |
| [58](#L58) | add\_filter('set-screen-option', array(\_\_CLASS\_\_, 'set\_screen'), 10, 3); |
| [59](#L59) | $per\_page\_array = array( |
| [60](#L60) | 'popupboxes\_per\_page', |
| [61](#L61) | 'popup\_categories\_per\_page', |
| [62](#L62) | ); |
| [63](#L63) |  |
| [64](#L64) | foreach ($per\_page\_array as $option\_name) { |
| [65](#L65) | add\_filter('set\_screen\_option\_' . $option\_name, array(\_\_CLASS\_\_, 'set\_screen'), 10, 3); |
| [66](#L66) | } |
| [67](#L67) | } |
| [68](#L68) |  |
| [69](#L69) | public static function set\_screen($status, $option, $value) { |
| [70](#L70) | return $value; |
| [71](#L71) | } |
| [72](#L72) |  |
| [73](#L73) | /\*\* |
| [74](#L74) | \* Register the stylesheets for the admin area. |
| [75](#L75) | \* |
| [76](#L76) | \* @since    1.0.0 |
| [77](#L77) | \*/ |
| [78](#L78) | public function enqueue\_styles($hook\_suffix) { |
| [79](#L79) | wp\_enqueue\_style($this->plugin\_name . '-admin', plugin\_dir\_url(\_\_FILE\_\_) . 'css/admin.css', array(), $this->version, 'all'); |
| [80](#L80) | wp\_enqueue\_style($this->plugin\_name . '-sweetalert', plugin\_dir\_url(\_\_FILE\_\_) . '/css/ays-pb-sweetalert2.min.css', array(), $this->version, 'all'); |
| [81](#L81) |  |
| [82](#L82) | if(false === strpos($hook\_suffix, $this->plugin\_name)) |
| [83](#L83) | return; |
| [84](#L84) |  |
| [85](#L85) | // Extended styles |
| [86](#L86) | wp\_enqueue\_style( 'wp-color-picker' ); |
| [87](#L87) | wp\_enqueue\_style( $this->plugin\_name . '-animate', plugin\_dir\_url(\_\_FILE\_\_) . 'css/animate.css', array(), $this->version, 'all' ); |
| [88](#L88) | wp\_enqueue\_style( $this->plugin\_name . '-bootstrap', plugin\_dir\_url(\_\_FILE\_\_) . 'css/bootstrap.min.css', array(), $this->version, 'all' ); |
| [89](#L89) | wp\_enqueue\_style( $this->plugin\_name . '-select2', plugin\_dir\_url(\_\_FILE\_\_) . 'css/ays-pb-select2.min.css', array(), $this->version, 'all' ); |
| [90](#L90) | wp\_enqueue\_style( $this->plugin\_name . '-jquery-datetimepicker', plugin\_dir\_url(\_\_FILE\_\_) . 'css/jquery-ui-timepicker-addon.css', array(), $this->version, 'all' ); |
| [91](#L91) | wp\_enqueue\_style( $this->plugin\_name . '-codemirror', plugin\_dir\_url(\_\_FILE\_\_) . 'css/ays-pb-codemirror.css', array(), $this->version, 'all'); |
| [92](#L92) | wp\_enqueue\_style( $this->plugin\_name . '-dropdown', plugin\_dir\_url(\_\_FILE\_\_) .  'css/dropdown.min.css', array(), $this->version, 'all'); |
| [93](#L93) | wp\_enqueue\_style( $this->plugin\_name . '-transition', plugin\_dir\_url(\_\_FILE\_\_) .  'css/transition.min.css', array(), $this->version, 'all'); |
| [94](#L94) |  |
| [95](#L95) | // Manual styles |
| [96](#L96) | wp\_enqueue\_style( $this->plugin\_name, plugin\_dir\_url( \_\_FILE\_\_ ) . 'css/ays-pb-admin.css', array(), $this->version, 'all' ); |
| [97](#L97) | wp\_enqueue\_style( $this->plugin\_name. '-banner', plugin\_dir\_url( \_\_FILE\_\_ ) . 'css/ays-pb-banner.css', array(), $this->version, 'all' ); |
| [98](#L98) | wp\_enqueue\_style( $this->plugin\_name . "-pro-features", plugin\_dir\_url( \_\_FILE\_\_ ) . 'css/ays-pb-pro-features.css', array(), time(), 'all' ); |
| [99](#L99) | } |
| [100](#L100) |  |
| [101](#L101) | /\*\* |
| [102](#L102) | \* Register the JavaScript for the admin area. |
| [103](#L103) | \* |
| [104](#L104) | \* @since    1.0.0 |
| [105](#L105) | \*/ |
| [106](#L106) | public function enqueue\_scripts($hook\_suffix) { |
| [107](#L107) | global $wp\_version; |
| [108](#L108) |  |
| [109](#L109) | if ( false !== strpos($hook\_suffix, "plugins.php") ) { |
| [110](#L110) | wp\_enqueue\_script( $this->plugin\_name . '-sweetalert', plugin\_dir\_url(\_\_FILE\_\_) . '/js/ays-pb-sweetalert2.all.min.js', array('jquery'), $this->version, true ); |
| [111](#L111) | wp\_enqueue\_script( $this->plugin\_name . '-admin', plugin\_dir\_url(\_\_FILE\_\_) . 'js/admin.js', array('jquery'), $this->version, true ); |
| [112](#L112) | wp\_localize\_script( $this->plugin\_name . '-admin', 'popup\_box\_ajax', array('ajax\_url' => admin\_url('admin-ajax.php')) ); |
| [113](#L113) | } |
| [114](#L114) |  |
| [115](#L115) | if(false === strpos($hook\_suffix, $this->plugin\_name)) |
| [116](#L116) | return; |
| [117](#L117) |  |
| [118](#L118) | $wp\_post\_types = get\_post\_types('', 'objects'); |
| [119](#L119) | $all\_post\_types = array(); |
| [120](#L120) | foreach ($wp\_post\_types as $pt){ |
| [121](#L121) | $all\_post\_types[] = array( |
| [122](#L122) | $pt->name, |
| [123](#L123) | $pt->label |
| [124](#L124) | ); |
| [125](#L125) | } |
| [126](#L126) |  |
| [127](#L127) | $pb\_banner\_date = $this->ays\_pb\_update\_banner\_time(); |
| [128](#L128) |  |
| [129](#L129) | $pb\_ajax\_data = array( |
| [130](#L130) | 'ajax' => admin\_url('admin-ajax.php'), |
| [131](#L131) | 'post\_types' => $all\_post\_types, |
| [132](#L132) | 'nextPopupPage' => \_\_( 'Are you sure you want to go to the next popup page?', "ays-popup-box"), |
| [133](#L133) | 'prevPopupPage' => \_\_( 'Are you sure you want to go to the previous popup page?', "ays-popup-box"), |
| [134](#L134) | 'AYS\_PB\_ADMIN\_URL' => AYS\_PB\_ADMIN\_URL, |
| [135](#L135) | 'AYS\_PB\_PUBLIC\_URL' => AYS\_PB\_PUBLIC\_URL, |
| [136](#L136) | 'addVideo' => \_\_( "Add Video", "ays-popup-box" ), |
| [137](#L137) | 'editVideo' => \_\_( "Edit Video", "ays-popup-box" ), |
| [138](#L138) | 'addImage' => \_\_( "Add Image", "ays-popup-box" ), |
| [139](#L139) | 'editImage' => \_\_( "Edit Image", "ays-popup-box" ), |
| [140](#L140) | 'pleaseEnterMore' => \_\_( "Please select more", "ays-popup-box" ), |
| [141](#L141) | 'loadResource' => \_\_( "Can't load resource.", "ays-popup-box" ), |
| [142](#L142) | 'errorMsg' => \_\_( "Error", "ays-popup-box" ), |
| [143](#L143) | 'somethingWentWrong' => \_\_( "Maybe something went wrong.", "ays-popup-box" ), |
| [144](#L144) | 'activated' => \_\_( "Activated", "ays-popup-box" ), |
| [145](#L145) | 'pbBannerDate' => $pb\_banner\_date, |
| [146](#L146) | ); |
| [147](#L147) |  |
| [148](#L148) | $color\_picker\_strings = array( |
| [149](#L149) | 'clear' => \_\_( 'Clear', "ays-popup-box" ), |
| [150](#L150) | 'clearAriaLabel' => \_\_( 'Clear color', "ays-popup-box" ), |
| [151](#L151) | 'defaultString' => \_\_( 'Default', "ays-popup-box" ), |
| [152](#L152) | 'defaultAriaLabel' => \_\_( 'Select default color', "ays-popup-box" ), |
| [153](#L153) | 'pick' => \_\_( 'Select Color', "ays-popup-box" ), |
| [154](#L154) | 'defaultLabel' => \_\_( 'Color value', "ays-popup-box" ), |
| [155](#L155) | ); |
| [156](#L156) |  |
| [157](#L157) | // Extended scripts |
| [158](#L158) | wp\_enqueue\_script( 'jquery-effects-core' ); |
| [159](#L159) | wp\_enqueue\_script( 'jquery-ui-sortable' ); |
| [160](#L160) | wp\_enqueue\_script( 'jquery-ui-datepicker' ); |
| [161](#L161) | wp\_enqueue\_media(); |
| [162](#L162) | wp\_enqueue\_script( $this->plugin\_name . '-popper', plugin\_dir\_url(\_\_FILE\_\_) . '/js/popper.min.js', array( 'jquery' ), $this->version, true ); |
| [163](#L163) | wp\_enqueue\_script( $this->plugin\_name . '-bootstrap', plugin\_dir\_url(\_\_FILE\_\_) . '/js/bootstrap.min.js', array( 'jquery' ), $this->version, true ); |
| [164](#L164) | wp\_enqueue\_script( $this->plugin\_name . '-select2', plugin\_dir\_url(\_\_FILE\_\_) . '/js/select2.min.js', array('jquery'), $this->version, true ); |
| [165](#L165) | wp\_enqueue\_script( $this->plugin\_name . '-sweetalert', plugin\_dir\_url(\_\_FILE\_\_) . '/js/ays-pb-sweetalert2.all.min.js', array('jquery'), $this->version, true ); |
| [166](#L166) | wp\_enqueue\_script( $this->plugin\_name . '-jquery.datetimepicker', plugin\_dir\_url(\_\_FILE\_\_) . 'js/jquery-ui-timepicker-addon.js', array( 'jquery' ), $this->version, true ); |
| [167](#L167) | wp\_enqueue\_script( $this->plugin\_name . '-wp-color-picker-alpha', plugin\_dir\_url(\_\_FILE\_\_) . 'js/wp-color-picker-alpha.min.js',array( 'wp-color-picker' ),$this->version, true ); |
| [168](#L168) | wp\_enqueue\_script( $this->plugin\_name . '-dropdown-min', plugin\_dir\_url(\_\_FILE\_\_) . '/js/dropdown.min.js', array('jquery'), $this->version, true ); |
| [169](#L169) | wp\_enqueue\_script( $this->plugin\_name . '-transition-min', plugin\_dir\_url(\_\_FILE\_\_) . '/js/transition.min.js', array('jquery'), $this->version, true ); |
| [170](#L170) | wp\_localize\_script( $this->plugin\_name . '-wp-color-picker-alpha', 'wpColorPickerL10n', $color\_picker\_strings ); |
| [171](#L171) |  |
| [172](#L172) | // Manual scripts |
| [173](#L173) | wp\_enqueue\_script( $this->plugin\_name, plugin\_dir\_url( \_\_FILE\_\_ ) . 'js/ays-pb-admin.js', array( 'jquery', 'wp-color-picker' ), $this->version, false ); |
| [174](#L174) | wp\_enqueue\_script( $this->plugin\_name . '-banner' , plugin\_dir\_url( \_\_FILE\_\_ ) . 'js/ays-pb-banner.js', array( 'jquery'), $this->version, false ); |
| [175](#L175) | wp\_enqueue\_script( $this->plugin\_name . 'custom-dropdown-adapter', plugin\_dir\_url( \_\_FILE\_\_ ) . 'js/ays-select2-dropdown-adapter.js', array('jquery'), $this->version, true ); |
| [176](#L176) | wp\_localize\_script( $this->plugin\_name, 'pb', $pb\_ajax\_data ); |
| [177](#L177) |  |
| [178](#L178) | if (Ays\_Pb\_Data::ays\_version\_compare($wp\_version, '>=', '5.5')) { |
| [179](#L179) | wp\_enqueue\_script( $this->plugin\_name . '-wp-load-scripts', plugin\_dir\_url(\_\_FILE\_\_) . 'js/ays-wp-load-scripts.js', array(), $this->version, true ); |
| [180](#L180) | } |
| [181](#L181) | } |
| [182](#L182) |  |
| [183](#L183) | public function ays\_pb\_update\_banner\_time() { |
| [184](#L184) | $date = time() + ( 3 \* 24 \* 60 \* 60 ) + (int) ( get\_option( 'gmt\_offset' ) \* HOUR\_IN\_SECONDS); |
| [185](#L185) | $next\_3\_days = gmdate('M d, Y H:i:s', $date); |
| [186](#L186) |  |
| [187](#L187) | $ays\_pb\_banner\_time = get\_option('ays\_pb\_banner\_time'); |
| [188](#L188) |  |
| [189](#L189) | if ( !$ays\_pb\_banner\_time || is\_null($ays\_pb\_banner\_time) ) { |
| [190](#L190) | update\_option('ays\_pb\_banner\_time', $next\_3\_days ); |
| [191](#L191) | } |
| [192](#L192) |  |
| [193](#L193) | $get\_ays\_pb\_banner\_time = get\_option('ays\_pb\_banner\_time'); |
| [194](#L194) |  |
| [195](#L195) | $val = 60\*60\*24\*0.5; // half day |
| [196](#L196) | // $val = 60; // for testing | 1 min |
| [197](#L197) |  |
| [198](#L198) | $current\_date = current\_time('mysql'); |
| [199](#L199) | $date\_diff = strtotime($current\_date) - intval(strtotime($get\_ays\_pb\_banner\_time)); |
| [200](#L200) |  |
| [201](#L201) | $days\_diff = $date\_diff / $val; |
| [202](#L202) | if (intval($days\_diff) > 0) { |
| [203](#L203) | update\_option('ays\_pb\_banner\_time', $next\_3\_days); |
| [204](#L204) | $get\_ays\_pb\_banner\_time = get\_option('ays\_pb\_banner\_time'); |
| [205](#L205) | } |
| [206](#L206) |  |
| [207](#L207) | return $get\_ays\_pb\_banner\_time; |
| [208](#L208) | } |
| [209](#L209) |  |
| [210](#L210) | /\*\* |
| [211](#L211) | \* De-register JavaScript files for the admin area. |
| [212](#L212) | \* |
| [213](#L213) | \* @since    1.0.0 |
| [214](#L214) | \*/ |
| [215](#L215) | public function disable\_scripts($hook\_suffix) { |
| [216](#L216) | if (false !== strpos($hook\_suffix, $this->plugin\_name)) { |
| [217](#L217) | if (is\_plugin\_active('ai-engine/ai-engine.php')) { |
| [218](#L218) | wp\_deregister\_script('mwai'); |
| [219](#L219) | wp\_deregister\_script('mwai-vendor'); |
| [220](#L220) | wp\_dequeue\_script('mwai'); |
| [221](#L221) | wp\_dequeue\_script('mwai-vendor'); |
| [222](#L222) | } |
| [223](#L223) | } |
| [224](#L224) | } |
| [225](#L225) |  |
| [226](#L226) | /\*\* |
| [227](#L227) | \* Register the administration menu for this plugin into the WordPress Dashboard menu. |
| [228](#L228) | \* |
| [229](#L229) | \* @since    1.0.0 |
| [230](#L230) | \*/ |
| [231](#L231) | public function add\_plugin\_admin\_menu() { |
| [232](#L232) | add\_menu\_page( |
| [233](#L233) | \_\_('Popup Box', "ays-popup-box"), |
| [234](#L234) | \_\_('Popup Box', "ays-popup-box"), |
| [235](#L235) | 'manage\_options', |
| [236](#L236) | $this->plugin\_name, |
| [237](#L237) | array($this, 'display\_plugin\_setup\_page'), |
| [238](#L238) | plugin\_dir\_url(\_\_FILE\_\_) . '/images/icons/popup-sidemenu-logo.svg', |
| [239](#L239) | 6 |
| [240](#L240) | ); |
| [241](#L241) | } |
| [242](#L242) |  |
| [243](#L243) | public function add\_plugin\_popups\_submenu() { |
| [244](#L244) | $hook\_popupbox = add\_submenu\_page( |
| [245](#L245) | $this->plugin\_name, |
| [246](#L246) | \_\_('Popups', "ays-popup-box"), |
| [247](#L247) | \_\_('Popups', "ays-popup-box"), |
| [248](#L248) | 'manage\_options', |
| [249](#L249) | $this->plugin\_name, |
| [250](#L250) | array($this, 'display\_plugin\_setup\_page') |
| [251](#L251) | ); |
| [252](#L252) |  |
| [253](#L253) | add\_action( "load-$hook\_popupbox", array($this, 'screen\_option\_popupbox') ); |
| [254](#L254) | add\_action( "load-$hook\_popupbox", array($this, 'add\_tabs') ); |
| [255](#L255) | } |
| [256](#L256) |  |
| [257](#L257) | public function add\_plugin\_categories\_submenu() { |
| [258](#L258) | $hook\_categories = add\_submenu\_page( |
| [259](#L259) | $this->plugin\_name, |
| [260](#L260) | \_\_('Categories', "ays-popup-box"), |
| [261](#L261) | \_\_('Categories', "ays-popup-box"), |
| [262](#L262) | 'manage\_options', |
| [263](#L263) | $this->plugin\_name . '-categories', |
| [264](#L264) | array($this, 'display\_plugin\_categories\_page') |
| [265](#L265) | ); |
| [266](#L266) |  |
| [267](#L267) | add\_action( "load-$hook\_categories", array($this, 'screen\_option\_categories') ); |
| [268](#L268) | add\_action( "load-$hook\_categories", array($this, 'add\_tabs') ); |
| [269](#L269) | } |
| [270](#L270) |  |
| [271](#L271) | public function add\_plugin\_custom\_fields\_submenu() { |
| [272](#L272) | $hook\_popup\_attributes = add\_submenu\_page( |
| [273](#L273) | $this->plugin\_name, |
| [274](#L274) | \_\_('Custom Fields', "ays-popup-box"), |
| [275](#L275) | \_\_('Custom Fields', "ays-popup-box"), |
| [276](#L276) | 'manage\_options', |
| [277](#L277) | $this->plugin\_name . '-attributes', |
| [278](#L278) | array($this, 'display\_plugin\_attributes\_page') |
| [279](#L279) | ); |
| [280](#L280) |  |
| [281](#L281) | add\_action( "load-$hook\_popup\_attributes", array($this, 'add\_tabs') ); |
| [282](#L282) | } |
| [283](#L283) |  |
| [284](#L284) | public function add\_plugin\_reports\_submenu() { |
| [285](#L285) | $hook\_reports = add\_submenu\_page( |
| [286](#L286) | $this->plugin\_name, |
| [287](#L287) | \_\_('Analytics', "ays-popup-box"), |
| [288](#L288) | \_\_('Analytics', "ays-popup-box"), |
| [289](#L289) | 'manage\_options', |
| [290](#L290) | $this->plugin\_name . '-reports', |
| [291](#L291) | array($this, 'display\_plugin\_results\_page') |
| [292](#L292) | ); |
| [293](#L293) |  |
| [294](#L294) | add\_action( "load-$hook\_reports", array($this, 'add\_tabs') ); |
| [295](#L295) | } |
| [296](#L296) |  |
| [297](#L297) | public function add\_plugin\_submissions\_submenu() { |
| [298](#L298) | $hook\_subscribes = add\_submenu\_page( |
| [299](#L299) | $this->plugin\_name, |
| [300](#L300) | \_\_('Submissions', "ays-popup-box"), |
| [301](#L301) | \_\_('Submissions', "ays-popup-box"), |
| [302](#L302) | 'manage\_options', |
| [303](#L303) | $this->plugin\_name . '-subscribes', |
| [304](#L304) | array($this, 'display\_plugin\_subscribes\_page') |
| [305](#L305) | ); |
| [306](#L306) |  |
| [307](#L307) | add\_action( "load-$hook\_subscribes", array($this, 'add\_tabs') ); |
| [308](#L308) | } |
| [309](#L309) |  |
| [310](#L310) | public function add\_plugin\_export\_import\_submenu() { |
| [311](#L311) | $hook\_export\_import = add\_submenu\_page( |
| [312](#L312) | $this->plugin\_name, |
| [313](#L313) | \_\_('Export/Import', "ays-popup-box"), |
| [314](#L314) | \_\_('Export/Import', "ays-popup-box"), |
| [315](#L315) | 'manage\_options', |
| [316](#L316) | $this->plugin\_name . '-export-import', |
| [317](#L317) | array($this, 'display\_plugin\_export\_import\_page') |
| [318](#L318) | ); |
| [319](#L319) |  |
| [320](#L320) | add\_action( "load-$hook\_export\_import", array($this, 'add\_tabs') ); |
| [321](#L321) | } |
| [322](#L322) |  |
| [323](#L323) | public function add\_plugin\_settings\_submenu() { |
| [324](#L324) | $hook\_settings = add\_submenu\_page( |
| [325](#L325) | $this->plugin\_name, |
| [326](#L326) | \_\_('General Settings', "ays-popup-box"), |
| [327](#L327) | \_\_('General Settings', "ays-popup-box"), |
| [328](#L328) | 'manage\_options', |
| [329](#L329) | $this->plugin\_name . '-settings', |
| [330](#L330) | array($this, 'display\_plugin\_settings\_page') |
| [331](#L331) | ); |
| [332](#L332) |  |
| [333](#L333) | add\_action( "load-$hook\_settings", array($this, 'screen\_option\_settings') ); |
| [334](#L334) | add\_action( "load-$hook\_settings", array($this, 'add\_tabs') ); |
| [335](#L335) | } |
| [336](#L336) |  |
| [337](#L337) | public function add\_plugin\_how\_to\_use\_submenu() { |
| [338](#L338) | $hook\_how\_to\_use = add\_submenu\_page( |
| [339](#L339) | $this->plugin\_name, |
| [340](#L340) | \_\_('How to use', "ays-popup-box"), |
| [341](#L341) | \_\_('How to use', "ays-popup-box"), |
| [342](#L342) | 'manage\_options', |
| [343](#L343) | $this->plugin\_name . '-how-to-use', |
| [344](#L344) | array($this, 'display\_plugin\_how\_to\_use\_page') |
| [345](#L345) | ); |
| [346](#L346) |  |
| [347](#L347) | add\_action( "load-$hook\_how\_to\_use", array($this, 'add\_tabs') ); |
| [348](#L348) | } |
| [349](#L349) |  |
| [350](#L350) | public function add\_plugin\_featured\_plugins\_submenu() { |
| [351](#L351) | $hook\_featured\_plugins = add\_submenu\_page( |
| [352](#L352) | $this->plugin\_name, |
| [353](#L353) | \_\_('Our Products', "ays-popup-box"), |
| [354](#L354) | \_\_('Our Products', "ays-popup-box"), |
| [355](#L355) | 'manage\_options', |
| [356](#L356) | $this->plugin\_name . '-featured-plugins', |
| [357](#L357) | array($this, 'display\_plugin\_featured\_plugins\_page') |
| [358](#L358) | ); |
| [359](#L359) |  |
| [360](#L360) | add\_action("load-$hook\_featured\_plugins", array($this, 'add\_tabs') ); |
| [361](#L361) | } |
| [362](#L362) |  |
| [363](#L363) | public function add\_plugin\_pro\_features\_submenu() { |
| [364](#L364) | $hook\_pro\_features = add\_submenu\_page( |
| [365](#L365) | $this->plugin\_name, |
| [366](#L366) | \_\_('PRO Features', "ays-popup-box"), |
| [367](#L367) | \_\_('PRO Features', "ays-popup-box"), |
| [368](#L368) | 'manage\_options', |
| [369](#L369) | $this->plugin\_name . '-pb-features', |
| [370](#L370) | array($this, 'display\_plugin\_pro\_features\_page') |
| [371](#L371) | ); |
| [372](#L372) |  |
| [373](#L373) | add\_action( "load-$hook\_pro\_features", array($this, 'add\_tabs') ); |
| [374](#L374) | } |
| [375](#L375) |  |
| [376](#L376) | public function display\_plugin\_setup\_page() { |
| [377](#L377) | $action = isset($\_GET['action']) ? sanitize\_text\_field($\_GET['action']) : ''; |
| [378](#L378) |  |
| [379](#L379) | switch ($action) { |
| [380](#L380) | case 'add': |
| [381](#L381) | case 'edit': |
| [382](#L382) | include\_once('partials/actions/ays-pb-admin-actions.php'); |
| [383](#L383) | break; |
| [384](#L384) | default: |
| [385](#L385) | include\_once('partials/ays-pb-admin-display.php'); |
| [386](#L386) | break; |
| [387](#L387) | } |
| [388](#L388) | } |
| [389](#L389) |  |
| [390](#L390) | public function display\_plugin\_categories\_page() { |
| [391](#L391) | $action = isset($\_GET['action']) ? sanitize\_text\_field($\_GET['action']) : ''; |
| [392](#L392) |  |
| [393](#L393) | switch ($action) { |
| [394](#L394) | case 'add': |
| [395](#L395) | case 'edit': |
| [396](#L396) | include\_once('partials/actions/ays-pb-categories-actions.php'); |
| [397](#L397) | break; |
| [398](#L398) | default: |
| [399](#L399) | include\_once('partials/ays-pb-categories-display.php'); |
| [400](#L400) | } |
| [401](#L401) | } |
| [402](#L402) |  |
| [403](#L403) | public function display\_plugin\_attributes\_page() { |
| [404](#L404) | include\_once('partials/attributes/actions/ays-pb-attributes-actions.php'); |
| [405](#L405) | } |
| [406](#L406) |  |
| [407](#L407) | public function display\_plugin\_results\_page() { |
| [408](#L408) | include\_once('partials/reports/ays-pb-reports-display.php'); |
| [409](#L409) | } |
| [410](#L410) |  |
| [411](#L411) | public function display\_plugin\_subscribes\_page() { |
| [412](#L412) | include\_once('partials/subscribes/ays-pb-subscribes-display.php'); |
| [413](#L413) | } |
| [414](#L414) |  |
| [415](#L415) | public function display\_plugin\_export\_import\_page() { |
| [416](#L416) | include\_once('partials/export-import/ays-pb-export-import.php'); |
| [417](#L417) | } |
| [418](#L418) |  |
| [419](#L419) | public function display\_plugin\_settings\_page() { |
| [420](#L420) | include\_once('partials/settings/popup-box-settings.php'); |
| [421](#L421) | } |
| [422](#L422) |  |
| [423](#L423) | public function display\_plugin\_how\_to\_use\_page() { |
| [424](#L424) | include\_once('partials/how-to-use/ays-pb-how-to-use.php'); |
| [425](#L425) | } |
| [426](#L426) |  |
| [427](#L427) | public function display\_plugin\_featured\_plugins\_page() { |
| [428](#L428) | include\_once('partials/features/ays-pb-plugin-featured-display.php'); |
| [429](#L429) | } |
| [430](#L430) |  |
| [431](#L431) | public function display\_plugin\_pro\_features\_page() { |
| [432](#L432) | include\_once 'partials/features/popup-box-pro-features-display.php'; |
| [433](#L433) | } |
| [434](#L434) |  |
| [435](#L435) | public function screen\_option\_popupbox() { |
| [436](#L436) | $option = 'per\_page'; |
| [437](#L437) | $args = array( |
| [438](#L438) | 'label' => \_\_('PopupBox', "ays-popup-box"), |
| [439](#L439) | 'default' => 20, |
| [440](#L440) | 'option' => 'popupboxes\_per\_page' |
| [441](#L441) | ); |
| [442](#L442) |  |
| [443](#L443) | add\_screen\_option($option, $args); |
| [444](#L444) | $this->popupbox\_obj = new Ays\_PopupBox\_List\_Table($this->plugin\_name); |
| [445](#L445) | $this->settings\_obj = new Ays\_PopupBox\_Settings\_Actions($this->plugin\_name); |
| [446](#L446) | } |
| [447](#L447) |  |
| [448](#L448) | public function screen\_option\_categories() { |
| [449](#L449) | $option = 'per\_page'; |
| [450](#L450) | $args = array( |
| [451](#L451) | 'label' => \_\_('Categories', "ays-popup-box"), |
| [452](#L452) | 'default' => 20, |
| [453](#L453) | 'option' => 'popup\_categories\_per\_page' |
| [454](#L454) | ); |
| [455](#L455) |  |
| [456](#L456) | add\_screen\_option($option, $args); |
| [457](#L457) | $this->popup\_categories\_obj = new Popup\_Categories\_List\_Table($this->plugin\_name); |
| [458](#L458) | $this->settings\_obj = new Ays\_PopupBox\_Settings\_Actions($this->plugin\_name); |
| [459](#L459) | } |
| [460](#L460) |  |
| [461](#L461) | public function screen\_option\_settings() { |
| [462](#L462) | $this->settings\_obj = new Ays\_PopupBox\_Settings\_Actions($this->plugin\_name); |
| [463](#L463) | } |
| [464](#L464) |  |
| [465](#L465) | public function add\_tabs() { |
| [466](#L466) | $screen = get\_current\_screen(); |
| [467](#L467) |  |
| [468](#L468) | if (!$screen) { |
| [469](#L469) | return; |
| [470](#L470) | } |
| [471](#L471) |  |
| [472](#L472) | $screen->add\_help\_tab( |
| [473](#L473) | array( |
| [474](#L474) | 'id' => 'popupbox\_help\_tab', |
| [475](#L475) | 'title' => \_\_('General Information:', "ays-popup-box"), |
| [476](#L476) | 'content' => |
| [477](#L477) | '<h2>' . \_\_('Popup Information', "ays-popup-box") . '</h2>' . |
| [478](#L478) | '<p>' |
| [479](#L479) | . \_\_('The WordPress Popup plugin will help you to create engaging popups with fully customizable and responsive designs. Attract your audience and convert them into email subscribers or paying customers.  Construct advertising offers, generate more leads by creating option forms and subscription popups.',  "ays-popup-box") . |
| [480](#L480) | '</p>' |
| [481](#L481) | ) |
| [482](#L482) | ); |
| [483](#L483) |  |
| [484](#L484) | $screen->set\_help\_sidebar( |
| [485](#L485) | '<p><strong>' . \_\_('For more information:', "ays-popup-box") . '</strong></p>' . |
| [486](#L486) | '<p> |
| [487](#L487) | <a href="https://www.youtube.com/watch?v=YSf6-icT2Ro&list=PL18\_gEiPDg8Ocrbwn1SUjs2XaSZlgHpWj" target="\_blank">' . \_\_('Youtube video tutorials', "ays-popup-box") . '</a> |
| [488](#L488) | </p>' . |
| [489](#L489) | '<p> |
| [490](#L490) | <a href="https://ays-pro.com/wordpress-popup-box-plugin-user-manual" target="\_blank">' . \_\_('Documentation: ', "ays-popup-box") . '</a> |
| [491](#L491) | </p>' . |
| [492](#L492) | '<p> |
| [493](#L493) | <a href="https://ays-pro.com/wordpress/popup-box" target="\_blank">' . \_\_('Popup Box plugin Premium version:', "ays-popup-box") . '</a> |
| [494](#L494) | </p>' |
| [495](#L495) | ); |
| [496](#L496) | } |
| [497](#L497) |  |
| [498](#L498) | public static function get\_listtables\_title\_length($listtable\_name) { |
| [499](#L499) | global $wpdb; |
| [500](#L500) |  |
| [501](#L501) | $settings\_table = $wpdb->prefix . "ays\_pb\_settings"; |
| [502](#L502) | $result = $wpdb->get\_var( |
| [503](#L503) | $wpdb->prepare( |
| [504](#L504) | "SELECT meta\_value |
| [505](#L505) | FROM {$settings\_table} |
| [506](#L506) | WHERE meta\_key = %s", 'options') |
| [507](#L507) | ); |
| [508](#L508) | $options = ($result == "") ? array() : json\_decode(stripcslashes($result), true); |
| [509](#L509) | $listtable\_title\_length = 5; |
| [510](#L510) |  |
| [511](#L511) | if (!empty($options)) { |
| [512](#L512) | switch ($listtable\_name) { |
| [513](#L513) | case 'popups': |
| [514](#L514) | $listtable\_title\_length = (isset($options['popup\_title\_length']) && intval($options['popup\_title\_length']) != 0) ? absint( intval($options['popup\_title\_length']) ) : 5; |
| [515](#L515) | break; |
| [516](#L516) | case 'categories': |
| [517](#L517) | $listtable\_title\_length = (isset($options['categories\_title\_length']) && intval($options['categories\_title\_length']) != 0) ? absint( intval($options['categories\_title\_length']) ) : 5; |
| [518](#L518) | break; |
| [519](#L519) | default: |
| [520](#L520) | $listtable\_title\_length = 5; |
| [521](#L521) | break; |
| [522](#L522) | } |
| [523](#L523) |  |
| [524](#L524) | return $listtable\_title\_length; |
| [525](#L525) | } |
| [526](#L526) |  |
| [527](#L527) | return $listtable\_title\_length; |
| [528](#L528) | } |
| [529](#L529) |  |
| [530](#L530) | public static function ays\_pb\_restriction\_string($type, $x, $length) { |
| [531](#L531) | $output = ""; |
| [532](#L532) |  |
| [533](#L533) | switch($type) { |
| [534](#L534) | case "char": |
| [535](#L535) | if (strlen($x) <= $length) { |
| [536](#L536) | $output = $x; |
| [537](#L537) | } else { |
| [538](#L538) | $output = substr($x, 0, $length) . '...'; |
| [539](#L539) | } |
| [540](#L540) | break; |
| [541](#L541) | case "word": |
| [542](#L542) | $res = explode(" ", $x); |
| [543](#L543) | if (count($res) <= $length) { |
| [544](#L544) | $output = implode(" ", $res); |
| [545](#L545) | } else { |
| [546](#L546) | $res = array\_slice($res, 0, $length); |
| [547](#L547) | $output = implode(" ", $res) . '...'; |
| [548](#L548) | } |
| [549](#L549) | break; |
| [550](#L550) | } |
| [551](#L551) |  |
| [552](#L552) | return $output; |
| [553](#L553) | } |
| [554](#L554) |  |
| [555](#L555) | public static function validateDate($date, $format = 'Y-m-d H:i:s') { |
| [556](#L556) | $d = DateTime::createFromFormat($format, $date); |
| [557](#L557) | return $d && $d->format($format) == $date; |
| [558](#L558) | } |
| [559](#L559) |  |
| [560](#L560) | // Code Mirror |
| [561](#L561) | function codemirror\_enqueue\_scripts($hook) { |
| [562](#L562) | if (false === strpos($hook, $this->plugin\_name)) { |
| [563](#L563) | return; |
| [564](#L564) | } |
| [565](#L565) |  |
| [566](#L566) | if(function\_exists('wp\_enqueue\_code\_editor')) { |
| [567](#L567) | $cm\_settings['codeEditor'] = wp\_enqueue\_code\_editor(array( |
| [568](#L568) | 'type' => 'text/css', |
| [569](#L569) | 'codemirror' => array( |
| [570](#L570) | 'inputStyle' => 'contenteditable', |
| [571](#L571) | 'theme' => 'cobalt', |
| [572](#L572) | ) |
| [573](#L573) | )); |
| [574](#L574) |  |
| [575](#L575) | wp\_enqueue\_script('wp-theme-plugin-editor'); |
| [576](#L576) | wp\_localize\_script('wp-theme-plugin-editor', 'cm\_settings', $cm\_settings); |
| [577](#L577) |  |
| [578](#L578) | wp\_enqueue\_style('wp-codemirror'); |
| [579](#L579) | } |
| [580](#L580) | } |
| [581](#L581) |  |
| [582](#L582) | /\*\* |
| [583](#L583) | \* Add settings action link to the plugins page. |
| [584](#L584) | \* |
| [585](#L585) | \* @since    1.0.0 |
| [586](#L586) | \*/ |
| [587](#L587) | public function add\_action\_links( $links ) { |
| [588](#L588) | /\* |
| [589](#L589) | \*  Documentation : https://codex.wordpress.org/Plugin\_API/Filter\_Reference/plugin\_action\_links\_(plugin\_file\_name) |
| [590](#L590) | \*/ |
| [591](#L591) | $settings\_link = array( |
| [592](#L592) | '<a href="' . admin\_url( 'options-general.php?page=' . $this->plugin\_name ) . '">' . \_\_('Settings', "ays-popup-box") . '</a>', |
| [593](#L593) | '<a href="https://ays-demo.com/popup-box-plugin-free-demo/" target="\_blank">' . \_\_('Demo', "ays-popup-box") . '</a>', |
| [594](#L594) | '<a id="ays-pb-plugins-buy-now-button" href="https://ays-pro.com/wordpress/popup-box?utm\_source=dashboard&utm\_medium=popup-free&utm\_campaign=plugins-buy-now-button" target="\_blank">' . \_\_('Upgrade 30% Sale', "ays-popup-box") . '</a>', |
| [595](#L595) | ); |
| [596](#L596) | return array\_merge(  $settings\_link, $links ); |
| [597](#L597) |  |
| [598](#L598) | } |
| [599](#L599) |  |
| [600](#L600) | public function add\_plugin\_row\_meta($meta, $file) { |
| [601](#L601) |  |
| [602](#L602) | if ($file == AYS\_PB\_BASENAME) { |
| [603](#L603) | $meta[] = '<a href="https://wordpress.org/support/plugin/ays-popup-box/" target="\_blank">' . esc\_html\_\_( 'Free Support', "ays-popup-box" ) . '</a>'; |
| [604](#L604) | } |
| [605](#L605) |  |
| [606](#L606) | return $meta; |
| [607](#L607) | } |
| [608](#L608) |  |
| [609](#L609) | public function deactivate\_plugin\_option() { |
| [610](#L610) | error\_reporting(0); |
| [611](#L611) |  |
| [612](#L612) | $request\_value = isset( $\_REQUEST['upgrade\_plugin'] ) ? sanitize\_text\_field( $\_REQUEST['upgrade\_plugin'] ) : ''; |
| [613](#L613) |  |
| [614](#L614) | $upgrade\_option = get\_option( 'ays\_pb\_upgrade\_plugin', '' ); |
| [615](#L615) |  |
| [616](#L616) | if ( $upgrade\_option === '' ) { |
| [617](#L617) | add\_option( 'ays\_pb\_upgrade\_plugin', $request\_value ); |
| [618](#L618) | } else { |
| [619](#L619) | update\_option( 'ays\_pb\_upgrade\_plugin', $request\_value ); |
| [620](#L620) | } |
| [621](#L621) |  |
| [622](#L622) | $response = array( |
| [623](#L623) | 'option' => get\_option( 'ays\_pb\_upgrade\_plugin', '' ), |
| [624](#L624) | ); |
| [625](#L625) |  |
| [626](#L626) | wp\_send\_json\_success( $response ); |
| [627](#L627) | } |
| [628](#L628) |  |
| [629](#L629) | public function get\_selected\_options\_pb() { |
| [630](#L630) |  |
| [631](#L631) | if (isset($\_POST['data']) && !empty($\_POST['data'])) { |
| [632](#L632) | $posts = get\_posts(array( |
| [633](#L633) | 'post\_type'   => $\_POST['data'], |
| [634](#L634) | 'post\_status' => 'publish', |
| [635](#L635) | 'numberposts' => -1 |
| [636](#L636) |  |
| [637](#L637) | )); |
| [638](#L638) | } else { |
| [639](#L639) | $posts = array(); |
| [640](#L640) | } |
| [641](#L641) |  |
| [642](#L642) | $arr = array(); |
| [643](#L643) | foreach ( $posts as $post ) { |
| [644](#L644) | array\_push($arr, array($post->ID, $post->post\_title)); |
| [645](#L645) |  |
| [646](#L646) | } |
| [647](#L647) | echo json\_encode($arr); |
| [648](#L648) | wp\_die(); |
| [649](#L649) | } |
| [650](#L650) |  |
| [651](#L651) | public function close\_warning\_note\_permanently() { |
| [652](#L652) | $cookie\_expiration = time() + 60\*60\*24\*30; |
| [653](#L653) | setcookie('ays\_pb\_show\_warning\_note', 'ays\_pb\_show\_warning\_note\_value', $cookie\_expiration, '/'); |
| [654](#L654) | } |
| [655](#L655) |  |
| [656](#L656) | public function ays\_pb\_create\_author() { |
| [657](#L657) | error\_reporting(0); |
| [658](#L658) |  |
| [659](#L659) | // Check for permissions. |
| [660](#L660) | if ( !Ays\_Pb\_Data::check\_user\_capability() ) { |
| [661](#L661) | ob\_end\_clean(); |
| [662](#L662) | $ob\_get\_clean = ob\_get\_clean(); |
| [663](#L663) | echo json\_encode(array( |
| [664](#L664) | 'results' => array() |
| [665](#L665) | )); |
| [666](#L666) | wp\_die(); |
| [667](#L667) | } |
| [668](#L668) |  |
| [669](#L669) | $search = isset($\_REQUEST['search']) && $\_REQUEST['search'] != '' ? sanitize\_text\_field($\_REQUEST['search']) : null; |
| [670](#L670) | $checked = isset($\_REQUEST['val']) && $\_REQUEST['val'] != '' ? sanitize\_text\_field($\_REQUEST['val']) : null; |
| [671](#L671) | $args = array( |
| [672](#L672) | 'fields' => array('ID', 'display\_name', 'user\_email', 'user\_login', 'user\_nicename') |
| [673](#L673) | ); |
| [674](#L674) |  |
| [675](#L675) | if ($search !== null) { |
| [676](#L676) | $args['search'] = '\*' . esc\_attr($search) . '\*'; |
| [677](#L677) | $args['search\_columns'] = array('ID', 'user\_login', 'user\_nicename', 'user\_email', 'display\_name'); |
| [678](#L678) | } |
| [679](#L679) |  |
| [680](#L680) | $user\_query = new WP\_User\_Query($args); |
| [681](#L681) | $users = $user\_query->get\_results(); |
| [682](#L682) | $response = array( |
| [683](#L683) | 'results' => array() |
| [684](#L684) | ); |
| [685](#L685) |  |
| [686](#L686) | if(empty($args)){ |
| [687](#L687) | $reports\_users = ''; |
| [688](#L688) | } |
| [689](#L689) |  |
| [690](#L690) | foreach ($users as $key => $user) { |
| [691](#L691) | if ($checked !== null) { |
| [692](#L692) | if ($user->ID == $checked) { |
| [693](#L693) | continue; |
| [694](#L694) | }else{ |
| [695](#L695) | $response['results'][] = array( |
| [696](#L696) | 'id' => $user->ID, |
| [697](#L697) | 'text' => $user->display\_name |
| [698](#L698) | ); |
| [699](#L699) | } |
| [700](#L700) | }else{ |
| [701](#L701) | $response['results'][] = array( |
| [702](#L702) | 'id' => $user->ID, |
| [703](#L703) | 'text' => $user->display\_name, |
| [704](#L704) | ); |
| [705](#L705) | } |
| [706](#L706) | } |
| [707](#L707) |  |
| [708](#L708) | ob\_end\_clean(); |
| [709](#L709) | echo json\_encode($response); |
| [710](#L710) | wp\_die(); |
| [711](#L711) | } |
| [712](#L712) |  |
| [713](#L713) | public function get\_next\_or\_prev\_row\_by\_id( $id, $type = "next", $table = "ays\_pb" ) { |
| [714](#L714) | global $wpdb; |
| [715](#L715) |  |
| [716](#L716) | if ( is\_null( $table ) || empty( $table ) ) { |
| [717](#L717) | return null; |
| [718](#L718) | } |
| [719](#L719) |  |
| [720](#L720) | $ays\_table = esc\_sql( $wpdb->prefix . $table ); |
| [721](#L721) |  |
| [722](#L722) | $where = array(); |
| [723](#L723) | $where\_condition = ""; |
| [724](#L724) |  |
| [725](#L725) | $id     = (isset( $id ) && $id != "" && absint($id) != 0) ? absint( sanitize\_text\_field( $id ) ) : null; |
| [726](#L726) | $type   = (isset( $type ) && $type != "") ? sanitize\_text\_field( $type ) : "next"; |
| [727](#L727) |  |
| [728](#L728) | if ( is\_null( $id ) || $id == 0 ) { |
| [729](#L729) | return null; |
| [730](#L730) | } |
| [731](#L731) |  |
| [732](#L732) | switch ( $type ) { |
| [733](#L733) | case 'prev': |
| [734](#L734) | $where[] = ' `id` < ' . $id . ' ORDER BY `id` DESC '; |
| [735](#L735) | break; |
| [736](#L736) | case 'next': |
| [737](#L737) | default: |
| [738](#L738) | $where[] = ' `id` > ' . $id; |
| [739](#L739) | break; |
| [740](#L740) | } |
| [741](#L741) |  |
| [742](#L742) | if( ! empty($where) ){ |
| [743](#L743) | $where\_condition = " WHERE " . implode( " AND ", $where ); |
| [744](#L744) | } |
| [745](#L745) |  |
| [746](#L746) | $sql = "SELECT `id` FROM {$ays\_table} ". $where\_condition ." LIMIT 1"; |
| [747](#L747) | $results = $wpdb->get\_row( $sql, 'ARRAY\_A' ); |
| [748](#L748) |  |
| [749](#L749) | return $results; |
| [750](#L750) |  |
| [751](#L751) | } |
| [752](#L752) |  |
| [753](#L753) | public function popup\_box\_admin\_footer($a){ |
| [754](#L754) | if(isset($\_REQUEST['page'])){ |
| [755](#L755) | if(false !== strpos($\_REQUEST['page'], $this->plugin\_name)){ |
| [756](#L756) | ?> |
| [757](#L757) | <div class="ays-pb-footer-support-box"> |
| [758](#L758) | <span class="ays-pb-footer-link-row"><a href="https://wordpress.org/support/plugin/ays-popup-box/" target="\_blank"><?php echo \_\_( "Support", "ays-popup-box"); ?></a></span> |
| [759](#L759) | <span class="ays-pb-footer-slash-row">/</span> |
| [760](#L760) | <span class="ays-pb-footer-link-row"><a href="https://ays-pro.com/wordpress-popup-box-plugin-user-manual" target="\_blank"><?php echo \_\_( "Docs", "ays-popup-box"); ?></a></span> |
| [761](#L761) | <span class="ays-pb-footer-slash-row">/</span> |
| [762](#L762) | <span class="ays-pb-footer-link-row"><a href="https://ays-demo.com/popup-box-plugin-survey/" target="\_blank"><?php echo \_\_( "Suggest a Feature", "ays-popup-box"); ?></a></span> |
| [763](#L763) | </div> |
| [764](#L764) | <p style="font-size:13px;text-align:center;font-style:italic;"> |
| [765](#L765) | <span style="margin-left:0px;margin-right:10px;" class="ays\_heart\_beat"><img src="<?php echo AYS\_PB\_ADMIN\_URL . "/images/icons/hearth.svg"?>"></span> |
| [766](#L766) | <span><?php echo \_\_( "If you love our plugin, please do big favor and rate us on WordPress.org", "ays-popup-box"); ?></span> |
| [767](#L767) | <a target="\_blank" class="ays-rated-link" href='http://bit.ly/3kYanHL'> |
| [768](#L768) | <span class="ays-dashicons ays-dashicons-star-empty"></span> |
| [769](#L769) | <span class="ays-dashicons ays-dashicons-star-empty"></span> |
| [770](#L770) | <span class="ays-dashicons ays-dashicons-star-empty"></span> |
| [771](#L771) | <span class="ays-dashicons ays-dashicons-star-empty"></span> |
| [772](#L772) | <span class="ays-dashicons ays-dashicons-star-empty"></span> |
| [773](#L773) | </a> |
| [774](#L774) | <span class="ays\_heart\_beat"><img src="<?php echo AYS\_PB\_ADMIN\_URL . "/images/icons/hearth.svg"?>"></span> |
| [775](#L775) | </p> |
| [776](#L776) | <?php |
| [777](#L777) | } |
| [778](#L778) | } |
| [779](#L779) | } |
| [780](#L780) |  |
| [781](#L781) | public function ays\_pb\_dismiss\_button(){ |
| [782](#L782) | // Run a security check. |
| [783](#L783) | check\_ajax\_referer( AYS\_PB\_NAME . '-sale-banner', sanitize\_key( $\_REQUEST['\_ajax\_nonce'] ) ); |
| [784](#L784) |  |
| [785](#L785) | // Check for permissions. |
| [786](#L786) | if ( ! current\_user\_can( 'manage\_options' ) ) { |
| [787](#L787) | ob\_end\_clean(); |
| [788](#L788) | $ob\_get\_clean = ob\_get\_clean(); |
| [789](#L789) | echo json\_encode(array( |
| [790](#L790) | 'status' => false, |
| [791](#L791) | )); |
| [792](#L792) | wp\_die(); |
| [793](#L793) | } |
| [794](#L794) |  |
| [795](#L795) | $data = array( |
| [796](#L796) | 'status' => false, |
| [797](#L797) | ); |
| [798](#L798) |  |
| [799](#L799) | if (isset($\_REQUEST['action']) && $\_REQUEST['action'] == 'ays\_pb\_dismiss\_button') { |
| [800](#L800) | if( (isset( $\_REQUEST['\_ajax\_nonce'] ) && wp\_verify\_nonce( $\_REQUEST['\_ajax\_nonce'], AYS\_PB\_NAME . '-sale-banner' )) && current\_user\_can( 'manage\_options' )){ |
| [801](#L801) | update\_option('ays\_pb\_sale\_btn', 1); |
| [802](#L802) | update\_option('ays\_pb\_sale\_date', current\_time( 'mysql' )); |
| [803](#L803) | $data['status'] = true; |
| [804](#L804) | } |
| [805](#L805) | } |
| [806](#L806) |  |
| [807](#L807) | ob\_end\_clean(); |
| [808](#L808) | $ob\_get\_clean = ob\_get\_clean(); |
| [809](#L809) | echo json\_encode($data); |
| [810](#L810) | wp\_die(); |
| [811](#L811) |  |
| [812](#L812) | } |
| [813](#L813) |  |
| [814](#L814) | public static function ays\_pb\_check\_if\_current\_image\_exists($image\_url) { |
| [815](#L815) | global $wpdb; |
| [816](#L816) |  |
| [817](#L817) | $res = true; |
| [818](#L818) | if( !isset($image\_url) ){ |
| [819](#L819) | $res = false; |
| [820](#L820) | } |
| [821](#L821) |  |
| [822](#L822) | if ( isset($image\_url) && !empty( $image\_url ) ) { |
| [823](#L823) |  |
| [824](#L824) | $re = '/-\d+[Xx]\d+\./'; |
| [825](#L825) | $subst = '.'; |
| [826](#L826) |  |
| [827](#L827) | $image\_url = preg\_replace($re, $subst, $image\_url, 1); |
| [828](#L828) |  |
| [829](#L829) | $attachment = $wpdb->get\_col($wpdb->prepare("SELECT ID FROM $wpdb->posts WHERE guid='%s';", $image\_url )); |
| [830](#L830) | if ( is\_null( $attachment ) || empty( $attachment ) ) { |
| [831](#L831) | $res = false; |
| [832](#L832) | } |
| [833](#L833) | } |
| [834](#L834) |  |
| [835](#L835) | return $res; |
| [836](#L836) | } |
| [837](#L837) |  |
| [838](#L838) | /\*\* |
| [839](#L839) | \* Display the Our Products content. |
| [840](#L840) | \* |
| [841](#L841) | \* @since 4.7.0 |
| [842](#L842) | \*/ |
| [843](#L843) | public function ays\_pb\_output\_our\_products\_content() { |
| [844](#L844) | if (!function\_exists('get\_plugins')) { |
| [845](#L845) | require\_once ABSPATH . 'wp-admin/includes/plugin.php'; |
| [846](#L846) | } |
| [847](#L847) |  |
| [848](#L848) | $all\_plugins = get\_plugins(); |
| [849](#L849) | $am\_plugins = $this->ays\_pb\_get\_our\_plugins(); |
| [850](#L850) | $can\_install\_plugins = self::ays\_pb\_can\_install('plugin'); |
| [851](#L851) | $can\_activate\_plugins = self::ays\_pb\_can\_activate('plugin'); |
| [852](#L852) |  |
| [853](#L853) | $content = ''; |
| [854](#L854) | $content.= '<div class="ays-pb-cards-block">'; |
| [855](#L855) |  |
| [856](#L856) | foreach ($am\_plugins as $plugin => $details) { |
| [857](#L857) | $plugin\_data = $this->ays\_pb\_get\_plugin\_data($plugin, $details, $all\_plugins); |
| [858](#L858) | $plugin\_ready\_to\_activate = $can\_activate\_plugins && isset($plugin\_data['status\_class']) && $plugin\_data['status\_class'] === 'status-installed'; |
| [859](#L859) | $plugin\_not\_activated = !isset($plugin\_data['status\_class']) || $plugin\_data['status\_class'] !== 'status-active'; |
| [860](#L860) | $plugin\_action\_class = ( isset($plugin\_data['action\_class']) && esc\_attr($plugin\_data['action\_class']) != "" ) ? esc\_attr($plugin\_data['action\_class']) : ""; |
| [861](#L861) | $plugin\_action\_class\_disbaled = strpos($plugin\_action\_class, 'status-active') !== false ? "disbaled='true'" : ""; |
| [862](#L862) |  |
| [863](#L863) | $content .= ' |
| [864](#L864) | <div class="ays-pb-card"> |
| [865](#L865) | <div class="ays-pb-card\_\_content flexible"> |
| [866](#L866) | <div class="ays-pb-card\_\_content-img-box"> |
| [867](#L867) | <img class="ays-pb-card\_\_img" src="' . esc\_url($plugin\_data['details']['icon']) . '" alt="' . esc\_attr($plugin\_data['details']['name'] ) . '"> |
| [868](#L868) | </div> |
| [869](#L869) | <div class="ays-pb-card\_\_text-block"> |
| [870](#L870) | <h5 class="ays-pb-card\_\_title">' . esc\_html($plugin\_data['details']['name']) . '</h5> |
| [871](#L871) | <p class="ays-pb-card\_\_text">' . wp\_kses\_post($plugin\_data['details']['desc']) . ' |
| [872](#L872) | <span class="ays-pb-card\_\_text-hidden"> |
| [873](#L873) | ' . wp\_kses\_post($plugin\_data['details']['desc\_hidden']) . ' |
| [874](#L874) | </span> |
| [875](#L875) | </p> |
| [876](#L876) | </div> |
| [877](#L877) | </div> |
| [878](#L878) | <div class="ays-pb-card\_\_footer">'; |
| [879](#L879) | if ($can\_install\_plugins || $plugin\_ready\_to\_activate || !$details['wporg']) { |
| [880](#L880) | $content .= '<button class="' . esc\_attr($plugin\_data['action\_class']) . '" data-plugin="' . esc\_attr($plugin\_data['plugin\_src']) . '" data-type="plugin" ' . $plugin\_action\_class\_disbaled . '> |
| [881](#L881) | ' . wp\_kses\_post($plugin\_data['action\_text']) . ' |
| [882](#L882) | <span class="ays\_pb\_loader display\_none"><img src=' . AYS\_PB\_ADMIN\_URL . '/images/loaders/loading.gif></span> |
| [883](#L883) | </button>'; |
| [884](#L884) | } elseif ($plugin\_not\_activated) { |
| [885](#L885) | $content .= '<a href="' . esc\_url($details['wporg']) . '" target="\_blank" rel="noopener noreferrer"> |
| [886](#L886) | ' . esc\_html\_e('WordPress.org', "ays-popup-box") . ' |
| [887](#L887) | <span aria-hidden="true" class="dashicons dashicons-external"></span> |
| [888](#L888) | </a>'; |
| [889](#L889) | } |
| [890](#L890) | $content .=' |
| [891](#L891) | <a target="\_blank" href="' . esc\_url($plugin\_data['details']['buy\_now']) . '" class="ays-pb-card\_\_btn-primary">' . \_\_('Buy Now', "ays-popup-box") . '</a> |
| [892](#L892) | </div> |
| [893](#L893) | </div>'; |
| [894](#L894) | } |
| [895](#L895) |  |
| [896](#L896) | $install\_plugin\_nonce = wp\_create\_nonce($this->plugin\_name . '-install-plugin-nonce'); |
| [897](#L897) | $content.= '<input type="hidden" id="ays\_pb\_ajax\_install\_plugin\_nonce" name="ays\_pb\_ajax\_install\_plugin\_nonce" value="' . $install\_plugin\_nonce . '">'; |
| [898](#L898) | $content.= '</div>'; |
| [899](#L899) |  |
| [900](#L900) | echo $content; |
| [901](#L901) | } |
| [902](#L902) |  |
| [903](#L903) | /\*\* |
| [904](#L904) | \* List of AM plugins that we propose to install. |
| [905](#L905) | \* |
| [906](#L906) | \* @since 4.7.0 |
| [907](#L907) | \* |
| [908](#L908) | \* @return array |
| [909](#L909) | \*/ |
| [910](#L910) | protected function ays\_pb\_get\_our\_plugins() { |
| [911](#L911) | if (!isset($\_SESSION)) { |
| [912](#L912) | session\_start(); |
| [913](#L913) | } |
| [914](#L914) |  |
| [915](#L915) | $images\_url = AYS\_PB\_ADMIN\_URL . '/images/icons/'; |
| [916](#L916) | $plugin\_url\_arr = array(); |
| [917](#L917) |  |
| [918](#L918) | $plugin\_slug = array( |
| [919](#L919) | 'quiz-maker', |
| [920](#L920) | 'poll-maker', |
| [921](#L921) | 'survey-maker', |
| [922](#L922) | 'gallery-photo-gallery', |
| [923](#L923) | 'secure-copy-content-protection', |
| [924](#L924) | 'personal-dictionary', |
| [925](#L925) | 'chart-builder', |
| [926](#L926) | ); |
| [927](#L927) |  |
| [928](#L928) | foreach ($plugin\_slug as $key => $slug) { |
| [929](#L929) | if ( isset($\_SESSION['ays\_pd\_our\_product\_links']) && !empty($\_SESSION['ays\_pd\_our\_product\_links']) && isset($\_SESSION['ays\_pd\_our\_product\_links'][$slug]) && !empty($\_SESSION['ays\_pd\_our\_product\_links'][$slug]) ) { |
| [930](#L930) | $plugin\_url = ( isset($\_SESSION['ays\_pd\_our\_product\_links'][$slug]) && $\_SESSION['ays\_pd\_our\_product\_links'][$slug] != "" ) ? esc\_url($\_SESSION['ays\_pd\_our\_product\_links'][$slug]) : ""; |
| [931](#L931) | } else { |
| [932](#L932) | $latest\_version = $this->ays\_pb\_get\_latest\_plugin\_version($slug); |
| [933](#L933) | $plugin\_url = 'https://downloads.wordpress.org/plugin/' . $slug . '.zip'; |
| [934](#L934) | if ($latest\_version != '') { |
| [935](#L935) | $plugin\_url = 'https://downloads.wordpress.org/plugin/' . $slug . '.' . $latest\_version . '.zip'; |
| [936](#L936) | $\_SESSION['ays\_pd\_our\_product\_links'][$slug] = $plugin\_url; |
| [937](#L937) | } |
| [938](#L938) | } |
| [939](#L939) |  |
| [940](#L940) | $plugin\_url\_arr[$slug] = $plugin\_url; |
| [941](#L941) | } |
| [942](#L942) |  |
| [943](#L943) | $plugins\_array = array( |
| [944](#L944) | 'quiz-maker/quiz-maker.php' => array( |
| [945](#L945) | 'icon' => $images\_url . 'icon-quiz-128x128.png', |
| [946](#L946) | 'name' => \_\_('Quiz Maker', "ays-popup-box"), |
| [947](#L947) | 'desc' => \_\_('With our Quiz Maker plugin it’s easy to make a quiz in a short time.', "ays-popup-box"), |
| [948](#L948) | 'desc\_hidden' => \_\_('You to add images to your quiz, order unlimited questions. Also you can style your quiz to satisfy your visitors.', "ays-popup-box"), |
| [949](#L949) | 'wporg' => 'https://wordpress.org/plugins/quiz-maker/', |
| [950](#L950) | 'buy\_now' => 'https://ays-pro.com/wordpress/quiz-maker/', |
| [951](#L951) | 'url' => $plugin\_url\_arr['quiz-maker'], |
| [952](#L952) | ), |
| [953](#L953) | 'poll-maker/poll-maker-ays.php' => array( |
| [954](#L954) | 'icon' => $images\_url . 'icon-poll-128x128.png', |
| [955](#L955) | 'name' => \_\_('Poll Maker', "ays-popup-box"), |
| [956](#L956) | 'desc' => \_\_('Create amazing online polls for your WordPress website super easily.', "ays-popup-box"), |
| [957](#L957) | 'desc\_hidden' => \_\_('Build up various types of polls in a minute and get instant feedback on any topic or product.', "ays-popup-box"), |
| [958](#L958) | 'wporg' => 'https://wordpress.org/plugins/poll-maker/', |
| [959](#L959) | 'buy\_now' => 'https://ays-pro.com/wordpress/poll-maker/', |
| [960](#L960) | 'url' => $plugin\_url\_arr['poll-maker'], |
| [961](#L961) | ), |
| [962](#L962) | 'survey-maker/survey-maker.php' => array( |
| [963](#L963) | 'icon' => $images\_url . 'icon-survey-128x128.png', |
| [964](#L964) | 'name' => \_\_('Survey Maker', "ays-popup-box"), |
| [965](#L965) | 'desc' => \_\_('Make amazing online surveys and get real-time feedback quickly and easily.', "ays-popup-box"), |
| [966](#L966) | 'desc\_hidden' => \_\_('Learn what your website visitors want, need, and expect with the help of Survey Maker. Build surveys without limiting your needs.', "ays-popup-box"), |
| [967](#L967) | 'wporg' => 'https://wordpress.org/plugins/survey-maker/', |
| [968](#L968) | 'buy\_now' => 'https://ays-pro.com/wordpress/survey-maker', |
| [969](#L969) | 'url' => $plugin\_url\_arr['survey-maker'], |
| [970](#L970) | ), |
| [971](#L971) | 'gallery-photo-gallery/gallery-photo-gallery.php' => array( |
| [972](#L972) | 'icon' => $images\_url . 'icon-gallery-128x128.png', |
| [973](#L973) | 'name' => \_\_('Gallery Photo Gallery', "ays-popup-box"), |
| [974](#L974) | 'desc' => \_\_('Create unlimited galleries and include unlimited images in those galleries.', "ays-popup-box"), |
| [975](#L975) | 'desc\_hidden' => \_\_('Represent images in an attractive way. Attract people with your own single and multiple free galleries from your photo library.', "ays-popup-box"), |
| [976](#L976) | 'wporg' => 'https://wordpress.org/plugins/gallery-photo-gallery/', |
| [977](#L977) | 'buy\_now' => 'https://ays-pro.com/wordpress/photo-gallery/', |
| [978](#L978) | 'url' => $plugin\_url\_arr['gallery-photo-gallery'], |
| [979](#L979) | ), |
| [980](#L980) | 'secure-copy-content-protection/secure-copy-content-protection.php' => array( |
| [981](#L981) | 'icon' => $images\_url . 'icon-sccp-128x128.png', |
| [982](#L982) | 'name' => \_\_('Secure Copy Content Protection', "ays-popup-box"), |
| [983](#L983) | 'desc' => \_\_('Disable the right click, copy paste, content selection and copy shortcut keys on your website.', "ays-popup-box"), |
| [984](#L984) | 'desc\_hidden' => \_\_('Protect web content from being plagiarized. Prevent plagiarism from your website with this easy to use plugin.', "ays-popup-box"), |
| [985](#L985) | 'wporg' => 'https://wordpress.org/plugins/secure-copy-content-protection/', |
| [986](#L986) | 'buy\_now' => 'https://ays-pro.com/wordpress/secure-copy-content-protection/', |
| [987](#L987) | 'url' => $plugin\_url\_arr['secure-copy-content-protection'], |
| [988](#L988) | ), |
| [989](#L989) | 'personal-dictionary/personal-dictionary.php' => array( |
| [990](#L990) | 'icon' => $images\_url . 'icon-pd-128x128.png', |
| [991](#L991) | 'name' => \_\_('Personal Dictionary', 'quiz-maker' ), |
| [992](#L992) | 'desc' => \_\_('Allow your students to create personal dictionary, study and memorize the words.', 'quiz-maker' ), |
| [993](#L993) | 'desc\_hidden' => \_\_('Allow your users to create their own digital dictionaries and learn new words and terms as fastest as possible.', 'quiz-maker' ), |
| [994](#L994) | 'wporg' => 'https://wordpress.org/plugins/personal-dictionary/', |
| [995](#L995) | 'buy\_now' => 'https://ays-pro.com/wordpress/personal-dictionary/', |
| [996](#L996) | 'url' => $plugin\_url\_arr['personal-dictionary'], |
| [997](#L997) | ), |
| [998](#L998) | 'chart-builder/chart-builder.php' => array( |
| [999](#L999) | 'icon' => $images\_url . 'icon-chart-128x128.png', |
| [1000](#L1000) | 'name' => \_\_('Chart Builder', "ays-popup-box"), |
| [1001](#L1001) | 'desc' => \_\_('Chart Builder plugin allows you to create beautiful charts', "ays-popup-box"), |
| [1002](#L1002) | 'desc\_hidden' => \_\_(' and graphs easily and quickly.', "ays-popup-box"), |
| [1003](#L1003) | 'wporg' => 'https://wordpress.org/plugins/chart-builder/', |
| [1004](#L1004) | 'buy\_now' => 'https://ays-pro.com/wordpress/chart-builder/', |
| [1005](#L1005) | 'url' => $plugin\_url\_arr['chart-builder'], |
| [1006](#L1006) | ), |
| [1007](#L1007) | ); |
| [1008](#L1008) |  |
| [1009](#L1009) | return $plugins\_array; |
| [1010](#L1010) | } |
| [1011](#L1011) |  |
| [1012](#L1012) | protected function ays\_pb\_get\_latest\_plugin\_version($slug) { |
| [1013](#L1013) | if ( is\_null($slug) || empty($slug) ) { |
| [1014](#L1014) | return ""; |
| [1015](#L1015) | } |
| [1016](#L1016) |  |
| [1017](#L1017) | $version\_latest = ""; |
| [1018](#L1018) |  |
| [1019](#L1019) | if (!function\_exists('plugins\_api')) { |
| [1020](#L1020) | require\_once(ABSPATH . 'wp-admin/includes/plugin-install.php'); |
| [1021](#L1021) | } |
| [1022](#L1022) |  |
| [1023](#L1023) | // set the arguments to get latest info from repository via API ## |
| [1024](#L1024) | $args = array( |
| [1025](#L1025) | 'slug' => $slug, |
| [1026](#L1026) | 'fields' => array( |
| [1027](#L1027) | 'version' => true, |
| [1028](#L1028) | ) |
| [1029](#L1029) | ); |
| [1030](#L1030) |  |
| [1031](#L1031) | /\*\* Prepare our query \*/ |
| [1032](#L1032) | $call\_api = plugins\_api('plugin\_information', $args); |
| [1033](#L1033) |  |
| [1034](#L1034) | /\*\* Check for Errors & Display the results \*/ |
| [1035](#L1035) | if (is\_wp\_error($call\_api)) { |
| [1036](#L1036) | $api\_error = $call\_api->get\_error\_message(); |
| [1037](#L1037) | } else { |
| [1038](#L1038) | //echo $call\_api; // everything ## |
| [1039](#L1039) | if (!empty($call\_api->version)) { |
| [1040](#L1040) | $version\_latest = $call\_api->version; |
| [1041](#L1041) | } |
| [1042](#L1042) | } |
| [1043](#L1043) |  |
| [1044](#L1044) | return $version\_latest; |
| [1045](#L1045) | } |
| [1046](#L1046) |  |
| [1047](#L1047) | /\*\* |
| [1048](#L1048) | \* Determine if the plugin/addon installations are allowed. |
| [1049](#L1049) | \* |
| [1050](#L1050) | \* @since 4.7.0 |
| [1051](#L1051) | \* |
| [1052](#L1052) | \* @param string $type Should be `plugin` or `addon`. |
| [1053](#L1053) | \* |
| [1054](#L1054) | \* @return bool |
| [1055](#L1055) | \*/ |
| [1056](#L1056) | public static function ays\_pb\_can\_install($type) { |
| [1057](#L1057) | return self::ays\_pb\_can\_do('install', $type); |
| [1058](#L1058) | } |
| [1059](#L1059) |  |
| [1060](#L1060) | /\*\* |
| [1061](#L1061) | \* Determine if the plugin/addon activations are allowed. |
| [1062](#L1062) | \* |
| [1063](#L1063) | \* @since 4.7.0 |
| [1064](#L1064) | \* |
| [1065](#L1065) | \* @param string $type Should be `plugin` or `addon`. |
| [1066](#L1066) | \* |
| [1067](#L1067) | \* @return bool |
| [1068](#L1068) | \*/ |
| [1069](#L1069) | public static function ays\_pb\_can\_activate($type) { |
| [1070](#L1070) | return self::ays\_pb\_can\_do('activate', $type); |
| [1071](#L1071) | } |
| [1072](#L1072) |  |
| [1073](#L1073) | /\*\* |
| [1074](#L1074) | \* Determine if the plugin/addon installations/activations are allowed. |
| [1075](#L1075) | \* |
| [1076](#L1076) | \* @since 4.7.0 |
| [1077](#L1077) | \* |
| [1078](#L1078) | \* @param string $what Should be 'activate' or 'install'. |
| [1079](#L1079) | \* @param string $type Should be `plugin` or `addon`. |
| [1080](#L1080) | \* |
| [1081](#L1081) | \* @return bool |
| [1082](#L1082) | \*/ |
| [1083](#L1083) | public static function ays\_pb\_can\_do($what, $type) { |
| [1084](#L1084) | if ( !in\_array($what, array('install', 'activate'), true) ) { |
| [1085](#L1085) | return false; |
| [1086](#L1086) | } |
| [1087](#L1087) |  |
| [1088](#L1088) | if ($type != 'plugin') { |
| [1089](#L1089) | return false; |
| [1090](#L1090) | } |
| [1091](#L1091) |  |
| [1092](#L1092) | $capability = $what . '\_plugins'; |
| [1093](#L1093) |  |
| [1094](#L1094) | if (!current\_user\_can($capability)) { |
| [1095](#L1095) | return false; |
| [1096](#L1096) | } |
| [1097](#L1097) |  |
| [1098](#L1098) | // Determine whether file modifications are allowed and it is activation permissions checking. |
| [1099](#L1099) | if ( $what === 'install' && ! wp\_is\_file\_mod\_allowed('ays\_pb\_can\_install') ) { |
| [1100](#L1100) | return false; |
| [1101](#L1101) | } |
| [1102](#L1102) |  |
| [1103](#L1103) | // All plugin checks are done. |
| [1104](#L1104) | if ($type === 'plugin') { |
| [1105](#L1105) | return true; |
| [1106](#L1106) | } |
| [1107](#L1107) |  |
| [1108](#L1108) | return false; |
| [1109](#L1109) | } |
| [1110](#L1110) |  |
| [1111](#L1111) | /\*\* |
| [1112](#L1112) | \* Get AM plugin data to display in the Our Products section. |
| [1113](#L1113) | \* |
| [1114](#L1114) | \* @since 4.7.0 |
| [1115](#L1115) | \* |
| [1116](#L1116) | \* @param string $plugin      Plugin slug. |
| [1117](#L1117) | \* @param array  $details     Plugin details. |
| [1118](#L1118) | \* @param array  $all\_plugins List of all plugins. |
| [1119](#L1119) | \* |
| [1120](#L1120) | \* @return array |
| [1121](#L1121) | \*/ |
| [1122](#L1122) | protected function ays\_pb\_get\_plugin\_data($plugin, $details, $all\_plugins) { |
| [1123](#L1123) | $have\_pro = (!empty($details['pro']) && !empty($details['pro']['plug'])); |
| [1124](#L1124) | $show\_pro = false; |
| [1125](#L1125) | $plugin\_data = array(); |
| [1126](#L1126) |  |
| [1127](#L1127) | if ($have\_pro) { |
| [1128](#L1128) | if (array\_key\_exists($plugin, $all\_plugins)) { |
| [1129](#L1129) | if (is\_plugin\_active($plugin)) { |
| [1130](#L1130) | $show\_pro = true; |
| [1131](#L1131) | } |
| [1132](#L1132) | } |
| [1133](#L1133) |  |
| [1134](#L1134) | if (array\_key\_exists($details['pro']['plug'], $all\_plugins)) { |
| [1135](#L1135) | $show\_pro = true; |
| [1136](#L1136) | } |
| [1137](#L1137) |  |
| [1138](#L1138) | if ($show\_pro) { |
| [1139](#L1139) | $plugin = $details['pro']['plug']; |
| [1140](#L1140) | $details = $details['pro']; |
| [1141](#L1141) | } |
| [1142](#L1142) | } |
| [1143](#L1143) |  |
| [1144](#L1144) | if (array\_key\_exists($plugin, $all\_plugins)) { |
| [1145](#L1145) | if ( is\_plugin\_active( $plugin ) ) { |
| [1146](#L1146) | // Status text/status. |
| [1147](#L1147) | $plugin\_data['status\_class'] = 'status-active'; |
| [1148](#L1148) | $plugin\_data['status\_text'] = esc\_html\_\_('Active', "ays-popup-box"); |
| [1149](#L1149) | // Button text/status. |
| [1150](#L1150) | $plugin\_data['action\_class'] = $plugin\_data['status\_class'] . ' ays-pb-card\_\_btn-info disabled'; |
| [1151](#L1151) | $plugin\_data['action\_text'] = esc\_html\_\_('Activated', "ays-popup-box"); |
| [1152](#L1152) | $plugin\_data['plugin\_src'] = esc\_attr($plugin); |
| [1153](#L1153) | } else { |
| [1154](#L1154) | // Status text/status. |
| [1155](#L1155) | $plugin\_data['status\_class'] = 'status-installed'; |
| [1156](#L1156) | $plugin\_data['status\_text'] = esc\_html\_\_('Inactive', "ays-popup-box"); |
| [1157](#L1157) | // Button text/status. |
| [1158](#L1158) | $plugin\_data['action\_class'] = $plugin\_data['status\_class'] . ' ays-pb-card\_\_btn-info'; |
| [1159](#L1159) | $plugin\_data['action\_text'] = esc\_html\_\_('Activate', "ays-popup-box"); |
| [1160](#L1160) | $plugin\_data['plugin\_src'] = esc\_attr($plugin); |
| [1161](#L1161) | } |
| [1162](#L1162) | } else { |
| [1163](#L1163) | // Doesn't exist, install. |
| [1164](#L1164) | // Status text/status. |
| [1165](#L1165) | $plugin\_data['status\_class'] = 'status-missing'; |
| [1166](#L1166) |  |
| [1167](#L1167) | if ( isset($details['act']) && 'go-to-url' === $details['act'] ) { |
| [1168](#L1168) | $plugin\_data['status\_class'] = 'status-go-to-url'; |
| [1169](#L1169) | } |
| [1170](#L1170) |  |
| [1171](#L1171) | $plugin\_data['status\_text'] = esc\_html\_\_('Not Installed', "ays-popup-box"); |
| [1172](#L1172) | // Button text/status. |
| [1173](#L1173) | $plugin\_data['action\_class'] = $plugin\_data['status\_class'] . ' ays-pb-card\_\_btn-info'; |
| [1174](#L1174) | $plugin\_data['action\_text'] = esc\_html\_\_('Install Plugin', "ays-popup-box"); |
| [1175](#L1175) | $plugin\_data['plugin\_src'] = esc\_url($details['url']); |
| [1176](#L1176) | } |
| [1177](#L1177) |  |
| [1178](#L1178) | $plugin\_data['details'] = $details; |
| [1179](#L1179) |  |
| [1180](#L1180) | return $plugin\_data; |
| [1181](#L1181) | } |
| [1182](#L1182) |  |
| [1183](#L1183) | /\*\* |
| [1184](#L1184) | \* Activate plugin. |
| [1185](#L1185) | \* |
| [1186](#L1186) | \* @since 4.7.0 |
| [1187](#L1187) | \*/ |
| [1188](#L1188) | public function ays\_pb\_activate\_plugin() { |
| [1189](#L1189) | // Run a security check. |
| [1190](#L1190) | check\_ajax\_referer( $this->plugin\_name . '-install-plugin-nonce', sanitize\_key($\_REQUEST['\_ajax\_nonce']) ); |
| [1191](#L1191) |  |
| [1192](#L1192) | // Check for permissions. |
| [1193](#L1193) | if (!current\_user\_can('activate\_plugins')) { |
| [1194](#L1194) | wp\_send\_json\_error( esc\_html\_\_('Plugin activation is disabled for you on this site.', "ays-popup-box") ); |
| [1195](#L1195) | } |
| [1196](#L1196) |  |
| [1197](#L1197) | if (isset($\_POST['plugin'])) { |
| [1198](#L1198) | $plugin = sanitize\_text\_field( wp\_unslash($\_POST['plugin']) ); |
| [1199](#L1199) | $activate = activate\_plugins($plugin); |
| [1200](#L1200) |  |
| [1201](#L1201) | if (!is\_wp\_error($activate)) { |
| [1202](#L1202) | wp\_send\_json\_success( esc\_html\_\_('Plugin activated.', "ays-popup-box") ); |
| [1203](#L1203) | } |
| [1204](#L1204) | } |
| [1205](#L1205) |  |
| [1206](#L1206) | wp\_send\_json\_error( esc\_html\_\_('Could not activate the plugin. Please activate it on the Plugins page.', "ays-popup-box") ); |
| [1207](#L1207) | } |
| [1208](#L1208) |  |
| [1209](#L1209) | /\*\* |
| [1210](#L1210) | \* Install plugin. |
| [1211](#L1211) | \* |
| [1212](#L1212) | \* @since 4.7.0 |
| [1213](#L1213) | \*/ |
| [1214](#L1214) | public function ays\_pb\_install\_plugin() { |
| [1215](#L1215) | // Run a security check. |
| [1216](#L1216) | check\_ajax\_referer( $this->plugin\_name . '-install-plugin-nonce', sanitize\_key($\_REQUEST['\_ajax\_nonce']) ); |
| [1217](#L1217) |  |
| [1218](#L1218) | $generic\_error = esc\_html\_\_('There was an error while performing your request.', "ays-popup-box"); |
| [1219](#L1219) | $type = !empty($\_POST['type']) ? sanitize\_key($\_POST['type']) : 'plugin'; |
| [1220](#L1220) |  |
| [1221](#L1221) | // Check if new installations are allowed. |
| [1222](#L1222) | if (!self::ays\_pb\_can\_install($type)) { |
| [1223](#L1223) | wp\_send\_json\_error($generic\_error); |
| [1224](#L1224) | } |
| [1225](#L1225) |  |
| [1226](#L1226) | $error = $type === 'plugin' ? esc\_html\_\_('Could not install the plugin. Please download and install it manually.', "ays-popup-box") : ""; |
| [1227](#L1227) |  |
| [1228](#L1228) | $plugin\_url = !empty($\_POST['plugin']) ? esc\_url\_raw( wp\_unslash($\_POST['plugin']) ) : ''; |
| [1229](#L1229) |  |
| [1230](#L1230) | if (empty($plugin\_url)) { |
| [1231](#L1231) | wp\_send\_json\_error($error); |
| [1232](#L1232) | } |
| [1233](#L1233) |  |
| [1234](#L1234) | // Prepare variables. |
| [1235](#L1235) | $url = esc\_url\_raw( |
| [1236](#L1236) | add\_query\_arg( |
| [1237](#L1237) | [ |
| [1238](#L1238) | 'page' => 'ays-pb-featured-plugins', |
| [1239](#L1239) | ], |
| [1240](#L1240) | admin\_url('admin.php') |
| [1241](#L1241) | ) |
| [1242](#L1242) | ); |
| [1243](#L1243) |  |
| [1244](#L1244) | ob\_start(); |
| [1245](#L1245) | $creds = request\_filesystem\_credentials($url, '', false, false, null); |
| [1246](#L1246) |  |
| [1247](#L1247) | // Hide the filesystem credentials form. |
| [1248](#L1248) | ob\_end\_clean(); |
| [1249](#L1249) |  |
| [1250](#L1250) | // Check for file system permissions. |
| [1251](#L1251) | if ($creds === false) { |
| [1252](#L1252) | wp\_send\_json\_error($error); |
| [1253](#L1253) | } |
| [1254](#L1254) |  |
| [1255](#L1255) | if (!WP\_Filesystem($creds)) { |
| [1256](#L1256) | wp\_send\_json\_error($error); |
| [1257](#L1257) | } |
| [1258](#L1258) |  |
| [1259](#L1259) | /\* |
| [1260](#L1260) | \* We do not need any extra credentials if we have gotten this far, so let's install the plugin. |
| [1261](#L1261) | \*/ |
| [1262](#L1262) | require\_once AYS\_PB\_DIR . 'includes/admin/class-ays-pb-upgrader.php'; |
| [1263](#L1263) | require\_once AYS\_PB\_DIR . 'includes/admin/class-ays-pb-install-skin.php'; |
| [1264](#L1264) | require\_once AYS\_PB\_DIR . 'includes/admin/class-ays-pb-skin.php'; |
| [1265](#L1265) |  |
| [1266](#L1266) | // Do not allow WordPress to search/download translations, as this will break JS output. |
| [1267](#L1267) | remove\_action( 'upgrader\_process\_complete', array('Language\_Pack\_Upgrader', 'async\_upgrade'), 20 ); |
| [1268](#L1268) |  |
| [1269](#L1269) | // Create the plugin upgrader with our custom skin. |
| [1270](#L1270) | $installer = new AysPb\Helpers\AysPbPluginSilentUpgrader( new Ays\_Pb\_Install\_Skin() ); |
| [1271](#L1271) |  |
| [1272](#L1272) | // Error check. |
| [1273](#L1273) | if (!method\_exists($installer, 'install')) { |
| [1274](#L1274) | wp\_send\_json\_error($error); |
| [1275](#L1275) | } |
| [1276](#L1276) |  |
| [1277](#L1277) | $installer->install($plugin\_url); |
| [1278](#L1278) |  |
| [1279](#L1279) | // Flush the cache and return the newly installed plugin basename. |
| [1280](#L1280) | wp\_cache\_flush(); |
| [1281](#L1281) |  |
| [1282](#L1282) | $plugin\_basename = $installer->plugin\_info(); |
| [1283](#L1283) |  |
| [1284](#L1284) | if (empty($plugin\_basename)) { |
| [1285](#L1285) | wp\_send\_json\_error($error); |
| [1286](#L1286) | } |
| [1287](#L1287) |  |
| [1288](#L1288) | $result = array( |
| [1289](#L1289) | 'msg' => $generic\_error, |
| [1290](#L1290) | 'is\_activated' => false, |
| [1291](#L1291) | 'basename' => $plugin\_basename, |
| [1292](#L1292) | ); |
| [1293](#L1293) |  |
| [1294](#L1294) | // Check for permissions. |
| [1295](#L1295) | if (!current\_user\_can('activate\_plugins')) { |
| [1296](#L1296) | $result['msg'] = $type === 'plugin' ? esc\_html\_\_('Plugin installed.', "ays-popup-box") : ""; |
| [1297](#L1297) |  |
| [1298](#L1298) | wp\_send\_json\_success($result); |
| [1299](#L1299) | } |
| [1300](#L1300) |  |
| [1301](#L1301) | // Activate the plugin silently. |
| [1302](#L1302) | $activated = activate\_plugin($plugin\_basename); |
| [1303](#L1303) | remove\_action( 'activated\_plugin', array('ays\_sccp\_activation\_redirect\_method', 'gallery\_p\_gallery\_activation\_redirect\_method', 'poll\_maker\_activation\_redirect\_method'), 100 ); |
| [1304](#L1304) |  |
| [1305](#L1305) | if (!is\_wp\_error($activated)) { |
| [1306](#L1306) | $result['is\_activated'] = true; |
| [1307](#L1307) | $result['msg'] = esc\_html\_\_('Plugin installed and activated.', "ays-popup-box"); |
| [1308](#L1308) |  |
| [1309](#L1309) | wp\_send\_json\_success($result); |
| [1310](#L1310) | } |
| [1311](#L1311) |  |
| [1312](#L1312) | // Fallback error just in case. |
| [1313](#L1313) | wp\_send\_json\_error($result); |
| [1314](#L1314) | } |
| [1315](#L1315) | } |

**Note:** See [TracBrowser](/wiki/TracBrowser)
for help on using the repository browser.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Plain Text](/browser/ays-popup-box/tags/4.9.2/admin/class-ays-pb-admin.php?format=txt)
* [Original Format](/export/3222499/ays-popup-box/tags/4.9.2/admin/class-ays-pb-admin.php)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)


