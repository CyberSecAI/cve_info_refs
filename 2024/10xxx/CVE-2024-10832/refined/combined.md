=== Content from plugins.trac.wordpress.org_4fc589df_20250114_181017.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fbrowser%2Fposti-shipping%2Ftags%2F3.10.3%2Fcore%2Fclass-shipping-method.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Revision](/browser/posti-shipping/trunk/core/class-shipping-method.php?rev=3132120 "Revision 3132120")
* [Next Revision](/browser/posti-shipping/trunk/core/class-shipping-method.php?rev=3206390 "Revision 3206390") →
* [Blame](/browser/posti-shipping/trunk/core/class-shipping-method.php?annotate=blame "Annotate each line with the last changed revision (this can be time consuming...)")
* [Revision Log](/log/posti-shipping/tags/3.10.3/core/class-shipping-method.php)

---

# [source:](/browser?order=name "Go to repository root") [posti-shipping](/browser/posti-shipping?order=name "View posti-shipping")/[tags](/browser/posti-shipping/tags?order=name "View tags")/[3.10.3](/browser/posti-shipping/tags/3.10.3?order=name "View 3.10.3")/[core](/browser/posti-shipping/tags/3.10.3/core?order=name "View core")/[class-shipping-method.php](/browser/posti-shipping/tags/3.10.3/core/class-shipping-method.php?order=name "View class-shipping-method.php")

View diff against:

View revision:

| [Last change](/changeset/3165107/posti-shipping/trunk/core/class-shipping-method.php "View differences") on this file was [3165107](/changeset/3165107/ "View changeset 3165107"), checked in by jooseposti, [3 months ago](/timeline?from=2024-10-08T15%3A48%3A16Z&precision=second "See timeline at 10/08/2024 03:48:16 PM") |
| --- |
| Update to version 3.10.2 from GitHub |
| **File size:** 31.7 KB | |

| Line |  |
| --- | --- |
| [1](#L1) | <?php |
| [2](#L2) | namespace Woo\_Pakettikauppa\_Core; |
| [3](#L3) |  |
| [4](#L4) | // Prevent direct access to the script |
| [5](#L5) | use WC\_Countries; |
| [6](#L6) |  |
| [7](#L7) | if ( ! defined('ABSPATH') ) { |
| [8](#L8) | exit; |
| [9](#L9) | } |
| [10](#L10) |  |
| [11](#L11) | if ( ! class\_exists(\_\_NAMESPACE\_\_ . '\Shipping\_Method') ) { |
| [12](#L12) | /\*\* |
| [13](#L13) | \* Shipping\_Method Class |
| [14](#L14) | \* |
| [15](#L15) | \* @class Shipping\_Method |
| [16](#L16) | \* @version  1.0.0 |
| [17](#L17) | \* @since 1.0.0 |
| [18](#L18) | \* @package  woo-pakettikauppa |
| [19](#L19) | \* @author Seravo |
| [20](#L20) | \*/ |
| [21](#L21) | class Shipping\_Method extends \WC\_Shipping\_Method { |
| [22](#L22) | /\*\* |
| [23](#L23) | \* Required to access Pakettikauppa client |
| [24](#L24) | \* @var Shipment $shipment |
| [25](#L25) | \*/ |
| [26](#L26) | private $shipment = null; |
| [27](#L27) |  |
| [28](#L28) | public $is\_loaded = false; |
| [29](#L29) |  |
| [30](#L30) | /\*\* |
| [31](#L31) | \* Constructor for Pakettikauppa shipping class |
| [32](#L32) | \* |
| [33](#L33) | \* @access public |
| [34](#L34) | \* @return void |
| [35](#L35) | \*/ |
| [36](#L36) | public function \_\_construct( $instance\_id = 0 ) { |
| [37](#L37) | parent::\_\_construct($instance\_id); |
| [38](#L38) |  |
| [39](#L39) | $this->load(); |
| [40](#L40) | } |
| [41](#L41) |  |
| [42](#L42) | public function get\_core() { |
| [43](#L43) | return \Woo\_Posti\_Shipping::get\_instance(); |
| [44](#L44) | } |
| [45](#L45) |  |
| [46](#L46) | public function load() { |
| [47](#L47) | if ( $this->is\_loaded ) { |
| [48](#L48) | return; |
| [49](#L49) | } |
| [50](#L50) |  |
| [51](#L51) | $this->id = $this->get\_core()->shippingmethod; // ID for your shipping method. Should be unique. |
| [52](#L52) | $this->method\_title = $this->get\_core()->text->shipping\_method\_name(); |
| [53](#L53) | $this->method\_description = $this->get\_core()->text->shipping\_method\_desc(); // Description shown in admin |
| [54](#L54) |  |
| [55](#L55) | $this->supports = array( |
| [56](#L56) | 'settings', |
| [57](#L57) | ); |
| [58](#L58) |  |
| [59](#L59) | $this->init(); |
| [60](#L60) |  |
| [61](#L61) | // Save settings in admin if you have any defined |
| [62](#L62) | add\_action('woocommerce\_update\_options\_shipping\_' . $this->id, array( $this, 'process\_admin\_options' )); |
| [63](#L63) |  |
| [64](#L64) | $this->is\_loaded = true; |
| [65](#L65) | } |
| [66](#L66) |  |
| [67](#L67) | /\*\* |
| [68](#L68) | \* Initialize Pakettikauppa shipping |
| [69](#L69) | \*/ |
| [70](#L70) | public function init() { |
| [71](#L71) | $this->form\_fields          = $this->my\_global\_form\_fields(); |
| [72](#L72) | $this->title                = $this->get\_option('title'); |
| [73](#L73) | } |
| [74](#L74) |  |
| [75](#L75) | public function validate\_pickuppoints\_field( $key, $value ) { |
| [76](#L76) | $values = wp\_json\_encode($value); |
| [77](#L77) | return $values; |
| [78](#L78) | } |
| [79](#L79) |  |
| [80](#L80) | public function generate\_notices\_html( $key, $value ) { |
| [81](#L81) | $settings = $this->get\_core()->shipment->get\_settings(); |
| [82](#L82) | $shipping\_method = $this->get\_core()->shippingmethod; |
| [83](#L83) | $field\_pref = 'woocommerce\_' . $shipping\_method . '\_'; |
| [84](#L84) | $configs = $this->get\_core()->api\_config; |
| [85](#L85) | if ( isset($\_POST[$field\_pref . 'mode']) ) { |
| [86](#L86) | $settings['mode'] = $\_POST[$field\_pref . 'mode']; |
| [87](#L87) | $settings['account\_number'] = $\_POST[$field\_pref . 'account\_number']; |
| [88](#L88) | $settings['secret\_key'] = $\_POST[$field\_pref . 'secret\_key']; |
| [89](#L89) | } |
| [90](#L90) | $mode = $settings['mode']; |
| [91](#L91) |  |
| [92](#L92) | ob\_start(); |
| [93](#L93) | ?> |
| [94](#L94) | <script> |
| [95](#L95) | jQuery(function( $ ) { |
| [96](#L96) | $( document ).ready(function() { |
| [97](#L97) | hide\_mode\_react(); |
| [98](#L98) |  |
| [99](#L99) | $.ajax({ |
| [100](#L100) | type: "POST", |
| [101](#L101) | url: ajaxurl, |
| [102](#L102) | data: { |
| [103](#L103) | action: 'check\_api', |
| [104](#L104) | api\_account: "<?php echo $settings['account\_number']; ?>", |
| [105](#L105) | api\_secret: "<?php echo $settings['secret\_key']; ?>" |
| [106](#L106) | }, |
| [107](#L107) | dataType: 'json' |
| [108](#L108) | }).done(function( status ) { |
| [109](#L109) | <?php if ( $mode == 'production' ) : ?> |
| [110](#L110) | hide\_mode\_react(status.api\_good); |
| [111](#L111) | if (status.api\_good) { |
| [112](#L112) | show\_api\_notice("", false); |
| [113](#L113) | } else { |
| [114](#L114) | var msg = status.msg; |
| [115](#L115) | if (status.error) { |
| [116](#L116) | msg += ".<br/><b><?php \_e('Error', 'woo-pakettikauppa'); ?>:</b> " + status.error; |
| [117](#L117) | } |
| [118](#L118) | if (status.code) { |
| [119](#L119) | msg += " <i>(<?php \_e('Code', 'woo-pakettikauppa'); ?> " + status.code + ")</i>"; |
| [120](#L120) | } |
| [121](#L121) | show\_api\_notice(msg, true); |
| [122](#L122) | } |
| [123](#L123) | <?php endif; ?> |
| [124](#L124) | }); |
| [125](#L125) |  |
| [126](#L126) | $( document ).on("change", "#woocommerce\_pakettikauppa\_shipping\_method\_mode", function() { |
| [127](#L127) | hide\_mode\_react(); |
| [128](#L128) | show\_api\_notice("", false); |
| [129](#L129) | }); |
| [130](#L130) | }); |
| [131](#L131) |  |
| [132](#L132) | function hide\_mode\_react( show = true ) { |
| [133](#L133) | if (show) { |
| [134](#L134) | $(".mode\_react").closest("tr").removeClass("row-disabled"); |
| [135](#L135) | $("h3.mode\_react").removeClass("row-disabled"); |
| [136](#L136) | } |
| [137](#L137) | else { |
| [138](#L138) | $(".mode\_react").closest("tr").addClass("row-disabled"); |
| [139](#L139) | $("h3.mode\_react").addClass("row-disabled"); |
| [140](#L140) | } |
| [141](#L141) | } |
| [142](#L142) |  |
| [143](#L143) | function show\_api\_notice(text, show = true) { |
| [144](#L144) | if (show) { |
| [145](#L145) | $("#pakettikauppa\_notices").show(); |
| [146](#L146) | $("#pakettikauppa\_notice\_api span").html(text+"."); |
| [147](#L147) | $("#pakettikauppa\_notice\_api").show(); |
| [148](#L148) | } else { |
| [149](#L149) | $("#pakettikauppa\_notices").hide(); |
| [150](#L150) | $("#pakettikauppa\_notice\_api").hide(); |
| [151](#L151) | $("#pakettikauppa\_notice\_api p").text(''); |
| [152](#L152) | } |
| [153](#L153) | } |
| [154](#L154) | }); |
| [155](#L155) | </script> |
| [156](#L156) | <tr id="pakettikauppa\_notices" style="display:none;"><td colspan="2"> |
| [157](#L157) | <div id="pakettikauppa\_notice\_api" class="pakettikauppa-notice notice-error"> |
| [158](#L158) | <p><b><?php echo strtoupper(\_\_('API error!', 'woo-pakettikauppa')); ?></b> <span></span></p> |
| [159](#L159) | </div> |
| [160](#L160) | </td></tr> |
| [161](#L161) | <?php |
| [162](#L162) | $html = ob\_get\_contents(); |
| [163](#L163) | ob\_end\_clean(); |
| [164](#L164) | return $html; |
| [165](#L165) | } |
| [166](#L166) |  |
| [167](#L167) | public function generate\_pickuppoints\_html( $key, $value ) { |
| [168](#L168) | $field\_key = $this->get\_field\_key($key); |
| [169](#L169) |  |
| [170](#L170) | if ( $this->get\_option($key) !== '' ) { |
| [171](#L171) | $values = $this->get\_option($key); |
| [172](#L172) | if ( is\_string($values) ) { |
| [173](#L173) | $values = json\_decode($this->get\_option($key), true); |
| [174](#L174) | } |
| [175](#L175) | } else { |
| [176](#L176) | $values = array(); |
| [177](#L177) | } |
| [178](#L178) |  |
| [179](#L179) | $all\_shipping\_methods = $this->get\_core()->shipment->services(); |
| [180](#L180) | if ( empty($all\_shipping\_methods) ) { |
| [181](#L181) | $all\_shipping\_methods = array(); |
| [182](#L182) | } |
| [183](#L183) |  |
| [184](#L184) | $methods = $this->get\_core()->shipment->get\_pickup\_point\_methods(); |
| [185](#L185) |  |
| [186](#L186) | ob\_start(); |
| [187](#L187) | ?> |
| [188](#L188) | <script> |
| [189](#L189) | function pkSetInputs(parent, disabled) { |
| [190](#L190) | var inputs = parent.querySelectorAll('input'); |
| [191](#L191) | for(var j=0; j<inputs.length; ++j) { |
| [192](#L192) | if (disabled){ |
| [193](#L193) | inputs[j].setAttribute('disabled', disabled); |
| [194](#L194) | } else { |
| [195](#L195) | inputs[j].removeAttribute('disabled'); |
| [196](#L196) | } |
| [197](#L197) | } |
| [198](#L198) | } |
| [199](#L199) |  |
| [200](#L200) | function pkChangeOptions(elem, methodId) { |
| [201](#L201) |  |
| [202](#L202) | var strUser = elem.options[elem.selectedIndex].value; |
| [203](#L203) | var elements = document.getElementsByClassName('pk-services-' + methodId); |
| [204](#L204) |  |
| [205](#L205) | var servicesElement = document.getElementById('services-' + methodId + '-' + strUser); |
| [206](#L206) | var pickuppointsElement = document.getElementById('pickuppoints-' + methodId); |
| [207](#L207) | var servicePickuppointsElement = document.getElementById('service-' + methodId + '-' + strUser + '-pickuppoints'); |
| [208](#L208) |  |
| [209](#L209) | for(var i=0; i<elements.length; ++i) { |
| [210](#L210) | elements[i].style.display = "none"; |
| [211](#L211) | pkSetInputs(elements[i], true); |
| [212](#L212) | } |
| [213](#L213) |  |
| [214](#L214) |  |
| [215](#L215) |  |
| [216](#L216) | if (strUser == '\_\_PICKUPPOINTS\_\_') { |
| [217](#L217) | if (pickuppointsElement) { |
| [218](#L218) | pickuppointsElement.style.display = "block"; |
| [219](#L219) | pkSetInputs(pickuppointsElement, false); |
| [220](#L220) | } |
| [221](#L221) | if (servicesElement) { |
| [222](#L222) | servicesElement.style.display = "none"; |
| [223](#L223) | pkSetInputs(servicesElement, true); |
| [224](#L224) | } |
| [225](#L225) | } else { |
| [226](#L226) | if (pickuppointsElement) { |
| [227](#L227) | pickuppointsElement.style.display = "none"; |
| [228](#L228) | pkSetInputs(pickuppointsElement, true); |
| [229](#L229) | } |
| [230](#L230) | if (servicesElement) { |
| [231](#L231) | servicesElement.style.display = "block"; |
| [232](#L232) | pkSetInputs(servicesElement, false); |
| [233](#L233) | } |
| [234](#L234) | if (elem.options[elem.selectedIndex].getAttribute('data-haspp') == 'true') { |
| [235](#L235) | servicePickuppointsElement.style.display = "block"; |
| [236](#L236) | pkSetInputs(servicePickuppointsElement, false); |
| [237](#L237) | } |
| [238](#L238) | } |
| [239](#L239) | } |
| [240](#L240) | </script> |
| [241](#L241) | <tr> |
| [242](#L242) | <th colspan="2" class="titledesc mode\_react" scope="row"><?php echo esc\_html($value['title']); ?></th> |
| [243](#L243) | </tr> |
| [244](#L244) | <tr> |
| [245](#L245) | <td colspan="2" class="mode\_react"> |
| [246](#L246) | <?php foreach ( \WC\_Shipping\_Zones::get\_zones('admin') as $zone\_raw ) : ?> |
| [247](#L247) | <hr> |
| [248](#L248) | <?php $zone = new \WC\_Shipping\_Zone($zone\_raw['zone\_id']); ?> |
| [249](#L249) | <h3> |
| [250](#L250) | <?php esc\_html\_e('Zone name', 'woocommerce'); ?>: <?php echo $zone->get\_zone\_name(); ?> |
| [251](#L251) | </h3> |
| [252](#L252) | <p> |
| [253](#L253) | <?php esc\_html\_e('Zone regions', 'woocommerce'); ?>: <?php echo $zone->get\_formatted\_location(); ?> |
| [254](#L254) | </p> |
| [255](#L255) | <h4><?php esc\_html\_e('Shipping method(s)', 'woocommerce'); ?></h4> |
| [256](#L256) | <?php foreach ( $zone->get\_shipping\_methods() as $method\_id => $shipping\_method ) : ?> |
| [257](#L257) | <?php if ( $shipping\_method->enabled === 'yes' && $shipping\_method->id !== $this->get\_core()->shippingmethod && $shipping\_method->id !== 'local\_pickup' ) : ?> |
| [258](#L258) | <?php |
| [259](#L259) | $selected\_service = null; |
| [260](#L260) | if ( ! empty($values[ $method\_id ]['service']) ) { |
| [261](#L261) | $selected\_service = $values[ $method\_id ]['service']; |
| [262](#L262) | } |
| [263](#L263) | if ( empty($selected\_service) && ! empty($methods) && isset($values[$method\_id]) ) { |
| [264](#L264) | $selected\_service = '\_\_PICKUPPOINTS\_\_'; |
| [265](#L265) | } |
| [266](#L266) | ?> |
| [267](#L267) | <table style="border-collapse: collapse;" border="0"> |
| [268](#L268) | <th><?php echo $shipping\_method->title; ?></th> |
| [269](#L269) | <td style="vertical-align: top;"> |
| [270](#L270) | <select id="<?php echo $method\_id; ?>-select" name="<?php echo esc\_html($field\_key) . '[' . esc\_attr($method\_id) . '][service]'; ?>" onchange="pkChangeOptions(this, '<?php echo $method\_id; ?>');"> |
| [271](#L271) | <option value="\_\_NULL\_\_"><?php echo $this->get\_core()->text->no\_shipping(); ?></option> |
| [272](#L272) | <?php if ( ! empty($methods) ) : ?> |
| [273](#L273) | <option value="\_\_PICKUPPOINTS\_\_" <?php echo ($selected\_service === '\_\_PICKUPPOINTS\_\_' ? 'selected' : ''); ?>>Noutopisteet</option> |
| [274](#L274) | <?php endif; ?> |
| [275](#L275) | <?php foreach ( $all\_shipping\_methods as $service\_id => $service\_name ) : ?> |
| [276](#L276) | <?php $has\_pp = ($this->get\_core()->shipment->service\_has\_pickup\_points($service\_id)) ? true : false; ?> |
| [277](#L277) | <option value="<?php echo $service\_id; ?>" <?php echo (strval($selected\_service) === strval($service\_id) ? 'selected' : ''); ?> data-haspp="<?php echo ($has\_pp) ? 'true' : 'false'; ?>"> |
| [278](#L278) | <?php echo $service\_name; ?> |
| [279](#L279) | <?php if ( $has\_pp ) : ?> |
| [280](#L280) | (<?php echo $this->get\_core()->text->includes\_pickup\_points(); ?>) |
| [281](#L281) | <?php endif; ?> |
| [282](#L282) | </option> |
| [283](#L283) | <?php endforeach; ?> |
| [284](#L284) | </select> |
| [285](#L285) | </td> |
| [286](#L286) | <td style="vertical-align: top;"> |
| [287](#L287) | <div style='display: none;' id="pickuppoints-<?php echo $method\_id; ?>"> |
| [288](#L288) | <?php foreach ( $methods as $method\_code => $method\_name ) : ?> |
| [289](#L289) | <input type="hidden" |
| [290](#L290) | name="<?php echo esc\_html($field\_key) . '[' . esc\_attr($method\_id) . '][' . $method\_code . '][active]'; ?>" |
| [291](#L291) | value="no"> |
| [292](#L292) | <p> |
| [293](#L293) | <label> |
| [294](#L294) | <input type="checkbox" |
| [295](#L295) | name="<?php echo esc\_html($field\_key) . '[' . esc\_attr($method\_id) . '][' . $method\_code . '][active]'; ?>" |
| [296](#L296) | value="yes" <?php echo (! empty($values[ $method\_id ][ $method\_code ]['active']) && $values[ $method\_id ][ $method\_code ]['active'] === 'yes') ? 'checked' : ''; ?>> |
| [297](#L297) | <?php echo $method\_name; ?> |
| [298](#L298) | </label> |
| [299](#L299) | </p> |
| [300](#L300) | <?php endforeach; ?> |
| [301](#L301) | </div> |
| [302](#L302) |  |
| [303](#L303) | <?php |
| [304](#L304) | $all\_additional\_services = $this->get\_core()->shipment->get\_additional\_services(); |
| [305](#L305) | if ( empty($all\_additional\_services) ) { |
| [306](#L306) | $all\_additional\_services = array(); |
| [307](#L307) | } |
| [308](#L308) | ?> |
| [309](#L309) | <?php foreach ( $all\_additional\_services as $method\_code => $additional\_services ) : ?> |
| [310](#L310) | <div class="pk-services-<?php echo $method\_id; ?>" style='display: none;' id="services-<?php echo $method\_id; ?>-<?php echo $method\_code; ?>"> |
| [311](#L311) | <?php foreach ( $additional\_services as $additional\_service ) : ?> |
| [312](#L312) | <?php if ( empty($additional\_service->specifiers) || in\_array($additional\_service->service\_code, array( '3102' ), true) ) : ?> |
| [313](#L313) | <input type="hidden" |
| [314](#L314) | name="<?php echo esc\_html($field\_key) . '[' . esc\_attr($method\_id) . '][' . esc\_attr($method\_code) . '][additional\_services][' . $additional\_service->service\_code . ']'; ?>" |
| [315](#L315) | value="no"> |
| [316](#L316) | <p> |
| [317](#L317) | <label> |
| [318](#L318) | <input type="checkbox" |
| [319](#L319) | name="<?php echo esc\_html($field\_key) . '[' . esc\_attr($method\_id) . '][' . esc\_attr($method\_code) . '][additional\_services][' . $additional\_service->service\_code . ']'; ?>" |
| [320](#L320) | value="yes" <?php echo (! empty($values[ $method\_id ][ $method\_code ]['additional\_services'][ $additional\_service->service\_code ]) && $values[ $method\_id ][ $method\_code ]['additional\_services'][ $additional\_service->service\_code ] === 'yes') ? 'checked' : ''; ?>> |
| [321](#L321) | <?php echo $additional\_service->name; ?> |
| [322](#L322) | </label> |
| [323](#L323) | </p> |
| [324](#L324) | <?php endif; ?> |
| [325](#L325) | <?php endforeach; ?> |
| [326](#L326) | <input type="hidden" |
| [327](#L327) | name="<?php echo esc\_html($field\_key) . '[' . esc\_attr($method\_id) . '][' . esc\_attr($method\_code) . '][additional\_services][return\_label]'; ?>" |
| [328](#L328) | value="no"> |
| [329](#L329) | <p> |
| [330](#L330) | <label> |
| [331](#L331) | <input type="checkbox" |
| [332](#L332) | name="<?php echo esc\_html($field\_key) . '[' . esc\_attr($method\_id) . '][' . esc\_attr($method\_code) . '][additional\_services][return\_label]'; ?>" |
| [333](#L333) | value="yes" <?php echo (! empty($values[ $method\_id ][ $method\_code ]['additional\_services']['return\_label']) && $values[ $method\_id ][ $method\_code ]['additional\_services']['return\_label'] === 'yes') ? 'checked' : ''; ?>> |
| [334](#L334) | <?php echo \_\_('Include return label (if available)', 'woo-pakettikauppa'); ?> |
| [335](#L335) | </label> |
| [336](#L336) | </p> |
| [337](#L337) | </div> |
| [338](#L338) | <?php endforeach; ?> |
| [339](#L339) | <?php foreach ( $all\_shipping\_methods as $service\_id => $service\_name ) : ?> |
| [340](#L340) | <?php if ( $this->get\_core()->shipment->service\_has\_pickup\_points($service\_id) ) : ?> |
| [341](#L341) | <div id="service-<?php echo $method\_id; ?>-<?php echo $service\_id; ?>-pickuppoints" class="pk-services-<?php echo $method\_id; ?>" style="display: none;"> |
| [342](#L342) | <input type="hidden" |
| [343](#L343) | name="<?php echo esc\_html($field\_key) . '[' . esc\_attr($method\_id) . '][' . esc\_attr($service\_id) . '][pickuppoints]'; ?>" value="no"> |
| [344](#L344) | <p> |
| [345](#L345) | <label> |
| [346](#L346) | <input type="checkbox" |
| [347](#L347) | name="<?php echo esc\_html($field\_key) . '[' . esc\_attr($method\_id) . '][' . esc\_attr($service\_id) . '][pickuppoints]'; ?>" |
| [348](#L348) | value="yes" <?php echo ((! empty($values[ $method\_id ][ $service\_id ]['pickuppoints']) && $values[ $method\_id ][ $service\_id ]['pickuppoints'] === 'yes') || empty($values[ $method\_id ][ $service\_id ]['pickuppoints'])) ? 'checked' : ''; ?>> |
| [349](#L349) | <?php echo \_\_('Pickup points', 'woo-pakettikauppa'); ?> |
| [350](#L350) | </label> |
| [351](#L351) | </p> |
| [352](#L352) | </div> |
| [353](#L353) | <?php endif; ?> |
| [354](#L354) | <?php endforeach; ?> |
| [355](#L355) | </td> |
| [356](#L356) | </table> |
| [357](#L357) | <script>pkChangeOptions(document.getElementById("<?php echo $method\_id; ?>-select"), '<?php echo $method\_id; ?>');</script> |
| [358](#L358) | <?php endif; ?> |
| [359](#L359) | <?php endforeach; ?> |
| [360](#L360) | <?php endforeach; ?> |
| [361](#L361) | <hr> |
| [362](#L362) |  |
| [363](#L363) | </td> |
| [364](#L364) | </tr> |
| [365](#L365) |  |
| [366](#L366) | <?php |
| [367](#L367) | $html = ob\_get\_contents(); |
| [368](#L368) | ob\_end\_clean(); |
| [369](#L369) | return $html; |
| [370](#L370) | } |
| [371](#L371) |  |
| [372](#L372) | public function generate\_enchancedtextarea\_html( $key, $value ) { |
| [373](#L373) | $field\_key = $this->get\_field\_key($key); |
| [374](#L374) | $field\_value = $this->get\_option($key); |
| [375](#L375) |  |
| [376](#L376) | ob\_start(); |
| [377](#L377) | ?> |
| [378](#L378) |  |
| [379](#L379) | <tr valign="top" class="pakettikauppa-setting"> |
| [380](#L380) | <th scope="row" class="titledesc"> |
| [381](#L381) | <label for="<?php echo $field\_key; ?>"><?php echo esc\_html($value['title']); ?></label> |
| [382](#L382) | </th> |
| [383](#L383) | <td class="forminp"> |
| [384](#L384) | <fieldset> |
| [385](#L385) | <legend class="screen-reader-text"><span><?php echo esc\_html($value['title']); ?></span></legend> |
| [386](#L386) | <textarea rows="3" cols="20" class="input-text wide-input " type="textarea" name="<?php echo $field\_key; ?>" id="<?php echo $field\_key; ?>" style="" placeholder=""><?php echo esc\_html($field\_value); ?></textarea> |
| [387](#L387) | <?php if ( ! empty($value['available\_params']) && is\_array($value['available\_params']) ) : ?> |
| [388](#L388) | <?php foreach ( $value['available\_params'] as $param\_key => $param\_desc ) : ?> |
| [389](#L389) | <p class="description enchtext noselect"> |
| [390](#L390) | <code class="enchtext-code" data-param="<?php echo esc\_html($param\_key); ?>" onclick="click\_enchancedtextarea\_code('<?php echo $field\_key; ?>', '<?php echo esc\_html($param\_key); ?>');">{<?php echo esc\_html($param\_key); ?>}</code> - <?php echo esc\_html($param\_desc); ?> |
| [391](#L391) | </p> |
| [392](#L392) | <?php endforeach; ?> |
| [393](#L393) | <?php endif; ?> |
| [394](#L394) | <?php if ( ! empty($value['description']) ) : ?> |
| [395](#L395) | <p class="description"><?php echo $value['description']; ?></p> |
| [396](#L396) | <?php endif; ?> |
| [397](#L397) | </fieldset> |
| [398](#L398) | </td> |
| [399](#L399) | </tr> |
| [400](#L400) |  |
| [401](#L401) | <?php |
| [402](#L402) | $html = ob\_get\_contents(); |
| [403](#L403) | ob\_end\_clean(); |
| [404](#L404) | return $html; |
| [405](#L405) | } |
| [406](#L406) |  |
| [407](#L407) | public function generate\_button\_html( $key, $value ) { |
| [408](#L408) | $field\_key = $this->get\_field\_key($key); |
| [409](#L409) | ob\_start(); |
| [410](#L410) | ?> |
| [411](#L411) | <tr valign="top" class="pakettikauppa-setting"> |
| [412](#L412) | <th scope="row" class="titledesc"> |
| [413](#L413) | <label for="<?php echo $field\_key; ?>"><?php echo esc\_html($value['title']); ?></label> |
| [414](#L414) | </th> |
| [415](#L415) | <td class="forminp"> |
| [416](#L416) | <fieldset> |
| [417](#L417) | <a class="button button-primary" href="<?php echo $value['url']; ?>"> |
| [418](#L418) | <?php echo $value['text']; ?> |
| [419](#L419) | </a> |
| [420](#L420) | </fieldset> |
| [421](#L421) | </td> |
| [422](#L422) | </tr> |
| [423](#L423) | <?php |
| [424](#L424) | $html = ob\_get\_contents(); |
| [425](#L425) | ob\_end\_clean(); |
| [426](#L426) | return $html; |
| [427](#L427) | } |
| [428](#L428) |  |
| [429](#L429) | protected function get\_form\_field\_mode() { |
| [430](#L430) | return array( |
| [431](#L431) | 'type'    => 'hidden', |
| [432](#L432) | 'default' => 'production', |
| [433](#L433) | ); |
| [434](#L434) | } |
| [435](#L435) |  |
| [436](#L436) | public function generate\_hidden\_html( $key, $args ) |
| [437](#L437) | { |
| [438](#L438) | $field\_key = $this->get\_field\_key($key); |
| [439](#L439) |  |
| [440](#L440) | return '<input type="hidden" name="' . esc\_html($field\_key) . '" value="' . esc\_attr($args['default']) . '" />'; |
| [441](#L441) | } |
| [442](#L442) |  |
| [443](#L443) | private function my\_global\_form\_fields() { |
| [444](#L444) | $wc\_countries = new WC\_Countries(); |
| [445](#L445) |  |
| [446](#L446) | $fields = array( |
| [447](#L447) | 'notices'    => array( |
| [448](#L448) | 'type'     => 'notices', |
| [449](#L449) | ), |
| [450](#L450) |  |
| [451](#L451) | array( |
| [452](#L452) | 'title' => '', |
| [453](#L453) | 'type'  => 'title', |
| [454](#L454) | 'class' => 'hidden', |
| [455](#L455) | ), |
| [456](#L456) |  |
| [457](#L457) | 'mode'                       => $this->get\_form\_field\_mode(), |
| [458](#L458) |  |
| [459](#L459) | 'account\_number'             => array( |
| [460](#L460) | 'title'    => $this->get\_core()->text->api\_key\_title(), |
| [461](#L461) | 'desc'     => $this->get\_core()->text->api\_key\_desc($this->get\_core()->vendor\_name), |
| [462](#L462) | 'type'     => 'text', |
| [463](#L463) | 'default'  => '', |
| [464](#L464) | 'desc\_tip' => true, |
| [465](#L465) | ), |
| [466](#L466) |  |
| [467](#L467) | 'secret\_key'                 => array( |
| [468](#L468) | 'title'    => $this->get\_core()->text->api\_secret\_title(), |
| [469](#L469) | 'desc'     => $this->get\_core()->text->api\_secret\_desc($this->get\_core()->vendor\_name), |
| [470](#L470) | 'type'     => 'password', |
| [471](#L471) | 'default'  => '', |
| [472](#L472) | 'desc\_tip' => true, |
| [473](#L473) | ), |
| [474](#L474) |  |
| [475](#L475) | 'order\_pickup'              => array( |
| [476](#L476) | 'title' => $this->get\_core()->text->order\_pickup\_title(), |
| [477](#L477) | 'type'  => 'title', |
| [478](#L478) | ), |
| [479](#L479) |  |
| [480](#L480) | 'order\_pickup\_customer\_id'                 => array( |
| [481](#L481) | 'title'    => $this->get\_core()->text->customer\_id\_title(), |
| [482](#L482) | 'desc'     => '', |
| [483](#L483) | 'type'     => 'text', |
| [484](#L484) | 'default'  => '', |
| [485](#L485) | 'desc\_tip' => true, |
| [486](#L486) | ), |
| [487](#L487) |  |
| [488](#L488) | 'order\_pickup\_invoice\_id'                 => array( |
| [489](#L489) | 'title'    => $this->get\_core()->text->invoice\_id\_title(), |
| [490](#L490) | 'desc'     => '', |
| [491](#L491) | 'type'     => 'text', |
| [492](#L492) | 'default'  => '', |
| [493](#L493) | 'desc\_tip' => true, |
| [494](#L494) | ), |
| [495](#L495) |  |
| [496](#L496) | 'order\_pickup\_sender\_id'                 => array( |
| [497](#L497) | 'title'    => $this->get\_core()->text->sender\_id\_title(), |
| [498](#L498) | 'desc'     => '', |
| [499](#L499) | 'type'     => 'text', |
| [500](#L500) | 'default'  => '', |
| [501](#L501) | 'desc\_tip' => true, |
| [502](#L502) | ), |
| [503](#L503) |  |
| [504](#L504) | 'pickup\_points'              => array( |
| [505](#L505) | 'title' => $this->get\_core()->text->pickup\_points\_title(), |
| [506](#L506) | 'type'  => 'pickuppoints', |
| [507](#L507) | ), |
| [508](#L508) |  |
| [509](#L509) | array( |
| [510](#L510) | 'title'       => $this->get\_core()->text->shipping\_settings\_title(), |
| [511](#L511) | 'type'        => 'title', |
| [512](#L512) | /\* translators: %s: url to documentation \*/ |
| [513](#L513) | 'description' => $this->get\_core()->text->shipping\_settings\_desc(), |
| [514](#L514) | ), |
| [515](#L515) |  |
| [516](#L516) | 'add\_tracking\_to\_email'      => array( |
| [517](#L517) | 'title'   => $this->get\_core()->text->add\_tracking\_link\_to\_email(), |
| [518](#L518) | 'type'    => 'checkbox', |
| [519](#L519) | 'default' => 'yes', |
| [520](#L520) | 'class'   => 'mode\_react', |
| [521](#L521) | ), |
| [522](#L522) |  |
| [523](#L523) | 'add\_pickup\_point\_to\_email'      => array( |
| [524](#L524) | 'title'   => $this->get\_core()->text->add\_pickup\_point\_to\_email(), |
| [525](#L525) | 'type'    => 'checkbox', |
| [526](#L526) | 'default' => 'yes', |
| [527](#L527) | 'class'   => 'mode\_react', |
| [528](#L528) | ), |
| [529](#L529) |  |
| [530](#L530) | 'ignore\_product\_weight'      => array( |
| [531](#L531) | 'title'   => $this->get\_core()->text->ignore\_product\_weight(), |
| [532](#L532) | 'type'    => 'checkbox', |
| [533](#L533) | 'default' => 'no', |
| [534](#L534) | 'class'   => 'mode\_react', |
| [535](#L535) | ), |
| [536](#L536) |  |
| [537](#L537) | 'change\_order\_status\_to'      => array( |
| [538](#L538) | 'title'   => $this->get\_core()->text->change\_order\_status\_to(), |
| [539](#L539) | 'type'    => 'select', |
| [540](#L540) | 'default' => '', |
| [541](#L541) | 'options' => array( |
| [542](#L542) | '' => $this->get\_core()->text->no\_order\_status\_change(), |
| [543](#L543) | 'completed'  => \_\_('Completed', 'woocommerce'), |
| [544](#L544) | 'processing' => \_\_('Processing', 'woocommerce'), |
| [545](#L545) | ), |
| [546](#L546) | 'class'   => 'mode\_react', |
| [547](#L547) | ), |
| [548](#L548) |  |
| [549](#L549) | 'translate\_products\_in\_labels'      => array( |
| [550](#L550) | 'title'   => $this->get\_core()->text->translate\_products\_in\_labels\_title(), |
| [551](#L551) | 'type'    => 'checkbox', |
| [552](#L552) | 'default' => 'no', |
| [553](#L553) | 'description' => $this->get\_core()->text->translate\_products\_in\_labels\_desc(), |
| [554](#L554) | 'desc\_tip'    => true, |
| [555](#L555) | 'class'   => 'mode\_react', |
| [556](#L556) | ), |
| [557](#L557) |  |
| [558](#L558) | 'create\_shipments\_automatically'     => array( |
| [559](#L559) | 'title'   => $this->get\_core()->text->create\_shipments\_automatically(), |
| [560](#L560) | 'type'    => 'select', |
| [561](#L561) | 'default' => 'no', |
| [562](#L562) | 'options' => array( |
| [563](#L563) | 'no'  => $this->get\_core()->text->no\_automatic\_creation\_of\_labels(), |
| [564](#L564) | /\* translators: %s: order status \*/ |
| [565](#L565) | 'completed'  => $this->get\_core()->text->when\_order\_status\_is(\_\_('Completed', 'woocommerce')), |
| [566](#L566) | /\* translators: %s: order status \*/ |
| [567](#L567) | 'processing' => $this->get\_core()->text->when\_order\_status\_is(\_\_('Processing', 'woocommerce')), |
| [568](#L568) | ), |
| [569](#L569) | 'class'   => 'mode\_react', |
| [570](#L570) | ), |
| [571](#L571) |  |
| [572](#L572) | 'labels\_size'     => array( |
| [573](#L573) | 'title'   => $this->get\_core()->text->labels\_size\_title(), |
| [574](#L574) | 'type'    => 'select', |
| [575](#L575) | 'default' => 'menu', |
| [576](#L576) | 'options' => array( |
| [577](#L577) | 'A5'  => 'A5', |
| [578](#L578) | '107x225'  => '107x225', |
| [579](#L579) | ), |
| [580](#L580) | 'class'   => 'mode\_react', |
| [581](#L581) | ), |
| [582](#L582) |  |
| [583](#L583) | 'download\_type\_of\_labels'     => array( |
| [584](#L584) | 'title'   => $this->get\_core()->text->download\_type\_of\_labels\_title(), |
| [585](#L585) | 'type'    => 'select', |
| [586](#L586) | 'default' => 'menu', |
| [587](#L587) | 'options' => array( |
| [588](#L588) | 'browser'  => $this->get\_core()->text->download\_type\_of\_labels\_option\_browser(), |
| [589](#L589) | 'download'  => $this->get\_core()->text->download\_type\_of\_labels\_option\_download(), |
| [590](#L590) | ), |
| [591](#L591) | 'class'   => 'mode\_react', |
| [592](#L592) | ), |
| [593](#L593) |  |
| [594](#L594) | 'post\_label\_to\_url' => array( |
| [595](#L595) | 'title'   => $this->get\_core()->text->post\_shipping\_label\_to\_url\_title(), |
| [596](#L596) | 'type'    => 'text', |
| [597](#L597) | 'default' => '', |
| [598](#L598) | 'description' => $this->get\_core()->text->post\_shipping\_label\_to\_url\_desc(), |
| [599](#L599) | 'desc\_tip'    => true, |
| [600](#L600) | 'class'   => 'mode\_react', |
| [601](#L601) | ), |
| [602](#L602) |  |
| [603](#L603) | array( |
| [604](#L604) | 'title' => $this->get\_core()->text->checkout\_settings(), |
| [605](#L605) | 'type'  => 'title', |
| [606](#L606) | ), |
| [607](#L607) |  |
| [608](#L608) | 'field\_phone\_required' => array( |
| [609](#L609) | 'title'   => $this->get\_core()->text->field\_phone\_required(), |
| [610](#L610) | 'type'    => 'select', |
| [611](#L611) | 'default' => 'no', |
| [612](#L612) | 'options' => array( |
| [613](#L613) | 'no'  => \_\_('No'), |
| [614](#L614) | 'yes'  => \_\_('Yes'), |
| [615](#L615) | ), |
| [616](#L616) | ), |
| [617](#L617) |  |
| [618](#L618) | 'pickup\_points\_type' => array( |
| [619](#L619) | 'title' => $this->get\_core()->text->pickup\_points\_type\_title(), |
| [620](#L620) | 'type' => 'multiselect', |
| [621](#L621) | 'options' => array( |
| [622](#L622) | 'all' => $this->get\_core()->text->pickup\_points\_type\_all(), |
| [623](#L623) | 'PRIVATE\_LOCKER' => $this->get\_core()->text->pickup\_points\_type\_private\_locker(), |
| [624](#L624) | 'OUTDOOR\_LOCKER' => $this->get\_core()->text->pickup\_points\_type\_outdoor\_locker(), |
| [625](#L625) | 'PARCEL\_LOCKER' => $this->get\_core()->text->pickup\_points\_type\_parcel\_locker(), |
| [626](#L626) | 'PICKUP\_POINT,AGENCY' => $this->get\_core()->text->pickup\_points\_type\_pickup\_point(), |
| [627](#L627) | ), |
| [628](#L628) | 'default' => 'all', |
| [629](#L629) | 'description' => $this->get\_core()->text->pickup\_points\_type\_desc(), |
| [630](#L630) | 'desc\_tip'    => true, |
| [631](#L631) | ), |
| [632](#L632) |  |
| [633](#L633) | 'pickup\_points\_search\_limit' => array( |
| [634](#L634) | 'title'       => $this->get\_core()->text->pickup\_points\_search\_limit\_title(), |
| [635](#L635) | 'type'        => 'number', |
| [636](#L636) | 'default'     => 5, |
| [637](#L637) | 'description' => $this->get\_core()->text->pickup\_points\_search\_limit\_desc(), |
| [638](#L638) | 'desc\_tip'    => true, |
| [639](#L639) | 'class'   => 'mode\_react', |
| [640](#L640) | ), |
| [641](#L641) |  |
| [642](#L642) | 'pickup\_point\_list\_type'     => array( |
| [643](#L643) | 'title'   => $this->get\_core()->text->pickup\_point\_list\_type\_title(), |
| [644](#L644) | 'type'    => 'select', |
| [645](#L645) | 'default' => 'menu', |
| [646](#L646) | 'options' => array( |
| [647](#L647) | 'menu'  => $this->get\_core()->text->pickup\_point\_list\_type\_option\_menu(), |
| [648](#L648) | 'list'  => $this->get\_core()->text->pickup\_point\_list\_type\_option\_list(), |
| [649](#L649) | ), |
| [650](#L650) | 'class'   => 'mode\_react', |
| [651](#L651) | ), |
| [652](#L652) | 'show\_pickup\_point\_override\_query' => array( |
| [653](#L653) | 'title'   => $this->get\_core()->text->show\_pickup\_point\_override\_query(), |
| [654](#L654) | 'type'    => 'select', |
| [655](#L655) | 'default' => 'yes', |
| [656](#L656) | 'options' => array( |
| [657](#L657) | 'no'  => \_\_('No'), |
| [658](#L658) | 'yes'  => \_\_('Yes'), |
| [659](#L659) | ), |
| [660](#L660) | 'description' => $this->get\_core()->text->pickup\_points\_override\_query\_desc(), |
| [661](#L661) | 'desc\_tip'    => true, |
| [662](#L662) | ), |
| [663](#L663) |  |
| [664](#L664) | array( |
| [665](#L665) | 'title' => $this->get\_core()->text->store\_owner\_information(), |
| [666](#L666) | 'type'  => 'title', |
| [667](#L667) | ), |
| [668](#L668) |  |
| [669](#L669) | 'sender\_name'                => array( |
| [670](#L670) | 'title'   => $this->get\_core()->text->sender\_name(), |
| [671](#L671) | 'type'    => 'text', |
| [672](#L672) | 'default' => get\_bloginfo('name'), |
| [673](#L673) | ), |
| [674](#L674) |  |
| [675](#L675) | 'sender\_address'             => array( |
| [676](#L676) | 'title'   => $this->get\_core()->text->sender\_address(), |
| [677](#L677) | 'type'    => 'text', |
| [678](#L678) | 'default' => WC()->countries->get\_base\_address(), |
| [679](#L679) | ), |
| [680](#L680) |  |
| [681](#L681) | 'sender\_postal\_code'         => array( |
| [682](#L682) | 'title'   => $this->get\_core()->text->sender\_postal\_code(), |
| [683](#L683) | 'type'    => 'text', |
| [684](#L684) | 'default' => WC()->countries->get\_base\_postcode(), |
| [685](#L685) | ), |
| [686](#L686) |  |
| [687](#L687) | 'sender\_city'                => array( |
| [688](#L688) | 'title'   => $this->get\_core()->text->sender\_city(), |
| [689](#L689) | 'type'    => 'text', |
| [690](#L690) | 'default' => WC()->countries->get\_base\_city(), |
| [691](#L691) | ), |
| [692](#L692) |  |
| [693](#L693) | 'sender\_country'                => array( |
| [694](#L694) | 'title'   => $this->get\_core()->text->sender\_country(), |
| [695](#L695) | 'type'    => 'select', |
| [696](#L696) | 'default' => WC()->countries->get\_base\_country(), |
| [697](#L697) | 'options'   => $wc\_countries->get\_countries(), |
| [698](#L698) | ), |
| [699](#L699) |  |
| [700](#L700) | 'sender\_phone'                => array( |
| [701](#L701) | 'title'   => $this->get\_core()->text->sender\_phone(), |
| [702](#L702) | 'type'    => 'text', |
| [703](#L703) | ), |
| [704](#L704) |  |
| [705](#L705) | 'sender\_email'                => array( |
| [706](#L706) | 'title'   => $this->get\_core()->text->sender\_email(), |
| [707](#L707) | 'type'    => 'email', |
| [708](#L708) | ), |
| [709](#L709) |  |
| [710](#L710) | 'info\_code'                  => array( |
| [711](#L711) | 'title'   => $this->get\_core()->text->info\_code(), |
| [712](#L712) | 'type'    => 'text', |
| [713](#L713) | 'default' => '', |
| [714](#L714) | ), |
| [715](#L715) | 'cod\_title' => array( |
| [716](#L716) | 'title' => $this->get\_core()->text->cod\_settings(), |
| [717](#L717) | 'type'  => 'title', |
| [718](#L718) | ), |
| [719](#L719) | 'cod\_iban'                   => array( |
| [720](#L720) | 'title'   => $this->get\_core()->text->cod\_iban(), |
| [721](#L721) | 'type'    => 'text', |
| [722](#L722) | 'default' => '', |
| [723](#L723) | ), |
| [724](#L724) | 'cod\_bic'                    => array( |
| [725](#L725) | 'title'   => $this->get\_core()->text->cod\_bic(), |
| [726](#L726) | 'type'    => 'text', |
| [727](#L727) | 'default' => '', |
| [728](#L728) | ), |
| [729](#L729) | array( |
| [730](#L730) | 'title' => $this->get\_core()->text->advanced\_settings(), |
| [731](#L731) | 'type'  => 'title', |
| [732](#L732) | ), |
| [733](#L733) | 'label\_additional\_info' => array( |
| [734](#L734) | 'title'   => $this->get\_core()->text->additional\_info\_param\_title(), |
| [735](#L735) | 'type'    => 'enchancedtextarea', |
| [736](#L736) | 'description' => '', |
| [737](#L737) | 'available\_params' => array( |
| [738](#L738) | 'ORDER\_NUMBER' => $this->get\_core()->text->additional\_info\_param\_order\_number(), |
| [739](#L739) | 'ORDER\_NOTE' => $this->get\_core()->text->additional\_info\_param\_order\_note(), |
| [740](#L740) | 'PRODUCTS\_NAMES' => $this->get\_core()->text->additional\_info\_param\_products\_names(), |
| [741](#L741) | 'PRODUCTS\_NAME\_WITH\_QUANTITY' => $this->get\_core()->text->additional\_info\_param\_products\_names\_with\_qty(), |
| [742](#L742) | 'PRODUCTS\_SKU' => $this->get\_core()->text->additional\_info\_param\_products\_sku(), |
| [743](#L743) | ), |
| [744](#L744) | ), |
| [745](#L745) | ); |
| [746](#L746) | //unset order pickup settings if feature is disabled |
| [747](#L747) | if ( ! $this->get\_core()->order\_pickup ) { |
| [748](#L748) | unset($fields['order\_pickup']); |
| [749](#L749) | unset($fields['order\_pickup\_customer\_id']); |
| [750](#L750) | unset($fields['order\_pickup\_invoice\_id']); |
| [751](#L751) | unset($fields['order\_pickup\_sender\_id']); |
| [752](#L752) | } |
| [753](#L753) | if ( get\_option($this->get\_core()->prefix . '\_wizard\_done') == 1 ) { |
| [754](#L754) | $fields['setup\_wizard'] = array( |
| [755](#L755) | 'title'   => $this->get\_core()->text->setup\_wizard(), |
| [756](#L756) | 'type'    => 'button', |
| [757](#L757) | 'url'     => esc\_url(admin\_url('admin.php?page=' . $this->get\_core()->setup\_page)), |
| [758](#L758) | 'text'    => $this->get\_core()->text->restart\_setup\_wizard(), |
| [759](#L759) | ); |
| [760](#L760) | } |
| [761](#L761) | return $fields; |
| [762](#L762) | } |
| [763](#L763) |  |
| [764](#L764) | public function process\_admin\_options() { |
| [765](#L765) | delete\_transient($this->get\_core()->prefix . '\_shipping\_methods'); |
| [766](#L766) | update\_option($this->get\_core()->prefix . '\_wizard\_done', 1); |
| [767](#L767) | //delete token on update, in case settings changed |
| [768](#L768) | delete\_transient($this->get\_core()->prefix . '\_access\_token'); |
| [769](#L769) | return parent::process\_admin\_options(); |
| [770](#L770) | } |
| [771](#L771) | } |
| [772](#L772) | } |

**Note:** See [TracBrowser](/wiki/TracBrowser)
for help on using the repository browser.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Plain Text](/browser/posti-shipping/tags/3.10.3/core/class-shipping-method.php?format=txt)
* [Original Format](/export/3222428/posti-shipping/tags/3.10.3/core/class-shipping-method.php)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from plugins.trac.wordpress.org_2a110388_20250114_181016.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fbrowser%2Fposti-shipping%2Ftags%2F3.10.3%2Fcore%2Fclass-shipping-method.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Revision](/browser/posti-shipping/trunk/core/class-shipping-method.php?rev=3132120 "Revision 3132120")
* [Next Revision](/browser/posti-shipping/trunk/core/class-shipping-method.php?rev=3206390 "Revision 3206390") →
* [Blame](/browser/posti-shipping/trunk/core/class-shipping-method.php?annotate=blame "Annotate each line with the last changed revision (this can be time consuming...)")
* [Revision Log](/log/posti-shipping/tags/3.10.3/core/class-shipping-method.php)

---

# [source:](/browser?order=name "Go to repository root") [posti-shipping](/browser/posti-shipping?order=name "View posti-shipping")/[tags](/browser/posti-shipping/tags?order=name "View tags")/[3.10.3](/browser/posti-shipping/tags/3.10.3?order=name "View 3.10.3")/[core](/browser/posti-shipping/tags/3.10.3/core?order=name "View core")/[class-shipping-method.php](/browser/posti-shipping/tags/3.10.3/core/class-shipping-method.php?order=name "View class-shipping-method.php")

View diff against:

View revision:

| [Last change](/changeset/3165107/posti-shipping/trunk/core/class-shipping-method.php "View differences") on this file was [3165107](/changeset/3165107/ "View changeset 3165107"), checked in by jooseposti, [3 months ago](/timeline?from=2024-10-08T15%3A48%3A16Z&precision=second "See timeline at 10/08/2024 03:48:16 PM") |
| --- |
| Update to version 3.10.2 from GitHub |
| **File size:** 31.7 KB | |

| Line |  |
| --- | --- |
| [1](#L1) | <?php |
| [2](#L2) | namespace Woo\_Pakettikauppa\_Core; |
| [3](#L3) |  |
| [4](#L4) | // Prevent direct access to the script |
| [5](#L5) | use WC\_Countries; |
| [6](#L6) |  |
| [7](#L7) | if ( ! defined('ABSPATH') ) { |
| [8](#L8) | exit; |
| [9](#L9) | } |
| [10](#L10) |  |
| [11](#L11) | if ( ! class\_exists(\_\_NAMESPACE\_\_ . '\Shipping\_Method') ) { |
| [12](#L12) | /\*\* |
| [13](#L13) | \* Shipping\_Method Class |
| [14](#L14) | \* |
| [15](#L15) | \* @class Shipping\_Method |
| [16](#L16) | \* @version  1.0.0 |
| [17](#L17) | \* @since 1.0.0 |
| [18](#L18) | \* @package  woo-pakettikauppa |
| [19](#L19) | \* @author Seravo |
| [20](#L20) | \*/ |
| [21](#L21) | class Shipping\_Method extends \WC\_Shipping\_Method { |
| [22](#L22) | /\*\* |
| [23](#L23) | \* Required to access Pakettikauppa client |
| [24](#L24) | \* @var Shipment $shipment |
| [25](#L25) | \*/ |
| [26](#L26) | private $shipment = null; |
| [27](#L27) |  |
| [28](#L28) | public $is\_loaded = false; |
| [29](#L29) |  |
| [30](#L30) | /\*\* |
| [31](#L31) | \* Constructor for Pakettikauppa shipping class |
| [32](#L32) | \* |
| [33](#L33) | \* @access public |
| [34](#L34) | \* @return void |
| [35](#L35) | \*/ |
| [36](#L36) | public function \_\_construct( $instance\_id = 0 ) { |
| [37](#L37) | parent::\_\_construct($instance\_id); |
| [38](#L38) |  |
| [39](#L39) | $this->load(); |
| [40](#L40) | } |
| [41](#L41) |  |
| [42](#L42) | public function get\_core() { |
| [43](#L43) | return \Woo\_Posti\_Shipping::get\_instance(); |
| [44](#L44) | } |
| [45](#L45) |  |
| [46](#L46) | public function load() { |
| [47](#L47) | if ( $this->is\_loaded ) { |
| [48](#L48) | return; |
| [49](#L49) | } |
| [50](#L50) |  |
| [51](#L51) | $this->id = $this->get\_core()->shippingmethod; // ID for your shipping method. Should be unique. |
| [52](#L52) | $this->method\_title = $this->get\_core()->text->shipping\_method\_name(); |
| [53](#L53) | $this->method\_description = $this->get\_core()->text->shipping\_method\_desc(); // Description shown in admin |
| [54](#L54) |  |
| [55](#L55) | $this->supports = array( |
| [56](#L56) | 'settings', |
| [57](#L57) | ); |
| [58](#L58) |  |
| [59](#L59) | $this->init(); |
| [60](#L60) |  |
| [61](#L61) | // Save settings in admin if you have any defined |
| [62](#L62) | add\_action('woocommerce\_update\_options\_shipping\_' . $this->id, array( $this, 'process\_admin\_options' )); |
| [63](#L63) |  |
| [64](#L64) | $this->is\_loaded = true; |
| [65](#L65) | } |
| [66](#L66) |  |
| [67](#L67) | /\*\* |
| [68](#L68) | \* Initialize Pakettikauppa shipping |
| [69](#L69) | \*/ |
| [70](#L70) | public function init() { |
| [71](#L71) | $this->form\_fields          = $this->my\_global\_form\_fields(); |
| [72](#L72) | $this->title                = $this->get\_option('title'); |
| [73](#L73) | } |
| [74](#L74) |  |
| [75](#L75) | public function validate\_pickuppoints\_field( $key, $value ) { |
| [76](#L76) | $values = wp\_json\_encode($value); |
| [77](#L77) | return $values; |
| [78](#L78) | } |
| [79](#L79) |  |
| [80](#L80) | public function generate\_notices\_html( $key, $value ) { |
| [81](#L81) | $settings = $this->get\_core()->shipment->get\_settings(); |
| [82](#L82) | $shipping\_method = $this->get\_core()->shippingmethod; |
| [83](#L83) | $field\_pref = 'woocommerce\_' . $shipping\_method . '\_'; |
| [84](#L84) | $configs = $this->get\_core()->api\_config; |
| [85](#L85) | if ( isset($\_POST[$field\_pref . 'mode']) ) { |
| [86](#L86) | $settings['mode'] = $\_POST[$field\_pref . 'mode']; |
| [87](#L87) | $settings['account\_number'] = $\_POST[$field\_pref . 'account\_number']; |
| [88](#L88) | $settings['secret\_key'] = $\_POST[$field\_pref . 'secret\_key']; |
| [89](#L89) | } |
| [90](#L90) | $mode = $settings['mode']; |
| [91](#L91) |  |
| [92](#L92) | ob\_start(); |
| [93](#L93) | ?> |
| [94](#L94) | <script> |
| [95](#L95) | jQuery(function( $ ) { |
| [96](#L96) | $( document ).ready(function() { |
| [97](#L97) | hide\_mode\_react(); |
| [98](#L98) |  |
| [99](#L99) | $.ajax({ |
| [100](#L100) | type: "POST", |
| [101](#L101) | url: ajaxurl, |
| [102](#L102) | data: { |
| [103](#L103) | action: 'check\_api', |
| [104](#L104) | api\_account: "<?php echo $settings['account\_number']; ?>", |
| [105](#L105) | api\_secret: "<?php echo $settings['secret\_key']; ?>" |
| [106](#L106) | }, |
| [107](#L107) | dataType: 'json' |
| [108](#L108) | }).done(function( status ) { |
| [109](#L109) | <?php if ( $mode == 'production' ) : ?> |
| [110](#L110) | hide\_mode\_react(status.api\_good); |
| [111](#L111) | if (status.api\_good) { |
| [112](#L112) | show\_api\_notice("", false); |
| [113](#L113) | } else { |
| [114](#L114) | var msg = status.msg; |
| [115](#L115) | if (status.error) { |
| [116](#L116) | msg += ".<br/><b><?php \_e('Error', 'woo-pakettikauppa'); ?>:</b> " + status.error; |
| [117](#L117) | } |
| [118](#L118) | if (status.code) { |
| [119](#L119) | msg += " <i>(<?php \_e('Code', 'woo-pakettikauppa'); ?> " + status.code + ")</i>"; |
| [120](#L120) | } |
| [121](#L121) | show\_api\_notice(msg, true); |
| [122](#L122) | } |
| [123](#L123) | <?php endif; ?> |
| [124](#L124) | }); |
| [125](#L125) |  |
| [126](#L126) | $( document ).on("change", "#woocommerce\_pakettikauppa\_shipping\_method\_mode", function() { |
| [127](#L127) | hide\_mode\_react(); |
| [128](#L128) | show\_api\_notice("", false); |
| [129](#L129) | }); |
| [130](#L130) | }); |
| [131](#L131) |  |
| [132](#L132) | function hide\_mode\_react( show = true ) { |
| [133](#L133) | if (show) { |
| [134](#L134) | $(".mode\_react").closest("tr").removeClass("row-disabled"); |
| [135](#L135) | $("h3.mode\_react").removeClass("row-disabled"); |
| [136](#L136) | } |
| [137](#L137) | else { |
| [138](#L138) | $(".mode\_react").closest("tr").addClass("row-disabled"); |
| [139](#L139) | $("h3.mode\_react").addClass("row-disabled"); |
| [140](#L140) | } |
| [141](#L141) | } |
| [142](#L142) |  |
| [143](#L143) | function show\_api\_notice(text, show = true) { |
| [144](#L144) | if (show) { |
| [145](#L145) | $("#pakettikauppa\_notices").show(); |
| [146](#L146) | $("#pakettikauppa\_notice\_api span").html(text+"."); |
| [147](#L147) | $("#pakettikauppa\_notice\_api").show(); |
| [148](#L148) | } else { |
| [149](#L149) | $("#pakettikauppa\_notices").hide(); |
| [150](#L150) | $("#pakettikauppa\_notice\_api").hide(); |
| [151](#L151) | $("#pakettikauppa\_notice\_api p").text(''); |
| [152](#L152) | } |
| [153](#L153) | } |
| [154](#L154) | }); |
| [155](#L155) | </script> |
| [156](#L156) | <tr id="pakettikauppa\_notices" style="display:none;"><td colspan="2"> |
| [157](#L157) | <div id="pakettikauppa\_notice\_api" class="pakettikauppa-notice notice-error"> |
| [158](#L158) | <p><b><?php echo strtoupper(\_\_('API error!', 'woo-pakettikauppa')); ?></b> <span></span></p> |
| [159](#L159) | </div> |
| [160](#L160) | </td></tr> |
| [161](#L161) | <?php |
| [162](#L162) | $html = ob\_get\_contents(); |
| [163](#L163) | ob\_end\_clean(); |
| [164](#L164) | return $html; |
| [165](#L165) | } |
| [166](#L166) |  |
| [167](#L167) | public function generate\_pickuppoints\_html( $key, $value ) { |
| [168](#L168) | $field\_key = $this->get\_field\_key($key); |
| [169](#L169) |  |
| [170](#L170) | if ( $this->get\_option($key) !== '' ) { |
| [171](#L171) | $values = $this->get\_option($key); |
| [172](#L172) | if ( is\_string($values) ) { |
| [173](#L173) | $values = json\_decode($this->get\_option($key), true); |
| [174](#L174) | } |
| [175](#L175) | } else { |
| [176](#L176) | $values = array(); |
| [177](#L177) | } |
| [178](#L178) |  |
| [179](#L179) | $all\_shipping\_methods = $this->get\_core()->shipment->services(); |
| [180](#L180) | if ( empty($all\_shipping\_methods) ) { |
| [181](#L181) | $all\_shipping\_methods = array(); |
| [182](#L182) | } |
| [183](#L183) |  |
| [184](#L184) | $methods = $this->get\_core()->shipment->get\_pickup\_point\_methods(); |
| [185](#L185) |  |
| [186](#L186) | ob\_start(); |
| [187](#L187) | ?> |
| [188](#L188) | <script> |
| [189](#L189) | function pkSetInputs(parent, disabled) { |
| [190](#L190) | var inputs = parent.querySelectorAll('input'); |
| [191](#L191) | for(var j=0; j<inputs.length; ++j) { |
| [192](#L192) | if (disabled){ |
| [193](#L193) | inputs[j].setAttribute('disabled', disabled); |
| [194](#L194) | } else { |
| [195](#L195) | inputs[j].removeAttribute('disabled'); |
| [196](#L196) | } |
| [197](#L197) | } |
| [198](#L198) | } |
| [199](#L199) |  |
| [200](#L200) | function pkChangeOptions(elem, methodId) { |
| [201](#L201) |  |
| [202](#L202) | var strUser = elem.options[elem.selectedIndex].value; |
| [203](#L203) | var elements = document.getElementsByClassName('pk-services-' + methodId); |
| [204](#L204) |  |
| [205](#L205) | var servicesElement = document.getElementById('services-' + methodId + '-' + strUser); |
| [206](#L206) | var pickuppointsElement = document.getElementById('pickuppoints-' + methodId); |
| [207](#L207) | var servicePickuppointsElement = document.getElementById('service-' + methodId + '-' + strUser + '-pickuppoints'); |
| [208](#L208) |  |
| [209](#L209) | for(var i=0; i<elements.length; ++i) { |
| [210](#L210) | elements[i].style.display = "none"; |
| [211](#L211) | pkSetInputs(elements[i], true); |
| [212](#L212) | } |
| [213](#L213) |  |
| [214](#L214) |  |
| [215](#L215) |  |
| [216](#L216) | if (strUser == '\_\_PICKUPPOINTS\_\_') { |
| [217](#L217) | if (pickuppointsElement) { |
| [218](#L218) | pickuppointsElement.style.display = "block"; |
| [219](#L219) | pkSetInputs(pickuppointsElement, false); |
| [220](#L220) | } |
| [221](#L221) | if (servicesElement) { |
| [222](#L222) | servicesElement.style.display = "none"; |
| [223](#L223) | pkSetInputs(servicesElement, true); |
| [224](#L224) | } |
| [225](#L225) | } else { |
| [226](#L226) | if (pickuppointsElement) { |
| [227](#L227) | pickuppointsElement.style.display = "none"; |
| [228](#L228) | pkSetInputs(pickuppointsElement, true); |
| [229](#L229) | } |
| [230](#L230) | if (servicesElement) { |
| [231](#L231) | servicesElement.style.display = "block"; |
| [232](#L232) | pkSetInputs(servicesElement, false); |
| [233](#L233) | } |
| [234](#L234) | if (elem.options[elem.selectedIndex].getAttribute('data-haspp') == 'true') { |
| [235](#L235) | servicePickuppointsElement.style.display = "block"; |
| [236](#L236) | pkSetInputs(servicePickuppointsElement, false); |
| [237](#L237) | } |
| [238](#L238) | } |
| [239](#L239) | } |
| [240](#L240) | </script> |
| [241](#L241) | <tr> |
| [242](#L242) | <th colspan="2" class="titledesc mode\_react" scope="row"><?php echo esc\_html($value['title']); ?></th> |
| [243](#L243) | </tr> |
| [244](#L244) | <tr> |
| [245](#L245) | <td colspan="2" class="mode\_react"> |
| [246](#L246) | <?php foreach ( \WC\_Shipping\_Zones::get\_zones('admin') as $zone\_raw ) : ?> |
| [247](#L247) | <hr> |
| [248](#L248) | <?php $zone = new \WC\_Shipping\_Zone($zone\_raw['zone\_id']); ?> |
| [249](#L249) | <h3> |
| [250](#L250) | <?php esc\_html\_e('Zone name', 'woocommerce'); ?>: <?php echo $zone->get\_zone\_name(); ?> |
| [251](#L251) | </h3> |
| [252](#L252) | <p> |
| [253](#L253) | <?php esc\_html\_e('Zone regions', 'woocommerce'); ?>: <?php echo $zone->get\_formatted\_location(); ?> |
| [254](#L254) | </p> |
| [255](#L255) | <h4><?php esc\_html\_e('Shipping method(s)', 'woocommerce'); ?></h4> |
| [256](#L256) | <?php foreach ( $zone->get\_shipping\_methods() as $method\_id => $shipping\_method ) : ?> |
| [257](#L257) | <?php if ( $shipping\_method->enabled === 'yes' && $shipping\_method->id !== $this->get\_core()->shippingmethod && $shipping\_method->id !== 'local\_pickup' ) : ?> |
| [258](#L258) | <?php |
| [259](#L259) | $selected\_service = null; |
| [260](#L260) | if ( ! empty($values[ $method\_id ]['service']) ) { |
| [261](#L261) | $selected\_service = $values[ $method\_id ]['service']; |
| [262](#L262) | } |
| [263](#L263) | if ( empty($selected\_service) && ! empty($methods) && isset($values[$method\_id]) ) { |
| [264](#L264) | $selected\_service = '\_\_PICKUPPOINTS\_\_'; |
| [265](#L265) | } |
| [266](#L266) | ?> |
| [267](#L267) | <table style="border-collapse: collapse;" border="0"> |
| [268](#L268) | <th><?php echo $shipping\_method->title; ?></th> |
| [269](#L269) | <td style="vertical-align: top;"> |
| [270](#L270) | <select id="<?php echo $method\_id; ?>-select" name="<?php echo esc\_html($field\_key) . '[' . esc\_attr($method\_id) . '][service]'; ?>" onchange="pkChangeOptions(this, '<?php echo $method\_id; ?>');"> |
| [271](#L271) | <option value="\_\_NULL\_\_"><?php echo $this->get\_core()->text->no\_shipping(); ?></option> |
| [272](#L272) | <?php if ( ! empty($methods) ) : ?> |
| [273](#L273) | <option value="\_\_PICKUPPOINTS\_\_" <?php echo ($selected\_service === '\_\_PICKUPPOINTS\_\_' ? 'selected' : ''); ?>>Noutopisteet</option> |
| [274](#L274) | <?php endif; ?> |
| [275](#L275) | <?php foreach ( $all\_shipping\_methods as $service\_id => $service\_name ) : ?> |
| [276](#L276) | <?php $has\_pp = ($this->get\_core()->shipment->service\_has\_pickup\_points($service\_id)) ? true : false; ?> |
| [277](#L277) | <option value="<?php echo $service\_id; ?>" <?php echo (strval($selected\_service) === strval($service\_id) ? 'selected' : ''); ?> data-haspp="<?php echo ($has\_pp) ? 'true' : 'false'; ?>"> |
| [278](#L278) | <?php echo $service\_name; ?> |
| [279](#L279) | <?php if ( $has\_pp ) : ?> |
| [280](#L280) | (<?php echo $this->get\_core()->text->includes\_pickup\_points(); ?>) |
| [281](#L281) | <?php endif; ?> |
| [282](#L282) | </option> |
| [283](#L283) | <?php endforeach; ?> |
| [284](#L284) | </select> |
| [285](#L285) | </td> |
| [286](#L286) | <td style="vertical-align: top;"> |
| [287](#L287) | <div style='display: none;' id="pickuppoints-<?php echo $method\_id; ?>"> |
| [288](#L288) | <?php foreach ( $methods as $method\_code => $method\_name ) : ?> |
| [289](#L289) | <input type="hidden" |
| [290](#L290) | name="<?php echo esc\_html($field\_key) . '[' . esc\_attr($method\_id) . '][' . $method\_code . '][active]'; ?>" |
| [291](#L291) | value="no"> |
| [292](#L292) | <p> |
| [293](#L293) | <label> |
| [294](#L294) | <input type="checkbox" |
| [295](#L295) | name="<?php echo esc\_html($field\_key) . '[' . esc\_attr($method\_id) . '][' . $method\_code . '][active]'; ?>" |
| [296](#L296) | value="yes" <?php echo (! empty($values[ $method\_id ][ $method\_code ]['active']) && $values[ $method\_id ][ $method\_code ]['active'] === 'yes') ? 'checked' : ''; ?>> |
| [297](#L297) | <?php echo $method\_name; ?> |
| [298](#L298) | </label> |
| [299](#L299) | </p> |
| [300](#L300) | <?php endforeach; ?> |
| [301](#L301) | </div> |
| [302](#L302) |  |
| [303](#L303) | <?php |
| [304](#L304) | $all\_additional\_services = $this->get\_core()->shipment->get\_additional\_services(); |
| [305](#L305) | if ( empty($all\_additional\_services) ) { |
| [306](#L306) | $all\_additional\_services = array(); |
| [307](#L307) | } |
| [308](#L308) | ?> |
| [309](#L309) | <?php foreach ( $all\_additional\_services as $method\_code => $additional\_services ) : ?> |
| [310](#L310) | <div class="pk-services-<?php echo $method\_id; ?>" style='display: none;' id="services-<?php echo $method\_id; ?>-<?php echo $method\_code; ?>"> |
| [311](#L311) | <?php foreach ( $additional\_services as $additional\_service ) : ?> |
| [312](#L312) | <?php if ( empty($additional\_service->specifiers) || in\_array($additional\_service->service\_code, array( '3102' ), true) ) : ?> |
| [313](#L313) | <input type="hidden" |
| [314](#L314) | name="<?php echo esc\_html($field\_key) . '[' . esc\_attr($method\_id) . '][' . esc\_attr($method\_code) . '][additional\_services][' . $additional\_service->service\_code . ']'; ?>" |
| [315](#L315) | value="no"> |
| [316](#L316) | <p> |
| [317](#L317) | <label> |
| [318](#L318) | <input type="checkbox" |
| [319](#L319) | name="<?php echo esc\_html($field\_key) . '[' . esc\_attr($method\_id) . '][' . esc\_attr($method\_code) . '][additional\_services][' . $additional\_service->service\_code . ']'; ?>" |
| [320](#L320) | value="yes" <?php echo (! empty($values[ $method\_id ][ $method\_code ]['additional\_services'][ $additional\_service->service\_code ]) && $values[ $method\_id ][ $method\_code ]['additional\_services'][ $additional\_service->service\_code ] === 'yes') ? 'checked' : ''; ?>> |
| [321](#L321) | <?php echo $additional\_service->name; ?> |
| [322](#L322) | </label> |
| [323](#L323) | </p> |
| [324](#L324) | <?php endif; ?> |
| [325](#L325) | <?php endforeach; ?> |
| [326](#L326) | <input type="hidden" |
| [327](#L327) | name="<?php echo esc\_html($field\_key) . '[' . esc\_attr($method\_id) . '][' . esc\_attr($method\_code) . '][additional\_services][return\_label]'; ?>" |
| [328](#L328) | value="no"> |
| [329](#L329) | <p> |
| [330](#L330) | <label> |
| [331](#L331) | <input type="checkbox" |
| [332](#L332) | name="<?php echo esc\_html($field\_key) . '[' . esc\_attr($method\_id) . '][' . esc\_attr($method\_code) . '][additional\_services][return\_label]'; ?>" |
| [333](#L333) | value="yes" <?php echo (! empty($values[ $method\_id ][ $method\_code ]['additional\_services']['return\_label']) && $values[ $method\_id ][ $method\_code ]['additional\_services']['return\_label'] === 'yes') ? 'checked' : ''; ?>> |
| [334](#L334) | <?php echo \_\_('Include return label (if available)', 'woo-pakettikauppa'); ?> |
| [335](#L335) | </label> |
| [336](#L336) | </p> |
| [337](#L337) | </div> |
| [338](#L338) | <?php endforeach; ?> |
| [339](#L339) | <?php foreach ( $all\_shipping\_methods as $service\_id => $service\_name ) : ?> |
| [340](#L340) | <?php if ( $this->get\_core()->shipment->service\_has\_pickup\_points($service\_id) ) : ?> |
| [341](#L341) | <div id="service-<?php echo $method\_id; ?>-<?php echo $service\_id; ?>-pickuppoints" class="pk-services-<?php echo $method\_id; ?>" style="display: none;"> |
| [342](#L342) | <input type="hidden" |
| [343](#L343) | name="<?php echo esc\_html($field\_key) . '[' . esc\_attr($method\_id) . '][' . esc\_attr($service\_id) . '][pickuppoints]'; ?>" value="no"> |
| [344](#L344) | <p> |
| [345](#L345) | <label> |
| [346](#L346) | <input type="checkbox" |
| [347](#L347) | name="<?php echo esc\_html($field\_key) . '[' . esc\_attr($method\_id) . '][' . esc\_attr($service\_id) . '][pickuppoints]'; ?>" |
| [348](#L348) | value="yes" <?php echo ((! empty($values[ $method\_id ][ $service\_id ]['pickuppoints']) && $values[ $method\_id ][ $service\_id ]['pickuppoints'] === 'yes') || empty($values[ $method\_id ][ $service\_id ]['pickuppoints'])) ? 'checked' : ''; ?>> |
| [349](#L349) | <?php echo \_\_('Pickup points', 'woo-pakettikauppa'); ?> |
| [350](#L350) | </label> |
| [351](#L351) | </p> |
| [352](#L352) | </div> |
| [353](#L353) | <?php endif; ?> |
| [354](#L354) | <?php endforeach; ?> |
| [355](#L355) | </td> |
| [356](#L356) | </table> |
| [357](#L357) | <script>pkChangeOptions(document.getElementById("<?php echo $method\_id; ?>-select"), '<?php echo $method\_id; ?>');</script> |
| [358](#L358) | <?php endif; ?> |
| [359](#L359) | <?php endforeach; ?> |
| [360](#L360) | <?php endforeach; ?> |
| [361](#L361) | <hr> |
| [362](#L362) |  |
| [363](#L363) | </td> |
| [364](#L364) | </tr> |
| [365](#L365) |  |
| [366](#L366) | <?php |
| [367](#L367) | $html = ob\_get\_contents(); |
| [368](#L368) | ob\_end\_clean(); |
| [369](#L369) | return $html; |
| [370](#L370) | } |
| [371](#L371) |  |
| [372](#L372) | public function generate\_enchancedtextarea\_html( $key, $value ) { |
| [373](#L373) | $field\_key = $this->get\_field\_key($key); |
| [374](#L374) | $field\_value = $this->get\_option($key); |
| [375](#L375) |  |
| [376](#L376) | ob\_start(); |
| [377](#L377) | ?> |
| [378](#L378) |  |
| [379](#L379) | <tr valign="top" class="pakettikauppa-setting"> |
| [380](#L380) | <th scope="row" class="titledesc"> |
| [381](#L381) | <label for="<?php echo $field\_key; ?>"><?php echo esc\_html($value['title']); ?></label> |
| [382](#L382) | </th> |
| [383](#L383) | <td class="forminp"> |
| [384](#L384) | <fieldset> |
| [385](#L385) | <legend class="screen-reader-text"><span><?php echo esc\_html($value['title']); ?></span></legend> |
| [386](#L386) | <textarea rows="3" cols="20" class="input-text wide-input " type="textarea" name="<?php echo $field\_key; ?>" id="<?php echo $field\_key; ?>" style="" placeholder=""><?php echo esc\_html($field\_value); ?></textarea> |
| [387](#L387) | <?php if ( ! empty($value['available\_params']) && is\_array($value['available\_params']) ) : ?> |
| [388](#L388) | <?php foreach ( $value['available\_params'] as $param\_key => $param\_desc ) : ?> |
| [389](#L389) | <p class="description enchtext noselect"> |
| [390](#L390) | <code class="enchtext-code" data-param="<?php echo esc\_html($param\_key); ?>" onclick="click\_enchancedtextarea\_code('<?php echo $field\_key; ?>', '<?php echo esc\_html($param\_key); ?>');">{<?php echo esc\_html($param\_key); ?>}</code> - <?php echo esc\_html($param\_desc); ?> |
| [391](#L391) | </p> |
| [392](#L392) | <?php endforeach; ?> |
| [393](#L393) | <?php endif; ?> |
| [394](#L394) | <?php if ( ! empty($value['description']) ) : ?> |
| [395](#L395) | <p class="description"><?php echo $value['description']; ?></p> |
| [396](#L396) | <?php endif; ?> |
| [397](#L397) | </fieldset> |
| [398](#L398) | </td> |
| [399](#L399) | </tr> |
| [400](#L400) |  |
| [401](#L401) | <?php |
| [402](#L402) | $html = ob\_get\_contents(); |
| [403](#L403) | ob\_end\_clean(); |
| [404](#L404) | return $html; |
| [405](#L405) | } |
| [406](#L406) |  |
| [407](#L407) | public function generate\_button\_html( $key, $value ) { |
| [408](#L408) | $field\_key = $this->get\_field\_key($key); |
| [409](#L409) | ob\_start(); |
| [410](#L410) | ?> |
| [411](#L411) | <tr valign="top" class="pakettikauppa-setting"> |
| [412](#L412) | <th scope="row" class="titledesc"> |
| [413](#L413) | <label for="<?php echo $field\_key; ?>"><?php echo esc\_html($value['title']); ?></label> |
| [414](#L414) | </th> |
| [415](#L415) | <td class="forminp"> |
| [416](#L416) | <fieldset> |
| [417](#L417) | <a class="button button-primary" href="<?php echo $value['url']; ?>"> |
| [418](#L418) | <?php echo $value['text']; ?> |
| [419](#L419) | </a> |
| [420](#L420) | </fieldset> |
| [421](#L421) | </td> |
| [422](#L422) | </tr> |
| [423](#L423) | <?php |
| [424](#L424) | $html = ob\_get\_contents(); |
| [425](#L425) | ob\_end\_clean(); |
| [426](#L426) | return $html; |
| [427](#L427) | } |
| [428](#L428) |  |
| [429](#L429) | protected function get\_form\_field\_mode() { |
| [430](#L430) | return array( |
| [431](#L431) | 'type'    => 'hidden', |
| [432](#L432) | 'default' => 'production', |
| [433](#L433) | ); |
| [434](#L434) | } |
| [435](#L435) |  |
| [436](#L436) | public function generate\_hidden\_html( $key, $args ) |
| [437](#L437) | { |
| [438](#L438) | $field\_key = $this->get\_field\_key($key); |
| [439](#L439) |  |
| [440](#L440) | return '<input type="hidden" name="' . esc\_html($field\_key) . '" value="' . esc\_attr($args['default']) . '" />'; |
| [441](#L441) | } |
| [442](#L442) |  |
| [443](#L443) | private function my\_global\_form\_fields() { |
| [444](#L444) | $wc\_countries = new WC\_Countries(); |
| [445](#L445) |  |
| [446](#L446) | $fields = array( |
| [447](#L447) | 'notices'    => array( |
| [448](#L448) | 'type'     => 'notices', |
| [449](#L449) | ), |
| [450](#L450) |  |
| [451](#L451) | array( |
| [452](#L452) | 'title' => '', |
| [453](#L453) | 'type'  => 'title', |
| [454](#L454) | 'class' => 'hidden', |
| [455](#L455) | ), |
| [456](#L456) |  |
| [457](#L457) | 'mode'                       => $this->get\_form\_field\_mode(), |
| [458](#L458) |  |
| [459](#L459) | 'account\_number'             => array( |
| [460](#L460) | 'title'    => $this->get\_core()->text->api\_key\_title(), |
| [461](#L461) | 'desc'     => $this->get\_core()->text->api\_key\_desc($this->get\_core()->vendor\_name), |
| [462](#L462) | 'type'     => 'text', |
| [463](#L463) | 'default'  => '', |
| [464](#L464) | 'desc\_tip' => true, |
| [465](#L465) | ), |
| [466](#L466) |  |
| [467](#L467) | 'secret\_key'                 => array( |
| [468](#L468) | 'title'    => $this->get\_core()->text->api\_secret\_title(), |
| [469](#L469) | 'desc'     => $this->get\_core()->text->api\_secret\_desc($this->get\_core()->vendor\_name), |
| [470](#L470) | 'type'     => 'password', |
| [471](#L471) | 'default'  => '', |
| [472](#L472) | 'desc\_tip' => true, |
| [473](#L473) | ), |
| [474](#L474) |  |
| [475](#L475) | 'order\_pickup'              => array( |
| [476](#L476) | 'title' => $this->get\_core()->text->order\_pickup\_title(), |
| [477](#L477) | 'type'  => 'title', |
| [478](#L478) | ), |
| [479](#L479) |  |
| [480](#L480) | 'order\_pickup\_customer\_id'                 => array( |
| [481](#L481) | 'title'    => $this->get\_core()->text->customer\_id\_title(), |
| [482](#L482) | 'desc'     => '', |
| [483](#L483) | 'type'     => 'text', |
| [484](#L484) | 'default'  => '', |
| [485](#L485) | 'desc\_tip' => true, |
| [486](#L486) | ), |
| [487](#L487) |  |
| [488](#L488) | 'order\_pickup\_invoice\_id'                 => array( |
| [489](#L489) | 'title'    => $this->get\_core()->text->invoice\_id\_title(), |
| [490](#L490) | 'desc'     => '', |
| [491](#L491) | 'type'     => 'text', |
| [492](#L492) | 'default'  => '', |
| [493](#L493) | 'desc\_tip' => true, |
| [494](#L494) | ), |
| [495](#L495) |  |
| [496](#L496) | 'order\_pickup\_sender\_id'                 => array( |
| [497](#L497) | 'title'    => $this->get\_core()->text->sender\_id\_title(), |
| [498](#L498) | 'desc'     => '', |
| [499](#L499) | 'type'     => 'text', |
| [500](#L500) | 'default'  => '', |
| [501](#L501) | 'desc\_tip' => true, |
| [502](#L502) | ), |
| [503](#L503) |  |
| [504](#L504) | 'pickup\_points'              => array( |
| [505](#L505) | 'title' => $this->get\_core()->text->pickup\_points\_title(), |
| [506](#L506) | 'type'  => 'pickuppoints', |
| [507](#L507) | ), |
| [508](#L508) |  |
| [509](#L509) | array( |
| [510](#L510) | 'title'       => $this->get\_core()->text->shipping\_settings\_title(), |
| [511](#L511) | 'type'        => 'title', |
| [512](#L512) | /\* translators: %s: url to documentation \*/ |
| [513](#L513) | 'description' => $this->get\_core()->text->shipping\_settings\_desc(), |
| [514](#L514) | ), |
| [515](#L515) |  |
| [516](#L516) | 'add\_tracking\_to\_email'      => array( |
| [517](#L517) | 'title'   => $this->get\_core()->text->add\_tracking\_link\_to\_email(), |
| [518](#L518) | 'type'    => 'checkbox', |
| [519](#L519) | 'default' => 'yes', |
| [520](#L520) | 'class'   => 'mode\_react', |
| [521](#L521) | ), |
| [522](#L522) |  |
| [523](#L523) | 'add\_pickup\_point\_to\_email'      => array( |
| [524](#L524) | 'title'   => $this->get\_core()->text->add\_pickup\_point\_to\_email(), |
| [525](#L525) | 'type'    => 'checkbox', |
| [526](#L526) | 'default' => 'yes', |
| [527](#L527) | 'class'   => 'mode\_react', |
| [528](#L528) | ), |
| [529](#L529) |  |
| [530](#L530) | 'ignore\_product\_weight'      => array( |
| [531](#L531) | 'title'   => $this->get\_core()->text->ignore\_product\_weight(), |
| [532](#L532) | 'type'    => 'checkbox', |
| [533](#L533) | 'default' => 'no', |
| [534](#L534) | 'class'   => 'mode\_react', |
| [535](#L535) | ), |
| [536](#L536) |  |
| [537](#L537) | 'change\_order\_status\_to'      => array( |
| [538](#L538) | 'title'   => $this->get\_core()->text->change\_order\_status\_to(), |
| [539](#L539) | 'type'    => 'select', |
| [540](#L540) | 'default' => '', |
| [541](#L541) | 'options' => array( |
| [542](#L542) | '' => $this->get\_core()->text->no\_order\_status\_change(), |
| [543](#L543) | 'completed'  => \_\_('Completed', 'woocommerce'), |
| [544](#L544) | 'processing' => \_\_('Processing', 'woocommerce'), |
| [545](#L545) | ), |
| [546](#L546) | 'class'   => 'mode\_react', |
| [547](#L547) | ), |
| [548](#L548) |  |
| [549](#L549) | 'translate\_products\_in\_labels'      => array( |
| [550](#L550) | 'title'   => $this->get\_core()->text->translate\_products\_in\_labels\_title(), |
| [551](#L551) | 'type'    => 'checkbox', |
| [552](#L552) | 'default' => 'no', |
| [553](#L553) | 'description' => $this->get\_core()->text->translate\_products\_in\_labels\_desc(), |
| [554](#L554) | 'desc\_tip'    => true, |
| [555](#L555) | 'class'   => 'mode\_react', |
| [556](#L556) | ), |
| [557](#L557) |  |
| [558](#L558) | 'create\_shipments\_automatically'     => array( |
| [559](#L559) | 'title'   => $this->get\_core()->text->create\_shipments\_automatically(), |
| [560](#L560) | 'type'    => 'select', |
| [561](#L561) | 'default' => 'no', |
| [562](#L562) | 'options' => array( |
| [563](#L563) | 'no'  => $this->get\_core()->text->no\_automatic\_creation\_of\_labels(), |
| [564](#L564) | /\* translators: %s: order status \*/ |
| [565](#L565) | 'completed'  => $this->get\_core()->text->when\_order\_status\_is(\_\_('Completed', 'woocommerce')), |
| [566](#L566) | /\* translators: %s: order status \*/ |
| [567](#L567) | 'processing' => $this->get\_core()->text->when\_order\_status\_is(\_\_('Processing', 'woocommerce')), |
| [568](#L568) | ), |
| [569](#L569) | 'class'   => 'mode\_react', |
| [570](#L570) | ), |
| [571](#L571) |  |
| [572](#L572) | 'labels\_size'     => array( |
| [573](#L573) | 'title'   => $this->get\_core()->text->labels\_size\_title(), |
| [574](#L574) | 'type'    => 'select', |
| [575](#L575) | 'default' => 'menu', |
| [576](#L576) | 'options' => array( |
| [577](#L577) | 'A5'  => 'A5', |
| [578](#L578) | '107x225'  => '107x225', |
| [579](#L579) | ), |
| [580](#L580) | 'class'   => 'mode\_react', |
| [581](#L581) | ), |
| [582](#L582) |  |
| [583](#L583) | 'download\_type\_of\_labels'     => array( |
| [584](#L584) | 'title'   => $this->get\_core()->text->download\_type\_of\_labels\_title(), |
| [585](#L585) | 'type'    => 'select', |
| [586](#L586) | 'default' => 'menu', |
| [587](#L587) | 'options' => array( |
| [588](#L588) | 'browser'  => $this->get\_core()->text->download\_type\_of\_labels\_option\_browser(), |
| [589](#L589) | 'download'  => $this->get\_core()->text->download\_type\_of\_labels\_option\_download(), |
| [590](#L590) | ), |
| [591](#L591) | 'class'   => 'mode\_react', |
| [592](#L592) | ), |
| [593](#L593) |  |
| [594](#L594) | 'post\_label\_to\_url' => array( |
| [595](#L595) | 'title'   => $this->get\_core()->text->post\_shipping\_label\_to\_url\_title(), |
| [596](#L596) | 'type'    => 'text', |
| [597](#L597) | 'default' => '', |
| [598](#L598) | 'description' => $this->get\_core()->text->post\_shipping\_label\_to\_url\_desc(), |
| [599](#L599) | 'desc\_tip'    => true, |
| [600](#L600) | 'class'   => 'mode\_react', |
| [601](#L601) | ), |
| [602](#L602) |  |
| [603](#L603) | array( |
| [604](#L604) | 'title' => $this->get\_core()->text->checkout\_settings(), |
| [605](#L605) | 'type'  => 'title', |
| [606](#L606) | ), |
| [607](#L607) |  |
| [608](#L608) | 'field\_phone\_required' => array( |
| [609](#L609) | 'title'   => $this->get\_core()->text->field\_phone\_required(), |
| [610](#L610) | 'type'    => 'select', |
| [611](#L611) | 'default' => 'no', |
| [612](#L612) | 'options' => array( |
| [613](#L613) | 'no'  => \_\_('No'), |
| [614](#L614) | 'yes'  => \_\_('Yes'), |
| [615](#L615) | ), |
| [616](#L616) | ), |
| [617](#L617) |  |
| [618](#L618) | 'pickup\_points\_type' => array( |
| [619](#L619) | 'title' => $this->get\_core()->text->pickup\_points\_type\_title(), |
| [620](#L620) | 'type' => 'multiselect', |
| [621](#L621) | 'options' => array( |
| [622](#L622) | 'all' => $this->get\_core()->text->pickup\_points\_type\_all(), |
| [623](#L623) | 'PRIVATE\_LOCKER' => $this->get\_core()->text->pickup\_points\_type\_private\_locker(), |
| [624](#L624) | 'OUTDOOR\_LOCKER' => $this->get\_core()->text->pickup\_points\_type\_outdoor\_locker(), |
| [625](#L625) | 'PARCEL\_LOCKER' => $this->get\_core()->text->pickup\_points\_type\_parcel\_locker(), |
| [626](#L626) | 'PICKUP\_POINT,AGENCY' => $this->get\_core()->text->pickup\_points\_type\_pickup\_point(), |
| [627](#L627) | ), |
| [628](#L628) | 'default' => 'all', |
| [629](#L629) | 'description' => $this->get\_core()->text->pickup\_points\_type\_desc(), |
| [630](#L630) | 'desc\_tip'    => true, |
| [631](#L631) | ), |
| [632](#L632) |  |
| [633](#L633) | 'pickup\_points\_search\_limit' => array( |
| [634](#L634) | 'title'       => $this->get\_core()->text->pickup\_points\_search\_limit\_title(), |
| [635](#L635) | 'type'        => 'number', |
| [636](#L636) | 'default'     => 5, |
| [637](#L637) | 'description' => $this->get\_core()->text->pickup\_points\_search\_limit\_desc(), |
| [638](#L638) | 'desc\_tip'    => true, |
| [639](#L639) | 'class'   => 'mode\_react', |
| [640](#L640) | ), |
| [641](#L641) |  |
| [642](#L642) | 'pickup\_point\_list\_type'     => array( |
| [643](#L643) | 'title'   => $this->get\_core()->text->pickup\_point\_list\_type\_title(), |
| [644](#L644) | 'type'    => 'select', |
| [645](#L645) | 'default' => 'menu', |
| [646](#L646) | 'options' => array( |
| [647](#L647) | 'menu'  => $this->get\_core()->text->pickup\_point\_list\_type\_option\_menu(), |
| [648](#L648) | 'list'  => $this->get\_core()->text->pickup\_point\_list\_type\_option\_list(), |
| [649](#L649) | ), |
| [650](#L650) | 'class'   => 'mode\_react', |
| [651](#L651) | ), |
| [652](#L652) | 'show\_pickup\_point\_override\_query' => array( |
| [653](#L653) | 'title'   => $this->get\_core()->text->show\_pickup\_point\_override\_query(), |
| [654](#L654) | 'type'    => 'select', |
| [655](#L655) | 'default' => 'yes', |
| [656](#L656) | 'options' => array( |
| [657](#L657) | 'no'  => \_\_('No'), |
| [658](#L658) | 'yes'  => \_\_('Yes'), |
| [659](#L659) | ), |
| [660](#L660) | 'description' => $this->get\_core()->text->pickup\_points\_override\_query\_desc(), |
| [661](#L661) | 'desc\_tip'    => true, |
| [662](#L662) | ), |
| [663](#L663) |  |
| [664](#L664) | array( |
| [665](#L665) | 'title' => $this->get\_core()->text->store\_owner\_information(), |
| [666](#L666) | 'type'  => 'title', |
| [667](#L667) | ), |
| [668](#L668) |  |
| [669](#L669) | 'sender\_name'                => array( |
| [670](#L670) | 'title'   => $this->get\_core()->text->sender\_name(), |
| [671](#L671) | 'type'    => 'text', |
| [672](#L672) | 'default' => get\_bloginfo('name'), |
| [673](#L673) | ), |
| [674](#L674) |  |
| [675](#L675) | 'sender\_address'             => array( |
| [676](#L676) | 'title'   => $this->get\_core()->text->sender\_address(), |
| [677](#L677) | 'type'    => 'text', |
| [678](#L678) | 'default' => WC()->countries->get\_base\_address(), |
| [679](#L679) | ), |
| [680](#L680) |  |
| [681](#L681) | 'sender\_postal\_code'         => array( |
| [682](#L682) | 'title'   => $this->get\_core()->text->sender\_postal\_code(), |
| [683](#L683) | 'type'    => 'text', |
| [684](#L684) | 'default' => WC()->countries->get\_base\_postcode(), |
| [685](#L685) | ), |
| [686](#L686) |  |
| [687](#L687) | 'sender\_city'                => array( |
| [688](#L688) | 'title'   => $this->get\_core()->text->sender\_city(), |
| [689](#L689) | 'type'    => 'text', |
| [690](#L690) | 'default' => WC()->countries->get\_base\_city(), |
| [691](#L691) | ), |
| [692](#L692) |  |
| [693](#L693) | 'sender\_country'                => array( |
| [694](#L694) | 'title'   => $this->get\_core()->text->sender\_country(), |
| [695](#L695) | 'type'    => 'select', |
| [696](#L696) | 'default' => WC()->countries->get\_base\_country(), |
| [697](#L697) | 'options'   => $wc\_countries->get\_countries(), |
| [698](#L698) | ), |
| [699](#L699) |  |
| [700](#L700) | 'sender\_phone'                => array( |
| [701](#L701) | 'title'   => $this->get\_core()->text->sender\_phone(), |
| [702](#L702) | 'type'    => 'text', |
| [703](#L703) | ), |
| [704](#L704) |  |
| [705](#L705) | 'sender\_email'                => array( |
| [706](#L706) | 'title'   => $this->get\_core()->text->sender\_email(), |
| [707](#L707) | 'type'    => 'email', |
| [708](#L708) | ), |
| [709](#L709) |  |
| [710](#L710) | 'info\_code'                  => array( |
| [711](#L711) | 'title'   => $this->get\_core()->text->info\_code(), |
| [712](#L712) | 'type'    => 'text', |
| [713](#L713) | 'default' => '', |
| [714](#L714) | ), |
| [715](#L715) | 'cod\_title' => array( |
| [716](#L716) | 'title' => $this->get\_core()->text->cod\_settings(), |
| [717](#L717) | 'type'  => 'title', |
| [718](#L718) | ), |
| [719](#L719) | 'cod\_iban'                   => array( |
| [720](#L720) | 'title'   => $this->get\_core()->text->cod\_iban(), |
| [721](#L721) | 'type'    => 'text', |
| [722](#L722) | 'default' => '', |
| [723](#L723) | ), |
| [724](#L724) | 'cod\_bic'                    => array( |
| [725](#L725) | 'title'   => $this->get\_core()->text->cod\_bic(), |
| [726](#L726) | 'type'    => 'text', |
| [727](#L727) | 'default' => '', |
| [728](#L728) | ), |
| [729](#L729) | array( |
| [730](#L730) | 'title' => $this->get\_core()->text->advanced\_settings(), |
| [731](#L731) | 'type'  => 'title', |
| [732](#L732) | ), |
| [733](#L733) | 'label\_additional\_info' => array( |
| [734](#L734) | 'title'   => $this->get\_core()->text->additional\_info\_param\_title(), |
| [735](#L735) | 'type'    => 'enchancedtextarea', |
| [736](#L736) | 'description' => '', |
| [737](#L737) | 'available\_params' => array( |
| [738](#L738) | 'ORDER\_NUMBER' => $this->get\_core()->text->additional\_info\_param\_order\_number(), |
| [739](#L739) | 'ORDER\_NOTE' => $this->get\_core()->text->additional\_info\_param\_order\_note(), |
| [740](#L740) | 'PRODUCTS\_NAMES' => $this->get\_core()->text->additional\_info\_param\_products\_names(), |
| [741](#L741) | 'PRODUCTS\_NAME\_WITH\_QUANTITY' => $this->get\_core()->text->additional\_info\_param\_products\_names\_with\_qty(), |
| [742](#L742) | 'PRODUCTS\_SKU' => $this->get\_core()->text->additional\_info\_param\_products\_sku(), |
| [743](#L743) | ), |
| [744](#L744) | ), |
| [745](#L745) | ); |
| [746](#L746) | //unset order pickup settings if feature is disabled |
| [747](#L747) | if ( ! $this->get\_core()->order\_pickup ) { |
| [748](#L748) | unset($fields['order\_pickup']); |
| [749](#L749) | unset($fields['order\_pickup\_customer\_id']); |
| [750](#L750) | unset($fields['order\_pickup\_invoice\_id']); |
| [751](#L751) | unset($fields['order\_pickup\_sender\_id']); |
| [752](#L752) | } |
| [753](#L753) | if ( get\_option($this->get\_core()->prefix . '\_wizard\_done') == 1 ) { |
| [754](#L754) | $fields['setup\_wizard'] = array( |
| [755](#L755) | 'title'   => $this->get\_core()->text->setup\_wizard(), |
| [756](#L756) | 'type'    => 'button', |
| [757](#L757) | 'url'     => esc\_url(admin\_url('admin.php?page=' . $this->get\_core()->setup\_page)), |
| [758](#L758) | 'text'    => $this->get\_core()->text->restart\_setup\_wizard(), |
| [759](#L759) | ); |
| [760](#L760) | } |
| [761](#L761) | return $fields; |
| [762](#L762) | } |
| [763](#L763) |  |
| [764](#L764) | public function process\_admin\_options() { |
| [765](#L765) | delete\_transient($this->get\_core()->prefix . '\_shipping\_methods'); |
| [766](#L766) | update\_option($this->get\_core()->prefix . '\_wizard\_done', 1); |
| [767](#L767) | //delete token on update, in case settings changed |
| [768](#L768) | delete\_transient($this->get\_core()->prefix . '\_access\_token'); |
| [769](#L769) | return parent::process\_admin\_options(); |
| [770](#L770) | } |
| [771](#L771) | } |
| [772](#L772) | } |

**Note:** See [TracBrowser](/wiki/TracBrowser)
for help on using the repository browser.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Plain Text](/browser/posti-shipping/tags/3.10.3/core/class-shipping-method.php?format=txt)
* [Original Format](/export/3222428/posti-shipping/tags/3.10.3/core/class-shipping-method.php)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from www.wordfence.com_d8d77962_20250114_181020.html ===


[![](https://www.wordfence.com/img/wordfence-intelligence-logo.svg)](/threat-intel/)

Have you found a vulnerability in a WordPress plugin or theme? Report vulnerabilities in WordPress plugins and themes through our [bug bounty program](https://www.wordfence.com/threat-intel/bug-bounty-program) and earn a bounty on all in-scope submissions, while we handle the responsible disclosure process on your behalf.

As a reminder, the Wordfence Intelligence Vulnerability Database API is completely free to query and utilize, both personally and commercially, and contains all the same vulnerability data as the user interface. Please review the API documentation and Webhook documentation for more information on how to query the vulnerability API endpoints and configure webhooks utilizing all the same data present in the Wordfence Intelligence user interface.

# Posti Shipping <= 3.10.3 - Reflected Cross-Site Scripting

 [Wordfence Intelligence](https://www.wordfence.com/threat-intel)   >    [Vulnerability Database](https://www.wordfence.com/threat-intel/vulnerabilities)   >   Posti Shipping <= 3.10.3 - Reflected Cross-Site Scripting

6.1

**Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')**
**CVSS Vector**
[CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N)

| CVE | [CVE-2024-10832](https://www.cve.org/CVERecord?id=CVE-2024-10832) |
| --- | --- |
| CVSS | 6.1 (Medium) |
| Publicly Published | December 3, 2024 |
| Last Updated | December 24, 2024 |
| Researcher | [vgo0](https://www.wordfence.com/threat-intel/vulnerabilities/researchers/dale-mavers) |

### Description

The Posti Shipping plugin for WordPress is vulnerable to Reflected Cross-Site Scripting via the account\_number and secret\_key parameters in all versions up to, and including, 3.10.3 due to insufficient input sanitization and output escaping. This makes it possible for unauthenticated attackers to inject arbitrary web scripts in pages that execute if they can successfully trick a user into performing an action such as clicking on a link.

#### References

* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/browser/posti-shipping/tags/3.10.3/core/class-shipping-method.php#L87)
* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/browser/posti-shipping/tags/3.10.3/core/class-shipping-method.php#L104)
* [wordpress.org](https://wordpress.org/plugins/posti-shipping/#developers)
* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/changeset/3206390/posti-shipping/tags/3.10.4/core/class-shipping-method.php)

#### Share

[Facebook](https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fposti-shipping%2Fposti-shipping-3103-cross-site-request-forgery-to-stored-cross-site-scripting-via-generate-notices-html-function&t=Posti%20Shipping%20%3C%3D%203.10.3%20-%20Reflected%20Cross-Site%20Scripting "Facebook")
[Twitter](https://twitter.com/share?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fposti-shipping%2Fposti-shipping-3103-cross-site-request-forgery-to-stored-cross-site-scripting-via-generate-notices-html-function&text=Posti%20Shipping%20%3C%3D%203.10.3%20-%20Reflected%20Cross-Site%20Scripting "Twitter")
[LinkedIn](https://www.linkedin.com/shareArticle?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fposti-shipping%2Fposti-shipping-3103-cross-site-request-forgery-to-stored-cross-site-scripting-via-generate-notices-html-function "LinkedIn")
Email

## Vulnerability Details for Posti Shipping

#### [Posti Shipping](https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/posti-shipping)

| Software Type | Plugin |
| --- | --- |
| Software Slug | posti-shipping [(view on wordpress.org)](https://wordpress.org/plugins/posti-shipping) |
| Patched? | Yes |
| Remediation | Update to version 3.10.4, or a newer patched version |
| Affected Version | * <= 3.10.3 |
| Patched Version | * 3.10.4 |

This record contains material that is subject to copyright.

**Copyright 2012-2025 Defiant Inc.**

**License:**
Defiant hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute this software vulnerability information. Any copy of the software vulnerability information you make for such purposes is authorized provided that you include a hyperlink to this vulnerability record and reproduce Defiant's copyright designation and this license in any such copy.
**[Read more.](https://www.wordfence.com/wordfence-intelligence-terms-and-conditions/)**

**Copyright 1999-2025 The MITRE Corporation**

**License:**
CVE Usage: MITRE hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute Common Vulnerabilities and Exposures (CVE®). Any copy you make for such purposes is authorized provided that you reproduce MITRE's copyright designation and this license in any such copy.
**[Read more.](https://www.cve.org/Legal/TermsOfUse)**

Have information to add, or spot any errors? Contact us at wfi-support@wordfence.com so we can make any appropriate adjustments.

Did you know Wordfence Intelligence provides free personal and commercial API access to our comprehensive WordPress vulnerability database, along with a free webhook integration to stay on top of the latest vulnerabilities added and updated in the database? Get started today!

Learn more

Want to get notified of the latest vulnerabilities that may affect your WordPress site?
 Install Wordfence on your site today to get notified immediately if your site is affected by a vulnerability that has been added to our database.

Get Wordfence

The Wordfence Intelligence WordPress vulnerability database is completely free to access and query via API. Please review the documentation on how to access and consume the vulnerability data via API.

Documentation



=== Content from wordpress.org_5bd9aa5b_20250114_181018.html ===


[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Showcase](https://wordpress.org/showcase/)
* [Hosting](https://wordpress.org/hosting/)
* Extend
  + [Themes](https://wordpress.org/themes/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Blocks](https://wordpress.org/blocks/)
  + [Openverse ↗︎](https://openverse.org/)
* Learn
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* Community
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [Events](https://events.wordpress.org/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* About
  + [About WordPress](https://wordpress.org/about/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
* [Get WordPress](https://wordpress.org/download/)

Search in WordPress.org

[Get WordPress](https://wordpress.org/download/)

[WordPress.org](https://wordpress.org/)

[Plugin Directory](https://wordpress.org/plugins/)

Posti Shipping

* [Submit a plugin](https://wordpress.org/plugins/developers/)
* [My favorites](https://wordpress.org/plugins/browse/favorites/)
* [Log in](https://login.wordpress.org/?redirect_to=https%3A%2F%2Fwordpress.org%2Fplugins%2Fposti-shipping&locale=en_US)

* [Submit a plugin](https://wordpress.org/plugins/developers/)
* [My favorites](https://wordpress.org/plugins/browse/favorites/)
* [Log in](https://login.wordpress.org/?redirect_to=https%3A%2F%2Fwordpress.org%2Fplugins%2Fposti-shipping&locale=en_US)

Search plugins

![](https://ps.w.org/posti-shipping/assets/banner-772x250.png?rev=3132120)
![](https://ps.w.org/posti-shipping/assets/icon-256x256.png?rev=3132120)
# Posti Shipping

By [Posti](https://www.posti.fi/)

[Download](https://downloads.wordpress.org/plugin/posti-shipping.zip)

* [Details](https://wordpress.org/plugins/posti-shipping/#description)
* [Reviews](https://wordpress.org/plugins/posti-shipping/#reviews)
* [Installation](https://wordpress.org/plugins/posti-shipping/#installation)
* [Development](https://wordpress.org/plugins/posti-shipping/#developers)

[Support](https://wordpress.org/support/plugin/posti-shipping/)

## Description

[Posti](https://www.posti.fi/) is a shipping service provider in Finland. This plugin integrates Posti’s parcel shipping services into WooCommerce. To start shipping, all your WooCommerce needs is this plugin and API credentials of your account registered with Posti. Order API credentials to use the plugin. (https://www.posti.fi/fi/yrityksille/tehosta-logistiikkaa/digitaaliset-palvelut-ja-rajapinnat/verkkokaupan-lisaosat)

This plugin requires at least WooCommerce version 4.7.0.

### Features

* Integrates Posti parcel shipping services with WooCommerce.
* Supports WooCommerce shipping zones and classes.
* Customers can choose to ship products to an address or to any pickup point.
* Store owners can add pickup points to any shipping zone’s shipping method.
* Store owners can use whatever shipping pricing plugin
* Store owners can generate the shipping label by one click.
* Store owners can generate shipping labels as mass action from orders view.
* Store owners and customers get tracking code links and status information.
* Support for Cash-On-Delivery.

## Screenshots

* [![](https://ps.w.org/posti-shipping/assets/screenshot-1.png?rev=2602856)](https://ps.w.org/posti-shipping/assets/screenshot-1.png?rev=2602856)

  Order screen in admin
* [![](https://ps.w.org/posti-shipping/assets/screenshot-2.png?rev=2602856)](https://ps.w.org/posti-shipping/assets/screenshot-2.png?rev=2602856)

  Checkout in twentynineteen theme
* [![](https://ps.w.org/posti-shipping/assets/screenshot-3.png?rev=2602856)](https://ps.w.org/posti-shipping/assets/screenshot-3.png?rev=2602856)

  Checkout in twentynineteen theme
* [![](https://ps.w.org/posti-shipping/assets/screenshot-4.png?rev=2602856)](https://ps.w.org/posti-shipping/assets/screenshot-4.png?rev=2602856)

  Settings screen in admin

## Installation

1. Install the plugin through the WordPress plugins screen directly or upload the plugin files to the `/wp-content/plugins/posti-shipping` directory.
2. Activate the plugin through the ‘Plugins’ screen in WordPress
3. Use the Settings->WooCommerce Posti screen to configure the plugin
4. The plugin requires WooCommerce to be installed, with shipping zones configured and this plugin activated and settings set.

This plugin can also be installed directly from Github.

## FAQ

### Is this ready for production use?

Yes! If you encounter any issues related to this plugin, please report at https://github.com/Seravo/woo-pakettikauppa/issues or [Posti customer service](https://www.posti.fi/verkkokauppiaat/)

## Reviews

![](https://secure.gravatar.com/avatar/f881def6acbc347bc524c1070939f57d894eafb59b7f1012c622fcd334b31068?s=60&d=retro&r=g)
### [Poorly maintained](https://wordpress.org/support/topic/poorly-maintained-3/)

[Simon J.](https://profiles.wordpress.org/simon-j-1/ "Posts by Simon J.")
April 10, 2024

The way this plugin saves pickup points is outdated and does not function properly anymore. This data is saved using update\_post\_meta when it should be done using WC\_Order::update\_meta\_data. Printing address cards does not work either; I suspect this too is due to utilizing some obsolete data structure. Also it is not compatible with Gutenberg blocks. Source code hints there is a test mode, but there’s no option to enable it in the settings UI. I wasted a lot of time chasing down these issues in order to get a decently working system for my client, when the expectation is “of course it works, it’s Posti’s own implementation, d’uh!” All in all a mess.

![](https://secure.gravatar.com/avatar/adb00bda8f93d08ed0b265c61c152aa9b3d0aef33e8a5111cc6ba9a3cc3a6291?s=60&d=retro&r=g)
### [Toimii erittäin hyvin](https://wordpress.org/support/topic/toimii-erittain-hyvin/)

[jussipv](https://profiles.wordpress.org/jussipv/ "Posts by jussipv")
October 25, 2023

Yhdellä klikkauksella tilauksen käsittely-sivulta saa luotua automaattisesti pakettikortit ja tilauksen tilakin muuttuu Lähetetty-tilaan, jossa asiakkaalle lähtee viesti, jossa seurantakoodi mukana.
Toisella klikkauksella saa suoraan pakettikortin auki WP:stä, josta sen pääsee tulostamaan.
Noutotilauksia en itse käytä, mutta lähetykset saa ilmeisesti myös lisättyä noutotilaukseen tämän avulla.
Ainoa miinus on jostain syystä heikompi tulostuslaatu tämän pluginin kautta luoduille pakettikorteille kun vertaa suoraan OmaPostista tehtyihin, mutta kunhan viivakoodit pelittää niin se riittää.

![](https://secure.gravatar.com/avatar/136f777957c60f9123a12b50e8c763dc42fb19da0f292e29fcbc5294eea1d79b?s=60&d=retro&r=g)
### [Excellent!!](https://wordpress.org/support/topic/excellent-12469/)

[pookwatches](https://profiles.wordpress.org/pookwatches/ "Posts by pookwatches")
January 19, 2023

Very functional! Operational reliability and upgradeability better than its competitors. Keep the software quality as you have been, great job! It’s a pity that we spent time on “the other”..

![](https://secure.gravatar.com/avatar/3393198358070c7f5f9e259f90684b91d4235844cbfb26707dd4d8baaa150095?s=60&d=retro&r=g)
### [Like pouring tar all over my website.](https://wordpress.org/support/topic/like-pouring-tar-all-over-my-website/)

[theotherrecords](https://profiles.wordpress.org/theotherrecords/ "Posts by theotherrecords")
April 19, 2021

As soon as I activated this plugin, my entire website (front and backend) slowed down like a snail crawling through frozen tar in January. Or kind of like that Yule greeting card my friends sent me via Posti in December from the other side of town that arrived in JULY… In fact, the website came to a screeching halt, I started getting a 504 Gateway Time-out error (and so did everybody else that tried to use it on multiple platforms and devices) and had to delete the plugin altogether via FTP. Immediately after deleting the plug-in, the website started working again. I’m sure this would be of great help to my webstore IF IT WORKED. Back to the drawing board, guys.

[Read all 4 reviews](https://wordpress.org/support/plugin/posti-shipping/reviews/)
## Contributors & Developers

“Posti Shipping” is open source software. The following people have contributed to this plugin.

Contributors

* ![](https://secure.gravatar.com/avatar/f7824ab44d2ec1bcfa3679834ede6c08cb7a34129545eba5d19d00e0b0dfc551?s=32&d=mm&r=g) [Joose Vettenranta](https://profiles.wordpress.org/joosev/)
* ![](https://secure.gravatar.com/avatar/801609f0c0abe81fae66192822c76c94bfe99eddf8460439edd98c3f53175273?s=32&d=mm&r=g) [Otto Kekäläinen](https://profiles.wordpress.org/ottok/)
* ![](https://secure.gravatar.com/avatar/dd95378309b8c85cd2ae60dc792879dd8f56bec35c1fac73d8e1500d2ad9dc60?s=32&d=mm&r=g) [Leo Toikka](https://profiles.wordpress.org/leotoikka/)
* ![](https://secure.gravatar.com/avatar/6be39524d4782fde76c37042ff4ab8a377a0823147e8d1b772c75ba0cde75476?s=32&d=mm&r=g) [Tero Auvinen](https://profiles.wordpress.org/serter/)
* ![](https://secure.gravatar.com/avatar/7793dc41cfdef16d99fbe14854a8a7d28b7198d3b14286a2d817f3913c2eafa1?s=32&d=mm&r=g) [k1sul1](https://profiles.wordpress.org/k1sul1/)

[Translate “Posti Shipping” into your language.](https://translate.wordpress.org/projects/wp-plugins/posti-shipping)

### Interested in development?

[Browse the code](https://plugins.trac.wordpress.org/browser/posti-shipping/), check out the [SVN repository](https://plugins.svn.wordpress.org/posti-shipping/), or subscribe to the [development log](https://plugins.trac.wordpress.org/log/posti-shipping/) by [RSS](https://plugins.trac.wordpress.org/log/posti-shipping/?limit=100&mode=stop_on_copy&format=rss).

## Changelog

#### 3.10.4

* Fix for possible Cross Site Request Forgery (CSRF) vulnerability

#### 3.10.3

* Fix for possible Full Path Disclosure (FPD) vulnerability

#### 3.10.2

* New feature: adding product quantities to address label
* New feature: order notes can be added to address label
* New feature: new order list column to show shipment tracking link
* Pickup points optional for Express-parcel
* Bug fix for duplicate shipments
* Bug fix for bulk order status update

#### 3.10.1

* Quick fix for Legacy order storage backwards compatibility

#### 3.10.0

* New feature: WooCommerce block editor support
* Return product mappings fixed
* Tested against WordPress 6.6.1 and WooCommerce 9.1.4

#### 3.9.4

* New feature: allow ignoring product weights
* New feature: HPOS support
* Various small fixes

#### 3.9.3

* Fix missing variable preventing list type of pickup points showing at checkout
* Fix PHP 8.2 related fixes

#### 3.9.2

* WP and Woo compatibility update
* Update to latest API library
* Various small fixes

#### 3.9.1

* WP compatibility update
* Bug fix: Attach tracking info to email

#### 3.9.0

* New feature: Support for order pickups
* New feature: Pickup point filtering
* New feature: Email info as template
* New feature: Custom bulk create order
* New feature: Option to create return labels automatically
* Bug fix: Weight and volume information to shipping labels if variable product

#### 3.8.0

* Support for shortcodes
* Support for variable products SKU on shipping labels

#### 3.7.2

* Fix small pickup point search bug

#### 3.7.1

* Fix for pickup point searches
* Fix for pakettikauppa\_fetch\_tracking\_codes -action
* Various small fixes

#### 3.7.0

* New feature: Support for different label sizes
* New feature: Shipping phone number optional / mandatory settings
* New feature: LV translations
* Refactoring: Arranging settings regrading checkout settings

#### 3.6.2

* Bug fix: load product class when not in admin view

#### 3.6.1

* Bug fix

#### 3.6.0

* New feature: LQ-shipments
* New feature: If shipping postcode is missing, use billing address
* New feature: LT translation
* Tested against woocommerce 4.6.1 and wordpress 5.9.2
* Various bug fixes

#### 3.5.2

* Diagnostic tool bug fix when using Posti Shipping version
* Add error message if mass action operation fails
* Update automated tests and PHP 8.x tests
* Convert API secret as password field for added security
* Update Pakettikauppa API library to latest version

#### 3.5.1

* Bug fix

#### 3.5.0

* Customer facing templates (checkout & view order) can now be replaced in own theme dir
* Minumum woocommerce version is now 4.7.0 and tested against woocommerce 6.1.0

#### 3.4.1

* Bug fix related to token caching

#### 3.4.0

* New feature: Updated diagnostic tool to check versions and cached tokens
* New feature: Additional info to shipping labels in custom shipment
* New feature: Instuction if no configured shipping method
* Fine tuning: Wizard fixes in settings
* Fine tuning: Double check that cached token is really expired after TTL
* Bug fix: Automated test fixes
* Bug fix: Refactoring, small bug fixes

#### 3.3.0

* New feature: Diagnostic tool to check everything is working correctly
* New feature: If using only one provider in pickup point searches, don’t show the provider name
* Bug fix: Allow saving if more than 16 shipping methods
* Bug fix: Various small bug fixes

#### 3.2.3

* Minor bugfix for token authentication

#### 3.2.2

* Minor bugfix

#### 3.2.1

* Fix timing issue preventing working from most installations

#### 3.2.0

* Add support for additional info to shipping labels
* Various bug fixes

#### 3.1.2.1

* Various compatibility fixes

#### 3.1.2

* Backwards compatibility for bulk actions

#### 3.1.1

* If product does not exists, display “unknown product”
* Change versioning to identical to Pakettikauppa plugin

#### 3.1.0

* Create multiple shipping labels from order view
* Allow editing of order phone number and email address
* Make pickup point search optional
* Various bug fixes

#### 3.0.1

* Fix bug in pickup point saving in checkout

#### 3.0.0

* Remove Pakettikauppa shipping method option
* Add possibility to choose pickup point in order view
* Fix bug for pickup point not saving in checkout

#### 2.4.0

* New pickup point chooser for checkout
* Fixing pickup point related bugs

#### 2.3.3

* Some plugins brake because of forced validation of chosen pickup points. This update loosens the validation little bit

#### 2.3.2

* Fix to validation that checks if pickup point is chosen
* Add checks that billing email and/or phone exists before adding those to shipping

#### 2.3.1

* Fix to help to fill orders from previous versions when using pickup points as shipping method

#### 2.3.0

* Many small changes: f.ex. adding new fields to checkout and to sender configuration
* Fixes compatibility with Klarna
* Fixes return shipments

#### 2.2.0

* Properly catch exceptions so faulty orders don’t cause a fatal error
* Allow supplying a different address for pickup point search
* Fix headers so files download properly

#### 2.1.2

* Fixed a bug breaking the setup wizard

#### 2.1.1

* Fixed a bug breaking shipping methods created the old way.

#### 1.1.2

* Better error handling if API credentials are wrong

#### 1.1.1

* Fix tracking url

#### 1.1.0

* Small tweaks to UX in settings
* Ability to choose pickup point when creating custom shipment
* Removed obsolete Posti shipping method
* Various bug fixes

#### 1.0.2

* Various small fixes to functionality and translations

#### 1.0.1

* Tracking URL change

#### 1.0.0

* Initial release for General Availability.

## Meta

* Version **3.10.4**
* Last updated **1 month ago**
* Active installations **1,000+**
* WordPress version **5.0 or higher**
* Tested up to **6.5.5**
* PHP version **7.1 or higher**
* Tags [posti](https://wordpress.org/plugins/tags/posti/)[shipping](https://wordpress.org/plugins/tags/shipping/)[smartship](https://wordpress.org/plugins/tags/smartship/)[toimitustavat](https://wordpress.org/plugins/tags/toimitustavat/)[woocommerce](https://wordpress.org/plugins/tags/woocommerce/)
* [Advanced View](https://wordpress.org/plugins/posti-shipping/advanced/)

## Ratings

3 out of 5 stars.

* [2 5-star reviews
  5 stars

  2](https://wordpress.org/support/plugin/posti-shipping/reviews/?filter=5)
* [0 4-star reviews
  4 stars

  0](https://wordpress.org/support/plugin/posti-shipping/reviews/?filter=4)
* [0 3-star reviews
  3 stars

  0](https://wordpress.org/support/plugin/posti-shipping/reviews/?filter=3)
* [0 2-star reviews
  2 stars

  0](https://wordpress.org/support/plugin/posti-shipping/reviews/?filter=2)
* [2 1-star reviews
  1 star

  2](https://wordpress.org/support/plugin/posti-shipping/reviews/?filter=1)

[Add my review](https://wordpress.org/support/plugin/posti-shipping/reviews/#new-post)

[See all reviews](https://wordpress.org/support/plugin/posti-shipping/reviews/)

## Contributors

* ![](https://secure.gravatar.com/avatar/f7824ab44d2ec1bcfa3679834ede6c08cb7a34129545eba5d19d00e0b0dfc551?s=32&d=mm&r=g) [Joose Vettenranta](https://profiles.wordpress.org/joosev/)
* ![](https://secure.gravatar.com/avatar/801609f0c0abe81fae66192822c76c94bfe99eddf8460439edd98c3f53175273?s=32&d=mm&r=g) [Otto Kekäläinen](https://profiles.wordpress.org/ottok/)
* ![](https://secure.gravatar.com/avatar/dd95378309b8c85cd2ae60dc792879dd8f56bec35c1fac73d8e1500d2ad9dc60?s=32&d=mm&r=g) [Leo Toikka](https://profiles.wordpress.org/leotoikka/)
* ![](https://secure.gravatar.com/avatar/6be39524d4782fde76c37042ff4ab8a377a0823147e8d1b772c75ba0cde75476?s=32&d=mm&r=g) [Tero Auvinen](https://profiles.wordpress.org/serter/)
* ![](https://secure.gravatar.com/avatar/7793dc41cfdef16d99fbe14854a8a7d28b7198d3b14286a2d817f3913c2eafa1?s=32&d=mm&r=g) [k1sul1](https://profiles.wordpress.org/k1sul1/)
## Support

Issues resolved in last two months:

0 out of 3

[View support forum](https://wordpress.org/support/plugin/posti-shipping/)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Privacy](https://wordpress.org/about/privacy/)

* [Showcase](https://wordpress.org/showcase/)
* [Themes](https://wordpress.org/themes/)
* [Plugins](https://wordpress.org/plugins/)
* [Patterns](https://wordpress.org/patterns/)

* [Learn](https://learn.wordpress.org/)
* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [WordPress.tv ↗](https://wordpress.tv/)

* [Get Involved](https://make.wordpress.org/)
* [Events](https://events.wordpress.org/)
* [Donate ↗](https://wordpressfoundation.org/donate/)
* [Five for the Future](https://wordpress.org/five-for-the-future/)

* [WordPress.com ↗](https://wordpress.com/?ref=wporg-footer)
* [Matt ↗](https://ma.tt/)
* [bbPress ↗](https://bbpress.org/)
* [BuddyPress ↗](https://buddypress.org/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our X (formerly Twitter) account](https://www.x.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)
* [Visit our YouTube channel](https://www.youtube.com/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)


