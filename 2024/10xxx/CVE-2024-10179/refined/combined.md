=== Content from plugins.trac.wordpress.org_aac607cf_20250115_092410.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fchangeset%2F3184136)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Changeset](/changeset/3184135 "Changeset 3184135")
* [Next Changeset](/changeset/3184137 "Changeset 3184137") →

---

# Changeset 3184136

View differences
inline
side by side

Show
lines around each change

Show the changes in full context

Ignore:

Blank lines

Case changes

White space changes

Timestamp:
11/08/2024 12:25:32 AM
([2 months](/timeline?from=2024-11-08T00%3A25%3A32Z&precision=second "See timeline at 11/08/2024 12:25:32 AM") ago)

Author:
wpslickstream
Message:

updating trunk to 2.0.0

Location:
[slick-engagement/trunk](/browser/slick-engagement/trunk?rev=3184136)
Files:

3 added
6 edited
2 moved

* [SlickEngagement.php](/browser/slick-engagement/trunk/SlickEngagement.php?rev=3184136 "Show entry in browser")
  (moved)
  *(moved from [slick-engagement/trunk/slick-engagement.php](/browser/slick-engagement/trunk/slick-engagement.php?rev=3104175 "Show original file (revision 3184135)"))*
  ([3 diffs](#file0 "Show differences"))
* [SlickEngagement\_ActionsFilters.php](/browser/slick-engagement/trunk/SlickEngagement_ActionsFilters.php?rev=3184136 "Show entry in browser")
  (added)
* [SlickEngagement\_Init.php](/browser/slick-engagement/trunk/SlickEngagement_Init.php?rev=3184136 "Show entry in browser")
  (moved)
  *(moved from [slick-engagement/trunk/slick-engagement\_init.php](/browser/slick-engagement/trunk/slick-engagement_init.php?rev=2876144 "Show original file (revision 3184135)"))*
  ([2 diffs](#file2 "Show differences"))
* [SlickEngagement\_InstallIndicator.php](/browser/slick-engagement/trunk/SlickEngagement_InstallIndicator.php?rev=3184136 "Show entry in browser")
  (modified)
  ([15 diffs](#file3 "Show differences"))
* [SlickEngagement\_LifeCycle.php](/browser/slick-engagement/trunk/SlickEngagement_LifeCycle.php?rev=3184136 "Show entry in browser")
  (modified)
  ([6 diffs](#file4 "Show differences"))
* [SlickEngagement\_OptionsManager.php](/browser/slick-engagement/trunk/SlickEngagement_OptionsManager.php?rev=3184136 "Show entry in browser")
  (modified)
  ([20 diffs](#file5 "Show differences"))
* [SlickEngagement\_PageBootData.php](/browser/slick-engagement/trunk/SlickEngagement_PageBootData.php?rev=3184136 "Show entry in browser")
  (added)
* [SlickEngagement\_Plugin.php](/browser/slick-engagement/trunk/SlickEngagement_Plugin.php?rev=3184136 "Show entry in browser")
  (modified)
  ([8 diffs](#file7 "Show differences"))
* [SlickEngagement\_Utils.php](/browser/slick-engagement/trunk/SlickEngagement_Utils.php?rev=3184136 "Show entry in browser")
  (added)
* [SlickEngagement\_Widgets.php](/browser/slick-engagement/trunk/SlickEngagement_Widgets.php?rev=3184136 "Show entry in browser")
  (modified)
  ([10 diffs](#file9 "Show differences"))
* [readme.txt](/browser/slick-engagement/trunk/readme.txt?rev=3184136 "Show entry in browser")
  (modified)
  ([4 diffs](#file10 "Show differences"))

### Legend:

Unmodified
Added
Removed

* ## [slick-engagement/trunk/SlickEngagement.php](/changeset/3184136/slick-engagement/trunk/SlickEngagement.php "Show the changeset 3184136 restricted to slick-engagement/trunk/SlickEngagement.php")

  | [r3184135](/browser/slick-engagement/trunk/slick-engagement.php?rev=3104175#L1 "Show revision 3184135 of this file in browser") | [r3184136](/browser/slick-engagement/trunk/SlickEngagement.php?rev=3184136#L1 "Show revision 3184136 of this file in browser") |  |
  | --- | --- | --- |
  | 1 |  | <?php |
  |  | 1 | <?php namespace Slickstream; |
  | 2 | 2 | /\* |
  | 3 | 3 | Plugin Name: Slickstream Search and Engagement |
  | 4 | 4 | Plugin URI: https://slickstream.com/getting-started |
  | 5 |  | ~~Version: 1.4.4~~ |
  | 6 | 5 | Author: Slickstream |
  | 7 | 6 | Author URI: https://slickstream.com |
  | […](/browser/slick-engagement/trunk/slick-engagement.php?rev=3104175#L11) | […](/browser/slick-engagement/trunk/SlickEngagement.php?rev=3184136#L10) |  |
  | 11 | 10 | \*/ |
  | 12 | 11 |  |
  | 13 |  | ~~$SlickEngagement\_minimalRequiredPhpVersion = '5.0';~~ |
  | 14 | 12 |  |
  | 15 | 13 | /\*\* |
  | […](/browser/slick-engagement/trunk/slick-engagement.php?rev=3104175#L18) | […](/browser/slick-engagement/trunk/SlickEngagement.php?rev=3184136#L16) |  |
  | 18 | 16 | \* an error message on the Admin page |
  | 19 | 17 | \*/ |
  | 20 |  | function SlickEngagement\_noticePhpVersionWrong() |
  | 21 |  | { |
  | 22 |  | global $SlickEngagement\_minimalRequiredPhpVersion; |
  | 23 |  | echo '<div class="updated fade">' . |
  | 24 |  | \_\_('Error: plugin "Slick Engagement" requires a newer version of PHP to be running.', 'slick-engagement') . |
  | 25 |  | '<br/>' . \_\_('Minimal version of PHP required: ', 'slick-engagement') . '<strong>' . $SlickEngagement\_minimalRequiredPhpVersion . '</strong>' . |
  | 26 |  | '<br/>' . \_\_('Your server\'s PHP version: ', 'slick-engagement') . '<strong>' . phpversion() . '</strong>' . |
  | 27 |  | '</div>'; |
  |  | 18 | function SlickstreamPluginInit(): void { |
  |  | 19 | $minimumRequiredPhpVersion = '7.4.0'; |
  |  | 20 |  |
  |  | 21 | if (version\_compare((string) phpversion(), $minimumRequiredPhpVersion) < 0) { |
  |  | 22 | add\_action('admin\_notices', function() use ($minimumRequiredPhpVersion) { |
  |  | 23 | echo '<div class="updated fade">' . |
  |  | 24 | \_\_('Error: plugin "Slickstream Engagement" requires a newer version of PHP to be running.', 'slick-engagement') . |
  |  | 25 | '<br/>' . \_\_('Minimum version of PHP required: ', 'slick-engagement') . '<strong>' . $minimumRequiredPhpVersion . '</strong>' . |
  |  | 26 | '<br/>' . \_\_('Your server\'s PHP version: ', 'slick-engagement') . '<strong>' . phpversion() . '</strong>' . |
  |  | 27 | '</div>'; |
  |  | 28 | }); |
  |  | 29 | return; |
  |  | 30 | } |
  |  | 31 |  |
  |  | 32 | require\_once 'SlickEngagement\_Init.php'; |
  |  | 33 | PluginInit(); |
  | 28 | 34 | } |
  | 29 | 35 |  |
  | 30 |  | function SlickEngagement\_PhpVersionCheck() |
  | 31 |  | { |
  | 32 |  | global $SlickEngagement\_minimalRequiredPhpVersion; |
  | 33 |  | if (version\_compare(phpversion(), $SlickEngagement\_minimalRequiredPhpVersion) < 0) { |
  | 34 |  | add\_action('admin\_notices', 'SlickEngagement\_noticePhpVersionWrong'); |
  | 35 |  | return false; |
  | 36 |  | } |
  | 37 |  | return true; |
  | 38 |  | } |
  | 39 |  |  |
  | 40 |  | /\*\* |
  | 41 |  | \* Initialize internationalization (i18n) for this plugin. |
  | 42 |  | \* References: |
  | 43 |  | \*      http://codex.wordpress.org/I18n\_for\_WordPress\_Developers |
  | 44 |  | \*      http://www.wdmac.com/how-to-create-a-po-language-translation#more-631 |
  | 45 |  | \* @return void |
  | 46 |  | \*/ |
  | 47 |  | function SlickEngagement\_i18n\_init() |
  | 48 |  | { |
  | 49 |  | $pluginDir = dirname(plugin\_basename(\_\_FILE\_\_)); |
  | 50 |  | load\_plugin\_textdomain('slick-engagement', false, $pluginDir . '/languages/'); |
  | 51 |  | } |
  | 52 |  |  |
  | 53 |  | ////////////////////////////////// |
  | 54 |  | // Run initialization |
  | 55 |  | ///////////////////////////////// |
  | 56 |  |  |
  | 57 |  | // Initialize i18n |
  | 58 |  | add\_action('plugins\_loadedi', 'SlickEngagement\_i18n\_init'); |
  | 59 |  |  |
  | 60 |  | // Run the version check. |
  | 61 |  | // If it is successful, continue with initialization for this plugin |
  | 62 |  | if (SlickEngagement\_PhpVersionCheck()) { |
  | 63 |  | // Only load and run the init function if we know PHP version can parse it |
  | 64 |  | include\_once 'slick-engagement\_init.php'; |
  | 65 |  | SlickEngagement\_init(\_\_FILE\_\_); |
  | 66 |  | } |
  |  | 36 | SlickstreamPluginInit(); |
* ## [slick-engagement/trunk/SlickEngagement\_Init.php](/changeset/3184136/slick-engagement/trunk/SlickEngagement_Init.php "Show the changeset 3184136 restricted to slick-engagement/trunk/SlickEngagement_Init.php")

  | [r3184135](/browser/slick-engagement/trunk/slick-engagement_init.php?rev=2876144#L1 "Show revision 3184135 of this file in browser") | [r3184136](/browser/slick-engagement/trunk/SlickEngagement_Init.php?rev=3184136#L1 "Show revision 3184136 of this file in browser") |  |
  | --- | --- | --- |
  | 1 |  | <?php |
  |  | 1 | <?php |
  |  | 2 | declare(strict\_types=1); |
  |  | 3 | namespace Slickstream; |
  | 2 | 4 |  |
  | 3 |  | function ~~SlickEngagement\_init($file)~~ { |
  |  | 5 | function PluginInit(): void { |
  | 4 | 6 |  |
  | 5 |  | require\_once~~('SlickEngagement\_Plugin.php')~~; |
  | 6 |  | $~~aPlugin = new SlickEngagement\_Plugin~~(); |
  |  | 7 | require\_once 'SlickEngagement\_ActionsFilters.php'; |
  |  | 8 | $slickActionsFilters = new ActionsFilters(); |
  | 7 | 9 |  |
  | 8 |  | ~~// Install the plugin~~ |
  | 9 | 10 | // NOTE: this file gets run each time you \*activate\* the plugin. |
  | 10 | 11 | // So in WP when you "install" the plugin, all that does it dump its files in the plugin-templates directory |
  | […](/browser/slick-engagement/trunk/slick-engagement_init.php?rev=2876144#L12) | […](/browser/slick-engagement/trunk/SlickEngagement_Init.php?rev=3184136#L13) |  |
  | 12 | 13 | // So here, the plugin tracks whether or not it has run its install operation, and we ensure it is run only once |
  | 13 | 14 | // on the first activation |
  | 14 |  | if (!$aPlugin->isInstalled()) { |
  | 15 |  | $aPlugin->install(); |
  | 16 |  | } |
  | 17 |  | else { |
  |  | 15 | if (!$slickActionsFilters->isInstalled()) { |
  |  | 16 | $slickActionsFilters->install(); |
  |  | 17 | } else { |
  | 18 | 18 | // Perform any version-upgrade activities prior to activation (e.g. database changes) |
  | 19 |  | $~~aPlugin~~->upgrade(); |
  |  | 19 | $slickActionsFilters->upgrade(); |
  | 20 | 20 | } |
  | 21 | 21 |  |
  | 22 | 22 | // Add callbacks to hooks |
  | 23 |  | $aPlugin->addActionsAndFilters(); |
  | 24 |  |  |
  | 25 |  | if (!$file) { |
  | 26 |  | $file = \_\_FILE\_\_; |
  | 27 |  | } |
  | 28 |  | // Register the Plugin Activation Hook |
  | 29 |  | register\_activation\_hook($file, array(&$aPlugin, 'activate')); |
  | 30 |  |  |
  | 31 |  |  |
  | 32 |  | // Register the Plugin Deactivation Hook |
  | 33 |  | register\_deactivation\_hook($file, array(&$aPlugin, 'deactivate')); |
  |  | 23 | $slickActionsFilters->addActionsAndFilters(); |
  | 34 | 24 | } |
* ## [slick-engagement/trunk/SlickEngagement\_InstallIndicator.php](/changeset/3184136/slick-engagement/trunk/SlickEngagement_InstallIndicator.php "Show the changeset 3184136 restricted to slick-engagement/trunk/SlickEngagement_InstallIndicator.php")

  | [r2876144](/browser/slick-engagement/trunk/SlickEngagement_InstallIndicator.php?rev=2876144#L1 "Show revision 2876144 of this file in browser") | [r3184136](/browser/slick-engagement/trunk/SlickEngagement_InstallIndicator.php?rev=3184136#L1 "Show revision 3184136 of this file in browser") |  |
  | --- | --- | --- |
  | 1 |  | <?php |
  | 2 |  | include\_once('SlickEngagement\_OptionsManager.php'); |
  |  | 1 | <?php |
  |  | 2 | declare(strict\_types=1); |
  |  | 3 | namespace Slickstream; |
  | 3 | 4 |  |
  | 4 |  | class SlickEngagement\_InstallIndicator extends SlickEngagement\_OptionsManager { |
  |  | 5 | require\_once 'SlickEngagement\_OptionsManager.php'; |
  |  | 6 |  |
  |  | 7 | class InstallIndicator extends OptionsManager { |
  | 5 | 8 |  |
  | 6 | 9 | const optionInstalled = '\_installed'; |
  | 7 | 10 | const optionVersion = '\_version'; |
  | 8 | 11 |  |
  |  | 12 | public function \_\_construct() { |
  |  | 13 | parent::\_\_construct(); |
  |  | 14 | } |
  |  | 15 |  |
  | 9 | 16 | /\*\* |
  | 10 | 17 | \* @return bool indicating if the plugin is installed already |
  | 11 | 18 | \*/ |
  | 12 |  | public function isInstalled() { |
  |  | 19 | public function isInstalled(): bool { |
  | 13 | 20 | return $this->getOption(self::optionInstalled) == true; |
  | 14 | 21 | } |
  | […](/browser/slick-engagement/trunk/SlickEngagement_InstallIndicator.php?rev=2876144#L18) | […](/browser/slick-engagement/trunk/SlickEngagement_InstallIndicator.php?rev=3184136#L25) |  |
  | 18 | 25 | \* @return null |
  | 19 | 26 | \*/ |
  | 20 |  | protected function markAsInstalled() { |
  |  | 27 | protected function markAsInstalled(): ?bool { |
  | 21 | 28 | return $this->updateOption(self::optionInstalled, true); |
  | 22 | 29 | } |
  | […](/browser/slick-engagement/trunk/SlickEngagement_InstallIndicator.php?rev=2876144#L28) | […](/browser/slick-engagement/trunk/SlickEngagement_InstallIndicator.php?rev=3184136#L35) |  |
  | 28 | 35 | \* false implies it was not. |
  | 29 | 36 | \*/ |
  | 30 |  | protected function markAsUnInstalled() { |
  |  | 37 | protected function markAsUnInstalled(): bool { |
  | 31 | 38 | return $this->deleteOption(self::optionInstalled); |
  | 32 | 39 | } |
  | […](/browser/slick-engagement/trunk/SlickEngagement_InstallIndicator.php?rev=2876144#L36) | […](/browser/slick-engagement/trunk/SlickEngagement_InstallIndicator.php?rev=3184136#L43) |  |
  | 36 | 43 | \* need to check if an older version was installed to see if you need to do certain |
  | 37 | 44 | \* upgrade housekeeping (e.g. changes to DB schema). |
  | 38 |  | ~~\* @return null~~ |
  | 39 | 45 | \*/ |
  | 40 |  | protected function getVersionSaved() { |
  |  | 46 | protected function getVersionSaved(): ?string { |
  | 41 | 47 | return $this->getOption(self::optionVersion); |
  | 42 | 48 | } |
  | […](/browser/slick-engagement/trunk/SlickEngagement_InstallIndicator.php?rev=2876144#L44) | […](/browser/slick-engagement/trunk/SlickEngagement_InstallIndicator.php?rev=3184136#L50) |  |
  | 44 | 50 | /\*\* |
  | 45 | 51 | \* Set a version string in the options. |
  | 46 |  | ~~\* need to check if~~ |
  | 47 | 52 | \* @param  $version string best practice: use a dot-delimited string like '1.2.3' so version strings can be easily |
  | 48 | 53 | \* compared using version\_compare (http://php.net/manual/en/function.version-compare.php) |
  | 49 |  | ~~\* @return null~~ |
  | 50 | 54 | \*/ |
  | 51 |  | protected function setVersionSaved($version) { |
  |  | 55 | protected function setVersionSaved($version): ?bool { |
  | 52 | 56 | return $this->updateOption(self::optionVersion, $version); |
  | 53 | 57 | } |
  | […](/browser/slick-engagement/trunk/SlickEngagement_InstallIndicator.php?rev=2876144#L57) | […](/browser/slick-engagement/trunk/SlickEngagement_InstallIndicator.php?rev=3184136#L61) |  |
  | 57 | 61 | \* "Plugin Name", "Version", "Description", "Text Domain", etc. |
  | 58 | 62 | \*/ |
  | 59 |  | protected function getMainPluginFileName() { |
  |  | 63 | protected function getMainPluginFileName(): string { |
  | 60 | 64 | return basename(dirname(\_\_FILE\_\_)) . 'php'; |
  | 61 | 65 | } |
  | […](/browser/slick-engagement/trunk/SlickEngagement_InstallIndicator.php?rev=2876144#L65) | […](/browser/slick-engagement/trunk/SlickEngagement_InstallIndicator.php?rev=3184136#L69) |  |
  | 65 | 69 | \* E.g. "Plugin Name", "Version", "Description", "Text Domain", etc. |
  | 66 | 70 | \* @param $key string plugin header key |
  | 67 |  | \* @return string if found, otherwise null |
  |  | 71 | \* @return string | null if found, otherwise null |
  | 68 | 72 | \*/ |
  | 69 | 73 | public function getPluginHeaderValue($key) { |
  | 70 | 74 | // Read the string from the comment header of the main plugin file |
  | 71 |  | $data = file\_get\_contents($this->getPluginDir() . DIRECTORY\_SEPARATOR . ~~$this->getMainPluginFileName()~~); |
  | 72 |  | $match = ~~array()~~; |
  | 73 |  | preg\_match(~~'/' . $key . ':\s\*(\S+)/'~~, $data, $match); |
  |  | 75 | $data = file\_get\_contents($this->getPluginDir() . DIRECTORY\_SEPARATOR . 'readme.txt'); |
  |  | 76 | $match = []; |
  |  | 77 | preg\_match("/$key:\\s\*(\\S+)/", $data, $match); |
  | 74 | 78 | if (count($match) >= 1) { |
  | 75 | 79 | return $match[1]; |
  | […](/browser/slick-engagement/trunk/SlickEngagement_InstallIndicator.php?rev=2876144#L84) | […](/browser/slick-engagement/trunk/SlickEngagement_InstallIndicator.php?rev=3184136#L88) |  |
  | 84 | 88 | \* @return string |
  | 85 | 89 | \*/ |
  | 86 |  | protected function getPluginDir() { |
  |  | 90 | protected function getPluginDir(): string { |
  | 87 | 91 | return dirname(\_\_FILE\_\_); |
  | 88 | 92 | } |
  | […](/browser/slick-engagement/trunk/SlickEngagement_InstallIndicator.php?rev=2876144#L91) | […](/browser/slick-engagement/trunk/SlickEngagement_InstallIndicator.php?rev=3184136#L95) |  |
  | 91 | 95 | \* Version of this code. |
  | 92 | 96 | \* Best practice: define version strings to be easily compared using version\_compare() |
  | 93 |  | ~~\* (http://php.net/manual/en/function.version-compare.php)~~ |
  | 94 | 97 | \* NOTE: You should manually make this match the SVN tag for your main plugin file 'Version' release and 'Stable tag' in readme.txt |
  | 95 | 98 | \* @return string |
  | 96 | 99 | \*/ |
  | 97 |  | public function getVersion() { |
  | 98 |  | return $this->getPluginHeaderValue('~~Version~~'); |
  |  | 100 | public function getVersion(): string { |
  |  | 101 | return $this->getPluginHeaderValue('Stable tag'); |
  | 99 | 102 | } |
  | 100 | 103 |  |
  | […](/browser/slick-engagement/trunk/SlickEngagement_InstallIndicator.php?rev=2876144#L108) | […](/browser/slick-engagement/trunk/SlickEngagement_InstallIndicator.php?rev=3184136#L111) |  |
  | 108 | 111 | \* should be taken. Assumes that version string comparable by version\_compare, examples: '1', '1.1', '1.1.1', '2.0', etc. |
  | 109 | 112 | \*/ |
  | 110 |  | public function isInstalledCodeAnUpgrade() { |
  |  | 113 | public function isInstalledCodeAnUpgrade(): bool { |
  | 111 | 114 | return $this->isSavedVersionLessThan($this->getVersion()); |
  | 112 | 115 | } |
  | […](/browser/slick-engagement/trunk/SlickEngagement_InstallIndicator.php?rev=2876144#L117) | […](/browser/slick-engagement/trunk/SlickEngagement_InstallIndicator.php?rev=3184136#L120) |  |
  | 117 | 120 | \* @return bool true if the saved version is earlier (by natural order) than the input version |
  | 118 | 121 | \*/ |
  | 119 |  | public function isSavedVersionLessThan($aVersion) { |
  |  | 122 | public function isSavedVersionLessThan($aVersion): bool { |
  | 120 | 123 | return $this->isVersionLessThan($this->getVersionSaved(), $aVersion); |
  | 121 | 124 | } |
  | […](/browser/slick-engagement/trunk/SlickEngagement_InstallIndicator.php?rev=2876144#L130) | […](/browser/slick-engagement/trunk/SlickEngagement_InstallIndicator.php?rev=3184136#L133) |  |
  | 130 | 133 | \* @return bool true if the saved version is earlier (by natural order) than the input version |
  | 131 | 134 | \*/ |
  | 132 |  | public function isSavedVersionLessThanEqual($aVersion) { |
  |  | 135 | public function isSavedVersionLessThanEqual($aVersion): bool { |
  | 133 | 136 | return $this->isVersionLessThanEqual($this->getVersionSaved(), $aVersion); |
  | 134 | 137 | } |
  | […](/browser/slick-engagement/trunk/SlickEngagement_InstallIndicator.php?rev=2876144#L139) | […](/browser/slick-engagement/trunk/SlickEngagement_InstallIndicator.php?rev=3184136#L142) |  |
  | 139 | 142 | \* @return bool true if version\_compare of $versions1 and $version2 shows $version1 as the same or earlier |
  | 140 | 143 | \*/ |
  | 141 |  | public function isVersionLessThanEqual($version1, $version2) { |
  | 142 |  | return ~~(version\_compare($version1, $version2) <= 0)~~; |
  |  | 144 | public function isVersionLessThanEqual($version1, $version2): bool { |
  |  | 145 | return version\_compare($version1, $version2) <= 0; |
  | 143 | 146 | } |
  | 144 | 147 |  |
  | […](/browser/slick-engagement/trunk/SlickEngagement_InstallIndicator.php?rev=2876144#L148) | […](/browser/slick-engagement/trunk/SlickEngagement_InstallIndicator.php?rev=3184136#L151) |  |
  | 148 | 151 | \* @return bool true if version\_compare of $versions1 and $version2 shows $version1 as earlier |
  | 149 | 152 | \*/ |
  | 150 |  | public function isVersionLessThan($version1, $version2) { |
  | 151 |  | return ~~(version\_compare($version1, $version2) < 0)~~; |
  |  | 153 | public function isVersionLessThan($version1, $version2): bool { |
  |  | 154 | return version\_compare($version1, $version2) < 0; |
  | 152 | 155 | } |
  | 153 | 156 |  |
  | […](/browser/slick-engagement/trunk/SlickEngagement_InstallIndicator.php?rev=2876144#L158) | […](/browser/slick-engagement/trunk/SlickEngagement_InstallIndicator.php?rev=3184136#L161) |  |
  | 158 | 161 | \* @return void |
  | 159 | 162 | \*/ |
  | 160 |  | protected function saveInstalledVersion() { |
  |  | 163 | protected function saveInstalledVersion(): void { |
  | 161 | 164 | $this->setVersionSaved($this->getVersion()); |
  | 162 | 165 | } |
  | 163 |  |  |
  | 164 |  |  |
  | 165 | 166 | } |
* ## [slick-engagement/trunk/SlickEngagement\_LifeCycle.php](/changeset/3184136/slick-engagement/trunk/SlickEngagement_LifeCycle.php "Show the changeset 3184136 restricted to slick-engagement/trunk/SlickEngagement_LifeCycle.php")

  | [r2876144](/browser/slick-engagement/trunk/SlickEngagement_LifeCycle.php?rev=2876144#L1 "Show revision 2876144 of this file in browser") | [r3184136](/browser/slick-engagement/trunk/SlickEngagement_LifeCycle.php?rev=3184136#L1 "Show revision 3184136 of this file in browser") |  |
  | --- | --- | --- |
  | 1 |  | <?php |
  | 2 |  | include\_once 'SlickEngagement\_InstallIndicator.php'; |
  |  | 1 | <?php |
  |  | 2 | declare(strict\_types=1); |
  |  | 3 | namespace Slickstream; |
  | 3 | 4 |  |
  | 4 |  | class SlickEngagement\_LifeCycle extends SlickEngagement\_InstallIndicator |
  | 5 |  | { |
  |  | 5 | require\_once 'SlickEngagement\_InstallIndicator.php'; |
  | 6 | 6 |  |
  | 7 |  | public function install() |
  | 8 |  | { |
  |  | 7 | class PluginLifecycle extends InstallIndicator { |
  |  | 8 |  |
  |  | 9 | public function \_\_construct() { |
  |  | 10 | parent::\_\_construct(); |
  |  | 11 | } |
  |  | 12 |  |
  |  | 13 | public function install(): void { |
  | 9 | 14 |  |
  | 10 | 15 | // Initialize Plugin Options |
  | […](/browser/slick-engagement/trunk/SlickEngagement_LifeCycle.php?rev=2876144#L24) | […](/browser/slick-engagement/trunk/SlickEngagement_LifeCycle.php?rev=3184136#L29) |  |
  | 24 | 29 | } |
  | 25 | 30 |  |
  | 26 |  | public function uninstall() |
  | 27 |  | { |
  |  | 31 | public function uninstall(): void { |
  | 28 | 32 | $this->otherUninstall(); |
  | 29 | 33 | $this->unInstallDatabaseTables(); |
  | […](/browser/slick-engagement/trunk/SlickEngagement_LifeCycle.php?rev=2876144#L36) | […](/browser/slick-engagement/trunk/SlickEngagement_LifeCycle.php?rev=3184136#L40) |  |
  | 36 | 40 | \* @return void |
  | 37 | 41 | \*/ |
  | 38 |  | public function upgrade() |
  | 39 |  | { |
  |  | 42 | public function upgrade(): void {} |
  |  | 43 |  |
  |  | 44 | /\*\* |
  |  | 45 | \* @return void |
  |  | 46 | \*/ |
  |  | 47 | public function activate(): void { |
  |  | 48 | $this->slickLog("Activating"); |
  | 40 | 49 | } |
  | 41 | 50 |  |
  | 42 | 51 | /\*\* |
  | 43 |  | ~~\* See: http://plugin.michael-simpson.com/?page\_id=105~~ |
  | 44 | 52 | \* @return void |
  | 45 | 53 | \*/ |
  | 46 |  | public function activate() |
  | 47 |  | { |
  | 48 |  | $this->guildLog("Activating"); |
  | 49 |  | } |
  | 50 |  |  |
  | 51 |  | /\*\* |
  | 52 |  | \* See: http://plugin.michael-simpson.com/?page\_id=105 |
  | 53 |  | \* @return void |
  | 54 |  | \*/ |
  | 55 |  | public function deactivate() |
  | 56 |  | { |
  | 57 |  | $this->guildLog("Deactivating"); |
  |  | 54 | public function deactivate(): void { |
  |  | 55 | $this->slickLog("Deactivating"); |
  | 58 | 56 | // $this->uninstall(); |
  | 59 | 57 | } |
  | 60 | 58 |  |
  | 61 | 59 | /\*\* |
  | 62 |  | ~~\* See: http://plugin.michael-simpson.com/?page\_id=31~~ |
  | 63 | 60 | \* @return void |
  | 64 | 61 | \*/ |
  | 65 |  | protected function initOptions() |
  | 66 |  | { |
  | 67 |  | } |
  |  | 62 | protected function initOptions(): void {} |
  | 68 | 63 |  |
  | 69 |  | public function addActionsAndFilters() |
  | 70 |  | { |
  | 71 |  | } |
  |  | 64 | public function addActionsAndFilters(): void {} |
  | 72 | 65 |  |
  | 73 | 66 | /\*\* |
  | 74 |  | ~~\* See: http://plugin.michael-simpson.com/?page\_id=101~~ |
  | 75 | 67 | \* Called by install() to create any database tables if needed. |
  | 76 | 68 | \* Best Practice: |
  | […](/browser/slick-engagement/trunk/SlickEngagement_LifeCycle.php?rev=2876144#L79) | […](/browser/slick-engagement/trunk/SlickEngagement_LifeCycle.php?rev=3184136#L71) |  |
  | 79 | 71 | \* @return void |
  | 80 | 72 | \*/ |
  | 81 |  | protected function installDatabaseTables() |
  | 82 |  | { |
  | 83 |  | } |
  |  | 73 | protected function installDatabaseTables(): void {} |
  | 84 | 74 |  |
  | 85 | 75 | /\*\* |
  | 86 |  | ~~\* See: http://plugin.michael-simpson.com/?page\_id=101~~ |
  | 87 | 76 | \* Drop plugin-created tables on uninstall. |
  | 88 | 77 | \* @return void |
  | 89 | 78 | \*/ |
  | 90 |  | protected function unInstallDatabaseTables() |
  | 91 |  | { |
  | 92 |  | } |
  |  | 79 | protected function unInstallDatabaseTables(): void {} |
  | 93 | 80 |  |
  | 94 | 81 | /\*\* |
  | 95 | 82 | \* Override to add any additional actions to be done at install time |
  | 96 |  | ~~\* See: http://plugin.michael-simpson.com/?page\_id=33~~ |
  | 97 | 83 | \* @return void |
  | 98 | 84 | \*/ |
  | 99 |  | protected function otherInstall() |
  | 100 |  | { |
  | 101 |  | } |
  |  | 85 | protected function otherInstall(): void {} |
  | 102 | 86 |  |
  | 103 | 87 | /\*\* |
  | 104 | 88 | \* Override to add any additional actions to be done at uninstall time |
  | 105 |  | ~~\* See: http://plugin.michael-simpson.com/?page\_id=33~~ |
  | 106 | 89 | \* @return void |
  | 107 | 90 | \*/ |
  | 108 |  | protected function otherUninstall() |
  | 109 |  | { |
  | 110 |  | } |
  |  | 91 | protected function otherUninstall(): void {} |
  | 111 | 92 |  |
  | 112 |  | /\*\* |
  | 113 |  | \* Puts the configuration page in the Plugins menu by default. |
  | 114 |  | \* Override to put it elsewhere or create a set of submenus |
  | 115 |  | \* Override with an empty implementation if you don't want a configuration page |
  | 116 |  | \* @return void |
  | 117 |  | \*/ |
  | 118 |  | public function addSettingsSubMenuPage() |
  | 119 |  | { |
  | 120 |  | //$this->addSettingsSubMenuPageToPluginsMenu(); |
  | 121 |  | $this->addSettingsSubMenuPageToSettingsMenu(); |
  | 122 |  | } |
  | 123 |  |  |
  | 124 |  | protected function requireExtraPluginFiles() |
  | 125 |  | { |
  |  | 93 | protected function requireExtraPluginFiles(): void { |
  | 126 | 94 | require\_once ABSPATH . 'wp-includes/pluggable.php'; |
  | 127 | 95 | require\_once ABSPATH . 'wp-admin/includes/plugin.php'; |
  | 128 |  | ~~}~~ |
  | 129 |  |  |
  | 130 |  | ~~/\*\*~~ |
  | 131 |  | ~~\* @return string Slug name for the URL to the Setting page~~ |
  | 132 |  | ~~\* (i.e. the page for setting options)~~ |
  | 133 |  | ~~\*/~~ |
  | 134 |  | ~~protected function getSettingsSlug()~~ |
  | 135 |  | ~~{~~ |
  | 136 |  | ~~return get\_class($this) . 'Settings';~~ |
  | 137 |  | ~~}~~ |
  | 138 |  |  |
  | 139 |  | ~~protected function addSettingsSubMenuPageToPluginsMenu()~~ |
  | 140 |  | ~~{~~ |
  | 141 |  | ~~$this->requireExtraPluginFiles();~~ |
  | 142 |  | ~~$displayName = $this->getPluginDisplayName();~~ |
  | 143 |  | ~~add\_submenu\_page('plugins.php',~~ |
  | 144 |  | ~~$displayName,~~ |
  | 145 |  | ~~$displayName,~~ |
  | 146 |  | ~~'manage\_options',~~ |
  | 147 |  | ~~$this->getSettingsSlug(),~~ |
  | 148 |  | ~~array(&$this, 'settingsPage'));~~ |
  | 149 |  | ~~}~~ |
  | 150 |  |  |
  | 151 |  | ~~protected function addSettingsSubMenuPageToSettingsMenu()~~ |
  | 152 |  | ~~{~~ |
  | 153 |  | ~~$this->requireExtraPluginFiles();~~ |
  | 154 |  | ~~$displayName = $this->getPluginDisplayName();~~ |
  | 155 |  | ~~add\_options\_page($displayName,~~ |
  | 156 |  | ~~$displayName,~~ |
  | 157 |  | ~~'manage\_options',~~ |
  | 158 |  | ~~$this->getSettingsSlug(),~~ |
  | 159 |  | ~~array(&$this, 'settingsPage'));~~ |
  | 160 | 96 | } |
  | 161 | 97 |  |
  | […](/browser/slick-engagement/trunk/SlickEngagement_LifeCycle.php?rev=2876144#L167) | […](/browser/slick-engagement/trunk/SlickEngagement_LifeCycle.php?rev=3184136#L103) |  |
  | 167 | 103 | \* avoid issues on some platforms |
  | 168 | 104 | \*/ |
  | 169 |  | protected function prefixTableName($name) |
  | 170 |  | { |
  |  | 105 | protected function prefixTableName($name): string { |
  | 171 | 106 | global $wpdb; |
  | 172 | 107 | return $wpdb->prefix . strtolower($this->prefix($name)); |
  | […](/browser/slick-engagement/trunk/SlickEngagement_LifeCycle.php?rev=2876144#L189) | […](/browser/slick-engagement/trunk/SlickEngagement_LifeCycle.php?rev=3184136#L124) |  |
  | 189 | 124 | \* @return string URL that can be used in a web page to make an Ajax call to $this->functionName |
  | 190 | 125 | \*/ |
  | 191 |  | public function getAjaxUrl($actionName) |
  | 192 |  | { |
  |  | 126 | public function getAjaxUrl($actionName): string { |
  | 193 | 127 | return admin\_url('admin-ajax.php') . '?action=' . $actionName; |
  | 194 | 128 | } |
  | 195 | 129 |  |
  | 196 |  | public function guildLog($msg, $name = '') |
  | 197 |  | { |
  |  | 130 | public function slickLog($msg, $name = ''): void { |
  | 198 | 131 | // Print the name of the calling function if $name is left empty |
  | 199 | 132 | $trace = debug\_backtrace(); |
  | 200 |  | $name = ('' == $name) ? $trace[1]['function'] : $name; |
  |  | 133 | $name = ('' === $name) ? $trace[1]['function'] : $name; |
  | 201 | 134 | $msg = print\_r($msg, true); |
  | 202 |  | $log = "Slick~~: " . $name . "  |  " . $msg . "~~\n"; |
  |  | 135 | $log = "Slickstream: $name | $msg\n"; |
  | 203 | 136 | error\_log($log); |
  | 204 | 137 | } |
  | 205 |  |  |
  | 206 | 138 | } |
* ## [slick-engagement/trunk/SlickEngagement\_OptionsManager.php](/changeset/3184136/slick-engagement/trunk/SlickEngagement_OptionsManager.php "Show the changeset 3184136 restricted to slick-engagement/trunk/SlickEngagement_OptionsManager.php")

  | [r2876144](/browser/slick-engagement/trunk/SlickEngagement_OptionsManager.php?rev=2876144#L1 "Show revision 2876144 of this file in browser") | [r3184136](/browser/slick-engagement/trunk/SlickEngagement_OptionsManager.php?rev=3184136#L1 "Show revision 3184136 of this file in browser") |  |
  | --- | --- | --- |
  | 1 |  | <?php |
  | 2 |  |  |
  | 3 |  | class SlickEngagement\_OptionsManager |
  | 4 |  | { |
  | 5 |  |  |
  | 6 |  | public function getOptionNamePrefix() |
  | 7 |  | { |
  | 8 |  | return get\_class($this) . '\_'; |
  |  | 1 | <?php |
  |  | 2 | declare(strict\_types=1); |
  |  | 3 | namespace Slickstream; |
  |  | 4 |  |
  |  | 5 | class OptionsManager { |
  |  | 6 | private $optionNamePrefix; |
  |  | 7 |  |
  |  | 8 | public function \_\_construct() { |
  |  | 9 | // Note: Do not change this or else settings from previous versions will not be able to be accessed |
  |  | 10 | $this->optionNamePrefix = 'SlickEngagement\_Plugin\_'; |
  | 9 | 11 | } |
  | 10 | 12 |  |
  | […](/browser/slick-engagement/trunk/SlickEngagement_OptionsManager.php?rev=2876144#L25) | […](/browser/slick-engagement/trunk/SlickEngagement_OptionsManager.php?rev=3184136#L27) |  |
  | 25 | 27 | \*       'Rating:', 'Excellent', 'Good', 'Fair', 'Poor') |
  | 26 | 28 | \*/ |
  | 27 |  | public function getOptionMetaData() |
  | 28 |  | { |
  | 29 |  | return array(); |
  |  | 29 | public function getOptionMetaData(): array { |
  |  | 30 | return []; |
  | 30 | 31 | } |
  | 31 | 32 |  |
  | […](/browser/slick-engagement/trunk/SlickEngagement_OptionsManager.php?rev=2876144#L33) | […](/browser/slick-engagement/trunk/SlickEngagement_OptionsManager.php?rev=3184136#L34) |  |
  | 33 | 34 | \* @return array of string name of options |
  | 34 | 35 | \*/ |
  | 35 |  | public function getOptionNames() |
  | 36 |  | { |
  |  | 36 | public function getOptionNames(): array { |
  | 37 | 37 | return array\_keys($this->getOptionMetaData()); |
  | 38 | 38 | } |
  | […](/browser/slick-engagement/trunk/SlickEngagement_OptionsManager.php?rev=2876144#L42) | […](/browser/slick-engagement/trunk/SlickEngagement_OptionsManager.php?rev=3184136#L42) |  |
  | 42 | 42 | \* @return void |
  | 43 | 43 | \*/ |
  | 44 |  | protected function initOptions() |
  | 45 |  | { |
  | 46 |  | } |
  |  | 44 | protected function initOptions(): void {} |
  | 47 | 45 |  |
  | 48 | 46 | /\*\* |
  | […](/browser/slick-engagement/trunk/SlickEngagement_OptionsManager.php?rev=2876144#L50) | […](/browser/slick-engagement/trunk/SlickEngagement_OptionsManager.php?rev=3184136#L48) |  |
  | 50 | 48 | \* @return void |
  | 51 | 49 | \*/ |
  | 52 |  | protected function deleteSavedOptions() |
  | 53 |  | { |
  |  | 50 | protected function deleteSavedOptions(): void  { |
  | 54 | 51 | $optionMetaData = $this->getOptionMetaData(); |
  | 55 | 52 | if (is\_array($optionMetaData)) { |
  | 56 | 53 | foreach ($optionMetaData as $aOptionKey => $aOptionMeta) { |
  | 57 |  | $prefixedOptionName = $this->prefix($aOptionKey);~~// how it is stored in DB~~ |
  |  | 54 | $prefixedOptionName = $this->prefix($aOptionKey); |
  | 58 | 55 | delete\_option($prefixedOptionName); |
  | 59 | 56 | } |
  | […](/browser/slick-engagement/trunk/SlickEngagement_OptionsManager.php?rev=2876144#L65) | […](/browser/slick-engagement/trunk/SlickEngagement_OptionsManager.php?rev=3184136#L62) |  |
  | 65 | 62 | \* Just returns the class name. Override this method to return something more readable |
  | 66 | 63 | \*/ |
  | 67 |  | public function getPluginDisplayName() |
  | 68 |  | { |
  | 69 |  | return get\_class($this); |
  | 70 |  | } |
  | 71 |  |  |
  |  | 64 | public function getPluginDisplayName(): string { |
  |  | 65 | return 'Slickstream Engagement'; |
  |  | 66 | } |
  |  | 67 |  |
  | 72 | 68 | /\*\* |
  | 73 | 69 | \* Get the prefixed version input $name suitable for storing in WP options |
  | […](/browser/slick-engagement/trunk/SlickEngagement_OptionsManager.php?rev=2876144#L76) | […](/browser/slick-engagement/trunk/SlickEngagement_OptionsManager.php?rev=3184136#L72) |  |
  | 76 | 72 | \* @return string |
  | 77 | 73 | \*/ |
  | 78 |  | public function prefix($name) |
  | 79 |  | { |
  | 80 |  | $optionNamePrefix = $this->getOptionNamePrefix(); |
  | 81 |  | if (strpos($name, $optionNamePrefix) === 0) { // 0 but not false |
  |  | 74 | public function prefix($name): string { |
  |  | 75 | if (strpos($name, $this->optionNamePrefix) === 0) { // 0 but not false |
  | 82 | 76 | return $name; // already prefixed |
  | 83 | 77 | } |
  | 84 |  | return $optionNamePrefix . $name; |
  | 85 |  | } |
  | 86 |  |  |
  | 87 |  | /\*\* |
  | 88 |  | \* Remove the prefix from the input $name. |
  | 89 |  | \* Idempotent: If no prefix found, just returns what was input. |
  | 90 |  | \* @param  $name string |
  | 91 |  | \* @return string $optionName without the prefix. |
  | 92 |  | \*/ |
  | 93 |  | public function &unPrefix($name) |
  | 94 |  | { |
  | 95 |  | $optionNamePrefix = $this->getOptionNamePrefix(); |
  | 96 |  | if (strpos($name, $optionNamePrefix) === 0) { |
  | 97 |  | return substr($name, strlen($optionNamePrefix)); |
  | 98 |  | } |
  | 99 |  | return $name; |
  |  | 78 | return $this->optionNamePrefix . $name; |
  | 100 | 79 | } |
  | 101 | 80 |  |
  | […](/browser/slick-engagement/trunk/SlickEngagement_OptionsManager.php?rev=2876144#L108) | […](/browser/slick-engagement/trunk/SlickEngagement_OptionsManager.php?rev=3184136#L87) |  |
  | 108 | 87 | \* if option is not set. |
  | 109 | 88 | \*/ |
  | 110 |  | public function getOption($optionName, $default = null) |
  | 111 |  | { |
  | 112 |  | $prefixedOptionName = $this->prefix($optionName); // how it is stored in DB |
  |  | 89 | public function getOption($optionName, $default = null): string { |
  |  | 90 | $prefixedOptionName = $this->prefix($optionName); |
  | 113 | 91 | $retVal = get\_option($prefixedOptionName); |
  | 114 | 92 | if (!$retVal && $default) { |
  | 115 | 93 | $retVal = $default; |
  | 116 | 94 | } |
  | 117 |  | return $retVal; |
  |  | 95 | return (string) $retVal; |
  | 118 | 96 | } |
  | 119 | 97 |  |
  | […](/browser/slick-engagement/trunk/SlickEngagement_OptionsManager.php?rev=2876144#L124) | […](/browser/slick-engagement/trunk/SlickEngagement_OptionsManager.php?rev=3184136#L102) |  |
  | 124 | 102 | \* @return bool from delegated call to delete\_option() |
  | 125 | 103 | \*/ |
  | 126 |  | public function deleteOption($optionName) |
  | 127 |  | { |
  | 128 |  | $prefixedOptionName = $this->prefix($optionName); // how it is stored in DB |
  |  | 104 | public function deleteOption($optionName): bool { |
  |  | 105 | $prefixedOptionName = $this->prefix($optionName); |
  | 129 | 106 | return delete\_option($prefixedOptionName); |
  | 130 | 107 | } |
  | […](/browser/slick-engagement/trunk/SlickEngagement_OptionsManager.php?rev=2876144#L137) | […](/browser/slick-engagement/trunk/SlickEngagement_OptionsManager.php?rev=3184136#L114) |  |
  | 137 | 114 | \* @return null from delegated call to delete\_option() |
  | 138 | 115 | \*/ |
  | 139 |  | public function addOption($optionName, $value) |
  | 140 |  | { |
  | 141 |  | $prefixedOptionName = $this->prefix($optionName); // how it is stored in DB |
  |  | 116 | public function addOption($optionName, $value): bool { |
  |  | 117 | $prefixedOptionName = $this->prefix($optionName); |
  | 142 | 118 | return add\_option($prefixedOptionName, $value); |
  | 143 | 119 | } |
  | […](/browser/slick-engagement/trunk/SlickEngagement_OptionsManager.php?rev=2876144#L150) | […](/browser/slick-engagement/trunk/SlickEngagement_OptionsManager.php?rev=3184136#L126) |  |
  | 150 | 126 | \* @return null from delegated call to delete\_option() |
  | 151 | 127 | \*/ |
  | 152 |  | public function updateOption($optionName, $value) |
  | 153 |  | { |
  | 154 |  | $prefixedOptionName = $this->prefix($optionName); // how it is stored in DB |
  |  | 128 | public function updateOption($optionName, $value): bool { |
  |  | 129 | $prefixedOptionName = $this->prefix($optionName); |
  | 155 | 130 | return update\_option($prefixedOptionName, $value); |
  | 156 | 131 | } |
  | […](/browser/slick-engagement/trunk/SlickEngagement_OptionsManager.php?rev=2876144#L166) | […](/browser/slick-engagement/trunk/SlickEngagement_OptionsManager.php?rev=3184136#L141) |  |
  | 166 | 141 | \* @return string role name |
  | 167 | 142 | \*/ |
  | 168 |  | public function getRoleOption($optionName) |
  | 169 |  | { |
  |  | 143 | public function getRoleOption($optionName): string { |
  | 170 | 144 | $roleAllowed = $this->getOption($optionName); |
  | 171 | 145 | if (!$roleAllowed || $roleAllowed == '') { |
  | […](/browser/slick-engagement/trunk/SlickEngagement_OptionsManager.php?rev=2876144#L181) | […](/browser/slick-engagement/trunk/SlickEngagement_OptionsManager.php?rev=3184136#L155) |  |
  | 181 | 155 | \* @return string a WP capability or '' if unknown input role |
  | 182 | 156 | \*/ |
  | 183 |  | protected function roleToCapability($roleName) |
  | 184 |  | { |
  |  | 157 | protected function roleToCapability($roleName): string { |
  | 185 | 158 | switch ($roleName) { |
  | 186 | 159 | case 'Super Admin': |
  | […](/browser/slick-engagement/trunk/SlickEngagement_OptionsManager.php?rev=2876144#L206) | […](/browser/slick-engagement/trunk/SlickEngagement_OptionsManager.php?rev=3184136#L179) |  |
  | 206 | 179 | \* @return bool |
  | 207 | 180 | \*/ |
  | 208 |  | public function isUserRoleEqualOrBetterThan($roleName) |
  | 209 |  | { |
  |  | 181 | public function isUserRoleEqualOrBetterThan($roleName): bool { |
  | 210 | 182 | if ('Anyone' == $roleName) { |
  | 211 | 183 | return true; |
  | […](/browser/slick-engagement/trunk/SlickEngagement_OptionsManager.php?rev=2876144#L219) | […](/browser/slick-engagement/trunk/SlickEngagement_OptionsManager.php?rev=3184136#L191) |  |
  | 219 | 191 | \* @return bool indicates if the user has adequate permissions |
  | 220 | 192 | \*/ |
  | 221 |  | public function canUserDoRoleOption($optionName) |
  | 222 |  | { |
  |  | 193 | public function canUserDoRoleOption($optionName): bool { |
  | 223 | 194 | $roleAllowed = $this->getRoleOption($optionName); |
  | 224 | 195 | if ('Anyone' == $roleAllowed) { |
  | […](/browser/slick-engagement/trunk/SlickEngagement_OptionsManager.php?rev=2876144#L229) | […](/browser/slick-engagement/trunk/SlickEngagement_OptionsManager.php?rev=3184136#L200) |  |
  | 229 | 200 |  |
  | 230 | 201 | /\*\* |
  | 231 |  | ~~\* see: http://codex.wordpress.org/Creating\_Options\_Pages~~ |
  | 232 |  | ~~\* @return void~~ |
  | 233 |  | ~~\*/~~ |
  | 234 |  | ~~public function createSettingsMenu()~~ |
  | 235 |  | ~~{~~ |
  | 236 |  | ~~$pluginName = $this->getPluginDisplayName();~~ |
  | 237 |  | ~~//create new top-level menu~~ |
  | 238 |  | ~~add\_menu\_page($pluginName . ' Plugin Settings',~~ |
  | 239 |  | ~~$pluginName,~~ |
  | 240 |  | ~~'administrator',~~ |
  | 241 |  | ~~get\_class($this),~~ |
  | 242 |  | ~~array(&$this, 'settingsPage')~~ |
  | 243 |  | ~~/\*,plugins\_url('/images/icon.png', \_\_FILE\_\_)\*/); // if you call 'plugins\_url; be sure to "require\_once" it~~ |
  | 244 |  |  |
  | 245 |  | ~~//call register settings function~~ |
  | 246 |  | ~~add\_action('admin\_init', array(&$this, 'registerSettings'));~~ |
  | 247 |  | ~~}~~ |
  | 248 |  |  |
  | 249 |  | ~~public function registerSettings()~~ |
  | 250 |  | ~~{~~ |
  | 251 |  | ~~$settingsGroup = get\_class($this) . '-settings-group';~~ |
  | 252 |  | ~~$optionMetaData = $this->getOptionMetaData();~~ |
  | 253 |  | ~~foreach ($optionMetaData as $aOptionKey => $aOptionMeta) {~~ |
  | 254 |  | ~~register\_setting($settingsGroup, $aOptionMeta);~~ |
  | 255 |  | ~~}~~ |
  | 256 |  | ~~}~~ |
  | 257 |  |  |
  | 258 |  | ~~/\*\*~~ |
  | 259 | 202 | \* Creates HTML for the Administration page to set options for this plugin. |
  | 260 | 203 | \* Override this method to create a customized page. |
  | 261 | 204 | \* @return void |
  | 262 | 205 | \*/ |
  | 263 |  | public function settingsPage() |
  | 264 |  | { |
  |  | 206 | public function settingsPage(): void { |
  | 265 | 207 | if (!current\_user\_can('manage\_options')) { |
  | 266 | 208 | wp\_die(\_\_('You do not have sufficient permissions to access this page.', 'slick-engagement')); |
  | […](/browser/slick-engagement/trunk/SlickEngagement_OptionsManager.php?rev=2876144#L313) | […](/browser/slick-engagement/trunk/SlickEngagement_OptionsManager.php?rev=3184136#L255) |  |
  | 313 | 255 | <?php |
  | 314 | 256 | } |
  | 315 |  | } |
  |  | 257 | } //if ($optionMetaData != null) { |
  | 316 | 258 | ?> |
  | 317 | 259 | </tbody></table> |
  | […](/browser/slick-engagement/trunk/SlickEngagement_OptionsManager.php?rev=2876144#L336) | […](/browser/slick-engagement/trunk/SlickEngagement_OptionsManager.php?rev=3184136#L278) |  |
  | 336 | 278 | \* @return void |
  | 337 | 279 | \*/ |
  | 338 |  | protected function createFormControl($aOptionKey, $aOptionMeta, $savedOptionValue) |
  | 339 |  | { |
  |  | 280 | protected function createFormControl($aOptionKey, $aOptionMeta, $savedOptionValue): void { |
  | 340 | 281 | if (is\_array($aOptionMeta) && count($aOptionMeta) > 2) { // Drop-down list |
  | 341 | 282 | $choices = array\_slice($aOptionMeta, 1); |
  | […](/browser/slick-engagement/trunk/SlickEngagement_OptionsManager.php?rev=2876144#L376) | […](/browser/slick-engagement/trunk/SlickEngagement_OptionsManager.php?rev=3184136#L317) |  |
  | 376 | 317 | \* @return string \_\_($optionValue) if it is listed in this method, otherwise just returns $optionValue |
  | 377 | 318 | \*/ |
  | 378 |  | protected function getOptionValueI18nString($optionValue) |
  | 379 |  | { |
  |  | 319 | protected function getOptionValueI18nString($optionValue): string { |
  | 380 | 320 | switch ($optionValue) { |
  | 381 | 321 | case 'true': |
  | […](/browser/slick-engagement/trunk/SlickEngagement_OptionsManager.php?rev=2876144#L399) | […](/browser/slick-engagement/trunk/SlickEngagement_OptionsManager.php?rev=3184136#L339) |  |
  | 399 | 339 | return $optionValue; |
  | 400 | 340 | } |
  | 401 |  |  |
  | 402 |  | ~~/\*\*~~ |
  | 403 |  | ~~\* Query MySQL DB for its version~~ |
  | 404 |  | ~~\* @return string|false~~ |
  | 405 |  | ~~\*/~~ |
  | 406 |  | ~~protected function getMySqlVersion()~~ |
  | 407 |  | ~~{~~ |
  | 408 |  | ~~global $wpdb;~~ |
  | 409 |  | ~~$rows = $wpdb->get\_results('select version() as mysqlversion');~~ |
  | 410 |  | ~~if (!empty($rows)) {~~ |
  | 411 |  | ~~return $rows[0]->mysqlversion;~~ |
  | 412 |  | ~~}~~ |
  | 413 |  | ~~return false;~~ |
  | 414 |  | ~~}~~ |
  | 415 |  |  |
  | 416 |  | ~~/\*\*~~ |
  | 417 |  | ~~\* If you want to generate an email address like "no-reply@your-site.com" then~~ |
  | 418 |  | ~~\* you can use this to get the domain name part.~~ |
  | 419 |  | ~~\* E.g.  'no-reply@' . $this->getEmailDomain();~~ |
  | 420 |  | ~~\* This code was stolen from the wp\_mail function, where it generates a default~~ |
  | 421 |  | ~~\* from "wordpress@your-site.com"~~ |
  | 422 |  | ~~\* @return string domain name~~ |
  | 423 |  | ~~\*/~~ |
  | 424 |  | ~~public function getEmailDomain()~~ |
  | 425 |  | ~~{~~ |
  | 426 |  | ~~// Get the site domain and get rid of www.~~ |
  | 427 |  | ~~$sitename = strtolower($\_SERVER['SERVER\_NAME']);~~ |
  | 428 |  | ~~if (substr($sitename, 0, 4) == 'www.') {~~ |
  | 429 |  | ~~$sitename = substr($sitename, 4);~~ |
  | 430 |  | ~~}~~ |
  | 431 |  | ~~return $sitename;~~ |
  | 432 |  | ~~}~~ |
  | 433 | 341 | } |
* ## [slick-engagement/trunk/SlickEngagement\_Plugin.php](/changeset/3184136/slick-engagement/trunk/SlickEngagement_Plugin.php "Show the changeset 3184136 restricted to slick-engagement/trunk/SlickEngagement_Plugin.php")

  | [r3104175](/browser/slick-engagement/trunk/SlickEngagement_Plugin.php?rev=3104175#L1 "Show revision 3104175 of this file in browser") | [r3184136](/browser/slick-engagement/trunk/SlickEngagement_Plugin.php?rev=3184136#L1 "Show revision 3184136 of this file in browser") |  |
  | --- | --- | --- |
  | 1 | 1 | <?php |
  | 2 |  | //NOTE: All inline JS scripts embedded by the plugin need to have the string `slickstream` somewhere in them; |
  | 3 |  | //  This allows the string `slickstream` to be used in WP-Rocket lazy load exclusions |
  | 4 |  |  |
  | 5 |  | include\_once 'SlickEngagement\_LifeCycle.php'; |
  | 6 |  | include\_once 'SlickEngagement\_Widgets.php'; |
  | 7 |  |  |
  | 8 |  | define('PLUGIN\_VERSION', '1.4.4'); |
  | 9 |  |  |
  | 10 |  | define("GENESIS\_AFTER\_HEADER\_POSTS", "After header on posts (for Genesis themes)"); |
  | 11 |  | define("GENESIS\_BEFORE\_CONTENT\_POSTS", "Before content on posts (for Genesis themes)"); |
  | 12 |  | define("GENESIS\_AFTER\_CONTENT", "After content (for Genesis themes)"); |
  | 13 |  | define("GENESIS\_BEFORE\_FOOTER", "Before footer (for Genesis themes)"); |
  | 14 |  |  |
  | 15 |  | class SlickEngagement\_Plugin extends SlickEngagement\_LifeCycle |
  | 16 |  | { |
  | 17 |  | private $consoleOutput = ""; |
  | 18 |  | private $scriptClass = 'slickstream-script'; |
  | 19 |  | const defaultServerUrl = 'https://app.slickstream.com'; |
  | 20 |  | /\*\* |
  | 21 |  | \* @return array of option meta data. |
  | 22 |  | \*/ |
  | 23 |  | public function getOptionMetaData() |
  | 24 |  | { |
  | 25 |  | $options = array( |
  | 26 |  | 'SiteCode' => array(\_\_('Site Code', 'slick-engagement')), |
  | 27 |  | 'SlickServerUrl' => array(\_\_('Service URL (optional)', 'slick-engagement')), |
  | 28 |  | ); |
  | 29 |  |  |
  | 30 |  | if (function\_exists('genesis')) { |
  | 31 |  | $options = array\_merge($options, [ |
  | 32 |  | 'InsertFilmstrip' => array(\_\_('Insert filmstrip', 'slick-engagement'), 'None', GENESIS\_AFTER\_HEADER\_POSTS, GENESIS\_BEFORE\_CONTENT\_POSTS), |
  | 33 |  | 'InsertSearchPanel' => array(\_\_('Insert inline search panel', 'slick-engagement'), 'None', GENESIS\_AFTER\_CONTENT, GENESIS\_BEFORE\_FOOTER), |
  | 34 |  | ]); |
  | 35 |  | } |
  | 36 |  |  |
  | 37 |  | return $options; |
  | 38 |  | } |
  | 39 |  |  |
  | 40 |  | protected function addOptionsFromArray($options) |
  | 41 |  | { |
  | 42 |  | foreach ($options as $key => $arr) { |
  | 43 |  | if (is\_array($arr) && count($arr) > 1) { |
  | 44 |  | $this->addOption($key, $arr[1]); |
  | 45 |  | } |
  | 46 |  | } |
  | 47 |  | } |
  | 48 |  |  |
  | 49 |  | protected function initOptions() |
  | 50 |  | { |
  | 51 |  | $options = $this->getOptionMetaData(); |
  | 52 |  | if (!empty($options)) { |
  | 53 |  | $this->addOptionsFromArray($options); |
  | 54 |  | } |
  | 55 |  | } |
  | 56 |  |  |
  | 57 |  | public function getPluginDisplayName() |
  | 58 |  | { |
  | 59 |  | return 'Slickstream Engagement'; |
  | 60 |  | } |
  | 61 |  |  |
  | 62 |  | protected function getMainPluginFileName() |
  | 63 |  | { |
  | 64 |  | return 'slick-engagement.php'; |
  | 65 |  | } |
  | 66 |  |  |
  | 67 |  | protected function installDatabaseTables() |
  | 68 |  | { |
  | 69 |  | } |
  | 70 |  |  |
  | 71 |  | protected function unInstallDatabaseTables() |
  | 72 |  | { |
  | 73 |  | } |
  | 74 |  |  |
  | 75 |  | public function upgrade() |
  | 76 |  | { |
  | 77 |  | } |
  | 78 |  |  |
  | 79 |  | public function addActionsAndFilters() |
  | 80 |  | { |
  | 81 |  | // Add options administration page |
  | 82 |  | add\_action('admin\_menu', array(&$this, 'addSettingsSubMenuPage')); |
  | 83 |  |  |
  | 84 |  | // Add Actions & Filters |
  | 85 |  | add\_action('wp\_head', array(&$this, 'addSlickPageHeader')); |
  | 86 |  |  |
  | 87 |  | // Adding scripts & styles to all pages |
  | 88 |  | // Examples: |
  | 89 |  | //        wp\_enqueue\_script('jquery'); |
  | 90 |  | //        wp\_enqueue\_style('my-style', plugins\_url('/css/my-style.css', \_\_FILE\_\_)); |
  | 91 |  | //        wp\_enqueue\_script('my-script', plugins\_url('/js/my-script.js', \_\_FILE\_\_)); |
  | 92 |  |  |
  | 93 |  | // Register short codes |
  | 94 |  | add\_shortcode('slick-film-strip', array($this, 'doFilmStripShortcode')); |
  | 95 |  | add\_shortcode('slick-game', array($this, 'doGameShortcode')); |
  | 96 |  | // add\_shortcode('slick-next-up', array($this, 'doNextUpShortcode')); |
  | 97 |  | add\_shortcode('slick-grid', array($this, 'doSlickGridShortcode')); |
  | 98 |  | add\_shortcode('slick-story', array($this, 'doSlickStoryShortcode')); |
  | 99 |  | add\_shortcode('slick-story-carousel', array($this, 'doSlickStoryCarouselShortcode')); |
  | 100 |  | add\_shortcode('slick-story-explorer', array($this, 'doSlickStoryExplorerShortcode')); |
  | 101 |  |  |
  | 102 |  | // Register AJAX hooks |
  | 103 |  | // Ensure pages can be configured with categories and tags |
  | 104 |  | add\_action('init', array(&$this, 'add\_taxonomies\_to\_pages')); |
  | 105 |  |  |
  | 106 |  | $prefix = is\_network\_admin() ? 'network\_admin\_' : ''; |
  | 107 |  | $plugin\_file = plugin\_basename($this->getPluginDir() . DIRECTORY\_SEPARATOR . $this->getMainPluginFileName()); //plugin\_basename( $this->getMainPluginFileName() ); |
  | 108 |  | // $this->guildLog('Adding filter ' . "{$prefix}plugin\_action\_links\_{$plugin\_file}"); |
  | 109 |  | add\_filter("{$prefix}plugin\_action\_links\_{$plugin\_file}", array(&$this, 'onActionLinks')); |
  | 110 |  |  |
  | 111 |  | add\_filter('rocket\_delay\_js\_exclusions', array(&$this, 'np\_wp\_rocket\_\_exclude\_from\_delay\_js')); |
  | 112 |  |  |
  | 113 |  | $this->maybe\_add\_genesis\_hooks(); |
  | 114 |  | } |
  | 115 |  |  |
  | 116 |  | private function maybe\_add\_genesis\_hooks() { |
  | 117 |  | $insertFilmstrip = $this->getOption('InsertFilmstrip', 'None'); |
  | 118 |  | if ($insertFilmstrip === GENESIS\_AFTER\_HEADER\_POSTS) { |
  | 119 |  | add\_action('genesis\_after\_header', array($this, 'insert\_film\_strip\_markup'), 15); |
  | 120 |  | } else if ($insertFilmstrip === GENESIS\_BEFORE\_CONTENT\_POSTS) { |
  | 121 |  | add\_action('genesis\_before\_content', array($this, 'insert\_film\_strip\_markup'), 15); |
  | 122 |  | } |
  | 123 |  |  |
  | 124 |  | $InsertSearchPanel = $this->getOption('InsertSearchPanel', 'None'); |
  | 125 |  | if ($InsertSearchPanel === GENESIS\_AFTER\_CONTENT) { |
  | 126 |  | add\_action('genesis\_after\_content', array($this, 'insert\_inline\_search\_panel\_markup'), 15); |
  | 127 |  | } else if ($InsertSearchPanel === GENESIS\_BEFORE\_FOOTER) { |
  | 128 |  | add\_action('genesis\_before\_footer', array($this, 'insert\_inline\_search\_panel\_markup'), 15); |
  | 129 |  | } |
  | 130 |  | } |
  | 131 |  |  |
  | 132 |  | public function insert\_film\_strip\_markup() |
  | 133 |  | { |
  | 134 |  | if (is\_singular('post')) { |
  | 135 |  | echo '<div style="min-height:72px;margin:10px auto" class="slick-film-strip"></div>'; |
  | 136 |  | } |
  | 137 |  | } |
  | 138 |  |  |
  | 139 |  | public function insert\_inline\_search\_panel\_markup() |
  | 140 |  | { |
  | 141 |  | if (is\_singular('post')) { |
  | 142 |  | echo "\n" . '<style>.slick-inline-search-panel { margin: 50px 15px; min-height: 428px; } @media (max-width: 600px) { .slick-inline-search-panel { min-height: 334px; } } </style>' . "\n"; |
  | 143 |  | echo '<div class="slick-inline-search-panel" data-config="\_default"></div>' . "\n"; |
  | 144 |  | } |
  | 145 |  | } |
  | 146 |  |  |
  | 147 |  | // Exclude scripts from JS delay in WP-Rocket. |
  | 148 |  | public function np\_wp\_rocket\_\_exclude\_from\_delay\_js($excluded\_strings = array()) |
  | 149 |  | { |
  | 150 |  | // MUST ESCAPE PERIODS AND PARENTHESES! |
  | 151 |  | $excluded\_strings[] = "slickstream"; |
  | 152 |  | $excluded\_strings[] = "Slickstream"; |
  | 153 |  | $excluded\_strings[] = "SLICKSTREAM"; |
  | 154 |  | $excluded\_strings[] = "ads\.adthrive\.com"; |
  | 155 |  | return $excluded\_strings; |
  | 156 |  | } |
  | 157 |  |  |
  | 158 |  | public function onActionLinks($links) |
  | 159 |  | { |
  | 160 |  | // $this->guildLog('onActionLinks ' . admin\_url('options-general.php?page=SlickEngagement\_PluginSettings')); |
  | 161 |  | $mylinks = array('<a href="' . admin\_url('options-general.php?page=SlickEngagement\_PluginSettings') . '">Settings</a>'); |
  | 162 |  | return array\_merge($links, $mylinks); |
  | 163 |  | } |
  | 164 |  |  |
  | 165 |  | public function doFilmStripShortcode() |
  | 166 |  | { |
  | 167 |  | return '<div class="slick-widget slick-film-strip slick-shortcode"></div>'; |
  | 168 |  | } |
  | 169 |  |  |
  | 170 |  | public function doGameShortcode() |
  | 171 |  | { |
  | 172 |  | return '<div class="slick-widget slick-game-panel slick-shortcode"></div>'; |
  | 173 |  | } |
  | 174 |  |  |
  | 175 |  | // public function doNextUpShortcode() |
  | 176 |  | // { |
  | 177 |  | //     return '<div class="slick-widget slick-next-up slick-shortcode"></div>'; |
  | 178 |  | // } |
  | 179 |  |  |
  | 180 |  | public function doSlickGridShortcode($attrs, $content, $tag) |
  | 181 |  | { |
  | 182 |  | extract(shortcode\_atts(array('id' => ''), $attrs)); |
  | 183 |  | if (isset($id)) { |
  | 184 |  | return '<div class="slick-content-grid" data-config="' . trim($id) . '"></div>' . "\n"; |
  | 185 |  | } else { |
  | 186 |  | return '<div class="slick-content-grid"></div>' . "\n"; |
  | 187 |  | } |
  | 188 |  | } |
  | 189 |  |  |
  | 190 |  | public function doSlickStoryCarouselShortcode() |
  | 191 |  | { |
  | 192 |  | return '<style>.slick-story-carousel {min-height: 324px;} @media (max-width: 600px) {.slick-story-carousel {min-height: 224px;}}</style>' . "\n" . '<div class="slick-widget slick-story-carousel slick-shortcode"></div>'; |
  | 193 |  | } |
  | 194 |  |  |
  | 195 |  | public function doSlickStoryExplorerShortcode() |
  | 196 |  | { |
  | 197 |  | return '<div class="slick-widget slick-story-explorer slick-shortcode"></div>'; |
  | 198 |  | } |
  | 199 |  |  |
  | 200 |  | public function doSlickStoryShortcode($attrs, $content, $tag) |
  | 201 |  | { |
  | 202 |  | extract(shortcode\_atts(array('src' => ''), $attrs)); |
  | 203 |  | // We want to support different styles of short-code arguments: |
  | 204 |  | //   old-style: https://:channelid.stories.slickstream.com/d/story/:channelid/:storyid |
  | 205 |  | //   story page URL: https://stories.slickstream.com/:channelid/story/:storyid |
  | 206 |  | //   new-style: :channelid/:storyid |
  | 207 |  | $oldStyleRegex = '/^https\:\/\/([^\/]+)\/d\/story\/([^\/]+)\/([^\/]+)$/i'; |
  | 208 |  | $revisedStyleRegex = '/^https\:\/\/([^\/]+)\/([^\/]+)\/d\/story\/([^\/]+)$/i'; |
  | 209 |  | $storyPageRegex = '/^https\:\/\/([^\/]+)\/([^\/]+)\/story\/([^\/]+)$/i'; |
  | 210 |  | $newStyleRegex = '/^([^\/]+)\/([^\/]+)$/i'; |
  | 211 |  | $domain = "stories.slickstream.com"; |
  | 212 |  | $slickServerUrl = $this->getOption('SlickServerUrl', $defaultServerUrl); |
  | 213 |  | if (preg\_match('/\-staging\.slickstream/', $slickServerUrl)) { |
  | 214 |  | $domain = "stories-staging.slickstream.com"; |
  | 215 |  | } |
  | 216 |  | $channelid = "nochannel"; |
  | 217 |  | $storyid = ""; |
  | 218 |  | $webStoryUrl = ""; |
  | 219 |  | if (preg\_match\_all($oldStyleRegex, $src, $matches)) { |
  | 220 |  | $domain = $matches[1][0]; |
  | 221 |  | $channelid = $matches[2][0]; |
  | 222 |  | $storyid = $matches[3][0]; |
  | 223 |  | $webStoryUrl = $this->getSlickstreamWebStoryUrl($domain, $channelid, $storyid); |
  | 224 |  | } else if (preg\_match\_all($revisedStyleRegex, $src, $matches)) { |
  | 225 |  | $domain = $matches[1][0]; |
  | 226 |  | $channelid = $matches[2][0]; |
  | 227 |  | $storyid = $matches[3][0]; |
  | 228 |  | $webStoryUrl = $this->getSlickstreamWebStoryUrl($domain, $channelid, $storyid); |
  | 229 |  | } else if (preg\_match\_all($storyPageRegex, $src, $matches)) { |
  | 230 |  | $domain = $matches[1][0]; |
  | 231 |  | $channelid = $matches[2][0]; |
  | 232 |  | $storyid = $matches[3][0]; |
  | 233 |  | $webStoryUrl = $this->getSlickstreamWebStoryUrl($domain, $channelid, $storyid); |
  | 234 |  | } else if (preg\_match\_all($newStyleRegex, $src, $matches)) { |
  | 235 |  | $channelid = $matches[1][0]; |
  | 236 |  | $storyid = $matches[2][0]; |
  | 237 |  | $webStoryUrl = $this->getSlickstreamWebStoryUrl($domain, $channelid, $storyid); |
  | 238 |  | } else { |
  | 239 |  | $webStoryUrl = $src; |
  | 240 |  | } |
  | 241 |  | $output = ''; |
  | 242 |  | if (!empty($webStoryUrl)) { |
  | 243 |  | if (empty($storyId)) { |
  | 244 |  | $storyId = $this->getStoryIdFromUrl($webStoryUrl); |
  | 245 |  | } |
  | 246 |  | $output .= '<slick-webstory-player id="story-' . $storyId . '">' . "\n"; |
  | 247 |  | $output .= '  <a href="' . $webStoryUrl . '"></a>' . "\n"; |
  | 248 |  | $output .= '</slick-webstory-player>' . "\n"; |
  | 249 |  | } |
  | 250 |  | return $output; |
  | 251 |  | } |
  | 252 |  |  |
  | 253 |  | public function getStoryIdFromUrl($url) |
  | 254 |  | { |
  | 255 |  | if (strpos($url, 'slickstream.com') !== false && strpos($url, '/d/webstory') !== false) { |
  | 256 |  | $parts = explode('/', $url); |
  | 257 |  | if (count($parts) > 1) { |
  | 258 |  | if (!empty($parts[count($parts) - 1])) { |
  | 259 |  | return $parts[count($parts) - 1]; |
  | 260 |  | } |
  | 261 |  | } |
  | 262 |  | } |
  | 263 |  | return substr(hash('md5', $url), 0, 5); |
  | 264 |  | } |
  | 265 |  |  |
  | 266 |  | public function getSlickstreamWebStoryUrl($domain, $channelId, $storyId) |
  | 267 |  | { |
  | 268 |  | return 'https://' . $domain . '/' . $channelId . '/d/webstory/' . $storyId; |
  | 269 |  | } |
  | 270 |  |  |
  | 271 |  | public function add\_taxonomies\_to\_pages() |
  | 272 |  | { |
  | 273 |  | register\_taxonomy\_for\_object\_type('post\_tag', 'page'); |
  | 274 |  | register\_taxonomy\_for\_object\_type('category', 'page'); |
  | 275 |  | } |
  | 276 |  |  |
  | 277 |  | /\* determine whether post has a featured image, if not, find the first image inside the post content, $size passes the thumbnail size, $url determines whether to return a URL or a full image tag\*/ |
  | 278 |  | /\* adapted from http://www.amberweinberg.com/wordpress-find-featured-image-or-first-image-in-post-find-dimensions-id-by-url/ \*/ |
  | 279 |  | public function getPostImage($post) |
  | 280 |  | { |
  | 281 |  | ob\_start(); |
  | 282 |  | ob\_end\_clean(); |
  | 283 |  |  |
  | 284 |  | //If there's a featured image, show it |
  | 285 |  | if (has\_post\_thumbnail($post)) { |
  | 286 |  | $images = wp\_get\_attachment\_image\_src(get\_post\_thumbnail\_id($post), 'single-post-thumbnail'); |
  | 287 |  | return $images[0]; |
  | 288 |  | } else { |
  | 289 |  | $content = $post->post\_content; |
  | 290 |  | $first\_img = ''; |
  | 291 |  | $output = preg\_match\_all('/<img.+src=[\'"]([^\'"]+)[\'"].\*>/i', $content, $matches); |
  | 292 |  | $first\_img = $matches[1][0]; |
  | 293 |  |  |
  | 294 |  | //No featured image, so we get the first image inside the post content |
  | 295 |  | if ($first\_img) { |
  | 296 |  | return $first\_img; |
  | 297 |  | } else { |
  | 298 |  | return null; |
  | 299 |  | } |
  | 300 |  | } |
  | 301 |  | } |
  | 302 |  |  |
  | 303 |  | public function removeSemicolons($value) |
  | 304 |  | { |
  | 305 |  | return str\_replace(';', ' ', $value); |
  | 306 |  | } |
  | 307 |  |  |
  | 308 |  | // Fetches the Page Boot Data from the server |
  | 309 |  | //TODO: if we find that `/page-boot-data` requests are reduced enough to always use origin, we can add headers to avoid hitting CloudFlare |
  | 310 |  | private function fetchBootData($siteCode) |
  | 311 |  | { |
  | 312 |  | $protocol = ((!empty($\_SERVER['HTTPS']) && $\_SERVER['HTTPS'] != 'off') || $\_SERVER['SERVER\_PORT'] == 443) ? "https://" : "http://"; |
  | 313 |  | $page\_url = $protocol . $\_SERVER['HTTP\_HOST'] . $\_SERVER['REQUEST\_URI']; |
  | 314 |  | $remote = self::defaultServerUrl . '/d/page-boot-data?site=' . $siteCode . '&url=' . rawurlencode($page\_url); |
  | 315 |  | $headers = array('referer' => home\_url()); |
  | 316 |  | $this->echoSlickstreamComment("Fetch endpoint: " . $remote); |
  | 317 |  | $this->echoSlickstreamComment("Headers: " . json\_encode($headers)); |
  | 318 |  | $response = wp\_remote\_get($remote , array('timeout' => 2, 'headers' => $headers)); |
  | 319 |  | $response\_code = wp\_remote\_retrieve\_response\_code( $response ); |
  | 320 |  | $response\_text = wp\_remote\_retrieve\_body($response); |
  | 321 |  |  |
  | 322 |  | if ($response\_code === 200) { |
  | 323 |  | return json\_decode($response\_text); |
  | 324 |  | } else { |
  | 325 |  | $this->echoSlickstreamComment("Error fetching boot data: " . $response\_text); |
  | 326 |  | return null; |
  | 327 |  | } |
  | 328 |  | } |
  | 329 |  |  |
  | 330 |  | private function echoSlickBootJs($boot\_data\_obj) { |
  | 331 |  | $boot\_data\_json = json\_encode($boot\_data\_obj); |
  | 332 |  |  |
  | 333 |  | if (false === $boot\_data\_json) { |
  | 334 |  | $this->echoSlickstreamComment('Error encoding page boot data JSON'); |
  | 335 |  | return; |
  | 336 |  | } |
  | 337 |  |  |
  | 338 |  | $this->echoSlickstreamComment('Page Boot Data:', false); |
  | 339 |  |  |
  | 340 |  | echo <<<JSBLOCK |
  | 341 |  | <script class='$this->scriptClass'> |
  | 342 |  | (function() { |
  | 343 |  | "slickstream"; |
  | 344 |  | const win = window; |
  | 345 |  | win.\$slickBoot = win.\$slickBoot || {}; |
  | 346 |  | win.\$slickBoot.d = ${boot\_data\_json}; |
  | 347 |  | win.\$slickBoot.s = 'plugin'; |
  | 348 |  | win.\$slickBoot.\_bd = performance.now(); |
  | 349 |  | })(); |
  | 350 |  | </script>\n |
  | 351 |  | JSBLOCK; |
  | 352 |  |  |
  | 353 |  | $this->echoSlickstreamComment('END Page Boot Data', false); |
  | 354 |  | } |
  | 355 |  |  |
  | 356 |  | private function isMobile() { |
  | 357 |  | if (isset($\_SERVER['HTTP\_USER\_AGENT'])) { |
  | 358 |  | $user\_agent = $\_SERVER['HTTP\_USER\_AGENT']; |
  | 359 |  | $excluded = preg\_match('/Tablet|iPad|Playbook|Nook|webOS|Kindle|Android (?!.\*Mobile).\*Safari/i', $user\_agent); |
  | 360 |  | $mobile = preg\_match('/Mobi|iP(hone|od)|Opera Mini/i', $user\_agent); |
  | 361 |  | return $mobile && !$excluded; |
  | 362 |  | } |
  | 363 |  | return false; |
  | 364 |  | } |
  | 365 |  |  |
  | 366 |  | private function getBootDataForDevice($boot\_data\_obj) { |
  | 367 |  | if (isset($boot\_data\_obj->v2)) { |
  | 368 |  | $boot\_data\_obj\_v2 = $boot\_data\_obj->v2; |
  | 369 |  | if (isset($boot\_data\_obj\_v2->phone) && $this->isMobile()) { |
  | 370 |  | return $boot\_data\_obj\_v2->phone; |
  | 371 |  | } |
  | 372 |  | return $boot\_data\_obj\_v2->desktop; |
  | 373 |  | } |
  | 374 |  | return $boot\_data\_obj; |
  | 375 |  | } |
  | 376 |  |  |
  | 377 |  | private function echoClsData($boot\_data\_obj) |
  | 378 |  | { |
  | 379 |  | $device\_boot\_data = $this->getBootDataForDevice($boot\_data\_obj); |
  | 380 |  |  |
  | 381 |  | $filmstrip\_config = isset($device\_boot\_data->filmstrip) ? $device\_boot\_data->filmstrip : ''; |
  | 382 |  | $dcm\_config = isset($device\_boot\_data->inlineSearch) ? $device\_boot\_data->inlineSearch : ''; |
  | 383 |  | $ec\_config = isset($device\_boot\_data->emailCapture) ? $device\_boot\_data->emailCapture : ''; |
  | 384 |  |  |
  | 385 |  | // from 1.2.5 settings |
  | 386 |  | $filmstrip\_margin = $this->getOption('ReserveFilmstripMargin', ''); |
  | 387 |  | $dcm\_margin = $this->getOption('ReserveDCMMargin', ''); |
  | 388 |  | if (!empty($filmstrip\_config) && !empty($filmstrip\_margin)) { |
  | 389 |  | $filmstrip\_config->marginLegacy = $filmstrip\_margin; |
  | 390 |  | } |
  | 391 |  | if (!empty($dcm\_config) && !empty($dcm\_margin)) { |
  | 392 |  | foreach ($dcm\_config as $config) { |
  | 393 |  | $config->marginLegacy = $dcm\_margin; |
  | 394 |  | } |
  | 395 |  | } |
  | 396 |  |  |
  | 397 |  | if (!empty($filmstrip\_config) || !empty($dcm\_config) || !empty($ec\_config)) { |
  | 398 |  | $filmstrip\_str = empty($filmstrip\_config) ? '' :  json\_encode($filmstrip\_config); |
  | 399 |  | $dcm\_str = empty($dcm\_config) ? '' :  json\_encode($dcm\_config); |
  | 400 |  | $ec\_str = empty($ec\_config) ? '' :  json\_encode($ec\_config); |
  | 401 |  |  |
  | 402 |  | $this->echoSlickstreamComment('CLS Insertion:', false); |
  | 403 |  |  |
  | 404 |  | echo "<script>\n"; |
  | 405 |  | echo '"use strict";(async(e,t,n)=>{const o="slickstream";const i=e?JSON.parse(e):null;const r=t?JSON.parse(t):null;const c=n?JSON.parse(n):null;if(i||r||c){const e=async()=>{if(document.body){if(i){m(i.selector,i.position||"after selector","slick-film-strip",i.minHeight||72,i.margin||i.marginLegacy||"10px auto")}if(r){r.forEach((e=>{if(e.selector){m(e.selector,e.position||"after selector","slick-inline-search-panel",e.minHeight||350,e.margin||e.marginLegacy||"50px 15px",e.id)}}))}if(c){s(c)}return}window.requestAnimationFrame(e)};window.requestAnimationFrame(e)}const s=async e=>{const t="slick-on-page";try{if(document.querySelector(`.${t}`)){return}const n=l()?e.minHeightMobile||220:e.minHeight||200;if(e.cssSelector){m(e.cssSelector,"before selector",t,n,"",undefined)}else{a(e.pLocation||3,t,n)}}catch(e){console.log("plugin","error",o,`Failed to inject ${t}`)}};const a=async(e,t,n)=>{const o=document.createElement("div");o.classList.add(t);o.classList.add("cls-inserted");o.style.minHeight=n+"px";const i=document.querySelectorAll("article p");if((i===null||i===void 0?void 0:i.length)>=e){const t=i[e-1];t.insertAdjacentElement("afterend",o);return o}const r=document.querySelectorAll("section.wp-block-template-part div.entry-content p");if((r===null||r===void 0?void 0:r.length)>=e){const t=r[e-1];t.insertAdjacentElement("afterend",o);return o}return null};const l=()=>{const e=navigator.userAgent;const t=/Tablet|iPad|Playbook|Nook|webOS|Kindle|Android (?!.\*Mobile).\*Safari/i.test(e);const n=/Mobi|iP(hone|od)|Opera Mini/i.test(e);return n&&!t};const d=async(e,t)=>{const n=Date.now();while(true){const o=document.querySelector(e);if(o){return o}const i=Date.now();if(i-n>=t){throw new Error("Timeout")}await u(200)}};const u=async e=>new Promise((t=>{setTimeout(t,e)}));const m=async(e,t,n,i,r,c)=>{try{const o=await d(e,5e3);const s=c?document.querySelector(`.${n}[data-config="${c}"]`):document.querySelector(`.${n}`);if(o&&!s){const e=document.createElement("div");e.style.minHeight=i+"px";e.style.margin=r;e.classList.add(n);e.classList.add("cls-inserted");if(c){e.dataset.config=c}switch(t){case"after selector":o.insertAdjacentElement("afterend",e);break;case"before selector":o.insertAdjacentElement("beforebegin",e);break;case"first child of selector":o.insertAdjacentElement("afterbegin",e);break;case"last child of selector":o.insertAdjacentElement("beforeend",e);break}return e}}catch(t){console.log("plugin","error",o,`Failed to inject ${n} for selector ${e}`)}return false}})' . "\n"; |
  | 406 |  | echo "('" . addslashes($filmstrip\_str) . "','" . addslashes($dcm\_str) . "','" . addslashes($ec\_str) . "');" . "\n"; |
  | 407 |  | echo "\n</script>\n"; |
  | 408 |  |  |
  | 409 |  | $this->echoSlickstreamComment('END CLS Insertion', false); |
  | 410 |  | } |
  | 411 |  | } |
  | 412 |  |  |
  | 413 |  | //Returns a name for the "page boot data" transient |
  | 414 |  | private function getTransientName() |
  | 415 |  | { |
  | 416 |  | DEFINE('PAGE\_BOOT\_DATA\_TRANSIENT\_PREFIX', 'slick\_page\_boot\_'); |
  | 417 |  | $normalized\_url = $\_SERVER['HTTP\_HOST'] . explode('?', $\_SERVER['REQUEST\_URI'])[0]; |
  | 418 |  | return PAGE\_BOOT\_DATA\_TRANSIENT\_PREFIX . md5($normalized\_url); |
  | 419 |  | } |
  | 420 |  |  |
  | 421 |  | private function isDebugModeEnabled() |
  | 422 |  | { |
  | 423 |  | $debugModeParam = $this->getQueryParamByName('slickdebug'); |
  | 424 |  | return $debugModeParam === "1"; |
  | 425 |  | } |
  | 426 |  |  |
  | 427 |  | private function echoSlickstreamComment($comment, $echoToConsole = true) |
  | 428 |  | { |
  | 429 |  | echo "<!-- [slickstream] " . $comment . " -->\n"; |
  | 430 |  |  |
  | 431 |  | if ($echoToConsole) { |
  | 432 |  | $this->consoleOutput .= $comment . "\n"; |
  | 433 |  | } |
  | 434 |  | } |
  | 435 |  |  |
  | 436 |  | private function debugCLS() |
  | 437 |  | { |
  |  | 2 | declare(strict\_types=1); |
  |  | 3 | namespace Slickstream; |
  |  | 4 |  |
  |  | 5 | // NOTE: All inline JS scripts embedded by the plugin need to have the string `slickstream` somewhere in them; |
  |  | 6 | // This allows the string `slickstream` to be used in WP-Rocket lazy load exclusions; ideally $scriptClass is added to each script |
  |  | 7 |  |
  |  | 8 | require\_once 'SlickEngagement\_Widgets.php'; |
  |  | 9 | require\_once 'SlickEngagement\_OptionsManager.php'; |
  |  | 10 | require\_once 'SlickEngagement\_PageBootData.php'; |
  |  | 11 | require\_once 'SlickEngagement\_Utils.php'; |
  |  | 12 |  |
  |  | 13 | class SlickEngagement\_Plugin extends OptionsManager  { |
  |  | 14 | private const PLUGIN\_VERSION = '2.0.0'; |
  |  | 15 | private const DEFAULT\_SERVER\_URL = 'app.slickstream.com'; |
  |  | 16 | private string $scriptClass = 'slickstream-script'; |
  |  | 17 | private string $serverUrlBase; |
  |  | 18 | private string $siteCode; |
  |  | 19 | private Utils $utils; |
  |  | 20 |  |
  |  | 21 | public function \_\_construct() { |
  |  | 22 | parent::\_\_construct(); |
  |  | 23 | $this->siteCode = rawurlencode(substr(trim($this->getOption('SiteCode', '')), 0, 9)); |
  |  | 24 | $this->serverUrlBase = "https://" . $this->getOption('SlickServerUrl', self::DEFAULT\_SERVER\_URL); |
  |  | 25 | $this->utils = Utils::getInstance(); |
  |  | 26 | } |
  |  | 27 |  |
  |  | 28 | private function echoComment($comment, $echoToConsole = true, $debugOnly = true): void { |
  |  | 29 | $this->utils->echoComment($comment, $echoToConsole, $debugOnly); |
  |  | 30 | } |
  |  | 31 |  |
  |  | 32 | private function echoDebugCLS(): void { |
  | 438 | 33 | echo <<<JSDOC |
  | 439 | 34 | <script class='$this->scriptClass'> |
  | […](/browser/slick-engagement/trunk/SlickEngagement_Plugin.php?rev=3104175#L455) | […](/browser/slick-engagement/trunk/SlickEngagement_Plugin.php?rev=3184136#L50) |  |
  | 455 | 50 | console.info(`\${slickBanner} Monitoring for CLS...`); |
  | 456 | 51 | const script = document.createElement('script'); |
  | 457 |  | script.src = 'https://unpkg.com/web-vitals~~@3~~/dist/web-vitals.attribution.iife.js'; |
  |  | 52 | script.src = 'https://unpkg.com/web-vitals/dist/web-vitals.attribution.iife.js'; |
  | 458 | 53 | script.onload = function () { |
  | 459 | 54 | webVitals.onCLS(clsDataCallback); |
  | 460 |  | ~~//webVitals.onFID(console.info);~~ |
  | 461 |  | ~~//webVitals.onLCP(console.info);~~ |
  | 462 | 55 | }; |
  | 463 | 56 | document.head.appendChild(script); |
  | […](/browser/slick-engagement/trunk/SlickEngagement_Plugin.php?rev=3104175#L467) | […](/browser/slick-engagement/trunk/SlickEngagement_Plugin.php?rev=3184136#L60) |  |
  | 467 | 60 | } |
  | 468 | 61 |  |
  | 469 |  | private function echoConsoleOutput() |
  | 470 |  | { |
  | 471 |  | if ($this->consoleOutput !== "") |
  | 472 |  | { |
  | 473 |  | echo "<script class='$this->scriptClass'>console.info(`[slickstream]\n$this->consoleOutput`)</script>\n"; |
  | 474 |  | } |
  | 475 |  | } |
  | 476 |  |  |
  | 477 |  | //TODO: Add functionality to detect if the page was cached (by a CDN or otherwise) |
  | 478 |  | private function getCurrentTimestampByTimeZone($tz\_name) |
  | 479 |  | { |
  |  | 62 | private function getCurrentTimestampByTimeZone($timezone): string { |
  | 480 | 63 | $timestamp = time(); |
  | 481 |  | $dt = new ~~DateTime('now', new DateTimeZone($tz\_nam~~e)); |
  |  | 64 | $dt = new \DateTime('now', new \DateTimeZone($timezone)); |
  | 482 | 65 | $dt->setTimestamp($timestamp); |
  | 483 | 66 | return $dt->format('n/j/Y, g:i:s A'); |
  | 484 | 67 | } |
  | 485 | 68 |  |
  | 486 |  | // Delete transient boot data if `&delete-boot=1` is passed in |
  | 487 |  | private function handleDeleteBootData() |
  | 488 |  | { |
  | 489 |  | $delete\_transient\_param = $this->getQueryParamByName('delete-boot'); |
  | 490 |  | $delete\_transient\_data = ($delete\_transient\_param === '1'); |
  | 491 |  |  |
  | 492 |  | if (!$delete\_transient\_data) { |
  | 493 |  | return; |
  | 494 |  | } |
  | 495 |  |  |
  | 496 |  | $this->echoSlickstreamComment("Deleting page boot data from cache"); |
  | 497 |  | $comment = (false === delete\_transient($this->getTransientName())) ? |
  | 498 |  | "Nothing to do--page not found in cache" : |
  | 499 |  | "Page boot data deleted successfully"; |
  | 500 |  | $this->echoSlickstreamComment($comment); |
  | 501 |  | } |
  | 502 |  |  |
  | 503 |  | private function getQueryParamByName($param\_name) |
  | 504 |  | { |
  | 505 |  | $param\_val = isset($\_GET[$param\_name]) ? $\_GET[$param\_name] : null; |
  | 506 |  | return $param\_val; |
  | 507 |  | } |
  | 508 |  |  |
  | 509 |  | private function echoPageBootData() |
  | 510 |  | { |
  | 511 |  | $siteCode = substr(trim($this->getOption('SiteCode')), 0, 9); |
  | 512 |  |  |
  | 513 |  | if (!$siteCode) { |
  | 514 |  | $this->echoSlickstreamComment("ERROR: Site Code missing from Plugin Settings; Slickstream services are disabled"); |
  | 515 |  | return; |
  | 516 |  | } |
  | 517 |  |  |
  | 518 |  | global $wp; |
  | 519 |  |  |
  | 520 |  | $transient\_name = $this->getTransientName(); //Name for WP Transient Cache API Key |
  | 521 |  |  |
  | 522 |  | // If `delete-boot=1` is passed as a query param, delete the stored page boot data |
  | 523 |  | $this->handleDeleteBootData(); |
  | 524 |  |  |
  | 525 |  | $no\_transient\_data = false === ($boot\_data\_obj = get\_transient($transient\_name)); //get\_transient returns `false` if the key doesn't exist |
  | 526 |  |  |
  | 527 |  | // If `slick-boot=1` is passed as a query param, force a re-fetch of the boot data from the server |
  | 528 |  | // If `slick-boot=0` is passed as a query param, skip fetching boot data from the server |
  | 529 |  | $slick\_boot\_param = $this->getQueryParamByName('slick-boot'); |
  | 530 |  | $force\_fetch\_boot\_data = ($slick\_boot\_param === '1'); |
  | 531 |  | $dont\_load\_boot\_data = ($slick\_boot\_param === '0'); |
  | 532 |  | $slick\_boot\_param\_not\_set = ($slick\_boot\_param === null); |
  | 533 |  |  |
  | 534 |  | // Check for existing data in transient cache. If none, then fetch data from server. |
  | 535 |  | //TODO: store cache hits and cache misses in a transient or option? |
  | 536 |  | if ($force\_fetch\_boot\_data || ($no\_transient\_data && $slick\_boot\_param\_not\_set)) { |
  | 537 |  | $this->echoSlickstreamComment("Fetching page boot data from server"); |
  | 538 |  | $boot\_data\_obj = $this->fetchBootData($siteCode); |
  | 539 |  |  |
  | 540 |  | // Put the results in transient storage; expire after 15 minutes |
  | 541 |  | if ($boot\_data\_obj) { |
  | 542 |  | set\_transient($transient\_name, $boot\_data\_obj, 15 \* MINUTE\_IN\_SECONDS); |
  | 543 |  | $this->echoSlickstreamComment("Storing page boot data in transient cache: " . $transient\_name); |
  | 544 |  | } else { |
  | 545 |  | return; |
  | 546 |  | } |
  | 547 |  | } else if ($dont\_load\_boot\_data) { |
  | 548 |  | $this->echoSlickstreamComment("Skipping page boot data and CLS output"); |
  | 549 |  | return; |
  | 550 |  | } else { |
  | 551 |  | $this->echoSlickstreamComment("Using cached page boot data: " . $transient\_name); |
  | 552 |  | } |
  | 553 |  |  |
  | 554 |  | $this->echoSlickBootJs($boot\_data\_obj); |
  | 555 |  | $this->echoClsData($boot\_data\_obj); |
  | 556 |  | } |
  | 557 |  |  |
  | 558 |  | //Plugin-based A/B Testing JS Logic |
  | 559 |  | private function getAbTestJs() |
  | 560 |  | { |
  | 561 |  |  |
  | 562 |  | $jsBlock = <<<JSBLOCK |
  | 563 |  | window.slickAbTestResult = function(percentEnabled, recalculate = false, testName = 'embed') { |
  | 564 |  | const win = window; |
  | 565 |  | const storage = win.localStorage; |
  | 566 |  | const targetPercentEnabled = parseInt(percentEnabled); |
  | 567 |  |  |
  | 568 |  | if (isNaN(targetPercentEnabled)) { |
  | 569 |  | return new Error("Invalid enabled percentage"); |
  | 570 |  | } |
  | 571 |  |  |
  | 572 |  | let enableSlickFeature; |
  | 573 |  | const abTestStorageKey = `slickab-\${testName}-\${targetPercentEnabled}`; |
  | 574 |  | const storedOnOffVal = storage.getItem(abTestStorageKey); |
  | 575 |  |  |
  | 576 |  | const percentKey = `slickAbTestPercent-\${testName}`; |
  | 577 |  | const storedPercentVal = parseInt(storage.getItem(percentKey)); |
  | 578 |  |  |
  | 579 |  | if (recalculate === true || !storedOnOffVal || storedPercentVal !== targetPercentEnabled) { |
  | 580 |  | enableSlickFeature = (Math.random() \* 100) <= targetPercentEnabled; |
  | 581 |  | storage.setItem(abTestStorageKey, enableSlickFeature); |
  | 582 |  | storage.setItem(percentKey, targetPercentEnabled); |
  | 583 |  | } else { |
  | 584 |  | enableSlickFeature = storage.getItem(abTestStorageKey) === 'true'; |
  | 585 |  | } |
  | 586 |  |  |
  | 587 |  | const abGroupVal = `slk\${testName}\${targetPercentEnabled}`; |
  | 588 |  | const featureOnOff = enableSlickFeature ? "on" : "off"; |
  | 589 |  | win.adthrive = win.adthrive || {}; |
  | 590 |  | win.adthrive.cmd = win.adthrive.cmd || []; |
  | 591 |  | win.adthrive.cmd.push(() => { win.adthrive.config.abGroup.set(abGroupVal, featureOnOff); }); |
  | 592 |  |  |
  | 593 |  | return enableSlickFeature; |
  | 594 |  | }; |
  | 595 |  | JSBLOCK; |
  | 596 |  |  |
  | 597 |  | return $jsBlock; |
  | 598 |  | } |
  | 599 |  |  |
  | 600 |  | private function get\_tax\_terms($post, $taxonomy\_name) { |
  | 601 |  | $taxTerms = array(); |
  | 602 |  | $terms = get\_the\_terms($post, $taxonomy\_name); |
  |  | 69 | private function getTaxTerms($post, $taxonomyName): array { |
  |  | 70 | $taxTerms = []; |
  |  | 71 | $terms = get\_the\_terms($post, $taxonomyName); |
  | 603 | 72 |  |
  | 604 | 73 | if (empty($terms)) { |
  | […](/browser/slick-engagement/trunk/SlickEngagement_Plugin.php?rev=3104175#L618) | […](/browser/slick-engagement/trunk/SlickEngagement_Plugin.php?rev=3184136#L87) |  |
  | 618 | 87 | } |
  | 619 | 88 |  |
  | 620 |  | private function create~~\_ldJsonTaxElement($taxonomy, $taxTerms)~~ { |
  |  | 89 | private function createLdJsonTaxElement($taxonomy, $taxTerms): object { |
  | 621 | 90 | return (object) [ |
  | 622 | 91 | 'name' => $taxonomy->name, |
  | […](/browser/slick-engagement/trunk/SlickEngagement_Plugin.php?rev=3104175#L627) | […](/browser/slick-engagement/trunk/SlickEngagement_Plugin.php?rev=3184136#L96) |  |
  | 627 | 96 | } |
  | 628 | 97 |  |
  | 629 |  | private function echoWpRocketDetection() |
  | 630 |  | { |
  |  | 98 | private function echoWpRocketDetection(): void { |
  | 631 | 99 | echo <<<JSBLOCK |
  | 632 | 100 | <script class='$this->scriptClass'> |
  | […](/browser/slick-engagement/trunk/SlickEngagement_Plugin.php?rev=3104175#L635) | […](/browser/slick-engagement/trunk/SlickEngagement_Plugin.php?rev=3184136#L103) |  |
  | 635 | 103 | const slickstreamRocketExternalScripts = document.querySelectorAll('script[type=rocketlazyloadscript][src\*="app.slickstream.com"]'); |
  | 636 | 104 | if (slickstreamRocketPluginScripts.length > 0 || slickstreamRocketExternalScripts.length > 0) { |
  | 637 |  | console.warn('[slickstream]~~WARNING: WP-Rocket is deferring one or more Slickstream scripts. This may cause undesirable behavior, such as increased CLS scores.'~~); |
  |  | 105 | console.warn('[slickstream]' + ['Slickstream scripts. This ', 'may cause undesirable behavior, ', 'such as increased CLS scores.',' WP-Rocket is deferring one or more ',].sort().join('')); |
  | 638 | 106 | } |
  | 639 | 107 | })(); |
  | […](/browser/slick-engagement/trunk/SlickEngagement_Plugin.php?rev=3104175#L642) | […](/browser/slick-engagement/trunk/SlickEngagement_Plugin.php?rev=3184136#L110) |  |
  | 642 | 110 | } |
  | 643 | 111 |  |
  | 644 |  | //Outputs AB Test Config Data to the Console |
  | 645 |  | private function consoleLogAbTestData() |
  | 646 |  | { |
  |  | 112 | private function consoleLogAbTestData(): void { |
  | 647 | 113 | echo <<<JSBLOCK |
  | 648 | 114 | <script class='$this->scriptClass'> |
  | 649 |  | "use strict";(async()=>{var e,t;const o=window.\$slickBoot=window.\$slickBoot||{};const n="[~~SLICKSTREAM] ";const s="color: red";const a="color: yellow";if(!o.d){console.warn(`%c${n}Slickstream page boot data not found.`,a);return}const r=(e=o.d)===null||e===void 0?void 0:e.abTests;const i=(t=o.d)===null||t===void 0?void 0:t.siteCode;if(!o){console.warn(`%c${n}Slickstream config data not found; Slickstream is likely not installed on this site.`,a);return}if(!i){console.warn(`%c${n}Could not determine Slickstream siteCode for this page.`,a);return}if(o.d.bestBy<Date.now()){console.warn(`%c${n}WARNING: Slicktream config data is stale (older than 15 minutes). Please reload the page to fetch up-to-date data.`,a)}if(!r||Array.isArray(r)&&r.length===0){console.info(`%c${n}There are no Slickstream A/B tests running currently.`,s)}else{console.info(`%c~~${n}A/B TEST(S) FOR SLICKSTREAM ARE RUNNING. \\n\\nHere are the details:`,s);const e=e=>{var t;const o=localStorage.getItem("slick-ab");const n=o&&JSON.parse(o)||{value:false};return{"Feature being Tested":e.feature,"Is the A/B test running on this site?":!((t=e===null||e===void 0?void 0:e.excludeSites)===null||t===void 0?void 0:t.includes(i))?"yes":"no","Am I in the test group (feature disabled)?":n.value===true?"yes":"no","Percentage of Users this feature is ENABLED For":e.fraction,"Percentage of Users this feature is DISABLED For":100-e.fraction,"Start Date":new Date(e.startDate).toString(),"End Date":new Date(e.endDate).toString(),"Current Time":(new Date).toString()}};r.forEach((t=>{console.table(e(t))}))}})(); |
  |  | 115 | "use strict";(async()=>{var e,t;const o=window.\$slickBoot=window.\$slickBoot||{};const n="[slickstream] ";const s="color: red";const a="color: yellow";if(!o.d){console.warn(`%c\${n}Slickstream page boot data not found.`,a);return}const r=(e=o.d)===null||e===void 0?void 0:e.abTests;const i=(t=o.d)===null||t===void 0?void 0:t.siteCode;if(!o){console.warn(`%c\${n}Slickstream config data not found; Slickstream is likely not installed on this site.`,a);return}if(!i){console.warn(`%c\${n}Could not determine Slickstream siteCode for this page.`,a);return}if(o.d.bestBy<Date.now()){console.warn(`%c\${n}WARNING: Slicktream page config data is stale. Please reload the page to fetch up-to-date config data.`,a)}if(!r||Array.isArray(r)&&r.length===0){console.info(`%c\${n}There are no Slickstream A/B tests running currently.`,s)}else{console.info(`%c\${n}A/B TEST(S) FOR SLICKSTREAM ARE RUNNING. \\n\\nHere are the details:`,s);const e=e=>{var t;const o=localStorage.getItem("slick-ab");const n=o&&JSON.parse(o)||{value:false};return{"Feature being Tested":e.feature,"Is the A/B test running on this site?":!((t=e===null||e===void 0?void 0:e.excludeSites)===null||t===void 0?void 0:t.includes(i))?"yes":"no","Am I in the test group (feature disabled)?":n.value===true?"yes":"no","Percentage of Users this feature is ENABLED For":e.fraction,"Percentage of Users this feature is DISABLED For":100-e.fraction,"Start Date":new Date(e.startDate).toString(),"End Date":new Date(e.endDate).toString(),"Current Time":(new Date).toString()}};r.forEach((t=>{console.table(e(t))}))}})(); |
  | 650 | 116 | </script> |
  | 651 |  | JSBLOCK; |
  | 652 |  | } |
  | 653 |  |  |
  | 654 |  | //TODO: Clean this up / migrate to SR functions |
  | 655 |  | public function addSlickPageHeader() |
  | 656 |  | { |
  |  | 117 | JSBLOCK; |
  |  | 118 | } |
  |  | 119 |  |
  |  | 120 | function getPageType(): string { |
  |  | 121 | if (is\_front\_page() || is\_home()) { |
  |  | 122 | return 'home'; |
  |  | 123 | } |
  |  | 124 | if (is\_category()) { |
  |  | 125 | return 'category'; |
  |  | 126 | } |
  |  | 127 | if (is\_tag()) { |
  |  | 128 | return 'tag'; |
  |  | 129 | } |
  |  | 130 | if (is\_singular('post')) { |
  |  | 131 | return 'post'; |
  |  | 132 | } |
  |  | 133 | if (is\_singular('page')) { |
  |  | 134 | return 'page'; |
  |  | 135 | } |
  |  | 136 | return 'other'; |
  |  | 137 | } |
  |  | 138 |  |
  |  | 139 | function addMeta($property, $content): void { |
  |  | 140 | $property = (string) $property; |
  |  | 141 | $content = (string) $content; |
  |  | 142 | echo '<meta property="' . htmlspecialchars($property, ENT\_QUOTES, 'UTF-8') . |
  |  | 143 | '" content="' . htmlspecialchars($content, ENT\_QUOTES, 'UTF-8') . "\" />\n";    } |
  |  | 144 |  |
  |  | 145 | function handleCategoryMeta($ldJsonPost): void { |
  |  | 146 | $term = get\_queried\_object(); |
  |  | 147 | if (isset($term->slug)) { |
  |  | 148 | $this->addMeta('slick:category', "$term->slug:$term->name"); |
  |  | 149 | $ldJsonPost->category = (object)[ |
  |  | 150 | '@id' => $term->term\_id, |
  |  | 151 | 'slug' => $term->slug, |
  |  | 152 | 'name' => $term->name |
  |  | 153 | ]; |
  |  | 154 | } |
  |  | 155 | } |
  |  | 156 |  |
  |  | 157 | function handleTagMeta($ldJsonPost): void { |
  |  | 158 | $term = get\_queried\_object(); |
  |  | 159 | if (isset($term->slug)) { |
  |  | 160 | $this->addMeta('slick:tag', "$term->slug:$term->name"); |
  |  | 161 | $ldJsonPost->tag = (object)[ |
  |  | 162 | '@id' => $term->term\_id, |
  |  | 163 | 'slug' => $term->slug, |
  |  | 164 | 'name' => $term->name |
  |  | 165 | ]; |
  |  | 166 | } |
  |  | 167 | } |
  |  | 168 |  |
  |  | 169 | function handleSingularMeta($post, &$ldJsonPost): void { |
  |  | 170 | if (is\_singular('post')) { |
  |  | 171 | $this->addMeta('slick:group', 'post'); |
  |  | 172 | } |
  |  | 173 |  |
  |  | 174 | $this->handleCategories($post, $ldJsonPost); |
  |  | 175 | $this->handleTags($post, $ldJsonPost); |
  |  | 176 | $this->handleTaxonomies($post, $ldJsonPost); |
  |  | 177 | } |
  |  | 178 |  |
  |  | 179 | function handleCategories($post, &$ldJsonPost): void { |
  |  | 180 | $categories = get\_the\_category(); |
  |  | 181 | if (empty($categories)) { |
  |  | 182 | return; |
  |  | 183 | } |
  |  | 184 |  |
  |  | 185 | $ldJsonCategoryElements = []; |
  |  | 186 | foreach ($categories as $category) { |
  |  | 187 | if (isset($category->slug) && $category->slug !== 'uncategorized') { |
  |  | 188 | $this->addMeta('slick:category', $category->slug . ':' . $this->utils->removeSemicolons($category->name)); |
  |  | 189 | $ldJsonCategoryElements[] = $this->buildCategoryElement($category); |
  |  | 190 | } |
  |  | 191 | } |
  |  | 192 |  |
  |  | 193 | if (!empty($ldJsonCategoryElements)) { |
  |  | 194 | $ldJsonPost->categories = $ldJsonCategoryElements; |
  |  | 195 | } |
  |  | 196 | } |
  |  | 197 |  |
  |  | 198 | function buildCategoryElement($category): object { |
  |  | 199 | $ldJsonParents = []; |
  |  | 200 | $used = [$category->cat\_ID]; |
  |  | 201 | $parentCatId = $category->category\_parent; |
  |  | 202 |  |
  |  | 203 | while ($parentCatId && count($used) < 8 && !in\_array($parentCatId, $used)) { |
  |  | 204 | $parentCat = get\_category($parentCatId); |
  |  | 205 | if ($parentCat instanceof WPError || $parentCat === null) { |
  |  | 206 | continue; |
  |  | 207 | } |
  |  | 208 | if ($parentCat && is\_object($parentCat) && isset($parentCat->slug) && $parentCat->slug !== 'uncategorized') { |
  |  | 209 | $parentCat = (object) $parentCat; //To placate WPError warnings |
  |  | 210 | $this->addMeta(';', $parentCat->slug . ':' . $this->utils->removeSemicolons($parentCat->name)); |
  |  | 211 | $ldJsonParents[] = (object)[ |
  |  | 212 | '@type' => 'CategoryParent', |
  |  | 213 | '@id' => $parentCat->cat\_ID, |
  |  | 214 | 'slug' => $parentCat->slug, |
  |  | 215 | 'name' => $this->utils->removeSemicolons($parentCat->name) |
  |  | 216 | ]; |
  |  | 217 | } |
  |  | 218 | $used[] = $parentCatId; |
  |  | 219 | if (!is\_wp\_error($parentCat)) { |
  |  | 220 | $parentCatId = $parentCat->category\_parent; |
  |  | 221 | } else { |
  |  | 222 | continue; |
  |  | 223 | } |
  |  | 224 | } |
  |  | 225 |  |
  |  | 226 | return (object)[ |
  |  | 227 | '@id' => $category->cat\_ID, |
  |  | 228 | 'slug' => $category->slug, |
  |  | 229 | 'name' => $this->utils->removeSemicolons($category->name), |
  |  | 230 | 'parents' => $ldJsonParents |
  |  | 231 | ]; |
  |  | 232 | } |
  |  | 233 |  |
  |  | 234 | function handleTags($post, &$ldJsonPost): void { |
  |  | 235 | $tags = get\_the\_tags(); |
  |  | 236 | if (empty($tags)) { |
  |  | 237 | return; |
  |  | 238 | } |
  |  | 239 | $ldJsonTags = array\_map(function($tag) { |
  |  | 240 | return $tag->name; |
  |  | 241 | }, $tags); |
  |  | 242 |  |
  |  | 243 | if (!empty($ldJsonTags)) { |
  |  | 244 | $ldJsonPost->tags = $ldJsonTags; |
  |  | 245 | } |
  |  | 246 | } |
  |  | 247 |  |
  |  | 248 | function handleTaxonomies($post, &$ldJsonPost): void { |
  |  | 249 | $taxonomies = get\_object\_taxonomies($post, 'objects'); |
  |  | 250 | if (empty($taxonomies)) return; |
  |  | 251 |  |
  |  | 252 | $ldJsonTaxonomies = []; |
  |  | 253 | foreach ($taxonomies as $taxonomy) { |
  |  | 254 | if (empty($taxonomy->\_builtin) && $taxonomy->public) { |
  |  | 255 | $taxTerms = $this->getTaxTerms($post, $taxonomy->name); |
  |  | 256 | if (!empty($taxTerms)) { |
  |  | 257 | $ldJsonTaxonomies[] = $this->createLdJsonTaxElement($taxonomy, $taxTerms); |
  |  | 258 | } |
  |  | 259 | } |
  |  | 260 | } |
  |  | 261 |  |
  |  | 262 | if (!empty($ldJsonTaxonomies)) { |
  |  | 263 | $ldJsonPost->taxonomies = $ldJsonTaxonomies; |
  |  | 264 | } |
  |  | 265 | } |
  |  | 266 |  |
  |  | 267 | function buildLdJsonPost($post): object { |
  |  | 268 | $ldJsonPost = (object)[ |
  |  | 269 | '@type' => 'WebPage', |
  |  | 270 | '@id' => $post->ID, |
  |  | 271 | 'isFront' => is\_front\_page(), |
  |  | 272 | 'isHome' => is\_home(), |
  |  | 273 | 'isCategory' => is\_category(), |
  |  | 274 | 'isTag' => is\_tag(), |
  |  | 275 | 'isSingular' => is\_singular(), |
  |  | 276 | 'date' => get\_the\_time('c'), |
  |  | 277 | 'modified' => get\_the\_modified\_time('c'), |
  |  | 278 | 'title' => $post->post\_title, |
  |  | 279 | 'pageType' => $this->getPageType(), |
  |  | 280 | 'postType' => $post->post\_type |
  |  | 281 | ]; |
  |  | 282 |  |
  |  | 283 | return $ldJsonPost; |
  |  | 284 | } |
  |  | 285 |  |
  |  | 286 | public function echoBootLoader(): void { |
  |  | 287 | $this->echoComment("Bootloader:", false, false); |
  |  | 288 | echo "<script class='$this->scriptClass'>'use strict';\n"; |
  |  | 289 | echo "(async(e,t)=>{if(location.search.indexOf(\"no-slick\")>=0){return}let s;const a=()=>performance.now();let c=window.\$slickBoot=window.\$slickBoot||{};c.rt=e;c.\_es=a();c.ev=\"2.0.1\";c.l=async(e,t)=>{try{let c=0;if(!s&&\"caches\"in self){s=await caches.open(\"slickstream-code\")}if(s){let o=await s.match(e);if(!o){c=a();await s.add(e);o=await s.match(e);if(o&&!o.ok){o=undefined;s.delete(e)}}if(o){const e=o.headers.get(\"x-slickstream-consent\");return{t:c,d:t?await o.blob():await o.json(),c:e||\"na\"}}}}catch(e){console.log(e)}return{}};const o=e=>new Request(e,{cache:\"no-store\"});if(!c.d||c.d.bestBy<Date.now()){const s=o(`\${e}/d/page-boot-data?site=\${t}&url=\${encodeURIComponent(location.href.split(\"#\")[0])}`);let{t:i,d:n,c:l}=await c.l(s);if(n){if(n.bestBy<Date.now()){n=undefined}else if(i){c.\_bd=i;c.c=l}}if(!n){c.\_bd=a();const e=await fetch(s);const t=e.headers.get(\"x-slickstream-consent\");c.c=t||\"na\";n=await e.json()}if(n){c.d=n;c.s=\"embed\"}}if(c.d){let e=c.d.bootUrl;const{t:t,d:s}=await c.l(o(e),true);if(s){c.bo=e=URL.createObjectURL(s);if(t){c.\_bf=t}}else{c.\_bf=a()}const i=document.createElement(\"script\");i.className=\"slickstream-script\";i.src=e;document.head.appendChild(i)}else{console.log(\"[slickstream] Boot failed\")}})\n"; |
  |  | 290 | echo '("' . addslashes($this->serverUrlBase) . '","' . addslashes($this->siteCode) . "\");\n"; |
  |  | 291 | echo "</script>\n"; |
  |  | 292 | $this->echoComment("END Bootloader", false, false); |
  |  | 293 | } |
  |  | 294 |  |
  |  | 295 | private function echoVersionMetaTag(): void { |
  |  | 296 | echo "\n<meta property='slick:wpversion' content='" . self::PLUGIN\_VERSION . "' />\n"; |
  |  | 297 | } |
  |  | 298 |  |
  |  | 299 | //Outputs debug info, meta tags, page boot data, and other page metadata into the page header |
  |  | 300 | public function addSlickPageHeader(): void { |
  | 657 | 301 | global $post; |
  | 658 |  | echo "\n"; |
  | 659 |  | $this->echoSlickstreamComment("Page Generated at: " . $this->getCurrentTimeStampByTimeZone('UTC') . " UTC"); |
  | 660 |  | $this->consoleOutput .= "Current timestamp: \${(new Date).toLocaleString('en-US', { timeZone: 'UTC' })} UTC\n\n"; |
  | 661 |  | $this->echoPageBootData(); |
  | 662 |  |  |
  | 663 |  | echo "\n" . '<meta property="slick:wpversion" content="' . PLUGIN\_VERSION . '" />' . "\n"; |
  | 664 |  | $siteCode = substr(trim($this->getOption('SiteCode')), 0, 9); |
  | 665 |  |  |
  | 666 |  | if ($siteCode) { |
  | 667 |  | $adThriveAbTest = false; |
  | 668 |  | $serverUrl = trim($this->getOption('SlickServerUrl', self::defaultServerUrl)); |
  | 669 |  | //NOTE: for WP Plugin-based A/B Tests, the SlickServerUrl option is overloaded, hence the weird usage here |
  | 670 |  | if (substr($serverUrl, 0, 11) === 'adthrive-ab') { |
  | 671 |  | $pieces = explode(" ", $serverUrl); |
  | 672 |  | $serverUrl = self::defaultServerUrl; |
  | 673 |  | $adThriveAbTest = true; |
  | 674 |  | $enabledPercent = (count($pieces) > 1) ? intval($pieces[1]) : 100; |
  | 675 |  | } |
  | 676 |  |  |
  | 677 |  | $this->echoSlickstreamComment("Bootloader:", false); |
  | 678 |  | echo "<script class='$this->scriptClass' >\n"; |
  | 679 |  | echo "'use strict';\n"; |
  | 680 |  | if ($adThriveAbTest) { |
  | 681 |  | echo $this->getAbTestJs(); |
  | 682 |  | echo "if (window.slickAbTestResult(" . $enabledPercent . ")) {\n"; |
  | 683 |  | } |
  | 684 |  | echo '(async(e,t)=>{if(location.search.indexOf("no-slick")>=0){return}let s;const a=()=>performance.now();let c=window.$slickBoot=window.$slickBoot||{};c.rt=e;c.\_es=a();c.ev="2.0.1";c.l=async(e,t)=>{try{let c=0;if(!s&&"caches"in self){s=await caches.open("slickstream-code")}if(s){let o=await s.match(e);if(!o){c=a();await s.add(e);o=await s.match(e);if(o&&!o.ok){o=undefined;s.delete(e)}}if(o){const e=o.headers.get("x-slickstream-consent");return{t:c,d:t?await o.blob():await o.json(),c:e||"na"}}}}catch(e){console.log(e)}return{}};const o=e=>new Request(e,{cache:"no-store"});if(!c.d||c.d.bestBy<Date.now()){const s=o(`${e}/d/page-boot-data?site=${t}&url=${encodeURIComponent(location.href.split("#")[0])}`);let{t:i,d:n,c:l}=await c.l(s);if(n){if(n.bestBy<Date.now()){n=undefined}else if(i){c.\_bd=i;c.c=l}}if(!n){c.\_bd=a();const e=await fetch(s);const t=e.headers.get("x-slickstream-consent");c.c=t||"na";n=await e.json()}if(n){c.d=n;c.s="embed"}}if(c.d){let e=c.d.bootUrl;const{t:t,d:s}=await c.l(o(e),true);if(s){c.bo=e=URL.createObjectURL(s);if(t){c.\_bf=t}}else{c.\_bf=a()}const i=document.createElement("script");i.className="slickstream-script";i.src=e;document.head.appendChild(i)}else{console.log("[slickstream] Boot failed")}})' . "\n"; |
  | 685 |  | echo '("' . $serverUrl . '","' . $siteCode . '");' . "\n"; |
  | 686 |  | if ($adThriveAbTest) { |
  | 687 |  | echo "}\n"; |
  | 688 |  | } |
  | 689 |  | echo "</script>\n"; |
  | 690 |  | $this->echoSlickstreamComment("END Bootloader", false); |
  | 691 |  | } |
  | 692 |  |  |
  | 693 |  | $this->echoSlickstreamComment("Page Metadata:", false); |
  |  | 302 |  |
  |  | 303 | $this->echoPageGenerationTimestamp(); |
  |  | 304 |  |
  |  | 305 | if (!$this->siteCode) { |
  |  | 306 | $this->echoComment("ERROR: Site Code missing from Plugin Settings; Slickstream services are disabled", true, false); |
  |  | 307 | return; |
  |  | 308 | } |
  |  | 309 |  |
  |  | 310 | $pageBootData = new PageBootData($this->serverUrlBase, $this->siteCode, $this->scriptClass); |
  |  | 311 | $pageBootData->handlePageBootData(); |
  |  | 312 | $this->echoVersionMetaTag(); |
  |  | 313 | $this->echoBootLoader(); |
  |  | 314 | $this->echoPageMetadata($post); |
  |  | 315 | $this->outputDebugInfo(); |
  |  | 316 | $this->echoWpRocketDetection(); |
  |  | 317 | } |
  |  | 318 |  |
  |  | 319 | private function echoPageGenerationTimestamp(): void { |
  |  | 320 | $timezone = 'America/New\_York'; |
  |  | 321 | $shortTimezone = 'EST'; |
  |  | 322 | $this->echoComment("Page Generated at: " . $this->getCurrentTimeStampByTimeZone($timezone) . " $shortTimezone", true, false); |
  |  | 323 | echo "\t\t<script>console.info(`[slickstream] Current timestamp: \${(new Date).toLocaleString('en-US', { timeZone: '$timezone' })} $shortTimezone`);</script>\n"; |
  |  | 324 | } |
  |  | 325 |  |
  |  | 326 | private function echoPageMetadata($post): void { |
  |  | 327 | $this->echoComment("Page Metadata:", false, false); |
  | 694 | 328 |  |
  | 695 |  | //TODO: Move this out into SR functions and cache the output |
  | 696 |  | $ldJsonElements = array(); |
  | 697 |  |  |
  | 698 |  | $ldJsonPlugin = (object) [ |
  |  | 329 | $ldJsonElements = []; |
  |  | 330 | array\_push($ldJsonElements, $this->getLdJsonPluginData(), $this->getLdJsonSiteData()); |
  |  | 331 |  |
  |  | 332 | if (!empty($post)) { |
  |  | 333 | $ldJsonPost = $this->buildLdJsonPost($post); |
  |  | 334 | $this->processPostMetadata($post, $ldJsonPost); |
  |  | 335 | array\_push($ldJsonElements, $ldJsonPost); |
  |  | 336 | } |
  |  | 337 |  |
  |  | 338 | $ldJson = (object) [ |
  |  | 339 | '@context' => 'https://slickstream.com', |
  |  | 340 | '@graph' => $ldJsonElements, |
  |  | 341 | ]; |
  |  | 342 | echo '<script type="application/x-slickstream+json">' . json\_encode($ldJson, JSON\_UNESCAPED\_SLASHES) . "</script>\n"; |
  |  | 343 | $this->echoComment("END Page Metadata", false, false); |
  |  | 344 | } |
  |  | 345 |  |
  |  | 346 | private function getLdJsonPluginData(): object { |
  |  | 347 | return (object) [ |
  | 699 | 348 | '@type' => 'Plugin', |
  | 700 |  | 'version' => PLUGIN\_VERSION, |
  | 701 |  | ]; |
  | 702 |  |  |
  | 703 |  | ~~array\_push($ldJsonElements, $ldJsonPlugin);~~ |
  | 704 |  |  |
  | 705 |  | ~~$ldJsonSite =~~ (object) [ |
  |  | 349 | 'version' => self::PLUGIN\_VERSION, |
  |  | 350 | ]; |
  |  | 351 | } |
  |  | 352 |  |
  |  | 353 | private function getLdJsonSiteData(): object { |
  |  | 354 | return (object) [ |
  | 706 | 355 | '@type' => 'Site', |
  | 707 | 356 | 'name' => get\_bloginfo('name'), |
  | […](/browser/slick-engagement/trunk/SlickEngagement_Plugin.php?rev=3104175#L711) | […](/browser/slick-engagement/trunk/SlickEngagement_Plugin.php?rev=3184136#L360) |  |
  | 711 | 360 | 'rtl' => is\_rtl(), |
  | 712 | 361 | ]; |
  | 713 |  | array\_push($ldJsonElements, $ldJsonSite); |
  | 714 |  |  |
  | 715 |  | if (!empty($post)) { |
  | 716 |  | $pageType = 'post'; |
  | 717 |  | if (is\_front\_page() || is\_home()) { |
  | 718 |  | $pageType = 'home'; |
  | 719 |  | } else if (is\_category()) { |
  | 720 |  | $pageType = 'category'; |
  | 721 |  | } else if (is\_tag()) { |
  | 722 |  | $pageType = 'tag'; |
  | 723 |  | } else if (is\_singular('post')) { |
  | 724 |  | $pageType = 'post'; |
  | 725 |  | } else if (is\_singular('page')) { |
  | 726 |  | $pageType = 'page'; |
  | 727 |  | } else { |
  | 728 |  | $pageType = 'other'; |
  | 729 |  | } |
  | 730 |  | $ldJsonPost = (object) [ |
  | 731 |  | '@type' => 'WebPage', |
  | 732 |  | '@id' => $post->ID, |
  | 733 |  | 'isFront' => is\_front\_page(), |
  | 734 |  | 'isHome' => is\_home(), |
  | 735 |  | 'isCategory' => is\_category(), |
  | 736 |  | 'isTag' => is\_tag(), |
  | 737 |  | 'isSingular' => is\_singular(), |
  | 738 |  | 'date' => get\_the\_time('c'), |
  | 739 |  | 'modified' => get\_the\_modified\_time('c'), |
  | 740 |  | 'title' => $post->post\_title, |
  | 741 |  | 'pageType' => $pageType, |
  | 742 |  | 'postType' => $post->post\_type, |
  | 743 |  | ]; |
  | 744 |  | echo '<meta property="slick:wppostid" content="' . $post->ID . '" />' . "\n"; |
  | 745 |  | if (has\_post\_thumbnail($post)) { |
  | 746 |  | $images = wp\_get\_attachment\_image\_src(get\_post\_thumbnail\_id($post), 'single-post-thumbnail'); |
  | 747 |  | if (!empty($images)) { |
  | 748 |  | echo '<meta property="slick:featured\_image" content="' . $images[0] . '" />' . "\n"; |
  | 749 |  | $ldJsonPost->featured\_image = $images[0]; |
  | 750 |  | } |
  | 751 |  | } |
  | 752 |  | $authorName = get\_the\_author\_meta('display\_name'); |
  | 753 |  | if (!empty($authorName)) { |
  | 754 |  | $ldJsonPost->author = $authorName; |
  | 755 |  | } |
  | 756 |  | if (is\_category()) { |
  | 757 |  | echo '<meta property="slick:group" content="category" />' . "\n"; |
  | 758 |  | $term = get\_queried\_object(); |
  | 759 |  | if (isset($term->slug)) { |
  | 760 |  | echo '<meta property="slick:category" content="' . $term->slug . ':' . $term->name . '" />' . "\n"; |
  | 761 |  | $ldJsonCategory = (object) [ |
  | 762 |  | '@id' => $term->term\_id, |
  | 763 |  | 'slug' => $term->slug, |
  | 764 |  | 'name' => $term->name, |
  | 765 |  | ]; |
  | 766 |  | $ldJsonPost->category = $ldJsonCategory; |
  | 767 |  | } |
  | 768 |  | } else if (is\_tag()) { |
  | 769 |  | echo '<meta property="slick:group" content="tag" />' . "\n"; |
  | 770 |  | $term = get\_queried\_object(); |
  | 771 |  | if (isset($term->slug)) { |
  | 772 |  | echo '<meta property="slick:tag" content="' . $term->slug . ':' . $term->name . '" />' . "\n"; |
  | 773 |  | $ldJsonTag = (object) [ |
  | 774 |  | '@id' => $term->term\_id, |
  | 775 |  | 'slug' => $term->slug, |
  | 776 |  | 'name' => $term->name, |
  | 777 |  | ]; |
  | 778 |  | $ldJsonPost->tag = $ldJsonTag; |
  | 779 |  | } |
  | 780 |  | } else if (is\_singular(['post', 'page'])) { |
  | 781 |  | if (is\_singular('post')) { |
  | 782 |  | echo '<meta property="slick:group" content="post" />' . "\n"; |
  | 783 |  | } |
  | 784 |  | $categories = get\_the\_category(); |
  | 785 |  | if (!empty($categories)) { |
  | 786 |  | $ldJsonCategoryElements = array(); |
  | 787 |  | foreach ($categories as $category) { |
  | 788 |  | if (isset($category->slug) && $category->slug !== 'uncategorized') { |
  | 789 |  | echo '<meta property="slick:category" content="' . $category->slug . ':' . $this->removeSemicolons($category->name); |
  | 790 |  | $used = [$category->cat\_ID]; |
  | 791 |  | $count = 0; |
  | 792 |  | $parentCatId = $category->category\_parent; |
  | 793 |  | $ldJsonParents = array(); |
  | 794 |  | while ($parentCatId && $count < 8 && !in\_array($parentCatId, $used)) { |
  | 795 |  | $parentCat = get\_category($parentCatId); |
  | 796 |  | if (isset($parentCat->slug) && $parentCat->slug !== 'uncategorized') { |
  | 797 |  | echo ';' . $parentCat->slug . ':' . $this->removeSemicolons($parentCat->name); |
  | 798 |  | $parentCatId = $parentCat->cat\_ID; |
  | 799 |  | $ldJsonParent = (object) [ |
  | 800 |  | '@type' => 'CategoryParent', |
  | 801 |  | '@id' => $parentCat->cat\_ID, |
  | 802 |  | 'slug' => $parentCat->slug, |
  | 803 |  | 'name' => $this->removeSemicolons($parentCat->name), |
  | 804 |  | ]; |
  | 805 |  | array\_push($ldJsonParents, $ldJsonParent); |
  | 806 |  | } else { |
  | 807 |  | break; |
  | 808 |  | } |
  | 809 |  | array\_push($used, $parentCatId); |
  | 810 |  | $count = $count + 1; |
  | 811 |  | } |
  | 812 |  | echo '" />' . "\n"; |
  | 813 |  | $ldJsonCategoryElement = (object) [ |
  | 814 |  | '@id' => $category->cat\_ID, |
  | 815 |  | 'slug' => $category->slug, |
  | 816 |  | 'name' => $this->removeSemicolons($category->name), |
  | 817 |  | 'parents' => $ldJsonParents, |
  | 818 |  | ]; |
  | 819 |  | array\_push($ldJsonCategoryElements, $ldJsonCategoryElement); |
  | 820 |  | } |
  | 821 |  | } |
  | 822 |  | if (!empty($ldJsonCategoryElements)) { |
  | 823 |  | $ldJsonPost->categories = $ldJsonCategoryElements; |
  | 824 |  | } |
  | 825 |  | } |
  | 826 |  |  |
  | 827 |  | $tags = get\_the\_tags(); |
  | 828 |  | if (!empty($tags)) { |
  | 829 |  | $ldJsonTags = array(); |
  | 830 |  | foreach ($tags as $tag) { |
  | 831 |  | if (isset($tag->name)) { |
  | 832 |  | array\_push($ldJsonTags, $tag->name); |
  | 833 |  | } |
  | 834 |  | } |
  | 835 |  | if (!empty($ldJsonTags)) { |
  | 836 |  | $ldJsonPost->tags = $ldJsonTags; |
  | 837 |  | } |
  | 838 |  | } |
  | 839 |  |  |
  | 840 |  | $ldJsonTaxonomies = array(); |
  | 841 |  | $taxonomies = get\_object\_taxonomies($post, 'objects'); |
  | 842 |  | if (!empty($taxonomies)) { |
  | 843 |  | foreach ($taxonomies as $taxonomy) { |
  | 844 |  | if (empty($taxonomy->\_builtin) && $taxonomy->public) { |
  | 845 |  | $taxTerms = $this->get\_tax\_terms($post, $taxonomy->name); |
  | 846 |  |  |
  | 847 |  | if (!empty($taxTerms)) { |
  | 848 |  | $ldJsonTaxElement = $this->create\_ldJsonTaxElement($taxonomy, $taxTerms); |
  | 849 |  | array\_push($ldJsonTaxonomies, $ldJsonTaxElement); |
  | 850 |  | } |
  | 851 |  | } |
  | 852 |  | } |
  | 853 |  | } |
  | 854 |  | if (class\_exists('WPRM\_Recipe\_Manager')) { |
  | 855 |  | // $postTypeArgs = array('public' => true, '\_builtin' => false); |
  | 856 |  | // $ldJsonPost->postTypes = get\_post\_types($postTypeArgs, 'names', 'and'); |
  | 857 |  | $recipes = WPRM\_Recipe\_Manager::get\_recipe\_ids\_from\_post($post->ID); |
  | 858 |  | // $ldJsonPost->recipes = $recipes; |
  | 859 |  | if (!empty($recipes)) { |
  | 860 |  | // $recipe = WPRM\_Recipe\_Manager::get\_recipe($recipes[0]); |
  | 861 |  | // $ldJsonPost->recipe = $recipe; |
  | 862 |  | // $ldJsonPost->recipeId = $recipes[0]; |
  | 863 |  | $recipeTaxonomies = get\_object\_taxonomies('wprm\_recipe', 'objects'); |
  | 864 |  | // $ldJsonPost->recipeTaxonomies = $recipeTaxonomies; |
  | 865 |  | if (!empty($recipeTaxonomies)) { |
  | 866 |  | foreach ($recipeTaxonomies as $taxonomy) { |
  | 867 |  | if (empty($taxonomy->\_builtin) && $taxonomy->public) { |
  | 868 |  | $taxTerms = array(); |
  | 869 |  | $terms = get\_the\_terms($recipes[0], $taxonomy->name); |
  | 870 |  | // $lsJsonPost->taxTerms = $terms; |
  | 871 |  | if (!empty($terms)) { |
  | 872 |  | foreach ($terms as $term) { |
  | 873 |  | $termObject = (object) [ |
  | 874 |  | '@id' => $term->term\_id, |
  | 875 |  | 'name' => $term->name, |
  | 876 |  | 'slug' => $term->slug, |
  | 877 |  | ]; |
  | 878 |  | array\_push($taxTerms, $termObject); |
  | 879 |  | } |
  | 880 |  | $ldJsonTaxElement = (object) [ |
  | 881 |  | 'name' => $taxonomy->name, |
  | 882 |  | 'label' => $taxonomy->label, |
  | 883 |  | 'description' => $taxonomy->description, |
  | 884 |  | 'terms' => $taxTerms, |
  | 885 |  | ]; |
  | 886 |  | array\_push($ldJsonTaxonomies, $ldJsonTaxElement); |
  | 887 |  | } |
  | 888 |  | } |
  | 889 |  | } |
  | 890 |  | } |
  | 891 |  | } |
  | 892 |  | } |
  | 893 |  | $ldJsonPost->taxonomies = $ldJsonTaxonomies; |
  | 894 |  | } |
  | 895 |  | array\_push($ldJsonElements, $ldJsonPost); |
  | 896 |  | } |
  | 897 |  | $ldJson = (object) [ |
  | 898 |  | '@context' => 'https://slickstream.com', |
  | 899 |  | '@graph' => $ldJsonElements, |
  | 900 |  | ]; |
  | 901 |  | echo '<script type="application/x-slickstream+json">' . json\_encode($ldJson, JSON\_UNESCAPED\_SLASHES) . "</script>\n"; |
  | 902 |  | $this->echoSlickstreamComment("END Page Metadata", false); |
  |  | 362 | } |
  |  | 363 |  |
  |  | 364 | private function processPostMetadata($post, &$ldJsonPost): void { |
  |  | 365 | $this->addMeta('slick:wppostid', $post->ID); |
  | 903 | 366 |  |
  | 904 |  | if ($this->isDebugModeEnabled()) |
  | 905 |  | { |
  | 906 |  | $this->consoleLogAbTestData(); |
  | 907 |  | $this->debugCLS(); |
  | 908 |  | $this->echoConsoleOutput(); |
  | 909 |  | } |
  | 910 |  | $this->echoWpRocketDetection(); |
  |  | 367 | if (has\_post\_thumbnail($post)) { |
  |  | 368 | $images = wp\_get\_attachment\_image\_src(get\_post\_thumbnail\_id($post), 'single-post-thumbnail'); |
  |  | 369 | if (!empty($images)) { |
  |  | 370 | $this->addMeta('slick:featured\_image', $images[0]); |
  |  | 371 | $ldJsonPost->featured\_image = $images[0]; |
  |  | 372 | } |
  |  | 373 | } |
  |  | 374 |  |
  |  | 375 | $authorName = get\_the\_author\_meta('display\_name'); |
  |  | 376 | if (!empty($authorName)) { |
  |  | 377 | $ldJsonPost->author = $authorName; |
  |  | 378 | } |
  |  | 379 |  |
  |  | 380 | $this->handlePostTypeMeta($post, $ldJsonPost); |
  |  | 381 | } |
  |  | 382 |  |
  |  | 383 | private function handlePostTypeMeta($post, &$ldJsonPost): void |
  |  | 384 | { |
  |  | 385 | switch (true) { |
  |  | 386 | case is\_category(): |
  |  | 387 | $this->addMeta('slick:group', 'category'); |
  |  | 388 | $this->handleCategoryMeta($ldJsonPost); |
  |  | 389 | break; |
  |  | 390 |  |
  |  | 391 | case is\_tag(): |
  |  | 392 | $this->addMeta('slick:group', 'tag'); |
  |  | 393 | $this->handleTagMeta($ldJsonPost); |
  |  | 394 | break; |
  |  | 395 |  |
  |  | 396 | case is\_singular(['post', 'page']): |
  |  | 397 | $this->handleSingularMeta($post, $ldJsonPost); |
  |  | 398 | break; |
  |  | 399 | } |
  |  | 400 | } |
  |  | 401 |  |
  |  | 402 | private function outputDebugInfo(): void { |
  |  | 403 | if (!$this->utils->isDebugModeEnabled()) { |
  |  | 404 | return; |
  |  | 405 | } |
  |  | 406 | $this->consoleLogAbTestData(); |
  |  | 407 | $this->echoDebugCLS(); |
  | 911 | 408 | } |
  | 912 | 409 | } |
* ## [slick-engagement/trunk/SlickEngagement\_Widgets.php](/changeset/3184136/slick-engagement/trunk/SlickEngagement_Widgets.php "Show the changeset 3184136 restricted to slick-engagement/trunk/SlickEngagement_Widgets.php")

  | [r2462387](/browser/slick-engagement/trunk/SlickEngagement_Widgets.php?rev=2462387#L1 "Show revision 2462387 of this file in browser") | [r3184136](/browser/slick-engagement/trunk/SlickEngagement_Widgets.php?rev=3184136#L1 "Show revision 3184136 of this file in browser") |  |
  | --- | --- | --- |
  | 1 |  | <?php |
  | 2 |  |  |
  | 3 |  | class Slick\_FilmStrip\_Widget extends WP\_Widget |
  | 4 |  | { |
  | 5 |  | /\*\* |
  | 6 |  | \* based on https://www.wpexplorer.com/create-widget-plugin-wordpress/ |
  | 7 |  |  |
  |  | 1 | <?php |
  |  | 2 | declare(strict\_types=1); |
  |  | 3 |  |
  |  | 4 | class Slick\_FilmStrip\_Widget extends WP\_Widget { |
  |  | 5 | /\*\* |
  | 8 | 6 | \* The widget simply creates a container that the Slick script will populate |
  | 9 | 7 | \* after the page loads. |
  | 10 | 8 | \*/ |
  | 11 | 9 |  |
  | 12 |  | public function \_\_construct() |
  | 13 |  | { |
  |  | 10 | public function \_\_construct() { |
  | 14 | 11 | parent::\_\_construct( |
  | 15 | 12 | 'slick\_filmstrip\_widget', |
  | 16 | 13 | \_\_('Slick FilmStrip Widget', 'text\_domain'), |
  | 17 |  | array('customize\_selective\_refresh' => true) |
  | 18 |  | ); |
  | 19 |  | } |
  | 20 |  |  |
  | 21 |  | public function form($instance) |
  | 22 |  | { |
  | 23 |  | $defaults = array( |
  | 24 |  | 'title' => '', |
  | 25 |  | ); |
  | 26 |  | extract(wp\_parse\_args((array) $instance, $defaults)); |
  | 27 |  | ?> |
  | 28 |  | <?php // Widget Title ?> |
  | 29 |  | <p> |
  | 30 |  | <label for="<?php echo esc\_attr($this->get\_field\_id('title')); ?>"><?php \_e('Widget Title', 'text\_domain');?></label> |
  | 31 |  | <input class="widefat" id="<?php echo esc\_attr($this->get\_field\_id('title')); ?>" name="<?php echo esc\_attr($this->get\_field\_name('title')); ?>" type="text" value="<?php echo esc\_attr($title); ?>" /> |
  | 32 |  | </p> |
  | 33 |  | <?php |
  | 34 |  | } |
  | 35 |  |  |
  | 36 |  | public function update($new\_instance, $old\_instance) |
  | 37 |  | { |
  | 38 |  | $instance = $old\_instance; |
  | 39 |  | $instance['title'] = isset($new\_instance['title']) ? wp\_strip\_all\_tags($new\_instance['title']) : ''; |
  | 40 |  | return $instance; |
  | 41 |  | } |
  | 42 |  |  |
  | 43 |  | public function widget($args, $instance) |
  | 44 |  | { |
  |  | 14 | ['customize\_selective\_refresh' => true] |
  |  | 15 | ); |
  |  | 16 | } |
  |  | 17 |  |
  |  | 18 | public function form($instance) { |
  |  | 19 | $defaults = [ |
  |  | 20 | 'title' => '', |
  |  | 21 | ]; |
  |  | 22 | extract(wp\_parse\_args((array) $instance, $defaults)); |
  |  | 23 | ?> |
  |  | 24 | <?php // Widget Title ?> |
  |  | 25 | <p> |
  |  | 26 | <label for="<?php echo esc\_attr($this->get\_field\_id('title')); ?>"><?php \_e('Widget Title', 'text\_domain');?></label> |
  |  | 27 | <input class="widefat" id="<?php echo esc\_attr($this->get\_field\_id('title')); ?>" name="<?php echo esc\_attr($this->get\_field\_name('title')); ?>" type="text" value="<?php echo esc\_attr($title); ?>" /> |
  |  | 28 | </p> |
  |  | 29 | <?php |
  |  | 30 | } |
  |  | 31 |  |
  |  | 32 | public function update($new\_instance, $old\_instance) { |
  |  | 33 | $instance = $old\_instance; |
  |  | 34 | $instance['title'] = isset($new\_instance['title']) ? wp\_strip\_all\_tags($new\_instance['title']) : ''; |
  |  | 35 | return $instance; |
  |  | 36 | } |
  |  | 37 |  |
  |  | 38 | public function widget($args, $instance) { |
  | 45 | 39 | extract($args); |
  | 46 | 40 | $title = isset($instance['title']) ? apply\_filters('widget\_title', $instance['title']) : ''; |
  | […](/browser/slick-engagement/trunk/SlickEngagement_Widgets.php?rev=2462387#L55) | […](/browser/slick-engagement/trunk/SlickEngagement_Widgets.php?rev=3184136#L49) |  |
  | 55 | 49 | } |
  | 56 | 50 |  |
  | 57 |  | class Slick\_Game\_Widget extends WP\_Widget |
  | 58 |  | { |
  | 59 |  | /\*\* |
  | 60 |  | \* based on https://www.wpexplorer.com/create-widget-plugin-wordpress/ |
  | 61 |  |  |
  | 62 |  | \* The widget simply creates a container that the Slick script will populate |
  | 63 |  | \* after the page loads. |
  | 64 |  | \*/ |
  | 65 |  |  |
  | 66 |  | public function \_\_construct() |
  | 67 |  | { |
  | 68 |  | parent::\_\_construct( |
  | 69 |  | 'slick\_game\_widget', |
  | 70 |  | \_\_('Slick Game Widget', 'text\_domain'), |
  | 71 |  | array('customize\_selective\_refresh' => true) |
  | 72 |  | ); |
  | 73 |  | } |
  | 74 |  |  |
  | 75 |  | public function form($instance) |
  | 76 |  | { |
  | 77 |  | $defaults = array( |
  | 78 |  | 'title' => '', |
  | 79 |  | ); |
  | 80 |  | extract(wp\_parse\_args((array) $instance, $defaults)); |
  | 81 |  | ?> |
  | 82 |  | <?php // Widget Title ?> |
  | 83 |  | <p> |
  | 84 |  | <label for="<?php echo esc\_attr($this->get\_field\_id('title')); ?>"><?php \_e('Widget Title', 'text\_domain');?></label> |
  | 85 |  | <input class="widefat" id="<?php echo esc\_attr($this->get\_field\_id('title')); ?>" name="<?php echo esc\_attr($this->get\_field\_name('title')); ?>" type="text" value="<?php echo esc\_attr($title); ?>" /> |
  | 86 |  | </p> |
  | 87 |  | <?php |
  | 88 |  | } |
  | 89 |  |  |
  | 90 |  | public function update($new\_instance, $old\_instance) |
  | 91 |  | { |
  | 92 |  | $instance = $old\_instance; |
  | 93 |  | $instance['title'] = isset($new\_instance['title']) ? wp\_strip\_all\_tags($new\_instance['title']) : ''; |
  | 94 |  | return $instance; |
  | 95 |  | } |
  | 96 |  |  |
  | 97 |  | public function widget($args, $instance) |
  | 98 |  | { |
  | 99 |  | extract($args); |
  | 100 |  | $title = isset($instance['title']) ? apply\_filters('widget\_title', $instance['title']) : ''; |
  | 101 |  | echo $before\_widget; |
  | 102 |  | if ($title) { |
  | 103 |  | echo $before\_title . $title . $after\_title; |
  | 104 |  | } |
  | 105 |  | echo '<div class="slick-widget slick-game-panel">'; |
  | 106 |  | echo '</div>'; |
  | 107 |  | echo $after\_widget; |
  | 108 |  | } |
  | 109 |  | } |
  | 110 |  |  |
  | 111 |  | class Slick\_Grid\_Widget extends WP\_Widget |
  | 112 |  | { |
  | 113 |  | /\*\* |
  | 114 |  | \* based on https://www.wpexplorer.com/create-widget-plugin-wordpress/ |
  | 115 |  |  |
  | 116 |  | \* The widget simply creates a container that the Slick script will populate |
  | 117 |  | \* after the page loads with the Slick grid widget. |
  | 118 |  | \*/ |
  | 119 |  |  |
  | 120 |  | public function \_\_construct() |
  | 121 |  | { |
  |  | 51 | class Slick\_Grid\_Widget extends WP\_Widget { |
  |  | 52 | /\*\* |
  |  | 53 | \* The widget simply creates a container that the Slick script will populate |
  |  | 54 | \* after the page loads with the Slick grid widget. |
  |  | 55 | \*/ |
  |  | 56 |  |
  |  | 57 | public function \_\_construct() { |
  | 122 | 58 | parent::\_\_construct( |
  | 123 | 59 | 'slick\_grid\_widget', |
  | 124 | 60 | \_\_('Slick Grid Widget', 'text\_domain'), |
  | 125 |  | array('customize\_selective\_refresh' => true) |
  | 126 |  | ); |
  | 127 |  | } |
  | 128 |  |  |
  | 129 |  | public function form($instance) |
  | 130 |  | { |
  | 131 |  | $defaults = array( |
  |  | 61 | ['customize\_selective\_refresh' => true] |
  |  | 62 | ); |
  |  | 63 | } |
  |  | 64 |  |
  |  | 65 | public function form($instance) { |
  |  | 66 | $defaults = [ |
  | 132 | 67 | 'title' => '', |
  | 133 | 68 | 'id' => '', |
  | 134 |  | ~~)~~; |
  |  | 69 | ]; |
  | 135 | 70 | extract(wp\_parse\_args((array) $instance, $defaults)); |
  | 136 | 71 | ?> |
  | […](/browser/slick-engagement/trunk/SlickEngagement_Widgets.php?rev=2462387#L145) | […](/browser/slick-engagement/trunk/SlickEngagement_Widgets.php?rev=3184136#L80) |  |
  | 145 | 80 | </p> |
  | 146 | 81 | <?php |
  | 147 |  | } |
  | 148 |  |  |
  | 149 |  | public function update($new\_instance, $old\_instance) |
  | 150 |  | { |
  |  | 82 | } |
  |  | 83 |  |
  |  | 84 | public function update($new\_instance, $old\_instance) { |
  | 151 | 85 | $instance = $old\_instance; |
  | 152 | 86 | $instance['title'] = isset($new\_instance['title']) ? wp\_strip\_all\_tags($new\_instance['title']) : ''; |
  | […](/browser/slick-engagement/trunk/SlickEngagement_Widgets.php?rev=2462387#L155) | […](/browser/slick-engagement/trunk/SlickEngagement_Widgets.php?rev=3184136#L89) |  |
  | 155 | 89 | } |
  | 156 | 90 |  |
  | 157 |  | public function widget($args, $instance) |
  | 158 |  | { |
  |  | 91 | public function widget($args, $instance) { |
  | 159 | 92 | extract($args); |
  | 160 | 93 | $title = isset($instance['title']) ? apply\_filters('widget\_title', $instance['title']) : ''; |
  | […](/browser/slick-engagement/trunk/SlickEngagement_Widgets.php?rev=2462387#L167) | […](/browser/slick-engagement/trunk/SlickEngagement_Widgets.php?rev=3184136#L100) |  |
  | 167 | 100 | echo '<div class="slick-content-grid" data-config="' . trim($id) . '"></div>' . "\n"; |
  | 168 | 101 | } else { |
  | 169 |  | echo '<div class="slick-content-grid"></div>' . "\n"; |
  | 170 |  | } |
  | 171 |  | echo $after\_widget; |
  | 172 |  | } |
  | 173 |  | } |
  | 174 |  |  |
  | 175 |  | class Slick\_Story\_Player\_Widget extends WP\_Widget |
  | 176 |  | { |
  | 177 |  | /\*\* |
  | 178 |  | \* based on https://www.wpexplorer.com/create-widget-plugin-wordpress/ |
  | 179 |  |  |
  | 180 |  | \* The widget simply creates a container that the Slick script will populate |
  | 181 |  | \* after the page loads with the Slick grid widget. |
  | 182 |  | \*/ |
  | 183 |  |  |
  | 184 |  | public function \_\_construct() |
  | 185 |  | { |
  |  | 102 | echo "<div class=\"slick-content-grid\"></div>\n"; |
  |  | 103 | } |
  |  | 104 | echo $after\_widget; |
  |  | 105 | } |
  |  | 106 | } |
  |  | 107 |  |
  |  | 108 | class Slick\_Story\_Player\_Widget extends WP\_Widget { |
  |  | 109 | /\*\* |
  |  | 110 | \* The widget simply creates a container that the Slick script will populate |
  |  | 111 | \* after the page loads with the Slick grid widget. |
  |  | 112 | \*/ |
  |  | 113 |  |
  |  | 114 | public function \_\_construct() { |
  | 186 | 115 | parent::\_\_construct( |
  | 187 | 116 | 'slick\_story\_player\_widget', |
  | 188 | 117 | \_\_('Slick Story Player Widget', 'text\_domain'), |
  | 189 |  | array('customize\_selective\_refresh' => true) |
  | 190 |  | ); |
  | 191 |  | } |
  | 192 |  |  |
  | 193 |  | public function form($instance) |
  | 194 |  | { |
  | 195 |  | $defaults = array( |
  |  | 118 | ['customize\_selective\_refresh' => true] |
  |  | 119 | ); |
  |  | 120 | } |
  |  | 121 |  |
  |  | 122 | public function form($instance) { |
  |  | 123 | $defaults = [ |
  | 196 | 124 | 'title' => '', |
  | 197 | 125 | 'webstoryurl' => '', |
  | 198 |  | ~~)~~; |
  |  | 126 | ]; |
  | 199 | 127 | extract(wp\_parse\_args((array) $instance, $defaults)); |
  | 200 | 128 | ?> |
  | […](/browser/slick-engagement/trunk/SlickEngagement_Widgets.php?rev=2462387#L209) | […](/browser/slick-engagement/trunk/SlickEngagement_Widgets.php?rev=3184136#L137) |  |
  | 209 | 137 | </p> |
  | 210 | 138 | <?php |
  | 211 |  | } |
  | 212 |  |  |
  | 213 |  | public function update($new\_instance, $old\_instance) |
  | 214 |  | { |
  |  | 139 | } |
  |  | 140 |  |
  |  | 141 | public function update($new\_instance, $old\_instance) { |
  | 215 | 142 | $instance = $old\_instance; |
  | 216 | 143 | $instance['title'] = isset($new\_instance['title']) ? wp\_strip\_all\_tags($new\_instance['title']) : ''; |
  | […](/browser/slick-engagement/trunk/SlickEngagement_Widgets.php?rev=2462387#L219) | […](/browser/slick-engagement/trunk/SlickEngagement_Widgets.php?rev=3184136#L146) |  |
  | 219 | 146 | } |
  | 220 | 147 |  |
  | 221 |  | public function widget($args, $instance) |
  | 222 |  | { |
  |  | 148 | public function widget($args, $instance)  { |
  | 223 | 149 | extract($args); |
  | 224 | 150 | $title = isset($instance['title']) ? apply\_filters('widget\_title', $instance['title']) : ''; |
  | […](/browser/slick-engagement/trunk/SlickEngagement_Widgets.php?rev=2462387#L230) | […](/browser/slick-engagement/trunk/SlickEngagement_Widgets.php?rev=3184136#L156) |  |
  | 230 | 156 | } |
  | 231 | 157 | $storyId = $this->getStoryIdFromUrl($webstoryurl); |
  | 232 |  | echo ~~'<slick-webstory-player id="story-' . $storyId . '">' . "~~\n"; |
  | 233 |  | echo ~~'  <a href="' . $webstoryurl . '"></a>' . "~~\n"; |
  | 234 |  | echo ~~'</slick-webstory-player>' . "~~\n"; |
  |  | 158 | echo "<slick-webstory-player id=\"story-$storyId\">\n"; |
  |  | 159 | echo "  <a href=\"$webstoryurl\"></a>\n"; |
  |  | 160 | echo "</slick-webstory-player>\n"; |
  | 235 | 161 | echo $after\_widget; |
  | 236 | 162 | } |
  | 237 | 163 | } |
  | 238 | 164 |  |
  | 239 |  | public function getStoryIdFromUrl($url) |
  | 240 |  | { |
  |  | 165 | public function getStoryIdFromUrl($url) { |
  | 241 | 166 | if (strpos($url, 'slickstream.com') !== false && strpos($url, '/d/webstory') !== false) { |
  | 242 | 167 | $parts = explode('/', $url); |
  | […](/browser/slick-engagement/trunk/SlickEngagement_Widgets.php?rev=2462387#L251) | […](/browser/slick-engagement/trunk/SlickEngagement_Widgets.php?rev=3184136#L176) |  |
  | 251 | 176 | } |
  | 252 | 177 |  |
  | 253 |  | class Slick\_Story\_Carousel\_Widget extends WP\_Widget |
  | 254 |  | { |
  | 255 |  | /\*\* |
  | 256 |  | \* based on https://www.wpexplorer.com/create-widget-plugin-wordpress/ |
  | 257 |  |  |
  | 258 |  | \* The widget simply creates a container that the Slick script will populate |
  | 259 |  | \* after the page loads with the Slick grid widget. |
  | 260 |  | \*/ |
  | 261 |  |  |
  | 262 |  | public function \_\_construct() |
  | 263 |  | { |
  |  | 178 | class Slick\_Story\_Carousel\_Widget extends WP\_Widget { |
  |  | 179 | /\*\* |
  |  | 180 | \* The widget simply creates a container that the Slick script will populate |
  |  | 181 | \* after the page loads with the Slick grid widget. |
  |  | 182 | \*/ |
  |  | 183 |  |
  |  | 184 | public function \_\_construct() { |
  | 264 | 185 | parent::\_\_construct( |
  | 265 | 186 | 'slick\_story\_carousel\_widget', |
  | 266 | 187 | \_\_('Slick Story Carousel Widget', 'text\_domain'), |
  | 267 |  | array('customize\_selective\_refresh' => true) |
  | 268 |  | ); |
  | 269 |  | } |
  | 270 |  |  |
  | 271 |  | public function form($instance) |
  | 272 |  | { |
  | 273 |  | $defaults = array( |
  | 274 |  | 'title' => '', |
  | 275 |  | ); |
  | 276 |  | extract(wp\_parse\_args((array) $instance, $defaults)); |
  | 277 |  | ?> |
  | 278 |  | <?php // Widget Title ?> |
  | 279 |  | <p> |
  | 280 |  | <label for="<?php echo esc\_attr($this->get\_field\_id('title')); ?>"><?php \_e('Widget Title', 'text\_domain');?></label> |
  | 281 |  | <input class="widefat" id="<?php echo esc\_attr($this->get\_field\_id('title')); ?>" name="<?php echo esc\_attr($this->get\_field\_name('title')); ?>" type="text" value="<?php echo esc\_attr($title); ?>" /> |
  | 282 |  | </p> |
  | 283 |  | <?php |
  | 284 |  | } |
  | 285 |  |  |
  | 286 |  | public function update($new\_instance, $old\_instance) |
  | 287 |  | { |
  | 288 |  | $instance = $old\_instance; |
  | 289 |  | $instance['title'] = isset($new\_instance['title']) ? wp\_strip\_all\_tags($new\_instance['title']) : ''; |
  | 290 |  | return $instance; |
  | 291 |  | } |
  | 292 |  |  |
  | 293 |  | public function widget($args, $instance) |
  | 294 |  | { |
  | 295 |  | extract($args); |
  | 296 |  | $title = isset($instance['title']) ? apply\_filters('widget\_title', $instance['title']) : ''; |
  | 297 |  | echo $before\_widget; |
  | 298 |  | if ($title) { |
  | 299 |  | echo $before\_title . $title . $after\_title; |
  | 300 |  | } |
  | 301 |  | echo '<style>.slick-story-carousel {min-height: 324px;} @media (max-width: 600px) {.slick-story-carousel {min-height: 224px;}}</style>' . "\n"; |
  | 302 |  | echo '<div class="slick-story-carousel"></div>' . "\n"; |
  | 303 |  | echo $after\_widget; |
  | 304 |  | } |
  | 305 |  | } |
  | 306 |  |  |
  | 307 |  | class Slick\_Story\_Explorer\_Widget extends WP\_Widget |
  | 308 |  | { |
  | 309 |  | /\*\* |
  | 310 |  | \* based on https://www.wpexplorer.com/create-widget-plugin-wordpress/ |
  | 311 |  |  |
  | 312 |  | \* The widget simply creates a container that the Slick script will populate |
  | 313 |  | \* after the page loads with the Slick grid widget. |
  | 314 |  | \*/ |
  | 315 |  |  |
  | 316 |  | public function \_\_construct() |
  | 317 |  | { |
  |  | 188 | ['customize\_selective\_refresh' => true] |
  |  | 189 | ); |
  |  | 190 | } |
  |  | 191 |  |
  |  | 192 | public function form($instance)  { |
  |  | 193 | $defaults = [ |
  |  | 194 | 'title' => '', |
  |  | 195 | ]; |
  |  | 196 | extract(wp\_parse\_args((array) $instance, $defaults)); |
  |  | 197 | ?> |
  |  | 198 | <?php // Widget Title ?> |
  |  | 199 | <p> |
  |  | 200 | <label for="<?php echo esc\_attr($this->get\_field\_id('title')); ?>"><?php \_e('Widget Title', 'text\_domain');?></label> |
  |  | 201 | <input class="widefat" id="<?php echo esc\_attr($this->get\_field\_id('title')); ?>" name="<?php echo esc\_attr($this->get\_field\_name('title')); ?>" type="text" value="<?php echo esc\_attr($title); ?>" /> |
  |  | 202 | </p> |
  |  | 203 | <?php |
  |  | 204 | } |
  |  | 205 |  |
  |  | 206 | public function update($new\_instance, $old\_instance) { |
  |  | 207 | $instance = $old\_instance; |
  |  | 208 | $instance['title'] = isset($new\_instance['title']) ? wp\_strip\_all\_tags($new\_instance['title']) : ''; |
  |  | 209 | return $instance; |
  |  | 210 | } |
  |  | 211 |  |
  |  | 212 | public function widget($args, $instance) { |
  |  | 213 | extract($args); |
  |  | 214 | $title = isset($instance['title']) ? apply\_filters('widget\_title', $instance['title']) : ''; |
  |  | 215 | echo $before\_widget; |
  |  | 216 | if ($title) { |
  |  | 217 | echo $before\_title . $title . $after\_title; |
  |  | 218 | } |
  |  | 219 | echo "<style>.slick-story-carousel {min-height: 324px;} @media (max-width: 600px) {.slick-story-carousel {min-height: 224px;}}</style>\n"; |
  |  | 220 | echo "<div class=\"slick-story-carousel\"></div>\n"; |
  |  | 221 | echo $after\_widget; |
  |  | 222 | } |
  |  | 223 | } |
  |  | 224 |  |
  |  | 225 | class Slick\_Story\_Explorer\_Widget extends WP\_Widget { |
  |  | 226 | /\*\* |
  |  | 227 | \* The widget simply creates a container that the Slick script will populate |
  |  | 228 | \* after the page loads with the Slick grid widget. |
  |  | 229 | \*/ |
  |  | 230 |  |
  |  | 231 | public function \_\_construct() { |
  | 318 | 232 | parent::\_\_construct( |
  | 319 | 233 | 'slick\_story\_explorer\_widget', |
  | 320 | 234 | \_\_('Slick Story Explorer Widget', 'text\_domain'), |
  | 321 |  | array('customize\_selective\_refresh' => true) |
  | 322 |  | ); |
  | 323 |  | } |
  | 324 |  |  |
  | 325 |  | public function form($instance) |
  | 326 |  | { |
  | 327 |  | $defaults = array( |
  | 328 |  | 'title' => '', |
  | 329 |  | ); |
  | 330 |  | extract(wp\_parse\_args((array) $instance, $defaults)); |
  | 331 |  | ?> |
  | 332 |  | <?php // Widget Title ?> |
  | 333 |  | <p> |
  | 334 |  | <label for="<?php echo esc\_attr($this->get\_field\_id('title')); ?>"><?php \_e('Widget Title', 'text\_domain');?></label> |
  | 335 |  | <input class="widefat" id="<?php echo esc\_attr($this->get\_field\_id('title')); ?>" name="<?php echo esc\_attr($this->get\_field\_name('title')); ?>" type="text" value="<?php echo esc\_attr($title); ?>" /> |
  | 336 |  | </p> |
  | 337 |  | <?php |
  | 338 |  | } |
  | 339 |  |  |
  | 340 |  | public function update($new\_instance, $old\_instance) |
  | 341 |  | { |
  | 342 |  | $instance = $old\_instance; |
  | 343 |  | $instance['title'] = isset($new\_instance['title']) ? wp\_strip\_all\_tags($new\_instance['title']) : ''; |
  | 344 |  | return $instance; |
  | 345 |  | } |
  | 346 |  |  |
  | 347 |  | public function widget($args, $instance) |
  | 348 |  | { |
  |  | 235 | ['customize\_selective\_refresh' => true] |
  |  | 236 | ); |
  |  | 237 | } |
  |  | 238 |  |
  |  | 239 | public function form($instance) { |
  |  | 240 | $defaults = [ |
  |  | 241 | 'title' => '', |
  |  | 242 | ]; |
  |  | 243 | extract(wp\_parse\_args((array) $instance, $defaults)); |
  |  | 244 | ?> |
  |  | 245 | <?php // Widget Title ?> |
  |  | 246 | <p> |
  |  | 247 | <label for="<?php echo esc\_attr($this->get\_field\_id('title')); ?>"><?php \_e('Widget Title', 'text\_domain');?></label> |
  |  | 248 | <input class="widefat" id="<?php echo esc\_attr($this->get\_field\_id('title')); ?>" name="<?php echo esc\_attr($this->get\_field\_name('title')); ?>" type="text" value="<?php echo esc\_attr($title); ?>" /> |
  |  | 249 | </p> |
  |  | 250 | <?php |
  |  | 251 | } |
  |  | 252 |  |
  |  | 253 | public function update($new\_instance, $old\_instance) { |
  |  | 254 | $instance = $old\_instance; |
  |  | 255 | $instance['title'] = isset($new\_instance['title']) ? wp\_strip\_all\_tags($new\_instance['title']) : ''; |
  |  | 256 | return $instance; |
  |  | 257 | } |
  |  | 258 |  |
  |  | 259 | public function widget($args, $instance) { |
  | 349 | 260 | extract($args); |
  | 350 | 261 | $title = isset($instance['title']) ? apply\_filters('widget\_title', $instance['title']) : ''; |
  | […](/browser/slick-engagement/trunk/SlickEngagement_Widgets.php?rev=2462387#L358) | […](/browser/slick-engagement/trunk/SlickEngagement_Widgets.php?rev=3184136#L269) |  |
  | 358 | 269 | } |
  | 359 | 270 |  |
  | 360 |  | function register\_slick\_widgets() |
  | 361 |  | { |
  |  | 271 | function register\_slick\_widgets(): void { |
  | 362 | 272 | register\_widget('Slick\_FilmStrip\_Widget'); |
  | 363 |  | ~~register\_widget('Slick\_Game\_Widget');~~ |
  | 364 | 273 | register\_widget('Slick\_Grid\_Widget'); |
  | 365 | 274 | register\_widget('Slick\_Story\_Player\_Widget'); |
* ## [slick-engagement/trunk/readme.txt](/changeset/3184136/slick-engagement/trunk/readme.txt "Show the changeset 3184136 restricted to slick-engagement/trunk/readme.txt")

  | [r3104175](/browser/slick-engagement/trunk/readme.txt?rev=3104175#L6 "Show revision 3104175 of this file in browser") | [r3184136](/browser/slick-engagement/trunk/readme.txt?rev=3184136#L6 "Show revision 3184136 of this file in browser") |  |
  | --- | --- | --- |
  | 6 | 6 | License URI: http://www.gnu.org/licenses/gpl-3.0.html |
  | 7 | 7 | Requires at least: 5.0 |
  | 8 |  | Requires PHP: ~~5.6~~ |
  | 9 |  | Tested up to: 6.~~5~~ |
  | 10 |  | Stable tag: ~~1.4.4~~ |
  |  | 8 | Requires PHP: 7.4 |
  |  | 9 | Tested up to: 6.6.2 |
  |  | 10 | Stable tag: 2.0.0 |
  | 11 | 11 |  |
  | 12 | 12 | Use Slickstream to upgrade your site search.  Get beautiful as-you-type search, relevant content recommendations, user favorites and more! |
  | […](/browser/slick-engagement/trunk/readme.txt?rev=3104175#L14) | […](/browser/slick-engagement/trunk/readme.txt?rev=3184136#L14) |  |
  | 14 | 14 | == Description == |
  | 15 | 15 |  |
  | 16 |  | This plugin is for [Slickstream](https://www.slickstream.com) customers.  It adds our embed code and key metadata into |
  | 17 |  | your webpages without affecting site speed or performance. |
  |  | 16 | This plugin is for [Slickstream](https://www.slickstream.com) customers.  It adds our embed code and key metadata into your webpages without affecting site speed or performance. |
  | 18 | 17 |  |
  | 19 | 18 | Slickstream users get unlimited access to all of our tools, including: |
  | […](/browser/slick-engagement/trunk/readme.txt?rev=3104175#L38) | […](/browser/slick-engagement/trunk/readme.txt?rev=3184136#L37) |  |
  | 38 | 37 | - Floating Back-to-Top: Simple option to return to top of content |
  | 39 | 38 | - Web Story Player: Full site integrations for existing web stories |
  | 40 |  | ~~- Interactive Games: Automatically generated minigames featuring recommendations~~ |
  | 41 | 39 | - Campaigns: Incorporate custom objectives into user experience (business only) |
  | 42 | 40 | - Analytics Portal: Robust insights into both Slickstream statistics and general |
  | […](/browser/slick-engagement/trunk/readme.txt?rev=3104175#L169) | […](/browser/slick-engagement/trunk/readme.txt?rev=3184136#L167) |  |
  | 169 | 167 | - Fix bug with widget declaration |
  | 170 | 168 |  |
  | 171 |  | = 1.1.2 |
  |  | 169 | = 1.1.2 = |
  | 172 | 170 | - Changed embed code to absolute URL |
  | 173 | 171 |  |
  | 174 |  | = 1.1.3 |
  |  | 172 | = 1.1.3 = |
  | 175 | 173 | - Trim site codes in case someone adds whitespace |
  | 176 | 174 |  |
  | 177 |  | = 1.1.4 |
  |  | 175 | = 1.1.4 = |
  | 178 | 176 | - Declare compatibility with WP 4.3 |
  | 179 | 177 |  |
  | 180 |  | = 1.1.5 |
  |  | 178 | = 1.1.5 = |
  | 181 | 179 | - New inline embed code that fixes problem with Firefox Private Browsing |
  | 182 | 180 |  |
  | 183 |  | = 1.1.6 |
  |  | 181 | = 1.1.6 = |
  | 184 | 182 | - Name and description updates only, no functional changes |
  | 185 | 183 |  |
  | 186 |  | = 1.1.7 |
  |  | 184 | = 1.1.7 = |
  | 187 | 185 | - Revised shortcode for story-viewer |
  | 188 | 186 |  |
  | 189 |  | = 1.1.8 |
  |  | 187 | = 1.1.8 = |
  | 190 | 188 | - Added widget and shortcode support for content-grid widget |
  | 191 | 189 |  |
  | 192 |  | = 1.1.9 |
  |  | 190 | = 1.1.9 = |
  | 193 | 191 | - Added widgets and shortcodes for story-carousel and story-explorer |
  | 194 | 192 | - Revised shortcode for story-viewer to use new embed code style |
  | 195 | 193 | - Added option for Genesis-based filmstrip container reservation |
  | 196 | 194 |  |
  | 197 |  | = 1.1.10 |
  |  | 195 | = 1.1.10 = |
  | 198 | 196 | - More options for Genesis-based container reservation |
  | 199 | 197 | - Internal testing option added |
  | 200 | 198 |  |
  | 201 |  | = 1.1.11 |
  |  | 199 | = 1.1.11 = |
  | 202 | 200 | - Minor fix to category fetching |
  | 203 | 201 | - Tested with WP 5.7.1 |
  | 204 | 202 |  |
  | 205 |  | = 1.1.12 |
  |  | 203 | = 1.1.12 = |
  | 206 | 204 | - Filmstrip injection now supports Genesis, Trellis/THA, and Thesis-based themes |
  | 207 | 205 | - Added Slickstream LD\_JSON |
  | 208 | 206 |  |
  | 209 |  | = 1.1.13 |
  |  | 207 | = 1.1.13 = |
  | 210 | 208 | - Removing Slickstream LD\_JSON |
  | 211 | 209 |  |
  | 212 |  | = 1.1.14 |
  |  | 210 | = 1.1.14 = |
  | 213 | 211 | - Bumping stable version |
  | 214 | 212 |  |
  | 215 |  | = 1.1.15 |
  |  | 213 | = 1.1.15 = |
  | 216 | 214 | - Support for Kadence theme hooks |
  | 217 | 215 |  |
  | 218 |  | = 1.1.16 |
  |  | 216 | = 1.1.16 = |
  | 219 | 217 | - Slickstream JSON metadata |
  | 220 | 218 |  |
  | 221 |  | = 1.1.17 |
  |  | 219 | = 1.1.17 = |
  | 222 | 220 | - Remove extraneous logging |
  | 223 | 221 | - Add support for custom injection hook |
  | 224 | 222 |  |
  | 225 |  | = 1.2.0 |
  |  | 223 | = 1.2.0 = |
  | 226 | 224 | - New embed code with support for boot loader |
  | 227 | 225 |  |
  | 228 |  | = 1.2.1 |
  |  | 226 | = 1.2.1 = |
  | 229 | 227 | - New options for injecting DCM |
  | 230 | 228 |  |
  | 231 |  | = 1.2.2 |
  |  | 229 | = 1.2.2 = |
  | 232 | 230 | - Revised to clarify support option |
  | 233 | 231 |  |
  | 234 |  | = 1.2.3 |
  |  | 232 | = 1.2.3 = |
  | 235 | 233 | - Verified compatibility with WP 6.0.1 |
  | 236 | 234 |  |
  | 237 |  | = 1.2.4 |
  |  | 235 | = 1.2.4 = |
  | 238 | 236 | - Security enhancements |
  | 239 | 237 |  |
  | 240 |  | = 1.2.5 |
  |  | 238 | = 1.2.5 = |
  | 241 | 239 | - Enhanced A/B testing |
  | 242 | 240 |  |
  | 243 |  | = 1.3.0 |
  |  | 241 | = 1.3.0 = |
  | 244 | 242 | - Automatically reduces CLS without adjustments or setting changes from admin |
  | 245 | 243 |  |
  | 246 |  | = 1.3.1 |
  |  | 244 | = 1.3.1 = |
  | 247 | 245 | - Security enhancements |
  | 248 | 246 |  |
  | 249 |  | = 1.4.0 |
  |  | 247 | = 1.4.0 = |
  | 250 | 248 | - Performance improvements |
  | 251 | 249 | - CLS improvements |
  | 252 | 250 |  |
  | 253 |  | = 1.4.1 |
  |  | 251 | = 1.4.1 = |
  | 254 | 252 | - Added support for custom margins for CLS |
  | 255 | 253 |  |
  | 256 |  | = 1.4.2 |
  |  | 254 | = 1.4.2 = |
  | 257 | 255 | - Performance improvements |
  | 258 | 256 |  |
  | 259 |  | = 1.4.3 |
  |  | 257 | = 1.4.3 = |
  | 260 | 258 | - Include options for Genesis-based container reservation |
  | 261 | 259 | - Additional performance enhancements |
  | 262 | 260 |  |
  | 263 |  | = 1.4.4 |
  |  | 261 | = 1.4.4 = |
  | 264 | 262 | - Performance improvement for CLS |
  |  | 263 |  |
  |  | 264 | = 2.0.0 = |
  |  | 265 | - Code updates to follow best practices for PHP >= 7.4.0 |
  |  | 266 | - Page configuration data-loading performance improvements |
  |  | 267 | - Security enhancements |

**Note:** See [TracChangeset](/wiki/TracChangeset)
for help on using the changeset viewer.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Unified Diff](?format=diff&new=3184136)
* [Zip Archive](?format=zip&new=3184136)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from wordpress.org_a072e1ab_20250115_092411.html ===


[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Showcase](https://wordpress.org/showcase/)
* [Hosting](https://wordpress.org/hosting/)
* Extend
  + [Themes](https://wordpress.org/themes/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Blocks](https://wordpress.org/blocks/)
  + [Openverse ↗︎](https://openverse.org/)
* Learn
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* Community
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [Events](https://events.wordpress.org/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* About
  + [About WordPress](https://wordpress.org/about/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
* [Get WordPress](https://wordpress.org/download/)

Search in WordPress.org

[Get WordPress](https://wordpress.org/download/)

[WordPress.org](https://wordpress.org/)

[Plugin Directory](https://wordpress.org/plugins/)

Slickstream: Engagement and Conversions

* [Submit a plugin](https://wordpress.org/plugins/developers/)
* [My favorites](https://wordpress.org/plugins/browse/favorites/)
* [Log in](https://login.wordpress.org/?redirect_to=https%3A%2F%2Fwordpress.org%2Fplugins%2Fslick-engagement&locale=en_US)

* [Submit a plugin](https://wordpress.org/plugins/developers/)
* [My favorites](https://wordpress.org/plugins/browse/favorites/)
* [Log in](https://login.wordpress.org/?redirect_to=https%3A%2F%2Fwordpress.org%2Fplugins%2Fslick-engagement&locale=en_US)

Search plugins

![](https://ps.w.org/slick-engagement/assets/banner-772x250.png?rev=2173300)
![](https://ps.w.org/slick-engagement/assets/icon-256x256.png?rev=2026729)
# Slickstream: Engagement and Conversions

By [Slickstream](https://slickstream.com)

[Download](https://downloads.wordpress.org/plugin/slick-engagement.2.0.3.zip)

* [Details](https://wordpress.org/plugins/slick-engagement/#description)
* [Reviews](https://wordpress.org/plugins/slick-engagement/#reviews)
* [Installation](https://wordpress.org/plugins/slick-engagement/#installation)
* [Development](https://wordpress.org/plugins/slick-engagement/#developers)

[Support](https://wordpress.org/support/plugin/slick-engagement/)

## Description

This plugin is for [Slickstream](https://www.slickstream.com) customers. It adds our embed code and key metadata into your webpages without affecting site speed or performance.

Slickstream users get unlimited access to all of our tools, including:

– Responsive *as-you-type search* with a heap of advanced features that your visitors will love

– Customizable *recommendation carousels and grids* backed by real data

– Hassle-free *content favoriting* to keep your visitors coming back

– A robust *analytics portal* with engagement insights you can actually use

### The Slickstream Difference

What makes Slickstream different is that we handle the hard work for you. We sit outside of WordPress, which means when you sign up we build a model of your site and use it to populate all of our search and recommendation tools. Then you pick the ones you want to use, flip a switch, and we’re live! Your site can be running Slickstream tomorrow, with no complicated technical implementation required.

### What’s Included

* Floating Search: Search with Slickstream on any page
* Hooked Search Buttons: Automatically link your existing search to Slickstream
* Inline Search Module: As-you-type search results displaying on page
* Infinite Filmstrip: Content recommendations placed above posts
* Filmstrip Toolbar: Sticky recommendations that display on scroll
* Content Grid: Flexible recommendation module that can be placed anywhere
* Floating Favorites: Interactive content bookmarking with no sign-in required
* Floating Back-to-Top: Simple option to return to top of content
* Web Story Player: Full site integrations for existing web stories
* Campaigns: Incorporate custom objectives into user experience (business only)
* Analytics Portal: Robust insights into both Slickstream statistics and general

### General Features and Integrations:

* Supports all major themes and editors
* Search or recommend content across multiple domains
* Multi-language search results supported
* Configurable GDPR settings
* Designed for accessibility compliance
* Client-side API available
* Email provider integrations (MailChimp, ConvertKit, ActiveCampaign)
* First-party data integration with advertising networks
* Google Analytics integration
* Recipe card integrations (WP Recipe Maker, Tasty Recipes)
* E-commerce integration (Shopify)

### Configuration Options:

* Pre-made templates to choose from
* Granular look and feel controls
* Custom messaging on all text prompts
* Attribution removal (additional charge)
* Built-in CLS (Cumulative Layout Shift) handling
* Optional opt-in email collection
* Optional advertising slot inclusions

### Search and Recommendation Details:

* Search by category, content type, or author
* Default sort by relevance, date, or popularity
* Custom result weighting in search and recommendations
* Manual categorization and content grouping control
* Exclude results by category, content type, or individual posts
* Custom taxonomies supported
* Progressively detailed results including metadata
* Automatic content grouping in results
* Fuzzy matching and typo forgiveness
* Highlighted search terms in results
* Structured data search experience for ingredients or supplies
* All search queries recorded in analytics

## Screenshots

* [![](https://ps.w.org/slick-engagement/assets/screenshot-1.png?rev=2579450)](https://ps.w.org/slick-engagement/assets/screenshot-1.png?rev=2579450)

  Slickstream Search in action, filtered by “sauce” and displaying results for “chipotle” along with appropriate metadata.
* [![](https://ps.w.org/slick-engagement/assets/screenshot-2.png?rev=2579450)](https://ps.w.org/slick-engagement/assets/screenshot-2.png?rev=2579450)

  The on-page experience for Slickstream users. On display are Favorites/Bookmarks, Floating Search, Back-To-Top and the Filmstrip Toolbar.
* [![](https://ps.w.org/slick-engagement/assets/screenshot-3.png?rev=2579450)](https://ps.w.org/slick-engagement/assets/screenshot-3.png?rev=2579450)

  Automatic categorization within the Slickstream panel. Here you can see results for “dessert” grouped by popularity, date, and a related subcategory (“baking”).

## Installation

1. Visit <https://slickstream.com> and tell us about your site.
2. Install and activate this plugin.
3. On the settings page (“Slick” under Settings), enter the site code we give you and click Save.
4. Check with us if you’d like any customization of your widgets

## FAQ

### What is Slickstream?

Slickstream is a sophisticated market-leading user engagement suite designed for independent publishers. It helps you turn casual visitors into loyal readers that return again and again through intelligent as-you-type search, content recommendations, favoriting and membership capabilities, email sign-up, and other useful features. You can easily design captivating user journeys that lead visitors to exactly what they’re looking for. The result is higher pageviews, time-on-page, click-throughs, and return visits. As if that isn’t enough, Slickstream’s reporting gives deep insights into its performance and how your visitors are interacting on your site, far beyond what you can see in Google Analytics.

### How will Slickstream help me?

Slickstream helps you to get the most out of the traffic that visits your site by turning casual visitors into loyal readers, increasing ad revenue.

Customizable features complement your brand and create a more premium site experience. The powerful recommendation engine serves up the best content to your readers so they spend more time on your site. Slickstream also saves you time, money and hassle from not having to rely on developers, multiple products, or other resources to do a bunch of manual site customization handled with one simple Slickstream installation.

Worried about first-party data? Slickstream helps with that too! Slickstream helps you authenticate traffic and build first-party data with logged-in site visitors.

Slickstream also offers an email sign-up feature that you can use to collect email addresses, but you can seamlessly use your existing email subscription method too. Slicksteam’s Highlighter feature draws attention to any element of your site you choose and has proven to significantly improve conversions.

### Do You Support Languages Other Than English?

Yes we do. Our underlying recommendation technology is not English-specific, and we have already localized the Engagement Suite for German, Portuguese, Spanish, Dutch, French, Norwegian, Swedish, Croatian, Russian, Danish, Arabic, Hebrew, Japanese and more. [Reach out to us](https://www.slickstream.com/contact) and we can confirm if we support your language too.

### Where can I learn more about Slickstream?

You can find more information about Slickstream here on Slickstream.com.

## Reviews

![](https://secure.gravatar.com/avatar/7c972b56a219b343c0f0d6098fae9e20bc786ea945f0a695565c5b00c85c8b8c?s=60&d=retro&r=g)
### [Much more than search](https://wordpress.org/support/topic/much-more-than-search/)

[reversewinesnob](https://profiles.wordpress.org/reversewinesnob/ "Posts by reversewinesnob")
October 2, 2021

Slickstream has great search functionality of course but the ability to favorite is awesome as well. Recommendations are spot on. The analytics are way cool; in fact, I use them just as much, if not more, than Google Analytics. Best of all the support is amazing and they are willing to configure just about everything to exactly how you want it. Cost is reasonable too. An easy 5 stars for this one!

![](https://secure.gravatar.com/avatar/cdd482d1718f09437ca160665bc64c02d34e0c313159b65058337ba65c5a9870?s=60&d=retro&r=g)
### [Power house](https://wordpress.org/support/topic/power-house/)

[Julie is HostessAtHeart](https://profiles.wordpress.org/julie-is-hostessatheart/ "Posts by Julie is HostessAtHeart")
September 29, 2021

I had Slickstream and then moved away from it. The service I went with didn’t do a great job on recommendations and in some cases made no sense. Slickstream made it so easy to reconfigure my site exactly the way I wanted and I love the analytics that I have concerning searches on my site.

![](https://secure.gravatar.com/avatar/28225f1b7606c5a40134eab71575702a508403f9c8e1dabfd5d8227b880b3c29?s=60&d=retro&r=g)
### [Love it!](https://wordpress.org/support/topic/love-it-3584/)

[stipplequilt](https://profiles.wordpress.org/stipplequilt/ "Posts by stipplequilt")
August 24, 2021

I really like seeing the search images at the top of my website!

![](https://secure.gravatar.com/avatar/ab7ccec82df3b6a9bed1f9e2978ffdc0a569374a1c87699a4c832bf82126ad68?s=60&d=retro&r=g)
### [Such a great tool!](https://wordpress.org/support/topic/such-a-great-tool-6/)

[jamonkey](https://profiles.wordpress.org/jamonkey/ "Posts by jamonkey")
August 20, 2021

I love Slickstream and how great it recommends my content for readers.

![](https://secure.gravatar.com/avatar/b6e4ba0fded06fd50d50f3cb84f202c546db62d71ca301538b52942b0840efbc?s=60&d=retro&r=g)
### [LOVE Slickstream!](https://wordpress.org/support/topic/love-slickstream/)

[lisaandluckydog](https://profiles.wordpress.org/lisaandluckydog/ "Posts by lisaandluckydog")
August 18, 2021

I have noticed a massive difference in search engagement and time-on-page. My readers love the ease of search, and they are coming back again and again!

![](https://secure.gravatar.com/avatar/9ab4a53eefb8d46fb8382ad028b6dfbe3923f1ce4dcb6e9d5f24516788ed05a8?s=60&d=retro&r=g)
### [Love it!](https://wordpress.org/support/topic/love-it-3575/)

[forkinthekitchen](https://profiles.wordpress.org/forkinthekitchen/ "Posts by forkinthekitchen")
August 12, 2021

Slickstream has made searching on my site so easy!

[Read all 11 reviews](https://wordpress.org/support/plugin/slick-engagement/reviews/)
## Contributors & Developers

“Slickstream: Engagement and Conversions” is open source software. The following people have contributed to this plugin.

Contributors

* ![](https://secure.gravatar.com/avatar/68b1c2fa46026f2d90ba4359d1f7defaf7d3496f23e6ad86021e5adac8484ea7?s=32&d=mm&r=g) [Slickstream](https://profiles.wordpress.org/wpslickstream/)
* ![](https://secure.gravatar.com/avatar/1d50e0acfef01229b9c849a7a3cad0c19ad3a01f136dc4bd195254558cb0be90?s=32&d=mm&r=g) [Kingston Duffie](https://profiles.wordpress.org/kduffie/)

[Translate “Slickstream: Engagement and Conversions” into your language.](https://translate.wordpress.org/projects/wp-plugins/slick-engagement)

### Interested in development?

[Browse the code](https://plugins.trac.wordpress.org/browser/slick-engagement/), check out the [SVN repository](https://plugins.svn.wordpress.org/slick-engagement/), or subscribe to the [development log](https://plugins.trac.wordpress.org/log/slick-engagement/) by [RSS](https://plugins.trac.wordpress.org/log/slick-engagement/?limit=100&mode=stop_on_copy&format=rss).

## Changelog

#### 1.2.5

* Enhanced A/B testing

#### 1.3.0

* Automatically reduces CLS without adjustments or setting changes from admin

#### 1.3.1

* Security enhancements

#### 1.4.0

* Performance improvements
* CLS improvements

#### 1.4.1

* Added support for custom margins for CLS

#### 1.4.2

* Performance improvements

#### 1.4.3

* Include options for Genesis-based container reservation
* Additional performance enhancements

#### 1.4.4

* Performance improvement for CLS

#### 2.0.0

* Code updates to follow best practices for PHP >= 7.4.0
* Page configuration data-loading performance improvements
* Security enhancements

#### 2.0.1

* Updated plugin metadata to improve upgrade workflow
* Revised to show accurate version number and update status

#### 2.0.2

* Upgrade lifecycle bug fix

#### 2.0.3

* Restored `SlickEngagement_init()` function
* Tested to be comaptible up to WordPress 6.7.0

## Meta

* Version **2.0.3**
* Last updated **2 months ago**
* Active installations **2,000+**
* WordPress version **5.2.0 or higher**
* Tested up to **6.7.0**
* PHP version **7.4.0 or higher**
* Tags [bookmarks](https://wordpress.org/plugins/tags/bookmarks/)[engagement](https://wordpress.org/plugins/tags/engagement/)[favorites](https://wordpress.org/plugins/tags/favorites/)[recommendations](https://wordpress.org/plugins/tags/recommendations/)[search](https://wordpress.org/plugins/tags/search/)
* [Advanced View](https://wordpress.org/plugins/slick-engagement/advanced/)

## Ratings

5 out of 5 stars.

* [11 5-star reviews
  5 stars

  11](https://wordpress.org/support/plugin/slick-engagement/reviews/?filter=5)
* [0 4-star reviews
  4 stars

  0](https://wordpress.org/support/plugin/slick-engagement/reviews/?filter=4)
* [0 3-star reviews
  3 stars

  0](https://wordpress.org/support/plugin/slick-engagement/reviews/?filter=3)
* [0 2-star reviews
  2 stars

  0](https://wordpress.org/support/plugin/slick-engagement/reviews/?filter=2)
* [0 1-star reviews
  1 star

  0](https://wordpress.org/support/plugin/slick-engagement/reviews/?filter=1)

[Add my review](https://wordpress.org/support/plugin/slick-engagement/reviews/#new-post)

[See all reviews](https://wordpress.org/support/plugin/slick-engagement/reviews/)

## Contributors

* ![](https://secure.gravatar.com/avatar/68b1c2fa46026f2d90ba4359d1f7defaf7d3496f23e6ad86021e5adac8484ea7?s=32&d=mm&r=g) [Slickstream](https://profiles.wordpress.org/wpslickstream/)
* ![](https://secure.gravatar.com/avatar/1d50e0acfef01229b9c849a7a3cad0c19ad3a01f136dc4bd195254558cb0be90?s=32&d=mm&r=g) [Kingston Duffie](https://profiles.wordpress.org/kduffie/)
## Support

Got something to say? Need help?

[View support forum](https://wordpress.org/support/plugin/slick-engagement/)

## Donate

Would you like to support the advancement of this plugin?

[Donate to this plugin](https://slickstream.com)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Privacy](https://wordpress.org/about/privacy/)

* [Showcase](https://wordpress.org/showcase/)
* [Themes](https://wordpress.org/themes/)
* [Plugins](https://wordpress.org/plugins/)
* [Patterns](https://wordpress.org/patterns/)

* [Learn](https://learn.wordpress.org/)
* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [WordPress.tv ↗](https://wordpress.tv/)

* [Get Involved](https://make.wordpress.org/)
* [Events](https://events.wordpress.org/)
* [Donate ↗](https://wordpressfoundation.org/donate/)
* [Five for the Future](https://wordpress.org/five-for-the-future/)

* [WordPress.com ↗](https://wordpress.com/?ref=wporg-footer)
* [Matt ↗](https://ma.tt/)
* [bbPress ↗](https://bbpress.org/)
* [BuddyPress ↗](https://buddypress.org/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our X (formerly Twitter) account](https://www.x.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)
* [Visit our YouTube channel](https://www.youtube.com/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from www.wordfence.com_d4b6646d_20250115_092413.html ===


[![](https://www.wordfence.com/img/wordfence-intelligence-logo.svg)](/threat-intel/)

Have you found a vulnerability in a WordPress plugin or theme? Report vulnerabilities in WordPress plugins and themes through our [bug bounty program](https://www.wordfence.com/threat-intel/bug-bounty-program) and earn a bounty on all in-scope submissions, while we handle the responsible disclosure process on your behalf.

As a reminder, the Wordfence Intelligence Vulnerability Database API is completely free to query and utilize, both personally and commercially, and contains all the same vulnerability data as the user interface. Please review the API documentation and Webhook documentation for more information on how to query the vulnerability API endpoints and configure webhooks utilizing all the same data present in the Wordfence Intelligence user interface.

# Slickstream: Engagement and Conversions <= 1.4.4 - Authenticated (Contributor+) Stored Cross-Site Scripting via slick-grid Shortcode

 [Wordfence Intelligence](https://www.wordfence.com/threat-intel)   >    [Vulnerability Database](https://www.wordfence.com/threat-intel/vulnerabilities)   >   Slickstream: Engagement and Conversions <= 1.4.4 - Authenticated (Contributor+) Stored Cross-Site Scripting via slick-grid Shortcode

6.4

**Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')**
**CVSS Vector**
[CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:C/C:L/I:L/A:N](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:C/C:L/I:L/A:N)

| CVE | [CVE-2024-10179](https://www.cve.org/CVERecord?id=CVE-2024-10179) |
| --- | --- |
| CVSS | 6.4 (Medium) |
| Publicly Published | November 11, 2024 |
| Last Updated | November 12, 2024 |
| Researcher | [Peter Thaleikis](https://www.wordfence.com/threat-intel/vulnerabilities/researchers/spek) |

### Description

The Slickstream: Engagement and Conversions plugin for WordPress is vulnerable to Stored Cross-Site Scripting via the plugin's slick-grid shortcode in all versions up to, and including, 1.4.4 due to insufficient input sanitization and output escaping on user supplied attributes. This makes it possible for authenticated attackers, with contributor-level access and above, to inject arbitrary web scripts in pages that will execute whenever a user accesses an injected page.

#### References

* [wordpress.org](https://wordpress.org/plugins/slick-engagement/#developers)
* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/changeset/3184136/)

#### Share

[Facebook](https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fslick-engagement%2Fslickstream-engagement-and-conversions-144-authenticated-contributor-stored-cross-site-scripting-via-slick-grid-shortcode&t=Slickstream%3A%20Engagement%20and%20Conversions%20%3C%3D%201.4.4%20-%20Authenticated%20%28Contributor%2B%29%20Stored%20Cross-Site%20Scripting%20via%20slick-grid%20Shortcode "Facebook")
[Twitter](https://twitter.com/share?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fslick-engagement%2Fslickstream-engagement-and-conversions-144-authenticated-contributor-stored-cross-site-scripting-via-slick-grid-shortcode&text=Slickstream%3A%20Engagement%20and%20Conversions%20%3C%3D%201.4.4%20-%20Authenticated%20%28Contributor%2B%29%20Stored%20Cross-Site%20Scripting%20via%20slick-grid%20Shortcode "Twitter")
[LinkedIn](https://www.linkedin.com/shareArticle?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fslick-engagement%2Fslickstream-engagement-and-conversions-144-authenticated-contributor-stored-cross-site-scripting-via-slick-grid-shortcode "LinkedIn")
Email

## Vulnerability Details for Slickstream: Engagement and Conversions

#### [Slickstream: Engagement and Conversions](https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/slick-engagement)

| Software Type | Plugin |
| --- | --- |
| Software Slug | slick-engagement [(view on wordpress.org)](https://wordpress.org/plugins/slick-engagement) |
| Patched? | Yes |
| Remediation | Update to version 2.0.0, or a newer patched version |
| Affected Version | * <= 1.4.4 |
| Patched Version | * 2.0.0 |

This record contains material that is subject to copyright.

**Copyright 2012-2025 Defiant Inc.**

**License:**
Defiant hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute this software vulnerability information. Any copy of the software vulnerability information you make for such purposes is authorized provided that you include a hyperlink to this vulnerability record and reproduce Defiant's copyright designation and this license in any such copy.
**[Read more.](https://www.wordfence.com/wordfence-intelligence-terms-and-conditions/)**

**Copyright 1999-2025 The MITRE Corporation**

**License:**
CVE Usage: MITRE hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute Common Vulnerabilities and Exposures (CVE®). Any copy you make for such purposes is authorized provided that you reproduce MITRE's copyright designation and this license in any such copy.
**[Read more.](https://www.cve.org/Legal/TermsOfUse)**

Have information to add, or spot any errors? Contact us at wfi-support@wordfence.com so we can make any appropriate adjustments.

Did you know Wordfence Intelligence provides free personal and commercial API access to our comprehensive WordPress vulnerability database, along with a free webhook integration to stay on top of the latest vulnerabilities added and updated in the database? Get started today!

Learn more

Want to get notified of the latest vulnerabilities that may affect your WordPress site?
 Install Wordfence on your site today to get notified immediately if your site is affected by a vulnerability that has been added to our database.

Get Wordfence

The Wordfence Intelligence WordPress vulnerability database is completely free to access and query via API. Please review the documentation on how to access and consume the vulnerability data via API.

Documentation


