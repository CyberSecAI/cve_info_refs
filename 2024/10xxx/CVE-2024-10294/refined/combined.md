=== Content from www.wordfence.com_45e83ff7_20250114_211441.html ===


[![](https://www.wordfence.com/img/wordfence-intelligence-logo.svg)](/threat-intel/)

Have you found a vulnerability in a WordPress plugin or theme? Report vulnerabilities in WordPress plugins and themes through our [bug bounty program](https://www.wordfence.com/threat-intel/bug-bounty-program) and earn a bounty on all in-scope submissions, while we handle the responsible disclosure process on your behalf.

As a reminder, the Wordfence Intelligence Vulnerability Database API is completely free to query and utilize, both personally and commercially, and contains all the same vulnerability data as the user interface. Please review the API documentation and Webhook documentation for more information on how to query the vulnerability API endpoints and configure webhooks utilizing all the same data present in the Wordfence Intelligence user interface.

# CE21 Suite <= 2.2.0 - Missing Authorization to Unauthenticated Plugin Settings Change

 [Wordfence Intelligence](https://www.wordfence.com/threat-intel)   >    [Vulnerability Database](https://www.wordfence.com/threat-intel/vulnerabilities)   >   CE21 Suite <= 2.2.0 - Missing Authorization to Unauthenticated Plugin Settings Change

6.5

**Missing Authorization**
**CVSS Vector**
[CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:L/A:L](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:L/A:L)

| CVE | [CVE-2024-10294](https://www.cve.org/CVERecord?id=CVE-2024-10294) |
| --- | --- |
| CVSS | 6.5 (Medium) |
| Publicly Published | November 8, 2024 |
| Last Updated | November 9, 2024 |
| Researcher | [István Márton - Wordfence](https://www.wordfence.com/threat-intel/vulnerabilities/researchers/lana-codes) |

### Description

The CE21 Suite plugin for WordPress is vulnerable to unauthorized modification of data due to a missing capability check on the 'ce21\_single\_sign\_on\_save\_api\_settings' function in versions up to, and including, 2.2.0. This makes it possible for unauthenticated attackers to change plugin settings.

#### References

* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/browser/ce21-suite/trunk/includes/ce21-functions.php?rev=3097700#L340)

#### Share

[Facebook](https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fce21-suite%2Fce21-suite-220-missing-authorization-to-unauthenticated-plugin-settings-change&t=CE21%20Suite%20%3C%3D%202.2.0%20-%20Missing%20Authorization%20to%20Unauthenticated%20Plugin%20Settings%20Change "Facebook")
[Twitter](https://twitter.com/share?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fce21-suite%2Fce21-suite-220-missing-authorization-to-unauthenticated-plugin-settings-change&text=CE21%20Suite%20%3C%3D%202.2.0%20-%20Missing%20Authorization%20to%20Unauthenticated%20Plugin%20Settings%20Change "Twitter")
[LinkedIn](https://www.linkedin.com/shareArticle?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fce21-suite%2Fce21-suite-220-missing-authorization-to-unauthenticated-plugin-settings-change "LinkedIn")
Email

## Vulnerability Details for CE21 Suite

#### [CE21 Suite](https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/ce21-suite)

| Software Type | Plugin |
| --- | --- |
| Software Slug | ce21-suite [(view on wordpress.org)](https://wordpress.org/plugins/ce21-suite) |
| Patched? | No |
| Remediation | No known patch available. Please review the vulnerability's details in depth and employ mitigations based on your organization's risk tolerance. It may be best to uninstall the affected software and find a replacement. |
| Affected Version | * <= 2.2.0 |

This record contains material that is subject to copyright.

**Copyright 2012-2025 Defiant Inc.**

**License:**
Defiant hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute this software vulnerability information. Any copy of the software vulnerability information you make for such purposes is authorized provided that you include a hyperlink to this vulnerability record and reproduce Defiant's copyright designation and this license in any such copy.
**[Read more.](https://www.wordfence.com/wordfence-intelligence-terms-and-conditions/)**

**Copyright 1999-2025 The MITRE Corporation**

**License:**
CVE Usage: MITRE hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute Common Vulnerabilities and Exposures (CVE®). Any copy you make for such purposes is authorized provided that you reproduce MITRE's copyright designation and this license in any such copy.
**[Read more.](https://www.cve.org/Legal/TermsOfUse)**

Have information to add, or spot any errors? Contact us at wfi-support@wordfence.com so we can make any appropriate adjustments.

Did you know Wordfence Intelligence provides free personal and commercial API access to our comprehensive WordPress vulnerability database, along with a free webhook integration to stay on top of the latest vulnerabilities added and updated in the database? Get started today!

Learn more

Want to get notified of the latest vulnerabilities that may affect your WordPress site?
 Install Wordfence on your site today to get notified immediately if your site is affected by a vulnerability that has been added to our database.

Get Wordfence

The Wordfence Intelligence WordPress vulnerability database is completely free to access and query via API. Please review the documentation on how to access and consume the vulnerability data via API.

Documentation



=== Content from plugins.trac.wordpress.org_af0b6546_20250114_211440.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fbrowser%2Fce21-suite%2Ftrunk%2Fincludes%2Fce21-functions.php%3Frev%3D3097700)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Revision](/browser/ce21-suite/trunk/includes/ce21-functions.php?rev=2855730 "Revision 2855730")
* [Latest Revision](/browser/ce21-suite/trunk/includes/ce21-functions.php)
* [Next Revision](/browser/ce21-suite/trunk/includes/ce21-functions.php?rev=3197928 "Revision 3197928") →
* [Blame](/browser/ce21-suite/trunk/includes/ce21-functions.php?annotate=blame&rev=3097700 "Annotate each line with the last changed revision (this can be time consuming...)")
* [Revision Log](/log/ce21-suite/trunk/includes/ce21-functions.php?rev=3097700)

---

# [source:](/browser?rev=3097700&order=name "Go to repository root") [ce21-suite](/browser/ce21-suite?rev=3097700&order=name "View ce21-suite")/[trunk](/browser/ce21-suite/trunk?rev=3097700&order=name "View trunk")/[includes](/browser/ce21-suite/trunk/includes?rev=3097700&order=name "View includes")/[ce21-functions.php](/browser/ce21-suite/trunk/includes/ce21-functions.php?rev=3097700&order=name "View ce21-functions.php") @ [3097700](/changeset/3097700/ "View changeset 3097700")

View diff against:

View revision:

| [Last change](/changeset/2855745/ce21-suite/trunk/includes/ce21-functions.php "View differences") on this file since 3097700 was [2855745](/changeset/2855745/ "View changeset 2855745"), checked in by ce21com, [2 years ago](/timeline?from=2023-01-27T10%3A18%3A26Z&precision=second "See timeline at 01/27/2023 10:18:26 AM") |
| --- |
| Fixed calendar next, previous click event redirect issue to hash tag |
| * Property **svn:executable** set to   *`*`* | |
| **File size:** 40.4 KB | |

| Line |  |
| --- | --- |
| [1](#L1) | <?php |
| [2](#L2) | /\*\* |
| [3](#L3) | \* Create  Table code |
| [4](#L4) | \* Check to see if the table exists already, if not, then create it  -function |
| [5](#L5) | \*/ |
| [6](#L6) | function ce21\_create\_table(){ |
| [7](#L7) | global $wpdb; |
| [8](#L8) | $table\_name = $wpdb->prefix . 'membership\_types\_ce21'; |
| [9](#L9) | try { |
| [10](#L10) | if ($wpdb->get\_var("show tables like '$table\_name'") != $table\_name) { |
| [11](#L11) | $charset\_collate = $wpdb->get\_charset\_collate(); |
| [12](#L12) | $sql = "CREATE TABLE $table\_name ( |
| [13](#L13) | id mediumint(9) NOT NULL AUTO\_INCREMENT, |
| [14](#L14) | TenantId mediumint(9) NOT NULL, |
| [15](#L15) | membershipTypeId mediumint(9) NOT NULL, |
| [16](#L16) | membershipName text NOT NULL, |
| [17](#L17) | created\_at timestamp NULL DEFAULT CURRENT\_TIMESTAMP, |
| [18](#L18) | updated\_at timestamp NULL DEFAULT CURRENT\_TIMESTAMP ON UPDATE CURRENT\_TIMESTAMP, |
| [19](#L19) | PRIMARY KEY  (id) |
| [20](#L20) | ) $charset\_collate;"; |
| [21](#L21) | require\_once(ABSPATH . 'wp-admin/includes/upgrade.php'); |
| [22](#L22) | dbDelta($sql); |
| [23](#L23) | if ($wpdb->last\_error) { |
| [24](#L24) | throw new Exception($wpdb->last\_error); |
| [25](#L25) | } |
| [26](#L26) | } |
| [27](#L27) | } catch (Exception $e){ |
| [28](#L28) | $errorMsg = ' Error on line '.$e->getLine().' in '.$e->getFile() . ' : <b>'.$e->getMessage().'</b>'; |
| [29](#L29) | ce21\_error\_log\_api($errorMsg); |
| [30](#L30) | } |
| [31](#L31) | } |
| [32](#L32) |  |
| [33](#L33) | /\*\* |
| [34](#L34) | \* Create new customer role for site  -function |
| [35](#L35) | \*/ |
| [36](#L36) | function ce21\_add\_customer\_role(){ |
| [37](#L37) | add\_role('CE21\_Customer', \_\_( |
| [38](#L38) | 'CE21 Customer'), |
| [39](#L39) | array( |
| [40](#L40) | 'read'  => true, // Allows a user to read |
| [41](#L41) | ) |
| [42](#L42) | ); |
| [43](#L43) | } |
| [44](#L44) |  |
| [45](#L45) | /\*\* |
| [46](#L46) | \* Create page code -function |
| [47](#L47) | \*/ |
| [48](#L48) |  |
| [49](#L49) | function ce21\_create\_authentication\_page(){ |
| [50](#L50) | $new\_page\_title = 'Article Authentication'; |
| [51](#L51) | $slug = 'article-authentication-ce21'; |
| [52](#L52) | $new\_page\_content = 'Sorry, You are not allowed to access this article content.'; |
| [53](#L53) | $new\_page\_template = ''; //ex. template-custom.php. Leave blank if you don't want a custom page template. |
| [54](#L54) |  |
| [55](#L55) | //don't change the code bellow, unless you know what you're doing |
| [56](#L56) | //$page\_check = get\_page\_by\_title($new\_page\_title); |
| [57](#L57) | $page\_check = get\_page\_by\_path( 'article-authentication-ce21' ); |
| [58](#L58) | //print\_r($page); |
| [59](#L59) | $new\_page = array( |
| [60](#L60) | 'post\_type' => 'page', |
| [61](#L61) | 'post\_title' => $new\_page\_title, |
| [62](#L62) | 'post\_name' => $slug, |
| [63](#L63) | 'post\_content' => $new\_page\_content, |
| [64](#L64) | 'post\_status' => 'publish', |
| [65](#L65) | ); |
| [66](#L66) |  |
| [67](#L67) | if(!isset($page\_check->ID)){ |
| [68](#L68) | $new\_page\_id = wp\_insert\_post($new\_page); |
| [69](#L69) | update\_post\_meta($new\_page\_id,'\_article\_authentication',$new\_page\_id); |
| [70](#L70) | if(!empty($new\_page\_template)){ |
| [71](#L71) | update\_post\_meta($new\_page\_id, '\_wp\_page\_template', $new\_page\_template); |
| [72](#L72) | } |
| [73](#L73) | } else if( $page\_check->post\_status == 'trash' ) { |
| [74](#L74) | wp\_update\_post(array( |
| [75](#L75) | 'ID' => $page\_check->ID, |
| [76](#L76) | 'post\_status' => 'publish' |
| [77](#L77) | )); |
| [78](#L78) | } |
| [79](#L79) | } |
| [80](#L80) | // Add our text to the bulk edit box |
| [81](#L81) | add\_action( 'bulk\_edit\_custom\_box', 'sso\_ce21\_on\_bulk\_edit\_custom\_box', 10, 2); |
| [82](#L82) |  |
| [83](#L83) | function sso\_ce21\_on\_bulk\_edit\_custom\_box($column\_name, $post\_type) |
| [84](#L84) | { |
| [85](#L85) | global $post; |
| [86](#L86) | if ('membership\_plan\_ce21' == $column\_name) { |
| [87](#L87) | try { |
| [88](#L88) | global $wpdb; |
| [89](#L89) | $table\_name\_ce21            = $wpdb->prefix . 'membership\_types\_ce21'; |
| [90](#L90) | $Memberships\_Data\_ce21      = $wpdb->get\_results("SELECT \* FROM ".$table\_name\_ce21." ORDER BY id ASC"); |
| [91](#L91) | $details                            = get\_post\_meta( $post->ID, '\_post\_authentication\_custom\_metabox\_ce21', false ); |
| [92](#L92) |  |
| [93](#L93) | if(! empty($Memberships\_Data\_ce21)) { |
| [94](#L94) | ?> |
| [95](#L95) | <fieldset class="inline-edit-col-center" style="max-width:400px;"> |
| [96](#L96) | <div class="inline-edit-col"> |
| [97](#L97) | <span class="title inline-edit-categories-label">Groups</span> |
| [98](#L98) | <ul class="cat-checklist category-checklist"> |
| [99](#L99) | <label><input type="checkbox" id="ckbulkCheckAll" /> Select All</label> |
| [100](#L100) | <?php foreach ($Memberships\_Data\_ce21 as $key => $value) { ?> |
| [101](#L101) | <label> <input type="checkbox" class="be\_group radio customCheckAll" value="<?php echo esc\_attr($value->membershipTypeId); ?>" |
| [102](#L102) | name="\_post\_authentication\_custom\_metabox\_ce21[]" /> |
| [103](#L103) | <?php echo esc\_html($value->membershipName); ?> |
| [104](#L104) | </label> |
| [105](#L105) | <?php } ?> |
| [106](#L106) | </ul> |
| [107](#L107) | </div> |
| [108](#L108) | </fieldset> |
| [109](#L109) | <?php |
| [110](#L110) | } else { |
| [111](#L111) | echo "Groups are not available."; |
| [112](#L112) | } |
| [113](#L113) | ce21\_wp\_error\_handle(); |
| [114](#L114) | } catch (Exception $e) { |
| [115](#L115) | $errorMsg = ' Error on line '.$e->getLine().' in '.$e->getFile() . ' : <b>'.$e->getMessage().'</b>'; |
| [116](#L116) | ce21\_error\_log\_api($errorMsg); |
| [117](#L117) | } |
| [118](#L118) | } |
| [119](#L119) | } |
| [120](#L120) |  |
| [121](#L121) |  |
| [122](#L122) | add\_action( 'wp\_ajax\_manage\_wp\_posts\_using\_bulk\_quick\_save\_bulk\_edit', 'sso\_ce21\_manage\_wp\_posts\_using\_bulk\_quick\_save\_bulk\_edit' ); |
| [123](#L123) |  |
| [124](#L124) | function sso\_ce21\_manage\_wp\_posts\_using\_bulk\_quick\_save\_bulk\_edit(){ |
| [125](#L125) |  |
| [126](#L126) | try { |
| [127](#L127) | // we need the post IDs |
| [128](#L128) | $post\_ids = ( isset( $\_POST[ 'post\_ids' ] ) && !empty( $\_POST[ 'post\_ids' ] ) ) ? sanitize\_post($\_POST[ 'post\_ids' ]) : NULL; |
| [129](#L129) | $new\_values = ( isset( $\_POST[ 'fields' ] ) && !empty( $\_POST[ 'fields' ] ) ) ? sanitize\_post($\_POST[ 'fields' ]) : NULL; |
| [130](#L130) |  |
| [131](#L131) | // if we have post IDs |
| [132](#L132) | if ( ! empty( $post\_ids ) && is\_array( $post\_ids ) ) { |
| [133](#L133) |  |
| [134](#L134) | // get the custom fields |
| [135](#L135) |  |
| [136](#L136) | foreach( $post\_ids as $post\_id ) { |
| [137](#L137) |  |
| [138](#L138) | $values\_to\_save = array(); |
| [139](#L139) |  |
| [140](#L140) | if (!empty($new\_values)) { |
| [141](#L141) | foreach($new\_values as $new\_value ) { |
| [142](#L142) | $values\_to\_save[] = $new\_value ; |
| [143](#L143) | } |
| [144](#L144) | } |
| [145](#L145) | $original\_meta = get\_post\_meta( $post\_id, '\_post\_authentication\_custom\_metabox\_ce21' ,true); |
| [146](#L146) |  |
| [147](#L147) | if( empty($original\_meta) ){ |
| [148](#L148) | update\_post\_meta( $post\_id, '\_post\_authentication\_custom\_metabox\_ce21',$values\_to\_save ); |
| [149](#L149) | } else{ |
| [150](#L150) | $new\_meta = array\_merge($values\_to\_save,$original\_meta); |
| [151](#L151) |  |
| [152](#L152) | update\_post\_meta( $post\_id, '\_post\_authentication\_custom\_metabox\_ce21',$new\_meta ); |
| [153](#L153) | } |
| [154](#L154) |  |
| [155](#L155) |  |
| [156](#L156) |  |
| [157](#L157) | } |
| [158](#L158) |  |
| [159](#L159) | } |
| [160](#L160) |  |
| [161](#L161) | } catch (Exception $e){ |
| [162](#L162) | $errorMsg = ' Error on line '.$e->getLine().' in '.$e->getFile() . ' : <b>'.$e->getMessage().'</b>'; |
| [163](#L163) | ce21\_error\_log\_api($errorMsg); |
| [164](#L164) | } |
| [165](#L165) | } |
| [166](#L166) | add\_action('wp\_ajax\_data\_fetch' , 'sso\_ce21\_data\_fetch'); |
| [167](#L167) | add\_action('wp\_ajax\_nopriv\_data\_fetch','sso\_ce21\_data\_fetch'); |
| [168](#L168) | function sso\_ce21\_data\_fetch(){ |
| [169](#L169) | if( isset($\_POST['post\_id']) ){ |
| [170](#L170) | $pid = sanitize\_text\_field($\_POST['post\_id']); |
| [171](#L171) | $details =  get\_post\_meta( $pid, '\_post\_authentication\_custom\_metabox\_ce21', true ); |
| [172](#L172) | if($details) { |
| [173](#L173) | echo wp\_send\_json(array('success' => true, 'result' => $details)); |
| [174](#L174) | } |
| [175](#L175) | else { |
| [176](#L176) | wp\_send\_json\_error(); |
| [177](#L177) | } |
| [178](#L178) | exit(); |
| [179](#L179) | } |
| [180](#L180) | } |
| [181](#L181) | require plugin\_dir\_path( \_\_FILE\_\_ ) . '/quick-edit-functions.php'; |
| [182](#L182) |  |
| [183](#L183) |  |
| [184](#L184) | // JavaScript functions to set/update checkbox |
| [185](#L185) |  |
| [186](#L186) | /\* |
| [187](#L187) | \*  Create Sign In Page |
| [188](#L188) | \*/ |
| [189](#L189) | function ce21\_sign\_in\_form\_page() { |
| [190](#L190) | $new\_page\_title = 'Sign In'; |
| [191](#L191) | $slug = 'sign-in-ce21'; |
| [192](#L192) | $new\_page\_content = '[ce21-sso-sign-in]'; |
| [193](#L193) | $new\_page\_template = ''; |
| [194](#L194) |  |
| [195](#L195) | $page\_check = get\_page\_by\_path( 'sign-in-ce21' ); |
| [196](#L196) | //print\_r($page); |
| [197](#L197) | $new\_page = array( |
| [198](#L198) | 'post\_type' => 'page', |
| [199](#L199) | 'post\_title' => $new\_page\_title, |
| [200](#L200) | 'post\_name' => $slug, |
| [201](#L201) | 'post\_content' => $new\_page\_content, |
| [202](#L202) | 'post\_status' => 'publish', |
| [203](#L203) | ); |
| [204](#L204) |  |
| [205](#L205) | if(!isset($page\_check->ID)){ |
| [206](#L206) | $new\_page\_id = wp\_insert\_post($new\_page); |
| [207](#L207) | update\_post\_meta($new\_page\_id,'\_sign\_in\_ce21',$new\_page\_id); |
| [208](#L208) | if(!empty($new\_page\_template)){ |
| [209](#L209) | update\_post\_meta($new\_page\_id, '\_wp\_page\_template', $new\_page\_template); |
| [210](#L210) | } |
| [211](#L211) | } else if( $page\_check->post\_status == 'trash' ) { |
| [212](#L212) | wp\_update\_post(array( |
| [213](#L213) | 'ID' => $page\_check->ID, |
| [214](#L214) | 'post\_status' => 'publish' |
| [215](#L215) | )); |
| [216](#L216) | } |
| [217](#L217) | } |
| [218](#L218) |  |
| [219](#L219) | function ce21\_sign\_in\_ajax\_api() |
| [220](#L220) | { |
| [221](#L221) | wp\_verify\_nonce( sanitize\_text\_field($\_POST['security']), 'ajax-login-nonce' ); |
| [222](#L222) | $ce21Email = sanitize\_text\_field($\_POST['username']); |
| [223](#L223) | $ce21Password = sanitize\_text\_field($\_POST['password']); |
| [224](#L224) | $postid = sanitize\_text\_field($\_POST['postid']); |
| [225](#L225) | $postURL = get\_permalink($postid); |
| [226](#L226) | $post\_data = array( |
| [227](#L227) | 'email' => $ce21Email, |
| [228](#L228) | 'password' => $ce21Password, |
| [229](#L229) | ); |
| [230](#L230) |  |
| [231](#L231) | $authorizeURI\_ce21 = get\_option( 'authorizeURI\_ce21' ); |
| [232](#L232) | $get\_error\_log\_api\_url\_ce21 = $authorizeURI\_ce21.'/WPAuthorize/VerifyLogin'; |
| [233](#L233) |  |
| [234](#L234) | $args = array( |
| [235](#L235) | 'method' => 'POST', |
| [236](#L236) | 'timeout' => 30, |
| [237](#L237) | 'redirection' => 10, |
| [238](#L238) | 'httpversion' => '1.1', |
| [239](#L239) | 'sslverify' => false, |
| [240](#L240) | 'headers' => array( |
| [241](#L241) | "Content-Type: application/json" |
| [242](#L242) | ), |
| [243](#L243) | 'body' => $post\_data, |
| [244](#L244) | 'cookies' => array() |
| [245](#L245) | ); |
| [246](#L246) | $response = wp\_remote\_post($get\_error\_log\_api\_url\_ce21, $args); |
| [247](#L247) |  |
| [248](#L248) | $newResponse = json\_decode($response['body']); |
| [249](#L249) | if($newResponse->isSuccess){ |
| [250](#L250) | $sesionHelper = new session\_helper\_ce21($newResponse->data->tenantId); |
| [251](#L251) |  |
| [252](#L252) | $sesionHelper->create\_session( $newResponse->data->firstName, $newResponse->data->lastName, $newResponse->data->email, $newResponse->data->tenantId, time() ); |
| [253](#L253) |  |
| [254](#L254) | if(isset($newResponse->data->catalogLoginUrl) && $newResponse->data->catalogLoginUrl != "" ) { |
| [255](#L255) | $loginUrl = $newResponse->data->catalogLoginUrl; |
| [256](#L256) | $redirectUrl = $loginUrl . "&returnUrl=" . $postURL; |
| [257](#L257) | }else{ |
| [258](#L258) | $redirectUrl = $postURL; |
| [259](#L259) | } |
| [260](#L260) |  |
| [261](#L261) | echo wp\_send\_json(array('isSuccess' => true, 'redirectURL' => $redirectUrl, 'message'=> 'Login Successfully')); |
| [262](#L262) | }else{ |
| [263](#L263) | echo wp\_send\_json($newResponse); |
| [264](#L264) | } |
| [265](#L265) |  |
| [266](#L266) | die(); |
| [267](#L267) | } |
| [268](#L268) |  |
| [269](#L269) |  |
| [270](#L270) | /\* |
| [271](#L271) | \* Function used to generate shotcode for ce21 sso signin shortcode |
| [272](#L272) | \* \*/ |
| [273](#L273) | add\_shortcode('ce21-sso-sign-in','ce21\_sso\_sign\_in\_shortcode'); |
| [274](#L274) | function ce21\_sso\_sign\_in\_shortcode() |
| [275](#L275) | { |
| [276](#L276) | ob\_start(); |
| [277](#L277) | include\_once( SINGLE\_SIGN\_ON\_CE21\_\_PLUGIN\_DIR . 'public/partials/single-sign-on-ce21-sso-sign-in.php'); |
| [278](#L278) | return ob\_get\_clean(); |
| [279](#L279) | } |
| [280](#L280) |  |
| [281](#L281) |  |
| [282](#L282) | /\* |
| [283](#L283) | \* Function used to check ce21\_api\_settings table exist or not. If not exist then it will create. |
| [284](#L284) | \* \*/ |
| [285](#L285) | function ce21\_create\_api\_settings\_table() |
| [286](#L286) | { |
| [287](#L287) | global $wpdb; |
| [288](#L288) | $table\_name = $wpdb->prefix . 'ce21\_api\_settings'; |
| [289](#L289) | try |
| [290](#L290) | { |
| [291](#L291) | if ($wpdb->get\_var("show tables like '$table\_name'") != $table\_name) |
| [292](#L292) | { |
| [293](#L293) | $charset\_collate = $wpdb->get\_charset\_collate(); |
| [294](#L294) | $sql = "CREATE TABLE $table\_name ( |
| [295](#L295) | Id int(11) NOT NULL AUTO\_INCREMENT, |
| [296](#L296) | BaseURL varchar(256) NOT NULL, |
| [297](#L297) | ClientId varchar(256) NOT NULL, |
| [298](#L298) | SecretKey varchar(500) NOT NULL, |
| [299](#L299) | CatalogURL varchar(500) NOT NULL, |
| [300](#L300) | AccessToken text NULL, |
| [301](#L301) | ExpiryDate datetime NULL, |
| [302](#L302) | CreatedOn timestamp NOT NULL DEFAULT CURRENT\_TIMESTAMP, |
| [303](#L303) | ModifiedOn timestamp NOT NULL DEFAULT CURRENT\_TIMESTAMP ON UPDATE CURRENT\_TIMESTAMP, |
| [304](#L304) | PRIMARY KEY  (id) |
| [305](#L305) | ) $charset\_collate;"; |
| [306](#L306) |  |
| [307](#L307) | require\_once(ABSPATH . 'wp-admin/includes/upgrade.php'); |
| [308](#L308) | dbDelta($sql); |
| [309](#L309) |  |
| [310](#L310) | if ($wpdb->last\_error) |
| [311](#L311) | { |
| [312](#L312) | throw new Exception($wpdb->last\_error); |
| [313](#L313) | } |
| [314](#L314) | } |
| [315](#L315) | } |
| [316](#L316) | catch (Exception $e) |
| [317](#L317) | { |
| [318](#L318) | $errorMsg = ' Error on line '.$e->getLine().' in '.$e->getFile() . ' : <b>'.$e->getMessage().'</b>'; |
| [319](#L319) | ce21\_error\_log\_api($errorMsg); |
| [320](#L320) | } |
| [321](#L321) | } |
| [322](#L322) |  |
| [323](#L323) |  |
| [324](#L324) | /\* |
| [325](#L325) | \* Function used to get API Settings data. |
| [326](#L326) | \* \*/ |
| [327](#L327) | function get\_ce21\_ss\_api\_settings\_data() |
| [328](#L328) | { |
| [329](#L329) | global $wpdb; |
| [330](#L330) | $data = $wpdb->get\_row("SELECT \* FROM ".$wpdb->prefix."ce21\_api\_settings"); |
| [331](#L331) | return $data; |
| [332](#L332) | } |
| [333](#L333) |  |
| [334](#L334) |  |
| [335](#L335) | /\* |
| [336](#L336) | \* Function used to save API Settings |
| [337](#L337) | \* \*/ |
| [338](#L338) | add\_action('wp\_ajax\_ce21\_single\_sign\_on\_save\_api\_settings','ce21\_single\_sign\_on\_save\_api\_settings'); |
| [339](#L339) | add\_action('wp\_ajax\_nopriv\_ce21\_single\_sign\_on\_save\_api\_settings','ce21\_single\_sign\_on\_save\_api\_settings'); |
| [340](#L340) | function ce21\_single\_sign\_on\_save\_api\_settings() |
| [341](#L341) | { |
| [342](#L342) | global $wpdb; |
| [343](#L343) | if(isset($\_POST)) |
| [344](#L344) | { |
| [345](#L345) | if ($\_POST['api\_settings\_id'] != "") |
| [346](#L346) | { |
| [347](#L347) | $update\_record = $wpdb->update($wpdb->prefix . 'ce21\_api\_settings', array( |
| [348](#L348) | 'BaseURL' => sanitize\_url($\_POST['base\_url']), |
| [349](#L349) | 'ClientId' => sanitize\_text\_field($\_POST['client\_id']), |
| [350](#L350) | 'SecretKey' => sanitize\_text\_field($\_POST['secret\_key']), |
| [351](#L351) | 'CatalogURL' => sanitize\_url($\_POST['catalog\_url']), |
| [352](#L352) | 'AccessToken' => NULL, |
| [353](#L353) | 'ExpiryDate' => NULL, |
| [354](#L354) | 'ModifiedOn' => date('Y-m-d H:i:s')), array( |
| [355](#L355) | 'Id' => sanitize\_text\_field($\_POST['api\_settings\_id']) |
| [356](#L356) | ) |
| [357](#L357) | ); |
| [358](#L358) |  |
| [359](#L359) | if ($update\_record) |
| [360](#L360) | { |
| [361](#L361) | $access\_token\_response = get\_access\_token(); |
| [362](#L362) |  |
| [363](#L363) | if ($access\_token\_response['success']) |
| [364](#L364) | { |
| [365](#L365) | $response = array( |
| [366](#L366) | 'success' => true, |
| [367](#L367) | 'message' => 'API Settings saved successfully!' |
| [368](#L368) | ); |
| [369](#L369) | } |
| [370](#L370) | else |
| [371](#L371) | { |
| [372](#L372) | $response = array( |
| [373](#L373) | 'success' => false, |
| [374](#L374) | 'message' => $access\_token\_response['message'] |
| [375](#L375) | ); |
| [376](#L376) | } |
| [377](#L377) | } |
| [378](#L378) | else |
| [379](#L379) | { |
| [380](#L380) | $response = array( |
| [381](#L381) | 'success' => false, |
| [382](#L382) | 'message' => 'Something went wrong while saving the data!' |
| [383](#L383) | ); |
| [384](#L384) | } |
| [385](#L385) |  |
| [386](#L386) |  |
| [387](#L387) | } |
| [388](#L388) | else |
| [389](#L389) | { |
| [390](#L390) | $insert\_record = $wpdb->insert($wpdb->prefix . 'ce21\_api\_settings', array( |
| [391](#L391) | 'BaseURL' => sanitize\_url($\_POST['base\_url']), |
| [392](#L392) | 'ClientId' => sanitize\_text\_field($\_POST['client\_id']), |
| [393](#L393) | 'SecretKey' => sanitize\_text\_field($\_POST['secret\_key']), |
| [394](#L394) | 'CatalogURL' => sanitize\_url($\_POST['catalog\_url']), |
| [395](#L395) | 'AccessToken' => NULL, |
| [396](#L396) | 'ExpiryDate' => NULL, |
| [397](#L397) | 'CreatedOn' => date('Y-m-d H:i:s'), |
| [398](#L398) | 'ModifiedOn' => date('Y-m-d H:i:s') |
| [399](#L399) | ) |
| [400](#L400) | ); |
| [401](#L401) |  |
| [402](#L402) | if ($insert\_record) |
| [403](#L403) | { |
| [404](#L404) | $access\_token\_response = get\_access\_token(); |
| [405](#L405) |  |
| [406](#L406) | if ($access\_token\_response['success']) |
| [407](#L407) | { |
| [408](#L408) | $response = array( |
| [409](#L409) | 'success' => true, |
| [410](#L410) | 'message' => 'API Settings saved successfully!' |
| [411](#L411) | ); |
| [412](#L412) | } |
| [413](#L413) | else |
| [414](#L414) | { |
| [415](#L415) | $response = array( |
| [416](#L416) | 'success' => false, |
| [417](#L417) | 'message' => $access\_token\_response['message'] |
| [418](#L418) | ); |
| [419](#L419) | } |
| [420](#L420) | } |
| [421](#L421) | else |
| [422](#L422) | { |
| [423](#L423) | $response = array( |
| [424](#L424) | 'success' => false, |
| [425](#L425) | 'message' => 'Something went wrong while saving the data!' |
| [426](#L426) | ); |
| [427](#L427) | } |
| [428](#L428) | } |
| [429](#L429) | } |
| [430](#L430) | else |
| [431](#L431) | { |
| [432](#L432) | $response = array( |
| [433](#L433) | 'success' => false, |
| [434](#L434) | 'message' => 'Something went wrong!' |
| [435](#L435) | ); |
| [436](#L436) | } |
| [437](#L437) |  |
| [438](#L438) | if (!empty($response)) { |
| [439](#L439) | echo json\_encode($response); |
| [440](#L440) | exit; |
| [441](#L441) | } |
| [442](#L442) | } |
| [443](#L443) |  |
| [444](#L444) |  |
| [445](#L445) | /\* |
| [446](#L446) | \* Function used to generate shotcode for ce21-single-sign-on calendar |
| [447](#L447) | \* \*/ |
| [448](#L448) | add\_shortcode('ce21-calendar','ce21\_single\_sign\_on\_calendar\_shortcode'); |
| [449](#L449) | function ce21\_single\_sign\_on\_calendar\_shortcode() |
| [450](#L450) | { |
| [451](#L451) | ob\_start(); |
| [452](#L452) | include\_once(SINGLE\_SIGN\_ON\_CE21\_\_PLUGIN\_DIR . 'public/partials/single-sign-on-ce21-calendar.php'); |
| [453](#L453) | return ob\_get\_clean(); |
| [454](#L454) | } |
| [455](#L455) |  |
| [456](#L456) |  |
| [457](#L457) | /\* |
| [458](#L458) | \* Function used to get ce21 calendar events. |
| [459](#L459) | \* \*/ |
| [460](#L460) | add\_action('wp\_ajax\_get\_ce21\_single\_sign\_on\_calendar\_events','get\_ce21\_single\_sign\_on\_calendar\_events'); |
| [461](#L461) | add\_action('wp\_ajax\_nopriv\_get\_ce21\_single\_sign\_on\_calendar\_events','get\_ce21\_single\_sign\_on\_calendar\_events'); |
| [462](#L462) | function get\_ce21\_single\_sign\_on\_calendar\_events() |
| [463](#L463) | { |
| [464](#L464) | $events\_array = []; |
| [465](#L465) | /\*Calendar Event Fetch using API starts\*/ |
| [466](#L466) | $access\_token\_response = get\_access\_token(); |
| [467](#L467) | $date = new DateTime(sanitize\_text\_field($\_REQUEST['start'])); |
| [468](#L468) | $startD = $date->format('Y-m-d'); |
| [469](#L469) |  |
| [470](#L470) | if ($access\_token\_response['success']) { |
| [471](#L471) | $api\_settings = get\_ce21\_ss\_api\_settings\_data(); |
| [472](#L472) | $api\_Access\_token = (!empty($api\_settings)) ?  $api\_settings->AccessToken : ''; |
| [473](#L473) | $base\_url = (!empty($api\_settings)) ? $api\_settings->BaseURL : ''; |
| [474](#L474) | $url = $base\_url."/wp/calendar?startDate=".$startD; |
| [475](#L475) |  |
| [476](#L476) | $args = array( |
| [477](#L477) | 'headers' => array( |
| [478](#L478) | 'Authorization' => 'Bearer ' . $api\_Access\_token |
| [479](#L479) | ) |
| [480](#L480) | ); |
| [481](#L481) | $res = wp\_remote\_get($url, $args); |
| [482](#L482) |  |
| [483](#L483) | //print\_r($res); |
| [484](#L484) | $res = json\_decode($res['body']); |
| [485](#L485) |  |
| [486](#L486) | if(!empty( $res )){ |
| [487](#L487) | $timezone = $res->momentZone; |
| [488](#L488) | $dateFormat = $res->dateFormat; |
| [489](#L489) | date\_default\_timezone\_set($timezone); |
| [490](#L490) | $timezoneText = date('T'); // => IST |
| [491](#L491) | if($dateFormat == 'dd/MM/yyyy'){ |
| [492](#L492) | $dtFormate = 'd/m/Y'; |
| [493](#L493) | }else{ |
| [494](#L494) | $dtFormate = 'm/d/Y'; |
| [495](#L495) | } |
| [496](#L496) | }else{ |
| [497](#L497) | $timezoneText = date('T'); // => IST |
| [498](#L498) | $dtFormate = 'm/d/Y'; |
| [499](#L499) | } |
| [500](#L500) |  |
| [501](#L501) | if(!empty( $res->events )){ |
| [502](#L502) | foreach ($res->events as $res\_event) |
| [503](#L503) | { |
| [504](#L504) | $timestamp=$res\_event->start; |
| [505](#L505) | $dt =  date($dtFormate, $timestamp/1000); |
| [506](#L506) | $sdt =  date('Y-m-d H:i:s', $timestamp/1000); |
| [507](#L507) | $timestampend=$res\_event->end; |
| [508](#L508) | $edt =  date('Y-m-d H:i:s', $timestampend/1000); |
| [509](#L509) | $desctime = str\_replace(array( '(', ')' ), '', $res\_event->time); |
| [510](#L510) | $desc = '<h4>'.$res\_event->title.'</h4>'; |
| [511](#L511) | $desc .= '<div>Type: '.$res\_event->producttype.'</div>'; |
| [512](#L512) | $desc .= '<div>Time: '.$dt.' '.$desctime.'</div>'; |
| [513](#L513) | $desc .= '<div class="ce21PriceDetail">'.$res\_event->price.'</div>'; |
| [514](#L514) | $new\_event = [ |
| [515](#L515) | 'title'=>$res\_event->title, |
| [516](#L516) | 'description'=> $desc, |
| [517](#L517) | 'start'=>$sdt, |
| [518](#L518) | 'end'=>$edt, |
| [519](#L519) | 'type'=>$res\_event->producttype, |
| [520](#L520) | 'time'=>$res\_event->time, |
| [521](#L521) | //'allDay'=>true, |
| [522](#L522) | 'className'=>$res\_event->class, |
| [523](#L523) | 'url'=>$res\_event->url |
| [524](#L524) | ]; |
| [525](#L525) |  |
| [526](#L526) | array\_push($events\_array,$new\_event); |
| [527](#L527) | } |
| [528](#L528) | } |
| [529](#L529) |  |
| [530](#L530) | } |
| [531](#L531) |  |
| [532](#L532) | /\*Calendar Event Fetch using API ends\*/ |
| [533](#L533) |  |
| [534](#L534) | global $wpdb; |
| [535](#L535) | $ce21\_calendar\_events = $wpdb->get\_results("SELECT \* FROM ".$wpdb->prefix."ce21\_calendar\_events"); |
| [536](#L536) |  |
| [537](#L537) | foreach ($ce21\_calendar\_events as $ce21\_calendar\_event) |
| [538](#L538) | { |
| [539](#L539) | /\*$start\_date = date('Y-m-d', strtotime($ce21\_calendar\_event->StartDate)); |
| [540](#L540) | $end\_date = date('Y-m-d', strtotime($ce21\_calendar\_event->EndDate));\*/ |
| [541](#L541) | $dateObject = new DateTime($ce21\_calendar\_event->StartDate); |
| [542](#L542) | $Time =  $dateObject->format('h:i A'); |
| [543](#L543) | $Time =  $Time.' ('.$timezoneText.')'; |
| [544](#L544) | $TimeText =  $dateObject->format($dtFormate.' h:i A'); |
| [545](#L545) |  |
| [546](#L546) | $desc = '<h4>'.$ce21\_calendar\_event->Title.'</h4>'; |
| [547](#L547) | $desc .= '<div>Time: '.$TimeText.' '.$timezoneText.'</div>'; |
| [548](#L548) |  |
| [549](#L549) | $event = [ |
| [550](#L550) | 'title'=>$ce21\_calendar\_event->Title, |
| [551](#L551) | 'description'=> $desc, |
| [552](#L552) | 'start'=>$ce21\_calendar\_event->StartDate, |
| [553](#L553) | 'end'=>$ce21\_calendar\_event->EndDate, |
| [554](#L554) | //'allDay'=>true, |
| [555](#L555) | 'type'=>'', |
| [556](#L556) | 'time'=>$Time, |
| [557](#L557) | 'className'=>'', |
| [558](#L558) | //'className'=>'fct-ev', |
| [559](#L559) | 'url'=>$ce21\_calendar\_event->Url |
| [560](#L560) | ]; |
| [561](#L561) |  |
| [562](#L562) | array\_push($events\_array,$event); |
| [563](#L563) | } |
| [564](#L564) |  |
| [565](#L565) | echo json\_encode($events\_array);exit; |
| [566](#L566) | } |
| [567](#L567) |  |
| [568](#L568) | function ce21\_my\_custom\_js() { |
| [569](#L569) | $style = 'bootstrap'; |
| [570](#L570) | if( ( wp\_style\_is( $style, 'queue' ) ) && ( wp\_style\_is( $style, 'done' ) ) ) { |
| [571](#L571) | echo '<script type="text/javascript">var isBootstrapUse = true;</script>'; |
| [572](#L572) | }else{ |
| [573](#L573) | echo '<script type="text/javascript">var isBootstrapUse = false;</script>'; |
| [574](#L574) | } |
| [575](#L575) |  |
| [576](#L576) | } |
| [577](#L577) | // Add hook for front-end <head></head> |
| [578](#L578) | add\_action( 'wp\_head', 'ce21\_my\_custom\_js' ); |
| [579](#L579) |  |
| [580](#L580) |  |
| [581](#L581) | /\* |
| [582](#L582) | \* Function used to check ce21\_calendar\_events table exist or not. If not exist then it will create. |
| [583](#L583) | \* \*/ |
| [584](#L584) | function ce21\_create\_calendar\_events\_table() |
| [585](#L585) | { |
| [586](#L586) | global $wpdb; |
| [587](#L587) | $table\_name = $wpdb->prefix . 'ce21\_calendar\_events'; |
| [588](#L588) | try |
| [589](#L589) | { |
| [590](#L590) | if ($wpdb->get\_var("show tables like '$table\_name'") != $table\_name) |
| [591](#L591) | { |
| [592](#L592) | $charset\_collate = $wpdb->get\_charset\_collate(); |
| [593](#L593) | $sql = "CREATE TABLE $table\_name ( |
| [594](#L594) | Id int(11) NOT NULL AUTO\_INCREMENT, |
| [595](#L595) | Title text NOT NULL, |
| [596](#L596) | StartDate datetime NULL, |
| [597](#L597) | EndDate datetime NULL, |
| [598](#L598) | Url text NULL, |
| [599](#L599) | CreatedOn timestamp NOT NULL DEFAULT CURRENT\_TIMESTAMP, |
| [600](#L600) | ModifiedOn timestamp NOT NULL DEFAULT CURRENT\_TIMESTAMP ON UPDATE CURRENT\_TIMESTAMP, |
| [601](#L601) | PRIMARY KEY  (id) |
| [602](#L602) | ) $charset\_collate;"; |
| [603](#L603) |  |
| [604](#L604) | require\_once(ABSPATH . 'wp-admin/includes/upgrade.php'); |
| [605](#L605) | dbDelta($sql); |
| [606](#L606) |  |
| [607](#L607) | if ($wpdb->last\_error) |
| [608](#L608) | { |
| [609](#L609) | throw new Exception($wpdb->last\_error); |
| [610](#L610) | } |
| [611](#L611) | } |
| [612](#L612) | } |
| [613](#L613) | catch (Exception $e) |
| [614](#L614) | { |
| [615](#L615) | $errorMsg = ' Error on line '.$e->getLine().' in '.$e->getFile() . ' : <b>'.$e->getMessage().'</b>'; |
| [616](#L616) | ce21\_error\_log\_api($errorMsg); |
| [617](#L617) | } |
| [618](#L618) | } |
| [619](#L619) |  |
| [620](#L620) |  |
| [621](#L621) | /\* |
| [622](#L622) | \* Function used to add new calendar event |
| [623](#L623) | \* \*/ |
| [624](#L624) | add\_action('wp\_ajax\_ce21\_ss\_add\_new\_calendar\_event','ce21\_ss\_add\_new\_calendar\_event'); |
| [625](#L625) | add\_action('wp\_ajax\_nopriv\_ce21\_ss\_add\_new\_calendar\_event','ce21\_ss\_add\_new\_calendar\_event'); |
| [626](#L626) | function ce21\_ss\_add\_new\_calendar\_event() |
| [627](#L627) | { |
| [628](#L628) | global $wpdb; |
| [629](#L629) | if(isset($\_POST)) |
| [630](#L630) | { |
| [631](#L631) |  |
| [632](#L632) | $start\_date = date('Y-m-d H:i:s', strtotime( sanitize\_text\_field($\_POST['start\_date']) )); |
| [633](#L633) | $end\_date = date('Y-m-d H:i:s', strtotime( sanitize\_text\_field($\_POST['end\_date']) )); |
| [634](#L634) |  |
| [635](#L635) | $insert\_record = $wpdb->insert($wpdb->prefix . 'ce21\_calendar\_events', array( |
| [636](#L636) | 'Title' => sanitize\_text\_field($\_POST['title']), |
| [637](#L637) | 'StartDate' => $start\_date, |
| [638](#L638) | 'EndDate' => $end\_date, |
| [639](#L639) | 'Url' => sanitize\_url($\_POST['url']), |
| [640](#L640) | 'CreatedOn' => date('Y-m-d H:i:s'), |
| [641](#L641) | 'ModifiedOn' => date('Y-m-d H:i:s') |
| [642](#L642) | ) |
| [643](#L643) | ); |
| [644](#L644) |  |
| [645](#L645) | if ($insert\_record) |
| [646](#L646) | { |
| [647](#L647) | $response = array( |
| [648](#L648) | 'success' => true, |
| [649](#L649) | 'message' => 'Calender event added successfully!' |
| [650](#L650) | ); |
| [651](#L651) |  |
| [652](#L652) | } |
| [653](#L653) | else |
| [654](#L654) | { |
| [655](#L655) | $response = array( |
| [656](#L656) | 'success' => false, |
| [657](#L657) | 'message' => 'Something went wrong while saving the data!' |
| [658](#L658) | ); |
| [659](#L659) | } |
| [660](#L660) |  |
| [661](#L661) | } |
| [662](#L662) | else |
| [663](#L663) | { |
| [664](#L664) | $response = array( |
| [665](#L665) | 'success' => false, |
| [666](#L666) | 'message' => 'Something went wrong!' |
| [667](#L667) | ); |
| [668](#L668) | } |
| [669](#L669) |  |
| [670](#L670) | if (!empty($response)) { |
| [671](#L671) | echo json\_encode($response); |
| [672](#L672) | exit; |
| [673](#L673) | } |
| [674](#L674) | } |
| [675](#L675) |  |
| [676](#L676) |  |
| [677](#L677) | /\* |
| [678](#L678) | \* Function used to delete ce21-single-sign-on-calendar-event |
| [679](#L679) | \* \*/ |
| [680](#L680) | add\_action('wp\_ajax\_ce21\_ss\_delete\_calendar\_event','ce21\_ss\_delete\_calendar\_event'); |
| [681](#L681) | add\_action('wp\_ajax\_nopriv\_ce21\_ss\_delete\_calendar\_event','ce21\_ss\_delete\_calendar\_event'); |
| [682](#L682) | function ce21\_ss\_delete\_calendar\_event() |
| [683](#L683) | { |
| [684](#L684) | global $wpdb; |
| [685](#L685) | if (isset($\_POST)) |
| [686](#L686) | { |
| [687](#L687) | $wpdb->delete($wpdb->prefix . 'ce21\_calendar\_events', array( |
| [688](#L688) | 'Id' => sanitize\_text\_field($\_POST['id']) |
| [689](#L689) | ) |
| [690](#L690) | ); |
| [691](#L691) |  |
| [692](#L692) | $return\_response = array( |
| [693](#L693) | 'success' => true, |
| [694](#L694) | 'message' => 'Calendar event deleted successfully!' |
| [695](#L695) | ); |
| [696](#L696) | } |
| [697](#L697) | else |
| [698](#L698) | { |
| [699](#L699) | $return\_response = array( |
| [700](#L700) | 'success' => false, |
| [701](#L701) | 'message' => 'Something went wrong!' |
| [702](#L702) | ); |
| [703](#L703) | } |
| [704](#L704) |  |
| [705](#L705) | if (!empty($return\_response)) |
| [706](#L706) | { |
| [707](#L707) | echo json\_encode($return\_response); |
| [708](#L708) | exit; |
| [709](#L709) | } |
| [710](#L710) | } |
| [711](#L711) |  |
| [712](#L712) |  |
| [713](#L713) | /\* |
| [714](#L714) | \* Function used to get ce21 single calendar events. |
| [715](#L715) | \* \*/ |
| [716](#L716) | add\_action('wp\_ajax\_get\_ce21\_single\_sign\_on\_calendar\_event','get\_ce21\_single\_sign\_on\_calendar\_event'); |
| [717](#L717) | add\_action('wp\_ajax\_nopriv\_get\_ce21\_single\_sign\_on\_calendar\_event','get\_ce21\_single\_sign\_on\_calendar\_event'); |
| [718](#L718) | function get\_ce21\_single\_sign\_on\_calendar\_event() |
| [719](#L719) | { |
| [720](#L720) | global $wpdb; |
| [721](#L721) | if (isset($\_POST)) |
| [722](#L722) | { |
| [723](#L723) | $event = $wpdb->get\_row($wpdb->prepare("SELECT \* FROM " . $wpdb->prefix . "ce21\_calendar\_events WHERE Id=%d", sanitize\_text\_field($\_POST['id']))); |
| [724](#L724) |  |
| [725](#L725) | $event\_array = [ |
| [726](#L726) | 'id' => $event->Id, |
| [727](#L727) | 'title' => $event->Title, |
| [728](#L728) | 'start\_date' => $event->StartDate, |
| [729](#L729) | 'end\_date' => $event->EndDate, |
| [730](#L730) | 'url' => $event->Url |
| [731](#L731) | ]; |
| [732](#L732) |  |
| [733](#L733) | $return\_response = array( |
| [734](#L734) | 'success' => true, |
| [735](#L735) | 'event' => $event\_array, |
| [736](#L736) | 'message' => 'Calendar event fetched successfully!' |
| [737](#L737) | ); |
| [738](#L738) | } |
| [739](#L739) | else |
| [740](#L740) | { |
| [741](#L741) | $return\_response = array( |
| [742](#L742) | 'success' => false, |
| [743](#L743) | 'event' => '', |
| [744](#L744) | 'message' => 'Something went wrong!' |
| [745](#L745) | ); |
| [746](#L746) | } |
| [747](#L747) |  |
| [748](#L748) | if (!empty($return\_response)) |
| [749](#L749) | { |
| [750](#L750) | echo json\_encode($return\_response); |
| [751](#L751) | exit; |
| [752](#L752) | } |
| [753](#L753) | } |
| [754](#L754) |  |
| [755](#L755) |  |
| [756](#L756) | /\* |
| [757](#L757) | \* Function used to add new calendar event |
| [758](#L758) | \* \*/ |
| [759](#L759) | add\_action('wp\_ajax\_ce21\_ss\_edit\_calendar\_event','ce21\_ss\_edit\_calendar\_event'); |
| [760](#L760) | add\_action('wp\_ajax\_nopriv\_ce21\_ss\_edit\_calendar\_event','ce21\_ss\_edit\_calendar\_event'); |
| [761](#L761) | function ce21\_ss\_edit\_calendar\_event() |
| [762](#L762) | { |
| [763](#L763) | global $wpdb; |
| [764](#L764) | if(isset($\_POST)) |
| [765](#L765) | { |
| [766](#L766) | $start\_date = date('Y-m-d H:i:s', strtotime( sanitize\_text\_field($\_POST['start\_date']) )); |
| [767](#L767) | $end\_date = date('Y-m-d H:i:s', strtotime( sanitize\_text\_field($\_POST['end\_date']) )); |
| [768](#L768) |  |
| [769](#L769) | $update\_record = $wpdb->update($wpdb->prefix . 'ce21\_calendar\_events', array( |
| [770](#L770) | 'Title' => sanitize\_text\_field($\_POST['title']), |
| [771](#L771) | 'StartDate' => $start\_date, |
| [772](#L772) | 'EndDate' => $end\_date, |
| [773](#L773) | 'Url' => sanitize\_url($\_POST['url']), |
| [774](#L774) | 'ModifiedOn' => date('Y-m-d H:i:s')), array( |
| [775](#L775) | 'Id' => sanitize\_text\_field($\_POST['id']) |
| [776](#L776) | ) |
| [777](#L777) | ); |
| [778](#L778) |  |
| [779](#L779) | if ($update\_record) |
| [780](#L780) | { |
| [781](#L781) | $response = array( |
| [782](#L782) | 'success' => true, |
| [783](#L783) | 'message' => 'Calender event updated successfully!' |
| [784](#L784) | ); |
| [785](#L785) |  |
| [786](#L786) | } |
| [787](#L787) | else |
| [788](#L788) | { |
| [789](#L789) | $response = array( |
| [790](#L790) | 'success' => false, |
| [791](#L791) | 'message' => 'Something went wrong while updating the data!' |
| [792](#L792) | ); |
| [793](#L793) | } |
| [794](#L794) | } |
| [795](#L795) | else |
| [796](#L796) | { |
| [797](#L797) | $response = array( |
| [798](#L798) | 'success' => false, |
| [799](#L799) | 'message' => 'Something went wrong!' |
| [800](#L800) | ); |
| [801](#L801) | } |
| [802](#L802) |  |
| [803](#L803) | if (!empty($response)) { |
| [804](#L804) | echo json\_encode($response); |
| [805](#L805) | exit; |
| [806](#L806) | } |
| [807](#L807) | } |
| [808](#L808) |  |
| [809](#L809) |  |
| [810](#L810) | /\* |
| [811](#L811) | \* Function used to load ce21-single-sign-on-calendar-events into datatable |
| [812](#L812) | \* \*/ |
| [813](#L813) | add\_action('wp\_ajax\_load\_ce21\_single\_sign\_on\_calendar\_events', 'load\_ce21\_single\_sign\_on\_calendar\_events'); |
| [814](#L814) | add\_action('wp\_ajax\_nopriv\_load\_ce21\_single\_sign\_on\_calendar\_events', 'load\_ce21\_single\_sign\_on\_calendar\_events'); |
| [815](#L815) |  |
| [816](#L816) | function load\_ce21\_single\_sign\_on\_calendar\_events() { |
| [817](#L817) | global $wpdb; |
| [818](#L818) |  |
| [819](#L819) | $request = sanitize\_post($\_REQUEST); |
| [820](#L820) | $col = array( |
| [821](#L821) | 0 => 'title', |
| [822](#L822) | 1 => 'start\_date', |
| [823](#L823) | 2 => 'end\_date', |
| [824](#L824) | 3 => 'url', |
| [825](#L825) | 4 => 'action' |
| [826](#L826) | );  //create column like table in database |
| [827](#L827) |  |
| [828](#L828) | $sql = "SELECT \* FROM " . $wpdb->prefix . "ce21\_calendar\_events"; |
| [829](#L829) |  |
| [830](#L830) | $query = $wpdb->get\_results($sql); |
| [831](#L831) | $totalData = $wpdb->num\_rows; |
| [832](#L832) | $totalFilter = $totalData; |
| [833](#L833) |  |
| [834](#L834) | //Search |
| [835](#L835) | $sql = "SELECT \* FROM " . $wpdb->prefix . "ce21\_calendar\_events"; |
| [836](#L836) | $font\_family = str\_replace("'", "\'", $request['search']['value']); |
| [837](#L837) | $column = $col[$request['order'][0]['column']]; |
| [838](#L838) | $order = $request['order'][0]['dir']; |
| [839](#L839) | if (!empty($request['search']['value'])) { |
| [840](#L840) | $sql .= " WHERE (Title Like %s OR StartDate Like %s OR EndDate Like %s OR Url Like %s )"; |
| [841](#L841) | $query = $wpdb->get\_results($wpdb->prepare($sql, $request['search']['value'] ."%", $request['search']['value'] . "%", $font\_family . "%", $request['search']['value'] . "%")); |
| [842](#L842) | $totalData = $wpdb->num\_rows; |
| [843](#L843) |  |
| [844](#L844) | $sql .= " ORDER BY %s %s LIMIT %d , %d"; |
| [845](#L845) | $query = $wpdb->get\_results($wpdb->prepare($sql, $request['search']['value'] ."%", $request['search']['value'] . "%", $font\_family . "%", $request['search']['value'] . "%", $column, $order, $request['start'], $request['length'])); |
| [846](#L846) | }else{ |
| [847](#L847) | $query = $wpdb->get\_results($sql); |
| [848](#L848) | $totalData = $wpdb->num\_rows; |
| [849](#L849) | $sql .= " ORDER BY %s %s LIMIT %d , %d"; |
| [850](#L850) | $query = $wpdb->get\_results($wpdb->prepare($sql, $column, $order, $request['start'], $request['length'])); |
| [851](#L851) | } |
| [852](#L852) | //Order |
| [853](#L853) |  |
| [854](#L854) | $data = array(); |
| [855](#L855) |  |
| [856](#L856) | foreach ($query as $row) { |
| [857](#L857) | $subdata = array(); |
| [858](#L858) | $subdata[] = ($row->Title != '') ? $row->Title : '-'; |
| [859](#L859) | $subdata[] = ($row->StartDate != '') ? $row->StartDate : '-';; |
| [860](#L860) | $subdata[] = ($row->EndDate != '') ? $row->EndDate : '-';; |
| [861](#L861) | $subdata[] = ($row->Url != '') ? $row->Url : '-';; |
| [862](#L862) | $subdata[] = '<button onclick="ce21\_ss\_open\_edit\_calendar\_event\_modal('.$row->Id.');">Edit</button> |
| [863](#L863) | <button onclick=  "ce21\_ss\_delete\_calendar\_event('.$row->Id.');">Delete</button>'; |
| [864](#L864) | $data[] = $subdata; |
| [865](#L865) | } |
| [866](#L866) |  |
| [867](#L867) | $json\_data = array( |
| [868](#L868) | "draw" => intval($request['draw']), |
| [869](#L869) | "recordsTotal" => intval($totalData), |
| [870](#L870) | "recordsFiltered" => intval($totalFilter), |
| [871](#L871) | "data" => $data |
| [872](#L872) | ); |
| [873](#L873) | echo json\_encode($json\_data); |
| [874](#L874) | exit; |
| [875](#L875) | } |
| [876](#L876) |  |
| [877](#L877) | /\*Mini Calendar code starts\*/ |
| [878](#L878) | function ce21\_mini\_calendar\_shortcode( $atts ) { |
| [879](#L879) | $dateComponents = getdate(); |
| [880](#L880) | $month = $dateComponents['mon']; |
| [881](#L881) | $year = $dateComponents['year']; |
| [882](#L882) |  |
| [883](#L883) | ob\_start(); |
| [884](#L884) | ?> |
| [885](#L885) | <div id="ce21MiniCalendarContainer"> |
| [886](#L886) | <?php ce21\_getMiniCalendarHTML($month,$year); ?> |
| [887](#L887) | </div> |
| [888](#L888) | <div id="ce21MiniCalendarLoader"> |
| [889](#L889) | <span class="loader-inner line-scale-pulse-out"> |
| [890](#L890) | <div></div> |
| [891](#L891) | <div></div> |
| [892](#L892) | <div></div> |
| [893](#L893) | <div></div> |
| [894](#L894) | <div></div> |
| [895](#L895) | </span> |
| [896](#L896) | </div> |
| [897](#L897) | <script type="text/javascript"> |
| [898](#L898) | jQuery(document).ready(function() { |
| [899](#L899) | jQuery('body').tooltip({ |
| [900](#L900) | selector: '.mini-tooltip', |
| [901](#L901) | html: true |
| [902](#L902) | }); |
| [903](#L903) | /\*if (isBootstrapUse) { |
| [904](#L904) | jQuery('.mini-tooltip').tooltip({html: true,}); |
| [905](#L905) | } else { |
| [906](#L906) | var tooltip = new Tooltip('.mini-tooltip', { |
| [907](#L907) | html: true |
| [908](#L908) | }); |
| [909](#L909) | }\*/ |
| [910](#L910) | }); |
| [911](#L911) | </script> |
| [912](#L912) | <?php |
| [913](#L913) | return ob\_get\_clean(); |
| [914](#L914) | } |
| [915](#L915) | add\_shortcode( 'ce21-mini-calendar', 'ce21\_mini\_calendar\_shortcode' ); |
| [916](#L916) |  |
| [917](#L917) | function ce21\_getMiniCalendarHTML($month,$year){ |
| [918](#L918) |  |
| [919](#L919) | /\*Mini Calendar Event Fetch using API starts\*/ |
| [920](#L920) | $access\_token\_response = get\_access\_token(); |
| [921](#L921) | //$date = new DateTime($year); |
| [922](#L922) | //$startD = $date->format('Y-m-d'); |
| [923](#L923) | $startD = $year.'-'.$month.'-01'; |
| [924](#L924) |  |
| [925](#L925) | if ($access\_token\_response['success']) { |
| [926](#L926) | $api\_settings = get\_ce21\_ss\_api\_settings\_data(); |
| [927](#L927) | $api\_Access\_token = (!empty($api\_settings)) ? $api\_settings->AccessToken : ''; |
| [928](#L928) | $base\_url = (!empty($api\_settings)) ? $api\_settings->BaseURL : ''; |
| [929](#L929) | $url = $base\_url . "/wp/minicalendar?startDate=" . $startD; |
| [930](#L930) |  |
| [931](#L931) | $args = array( |
| [932](#L932) | 'headers' => array( |
| [933](#L933) | 'Authorization' => 'Bearer ' . $api\_Access\_token |
| [934](#L934) | ) |
| [935](#L935) | ); |
| [936](#L936) | $res = wp\_remote\_get($url, $args); |
| [937](#L937) | $res = json\_decode($res['body']); |
| [938](#L938) | } |
| [939](#L939) | $eventDays = []; |
| [940](#L940) | $i=0; |
| [941](#L941) | //print\_r($res); |
| [942](#L942) | if(!empty($res) && !empty($res->days)){ |
| [943](#L943) | foreach ($res->days as $days){ |
| [944](#L944) | if($days->hasProduct){ |
| [945](#L945) | $eventDays[$i]['day'] = $days->day; |
| [946](#L946) | $eventDays[$i]['color'] = $days->color; |
| [947](#L947) | $eventDays[$i]['className'] = $days->className; |
| [948](#L948) | $eventDays[$i]['tooltip'] = $days->tooltip; |
| [949](#L949) | $eventDays[$i]['url'] = $res->fullUrl; |
| [950](#L950) | $i++; |
| [951](#L951) | } |
| [952](#L952) | } |
| [953](#L953) | } |
| [954](#L954) | //print\_r($eventDays); |
| [955](#L955) | /\*Mini Calendar Event Fetch using API starts\*/ |
| [956](#L956) |  |
| [957](#L957) | /\*Mini Calendar Event Fetch from database start\*/ |
| [958](#L958) | global $wpdb; |
| [959](#L959) | $start\_dt = new DateTime($year.'-'.$month.'-01 00:00:00'); |
| [960](#L960) | $startDate = $start\_dt->format('Y-m-d H:i:s'); |
| [961](#L961) | $end\_dt = new DateTime($year.'-'.$month.'-01 23:59:59'); |
| [962](#L962) | $end\_dt->modify('last day of this month'); |
| [963](#L963) | $endDate = $end\_dt->format('Y-m-d H:i:s'); |
| [964](#L964) |  |
| [965](#L965) | $ce21\_calendar\_events = $wpdb->get\_results($wpdb->prepare("SELECT \* FROM ".$wpdb->prefix."ce21\_calendar\_events WHERE `StartDate` BETWEEN %s AND %s", $startDate, $endDate)); |
| [966](#L966) |  |
| [967](#L967) | foreach ($ce21\_calendar\_events as $ce21\_calendar\_event) |
| [968](#L968) | { |
| [969](#L969) | $eventDays[$i]['day'] = date('d', strtotime($ce21\_calendar\_event->StartDate)); |
| [970](#L970) | $eventDays[$i]['color'] = '#bf9000'; |
| [971](#L971) | $eventDays[$i]['className'] = 'cal-day'; |
| [972](#L972) | $eventDays[$i]['tooltip'] = $ce21\_calendar\_event->Title; |
| [973](#L973) | $eventDays[$i]['url'] = !empty($ce21\_calendar\_event->Url) ? $ce21\_calendar\_event->Url : (!empty($res) ? $res->fullUrl : ""); |
| [974](#L974) | $i++; |
| [975](#L975) | } |
| [976](#L976) | /\*Mini Calendar Event Fetch from database ends\*/ |
| [977](#L977) |  |
| [978](#L978) | $dateObj   = DateTime::createFromFormat('!m', $month); |
| [979](#L979) | $monthName = $dateObj->format('F'); |
| [980](#L980) | $tgl = '1 '.$monthName.' '.$year; |
| [981](#L981) | $prevMonth = date("m",mktime(0,0,0,date("m", strtotime($tgl))-1,1,date("Y", strtotime($tgl)))); |
| [982](#L982) | $prevYear  = date("Y",mktime(0,0,0,date("m", strtotime($tgl))-1,1,date("Y", strtotime($tgl)))); |
| [983](#L983) | $nextMonth = date("m",mktime(0,0,0,date("m", strtotime($tgl))+1,1,date("Y", strtotime($tgl)))); |
| [984](#L984) | $nextYear  = date("Y",mktime(0,0,0,date("m", strtotime($tgl))+1,1,date("Y", strtotime($tgl)))); |
| [985](#L985) |  |
| [986](#L986) | // What is the first day of the month in question? |
| [987](#L987) | $firstDayOfMonth = mktime(0,0,0,$month,1,$year); |
| [988](#L988) | // How many days does this month contain? |
| [989](#L989) | $numberDays = date('t',$firstDayOfMonth); |
| [990](#L990) | // Retrieve some information about the first day of the |
| [991](#L991) | // month in question. |
| [992](#L992) | $dateComponents = getdate($firstDayOfMonth); |
| [993](#L993) | // What is the name of the month in question? |
| [994](#L994) | $monthName = $dateComponents['month']; |
| [995](#L995) | // What is the index value (0-6) of the first day of the |
| [996](#L996) | // month in question. |
| [997](#L997) | $dayOfWeek = $dateComponents['wday']; |
| [998](#L998) | ?> |
| [999](#L999) | <div id="calendarContainer" class="calendarContainer" style="margin-bottom:15px;"> |
| [1000](#L1000) | <table class="calendar" style="border-collapse: collapse;"> |
| [1001](#L1001) | <tbody> |
| [1002](#L1002) | <tr> |
| [1003](#L1003) | <td> |
| [1004](#L1004) | <a class="ce21\_calendar\_nav" aria-label="Click here to go to previous month" data-month="<?php echo esc\_attr($prevMonth); ?>" |
| [1005](#L1005) | data-year="<?php echo esc\_attr($prevYear); ?>" href="javascript: void(0);" >&lt;&lt;</a> |
| [1006](#L1006) | </td> |
| [1007](#L1007) | <td style="text-align: center; width: 130px"> |
| [1008](#L1008) | <?php if(empty($res)){ ?> |
| [1009](#L1009) | <a href=""><?php echo esc\_html($monthName.' '.$year); ?></a> |
| [1010](#L1010) | <?php } else { ?> |
| [1011](#L1011) | <a href="<?php echo esc\_url($res->fullUrl); ?>"><?php echo esc\_html($monthName.' '.$year); ?></a> |
| [1012](#L1012) | <?php } ?> |
| [1013](#L1013) | </td> |
| [1014](#L1014) | <td> |
| [1015](#L1015) | <a class="ce21\_calendar\_nav" aria-label="Click here to go to next month" data-month="<?php echo esc\_attr($nextMonth); ?>" |
| [1016](#L1016) | data-year="<?php echo esc\_attr($nextYear); ?>" href="javascript: void(0);">&gt;&gt;</a> |
| [1017](#L1017) | </td> |
| [1018](#L1018) | </tr> |
| [1019](#L1019) | </tbody> |
| [1020](#L1020) | </table> |
| [1021](#L1021) | <table class="calendar" cellspacing="2" cellpadding="2" style="border-width: 0px; border-collapse: collapse;"> |
| [1022](#L1022) | <tbody> |
| [1023](#L1023) | <tr> |
| [1024](#L1024) | <th align="center" aria-label="Sunday" abbr="Sunday" scope="col">Sun</th> |
| [1025](#L1025) | <th align="center" aria-label="Monday" abbr="Monday" scope="col">Mon</th> |
| [1026](#L1026) | <th align="center" aria-label="Tuesday" abbr="Tuesday" scope="col">Tue</th> |
| [1027](#L1027) | <th align="center" aria-label="Wednesday" abbr="Wednesday" scope="col">Wed</th> |
| [1028](#L1028) | <th align="center" aria-label="Thursday" abbr="Thursday" scope="col">Thu</th> |
| [1029](#L1029) | <th align="center" aria-label="Friday" abbr="Friday" scope="col">Fri</th> |
| [1030](#L1030) | <th align="center" aria-label="Saturday" abbr="Saturday" scope="col">Sat</th> |
| [1031](#L1031) | </tr> |
| [1032](#L1032) | <?php $currentDay = 1; ?> |
| [1033](#L1033) | <tr> |
| [1034](#L1034) | <?php |
| [1035](#L1035) | // The variable $dayOfWeek is used to |
| [1036](#L1036) | // ensure that the calendar |
| [1037](#L1037) | // display consists of exactly 7 columns. |
| [1038](#L1038) | if ($dayOfWeek > 0) { |
| [1039](#L1039) | echo "<td class='ohter' colspan='".esc\_attr($dayOfWeek)."'>&nbsp;</td>"; |
| [1040](#L1040) | } |
| [1041](#L1041) | $month = str\_pad($month, 2, "0", STR\_PAD\_LEFT); |
| [1042](#L1042) | while ($currentDay <= $numberDays) { |
| [1043](#L1043) | // Seventh column (Saturday) reached. Start a new row. |
| [1044](#L1044) | if ($dayOfWeek == 7) { |
| [1045](#L1045) | $dayOfWeek = 0; |
| [1046](#L1046) | echo "</tr><tr>"; |
| [1047](#L1047) | } |
| [1048](#L1048) | $currentDayRel = str\_pad($currentDay, 2, "0", STR\_PAD\_LEFT); |
| [1049](#L1049) | $date = "$year-$month-$currentDayRel"; |
| [1050](#L1050) |  |
| [1051](#L1051) | $key = array\_search($currentDay,array\_column($eventDays, 'day')); |
| [1052](#L1052) | if( !empty($key) || $key===0 ){ |
| [1053](#L1053) | ?> |
| [1054](#L1054) | <td class="day <?php echo esc\_attr(' '.$eventDays[$key]['className']); ?>" rel="<?php echo esc\_attr($date); ?>"> |
| [1055](#L1055) | <a href="<?php echo esc\_attr($eventDays[$key]['url']); ?>" class="exist clsCalenderTooltip mini-tooltip" |
| [1056](#L1056) | style="background-color:<?php echo esc\_attr($eventDays[$key]['color']); ?>" |
| [1057](#L1057) | data-toggle="tooltip" title="<?php echo esc\_attr($eventDays[$key]['tooltip']); ?>"> |
| [1058](#L1058) | <?php echo esc\_html($currentDay); ?> |
| [1059](#L1059) | </a> |
| [1060](#L1060) | </td> |
| [1061](#L1061) | <?php |
| [1062](#L1062) | }else{ |
| [1063](#L1063) | echo "<td class='day' rel='". esc\_attr($date)."'>".esc\_html($currentDay)."</td>"; |
| [1064](#L1064) | } |
| [1065](#L1065) |  |
| [1066](#L1066) | // Increment counters |
| [1067](#L1067) | $currentDay++; |
| [1068](#L1068) | $dayOfWeek++; |
| [1069](#L1069) | } |
| [1070](#L1070) | // Complete the row of the last week in month, if necessary |
| [1071](#L1071) | if ($dayOfWeek != 7) { |
| [1072](#L1072) | $remainingDays = 7 - $dayOfWeek; |
| [1073](#L1073) | echo "<td class='ohter' colspan=" . esc\_attr( $remainingDays ) , ">&nbsp;</td>"; |
| [1074](#L1074) | } |
| [1075](#L1075) | ?> |
| [1076](#L1076) | </tr> |
| [1077](#L1077) | </tbody> |
| [1078](#L1078) | </table> |
| [1079](#L1079) | </div> |
| [1080](#L1080) | <?php |
| [1081](#L1081) | } |
| [1082](#L1082) | /\* |
| [1083](#L1083) | \* Function used to get ce21 calendar events. |
| [1084](#L1084) | \*/ |
| [1085](#L1085) | add\_action('wp\_ajax\_get\_ce21\_mini\_calendar','get\_ce21\_mini\_calendar'); |
| [1086](#L1086) | add\_action('wp\_ajax\_nopriv\_get\_ce21\_mini\_calendar','get\_ce21\_mini\_calendar'); |
| [1087](#L1087) | function get\_ce21\_mini\_calendar() |
| [1088](#L1088) | { |
| [1089](#L1089) | header('Content-type: application/json'); |
| [1090](#L1090) | $month = sanitize\_text\_field($\_REQUEST['month']); |
| [1091](#L1091) | $year  = sanitize\_text\_field($\_REQUEST['year']); |
| [1092](#L1092) | ob\_start(); |
| [1093](#L1093) | ce21\_getMiniCalendarHTML($month,$year); |
| [1094](#L1094) | $res['content'] = ob\_get\_clean(); |
| [1095](#L1095) | $res['success'] = true; |
| [1096](#L1096) | echo json\_encode($res); |
| [1097](#L1097) | exit; |
| [1098](#L1098) | } |
| [1099](#L1099) | /\*Mini Calendar code ends\*/ |

**Note:** See [TracBrowser](/wiki/TracBrowser)
for help on using the repository browser.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Plain Text](/browser/ce21-suite/trunk/includes/ce21-functions.php?rev=3097700&format=txt)
* [Original Format](/export/3097700/ce21-suite/trunk/includes/ce21-functions.php)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)


