=== Content from themes.trac.wordpress.org_bb1aefaf_20250114_192544.html ===


[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Showcase](https://wordpress.org/showcase/)
* [Hosting](https://wordpress.org/hosting/)
* Extend
  + [Themes](https://wordpress.org/themes/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Blocks](https://wordpress.org/blocks/)
  + [Openverse ↗︎](https://openverse.org/)
* Learn
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* Community
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [Events](https://events.wordpress.org/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* About
  + [About WordPress](https://wordpress.org/about/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Make WordPress Themes](//make.wordpress.org/themes/)

* [Blog](//make.wordpress.org/themes/)
* [Trac (Theme Reviews)](//themes.trac.wordpress.org/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=https%3A%2F%2Fthemes.trac.wordpress.org%2Fchangeset%3Fnew%3D247810%2540th-shop-mania%26old%3D247810%2540th-shop-mania)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)
* [Ticket Graph](/ticketgraph)

## Context Navigation

* ← [Previous Change](/changeset/239331/th-shop-mania "Changeset 239331 for th-shop-mania")
* [Next Change](/changeset/251951/th-shop-mania "Changeset 251951 for th-shop-mania") →

---

# Changeset [247810](/changeset/247810 "Show full changeset") for [th-shop-mania](/browser/th-shop-mania?rev=247810 "Show entry in browser")

View differences
inline
side by side

Show
lines around each change

Show the changes in full context

Ignore:

Blank lines

Case changes

White space changes

Timestamp:
11/06/2024 11:37:32 AM
([2 months](/timeline?from=2024-11-06T11%3A37%3A32Z&precision=second "See timeline at 11/06/2024 11:37:32 AM") ago)

Author:
themedropbox
Message:

New version of Th Shop Mania - 1.5.0

Location:
[th-shop-mania/1.5.0](/browser/th-shop-mania/1.5.0?rev=247810)
Files:

10 edited
1 copied

* [.](/browser/th-shop-mania/1.5.0?rev=247810 "Show entry in browser")
  (copied)
  *(copied from [th-shop-mania/1.4.9](/browser/th-shop-mania/1.4.9?rev=239331 "Show original file (revision 247809)"))*
* [customizer/customizer.css](/browser/th-shop-mania/1.5.0/customizer/customizer.css?rev=247810 "Show entry in browser")
  (modified)
  ([1 diff](#file1 "Show differences"))
* [customizer/customizer.php](/browser/th-shop-mania/1.5.0/customizer/customizer.php?rev=247810 "Show entry in browser")
  (modified)
  ([2 diffs](#file2 "Show differences"))
* [customizer/section/color/global-color.php](/browser/th-shop-mania/1.5.0/customizer/section/color/global-color.php?rev=247810 "Show entry in browser")
  (modified)
  ([1 diff](#file3 "Show differences"))
* [inc/admin-function.php](/browser/th-shop-mania/1.5.0/inc/admin-function.php?rev=247810 "Show entry in browser")
  (modified)
  ([2 diffs](#file4 "Show differences"))
* [inc/init.php](/browser/th-shop-mania/1.5.0/inc/init.php?rev=247810 "Show entry in browser")
  (modified)
  ([2 diffs](#file5 "Show differences"))
* [lib/notification/customizer-notification/thsm-custom-section.php](/browser/th-shop-mania/1.5.0/lib/notification/customizer-notification/thsm-custom-section.php?rev=247810 "Show entry in browser")
  (modified)
  ([1 diff](#file6 "Show differences"))
* [lib/notification/js/notify.js](/browser/th-shop-mania/1.5.0/lib/notification/js/notify.js?rev=247810 "Show entry in browser")
  (modified)
  ([1 diff](#file7 "Show differences"))
* [lib/notification/notify.php](/browser/th-shop-mania/1.5.0/lib/notification/notify.php?rev=247810 "Show entry in browser")
  (modified)
  ([1 diff](#file8 "Show differences"))
* [readme.txt](/browser/th-shop-mania/1.5.0/readme.txt?rev=247810 "Show entry in browser")
  (modified)
  ([2 diffs](#file9 "Show differences"))
* [style.css](/browser/th-shop-mania/1.5.0/style.css?rev=247810 "Show entry in browser")
  (modified)
  ([1 diff](#file10 "Show differences"))

### Legend:

Unmodified
Added
Removed

* ## [th-shop-mania/1.5.0/customizer/customizer.css](/changeset/247810/th-shop-mania/1.5.0/customizer/customizer.css "Show the changeset 247810 restricted to th-shop-mania/1.5.0/customizer/customizer.css")

  | [r237621](/browser/th-shop-mania/1.4.6/customizer/customizer.css?rev=237621#L1 "Show revision 237621 of this file in browser") | [r247810](/browser/th-shop-mania/1.5.0/customizer/customizer.css?rev=247810#L1 "Show revision 247810 of this file in browser") |  |
  | --- | --- | --- |
  |  | 1 | /\* Smooth scrolling in customizer sections \*/ |
  |  | 2 | #customize-controls .accordion-section-content { |
  |  | 3 | overflow-y: auto; |
  |  | 4 | scroll-behavior: smooth; |
  |  | 5 | } |
  |  | 6 |  |
  |  | 7 | /\* Prevent content jumping \*/ |
  |  | 8 | #customize-controls .accordion-section.open { |
  |  | 9 | overflow-y: auto; |
  |  | 10 | } |
  |  | 11 |  |
  |  | 12 | /\* Ensure no jumping when opening a section \*/ |
  |  | 13 | html { |
  |  | 14 | overflow-y: scroll; |
  |  | 15 | } |
  |  | 16 |  |
  | 1 | 17 | .customize-pane-parent{ |
  | 2 | 18 | background: #FFF; |
* ## [th-shop-mania/1.5.0/customizer/customizer.php](/changeset/247810/th-shop-mania/1.5.0/customizer/customizer.php "Show the changeset 247810 restricted to th-shop-mania/1.5.0/customizer/customizer.php")

  | [r183511](/browser/th-shop-mania/1.2.4/customizer/customizer.php?rev=183511#L7 "Show revision 183511 of this file in browser") | [r247810](/browser/th-shop-mania/1.5.0/customizer/customizer.php?rev=247810#L7 "Show revision 247810 of this file in browser") |  |
  | --- | --- | --- |
  | 7 | 7 | \*/ |
  | 8 | 8 | function th\_shop\_mania\_customize\_register( $wp\_customize ){ |
  |  | 9 |  |
  | 9 | 10 | require TH\_SHOP\_MANIA\_THEME\_DIR . 'customizer/section/woo/single-product.php'; |
  | 10 | 11 | //site identity |
  | […](/browser/th-shop-mania/1.2.4/customizer/customizer.php?rev=183511#L14) | […](/browser/th-shop-mania/1.5.0/customizer/customizer.php?rev=247810#L15) |  |
  | 14 | 15 | } |
  | 15 | 16 | add\_action('customize\_register','th\_shop\_mania\_customize\_register'); |
  | 16 |  | // function th\_shop\_mania\_is\_json( $string ){ |
  | 17 |  | //     return is\_string( $string ) && is\_array( json\_decode( $string, true ) ) ? true : false; |
  | 18 |  | // } |
  |  | 17 |  |
  |  | 18 | if ( !function\_exists('th\_shop\_mania\_is\_json') ) { |
  |  | 19 | function th\_shop\_mania\_is\_json( $string ){ |
  |  | 20 | return is\_string( $string ) && is\_array( json\_decode( $string, true ) ) ? true : false; |
  |  | 21 | } |
  |  | 22 | } |
* ## [th-shop-mania/1.5.0/customizer/section/color/global-color.php](/changeset/247810/th-shop-mania/1.5.0/customizer/section/color/global-color.php "Show the changeset 247810 restricted to th-shop-mania/1.5.0/customizer/section/color/global-color.php")

  | [r183511](/browser/th-shop-mania/1.2.4/customizer/section/color/global-color.php?rev=183511#L3 "Show revision 183511 of this file in browser") | [r247810](/browser/th-shop-mania/1.5.0/customizer/section/color/global-color.php?rev=247810#L3 "Show revision 247810 of this file in browser") |  |
  | --- | --- | --- |
  | 3 | 3 | //Global Option |
  | 4 | 4 | /\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*/ |
  |  | 5 |  |
  | 5 | 6 | $wp\_customize->add\_panel( 'th-shop-mania-panel-color-background', array( |
  | 6 | 7 | 'priority' => 22, |
* ## [th-shop-mania/1.5.0/inc/admin-function.php](/changeset/247810/th-shop-mania/1.5.0/inc/admin-function.php "Show the changeset 247810 restricted to th-shop-mania/1.5.0/inc/admin-function.php")

  | [r183511](/browser/th-shop-mania/1.2.4/inc/admin-function.php?rev=183511#L248 "Show revision 183511 of this file in browser") | [r247810](/browser/th-shop-mania/1.5.0/inc/admin-function.php?rev=247810#L248 "Show revision 247810 of this file in browser") |  |
  | --- | --- | --- |
  | 248 | 248 | } |
  | 249 | 249 | endif; |
  |  | 250 |  |
  | 250 | 251 | if ( !function\_exists('th\_shop\_mania\_is\_json') ) { |
  | 251 | 252 | function th\_shop\_mania\_is\_json( $string ){ |
  | […](/browser/th-shop-mania/1.2.4/inc/admin-function.php?rev=183511#L253) | […](/browser/th-shop-mania/1.5.0/inc/admin-function.php?rev=247810#L254) |  |
  | 253 | 254 | } |
  | 254 | 255 | } |
  |  | 256 |  |
  | 255 | 257 | if (!function\_exists('th\_shop\_mania\_wp\_kses\_allowed\_html')) { |
  | 256 | 258 | function th\_shop\_mania\_wp\_kses\_allowed\_html() { |
* ## [th-shop-mania/1.5.0/inc/init.php](/changeset/247810/th-shop-mania/1.5.0/inc/init.php "Show the changeset 247810 restricted to th-shop-mania/1.5.0/inc/init.php")

  | [r238381](/browser/th-shop-mania/1.4.7/inc/init.php?rev=238381#L6 "Show revision 238381 of this file in browser") | [r247810](/browser/th-shop-mania/1.5.0/inc/init.php?rev=247810#L6 "Show revision 247810 of this file in browser") |  |
  | --- | --- | --- |
  | 6 | 6 | \* @return mixed|string |
  | 7 | 7 | \*/ |
  | 8 |  | ~~$plugin\_pro\_exists = file\_exists(WP\_PLUGIN\_DIR . '/' . 'th-shop-mania-pro/th-shop-mania-pro.php');~~ |
  | 9 | 8 | get\_template\_part( 'inc/starter-content/class-th-shop-mania-starter-content'); |
  | 10 | 9 | get\_template\_part( 'inc/admin-function'); |
  | […](/browser/th-shop-mania/1.4.7/inc/init.php?rev=238381#L31) | […](/browser/th-shop-mania/1.5.0/inc/init.php?rev=247810#L30) |  |
  | 31 | 30 | get\_template\_part('customizer/extend-customizer/class-th-shop-mania-wp-customize-panel'); |
  | 32 | 31 | get\_template\_part('customizer/extend-customizer/class-th-shop-mania-wp-customize-section'); |
  |  | 32 | get\_template\_part('lib/notification/customizer-notification/thsm-custom-section'); |
  |  | 33 | get\_template\_part( 'lib/notification/customizer-notification/customizer-install'); |
  | 33 | 34 | get\_template\_part('customizer/customizer-radio-image/class/class-th-shop-mania-customize-control-radio-image'); |
  | 34 | 35 | get\_template\_part('customizer/customizer-range-value/class/class-th-shop-mania-customizer-range-value-control'); |
  | 35 | 36 | get\_template\_part('customizer/customizer-toggle/class-th-shop-mania-toggle-control'); |
  |  | 37 | get\_template\_part('customizer/custom-customizer'); |
  |  | 38 | get\_template\_part('customizer/customizer'); |
  |  | 39 | $plugin\_pro\_exists = file\_exists(WP\_PLUGIN\_DIR . '/' . 'th-shop-mania-pro/th-shop-mania-pro.php'); |
  | 36 | 40 | if (!$plugin\_pro\_exists) { |
  | 37 | 41 | get\_template\_part('customizer/pro-button/class-customize'); |
  | 38 | 42 | } |
  | 39 |  | ~~get\_template\_part('customizer/custom-customizer');~~ |
  | 40 |  | ~~get\_template\_part('customizer/customizer');~~ |
  | 41 |  | ~~get\_template\_part('lib/notification/customizer-notification/thsm-custom-section');~~ |
  | 42 |  | ~~get\_template\_part( 'lib/notification/customizer-notification/customizer-install');~~ |
  | 43 | 43 | } |
  | 44 | 44 |  |
* ## [th-shop-mania/1.5.0/lib/notification/customizer-notification/thsm-custom-section.php](/changeset/247810/th-shop-mania/1.5.0/lib/notification/customizer-notification/thsm-custom-section.php "Show the changeset 247810 restricted to th-shop-mania/1.5.0/lib/notification/customizer-notification/thsm-custom-section.php")

  | [r237621](/browser/th-shop-mania/1.4.6/lib/notification/customizer-notification/thsm-custom-section.php?rev=237621#L68 "Show revision 237621 of this file in browser") | [r247810](/browser/th-shop-mania/1.5.0/lib/notification/customizer-notification/thsm-custom-section.php?rev=247810#L68 "Show revision 247810 of this file in browser") |  |
  | --- | --- | --- |
  | 68 | 68 | ); |
  | 69 | 69 | } |
  | 70 |  | add\_action('customize\_register', 'th\_shop\_mania\_customize\_install\_register'); |
  |  | 70 | add\_action('customize\_register', 'th\_shop\_mania\_customize\_install\_register' , 1); |
* ## [th-shop-mania/1.5.0/lib/notification/js/notify.js](/changeset/247810/th-shop-mania/1.5.0/lib/notification/js/notify.js "Show the changeset 247810 restricted to th-shop-mania/1.5.0/lib/notification/js/notify.js")

  | [r238381](/browser/th-shop-mania/1.4.7/lib/notification/js/notify.js?rev=238381#L27 "Show revision 238381 of this file in browser") | [r247810](/browser/th-shop-mania/1.5.0/lib/notification/js/notify.js?rev=247810#L27 "Show revision 247810 of this file in browser") |  |
  | --- | --- | --- |
  | 27 | 27 | dataType: 'html', |
  | 28 | 28 | data: { |
  | 29 |  | action: '~~th\_shop\_mania\_install\_and\_activate\_callback~~', |
  |  | 29 | action: '', |
  | 30 | 30 | security: theme\_data.security, |
  | 31 | 31 | plugin\_slug: pluginSlug |
* ## [th-shop-mania/1.5.0/lib/notification/notify.php](/changeset/247810/th-shop-mania/1.5.0/lib/notification/notify.php "Show the changeset 247810 restricted to th-shop-mania/1.5.0/lib/notification/notify.php")

  | [r238381](/browser/th-shop-mania/1.4.7/lib/notification/notify.php?rev=238381#L196 "Show revision 238381 of this file in browser") | [r247810](/browser/th-shop-mania/1.5.0/lib/notification/notify.php?rev=247810#L196 "Show revision 247810 of this file in browser") |  |
  | --- | --- | --- |
  | 196 | 196 | // Callback function to install and activate plugin |
  | 197 | 197 | function th\_shop\_mania\_install\_and\_activate\_callback() { |
  |  | 198 |  |
  |  | 199 | if ( ! current\_user\_can( 'administrator' ) ) { |
  |  | 200 |  |
  |  | 201 | wp\_die( - 1, 403 ); |
  |  | 202 |  |
  |  | 203 | } |
  | 198 | 204 | // Check nonce for security |
  | 199 | 205 | check\_ajax\_referer('thactivatenonce', 'security'); |
* ## [th-shop-mania/1.5.0/readme.txt](/changeset/247810/th-shop-mania/1.5.0/readme.txt "Show the changeset 247810 restricted to th-shop-mania/1.5.0/readme.txt")

  | [r239331](/browser/th-shop-mania/1.4.9/readme.txt?rev=239331#L5 "Show revision 239331 of this file in browser") | [r247810](/browser/th-shop-mania/1.5.0/readme.txt?rev=247810#L5 "Show revision 247810 of this file in browser") |  |
  | --- | --- | --- |
  | 5 | 5 | Requires PHP: 5.6 |
  | 6 | 6 | Tested up to: 6.6 |
  | 7 |  | Stable tag: 1.~~4.9~~ |
  |  | 7 | Stable tag: 1.5.0 |
  | 8 | 8 | License: GPLv3 or later |
  | 9 | 9 | License URL: https://www.gnu.org/licenses/gpl-3.0.en.html |
  | […](/browser/th-shop-mania/1.4.9/readme.txt?rev=239331#L22) | […](/browser/th-shop-mania/1.5.0/readme.txt?rev=247810#L22) |  |
  | 22 | 22 | = Can i use your theme with latest version of WordPress= |
  | 23 | 23 | Yes, this theme is tested with latest version of WordPress, you can use it for your site. |
  |  | 24 |  |
  |  | 25 | = Version 1.5.0 = |
  |  | 26 | \* Fixed: Security issue fixed. |
  | 24 | 27 |  |
  | 25 | 28 | = Version 1.4.9 = |
* ## [th-shop-mania/1.5.0/style.css](/changeset/247810/th-shop-mania/1.5.0/style.css "Show the changeset 247810 restricted to th-shop-mania/1.5.0/style.css")

  | [r239331](/browser/th-shop-mania/1.4.9/style.css?rev=239331#L5 "Show revision 239331 of this file in browser") | [r247810](/browser/th-shop-mania/1.5.0/style.css?rev=247810#L5 "Show revision 247810 of this file in browser") |  |
  | --- | --- | --- |
  | 5 | 5 | Author URI: https://www.themehunk.com |
  | 6 | 6 | Description: TH Shop Mania is a Fast, Lightweight, and Fully Customizable WooCommerce WordPress Theme for Creating eCommerce Websites. Build with SEO in mind it uses a powerful AJAX tech​ to give users a very fast and seamless online shopping interface​ without the need to constantly refresh pages. Shop Mania works perfectly with all page builders like Elementor, Visual Composer, Beaver Builder, Brizy, Gutenberg, etc. You can easily create websites for: electronics, fashion, furniture, niche store, clothing, glasses, watches, sport, shoes, jewelry, cosmetics, multi-vendor marketplace, medical, food, auto parts, organic, landing page, music shop, and others. Shop Mania improved performance by optimizing dynamic styles, using CSS variables, and optimizing server response time. The theme is integrated with WooCommerce, Advanced Product Search, Woo Cart plugin, Product compare, Variation Swatches plugin, and the lead form builder plugin which will help you design a perfect Online Store. |
  | 7 |  | Version: 1.~~4.9~~ |
  |  | 7 | Version: 1.5.0 |
  | 8 | 8 | Requires at least: 5.5 |
  | 9 | 9 | Tested up to: 6.6 |

**Note:** See [TracChangeset](/wiki/TracChangeset)
for help on using the changeset viewer.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Unified Diff](?format=diff&new=247810)
* [Zip Archive](?format=zip&new=247810)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Privacy](https://wordpress.org/about/privacy/)

* [Showcase](https://wordpress.org/showcase/)
* [Themes](https://wordpress.org/themes/)
* [Plugins](https://wordpress.org/plugins/)
* [Patterns](https://wordpress.org/patterns/)

* [Learn](https://learn.wordpress.org/)
* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [WordPress.tv ↗](https://wordpress.tv/)

* [Get Involved](https://make.wordpress.org/)
* [Events](https://events.wordpress.org/)
* [Donate ↗](https://wordpressfoundation.org/donate/)
* [Five for the Future](https://wordpress.org/five-for-the-future/)

* [WordPress.com ↗](https://wordpress.com/?ref=wporg-footer)
* [Matt ↗](https://ma.tt/)
* [bbPress ↗](https://bbpress.org/)
* [BuddyPress ↗](https://buddypress.org/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our X (formerly Twitter) account](https://www.x.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)
* [Visit our YouTube channel](https://www.youtube.com/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from themes.svn.wordpress.org_d1548117_20250114_192543.html ===
php
include\_once(ABSPATH . 'wp-admin/includes/plugin.php');
function th\_shop\_mania\_set\_cookie() {
$expire\_time = time() + (86400 \* 7); // 7 days in seconds
if (!isset($\_COOKIE['th\_shop\_mania\_thms\_time'])) {
// Set a cookie for 7 days
setcookie('th\_shop\_mania\_thms\_time', $expire\_time, $expire\_time, COOKIEPATH, COOKIE\_DOMAIN);
}
}
function th\_shop\_mania\_unset\_cookie(){
$visit\_time = time();
if (isset($\_COOKIE['th\_shop\_mania\_thms\_time']) && $\_COOKIE['th\_shop\_mania\_thms\_time'] < $visit\_time) {
setcookie('th\_shop\_mania\_thms\_time', '', time() - 3600, COOKIEPATH, COOKIE\_DOMAIN);
}
}
function th\_shop\_mania\_clear\_notice\_cookie() {
// Clear the cookie when the theme is switched
if (isset($\_COOKIE['th\_shop\_mania\_thms\_time'])) {
setcookie('th\_shop\_mania\_thms\_time', '', time() - 3600, COOKIEPATH, COOKIE\_DOMAIN);
}
}
if(isset($\_GET['notice-disable']) && $\_GET['notice-disable'] == true){
add\_action('admin\_init', 'th\_shop\_mania\_set\_cookie');
}
if(!isset($\_COOKIE['th\_shop\_mania\_thms\_time'])) {
add\_action('admin\_notices', 'th\_shop\_mania\_display\_admin\_notice');
}
if(isset($\_COOKIE['th\_shop\_mania\_thms\_time'])) {
add\_action( 'admin\_notices', 'th\_shop\_mania\_unset\_cookie');
}
// add\_action('admin\_notices', 'th\_shop\_mania\_display\_admin\_notice');
// Display admin notice
function th\_shop\_mania\_display\_admin\_notice() {
$allowed\_pages = array(
'dashboard', // index.php
'themes', // themes.php
'plugins', // plugins.php
'users',
'appearance\_page\_th\_shop\_mania\_thunk\_started' // appearance\_page\_thunk\_started
);
// Get the current screen
$current\_screen = get\_current\_screen();
// Check if the current screen is one of the allowed pages
if (!in\_array($current\_screen-base, $allowed\_pages)) {
return; // Exit if not on an allowed page
}
global $current\_user;
$user\_id = $current\_user->ID;
$theme\_data = wp\_get\_theme();
if ( get\_user\_meta( $user\_id, esc\_html( $theme\_data->get( 'TextDomain' ) ) . '\_notice\_ignore' ) ) {
return;
}
// Retrieve the theme support data
$plugin\_data = get\_theme\_support('recommend-plugins');
// Check if the theme support exists and has the plugin data
$plugin\_data = $plugin\_data[0];
// Get the specific plugin data
$hunk\_companion = isset($plugin\_data['hunk-companion']) ? $plugin\_data['hunk-companion'] : array();
$th\_shop\_mania\_pro = isset($hunk\_companion['pro-plugin']) ? $hunk\_companion['pro-plugin'] : array();
// Extract the values
$plugin\_pro\_slug = isset($th\_shop\_mania\_pro['slug']) ? $th\_shop\_mania\_pro['slug'] : '';
$plugin\_pro\_file = isset($th\_shop\_mania\_pro['init']) ? $th\_shop\_mania\_pro['init'] : '';
$plugin\_companion\_slug = isset($plugin\_data['hunk-companion']['slug']) ? $plugin\_data['hunk-companion']['slug'] : 'hunk-companion';
$plugin\_companion\_file = isset($plugin\_data['hunk-companion']['active\_filename']) ? $plugin\_data['hunk-companion']['active\_filename'] : '';
// Show admin notice to install or activate the secondary plugin
$plugin\_pro\_installed = is\_plugin\_active($plugin\_pro\_file);
$plugin\_pro\_exists = file\_exists(WP\_PLUGIN\_DIR . '/' . $plugin\_pro\_file);
$plugin\_companion\_installed = is\_plugin\_active($plugin\_companion\_file);
$plugin\_companion\_exists = file\_exists(WP\_PLUGIN\_DIR . '/' . $plugin\_companion\_file);
// Check if 'th-shop-mania-pro' is installed
$plugin\_pro\_installed = is\_plugin\_active($plugin\_pro\_file);
$plugin\_pro\_exists = file\_exists(WP\_PLUGIN\_DIR . '/' . $plugin\_pro\_file);
if ((isset($\_GET['page']) && $\_GET['page'] == 'th\_shop\_mania\_thunk\_started' ) || ((!$plugin\_pro\_exists && !$plugin\_companion\_exists) ||($plugin\_pro\_exists && !$plugin\_pro\_installed) || (!$plugin\_pro\_exists && $plugin\_companion\_exists && !$plugin\_companion\_installed)) ) {
if ($plugin\_pro\_exists) {
// 'th-shop-mania-pro' is installed
if ($plugin\_pro\_installed) {
// Plugin is activated
echo '
## '.sprintf( esc\_html\_\_( 'Thank you for installing %1$s - Version %2$s', 'th-shop-mania' ), apply\_filters( 'thsm\_page\_title', \_\_( 'Th Shop Mania', 'th-shop-mania' ) ), esc\_html( $theme\_data->Version ) ).'

' . esc\_html\_\_('To take full advantage of all the features this theme has to offer, please install and activate the ', 'th-shop-mania') . '**Hunk Companion**

' . esc\_html\_\_('Go to Ready To Import website Templates ', 'th-shop-mania') . '

![](' . esc_url(get_template_directory_uri() . '/lib/notification/banner.png') . ')

';
} else {
// Plugin is installed but not activated
echo '
## '.sprintf( esc\_html\_\_( 'Thank you for installing %1$s - Version %2$s', 'th-shop-mania' ), apply\_filters( 'thsm\_page\_title', \_\_( 'Th Shop Mania', 'th-shop-mania' ) ), esc\_html( $theme\_data->Version ) ).'

' . esc\_html\_\_('To take full advantage of all the features this theme has to offer, please install and activate the ', 'th-shop-mania') . '**TH Shop Mania Pro**

' . esc\_html\_\_('Activate', 'th-shop-mania') . '
' . esc\_html\_\_('Go to Ready To Import website Templates ', 'th-shop-mania') . '

![](' . esc_url(get_template_directory_uri() . '/lib/notification/banner.png') . ')

';
}
} else {
// 'th-shop-mania-pro' is not installed, check 'hunk-companion'
$plugin\_companion\_installed = is\_plugin\_active($plugin\_companion\_file);
$plugin\_companion\_exists = file\_exists(WP\_PLUGIN\_DIR . '/' . $plugin\_companion\_file);
echo '
## '.sprintf( esc\_html\_\_( 'Thank you for installing %1$s - Version %2$s', 'th-shop-mania' ), apply\_filters( 'thsm\_page\_title', \_\_( 'Th Shop Mania', 'th-shop-mania' ) ), esc\_html( $theme\_data->Version ) ).'

' . esc\_html\_\_('To take full advantage of all the features this theme has to offer, please install and activate the ', 'th-shop-mania') . '**Hunk Companion**

';
if ($plugin\_companion\_exists) {
if ($plugin\_companion\_installed) {
echo '' . esc\_html\_\_('Go to Ready To Import website Templates ', 'th-shop-mania') . '';
} else {
echo '' . esc\_html\_\_('Activate', 'th-shop-mania') . ' ' . esc\_html\_\_('Go to Ready To Import website Templates ', 'th-shop-mania') . '';
}
} else {
echo '' . esc\_html\_\_('Install', 'th-shop-mania') . '' . esc\_html\_\_('Go to Ready To Import website Templates ', 'th-shop-mania') . '';
}
echo '
![](' . esc_url(get_template_directory_uri() . '/lib/notification/banner.png') . ')

';
}
}
}
// Custom function to check if a plugin is installed
function th\_shop\_mania\_is\_plugin\_installed($plugin\_slug) {
$plugin\_dir = WP\_PLUGIN\_DIR . '/' . $plugin\_slug;
return is\_dir($plugin\_dir);
}
function th\_shop\_mania\_install\_custom\_plugin($plugin\_slug) {
require\_once ABSPATH . 'wp-admin/includes/plugin-install.php';
require\_once ABSPATH . 'wp-admin/includes/class-wp-upgrader.php';
$plugin\_info = plugins\_api('plugin\_information', array('slug' => $plugin\_slug));
if (is\_wp\_error($plugin\_info)) {
return $plugin\_info->get\_error\_message();
}
$upgrader = new Plugin\_Upgrader(new Plugin\_Installer\_Skin(array(
'api' => $plugin\_info,
)));
$result = $upgrader->install($plugin\_info->download\_link);
if (is\_wp\_error($result)) {
return $result->get\_error\_message();
}
return "success";
}
// AJAX handler for installing and activating plugins
add\_action('wp\_ajax\_th\_shop\_mania\_install\_and\_activate\_callback', 'th\_shop\_mania\_install\_and\_activate\_callback');
// Callback function to install and activate plugin
function th\_shop\_mania\_install\_and\_activate\_callback() {
// Check nonce for security
check\_ajax\_referer('thactivatenonce', 'security');
// Retrieve plugin slug from AJAX request
$plugin\_slug = isset($\_POST['plugin\_slug']) ? sanitize\_text\_field($\_POST['plugin\_slug']) : '';
if (empty($plugin\_slug)) {
wp\_send\_json\_error(array('message' => 'Plugin slug is missing.'));
return;
}
$plugin\_file = WP\_PLUGIN\_DIR . '/' . $plugin\_slug . '/' . $plugin\_slug . '.php';
// Install the plugin
if (!file\_exists($plugin\_file)) {
// Start output buffering to capture the plugin installation output
ob\_start();
$status = th\_shop\_mania\_install\_custom\_plugin($plugin\_slug);
// Get the buffered content
$install\_output = ob\_get\_clean();
if (is\_wp\_error($status)) {
wp\_send\_json\_error(array('message' => $status->get\_error\_message(), 'install\_output' => $install\_output));
return;
}
// Check if the plugin file exists after installation
if (!file\_exists($plugin\_file)) {
wp\_send\_json\_error(array('message' => 'Plugin file does not exist after installation.', 'install\_output' => $install\_output));
return;
}
}
// Activate the plugin
if (!is\_plugin\_active($plugin\_file)) {
$status = activate\_plugin($plugin\_file);
if (is\_wp\_error($status)) {
wp\_send\_json\_error(array('message' => $status->get\_error\_message()));
return;
}
}
return 'Plugin installed and activated successfully.';
}
function th\_shop\_mania\_admin\_script($hook\_suffix) {
// Define the pages where the script should be enqueued
$allowed\_pages = array(
'index.php',
'themes.php',
'plugins.php',
'users.php',
'appearance\_page\_th\_shop\_mania\_thunk\_started'
);
// Check if the current page is one of the allowed pages
if (!in\_array($hook\_suffix, $allowed\_pages)) {
return;
}
// Enqueue styles and scripts only on the allowed pages
wp\_enqueue\_style('th-shop-mania-admin-css', get\_template\_directory\_uri() . '/lib/notification/css/admin.css', array(), TH\_SHOP\_MANIA\_THEME\_VERSION, 'all');
wp\_enqueue\_script('th-shop-mania-notifyjs', get\_template\_directory\_uri() . '/lib/notification/js/notify.js', array('jquery'), TH\_SHOP\_MANIA\_THEME\_VERSION, true);
// Pass AJAX URL to the script
wp\_localize\_script('th-shop-mania-notifyjs', 'theme\_data', array(
'ajax\_url' => admin\_url('admin-ajax.php'),
'security' => wp\_create\_nonce('thactivatenonce'), // Create nonce for security
'redirectUrl' => esc\_url(admin\_url('themes.php?page=themehunk-site-library&template=step')) // Generate dynamic URL
));
}
add\_action('admin\_enqueue\_scripts', 'th\_shop\_mania\_admin\_script');
// Hook the function to clear the cookie when the theme is switched to
add\_action('after\_switch\_theme', 'th\_shop\_mania\_clear\_notice\_cookie');
?>


=== Content from themes.trac.wordpress.org_0b812da2_20250114_192544.html ===


[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Showcase](https://wordpress.org/showcase/)
* [Hosting](https://wordpress.org/hosting/)
* Extend
  + [Themes](https://wordpress.org/themes/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Blocks](https://wordpress.org/blocks/)
  + [Openverse ↗︎](https://openverse.org/)
* Learn
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* Community
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [Events](https://events.wordpress.org/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* About
  + [About WordPress](https://wordpress.org/about/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Make WordPress Themes](//make.wordpress.org/themes/)

* [Blog](//make.wordpress.org/themes/)
* [Trac (Theme Reviews)](//themes.trac.wordpress.org/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=https%3A%2F%2Fthemes.trac.wordpress.org%2Fbrowser%2Fth-shop-mania%2F1.4.9%2Flib%2Fnotification%2Fnotify.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)
* [Ticket Graph](/ticketgraph)

## Context Navigation

* [Blame](/browser/th-shop-mania/1.4.7/lib/notification/notify.php?annotate=blame "Annotate each line with the last changed revision (this can be time consuming...)")
* [Revision Log](/log/th-shop-mania/1.4.9/lib/notification/notify.php)

---

# [source:](/browser?order=name "Go to repository root") [th-shop-mania](/browser/th-shop-mania?order=name "View th-shop-mania")/[1.4.9](/browser/th-shop-mania/1.4.9?order=name "View 1.4.9")/[lib](/browser/th-shop-mania/1.4.9/lib?order=name "View lib")/[notification](/browser/th-shop-mania/1.4.9/lib/notification?order=name "View notification")/[notify.php](/browser/th-shop-mania/1.4.9/lib/notification/notify.php?order=name "View notify.php")

View diff against:

View revision:

| [Last change](/changeset/238381/th-shop-mania/1.4.7/lib/notification/notify.php "View differences") on this file was [238381](/changeset/238381/ "View changeset 238381"), checked in by themedropbox, [5 months ago](/timeline?from=2024-08-12T07%3A12%3A53Z&precision=second "See timeline at 08/12/2024 07:12:53 AM") |
| --- |
| New version of Th Shop Mania - 1.4.7 |
| * Property **svn:eol-style** set to   *`native`* | |
| **File size:** 13.2 KB | |

| Line |  |
| --- | --- |
| [1](#L1) | <?php |
| [2](#L2) | include\_once(ABSPATH . 'wp-admin/includes/plugin.php'); |
| [3](#L3) |  |
| [4](#L4) | function th\_shop\_mania\_set\_cookie() { |
| [5](#L5) | $expire\_time = time() + (86400 \* 7); // 7 days in seconds |
| [6](#L6) |  |
| [7](#L7) | if (!isset($\_COOKIE['th\_shop\_mania\_thms\_time'])) { |
| [8](#L8) | // Set a cookie for 7 days |
| [9](#L9) | setcookie('th\_shop\_mania\_thms\_time', $expire\_time, $expire\_time, COOKIEPATH, COOKIE\_DOMAIN); |
| [10](#L10) | } |
| [11](#L11) |  |
| [12](#L12) | } |
| [13](#L13) | function th\_shop\_mania\_unset\_cookie(){ |
| [14](#L14) |  |
| [15](#L15) | $visit\_time = time(); |
| [16](#L16) | if (isset($\_COOKIE['th\_shop\_mania\_thms\_time']) && $\_COOKIE['th\_shop\_mania\_thms\_time'] < $visit\_time) { |
| [17](#L17) | setcookie('th\_shop\_mania\_thms\_time', '', time() - 3600, COOKIEPATH, COOKIE\_DOMAIN); |
| [18](#L18) | } |
| [19](#L19) | } |
| [20](#L20) |  |
| [21](#L21) | function th\_shop\_mania\_clear\_notice\_cookie() { |
| [22](#L22) | // Clear the cookie when the theme is switched |
| [23](#L23) | if (isset($\_COOKIE['th\_shop\_mania\_thms\_time'])) { |
| [24](#L24) | setcookie('th\_shop\_mania\_thms\_time', '', time() - 3600, COOKIEPATH, COOKIE\_DOMAIN); |
| [25](#L25) | } |
| [26](#L26) | } |
| [27](#L27) |  |
| [28](#L28) | if(isset($\_GET['notice-disable']) && $\_GET['notice-disable'] == true){ |
| [29](#L29) | add\_action('admin\_init', 'th\_shop\_mania\_set\_cookie'); |
| [30](#L30) | } |
| [31](#L31) |  |
| [32](#L32) |  |
| [33](#L33) | if(!isset($\_COOKIE['th\_shop\_mania\_thms\_time'])) { |
| [34](#L34) | add\_action('admin\_notices', 'th\_shop\_mania\_display\_admin\_notice'); |
| [35](#L35) |  |
| [36](#L36) | } |
| [37](#L37) |  |
| [38](#L38) | if(isset($\_COOKIE['th\_shop\_mania\_thms\_time'])) { |
| [39](#L39) | add\_action( 'admin\_notices', 'th\_shop\_mania\_unset\_cookie'); |
| [40](#L40) | } |
| [41](#L41) |  |
| [42](#L42) | // add\_action('admin\_notices', 'th\_shop\_mania\_display\_admin\_notice'); |
| [43](#L43) |  |
| [44](#L44) | // Display admin notice |
| [45](#L45) | function th\_shop\_mania\_display\_admin\_notice() { |
| [46](#L46) |  |
| [47](#L47) | $allowed\_pages = array( |
| [48](#L48) | 'dashboard',             // index.php |
| [49](#L49) | 'themes',                // themes.php |
| [50](#L50) | 'plugins',               // plugins.php |
| [51](#L51) | 'users', |
| [52](#L52) | 'appearance\_page\_th\_shop\_mania\_thunk\_started' // appearance\_page\_thunk\_started |
| [53](#L53) | ); |
| [54](#L54) |  |
| [55](#L55) | // Get the current screen |
| [56](#L56) | $current\_screen = get\_current\_screen(); |
| [57](#L57) |  |
| [58](#L58) | // Check if the current screen is one of the allowed pages |
| [59](#L59) | if (!in\_array($current\_screen->base, $allowed\_pages)) { |
| [60](#L60) | return; // Exit if not on an allowed page |
| [61](#L61) | } |
| [62](#L62) |  |
| [63](#L63) | global $current\_user; |
| [64](#L64) | $user\_id   = $current\_user->ID; |
| [65](#L65) | $theme\_data  = wp\_get\_theme(); |
| [66](#L66) |  |
| [67](#L67) | if ( get\_user\_meta( $user\_id, esc\_html( $theme\_data->get( 'TextDomain' ) ) . '\_notice\_ignore' ) ) { |
| [68](#L68) | return; |
| [69](#L69) | } |
| [70](#L70) |  |
| [71](#L71) | // Retrieve the theme support data |
| [72](#L72) | $plugin\_data = get\_theme\_support('recommend-plugins'); |
| [73](#L73) |  |
| [74](#L74) | // Check if the theme support exists and has the plugin data |
| [75](#L75) |  |
| [76](#L76) | $plugin\_data = $plugin\_data[0]; |
| [77](#L77) |  |
| [78](#L78) | // Get the specific plugin data |
| [79](#L79) | $hunk\_companion = isset($plugin\_data['hunk-companion']) ? $plugin\_data['hunk-companion'] : array(); |
| [80](#L80) | $th\_shop\_mania\_pro = isset($hunk\_companion['pro-plugin']) ? $hunk\_companion['pro-plugin'] : array(); |
| [81](#L81) |  |
| [82](#L82) | // Extract the values |
| [83](#L83) | $plugin\_pro\_slug = isset($th\_shop\_mania\_pro['slug']) ? $th\_shop\_mania\_pro['slug'] : ''; |
| [84](#L84) | $plugin\_pro\_file = isset($th\_shop\_mania\_pro['init']) ? $th\_shop\_mania\_pro['init'] : ''; |
| [85](#L85) | $plugin\_companion\_slug = isset($plugin\_data['hunk-companion']['slug']) ? $plugin\_data['hunk-companion']['slug'] : 'hunk-companion'; |
| [86](#L86) | $plugin\_companion\_file = isset($plugin\_data['hunk-companion']['active\_filename']) ? $plugin\_data['hunk-companion']['active\_filename'] : ''; |
| [87](#L87) |  |
| [88](#L88) |  |
| [89](#L89) | // Show admin notice to install or activate the secondary plugin |
| [90](#L90) | $plugin\_pro\_installed = is\_plugin\_active($plugin\_pro\_file); |
| [91](#L91) | $plugin\_pro\_exists = file\_exists(WP\_PLUGIN\_DIR . '/' . $plugin\_pro\_file); |
| [92](#L92) | $plugin\_companion\_installed = is\_plugin\_active($plugin\_companion\_file); |
| [93](#L93) | $plugin\_companion\_exists = file\_exists(WP\_PLUGIN\_DIR . '/' . $plugin\_companion\_file); |
| [94](#L94) |  |
| [95](#L95) | // Check if 'th-shop-mania-pro' is installed |
| [96](#L96) | $plugin\_pro\_installed = is\_plugin\_active($plugin\_pro\_file); |
| [97](#L97) | $plugin\_pro\_exists = file\_exists(WP\_PLUGIN\_DIR . '/' . $plugin\_pro\_file); |
| [98](#L98) |  |
| [99](#L99) | if ((isset($\_GET['page']) && $\_GET['page'] == 'th\_shop\_mania\_thunk\_started' ) || ((!$plugin\_pro\_exists && !$plugin\_companion\_exists) ||($plugin\_pro\_exists && !$plugin\_pro\_installed) || (!$plugin\_pro\_exists && $plugin\_companion\_exists && !$plugin\_companion\_installed)) ) { |
| [100](#L100) |  |
| [101](#L101) |  |
| [102](#L102) | if ($plugin\_pro\_exists) { |
| [103](#L103) | // 'th-shop-mania-pro' is installed |
| [104](#L104) | if ($plugin\_pro\_installed) { |
| [105](#L105) | // Plugin is activated |
| [106](#L106) | echo '<div class="notice notice-info th-shop-mania-wrapper-banner is-dismissible"> |
| [107](#L107) | <div class="left"><h2 class="title"> |
| [108](#L108) | '.sprintf( esc\_html\_\_( 'Thank you for installing %1$s - Version %2$s', 'th-shop-mania' ), apply\_filters( 'thsm\_page\_title', \_\_( 'Th Shop Mania', 'th-shop-mania' ) ), esc\_html( $theme\_data->Version ) ).'</h2> |
| [109](#L109) | <p>' . esc\_html\_\_('To take full advantage of all the features this theme has to offer, please install and activate the ', 'th-shop-mania') . '<strong>Hunk Companion</strong></p> |
| [110](#L110) | <button class="button button-primary" id="go-to-starter-sites" data-slug="' . esc\_attr($plugin\_pro\_slug) . '">' . esc\_html\_\_('Go to Ready To Import website Templates ', 'th-shop-mania') . '</button> |
| [111](#L111) | </div> |
| [112](#L112) | <div class="right"> |
| [113](#L113) | <img src="' . esc\_url(get\_template\_directory\_uri() . '/lib/notification/banner.png') . '" /> |
| [114](#L114) | </div> |
| [115](#L115) | <a href="?notice-disable=1" class="notice-dismiss dashicons dashicons-dismiss dashicons-dismiss-icon"></a> |
| [116](#L116) | </div>'; |
| [117](#L117) | } else { |
| [118](#L118) | // Plugin is installed but not activated |
| [119](#L119) | echo '<div class="notice notice-info th-shop-mania-wrapper-banner is-dismissible"> |
| [120](#L120) | <div class="left"> |
| [121](#L121) | <h2 class="title"> |
| [122](#L122) | '.sprintf( esc\_html\_\_( 'Thank you for installing %1$s - Version %2$s', 'th-shop-mania' ), apply\_filters( 'thsm\_page\_title', \_\_( 'Th Shop Mania', 'th-shop-mania' ) ), esc\_html( $theme\_data->Version ) ).'</h2> |
| [123](#L123) | <p>' . esc\_html\_\_('To take full advantage of all the features this theme has to offer, please install and activate the ', 'th-shop-mania') . '<strong>TH Shop Mania Pro</strong></p> |
| [124](#L124) | <button class="button button-primary" id="activate-th-shop-mania-pro" data-slug="' . esc\_attr($plugin\_pro\_slug) . '"><span>' . esc\_html\_\_('Activate', 'th-shop-mania') . '</span><span class="dashicons dashicons-update loader"></span></button> |
| [125](#L125) | <button class="button button-primary" id="go-to-starter-sites" data-slug="' . esc\_attr($plugin\_pro\_slug) . '" disabled>' . esc\_html\_\_('Go to Ready To Import website Templates ', 'th-shop-mania') . '</button> |
| [126](#L126) | </div> |
| [127](#L127) | <div class="right"> |
| [128](#L128) | <img src="' . esc\_url(get\_template\_directory\_uri() . '/lib/notification/banner.png') . '" /> |
| [129](#L129) | </div> |
| [130](#L130) | <a href="?notice-disable=1" class="notice-dismiss dashicons dashicons-dismiss dashicons-dismiss-icon"></a> |
| [131](#L131) | </div>'; |
| [132](#L132) | } |
| [133](#L133) | } else { |
| [134](#L134) | // 'th-shop-mania-pro' is not installed, check 'hunk-companion' |
| [135](#L135) | $plugin\_companion\_installed = is\_plugin\_active($plugin\_companion\_file); |
| [136](#L136) | $plugin\_companion\_exists = file\_exists(WP\_PLUGIN\_DIR . '/' . $plugin\_companion\_file); |
| [137](#L137) |  |
| [138](#L138) | echo '<div class="notice notice-info th-shop-mania-wrapper-banner is-dismissible"> |
| [139](#L139) | <div class="left"> |
| [140](#L140) | <h2 class="title"> |
| [141](#L141) | '.sprintf( esc\_html\_\_( 'Thank you for installing %1$s - Version %2$s', 'th-shop-mania' ), apply\_filters( 'thsm\_page\_title', \_\_( 'Th Shop Mania', 'th-shop-mania' ) ), esc\_html( $theme\_data->Version ) ).'</h2> |
| [142](#L142) | <p>' . esc\_html\_\_('To take full advantage of all the features this theme has to offer, please install and activate the ', 'th-shop-mania') . '<strong>Hunk Companion</strong></p>'; |
| [143](#L143) |  |
| [144](#L144) | if ($plugin\_companion\_exists) { |
| [145](#L145) | if ($plugin\_companion\_installed) { |
| [146](#L146) | echo '<button class="button button-primary" id="go-to-starter-sites" data-slug="' . esc\_attr($plugin\_pro\_slug) . '">' . esc\_html\_\_('Go to Ready To Import website Templates ', 'th-shop-mania') . '<span class="dashicons dashicons-update loader"></span></button>'; |
| [147](#L147) | } else { |
| [148](#L148) | echo '<button class="button button-primary" id="activate-hunk-companion" data-slug="' . esc\_attr($plugin\_companion\_slug) . '"><span>' . esc\_html\_\_('Activate', 'th-shop-mania') . '</span><span class="dashicons dashicons-update loader"></span></button> <button class="button button-primary" id="go-to-starter-sites" data-slug="' . esc\_attr($plugin\_pro\_slug) . '" disabled>' . esc\_html\_\_('Go to Ready To Import website Templates ', 'th-shop-mania') . '</button>'; |
| [149](#L149) | } |
| [150](#L150) | } else { |
| [151](#L151) | echo '<button class="button button-primary" id="install-hunk-companion" data-slug="' . esc\_attr($plugin\_companion\_slug) . '"><span>' . esc\_html\_\_('Install', 'th-shop-mania') . '</span><span class="dashicons dashicons-update loader"></span></button><button class="button button-primary" id="go-to-starter-sites" data-slug="' . esc\_attr($plugin\_pro\_slug) . '"disabled >' . esc\_html\_\_('Go to Ready To Import website Templates ', 'th-shop-mania') . '</button>'; |
| [152](#L152) | } |
| [153](#L153) |  |
| [154](#L154) | echo '</div> |
| [155](#L155) | <div class="right"> |
| [156](#L156) | <img src="' . esc\_url(get\_template\_directory\_uri() . '/lib/notification/banner.png') . '" /> |
| [157](#L157) | </div> |
| [158](#L158) | <a href="?notice-disable=1" class="notice-dismiss dashicons dashicons-dismiss dashicons-dismiss-icon"></a> |
| [159](#L159) | </div>'; |
| [160](#L160) | } |
| [161](#L161) | } |
| [162](#L162) | } |
| [163](#L163) |  |
| [164](#L164) | // Custom function to check if a plugin is installed |
| [165](#L165) | function th\_shop\_mania\_is\_plugin\_installed($plugin\_slug) { |
| [166](#L166) | $plugin\_dir = WP\_PLUGIN\_DIR . '/' . $plugin\_slug; |
| [167](#L167) | return is\_dir($plugin\_dir); |
| [168](#L168) | } |
| [169](#L169) |  |
| [170](#L170) | function th\_shop\_mania\_install\_custom\_plugin($plugin\_slug) { |
| [171](#L171) | require\_once ABSPATH . 'wp-admin/includes/plugin-install.php'; |
| [172](#L172) | require\_once ABSPATH . 'wp-admin/includes/class-wp-upgrader.php'; |
| [173](#L173) |  |
| [174](#L174) | $plugin\_info = plugins\_api('plugin\_information', array('slug' => $plugin\_slug)); |
| [175](#L175) |  |
| [176](#L176) | if (is\_wp\_error($plugin\_info)) { |
| [177](#L177) | return $plugin\_info->get\_error\_message(); |
| [178](#L178) | } |
| [179](#L179) |  |
| [180](#L180) | $upgrader = new Plugin\_Upgrader(new Plugin\_Installer\_Skin(array( |
| [181](#L181) | 'api' => $plugin\_info, |
| [182](#L182) | ))); |
| [183](#L183) |  |
| [184](#L184) | $result = $upgrader->install($plugin\_info->download\_link); |
| [185](#L185) |  |
| [186](#L186) | if (is\_wp\_error($result)) { |
| [187](#L187) | return $result->get\_error\_message(); |
| [188](#L188) | } |
| [189](#L189) |  |
| [190](#L190) | return "success"; |
| [191](#L191) | } |
| [192](#L192) |  |
| [193](#L193) | // AJAX handler for installing and activating plugins |
| [194](#L194) | add\_action('wp\_ajax\_th\_shop\_mania\_install\_and\_activate\_callback', 'th\_shop\_mania\_install\_and\_activate\_callback'); |
| [195](#L195) |  |
| [196](#L196) | // Callback function to install and activate plugin |
| [197](#L197) | function th\_shop\_mania\_install\_and\_activate\_callback() { |
| [198](#L198) | // Check nonce for security |
| [199](#L199) | check\_ajax\_referer('thactivatenonce', 'security'); |
| [200](#L200) |  |
| [201](#L201) | // Retrieve plugin slug from AJAX request |
| [202](#L202) | $plugin\_slug = isset($\_POST['plugin\_slug']) ? sanitize\_text\_field($\_POST['plugin\_slug']) : ''; |
| [203](#L203) |  |
| [204](#L204) | if (empty($plugin\_slug)) { |
| [205](#L205) | wp\_send\_json\_error(array('message' => 'Plugin slug is missing.')); |
| [206](#L206) | return; |
| [207](#L207) | } |
| [208](#L208) |  |
| [209](#L209) | $plugin\_file = WP\_PLUGIN\_DIR . '/' . $plugin\_slug . '/' . $plugin\_slug . '.php'; |
| [210](#L210) |  |
| [211](#L211) | // Install the plugin |
| [212](#L212) | if (!file\_exists($plugin\_file)) { |
| [213](#L213) | // Start output buffering to capture the plugin installation output |
| [214](#L214) | ob\_start(); |
| [215](#L215) |  |
| [216](#L216) | $status = th\_shop\_mania\_install\_custom\_plugin($plugin\_slug); |
| [217](#L217) |  |
| [218](#L218) | // Get the buffered content |
| [219](#L219) | $install\_output = ob\_get\_clean(); |
| [220](#L220) |  |
| [221](#L221) | if (is\_wp\_error($status)) { |
| [222](#L222) | wp\_send\_json\_error(array('message' => $status->get\_error\_message(), 'install\_output' => $install\_output)); |
| [223](#L223) | return; |
| [224](#L224) | } |
| [225](#L225) |  |
| [226](#L226) | // Check if the plugin file exists after installation |
| [227](#L227) | if (!file\_exists($plugin\_file)) { |
| [228](#L228) | wp\_send\_json\_error(array('message' => 'Plugin file does not exist after installation.', 'install\_output' => $install\_output)); |
| [229](#L229) | return; |
| [230](#L230) | } |
| [231](#L231) | } |
| [232](#L232) |  |
| [233](#L233) | // Activate the plugin |
| [234](#L234) | if (!is\_plugin\_active($plugin\_file)) { |
| [235](#L235) | $status = activate\_plugin($plugin\_file); |
| [236](#L236) | if (is\_wp\_error($status)) { |
| [237](#L237) | wp\_send\_json\_error(array('message' => $status->get\_error\_message())); |
| [238](#L238) | return; |
| [239](#L239) | } |
| [240](#L240) |  |
| [241](#L241) | } |
| [242](#L242) | return 'Plugin installed and activated successfully.'; |
| [243](#L243) |  |
| [244](#L244) | } |
| [245](#L245) |  |
| [246](#L246) |  |
| [247](#L247) | function th\_shop\_mania\_admin\_script($hook\_suffix) { |
| [248](#L248) | // Define the pages where the script should be enqueued |
| [249](#L249) | $allowed\_pages = array( |
| [250](#L250) | 'index.php', |
| [251](#L251) | 'themes.php', |
| [252](#L252) | 'plugins.php', |
| [253](#L253) | 'users.php', |
| [254](#L254) | 'appearance\_page\_th\_shop\_mania\_thunk\_started' |
| [255](#L255) | ); |
| [256](#L256) |  |
| [257](#L257) | // Check if the current page is one of the allowed pages |
| [258](#L258) | if (!in\_array($hook\_suffix, $allowed\_pages)) { |
| [259](#L259) | return; |
| [260](#L260) | } |
| [261](#L261) |  |
| [262](#L262) | // Enqueue styles and scripts only on the allowed pages |
| [263](#L263) | wp\_enqueue\_style('th-shop-mania-admin-css', get\_template\_directory\_uri() . '/lib/notification/css/admin.css', array(), TH\_SHOP\_MANIA\_THEME\_VERSION, 'all'); |
| [264](#L264) | wp\_enqueue\_script('th-shop-mania-notifyjs', get\_template\_directory\_uri() . '/lib/notification/js/notify.js', array('jquery'), TH\_SHOP\_MANIA\_THEME\_VERSION, true); |
| [265](#L265) |  |
| [266](#L266) | // Pass AJAX URL to the script |
| [267](#L267) | wp\_localize\_script('th-shop-mania-notifyjs', 'theme\_data', array( |
| [268](#L268) | 'ajax\_url' => admin\_url('admin-ajax.php'), |
| [269](#L269) | 'security' => wp\_create\_nonce('thactivatenonce'), // Create nonce for security |
| [270](#L270) | 'redirectUrl' => esc\_url(admin\_url('themes.php?page=themehunk-site-library&template=step')) // Generate dynamic URL |
| [271](#L271) | )); |
| [272](#L272) | } |
| [273](#L273) | add\_action('admin\_enqueue\_scripts', 'th\_shop\_mania\_admin\_script'); |
| [274](#L274) |  |
| [275](#L275) | // Hook the function to clear the cookie when the theme is switched to |
| [276](#L276) | add\_action('after\_switch\_theme', 'th\_shop\_mania\_clear\_notice\_cookie'); |
| [277](#L277) |  |
| [278](#L278) | ?> |

**Note:** See [TracBrowser](/wiki/TracBrowser)
for help on using the repository browser.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Plain Text](/browser/th-shop-mania/1.4.9/lib/notification/notify.php?format=txt)
* [Original Format](/export/256021/th-shop-mania/1.4.9/lib/notification/notify.php)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Privacy](https://wordpress.org/about/privacy/)

* [Showcase](https://wordpress.org/showcase/)
* [Themes](https://wordpress.org/themes/)
* [Plugins](https://wordpress.org/plugins/)
* [Patterns](https://wordpress.org/patterns/)

* [Learn](https://learn.wordpress.org/)
* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [WordPress.tv ↗](https://wordpress.tv/)

* [Get Involved](https://make.wordpress.org/)
* [Events](https://events.wordpress.org/)
* [Donate ↗](https://wordpressfoundation.org/donate/)
* [Five for the Future](https://wordpress.org/five-for-the-future/)

* [WordPress.com ↗](https://wordpress.com/?ref=wporg-footer)
* [Matt ↗](https://ma.tt/)
* [bbPress ↗](https://bbpress.org/)
* [BuddyPress ↗](https://buddypress.org/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our X (formerly Twitter) account](https://www.x.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)
* [Visit our YouTube channel](https://www.youtube.com/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from www.wordfence.com_fe8f4c11_20250114_192545.html ===


[![](https://www.wordfence.com/img/wordfence-intelligence-logo.svg)](/threat-intel/)

Have you found a vulnerability in a WordPress plugin or theme? Report vulnerabilities in WordPress plugins and themes through our [bug bounty program](https://www.wordfence.com/threat-intel/bug-bounty-program) and earn a bounty on all in-scope submissions, while we handle the responsible disclosure process on your behalf.

As a reminder, the Wordfence Intelligence Vulnerability Database API is completely free to query and utilize, both personally and commercially, and contains all the same vulnerability data as the user interface. Please review the API documentation and Webhook documentation for more information on how to query the vulnerability API endpoints and configure webhooks utilizing all the same data present in the Wordfence Intelligence user interface.

# Th Shop Mania <= 1.4.9 - Authenticated (Subscriber+) Arbitrary Plugin Installation/Activation

 [Wordfence Intelligence](https://www.wordfence.com/threat-intel)   >    [Vulnerability Database](https://www.wordfence.com/threat-intel/vulnerabilities)   >   Th Shop Mania <= 1.4.9 - Authenticated (Subscriber+) Arbitrary Plugin Installation/Activation

8.8

**Missing Authorization**
**CVSS Vector**
[CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H)

| CVE | [CVE-2024-10674](https://www.cve.org/CVERecord?id=CVE-2024-10674) |
| --- | --- |
| CVSS | 8.8 (High) |
| Publicly Published | November 8, 2024 |
| Last Updated | November 9, 2024 |
| Researchers | [Sean Murphy](https://www.wordfence.com/threat-intel/vulnerabilities/researchers/sean-murphy)  [Kevin Murphy (knmurphy)](https://www.wordfence.com/threat-intel/vulnerabilities/researchers/kevin-murphy-knmurphy) |

### Description

The Th Shop Mania theme for WordPress is vulnerable to unauthorized arbitrary plugin installation due to a missing capability check on the th\_shop\_mania\_install\_and\_activate\_callback() function in all versions up to, and including, 1.4.9. This makes it possible for authenticated attackers, with Subscriber-level access and above, to install arbitrary plugins which can be leveraged to exploit other vulnerabilities and achieve remote code execution and privilege escalation.

#### References

* [themes.svn.wordpress.org](https://themes.svn.wordpress.org/th-shop-mania/1.4.9/lib/notification/notify.php)
* [themes.trac.wordpress.org](https://themes.trac.wordpress.org/browser/th-shop-mania/1.4.9/lib/notification/notify.php)
* [themes.trac.wordpress.org](https://themes.trac.wordpress.org/changeset?sfp_email=&sfph_mail=&reponame=&old=247810%40th-shop-mania&new=247810%40th-shop-mania&sfp_email=&sfph_mail=)

#### Share

[Facebook](https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-themes%2Fth-shop-mania%2Fth-shop-mania-149-authenticated-subscriber-arbitrary-plugin-installationactivation&t=Th%20Shop%20Mania%20%3C%3D%201.4.9%20-%20Authenticated%20%28Subscriber%2B%29%20Arbitrary%20Plugin%20Installation%2FActivation "Facebook")
[Twitter](https://twitter.com/share?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-themes%2Fth-shop-mania%2Fth-shop-mania-149-authenticated-subscriber-arbitrary-plugin-installationactivation&text=Th%20Shop%20Mania%20%3C%3D%201.4.9%20-%20Authenticated%20%28Subscriber%2B%29%20Arbitrary%20Plugin%20Installation%2FActivation "Twitter")
[LinkedIn](https://www.linkedin.com/shareArticle?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-themes%2Fth-shop-mania%2Fth-shop-mania-149-authenticated-subscriber-arbitrary-plugin-installationactivation "LinkedIn")
Email

## Vulnerability Details for Th Shop Mania

#### [Th Shop Mania](https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-themes/th-shop-mania)

| Software Type | Theme |
| --- | --- |
| Software Slug | th-shop-mania [(view on wordpress.org)](https://wordpress.org/themes/th-shop-mania) |
| Patched? | Yes |
| Remediation | Update to version 1.5.0, or a newer patched version |
| Affected Version | * <= 1.4.9 |
| Patched Version | * 1.5.0 |

This record contains material that is subject to copyright.

**Copyright 2012-2025 Defiant Inc.**

**License:**
Defiant hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute this software vulnerability information. Any copy of the software vulnerability information you make for such purposes is authorized provided that you include a hyperlink to this vulnerability record and reproduce Defiant's copyright designation and this license in any such copy.
**[Read more.](https://www.wordfence.com/wordfence-intelligence-terms-and-conditions/)**

**Copyright 1999-2025 The MITRE Corporation**

**License:**
CVE Usage: MITRE hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute Common Vulnerabilities and Exposures (CVE®). Any copy you make for such purposes is authorized provided that you reproduce MITRE's copyright designation and this license in any such copy.
**[Read more.](https://www.cve.org/Legal/TermsOfUse)**

Have information to add, or spot any errors? Contact us at wfi-support@wordfence.com so we can make any appropriate adjustments.

Did you know Wordfence Intelligence provides free personal and commercial API access to our comprehensive WordPress vulnerability database, along with a free webhook integration to stay on top of the latest vulnerabilities added and updated in the database? Get started today!

Learn more

Want to get notified of the latest vulnerabilities that may affect your WordPress site?
 Install Wordfence on your site today to get notified immediately if your site is affected by a vulnerability that has been added to our database.

Get Wordfence

The Wordfence Intelligence WordPress vulnerability database is completely free to access and query via API. Please review the documentation on how to access and consume the vulnerability data via API.

Documentation


