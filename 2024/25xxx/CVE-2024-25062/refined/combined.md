=== Content from gitlab.gnome.org_25796842_20250114_203128.html ===


[Skip to content](#content-body)
GitLab
[![](data:image/gif;base64...)](/ "Homepage")

* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)

# [CVE-2024-25062] Use-after-free in xmlValidatePopElement() using XMLReader API

I wrote a really dumb fuzzer that tries to call some of the XMLReader API randomly, and found a use-after-free crash while running the fuzzer.

To create a stand-alone reproducer, I also made it possible for the fuzzer to write out C code for all the XMLReader API calls it would make for the given input, before actually trying to reproduce the crash.

So the attached [schema.c](/-/project/1665/uploads/bad1c33f100c76766acad0211986c672/schema.c) can be copied over `fuzz/schema.c` in the libxml2 repository, and then build the schema fuzzer to create the test case. I've also attached [repro.bin](/-/project/1665/uploads/800c9b75a9aa9bac161efe0c61fe0e96/repro.bin) as the input file to reproduce it.

Here's the `configure` invocation as written to `config.log`:

```
$ ./configure --prefix=/usr --without-iconv --with-icu --without-lzma --without-python --with-xptr-locs --with-zlib 'CC=xcrun -sdk macosx cc -fsanitize=address,fuzzer -fsanitize-coverage=inline-8bit-counters,trace-cmp -fno-sanitize-coverage=pc-table -g -fno-omit-frame-pointer -DFUZZING_BUILD_MODE_UNSAFE_FOR_PRODUCTION' --no-create --no-recursion
```

Here's the ASan stack traces:

```
=================================================================
==55584==ERROR: AddressSanitizer: heap-use-after-free on address 0x000108603b90 at pc 0x000105921fc4 bp 0x00016b19acb0 sp 0x00016b19aca8
READ of size 8 at 0x000108603b90 thread T0
    #0 0x105921fc0 in xmlValidatePopElement valid.c:5810
    #1 0x1059c4640 in xmlTextReaderValidatePop xmlreader.c:920
    #2 0x1059c1b98 in xmlTextReaderRead xmlreader.c:1319
    #3 0x104c6d064 in LLVMFuzzerTestOneInput schema.c:1486
    #4 0x104c87bd4 in fuzzer::Fuzzer::ExecuteCallback(unsigned char const*, unsigned long) FuzzerLoop.cpp:617
    #5 0x104c73a14 in fuzzer::RunOneTest(fuzzer::Fuzzer*, char const*, unsigned long) FuzzerDriver.cpp:324
    #6 0x104c78de8 in fuzzer::FuzzerDriver(int*, char***, int (*)(unsigned char const*, unsigned long)) FuzzerDriver.cpp:860
    #7 0x104ca5668 in main FuzzerMain.cpp:20
    #8 0x187941054  (<unknown module>)

0x000108603b90 is located 16 bytes inside of 120-byte region [0x000108603b80,0x000108603bf8)
freed by thread T0 here:
    #0 0x105f12fe4 in wrap_free+0x98 (libclang_rt.asan_osx_dynamic.dylib:arm64e+0x52fe4)
    #1 0x1059c2600 in xmlTextReaderRead xmlreader.c:1362
    #2 0x104c6cfb4 in LLVMFuzzerTestOneInput schema.c:1475
    #3 0x104c87bd4 in fuzzer::Fuzzer::ExecuteCallback(unsigned char const*, unsigned long) FuzzerLoop.cpp:617
    #4 0x104c73a14 in fuzzer::RunOneTest(fuzzer::Fuzzer*, char const*, unsigned long) FuzzerDriver.cpp:324
    #5 0x104c78de8 in fuzzer::FuzzerDriver(int*, char***, int (*)(unsigned char const*, unsigned long)) FuzzerDriver.cpp:860
    #6 0x104ca5668 in main FuzzerMain.cpp:20
    #7 0x187941054  (<unknown module>)

previously allocated by thread T0 here:
    #0 0x105f12ea8 in wrap_malloc+0x94 (libclang_rt.asan_osx_dynamic.dylib:arm64e+0x52ea8)
    #1 0x1058d42c4 in xmlNewDocNodeEatName tree.c:2317
    #2 0x1058bd784 in xmlSAX2StartElementNs SAX2.c
    #3 0x1059ca35c in xmlTextReaderStartElementNs xmlreader.c:627
    #4 0x10589ffa8 in xmlParseStartTag2 parser.c:10063
    #5 0x1058887d8 in xmlParseChunk parser.c:12207
    #6 0x1059c39e0 in xmlTextReaderPushData xmlreader.c:751
    #7 0x1059c0d94 in xmlTextReaderRead xmlreader.c:1183
    #8 0x104c67efc in LLVMFuzzerTestOneInput schema.c:36
    #9 0x104c87bd4 in fuzzer::Fuzzer::ExecuteCallback(unsigned char const*, unsigned long) FuzzerLoop.cpp:617
    #10 0x104c73a14 in fuzzer::RunOneTest(fuzzer::Fuzzer*, char const*, unsigned long) FuzzerDriver.cpp:324
    #11 0x104c78de8 in fuzzer::FuzzerDriver(int*, char***, int (*)(unsigned char const*, unsigned long)) FuzzerDriver.cpp:860
    #12 0x104ca5668 in main FuzzerMain.cpp:20
    #13 0x187941054  (<unknown module>)

SUMMARY: AddressSanitizer: heap-use-after-free valid.c:5810 in xmlValidatePopElement
Shadow bytes around the buggy address:
  0x000108603900: fa fa fa fa fa fa fa fa fd fd fd fd fd fd fd fd
  0x000108603980: fd fd fd fd fd fd fd fa fa fa fa fa fa fa fa fa
  0x000108603a00: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fa
  0x000108603a80: fa fa fa fa fa fa fa fa fd fd fd fd fd fd fd fd
  0x000108603b00: fd fd fd fd fd fd fd fa fa fa fa fa fa fa fa fa
=>0x000108603b80: fd fd[fd]fd fd fd fd fd fd fd fd fd fd fd fd fa
  0x000108603c00: fa fa fa fa fa fa fa fa 00 00 00 00 00 00 00 00
  0x000108603c80: 00 00 00 00 00 00 00 fa fa fa fa fa fa fa fa fa
  0x000108603d00: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 fa
  0x000108603d80: fa fa fa fa fa fa fa fa 00 00 00 00 00 00 00 00
  0x000108603e00: 00 00 00 00 00 00 00 fa fa fa fa fa fa fa fa fa
Shadow byte legend (one shadow byte represents 8 application bytes):
  Addressable:           00
  Partially addressable: 01 02 03 04 05 06 07
  Heap left redzone:       fa
  Freed heap region:       fd
  Stack left redzone:      f1
  Stack mid redzone:       f2
  Stack right redzone:     f3
  Stack after return:      f5
  Stack use after scope:   f8
  Global redzone:          f9
  Global init order:       f6
  Poisoned by user:        f7
  Container overflow:      fc
  Array cookie:            ac
  Intra object redzone:    bb
  ASan internal:           fe
  Left alloca redzone:     ca
  Right alloca redzone:    cb
==55584==ABORTING
Abort trap: 6
```

Assignee
Loading

Time tracking
Loading



=== Content from gitlab.gnome.org_599cf271_20250114_203129.html ===


[Skip to content](#content-body)
GitLab
[![](data:image/gif;base64...)](/ "Homepage")

* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)

# Tags

Tags give the ability to mark specific points in history as being important

* [v2.13.5](/GNOME/libxml2/-/tags/v2.13.5)
  protected
  [de918d45](/GNOME/libxml2/-/commit/de918d45e1b2276a28a4cd32bcf556bef65284e4)
  ·
  [Release v2.13.5](/GNOME/libxml2/-/commit/de918d45e1b2276a28a4cd32bcf556bef65284e4)

  ·
  Nov 12, 2024

  Release:
  [libxml 2.13.5](/GNOME/libxml2/-/releases/v2.13.5)
  ```
  Release v2.13.5
  ```
* [v2.13.4](/GNOME/libxml2/-/tags/v2.13.4)
  protected
  [60d3056c](/GNOME/libxml2/-/commit/60d3056c97067e6cb2125284878ed7c99c90ed81)
  ·
  [Release v2.13.4](/GNOME/libxml2/-/commit/60d3056c97067e6cb2125284878ed7c99c90ed81)

  ·
  Sep 18, 2024

  Release:
  [libxml2 2.13.4](/GNOME/libxml2/-/releases/v2.13.4)
  ```
  Release v2.13.4
  ```
* [v2.11.9](/GNOME/libxml2/-/tags/v2.11.9)
  protected
  [954e851e](/GNOME/libxml2/-/commit/954e851e1d8d1f4c1dfbdf043623b3c11a1c723c)
  ·
  [Release v2.11.9](/GNOME/libxml2/-/commit/954e851e1d8d1f4c1dfbdf043623b3c11a1c723c)

  ·
  Jul 24, 2024

  Release:
  [libxml2 2.11.9](/GNOME/libxml2/-/releases/v2.11.9)
  ```
  Release v2.11.9
  ```
* [v2.12.9](/GNOME/libxml2/-/tags/v2.12.9)
  protected
  [00301f0f](/GNOME/libxml2/-/commit/00301f0fe8bccdb9945fb684e9bbd72449b961a5)
  ·
  [Release v2.12.9](/GNOME/libxml2/-/commit/00301f0fe8bccdb9945fb684e9bbd72449b961a5)

  ·
  Jul 24, 2024

  Release:
  [libxml2 2.12.9](/GNOME/libxml2/-/releases/v2.12.9)
  ```
  Release v2.12.9
  ```
* [v2.13.3](/GNOME/libxml2/-/tags/v2.13.3)
  protected
  [3b1742b8](/GNOME/libxml2/-/commit/3b1742b8391e966be780bdc43fdf959f7b3a118c)
  ·
  [Release v2.13.3](/GNOME/libxml2/-/commit/3b1742b8391e966be780bdc43fdf959f7b3a118c)

  ·
  Jul 24, 2024

  Release:
  [libxml2 2.13.3](/GNOME/libxml2/-/releases/v2.13.3)
  ```
  Release v2.13.3
  ```
* [v2.13.2](/GNOME/libxml2/-/tags/v2.13.2)
  protected
  [4b3f860e](/GNOME/libxml2/-/commit/4b3f860e5420ade19a825dc7f4d75789489535ba)
  ·
  [Release v2.13.2](/GNOME/libxml2/-/commit/4b3f860e5420ade19a825dc7f4d75789489535ba)

  ·
  Jul 04, 2024

  Release:
  [libxml2 2.13.2](/GNOME/libxml2/-/releases/v2.13.2)
  ```
  Release v2.13.2
  ```
* [v2.13.1](/GNOME/libxml2/-/tags/v2.13.1)
  protected
  [48dba1e2](/GNOME/libxml2/-/commit/48dba1e21f8f1a7d8a817eaf65831396e74b78d2)
  ·
  [Release v2.13.1](/GNOME/libxml2/-/commit/48dba1e21f8f1a7d8a817eaf65831396e74b78d2)

  ·
  Jun 19, 2024

  Release:
  [libxml2 2.13.1](/GNOME/libxml2/-/releases/v2.13.1)
  ```
  Release v2.13.1
  ```
* [v2.13.0](/GNOME/libxml2/-/tags/v2.13.0)
  protected
  [cdd2575f](/GNOME/libxml2/-/commit/cdd2575f7fbab1d8162600f4048bc37503c80e28)
  ·
  [Release v2.13.0](/GNOME/libxml2/-/commit/cdd2575f7fbab1d8162600f4048bc37503c80e28)

  ·
  Jun 12, 2024

  Release:
  [libxml2 2.13.0](/GNOME/libxml2/-/releases/v2.13.0)
  ```
  Release v2.13.0
  ```
* [v2.12.8](/GNOME/libxml2/-/tags/v2.12.8)
  protected
  [83fce0a3](/GNOME/libxml2/-/commit/83fce0a3f9ef22c90a980b03bb90cbd364d5c9ab)
  ·
  [Release v2.12.8](/GNOME/libxml2/-/commit/83fce0a3f9ef22c90a980b03bb90cbd364d5c9ab)

  ·
  Jun 12, 2024

  Release:
  [libxml2 2.12.8](/GNOME/libxml2/-/releases/v2.12.8)
  ```
  Release v2.12.8
  ```
* [v2.11.8](/GNOME/libxml2/-/tags/v2.11.8)
  protected
  [58a973c4](/GNOME/libxml2/-/commit/58a973c40ba927e5ad941789723da7c47a2d60e3)
  ·
  [Release v2.11.8](/GNOME/libxml2/-/commit/58a973c40ba927e5ad941789723da7c47a2d60e3)

  ·
  May 13, 2024

  Release:
  [libxml2 2.11.8](/GNOME/libxml2/-/releases/v2.11.8)
  ```
  Release v2.11.8
  ```
* [v2.12.7](/GNOME/libxml2/-/tags/v2.12.7)
  protected
  [0b6d8130](/GNOME/libxml2/-/commit/0b6d8130737125ba45981d54be7f15fe398ad2e0)
  ·
  [Release v2.12.7](/GNOME/libxml2/-/commit/0b6d8130737125ba45981d54be7f15fe398ad2e0)

  ·
  May 13, 2024

  Release:
  [libxml2 2.12.7](/GNOME/libxml2/-/releases/v2.12.7)
  ```
  Release v2.12.7
  ```
* [v2.12.6](/GNOME/libxml2/-/tags/v2.12.6)
  protected
  [505e2e87](/GNOME/libxml2/-/commit/505e2e872e767405be565aa9d47ae9d6d5677f79)
  ·
  [Release v2.12.6](/GNOME/libxml2/-/commit/505e2e872e767405be565aa9d47ae9d6d5677f79)

  ·
  Mar 15, 2024

  Release:
  [libxml2 2.12.6](/GNOME/libxml2/-/releases/v2.12.6)
  ```
  Release v2.12.6
  ```
* [v2.11.7](/GNOME/libxml2/-/tags/v2.11.7)
  protected
  [87113200](/GNOME/libxml2/-/commit/8711320065405c4bb08aaccd4bd2881450b5ce41)
  ·
  [Release v2.11.7](/GNOME/libxml2/-/commit/8711320065405c4bb08aaccd4bd2881450b5ce41)

  ·
  Feb 04, 2024

  Release:
  [libxml2 2.11.7](/GNOME/libxml2/-/releases/v2.11.7)
  ```
  Release v2.11.7
  ```
* [v2.12.5](/GNOME/libxml2/-/tags/v2.12.5)
  protected
  [e189e994](/GNOME/libxml2/-/commit/e189e9945317ad4c8603fa2300d11d11f5e2e335)
  ·
  [Release v2.12.5](/GNOME/libxml2/-/commit/e189e9945317ad4c8603fa2300d11d11f5e2e335)

  ·
  Feb 04, 2024

  Release:
  [libxml2 2.12.5](/GNOME/libxml2/-/releases/v2.12.5)
  ```
  Release v2.12.5
  ```
* [v2.12.4](/GNOME/libxml2/-/tags/v2.12.4)
  protected
  [8292f361](/GNOME/libxml2/-/commit/8292f361458fcffe0bff515a385be02e9d35582c)
  ·
  [Release v2.12.4](/GNOME/libxml2/-/commit/8292f361458fcffe0bff515a385be02e9d35582c)

  ·
  Jan 15, 2024

  Release:
  [libxml2 2.12.4](/GNOME/libxml2/-/releases/v2.12.4)
  ```
  Release v2.12.4
  ```
* [v2.12.3](/GNOME/libxml2/-/tags/v2.12.3)
  protected
  [30d22bec](/GNOME/libxml2/-/commit/30d22bec03893ad646907050959bdfe9e8000146)
  ·
  [Release v2.12.3](/GNOME/libxml2/-/commit/30d22bec03893ad646907050959bdfe9e8000146)

  ·
  Dec 12, 2023

  Release:
  [libxml2 2.12.3](/GNOME/libxml2/-/releases/v2.12.3)
  ```
  Release v2.12.3
  ```
* [v2.12.2](/GNOME/libxml2/-/tags/v2.12.2)
  protected
  [4d8fa5b2](/GNOME/libxml2/-/commit/4d8fa5b292fc902268217fa0f7031e77e5437b5a)
  ·
  [Release v2.12.2](/GNOME/libxml2/-/commit/4d8fa5b292fc902268217fa0f7031e77e5437b5a)

  ·
  Dec 05, 2023

  Release:
  [libxml2 2.12.2](/GNOME/libxml2/-/releases/v2.12.2)
  ```
  Release v2.12.2
  ```
* [v2.12.1](/GNOME/libxml2/-/tags/v2.12.1)
  protected
  [f4ac9926](/GNOME/libxml2/-/commit/f4ac9926a463ecb628f73049e4fd7ecced8fb7cf)
  ·
  [Release v2.12.1](/GNOME/libxml2/-/commit/f4ac9926a463ecb628f73049e4fd7ecced8fb7cf)

  ·
  Nov 23, 2023

  Release:
  [libxml2 2.12.1](/GNOME/libxml2/-/releases/v2.12.1)
  ```
  Release v2.12.1
  ```
* [v2.12.0](/GNOME/libxml2/-/tags/v2.12.0)
  protected
  [5e9b167d](/GNOME/libxml2/-/commit/5e9b167dce73bd6a804ab107ae4c4b95e6849597)
  ·
  [Release v2.12.0](/GNOME/libxml2/-/commit/5e9b167dce73bd6a804ab107ae4c4b95e6849597)

  ·
  Nov 16, 2023

  Release:
  [libxml2 2.12.0](/GNOME/libxml2/-/releases/v2.12.0)
  ```
  Release v2.12.0
  ```
* [v2.11.6](/GNOME/libxml2/-/tags/v2.11.6)
  protected
  [93f0179d](/GNOME/libxml2/-/commit/93f0179d9d0bcd0d053d2df3e2fd382e6dac6954)
  ·
  [Release v2.11.6](/GNOME/libxml2/-/commit/93f0179d9d0bcd0d053d2df3e2fd382e6dac6954)

  ·
  Nov 16, 2023

  Release:
  [libxml2 2.11.6](/GNOME/libxml2/-/releases/v2.11.6)
  ```
  Release v2.11.6
  ```

* Prev
* [1](/GNOME/libxml2/-/tags)
* [2](/GNOME/libxml2/-/tags?page=2)
* [3](/GNOME/libxml2/-/tags?page=3)
* [4](/GNOME/libxml2/-/tags?page=4)
* [5](/GNOME/libxml2/-/tags?page=5)
* …
* [12](/GNOME/libxml2/-/tags?page=12)
* [Next](/GNOME/libxml2/-/tags?page=2)


