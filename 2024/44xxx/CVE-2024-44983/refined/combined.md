=== Content from git.kernel.org_20c110b0_20250115_094112.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=043a18bb6cf16adaa2f8642acfde6e8956a9caaa)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=043a18bb6cf16adaa2f8642acfde6e8956a9caaa)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=043a18bb6cf16adaa2f8642acfde6e8956a9caaa)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=043a18bb6cf16adaa2f8642acfde6e8956a9caaa)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Pablo Neira Ayuso <pablo@netfilter.org> | 2024-08-13 12:39:46 +0200 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-08-29 17:36:00 +0200 |
| commit | [043a18bb6cf16adaa2f8642acfde6e8956a9caaa](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=043a18bb6cf16adaa2f8642acfde6e8956a9caaa) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=043a18bb6cf16adaa2f8642acfde6e8956a9caaa)) | |
| tree | [eb5c40621bec04ba0b7bdd76609c6a282827292f](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=043a18bb6cf16adaa2f8642acfde6e8956a9caaa) | |
| parent | [95a305ba259b685780ed62ea2295aa2feb2d6c0c](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=95a305ba259b685780ed62ea2295aa2feb2d6c0c) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=043a18bb6cf16adaa2f8642acfde6e8956a9caaa&id2=95a305ba259b685780ed62ea2295aa2feb2d6c0c)) | |
| download | [linux-043a18bb6cf16adaa2f8642acfde6e8956a9caaa.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-043a18bb6cf16adaa2f8642acfde6e8956a9caaa.tar.gz) | |

netfilter: flowtable: validate vlan header[ Upstream commit 6ea14ccb60c8ab829349979b22b58a941ec4a3ee ]
Ensure there is sufficient room to access the protocol field of the
VLAN header, validate it once before the flowtable lookup.
=====================================================
BUG: KMSAN: uninit-value in nf\_flow\_offload\_inet\_hook+0x45a/0x5f0 net/netfilter/nf\_flow\_table\_inet.c:32
nf\_flow\_offload\_inet\_hook+0x45a/0x5f0 net/netfilter/nf\_flow\_table\_inet.c:32
nf\_hook\_entry\_hookfn include/linux/netfilter.h:154 [inline]
nf\_hook\_slow+0xf4/0x400 net/netfilter/core.c:626
nf\_hook\_ingress include/linux/netfilter\_netdev.h:34 [inline]
nf\_ingress net/core/dev.c:5440 [inline]
Fixes: 4cd91f7c290f ("netfilter: flowtable: add vlan support")
Reported-by: syzbot+8407d9bb88cd4c6bf61a@syzkaller.appspotmail.com
Signed-off-by: Pablo Neira Ayuso <pablo@netfilter.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=043a18bb6cf16adaa2f8642acfde6e8956a9caaa)

| -rw-r--r-- | [net/netfilter/nf\_flow\_table\_inet.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/netfilter/nf_flow_table_inet.c?id=043a18bb6cf16adaa2f8642acfde6e8956a9caaa) | 3 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |
| -rw-r--r-- | [net/netfilter/nf\_flow\_table\_ip.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/netfilter/nf_flow_table_ip.c?id=043a18bb6cf16adaa2f8642acfde6e8956a9caaa) | 3 | |  |  |  | | --- | --- | --- | |

2 files changed, 6 insertions, 0 deletions

| diff --git a/net/netfilter/nf\_flow\_table\_inet.c b/net/netfilter/nf\_flow\_table\_inet.cindex 6eef15648b7b08..b0f19917193241 100644--- a/[net/netfilter/nf\_flow\_table\_inet.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/netfilter/nf_flow_table_inet.c?id=95a305ba259b685780ed62ea2295aa2feb2d6c0c)+++ b/[net/netfilter/nf\_flow\_table\_inet.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/netfilter/nf_flow_table_inet.c?id=043a18bb6cf16adaa2f8642acfde6e8956a9caaa)@@ -17,6 +17,9 @@ nf\_flow\_offload\_inet\_hook(void \*priv, struct sk\_buff \*skb,  switch (skb->protocol) { case htons(ETH\_P\_8021Q):+ if (!pskb\_may\_pull(skb, skb\_mac\_offset(skb) + sizeof(\*veth)))+ return NF\_ACCEPT;+ veth = (struct vlan\_ethhdr \*)skb\_mac\_header(skb); proto = veth->h\_vlan\_encapsulated\_proto; break;diff --git a/net/netfilter/nf\_flow\_table\_ip.c b/net/netfilter/nf\_flow\_table\_ip.cindex c2c005234dcd38..98edcaa37b38d4 100644--- a/[net/netfilter/nf\_flow\_table\_ip.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/netfilter/nf_flow_table_ip.c?id=95a305ba259b685780ed62ea2295aa2feb2d6c0c)+++ b/[net/netfilter/nf\_flow\_table\_ip.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/netfilter/nf_flow_table_ip.c?id=043a18bb6cf16adaa2f8642acfde6e8956a9caaa)@@ -281,6 +281,9 @@ static bool nf\_flow\_skb\_encap\_protocol(struct sk\_buff \*skb, \_\_be16 proto,  switch (skb->protocol) { case htons(ETH\_P\_8021Q):+ if (!pskb\_may\_pull(skb, skb\_mac\_offset(skb) + sizeof(\*veth)))+ return false;+ veth = (struct vlan\_ethhdr \*)skb\_mac\_header(skb); if (veth->h\_vlan\_encapsulated\_proto == proto) { \*offset += VLAN\_HLEN; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-15 09:39:49 +0000



=== Content from git.kernel.org_165670f8_20250115_094111.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=0279c35d242d037abeb73d60d06a6d1bb7f672d9)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=0279c35d242d037abeb73d60d06a6d1bb7f672d9)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=0279c35d242d037abeb73d60d06a6d1bb7f672d9)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=0279c35d242d037abeb73d60d06a6d1bb7f672d9)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Pablo Neira Ayuso <pablo@netfilter.org> | 2024-08-13 12:39:46 +0200 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-08-29 17:33:49 +0200 |
| commit | [0279c35d242d037abeb73d60d06a6d1bb7f672d9](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=0279c35d242d037abeb73d60d06a6d1bb7f672d9) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=0279c35d242d037abeb73d60d06a6d1bb7f672d9)) | |
| tree | [03b0ac6f389391283c7d262b713a067ecc9115be](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=0279c35d242d037abeb73d60d06a6d1bb7f672d9) | |
| parent | [fa4e6ae38574d0fc5596272bee64727d8ab7052b](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=fa4e6ae38574d0fc5596272bee64727d8ab7052b) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=0279c35d242d037abeb73d60d06a6d1bb7f672d9&id2=fa4e6ae38574d0fc5596272bee64727d8ab7052b)) | |
| download | [linux-0279c35d242d037abeb73d60d06a6d1bb7f672d9.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-0279c35d242d037abeb73d60d06a6d1bb7f672d9.tar.gz) | |

netfilter: flowtable: validate vlan header[ Upstream commit 6ea14ccb60c8ab829349979b22b58a941ec4a3ee ]
Ensure there is sufficient room to access the protocol field of the
VLAN header, validate it once before the flowtable lookup.
=====================================================
BUG: KMSAN: uninit-value in nf\_flow\_offload\_inet\_hook+0x45a/0x5f0 net/netfilter/nf\_flow\_table\_inet.c:32
nf\_flow\_offload\_inet\_hook+0x45a/0x5f0 net/netfilter/nf\_flow\_table\_inet.c:32
nf\_hook\_entry\_hookfn include/linux/netfilter.h:154 [inline]
nf\_hook\_slow+0xf4/0x400 net/netfilter/core.c:626
nf\_hook\_ingress include/linux/netfilter\_netdev.h:34 [inline]
nf\_ingress net/core/dev.c:5440 [inline]
Fixes: 4cd91f7c290f ("netfilter: flowtable: add vlan support")
Reported-by: syzbot+8407d9bb88cd4c6bf61a@syzkaller.appspotmail.com
Signed-off-by: Pablo Neira Ayuso <pablo@netfilter.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=0279c35d242d037abeb73d60d06a6d1bb7f672d9)

| -rw-r--r-- | [net/netfilter/nf\_flow\_table\_inet.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/netfilter/nf_flow_table_inet.c?id=0279c35d242d037abeb73d60d06a6d1bb7f672d9) | 3 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |
| -rw-r--r-- | [net/netfilter/nf\_flow\_table\_ip.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/netfilter/nf_flow_table_ip.c?id=0279c35d242d037abeb73d60d06a6d1bb7f672d9) | 3 | |  |  |  | | --- | --- | --- | |

2 files changed, 6 insertions, 0 deletions

| diff --git a/net/netfilter/nf\_flow\_table\_inet.c b/net/netfilter/nf\_flow\_table\_inet.cindex 6eef15648b7b08..b0f19917193241 100644--- a/[net/netfilter/nf\_flow\_table\_inet.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/netfilter/nf_flow_table_inet.c?id=fa4e6ae38574d0fc5596272bee64727d8ab7052b)+++ b/[net/netfilter/nf\_flow\_table\_inet.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/netfilter/nf_flow_table_inet.c?id=0279c35d242d037abeb73d60d06a6d1bb7f672d9)@@ -17,6 +17,9 @@ nf\_flow\_offload\_inet\_hook(void \*priv, struct sk\_buff \*skb,  switch (skb->protocol) { case htons(ETH\_P\_8021Q):+ if (!pskb\_may\_pull(skb, skb\_mac\_offset(skb) + sizeof(\*veth)))+ return NF\_ACCEPT;+ veth = (struct vlan\_ethhdr \*)skb\_mac\_header(skb); proto = veth->h\_vlan\_encapsulated\_proto; break;diff --git a/net/netfilter/nf\_flow\_table\_ip.c b/net/netfilter/nf\_flow\_table\_ip.cindex 5383bed3d3e002..846fa2ad7c8580 100644--- a/[net/netfilter/nf\_flow\_table\_ip.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/netfilter/nf_flow_table_ip.c?id=fa4e6ae38574d0fc5596272bee64727d8ab7052b)+++ b/[net/netfilter/nf\_flow\_table\_ip.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/netfilter/nf_flow_table_ip.c?id=0279c35d242d037abeb73d60d06a6d1bb7f672d9)@@ -281,6 +281,9 @@ static bool nf\_flow\_skb\_encap\_protocol(struct sk\_buff \*skb, \_\_be16 proto,  switch (skb->protocol) { case htons(ETH\_P\_8021Q):+ if (!pskb\_may\_pull(skb, skb\_mac\_offset(skb) + sizeof(\*veth)))+ return false;+ veth = (struct vlan\_ethhdr \*)skb\_mac\_header(skb); if (veth->h\_vlan\_encapsulated\_proto == proto) { \*offset += VLAN\_HLEN; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-15 09:39:47 +0000



=== Content from git.kernel.org_6e8aebbf_20250115_094114.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=c05155cc455785916164aa5e1b4605a2ae946537)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=c05155cc455785916164aa5e1b4605a2ae946537)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=c05155cc455785916164aa5e1b4605a2ae946537)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=c05155cc455785916164aa5e1b4605a2ae946537)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Pablo Neira Ayuso <pablo@netfilter.org> | 2024-08-13 12:39:46 +0200 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-09-04 13:23:34 +0200 |
| commit | [c05155cc455785916164aa5e1b4605a2ae946537](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=c05155cc455785916164aa5e1b4605a2ae946537) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=c05155cc455785916164aa5e1b4605a2ae946537)) | |
| tree | [9a7e0251d4cc08e5d0960c16628cc9e714c0c81f](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=c05155cc455785916164aa5e1b4605a2ae946537) | |
| parent | [975f764e96f71616b530e300c1bb2ac0ce0c2596](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=975f764e96f71616b530e300c1bb2ac0ce0c2596) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=c05155cc455785916164aa5e1b4605a2ae946537&id2=975f764e96f71616b530e300c1bb2ac0ce0c2596)) | |
| download | [linux-c05155cc455785916164aa5e1b4605a2ae946537.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-c05155cc455785916164aa5e1b4605a2ae946537.tar.gz) | |

netfilter: flowtable: validate vlan header[ Upstream commit 6ea14ccb60c8ab829349979b22b58a941ec4a3ee ]
Ensure there is sufficient room to access the protocol field of the
VLAN header, validate it once before the flowtable lookup.
=====================================================
BUG: KMSAN: uninit-value in nf\_flow\_offload\_inet\_hook+0x45a/0x5f0 net/netfilter/nf\_flow\_table\_inet.c:32
nf\_flow\_offload\_inet\_hook+0x45a/0x5f0 net/netfilter/nf\_flow\_table\_inet.c:32
nf\_hook\_entry\_hookfn include/linux/netfilter.h:154 [inline]
nf\_hook\_slow+0xf4/0x400 net/netfilter/core.c:626
nf\_hook\_ingress include/linux/netfilter\_netdev.h:34 [inline]
nf\_ingress net/core/dev.c:5440 [inline]
Fixes: 4cd91f7c290f ("netfilter: flowtable: add vlan support")
Reported-by: syzbot+8407d9bb88cd4c6bf61a@syzkaller.appspotmail.com
Signed-off-by: Pablo Neira Ayuso <pablo@netfilter.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=c05155cc455785916164aa5e1b4605a2ae946537)

| -rw-r--r-- | [net/netfilter/nf\_flow\_table\_inet.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/netfilter/nf_flow_table_inet.c?id=c05155cc455785916164aa5e1b4605a2ae946537) | 3 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |
| -rw-r--r-- | [net/netfilter/nf\_flow\_table\_ip.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/netfilter/nf_flow_table_ip.c?id=c05155cc455785916164aa5e1b4605a2ae946537) | 3 | |  |  |  | | --- | --- | --- | |

2 files changed, 6 insertions, 0 deletions

| diff --git a/net/netfilter/nf\_flow\_table\_inet.c b/net/netfilter/nf\_flow\_table\_inet.cindex 6783ea220f8fe2..7f746acb4b027a 100644--- a/[net/netfilter/nf\_flow\_table\_inet.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/netfilter/nf_flow_table_inet.c?id=975f764e96f71616b530e300c1bb2ac0ce0c2596)+++ b/[net/netfilter/nf\_flow\_table\_inet.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/netfilter/nf_flow_table_inet.c?id=c05155cc455785916164aa5e1b4605a2ae946537)@@ -17,6 +17,9 @@ nf\_flow\_offload\_inet\_hook(void \*priv, struct sk\_buff \*skb,  switch (skb->protocol) { case htons(ETH\_P\_8021Q):+ if (!pskb\_may\_pull(skb, skb\_mac\_offset(skb) + sizeof(\*veth)))+ return NF\_ACCEPT;+ veth = (struct vlan\_ethhdr \*)skb\_mac\_header(skb); proto = veth->h\_vlan\_encapsulated\_proto; break;diff --git a/net/netfilter/nf\_flow\_table\_ip.c b/net/netfilter/nf\_flow\_table\_ip.cindex f3227f93169698..8fa16be0def2a6 100644--- a/[net/netfilter/nf\_flow\_table\_ip.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/netfilter/nf_flow_table_ip.c?id=975f764e96f71616b530e300c1bb2ac0ce0c2596)+++ b/[net/netfilter/nf\_flow\_table\_ip.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/netfilter/nf_flow_table_ip.c?id=c05155cc455785916164aa5e1b4605a2ae946537)@@ -254,6 +254,9 @@ static bool nf\_flow\_skb\_encap\_protocol(struct sk\_buff \*skb, \_\_be16 proto,  switch (skb->protocol) { case htons(ETH\_P\_8021Q):+ if (!pskb\_may\_pull(skb, skb\_mac\_offset(skb) + sizeof(\*veth)))+ return false;+ veth = (struct vlan\_ethhdr \*)skb\_mac\_header(skb); if (veth->h\_vlan\_encapsulated\_proto == proto) { \*offset += VLAN\_HLEN; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-15 09:39:51 +0000



=== Content from git.kernel.org_30cf2e00_20250115_094112.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=6ea14ccb60c8ab829349979b22b58a941ec4a3ee)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=6ea14ccb60c8ab829349979b22b58a941ec4a3ee)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=6ea14ccb60c8ab829349979b22b58a941ec4a3ee)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=6ea14ccb60c8ab829349979b22b58a941ec4a3ee)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Pablo Neira Ayuso <pablo@netfilter.org> | 2024-08-13 12:39:46 +0200 |
| --- | --- | --- |
| committer | Pablo Neira Ayuso <pablo@netfilter.org> | 2024-08-22 12:14:18 +0200 |
| commit | [6ea14ccb60c8ab829349979b22b58a941ec4a3ee](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=6ea14ccb60c8ab829349979b22b58a941ec4a3ee) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=6ea14ccb60c8ab829349979b22b58a941ec4a3ee)) | |
| tree | [368e79a57fd09ebf0d94917d038f4b9a861d3fd6](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=6ea14ccb60c8ab829349979b22b58a941ec4a3ee) | |
| parent | [a0b39e2dc7017ac667b70bdeee5293e410fab2fb](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=a0b39e2dc7017ac667b70bdeee5293e410fab2fb) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=6ea14ccb60c8ab829349979b22b58a941ec4a3ee&id2=a0b39e2dc7017ac667b70bdeee5293e410fab2fb)) | |
| download | [linux-6ea14ccb60c8ab829349979b22b58a941ec4a3ee.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-6ea14ccb60c8ab829349979b22b58a941ec4a3ee.tar.gz) | |

netfilter: flowtable: validate vlan headerEnsure there is sufficient room to access the protocol field of the
VLAN header, validate it once before the flowtable lookup.
=====================================================
BUG: KMSAN: uninit-value in nf\_flow\_offload\_inet\_hook+0x45a/0x5f0 net/netfilter/nf\_flow\_table\_inet.c:32
nf\_flow\_offload\_inet\_hook+0x45a/0x5f0 net/netfilter/nf\_flow\_table\_inet.c:32
nf\_hook\_entry\_hookfn include/linux/netfilter.h:154 [inline]
nf\_hook\_slow+0xf4/0x400 net/netfilter/core.c:626
nf\_hook\_ingress include/linux/netfilter\_netdev.h:34 [inline]
nf\_ingress net/core/dev.c:5440 [inline]
Fixes: 4cd91f7c290f ("netfilter: flowtable: add vlan support")
Reported-by: syzbot+8407d9bb88cd4c6bf61a@syzkaller.appspotmail.com
Signed-off-by: Pablo Neira Ayuso <pablo@netfilter.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=6ea14ccb60c8ab829349979b22b58a941ec4a3ee)

| -rw-r--r-- | [net/netfilter/nf\_flow\_table\_inet.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/netfilter/nf_flow_table_inet.c?id=6ea14ccb60c8ab829349979b22b58a941ec4a3ee) | 3 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |
| -rw-r--r-- | [net/netfilter/nf\_flow\_table\_ip.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/netfilter/nf_flow_table_ip.c?id=6ea14ccb60c8ab829349979b22b58a941ec4a3ee) | 3 | |  |  |  | | --- | --- | --- | |

2 files changed, 6 insertions, 0 deletions

| diff --git a/net/netfilter/nf\_flow\_table\_inet.c b/net/netfilter/nf\_flow\_table\_inet.cindex 88787b45e30d6b..8b541a08034206 100644--- a/[net/netfilter/nf\_flow\_table\_inet.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/netfilter/nf_flow_table_inet.c?id=a0b39e2dc7017ac667b70bdeee5293e410fab2fb)+++ b/[net/netfilter/nf\_flow\_table\_inet.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/netfilter/nf_flow_table_inet.c?id=6ea14ccb60c8ab829349979b22b58a941ec4a3ee)@@ -17,6 +17,9 @@ nf\_flow\_offload\_inet\_hook(void \*priv, struct sk\_buff \*skb,  switch (skb->protocol) { case htons(ETH\_P\_8021Q):+ if (!pskb\_may\_pull(skb, skb\_mac\_offset(skb) + sizeof(\*veth)))+ return NF\_ACCEPT;+ veth = (struct vlan\_ethhdr \*)skb\_mac\_header(skb); proto = veth->h\_vlan\_encapsulated\_proto; break;diff --git a/net/netfilter/nf\_flow\_table\_ip.c b/net/netfilter/nf\_flow\_table\_ip.cindex c2c005234dcd38..98edcaa37b38d4 100644--- a/[net/netfilter/nf\_flow\_table\_ip.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/netfilter/nf_flow_table_ip.c?id=a0b39e2dc7017ac667b70bdeee5293e410fab2fb)+++ b/[net/netfilter/nf\_flow\_table\_ip.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/netfilter/nf_flow_table_ip.c?id=6ea14ccb60c8ab829349979b22b58a941ec4a3ee)@@ -281,6 +281,9 @@ static bool nf\_flow\_skb\_encap\_protocol(struct sk\_buff \*skb, \_\_be16 proto,  switch (skb->protocol) { case htons(ETH\_P\_8021Q):+ if (!pskb\_may\_pull(skb, skb\_mac\_offset(skb) + sizeof(\*veth)))+ return false;+ veth = (struct vlan\_ethhdr \*)skb\_mac\_header(skb); if (veth->h\_vlan\_encapsulated\_proto == proto) { \*offset += VLAN\_HLEN; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-15 09:39:49 +0000



=== Content from git.kernel.org_700ce12d_20250115_094115.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=d9384ae7aec46036d248d1c2c2757e471ab486c3)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=d9384ae7aec46036d248d1c2c2757e471ab486c3)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=d9384ae7aec46036d248d1c2c2757e471ab486c3)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=d9384ae7aec46036d248d1c2c2757e471ab486c3)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Pablo Neira Ayuso <pablo@netfilter.org> | 2024-08-13 12:39:46 +0200 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-08-29 17:30:47 +0200 |
| commit | [d9384ae7aec46036d248d1c2c2757e471ab486c3](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=d9384ae7aec46036d248d1c2c2757e471ab486c3) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=d9384ae7aec46036d248d1c2c2757e471ab486c3)) | |
| tree | [96c5e54ea2ee498d2974afa3d4b1e2791f5ac0bf](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=d9384ae7aec46036d248d1c2c2757e471ab486c3) | |
| parent | [38a21c026ed2cc7232414cb166efc1923f34af17](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=38a21c026ed2cc7232414cb166efc1923f34af17) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=d9384ae7aec46036d248d1c2c2757e471ab486c3&id2=38a21c026ed2cc7232414cb166efc1923f34af17)) | |
| download | [linux-d9384ae7aec46036d248d1c2c2757e471ab486c3.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-d9384ae7aec46036d248d1c2c2757e471ab486c3.tar.gz) | |

netfilter: flowtable: validate vlan header[ Upstream commit 6ea14ccb60c8ab829349979b22b58a941ec4a3ee ]
Ensure there is sufficient room to access the protocol field of the
VLAN header, validate it once before the flowtable lookup.
=====================================================
BUG: KMSAN: uninit-value in nf\_flow\_offload\_inet\_hook+0x45a/0x5f0 net/netfilter/nf\_flow\_table\_inet.c:32
nf\_flow\_offload\_inet\_hook+0x45a/0x5f0 net/netfilter/nf\_flow\_table\_inet.c:32
nf\_hook\_entry\_hookfn include/linux/netfilter.h:154 [inline]
nf\_hook\_slow+0xf4/0x400 net/netfilter/core.c:626
nf\_hook\_ingress include/linux/netfilter\_netdev.h:34 [inline]
nf\_ingress net/core/dev.c:5440 [inline]
Fixes: 4cd91f7c290f ("netfilter: flowtable: add vlan support")
Reported-by: syzbot+8407d9bb88cd4c6bf61a@syzkaller.appspotmail.com
Signed-off-by: Pablo Neira Ayuso <pablo@netfilter.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=d9384ae7aec46036d248d1c2c2757e471ab486c3)

| -rw-r--r-- | [net/netfilter/nf\_flow\_table\_inet.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/netfilter/nf_flow_table_inet.c?id=d9384ae7aec46036d248d1c2c2757e471ab486c3) | 3 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |
| -rw-r--r-- | [net/netfilter/nf\_flow\_table\_ip.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/netfilter/nf_flow_table_ip.c?id=d9384ae7aec46036d248d1c2c2757e471ab486c3) | 3 | |  |  |  | | --- | --- | --- | |

2 files changed, 6 insertions, 0 deletions

| diff --git a/net/netfilter/nf\_flow\_table\_inet.c b/net/netfilter/nf\_flow\_table\_inet.cindex 6eef15648b7b08..b0f19917193241 100644--- a/[net/netfilter/nf\_flow\_table\_inet.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/netfilter/nf_flow_table_inet.c?id=38a21c026ed2cc7232414cb166efc1923f34af17)+++ b/[net/netfilter/nf\_flow\_table\_inet.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/netfilter/nf_flow_table_inet.c?id=d9384ae7aec46036d248d1c2c2757e471ab486c3)@@ -17,6 +17,9 @@ nf\_flow\_offload\_inet\_hook(void \*priv, struct sk\_buff \*skb,  switch (skb->protocol) { case htons(ETH\_P\_8021Q):+ if (!pskb\_may\_pull(skb, skb\_mac\_offset(skb) + sizeof(\*veth)))+ return NF\_ACCEPT;+ veth = (struct vlan\_ethhdr \*)skb\_mac\_header(skb); proto = veth->h\_vlan\_encapsulated\_proto; break;diff --git a/net/netfilter/nf\_flow\_table\_ip.c b/net/netfilter/nf\_flow\_table\_ip.cindex 22bc0e3d8a0b59..34be2c9bc39d83 100644--- a/[net/netfilter/nf\_flow\_table\_ip.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/netfilter/nf_flow_table_ip.c?id=38a21c026ed2cc7232414cb166efc1923f34af17)+++ b/[net/netfilter/nf\_flow\_table\_ip.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/netfilter/nf_flow_table_ip.c?id=d9384ae7aec46036d248d1c2c2757e471ab486c3)@@ -275,6 +275,9 @@ static bool nf\_flow\_skb\_encap\_protocol(struct sk\_buff \*skb, \_\_be16 proto,  switch (skb->protocol) { case htons(ETH\_P\_8021Q):+ if (!pskb\_may\_pull(skb, skb\_mac\_offset(skb) + sizeof(\*veth)))+ return false;+ veth = (struct vlan\_ethhdr \*)skb\_mac\_header(skb); if (veth->h\_vlan\_encapsulated\_proto == proto) { \*offset += VLAN\_HLEN; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-15 09:39:52 +0000


