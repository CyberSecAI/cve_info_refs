=== Content from knowledgebase.paloaltonetworks.com_6727c867_20250115_180755.html ===


Troubleshoot CVE-2024-5921 Issues

# Troubleshoot CVE-2024-5921 Issues

3517
Created On 12/16/24 19:58 PM - Last Modified 12/27/24 18:17 PM
**[GlobalProtect App](https://support.paloaltonetworks.com/search#f:@source=[Salesforce Knowledge,PAN techDOCS]&f:@panfeature=[GlobalProtect App])**

**[GlobalProtect Gateway](https://support.paloaltonetworks.com/search#f:@source=[Salesforce Knowledge,PAN techDOCS]&f:@panfeature=[GlobalProtect Gateway])**

**[Certification](https://support.paloaltonetworks.com/search#f:@source=[Salesforce Knowledge,PAN techDOCS]&f:@panfeaturecategory=[Certification])**

**[VPNs](https://support.paloaltonetworks.com/search#f:@source=[Salesforce Knowledge,PAN techDOCS]&f:@panfeaturecategory=[VPNs])**

**[GlobalProtect](https://support.paloaltonetworks.com/search#f:@source=[Salesforce Knowledge,PAN techDOCS]&f:@panproduct=[GlobalProtect])**

## Question

After enabling the FULLCHAINCERTVERIFY="YES" due to [CVE-2024-5921,](https://security.paloaltonetworks.com/CVE-2024-5921) the GP App throws "The certificate is not fips compliant. Please access the system logs for more information" and fails to connect to the GP Portal/Gateway

![](https://lh7-rt.googleusercontent.com/docsz/AD_4nXdrJr8qSkf9ZM5EMXoyb7fzhD0CLKAYKhkxOAJSCSRZHQeVmz22RB7BueXl8xSstXUeMi89Gkt-QM_VMWYHFialJ846Ri284vSJ4uJBWk8Re7p27cSHYoZoHBJDyvDPvDUu_uyY2w?key=Jzj4F67_Mi3wDXNR1BOWbWSv)

## Environment

GlobalProtect App with FULLCHAINCERTVERIFY

GP Portal and Gateway

## Answer

The FULLCHAINCERTVERIFY requires FIPS certificate validation checks. The GP App displays a **general message** "The certificate is not fips compliant. Please access the system logs for more information" when the certificate does not pass FIPS-CC validation checks due to.

Please check [FIPS-CC Mode Issues](https://docs.paloaltonetworks.com/globalprotect/10-1/globalprotect-admin/certifications/resolve-fips-cc-mode-issues) for conditions where the message can appear and compare the PanGPS.log

Following are some of the example scenarios where the message appears.

 **Example 1: OCSP and CRL URLs are not HTTP-based so the revocation check failed**

In the following scenario, the PanGPS.log shows the certificate (i.e. issuer CA):

1. 1. Does not have OCSP URI
   2. Has 1 CRL distribution point
   3. Has CRL Signing in the KeyUsage

But PanGPS failed to read/access the CRL URI

(P27136-T30232)Debug(1358): 12/04/24 09:22:48:677 CheckOCSP: Finding position of cert in chain (length = 4)...(P27136-T30232)Debug(1369): 12/04/24 09:22:48:677 CheckOCSP: Found cert in chain at chain index = 0
(P27136-T30232)Debug(1381): 12/04/24 09:22:48:677 CheckOCSP: Retrieve Issuer at chain index = 1
(P27136-T30232)Debug(1391): 12/04/24 09:22:48:677 issuer retrieved from sk:
(P27136-T30232)Debug(2439): 12/04/24 09:22:48:677 certificate: /DC=com/DC=domain/DC=ad/CN=EXAMPLE-SUB-CA
(P27136-T30232)Debug(2440): 12/04/24 09:22:48:677 issuer: /DC=com/DC=domain/DC=ad/CN=EXAMPLE-ROOT-CA
(P27136-T30232)Error(1409): 12/04/24 09:22:48:677 **No OCSP URI found in the certificate..**
(P27136-T30232)Info (1646): 12/04/24 09:22:48:677 len=183
(P27136-T30232)Debug(1673): 12/04/24 09:22:48:677 **total 1 crl distribution points in certificate.**
(P27136-T30232)Debug(1807): 12/04/24 09:22:48:677 FIPS-CC cert check: KeyUsage for crl sign purpose checked okay..
(P27136-T30232)Debug(1573): 12/04/24 09:22:48:677 **crl cert check result=-1**
(P27136-T30232)Error(14001): 12/04/24 09:22:48:677 **Failed validation of the X509v3 certificate. Read/Access OCSP or CRL failed.**

You can open the EXAMPLE-SUB-CA certificate and verify CRL and OCSP information to understand it further. In this example, the **Authority Access Information**does not have OCSP Responder URI based on HTTP/HTTPS. It has Alternate Names URL based-on LDAP which is not supported

![](/servlet/rtaImage?eid=ka14u000000HsuS&feoid=00N0g000003VXsh&refid=0EM4u00000B68sM)

**After checking the CRL Distribution Point URL, we know it is also LDAP-based which is not supported.**

**Conclusion:** This scenario uses Internal PKI infrastructure and OCSP and CRL URIs are LDAP-based which are not supported.

**Suggested Solution/Workaround:**

* + The GP Portal and Gateway certificate chain should have HTTP-based OCSP and CRL URIs and that should be accessible from the clients.
  + Another workaround is to use certificates (leaf & root) that do not have **Authority Information Access** and **CRL Distribution Point**. Firewall-generated certificates do not have those extensions. Publish the Root certificate to clients

**Example 2: RSA Key Exponent Failure**

In the following scenario, the PanGPS.log shows the CA certificate has an RSA exponent that is not odd or greater than ((2^16)+1)

(P15992-T2244)Debug(13976): 12/04/24 11:52:28:196 cert chain size=4
(P15992-T2244)Debug(2107): 12/04/24 11:52:28:196 CheckCertFipsCompliant cert.. cert 0xc96d40e0 type 1
(P15992-T2244)Info (2182): 12/04/24 11:52:28:196 FIPS-CC cert check: server cert..
(P15992-T2244)Info (2219): 12/04/24 11:52:28:196 FIPS-CC cert check: CheckCertFipsCompliant returning with result = 0
(P15992-T2244)Debug(2107): 12/04/24 11:52:28:196 CheckCertFipsCompliant cert.. cert 0xc96d4ea0 type 3
(P15992-T2244)Info (2194): 12/04/24 11:52:28:196 FIPS-CC cert check: CA cert..
(P15992-T2244)Info (2219): 12/04/24 11:52:28:196 FIPS-CC cert check: CheckCertFipsCompliant returning with result = 0
(P15992-T2244)Debug(2107): 12/04/24 11:52:28:196 CheckCertFipsCompliant cert.. cert 0xc96d3a00 type 3
(P15992-T2244)Info (2194): 12/04/24 11:52:28:196 **FIPS-CC cert check: CA cert..**
(P15992-T2244)Info (2219): 12/04/24 11:52:28:196 FIPS-CC cert check: CheckCertFipsCompliant returning with result = 0
(P15992-T2244)Debug(2107): 12/04/24 11:52:28:196 CheckCertFipsCompliant cert.. cert 0xc96d5000 type 3
(P15992-T2244)Error(1697): 12/04/24 11:52:28:196 **RSA exponent must be odd or greater than ((2^16)+1)**
(P15992-T2244)Error(2138): 12/04/24 11:52:28:196 FIPS-CC error: Non compliant FIPS-CC mode certificate. Found -1 bit(2:exp-sb) for RSA key.
(P15992-T2244)Info (2194): 12/04/24 11:52:28:196 FIPS-CC cert check: CA cert..
(P15992-T2244)Info (2219): 12/04/24 11:52:28:196 FIPS-CC cert check: CheckCertFipsCompliant returning with result = -269549566
(P15992-T2244)Debug(13978): 12/04/24 11:52:28:196 cert chain fips compliant check returns: 0X00000000

**Causes:** One of the certificates in the chain is not FIPS compliant, it's either using a non-FIPS algorithm (e.g. SHA1) or the RSA key is not odd & greater than ((2^16)+1)

In the above example, the Root CA (i.e. the last certificate in the chain) is using SHA1 algorithm

![](/servlet/rtaImage?eid=ka14u000000HsuS&feoid=00N0g000003VXsh&refid=0EM4u00000B6C75)

**Solution:**

* + If the CA's algorithm is SHA1, fix the certificate chain on the GP Portal/Gateway, it might be using an old CA. Import the new CAs chain and remove the old (e.g. SHA1 Root CA).
  + If the leaf's certificate RSA key is not FIPS compliant, generate a new leaf certificate with higher bits/key exponent

## **Example 3: OCSP Request is missing Host header and OCSP Responder behind the Cloud Proxies (e.g. Cloudflare, etc) are sending 4xx Not Found or Bad Request**

PanGPS.log shows Error querying the OCSP responder:

(P3328-T7968)Debug(1413): 12/03/24 07:28:49:864 ocsp uri=<http://ocsp.sectigo.com>
...
(P3328-T7968)Debug( 316): 12/03/24 07:28:49:864 host is FQDN: ocsp.sectigo.com
...
(P3328-T7968)Debug( 114): 12/03/24 07:28:49:897 ocsp socket=1792, status=-1
(P3328-T7968)Error(1019): 12/03/24 07:28:49:920 pan\_process\_responder returns NULL!
(P3328-T7968)Debug(1079): 12/03/24 07:28:49:920 certificate valid time information (Issuer: Not Before[Nov  2 00:00:00 2018 GMT]; Not After[Dec 31 23:59:59 2030 GMT]; Cert: Not Before[Apr  2 00:00:00 2024 GMT]; Not After[May  3 23:59:59 2025 GMT];)
(P3328-T7968)Debug( 231): 12/03/24 07:28:49:920 **Error querying OCSP responder**
(P3328-T7968)Error( 279): 12/03/24 07:28:49:920 Failed to query OCSP responsder
(P3328-T7968)Error( 296): 12/03/24 07:28:49:920 [OCSP] The result of Certificate status query is unavailable
(P3328-T7968)Debug(1423): 12/03/24 07:28:49:920 ocsp parse result=-1, status=3 reason=7
(P3328-T7968)Debug(1673): 12/03/24 07:28:49:920 **total 0 crl distribution points in certificate.**
(P3328-T7968)Debug(1527): 12/03/24 07:28:49:920 crl cert check result: crl url count = 0
(P3328-T7968)Error(14001): 12/03/24 07:28:49:920 **Failed validation of the X509v3 certificate. Read/Access OCSP or CRL failed.**

**Packet Capture shows OCSP Request missing Host header**

![](/servlet/rtaImage?eid=ka14u000000HsuS&feoid=00N0g000003VXsh&refid=0EM4u00000B69qv)

**Solution:**[GPC-22080](https://docs.paloaltonetworks.com/globalprotect/6-3/globalprotect-app-release-notes/globalprotect-addressed-issues) addressed in GP App 6.3.2

## **Example 4:** **OCSP and CRL both fail because** **GP Portal/Gateway sending ONLY the leaf/server certificate (i.e. not the complete cert chain with intermediate and root CAs)**

**Workaround:** Send the full chain (leaf + intermediate + root) from GP Portal/Gateway

## **Example 5:** **OCSP and CRL both fail because** **GP Portal/Gateway sends an out-of-order Certificate Chain (e.g. Leaf + Root + Intermediate)**

In the following scenario, PanGPS.log shows that GP Portal sends a certificate chain of 3 certs but OCSP and CRL fail

(P10460-T7764)Dump (1145): 12/17/24 11:18:29:241 MFAuthHandleMsg: Check domain name gp.exampl.local versus CN name gp.exampl.local
(P10460-T7764)Debug(1040): 12/17/24 11:18:29:241 Hostname gp.exampl.local matches sub alt name gp.exampl.local
(P10460-T7764)Dump (1050): 12/17/24 11:18:29:241 check subalt returns 1
(P10460-T7764)Debug(13976): 12/17/24 11:18:29:241 **cert chain size=3**
(P10460-T7764)Debug(2107): 12/17/24 11:18:29:241 CheckCertFipsCompliant cert.. cert 0x71f64870 **type 1**
(P10460-T7764)Dump (2123): 12/17/24 11:18:29:241 FIPS-CC cert check: digest algo verified okay..
(P10460-T7764)Dump (2143): 12/17/24 11:18:29:241 FIPS-CC cert check: bit strengths and exponents checked okay..
(P10460-T7764)Info (2182): 12/17/24 11:18:29:241 FIPS-CC cert check**: server cert..**
(P10460-T7764)Dump (1869): 12/17/24 11:18:29:241 FIPS-CC cert check: Extensions checked okay..
(P10460-T7764)Info (2219): 12/17/24 11:18:29:241 FIPS-CC cert check: CheckCertFipsCompliant returning with result = 0
(P10460-T7764)Debug(2107): 12/17/24 11:18:29:242 CheckCertFipsCompliant cert.. cert 0x71f649d0 **type 3**
(P10460-T7764)Dump (2123): 12/17/24 11:18:29:242 FIPS-CC cert check: digest algo verified okay..
(P10460-T7764)Dump (2143): 12/17/24 11:18:29:242 FIPS-CC cert check: bit strengths and exponents checked okay..
(P10460-T7764)Info (2194): 12/17/24 11:18:29:242 FIPS-CC cert check: **CA cert..**
(P10460-T7764)Info (2219): 12/17/24 11:18:29:242 FIPS-CC cert check: CheckCertFipsCompliant returning with result = 0
(P10460-T7764)Debug(2107): 12/17/24 11:18:29:242 CheckCertFipsCompliant cert.. cert 0x71f64030 **type 3**
(P10460-T7764)Dump (2123): 12/17/24 11:18:29:242 FIPS-CC cert check: digest algo verified okay..
(P10460-T7764)Dump (2143): 12/17/24 11:18:29:242 FIPS-CC cert check: bit strengths and exponents checked okay..
(P10460-T7764)Info (2194): 12/17/24 11:18:29:242 FIPS-CC cert check: **CA cert..**
(P10460-T7764)Info (2219): 12/17/24 11:18:29:242 FIPS-CC cert check: CheckCertFipsCompliant returning with result = 0
(P10460-T7764)Debug(13978): 12/17/24 11:18:29:242 cert chain fips compliant check returns: 0X00000004
(P10460-T7764)Debug(1253): 12/17/24 11:18:29:242 check OCSP for certificate:
(P10460-T7764)Debug(2439): 12/17/24 11:18:29:242 certificate: /C=US/ST=Florida/L=Miami/O=EXAMPLE Corporation/CN=gp.exampl.local
(P10460-T7764)Debug(2440): 12/17/24 11:18:29:242 issuer: /C=US/O=DigiCert Inc/CN=DigiCert Global G2 TLS RSA SHA256 2020 CA1

(P10460-T7764)Dump ( 152): 12/17/24 11:18:29:242 pan\_get\_full\_path(): full path in multibyte char is c:\Program Files\Palo Alto Networks\GlobalProtect\tca.cer
(P10460-T7764)Info (1270): 12/17/24 11:18:29:242 full path for issuer certificate:c:\Program Files\Palo Alto Networks\GlobalProtect\tca.cer.
(P10460-T7764)Debug(1358): 12/17/24 11:18:29:242 CheckOCSP: Finding position of cert in chain (length = 3)...
(P10460-T7764)Debug(1369): 12/17/24 11:18:29:242 CheckOCSP: Found cert in chain at chain index = 0
(P10460-T7764)Debug(1381): 12/17/24 11:18:29:242 CheckOCSP: Retrieve Issuer at chain index = 1
(P10460-T7764)Debug(1391): 12/17/24 11:18:29:242 issuer retrieved from sk:
(P10460-T7764)Debug(2439): 12/17/24 11:18:29:242 certificate: /C=US/O=DigiCert Inc/OU=[www.digicert.com/CN=DigiCert](https://www.digicert.com/CN%3DDigiCert) Global Root G2
(P10460-T7764)Debug(2440): 12/17/24 11:18:29:242 issuer: /C=US/O=DigiCert Inc/OU=[www.digicert.com/CN=DigiCert](https://www.digicert.com/CN%3DDigiCert) Global Root G2

(P10460-T7764)Debug(1413): 12/17/24 11:18:29:242 ocsp uri=<http://ocsp.digicert.com>
...
(P10460-T7764)Dump ( 804): 12/17/24 11:18:29:242 ocsp.digicert.com is fqdn
(P10460-T7764)Debug( 316): 12/17/24 11:18:29:242 host is FQDN: ocsp.digicert.com
...
(P10460-T7764)Debug( 114): 12/17/24 11:18:29:313 ocsp socket=1908, status=-1
(P10460-T7764)Debug( 923): 12/17/24 11:18:30:642 **Responder error message=Responder Error: unauthorized (6)**

(P10460-T7764)Debug(1079): 12/17/24 11:18:30:643 certificate valid time information (Issuer: Not Before[Aug  1 12:00:00 2013 GMT]; Not After[Jan 15 12:00:00 2038 GMT]; Cert: Not Before[May 30 00:00:00 2024 GMT]; Not After[Jun 30 23:59:59 2025 GMT];)
(P10460-T7764)Debug(1423): 12/17/24 11:18:30:643 ocsp parse result=0, status=2 reason=0
(P10460-T7764)Info (1646): 12/17/24 11:18:30:643 len=66
(P10460-T7764)Info (1646): 12/17/24 11:18:30:643 len=66
(P10460-T7764)Debug(1673): 12/17/24 11:18:30:643 **total 2 crl distribution points in certificate.**
(P10460-T7764)Debug(1807): 12/17/24 11:18:30:643 FIPS-CC cert check: KeyUsage for crl sign purpose checked okay..
...
(P10460-T7764)Dump ( 804): 12/17/24 11:18:30:793 crl3.digicert.com is fqdn
(P10460-T7764)Debug( 316): 12/17/24 11:18:30:793 **host is FQDN: crl3.digicert.com**
...
(P10460-T7764)Debug(1840): 12/17/24 11:18:30:878 received: HTTP/1.1 200 OK

(P10460-T7764)Error(1881): 12/17/24 11:18:30:879 invalid Content-Length.
(P10460-T7764)Debug(1947): 12/17/24 11:18:30:879 **incorrect http status or invalid content length.**
(P10460-T7764)Debug(1710): 12/17/24 11:18:30:879 crl downloading returns -7
(P10460-T7764)Debug(1738): 12/17/24 11:18:30:879 failed to download the crl file.
...
(P10460-T7764)Debug( 316): 12/17/24 11:18:31:031 **host is FQDN: crl4.digicert.com**
(P10460-T7764)Dump ( 858): 12/17/24 11:18:31:032 crl4.digicert.com is not resolved to an ipv6
...
(P10460-T7764)Debug(1840): 12/17/24 11:18:31:137 received: HTTP/1.1 200 OK

(P10460-T7764)Error(1881): 12/17/24 11:18:31:139 invalid Content-Length.
(P10460-T7764)Debug(1947): 12/17/24 11:18:31:139 **incorrect http status or invalid content length.**
(P10460-T7764)Debug(1710): 12/17/24 11:18:31:140 crl downloading returns -7
(P10460-T7764)Debug(1738): 12/17/24 11:18:31:140 failed to download the crl file.
(P10460-T7764)Debug(1573): 12/17/24 11:18:31:140 crl cert check result=-1
(P10460-T7764)Error(14001): 12/17/24 11:18:31:140 **Failed validation of the X509v3 certificate. Read/Access OCSP or CRL failed.**

Take a packet capture to see the order of the certificate chain in the TLS Handshake between the GP App and GP Portal/Gateway. In this example, the packet capture shows an out-of-order certificate chain in the TLS handshake:

* + Leaf/Server Cert
  + **Root CA**
  + **Intermediate**

**When a certificate chain is out-of-order, the OCSP Request will have wrong information about the Issuer, and also CRL will fail because the GP App will use the wrong certificate to check it**

**Solution: The certificate chain order should be the following. Push the certificate chain in order from the GP Portal/Gateway**

* + Leaf/Server certificate
  + Intermediate CA (if there are multiple Intermediate, they should be in order as well)
  + Root CA

##### Other users also viewed:

Actions

* Print
* Copy Link

  https://knowledgebase.paloaltonetworks.com/KCSArticleDetail?id=kA14u000000HEeVCAW&refURL=http%3A%2F%2Fknowledgebase.paloaltonetworks.com%2FKCSArticleDetail

Choose Language English
Chinese (Simplified)
French
German
Japanese
Korean
Spanish



=== Content from vimeo.com_7f7ce8b3_20250115_120047.html ===


# Verify to continue

To continue, please confirm that you're a human (and not a spambot).

## Checking if the site connection is secure

vimeo.com needs to review the security of your connection before
proceeding.



=== Content from support.paloaltonetworks.com_25be5225_20250115_180802.html ===


## Filter your Results

# **Results** For '' across Palo Alto Networks.

## Still Can't find a solution?

### Ask a Question

Head over the our LIVE Community and get some answers!

[![live](/Images/live-mini-icon.svg)Ask a Question ›](https://live.paloaltonetworks.com/t5/Customers/ct-p/support)

### Create a Case

Let us know how we can help and one of our specialists will be in touch!

[![case](/Images/case-mini-icon.svg)File a case ›](https://support.paloaltonetworks.com/Home/AccountSelector?TargetResource%3Dhttps%3A%2F%2Fsso.paloaltonetworks.com%2Fapp%2Fpanw-ciam_sfdcprodcasecommunities_1%2Fexk3jjv9xQhNTsmhF0j6%2Fsso%2Fsaml%3FRelayState%3Dhttps%253A%252F%252Fsupportcases.paloaltonetworks.com%252Fs%252Fgethelp)



=== Content from support.paloaltonetworks.com_1b49f74e_20250115_180758.html ===

[![](https://marketplace-images-pan.s3.us-west-2.amazonaws.com/orangBlackLogo.png)](https://www.paloaltonetworks.com/)

![](https://marketplace-images-pan.s3.us-west-2.amazonaws.com/orange-backdrop-new3.png)

## Cookies are required

Cookies are disabled on your browser. Please enable Cookies and refresh this page.

[Refresh](.)

![Palo Alto Networks](https://sso.paloaltonetworks.com/fs/bco/1/fs08ykaqtm4jZfxqB0j6)

## The page has timed out

If this page does not reload automatically, please refresh your browser.

By signing in, you agree to our
[Terms](https://www.paloaltonetworks.com/legal-notices/terms-of-use)
and acknowledge our
[Privacy Statement](https://www.paloaltonetworks.com/legal-notices/privacy).

[![](https://marketplace-images-pan.s3.us-west-2.amazonaws.com/orangBlackLogo.png)](https://www.paloaltonetworks.com/)

### Company

* [About Palo Alto Networks](https://www.paloaltonetworks.com/company)
* [Careers](https://www.paloaltonetworks.com/company/careers)

### Legal Notices

* [Privacy](https://www.paloaltonetworks.com/legal-notices/privacy)
* [Terms of Use](https://www.paloaltonetworks.com/legal-notices/terms-of-use)

### Resources

* [Support](https://live.paloaltonetworks.com/t5/custom/page/page-id/Support)
* [Live Community](https://live.paloaltonetworks.com/)
* [Email Subscription](https://www.paloaltonetworks.com/company/subscriptions)
* [Beacon](https://beacon.exceedlms.com/student/catalog)

* [path fill-rule="evenodd" clip-rule="evenodd" d="M27.7 27.4c0 .883-.674 1.6-1.505 1.6H1.938c-.83 0-1.504-.717-1.504-1.6V1.6c0-.884.673-1.6 1.504-1.6h24.257c.83 0 1.505.716 1.505 1.6v25.8zm-8.453-9.63V29h-4.25V17.77h-3.553v-4.377h3.554v-3.228c0-3.745 2.15-5.785 5.292-5.785 1.505 0 2.799.12 3.175.172v3.915h-2.179c-1.708 0-2.039.864-2.039 2.132v2.794h4.075l-.53 4.377h-3.545z"/>](https://www.linkedin.com/company/palo-alto-networks)

© Palo Alto Networks, Inc. All rights reserved.



=== Content from vimeo.com_f30ed3b6_20250115_120047.html ===


# Verify to continue

To continue, please confirm that you're a human (and not a spambot).

## Checking if the site connection is secure

vimeo.com needs to review the security of your connection before
proceeding.



=== Content from github.com_a05fd65a_20250114_201212.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FAmberWolfCyber%2FNachoVPN)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FAmberWolfCyber%2FNachoVPN)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E&source=header-repo&source_repo=AmberWolfCyber%2FNachoVPN)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[AmberWolfCyber](/AmberWolfCyber)
/
**[NachoVPN](/AmberWolfCyber/NachoVPN)**
Public

* [Notifications](/login?return_to=%2FAmberWolfCyber%2FNachoVPN) You must be signed in to change notification settings
* [Fork
  26](/login?return_to=%2FAmberWolfCyber%2FNachoVPN)
* [Star
   195](/login?return_to=%2FAmberWolfCyber%2FNachoVPN)

A delicious, but malicious SSL-VPN server 🌮

### License

[MIT license](/AmberWolfCyber/NachoVPN/blob/main/LICENSE)

[195
stars](/AmberWolfCyber/NachoVPN/stargazers) [26
forks](/AmberWolfCyber/NachoVPN/forks) [Branches](/AmberWolfCyber/NachoVPN/branches) [Tags](/AmberWolfCyber/NachoVPN/tags) [Activity](/AmberWolfCyber/NachoVPN/activity)
 [Star](/login?return_to=%2FAmberWolfCyber%2FNachoVPN)

 [Notifications](/login?return_to=%2FAmberWolfCyber%2FNachoVPN) You must be signed in to change notification settings

* [Code](/AmberWolfCyber/NachoVPN)
* [Issues
  1](/AmberWolfCyber/NachoVPN/issues)
* [Pull requests
  0](/AmberWolfCyber/NachoVPN/pulls)
* [Actions](/AmberWolfCyber/NachoVPN/actions)
* [Projects
  0](/AmberWolfCyber/NachoVPN/projects)
* [Security](/AmberWolfCyber/NachoVPN/security)
* [Insights](/AmberWolfCyber/NachoVPN/pulse)

Additional navigation options

* [Code](/AmberWolfCyber/NachoVPN)
* [Issues](/AmberWolfCyber/NachoVPN/issues)
* [Pull requests](/AmberWolfCyber/NachoVPN/pulls)
* [Actions](/AmberWolfCyber/NachoVPN/actions)
* [Projects](/AmberWolfCyber/NachoVPN/projects)
* [Security](/AmberWolfCyber/NachoVPN/security)
* [Insights](/AmberWolfCyber/NachoVPN/pulse)

# AmberWolfCyber/NachoVPN

    main[Branches](/AmberWolfCyber/NachoVPN/branches)[Tags](/AmberWolfCyber/NachoVPN/tags)Go to fileCode
## Folders and files

| Name | | Name | Last commit message | Last commit date |
| --- | --- | --- | --- | --- |
| Latest commit History[7 Commits](/AmberWolfCyber/NachoVPN/commits/main/) | | |
| [.github/workflows](/AmberWolfCyber/NachoVPN/tree/main/.github/workflows "This path skips through empty directories") | | [.github/workflows](/AmberWolfCyber/NachoVPN/tree/main/.github/workflows "This path skips through empty directories") |  |  |
| [src/nachovpn](/AmberWolfCyber/NachoVPN/tree/main/src/nachovpn "This path skips through empty directories") | | [src/nachovpn](/AmberWolfCyber/NachoVPN/tree/main/src/nachovpn "This path skips through empty directories") |  |  |
| [.gitignore](/AmberWolfCyber/NachoVPN/blob/main/.gitignore ".gitignore") | | [.gitignore](/AmberWolfCyber/NachoVPN/blob/main/.gitignore ".gitignore") |  |  |
| [Dockerfile](/AmberWolfCyber/NachoVPN/blob/main/Dockerfile "Dockerfile") | | [Dockerfile](/AmberWolfCyber/NachoVPN/blob/main/Dockerfile "Dockerfile") |  |  |
| [LICENSE](/AmberWolfCyber/NachoVPN/blob/main/LICENSE "LICENSE") | | [LICENSE](/AmberWolfCyber/NachoVPN/blob/main/LICENSE "LICENSE") |  |  |
| [MANIFEST.in](/AmberWolfCyber/NachoVPN/blob/main/MANIFEST.in "MANIFEST.in") | | [MANIFEST.in](/AmberWolfCyber/NachoVPN/blob/main/MANIFEST.in "MANIFEST.in") |  |  |
| [README.md](/AmberWolfCyber/NachoVPN/blob/main/README.md "README.md") | | [README.md](/AmberWolfCyber/NachoVPN/blob/main/README.md "README.md") |  |  |
| [docker-compose.yml](/AmberWolfCyber/NachoVPN/blob/main/docker-compose.yml "docker-compose.yml") | | [docker-compose.yml](/AmberWolfCyber/NachoVPN/blob/main/docker-compose.yml "docker-compose.yml") |  |  |
| [entrypoint.sh](/AmberWolfCyber/NachoVPN/blob/main/entrypoint.sh "entrypoint.sh") | | [entrypoint.sh](/AmberWolfCyber/NachoVPN/blob/main/entrypoint.sh "entrypoint.sh") |  |  |
| [logo.png](/AmberWolfCyber/NachoVPN/blob/main/logo.png "logo.png") | | [logo.png](/AmberWolfCyber/NachoVPN/blob/main/logo.png "logo.png") |  |  |
| [requirements.txt](/AmberWolfCyber/NachoVPN/blob/main/requirements.txt "requirements.txt") | | [requirements.txt](/AmberWolfCyber/NachoVPN/blob/main/requirements.txt "requirements.txt") |  |  |
| [setup.py](/AmberWolfCyber/NachoVPN/blob/main/setup.py "setup.py") | | [setup.py](/AmberWolfCyber/NachoVPN/blob/main/setup.py "setup.py") |  |  |
| View all files | | |

## Repository files navigation

* README
* MIT license
# NachoVPN 🌮🔒

[![](/AmberWolfCyber/NachoVPN/raw/main/logo.png)](/AmberWolfCyber/NachoVPN/blob/main/logo.png)

[![](https://camo.githubusercontent.com/6cd0120cc4c5ac11d28b2c60f76033b52db98dac641de3b2644bb054b449d60c/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f4c6963656e73652d4d49542d79656c6c6f772e737667)](/AmberWolfCyber/NachoVPN/blob/main/LICENSE)
[![](https://github.com/AmberWolfCyber/NachoVPN/actions/workflows/build-docker.yml/badge.svg)](https://github.com/AmberWolfCyber/NachoVPN/actions/workflows)

NachoVPN is a Proof of Concept that demonstrates exploitation of SSL-VPN clients, using a rogue VPN server.

It uses a plugin-based architecture so that support for additional SSL-VPN products can be contributed by the community. It currently supports various popular corporate VPN products, such as Cisco AnyConnect, SonicWall NetExtender, Palo Alto GlobalProtect, and Ivanti Connect Secure.

For further details, see our [blog post](https://blog.amberwolf.com/blog/2024/november/introducing-nachovpn---one-vpn-server-to-pwn-them-all/), and HackFest Hollywood 2024 presentation [[slides](https://github.com/AmberWolfCyber/presentations/blob/main/2024/Very%20Pwnable%20Networks%20-%20HackFest%20Hollywood%202024.pdf)|[video](https://www.youtube.com/watch?v=-MZfkmcZRVg)].

## Installation

### Prerequisites

* Python 3.9 or later
* Docker (optional)
* osslsigncode (Linux only)
* msitools (Linux only)
* git (optional)

### Installing from source

NachoVPN can be installed from GitHub using pip. Note that this requires git to be installed.

First, create a virtual environment. On Linux, this can be done with:

```
python3 -m venv env
source env/bin/activate
```

On Windows, use:

```
python -m venv env
.\env\Scripts\activate
```

Then, install NachoVPN:

```
pip install git+https://github.com/AmberWolfCyber/NachoVPN.git
```

If you prefer to use Docker, then you can pull the container from the GitHub Container Registry:

```
docker pull ghcr.io/amberwolfcyber/nachovpn:release
```

## Building for distribution

### Building a wheel file

First, clone this repository, and install `setuptools` and `wheel` via pip. You can then run the `setup.py` script:

```
git clone https://github.com/AmberWolfCyber/NachoVPN
pip install -U setuptools wheel
python setup.py bdist_wheel
```

This will generate a wheel file in the `dist` directory, which can be installed with pip:

```
pip install dist/nachovpn-1.0.0-py3-none-any.whl
```

### Building for local development

Alternatively, for local development you can install the package in editable mode using:

```
pip install -e .
```

### Building a container image

You can build the container image with the following command:

```
docker build -t nachovpn:latest .
```

## Running

To run the server as standalone, use:

```
python -m nachovpn.server

```

Alternatively, you can run the server using Docker:

```
docker run -e SERVER_FQDN=connect.nachovpn.local -e EXTERNAL_IP=1.2.3.4 -v ./certs:/app/certs -p 80:80 -p 443:443 --rm -it nachovpn
```

This will generate a certificate for the `SERVER_FQDN` using certbot, and save it to the `certs` directory, which we've mounted into the container.

Alternatively, for testing purposes, you can skip the certificate generation by setting the `SKIP_CERTBOT` environment variable.

This will generate a self-signed certificate instead.

```
docker run -e SERVER_FQDN=connect.nachovpn.local -e SKIP_CERTBOT=1 -e EXTERNAL_IP=1.2.3.4 -p 443:443 --rm -it nachovpn
```

An example [docker-compose file](/AmberWolfCyber/NachoVPN/blob/main/docker-compose.yml) is also provided for convenience.

### Debugging

You can run `nachovpn` with the `-d` or `--debug` command line arguments in order to increase the verbosity of logging, which can aid in debugging.

Alternatively, if the logging is too noisy, you can use the `q` or `--quiet` command line argument instead.

### Plugins

NachoVPN supports the following plugins and capabilities:

| Plugin | Product | CVE | Windows RCE | macOS RCE | Privileged | URI Handler | Packet Capture | Demo |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |
| Cisco | Cisco AnyConnect | N/A | ✅ | ✅ | ❌ | ❌ | ✅ | [Windows](https://vimeo.com/1024773762) / [macOS](https://vimeo.com/1024773668) |
| SonicWall | SonicWall NetExtender | [CVE-2024-29014](https://blog.amberwolf.com/blog/2024/november/sonicwall-netextender-for-windows---rce-as-system-via-epc-client-update-cve-2024-29014/) | ✅ | ❌ | ✅ | ✅ | ❌ | [Windows](https://vimeo.com/1024774407) |
| PaloAlto | Palo Alto GlobalProtect | [CVE-2024-5921](https://blog.amberwolf.com/blog/2024/november/palo-alto-globalprotect---code-execution-and-privilege-escalation-via-malicious-vpn-server-cve-2024-5921/) (partial fix) | ✅ | ✅ | ✅ | ❌ | ✅ | [Windows](https://vimeo.com/1024774239) / [macOS](https://vimeo.com/1024773987) / [iOS](https://vimeo.com/1024773956) |
| PulseSecure | Ivanti Connect Secure | N/A | ✅ | ✅ | ❌ | ✅ (Windows only) | ✅ | [Windows](https://vimeo.com/1024773914) |

#### URI handlers

* The Ivanti Connect Secure (Pulse Secure) URI handler can be triggered by visiting the `/pulse` URL on the NachoVPN server.
* The SonicWall NetExtender URI handler can be triggered by visiting the `/sonicwall` URL on the NachoVPN server. This requires that the SonicWall Connect Agent is installed on the client machine.

#### Operating Notes

* It is recommended to use a TLS certificate that is signed by a trusted Certificate Authority. The docker container automates this process for you, using certbot. If you do not use a trusted certificate, then NachoVPN will generate a self-signed certificate instead, which in most cases will either cause the client to prompt with a certificate warning, or it will refuse to connect unless you modify the client settings to accept self-signed certificates. For the Palo Alto GlobalProtect plugin, this will also cause the MSI installer to fail.
* In order to simulate a valid codesigning certificate for the SonicWall plugin, NachoVPN will sign the `NACAgent.exe` payload with a self-signed certificate. For testing purposes, you can download and install this CA certificate from `/sonicwall/ca.crt` before triggering the exploit. For production use-cases, you will need to obtain a valid codesigning certificate from a public CA, sign your `NACAgent.exe` payload, and place it in the `payloads` directory (or volume mount it into `/app/payloads`, if using docker).
* For convenience, a default `NACAgent.exe` payload is generated for the SonicWall plugin, and written to the `payloads` directory. This simply spawns a new `cmd.exe` process on the current user's desktop, running as `SYSTEM`.
* The Palo Alto GlobalProtect plugin requires that the MSI installers and `msi_version.txt` file are present in the `downloads` directory. Either add these manually, or run the `msi_downloader.py` script to download them.

#### Disabling a plugin

To disable a plugin, add it to the `DISABLED_PLUGINS` environment variable. For example:

```
DISABLED_PLUGINS=CiscoPlugin,SonicWallPlugin
```

### Environment Variables

NachoVPN is configured using environment variables. This makes it easily compatible with containerised deployments.

Global environment variables:

| Variable | Description | Default |
| --- | --- | --- |
| `SERVER_FQDN` | The fully qualified domain name of the server. | `connect.nachovpn.local` |
| `EXTERNAL_IP` | The external IP address of the server. | `127.0.0.1` |
| `WRITE_PCAP` | Whether to write captured PCAP files to disk. | `false` |
| `DISABLED_PLUGINS` | A comma-separated list of plugins to disable. |  |
| `USE_DYNAMIC_SERVER_THUMBPRINT` | Whether to calculate the server certificate thumbprint dynamically from the server (useful if behind a proxy). | `false` |
| `SERVER_SHA1_THUMBPRINT` | Allows overriding the calculated SHA1 thumbprint for the server certificate. |  |
| `SERVER_MD5_THUMBPRINT` | Allows overriding the calculated MD5 thumbprint for the server certificate. |  |

Plugin specific environment variables:

| Variable | Description | Default |
| --- | --- | --- |
| `VPN_NAME` | The name of the VPN profile, which is presented to the client for Cisco AnyConnect. | `NachoVPN` |
| `PULSE_LOGON_SCRIPT` | The path to the Pulse Secure logon script. | `C:\Windows\System32\calc.exe` |
| `PULSE_LOGON_SCRIPT_MACOS` | The path to the Pulse Secure logon script for macOS. |  |
| `PULSE_DNS_SUFFIX` | The DNS suffix to be used for Pulse Secure connections. | `nachovpn.local` |
| `PULSE_USERNAME` | The username to be pre-filled in the Pulse Secure logon dialog. |  |
| `PULSE_SAVE_CONNECTION` | Whether to save the Pulse Secure connection in the user's client. | `false` |
| `PULSE_ANONYMOUS_AUTH` | Whether to use anonymous authentication for Pulse Secure connections. If set to `true`, the user will not be prompted for a username or password. | `false` |
| `PALO_ALTO_MSI_ADD_FILE` | The path to a file to be added to the Palo Alto installer MSI. |  |
| `PALO_ALTO_MSI_COMMAND` | The command to be executed by the Palo Alto installer MSI. | `net user pwnd Passw0rd123! /add && net localgroup administrators pwnd /add` |
| `PALO_ALTO_FORCE_PATCH` | Whether to force the patching of the MSI installer if it already exists in the payloads directory. | `false` |
| `PALO_ALTO_PKG_COMMAND` | The command to be executed by the Palo Alto installer PKG on macOS. | `touch /tmp/pwnd` |
| `CISCO_COMMAND_WIN` | The command to be executed by the Cisco AnyConnect OnConnect.vbs script on Windows. | `calc.exe` |
| `CISCO_COMMAND_MACOS` | The command to be executed by the Cisco AnyConnect OnConnect.sh script on macOS. | `touch /tmp/pwnd` |

## Mitigations

We recommend the following mitigations:

* Ensure SSL-VPN clients are updated to the latest version available from the vendor.
* Most VPN clients support the concept of locking down the VPN profile to a specific endpoint, or using an always-on VPN mode. This should be enabled where possible.
* Unfortunately, in some cases this lockdown can be removed by a malicious local user, therefore it is also recommended to use host-based firewall rules to restrict the IP addresses that the VPN client can communicate with.
* Consider using an Application Control policy, such as WDAC, or an EDR solution to ensure that only approved executables and scripts can be executed by the VPN client.
* Detect and alert on VPN clients executing non-standard child processes.

## References

* [AmberWolf Blog: NachoVPN](https://blog.amberwolf.com/blog/2024/november/introducing-nachovpn---one-vpn-server-to-pwn-them-all/)
* [HackFest Hollywood 2024: Very Pwnable Networks: Exploiting the Top Corporate VPN Clients for Remote Root and SYSTEM Shells, Rich Warren & David Cash](https://github.com/AmberWolfCyber/presentations/blob/main/2024/Very%20Pwnable%20Networks%20-%20HackFest%20Hollywood%202024.pdf) [[video](https://www.youtube.com/watch?v=-MZfkmcZRVg)]
* [BlackHat 2008: Leveraging the Edge: Abusing SSL VPNs, Mike Zusman](https://www.blackhat.com/presentations/bh-usa-08/Zusman/BH_US_08_Zusman_SSL_VPN_Abuse.pdf)
* [BlackHat 2019: Infiltrating Corporate Intranet Like NSA, Orange Tsai & Meh Chang](https://i.blackhat.com/USA-19/Wednesday/us-19-Tsai-Infiltrating-Corporate-Intranet-Like-NSA.pdf)
* [NCC Group: Making New Connections: Leveraging Cisco AnyConnect Client to Drop and Run Payloads, David Cash & Julian Storr](https://www.nccgroup.com/uk/research-blog/making-new-connections-leveraging-cisco-anyconnect-client-to-drop-and-run-payloads/)
* [The OpenConnect Project](https://www.infradead.org/openconnect/)

## Contributing

We welcome contributions! Please open an issue or raise a Pull Request.

If you're interested in developing a new plugin, you can take a look at the [ExamplePlugin](/AmberWolfCyber/NachoVPN/blob/main/src/nachovpn/plugins/example/plugin.py) to get started.

## License

NachoVPN is licensed under the MIT license. See the [LICENSE](/AmberWolfCyber/NachoVPN/blob/main/LICENSE) file for details.

## About

A delicious, but malicious SSL-VPN server 🌮

### Resources

[Readme](#readme-ov-file)
### License

[MIT license](#MIT-1-ov-file)

[Activity](/AmberWolfCyber/NachoVPN/activity)
[Custom properties](/AmberWolfCyber/NachoVPN/custom-properties)
### Stars

[**195**
stars](/AmberWolfCyber/NachoVPN/stargazers)
### Watchers

[**4**
watching](/AmberWolfCyber/NachoVPN/watchers)
### Forks

[**26**
forks](/AmberWolfCyber/NachoVPN/forks)
[Report repository](/contact/report-content?content_url=https%3A%2F%2Fgithub.com%2FAmberWolfCyber%2FNachoVPN&report=AmberWolfCyber+%28user%29)

## [Releases](/AmberWolfCyber/NachoVPN/releases)

No releases published

## [Packages 0](/orgs/AmberWolfCyber/packages?repo_name=NachoVPN)

## Languages

* [Python
  75.0%](/AmberWolfCyber/NachoVPN/search?l=python)
* [HTML
  22.2%](/AmberWolfCyber/NachoVPN/search?l=html)
* [C
  1.7%](/AmberWolfCyber/NachoVPN/search?l=c)
* Other
  1.1%

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from security.paloaltonetworks.com_7cc49e60_20250115_180800.html ===


* [Get support](https://support.paloaltonetworks.com/support)
* [Security advisories](/)
* [Report vulnerabilities](/report)
* [Bug Bounty](/scope)
* [Subscribe](https://support.paloaltonetworks.com/SupportAccount/Preferences)
* [RSS feed](/rss.xml)
[Palo Alto Networks Security Advisories](/) /
CVE-2024-5921
## CVE-2024-5921 GlobalProtect App: Insufficient Certificate Validation Leads to Privilege Escalation

Urgency
MODERATE
047910
[Severity
5.6 ·
MEDIUM](https://www.first.org/cvss/calculator/4.0#CVSS:4.0/AV:A/AC:L/AT:P/PR:N/UI:P/VC:N/VI:H/VA:N/SC:H/SI:H/SA:H/E:P/AU:N/R:U/V:D/RE:M/U:Amber "CVSS-BT: CVSS:4.0/AV:A/AC:L/AT:P/PR:N/UI:P/VC:N/VI:H/VA:N/SC:H/SI:H/SA:H/E:P/AU:N/R:U/V:D/RE:M/U:Amber")Exploit Maturity
**POC**Response Effort
**MODERATE**Recovery
**USER**Value Density
**DIFFUSE**Attack Vector
**ADJACENT**Attack Complexity
**LOW**Attack Requirements
**PRESENT**Automatable
**NO**User Interaction
**PASSIVE**Product Confidentiality
**NONE**Product Integrity
**HIGH**Product Availability
**NONE**Privileges Required
**NONE**Subsequent Confidentiality
**HIGH**Subsequent Integrity
**HIGH**Subsequent Availability
**HIGH**[CVE](https://www.cve.org/CVERecord?id=CVE-2024-5921 "See CVE.org record")
[JSON](/json/CVE-2024-5921 "Download the information in this advisory in CVE-JSON format")
[CSAF](/csaf/CVE-2024-5921 "Download the information in this advisory in CSAF format")

 Published
**2024-11-26** Updated
**2025-01-13**Reference
**GPC-19860,
GPC-19861**Discovered
**externally**
### Description

An insufficient certification validation issue in the Palo Alto Networks GlobalProtect app enables attackers to connect the GlobalProtect app to arbitrary servers. This can enable a local non-administrative operating system user or an attacker on the same subnet to install malicious root certificates on the endpoint and subsequently install malicious software signed by the malicious root certificates on that endpoint.

Please subscribe to [our RSS feed](https://security.paloaltonetworks.com/rss.xml) to be alerted to new updates to this and other advisories.

### Product Status

| Versions | Affected | Unaffected |
| GlobalProtect App | All on Windows UWP | None on Windows UWP |
| GlobalProtect App 6.3 | < 6.3.2\* on Windows< 6.3.2\* on macOS | >= 6.3.2\* on Windows>= 6.3.2\* on macOS |
| GlobalProtect App 6.2 | < 6.2.6\* on Windows< 6.2.6-HF\* on macOS< 6.2.1-HF2\* on Linux | >= 6.2.6\* on Windows>= 6.2.6-HF\* on macOS (ETA: middle of Jan)>= 6.2.1-HF2\* on Linux (ETA: end of Jan) |
| GlobalProtect App 6.1 | All on WindowsAll on macOSAll on Linux< 6.1.6\* on Android< 6.1.7\* on iOS | None on WindowsNone on macOSNone on Linux>= 6.1.6\* on Android (ETA: end of Jan)>= 6.1.7\* on iOS (ETA: end of Jan) |

\* In addition to the software updates listed above, additional steps are required to protect against this vulnerability. See the Solution section for full details.

### Required Configuration for Exposure

No special configuration is required to be affected by this issue.

### Severity: MEDIUM, Suggested Urgency: MODERATE

An attacker on the same subnet as an end user who can influence DNS traffic can cause the user to connect to a malicious GlobalProtect portal.
CVSS-BT:
5.6 /
CVSS-B:
7.2 ([CVSS:4.0/AV:A/AC:L/AT:P/PR:N/UI:P/VC:N/VI:H/VA:N/SC:H/SI:H/SA:H/E:P/AU:N/R:U/V:D/RE:M/U:Amber](https://www.first.org/cvss/calculator/4.0#CVSS:4.0/AV:A/AC:L/AT:P/PR:N/UI:P/VC:N/VI:H/VA:N/SC:H/SI:H/SA:H/E:P/AU:N/R:U/V:D/RE:M/U:Amber))

A local user with non-administrative privileges connects to a malicious GlobalProtect portal.
CVSS-BT:
5.6 /
CVSS-B:
7.1 ([CVSS:4.0/AV:L/AC:L/AT:P/PR:L/UI:N/VC:N/VI:H/VA:N/SC:H/SI:H/SA:H/E:P/AU:N/R:U/V:D/RE:M/U:Amber](https://www.first.org/cvss/calculator/4.0#CVSS:4.0/AV:L/AC:L/AT:P/PR:L/UI:N/VC:N/VI:H/VA:N/SC:H/SI:H/SA:H/E:P/AU:N/R:U/V:D/RE:M/U:Amber))

### Exploitation Status

Palo Alto Networks is not aware of any malicious exploitation of this issue. We are aware of a publicly available conference talk and blog posts discussing this issue. A proof of concept for this issue is also publicly available.

### Weakness Type and Impact

[CWE-295 Improper Certificate Validation](https://cwe.mitre.org/data/definitions/295 "More at https://cwe.mitre.org/data/definitions/295")

[CAPEC-233 Privilege Escalation](https://capec.mitre.org/data/definitions/233 "More at https://capec.mitre.org/data/definitions/233")

### Solution

This issue is fixed in GlobalProtect app 6.2.6 on Windows, GlobalProtect app 6.3.2 on Windows and macOS, and all later GlobalProtect app versions. Additional fixes are under development and will be made available for the remaining platforms (Linux, iOS, and Android).

The fix for this vulnerability requires three steps:

1. Ensure that all of your GlobalProtect portals use TLS certificate chains that meet the criteria specified in the "FIPS-CC Certification Validation" table in [our documentation](https://docs.paloaltonetworks.com/globalprotect/10-1/globalprotect-admin/certifications/resolve-fips-cc-mode-issues).
2. Ensure that the TLS certificate chains used by the GlobalProtect portals are added to the root certificate store in your operating system.
3. Install a fixed version of GlobalProtect using one of the deployment options below. This setting enforces strict X.509v3 verification checks on the certificate provided by the GlobalProtect portal.

Note: Prisma Access customers using portals with a \*.gpcloudservice.com domain name already have valid TLS certificate chains. The root certificate for these portals is from GoDaddy, which is trusted by default in Windows, macOS, RHEL, Ubuntu, iOS, and Android. Therefore, Prisma Access customers using a GlobalProtect portal with a \*.gpcloudservice.com domain name should only need to perform step 3 above.

**Important**: If your GlobalProtect portals do not use valid X.509V3 TLS certificate chains, this will result in TLS verification failures. To generate a GlobalProtect portal certificate that can be used with a fixed version of GlobalProtect app, refer to the first "FIPS-CC Certification Validation" table in [our documentation](https://docs.paloaltonetworks.com/globalprotect/10-1/globalprotect-admin/certifications/resolve-fips-cc-mode-issues).

**Warning: Performance Concern:** Some customers reported problems connecting to Portals and Gateways when this solution was implemented in certain situations. This is due to certificate providers that rate limit requests for Online Certificate Status Protocol (OCSP) and certificate revocation list (CRL) checks. This happens when multiple users connect to GlobalProtect Portals from a single public IP (such as NAT) around the same time, such as when hundreds or thousands of end users connect around the start of a workday from a single office.

**Solution for new and existing GlobalProtect app installations on Windows**

Customers can use their endpoint mobile device management (MDM) tools to apply the following changes.

1. Install a fixed version of GlobalProtect app.
2. Update the following registry key with the specified recommended values (these values have the REG\_SZ type):
   [HKEY\_LOCAL\_MACHINE\SOFTWARE\Palo Alto Networks\GlobalProtect\Settings]
   "cert-store"="machine"
   "cert-location"="ROOT"
   "full-chain-cert-verify"="yes"
3. To apply this registry change, restart Windows.

**Alternate solution for new GlobalProtect app installations on Windows**

Install the GlobalProtect app with the pre-deployment key FULLCHAINCERTVERIFY set to Yes:

> msiexec.exe /i GlobalProtect64.msi FULLCHAINCERTVERIFY="yes"

Note: This command will add the registry values listed in the previous section (no additional MSI options are needed).
**Solution for new and existing GlobalProtect app installations on macOS**

1. Install a fixed version of the GlobalProtect app.
2. [Use Xcode to edit the com.paloaltonetworks.GlobalProtect.settings.plist file](https://docs.paloaltonetworks.com/globalprotect/10-1/globalprotect-admin/globalprotect-apps/deploy-app-settings-transparently/deploy-app-settings-to-mac-endpoints/deploy-app-settings-in-the-mac-plist) in /Library/Preferences.
3. Add a "Settings" section if it does not exist within the GlobalProtect section.
4. Within the "Settings" section, add the full-chain-cert-verify key and set the string value to yes.
   <key>GlobalProtect</key>
   <dict>
       (removed for brevity)
   **<key>Settings</key>**
   **<dict>**
   **<key>full-chain-cert-verify</key>**
   **<string>yes</string>**
   **</dict>**
   </dict>
5. Restart macOS.

### Workarounds and Mitigations

You can mitigate this issue for all platforms ([Windows](https://docs.paloaltonetworks.com/globalprotect/10-1/globalprotect-admin/certifications/enable-and-verify-fips-cc-mode/enable-fips-cc-mode-using-the-windows-registry), [macOS](https://docs.paloaltonetworks.com/globalprotect/10-1/globalprotect-admin/certifications/enable-and-verify-fips-cc-mode/enable-fips-cc-mode-using-the-macos-property-list), [Linux](https://docs.paloaltonetworks.com/globalprotect/10-1/globalprotect-admin/certifications/enable-and-verify-fips-cc-mode/enable-fips-cc-mode-on-linux-endpoints-redhat), [iOS](https://docs.paloaltonetworks.com/globalprotect/10-1/globalprotect-admin/certifications/enable-and-verify-fips-cc-mode/enable-and-verify-fips-cc-mode-using-workspaceone-on-ios-devices), [Android](https://docs.paloaltonetworks.com/globalprotect/10-1/globalprotect-admin/certifications/enable-and-verify-fips-cc-mode/enable-and-verify-fips-cc-mode-using-microsoft-intune-on-android-endpoints)) by using the GlobalProtect app 6.0 in FIPS-CC mode or GlobalProtect app 5.1 in FIPS-CC mode. For details, refer to the first "FIPS-CC Certification Validation" table in [our documentation](https://docs.paloaltonetworks.com/globalprotect/10-1/globalprotect-admin/certifications/resolve-fips-cc-mode-issues).

Note: this is separate from any FIPS-CC configurations on any GlobalProtect portals or gateways. This workaround is specific to FIPS-CC mode on the GlobalProtect app. GlobalProtect portals or gateways do not need to use FIPS-CC mode as part of this workaround.

### Acknowledgments

Palo Alto Networks thanks Maxime ESCOURBIAC, Michelin CERT, Yassine BENGANA, Abicom for Michelin CERT, and Richard Warren and David Cash of AmberWolf for discovering and reporting the issue."
### Frequently Asked Questions

#### Q. What does the fix for the GlobalProtect app on Windows do?

> The fix for this vulnerability adds three configuration options to the installer (CERTSTORE, CERTLOCATION, and FULLCHAINCERTVERIFY) and Windows registry (cert-store, cert-location, full-chain-cert-verify). Collectively, these options configure the GlobalProtect app to [enforce strict X.509v3 verification checks](https://docs.paloaltonetworks.com/globalprotect/10-1/globalprotect-admin/certifications/resolve-fips-cc-mode-issues) on the certificate chain provided by GlobalProtect portals. In addition, FIPS-CC certificate verification checks are now performed when connecting to GlobalProtect portals.
>
> Note: Documentation for the new installer options and registry settings will be published to the [Deploy App Settings to Windows Endpoints documentation](https://docs.paloaltonetworks.com/globalprotect/10-1/globalprotect-admin/globalprotect-apps/deploy-app-settings-transparently/deploy-app-settings-to-windows-endpoints).

#### Q. How do I troubleshoot issues with my TLS certificates?

> Refer to the "[Troubleshoot CVE-2024-5921 Issues](https://knowledgebase.paloaltonetworks.com/KCSArticleDetail?id=kA14u000000HEeVCAW)" knowledge base article.

#### Q. I use client-based certificate authentication. Am I affected?

> This is unrelated to client certificate authentication. This vulnerability is related to the TLS server certificate presented by the GlobalProtect portal.

#### Q. If I set "Allow User to Change Portal Address" in the GlobalProtect portal settings to "No", is that a valid workaround?

> No. This vulnerability can be exploited by an attacker who is not on the user's system. An attacker on the same subnet as a target user can influence DNS traffic on the subnet, causing the GlobalProtect app on the user's system to connect to a malicious GlobalProtect portal.

#### Q. Can I use FIPS-CC in a version of the GlobalProtect app other than GlobalProtect app 5.1 or GlobalProtect app 6.0?

> No. FIPS-CC is only certified for GlobalProtect app 5.1 and GlobalProtect app 6.0. A prior version of this advisory indicated that this was possible for versions other than GlobalProtect app 5.1 and GlobalProtect app 6.0. This has been corrected.

#### Q. I already installed GlobalProtect app 6.2.6 on Windows without the special MSI command line options. Do I have to re-install?

> No. Refer to the "Solution for new and existing GlobalProtect app installation on Windows" section for guidance on registry updates that you can apply after installing GlobalProtect app 6.2.6 on Windows.

#### Q. How do I know if I ran the MSI installer correctly?

> After installing, check the Windows registry under the HKEY\_LOCAL\_MACHINE\SOFTWARE\Palo Alto Networks\GlobalProtect\Settings key. If full-chain-cert-verify is set to "yes", the installer was run correctly.
>
>
> Note: Documentation for the new installer options and registry settings will be published to the [Deploy App Settings to Windows Endpoints documentation](https://docs.paloaltonetworks.com/globalprotect/10-1/globalprotect-admin/globalprotect-apps/deploy-app-settings-transparently/deploy-app-settings-to-windows-endpoints).

#### Q. If I'm using self-signed certificates in my GlobalProtect portals, will the GlobalProtect app still be affected?

> Yes. A software update listed in the Solution section is still required. If the self-signed certificate meets the criteria specified in the "FIPS-CC Certification Validation" table in [our documentation](https://docs.paloaltonetworks.com/globalprotect/10-1/globalprotect-admin/certifications/resolve-fips-cc-mode-issues), the self-signed certificate will be validated.

### Timeline

2025-01-13
Added planned fix version and ETA for 6.1 for Android2024-12-24
Updated product status table for GlobalProtect app 6.3.2 and added macOS solution2024-12-19
Updated ETAs for GlobalProtect app versions 6.3, 6.2, and 6.12024-12-16
Updated planned fix version and ETA for 6.3 for Windows and macOS2024-12-13
Added note to the solution about potential performance concern2024-12-06
Updated affected products, added ETAs, clarified solution, and added frequently asked questions2024-11-27
Added registry-based deployment option to solution, and added frequently asked questions2024-11-26
Clarified impact, solution, and added frequently asked questions2024-11-26
Initial publication[Terms of use](https://www.paloaltonetworks.com/legal-notices/terms-of-use)[Privacy](https://www.paloaltonetworks.com/legal-notices/privacy)[Product Security Assurance and Vulnerability Disclosure Policy](https://paloaltonetworks.com/product-security-assurance)[Report vulnerabilities](/report)[Manage subscriptions](https://support.paloaltonetworks.com/SupportAccount/Preferences)© 2025 Palo Alto Networks, Inc. All rights reserved.

=== Content from vimeo.com_909530d8_20250115_180759.html ===


# Verify to continue

To continue, please confirm that you're a human (and not a spambot).

## Checking if the site connection is secure

vimeo.com needs to review the security of your connection before
proceeding.



=== Content from vimeo.com_a8f0632c_20250115_120047.html ===


# Verify to continue

To continue, please confirm that you're a human (and not a spambot).

## Checking if the site connection is secure

vimeo.com needs to review the security of your connection before
proceeding.


