=== Content from lists.debian.org_d0d32a04_20250115_081845.html ===


---

[[Date Prev](msg00021.html)][[Date Next](msg00023.html)]
[[Thread Prev](msg00021.html)][[Thread Next](msg00023.html)]
[[Date Index](maillist.html#00022)]
[[Thread Index](threads.html#00022)]

# [SECURITY] [DLA 3727-1] firefox-esr security update

---

* *To*: <debian-lts-announce@lists.debian.org>
* *Subject*: [SECURITY] [DLA 3727-1] firefox-esr security update
* *From*: Emilio Pozuelo Monfort <pochu@debian.org>
* *Date*: Wed, 31 Jan 2024 16:16:20 +0100 (CET)
* *Message-id*: <[[ðŸ”Ž]](/msgid-search/20240131151620.C92DC2A01ED%40andromeda)Â [20240131151620.C92DC2A01ED@andromeda](msg00022.html)>
* *Mail-followup-to*: debian-lts@lists.debian.org
* *Reply-to*: debian-lts@lists.debian.org

---

```
-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA256

- -------------------------------------------------------------------------
Debian LTS Advisory DLA-3727-1                debian-lts@lists.debian.org
<https://www.debian.org/lts/security/>               Emilio Pozuelo Monfort
January 31, 2024                              <https://wiki.debian.org/LTS>
- -------------------------------------------------------------------------

Package        : firefox-esr
Version        : 115.7.0esr-1~deb10u1
CVE ID         : CVE-2024-0741 CVE-2024-0742 CVE-2024-0746 CVE-2024-0747
                 CVE-2024-0749 CVE-2024-0750 CVE-2024-0751 CVE-2024-0753
                 CVE-2024-0755

Multiple security issues have been found in the Mozilla Firefox web
browser, which could potentially result in the execution of arbitrary
code, phishing, clickjacking, privilege escalation, HSTS bypass or
bypass of content security policies.

For Debian 10 buster, these problems have been fixed in version
115.7.0esr-1~deb10u1.

We recommend that you upgrade your firefox-esr packages.

For the detailed security status of firefox-esr please refer to
its security tracker page at:
<https://security-tracker.debian.org/tracker/firefox-esr>

Further information about Debian LTS security advisories, how to apply
these updates to your system and frequently asked questions can be
found at: <https://wiki.debian.org/LTS>
-----BEGIN PGP SIGNATURE-----

iQIzBAEBCAAdFiEEcJymx+vmJZxd92Q+nUbEiOQ2gwIFAmW6ZD8ACgkQnUbEiOQ2
gwLwtRAAkrRo4Tp7+yx/1wUz9/TR5vREOCXoszy2WdVQvuTgiNYwkSAMDL1TpId1
M2mNLtL8v3QCCNoZqA3rIDVsixrBwZWdDLUA1OMjqyB3ChuX45lcyu3A+71v9MkI
2VaOIlkaWicu9rxNSQOYuPqItl2ydFLTUmVgR1pR4J+NstP/imijiEbPAiG5BM4n
U8L0IiUs8J+DQxeft5SWwFbMjbS8pi2R845z7p9RjGkIMPJF3CUdpsKnQcItCQIV
Ncc4YzVc8h7qpR4IWgLsGMoqA0EOtQB6NzFHZlASItgLJhDJSCVx/9/kUggjkq2D
DYTz5SoXW5P2QhX6rhkzYb8PVzyd9OQLXk2gEqEq4mtAidKO0IYl9ImwiCsnUoQp
HGz/e3QzFd2g1PVZ2RrjXjHAVe3r2wX3hv/eU8zZJadMR7/FcuYGKUPM897iov0K
Pac32GKpDdr7+x+LABrpzit1RjaULdzfOIa8EakOKtnnmtzH2KTf7nkLG8+KshfL
L5gmaWeBj1korqswg6p6ptPgm/KaqTK9ycyHZnwWNOdtDmAedfYJqITWgWZLP/nx
WzElPEQgqL521o/oFpAQ3Dp+OqNrjPV47oP5xdHQrdj1VJ0omc6F3GtJIvh182ak
HDKoTxdvLigeN4l9HnIdNqSFNRrsjNUbFjf2LdvdHYM382R5W9s=
=hLRb
-----END PGP SIGNATURE-----

```

---



=== Content from www.mozilla.org_eb2c002a_20250115_081847.html ===


## Help us improve your Mozilla experience

In addition to Cookies necessary for this site to function, weâ€™d like your permission to set some additional Cookies to better understand your browsing needs and improve your experience. Rest assured â€” we value your privacy.

Accept All Additional Cookies

Reject All Additional Cookies

[Cookie settings](/en-US/privacy/websites/cookie-settings/)

Menu
[![Mozilla](https://www.mozilla.org/media/img/logos/m24/lockup-black.f2ddba3f0724.svg)](/en-US/)

* [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
  Firefox browsers](/en-US/firefox/)
  Close Firefox browsers menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Desktop](/en-US/firefox/new/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for iOS](/en-US/firefox/browsers/mobile/ios/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Android](/en-US/firefox/browsers/mobile/android/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/focus/logo.aac3e33175cb.svg)
    ## Firefox Focus](/en-US/firefox/browsers/mobile/focus/)
  + [## Firefox blog](https://blog.mozilla.org/firefox/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=firefox)
* [Products](/en-US/products/)
  Close Products menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/mozilla/vpn/logo.c648f487bfb8.svg)
    ## Mozilla VPN](/en-US/products/vpn/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/monitor/logo.d97e5516f9e6.svg)
    ## Mozilla Monitor](https://monitor.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/relay/logo-white.d42a8b52e44c.svg)
    ## Firefox Relay](https://relay.firefox.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/pocket/logo.17446bc33a5d.svg)
    ## Pocket](https://getpocket.com/firefox_learnmore/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/nav/icons/icon-mdn-plus.f54475f980ab.svg)
    ## MDN Plus](https://developer.mozilla.org/plus?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/fakespot/logo-blue.3973b8fe9631.svg)
    ## Fakespot](https://fakespot.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/thunderbird/logo-thunderbird.121e9c0fed45.svg)
    ## Thunderbird](https://www.thunderbird.net/)

  [All products](/en-US/products/)
* [About us](/en-US/about/)
  Close About us menu

  Our Mission

  + [## About Mozilla](/en-US/about/)
  + [## The Mozilla Manifesto](/en-US/about/manifesto/)
  + [## Get Involved](/en-US/contribute/)
  + [## Innovation Projects](https://future.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Blog](https://blog.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)

  Our Work

  + [## Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla.ai](https://www.mozilla.ai/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Ventures](https://mozilla.vc/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Advertising](/en-US/advertising/)

## Menu

* Mozilla Security

## [Mozilla Security](/en-US/security/)

* [Advisories](/en-US/security/advisories/)
* [Known Vulnerabilities](/en-US/security/known-vulnerabilities/)
* [Mozilla Security Blog](https://blog.mozilla.com/security/)
* [Security Bug Bounty](/en-US/security/bug-bounty/)
* [Third-party Injection Policy](/en-US/security/third-party-software-injection/)

## [Client Bug Bounty](/en-US/security/client-bug-bounty/)

* [Frequently Asked Questions](/en-US/security/bug-bounty/faq/)
* [Hall of Fame](/en-US/security/bug-bounty/hall-of-fame/)

## [Web Bug Bounty](/en-US/security/web-bug-bounty/)

* [Eligible Websites](/en-US/security/bug-bounty/web-eligible-sites/)
* [Frequently Asked Questions](/en-US/security/bug-bounty/faq-webapp/)
* [Hall of Fame](/en-US/security/bug-bounty/web-hall-of-fame/)

# Mozilla Foundation Security Advisory 2024-02

## Security Vulnerabilities fixed in Firefox ESR 115.7

Announced
January 23, 2024
Impact
high
Products
Firefox ESR
Fixed in

* Firefox ESR 115.7

*Updated February 8, 2024 to remove CVE-2024-0749 which was inadvertently included in the original advisory.*

#### [#CVE-2024-0741: Out of bounds write in ANGLE](#CVE-2024-0741)

Reporter
Renan Rios
Impact
high
##### Description

An out of bounds write in ANGLE could have allowed an attacker to corrupt memory leading to a potentially exploitable crash.

##### References

* [Bug 1864587](https://bugzilla.mozilla.org/show_bug.cgi?id=1864587)

#### [#CVE-2024-0742: Failure to update user input timestamp](#CVE-2024-0742)

Reporter
Andrew McCreight
Impact
high
##### Description

It was possible for certain browser prompts and dialogs to be activated or dismissed unintentionally by the user due to an incorrect timestamp used to prevent input after page load.

##### References

* [Bug 1867152](https://bugzilla.mozilla.org/show_bug.cgi?id=1867152)

#### [#CVE-2024-0746: Crash when listing printers on Linux](#CVE-2024-0746)

Reporter
Cornel Ionce
Impact
moderate
##### Description

A Linux user opening the print preview dialog could have caused the browser to crash.

##### References

* [Bug 1660223](https://bugzilla.mozilla.org/show_bug.cgi?id=1660223)

#### [#CVE-2024-0747: Bypass of Content Security Policy when directive unsafe-inline was set](#CVE-2024-0747)

Reporter
Seongil Wi
Impact
moderate
##### Description

When a parent page loaded a child in an iframe with `unsafe-inline`, the parent Content Security Policy could have overridden the child Content Security Policy.

##### References

* [Bug 1764343](https://bugzilla.mozilla.org/show_bug.cgi?id=1764343)

#### [#CVE-2024-0750: Potential permissions request bypass via clickjacking](#CVE-2024-0750)

Reporter
Hafiizh
Impact
moderate
##### Description

A bug in popup notifications delay calculation could have made it possible for an attacker to trick a user into granting permissions.

##### References

* [Bug 1863083](https://bugzilla.mozilla.org/show_bug.cgi?id=1863083)

#### [#CVE-2024-0751: Privilege escalation through devtools](#CVE-2024-0751)

Reporter
Rob Wu
Impact
moderate
##### Description

A malicious devtools extension could have been used to escalate privileges.

##### References

* [Bug 1865689](https://bugzilla.mozilla.org/show_bug.cgi?id=1865689)

#### [#CVE-2024-0753: HSTS policy on subdomain could bypass policy of upper domain](#CVE-2024-0753)

Reporter
Hanno BÃ¶ck
Impact
moderate
##### Description

In specific HSTS configurations an attacker could have bypassed HSTS on a subdomain.

##### References

* [Bug 1870262](https://bugzilla.mozilla.org/show_bug.cgi?id=1870262)

#### [#CVE-2024-0755: Memory safety bugs fixed in Firefox 122, Firefox ESR 115.7, and Thunderbird 115.7](#CVE-2024-0755)

Reporter
Daniel Holbert, Andrew Osmond, and the Mozilla Fuzzing Team
Impact
moderate
##### Description

Memory safety bugs present in Firefox 121, Firefox ESR 115.6, and Thunderbird 115.6. Some of these bugs showed evidence of memory corruption and we presume that with enough effort some of these could have been exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 122, Firefox ESR 115.7, and Thunderbird 115.7](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1868456%2C1871445%2C1873701)

## Company

* [Leadership](/about/leadership/)
* [Press Center](https://blog.mozilla.org/category/mozilla/news/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=company)
* [Careers](/en-US/careers/)
* [Contact](/en-US/contact/)

## Support

* [Product Help](https://support.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [File a Bug](https://bugzilla.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [Localize Mozilla](https://pontoon.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)

## Resources

* [Advertise with Mozilla](/en-US/advertising/)
* [Firefox Release Notes](/firefox/134.0.1/releasenotes/)

## Developers

* [Developer Edition](/en-US/firefox/developer/)
* [Enterprise](/en-US/firefox/enterprise/)
* [Tools](https://firefox-source-docs.mozilla.org/devtools-user/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=developers)
* [MDN](https://developer.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer)

## Follow @Mozilla

* [X (formerly Twitter) (@mozilla)](https://twitter.com/mozilla)
* [Instagram (@mozilla)](https://www.instagram.com/mozilla/)
* [LinkedIn (@mozilla)](https://www.linkedin.com/company/mozilla-corporation/)
* [TikTok (@mozilla)](https://www.tiktok.com/%40mozilla)
* [Spotify (@mozilla)](https://open.spotify.com/show/0vT7LJMeVDxyQ2ZamHKu08?si=_uDRD6bRR_6M5YZyISGXgA)

## Follow @Firefox

* [X (formerly Twitter) (@firefox)](https://twitter.com/firefox)
* [Instagram (@firefox)](https://www.instagram.com/firefox/)
* [YouTube (@firefoxchannel)](https://www.youtube.com/user/firefoxchannel)
* [TikTok (@firefox)](https://www.tiktok.com/%40firefox)

[Donate](https://foundation.mozilla.org/?form=moco-donate-footer)

Visit [Mozilla Corporationâ€™s](/en-US/) not-for-profit parent, the [Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer).

Portions of this content are Â©1998â€“2025 by individual mozilla.org contributors. Content available under a [Creative Commons license](/en-US/foundation/licensing/website-content/).

* [Website Privacy Notice](/en-US/privacy/websites/)
* [Cookies](/en-US/privacy/websites/cookie-settings/)
* [Legal](/en-US/about/legal/)
* [Community Participation Guidelines](/en-US/about/governance/policies/participation/)
* [About this site](/en-US/about/this-site/)

![](https://www.mozilla.org/media/img/logos/m24/wordmark-white.2d673bb5b33a.svg)



=== Content from lists.debian.org_e97caf08_20250115_081845.html ===


---

[[Date Prev](msg00014.html)][[Date Next](msg00016.html)]
[[Thread Prev](msg00014.html)][[Thread Next](msg00016.html)]
[[Date Index](maillist.html#00015)]
[[Thread Index](threads.html#00015)]

# [SECURITY] [DLA 3720-1] thunderbird security update

---

* *To*: <debian-lts-announce@lists.debian.org>
* *Subject*: [SECURITY] [DLA 3720-1] thunderbird security update
* *From*: Emilio Pozuelo Monfort <pochu@debian.org>
* *Date*: Thu, 25 Jan 2024 11:49:57 +0100 (CET)
* *Message-id*: <[[ðŸ”Ž]](/msgid-search/20240125104957.8D75D2AB5D4%40andromeda)Â [20240125104957.8D75D2AB5D4@andromeda](msg00015.html)>
* *Mail-followup-to*: debian-lts@lists.debian.org
* *Reply-to*: debian-lts@lists.debian.org

---

```
-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA256

- -------------------------------------------------------------------------
Debian LTS Advisory DLA-3720-1                debian-lts@lists.debian.org
<https://www.debian.org/lts/security/>               Emilio Pozuelo Monfort
January 25, 2024                              <https://wiki.debian.org/LTS>
- -------------------------------------------------------------------------

Package        : thunderbird
Version        : 1:115.7.0-1~deb10u1
CVE ID         : CVE-2024-0741 CVE-2024-0742 CVE-2024-0746 CVE-2024-0747
                 CVE-2024-0749 CVE-2024-0750 CVE-2024-0751 CVE-2024-0753
                 CVE-2024-0755

Multiple security issues were discovered in Thunderbird, which could
result in denial of service or the execution of arbitrary code.

For Debian 10 buster, these problems have been fixed in version
1:115.7.0-1~deb10u1.

We recommend that you upgrade your thunderbird packages.

For the detailed security status of thunderbird please refer to
its security tracker page at:
<https://security-tracker.debian.org/tracker/thunderbird>

Further information about Debian LTS security advisories, how to apply
these updates to your system and frequently asked questions can be
found at: <https://wiki.debian.org/LTS>
-----BEGIN PGP SIGNATURE-----

iQIzBAEBCAAdFiEEcJymx+vmJZxd92Q+nUbEiOQ2gwIFAmWyPNUACgkQnUbEiOQ2
gwJUfBAAii62ZY/Ii3bdR/NHircg99wh+aBQpFQqQaDmuobl3h3PuNttJvBF6xfV
bgUKzv224LAlADMmxK05h3nvuCmYvu+wsx58EekwEJlTGI7ED7zDqKx9UUrxPMwX
Ojl5aSfI6RYbw5lQ/NcyI/NOGdU3ds21xadbKkDG8h2iKxpVcTXTpqpFOqToCDax
FHChrj1FeNJADuL+w4w7Eice2+I2ArgvsAGkMuLH2CxG9gdQMon05eOwL571bU1+
MqueuTY1T9tFZC+7+Q2qxixorw4p/AMV3xXl1zAfb1cCx8wOKXt/86ElgyRyc14X
eIDcPh9o98bnyU30fVYViGYAzIEmJ5+CcPkXOcI0YIF41krOHSSnptmOE8Hxj9h+
deiUjHLAKQ6Ncyu/jnCltrSeFvRnfamagh9B28VMyV2Q/gY/LC3yzzfYgsBVGfmT
jjNgPWU2IoUSzyfqz8kPyqRffTj3kDDlVkdJc2afobkpcx88afxYXO+x95ilcVYv
I+rgsjU4BKitdA0GcXiC8JMcFulrZZg9un6zfMZjYipPlJX6x2XEllwpUv30IdiT
wGlKUeC04jrD9X2kxTCdijAKIZJMRJzspuHERgLWEOmJSo9k1zlbFxPzrVq5RgTk
mwkkF9Lvgy7PrnuvkDmcYwSx9FEHb+D6dMM8e/UiRwZu3s3R150=
=fQo/
-----END PGP SIGNATURE-----

```

---



=== Content from www.mozilla.org_3a71a3b3_20250115_081849.html ===


## Help us improve your Mozilla experience

In addition to Cookies necessary for this site to function, weâ€™d like your permission to set some additional Cookies to better understand your browsing needs and improve your experience. Rest assured â€” we value your privacy.

Accept All Additional Cookies

Reject All Additional Cookies

[Cookie settings](/en-US/privacy/websites/cookie-settings/)

Menu
[![Mozilla](https://www.mozilla.org/media/img/logos/m24/lockup-black.f2ddba3f0724.svg)](/en-US/)

* [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
  Firefox browsers](/en-US/firefox/)
  Close Firefox browsers menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Desktop](/en-US/firefox/new/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for iOS](/en-US/firefox/browsers/mobile/ios/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Android](/en-US/firefox/browsers/mobile/android/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/focus/logo.aac3e33175cb.svg)
    ## Firefox Focus](/en-US/firefox/browsers/mobile/focus/)
  + [## Firefox blog](https://blog.mozilla.org/firefox/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=firefox)
* [Products](/en-US/products/)
  Close Products menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/mozilla/vpn/logo.c648f487bfb8.svg)
    ## Mozilla VPN](/en-US/products/vpn/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/monitor/logo.d97e5516f9e6.svg)
    ## Mozilla Monitor](https://monitor.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/relay/logo-white.d42a8b52e44c.svg)
    ## Firefox Relay](https://relay.firefox.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/pocket/logo.17446bc33a5d.svg)
    ## Pocket](https://getpocket.com/firefox_learnmore/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/nav/icons/icon-mdn-plus.f54475f980ab.svg)
    ## MDN Plus](https://developer.mozilla.org/plus?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/fakespot/logo-blue.3973b8fe9631.svg)
    ## Fakespot](https://fakespot.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/thunderbird/logo-thunderbird.121e9c0fed45.svg)
    ## Thunderbird](https://www.thunderbird.net/)

  [All products](/en-US/products/)
* [About us](/en-US/about/)
  Close About us menu

  Our Mission

  + [## About Mozilla](/en-US/about/)
  + [## The Mozilla Manifesto](/en-US/about/manifesto/)
  + [## Get Involved](/en-US/contribute/)
  + [## Innovation Projects](https://future.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Blog](https://blog.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)

  Our Work

  + [## Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla.ai](https://www.mozilla.ai/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Ventures](https://mozilla.vc/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Advertising](/en-US/advertising/)

## Menu

* Mozilla Security

## [Mozilla Security](/en-US/security/)

* [Advisories](/en-US/security/advisories/)
* [Known Vulnerabilities](/en-US/security/known-vulnerabilities/)
* [Mozilla Security Blog](https://blog.mozilla.com/security/)
* [Security Bug Bounty](/en-US/security/bug-bounty/)
* [Third-party Injection Policy](/en-US/security/third-party-software-injection/)

## [Client Bug Bounty](/en-US/security/client-bug-bounty/)

* [Frequently Asked Questions](/en-US/security/bug-bounty/faq/)
* [Hall of Fame](/en-US/security/bug-bounty/hall-of-fame/)

## [Web Bug Bounty](/en-US/security/web-bug-bounty/)

* [Eligible Websites](/en-US/security/bug-bounty/web-eligible-sites/)
* [Frequently Asked Questions](/en-US/security/bug-bounty/faq-webapp/)
* [Hall of Fame](/en-US/security/bug-bounty/web-hall-of-fame/)

# Mozilla Foundation Security Advisory 2024-04

## Security Vulnerabilities fixed in Thunderbird 115.7

Announced
January 23, 2024
Impact
high
Products
Thunderbird
Fixed in

* Thunderbird 115.7

*In general, these flaws cannot be exploited through email in the Thunderbird product because scripting is disabled when reading mail, but are potentially risks in browser or browser-like contexts.*

#### [#CVE-2024-0741: Out of bounds write in ANGLE](#CVE-2024-0741)

Reporter
Renan Rios
Impact
high
##### Description

An out of bounds write in ANGLE could have allowed an attacker to corrupt memory leading to a potentially exploitable crash.

##### References

* [Bug 1864587](https://bugzilla.mozilla.org/show_bug.cgi?id=1864587)

#### [#CVE-2024-0742: Failure to update user input timestamp](#CVE-2024-0742)

Reporter
Andrew McCreight
Impact
high
##### Description

It was possible for certain browser prompts and dialogs to be activated or dismissed unintentionally by the user due to an incorrect timestamp used to prevent input after page load.

##### References

* [Bug 1867152](https://bugzilla.mozilla.org/show_bug.cgi?id=1867152)

#### [#CVE-2024-0746: Crash when listing printers on Linux](#CVE-2024-0746)

Reporter
Cornel Ionce
Impact
moderate
##### Description

A Linux user opening the print preview dialog could have caused the browser to crash.

##### References

* [Bug 1660223](https://bugzilla.mozilla.org/show_bug.cgi?id=1660223)

#### [#CVE-2024-0747: Bypass of Content Security Policy when directive unsafe-inline was set](#CVE-2024-0747)

Reporter
Seongil Wi
Impact
moderate
##### Description

When a parent page loaded a child in an iframe with `unsafe-inline`, the parent Content Security Policy could have overridden the child Content Security Policy.

##### References

* [Bug 1764343](https://bugzilla.mozilla.org/show_bug.cgi?id=1764343)

#### [#CVE-2024-0749: Phishing site popup could show local origin in address bar](#CVE-2024-0749)

Reporter
Kestrel
Impact
moderate
##### Description

A phishing site could have repurposed an `about:` dialog to show phishing content with an incorrect origin in the address bar.

##### References

* [Bug 1813463](https://bugzilla.mozilla.org/show_bug.cgi?id=1813463)

#### [#CVE-2024-0750: Potential permissions request bypass via clickjacking](#CVE-2024-0750)

Reporter
Hafiizh
Impact
moderate
##### Description

A bug in popup notifications delay calculation could have made it possible for an attacker to trick a user into granting permissions.

##### References

* [Bug 1863083](https://bugzilla.mozilla.org/show_bug.cgi?id=1863083)

#### [#CVE-2024-0751: Privilege escalation through devtools](#CVE-2024-0751)

Reporter
Rob Wu
Impact
moderate
##### Description

A malicious devtools extension could have been used to escalate privileges.

##### References

* [Bug 1865689](https://bugzilla.mozilla.org/show_bug.cgi?id=1865689)

#### [#CVE-2024-0753: HSTS policy on subdomain could bypass policy of upper domain](#CVE-2024-0753)

Reporter
Hanno BÃ¶ck
Impact
moderate
##### Description

In specific HSTS configurations an attacker could have bypassed HSTS on a subdomain.

##### References

* [Bug 1870262](https://bugzilla.mozilla.org/show_bug.cgi?id=1870262)

#### [#CVE-2024-0755: Memory safety bugs fixed in Firefox 122, Firefox ESR 115.7, and Thunderbird 115.7](#CVE-2024-0755)

Reporter
Daniel Holbert, Andrew Osmond, and the Mozilla Fuzzing Team
Impact
moderate
##### Description

Memory safety bugs present in Firefox 121, Firefox ESR 115.6, and Thunderbird 115.6. Some of these bugs showed evidence of memory corruption and we presume that with enough effort some of these could have been exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 122, Firefox ESR 115.7, and Thunderbird 115.7](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1868456%2C1871445%2C1873701)

## Company

* [Leadership](/about/leadership/)
* [Press Center](https://blog.mozilla.org/category/mozilla/news/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=company)
* [Careers](/en-US/careers/)
* [Contact](/en-US/contact/)

## Support

* [Product Help](https://support.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [File a Bug](https://bugzilla.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [Localize Mozilla](https://pontoon.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)

## Resources

* [Advertise with Mozilla](/en-US/advertising/)
* [Firefox Release Notes](/firefox/134.0.1/releasenotes/)

## Developers

* [Developer Edition](/en-US/firefox/developer/)
* [Enterprise](/en-US/firefox/enterprise/)
* [Tools](https://firefox-source-docs.mozilla.org/devtools-user/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=developers)
* [MDN](https://developer.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer)

## Follow @Mozilla

* [X (formerly Twitter) (@mozilla)](https://twitter.com/mozilla)
* [Instagram (@mozilla)](https://www.instagram.com/mozilla/)
* [LinkedIn (@mozilla)](https://www.linkedin.com/company/mozilla-corporation/)
* [TikTok (@mozilla)](https://www.tiktok.com/%40mozilla)
* [Spotify (@mozilla)](https://open.spotify.com/show/0vT7LJMeVDxyQ2ZamHKu08?si=_uDRD6bRR_6M5YZyISGXgA)

## Follow @Firefox

* [X (formerly Twitter) (@firefox)](https://twitter.com/firefox)
* [Instagram (@firefox)](https://www.instagram.com/firefox/)
* [YouTube (@firefoxchannel)](https://www.youtube.com/user/firefoxchannel)
* [TikTok (@firefox)](https://www.tiktok.com/%40firefox)

[Donate](https://foundation.mozilla.org/?form=moco-donate-footer)

Visit [Mozilla Corporationâ€™s](/en-US/) not-for-profit parent, the [Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer).

Portions of this content are Â©1998â€“2025 by individual mozilla.org contributors. Content available under a [Creative Commons license](/en-US/foundation/licensing/website-content/).

* [Website Privacy Notice](/en-US/privacy/websites/)
* [Cookies](/en-US/privacy/websites/cookie-settings/)
* [Legal](/en-US/about/legal/)
* [Community Participation Guidelines](/en-US/about/governance/policies/participation/)
* [About this site](/en-US/about/this-site/)

![](https://www.mozilla.org/media/img/logos/m24/wordmark-white.2d673bb5b33a.svg)



=== Content from bugzilla.mozilla.org_8f3041c3_20250115_081845.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  Â·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summaryâ–¾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View â–¾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/1660223)
* [XML](/show_bug.cgi?ctype=xml&id=1660223)

Closed
[Bug 1660223](/show_bug.cgi?id=1660223)
(CVE-2024-0746)

Opened 4 years ago
Closed 1 year ago

# Crash in [@ gtk\_printer\_get\_name]

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Crash in [@ gtk\_printer\_get\_name]

## Categories

### (Core :: Printing: Output, defect, P3)

[Product:](/describecomponents.cgi?product=Core)

Core
â–¾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=Printing%3A%20Output#Printing%3A%20Output)

Printing: Output
â–¾

Core :: Printing: Output
Problems printing from this product should be submitted under this component.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=Printing%3A%20Output&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=Printing%3A%20Output&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=Printing%3A%20Output)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Firefox 81

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

x86\_64

Linux

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

P3

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

S3

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

122 Branch

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Performance Impact | --- |
| --- | --- |
| Webcompat Priority | --- |
| Webcompat Score | --- |
| Accessibility Severity | --- |
| a11y-review | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox-esr115 | [122+](/buglist.cgi?f1=cf_tracking_firefox_esr115&o1=equals&v1=122%2B) | [verified](/buglist.cgi?f1=cf_status_firefox_esr115&o1=equals&v1=verified) |
| firefox81 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox81&o1=equals&v1=wontfix) |
| firefox120 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox120&o1=equals&v1=wontfix) |
| firefox121 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox121&o1=equals&v1=wontfix) |
| firefox122 | [+](/buglist.cgi?f1=cf_tracking_firefox122&o1=equals&v1=%2B) | [verified](/buglist.cgi?f1=cf_status_firefox122&o1=equals&v1=verified) |

|  | Tracking | Status |
| --- | --- | --- |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | 122+ | verified |
| firefox-esr128 | --- | --- |
| firefox81 |  | wontfix |
| firefox120 |  | wontfix |
| firefox121 |  | wontfix |
| firefox122 | + | verified |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: noni, Assigned: dholbert)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/cd9b85b2e112bd7941b21ad03f42604e?d=mm&size=40)  [dholbert](/user_profile?user_id=278074)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/c283b43bb335591e8c45a929dc905f53?d=mm&size=40)  [noni](/user_profile?user_id=458186)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](extensions/Gravatar/web/default.jpg)  [jwatt](/user_profile?user_id=32767)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

16 people

## References

### (Blocks 1 open bug)

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[1658287](/show_bug.cgi?id=1658287 "NEW - [meta] Modernized Print UI - QA bug tracking"), [133787](/show_bug.cgi?id=133787 "RESOLVED FIXED - [UX][Meta] Redesign print preview and make it tab-modal instead of window-modal")

Dependency [tree](/showdependencytree.cgi?id=1660223&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=1660223)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[Duplicates:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#duplicates)

[1750768](/show_bug.cgi?id=1750768 "RESOLVED DUPLICATE - Firefox crashing when attempting to print")

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

[gitlab.gnome.org/GNOME/gtk/-/issues/4672](https://gitlab.gnome.org/GNOME/gtk/-/issues/4672 "https://gitlab.gnome.org/GNOME/gtk/-/issues/4672")

[gitlab.gnome.org/GNOME/gtk/-/issues/6265](https://gitlab.gnome.org/GNOME/gtk/-/issues/6265 "https://gitlab.gnome.org/GNOME/gtk/-/issues/6265")

## Details

### (Keywords: crash, csectype-uaf, sec-moderate, Whiteboard: [print2020][old-ui?][tbird crash][adv-main122+][adv-esr115.7+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

CVE-2024-0746

[Keywords:](/describekeywords.cgi)

[crash](/buglist.cgi?keywords=crash&resolution=---),
[csectype-uaf](/buglist.cgi?keywords=csectype-uaf&resolution=---),
[sec-moderate](/buglist.cgi?keywords=sec-moderate&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[print2020][old-ui?][tbird crash][adv-main122+][adv-esr115.7+]

QA Whiteboard:

[post-critsmash-triage] [qa-triaged]

Has STR:

yes

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |
|  | qe-verify |  |

## Crash Data

Signature:

[[@ gtk\_printer\_get\_name ]](https://crash-stats.mozilla.org/signature/?signature=gtk_printer_get_name)

[[@ g\_type\_check\_instance\_cast ]](https://crash-stats.mozilla.org/signature/?signature=g_type_check_instance_cast)

[[@ libgtk-3.so.0@0x3ad666 ]](https://crash-stats.mozilla.org/signature/?signature=libgtk-3.so.0%400x3ad666)

[[@ libgtk-3.so.0@0x3c80cd ]](https://crash-stats.mozilla.org/signature/?signature=libgtk-3.so.0%400x3c80cd)

[[@ libgtk-3.so.0@0x3ad8c6 ]](https://crash-stats.mozilla.org/signature/?signature=libgtk-3.so.0%400x3ad8c6)

[[@ libgtk-3.so.0@0x39bcf6 ]](https://crash-stats.mozilla.org/signature/?signature=libgtk-3.so.0%400x39bcf6)

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (4 files)

| [Bug 1660223: Let printer enumeration run to completion, to avoid a GTK bug. r?jwatt,AlaskanEmily](/attachment.cgi?id=9367750)  [1 year ago](#c33)  [Daniel Holbert [:dholbert]](/user_profile?user_id=278074)   48 bytes, text/x-phabricator-request |  | [Details](/attachment.cgi?id=9367750&action=edit) | [Review](/attachment.cgi?id=9367750) |
| --- | --- | --- |
| [minimal gtk program (c++ testcase) that triggers the same UAF bug for me](/attachment.cgi?id=9368606)  [1 year ago](#c41)  [Daniel Holbert [:dholbert]](/user_profile?user_id=278074)   2.85 KB, text/plain |  | [Details](/attachment.cgi?id=9368606&action=edit) |
| [Bug 1660223: Let printer enumeration run to completion, to avoid a GTK bug. r?jwatt,AlaskanEmily](/attachment.cgi?id=9369132)  [1 year ago](#c47)  [Daniel Holbert [:dholbert]](/user_profile?user_id=278074)   48 bytes, text/x-phabricator-request | phab-bot : [approval-mozilla-esr115+](#a105756159_600971 "1 year ago") | [Details](/attachment.cgi?id=9369132&action=edit) | [Review](/attachment.cgi?id=9369132) |
| [advisory.txt](/attachment.cgi?id=9373596)  [1 year ago](#c58)  [Jesse Schwartzentruber (:truber)](/user_profile?user_id=486733)   137 bytes, text/plain |  | [Details](/attachment.cgi?id=9373596&action=edit) |

Bottom â†“
Tags â–¾

* Reset

Timeline â–¾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Cornel Ionce [:noni] [Hubs QA]](/user_profile?user_id=458186)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=1660223#c0)â€¢ 4 years ago â€¢ [Edited](/page.cgi?id=comment-revisions.html&bug_id=1660223&comment_id=14997903 "1 revision") |
|  | |

This bug is for crash report [bp-4cb207df-64d5-4ec6-b5be-db1ec0200820](https://crash-stats.mozilla.org/report/index/4cb207df-64d5-4ec6-b5be-db1ec0200820).

Top 10 frames of crashing thread:

```
0 libgtk-3.so.0 gtk_printer_get_name ./debian/build/deb/gtk/../../../../gtk/gtkprinter.c:436
1 libprintbackend-cups.so <name omitted> ../../../../../../modules/printbackends/cups/gtkprintbackendcups.c:1874
2 libglib-2.0.so.0 <name omitted> ../../../glib/glist.c:922
3 libprintbackend-cups.so cups_request_printer_list_cb ../../../../../../modules/printbackends/cups/gtkprintbackendcups.c:3630
4 libprintbackend-cups.so cups_dispatch_watch_dispatch ../../../../../../modules/printbackends/cups/gtkprintbackendcups.c:1581
5 libglib-2.0.so.0 g_main_context_dispatch ../../../glib/gmain.c:3974
6 libglib-2.0.so.0 g_main_context_iterate ../../../glib/gmain.c:4047
7 libglib-2.0.so.0 <name omitted> ../../../glib/gmain.c:4241
8 libgtk-3.so.0 gtk_enumerate_printers ./debian/build/deb/gtk/../../../../gtk/gtkprinter.c:1285
9 libxul.so mozilla::detail::RunnableMethodImpl<nsDeviceContextSpecGTK*, void  xpcom/threads/nsThreadUtils.h:1240

```

**Affected versions**

* 81.0a1 (BuildId:20200819212829)

**Affected platforms**

* Ubuntu 20.04 64bit.

**Additional notes**

* The drivers for the printers were installed with hplip 3.20.6 (latest available at this time).
* This could have been an isolated case, I'll look into it in order to get some more specific steps.

**Steps to reproduce**

1. Fresh install of the printer (HP MFP M28A in my case)
2. Open Firefox.
3. Navigate to any page and print it.

**Expected result**

* Page is correctly printed.

**Actual result**

* Browser crashed and page was not printed.

**Regression Window**

* Not sure if this is a regression or not since I've only ran into it once so far.

**[Suggested Severity]**

* S3

|  | [Jonathan Watt [:jwatt]](/user_profile?user_id=32767) |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=1660223#c1)â€¢ 4 years ago |
|  | |

So the `gtk_enumerate_printers` call made via the runable here:

<https://searchfox.org/mozilla-central/rev/6cc48251bb97600fdf11a5b4c5f621bfc8606d55/widget/gtk/nsDeviceContextSpecG.cpp#266>

|  | [Jonathan Watt [:jwatt]](/user_profile?user_id=32767) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1660223#a664_32767)â€¢ 4 years ago |

Component: Printing â†’ Printing: OutputProduct: Toolkit â†’ Core

|  | [Jonathan Watt [:jwatt]](/user_profile?user_id=32767) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=1660223#c2)â€¢ 4 years ago |
|  | |

Something to keep an eye on, but the number of these crashes reported recently is currently no more than we've had going back months.

|  | [Ting-Yu Lin [:TYLin] (PST, UTC-8)](/user_profile?user_id=503090) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1660223#a36670_503090)â€¢ 4 years ago |

Severity: -- â†’ S3

|  | [Sean Voisen (:svoisen)](/user_profile?user_id=621005) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1660223#a180596_621005)â€¢ 4 years ago |

Priority: -- â†’ P2

|  | [Camelia Badau [:cbadau], Desktop Test Engineering](/user_profile?user_id=500622) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1660223#a334554_500622)â€¢ 4 years ago |

Has Regression Range: --- â†’ noHas STR: --- â†’ yes

|  | [Jonathan Watt [:jwatt]](/user_profile?user_id=32767) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=1660223#c3)â€¢ 4 years ago |
|  | |

(In reply to Jonathan Watt [:jwatt] from [comment #2](/show_bug.cgi?id=1660223#c2 "VERIFIED FIXED - Crash in [@ gtk_printer_get_name]"))

> Something to keep an eye on, but the number of these crashes reported recently is currently no more than we've had going back months.

Dropping this to P3 for now, since there doesn't seem to have been any increase in the frequency of this crash since way before the new UI started being developed.

Priority: P2 â†’ P3

|  | [Sean Voisen (:svoisen)](/user_profile?user_id=621005) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1660223#a1585938_621005)â€¢ 4 years ago |

Whiteboard: [print2020\_v81][old-ui?] â†’ [print2020][old-ui?]

|  | [Gabriele Svelto [:gsvelto]](/user_profile?user_id=448747) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=1660223#c4)â€¢ 4 years ago â€¢ [Edited](/page.cgi?id=comment-revisions.html&bug_id=1660223&comment_id=15303802 "1 revision") |
|  | |

The crashes under this signature all have the poison pattern in one of the registers. This is an use-after-free crash and thus potentially security sensitive.

Group: core-securityKeywords: [csectype-uaf](/buglist.cgi?keywords=csectype-uaf&resolution=---)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=1660223#c5)â€¢ 4 years ago |
|  | |

Seems to pretty consistently be `rdx` which means you should be able to look at the assembly and figure out which object is the freed one.

Calling this `sec-moderate` on the assumption that we only call this function when the user has explicitly tried to print something, and that it's not something a web site could trigger on its own.

Group: core-security â†’ layout-core-securityKeywords: [sec-moderate](/buglist.cgi?keywords=sec-moderate&resolution=---)

|  | [Jonathan Watt [:jwatt]](/user_profile?user_id=32767) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=1660223#c6)â€¢ 2 years ago |
|  | |

Currently all crashes seem to be null-dereference crashes.

Looking at the [gtk\_printer\_get\_name source](https://github.com/GNOME/gtk/blob/89ea9ba6003837cdd5e82b131a6e61a13f2952c0/gtk/gtkprinter.c#L434), it seems like `printer` cannot be null, and therefore `printer->priv` must be null if we crash in `gtk_printer_get_name`.

(In reply to Gabriele Svelto [:gsvelto] from [comment #4](/show_bug.cgi?id=1660223#c4 "VERIFIED FIXED - Crash in [@ gtk_printer_get_name]"))

> The crashes under this signature all have the poison pattern in one of the registers. This is an use-after-free crash and thus potentially security sensitive.

`rax` contains `0xe5e5e5e5e5e5e5e5`. But does that really mean that there is a security issue here? If the poison pattern was in memory, that would be an expected part of normal execution...unless that memory was being read from. I'm possibly showing my ignorance here, but could the pattern be in `rax` because it was put there in order to copy that value from `rax` into some freed memory to poison it? Or is there good reason to believe that it being there means that we **read** that value from freed memory.

Flags: needinfo?(gsvelto)

|  | [Gabriele Svelto [:gsvelto]](/user_profile?user_id=448747) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=1660223#c7)â€¢ 2 years ago |
|  | |

The addresses reported in Socorro are misleading because the real crashing address - which is `0xe5e5e5e5e5e5e5e5` - causes a general protection fault on x86-64 processors and gets reported as NULL. We're this close to showing the real address in these crashes ([bug 1493342](/show_bug.cgi?id=1493342 "RESOLVED FIXED - Report crashes at amd64 non-canonical addresses correctly")). We just need to make a new release of the stack walker and ship it into Socorro, then all these crashes will show up as hitting `0xe5e5e5e5e5e5e5e5`.

Flags: needinfo?(gsvelto)

|  | [Wayne Mery (:wsmwk)](/user_profile?user_id=29811) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1660223#a76279736_29811)â€¢ 2 years ago |

Whiteboard: [print2020][old-ui?] â†’ [print2020][old-ui?][tbird crash]

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=1660223#c8)â€¢ 2 years ago |
|  | |

(In reply to Gabriele Svelto [:gsvelto] (PTO) from [comment #7](/show_bug.cgi?id=1660223#c7 "VERIFIED FIXED - Crash in [@ gtk_printer_get_name]"))

> The addresses reported in Socorro are misleading because the real crashing address - which is `0xe5e5e5e5e5e5e5e5` - causes a general protection fault on x86-64 processors and gets reported as NULL. We're this close to showing the real address in these crashes ([bug 1493342](/show_bug.cgi?id=1493342 "RESOLVED FIXED - Report crashes at amd64 non-canonical addresses correctly")). We just need to make a new release of the stack walker and ship it into Socorro, then all these crashes will show up as hitting `0xe5e5e5e5e5e5e5e5`.

As expected, these crashes are now showing up as being on poison values.

|  | [Wayne Mery (:wsmwk)](/user_profile?user_id=29811) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=1660223#c9)â€¢ 2 years ago |
|  | |

[bp-4d261420-0503-4073-ab76-b15600230424](https://crash-stats.mozilla.org/report/index/4d261420-0503-4073-ab76-b15600230424) from <https://support.mozilla.org/en-US/questions/1411664> and <https://github.com/flathub/org.mozilla.Thunderbird/issues/134>

|  | [Wayne Mery (:wsmwk)](/user_profile?user_id=29811) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=1660223#c10)â€¢ 2 years ago |
|  | |

Is there a workaround for users to try?

User in [bp-515af179-d3a0-420a-aaf1-99aa00230419](https://crash-stats.mozilla.org/report/index/515af179-d3a0-420a-aaf1-99aa00230419) cites crashes for both Firefox and Thunderbird when using papercut, which is pretty popular.

Flags: needinfo?(jwatt)

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074)  Assignee |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=1660223#c11)â€¢ 2 years ago |
|  | |

(In reply to Wayne Mery (:wsmwk) from [comment #10](/show_bug.cgi?id=1660223#c10 "VERIFIED FIXED - Crash in [@ gtk_printer_get_name]"))

> Is there a workaround for users to try?

I don't think so.

> User in [bp-515af179-d3a0-420a-aaf1-99aa00230419](https://crash-stats.mozilla.org/report/index/515af179-d3a0-420a-aaf1-99aa00230419) cites crashes for both Firefox and Thunderbird when using papercut, which is pretty popular.

Yeah, the comment there is interesting (on their system this seems to be specific to that print target, printed to from Firefox only).

However, I'm not sure how far that gets us; the papercut documentation says [they don't offer a print driver for Mac or Linux](https://www.papercut.com/help/manuals/ng-mf/applicationserver/find-me-global-print-driver/#about-the-papercut-global-print-driver); they just recommend using the platform postscript driver. So that means we aren't e.g. hitting some bug or edge case in a papercut print driver. (Also: it looks like that's the only crash report that mentions papercut.)

Side note, I wondered if maybe [bug 1826872](/show_bug.cgi?id=1826872 "RESOLVED FIXED - Move CUPS printer dest into CUPSPrinterInfo for nsPrinterCUPS") might help here (we're anticipating that that'll help with some other print crashes). However, I don't think it does help here -- [bug 1826872](/show_bug.cgi?id=1826872 "RESOLVED FIXED - Move CUPS printer dest into CUPSPrinterInfo for nsPrinterCUPS")'s patch landed on the 114 Nightly cycle, and this bug here has two crashes from 114 betas:

[bp-0fb8e0c5-74ab-41c9-9a5d-3ac600230520](https://crash-stats.mozilla.org/report/index/0fb8e0c5-74ab-41c9-9a5d-3ac600230520)

[bp-624919ac-f0b2-4d44-a364-d8c870230518](https://crash-stats.mozilla.org/report/index/624919ac-f0b2-4d44-a364-d8c870230518)

|  | [Gabriele Svelto [:gsvelto]](/user_profile?user_id=448747) |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=1660223#c12)â€¢ 1 year ago |
|  | |

Added a signature

Crash Signature: [@ gtk\_printer\_get\_name] â†’ [@ gtk\_printer\_get\_name]
[@ g\_type\_check\_instance\_cast]

|  | [Gabriele Svelto [:gsvelto]](/user_profile?user_id=448747) |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=1660223#c13)â€¢ 1 year ago |
|  | |

There's several old distros for which we don't have symbols which also hit this issue, adding them so we can track the volume.

Crash Signature: [@ gtk\_printer\_get\_name]
[@ g\_type\_check\_instance\_cast] â†’ [@ gtk\_printer\_get\_name]
[@ g\_type\_check\_instance\_cast]
[@ libgtk-3.so.0@0x3ad666]
[@ libgtk-3.so.0@0x3c80cd]
[@ libgtk-3.so.0@0x3ad8c6]

|  | [Randell Jesup [:jesup] (needinfo me)](/user_profile?user_id=11539) |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=1660223#c14)â€¢ 1 year ago |
|  | |

Slowly increasing crash rate over the last 6 months. Strongly correlated with day-of-the-week.

#2 e5e5 UAF in the last month, 1387 crashes

Flags: needinfo?(jwatt)

|  | [Randell Jesup [:jesup] (needinfo me)](/user_profile?user_id=11539) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1660223#a103974387_11539)â€¢ 1 year ago |

Flags: needinfo?(jwatt)

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074)  Assignee |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=1660223#c15)â€¢ 1 year ago â€¢ [Edited](/page.cgi?id=comment-revisions.html&bug_id=1660223&comment_id=16700255 "5 revisions") |
|  | |

In reply to Jonathan Watt [:jwatt] from [comment #1](/show_bug.cgi?id=1660223#c1 "VERIFIED FIXED - Crash in [@ gtk_printer_get_name]"))

> So the `gtk_enumerate_printers` call made via the runable here:
>
> <https://searchfox.org/mozilla-central/rev/6cc48251bb97600fdf11a5b4c5f621bfc8606d55/widget/gtk/nsDeviceContextSpecG.cpp#266>

Here's a more current searchfox link; though this particular snippet is unchanged since [comment 1](/show_bug.cgi?id=1660223#c1 "VERIFIED FIXED - Crash in [@ gtk_printer_get_name]") was posted.

<https://searchfox.org/mozilla-central/rev/16526d690cccc9c60cacf09cc08e2c3041ef884e/widget/gtk/nsDeviceContextSpecG.cpp#357-360>

```
  NS_DispatchToCurrentThread(
      NewRunnableMethod("nsDeviceContextSpecGTK::EnumeratePrinters", this,
                        &nsDeviceContextSpecGTK::EnumeratePrinters));
}

```

~~I'm noticing one red flag here... We're passing a raw `this` pointer in to a runnable there which gets executed asynchronously, and I'm not sure we have any guarantee that `this` will still be alive when the runnable gets executed. (`this` here is a `nsDeviceContextSpecGTK` which is a refcounted object, owned by the print data for the particular print job, I think).~~

~~It seems conceivable that if the print operation fails or is canceled and the `nsDeviceContextSpecGTK` is torn down before the runnable can be executed, then that would trivially trigger a UAF here, when the runnable is executed.~~

[EDIT: This actually shouldn't be a problem; see [comment 20](/show_bug.cgi?id=1660223#c20 "VERIFIED FIXED - Crash in [@ gtk_printer_get_name]"). `NewRunnableMethod` takes this into consideration and generates a runnable that maintains a strong reference to the passed-in `this` pointer.]

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074)  Assignee |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=1660223#c16)â€¢ 1 year ago |
| obsolete | |

| Comment hidden (obsolete) |  |
| --- | --- |

Maybe instead of `NewRunnableMethod`, we should try using some sort of lightweight locally-defined runnable class that holds a `RefPtr< nsDeviceContextSpecGTK>`, so we can be sure that our nsDeviceContextSpecGTK isn't destroyed before the runanble gets executed?

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074)  Assignee |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=1660223#c17)â€¢ 1 year ago |
| obsolete | |

| Comment hidden (obsolete) |  |
| --- | --- |

Or it looks like we can use a lambda function in `NS_NewRunnableFunction` with variable-capture to generate a RefPtr, without needing an explicit utility class, too -- like so:

<https://searchfox.org/mozilla-central/rev/16526d690cccc9c60cacf09cc08e2c3041ef884e/dom/media/webcodecs/DecoderTemplate.cpp#612-620>

```
NS_DispatchToCurrentThread(NS_NewRunnableFunction(
    "ProcessConfigureMessage (async): invalid config",
    [self = RefPtr(this), errorMessage] {
  [...]

```

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074)  Assignee |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=1660223#c18)â€¢ 1 year ago |
| obsolete | |

| Comment hidden (obsolete) |  |
| --- | --- |

I spun off [bug 1868687](/show_bug.cgi?id=1868687 "RESOLVED INVALID") to address [comment 15](/show_bug.cgi?id=1660223#c15 "VERIFIED FIXED - Crash in [@ gtk_printer_get_name]") - 17 here. (Not doing a patch here since I'm not 100% sure it'll fix the crash volume for this crash signature, though I hope it will.)

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074)  Assignee |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=1660223#c19)â€¢ 1 year ago â€¢ [Edited](/page.cgi?id=comment-revisions.html&bug_id=1660223&comment_id=16700294 "1 revision") |
| obsolete | |

| Comment hidden (obsolete) |  |
| --- | --- |

(applying the issue from [comment 15](/show_bug.cgi?id=1660223#c15 "VERIFIED FIXED - Crash in [@ gtk_printer_get_name]") to what-was-described-in-[comment 0](/show_bug.cgi?id=1660223#c0 "VERIFIED FIXED - Crash in [@ gtk_printer_get_name]") here: maybe the user completes the print operation really quickly, and `EnumeratePrinters` was somehow either still pending or still continuing in the background (not sure if it strictly must complete before the print UI is usable?); and when the print operation completes, the `nsDeviceContextSpecGTK` gets torn down, despite the fact that `EnumeratePrinters` is still running.)

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074)  Assignee |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=1660223#c20)â€¢ 1 year ago |
|  | |

Whoops, never mind -- the thing I'm focused on in [comment 15](/show_bug.cgi?id=1660223#c15 "VERIFIED FIXED - Crash in [@ gtk_printer_get_name]") up through this one isn't an issue after all. The `NewRunnableMethod` utility-code that we're using here **does actually maintain a strong refcounted reference to the passed-in object**:

<https://searchfox.org/mozilla-central/rev/16526d690cccc9c60cacf09cc08e2c3041ef884e/xpcom/threads/nsThreadUtils.h#1352,1358>

```
//  - MyClass must define AddRef and Release methods
...
// The created runnable will take a strong reference to `myObject`.

```

(I was initially confused since there's another utility-function of the same name [here](https://searchfox.org/mozilla-central/rev/16526d690cccc9c60cacf09cc08e2c3041ef884e/ipc/chromium/src/base/task.h#129-138) which is documented as being for non-reference-counted objects. But that one's namespaced inside of a class and definitely isn't what we're using here.)

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074)  Assignee |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=1660223#c21)â€¢ 1 year ago â€¢ [Edited](/page.cgi?id=comment-revisions.html&bug_id=1660223&comment_id=16700315 "2 revisions") |
|  | |

There's a chance this is related to <https://gitlab.gnome.org/GNOME/gtk/-/issues/4672> which emilio filed in response to [bug 1750768](/show_bug.cgi?id=1750768 "RESOLVED DUPLICATE - Firefox crashing when attempting to print").

In that gitlab issue, emilio described the issue as "a null deref / passing a null name to `gtk_printer_get_name` from `find_printer`." Though probably that was mistaken due to our crash reporter mistakenly having shown null instead of e5e5e5 per [comment 7](/show_bug.cgi?id=1660223#c7 "VERIFIED FIXED - Crash in [@ gtk_printer_get_name]"), and really it was an instance of this issue (though it still might be an upstream bug).

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1660223#a103979778_278074)â€¢ 1 year ago |

See Also: â†’ <https://gitlab.gnome.org/GNOME/gtk/-/issues/4672>

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074)  Assignee |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=1660223#c22)â€¢ 1 year ago â€¢ [Edited](/page.cgi?id=comment-revisions.html&bug_id=1660223&comment_id=16700330 "2 revisions") |
|  | |

In any case I agree with emilio's assessment on that bug, that this seems to be a UAF in GTK code rather than in Firefox code.

Here's a recent crash report, so we have a concrete backtrace to reason about:

[bp-1b8c13ce-919c-47b9-b49e-3a2290231206](https://crash-stats.mozilla.org/report/index/1b8c13ce-919c-47b9-b49e-3a2290231206)

Top 10 frames of crashing thread:

```
0  libgtk-3.so.0  gtk_printer_get_name  gtk/gtkprinter.c:436
1  libprintbackend-cups.so  find_printer  modules/printbackends/cups/gtkprintbackendcups.c:1874
2  libglib-2.0.so.0  g_list_find_custom  glib/glist.c:922
3  libprintbackend-cups.so  cups_request_printer_list_cb  modules/printbackends/cups/gtkprintbackendcups.c:3630
4  libprintbackend-cups.so  cups_dispatch_watch_dispatch  modules/printbackends/cups/gtkprintbackendcups.c:1581
5  libglib-2.0.so.0  g_main_dispatch  glib/gmain.c:3309
5  libglib-2.0.so.0  g_main_context_dispatch  glib/gmain.c:3974
6  libglib-2.0.so.0  g_main_context_iterate  glib/gmain.c:4047
7  libglib-2.0.so.0  g_main_loop_run  glib/gmain.c:4241
8  libgtk-3.so.0  gtk_enumerate_printers  gtk/gtkprinter.c:1285

```

I'm using the Linux Mint source on github as a reference for this GTK/cups code, since it's one of the first easily-linkable copies that I could find that has many/most of these source files (though line numbers might not match up exactly due to version differences).

The innermost function in the backtrace is <https://github.com/linuxmint/gtk/blob/158a2b0e1e8d582bc041acc7fe323922747d7787/gtk/gtkprinter.c#L434-L436>

```
const gchar *
gtk_printer_get_name (GtkPrinter *printer)
{
  g_return_val_if_fail (GTK_IS_PRINTER (printer), NULL);

  return printer->priv->name;
}

```

The only object that could conceivably cause a UAF there is the `GtkPrinter *printer` parameter itself, or possibly its `priv` member (i.e. if `printer-priv` is pointing at an object that's been deleted and filled with garbage).

Going up a few stack levels, this `printer` arg seems to come from a linked-list, `removed_printer_checklist`, that CUPS code gets and iterates-across in `cups_request_printer_list_cb`.

That list gets assigned here:

```
removed_printer_checklist = gtk_print_backend_get_printer_list (backend);

```

<https://github.com/linuxmint/gtk/blob/158a2b0e1e8d582bc041acc7fe323922747d7787/modules/printbackends/cups/gtkprintbackendcups.c#L3244C1-L3248C76>

...and then cups iterates over it here (and we crash during this iteration; note `g_list_find_custom` in the backtrace, calling the passed-in function pointer `find_printer`):

```
      /* remove name from checklist if it was found */
      node = g_list_find_custom (removed_printer_checklist,
				 info->printer_name,
				 (GCompareFunc) find_printer);
      removed_printer_checklist = g_list_delete_link (removed_printer_checklist,
						      node);

```

<https://github.com/linuxmint/gtk/blob/158a2b0e1e8d582bc041acc7fe323922747d7787/modules/printbackends/cups/gtkprintbackendcups.c#L3326-L3331>

That iteration does seem to be deleting things as it goes. So a UAF here would suggest that there's a cycle in that list, or perhaps two `printer` objects that somehow share the same `priv` pointer (if `printer->priv` is the deleted thing rather than `printer`). Or just an entry in that list that's got a bogus pointer-to-deleted-data for other reasons.

Anyway: Gecko doesn't manage the lifetime of any of these objects, so I think it's pretty clear that the UAF here is a cups or gtk bug, and not a Gecko bug.

|  | [Jonathan Watt [:jwatt]](/user_profile?user_id=32767) |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=1660223#c23)â€¢ 1 year ago |
|  | |

Nice work, thanks, Daniel!!

(In reply to Daniel Holbert [:dholbert] from [comment #22](/show_bug.cgi?id=1660223#c22 "VERIFIED FIXED - Crash in [@ gtk_printer_get_name]"))

> I'm using the Linux Mint source on github as a reference for this GTK/cups code, since it's one of the first easily-linkable copies that I could find that has many/most of these source files (though line numbers might not match up exactly due to version differences).

FWIW if we were to know which version of gtk is in use, the upstream gtk repo allows you to find the source by tag. For example, on Fedora 38 the current `gtk4` package that's installed is 4.10.5:

<https://github.com/GNOME/gtk/blob/4.10.5/gtk/gtkprinter.c>

Flags: needinfo?(jwatt)

|  | [Jonathan Watt [:jwatt]](/user_profile?user_id=32767) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1660223#a103983325_32767)â€¢ 1 year ago |

Flags: needinfo?(jwatt)

|  | [Gabriele Svelto [:gsvelto]](/user_profile?user_id=448747) |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=1660223#c24)â€¢ 1 year ago |
|  | |

I should be able to figure out the GTK versions by looking at the proc maps in a few minidumps.

|  | [Gabriele Svelto [:gsvelto]](/user_profile?user_id=448747) |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=1660223#c25)â€¢ 1 year ago |
|  | |

Here's a few samples from various distributions:

Ubuntu 20.04.6 LTS

<https://crash-stats.mozilla.org/report/index/e17d20b6-50a2-4bbe-adcf-98b780231207>

gtk-3.24.20

Ubuntu 22.04.3 LTS

<https://crash-stats.mozilla.org/report/index/44f23b98-6967-47fa-8a90-d69030231207>

gtk-3.24.33

Debian 11

<https://crash-stats.mozilla.org/report/index/1f21bc43-ee82-4e43-b1d9-5caef0231207>

gtk-3.24.24

Debian 12

<https://crash-stats.mozilla.org/report/index/fdf28eab-99b9-4c46-bedd-b9a8e0231206>

gtk-3.24.38

OpenSUSE Leap 15.4

<https://crash-stats.mozilla.org/report/index/1a028e01-1c07-456b-bd92-94d1c0231206>

gtk-3.24.34

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074)  Assignee |  |
| --- | --- | --- |
| [Comment 26](/show_bug.cgi?id=1660223#c26)â€¢ 1 year ago â€¢ [Edited](/page.cgi?id=comment-revisions.html&bug_id=1660223&comment_id=16701602 "4 revisions") |
|  | |

Good news, I just repro'd locally. I'll try to capture in rr and submit to pernosco later on today.

This seems to require opening multiple print-preview dialogs at once (which normally isn't something that can happen, but apparently is possible if you get stuck waiting on a response from a remote cups server and you hit Ctrl+P again while the dialog is waiting)

My STR, using Ubuntu 22.04:

(1) Set up a machine as a CUPS print server to share its printers:

```
sudo cupsctl --share-printers

```

Not sure if it's necessary, but I also went to Ubuntu print-settings, Additional Printer Settings, "Add", and then chose "Generic CUPS-BRF" as the printer type and then chose "Generic" and "Postscript" at the driver prompts. This just gave me a shared printer that doesn't actually spit out paper, which is nice.

The rest of my STR happens on my laptop (a second Ubuntu 22.04 machine):

(2) Configure laptop to use the above machine as its CUPS print server, by creating `$HOME/.cups/client.conf` with contents `ServerName IP-ADDRESS-OF-SERVER`

(3) Throttle the laptop bandwidth using `wondershaper`: `sudo apt install wondershaper` and then `sudo wondershaper [interface-name] 200 200` (Here, `interface-name` comes from e.g. `ifconfig`)

(4) Start Firefox (e.g. at `about:home`; the content doesn't matter).

(5) Hold Ctrl and rapidly press P several times.

This will spawn **several layers of stacked print dialogs** (you can't really tell, except that the shadow-border gets a little darker as they stack. You'll uncover them in subsequent steps). The foreground one will probably show a spinner for a while.

(6) (optional) at this point you can remove the wondershaper throttling, `sudo wondershaper clear [interface-name]`)

(7) When the print preview is ready to interact with, click "Print".

(8) After a second, you'll find yourself looking at another print-preview dialog (the one that was covered up). Hit "Print" on that one as well.

ACTUAL RESULTS:

After I hit Print on that second (initially-covered-up) dialog in step 8, it says "Printing" for a few seconds and then I crash.

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074)  Assignee |  |
| --- | --- | --- |
| [Comment 27](/show_bug.cgi?id=1660223#c27)â€¢ 1 year ago |
|  | |

Pernosco trace: [https://pernos.co/debug/xoPD4BFSlg7LL57Y8GITSg/index.html#f{m[BuPC,AA\_,t[Pw,Mq4\_,f{e[BuO4,A/aJ\_,s{afxJhQAAA,bCgs,uVlm9,oVnE9\_\_\_/](https://pernos.co/debug/xoPD4BFSlg7LL57Y8GITSg/index.html#f%7Bm%5BBuPC,AA_,t%5BPw,Mq4_,f%7Be%5BBuO4,A/aJ_,s%7BafxJhQAAA,bCgs,uVlm9,oVnE9___/)

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074)  Assignee |  |
| --- | --- | --- |
| [Comment 28](/show_bug.cgi?id=1660223#c28)â€¢ 1 year ago |
|  | |

I added some markers in the pernosco trace, as guideposts.

So it looks like one bit of interestingness here is that `gtk_enumerate_printers` spins the event loop (`g_main_loop_run`) -- that's shown in the crash reports here as well. That callout happens here:

<https://github.com/GNOME/gtk/blob/f5516845d451ddc1286d6c9c0d7a5a8ce1dd8bc3/gtk/gtkprinter.c#L1336-L1339>

That means we end up in a reentrant event-loop, nested two levels deep in `nsThread::ProcessNextEvent` (shown in pernosco, but not shown in our crash report backtrace for some reason; I'm not sure why).

During that event loop, the GTK printer data gets destroyed, after (because?) we find the printer that we're looking for -- i.e. we get a callback to `nsDeviceContextSpecGTK::PrinterEnumerator` from which we return `TRUE` to indicate "yes, that's the one". And then the GTK printer objects get freed (`gtk_print_backend_destroy`), and then we unwind the stack up to a stack level that's just reported as

`/usr/lib/x86_64-linux-gnu/gtk-3.0/3.0.0/printbackends/libprintbackend-cups.so+[offset]`

...and we crash before exiting that stack level, inside of a call to `g_list_find_custom` (as can be seen in the crash report backtraces).

So it sort of looks like in our reentrant event loop, CUPS is getting confused about whether or not we're enumerating. I'm not yet clear if it's doing a separate enumeration over the same data, or failing to notice that our enumeration completed, or what.

I probably need to try to re-record with more symbols packages installed, or possibly with gtk/cups sources available if I can figure out how to wire that up. It might be a few days before I can do that, though -- I have to context-switch to some other tasks at the moment.

Flags: needinfo?(jwatt) â†’ needinfo?(dholbert)

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074)  Assignee |  |
| --- | --- | --- |
| [Comment 29](/show_bug.cgi?id=1660223#c29)â€¢ 1 year ago |
|  | |

Note, there are two distinct usability issues in [comment 26](/show_bug.cgi?id=1660223#c26 "VERIFIED FIXED - Crash in [@ gtk_printer_get_name]") that we might want to spin off here, once we're comfortable doing so:

* Issue #1: the print dialog takes a long time to populate, if you have CUPS configured to use a remote cups server (`$HOME/.cups/client.conf` with contents `ServerName IP-ADDRESS-OF-SERVER`), particularly if your network traffic to that server is slow (e.g. via `wondershaper` throttling in my STR, or just bad network conditions).
* Issue #2: when that happens (and maybe other times too?), we allow ourselves to spawn multiple print-preview dialogs for the same page. (Possibly just because the dialog is blocked on `gtk_enumerate_printers` which spins the event loop when it's waiting, as discussed above).

Some thoughts on these:

I wonder if Issue #1 might be related to some of the print hangs we've seen on other bugs (often folks tell us they're using a network printer, but I'm not sure if we've considered/asked whether they're using a remote cups server as well). In any case, we need to fix things to account for the possibility that cups can be arbitrarily slow-to-respond.

I imagine/hope we can fix Issue #2 in a relatively straightforward way by adding some sort of RAII guard (or JS equivalent) when the print dialog opens, to prevent further dialogs from opening in nested event loops. This is worth doing for its own sake, and there's a chance that might avoid this crash entirely.

One other quick note, [https://chromium.googlesource.com/chromium/src/+/main/docs/linux/debugging\_gtk.md](https://chromium.googlesource.com/chromium/src/%2B/main/docs/linux/debugging_gtk.md) has some info on how Chromium folks build gtk for local debugging -- I might doing try that for the sake of a more-understandable pernosco trace.

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074)  Assignee |  |
| --- | --- | --- |
| [Comment 30](/show_bug.cgi?id=1660223#c30)â€¢ 1 year ago â€¢ [Edited](/page.cgi?id=comment-revisions.html&bug_id=1660223&comment_id=16702871 "1 revision") |
|  | |

The "multiple superimposed print dialogs" thing doesn't seem to be required, actually; I was just able to trigger this crash with two entirely separate print operations (i.e. my [comment 26](/show_bug.cgi?id=1660223#c26 "VERIFIED FIXED - Crash in [@ gtk_printer_get_name]") STR, but without the "rapidly press ctrl+p" thing; just printing once with ctrl+p, completing that operation, and then printing again with ctrl+p).

I also was able to build libgtk locally, with debug info/symbols, and run Firefox with that locally-built library. For whatever reason, my locally-built library doesn't trigger the crash -- but at the moment when I'd expect a crash, I do get a GTK nonfatal assertion-failure that seems to be a symptom of the same trouble:

```
Gtk-CRITICAL **: 11:41:26.372: gtk_printer_get_name: assertion 'GTK_IS_PRINTER (printer)' failed

```

That's probably a signal that we're passing a bogus object of some sort into `gtk_printer_get_name`, and for whatever reason it hasn't been poisoned yet, but it's still a landmine.

Here's a pernosco trace where we hit that gtk assertion failure, with my local debug build of gtk (so hopefully fairly-debuggable), and with `GTK_DEBUG=printing` to add various bits of logging around gtk printing internals:

[https://pernos.co/debug/DUwm21zoKTPK5aRy37dSfg/index.html#f{m[A0G2,GcCZ\_,t[KA,ENHV\_,f{e[A0G2,GcCZ\_,s{af6RSwAAA,bGw,uvBEL,ovHil\_\_\_,v[{wiLg,v[{f'list',q'stdouterr',p{\_,xAYag\_,{f'container',q'stack',p{\_,xAYag\_\_\_,{w/eg,v[{f'source',q'source',p{\_,xAYag\_,{f'list',q'execution',p{'symbol''gtk\_printer\_get\_name'\_,xAYag\_\_\_\_/](https://pernos.co/debug/DUwm21zoKTPK5aRy37dSfg/index.html#f%7Bm%5BA0G2,GcCZ_,t%5BKA,ENHV_,f%7Be%5BA0G2,GcCZ_,s%7Baf6RSwAAA,bGw,uvBEL,ovHil___,v%5B%7BwiLg,v%5B%7Bf'list',q'stdouterr',p%7B_,xAYag_,%7Bf'container',q'stack',p%7B_,xAYag___,%7Bw/eg,v%5B%7Bf'source',q'source',p%7B_,xAYag_,%7Bf'list',q'execution',p%7B'symbol''gtk_printer_get_name'_,xAYag____/)

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074)  Assignee |  |
| --- | --- | --- |
| [Comment 31](/show_bug.cgi?id=1660223#c31)â€¢ 1 year ago |
|  | |

Looking at that pernosco trace, I'm more confident that this is a bug in GTK (specifically in gtkprintbackendcups.c)

The short version is that we're in some gtk/cups code that updates a collection of printers, while also maintaining a separate list of those printers; and one of the updates triggers the whole collection to be deleted (through a bit of indirection), and then we go to check our separate list and we crash.

Here's roughly what happens:

* We call `gtk_enumerate_printers`, to get a `GtkPrinter` instance corresponding to a particular printer-name that we remember.
* `gtk_enumerate_printers` calls `list_printers_init`, which [sets up a callback-handler for the named signal `"printer-added"`](https://github.com/GNOME/gtk/blob/0b0a5a52af59b50a83f9cf4594d9beb606af36c6/gtk/print/gtkprinter.c#L1275-L1277), wiring that signal up to call [`list_added_cb()`](https://github.com/GNOME/gtk/blob/0b0a5a52af59b50a83f9cf4594d9beb606af36c6/gtk/print/gtkprinter.c#L1189)
* Later on, we find ourselves in [`cups_request_printer_list_cb()`](https://github.com/GNOME/gtk/blob/0b0a5a52af59b50a83f9cf4594d9beb606af36c6/modules/printbackends/gtkprintbackendcups.c#L3643) to handle a response from the cups server with printer info.
* In that `cups_request_printer_list_cb` function, we [set up a local linked-list of printers, `removed_printer_checklist`](https://github.com/GNOME/gtk/blob/0b0a5a52af59b50a83f9cf4594d9beb606af36c6/modules/printbackends/gtkprintbackendcups.c#L3684) that we're comparing against and modifying as-we-go for some reason.
* The main loop of `cups_request_printer_list_cb` [iterates over the CUPS response data](https://github.com/GNOME/gtk/blob/0b0a5a52af59b50a83f9cf4594d9beb606af36c6/modules/printbackends/gtkprintbackendcups.c#L3686-L3688), [generating GtkPrinter instances](https://github.com/GNOME/gtk/blob/0b0a5a52af59b50a83f9cf4594d9beb606af36c6/modules/printbackends/gtkprintbackendcups.c#L3763-L3764) as it goes.
* AND, during that loop: when it creates a new `GtkPrinter`, it [sends the `"printer-added"` signal](https://github.com/GNOME/gtk/blob/0b0a5a52af59b50a83f9cf4594d9beb606af36c6/modules/printbackends/gtkprintbackendcups.c#L3801), which synchronously invokes the `list_added_cb` callback that I discussed at the start here.
* `list_added_cb` calls our own custom comparison function to see if we've found the printer that we're looking for (by name). If we have, then **a bunch of data gets deleted (which is a problem further on)**!! Specifically: `list_added_cb` [calls `stop_enumeration`](https://github.com/GNOME/gtk/blob/0b0a5a52af59b50a83f9cf4594d9beb606af36c6/gtk/print/gtkprinter.c#L1195), which [calls `list_done_cb`](https://github.com/GNOME/gtk/blob/0b0a5a52af59b50a83f9cf4594d9beb606af36c6/gtk/print/gtkprinter.c#L1169), which calls [`list_printers_remove_backend`](https://github.com/GNOME/gtk/blob/0b0a5a52af59b50a83f9cf4594d9beb606af36c6/gtk/print/gtkprinter.c#L1242) which [destroys the print backend and frees the printer list](https://github.com/GNOME/gtk/blob/0b0a5a52af59b50a83f9cf4594d9beb606af36c6/gtk/print/gtkprinter.c#L1222-L1227).
* Then we unwind back up to the `cups_request_printer_list_cb` loop (where we dispatched the "printer-added" signal from), and we keep looping over the cups response data; and when we get to the part where we try to [search in our `removed_printer_checklist`](https://github.com/GNOME/gtk/blob/0b0a5a52af59b50a83f9cf4594d9beb606af36c6/modules/printbackends/gtkprintbackendcups.c#L3753-L3756) linked-list of `GtkPrinter*` pointers, we find that the `GtkPrinter*` pointers in our linked list are all pointing to garbage data, and we either **crash with UAF**, or (if we're lucky) we notice that the object's data doesn't look right for a `GtkPrinter` and we bail out safely, with the `GTK_IS_PRINTER` nonfatal-assertion-failure quoted above.
Flags: needinfo?(dholbert)

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074)  Assignee |  |
| --- | --- | --- |
| [Comment 32](/show_bug.cgi?id=1660223#c32)â€¢ 1 year ago â€¢ [Edited](/page.cgi?id=comment-revisions.html&bug_id=1660223&comment_id=16703044 "1 revision") |
|  | |

Unfortunately a lot of this GTK code has git-blame dating back ~17 years or so, so for better or for worse, this may have been a problem for quite a while.

Coincidentally, our [doomed `removed_printer_checklist` search](https://github.com/GNOME/gtk/blob/0b0a5a52af59b50a83f9cf4594d9beb606af36c6/modules/printbackends/gtkprintbackendcups.c#L3753-L3756) (the last bullet in my previous-comment explanation) seems to have been last touched in a commit from 10 years ago titled `Revert "Fix gtkprintbackendcups crash"`: <https://github.com/GNOME/gtk/commit/9d36dbb44ba14adeb29135de01a936eb623375f2>

But the crash referenced there seems to have been something different from the crash that we're hitting here... maybe. (The reverted patch was a null-check for `removed_printer_checklist` which wouldn't help in this case.)

I'm pretty sure it's possible to write a small GTK program that triggers this same issue, to assist in reporting upstream and seeing if the GTK folks can do anything about this. Based on how ancient the code is and how fiddly printer things are, I'm not entirely sure a fix will be trivial/forthcoming.

I have an untested idea for a workaround on our end -- I think we can avoid around this by **changing our comparison callback to pretend it never finds the thing it's looking for**, i.e. make `nsDeviceContextSpecGTK::PrinterEnumerator` unconditionally return FALSE. That should prevent `list_added_cb` from calling `stop_enumeration` and deleting data out from under the `cups_request_printer_list_cb` loop. It's possible there'll be a perf cost (even in the general weren't-gonna-crash case) to forcing ourselves to traverse the whole printer list, but hopefully it's minimal...

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074)  Assignee |  |
| --- | --- | --- |
| [Comment 33](/show_bug.cgi?id=1660223#c33)â€¢ 1 year ago |
|  | |

Attached file
[Bug 1660223: Let printer enumeration run to completion, to avoid a GTK bug. r?jwatt,AlaskanEmily](attachment.cgi?id=9367750)
â€” [Details](attachment.cgi?id=9367750&action=edit)

|  | [Phabricator Automation](/user_profile?user_id=600971) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1660223#a104154125_600971)â€¢ 1 year ago |

Assignee: nobody â†’ dholbertStatus: NEW â†’ ASSIGNED

|  | [Phabricator Automation](/user_profile?user_id=600971) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1660223#a104154274_600971)â€¢ 1 year ago |

[Attachment #9367750](/attachment.cgi?id=9367750&action=edit "Bug 1660223: Let printer enumeration run to completion, to avoid a GTK bug. r?jwatt,AlaskanEmily") -
Attachment description: Bug 1660223: Let printer enumeration run to completion, to avoid a GTK bug. r?jwatt â†’ Bug 1660223: Let printer enumeration run to completion, to avoid a GTK bug. r?jwatt,AlaskanEmily

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074)  Assignee |  |
| --- | --- | --- |
| [Comment 34](/show_bug.cgi?id=1660223#c34)â€¢ 1 year ago â€¢ [Edited](/page.cgi?id=comment-revisions.html&bug_id=1660223&comment_id=16703059 "1 revision") |
|  | |

Workaround posted. Early next week, I'll also try to write a small demo GTK program that triggers the issue, to assist with reporting upstream so the GTK folks can maybe/hopefully try to fix the root issue here, so that we don't have to work around it.

|  | [Gabriele Svelto [:gsvelto]](/user_profile?user_id=448747) |  |
| --- | --- | --- |
| [Comment 35](/show_bug.cgi?id=1660223#c35)â€¢ 1 year ago |
|  | |

This is a great idea to solve this issue, thanks for taking the time to look into this.

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074)  Assignee |  |
| --- | --- | --- |
| [Comment 36](/show_bug.cgi?id=1660223#c36)â€¢ 1 year ago |
|  | |

BTW, the reason we're doing this printer enumeration in the first place is explained in [bug 1090448 comment 0](/show_bug.cgi?id=1090448#c0 "VERIFIED FIXED - Make e10s printing work on Linux") (though things have changed somewhat since then, I think).

(Basically, we've got a printer name stored as part of the print settings, but not an actual `GtkPrinter*` handle. To get that handle, we have to enumerate the printers to find the one with the matching name.)

|  | [Pulsebot](/user_profile?user_id=510726) |  |
| --- | --- | --- |
| [Comment 37](/show_bug.cgi?id=1660223#c37)â€¢ 1 year ago |
|  | |

Pushed by dholbert@mozilla.com:
<https://hg.mozilla.org/integration/autoland/rev/833e0bfa6d81>
Let printer enumeration run to completion, to avoid a GTK bug. r=jwatt

|  | [Sebastian Hengst [:aryx] (needinfo me if it's about an intermittent or backout)](/user_profile?user_id=258347) |  |
| --- | --- | --- |
| [Comment 38](/show_bug.cgi?id=1660223#c38)â€¢ 1 year ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/833e0bfa6d81>

Group: layout-core-security â†’ core-security-releaseStatus: ASSIGNED â†’ RESOLVEDClosed: 1 year ago
[status-firefox122](/buglist.cgi?f1=cf_status_firefox122&o1=isnotempty):
--- â†’ [fixed](/buglist.cgi?f1=cf_status_firefox122&o1=equals&v1=fixed)Resolution: --- â†’ FIXEDTarget Milestone: --- â†’ 122 Branch

|  | [Donal Meehan [:dmeehan]](/user_profile?user_id=695136) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1660223#a104546927_695136)â€¢ 1 year ago |

[status-firefox120](/buglist.cgi?f1=cf_status_firefox120&o1=isnotempty):
--- â†’ [wontfix](/buglist.cgi?f1=cf_status_firefox120&o1=equals&v1=wontfix)
[status-firefox121](/buglist.cgi?f1=cf_status_firefox121&o1=isnotempty):
--- â†’ [wontfix](/buglist.cgi?f1=cf_status_firefox121&o1=equals&v1=wontfix)
[status-firefox81](/buglist.cgi?f1=cf_status_firefox81&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox81&o1=equals&v1=affected) â†’ [wontfix](/buglist.cgi?f1=cf_status_firefox81&o1=equals&v1=wontfix)
[status-firefox-esr115](/buglist.cgi?f1=cf_status_firefox_esr115&o1=isnotempty):
--- â†’ [affected](/buglist.cgi?f1=cf_status_firefox_esr115&o1=equals&v1=affected)
[tracking-firefox122](/buglist.cgi?f1=cf_tracking_firefox122&o1=isnotempty):
--- â†’ [+](/buglist.cgi?f1=cf_tracking_firefox122&o1=equals&v1=%2B)
[tracking-firefox-esr115](/buglist.cgi?f1=cf_tracking_firefox_esr115&o1=isnotempty):
--- â†’ [122+](/buglist.cgi?f1=cf_tracking_firefox_esr115&o1=equals&v1=122%2B)

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1660223#a104562270_278074)â€¢ 1 year ago |

Duplicate of this bug: [1750768](/show_bug.cgi?id=1750768 "RESOLVED DUPLICATE - Firefox crashing when attempting to print")

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074)  Assignee |  |
| --- | --- | --- |
| [Comment 40](/show_bug.cgi?id=1660223#c40)â€¢ 1 year ago |
|  | |

Good news: in [bug 1750768 comment 14](/show_bug.cgi?id=1750768#c14 "RESOLVED DUPLICATE - Firefox crashing when attempting to print"), we have confirmation from a user that the patch (landed in [comment 37](/show_bug.cgi?id=1660223#c37 "VERIFIED FIXED - Crash in [@ gtk_printer_get_name]")) has addressed the crash.

(I've now marked that bug as a dupe of this one.)

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074)  Assignee |  |
| --- | --- | --- |
| [Comment 41](/show_bug.cgi?id=1660223#c41)â€¢ 1 year ago |
|  | |

Attached file
[minimal gtk program (c++ testcase) that triggers the same UAF bug for me](attachment.cgi?id=9368606)
â€” [Details](attachment.cgi?id=9368606&action=edit)

Here's a minimal gtk testcase that triggers the underlying GTK bug.

As noted in the comment at the top of this C++ source code: one of the requirements to trigger the issue with this testcase is the environmental variable `G_DEBUG=fatal-criticals`. Without that, gtk\_printer\_get\_name's graceful `GTK_IS_PRINTER` assertion can handle this gracefully pretty reliably and will return when it detects that it's been given a garbage-object rather than something that it can recognize as a GtkPrinter.

The `G_DEBUG=fatal-criticals` environmental variable makes that assertion-failure fatal, though (which is useful, since in this case it's a sign of UAF.)

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1660223#a104612512_278074)â€¢ 1 year ago |

[Attachment #9368606](/attachment.cgi?id=9368606&action=edit "minimal gtk program (c++ testcase) that triggers the same UAF bug for me") -
Attachment mime type: text/x-c++src â†’ text/plain

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074)  Assignee |  |
| --- | --- | --- |
| [Comment 42](/show_bug.cgi?id=1660223#c42)â€¢ 1 year ago â€¢ [Edited](/page.cgi?id=comment-revisions.html&bug_id=1660223&comment_id=16712175 "1 revision") |
|  | |

I've just reported this to the Gnome folks at <https://security.gnome.org> (just a web form; if a ticket results from it, I'll post a link to the ticket here). They might just bump <https://gitlab.gnome.org/GNOME/gtk/-/issues/4672> to be sec-sensitive, too; I mentioned in my form-submission that this is essentially that exact bug, which we now know to be a UAF rather than a null-deref.

|  | [Randell Jesup [:jesup] (needinfo me)](/user_profile?user_id=11539) |  |
| --- | --- | --- |
| [Comment 43](/show_bug.cgi?id=1660223#c43)â€¢ 1 year ago |
|  | |

Would this be part of the same issue? <https://crash-stats.mozilla.org/signature/?address=~e5e5e&product=Firefox&version=122.0a1&version=121.0&version=121.0b&version=120.0.1&version=120.0&date=%3E%3D2023-11-15T02%3A34%3A00.000Z&date=%3C2023-12-15T02%3A34%3A00.000Z&_sort=-date&signature=libgtk-3.so.0%400x3c80cd>

|  | [Randell Jesup [:jesup] (needinfo me)](/user_profile?user_id=11539) |  |
| --- | --- | --- |
| [Comment 44](/show_bug.cgi?id=1660223#c44)â€¢ 1 year ago |
|  | |

and <https://crash-stats.mozilla.org/signature/?address=~e5e5e&product=Firefox&version=122.0a1&version=121.0&version=121.0b&version=120.0.1&version=120.0&signature=libgtk-3.so.0%400x39bcf6&date=%3E%3D2023-11-15T02%3A34%3A00.000Z&date=%3C2023-12-15T02%3A34%3A00.000Z&_columns=date&_columns=product&_columns=version&_columns=build_id&_columns=platform&_columns=reason&_columns=address&_columns=install_time&_columns=startup_crash&_sort=-date&page=1>

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074)  Assignee |  |
| --- | --- | --- |
| [Comment 45](/show_bug.cgi?id=1660223#c45)â€¢ 1 year ago |
|  | |

(In reply to Randell Jesup [:jesup] (needinfo me) from [comment #43](/show_bug.cgi?id=1660223#c43 "VERIFIED FIXED - Crash in [@ gtk_printer_get_name]"))

> Would this be part of the same issue? <https://crash-stats.mozilla.org/signature/?address=~e5e5e&product=Firefox&version=122.0a1&version=121.0&version=121.0b&version=120.0.1&version=120.0&date=%3E%3D2023-11-15T02%3A34%3A00.000Z&date=%3C2023-12-15T02%3A34%3A00.000Z&_sort=-date&signature=libgtk-3.so.0%400x3c80cd>

Yes, that's for `libgtk-3.so.0@0x3c80cd` -- it looks like we've already got that tracked as a known one of the crash signatures here (added in [comment 13](/show_bug.cgi?id=1660223#c13 "VERIFIED FIXED - Crash in [@ gtk_printer_get_name]")).

Double-checking though: the most recent crash there, [bp-369737f8-0648-4b03-a5ab-96c290231215](https://crash-stats.mozilla.org/report/index/369737f8-0648-4b03-a5ab-96c290231215) , seems to be exactly this -- it's got symbols for nearly all stack levels except the level 0 and level 21. Comparing the the stack levels that it does have against the crash report that I linked in [comment 22](/show_bug.cgi?id=1660223#c22 "VERIFIED FIXED - Crash in [@ gtk_printer_get_name]"), they match up pretty closely.

(In reply to Randell Jesup [:jesup] (needinfo me) from [comment #44](/show_bug.cgi?id=1660223#c44 "VERIFIED FIXED - Crash in [@ gtk_printer_get_name]"))

> and <https://crash-stats.mozilla.org/signature/?address=~e5e5e&product=Firefox&version=122.0a1&version=121.0&version=121.0b&version=120.0.1&version=120.0&signature=libgtk-3.so.0%400x39bcf6&date=%3E%3D2023-11-15T02%3A34%3A00.000Z&date=%3C2023-12-15T02%3A34%3A00.000Z&_columns=date&_columns=product&_columns=version&_columns=build_id&_columns=platform&_columns=reason&_columns=address&_columns=install_time&_columns=startup_crash&_sort=-date&page=1>

Very likely yes. Hard to say for certain there, since I'm not seeing any crashes that have symbols for any of the non-Gecko stacktrace levels, but the fact that we're in a `RunnableMethodImpl<nsDeviceContextSpecGTK*, ...>` and the pattern of `libgtk`/`libglib`/`libprintbackend-cups` below that are a pretty strong indicator that it's this same crash.

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074)  Assignee |  |
| --- | --- | --- |
| [Comment 46](/show_bug.cgi?id=1660223#c46)â€¢ 1 year ago |
|  | |

--> Tentatively adding the crash signature from [comment 44](/show_bug.cgi?id=1660223#c44 "VERIFIED FIXED - Crash in [@ gtk_printer_get_name]").

Crash Signature: [@ gtk\_printer\_get\_name]
[@ g\_type\_check\_instance\_cast]
[@ libgtk-3.so.0@0x3ad666]
[@ libgtk-3.so.0@0x3c80cd]
[@ libgtk-3.so.0@0x3ad8c6] â†’ [@ gtk\_printer\_get\_name]
[@ g\_type\_check\_instance\_cast]
[@ libgtk-3.so.0@0x3ad666]
[@ libgtk-3.so.0@0x3c80cd]
[@ libgtk-3.so.0@0x3ad8c6]
[@ libgtk-3.so.0@0x39bcf6]

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074)  Assignee |  |
| --- | --- | --- |
| [Comment 47](/show_bug.cgi?id=1660223#c47)â€¢ 1 year ago |
|  | |

Attached file
[Bug 1660223: Let printer enumeration run to completion, to avoid a GTK bug. r?jwatt,AlaskanEmily](attachment.cgi?id=9369132)
â€” [Details](attachment.cgi?id=9369132&action=edit)

Original Revision: <https://phabricator.services.mozilla.com/D195949>

|  | [Phabricator Automation](/user_profile?user_id=600971) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1660223#a104914493_600971)â€¢ 1 year ago |

[Attachment #9369132](/attachment.cgi?id=9369132&action=edit "Bug 1660223: Let printer enumeration run to completion, to avoid a GTK bug. r?jwatt,AlaskanEmily") -
Flags: approval-mozilla-esr115?

|  | [Phabricator Automation](/user_profile?user_id=600971) |  |
| --- | --- | --- |
| [Comment 48](/show_bug.cgi?id=1660223#c48)â€¢ 1 year ago |
|  | |

# Uplift Approval Request

* **Risk associated with taking this patch**: Low.
* **String changes made/needed**: None
* **Is Android affected?**: no
* **Code covered by automated testing**: no
* **Steps to reproduce for manual QE testing**: See [comment 26](/show_bug.cgi?id=1660223#c26 "VERIFIED FIXED - Crash in [@ gtk_printer_get_name]") on the bug ( <https://bugzilla.mozilla.org/show_bug.cgi?id=1660223#c26> )
* **Explanation of risk level**: The patch just has us complete a walk through the list of printers (which we might have to do in general), rather than interrupting the walk partway through. In many cases, we already would have been doing a walthrough of the full list of printers, so this isn't a new behavior. See end of [comment 32](/show_bug.cgi?id=1660223#c32 "VERIFIED FIXED - Crash in [@ gtk_printer_get_name]").
* **Fix verified in Nightly**: yes
* **Needs manual QE test**: no
* **User impact if declined**: Crashes when printing in certain configurations

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074)  Assignee |  |
| --- | --- | --- |
| [Comment 49](/show_bug.cgi?id=1660223#c49)â€¢ 1 year ago â€¢ [Edited](/page.cgi?id=comment-revisions.html&bug_id=1660223&comment_id=16718339 "3 revisions") |
|  | |

(In reply to Daniel Holbert [:dholbert] from [comment #42](/show_bug.cgi?id=1660223#c42 "VERIFIED FIXED - Crash in [@ gtk_printer_get_name]"))

> I've just reported this to the Gnome folks at <https://security.gnome.org> (just a web form; if a ticket results from it, I'll post a link to the ticket here).

My report spawned a Gnome security-bug at <https://gitlab.gnome.org/GNOME/gtk/-/issues/6265> (which shows up as 404 since it's hidden to the public). It's essentially a dupe of their [public bug](https://gitlab.gnome.org/GNOME/gtk/-/issues/4672), but they're keeping them separate for now since 4672 is already public.

I'm also adding a whiteboard note here to remind ourselves to keep this bug hidden until those bugs are fixed/openable (particularly when 6265 can be made public.) Don't want to zero-day the gnome folks with the details discussed here.

See Also: â†’ <https://gitlab.gnome.org/GNOME/gtk/-/issues/6265>Whiteboard: [print2020][old-ui?][tbird crash] â†’ [keep hidden until linked GTK bugs are public/fixed][print2020][old-ui?][tbird crash]

|  | [Andrei Vaida [:avaida]](/user_profile?user_id=488993) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1660223#a105305473_488993)â€¢ 1 year ago |

QA Whiteboard: [post-critsmash-triage]Flags: qe-verify+

|  | [Mihai Boldan, Desktop QA [:mboldan]](/user_profile?user_id=551058) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1660223#a105311300_551058)â€¢ 1 year ago |

QA Whiteboard: [post-critsmash-triage] â†’ [post-critsmash-triage] [qa-triaged]

|  | [Daniel Bodea [:danibodea]](/user_profile?user_id=616104) |  |
| --- | --- | --- |
| [Comment 50](/show_bug.cgi?id=1660223#c50)â€¢ 1 year ago |
|  | |

I have attempted to perform the steps in [comment 26](/show_bug.cgi?id=1660223#c26 "VERIFIED FIXED - Crash in [@ gtk_printer_get_name]") to trigger this crash, but I am unable due to various reasons: the technical knowledge needed to properly complete them is quite high for my level (creating client.conf file with specific content and server names, throttling bandwidth, creating and sharing printers) and 2 different Ubuntu systems are required to complete the steps. This being said I cannot reproduce this issue.

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074)  Assignee |  |
| --- | --- | --- |
| [Comment 51](/show_bug.cgi?id=1660223#c51)â€¢ 1 year ago â€¢ [Edited](/page.cgi?id=comment-revisions.html&bug_id=1660223&comment_id=16723866 "1 revision") |
|  | |

Thanks for trying! I think I can do verification here, since I've got a setup that reproduces the crash.

Which builds are we trying to verify as good/bad at this stage? Just nightlies before/after the patch landed? Or current release 121 vs. current beta 122?

Flags: needinfo?(dbodea)

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074)  Assignee |  |
| --- | --- | --- |
| [Comment 52](/show_bug.cgi?id=1660223#c52)â€¢ 1 year ago |
|  | |

> (2) Configure laptop to use the above machine as its CUPS print server, by creating $HOME/.cups/client.conf with contents ServerName IP-ADDRESS-OF-SERVER

Side note, partly for my own reference later: instead of this `client.conf` thing, you can also just run the following in the terminal (importantly, the same terminal that you launch Firefox from):

`export CUPS_SERVER=10.0.30.5`

(where `10.0.30.5` is just an example; that's meant to be the IP address of the other machine that you're using as a remote CUPS server.)

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074)  Assignee |  |
| --- | --- | --- |
| [Comment 53](/show_bug.cgi?id=1660223#c53)â€¢ 1 year ago â€¢ [Edited](/page.cgi?id=comment-revisions.html&bug_id=1660223&comment_id=16724494 "1 revision") |
|  | |

Right now at least, in my test environment (using my laptop, with desktop as CUPS server via `CUPS_SERVER` environmental variable as noted in previous comment), I'm hitting this crash immediately on the first print operation, in builds known-to-be affected by the bug, without even needing the `wondershaper` bandwidth-throttling or repeated prints described in [comment 26](/show_bug.cgi?id=1660223#c26 "VERIFIED FIXED - Crash in [@ gtk_printer_get_name]").

NIGHTLY BEFORE/AFTER THE FIX:

Reproduced the bug in Nightly 122.0a1 (2023-12-12). Crash report: [bp-48910ebe-a33d-4180-90ab-38dcd0231222](https://crash-stats.mozilla.org/report/index/48910ebe-a33d-4180-90ab-38dcd0231222)

Unable to reproduce in Nightly 122.0a1 (2023-12-14)

RELEASE 121 VS BETA 122:

Reproduced the bug in Firefox 121.0 (64-bit). Crash report: [bp-bc0a3026-0fc9-4a41-8de1-6fdf70231222](https://crash-stats.mozilla.org/report/index/bc0a3026-0fc9-4a41-8de1-6fdf70231222)

Unable to reproduce in Firefox 122.0b3

NOTES:

In these comparisons, the reproducing builds (121. and the 2023-12-12 nightly) reproduced the crash for me on my very first attempt to print.

The not-reproducing builds did not; I tried again several times, including the measures in [comment 26](/show_bug.cgi?id=1660223#c26 "VERIFIED FIXED - Crash in [@ gtk_printer_get_name]") (wondershaper, repeated print operations with inadvertently-stacked print dialogs), and was still unable to repro, so I'm pretty confident that the not-repreoducing in these builds is "real" rather than just luck.

So I'm happy calling this "verified fixed" in Nightly (at least in 2023-12-14 and newer), and "verified fixed" in 122.0b3

danibodea, let me know if there are any other comparisons/verification that we need here. I'll be happy to restest with ESR builds once the fix gets uplifted there.

Thanks!

Status: RESOLVED â†’ VERIFIED
[status-firefox122](/buglist.cgi?f1=cf_status_firefox122&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox122&o1=equals&v1=fixed) â†’ [verified](/buglist.cgi?f1=cf_status_firefox122&o1=equals&v1=verified)

|  | [Phabricator Automation](/user_profile?user_id=600971) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1660223#a105756159_600971)â€¢ 1 year ago |

[Attachment #9369132](/attachment.cgi?id=9369132&action=edit "Bug 1660223: Let printer enumeration run to completion, to avoid a GTK bug. r?jwatt,AlaskanEmily") -
Flags: approval-mozilla-esr115? â†’ approval-mozilla-esr115+

|  | [Pulsebot](/user_profile?user_id=510726) |  |
| --- | --- | --- |
| [Comment 54](/show_bug.cgi?id=1660223#c54)â€¢ 1 year ago |
| uplift | |

<https://hg.mozilla.org/releases/mozilla-esr115/rev/0168b085c45b>

|  | [Lando Automation](/user_profile?user_id=640478) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1660223#a105756336_640478)â€¢ 1 year ago |

[status-firefox-esr115](/buglist.cgi?f1=cf_status_firefox_esr115&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox_esr115&o1=equals&v1=affected) â†’ [fixed](/buglist.cgi?f1=cf_status_firefox_esr115&o1=equals&v1=fixed)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1660223#a106508635_1689)â€¢ 1 year ago |

Keywords: [keep-hidden](/buglist.cgi?keywords=keep-hidden&resolution=---)

|  | [Daniel Bodea [:danibodea]](/user_profile?user_id=616104) |  |
| --- | --- | --- |
| [Comment 55](/show_bug.cgi?id=1660223#c55)â€¢ 1 year ago |
|  | |

(In reply to Daniel Holbert [:dholbert] from [comment #51](/show_bug.cgi?id=1660223#c51 "VERIFIED FIXED - Crash in [@ gtk_printer_get_name]"))

> Thanks for trying! I think I can do verification here, since I've got a setup that reproduces the crash.
>
> Which builds are we trying to verify as good/bad at this stage? Just nightlies before/after the patch landed? Or current release 121 vs. current beta 122?

I'm sorry for the late reply. I normally attempt to reproduce in builds immediately before the fix and then attempt verification in the latest versions of respective channels. Thank you for the verification! I'll keep this bug in a backlog and remind you to verify ESR channel as well, when it lands, however, it's worth knowing that verification in a treeherder build with the fix is also acceptable.

Flags: needinfo?(dbodea)

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074)  Assignee |  |
| --- | --- | --- |
| [Comment 56](/show_bug.cgi?id=1660223#c56)â€¢ 1 year ago â€¢ [Edited](/page.cgi?id=comment-revisions.html&bug_id=1660223&comment_id=16738431 "1 revision") |
|  | |

Thanks! Looks like this hit ESR already, actually (on treeherder at least). I'll do verification for the before/after builds on TreeHerder for that tree, using `Linux x64 Shippable` row, "Bs" task, choosing the "target.tar.bz2" artifact.

Unpatched: <https://treeherder.mozilla.org/jobs?repo=mozilla-esr115&searchStr=linux%2C64%2Cshippable%2CBs&revision=0f158c2767db4d0e5f486c70fa83ba6cec4f1287&selectedTaskRun=S24v2lXbSGKEDckUXvxRPg.0>

Patched: <https://treeherder.mozilla.org/jobs?repo=mozilla-esr115&searchStr=linux%2C64%2Cshippable%2CBs&revision=0168b085c45b39f0f2ddb3d671e2e3a6f6631ff6&selectedTaskRun=RWNWoLcUSkOLMqll4HpWCg.0>

As in [comment 53](/show_bug.cgi?id=1660223#c53 "VERIFIED FIXED - Crash in [@ gtk_printer_get_name]"), the "Unpatched" build here crashed on the first print operation when running in my test environment with CUPS\_SERVER set to use my remote print server. Crash reports:

[bp-891c047c-ecdb-4965-92c6-142420240106](https://crash-stats.mozilla.org/report/index/891c047c-ecdb-4965-92c6-142420240106)

[bp-5bd4c0d5-7f3e-4948-bcf3-0c0b90240106](https://crash-stats.mozilla.org/report/index/5bd4c0d5-7f3e-4948-bcf3-0c0b90240106)

And I was unable to get the "Patched" build to crash, after a few minutes of similar print jobs that crashed the unpatched build (and trying with wondershaper as well for good measure).

--> Verified on ESR115 with treeherder builds.

[status-firefox-esr115](/buglist.cgi?f1=cf_status_firefox_esr115&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox_esr115&o1=equals&v1=fixed) â†’ [verified](/buglist.cgi?f1=cf_status_firefox_esr115&o1=equals&v1=verified)

|  | [Daniel Bodea [:danibodea]](/user_profile?user_id=616104) |  |
| --- | --- | --- |
| [Comment 57](/show_bug.cgi?id=1660223#c57)â€¢ 1 year ago |
|  | |

Thank you for the help!

Flags: qe-verify+

|  | [Jesse Schwartzentruber (:truber)](/user_profile?user_id=486733) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1660223#a107598768_486733)â€¢ 1 year ago |

Whiteboard: [keep hidden until linked GTK bugs are public/fixed][print2020][old-ui?][tbird crash] â†’ [keep hidden until linked GTK bugs are public/fixed][print2020][old-ui?][tbird crash][adv-main122+][adv-esr115.7+]

|  | [Jesse Schwartzentruber (:truber)](/user_profile?user_id=486733) |  |
| --- | --- | --- |
| [Comment 58](/show_bug.cgi?id=1660223#c58)â€¢ 1 year ago |
|  | |

Attached file
[advisory.txt](attachment.cgi?id=9373596)
â€” [Details](attachment.cgi?id=9373596&action=edit)

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074)  Assignee |  |
| --- | --- | --- |
| [Comment 59](/show_bug.cgi?id=1660223#c59)â€¢ 1 year ago |
|  | |

Note, the associated `[@ g_type_check_instance_cast ]` crash signature happens to have two new crash reports today ([here](https://crash-stats.mozilla.org/report/index/40b42494-5ae1-4662-b985-361950240118) and [here](https://crash-stats.mozilla.org/report/index/37f48309-716f-4304-95fe-9a0e70240118), from Nightly 123.0a1 -- but they're not related to this bug (nothing printing-related in the backtrace). I filed [bug 1875370](/show_bug.cgi?id=1875370 "RESOLVED INVALID") on those.

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074)  Assignee |  |
| --- | --- | --- |
| [Comment 60](/show_bug.cgi?id=1660223#c60)â€¢ 1 year ago |
|  | |

Disregarding those two crashes discussed in [comment 59](/show_bug.cgi?id=1660223#c59 "VERIFIED FIXED - Crash in [@ gtk_printer_get_name]"), we've still got zero crash volume for any Firefox versions beyond 121 (i.e. any versions with the fix), for any of the signatures associated with this bug.

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1660223#a107757424_578488)â€¢ 1 year ago |

Alias: CVE-2024-0746

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074)  Assignee |  |
| --- | --- | --- |
| [Comment 61](/show_bug.cgi?id=1660223#c61)â€¢ 7 months ago |
|  | |

FWIW the associated GTK bugs here are unhidden, so I'm not sure we need to keep this closed anymore.

The two GTK bug reports were

<https://gitlab.gnome.org/GNOME/gtk/-/issues/4672>

<https://gitlab.gnome.org/GNOME/gtk/-/issues/6265>

The older one was always open (it was filed before we realized there was a sec issue or knew what was going on), and has since been duped to the newer one.

The newer one has been fixed and was made "visible to everyone" 3 months ago [March 13th]

dveditz, I think we're OK to un-hide this if you agree.

Flags: needinfo?(dveditz)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 62](/show_bug.cgi?id=1660223#c62)â€¢ 7 months ago |
|  | |

Thanks

Group: core-security-releaseFlags: needinfo?(dveditz)Keywords: [keep-hidden](/buglist.cgi?keywords=keep-hidden&resolution=---)Whiteboard: [keep hidden until linked GTK bugs are public/fixed][print2020][old-ui?][tbird crash][adv-main122+][adv-esr115.7+] â†’ [print2020][old-ui?][tbird crash][adv-main122+][adv-esr115.7+]
You need to [log in](/show_bug.cgi?id=1660223&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top â†‘

## Attachment

Hide Details

### General

Creator:  [Daniel Holbert [:dholbert]](/user_profile?user_id=278074)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from www.mozilla.org_edd21a79_20250115_081846.html ===


## Help us improve your Mozilla experience

In addition to Cookies necessary for this site to function, weâ€™d like your permission to set some additional Cookies to better understand your browsing needs and improve your experience. Rest assured â€” we value your privacy.

Accept All Additional Cookies

Reject All Additional Cookies

[Cookie settings](/en-US/privacy/websites/cookie-settings/)

Menu
[![Mozilla](https://www.mozilla.org/media/img/logos/m24/lockup-black.f2ddba3f0724.svg)](/en-US/)

* [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
  Firefox browsers](/en-US/firefox/)
  Close Firefox browsers menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Desktop](/en-US/firefox/new/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for iOS](/en-US/firefox/browsers/mobile/ios/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Android](/en-US/firefox/browsers/mobile/android/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/focus/logo.aac3e33175cb.svg)
    ## Firefox Focus](/en-US/firefox/browsers/mobile/focus/)
  + [## Firefox blog](https://blog.mozilla.org/firefox/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=firefox)
* [Products](/en-US/products/)
  Close Products menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/mozilla/vpn/logo.c648f487bfb8.svg)
    ## Mozilla VPN](/en-US/products/vpn/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/monitor/logo.d97e5516f9e6.svg)
    ## Mozilla Monitor](https://monitor.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/relay/logo-white.d42a8b52e44c.svg)
    ## Firefox Relay](https://relay.firefox.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/pocket/logo.17446bc33a5d.svg)
    ## Pocket](https://getpocket.com/firefox_learnmore/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/nav/icons/icon-mdn-plus.f54475f980ab.svg)
    ## MDN Plus](https://developer.mozilla.org/plus?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/fakespot/logo-blue.3973b8fe9631.svg)
    ## Fakespot](https://fakespot.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/thunderbird/logo-thunderbird.121e9c0fed45.svg)
    ## Thunderbird](https://www.thunderbird.net/)

  [All products](/en-US/products/)
* [About us](/en-US/about/)
  Close About us menu

  Our Mission

  + [## About Mozilla](/en-US/about/)
  + [## The Mozilla Manifesto](/en-US/about/manifesto/)
  + [## Get Involved](/en-US/contribute/)
  + [## Innovation Projects](https://future.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Blog](https://blog.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)

  Our Work

  + [## Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla.ai](https://www.mozilla.ai/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Ventures](https://mozilla.vc/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Advertising](/en-US/advertising/)

## Menu

* Mozilla Security

## [Mozilla Security](/en-US/security/)

* [Advisories](/en-US/security/advisories/)
* [Known Vulnerabilities](/en-US/security/known-vulnerabilities/)
* [Mozilla Security Blog](https://blog.mozilla.com/security/)
* [Security Bug Bounty](/en-US/security/bug-bounty/)
* [Third-party Injection Policy](/en-US/security/third-party-software-injection/)

## [Client Bug Bounty](/en-US/security/client-bug-bounty/)

* [Frequently Asked Questions](/en-US/security/bug-bounty/faq/)
* [Hall of Fame](/en-US/security/bug-bounty/hall-of-fame/)

## [Web Bug Bounty](/en-US/security/web-bug-bounty/)

* [Eligible Websites](/en-US/security/bug-bounty/web-eligible-sites/)
* [Frequently Asked Questions](/en-US/security/bug-bounty/faq-webapp/)
* [Hall of Fame](/en-US/security/bug-bounty/web-hall-of-fame/)

# Mozilla Foundation Security Advisory 2024-01

## Security Vulnerabilities fixed in Firefox 122

Announced
January 23, 2024
Impact
high
Products
Firefox
Fixed in

* Firefox 122

#### [#CVE-2024-0741: Out of bounds write in ANGLE](#CVE-2024-0741)

Reporter
Renan Rios
Impact
high
##### Description

An out of bounds write in ANGLE could have allowed an attacker to corrupt memory leading to a potentially exploitable crash.

##### References

* [Bug 1864587](https://bugzilla.mozilla.org/show_bug.cgi?id=1864587)

#### [#CVE-2024-0742: Failure to update user input timestamp](#CVE-2024-0742)

Reporter
Andrew McCreight
Impact
high
##### Description

It was possible for certain browser prompts and dialogs to be activated or dismissed unintentionally by the user due to an incorrect timestamp used to prevent input after page load.

##### References

* [Bug 1867152](https://bugzilla.mozilla.org/show_bug.cgi?id=1867152)

#### [#CVE-2024-0743: Crash in NSS TLS method](#CVE-2024-0743)

Reporter
John Schanck
Impact
high
##### Description

An unchecked return value in TLS handshake code could have caused a potentially exploitable crash.

##### References

* [Bug 1867408](https://bugzilla.mozilla.org/show_bug.cgi?id=1867408)

#### [#CVE-2024-0744: Wild pointer dereference in JavaScript](#CVE-2024-0744)

Reporter
Lukas Bernhard
Impact
high
##### Description

In some circumstances, JIT compiled code could have dereferenced a wild pointer value. This could have led to an exploitable crash.

##### References

* [Bug 1871089](https://bugzilla.mozilla.org/show_bug.cgi?id=1871089)

#### [#CVE-2024-0745: Stack buffer overflow in WebAudio](#CVE-2024-0745)

Reporter
Yangkang of 360 ATA Team
Impact
high
##### Description

The WebAudio `OscillatorNode` object was susceptible to a stack buffer overflow. This could have led to a potentially exploitable crash.

##### References

* [Bug 1871838](https://bugzilla.mozilla.org/show_bug.cgi?id=1871838)

#### [#CVE-2024-0746: Crash when listing printers on Linux](#CVE-2024-0746)

Reporter
Cornel Ionce
Impact
moderate
##### Description

A Linux user opening the print preview dialog could have caused the browser to crash.

##### References

* [Bug 1660223](https://bugzilla.mozilla.org/show_bug.cgi?id=1660223)

#### [#CVE-2024-0747: Bypass of Content Security Policy when directive unsafe-inline was set](#CVE-2024-0747)

Reporter
Seongil Wi
Impact
moderate
##### Description

When a parent page loaded a child in an iframe with `unsafe-inline`, the parent Content Security Policy could have overridden the child Content Security Policy.

##### References

* [Bug 1764343](https://bugzilla.mozilla.org/show_bug.cgi?id=1764343)

#### [#CVE-2024-0748: Compromised content process could modify document URI](#CVE-2024-0748)

Reporter
Young Min Kim
Impact
moderate
##### Description

A compromised content process could have updated the document URI. This could have allowed an attacker to set an arbitrary URI in the address bar or history.

##### References

* [Bug 1783504](https://bugzilla.mozilla.org/show_bug.cgi?id=1783504)

#### [#CVE-2024-0749: Phishing site popup could show local origin in address bar](#CVE-2024-0749)

Reporter
Kestrel
Impact
moderate
##### Description

A phishing site could have repurposed an `about:` dialog to show phishing content with an incorrect origin in the address bar.

##### References

* [Bug 1813463](https://bugzilla.mozilla.org/show_bug.cgi?id=1813463)

#### [#CVE-2024-0750: Potential permissions request bypass via clickjacking](#CVE-2024-0750)

Reporter
Hafiizh
Impact
moderate
##### Description

A bug in popup notifications delay calculation could have made it possible for an attacker to trick a user into granting permissions.

##### References

* [Bug 1863083](https://bugzilla.mozilla.org/show_bug.cgi?id=1863083)

#### [#CVE-2024-0751: Privilege escalation through devtools](#CVE-2024-0751)

Reporter
Rob Wu
Impact
moderate
##### Description

A malicious devtools extension could have been used to escalate privileges.

##### References

* [Bug 1865689](https://bugzilla.mozilla.org/show_bug.cgi?id=1865689)

#### [#CVE-2024-0752: Use-after-free could occur when applying update on macOS](#CVE-2024-0752)

Reporter
Nika Layzell
Impact
moderate
##### Description

A use-after-free crash could have occurred on macOS if a Firefox update were being applied on a very busy system. This could have resulted in an exploitable crash.

##### References

* [Bug 1866840](https://bugzilla.mozilla.org/show_bug.cgi?id=1866840)

#### [#CVE-2024-0753: HSTS policy on subdomain could bypass policy of upper domain](#CVE-2024-0753)

Reporter
Hanno BÃ¶ck
Impact
moderate
##### Description

In specific HSTS configurations an attacker could have bypassed HSTS on a subdomain.

##### References

* [Bug 1870262](https://bugzilla.mozilla.org/show_bug.cgi?id=1870262)

#### [#CVE-2024-0754: Crash when using some WASM files in devtools](#CVE-2024-0754)

Reporter
Christian Holler
Impact
moderate
##### Description

Some WASM source files could have caused a crash when loaded in devtools.

##### References

* [Bug 1871605](https://bugzilla.mozilla.org/show_bug.cgi?id=1871605)

#### [#CVE-2024-0755: Memory safety bugs fixed in Firefox 122, Firefox ESR 115.7, and Thunderbird 115.7](#CVE-2024-0755)

Reporter
Daniel Holbert, Andrew Osmond, and the Mozilla Fuzzing Team
Impact
moderate
##### Description

Memory safety bugs present in Firefox 121, Firefox ESR 115.6, and Thunderbird 115.6. Some of these bugs showed evidence of memory corruption and we presume that with enough effort some of these could have been exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 122, Firefox ESR 115.7, and Thunderbird 115.7](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1868456%2C1871445%2C1873701)

## Company

* [Leadership](/about/leadership/)
* [Press Center](https://blog.mozilla.org/category/mozilla/news/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=company)
* [Careers](/en-US/careers/)
* [Contact](/en-US/contact/)

## Support

* [Product Help](https://support.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [File a Bug](https://bugzilla.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [Localize Mozilla](https://pontoon.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)

## Resources

* [Advertise with Mozilla](/en-US/advertising/)
* [Firefox Release Notes](/firefox/134.0.1/releasenotes/)

## Developers

* [Developer Edition](/en-US/firefox/developer/)
* [Enterprise](/en-US/firefox/enterprise/)
* [Tools](https://firefox-source-docs.mozilla.org/devtools-user/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=developers)
* [MDN](https://developer.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer)

## Follow @Mozilla

* [X (formerly Twitter) (@mozilla)](https://twitter.com/mozilla)
* [Instagram (@mozilla)](https://www.instagram.com/mozilla/)
* [LinkedIn (@mozilla)](https://www.linkedin.com/company/mozilla-corporation/)
* [TikTok (@mozilla)](https://www.tiktok.com/%40mozilla)
* [Spotify (@mozilla)](https://open.spotify.com/show/0vT7LJMeVDxyQ2ZamHKu08?si=_uDRD6bRR_6M5YZyISGXgA)

## Follow @Firefox

* [X (formerly Twitter) (@firefox)](https://twitter.com/firefox)
* [Instagram (@firefox)](https://www.instagram.com/firefox/)
* [YouTube (@firefoxchannel)](https://www.youtube.com/user/firefoxchannel)
* [TikTok (@firefox)](https://www.tiktok.com/%40firefox)

[Donate](https://foundation.mozilla.org/?form=moco-donate-footer)

Visit [Mozilla Corporationâ€™s](/en-US/) not-for-profit parent, the [Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer).

Portions of this content are Â©1998â€“2025 by individual mozilla.org contributors. Content available under a [Creative Commons license](/en-US/foundation/licensing/website-content/).

* [Website Privacy Notice](/en-US/privacy/websites/)
* [Cookies](/en-US/privacy/websites/cookie-settings/)
* [Legal](/en-US/about/legal/)
* [Community Participation Guidelines](/en-US/about/governance/policies/participation/)
* [About this site](/en-US/about/this-site/)

![](https://www.mozilla.org/media/img/logos/m24/wordmark-white.2d673bb5b33a.svg)


