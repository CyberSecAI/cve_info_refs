=== Content from plugins.trac.wordpress.org_0b7a6b7d_20250114_224603.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fchangeset%3Fnew%3D3027368%2540form-maker%26old%3D3027368%2540form-maker)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Change](/changeset/2993709/form-maker "Changeset 2993709 for form-maker")
* [Next Change](/changeset/3027369/form-maker "Changeset 3027369 for form-maker") →

---

# Changeset [3027368](/changeset/3027368 "Show full changeset") for [form-maker](/browser/form-maker?rev=3027368 "Show entry in browser")

View differences
inline
side by side

Show
lines around each change

Show the changes in full context

Ignore:

Blank lines

Case changes

White space changes

Timestamp:
01/26/2024 01:54:34 PM
([12 months](/timeline?from=2024-01-26T13%3A54%3A34Z&precision=second "See timeline at 01/26/2024 01:54:34 PM") ago)

Author:
10web
Message:

Fixed: Vulnerability issue fix.

Location:
[form-maker/trunk](/browser/form-maker/trunk?rev=3027368)
Files:

3 edited

* [booster/controller.php](/browser/form-maker/trunk/booster/controller.php?rev=3027368 "Show entry in browser")
  (modified)
  ([1 diff](#file0 "Show differences"))
* [form-maker.php](/browser/form-maker/trunk/form-maker.php?rev=3027368 "Show entry in browser")
  (modified)
  ([3 diffs](#file1 "Show differences"))
* [readme.txt](/browser/form-maker/trunk/readme.txt?rev=3027368 "Show entry in browser")
  (modified)
  ([2 diffs](#file2 "Show differences"))

### Legend:

Unmodified
Added
Removed

* ## [form-maker/trunk/booster/controller.php](/changeset/3027368/form-maker/trunk/booster/controller.php "Show the changeset 3027368 restricted to form-maker/trunk/booster/controller.php")

  | [r2908110](/browser/form-maker/trunk/booster/controller.php?rev=2908110#L38 "Show revision 2908110 of this file in browser") | [r3027368](/browser/form-maker/trunk/booster/controller.php?rev=3027368#L38 "Show revision 3027368 of this file in browser") |  |
  | --- | --- | --- |
  | 38 | 38 | $this->view = new BoosterView(); |
  | 39 | 39 | if ( !$task ) { |
  | 40 |  | $task = isset($\_GET['task']) ? sanitize\_text\_field($\_GET['task']) : (isset($\_POST['task']) ? sanitize\_text\_field($\_POST['task']) : ''); |
  | 41 |  | } |
  | 42 |  | if ( $task != 'display' && method\_exists($this, $task) ) { |
  | 43 |  | $this->$task($params); |
  |  | 40 | $task = isset($\_POST['task']) ? sanitize\_text\_field($\_POST['task']) : ''; |
  |  | 41 | } |
  |  | 42 | if ( $task != 'display' && method\_exists($this, $task) && $task != 'execute' && $task != '\_\_construct' ) { |
  |  | 43 | $speed\_ajax\_nonce = isset($\_POST['speed\_ajax\_nonce']) ? sanitize\_text\_field($\_POST['speed\_ajax\_nonce']) : ''; |
  |  | 44 | if ( !wp\_verify\_nonce($speed\_ajax\_nonce, 'speed\_ajax\_nonce') ) { |
  |  | 45 | die('Permission Denied.'); |
  |  | 46 | } |
  |  | 47 |  |
  |  | 48 | $this->$task($params); |
  | 44 | 49 | } |
  | 45 | 50 | else { |
* ## [form-maker/trunk/form-maker.php](/changeset/3027368/form-maker/trunk/form-maker.php "Show the changeset 3027368 restricted to form-maker/trunk/form-maker.php")

  | [r2977437](/browser/form-maker/trunk/form-maker.php?rev=2977437#L4 "Show revision 2977437 of this file in browser") | [r3027368](/browser/form-maker/trunk/form-maker.php?rev=3027368#L4 "Show revision 3027368 of this file in browser") |  |
  | --- | --- | --- |
  | 4 | 4 | \* Plugin URI: https://10web.io/plugins/wordpress-form-maker/?utm\_source=form\_maker&utm\_medium=free\_plugin |
  | 5 | 5 | \* Description: This plugin is a modern and advanced tool for easy and fast creating of a WordPress Form. The backend interface is intuitive and user friendly which allows users far from scripting and programming to create WordPress Forms. |
  | 6 |  | \* Version: 1.15.2~~1~~ |
  |  | 6 | \* Version: 1.15.22 |
  | 7 | 7 | \* Author: 10Web Form Builder Team |
  | 8 | 8 | \* Author URI: https://10web.io/plugins/?utm\_source=form\_maker&utm\_medium=free\_plugin |
  | […](/browser/form-maker/trunk/form-maker.php?rev=2977437#L11) | […](/browser/form-maker/trunk/form-maker.php?rev=3027368#L11) |  |
  | 11 | 11 |  |
  | 12 | 12 | defined('ABSPATH') || die('Access Denied'); |
  | 13 |  |  |
  |  | 13 | #[\AllowDynamicProperties] |
  | 14 | 14 | final class WDFM { |
  | 15 | 15 | /\*\* |
  | […](/browser/form-maker/trunk/form-maker.php?rev=2977437#L27) | […](/browser/form-maker/trunk/form-maker.php?rev=3027368#L27) |  |
  | 27 | 27 | public $front\_urls = array(); |
  | 28 | 28 | public $main\_file = ''; |
  | 29 |  | public $plugin\_version = '1.15.2~~1~~'; |
  | 30 |  | public $db\_version = '2.15.2~~1~~'; |
  |  | 29 | public $plugin\_version = '1.15.22'; |
  |  | 30 | public $db\_version = '2.15.22'; |
  | 31 | 31 | public $menu\_postfix = '\_fm'; |
  | 32 | 32 | public $plugin\_postfix = ''; |
* ## [form-maker/trunk/readme.txt](/changeset/3027368/form-maker/trunk/readme.txt "Show the changeset 3027368 restricted to form-maker/trunk/readme.txt")

  | [r2993708](/browser/form-maker/trunk/readme.txt?rev=2993708#L4 "Show revision 2993708 of this file in browser") | [r3027368](/browser/form-maker/trunk/readme.txt?rev=3027368#L4 "Show revision 3027368 of this file in browser") |  |
  | --- | --- | --- |
  | 4 | 4 | Requires at least: 4.6 |
  | 5 | 5 | Tested up to: 6.4 |
  | 6 |  | Stable tag: 1.15.2~~1~~ |
  |  | 6 | Stable tag: 1.15.22 |
  | 7 | 7 | License: GPLv2 or later |
  | 8 | 8 | License URI: http://www.gnu.org/licenses/gpl-2.0.html |
  | […](/browser/form-maker/trunk/readme.txt?rev=2993708#L558) | […](/browser/form-maker/trunk/readme.txt?rev=3027368#L558) |  |
  | 558 | 558 |  |
  | 559 | 559 | == Changelog == |
  |  | 560 | = 1.15.22 = |
  |  | 561 | \* Fixed: Vulnerability issue fix. |
  |  | 562 |  |
  | 560 | 563 | = 1.15.21 = |
  | 561 | 564 | \* Fixed: Captcha field security issue. |

**Note:** See [TracChangeset](/wiki/TracChangeset)
for help on using the changeset viewer.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Unified Diff](?format=diff&new=3027368)
* [Zip Archive](?format=zip&new=3027368)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from www.wordfence.com_d468b7f6_20250114_224605.html ===


[![](https://www.wordfence.com/img/wordfence-intelligence-logo.svg)](/threat-intel/)

Have you found a vulnerability in a WordPress plugin or theme? Report vulnerabilities in WordPress plugins and themes through our [bug bounty program](https://www.wordfence.com/threat-intel/bug-bounty-program) and earn a bounty on all in-scope submissions, while we handle the responsible disclosure process on your behalf.

As a reminder, the Wordfence Intelligence Vulnerability Database API is completely free to query and utilize, both personally and commercially, and contains all the same vulnerability data as the user interface. Please review the API documentation and Webhook documentation for more information on how to query the vulnerability API endpoints and configure webhooks utilizing all the same data present in the Wordfence Intelligence user interface.

# Form-Maker (twb\_form-maker) <= 1.15.21 - Cross-Site Request Forgery to Limited Code Execution via Execute

 [Wordfence Intelligence](https://www.wordfence.com/threat-intel)   >    [Vulnerability Database](https://www.wordfence.com/threat-intel/vulnerabilities)   >   Form-Maker (twb\_form-maker) <= 1.15.21 - Cross-Site Request Forgery to Limited Code Execution via Execute

5.4

**Inappropriate Source Code Style or Formatting**
**CVSS Vector**
[CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:U/C:N/I:L/A:L](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:U/C:N/I:L/A:L)

| CVE | [CVE-2024-0667](https://www.cve.org/CVERecord?id=CVE-2024-0667) |
| --- | --- |
| CVSS | 5.4 (Medium) |
| Publicly Published | January 26, 2024 |
| Last Updated | January 27, 2024 |
| Researcher | [SudoBash](https://www.wordfence.com/threat-intel/vulnerabilities/researchers/sudobash) |

### Description

The Form Maker by 10Web – Mobile-Friendly Drag & Drop Contact Form Builder plugin for WordPress is vulnerable to Cross-Site Request Forgery in all versions up to, and including, 1.15.21. This is due to missing or incorrect nonce validation on the 'execute' function. This makes it possible for unauthenticated attackers to execute arbitrary methods in the 'BoosterController' class via a forged request granted they can trick a site administrator into performing an action such as clicking on a link.

#### References

* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/browser/form-maker/tags/1.15.21/booster/controller.php#L34)
* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/changeset?sfp_email=&sfph_mail=&reponame=&old=3027368%40form-maker&new=3027368%40form-maker&sfp_email=&sfph_mail=)

#### Share

[Facebook](https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fform-maker%2Fform-maker-twb-form-maker-11521-cross-site-request-forgery-to-limited-code-execution-via-execute&t=Form-Maker%20%28twb_form-maker%29%20%3C%3D%201.15.21%20-%20Cross-Site%20Request%20Forgery%20to%20Limited%20Code%20Execution%20via%20Execute "Facebook")
[Twitter](https://twitter.com/share?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fform-maker%2Fform-maker-twb-form-maker-11521-cross-site-request-forgery-to-limited-code-execution-via-execute&text=Form-Maker%20%28twb_form-maker%29%20%3C%3D%201.15.21%20-%20Cross-Site%20Request%20Forgery%20to%20Limited%20Code%20Execution%20via%20Execute "Twitter")
[LinkedIn](https://www.linkedin.com/shareArticle?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fform-maker%2Fform-maker-twb-form-maker-11521-cross-site-request-forgery-to-limited-code-execution-via-execute "LinkedIn")
Email

## Vulnerability Details for Form Maker by 10Web – Mobile-Friendly Drag & Drop Contact Form Builder

#### [Form Maker by 10Web – Mobile-Friendly Drag & Drop Contact Form Builder](https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/form-maker)

| Software Type | Plugin |
| --- | --- |
| Software Slug | form-maker [(view on wordpress.org)](https://wordpress.org/plugins/form-maker) |
| Patched? | Yes |
| Remediation | Update to version 1.15.22, or a newer patched version |
| Affected Version | * <= 1.15.21 |
| Patched Version | * 1.15.22 |

This record contains material that is subject to copyright.

**Copyright 2012-2025 Defiant Inc.**

**License:**
Defiant hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute this software vulnerability information. Any copy of the software vulnerability information you make for such purposes is authorized provided that you include a hyperlink to this vulnerability record and reproduce Defiant's copyright designation and this license in any such copy.
**[Read more.](https://www.wordfence.com/wordfence-intelligence-terms-and-conditions/)**

**Copyright 1999-2025 The MITRE Corporation**

**License:**
CVE Usage: MITRE hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute Common Vulnerabilities and Exposures (CVE®). Any copy you make for such purposes is authorized provided that you reproduce MITRE's copyright designation and this license in any such copy.
**[Read more.](https://www.cve.org/Legal/TermsOfUse)**

Have information to add, or spot any errors? Contact us at wfi-support@wordfence.com so we can make any appropriate adjustments.

Did you know Wordfence Intelligence provides free personal and commercial API access to our comprehensive WordPress vulnerability database, along with a free webhook integration to stay on top of the latest vulnerabilities added and updated in the database? Get started today!

Learn more

Want to get notified of the latest vulnerabilities that may affect your WordPress site?
 Install Wordfence on your site today to get notified immediately if your site is affected by a vulnerability that has been added to our database.

Get Wordfence

The Wordfence Intelligence WordPress vulnerability database is completely free to access and query via API. Please review the documentation on how to access and consume the vulnerability data via API.

Documentation



=== Content from plugins.trac.wordpress.org_0434705e_20250114_224556.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fbrowser%2Fform-maker%2Ftags%2F1.15.21%2Fbooster%2Fcontroller.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Revision](/browser/form-maker/trunk/booster/controller.php?rev=2879537 "Revision 2879537")
* [Next Revision](/browser/form-maker/trunk/booster/controller.php?rev=3027368 "Revision 3027368") →
* [Blame](/browser/form-maker/trunk/booster/controller.php?annotate=blame "Annotate each line with the last changed revision (this can be time consuming...)")
* [Revision Log](/log/form-maker/tags/1.15.21/booster/controller.php)

---

# [source:](/browser?order=name "Go to repository root") [form-maker](/browser/form-maker?order=name "View form-maker")/[tags](/browser/form-maker/tags?order=name "View tags")/[1.15.21](/browser/form-maker/tags/1.15.21?order=name "View 1.15.21")/[booster](/browser/form-maker/tags/1.15.21/booster?order=name "View booster")/[controller.php](/browser/form-maker/tags/1.15.21/booster/controller.php?order=name "View controller.php")

View diff against:

View revision:

| [Last change](/changeset/2908110/form-maker/trunk/booster/controller.php "View differences") on this file was [2908110](/changeset/2908110/ "View changeset 2908110"), checked in by 10web, [21 months ago](/timeline?from=2023-05-04T15%3A32%3A33Z&precision=second "See timeline at 05/04/2023 03:32:33 PM") |
| --- |
| * Fixed: Conditional logic on form reset. * Fixed: Form submit in some cases. |
| **File size:** 23.6 KB | |

| Line |  |
| --- | --- |
| [1](#L1) | <?php |
| [2](#L2) |  |
| [3](#L3) | /\*\* |
| [4](#L4) | \* Class SpeedController\_twb |
| [5](#L5) | \*/ |
| [6](#L6) | class BoosterController { |
| [7](#L7) | private $booster; |
| [8](#L8) | private $model; |
| [9](#L9) | private $view; |
| [10](#L10) |  |
| [11](#L11) | const PlUGIN\_FILE = 'tenweb-speed-optimizer/tenweb\_speed\_optimizer.php'; |
| [12](#L12) |  |
| [13](#L13) | const PLUGIN\_ZIP = 'https://downloads.wordpress.org/plugin/tenweb-speed-optimizer.latest-stable.zip'; |
| [14](#L14) |  |
| [15](#L15) | private $google\_api\_keys = array( |
| [16](#L16) | 'AIzaSyCQmF4ZSbZB8prjxci3GWVK4UWc-Yv7vbw', |
| [17](#L17) | 'AIzaSyAgXPc9Yp0auiap8L6BsHWoSVzkSYgHdrs', |
| [18](#L18) | 'AIzaSyCftPiteYkBsC2hamGbGax5D9JQ4CzexPU', |
| [19](#L19) | 'AIzaSyC-6oKLqdvufJnysAxd0O56VgZrCgyNMHg', |
| [20](#L20) | 'AIzaSyB1QHYGZZ6JIuUUce4VyBt5gF\_-LwI5Xsk', |
| [21](#L21) | 'AIzaSyDZLf5UpZ914NoCZF16ad0PrspINs6ak0g', |
| [22](#L22) | 'AIzaSyDvLQHgtF94eha7sDCLIUiQ0lmfsIOR\_sw', |
| [23](#L23) | 'AIzaSyAh8baU4m\_C1qgSNsGiYU6q4iMDe6q\_dSY', |
| [24](#L24) | 'AIzaSyCjwzqteBYBPdYxyXPrcQGNtoQ20U89G2A', |
| [25](#L25) | ); |
| [26](#L26) |  |
| [27](#L27) | public function \_\_construct($booster) { |
| [28](#L28) | $this->booster = $booster; |
| [29](#L29) | } |
| [30](#L30) |  |
| [31](#L31) | /\*\* |
| [32](#L32) | \* Execute. |
| [33](#L33) | \*/ |
| [34](#L34) | public function execute($task = '', $params = array()) { |
| [35](#L35) | require\_once($this->booster->plugin\_dir . '/model.php'); |
| [36](#L36) | $this->model = new BoosterModel(); |
| [37](#L37) | require\_once($this->booster->plugin\_dir . '/view.php'); |
| [38](#L38) | $this->view = new BoosterView(); |
| [39](#L39) | if ( !$task ) { |
| [40](#L40) | $task = isset($\_GET['task']) ? sanitize\_text\_field($\_GET['task']) : (isset($\_POST['task']) ? sanitize\_text\_field($\_POST['task']) : ''); |
| [41](#L41) | } |
| [42](#L42) | if ( $task != 'display' && method\_exists($this, $task) ) { |
| [43](#L43) | $this->$task($params); |
| [44](#L44) | } |
| [45](#L45) | else { |
| [46](#L46) | $this->display(); |
| [47](#L47) | } |
| [48](#L48) | } |
| [49](#L49) |  |
| [50](#L50) | /\*\* |
| [51](#L51) | \* Display. |
| [52](#L52) | \*/ |
| [53](#L53) | public function display() { |
| [54](#L54) | $params = array(); |
| [55](#L55) | $params['twb\_dismiss'] = isset($\_GET['twb\_dismiss']) ? intval($\_GET['twb\_dismiss']) : 0; |
| [56](#L56) | $params['submenu\_section\_optimize\_images'] = $this->booster->page['section\_optimize\_images']; |
| [57](#L57) | $params['section\_booster\_title'] = $this->booster->page['section\_booster\_title']; |
| [58](#L58) | $params['section\_booster\_desc'] = $this->booster->page['section\_booster\_desc']; |
| [59](#L59) | $params['section\_booster\_success\_title'] = $this->booster->page['section\_booster\_success\_title']; |
| [60](#L60) | $params['section\_booster\_success\_desc'] = $this->booster->page['section\_booster\_success\_desc']; |
| [61](#L61) | $params['section\_analyze\_desc'] = $this->booster->page['section\_analyze\_desc']; |
| [62](#L62) | $params['submenu\_section\_analyze'] = $this->booster->page['section\_analyze']; |
| [63](#L63) | $params['booster\_plugin\_status'] = $this->booster->booster\_plugin\_status; |
| [64](#L64) | $params['status'] = $this->booster->status; |
| [65](#L65) | $params['booster\_is\_connected'] = $this->booster->booster\_is\_connected; |
| [66](#L66) | $params['tenweb\_is\_paid'] = $this->booster->is\_paid; |
| [67](#L67) | $params['is\_plugin'] = $this->booster->is\_plugin; |
| [68](#L68) | $params['submenu\_parent\_slug'] = $this->booster->submenu['parent\_slug']; |
| [69](#L69) | $params['slug'] = $this->booster->slug; |
| [70](#L70) | $params['show\_cta'] = $this->booster->show\_cta; |
| [71](#L71) | $params['show\_cta\_option'] = $this->booster->show\_cta\_option; |
| [72](#L72) |  |
| [73](#L73) | $params['images\_count'] = $this->get\_images\_count(); |
| [74](#L74) | $params['images\_total\_size'] = get\_option('twb\_images\_total\_size', '0 KB'); |
| [75](#L75) |  |
| [76](#L76) | $params['page\_is\_public'] = TRUE; |
| [77](#L77) |  |
| [78](#L78) | $twb\_speed\_score = get\_option('twb\_speed\_score'); |
| [79](#L79) | $data = array( |
| [80](#L80) | 'url' => get\_home\_url(), |
| [81](#L81) | 'desktop\_score' => 0, |
| [82](#L82) | 'desktop\_loading\_time' => 0, |
| [83](#L83) | 'mobile\_score' => 0, |
| [84](#L84) | 'mobile\_loading\_time' => 0, |
| [85](#L85) | 'last\_analyzed\_time' => '', |
| [86](#L86) | ); |
| [87](#L87) | if ( !empty($twb\_speed\_score) && !empty($twb\_speed\_score['last']) && !empty($twb\_speed\_score['last']['url']) ) { |
| [88](#L88) | $last\_url = $twb\_speed\_score['last']['url']; |
| [89](#L89) | if ( !empty($twb\_speed\_score[$last\_url]['desktop\_score']) |
| [90](#L90) | && !empty($twb\_speed\_score[$last\_url]['desktop\_loading\_time']) |
| [91](#L91) | && !empty($twb\_speed\_score[$last\_url]['mobile\_score']) |
| [92](#L92) | && !empty($twb\_speed\_score[$last\_url]['mobile\_loading\_time']) |
| [93](#L93) | && !empty($twb\_speed\_score[$last\_url]['last\_analyzed\_time']) ) { |
| [94](#L94) | $data = array( |
| [95](#L95) | 'url' => $last\_url, |
| [96](#L96) | 'desktop\_score' => $twb\_speed\_score[$last\_url]['desktop\_score'], |
| [97](#L97) | 'desktop\_loading\_time' => $twb\_speed\_score[$last\_url]['desktop\_loading\_time'], |
| [98](#L98) | 'mobile\_score' => $twb\_speed\_score[$last\_url]['mobile\_score'], |
| [99](#L99) | 'mobile\_loading\_time' => $twb\_speed\_score[$last\_url]['mobile\_loading\_time'], |
| [100](#L100) | 'last\_analyzed\_time' => $twb\_speed\_score[$last\_url]['last\_analyzed\_time'], |
| [101](#L101) | ); |
| [102](#L102) | } |
| [103](#L103) | } |
| [104](#L104) |  |
| [105](#L105) | $params['twb\_speed\_score'] = $data; |
| [106](#L106) | $domain\_id = get\_site\_option('tenweb\_domain\_id'); |
| [107](#L107) | $params['dashboard\_booster\_url'] = ''; |
| [108](#L108) | if ( defined("TENWEB\_DASHBOARD") && !empty($domain\_id) ) { |
| [109](#L109) | $params['dashboard\_booster\_url'] = trim(TENWEB\_DASHBOARD, '/') . '/websites/' . $domain\_id . '/booster/frontend'; |
| [110](#L110) | } |
| [111](#L111) |  |
| [112](#L112) | $params['pages\_compressed'] = $this->get\_pages\_compressed($params); |
| [113](#L113) |  |
| [114](#L114) | $params['twb\_dismiss'] = (isset($\_GET['twb\_dismiss']) && $\_GET['twb\_dismiss'] == 1) ? $\_GET['twb\_dismiss'] : 0; |
| [115](#L115) |  |
| [116](#L116) | $this->view->display($params); |
| [117](#L117) | } |
| [118](#L118) |  |
| [119](#L119) | /\*\* |
| [120](#L120) | \* Run function as ajax action and keep optimized images data in DB option |
| [121](#L121) | \* Endpoint work once a day to prevent page loading time |
| [122](#L122) | \*/ |
| [123](#L123) | public function set\_compressed\_pages() { |
| [124](#L124) | $twb\_optimized\_pages = get\_transient("twb\_optimized\_pages"); |
| [125](#L125) |  |
| [126](#L126) | if ( !empty($twb\_optimized\_pages) || !defined('TENWEBIO\_MANAGER\_PREFIX') ) { |
| [127](#L127) | die; |
| [128](#L128) | } |
| [129](#L129) |  |
| [130](#L130) | $workspace\_id = (int) get\_site\_option(TENWEBIO\_MANAGER\_PREFIX . '\_workspace\_id', 0); |
| [131](#L131) | $domain\_id = (int) get\_option(TENWEBIO\_MANAGER\_PREFIX . '\_domain\_id', 0); |
| [132](#L132) | if ( $this->booster->booster\_is\_connected || |
| [133](#L133) | $this->booster->is\_paid || |
| [134](#L134) | $workspace\_id == 0 || |
| [135](#L135) | $domain\_id == 0 || |
| [136](#L136) | !defined('TENWEBIO\_API\_URL')) { |
| [137](#L137) | die; |
| [138](#L138) | } |
| [139](#L139) |  |
| [140](#L140) | $url = TENWEBIO\_API\_URL . "/compress/workspaces/" . $workspace\_id . "/domains/" . $domain\_id."/stat"; |
| [141](#L141) | $access\_token = get\_site\_option('tenweb\_access\_token'); |
| [142](#L142) |  |
| [143](#L143) | $args = array( |
| [144](#L144) | 'timeout'     => 50, |
| [145](#L145) | 'headers'     => array( |
| [146](#L146) | "accept" => "application/x.10weboptimizer.v3+json", |
| [147](#L147) | "authorization" => "Bearer " . $access\_token, |
| [148](#L148) | ), |
| [149](#L149) | ); |
| [150](#L150) | $response = wp\_remote\_get($url, $args); |
| [151](#L151) | if ( is\_array($response) && !is\_wp\_error($response) ) { |
| [152](#L152) | $body = json\_decode( $response['body'], 1 ); |
| [153](#L153) | if ( isset($body['status']) && $body['status'] == 200 ) { |
| [154](#L154) | $data = $body['data']; |
| [155](#L155) | $total\_not\_compressed\_images\_size = isset($data['not\_compressed']['total\_size']) ? $data['not\_compressed']['total\_size'] : 0; |
| [156](#L156) | $total\_not\_compressed\_images\_size = TWBLibrary::formatBytes($total\_not\_compressed\_images\_size); |
| [157](#L157) | $total\_not\_compressed\_images\_count = intval($data['not\_compressed']['full'] + $data['not\_compressed']['thumbs'] + $data['not\_compressed']['other']); |
| [158](#L158) |  |
| [159](#L159) | $pages\_compressed\_api = $data['pages\_compressed']; |
| [160](#L160) |  |
| [161](#L161) | $twb\_optimized\_pages = array(); |
| [162](#L162) | if ( class\_exists('\TenWebOptimizer\OptimizerUtils') ) { |
| [163](#L163) | $twb\_optimized\_pages = \TenWebOptimizer\OptimizerUtils::getCriticalPages(); |
| [164](#L164) | } |
| [165](#L165) |  |
| [166](#L166) | $total\_compressed\_images = 0; |
| [167](#L167) | $i = 0; |
| [168](#L168) | $pages\_compressed = array(); |
| [169](#L169) | /\* Adding new pages which are optimized but haven't images and endpoint doesn't have that pages in response \*/ |
| [170](#L170) | foreach ( $twb\_optimized\_pages as $page\_id => $val ) { |
| [171](#L171) | /\* Permalink text for front\_page should be Homepage \*/ |
| [172](#L172) | $pages\_compressed[$i]['page\_id'] = $page\_id; |
| [173](#L173) | if( $page\_id == 'front\_page' ) { |
| [174](#L174) | $pages\_compressed[$i]['permalink'] = 'Homepage'; |
| [175](#L175) | } else { |
| [176](#L176) | $pages\_compressed[$i]['permalink'] = $val['url']; |
| [177](#L177) | } |
| [178](#L178) |  |
| [179](#L179) | /\* Finding value with page\_id key in the array from endpoint to get images\_count \*/ |
| [180](#L180) | $found = current(array\_filter($pages\_compressed\_api,  function($item) use($page\_id) { |
| [181](#L181) | return isset($item['page\_id']) && $page\_id == $item['page\_id']; |
| [182](#L182) | })); |
| [183](#L183) |  |
| [184](#L184) | if( !empty($found) ) { |
| [185](#L185) | $pages\_compressed[$i]['images\_count'] = $found['images\_count']; |
| [186](#L186) | $total\_compressed\_images += $found['images\_count']; |
| [187](#L187) | } else { |
| [188](#L188) | $pages\_compressed[$i]['images\_count'] = 0; |
| [189](#L189) | } |
| [190](#L190) | $i++; |
| [191](#L191) | } |
| [192](#L192) |  |
| [193](#L193) | $data['pages'] = $pages\_compressed; |
| [194](#L194) | $data['compressed\_pages\_count'] = count($pages\_compressed); |
| [195](#L195) | $data['total\_compressed\_images'] = (int) $total\_compressed\_images; |
| [196](#L196) | $data['total\_not\_compressed\_images\_size'] = $total\_not\_compressed\_images\_size; |
| [197](#L197) | $data['total\_not\_compressed\_images\_count'] = $total\_not\_compressed\_images\_count; |
| [198](#L198) | if ( $total\_compressed\_images != 0 || $total\_not\_compressed\_images\_size != 0 ) { |
| [199](#L199) | set\_transient( 'twb\_optimized\_pages', $data, DAY\_IN\_SECONDS ); |
| [200](#L200) | } |
| [201](#L201) | } |
| [202](#L202) | } |
| [203](#L203) | die; |
| [204](#L204) | } |
| [205](#L205) |  |
| [206](#L206) | /\*\* |
| [207](#L207) | \* Update show CTA value. |
| [208](#L208) | \* |
| [209](#L209) | \* @return void |
| [210](#L210) | \*/ |
| [211](#L211) | public function set\_show\_cta() { |
| [212](#L212) | $show\_cta = isset($\_POST['show\_cta']) ? intval($\_POST['show\_cta']) : 0; |
| [213](#L213) | update\_option("twb\_show\_cta", $show\_cta); |
| [214](#L214) | die(); |
| [215](#L215) | } |
| [216](#L216) |  |
| [217](#L217) | /\*\* |
| [218](#L218) | \* Get copmpressed pages/images data from DB. |
| [219](#L219) | \* |
| [220](#L220) | \* @param $params array |
| [221](#L221) | \* |
| [222](#L222) | \* @return array |
| [223](#L223) | \*/ |
| [224](#L224) | public function get\_pages\_compressed( $params ) { |
| [225](#L225) | $return\_data = array( |
| [226](#L226) | 'pages' => array(), |
| [227](#L227) | 'total\_compressed\_images' => 0, |
| [228](#L228) | 'total\_not\_compressed\_images\_size' => '0 B', |
| [229](#L229) | 'total\_not\_compressed\_images\_count' => 0, |
| [230](#L230) | 'compressed\_pages\_count' => 0, |
| [231](#L231) | ); |
| [232](#L232) |  |
| [233](#L233) | $twb\_optimized\_pages = get\_transient("twb\_optimized\_pages"); |
| [234](#L234) | if ( !empty($twb\_optimized\_pages) ) { |
| [235](#L235) | return $twb\_optimized\_pages; |
| [236](#L236) | } else { |
| [237](#L237) | /\* in case of returned data is 0 just get from db last data or run PG functionality to get count/size \*/ |
| [238](#L238) | $images\_total\_size = get\_option('twb\_images\_total\_size'); |
| [239](#L239) | if ( !empty($images\_total\_size) ) { |
| [240](#L240) | $return\_data['total\_not\_compressed\_images\_size'] = $images\_total\_size; |
| [241](#L241) | $return\_data['total\_not\_compressed\_images\_count'] = $params['images\_count']; |
| [242](#L242) | } |
| [243](#L243) | } |
| [244](#L244) |  |
| [245](#L245) | return $return\_data; |
| [246](#L246) | } |
| [247](#L247) |  |
| [248](#L248) | /\*\* |
| [249](#L249) | \* Get total size of all images․ |
| [250](#L250) | \*/ |
| [251](#L251) | public function get\_total\_size\_of\_images() { |
| [252](#L252) | $total = get\_option('twb\_images\_total\_size'); |
| [253](#L253) | if ( empty($total) ) { |
| [254](#L254) | $total = 0; |
| [255](#L255) | $allowed\_types = array( |
| [256](#L256) | 'image/jpeg', |
| [257](#L257) | 'image/jpg', |
| [258](#L258) | 'image/png', |
| [259](#L259) | 'image/gif', |
| [260](#L260) | 'image/webp', |
| [261](#L261) | 'image/svg', |
| [262](#L262) | 'image/png' |
| [263](#L263) | ); |
| [264](#L264) | $args = array( |
| [265](#L265) | 'post\_type' => 'attachment', |
| [266](#L266) | 'numberposts' => -1, |
| [267](#L267) | 'post\_status' => NULL, |
| [268](#L268) | 'post\_parent' => NULL, // any parent |
| [269](#L269) | ); |
| [270](#L270) | $attachments = get\_posts($args); |
| [271](#L271) | if ( $attachments ) { |
| [272](#L272) | foreach ( $attachments as $post ) { |
| [273](#L273) | if ( !in\_array($post->post\_mime\_type, $allowed\_types) ) { |
| [274](#L274) | continue; |
| [275](#L275) | } |
| [276](#L276) | $meta = wp\_get\_attachment\_metadata($post->ID); |
| [277](#L277) | if ( isset($meta['filesize']) ) { |
| [278](#L278) | $filesize = $meta['filesize']; |
| [279](#L279) | } |
| [280](#L280) | else { |
| [281](#L281) | $path = get\_attached\_file($post->ID); |
| [282](#L282) | if ( !file\_exists($path) ) { |
| [283](#L283) | continue; |
| [284](#L284) | } |
| [285](#L285) | $filesize = filesize($path); |
| [286](#L286) | } |
| [287](#L287) | $total += $filesize; |
| [288](#L288) | } |
| [289](#L289) | } |
| [290](#L290) | $total = TWBLibrary::formatBytes( $total ); |
| [291](#L291) | update\_option('twb\_images\_total\_size', $total, 1); |
| [292](#L292) | } |
| [293](#L293) |  |
| [294](#L294) | echo json\_encode(array("size" => $total)); |
| [295](#L295) | die; |
| [296](#L296) | } |
| [297](#L297) |  |
| [298](#L298) | /\*\* |
| [299](#L299) | \* Top banner. |
| [300](#L300) | \*/ |
| [301](#L301) | public function top\_banner($params = array()) { |
| [302](#L302) | if ( $this->booster->is\_paid === FALSE ) { |
| [303](#L303) | $booster\_is\_active = ( $this->booster->booster\_is\_connected && $this->booster->booster\_plugin\_status == 2 ) ? TRUE : FALSE; |
| [304](#L304) | if ( $booster\_is\_active ) { |
| [305](#L305) | if ( !isset($params['title']) ) { |
| [306](#L306) | $params['title'] = \_\_('Get 10Web Booster Pro', 'tenweb-booster'); |
| [307](#L307) | } |
| [308](#L308) | if ( !isset($params['desc']) ) { |
| [309](#L309) | $params['desc'] = \_\_('Automatically optimize the entire website with all images.', 'tenweb-booster'); |
| [310](#L310) | } |
| [311](#L311) | if ( !isset($params['notice']) ) { |
| [312](#L312) | $params['notice'] = FALSE; |
| [313](#L313) | } |
| [314](#L314) | $params['button'] = array( |
| [315](#L315) | 'name' => \_\_('Upgrade', 'tenweb-booster'), |
| [316](#L316) | 'url' => "https://my.10web.io/websites/" . get\_site\_option('tenweb\_domain\_id') . "/booster/frontend?pricing=1", |
| [317](#L317) | 'target' => 'target="\_blank"', |
| [318](#L318) | ); |
| [319](#L319) | } |
| [320](#L320) | else { |
| [321](#L321) | if ( !isset($params['title']) ) { |
| [322](#L322) | $single = \_\_('%s image can be optimized', 'tenweb-booster'); |
| [323](#L323) | $plural = \_\_('%s images can be optimized', 'tenweb-booster'); |
| [324](#L324) | $images\_count = $this->get\_images\_count(); |
| [325](#L325) | $params['title'] = wp\_sprintf(\_n($single, $plural, $images\_count, 'tenweb-booster'), $images\_count); |
| [326](#L326) | } |
| [327](#L327) | if ( !isset($params['desc']) ) { |
| [328](#L328) | $params['desc'] = \_\_('Improve PageSpeed optimization by optimizing your website.', 'tenweb-booster'); |
| [329](#L329) | } |
| [330](#L330) | if ( !isset($params['notice']) ) { |
| [331](#L331) | $params['notice'] = \_\_('Heavy images negatively affect your website load time and PageSpeed optimization.', 'tenweb-booster'); |
| [332](#L332) | } |
| [333](#L333) | $params['button'] = array( |
| [334](#L334) | 'name' => \_\_('Optimize now', 'tenweb-booster'), |
| [335](#L335) | 'url' => add\_query\_arg(array( 'page' => TenWebBooster::PREFIX . '\_' . $this->booster->slug ), admin\_url('admin.php')), |
| [336](#L336) | 'target' => '', |
| [337](#L337) | ); |
| [338](#L338) | } |
| [339](#L339) |  |
| [340](#L340) | $this->view->top\_banner($params); |
| [341](#L341) | } |
| [342](#L342) | } |
| [343](#L343) |  |
| [344](#L344) | /\*\* |
| [345](#L345) | \* Install booster plugin |
| [346](#L346) | \*/ |
| [347](#L347) | public function install\_booster() { |
| [348](#L348) | $activated = $this->install\_plugin(); |
| [349](#L349) | // To change the plugin status on Dashboard. |
| [350](#L350) | if (class\_exists('\Tenweb\_Authorization\Helper') |
| [351](#L351) | && method\_exists('\Tenweb\_Authorization\Helper', "check\_site\_state") ) { |
| [352](#L352) | \Tenweb\_Authorization\Helper::check\_site\_state(true); |
| [353](#L353) | } |
| [354](#L354) | // activate\_plugin function returns null when the plugin activated successfully. |
| [355](#L355) | if ( is\_null($activated) ) { |
| [356](#L356) | $this->booster = $this->booster->set\_booster\_data(); |
| [357](#L357) | } |
| [358](#L358) | $params = array(); |
| [359](#L359) | $params['booster\_plugin\_status'] = $this->booster->booster\_plugin\_status; |
| [360](#L360) | $params['status'] = $this->booster->status; |
| [361](#L361) | $params['is\_plugin'] = $this->booster->is\_plugin; |
| [362](#L362) | $params['tenweb\_is\_paid'] = $this->booster->is\_paid; |
| [363](#L363) | $params['slug'] = $this->booster->slug; |
| [364](#L364) | $domain\_id = get\_site\_option('tenweb\_domain\_id'); |
| [365](#L365) | $params['dashboard\_booster\_url'] = ''; |
| [366](#L366) | if ( defined("TENWEB\_DASHBOARD") && !empty($domain\_id) ) { |
| [367](#L367) | $params['dashboard\_booster\_url'] = trim(TENWEB\_DASHBOARD, '/') . '/websites/' . $domain\_id . '/booster/frontend'; |
| [368](#L368) | } |
| [369](#L369) | $params['submenu\_parent\_slug'] = $this->booster->submenu['parent\_slug']; |
| [370](#L370) | $params['section\_booster\_title'] = $this->booster->page['section\_booster\_title']; |
| [371](#L371) | $params['section\_booster\_desc'] = $this->booster->page['section\_booster\_desc']; |
| [372](#L372) | $params['section\_booster\_success\_title'] = $this->booster->page['section\_booster\_success\_title']; |
| [373](#L373) | $params['section\_booster\_success\_desc'] = $this->booster->page['section\_booster\_success\_desc']; |
| [374](#L374) | $this->view->header($params); |
| [375](#L375) | die; |
| [376](#L376) | } |
| [377](#L377) |  |
| [378](#L378) | /\*\* |
| [379](#L379) | \* Install/activate the plugin. |
| [380](#L380) | \* |
| [381](#L381) | \* @param $status |
| [382](#L382) | \* |
| [383](#L383) | \* @return bool|int|true|WP\_Error|null |
| [384](#L384) | \*/ |
| [385](#L385) | private function install\_plugin() { |
| [386](#L386) | $activated = FALSE; |
| [387](#L387) | if ( $this->booster->booster\_plugin\_status == 0 ) { |
| [388](#L388) | include\_once( ABSPATH . 'wp-admin/includes/class-wp-upgrader.php'); |
| [389](#L389) | wp\_cache\_flush(); |
| [390](#L390) | $upgrader = new Plugin\_Upgrader(); |
| [391](#L391) | $installed = $upgrader->install(self::PLUGIN\_ZIP); |
| [392](#L392) | } |
| [393](#L393) | else { |
| [394](#L394) | $installed = TRUE; |
| [395](#L395) | } |
| [396](#L396) |  |
| [397](#L397) | if ( !is\_wp\_error( $installed ) && $installed ) { |
| [398](#L398) | $activated = activate\_plugin(self::PlUGIN\_FILE); |
| [399](#L399) | } |
| [400](#L400) |  |
| [401](#L401) | return $activated; |
| [402](#L402) | } |
| [403](#L403) |  |
| [404](#L404) | /\*\* |
| [405](#L405) | \* Get optimized media count. |
| [406](#L406) | \* |
| [407](#L407) | \* @return int |
| [408](#L408) | \*/ |
| [409](#L409) | public function get\_images\_count() { |
| [410](#L410) | $allowed\_types = array('image/jpeg','image/jpg','image/png','image/gif','image/webp','image/svg'); |
| [411](#L411) | // Get all wp-media attachments. |
| [412](#L412) | $attachments = wp\_count\_attachments(); |
| [413](#L413) | $total = 0; |
| [414](#L414) | if ( !empty($attachments) ) { |
| [415](#L415) | foreach ( $attachments as $key => $attachment ) { |
| [416](#L416) | if ( in\_array($key, $allowed\_types) ) { |
| [417](#L417) | $total += $attachment; |
| [418](#L418) | } |
| [419](#L419) | } |
| [420](#L420) | } |
| [421](#L421) |  |
| [422](#L422) | include\_once( ABSPATH . 'wp-admin/includes/plugin.php' ); |
| [423](#L423) | if ( is\_plugin\_active('photo-gallery/photo-gallery.php') ) { |
| [424](#L424) | // Get all Photo gallery media. |
| [425](#L425) | global $wpdb; |
| [426](#L426) | $row = $wpdb->get\_row('SELECT count(id) AS qty FROM `' . $wpdb->prefix . 'bwg\_file\_paths` WHERE is\_dir = 0'); |
| [427](#L427) | if ( !empty($row) && !empty($row->qty) ) { |
| [428](#L428) | $total += intval($row->qty); |
| [429](#L429) | } |
| [430](#L430) | } |
| [431](#L431) |  |
| [432](#L432) | return intval($total); |
| [433](#L433) | } |
| [434](#L434) |  |
| [435](#L435) | /\*\* |
| [436](#L436) | \* Sign up to the Dashboard. |
| [437](#L437) | \* |
| [438](#L438) | \* @return bool |
| [439](#L439) | \*/ |
| [440](#L440) | public function sign\_up\_dashboard() { |
| [441](#L441) | $email = isset($\_POST['twb\_email']) ? sanitize\_email($\_POST['twb\_email']) : ''; |
| [442](#L442) | $parent\_slug = isset($\_POST['parent\_slug']) ? sanitize\_text\_field($\_POST['parent\_slug']) : ''; |
| [443](#L443) | $slug = isset($\_POST['slug']) ? sanitize\_text\_field($\_POST['slug']) : ''; |
| [444](#L444) | $is\_plugin = isset($\_POST['is\_plugin']) ? sanitize\_text\_field($\_POST['is\_plugin']) : TRUE; |
| [445](#L445) |  |
| [446](#L446) |  |
| [447](#L447) | $body\_data = array( |
| [448](#L448) | 'email' => $email, |
| [449](#L449) | 'first\_name' => '10Webber', |
| [450](#L450) | 'last\_name' => rand( 1000, 9999 ), |
| [451](#L451) | 'service\_key' => 'gTcjslfqqBFFwJKBnFgQYhkQEJpplLaDKfj', |
| [452](#L452) | ); |
| [453](#L453) |  |
| [454](#L454) | if ( $is\_plugin ) { |
| [455](#L455) | switch ( $parent\_slug ) { |
| [456](#L456) | case "manage\_fm": |
| [457](#L457) | $body\_data['product\_id'] = '95'; |
| [458](#L458) | break; |
| [459](#L459) | case "wdi\_feeds": |
| [460](#L460) | $body\_data['product\_id'] = '43'; |
| [461](#L461) | break; |
| [462](#L462) | case "info\_ffwd": |
| [463](#L463) | $body\_data['product\_id'] = '93'; |
| [464](#L464) | break; |
| [465](#L465) | case "sliders\_wds": |
| [466](#L466) | $body\_data['product\_id'] = '97'; |
| [467](#L467) | break; |
| [468](#L468) | case "galleries\_bwg": |
| [469](#L469) | $body\_data['product\_id'] = '101'; |
| [470](#L470) | break; |
| [471](#L471) | default: |
| [472](#L472) | $body\_data['product\_slug'] = "plugin\_" . $slug; |
| [473](#L473) | } |
| [474](#L474) | } else { |
| [475](#L475) | $body\_data['product\_slug'] = "theme\_" . $slug; |
| [476](#L476) | } |
| [477](#L477) |  |
| [478](#L478) | $args = array( |
| [479](#L479) | 'method'      => 'POST', |
| [480](#L480) | 'headers'     => array( |
| [481](#L481) | 'Content-Type'  => 'application/x-www-form-urlencoded; charset=UTF-8', |
| [482](#L482) | 'Accept'        => 'application/x.10webcore.v1+json' |
| [483](#L483) | ), |
| [484](#L484) | 'body'        => $body\_data, |
| [485](#L485) | ); |
| [486](#L486) | $url = 'https://core.10web.io/api/checkout/signup-via-magic-link'; |
| [487](#L487) | $result = wp\_remote\_post( $url, $args ); |
| [488](#L488) | ob\_clean(); |
| [489](#L489) | if ( !empty($result) && isset( $result['body']) ) { |
| [490](#L490) | $result = $result['body']; |
| [491](#L491) | } else { |
| [492](#L492) | echo json\_encode( array('status' => 'error' ) ); |
| [493](#L493) | die; |
| [494](#L494) | } |
| [495](#L495) |  |
| [496](#L496) | $result = json\_decode($result, 1); |
| [497](#L497) | if ( class\_exists('\TenWebOptimizer\OptimizerUtils') ) { |
| [498](#L498) | $args = ''; |
| [499](#L499) | if ( isset($result['status']) && isset($result['data']['magic\_data']) && $result['status'] == "ok" ) { |
| [500](#L500) | $args = array( 'magic\_data' => $result['data']['magic\_data'] ); |
| [501](#L501) | } |
| [502](#L502) | elseif ( isset($result['error']) && $result['error']['status\_code'] == "422" ) { |
| [503](#L503) | $args = array( 'login\_request\_plugin' => $this->booster->slug ); |
| [504](#L504) | } |
| [505](#L505) | if ( $args ) { |
| [506](#L506) | $connect\_link = \TenWebOptimizer\OptimizerUtils::get\_tenweb\_connection\_link('login', $args); |
| [507](#L507) | echo json\_encode(array( 'status' => 'success', 'booster\_connect\_url' => $connect\_link )); |
| [508](#L508) | die(); |
| [509](#L509) | } |
| [510](#L510) | } |
| [511](#L511) | echo json\_encode( array('status' => 'error') ); |
| [512](#L512) | die(); |
| [513](#L513) | } |
| [514](#L514) |  |
| [515](#L515) | /\*\* |
| [516](#L516) | \* Connect to dashboard. |
| [517](#L517) | \* |
| [518](#L518) | \* @return void |
| [519](#L519) | \*/ |
| [520](#L520) | public function connect\_to\_dashboard() { |
| [521](#L521) | if ( class\_exists('\TenWebOptimizer\OptimizerUtils') ) { |
| [522](#L522) | $twb\_connect\_link = \TenWebOptimizer\OptimizerUtils::get\_tenweb\_connection\_link('login'); |
| [523](#L523) | echo json\_encode(array( 'status' => 'success', 'booster\_connect\_url' => $twb\_connect\_link )); |
| [524](#L524) | } |
| [525](#L525) | else { |
| [526](#L526) | echo json\_encode(array( 'status' => 'error' ) ); |
| [527](#L527) | } |
| [528](#L528) | die; |
| [529](#L529) | } |
| [530](#L530) |  |
| [531](#L531) | /\*\* |
| [532](#L532) | \* Get Google page speed score. |
| [533](#L533) | \*/ |
| [534](#L534) | public function get\_google\_page\_speed() { |
| [535](#L535) | $last\_api\_key\_index = isset($\_POST['last\_api\_key\_index']) ? sanitize\_text\_field($\_POST['last\_api\_key\_index']) : ''; |
| [536](#L536) |  |
| [537](#L537) | $url = isset($\_POST['twb\_url']) ? sanitize\_url($\_POST['twb\_url']) : ''; |
| [538](#L538) |  |
| [539](#L539) | /\* Check if url hasn't http or https add \*/ |
| [540](#L540) | if ( strpos($url, 'http') !== 0 ){ |
| [541](#L541) | if ( isset($\_SERVER['HTTPS']) ) { |
| [542](#L542) | $url = 'https://'.$url; |
| [543](#L543) | } else { |
| [544](#L544) | $url = 'http://'.$url; |
| [545](#L545) | } |
| [546](#L546) | } |
| [547](#L547) |  |
| [548](#L548) | /\* Check if the url is valid \*/ |
| [549](#L549) | if ( !filter\_var($url, FILTER\_VALIDATE\_URL) ) { |
| [550](#L550) | echo json\_encode(array('error' => 1)); die; |
| [551](#L551) | } |
| [552](#L552) |  |
| [553](#L553) | $post\_id = url\_to\_postid($url); |
| [554](#L554) | $home\_url = get\_home\_url(); |
| [555](#L555) | if ( $post\_id !== 0 && get\_post\_status( $post\_id ) != 'publish' && rtrim($url, "/") != rtrim($home\_url, "/") ) { |
| [556](#L556) | echo json\_encode( array('error' => 1, 'msg' => esc\_html\_\_('This page is not public. Please publish the page to check the score.', 'tenweb-booster')) ); |
| [557](#L557) | die; |
| [558](#L558) | } |
| [559](#L559) |  |
| [560](#L560) | if ( $last\_api\_key\_index != '' ) { |
| [561](#L561) | /\* remove array value as this key already used and no need to try again during the retry \*/ |
| [562](#L562) | unset($this->google\_api\_keys[$last\_api\_key\_index]); |
| [563](#L563) | } |
| [564](#L564) | $random\_index = array\_rand( $this->google\_api\_keys ); |
| [565](#L565) | $random\_api\_key = $this->google\_api\_keys[$random\_index]; |
| [566](#L566) | $result = $this->twb\_google\_speed\_cron( $url, 'desktop', $random\_api\_key ); |
| [567](#L567) | if ( !empty($result['error']) || empty($result)) { |
| [568](#L568) | /\* Case when retry already done and $last\_api\_key\_index is not empty \*/ |
| [569](#L569) | if ( $last\_api\_key\_index != '' ) { |
| [570](#L570) | echo json\_encode(array( 'error' => 1 )); |
| [571](#L571) | } |
| [572](#L572) | else { |
| [573](#L573) | echo json\_encode(array( 'error' => 1, 'last\_api\_key\_index' => $random\_index )); |
| [574](#L574) | } |
| [575](#L575) | die; |
| [576](#L576) | } |
| [577](#L577) | $score['desktop'] = $result['score']\*100; |
| [578](#L578) | $score['desktop\_loading\_time'] = $result['loading\_time']; |
| [579](#L579) |  |
| [580](#L580) | $result = $this->twb\_google\_speed\_cron( $url, 'mobile', $random\_api\_key ); |
| [581](#L581) | if ( !empty($result['error']) || empty($result) ) { |
| [582](#L582) | /\* Case when retry already done and $last\_api\_key\_index is not empty \*/ |
| [583](#L583) | if ( $last\_api\_key\_index != '' ) { |
| [584](#L584) | echo json\_encode(array( 'error' => 1 )); |
| [585](#L585) | } |
| [586](#L586) | else { |
| [587](#L587) | echo json\_encode(array( 'error' => 1, 'last\_api\_key\_index' => $random\_index )); |
| [588](#L588) | } |
| [589](#L589) | die; |
| [590](#L590) | } |
| [591](#L591) | $score['mobile'] = $result['score']\*100; |
| [592](#L592) | $score['mobile\_loading\_time'] = $result['loading\_time']; |
| [593](#L593) |  |
| [594](#L594) | $nowdate = current\_time( 'mysql' ); |
| [595](#L595) | $nowdate = date('d.m.Y h:i:s a', strtotime($nowdate)); |
| [596](#L596) |  |
| [597](#L597) | $data = get\_option('twb\_speed\_score'); |
| [598](#L598) | $data[$url] = array( |
| [599](#L599) | 'desktop\_score' => $score['desktop'], |
| [600](#L600) | 'desktop\_loading\_time' => $score['desktop\_loading\_time'], |
| [601](#L601) | 'mobile\_score' => $score['mobile'], |
| [602](#L602) | 'mobile\_loading\_time' => $score['mobile\_loading\_time'], |
| [603](#L603) | 'last\_analyzed\_time' => $nowdate, |
| [604](#L604) | 'error' => 0 |
| [605](#L605) | ); |
| [606](#L606) | $data['last'] = array( |
| [607](#L607) | 'url' => $url |
| [608](#L608) | ); |
| [609](#L609) | update\_option('twb\_speed\_score', $data, 1); |
| [610](#L610) |  |
| [611](#L611) | $twb\_hompage\_optimized = get\_option('twb\_hompage\_optimized'); |
| [612](#L612) | if ( rtrim($url, "/") == rtrim($home\_url, "/") && !empty($twb\_hompage\_optimized) && $twb\_hompage\_optimized == 1 ) { |
| [613](#L613) | update\_option('twb\_hompage\_optimized', 2); |
| [614](#L614) | } |
| [615](#L615) | ob\_clean(); |
| [616](#L616) | echo json\_encode(array( |
| [617](#L617) | 'desktop\_score' => esc\_html($score['desktop']), |
| [618](#L618) | 'desktop\_loading\_time' => esc\_html($score['desktop\_loading\_time']), |
| [619](#L619) | 'mobile\_score' => esc\_html($score['mobile']), |
| [620](#L620) | 'mobile\_loading\_time' => esc\_html($score['mobile\_loading\_time']), |
| [621](#L621) | 'last\_analyzed\_time' => esc\_html($nowdate), |
| [622](#L622) | )); |
| [623](#L623) | die; |
| [624](#L624) | } |
| [625](#L625) |  |
| [626](#L626) | /\*\* |
| [627](#L627) | \* Remote get action to get google speed score |
| [628](#L628) | \* |
| [629](#L629) | \* @param $page\_url string which is url of the page which speed should counted |
| [630](#L630) | \* @param $strategy string parameter which get desktop or mobile |
| [631](#L631) | \* |
| [632](#L632) | \* @return array |
| [633](#L633) | \*/ |
| [634](#L634) | public function twb\_google\_speed\_cron( $page\_url, $strategy,  $key = 'AIzaSyCQmF4ZSbZB8prjxci3GWVK4UWc-Yv7vbw') { |
| [635](#L635) | $url = "https://www.googleapis.com/pagespeedonline/v5/runPagespeed?url=" . $page\_url . "&key=".$key; |
| [636](#L636) | $url = ( $strategy == "mobile" ) ? $url . "&strategy=mobile" : $url; |
| [637](#L637) |  |
| [638](#L638) | $response = wp\_remote\_get($url, array('timeout' => 300)); |
| [639](#L639) | $data = array(); |
| [640](#L640) |  |
| [641](#L641) | if (is\_array($response) && !is\_wp\_error($response)) { |
| [642](#L642) |  |
| [643](#L643) | $body = $response['body']; |
| [644](#L644) | $body = json\_decode($body); |
| [645](#L645) | if (isset($body->error) ) { |
| [646](#L646) | $data['error'] = 1; |
| [647](#L647) | } else { |
| [648](#L648) | $data['score'] = $body->lighthouseResult->categories->performance->score; |
| [649](#L649) | $data['loading\_time'] = $body->lighthouseResult->audits->interactive->displayValue; |
| [650](#L650) | } |
| [651](#L651) | } else { |
| [652](#L652) | $data['error'] = 1; |
| [653](#L653) | } |
| [654](#L654) | return $data; |
| [655](#L655) | } |
| [656](#L656) | } |

**Note:** See [TracBrowser](/wiki/TracBrowser)
for help on using the repository browser.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Plain Text](/browser/form-maker/tags/1.15.21/booster/controller.php?format=txt)
* [Original Format](/export/3222502/form-maker/tags/1.15.21/booster/controller.php)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)


