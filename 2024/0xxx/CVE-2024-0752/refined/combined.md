=== Content from www.mozilla.org_edd21a79_20250114_203204.html ===


## Help us improve your Mozilla experience

In addition to Cookies necessary for this site to function, we’d like your permission to set some additional Cookies to better understand your browsing needs and improve your experience. Rest assured — we value your privacy.

Accept All Additional Cookies

Reject All Additional Cookies

[Cookie settings](/en-US/privacy/websites/cookie-settings/)

Menu
[![Mozilla](https://www.mozilla.org/media/img/logos/m24/lockup-black.f2ddba3f0724.svg)](/en-US/)

* [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
  Firefox browsers](/en-US/firefox/)
  Close Firefox browsers menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Desktop](/en-US/firefox/new/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for iOS](/en-US/firefox/browsers/mobile/ios/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Android](/en-US/firefox/browsers/mobile/android/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/focus/logo.aac3e33175cb.svg)
    ## Firefox Focus](/en-US/firefox/browsers/mobile/focus/)
  + [## Firefox blog](https://blog.mozilla.org/firefox/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=firefox)
* [Products](/en-US/products/)
  Close Products menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/mozilla/vpn/logo.c648f487bfb8.svg)
    ## Mozilla VPN](/en-US/products/vpn/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/monitor/logo.d97e5516f9e6.svg)
    ## Mozilla Monitor](https://monitor.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/relay/logo-white.d42a8b52e44c.svg)
    ## Firefox Relay](https://relay.firefox.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/pocket/logo.17446bc33a5d.svg)
    ## Pocket](https://getpocket.com/firefox_learnmore/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/nav/icons/icon-mdn-plus.f54475f980ab.svg)
    ## MDN Plus](https://developer.mozilla.org/plus?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/fakespot/logo-blue.3973b8fe9631.svg)
    ## Fakespot](https://fakespot.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/thunderbird/logo-thunderbird.121e9c0fed45.svg)
    ## Thunderbird](https://www.thunderbird.net/)

  [All products](/en-US/products/)
* [About us](/en-US/about/)
  Close About us menu

  Our Mission

  + [## About Mozilla](/en-US/about/)
  + [## The Mozilla Manifesto](/en-US/about/manifesto/)
  + [## Get Involved](/en-US/contribute/)
  + [## Innovation Projects](https://future.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Blog](https://blog.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)

  Our Work

  + [## Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla.ai](https://www.mozilla.ai/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Ventures](https://mozilla.vc/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Advertising](/en-US/advertising/)

## Menu

* Mozilla Security

## [Mozilla Security](/en-US/security/)

* [Advisories](/en-US/security/advisories/)
* [Known Vulnerabilities](/en-US/security/known-vulnerabilities/)
* [Mozilla Security Blog](https://blog.mozilla.com/security/)
* [Security Bug Bounty](/en-US/security/bug-bounty/)
* [Third-party Injection Policy](/en-US/security/third-party-software-injection/)

## [Client Bug Bounty](/en-US/security/client-bug-bounty/)

* [Frequently Asked Questions](/en-US/security/bug-bounty/faq/)
* [Hall of Fame](/en-US/security/bug-bounty/hall-of-fame/)

## [Web Bug Bounty](/en-US/security/web-bug-bounty/)

* [Eligible Websites](/en-US/security/bug-bounty/web-eligible-sites/)
* [Frequently Asked Questions](/en-US/security/bug-bounty/faq-webapp/)
* [Hall of Fame](/en-US/security/bug-bounty/web-hall-of-fame/)

# Mozilla Foundation Security Advisory 2024-01

## Security Vulnerabilities fixed in Firefox 122

Announced
January 23, 2024
Impact
high
Products
Firefox
Fixed in

* Firefox 122

#### [#CVE-2024-0741: Out of bounds write in ANGLE](#CVE-2024-0741)

Reporter
Renan Rios
Impact
high
##### Description

An out of bounds write in ANGLE could have allowed an attacker to corrupt memory leading to a potentially exploitable crash.

##### References

* [Bug 1864587](https://bugzilla.mozilla.org/show_bug.cgi?id=1864587)

#### [#CVE-2024-0742: Failure to update user input timestamp](#CVE-2024-0742)

Reporter
Andrew McCreight
Impact
high
##### Description

It was possible for certain browser prompts and dialogs to be activated or dismissed unintentionally by the user due to an incorrect timestamp used to prevent input after page load.

##### References

* [Bug 1867152](https://bugzilla.mozilla.org/show_bug.cgi?id=1867152)

#### [#CVE-2024-0743: Crash in NSS TLS method](#CVE-2024-0743)

Reporter
John Schanck
Impact
high
##### Description

An unchecked return value in TLS handshake code could have caused a potentially exploitable crash.

##### References

* [Bug 1867408](https://bugzilla.mozilla.org/show_bug.cgi?id=1867408)

#### [#CVE-2024-0744: Wild pointer dereference in JavaScript](#CVE-2024-0744)

Reporter
Lukas Bernhard
Impact
high
##### Description

In some circumstances, JIT compiled code could have dereferenced a wild pointer value. This could have led to an exploitable crash.

##### References

* [Bug 1871089](https://bugzilla.mozilla.org/show_bug.cgi?id=1871089)

#### [#CVE-2024-0745: Stack buffer overflow in WebAudio](#CVE-2024-0745)

Reporter
Yangkang of 360 ATA Team
Impact
high
##### Description

The WebAudio `OscillatorNode` object was susceptible to a stack buffer overflow. This could have led to a potentially exploitable crash.

##### References

* [Bug 1871838](https://bugzilla.mozilla.org/show_bug.cgi?id=1871838)

#### [#CVE-2024-0746: Crash when listing printers on Linux](#CVE-2024-0746)

Reporter
Cornel Ionce
Impact
moderate
##### Description

A Linux user opening the print preview dialog could have caused the browser to crash.

##### References

* [Bug 1660223](https://bugzilla.mozilla.org/show_bug.cgi?id=1660223)

#### [#CVE-2024-0747: Bypass of Content Security Policy when directive unsafe-inline was set](#CVE-2024-0747)

Reporter
Seongil Wi
Impact
moderate
##### Description

When a parent page loaded a child in an iframe with `unsafe-inline`, the parent Content Security Policy could have overridden the child Content Security Policy.

##### References

* [Bug 1764343](https://bugzilla.mozilla.org/show_bug.cgi?id=1764343)

#### [#CVE-2024-0748: Compromised content process could modify document URI](#CVE-2024-0748)

Reporter
Young Min Kim
Impact
moderate
##### Description

A compromised content process could have updated the document URI. This could have allowed an attacker to set an arbitrary URI in the address bar or history.

##### References

* [Bug 1783504](https://bugzilla.mozilla.org/show_bug.cgi?id=1783504)

#### [#CVE-2024-0749: Phishing site popup could show local origin in address bar](#CVE-2024-0749)

Reporter
Kestrel
Impact
moderate
##### Description

A phishing site could have repurposed an `about:` dialog to show phishing content with an incorrect origin in the address bar.

##### References

* [Bug 1813463](https://bugzilla.mozilla.org/show_bug.cgi?id=1813463)

#### [#CVE-2024-0750: Potential permissions request bypass via clickjacking](#CVE-2024-0750)

Reporter
Hafiizh
Impact
moderate
##### Description

A bug in popup notifications delay calculation could have made it possible for an attacker to trick a user into granting permissions.

##### References

* [Bug 1863083](https://bugzilla.mozilla.org/show_bug.cgi?id=1863083)

#### [#CVE-2024-0751: Privilege escalation through devtools](#CVE-2024-0751)

Reporter
Rob Wu
Impact
moderate
##### Description

A malicious devtools extension could have been used to escalate privileges.

##### References

* [Bug 1865689](https://bugzilla.mozilla.org/show_bug.cgi?id=1865689)

#### [#CVE-2024-0752: Use-after-free could occur when applying update on macOS](#CVE-2024-0752)

Reporter
Nika Layzell
Impact
moderate
##### Description

A use-after-free crash could have occurred on macOS if a Firefox update were being applied on a very busy system. This could have resulted in an exploitable crash.

##### References

* [Bug 1866840](https://bugzilla.mozilla.org/show_bug.cgi?id=1866840)

#### [#CVE-2024-0753: HSTS policy on subdomain could bypass policy of upper domain](#CVE-2024-0753)

Reporter
Hanno Böck
Impact
moderate
##### Description

In specific HSTS configurations an attacker could have bypassed HSTS on a subdomain.

##### References

* [Bug 1870262](https://bugzilla.mozilla.org/show_bug.cgi?id=1870262)

#### [#CVE-2024-0754: Crash when using some WASM files in devtools](#CVE-2024-0754)

Reporter
Christian Holler
Impact
moderate
##### Description

Some WASM source files could have caused a crash when loaded in devtools.

##### References

* [Bug 1871605](https://bugzilla.mozilla.org/show_bug.cgi?id=1871605)

#### [#CVE-2024-0755: Memory safety bugs fixed in Firefox 122, Firefox ESR 115.7, and Thunderbird 115.7](#CVE-2024-0755)

Reporter
Daniel Holbert, Andrew Osmond, and the Mozilla Fuzzing Team
Impact
moderate
##### Description

Memory safety bugs present in Firefox 121, Firefox ESR 115.6, and Thunderbird 115.6. Some of these bugs showed evidence of memory corruption and we presume that with enough effort some of these could have been exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 122, Firefox ESR 115.7, and Thunderbird 115.7](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1868456%2C1871445%2C1873701)

## Company

* [Leadership](/about/leadership/)
* [Press Center](https://blog.mozilla.org/category/mozilla/news/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=company)
* [Careers](/en-US/careers/)
* [Contact](/en-US/contact/)

## Support

* [Product Help](https://support.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [File a Bug](https://bugzilla.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [Localize Mozilla](https://pontoon.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)

## Resources

* [Advertise with Mozilla](/en-US/advertising/)
* [Firefox Release Notes](/firefox/134.0.1/releasenotes/)

## Developers

* [Developer Edition](/en-US/firefox/developer/)
* [Enterprise](/en-US/firefox/enterprise/)
* [Tools](https://firefox-source-docs.mozilla.org/devtools-user/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=developers)
* [MDN](https://developer.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer)

## Follow @Mozilla

* [X (formerly Twitter) (@mozilla)](https://twitter.com/mozilla)
* [Instagram (@mozilla)](https://www.instagram.com/mozilla/)
* [LinkedIn (@mozilla)](https://www.linkedin.com/company/mozilla-corporation/)
* [TikTok (@mozilla)](https://www.tiktok.com/%40mozilla)
* [Spotify (@mozilla)](https://open.spotify.com/show/0vT7LJMeVDxyQ2ZamHKu08?si=_uDRD6bRR_6M5YZyISGXgA)

## Follow @Firefox

* [X (formerly Twitter) (@firefox)](https://twitter.com/firefox)
* [Instagram (@firefox)](https://www.instagram.com/firefox/)
* [YouTube (@firefoxchannel)](https://www.youtube.com/user/firefoxchannel)
* [TikTok (@firefox)](https://www.tiktok.com/%40firefox)

[Donate](https://foundation.mozilla.org/?form=moco-donate-footer)

Visit [Mozilla Corporation’s](/en-US/) not-for-profit parent, the [Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer).

Portions of this content are ©1998–2025 by individual mozilla.org contributors. Content available under a [Creative Commons license](/en-US/foundation/licensing/website-content/).

* [Website Privacy Notice](/en-US/privacy/websites/)
* [Cookies](/en-US/privacy/websites/cookie-settings/)
* [Legal](/en-US/about/legal/)
* [Community Participation Guidelines](/en-US/about/governance/policies/participation/)
* [About this site](/en-US/about/this-site/)

![](https://www.mozilla.org/media/img/logos/m24/wordmark-white.2d673bb5b33a.svg)



=== Content from bugzilla.mozilla.org_d78ad347_20250114_203204.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/1866840)
* [XML](/show_bug.cgi?ctype=xml&id=1866840)

Closed
[Bug 1866840](/show_bug.cgi?id=1866840)
(CVE-2024-0752)

Opened 1 year ago
Closed 1 year ago

# TImeout code for calling SetupMacCommandLine on main thread can lead to a UAF

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

TImeout code for calling SetupMacCommandLine on main thread can lead to a UAF

## Categories

### (Toolkit :: Application Update, defect)

[Product:](/describecomponents.cgi?product=Toolkit)

Toolkit
▾

Toolkit
The Mozilla Toolkit is a set of APIs, built on top of Gecko, which provide advanced services to XUL applications. These services include Profile Management, Chrome Registration, Browsing History, Extension and Theme Management, Application Update Service, and Safe Mode. ([More info](https://wiki.mozilla.org/Modules/Toolkit))
[See Open Bugs in This Product](/buglist.cgi?product=Toolkit&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Toolkit)
Watch This Product

[Component:](/describecomponents.cgi?product=Toolkit&component=Application%20Update#Application%20Update)

Application Update
▾

Toolkit :: Application Update
Application update for Firefox and Thunderbird.
[See Open Bugs in This Component](/buglist.cgi?product=Toolkit&component=Application%20Update&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Toolkit&component=Application%20Update&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Toolkit&component=Application%20Update)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

unspecified

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

Unspecified

Unspecified

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

--

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

122 Branch

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Webcompat Score | --- |
| --- | --- |
| Accessibility Severity | --- |
| Performance Impact | --- |
| a11y-review | --- |
| Webcompat Priority | --- |
| Install Update Workflow | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox-esr115 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox_esr115&o1=equals&v1=wontfix) |
| firefox120 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox120&o1=equals&v1=wontfix) |
| firefox121 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox121&o1=equals&v1=wontfix) |
| firefox122 | --- | [verified](/buglist.cgi?f1=cf_status_firefox122&o1=equals&v1=verified) |

|  | Tracking | Status |
| --- | --- | --- |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | wontfix |
| firefox-esr128 | --- | --- |
| firefox120 |  | wontfix |
| firefox121 |  | wontfix |
| firefox122 |  | verified |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: nika, Assigned: nika)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/fcf93a5a624020bf2256443c69e08b51?d=mm&size=40)  [nika](/user_profile?user_id=534482)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/fcf93a5a624020bf2256443c69e08b51?d=mm&size=40)  [nika](/user_profile?user_id=534482)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/50e82ef70720dfcf1385f583e34f9ba9?d=mm&size=40)  [erchen](/user_profile?user_id=753852)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

9 people

## References

### (Regression)

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

[1342887](/show_bug.cgi?id=1342887 "RESOLVED FIXED - Intermittent test_fallback_update.py TestFallbackUpdate.test_update | TimeoutException: Timed out after 300.1 seconds with message: Update has been applied.")

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

[1864241](/show_bug.cgi?id=1864241 "RESOLVED WORKSFORME - Crash in [@ mozilla::Monitor::Lock]")

## Details

### (Keywords: csectype-uaf, regression, sec-moderate, Whiteboard: [adv-main122+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

CVE-2024-0752

[Keywords:](/describekeywords.cgi)

[csectype-uaf](/buglist.cgi?keywords=csectype-uaf&resolution=---),
[regression](/buglist.cgi?keywords=regression&resolution=---),
[sec-moderate](/buglist.cgi?keywords=sec-moderate&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[adv-main122+]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (2 files, 2 obsolete files)

| [Bug 1866840 - Only call SetupMacCommandLine if we're restarting, r=#application-update-reviewers](/attachment.cgi?id=9365659)  [1 year ago](#c1)  [Nika Layzell [:nika] (ni? for response)](/user_profile?user_id=534482)   48 bytes, text/x-phabricator-request |  | [Details](/attachment.cgi?id=9365659&action=edit) | [Review](/attachment.cgi?id=9365659) |
| --- | --- | --- |
| [Bug 1866840 - Only call SetupMacCommandLine if we're restarting, r=#application-update-reviewers](/attachment.cgi?id=9366926)  [1 year ago](#c8)  [Nika Layzell [:nika] (ni? for response)](/user_profile?user_id=534482)   48 bytes, text/x-phabricator-request | RyanVM : [approval-mozilla-beta-](#c10 "1 year ago") | [Details](/attachment.cgi?id=9366926&action=edit) | [Review](/attachment.cgi?id=9366926) |
| [advisory.txt](/attachment.cgi?id=9373608)  [1 year ago](#c12)  [Jesse Schwartzentruber (:truber)](/user_profile?user_id=486733)   235 bytes, text/plain |  | [Details](/attachment.cgi?id=9373608&action=edit) |
| [Bug 1866840 - Add fuzzing Nyx coverage build. r?#taskgraph-reviewers!](/attachment.cgi?id=9377949)  [1 year ago](#c13)  [Jesse Schwartzentruber (:truber)](/user_profile?user_id=486733)   48 bytes, text/x-phabricator-request |  | [Details](/attachment.cgi?id=9377949&action=edit) | [Review](/attachment.cgi?id=9377949) |

Show Obsolete

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Nika Layzell [:nika] (ni? for response)](/user_profile?user_id=534482)  Assignee |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=1866840#c0)• 1 year ago |
|  | |

In [bug 1342887](/show_bug.cgi?id=1342887 "RESOLVED FIXED - Intermittent test_fallback_update.py TestFallbackUpdate.test_update | TimeoutException: Timed out after 300.1 seconds with message: Update has been applied."), a timeout was added to the synchronous wait in `UpdateDriverSetupMacCommandLine` for a dispatch to the main thread. Unfortunately, this timeout will likely lead to a UAF if triggered, as the closure for the runnable holds references to stack local values: <https://searchfox.org/mozilla-central/rev/f030995a79461379153293c0e07f4982afe9ac28/toolkit/xre/nsUpdateDriver.cpp#91>.

This code should either be changed to remove the timeout (likely changing to to instead use a helper like [`SyncRunnable`](https://searchfox.org/mozilla-central/rev/f030995a79461379153293c0e07f4982afe9ac28/xpcom/threads/SyncRunnable.h#32) which makes this sort of thing safer, or it should be modified to work safely, by copying all relevant state onto the heap. Given the types of some of the captured data (including mutating raw pointer in/out parameters), however, this seems like it would be a bit tricky.

That being said, looking at the callers of `UpdateDriverSetupMacCommandLine`, I actually think it is possible to avoid the call and dispatch all-together.

This function appears to be called indirectly through [`ProcessUpdates`](https://searchfox.org/mozilla-central/rev/f030995a79461379153293c0e07f4982afe9ac28/toolkit/xre/nsUpdateDriver.cpp#694,729,736), which only appears to be called off-main-thread in [`nsUpdateProcessor::StartStagedUpdate`](https://searchfox.org/mozilla-central/rev/f030995a79461379153293c0e07f4982afe9ac28/toolkit/xre/nsUpdateDriver.cpp#832). In this case the `restart` parameter is `false`, and we should be post-XPCOM-startup meaning that [most of the `SetupMacCommandLine` function](https://searchfox.org/mozilla-central/rev/f030995a79461379153293c0e07f4982afe9ac28/toolkit/xre/nsCommandLineServiceMac.mm#60-75) is a no-op. In addition, the [only non-noop section](https://searchfox.org/mozilla-central/rev/f030995a79461379153293c0e07f4982afe9ac28/toolkit/xre/nsCommandLineServiceMac.mm#51-58) only removes command line flags, and if `restart` is false, those flags [will never be in the passed in argc array](https://searchfox.org/mozilla-central/rev/f030995a79461379153293c0e07f4982afe9ac28/toolkit/xre/nsUpdateDriver.cpp#554-575,619).

I believe the `UpdateDriverSetupMacCommandLine` function can be removed, and the relevant code inserted into the call-site: <https://searchfox.org/mozilla-central/rev/f030995a79461379153293c0e07f4982afe9ac28/toolkit/xre/nsUpdateDriver.cpp#619>

```
if (restart) {
  MOZ_RELEASE_ASSERT(NS_IsMainThread(),
                     "restart may only be set for calls on the main thread");
  CommandLineServiceMac::SetupMacCommandLine(argc, argv, restart);
}

```

|  | [Nika Layzell [:nika] (ni? for response)](/user_profile?user_id=534482)  Assignee |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=1866840#c1)• 1 year ago |
|  | |

Attached file
[Bug 1866840 - Only call SetupMacCommandLine if we're restarting, r=#application-update-reviewers](attachment.cgi?id=9365659)
— [Details](attachment.cgi?id=9365659&action=edit)

|  | [Phabricator Automation](/user_profile?user_id=600971) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1866840#a724_600971)• 1 year ago |

Assignee: nobody → nikaStatus: NEW → ASSIGNED

|  | [BugBot [:suhaib / :marco/ :calixte]](/user_profile?user_id=575867) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=1866840#c2)• 1 year ago |
|  | |

Set release status flags based on info from the regressing [bug 1342887](/show_bug.cgi?id=1342887 "RESOLVED FIXED - Intermittent test_fallback_update.py TestFallbackUpdate.test_update | TimeoutException: Timed out after 300.1 seconds with message: Update has been applied.")

[status-firefox120](/buglist.cgi?f1=cf_status_firefox120&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox120&o1=equals&v1=affected)
[status-firefox121](/buglist.cgi?f1=cf_status_firefox121&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox121&o1=equals&v1=affected)
[status-firefox122](/buglist.cgi?f1=cf_status_firefox122&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox122&o1=equals&v1=affected)
[status-firefox-esr115](/buglist.cgi?f1=cf_status_firefox_esr115&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox_esr115&o1=equals&v1=affected)

|  | [Nika Layzell [:nika] (ni? for response)](/user_profile?user_id=534482)  Assignee |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=1866840#c3)• 1 year ago |
|  | |

I realize I never wrote it in this bug, but i found this issue through :gsvelto's comment: <https://bugzilla.mozilla.org/show_bug.cgi?id=1864241#c1>

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=1866840#c4)• 1 year ago |
|  | |

Nice find. This sounds like it would be difficult for a web page to exploit, so I'll mark it sec-moderate.

Keywords: [csectype-uaf](/buglist.cgi?keywords=csectype-uaf&resolution=---),
[sec-moderate](/buglist.cgi?keywords=sec-moderate&resolution=---)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1866840#a95183_75935)• 1 year ago |

[status-firefox120](/buglist.cgi?f1=cf_status_firefox120&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox120&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox120&o1=equals&v1=wontfix)
[status-firefox121](/buglist.cgi?f1=cf_status_firefox121&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox121&o1=equals&v1=affected) → [fix-optional](/buglist.cgi?f1=cf_status_firefox121&o1=equals&v1=fix-optional)

|  | [Pulsebot](/user_profile?user_id=510726) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=1866840#c5)• 1 year ago |
|  | |

Pushed by nlayzell@mozilla.com:
<https://hg.mozilla.org/integration/autoland/rev/dca6957049cc>
Only call SetupMacCommandLine if we're restarting, r=application-update-reviewers,nalexander

|  | [Sebastian Hengst [:aryx] (needinfo me if it's about an intermittent or backout)](/user_profile?user_id=258347) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=1866840#c6)• 1 year ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/dca6957049cc>

Group: firefox-core-security → core-security-releaseStatus: ASSIGNED → RESOLVEDClosed: 1 year ago
[status-firefox122](/buglist.cgi?f1=cf_status_firefox122&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox122&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox122&o1=equals&v1=fixed)Resolution: --- → FIXEDTarget Milestone: --- → 122 Branch

|  | [BugBot [:suhaib / :marco/ :calixte]](/user_profile?user_id=575867) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=1866840#c7)• 1 year ago |
|  | |

The patch landed in nightly and beta is affected.

:nika, is this bug important enough to require an uplift?

* If yes, please nominate the patch for beta approval.
* If no, please set `status-firefox121` to `wontfix`.

For more information, please visit [BugBot documentation](https://wiki.mozilla.org/BugBot#uplift_beta.py).

Flags: needinfo?(nika)

|  | [Nika Layzell [:nika] (ni? for response)](/user_profile?user_id=534482)  Assignee |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=1866840#c8)• 1 year ago |
|  | |

Attached file
[Bug 1866840 - Only call SetupMacCommandLine if we're restarting, r=#application-update-reviewers](attachment.cgi?id=9366926) (obsolete)
— [Details](attachment.cgi?id=9366926&action=edit)

Original Revision: <https://phabricator.services.mozilla.com/D194792>

|  | [Phabricator Automation](/user_profile?user_id=600971) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1866840#a613433_600971)• 1 year ago |

[Attachment #9366926](/attachment.cgi?id=9366926&action=edit "Bug 1866840 - Only call SetupMacCommandLine if we're restarting, r=#application-update-reviewers") -
Flags: approval-mozilla-beta?

|  | [Phabricator Automation](/user_profile?user_id=600971) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=1866840#c9)• 1 year ago |
|  | |

# Uplift Approval Request

* **Risk associated with taking this patch**: Medium-High
* **Is Android affected?**: no
* **Code covered by automated testing**: no
* **Steps to reproduce for manual QE testing**: Two flows should be checked: 1. Start Firefox with `open -a path/to/Firefox.app https://mozilla.org` while an update is staged, but has not yet been applied. 2. Restart firefox while it is running for an update, and ensure that the pages restore as expected, no crashes occur, and the update is applied.
* **Fix verified in Nightly**: yes
* **Needs manual QE test**: yes
* **String changes made/needed**: None
* **User impact if declined**: Very rare racy UAF if the main thread is very busy when applying an update. Likely very difficult to exploit due to only occurring in specific cases when applying a pending update.
* **Explanation of risk level**: Changes to largely untested macOS-specific update applicaiton logic.
Flags: qe-verify+

|  | [Nika Layzell [:nika] (ni? for response)](/user_profile?user_id=534482)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1866840#a614402_534482)• 1 year ago |

Flags: needinfo?(nika)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=1866840#c10)• 1 year ago |
|  | |

Comment on [attachment 9366926](/attachment.cgi?id=9366926 "Bug 1866840 - Only call SetupMacCommandLine if we're restarting, r=#application-update-reviewers") [[details]](/attachment.cgi?id=9366926&action=edit "Bug 1866840 - Only call SetupMacCommandLine if we're restarting, r=#application-update-reviewers")

[Bug 1866840](/show_bug.cgi?id=1866840 "VERIFIED FIXED - TImeout code for calling SetupMacCommandLine on main thread can lead to a UAF") - Only call SetupMacCommandLine if we're restarting, r=#application-update-reviewers

Given the medium-high risk and moderate severity of this, I'm inclined to let this ride the Fx122 train since we're a week out from Fx121 going to RC. Feel free to ping me if you feel that this should be reconsidered.

[Attachment #9366926](/attachment.cgi?id=9366926&action=edit "Bug 1866840 - Only call SetupMacCommandLine if we're restarting, r=#application-update-reviewers") -
Flags: approval-mozilla-beta? → approval-mozilla-beta-

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1866840#a614931_75935)• 1 year ago |

[status-firefox121](/buglist.cgi?f1=cf_status_firefox121&o1=isnotempty):
[fix-optional](/buglist.cgi?f1=cf_status_firefox121&o1=equals&v1=fix-optional) → [wontfix](/buglist.cgi?f1=cf_status_firefox121&o1=equals&v1=wontfix)
[status-firefox-esr115](/buglist.cgi?f1=cf_status_firefox_esr115&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox_esr115&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox_esr115&o1=equals&v1=wontfix)

|  | [Phabricator Automation](/user_profile?user_id=600971) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1866840#a615004_600971)• 1 year ago |

[Attachment #9366926](/attachment.cgi?id=9366926&action=edit "Bug 1866840 - Only call SetupMacCommandLine if we're restarting, r=#application-update-reviewers") -
Attachment is obsolete: true

|  | [Brindusa Tot, Desktop QA](/user_profile?user_id=553429) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1866840#a680845_553429)• 1 year ago |

QA Whiteboard: [qa-triaged]

|  | [Simona Badau, Desktop QA](/user_profile?user_id=409434) |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=1866840#c11)• 1 year ago |
|  | |

Verified as fixed on the latest Nightly 122.0a1 on macOS 13 - no crashes occur while updating using the two flows mentioned in [Comment 9](/show_bug.cgi?id=1866840#c9 "VERIFIED FIXED - TImeout code for calling SetupMacCommandLine on main thread can lead to a UAF").

Status: RESOLVED → VERIFIEDQA Whiteboard: [qa-triaged]
[status-firefox122](/buglist.cgi?f1=cf_status_firefox122&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox122&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox122&o1=equals&v1=verified)Flags: qe-verify+

|  | [Jesse Schwartzentruber (:truber)](/user_profile?user_id=486733) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1866840#a4419229_486733)• 1 year ago |

Whiteboard: [adv-main122+]

|  | [Jesse Schwartzentruber (:truber)](/user_profile?user_id=486733) |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=1866840#c12)• 1 year ago |
|  | |

Attached file
[advisory.txt](attachment.cgi?id=9373608)
— [Details](attachment.cgi?id=9373608&action=edit)

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1866840#a4577401_578488)• 1 year ago |

Alias: CVE-2024-0752

|  | [Jesse Schwartzentruber (:truber)](/user_profile?user_id=486733) |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=1866840#c13)• 1 year ago |
|  | |

Attached file
[Bug 1866840 - Add fuzzing Nyx coverage build. r?#taskgraph-reviewers!](attachment.cgi?id=9377949) (obsolete)
— [Details](attachment.cgi?id=9377949&action=edit)

|  | [Phabricator Automation](/user_profile?user_id=600971) |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=1866840#c14)• 1 year ago |
|  | |

Comment on [attachment 9377949](/attachment.cgi?id=9377949 "Bug 1866840 - Add fuzzing Nyx coverage build. r?#taskgraph-reviewers!") [[details]](/attachment.cgi?id=9377949&action=edit "Bug 1866840 - Add fuzzing Nyx coverage build. r?#taskgraph-reviewers!")

[Bug 1866840](/show_bug.cgi?id=1866840 "VERIFIED FIXED - TImeout code for calling SetupMacCommandLine on main thread can lead to a UAF") - Add fuzzing Nyx coverage build. r?#taskgraph-reviewers!

Revision D200454 was moved to [bug 1875285](/show_bug.cgi?id=1875285 "RESOLVED FIXED - Add snapshot fuzzing coverage build"). Setting [attachment 9377949](/attachment.cgi?id=9377949 "Bug 1866840 - Add fuzzing Nyx coverage build. r?#taskgraph-reviewers!") [[details]](/attachment.cgi?id=9377949&action=edit "Bug 1866840 - Add fuzzing Nyx coverage build. r?#taskgraph-reviewers!") to obsolete.

[Attachment #9377949](/attachment.cgi?id=9377949&action=edit "Bug 1866840 - Add fuzzing Nyx coverage build. r?#taskgraph-reviewers!") -
Attachment is obsolete: true

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=1866840#c15)• 8 months ago |
|  | |

Making Firefox 122 security bugs public. [bugspam filter string: Pilgarlic-Towers]

Group: core-security-release
You need to [log in](/show_bug.cgi?id=1866840&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Nika Layzell [:nika] (ni? for response)](/user_profile?user_id=534482)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review


