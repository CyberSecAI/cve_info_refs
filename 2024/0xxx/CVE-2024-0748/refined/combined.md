=== Content from www.mozilla.org_edd21a79_20250115_084127.html ===


## Help us improve your Mozilla experience

In addition to Cookies necessary for this site to function, we’d like your permission to set some additional Cookies to better understand your browsing needs and improve your experience. Rest assured — we value your privacy.

Accept All Additional Cookies

Reject All Additional Cookies

[Cookie settings](/en-US/privacy/websites/cookie-settings/)

Menu
[![Mozilla](https://www.mozilla.org/media/img/logos/m24/lockup-black.f2ddba3f0724.svg)](/en-US/)

* [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
  Firefox browsers](/en-US/firefox/)
  Close Firefox browsers menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Desktop](/en-US/firefox/new/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for iOS](/en-US/firefox/browsers/mobile/ios/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Android](/en-US/firefox/browsers/mobile/android/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/focus/logo.aac3e33175cb.svg)
    ## Firefox Focus](/en-US/firefox/browsers/mobile/focus/)
  + [## Firefox blog](https://blog.mozilla.org/firefox/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=firefox)
* [Products](/en-US/products/)
  Close Products menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/mozilla/vpn/logo.c648f487bfb8.svg)
    ## Mozilla VPN](/en-US/products/vpn/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/monitor/logo.d97e5516f9e6.svg)
    ## Mozilla Monitor](https://monitor.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/relay/logo-white.d42a8b52e44c.svg)
    ## Firefox Relay](https://relay.firefox.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/pocket/logo.17446bc33a5d.svg)
    ## Pocket](https://getpocket.com/firefox_learnmore/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/nav/icons/icon-mdn-plus.f54475f980ab.svg)
    ## MDN Plus](https://developer.mozilla.org/plus?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/fakespot/logo-blue.3973b8fe9631.svg)
    ## Fakespot](https://fakespot.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/thunderbird/logo-thunderbird.121e9c0fed45.svg)
    ## Thunderbird](https://www.thunderbird.net/)

  [All products](/en-US/products/)
* [About us](/en-US/about/)
  Close About us menu

  Our Mission

  + [## About Mozilla](/en-US/about/)
  + [## The Mozilla Manifesto](/en-US/about/manifesto/)
  + [## Get Involved](/en-US/contribute/)
  + [## Innovation Projects](https://future.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Blog](https://blog.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)

  Our Work

  + [## Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla.ai](https://www.mozilla.ai/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Ventures](https://mozilla.vc/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Advertising](/en-US/advertising/)

## Menu

* Mozilla Security

## [Mozilla Security](/en-US/security/)

* [Advisories](/en-US/security/advisories/)
* [Known Vulnerabilities](/en-US/security/known-vulnerabilities/)
* [Mozilla Security Blog](https://blog.mozilla.com/security/)
* [Security Bug Bounty](/en-US/security/bug-bounty/)
* [Third-party Injection Policy](/en-US/security/third-party-software-injection/)

## [Client Bug Bounty](/en-US/security/client-bug-bounty/)

* [Frequently Asked Questions](/en-US/security/bug-bounty/faq/)
* [Hall of Fame](/en-US/security/bug-bounty/hall-of-fame/)

## [Web Bug Bounty](/en-US/security/web-bug-bounty/)

* [Eligible Websites](/en-US/security/bug-bounty/web-eligible-sites/)
* [Frequently Asked Questions](/en-US/security/bug-bounty/faq-webapp/)
* [Hall of Fame](/en-US/security/bug-bounty/web-hall-of-fame/)

# Mozilla Foundation Security Advisory 2024-01

## Security Vulnerabilities fixed in Firefox 122

Announced
January 23, 2024
Impact
high
Products
Firefox
Fixed in

* Firefox 122

#### [#CVE-2024-0741: Out of bounds write in ANGLE](#CVE-2024-0741)

Reporter
Renan Rios
Impact
high
##### Description

An out of bounds write in ANGLE could have allowed an attacker to corrupt memory leading to a potentially exploitable crash.

##### References

* [Bug 1864587](https://bugzilla.mozilla.org/show_bug.cgi?id=1864587)

#### [#CVE-2024-0742: Failure to update user input timestamp](#CVE-2024-0742)

Reporter
Andrew McCreight
Impact
high
##### Description

It was possible for certain browser prompts and dialogs to be activated or dismissed unintentionally by the user due to an incorrect timestamp used to prevent input after page load.

##### References

* [Bug 1867152](https://bugzilla.mozilla.org/show_bug.cgi?id=1867152)

#### [#CVE-2024-0743: Crash in NSS TLS method](#CVE-2024-0743)

Reporter
John Schanck
Impact
high
##### Description

An unchecked return value in TLS handshake code could have caused a potentially exploitable crash.

##### References

* [Bug 1867408](https://bugzilla.mozilla.org/show_bug.cgi?id=1867408)

#### [#CVE-2024-0744: Wild pointer dereference in JavaScript](#CVE-2024-0744)

Reporter
Lukas Bernhard
Impact
high
##### Description

In some circumstances, JIT compiled code could have dereferenced a wild pointer value. This could have led to an exploitable crash.

##### References

* [Bug 1871089](https://bugzilla.mozilla.org/show_bug.cgi?id=1871089)

#### [#CVE-2024-0745: Stack buffer overflow in WebAudio](#CVE-2024-0745)

Reporter
Yangkang of 360 ATA Team
Impact
high
##### Description

The WebAudio `OscillatorNode` object was susceptible to a stack buffer overflow. This could have led to a potentially exploitable crash.

##### References

* [Bug 1871838](https://bugzilla.mozilla.org/show_bug.cgi?id=1871838)

#### [#CVE-2024-0746: Crash when listing printers on Linux](#CVE-2024-0746)

Reporter
Cornel Ionce
Impact
moderate
##### Description

A Linux user opening the print preview dialog could have caused the browser to crash.

##### References

* [Bug 1660223](https://bugzilla.mozilla.org/show_bug.cgi?id=1660223)

#### [#CVE-2024-0747: Bypass of Content Security Policy when directive unsafe-inline was set](#CVE-2024-0747)

Reporter
Seongil Wi
Impact
moderate
##### Description

When a parent page loaded a child in an iframe with `unsafe-inline`, the parent Content Security Policy could have overridden the child Content Security Policy.

##### References

* [Bug 1764343](https://bugzilla.mozilla.org/show_bug.cgi?id=1764343)

#### [#CVE-2024-0748: Compromised content process could modify document URI](#CVE-2024-0748)

Reporter
Young Min Kim
Impact
moderate
##### Description

A compromised content process could have updated the document URI. This could have allowed an attacker to set an arbitrary URI in the address bar or history.

##### References

* [Bug 1783504](https://bugzilla.mozilla.org/show_bug.cgi?id=1783504)

#### [#CVE-2024-0749: Phishing site popup could show local origin in address bar](#CVE-2024-0749)

Reporter
Kestrel
Impact
moderate
##### Description

A phishing site could have repurposed an `about:` dialog to show phishing content with an incorrect origin in the address bar.

##### References

* [Bug 1813463](https://bugzilla.mozilla.org/show_bug.cgi?id=1813463)

#### [#CVE-2024-0750: Potential permissions request bypass via clickjacking](#CVE-2024-0750)

Reporter
Hafiizh
Impact
moderate
##### Description

A bug in popup notifications delay calculation could have made it possible for an attacker to trick a user into granting permissions.

##### References

* [Bug 1863083](https://bugzilla.mozilla.org/show_bug.cgi?id=1863083)

#### [#CVE-2024-0751: Privilege escalation through devtools](#CVE-2024-0751)

Reporter
Rob Wu
Impact
moderate
##### Description

A malicious devtools extension could have been used to escalate privileges.

##### References

* [Bug 1865689](https://bugzilla.mozilla.org/show_bug.cgi?id=1865689)

#### [#CVE-2024-0752: Use-after-free could occur when applying update on macOS](#CVE-2024-0752)

Reporter
Nika Layzell
Impact
moderate
##### Description

A use-after-free crash could have occurred on macOS if a Firefox update were being applied on a very busy system. This could have resulted in an exploitable crash.

##### References

* [Bug 1866840](https://bugzilla.mozilla.org/show_bug.cgi?id=1866840)

#### [#CVE-2024-0753: HSTS policy on subdomain could bypass policy of upper domain](#CVE-2024-0753)

Reporter
Hanno Böck
Impact
moderate
##### Description

In specific HSTS configurations an attacker could have bypassed HSTS on a subdomain.

##### References

* [Bug 1870262](https://bugzilla.mozilla.org/show_bug.cgi?id=1870262)

#### [#CVE-2024-0754: Crash when using some WASM files in devtools](#CVE-2024-0754)

Reporter
Christian Holler
Impact
moderate
##### Description

Some WASM source files could have caused a crash when loaded in devtools.

##### References

* [Bug 1871605](https://bugzilla.mozilla.org/show_bug.cgi?id=1871605)

#### [#CVE-2024-0755: Memory safety bugs fixed in Firefox 122, Firefox ESR 115.7, and Thunderbird 115.7](#CVE-2024-0755)

Reporter
Daniel Holbert, Andrew Osmond, and the Mozilla Fuzzing Team
Impact
moderate
##### Description

Memory safety bugs present in Firefox 121, Firefox ESR 115.6, and Thunderbird 115.6. Some of these bugs showed evidence of memory corruption and we presume that with enough effort some of these could have been exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 122, Firefox ESR 115.7, and Thunderbird 115.7](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1868456%2C1871445%2C1873701)

## Company

* [Leadership](/about/leadership/)
* [Press Center](https://blog.mozilla.org/category/mozilla/news/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=company)
* [Careers](/en-US/careers/)
* [Contact](/en-US/contact/)

## Support

* [Product Help](https://support.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [File a Bug](https://bugzilla.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [Localize Mozilla](https://pontoon.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)

## Resources

* [Advertise with Mozilla](/en-US/advertising/)
* [Firefox Release Notes](/firefox/134.0.1/releasenotes/)

## Developers

* [Developer Edition](/en-US/firefox/developer/)
* [Enterprise](/en-US/firefox/enterprise/)
* [Tools](https://firefox-source-docs.mozilla.org/devtools-user/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=developers)
* [MDN](https://developer.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer)

## Follow @Mozilla

* [X (formerly Twitter) (@mozilla)](https://twitter.com/mozilla)
* [Instagram (@mozilla)](https://www.instagram.com/mozilla/)
* [LinkedIn (@mozilla)](https://www.linkedin.com/company/mozilla-corporation/)
* [TikTok (@mozilla)](https://www.tiktok.com/%40mozilla)
* [Spotify (@mozilla)](https://open.spotify.com/show/0vT7LJMeVDxyQ2ZamHKu08?si=_uDRD6bRR_6M5YZyISGXgA)

## Follow @Firefox

* [X (formerly Twitter) (@firefox)](https://twitter.com/firefox)
* [Instagram (@firefox)](https://www.instagram.com/firefox/)
* [YouTube (@firefoxchannel)](https://www.youtube.com/user/firefoxchannel)
* [TikTok (@firefox)](https://www.tiktok.com/%40firefox)

[Donate](https://foundation.mozilla.org/?form=moco-donate-footer)

Visit [Mozilla Corporation’s](/en-US/) not-for-profit parent, the [Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer).

Portions of this content are ©1998–2025 by individual mozilla.org contributors. Content available under a [Creative Commons license](/en-US/foundation/licensing/website-content/).

* [Website Privacy Notice](/en-US/privacy/websites/)
* [Cookies](/en-US/privacy/websites/cookie-settings/)
* [Legal](/en-US/about/legal/)
* [Community Participation Guidelines](/en-US/about/governance/policies/participation/)
* [About this site](/en-US/about/this-site/)

![](https://www.mozilla.org/media/img/logos/m24/wordmark-white.2d673bb5b33a.svg)



=== Content from bugzilla.mozilla.org_0bccb2fb_20250115_084124.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/1783504)
* [XML](/show_bug.cgi?ctype=xml&id=1783504)

Closed
[Bug 1783504](/show_bug.cgi?id=1783504)
(CVE-2024-0748)

Opened 2 years ago
Closed 9 months ago

# Compromised content process can UpdateDocumentURI

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Compromised content process can UpdateDocumentURI

## Categories

### (Core :: DOM: Content Processes, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=DOM%3A%20Content%20Processes#DOM%3A%20Content%20Processes)

DOM: Content Processes
▾

Core :: DOM: Content Processes
Issues related to implementation of content processes in Firefox, especially the code in dom/ipc ([more info](https://wiki.mozilla.org/Project\_Fission))
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=DOM%3A%20Content%20Processes&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=DOM%3A%20Content%20Processes&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=DOM%3A%20Content%20Processes)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

unspecified

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

Unspecified

Unspecified

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

S2

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

126 Branch

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Webcompat Score | --- |
| --- | --- |
| Webcompat Priority | --- |
| Accessibility Severity | --- |
| a11y-review | --- |
| Performance Impact | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox-esr102 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox_esr102&o1=equals&v1=wontfix) |
| firefox-esr115 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox_esr115&o1=equals&v1=wontfix) |
| firefox113 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox113&o1=equals&v1=wontfix) |
| firefox114 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox114&o1=equals&v1=wontfix) |
| firefox115 | [+](/buglist.cgi?f1=cf_tracking_firefox115&o1=equals&v1=%2B) | [wontfix](/buglist.cgi?f1=cf_status_firefox115&o1=equals&v1=wontfix) |
| firefox116 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox116&o1=equals&v1=wontfix) |
| firefox117 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox117&o1=equals&v1=wontfix) |
| firefox119 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox119&o1=equals&v1=wontfix) |
| firefox120 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox120&o1=equals&v1=wontfix) |
| firefox121 | [-](/buglist.cgi?f1=cf_tracking_firefox121&o1=equals&v1=-) | [wontfix](/buglist.cgi?f1=cf_status_firefox121&o1=equals&v1=wontfix) |
| firefox122 | [+](/buglist.cgi?f1=cf_tracking_firefox122&o1=equals&v1=%2B) | [wontfix](/buglist.cgi?f1=cf_status_firefox122&o1=equals&v1=wontfix) |
| firefox123 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox123&o1=equals&v1=wontfix) |
| firefox124 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox124&o1=equals&v1=wontfix) |
| firefox125 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox125&o1=equals&v1=wontfix) |
| firefox126 | --- | [fixed](/buglist.cgi?f1=cf_status_firefox126&o1=equals&v1=fixed) |

|  | Tracking | Status |
| --- | --- | --- |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr102 |  | wontfix |
| firefox-esr115 | --- | wontfix |
| firefox-esr128 | --- | --- |
| firefox113 |  | wontfix |
| firefox114 |  | wontfix |
| firefox115 | + | wontfix |
| firefox116 |  | wontfix |
| firefox117 |  | wontfix |
| firefox119 |  | wontfix |
| firefox120 |  | wontfix |
| firefox121 | - | wontfix |
| firefox122 | + | wontfix |
| firefox123 |  | wontfix |
| firefox124 |  | wontfix |
| firefox125 |  | wontfix |
| firefox126 |  | fixed |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: y, Assigned: aiunusov)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/df47efa3986884c43ed81c2abb7e5514?d=mm&size=40)  [aiunusov](/user_profile?user_id=712685)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/00dd3423c26fb64e83ec942bdbdf7098?d=mm&size=40)  [y](/user_profile?user_id=694094)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/056757eff6ed7c8ec26f61e3bf7695fe?d=mm&size=40)  [smaug](/user_profile?user_id=39966)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

18 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

[1804684](/show_bug.cgi?id=1804684 "RESOLVED FIXED - Fragment navigation may change document URI scheme from https to http")

[1889331](/show_bug.cgi?id=1889331 "RESOLVED FIXED - Make dom.security.setdocumenturi enabled by default on release as well")

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[1868387](/show_bug.cgi?id=1868387 "RESOLVED FIXED - Make a pref, that enables origin security check for SetDocumentURI() method"), [1873052](/show_bug.cgi?id=1873052 "RESOLVED FIXED - Make pref dom.security.setdocumenturi enabled on early beta and earlier")

Dependency [tree](/showdependencytree.cgi?id=1783504&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=1783504)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

[1832321](/show_bug.cgi?id=1832321 "RESOLVED FIXED - Crash in [@ IPCError-content | RecvUpdateDocumentURI Setting DocumentURI with a different Origin than principal URI]"), [1852227](/show_bug.cgi?id=1852227 "RESOLVED WORKSFORME - Crash in [@ mozilla::dom::WindowGlobalChild::SetDocumentURI]"), [1876034](/show_bug.cgi?id=1876034 "RESOLVED FIXED - Crash [@ mozilla::dom::WindowGlobalChild::SetDocumentURI ]")

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

[fission-ipc-map](/show_bug.cgi?id=1491018 "NEW - Create Authoritative 'This Origin to this Content Process' Infrastructure")

## Details

### (4 keywords, Whiteboard: [disclosure 11 Aug 2023][reporter-external] [client-bounty-form] [verif?][adv-main122+] [adv-main126-])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

CVE-2024-0748

[Keywords:](/describekeywords.cgi)

[csectype-sop](/buglist.cgi?keywords=csectype-sop&resolution=---),
[csectype-spoof](/buglist.cgi?keywords=csectype-spoof&resolution=---),
[reporter-external](/buglist.cgi?keywords=reporter-external&resolution=---),
[sec-moderate](/buglist.cgi?keywords=sec-moderate&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[disclosure 11 Aug 2023][reporter-external] [client-bounty-form] [verif?][adv-main122+] [adv-main126-]

QA Whiteboard:

[post-critsmash-triage]

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [dveditz](/user_profile?user_id=1689) | [sec-bounty](#a41420530_1689 "2 years ago") | + |
| --- | --- | --- |
| [dveditz](/user_profile?user_id=1689) | sec-bounty | + |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (5 files, 3 obsolete files)

| [poc.patch](/attachment.cgi?id=9288698)  [2 years ago](#c0)  [Young Min Kim](/user_profile?user_id=694094)   608 bytes, patch |  | [Details](/attachment.cgi?id=9288698&action=edit) | [Diff](/attachment.cgi?id=9288698&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1783504&attachment=9288698) |
| --- | --- | --- |
| [ext.zip](/attachment.cgi?id=9288699)  [2 years ago](#c1)  [Young Min Kim](/user_profile?user_id=694094)   963 bytes, application/zip |  | [Details](/attachment.cgi?id=9288699&action=edit) |
| [poc.html](/attachment.cgi?id=9288700)  [2 years ago](#c2)  [Young Min Kim](/user_profile?user_id=694094)   1.11 KB, text/html |  | [Details](/attachment.cgi?id=9288700&action=edit) |
| [Bug 1783504 - tweak when UpdateDocumentURI can be set, r=smaug](/attachment.cgi?id=9298539)  [2 years ago](#c11)  [Artur Iunusov](/user_profile?user_id=712685)   48 bytes, text/x-phabricator-request |  | [Details](/attachment.cgi?id=9298539&action=edit) | [Review](/attachment.cgi?id=9298539) |
| [WIP: Bug 1783504 - FIX Compromised content process can UpdateDocumentURI, r=smaug!](/attachment.cgi?id=9299267)  [2 years ago](#c12)  [Artur Iunusov](/user_profile?user_id=712685)   48 bytes, text/x-phabricator-request |  | [Details](/attachment.cgi?id=9299267&action=edit) | [Review](/attachment.cgi?id=9299267) |
| [WIP: Bug 1783504 - FIX Compromised content process can UpdateDocumentURI, r=smaug!](/attachment.cgi?id=9303480)  [2 years ago](#c13)  [Artur Iunusov](/user_profile?user_id=712685)   48 bytes, text/x-phabricator-request |  | [Details](/attachment.cgi?id=9303480&action=edit) | [Review](/attachment.cgi?id=9303480) |
| [advisory.txt](/attachment.cgi?id=9373594)  [1 year ago](#c52)  [Jesse Schwartzentruber (:truber)](/user_profile?user_id=486733)   227 bytes, text/plain |  | [Details](/attachment.cgi?id=9373594&action=edit) |
| [poc.patch](/attachment.cgi?id=9379725)  [11 months ago](#c59)  [Artur Iunusov](/user_profile?user_id=712685)   677 bytes, patch |  | [Details](/attachment.cgi?id=9379725&action=edit) | [Diff](/attachment.cgi?id=9379725&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1783504&attachment=9379725) |

Show Obsolete

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Young Min Kim](/user_profile?user_id=694094)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=1783504#c0)• 2 years ago |
|  | |

Attached patch

[poc.patch](attachment.cgi?id=9288698&action=diff) (obsolete)
— [Details](attachment.cgi?id=9288698&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1783504&attachment=9288698)

`WindowGlobalParent::RecvUpdateDocumentURI` does not validate the new DocumentURI, so a compromised content process is able to set an arbitrary documentURI (<https://searchfox.org/mozilla-central/rev/675d6b7b04c4a802493d29632ee45f6e036a5702/dom/ipc/WindowGlobalParent.cpp#370>).

This is used in several places including but not limited to:

1. Address bar and related components, when the history is updated, e.g., `history.pushState()` or `history.back()`.
2. `Hub.fillInAddress` for `extensions/ConduitsParent` (<https://searchfox.org/mozilla-central/rev/675d6b7b04c4a802493d29632ee45f6e036a5702/toolkit/components/extensions/ConduitsParent.jsm#187>)

   This sets `MessageSender.url` for extension messages. Many extensions rely on `MessageSender.url` to verify whether the message came from a trusted source.
3. `webrtcUI.getActiveStreams` (<https://searchfox.org/mozilla-central/rev/675d6b7b04c4a802493d29632ee45f6e036a5702/browser/modules/webrtcUI.jsm#180>)

   This is used in "Tabs sharing devices" menu (the permission prompt is not affected).
4. `LoginAutoComplete::startSearch` (<https://searchfox.org/mozilla-central/rev/675d6b7b04c4a802493d29632ee45f6e036a5702/toolkit/components/passwordmgr/LoginAutoComplete.jsm#531>) and `LoginManagerChild::_filterForExactFormOriginLogins` (<https://searchfox.org/mozilla-central/rev/675d6b7b04c4a802493d29632ee45f6e036a5702/toolkit/components/passwordmgr/LoginManagerChild.jsm#2646>)

   It seems only fill via the context menu is possible, autofill seems not affected.

Threrefore, the compromised content process can spoof the address bar, extension message from trusted component, Tabs sharing devices" menu, and get logins for another origin.

## REPRODUCTION CASE

1. Apply the attached `poc.patch`.
2. Create a new login for `https://example.com` in `about:logins`.
3. Install the attached extension.
4. Visit the attached `poc.html` over secure origin (an online version is available in <https://chs17f87gytb304hg6vk.glitch.me/>)
5. Press "Click" and check the address bar.
6. Check the extension message sender.
7. Press "getUserMedia(audio)" and check "Tabs sharing devices" menu.
8. 5-7 should show example.com.
9. Open context menu on the Username field and select the login added in 2. Check the password field is filled.
Flags: sec-bounty?

|  | [Young Min Kim](/user_profile?user_id=694094)  Reporter |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=1783504#c1)• 2 years ago |
|  | |

Attached file
[ext.zip](attachment.cgi?id=9288699)
— [Details](attachment.cgi?id=9288699&action=edit)

|  | [Young Min Kim](/user_profile?user_id=694094)  Reporter |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=1783504#c2)• 2 years ago |
|  | |

Attached file
[poc.html](attachment.cgi?id=9288700)
— [Details](attachment.cgi?id=9288700&action=edit)

|  | [Sergey Galich [:serg]](/user_profile?user_id=691597) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1783504#a16328_691597)• 2 years ago |

Group: firefox-core-security → core-securityComponent: Security → IPCProduct: Firefox → Core

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1783504#a17806_406194)• 2 years ago |

Group: core-security → dom-core-securityComponent: IPC → DOM: Content Processes

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=1783504#c3)• 2 years ago |
|  | |

Nika, it looks like you have a comment in this function that sounds like the basic issue described in [comment 0](/show_bug.cgi?id=1783504#c0 "RESOLVED FIXED - Compromised content process can UpdateDocumentURI"). Do we have a bug on file for this?

Flags: needinfo?(nika)

|  | [Nika Layzell [:nika] (ni? for response)](/user_profile?user_id=534482) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=1783504#c4)• 2 years ago |
|  | |

I wasn't able to find one with a quick search. When I first wrote this code the `WindowGlobalParent` version of things wasn't used for anything yet, so there wasn't much of an impact, but we should definitely try to do better here.

It would be nice to do the full suite of checks which would be performed by a call like `pushState` here, however it's likely we'll need to relax things slightly at least at first while we're working on this. Perhaps we could start out by just having an origin check between the previous URI and a new URI, or some other check to make sure that the origin of the new URI matches `mDocumentPrincipal`. There will need to be some other checks to allow e.g. `about:blank` or `about:srcdoc` in some cases as well.

Flags: needinfo?(nika)

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1783504#a282100_578488)• 2 years ago |

See Also: → [fission-ipc-map](/show_bug.cgi?id=1491018 "NEW - Create Authoritative 'This Origin to this Content Process' Infrastructure")

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1783504#a395402_406194)• 2 years ago |

Status: UNCONFIRMED → NEWEver confirmed: trueKeywords: [csectype-sandbox-escape](/buglist.cgi?keywords=csectype-sandbox-escape&resolution=---)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=1783504#c5)• 2 years ago |
|  | |

It's not quite a sandbox escape yet, but there might be some front-end code that would grant additional privileges to a chrome or about URL. Otherwise, you can definitely use this for spoofing and violating same-origin, which is sec-moderate if it requires a compromised process to get there.

Keywords: [csectype-sandbox-escape](/buglist.cgi?keywords=csectype-sandbox-escape&resolution=---) → [csectype-sop](/buglist.cgi?keywords=csectype-sop&resolution=---),
[csectype-spoof](/buglist.cgi?keywords=csectype-spoof&resolution=---),
[sec-moderate](/buglist.cgi?keywords=sec-moderate&resolution=---)

|  | [BugBot [:suhaib / :marco/ :calixte]](/user_profile?user_id=575867) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=1783504#c6)• 2 years ago |
|  | |

The severity field is not set for this bug.

:edenchuang, could you have a look please?

For more information, please visit [auto\_nag documentation](https://wiki.mozilla.org/Release_Management/autonag#workflow.2Fno_severity.py).

Flags: needinfo?(echuang)

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=1783504#c7)• 2 years ago |
|  | |

I think we should fix this at some point and not just let it linger. It sounds like there's a reasonable path forward here to at least get some protection.

Severity: -- → S2Flags: needinfo?(echuang)

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=1783504#c8)• 2 years ago |
|  | |

Jens, could you maybe find somebody to work on this? I'm not who exactly is responsible for WindowGlobalParent stuff at this point. Nika laid out a plan of attack in [comment 4](/show_bug.cgi?id=1783504#c4 "RESOLVED FIXED - Compromised content process can UpdateDocumentURI"), but doesn't have time to work on it. It is a little open ended, but it feels like a reasonably scoped project. Thanks.

Flags: needinfo?(jstutte)

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=1783504#c9)• 2 years ago |
|  | |

In addition to documentURI, we probably want to tweak isInitialDocument.

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=1783504#c10)• 2 years ago • [Edited](/page.cgi?id=comment-revisions.html&bug_id=1783504&comment_id=16085841 "1 revision") |
|  | |

Taking this, although I may not be the one working on this (but rather helping someone else to fix this).

Assignee: nobody → smaug

|  | [Jens Stutte [:jstutte]](/user_profile?user_id=646284) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1783504#a5195618_646284)• 2 years ago |

Flags: needinfo?(jstutte)

|  | [Artur Iunusov](/user_profile?user_id=712685)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1783504#a5787605_712685)• 2 years ago |

Assignee: smaug → aiunusov

|  | [Artur Iunusov](/user_profile?user_id=712685)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1783504#a5787636_712685)• 2 years ago |

Status: NEW → ASSIGNED

|  | [Artur Iunusov](/user_profile?user_id=712685)  Assignee |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=1783504#c11)• 2 years ago |
|  | |

Attached file
[Bug 1783504 - tweak when UpdateDocumentURI can be set, r=smaug](attachment.cgi?id=9298539)
— [Details](attachment.cgi?id=9298539&action=edit)

|  | [Artur Iunusov](/user_profile?user_id=712685)  Assignee |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=1783504#c12)• 2 years ago |
|  | |

Attached file
[WIP: Bug 1783504 - FIX Compromised content process can UpdateDocumentURI, r=smaug!](attachment.cgi?id=9299267) (obsolete)
— [Details](attachment.cgi?id=9299267&action=edit)

Differencial Revision: <https://phabricator.services.mozilla.com/D159340>

|  | [Phabricator Automation](/user_profile?user_id=600971) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1783504#a7457254_600971)• 2 years ago |

[Attachment #9298539](/attachment.cgi?id=9298539&action=edit "Bug 1783504 - tweak when UpdateDocumentURI can be set, r=smaug") -
Attachment description: WIP: Bug 1783504 - FIX Compromised content process can UpdateDocumentURI, r=smaug! → Bug 1783504 - FIX Compromised content process can UpdateDocumentURI, r=smaug!

|  | [Phabricator Automation](/user_profile?user_id=600971) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1783504#a7605465_600971)• 2 years ago |

[Attachment #9299267](/attachment.cgi?id=9299267&action=edit "WIP: Bug 1783504 - FIX Compromised content process can UpdateDocumentURI, r=smaug!") -
Attachment is obsolete: true

|  | [Phabricator Automation](/user_profile?user_id=600971) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1783504#a8313083_600971)• 2 years ago |

[Attachment #9298539](/attachment.cgi?id=9298539&action=edit "Bug 1783504 - tweak when UpdateDocumentURI can be set, r=smaug") -
Attachment description: Bug 1783504 - FIX Compromised content process can UpdateDocumentURI, r=smaug! → WIP: Bug 1783504 - FIX Compromised content process can UpdateDocumentURI,

|  | [Phabricator Automation](/user_profile?user_id=600971) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1783504#a8315540_600971)• 2 years ago |

[Attachment #9298539](/attachment.cgi?id=9298539&action=edit "Bug 1783504 - tweak when UpdateDocumentURI can be set, r=smaug") -
Attachment description: WIP: Bug 1783504 - FIX Compromised content process can UpdateDocumentURI, → Bug 1783504 - FIX Compromised content process can UpdateDocumentURI,

|  | [Phabricator Automation](/user_profile?user_id=600971) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1783504#a8316065_600971)• 2 years ago |

[Attachment #9298539](/attachment.cgi?id=9298539&action=edit "Bug 1783504 - tweak when UpdateDocumentURI can be set, r=smaug") -
Attachment description: Bug 1783504 - FIX Compromised content process can UpdateDocumentURI, → WIP: Bug 1783504 - FIX Compromised content process can UpdateDocumentURI,

|  | [Phabricator Automation](/user_profile?user_id=600971) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1783504#a8331037_600971)• 2 years ago |

[Attachment #9298539](/attachment.cgi?id=9298539&action=edit "Bug 1783504 - tweak when UpdateDocumentURI can be set, r=smaug") -
Attachment description: WIP: Bug 1783504 - FIX Compromised content process can UpdateDocumentURI, → Bug 1783504 - FIX Compromised content process can UpdateDocumentURI, r=smaug!

|  | [Phabricator Automation](/user_profile?user_id=600971) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1783504#a8409301_600971)• 2 years ago |

[Attachment #9298539](/attachment.cgi?id=9298539&action=edit "Bug 1783504 - tweak when UpdateDocumentURI can be set, r=smaug") -
Attachment description: Bug 1783504 - FIX Compromised content process can UpdateDocumentURI, r=smaug! → WIP: Bug 1783504 - FIX Compromised content process can UpdateDocumentURI, r=smaug!

|  | [Phabricator Automation](/user_profile?user_id=600971) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1783504#a8662140_600971)• 2 years ago |

[Attachment #9298539](/attachment.cgi?id=9298539&action=edit "Bug 1783504 - tweak when UpdateDocumentURI can be set, r=smaug") -
Attachment description: WIP: Bug 1783504 - FIX Compromised content process can UpdateDocumentURI, r=smaug! → Bug 1783504 - FIX Compromised content process can UpdateDocumentURI, r=smaug!

|  | [Artur Iunusov](/user_profile?user_id=712685)  Assignee |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=1783504#c13)• 2 years ago |
|  | |

Attached file
[WIP: Bug 1783504 - FIX Compromised content process can UpdateDocumentURI, r=smaug!](attachment.cgi?id=9303480) (obsolete)
— [Details](attachment.cgi?id=9303480&action=edit)

|  | [Phabricator Automation](/user_profile?user_id=600971) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1783504#a8739328_600971)• 2 years ago |

[Attachment #9303480](/attachment.cgi?id=9303480&action=edit "WIP: Bug 1783504 - FIX Compromised content process can UpdateDocumentURI, r=smaug!") -
Attachment is obsolete: true

|  | [Phabricator Automation](/user_profile?user_id=600971) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1783504#a8739404_600971)• 2 years ago |

[Attachment #9298539](/attachment.cgi?id=9298539&action=edit "Bug 1783504 - tweak when UpdateDocumentURI can be set, r=smaug") -
Attachment description: Bug 1783504 - FIX Compromised content process can UpdateDocumentURI, r=smaug! → WIP: Bug 1783504 - FIX Compromised content process can UpdateDocumentURI, r=smaug!

|  | [Phabricator Automation](/user_profile?user_id=600971) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1783504#a10129166_600971)• 2 years ago |

[Attachment #9298539](/attachment.cgi?id=9298539&action=edit "Bug 1783504 - tweak when UpdateDocumentURI can be set, r=smaug") -
Attachment description: WIP: Bug 1783504 - FIX Compromised content process can UpdateDocumentURI, r=smaug! → Bug 1783504 - FIX Compromised content process can UpdateDocumentURI, r=smaug!

|  | [Phabricator Automation](/user_profile?user_id=600971) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1783504#a10591985_600971)• 2 years ago |

[Attachment #9298539](/attachment.cgi?id=9298539&action=edit "Bug 1783504 - tweak when UpdateDocumentURI can be set, r=smaug") -
Attachment description: Bug 1783504 - FIX Compromised content process can UpdateDocumentURI, r=smaug! → WIP: Bug 1783504 - FIX Compromised content process can UpdateDocumentURI, r=smaug!

|  | [Phabricator Automation](/user_profile?user_id=600971) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1783504#a10594944_600971)• 2 years ago |

[Attachment #9298539](/attachment.cgi?id=9298539&action=edit "Bug 1783504 - tweak when UpdateDocumentURI can be set, r=smaug") -
Attachment description: WIP: Bug 1783504 - FIX Compromised content process can UpdateDocumentURI, r=smaug! → Bug 1783504 - FIX Compromised content process can UpdateDocumentURI, r=smaug!

|  | [Phabricator Automation](/user_profile?user_id=600971) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1783504#a10628575_600971)• 2 years ago |

[Attachment #9298539](/attachment.cgi?id=9298539&action=edit "Bug 1783504 - tweak when UpdateDocumentURI can be set, r=smaug") -
Attachment description: Bug 1783504 - FIX Compromised content process can UpdateDocumentURI, r=smaug! → WIP: Bug 1783504 - FIX Compromised content process can UpdateDocumentURI, r=smaug!

|  | [Phabricator Automation](/user_profile?user_id=600971) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1783504#a10679141_600971)• 2 years ago |

[Attachment #9298539](/attachment.cgi?id=9298539&action=edit "Bug 1783504 - tweak when UpdateDocumentURI can be set, r=smaug") -
Attachment description: WIP: Bug 1783504 - FIX Compromised content process can UpdateDocumentURI, r=smaug! → Bug 1783504 - FIX Compromised content process can UpdateDocumentURI, r=smaug!

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1783504#a10730818_39966)• 2 years ago |

Depends on: [1804684](/show_bug.cgi?id=1804684 "RESOLVED FIXED - Fragment navigation may change document URI scheme from https to http")

|  | [Phabricator Automation](/user_profile?user_id=600971) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1783504#a11064935_600971)• 2 years ago |

[Attachment #9298539](/attachment.cgi?id=9298539&action=edit "Bug 1783504 - tweak when UpdateDocumentURI can be set, r=smaug") -
Attachment description: Bug 1783504 - FIX Compromised content process can UpdateDocumentURI, r=smaug! → WIP: Bug 1783504 - FIX Compromised content process can UpdateDocumentURI, r=smaug!

|  | [Phabricator Automation](/user_profile?user_id=600971) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1783504#a23505607_600971)• 2 years ago |

[Attachment #9298539](/attachment.cgi?id=9298539&action=edit "Bug 1783504 - tweak when UpdateDocumentURI can be set, r=smaug") -
Attachment description: WIP: Bug 1783504 - FIX Compromised content process can UpdateDocumentURI, r=smaug! → Bug 1783504 - FIX Compromised content process can UpdateDocumentURI, r=smaug!

|  | [Sebastian Hengst [:aryx] (needinfo me if it's about an intermittent or backout)](/user_profile?user_id=258347) |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=1783504#c14)• 2 years ago |
|  | |

FIX Compromised content process can UpdateDocumentURI, r=smaug,necko-reviewers

<https://hg.mozilla.org/integration/autoland/rev/a364609f354a7d00bd1d44c0272b21b3eeb9b177>

<https://hg.mozilla.org/mozilla-central/rev/a364609f354a>

Group: dom-core-security → core-security-releaseStatus: ASSIGNED → RESOLVEDClosed: 2 years ago
[status-firefox115](/buglist.cgi?f1=cf_status_firefox115&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox115&o1=equals&v1=fixed)Resolution: --- → FIXEDTarget Milestone: --- → 115 Branch

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1783504#a23818793_75935)• 2 years ago |

[status-firefox113](/buglist.cgi?f1=cf_status_firefox113&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox113&o1=equals&v1=wontfix)
[status-firefox114](/buglist.cgi?f1=cf_status_firefox114&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox114&o1=equals&v1=affected)
[status-firefox-esr102](/buglist.cgi?f1=cf_status_firefox_esr102&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox_esr102&o1=equals&v1=affected)
[tracking-firefox114](/buglist.cgi?f1=cf_tracking_firefox114&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox114&o1=equals&v1=%2B)
[tracking-firefox115](/buglist.cgi?f1=cf_tracking_firefox115&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox115&o1=equals&v1=%2B)
[tracking-firefox-esr102](/buglist.cgi?f1=cf_tracking_firefox_esr102&o1=isnotempty):
--- → [114+](/buglist.cgi?f1=cf_tracking_firefox_esr102&o1=equals&v1=114%2B)

|  | [BugBot [:suhaib / :marco/ :calixte]](/user_profile?user_id=575867) |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=1783504#c15)• 2 years ago |
|  | |

The patch landed in nightly and beta is affected.

:aiunusov, is this bug important enough to require an uplift?

* If yes, please nominate the patch for beta approval.
* If no, please set `status-firefox114` to `wontfix`.

For more information, please visit [BugBot documentation](https://wiki.mozilla.org/BugBot#uplift_beta.py).

Flags: needinfo?(aiunusov)

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1783504#a23948128_406194)• 2 years ago |

Regressions: [1832321](/show_bug.cgi?id=1832321 "RESOLVED FIXED - Crash in [@ IPCError-content | RecvUpdateDocumentURI Setting DocumentURI with a different Origin than principal URI]")

|  | [Sebastian Hengst [:aryx] (needinfo me if it's about an intermittent or backout)](/user_profile?user_id=258347) |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=1783504#c16)• 2 years ago |
|  | |

Backed out on request from Artur for causing frequent crashes ([bug 1832321](/show_bug.cgi?id=1832321 "RESOLVED FIXED - Crash in [@ IPCError-content | RecvUpdateDocumentURI Setting DocumentURI with a different Origin than principal URI]")):

<https://hg.mozilla.org/mozilla-central/rev/045b0358990bc474903d8c11101271faeec8482c>

Status: RESOLVED → REOPENED
[status-firefox115](/buglist.cgi?f1=cf_status_firefox115&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox115&o1=equals&v1=fixed) → [affected](/buglist.cgi?f1=cf_status_firefox115&o1=equals&v1=affected)Resolution: FIXED → ---Target Milestone: 115 Branch → ---

|  | [Artur Iunusov](/user_profile?user_id=712685)  Assignee |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=1783504#c17)• 2 years ago |
|  | |

Backed out. No need to nominate for beta

Flags: needinfo?(aiunusov)

|  | [Artur Iunusov](/user_profile?user_id=712685)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1783504#a25237598_712685)• 2 years ago |

[status-firefox-esr102](/buglist.cgi?f1=cf_status_firefox_esr102&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox_esr102&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox_esr102&o1=equals&v1=wontfix)

|  | [Artur Iunusov](/user_profile?user_id=712685)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1783504#a25238017_712685)• 2 years ago |

[status-firefox-esr102](/buglist.cgi?f1=cf_status_firefox_esr102&o1=isnotempty):
[wontfix](/buglist.cgi?f1=cf_status_firefox_esr102&o1=equals&v1=wontfix) → [affected](/buglist.cgi?f1=cf_status_firefox_esr102&o1=equals&v1=affected)
[tracking-firefox-esr102](/buglist.cgi?f1=cf_tracking_firefox_esr102&o1=isnotempty):
[114+](/buglist.cgi?f1=cf_tracking_firefox_esr102&o1=equals&v1=114%2B) → ---

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1783504#a25240787_75935)• 2 years ago |

[status-firefox114](/buglist.cgi?f1=cf_status_firefox114&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox114&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox114&o1=equals&v1=wontfix)
[tracking-firefox114](/buglist.cgi?f1=cf_tracking_firefox114&o1=isnotempty):
[+](/buglist.cgi?f1=cf_tracking_firefox114&o1=equals&v1=%2B) → ---

|  | [Artur Iunusov](/user_profile?user_id=712685)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1783504#a25927048_712685)• 2 years ago |

[status-firefox115](/buglist.cgi?f1=cf_status_firefox115&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox115&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox115&o1=equals&v1=wontfix)

|  | [BugBot [:suhaib / :marco/ :calixte]](/user_profile?user_id=575867) |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=1783504#c18)• 2 years ago |
|  | |

There is an r+ patch which didn't land and no activity in this bug for 2 weeks.

:aiunusov, could you have a look please?

If you still have some work to do, you can add an action "Plan Changes" in Phabricator.

For more information, please visit [BugBot documentation](https://wiki.mozilla.org/BugBot#not_landed.py).

Flags: needinfo?(smaug)Flags: needinfo?(aiunusov)

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1783504#a27400873_39966)• 2 years ago |

Flags: needinfo?(smaug)

|  | [Artur Iunusov](/user_profile?user_id=712685)  Assignee |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=1783504#c19)• 2 years ago |
|  | |

Sure. Thanks!

Flags: needinfo?(aiunusov)

|  | [Phabricator Automation](/user_profile?user_id=600971) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1783504#a29301276_600971)• 2 years ago |

[Attachment #9298539](/attachment.cgi?id=9298539&action=edit "Bug 1783504 - tweak when UpdateDocumentURI can be set, r=smaug") -
Attachment description: Bug 1783504 - FIX Compromised content process can UpdateDocumentURI, r=smaug! → Bug 1783504 - Add scheme logging to investigate a crash, r=smaug!

|  | [Pulsebot](/user_profile?user_id=510726) |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=1783504#c20)• 1 years ago |
|  | |

Pushed by opettay@mozilla.com:
<https://hg.mozilla.org/integration/autoland/rev/29c24651d5f3>
Add scheme logging to investigate a crash, r=smaug,necko-reviewers

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1783504#a29911607_39966)• 1 years ago |

Keywords: [leave-open](/buglist.cgi?keywords=leave-open&resolution=---)

|  | [Sebastian Hengst [:aryx] (needinfo me if it's about an intermittent or backout)](/user_profile?user_id=258347) |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=1783504#c21)• 1 years ago • [Edited](/page.cgi?id=comment-revisions.html&bug_id=1783504&comment_id=16501463 "1 revision") |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/29c24651d5f3>

|  | [Pulsebot](/user_profile?user_id=510726) |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=1783504#c22)• 1 years ago |
|  | |

Backout by ncsoregi@mozilla.com:
<https://hg.mozilla.org/mozilla-central/rev/614d9a698c47>
Backed out changeset 29c24651d5f3 for causing Android crashes. a=backout

|  | [Artur Iunusov](/user_profile?user_id=712685)  Assignee |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=1783504#c23)• 1 years ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/614d9a698c47037b40ce12a685db6bb2eba75442>

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1783504#a30035525_75935)• 1 years ago |

[status-firefox116](/buglist.cgi?f1=cf_status_firefox116&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox116&o1=equals&v1=wontfix)
[status-firefox117](/buglist.cgi?f1=cf_status_firefox117&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox117&o1=equals&v1=affected)
[status-firefox-esr102](/buglist.cgi?f1=cf_status_firefox_esr102&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox_esr102&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox_esr102&o1=equals&v1=wontfix)
[status-firefox-esr115](/buglist.cgi?f1=cf_status_firefox_esr115&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox_esr115&o1=equals&v1=affected)

|  | [Young Min Kim](/user_profile?user_id=694094)  Reporter |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=1783504#c24)• 1 years ago |
|  | |

Please note this issue will be published and presented in the upcoming USENIX Security on Friday, Auguest 11. Only the `MessageSender.url` part will be mentioned and neither PoC nor the detail will be made public.

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1783504#a31728380_1689)• 1 years ago |

Whiteboard: [reporter-external] [client-bounty-form] [verif?] → [disclosure 11 Aug 2023][reporter-external] [client-bounty-form] [verif?]

|  | [Phabricator Automation](/user_profile?user_id=600971) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1783504#a32331510_600971)• 1 year ago |

[Attachment #9298539](/attachment.cgi?id=9298539&action=edit "Bug 1783504 - tweak when UpdateDocumentURI can be set, r=smaug") -
Attachment description: Bug 1783504 - Add scheme logging to investigate a crash, r=smaug! → Bug 1783504 - Move security check to the content process, r=smaug!

|  | [Pulsebot](/user_profile?user_id=510726) |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=1783504#c25)• 1 year ago |
|  | |

Pushed by opettay@mozilla.com:
<https://hg.mozilla.org/integration/autoland/rev/81a597c0aa27>
Move security check to the content process, r=smaug

|  | [Sebastian Hengst [:aryx] (needinfo me if it's about an intermittent or backout)](/user_profile?user_id=258347) |  |
| --- | --- | --- |
| [Comment 26](/show_bug.cgi?id=1783504#c26)• 1 year ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/81a597c0aa27>

|  | [Sebastian Hengst [:aryx] (needinfo me if it's about an intermittent or backout)](/user_profile?user_id=258347) |  |
| --- | --- | --- |
| [Comment 27](/show_bug.cgi?id=1783504#c27)• 1 year ago |
|  | |

Backed out previous changeset on request from aiunusov because a sufficient amount of crash reports has been collected:

<https://hg.mozilla.org/integration/autoland/rev/62357f3d85016b6d944d6da24d20f3a579efc623>

|  | [Jens Stutte [:jstutte]](/user_profile?user_id=646284) |  |
| --- | --- | --- |
| [Comment 28](/show_bug.cgi?id=1783504#c28)• 1 year ago |
|  | |

Interesting, in all the collected [Fenix crashes](https://crash-stats.mozilla.org/report/index/3a54deba-605f-4a3c-b16b-442d70230907) we come through [if (!mozilla::SessionHistoryInParent())](https://hg.mozilla.org/mozilla-central/annotate/f44a8ec033b8c6cc0cbef5480d7f73d85612c475/docshell/base/nsDocShell.cpp#l787) after a `GoBack`. That would explain why it does not happen elsewhere, IIUC SHIP is active everywhere except for Android?

Flags: needinfo?(smaug)

|  | [Sebastian Hengst [:aryx] (needinfo me if it's about an intermittent or backout)](/user_profile?user_id=258347) |  |
| --- | --- | --- |
| [Comment 29](/show_bug.cgi?id=1783504#c29)• 1 year ago |
|  | |

Backout merged to central: <https://hg.mozilla.org/mozilla-central/rev/62357f3d8501>

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966) |  |
| --- | --- | --- |
| [Comment 30](/show_bug.cgi?id=1783504#c30)• 1 year ago |
|  | |

The problem is likely again in https-only mode

Flags: needinfo?(smaug)

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1783504#a34661261_406194)• 1 year ago |

Regressions: [1852227](/show_bug.cgi?id=1852227 "RESOLVED WORKSFORME - Crash in [@ mozilla::dom::WindowGlobalChild::SetDocumentURI]")

|  | [Phabricator Automation](/user_profile?user_id=600971) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1783504#a37169263_600971)• 1 year ago |

[Attachment #9298539](/attachment.cgi?id=9298539&action=edit "Bug 1783504 - tweak when UpdateDocumentURI can be set, r=smaug") -
Attachment description: Bug 1783504 - Move security check to the content process, r=smaug! → Bug 1783504 - SameDocumentNavigation: add additional Origin check, r=smaug

|  | [Phabricator Automation](/user_profile?user_id=600971) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1783504#a37861130_600971)• 1 year ago |

[Attachment #9298539](/attachment.cgi?id=9298539&action=edit "Bug 1783504 - tweak when UpdateDocumentURI can be set, r=smaug") -
Attachment description: Bug 1783504 - SameDocumentNavigation: add additional Origin check, r=smaug → WIP: Bug 1783504 - Fix Compromised content process can UpdateDocumentURI, r=smaug

|  | [Phabricator Automation](/user_profile?user_id=600971) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1783504#a38376949_600971)• 1 year ago |

[Attachment #9298539](/attachment.cgi?id=9298539&action=edit "Bug 1783504 - tweak when UpdateDocumentURI can be set, r=smaug") -
Attachment description: WIP: Bug 1783504 - Fix Compromised content process can UpdateDocumentURI, r=smaug → Bug 1783504 - Fix Compromised content process can UpdateDocumentURI, r=smaug

|  | [Phabricator Automation](/user_profile?user_id=600971) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1783504#a39682422_600971)• 1 year ago |

[Attachment #9298539](/attachment.cgi?id=9298539&action=edit "Bug 1783504 - tweak when UpdateDocumentURI can be set, r=smaug") -
Attachment description: Bug 1783504 - Fix Compromised content process can UpdateDocumentURI, r=smaug → WIP: Bug 1783504 - Fix Compromised content process can UpdateDocumentURI, r=smaug

|  | [Phabricator Automation](/user_profile?user_id=600971) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1783504#a39683751_600971)• 1 year ago |

[Attachment #9298539](/attachment.cgi?id=9298539&action=edit "Bug 1783504 - tweak when UpdateDocumentURI can be set, r=smaug") -
Attachment description: WIP: Bug 1783504 - Fix Compromised content process can UpdateDocumentURI, r=smaug → Bug 1783504 - Fix Compromised content process can UpdateDocumentURI, r=smaug

|  | [Phabricator Automation](/user_profile?user_id=600971) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1783504#a40128066_600971)• 1 year ago |

[Attachment #9298539](/attachment.cgi?id=9298539&action=edit "Bug 1783504 - tweak when UpdateDocumentURI can be set, r=smaug") -
Attachment description: Bug 1783504 - Fix Compromised content process can UpdateDocumentURI, r=smaug → Bug 1783504 - tweak when UpdateDocumentURI can be set, r=smaug

|  | [Pulsebot](/user_profile?user_id=510726) |  |
| --- | --- | --- |
| [Comment 31](/show_bug.cgi?id=1783504#c31)• 1 year ago |
|  | |

Pushed by opettay@mozilla.com:
<https://hg.mozilla.org/integration/autoland/rev/724cb235ebec>
tweak when UpdateDocumentURI can be set, r=smaug

|  | [Sebastian Hengst [:aryx] (needinfo me if it's about an intermittent or backout)](/user_profile?user_id=258347) |  |
| --- | --- | --- |
| [Comment 32](/show_bug.cgi?id=1783504#c32)• 1 year ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/724cb235ebec>

Is there anything left to be done here or can this bug be closed?

Flags: needinfo?(aiunusov)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1783504#a40188330_75935)• 1 year ago |

Flags: needinfo?(smaug)

|  | [Artur Iunusov](/user_profile?user_id=712685)  Assignee |  |
| --- | --- | --- |
| [Comment 33](/show_bug.cgi?id=1783504#c33)• 1 year ago |
|  | |

We need to monitor <https://crash-stats.mozilla.org> for the possible crashes, at least, for one week.

If this patch will not be backed out afterwards - we can close it

Flags: needinfo?(aiunusov)

|  | [Jens Stutte [:jstutte]](/user_profile?user_id=646284) |  |
| --- | --- | --- |
| [Comment 34](/show_bug.cgi?id=1783504#c34)• 1 year ago • [Edited](/page.cgi?id=comment-revisions.html&bug_id=1783504&comment_id=16668574 "3 revisions") |
|  | |

Trying to capture a thought we had when talking Artur and I:

The crashes we see (again) have `HandleSameDocumentNavigation` on their stack by chance, as there seem to be an expensive synchronous execution. In fact, `SendDocumentURI` is asynchronous and we cannot be 100% sure that the `RecvDocumentURI` that caused the dump corresponds to the `SendDocumentURI` inside this `HandleSameDocumentNavigation` call - it might just have been an earlier invocation of `SendDocumentURI` that might have come from different code paths. There is a time window between sending the IPC message on the child side, elaborating it on the parent side and then requesting a dump from the client that could be arbitrarily long, such that we end up scheduling a second `SendDocumentURI` in the meantime. It might be worth looking out for any `SetDocumentURI` invocation on the child side, especially if coming from Java code.

|  | [Sandor Molnar[:smolnar]](/user_profile?user_id=670045) |  |
| --- | --- | --- |
| [Comment 35](/show_bug.cgi?id=1783504#c35)• 1 year ago |
|  | |

Backed out for crashes on crash stats on Android Nightly

Backout link: <https://hg.mozilla.org/integration/autoland/rev/571c293cedd28db6ac86fd553e2810f40e382e80>

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1783504#a40277088_75935)• 1 year ago |

[status-firefox117](/buglist.cgi?f1=cf_status_firefox117&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox117&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox117&o1=equals&v1=wontfix)
[status-firefox119](/buglist.cgi?f1=cf_status_firefox119&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox119&o1=equals&v1=wontfix)
[status-firefox120](/buglist.cgi?f1=cf_status_firefox120&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox120&o1=equals&v1=wontfix)
[status-firefox121](/buglist.cgi?f1=cf_status_firefox121&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox121&o1=equals&v1=affected)

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966) |  |
| --- | --- | --- |
| [Comment 36](/show_bug.cgi?id=1783504#c36)• 1 year ago |
|  | |

SetDocumentURI coming from client side from java code? Can't figure out what that might mean.

Flags: needinfo?(smaug)

|  | [Sandor Molnar[:smolnar]](/user_profile?user_id=670045) |  |
| --- | --- | --- |
| [Comment 37](/show_bug.cgi?id=1783504#c37)• 1 year ago |
|  | |

backout merge to central: <https://hg.mozilla.org/mozilla-central/rev/571c293cedd2>

|  | [Jens Stutte [:jstutte]](/user_profile?user_id=646284) |  |
| --- | --- | --- |
| [Comment 38](/show_bug.cgi?id=1783504#c38)• 1 year ago |
|  | |

(In reply to Olli Pettay [:smaug][bugs@pettay.fi] from [comment #36](/show_bug.cgi?id=1783504#c36 "RESOLVED FIXED - Compromised content process can UpdateDocumentURI"))

> SetDocumentURI coming from client side from java code? Can't figure out what that might mean.

That I don't know, but I just wanted to point out that we might not come through the code path we think we are coming through on the child side, at least in theory.

|  | [Pulsebot](/user_profile?user_id=510726) |  |
| --- | --- | --- |
| [Comment 39](/show_bug.cgi?id=1783504#c39)• 1 year ago |
|  | |

Pushed by opettay@mozilla.com:
<https://hg.mozilla.org/integration/autoland/rev/16c2fd641193>
tweak when UpdateDocumentURI can be set, r=smaug

|  | [Sebastian Hengst [:aryx] (needinfo me if it's about an intermittent or backout)](/user_profile?user_id=258347) |  |
| --- | --- | --- |
| [Comment 40](/show_bug.cgi?id=1783504#c40)• 1 year ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/16c2fd641193>

|  | [Artur Iunusov](/user_profile?user_id=712685)  Assignee |  |
| --- | --- | --- |
| [Comment 41](/show_bug.cgi?id=1783504#c41)• 1 year ago |
|  | |

no crashes during this week so far: <https://crash-stats.mozilla.org/signature/?signature=IPCError-content%20%7C%20RecvUpdateDocumentURI%20Setting%20DocumentURI%20with%20a%20different%20Origin%20than%20principal%20URI&date=%3E%3D2023-11-17T17%3A21%3A00.000Z&date=%3C2023-11-24T17%3A21%3A00.000Z&_columns=date&_columns=product&_columns=version&_columns=build_id&_columns=platform&_columns=reason&_columns=address&_columns=install_time&_columns=startup_crash&_sort=-date&page=1#reports>

I guess we can wait for another week, and then close the bug

|  | [Artur Iunusov](/user_profile?user_id=712685)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1783504#a41310566_712685)• 1 year ago |

Status: REOPENED → RESOLVEDClosed: 2 years ago → 1 year agoResolution: --- → FIXED

|  | [BugBot (nomail) [:suhaib / :marco/ :calixte]](/user_profile?user_id=710528) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1783504#a41312726_710528)• 1 year ago |

Keywords: [leave-open](/buglist.cgi?keywords=leave-open&resolution=---)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1783504#a41313743_75935)• 1 year ago |

[status-firefox122](/buglist.cgi?f1=cf_status_firefox122&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox122&o1=equals&v1=fixed)
[tracking-firefox121](/buglist.cgi?f1=cf_tracking_firefox121&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox121&o1=equals&v1=%2B)
[tracking-firefox122](/buglist.cgi?f1=cf_tracking_firefox122&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox122&o1=equals&v1=%2B)
[tracking-firefox-esr115](/buglist.cgi?f1=cf_tracking_firefox_esr115&o1=isnotempty):
--- → [121+](/buglist.cgi?f1=cf_tracking_firefox_esr115&o1=equals&v1=121%2B)Target Milestone: --- → 122 Branch

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1783504#a41420530_1689)• 1 year ago |

Flags: sec-bounty? → sec-bounty+

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 42](/show_bug.cgi?id=1783504#c42)• 1 year ago |
|  | |

What are your thoughts on backports here? It grafts cleanly to both Beta but needs a bit of rebasing for ESR115. But I'm also wondering how much bake time you think we need?

Flags: needinfo?(aiunusov)

|  | [Artur Iunusov](/user_profile?user_id=712685)  Assignee |  |
| --- | --- | --- |
| [Comment 43](/show_bug.cgi?id=1783504#c43)• 1 year ago |
|  | |

We need to test this patch at least until next soft freeze

I would target a Beta at this moment

Flags: needinfo?(aiunusov)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 44](/show_bug.cgi?id=1783504#c44)• 1 year ago |
|  | |

Alright, let's let this ride Fx122 then and we can revisit the ESR backport next cycle.

[status-firefox121](/buglist.cgi?f1=cf_status_firefox121&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox121&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox121&o1=equals&v1=wontfix)
[tracking-firefox121](/buglist.cgi?f1=cf_tracking_firefox121&o1=isnotempty):
[+](/buglist.cgi?f1=cf_tracking_firefox121&o1=equals&v1=%2B) → [-](/buglist.cgi?f1=cf_tracking_firefox121&o1=equals&v1=-)
[tracking-firefox-esr115](/buglist.cgi?f1=cf_tracking_firefox_esr115&o1=isnotempty):
[121+](/buglist.cgi?f1=cf_tracking_firefox_esr115&o1=equals&v1=121%2B) → [122+](/buglist.cgi?f1=cf_tracking_firefox_esr115&o1=equals&v1=122%2B)

|  | [Artur Iunusov](/user_profile?user_id=712685)  Assignee |  |
| --- | --- | --- |
| [Comment 45](/show_bug.cgi?id=1783504#c45)• 1 year ago |
|  | |

Sounds good

|  | [Artur Iunusov](/user_profile?user_id=712685)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1783504#a42010326_712685)• 1 year ago |

Blocks: [1868387](/show_bug.cgi?id=1868387 "RESOLVED FIXED - Make a pref, that enables origin security check for SetDocumentURI() method")

|  | [Mihai Boldan, Desktop QA [:mboldan]](/user_profile?user_id=551058) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1783504#a43221311_551058)• 1 year ago |

Flags: qe-verify+

|  | [Artur Iunusov](/user_profile?user_id=712685)  Assignee |  |
| --- | --- | --- |
| [Comment 46](/show_bug.cgi?id=1783504#c46)• 1 year ago • [Edited](/page.cgi?id=comment-revisions.html&bug_id=1783504&comment_id=16722230 "3 revisions") |
|  | |

If we are going to merge it to esr 115, then I must to prepare this patch and <https://bugzilla.mozilla.org/show_bug.cgi?id=1868387>

In order to have a pref (to disable the whole feature in case of an incident)

Links to monitor crashes:

<https://crash-stats.mozilla.org/search/?signature=~SetDocumentURI&date=%3E%3D2023-12-14T13%3A01%3A00.000Z&date=%3C2023-12-21T13%3A01%3A00.000Z&_facets=signature&_sort=-date&_columns=date&_columns=signature&_columns=product&_columns=version&_columns=build_id&_columns=platform#facet-signature>

<https://crash-stats.mozilla.org/search/?signature=~RecvUpdateDocumentURI&date=%3E%3D2023-12-14T12%3A57%3A00.000Z&date=%3C2023-12-21T12%3A57%3A00.000Z&_facets=signature&_sort=-date&_columns=date&_columns=signature&_columns=product&_columns=version&_columns=build_id&_columns=platform#facet-signature>

(so far, amount is quite low)

|  | [Andrei Vaida [:avaida]](/user_profile?user_id=488993) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1783504#a43456206_488993)• 1 year ago |

QA Whiteboard: [post-critsmash-triage]

|  | [Artur Iunusov](/user_profile?user_id=712685)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1783504#a44607441_712685)• 1 year ago |

Blocks: [1873052](/show_bug.cgi?id=1873052 "RESOLVED FIXED - Make pref dom.security.setdocumenturi enabled on early beta and earlier")

|  | [Artur Iunusov](/user_profile?user_id=712685)  Assignee |  |
| --- | --- | --- |
| [Comment 47](/show_bug.cgi?id=1783504#c47)• 1 year ago • [Edited](/page.cgi?id=comment-revisions.html&bug_id=1783504&comment_id=16737562 "4 revisions") |
|  | |

These patches requires uplift (if they not in the release already):

<https://phabricator.services.mozilla.com/D159340>

<https://phabricator.services.mozilla.com/D196290>

<https://phabricator.services.mozilla.com/D195554>

<https://phabricator.services.mozilla.com/D197698>

(sounds like I have no enough rights to create Uplift form)

|  | [Artur Iunusov](/user_profile?user_id=712685)  Assignee |  |
| --- | --- | --- |
| [Comment 48](/show_bug.cgi?id=1783504#c48)• 1 year ago |
|  | |

Just want to make sure, that all the patches mentioned above will go to release before soft freeze.

But I have no rights for doing uplift.

could you, please, guide me, how to proceed in that case?

Flags: needinfo?(ryanvm)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 49](/show_bug.cgi?id=1783504#c49)• 1 year ago |
|  | |

All of those are on track to ride 122 to Release. If you want to nominate them for ESR approval also, you can do so by setting the `approval-mozilla-esr115` dropdown to `?` on the Details link for each attachment and fill out the form. That said, the urgency probably isn't very high there since [bug 1873052](/show_bug.cgi?id=1873052 "RESOLVED FIXED - Make pref dom.security.setdocumenturi enabled on early beta and earlier") would disable the behavior anyway.

Flags: needinfo?(ryanvm)

|  | [Artur Iunusov](/user_profile?user_id=712685)  Assignee |  |
| --- | --- | --- |
| [Comment 50](/show_bug.cgi?id=1783504#c50)• 1 year ago |
|  | |

all clear, then. Thanks!

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1783504#a44703018_75935)• 1 year ago |

[status-firefox-esr115](/buglist.cgi?f1=cf_status_firefox_esr115&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox_esr115&o1=equals&v1=affected) → [fix-optional](/buglist.cgi?f1=cf_status_firefox_esr115&o1=equals&v1=fix-optional)
[tracking-firefox-esr115](/buglist.cgi?f1=cf_tracking_firefox_esr115&o1=isnotempty):
[122+](/buglist.cgi?f1=cf_tracking_firefox_esr115&o1=equals&v1=122%2B) → ---

|  | [Daniel Bodea [:danibodea]](/user_profile?user_id=616104) |  |
| --- | --- | --- |
| [Comment 51](/show_bug.cgi?id=1783504#c51)• 1 year ago |
|  | |

(In reply to Young Min Kim from [comment #0](/show_bug.cgi?id=1783504#c0 "RESOLVED FIXED - Compromised content process can UpdateDocumentURI"))

> ## REPRODUCTION CASE
>
> 1. Apply the attached `poc.patch`.
> 2. Create a new login for `https://example.com` in `about:logins`.
> 3. Install the attached extension.
> 4. Visit the attached `poc.html` over secure origin (an online version is available in <https://chs17f87gytb304hg6vk.glitch.me/>)
> 5. Press "Click" and check the address bar.
> 6. Check the extension message sender.
> 7. Press "getUserMedia(audio)" and check "Tabs sharing devices" menu.
> 8. 5-7 should show example.com.
> 9. Open the context menu on the Username field and select the login added in 2. Check the password field is filled.

I am unable to reproduce using the REPRODUCTION CASE in [comment 0](/show_bug.cgi?id=1783504#c0 "RESOLVED FIXED - Compromised content process can UpdateDocumentURI"). Could you help clear out the steps to reproduce so that I know how to properly reproduce and verify the fix? Questions:

1. Could a QA do the first step? How do I apply this patch? Is this not a build compilation process?
2. Regarding step 2, should I create a login for <https://example.com>? Should I not create logins for the test page's location <https://chs17f87gytb304hg6vk.glitch.me/> instead?
3. Regarding step 3, should I add the attached extension as a temporary addon?
4. Regarding step 4, I assume I should be loading the specified link (<https://chs17f87gytb304hg6vk.glitch.me/>), right?
5. Regarding step 5, what should I check about the address bar?
6. Regarding step 6, what should I check, exactly?
7. Regarding step 7, should I allow the permission that is displayed after clicking "getUserMedia(audio)"? What should I be checking about the Permissions Menu?
8. Regarding step 8, What exactly should be showing "example.com"?
9. Do I left-click the Username field to select the saved login? Or do I have to use right-click and "Use saved logins"?
10. The affected behavior is that the password is not autocompleted when selecting the username, so the fixed behavior is that the password is not being auto-filled, right?

I am sorry to ask such specific questions. I am QA and do not possess the technical level of development engineers. We (QA) need to make sure we reproduce the issue to properly verify it's fixed. Thank you!

Flags: needinfo?(aiunusov)

|  | [Jesse Schwartzentruber (:truber)](/user_profile?user_id=486733) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1783504#a45742477_486733)• 1 year ago |

Whiteboard: [disclosure 11 Aug 2023][reporter-external] [client-bounty-form] [verif?] → [disclosure 11 Aug 2023][reporter-external] [client-bounty-form] [verif?][adv-main122+]

|  | [Jesse Schwartzentruber (:truber)](/user_profile?user_id=486733) |  |
| --- | --- | --- |
| [Comment 52](/show_bug.cgi?id=1783504#c52)• 1 year ago |
|  | |

Attached file
[advisory.txt](attachment.cgi?id=9373594)
— [Details](attachment.cgi?id=9373594&action=edit)

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1783504#a45904767_578488)• 1 year ago |

Alias: CVE-2024-0748

|  | [Artur Iunusov](/user_profile?user_id=712685)  Assignee |  |
| --- | --- | --- |
| [Comment 53](/show_bug.cgi?id=1783504#c53)• 1 year ago |
|  | |

```
1 Need to patch a code. I can do this for you
2 yes, you have to go to the about:logins and create a login
3 - yes, extension is needed
4 https://chs17f87gytb304hg6vk.glitch.me - exactly that link
5 yes
6 - you should expect a tab crash
7 yes, and expect tab crash
8 tab must crash

```
Flags: needinfo?(aiunusov)

|  | [Artur Iunusov](/user_profile?user_id=712685)  Assignee |  |
| --- | --- | --- |
| [Comment 54](/show_bug.cgi?id=1783504#c54)• 1 year ago |
|  | |

I will prepare a link with the patched version for the testing soon

|  | [Artur Iunusov](/user_profile?user_id=712685)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1783504#a46233999_712685)• 1 year ago |

Regressions: [1876034](/show_bug.cgi?id=1876034 "RESOLVED FIXED - Crash [@ mozilla::dom::WindowGlobalChild::SetDocumentURI ]")

|  | [Daniel Bodea [:danibodea]](/user_profile?user_id=616104) |  |
| --- | --- | --- |
| [Comment 55](/show_bug.cgi?id=1783504#c55)• 1 year ago |
|  | |

This message serves as a reminder to address the QA requirement in order to reproduce and verify the fix. Thank you.

Flags: needinfo?(aiunusov)

|  | [Artur Iunusov](/user_profile?user_id=712685)  Assignee |  |
| --- | --- | --- |
| [Comment 56](/show_bug.cgi?id=1783504#c56)• 11 months ago • [Edited](/page.cgi?id=comment-revisions.html&bug_id=1783504&comment_id=16787961 "1 revision") |
|  | |

Prepared builds for QA:

<https://treeherder.mozilla.org/jobs?repo=try&revision=f719296de0493d23f647ff2e6372a636bfadcb28>

Writing the instruction at the moment

|  | [Daniel Bodea [:danibodea]](/user_profile?user_id=616104) |  |
| --- | --- | --- |
| [Comment 57](/show_bug.cgi?id=1783504#c57)• 11 months ago |
|  | |

The steps in [comment 0](/show_bug.cgi?id=1783504#c0 "RESOLVED FIXED - Compromised content process can UpdateDocumentURI") still don't cause a crash while using the newly created patch build. It's important to notice that the extension does not seem to work even though it loads as a temporary addon. Furthermore, I would like to know why we should consider the fix valid considering the reproduction needs a different build than the officially released ones. Should we be expecting new instructions? Thank you.

|  | [Artur Iunusov](/user_profile?user_id=712685)  Assignee |  |
| --- | --- | --- |
| [Comment 58](/show_bug.cgi?id=1783504#c58)• 11 months ago |
|  | |

We need a patched build in order to simulate a compromised content process

(I am checking that patched version at the moment)

Flags: needinfo?(aiunusov)

|  | [Artur Iunusov](/user_profile?user_id=712685)  Assignee |  |
| --- | --- | --- |
| [Comment 59](/show_bug.cgi?id=1783504#c59)• 11 months ago |
|  | |

Attached patch

[poc.patch](attachment.cgi?id=9379725&action=diff)
— [Details](attachment.cgi?id=9379725&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1783504&attachment=9379725)

Updated POC

[Attachment #9288698](/attachment.cgi?id=9288698&action=edit "poc.patch") -
Attachment is obsolete: true

|  | [Artur Iunusov](/user_profile?user_id=712685)  Assignee |  |
| --- | --- | --- |
| [Comment 60](/show_bug.cgi?id=1783504#c60)• 11 months ago • [Edited](/page.cgi?id=comment-revisions.html&bug_id=1783504&comment_id=16794388 "3 revisions") |
|  | |

Figured out. It seems that poc.patch was a bit outdated (after the recent changes in Firefox itself).

I prepared a new version of the patched builds, and tested them locally:

<https://treeherder.mozilla.org/jobs?repo=try&revision=49861ebd428cd9d9de3610c72d200b39cdc021fa>

Tab must crash in that version.

Could you please, check again?

(we cannot use the normal nightly for the testing, since we do not know yet, how to compromise the content process in a real scenario)

Flags: needinfo?(dbodea)

|  | [Artur Iunusov](/user_profile?user_id=712685)  Assignee |  |
| --- | --- | --- |
| [Comment 61](/show_bug.cgi?id=1783504#c61)• 11 months ago • [Edited](/page.cgi?id=comment-revisions.html&bug_id=1783504&comment_id=16794394 "1 revision") |
|  | |

0 Download a patched version from <https://treeherder.mozilla.org/jobs?repo=try&revision=49861ebd428cd9d9de3610c72d200b39cdc021fa>

1 Create a new login for <https://example.com> in about:logins.

2 Install the attached extension.

3 Visit the attached poc.html over secure origin (an online version is available in <https://chs17f87gytb304hg6vk.glitch.me/>)

(after a visiting poc.html or <https://chs17f87gytb304hg6vk.glitch.me/>, tab must immediately crash)

|  | [Daniel Bodea [:danibodea]](/user_profile?user_id=616104) |  |
| --- | --- | --- |
| [Comment 62](/show_bug.cgi?id=1783504#c62)• 11 months ago |
|  | |

I can reproduce this tab crash using the build and extension provided in the previous comment on Windows 10 and 11, but the creation of a login for <https://example.com/> is not necessary. The tab crashes with and without it. Is this a correct reproduction of the issue in question?

Furthermore, how should I proceed to verify this fix considering that the reproduction was made on a patched build to simulate a compromised content process? Thank you.

Flags: needinfo?(dbodea) → needinfo?(aiunusov)

|  | [Artur Iunusov](/user_profile?user_id=712685)  Assignee |  |
| --- | --- | --- |
| [Comment 63](/show_bug.cgi?id=1783504#c63)• 11 months ago • [Edited](/page.cgi?id=comment-revisions.html&bug_id=1783504&comment_id=16799829 "4 revisions") |
|  | |

I think creating a new login isn't really necessary (since the tab will crash anyway before a compromised process tries to even access it).

Regarding the second question, I think, reading POC.patch might help (which compromises a content process in a simple and dirty way) and building a version for verification on your machine:

<https://firefox-source-docs.mozilla.org/setup/windows_build.html>

<https://firefox-source-docs.mozilla.org/setup/linux_build.html>

<https://firefox-source-docs.mozilla.org/setup/macos_build.html>

(Just one extra command is required in order to patch it: hg import POC.patch)

You can also play with the new setting (dom.security.setdocumenturi). For example, disable it and perform the steps (4-9).

Flags: needinfo?(aiunusov)

|  | [Daniel Bodea [:danibodea]](/user_profile?user_id=616104) |  |
| --- | --- | --- |
| [Comment 64](/show_bug.cgi?id=1783504#c64)• 11 months ago |
|  | |

Unfortunately (as QA) we don't have the required time and resources to patch our test builds. Would you be able to patch another build for us so we can verify it? Thank you.

Flags: needinfo?(aiunusov)

|  | [Artur Iunusov](/user_profile?user_id=712685)  Assignee |  |
| --- | --- | --- |
| [Comment 65](/show_bug.cgi?id=1783504#c65)• 11 months ago • [Edited](/page.cgi?id=comment-revisions.html&bug_id=1783504&comment_id=16804147 "1 revision") |
|  | |

Sure. I can patch any revision you ask.

If you need just a patched version of today's Nightly, I will provide it soon today

Flags: needinfo?(aiunusov)

|  | [Daniel Bodea [:danibodea]](/user_profile?user_id=616104) |  |
| --- | --- | --- |
| [Comment 66](/show_bug.cgi?id=1783504#c66)• 11 months ago |
|  | |

It would be best to verify it in the latest Nightly and latest Release if it's not too much to ask. Thank you for your support!

Flags: needinfo?(aiunusov)

|  | [Artur Iunusov](/user_profile?user_id=712685)  Assignee |  |
| --- | --- | --- |
| [Comment 67](/show_bug.cgi?id=1783504#c67)• 11 months ago |
|  | |

Builds are on their way: <https://treeherder.mozilla.org/jobs?repo=try&revision=a8142806fa2ea2b1c58702bd049c015a2de947bb>

Flags: needinfo?(aiunusov)

|  | [Daniel Bodea [:danibodea]](/user_profile?user_id=616104) |  |
| --- | --- | --- |
| [Comment 68](/show_bug.cgi?id=1783504#c68)• 11 months ago |
|  | |

This issue still occurs with the provided Nightly v125.0a1 try build using the provided steps.

Furthermore, Microsoft Defender has detected a virus in the provided try build: Trojan:Script/Wacatac.B!ml

I cannot verify the fix in either of the latest branches.

Status: RESOLVED → REOPENED
[status-firefox125](/buglist.cgi?f1=cf_status_firefox125&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox125&o1=equals&v1=affected)Resolution: FIXED → ---

|  | [Artur Iunusov](/user_profile?user_id=712685)  Assignee |  |
| --- | --- | --- |
| [Comment 69](/show_bug.cgi?id=1783504#c69)• 11 months ago • [Edited](/page.cgi?id=comment-revisions.html&bug_id=1783504&comment_id=16813022 "3 revisions") |
|  | |

The provided binaries contained only this change: <https://hg.mozilla.org/try/rev/02babe736726c6e21e1a4783009d14b6a667b20a>

which is of course, could be detected by the antivirus as malicious software. Since this POC intentionally makes a content process compromised (for testing purposes only)

|  | [Artur Iunusov](/user_profile?user_id=712685)  Assignee |  |
| --- | --- | --- |
| [Comment 70](/show_bug.cgi?id=1783504#c70)• 11 months ago • [Edited](/page.cgi?id=comment-revisions.html&bug_id=1783504&comment_id=16830500 "3 revisions") |
|  | |

Could you please, explain the issue with Nightly v125.0a1?

In any case I can provide a new binaries for testing

How about this build (this is today's Nightly, with the patched content process, in order to be 'compromised'): <https://treeherder.mozilla.org/jobs?repo=try&revision=137cf9c00e4f7b565da87be8fc05d11937ac3f75>

in case of any issues, you can also ping me in Matrix :)

Flags: needinfo?(dbodea)

|  | [Artur Iunusov](/user_profile?user_id=712685)  Assignee |  |
| --- | --- | --- |
| [Comment 71](/show_bug.cgi?id=1783504#c71)• 10 months ago |
|  | |

UPD: I double checked everything, and managed to reproduce the tab crash using the steps above and binaries from <https://treeherder.mozilla.org/jobs?repo=try&revision=137cf9c00e4f7b565da87be8fc05d11937ac3f75>

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1783504#a50040954_75935)• 10 months ago |

Status: REOPENED → NEW
[status-firefox122](/buglist.cgi?f1=cf_status_firefox122&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox122&o1=equals&v1=fixed) → [wontfix](/buglist.cgi?f1=cf_status_firefox122&o1=equals&v1=wontfix)
[status-firefox123](/buglist.cgi?f1=cf_status_firefox123&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox123&o1=equals&v1=wontfix)
[status-firefox124](/buglist.cgi?f1=cf_status_firefox124&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox124&o1=equals&v1=wontfix)
[status-firefox-esr115](/buglist.cgi?f1=cf_status_firefox_esr115&o1=isnotempty):
[fix-optional](/buglist.cgi?f1=cf_status_firefox_esr115&o1=equals&v1=fix-optional) → [wontfix](/buglist.cgi?f1=cf_status_firefox_esr115&o1=equals&v1=wontfix)Target Milestone: 122 Branch → ---

|  | [Artur Iunusov](/user_profile?user_id=712685)  Assignee |  |
| --- | --- | --- |
| [Comment 72](/show_bug.cgi?id=1783504#c72)• 10 months ago |
|  | |

The original issue has been fixed. Now, instead of leaking data, the tab crashes immediately.

But since we don't yet know if it's even possible to compromise the content process, it makes for QA too difficult to test. This is why custom binaries are needed.

|  | [Daniel Bodea [:danibodea]](/user_profile?user_id=616104) |  |
| --- | --- | --- |
| [Comment 73](/show_bug.cgi?id=1783504#c73)• 10 months ago |
|  | |

From the answers in [comment 53](/show_bug.cgi?id=1783504#c53 "RESOLVED FIXED - Compromised content process can UpdateDocumentURI"), I have understood that to reproduce the issue, the tab must crash so I expected the tab not to crash in the fixed builds. In my testing, the same outcome was observed in both the "affected" build and the "fixed" one as the tab crashes.

As a consequence, I need to ask for more details: Assuming that the data leak is the actual issue, how am I to determine whether the build leaks data or not so I can correctly verify the fix?

Thank you for your help!

Flags: needinfo?(dbodea) → needinfo?(aiunusov)

|  | [Artur Iunusov](/user_profile?user_id=712685)  Assignee |  |
| --- | --- | --- |
| [Comment 74](/show_bug.cgi?id=1783504#c74)• 10 months ago • [Edited](/page.cgi?id=comment-revisions.html&bug_id=1783504&comment_id=16844595 "11 revisions") |
|  | |

In short, this is the correct behavior: the tab should crash, in order not to allow to change a document URI and steal the data.

Basically, we're dealing with a security issue that not exist, but could arise in the future if someone finds a way to compromise the content process (that is why testing is so unusual and sometimes complicated)

(I think, to confirm that fix is working, I could also provide a patched old version, before my fix. To double check that tab was potentially allowing to steal the data)

|  | [Daniel Bodea [:danibodea]](/user_profile?user_id=616104) |  |
| --- | --- | --- |
| [Comment 75](/show_bug.cgi?id=1783504#c75)• 10 months ago |
|  | |

Due to the high level of technicality and the fact that is quite hard to reproduce or verify (as mentioned in [comment 72](/show_bug.cgi?id=1783504#c72 "RESOLVED FIXED - Compromised content process can UpdateDocumentURI")), I will be removing the qe+ flag. However, if verification of this report is necessary, please provide us with the necessary custom builds and information needed to complete.

Thank you.

Flags: qe-verify+

|  | [Artur Iunusov](/user_profile?user_id=712685)  Assignee |  |
| --- | --- | --- |
| [Comment 76](/show_bug.cgi?id=1783504#c76)• 10 months ago |
|  | |

I can perform any test that required

Flags: needinfo?(aiunusov)

|  | [Artur Iunusov](/user_profile?user_id=712685)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1783504#a52354629_712685)• 10 months ago |

Blocks: [1889331](/show_bug.cgi?id=1889331 "RESOLVED FIXED - Make dom.security.setdocumenturi enabled by default on release as well")

|  | [Artur Iunusov](/user_profile?user_id=712685)  Assignee |  |
| --- | --- | --- |
| [Comment 77](/show_bug.cgi?id=1783504#c77)• 9 months ago |
|  | |

Follow up bug (enhancement): <https://bugzilla.mozilla.org/show_bug.cgi?id=1890569>

Status: NEW → RESOLVEDClosed: 1 year ago → 9 months agoResolution: --- → FIXED

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1783504#a52896119_75935)• 9 months ago |

No longer blocks: [1889331](/show_bug.cgi?id=1889331 "RESOLVED FIXED - Make dom.security.setdocumenturi enabled by default on release as well")
[status-firefox125](/buglist.cgi?f1=cf_status_firefox125&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox125&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox125&o1=equals&v1=wontfix)
[status-firefox126](/buglist.cgi?f1=cf_status_firefox126&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox126&o1=equals&v1=fixed)Depends on: [1889331](/show_bug.cgi?id=1889331 "RESOLVED FIXED - Make dom.security.setdocumenturi enabled by default on release as well")Target Milestone: --- → 126 Branch

|  | [Jesse Schwartzentruber (:truber)](/user_profile?user_id=486733) |  |
| --- | --- | --- |
| [Comment 78](/show_bug.cgi?id=1783504#c78)• 8 months ago |
|  | |

Unless I'm misunderstanding, I think this should have remained marked fixed in 122 (based on [comment 72](#c72)).

Flags: needinfo?(ryanvm)Whiteboard: [disclosure 11 Aug 2023][reporter-external] [client-bounty-form] [verif?][adv-main122+] → [disclosure 11 Aug 2023][reporter-external] [client-bounty-form] [verif?][adv-main122+] [adv-main126-]

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 79](/show_bug.cgi?id=1783504#c79)• 8 months ago |
|  | |

I guess, though it didn't actually ride the trains until 126 ([bug 1889331](/show_bug.cgi?id=1889331 "RESOLVED FIXED - Make dom.security.setdocumenturi enabled by default on release as well")).

Flags: needinfo?(ryanvm)

|  | [David Lawrence [:dkl]](/user_profile?user_id=5898) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1783504#a57312221_5898)• 8 months ago |

Keywords: [reporter-external](/buglist.cgi?keywords=reporter-external&resolution=---)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1783504#a66933945_1689)• 4 months ago |

Group: core-security-release
You need to [log in](/show_bug.cgi?id=1783504&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Young Min Kim](/user_profile?user_id=694094)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review


