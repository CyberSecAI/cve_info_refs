=== Content from github.com_e284238c_20250115_213034.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftrezor%2Ftrezor-crypto%2Fcommit%2F009850f6c9afcf60b4c6280afd46868b1a7a1fdd)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftrezor%2Ftrezor-crypto%2Fcommit%2F009850f6c9afcf60b4c6280afd46868b1a7a1fdd)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=trezor%2Ftrezor-crypto)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

This repository has been archived by the owner on Nov 16, 2021. It is now read-only.

[trezor](/trezor)
/
**[trezor-crypto](/trezor/trezor-crypto)**
Public archive

* [Notifications](/login?return_to=%2Ftrezor%2Ftrezor-crypto) You must be signed in to change notification settings
* [Fork
  204](/login?return_to=%2Ftrezor%2Ftrezor-crypto)
* [Star
   503](/login?return_to=%2Ftrezor%2Ftrezor-crypto)

* [Code](/trezor/trezor-crypto)
* [Issues
  0](/trezor/trezor-crypto/issues)
* [Pull requests
  0](/trezor/trezor-crypto/pulls)
* [Actions](/trezor/trezor-crypto/actions)
* [Projects
  0](/trezor/trezor-crypto/projects)
* [Security](/trezor/trezor-crypto/security)
* [Insights](/trezor/trezor-crypto/pulse)

Additional navigation options

* [Code](/trezor/trezor-crypto)
* [Issues](/trezor/trezor-crypto/issues)
* [Pull requests](/trezor/trezor-crypto/pulls)
* [Actions](/trezor/trezor-crypto/actions)
* [Projects](/trezor/trezor-crypto/projects)
* [Security](/trezor/trezor-crypto/security)
* [Insights](/trezor/trezor-crypto/pulse)

## Commit

[Permalink](/trezor/trezor-crypto/commit/009850f6c9afcf60b4c6280afd46868b1a7a1fdd)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Fixed undefined behavior

[Browse files](/trezor/trezor-crypto/tree/009850f6c9afcf60b4c6280afd46868b1a7a1fdd)
Browse the repository at this point in the history

```
This fixes a shift by 32 and shifts on signed integer that overflow.
```

* Loading branch information

[![@jhoenicke](https://avatars.githubusercontent.com/u/897826?s=40&v=4)](/jhoenicke) [![@prusnak](https://avatars.githubusercontent.com/u/42201?s=40&v=4)](/prusnak)

[jhoenicke](/trezor/trezor-crypto/commits?author=jhoenicke "View all commits by jhoenicke")
authored and
[prusnak](/trezor/trezor-crypto/commits?author=prusnak "View all commits by prusnak")
committed
Mar 27, 2018

1 parent
[49272f8](/trezor/trezor-crypto/commit/49272f8d869f1424608760ea52949595c17804e3)

commit 009850f

 Show file tree

 Hide file tree

Showing
**6 changed files**
with
**23 additions**
and
**23 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* address.c
  [address.c](#diff-cc6d43aa01d6b6fb8bc8a4112555b317c97a2e57b36118d806a64f3dc0ce250e)
* bignum.c
  [bignum.c](#diff-3d30768f8c0d6ac05da6b233e6ab24b60d60da374cd7454263405323a3474fe8)
* bip32.c
  [bip32.c](#diff-bc61c1212da56d9fbac6a91fb2437fc024516a42d163edb12575f5541cf64b1a)
* nem.c
  [nem.c](#diff-bcfd2a93f5247992af9082efcd3721931e8ef5ffa38e84122012745184c07470)
* rand.c
  [rand.c](#diff-f5da78f0f2e2c1b2d53f65e12d203219437dcc4fc4ddcd772c89375ec1791426)
* test\_check.c
  [test\_check.c](#diff-e6253fd3c4770767f40cb9b711420494717f3c3193d62b0c146ae9e108477663)

## There are no files selected for viewing

6 changes: 3 additions & 3 deletions

6
[address.c](#diff-cc6d43aa01d6b6fb8bc8a4112555b317c97a2e57b36118d806a64f3dc0ce250e "address.c")

Show comments

[View file](/trezor/trezor-crypto/blob/009850f6c9afcf60b4c6280afd46868b1a7a1fdd/address.c)
Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -45,12 +45,12 @@ bool address\_check\_prefix(const uint8\_t \*addr, uint32\_t address\_type) |
|  |  | return address\_type == (uint32\_t)(addr[0]); |
|  |  | } |
|  |  | if (address\_type <= 0xFFFF) { |
|  |  | return address\_type == ((uint32\_t)(addr[0] << 8) | (uint32\_t)(addr[1])); |
|  |  | return address\_type == (((uint32\_t) addr[0] << 8) | ((uint32\_t) addr[1])); |
|  |  | } |
|  |  | if (address\_type <= 0xFFFFFF) { |
|  |  | return address\_type == ((uint32\_t)(addr[0] << 16) | (uint32\_t)(addr[1] << 8) | (uint32\_t)(addr[2])); |
|  |  | return address\_type == (((uint32\_t) addr[0] << 16) | ((uint32\_t) addr[1] << 8) | ((uint32\_t) addr[2])); |
|  |  | } |
|  |  | return address\_type == ((uint32\_t)(addr[0] << 24) | (uint32\_t)(addr[1] << 16) | (uint32\_t)(addr[2] << 8) | (uint32\_t)(addr[3])); |
|  |  | return address\_type == (((uint32\_t) addr[0] << 24) | ((uint32\_t) addr[1] << 16) | ((uint32\_t) addr[2] << 8) | ((uint32\_t) addr[3])); |
|  |  | } |
|  |  |  |
|  |  | #if USE\_ETHEREUM |
| Expand Down | |  |

18 changes: 9 additions & 9 deletions

18
[bignum.c](#diff-3d30768f8c0d6ac05da6b233e6ab24b60d60da374cd7454263405323a3474fe8 "bignum.c")

Show comments

[View file](/trezor/trezor-crypto/blob/009850f6c9afcf60b4c6280afd46868b1a7a1fdd/bignum.c)
Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -111,13 +111,13 @@ void bn\_read\_be(const uint8\_t \*in\_number, bignum256 \*out\_number) |
|  |  | void bn\_write\_be(const bignum256 \*in\_number, uint8\_t \*out\_number) |
|  |  | { |
|  |  | int i; |
|  |  | uint32\_t temp = in\_number->val[8] << 16; |
|  |  | uint32\_t temp = in\_number->val[8]; |
|  |  | for (i = 0; i < 8; i++) { |
|  |  | // invariant: temp = (in\_number >> 30\*(8-i)) << (16 + 2i) |
|  |  | // invariant: temp = (in\_number >> 30\*(8-i)) |
|  |  | uint32\_t limb = in\_number->val[7 - i]; |
|  |  | temp |= limb >> (14 - 2\*i); |
|  |  | temp = (temp << (16 + 2\*i)) | (limb >> (14 - 2\*i)); |
|  |  | write\_be(out\_number + i \* 4, temp); |
|  |  | temp = limb << (18 + 2\*i); |
|  |  | temp = limb; |
|  |  | } |
|  |  | } |
|  |  |  |
| Expand Down  Expand Up | | @@ -146,13 +146,13 @@ void bn\_read\_le(const uint8\_t \*in\_number, bignum256 \*out\_number) |
|  |  | void bn\_write\_le(const bignum256 \*in\_number, uint8\_t \*out\_number) |
|  |  | { |
|  |  | int i; |
|  |  | uint32\_t temp = in\_number->val[8] << 16; |
|  |  | uint32\_t temp = in\_number->val[8]; |
|  |  | for (i = 0; i < 8; i++) { |
|  |  | // invariant: temp = (in\_number >> 30\*(8-i)) << (16 + 2i) |
|  |  | // invariant: temp = (in\_number >> 30\*(8-i)) |
|  |  | uint32\_t limb = in\_number->val[7 - i]; |
|  |  | temp |= limb >> (14 - 2\*i); |
|  |  | temp = (temp << (16 + 2\*i)) | (limb >> (14 - 2\*i)); |
|  |  | write\_le(out\_number + (7 - i) \* 4, temp); |
|  |  | temp = limb << (18 + 2\*i); |
|  |  | temp = limb; |
|  |  | } |
|  |  | } |
|  |  |  |
| Expand Down  Expand Up | | @@ -840,7 +840,7 @@ void bn\_inverse(bignum256 \*x, const bignum256 \*prime) |
|  |  | // s + factor\*prime mod 2^k == 0 |
|  |  | // i.e. factor = s \* -1/prime mod 2^k. |
|  |  | // Then compute s + factor\*prime and shift right by k bits. |
|  |  | uint32\_t mask = (1 << k) - 1; |
|  |  | uint32\_t mask = (1u << k) - 1; |
|  |  | uint32\_t factor = (inverse \* us.a[8]) & mask; |
|  |  | temp = (us.a[8] + (uint64\_t) pp[0] \* factor) >> k; |
|  |  | assert(((us.a[8] + pp[0] \* factor) & mask) == 0); |
| Expand Down | |  |

2 changes: 1 addition & 1 deletion

2
[bip32.c](#diff-bc61c1212da56d9fbac6a91fb2437fc024516a42d163edb12575f5541cf64b1a "bip32.c")

Show comments

[View file](/trezor/trezor-crypto/blob/009850f6c9afcf60b4c6280afd46868b1a7a1fdd/bip32.c)
Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -168,7 +168,7 @@ uint32\_t hdnode\_fingerprint(HDNode \*node) |
|  |  | hdnode\_fill\_public\_key(node); |
|  |  | hasher\_Raw(node->curve->hasher\_type, node->public\_key, 33, digest); |
|  |  | ripemd160(digest, 32, digest); |
|  |  | fingerprint = (digest[0] << 24) + (digest[1] << 16) + (digest[2] << 8) + digest[3]; |
|  |  | fingerprint = ((uint32\_t) digest[0] << 24) + (digest[1] << 16) + (digest[2] << 8) + digest[3]; |
|  |  | memzero(digest, sizeof(digest)); |
|  |  | return fingerprint; |
|  |  | } |
| Expand Down | |  |

16 changes: 8 additions & 8 deletions

16
[nem.c](#diff-bcfd2a93f5247992af9082efcd3721931e8ef5ffa38e84122012745184c07470 "nem.c")

Show comments

[View file](/trezor/trezor-crypto/blob/009850f6c9afcf60b4c6280afd46868b1a7a1fdd/nem.c)
Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -214,7 +214,7 @@ bool nem\_transaction\_create\_transfer(nem\_transaction\_ctx \*ctx, |
|  |  |  |
|  |  | bool ret = nem\_transaction\_write\_common(ctx, |
|  |  | NEM\_TRANSACTION\_TYPE\_TRANSFER, |
|  |  | network << 24 | (mosaics ? 2 : 1), |
|  |  | (uint32\_t) network << 24 | (mosaics ? 2 : 1), |
|  |  | timestamp, |
|  |  | signer, |
|  |  | fee, |
| Expand Down  Expand Up | | @@ -292,7 +292,7 @@ bool nem\_transaction\_create\_multisig(nem\_transaction\_ctx \*ctx, |
|  |  |  |
|  |  | bool ret = nem\_transaction\_write\_common(ctx, |
|  |  | NEM\_TRANSACTION\_TYPE\_MULTISIG, |
|  |  | network << 24 | 1, |
|  |  | (uint32\_t) network << 24 | 1, |
|  |  | timestamp, |
|  |  | signer, |
|  |  | fee, |
| Expand Down  Expand Up | | @@ -321,7 +321,7 @@ bool nem\_transaction\_create\_multisig\_signature(nem\_transaction\_ctx \*ctx, |
|  |  |  |
|  |  | bool ret = nem\_transaction\_write\_common(ctx, |
|  |  | NEM\_TRANSACTION\_TYPE\_MULTISIG\_SIGNATURE, |
|  |  | network << 24 | 1, |
|  |  | (uint32\_t) network << 24 | 1, |
|  |  | timestamp, |
|  |  | signer, |
|  |  | fee, |
| Expand Down  Expand Up | | @@ -361,7 +361,7 @@ bool nem\_transaction\_create\_provision\_namespace(nem\_transaction\_ctx \*ctx, |
|  |  |  |
|  |  | bool ret = nem\_transaction\_write\_common(ctx, |
|  |  | NEM\_TRANSACTION\_TYPE\_PROVISION\_NAMESPACE, |
|  |  | network << 24 | 1, |
|  |  | (uint32\_t) network << 24 | 1, |
|  |  | timestamp, |
|  |  | signer, |
|  |  | fee, |
| Expand Down  Expand Up | | @@ -420,7 +420,7 @@ bool nem\_transaction\_create\_mosaic\_creation(nem\_transaction\_ctx \*ctx, |
|  |  |  |
|  |  | bool ret = nem\_transaction\_write\_common(ctx, |
|  |  | NEM\_TRANSACTION\_TYPE\_MOSAIC\_CREATION, |
|  |  | network << 24 | 1, |
|  |  | (uint32\_t) network << 24 | 1, |
|  |  | timestamp, |
|  |  | signer, |
|  |  | fee, |
| Expand Down  Expand Up | | @@ -506,7 +506,7 @@ bool nem\_transaction\_create\_mosaic\_supply\_change(nem\_transaction\_ctx \*ctx, |
|  |  |  |
|  |  | bool ret = nem\_transaction\_write\_common(ctx, |
|  |  | NEM\_TRANSACTION\_TYPE\_MOSAIC\_SUPPLY\_CHANGE, |
|  |  | network << 24 | 1, |
|  |  | (uint32\_t) network << 24 | 1, |
|  |  | timestamp, |
|  |  | signer, |
|  |  | fee, |
| Expand Down  Expand Up | | @@ -544,7 +544,7 @@ bool nem\_transaction\_create\_aggregate\_modification(nem\_transaction\_ctx \*ctx, |
|  |  |  |
|  |  | bool ret = nem\_transaction\_write\_common(ctx, |
|  |  | NEM\_TRANSACTION\_TYPE\_AGGREGATE\_MODIFICATION, |
|  |  | network << 24 | (relative\_change ? 2 : 1), |
|  |  | (uint32\_t) network << 24 | (relative\_change ? 2 : 1), |
|  |  | timestamp, |
|  |  | signer, |
|  |  | fee, |
| Expand Down  Expand Up | | @@ -600,7 +600,7 @@ bool nem\_transaction\_create\_importance\_transfer(nem\_transaction\_ctx \*ctx, |
|  |  |  |
|  |  | bool ret = nem\_transaction\_write\_common(ctx, |
|  |  | NEM\_TRANSACTION\_TYPE\_IMPORTANCE\_TRANSFER, |
|  |  | network << 24 | 1, |
|  |  | (uint32\_t) network << 24 | 1, |
|  |  | timestamp, |
|  |  | signer, |
|  |  | fee, |
| Expand Down | |  |

2 changes: 1 addition & 1 deletion

2
[rand.c](#diff-f5da78f0f2e2c1b2d53f65e12d203219437dcc4fc4ddcd772c89375ec1791426 "rand.c")

Show comments

[View file](/trezor/trezor-crypto/blob/009850f6c9afcf60b4c6280afd46868b1a7a1fdd/rand.c)
Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -45,7 +45,7 @@ uint32\_t random32(void) |
|  |  | srand((unsigned)time(NULL)); |
|  |  | initialized = 1; |
|  |  | } |
|  |  | return ((rand() % 0xFF) | ((rand() % 0xFF) << 8) | ((rand() % 0xFF) << 16) | ((rand() % 0xFF) << 24)); |
|  |  | return ((rand() & 0xFF) | ((rand() & 0xFF) << 8) | ((rand() & 0xFF) << 16) | ((uint32\_t) (rand() & 0xFF) << 24)); |
|  |  | } |
|  |  |  |
|  |  | #endif /\* RAND\_PLATFORM\_INDEPENDENT \*/ |
| Expand Down | |  |

2 changes: 1 addition & 1 deletion

2
[test\_check.c](#diff-e6253fd3c4770767f40cb9b711420494717f3c3193d62b0c146ae9e108477663 "test_check.c")

Show comments

[View file](/trezor/trezor-crypto/blob/009850f6c9afcf60b4c6280afd46868b1a7a1fdd/test_check.c)
Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -3028,7 +3028,7 @@ static void test\_codepoints\_curve(const ecdsa\_curve \*curve) { |
|  |  | for (i = 0; i < 64; i++) { |
|  |  | for (j = 0; j < 8; j++) { |
|  |  | bn\_zero(&a); |
|  |  | a.val[(4\*i)/30] = (2\*j+1) << (4\*i % 30); |
|  |  | a.val[(4\*i)/30] = (uint32\_t) (2\*j+1) << (4\*i % 30); |
|  |  | bn\_normalize(&a); |
|  |  | // note that this is not a trivial test. We add 64 curve |
|  |  | // points in the table to get that particular curve point. |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `009850f`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftrezor%2Ftrezor-crypto%2Fcommit%2F009850f6c9afcf60b4c6280afd46868b1a7a1fdd) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from twitter.com_b2726737_20250115_213035.html ===



=== Content from milksad.info_abb6ddbd_20250115_082105.html ===


* [![](/assets/base/milksad_transparent.svg)
  Milk Sad](/)
* [/summary](/index.html)
* [/updates](/updates.html)
* [/full write-up](/disclosure.html)
* [/faq](/faq.html)

# Update #5 - Digging Into New Trust Wallet Research

Published: Jan 23, 2024Author: Christian Reitter

Last Friday, we learned of a [newly disclosed vulnerability](https://secbit.io/blog/en/2024/01/19/trust-wallets-fomo3d-summer-vuln/) in the `Trust Wallet` software which is relevant to Milk Sad. Researchers from [SECBIT Labs](https://secbit.io) tracked down an older wallet generation weakness in the iOS platform version of `Trust Wallet` from 2018 and connected it to the large thefts on 2023-07-12 that triggered our Milk Sad research.

Using the newly available information, we managed to reproduce some of their findings, and can give a first look at additional data we collected.

## Table of Contents

* [Vulnerability TL;DR](#vulnerability-tldr)
  + [Vulnerability Types](#vulnerability-types)
* [Early Results](#early-results)
  + [Over 6500 Weak Wallets ð¥](#over-6500-weak-wallets-)
  + [Wallet Creation Date Pattern](#wallet-creation-date-pattern)
  + [Bitcoin On-Chain Movements](#bitcoin-on-chain-movements)
  + [Involvement in the 2023-07-12 Theft](#involvement-in-the-2023-07-12-theft)
  + [Current Status & Advice](#current-status--advice)
* [Summary & Outlook](#summary--outlook)

## Vulnerability TL;DR

Open source code shows that [a core component](https://github.com/trustwallet/trezor-crypto-ios/commits/master/) of the `Trust Wallet` app for iOS generated new cryptocurrency wallets using unsafe functions in the `trezor-crypto` library that were not meant for production. As a result, their wallet entropy is based on a weak PRNG with 31-bit initial state that is seeded with easy-to-guess time values. This makes all wallets generated with vulnerable app versions easy to brute force remotely, like the weak `bx seed` mechanism in Libbitcoin. Both weaknesses were attacked on-chain at the same time in July 2023.

If you want to understand this better, we recommend taking a look at the [Trust Walletâs Fomo3D Summer: Fresh Discovery of Low Entropy Flaw From 2018](https://secbit.io/blog/en/2024/01/19/trust-wallets-fomo3d-summer-vuln/) disclosure of the SECBIT team.

Credits for this discovery go to `p0n1` and `outoflegend` from SECBIT Labs. We werenât involved in their disclosure and didnât know about it beforehand, but they gave us some useful confirmations and hints via email after their disclosure was public. Thank you!

### Vulnerability Types

The newly disclosed vulnerability comes in two forms. Together with the previously known `Trust Wallet` vulnerability, things are getting confusing, so hereâs a short overview:

| Issue | When | Characteristics | Research | ID |
| --- | --- | --- | --- | --- |
| vulnerable Trust Wallet browser extension | 2022/2023 | Mersenne Twister based | [research update #2](/posts/research-update-2/) | CVE-2023-31290 |
| vulnerable Trust Wallet iOS app - **variant A** | Mid-2018 | `LCG16807` `MINSTD_RAND0` + `trezor-crypto` [2e528be](https://github.com/trezor/trezor-crypto/commit/2e528be1e91dd48c0e55061fbdd40ccf8b285559) | this article | CVE-2024-23660 |
| vulnerable Trust Wallet iOS app - **variant B** | Mid-2018 | `LCG16807` `MINSTD_RAND0` + `trezor-crypto` [009850](https://github.com/trezor/trezor-crypto/commit/009850f6c9afcf60b4c6280afd46868b1a7a1fdd) | this article | CVE-2024-23660 |

Each weak PRNGs variant creates different ranges of weak wallets. This article is *exclusively* about the two newly discovered variants, and does not cover the Mersenne Twister based vulnerability.

## Early Results

Unlike other vulnerabilities with time-based PRNG seeding that we looked at before, this one calls the PRNG initialization in a way that can be predicted by outside observers, in both variant A and variant B:

```
srand((unsigned)time(NULL));

```

`time(NULL)` returns the *seconds* since 1970-01-01 00:00:00, representing the ârandomâ base for `srand()` to pick the first PRNG state setting. Developers may know this time format as [Unix time](https://en.wikipedia.org/wiki/Unix_time).

For our initial experiments, we assume that the devices running the code had reasonably correct date and clock settings at the time they generated new wallets. The PRNG has a 31-bit state, but we used the known `srand()` behavior to focus our initial search onto a smaller subset of wallets which correspond to certain creation dates. This optimization speeds up the initial work.

### Over 6500 Weak Wallets ð¥

Within the wallet ranges with 12 mnemonic words (128 bits), we found the following:

| Range | Variant A | Variant B |
| --- | --- | --- |
| creation timestamp in srand() | 2010-01-01 to 2025-01-01 | 2010-01-01 to 2025-01-01 |
| Bitcoin P2PKH, compressed pubkey | 21 | 40 |
| Bitcoin P2SH-P2WPKH | 8 | 14 |
| Bitcoin P2WPKH | 452 | 216 |
| Ethereum | 4261 | 2054 |
| total unique wallet private keys | 4455 | 2117 |

**Data details** (click to unfold)

* Wallet generation: variant A entropy -> BIP39 -> BIP32.
* Wallet generation: variant B entropy -> BIP39 -> BIP32.
* The 18 word and 24 word ranges in Variant A seem to be mostly unused, we focused on 12 word.
* Ethereum wallet detection is based on a known incomplete bloom filter data set from mid-2023.
* Bitcoin wallet detection is based on a bloom filter data set from 2024-01-15.

Based on the current preliminary (incomplete!) data, weâre counting at least **6572** unique wallet mnemonics, and we still expect to find more.

### Wallet Creation Date Pattern

We mapped out the discovered BTC and ETH wallets in a histogram plot to better understand the PRNG index range patterns (and therefore potential timestamps) the wallets in variant A and variant B were created with:

![Histogram of PRNG creation index for discovered wallets<br/>Trust Wallet iOS variant A & B - 128 bit wallets<br/>Yearly X-Axis timestamp markers, graph based on incomplete data](/assets/images/resized/600/trustwallet2ab_bip39_128bit_only_histogram_btc_eth_prng_index_2010_2025_graph1.png)

Histogram of PRNG creation index for discovered wallets
Trust Wallet iOS variant A & B - 128 bit wallets
Yearly X-Axis timestamp markers, graph based on incomplete data

**Graph details** (click to unfold)

* 2018-01-01: **1,514 x 10â¹** timestamp
* 2019-01-01: **1,546 x 10â¹** timestamp
* 2020-01-01: **1,578 x 10â¹** timestamp
* Total range shown: 2010-01-01 to 2025-01-01
* Y-Axis capped for readability, data is not stacked
* Variant B data only covers 2018-01-01 to 2020-01-01
* ETH data is outdated

Two main observations:

1. The majority of Bitcoin and Ethereum wallets have a PRNG seed that corresponds to wallet creation timestamps from 2018 and 2019.
2. There is a smaller number of wallets with a more ârandomâ pattern.

Point 1) generally fits to the publicly known timeline of the `Trust Wallet iOS` development and vulnerability (but is not a hard confirmation).
Point 2) indicates that there is some other source of weak wallets in this range that is less time based. Alternatively, itâs possible that a subset of app devices had bad clocks for some reasons when creating the wallets.

Since the situation in 2018-2019 is very busy, here is a zoomed-in and annotated version:

![Histogram of PRNG creation index for discovered wallets - Trust Wallet iOS<br/>variant A & B, 2018-05 to 2020-01, data is not stacked, graph based on incomplete data](/assets/images/resized/600/trustwallet2ab_bip39_128bit_only_histogram_btc_eth_prng_index_2018_2019_graph2.png)

Histogram of PRNG creation index for discovered wallets - Trust Wallet iOS
variant A & B, 2018-05 to 2020-01, data is not stacked, graph based on incomplete data

A possible interpretation of the graph history:

1. Parameter space âbeforeâ the vulnerable `Trust Wallet` versions
2. Weak wallets of variant A appear with the first weak software version
3. Weak wallets of variant B appear once a differently vulnerable software version gets released
   * -> New wallets in variant A get more rare
4. A patched version get released
   * -> New wallets in variant B get more rare
5. Historically high BTC prices motivate users to create new wallet mnemonics for Bitcoin accounts (?)
6. Some users of both vulnerable software versions keep creating weak wallets months later, likely because they did not get or install the patched app versions yet

It is unclear to us if `Trust Wallet` on iOS had full support for Bitcoin wallets at the time, which may would be a relevant factor in the interpretation, and a clue towards the involvement of other wallet software.

### Bitcoin On-Chain Movements

Here is an *initial, incomplete* analysis of BTC movements to and from weak wallets based on our initial data:

![Historic aggregated usage of known wallets in 128 bit Trust Wallet Bitcoin range - <b>variant A</b>](/assets/images/resized/600/trustwallet2a_bip39_128bit_only_monthly_volume_btc_2018_2023_graph1.png)

Historic aggregated usage of known wallets in 128 bit Trust Wallet Bitcoin range - **variant A**

Notably, there is a visible peak in the graph of outgoing transfers of the month of 2023-07, which is no coincidence. More on this later.

![Historic aggregated usage of known wallets in 128 bit Trust Wallet Bitcoin range - <b>variant B</b>](/assets/images/resized/600/trustwallet2b_bip39_128bit_only_monthly_volume_btc_2018_2023_data2018_2019_graph1.png)

Historic aggregated usage of known wallets in 128 bit Trust Wallet Bitcoin range - **variant B**

Early estimations for on-chain funds movement volume:

| Variant A | ca. **389,5 BTC** | 2010-01-01 to 2025-01-01 |
| --- | --- | --- |
| Variant B | ca. **377,2 BTC** | 2018-01-01 to 2020-01-01 |

Note: this describes funds moved over the weak wallets that have been at risk at some point, not the amounts stolen by attackers.

### Involvement in the 2023-07-12 Theft

Here are the three biggest outgoing theft transactions from the newly disclosed range of weak wallets on 2023-07-12:

| Transaction | Volume variant A (`Trust Wallet iOS`) | Volume variant B (`Trust Wallet iOS`) | Transaction total volume | Date |
| --- | --- | --- | --- | --- |
| [81cfe97c..7136f5bf](https://mempool.space/tx/81cfe97cc16a49398d6986032ec8f6970ea80df5aa0990dcf0164de87136f5bf) | -4,829 BTC | -3,481 BTC | -9,744 BTC | 2023-07-12 12:41 |
| [cdd9a2af..70a9716c](https://mempool.space/tx/cdd9a2aff7cd0707e31023513cc78aceff7ea7e754e3a9bde9c0482b70a9716c) | -8,161 BTC | none | -8,161 BTC *(incl. fee)* | 2023-07-12 12:41 |
| [a22b33a9..8f8f774b](https://mempool.space/tx/a22b33a9a4ca0de2f56ef166298c186c5d71e56b944a255c2ecc52748f8f774b) | -9,523 BTC | -0,517 BTC | -14,846 BTC | 2023-07-12 12:41 |

As you can see, the newly discovered weak wallets make up a significant portion of some of the theft transactions on that day.
At least one of the transactions ([cdd9a2af..70a9716c](https://mempool.space/tx/cdd9a2aff7cd0707e31023513cc78aceff7ea7e754e3a9bde9c0482b70a9716c)) had not been on our radar so far, since the stolen funds were exclusively coming from previously untracked wallets. We therefore have to adjust our estimates of the overall figure of BTC stolen from victims that day. It now exceeds $1M USD of equivalent value at the time!

### Current Status & Advice

At the time of publication, less than $100 USD in total remain on the known BTC wallets in the analyzed range subsets. Unfortunately, there have still been a number of incoming BTC transactions after 2023-07-12, which are very much at risk of getting stolen the second they get announced on the blockchain.

`Trust Wallet` users who created their mnemonic seed words with an app version downloaded during the time in question should be very careful. If in doubt, move funds to a new wallet mnemonic generated on a well-regarded and up-to-date wallet solution, such as a popular hardware wallet.

## Summary & Outlook

In this research update, weâve followed up on work by other security researchers who discovered two large new ranges of weak cryptocurrency wallets from (most likely) an older vulnerability in `Trust Wallet` on iOS. We confirmed that these weak wallets exist and that they were involved in the Milk Sad thefts. We also provided new statistics on their distribution and usage.

This is an exciting new piece of the overall Milk Sad puzzle, and weâll continue to update this blog post with new information as it becomes available.

[RSS](https://milksad.info/feed.xml),
[Git](https://git.distrust.co/milksad),
[data](https://git.distrust.co/milksad/data),
[old lookup](https://milksad.info/lookup.html) ![Milk Sad logo as icon](/assets/base/milksad_bottle_transparent.svg)2023-2024



=== Content from secbit.io_ac1b39b1_20250115_082106.html ===


[SECBIT Blog](/)

* [Home](https://sec-bit.github.io/blog/en/)
* [Archives](https://sec-bit.github.io/blog/en/post/)
* [Tags](https://sec-bit.github.io/blog/en/tags/)
* [Categories](https://sec-bit.github.io/blog/en/categories/)
* English
  + [中文](https://sec-bit.github.io/blog/)

[SECBIT Blog](/)

* [Home](https://sec-bit.github.io/blog/en/)
* [Archives](https://sec-bit.github.io/blog/en/post/)
* [Tags](https://sec-bit.github.io/blog/en/tags/)
* [Categories](https://sec-bit.github.io/blog/en/categories/)
* English
  + [**English**](https://sec-bit.github.io/blog/en/)
  + [中文](https://sec-bit.github.io/blog/)

# Trust Wallet's Fomo3D Summer: Fresh Discovery of Low Entropy Flaw From 2018

p0n1 and outoflegend

2024-01-19

(LastMod:
2024-11-12)

[crypto wallet](https://sec-bit.github.io/blog/en/categories/crypto-wallet/)
[vulnerability](https://sec-bit.github.io/blog/en/categories/vulnerability/)

> Authors: [p0n1](https://twitter.com/ErrNil) and [outoflegend](https://twitter.com/outoflegend) from [SECBIT Labs](https://secbit.io/)

Read highlights, join the discussion, and share your thoughts on Twitter!

👉👉👉 <https://twitter.com/ErrNil/status/1748203326561509601> 👈👈👈

Update on 2024-01-25: The vulnerability has been assigned as *CVE-2024-23660*. The [CVE entry](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2024-23660) is now available.

Update on 2024-01-24: The security researchers who disclosed the [Milk Sad](https://milksad.info/) vulnerability in Libbitcoin have reviewed our analysis and reproduced this vulnerability. Their awesome writeup can be found [here](https://milksad.info/posts/research-update-5/).

## How Did Our Investigation Begin?

On 2023-07-12, numerous ETH wallets were hacked, and the funds were transferred to the address 0xAa8B55e21ef3df5f15adf4d0F49D3bfa854e9125. Victims claimed to have used different crypto wallets, some even claiming they hadn’t accessed their wallets for a long time. Some even said their wallets were air-gapped or used as cold storage.

These claims raised questions in our minds, hinting at something more significant. These questions prompted us to start the investigation.

## Were Single or Multiple Wallet Providers Affected? Why?

We have seen user reports on social media with at least three types of wallets, including Trust Wallet and Klever Wallet. Fortunately, @klever\_io quickly responded to this hack, pointing out that it was related to an already-known exploit caused by low entropy mnemonic. It was similar to the one reported by [Trust Wallet’s browser extension in April 2023](https://blog.ledger.com/Funds-of-every-wallet-created-with-the-Trust-Wallet-browser-extension-could-have-been-stolen). They also stated that this issue was not exclusive to Klever. Reports suggested that multiple wallet providers were affected, providing insight and direction into the possible reasons behind the hacking. However, **no other wallets** except @klever\_io have confirmed the issue.

## When Were the Affected Wallets Created?

Investigating a crypto wallet hack requires detailed user reports, including wallet creation dates and the wallet brand or product version used. Unfortunately, we couldn’t find enough affected users online, as many were unaware of the hack, and others couldn’t recall their wallet creation details accurately. We opted to utilize on-chain data for quick analysis.

You can find more details and findings in our previous tweet thread [here](https://twitter.com/ErrNil/status/1679533412112293888).

> 1/🧵 Investigating the recent hack… many wallets created between 2017-06-30 and 2023-06-04 were affected! The most victims are from July 2018. Please check if you’re one of them.

The hack is not limited to a single wallet. Many victims were hacked, transferring funds to 0xAa8B55e21ef3df5f15adf4d0F49D3bfa854e9125. A lack of reports online could be due to the affected addresses being old and unchecked.

Quick research on on-chain data using @DuneAnalytics provided important findings. The analytics dashboard can be found [here](https://dune.com/echo_/2023-07-12-low-entropy-wallets-hack-analysis).

Most intriguing was the wallet creation date. A common vulnerability might link the hacked addresses. Some addresses never sent out any transactions, only receiving funds. The oldest wallet hacked was created on 2017-06-30, and the latest on 2023-06-04. It provides significant evidence that not a single provider was targeted, and the vulnerable product might still be in production. **Most addresses were created in 2018/2019, with the most being created in July and August 2018.**

![Wallet Creation Date By Month](./img/wallet-creation-date-by-month.png)

However, this may not cover all the affected wallets, as the hacker might have scanned for addresses with value, and some wallets may still be unknown.

As a result, we encouraged users whose wallets were created during this period and who were using the reported products to check for themselves.

## Is Trust Wallet Involved Once Again?

As most victims claimed to use Trust Wallet, one of the most active crypto wallets in 2018, even [acquired by Binance in July 2018](https://techcrunch.com/2018/07/31/crypto-exchange-binance-buys-trust-wallet-in-first-acquisition-deal), we suspected some underlying issues in their code.

Trust Wallet had [disclosed a low entropy vulnerability](https://community.trustwallet.com/t/browser-extension-wasm-vulnerability-postmortem/750787) in their browser extension in April 2023. Could something similar have occurred in their wallet history?

We expected their team to recognize the potential issue and initiate a self-check if enough users reported the hack or if they saw the news about it.

With that in mind, we set it aside for the moment and returned to our own work.

## A New Disclosure Called Milk Sad Brings Us Back

On 2023-08-09, an article captured our attention. Researchers [uncovered](https://milksad.info/disclosure.html) a cryptographic weakness in the Libbitcoin Explorer (bx) cryptocurrency wallet tool, leading to recent wallet thefts. After carefully reviewing their detailed writeup, we believe this vulnerability is closely related to the hack we previously investigated. Both incidents occurred on July 12, providing an excellent reason to suspect they originated from the same hacker.

On August 11, 2023, @cz\_binance [wrote about this vulnerability](https://twitter.com/cz_binance/status/1689891966249541632) asserted that Trust Wallet was unaffected.

> This vulnerability is due to the random number generator using a 32-bit seed, which is not sufficiently random against modern cracking techniques such as GPUs. @Trustwallet and @Binance wallets do not use this for seed phrase generation. 🙏

However, we became convinced that the libbitcoin vulnerability **was not solely responsible** for the hack we had previously analyzed. It mainly affected Bitcoin users, and the amount of money involved was considerably smaller.

With these new insights, we decided to reopen the investigation.

## Dig on Trust Wallet

Given our previous observations, many compromised wallets were created in July and August 2018, and many users reported using Trust Wallet. The open-source nature of Trust Wallet allowed us to delve into its code from that period.

Upon reviewing the repositories they might have utilized at the time for iOS, we had to navigate through a few dependencies due to the separate repositories in use.

Trust Wallet’s iOS platform relied on the [`trezor-crypto`](https://github.com/trezor/trezor-crypto/) library to generate BIP39 mnemonic words.

In `trezor-crypto/bip39.c`, we noticed:

Copy

| ```  [1](#hl-0-1)  [2](#hl-0-2)  [3](#hl-0-3)  [4](#hl-0-4)  [5](#hl-0-5)  [6](#hl-0-6)  [7](#hl-0-7)  [8](#hl-0-8)  [9](#hl-0-9) [10](#hl-0-10) [11](#hl-0-11)  ``` | ``` const char *mnemonic_generate(int strength) {     if (strength % 32 || strength < 128 || strength > 256) {         return 0;     }     uint8_t data[32];     random_buffer(data, 32);     const char *r = mnemonic_from_data(data, strength / 8);     memzero(data, sizeof(data));     return r; } ``` |
| --- | --- |

This function hinges on the `trezor-crypto` library to generate a random number, the seed/entropy for producing mnemonic words.

The `trezor-crypto/rand.c` section, however, is where things get intriguing:

Copy

| ```  [1](#hl-1-1)  [2](#hl-1-2)  [3](#hl-1-3)  [4](#hl-1-4)  [5](#hl-1-5)  [6](#hl-1-6)  [7](#hl-1-7)  [8](#hl-1-8)  [9](#hl-1-9) [10](#hl-1-10) [11](#hl-1-11) [12](#hl-1-12) [13](#hl-1-13) [14](#hl-1-14) [15](#hl-1-15) [16](#hl-1-16) [17](#hl-1-17) [18](#hl-1-18) [19](#hl-1-19) [20](#hl-1-20) [21](#hl-1-21) [22](#hl-1-22) [23](#hl-1-23) [24](#hl-1-24) [25](#hl-1-25) [26](#hl-1-26) [27](#hl-1-27) [28](#hl-1-28) [29](#hl-1-29) [30](#hl-1-30) [31](#hl-1-31) [32](#hl-1-32) [33](#hl-1-33) [34](#hl-1-34) [35](#hl-1-35) [36](#hl-1-36) [37](#hl-1-37) [38](#hl-1-38) [39](#hl-1-39) [40](#hl-1-40) [41](#hl-1-41) [42](#hl-1-42) [43](#hl-1-43)  ``` | ``` #include "rand.h" #ifndef RAND_PLATFORM_INDEPENDENT #pragma message("NOT SUITABLE FOR PRODUCTION USE!") // The following code is not supposed to be used in a production environment. // It's included only to make the library testable. // The message above tries to prevent any accidental use outside of the test environment. // // You are supposed to replace the random32() function with your own secure code. // There is also a possibility to replace the random_buffer() function as it is defined as a weak symbol. #include <stdio.h> #include <time.h> uint32_t random32(void) {     static int initialized = 0;     if (!initialized) {         srand((unsigned)time(NULL));         initialized = 1;     }     return ((rand() & 0xFF) | ((rand() & 0xFF) << 8) | ((rand() & 0xFF) << 16) | ((uint32_t) (rand() & 0xFF) << 24)); } #endif /* RAND_PLATFORM_INDEPENDENT */ // // The following code is platform independent // void __attribute__((weak)) random_buffer(uint8_t *buf, size_t len) {     uint32_t r = 0;     for (size_t i = 0; i < len; i++) {         if (i % 4 == 0) {             r = random32();         }         buf[i] = (r >> ((i % 4) * 8)) & 0xFF;     } } ``` |
| --- | --- |

The answer, it turned out, was right there in front of us!

## What Was the Root Cause of the Vulnerability?

Breaking down the original code, it incorporates two distinct functions: `random32()` and `random_buffer()`.

The `random32()` function initializes the random seed only once, using the current time in seconds. This seed is then used to generate a 32-bit random value through the repeated calling of the `rand()` function. Notably, the `rand()` function is not suitable for cryptographic purposes, as many implementations of it are easily [broken or exploited](https://crypto.stackexchange.com/questions/52000/how-can-c-rand-be-exploited-if-a-secure-seed-is-used). The core security weakness here is the usage of `srand((unsigned)time(NULL))`, which seeds the random number generator based on the current time. This predictable value could allow an attacker to guess the state of the random number generator if they have an idea of when the generator was seeded. If two users generate mnemonic words at the exact same second, they will get the same seed, leading to identical wallet addresses. This weakened seeding reduces the key space, making wallet keys very predictable.

The `random_buffer()` function functions by filling a buffer with arbitrary bytes via repeated calls to `random32()`, extracting 8-bit chunks from the resultant 32-bit value. Its frailty is intrinsically linked to `random32()`’s aforementioned vulnerability, whereby its predictability is its downfall.

Deploying this code unaltered for BIP39 mnemonic word generation would inherently limit the key space. Instead of an expansive array of mnemonic combinations, the key space would merely extend to unique timestamps in seconds. A shrewd hacker could exploit this by systemically generating mnemonics for each timestamp within a conceivable timeframe, linking them to specific wallet addresses. This strategy could trigger large-scale wallet breaches and unauthorized fund transfers if executed broadly.

The code provides an unequivocal warning that it isn’t tailored for production use, and it emphatically recommends supplanting the random functions with more secure counterparts. Overlooking this warning and deploying the code in an authentic environment represents a critical error. The sanctity of cryptographic keys hinges on robust, unforeseeable random number generation, and this code fails to meet that benchmark.

Regrettably, Trust Wallet sidestepped these warnings, opting to implement the aforementioned code directly in a live environment. This oversight precipitated the generation of low entropy mnemonic words that were effortlessly predictable.

## Which Versions of Trust Wallet Were Affected and Vulnerable?

Trust Wallet iOS’s vulnerability is traced back to a chain of dependencies: `trust-wallet-ios -> trust-keystore -> trust-core -> trezor-crypto-ios`. The [trezor-crypto-ios](https://github.com/trustwallet/trezor-crypto-ios) repository, a CocoaPods wrapper around the trezor-crypto C library, didn’t replace the vulnerable `random32()` or `random_buffer()` functions, resulting in the previously mentioned issues.

The vulnerable code was introduced in trezor-crypto-ios repository in commit 3cd6e8f647fbba8b5d8844fcd144365a086b629f, git tag 0.0.4, on February 5, 2018.

The final vulnerable commit for the trezor-crypto-ios repository was b23e468d462a9556006552b1d610f6bfb300c52a with pod version `0.0.6`. Trust developers later fixed the vulnerability in commit 11ef918a089e25580fd8fa0c14a7b62a338cb2db, where they introduced the `util/SecRandom.m`. This new implementation replaced the unsafe `random32()` and `random_buffer()` functions.

In the new version, `random32()` now utilizes `SecRandomCopyBytes()` to generate a 32-bit random value, employing the iOS Security framework to ensure cryptographic security. Unlike the previous function, it doesn’t rely on time-based seeding, thus eliminating the associated security risk. Similarly, `random_buffer()` has been changed to use `SecRandomCopyBytes()`, filling the buffer with cryptographically secure random values, and overcoming the weaknesses in the original code.

Trust Wallet’s Fix Timeline:

* **trezor-crypto-ios**: Fixed on July 16, 2018, commit 11ef918a089e25580fd8fa0c14a7b62a338cb2db, pod version 0.0.7, adding safe `random32()` and `random_buffer()` functions.
* **trust-core**: Fixed on August 8, 2018, commit e8686eb9dd993dfe5f96236edad847362c21fc5c, pod version 0.1.2, by updating TrezorCrypto to 0.0.7.
* **trust-keystore**: Fixed on August 8, 2018, commit eb94ba0bf728bfc8012729b99f5fc36e51256206, pod version 0.4.3, by updating trust-core to 0.1.2.
* **trust-wallet-ios**: Fixed on August 21, 2018, commit 0c716fdc4b04a91e4cdb274c96aef45952f7e354, by updating dependencies.

However, the date and version when the fixed wallet was released to the iOS App Store **remain uncertain**. Additionally, the situation concerning the Trust Wallet Android version is unclear due to a lack of commit history, leaving questions about whether it was affected similarly.

## Are There Any Wallets and Products Still Vulnerable in Production?

Though Trust Wallet fixed the identified vulnerability in 2018, users employing outdated app versions could still be at risk if they have not updated to the secure version.

Numerous wallets have forked from Trust Wallet, and they may historically be or continue to be vulnerable.

It’s alarming that users may still use wallets created during the vulnerable period. Without awareness of the issue, they may face further loss of funds.

Our analysis of on-chain data reveals that wallets created between June 30, 2017, and June 4, 2023, were compromised. This evidence suggests that vulnerable wallets and products may still be in use. Additionally, a similar vulnerability known as the “Milk Sad” in libbitcoin may have contributed to these breaches and remains a live concern.

Investigations into other potential vulnerable wallet providers are ongoing.

## Some Fun Facts About What Is Trust Wallet’s “Fomo3D Summer”

Examining [on-chain data](https://dune.com/echo_/2023-07-12-low-entropy-wallets-hack-analysis), we discovered a surge in victims in July and August 2018, peaking precisely within those months and declining after that. Wallets compromised before July 2018 were rare, possibly indicating a major crypto wallet provider’s release of a vulnerable product version in July, followed by a fixed version in August.

![Wallet Creation Date By Day](img/wallet-creation-date-by-day.png)

A staggering 119 wallets were created on July 21, 2018. Analyzing these wallet addresses reveals that most of them were involved in [the famous Fomo3D](https://etherscan.io/address/0xa62142888aba8370742be823c1782d17a0389da1) [game](https://secbit.io/blog/en/2018/08/23/how-the-winner-got-fomo3d-prize-a-detailed-explanation/), popular at that time. Evidence can still be found of people writing about Fomo3D and providing [tutorials](https://hackmd.io/s/r18NzXQSQ) on participating in the game **using Trust Wallet**, a well-designed wallet that enabled interaction with DApps. Trust Wallet’s popularity during this “DApp summer” even led to its acquisition by Binance.

![Fomo3D](img/FOMO3D.jpeg)

This on-chain story aligns with Trust Wallet’s Git history, inspiring us to label this vulnerability and associated incident “Trust Wallet’s Fomo3D Summer.”

![Fomo3D Balance on Etherscan](img/etherscan-fomo3d.png)

## What Has Been the Impact of This Vulnerability?

Trust Wallet, boasting a significant user base, is among the most prominent mobile crypto wallet providers. Due to its extensive reach and open-source nature from the start, numerous public and private forks may have adopted its vulnerable versions.

Through analyzing the earnings of the address 0xAa8B55e21ef3df5f15adf4d0F49D3bfa854e9125 on the ETH mainnet, we discovered that assets have been stolen from over 2100 victims, resulting in a loss of more than 1360 ETH. This only accounts for the ETH mainnet loss. Theft also occurred on other chains, including but not limited to Bitcoin, Binance chain, Arbitrum, Polygon, and Optimism, leading to losses across different hacker addresses.

![Hacker on Bloxy](img/bloxy-hacker.png)

Suppose these thefts all originated from the same or similar vulnerability, and there is strong evidence to suggest they did. In that case, the total loss must exceed $3 million at the time of writing. However, Trust Wallet is unlikely to be the sole cause of these breaches. Some users claim to have used other wallets, although these could be forks of Trust Wallet.

Calculating the precise loss is a complex task requiring substantial time, computation, and query resources. The challenges include early theft before massive hacks, ongoing theft, stolen funds across multiple blockchains and addresses, and shared vulnerability across different wallets. All these factors complicate a clear assessment of the total impact.

Besides, hackers **are watching all** those vulnerable wallets in all blockchains. They will sweep away the assets in the affected wallets in a short time when anyone deposits funds into them.

## Timeline

* **2023/07/12:** The low entropy wallet hack occurred and was observed.
* **2023/07/13:** Klever Wallet disclosed that this hack affected their product and stated that the issue was not exclusive to them. [Tweet](https://twitter.com/klever_io/status/1679267565434986501)
* **2023/07/14:** We initially analyzed the low-entropy wallet hack. [Tweet](https://twitter.com/ErrNil/status/1679533412112293888)
* **2023/07/15:** Trust Wallet’s CEO clarified that the vulnerability was unrelated to them and that they were still investigating. [Tweet](https://twitter.com/EowynChen/status/1680013484216524802)
* **2023/08/09:** Attention was drawn to a vulnerability called “Milk Sad” in Libbitcoin, which was disclosed. [Details](https://milksad.info/disclosure.html)
* **2023/08/11:** CZ claimed that Trust Wallet was not affected by the low entropy vulnerability in seed generation, prompting us to reopen our investigation into the hack. [Tweet](https://twitter.com/cz_binance/status/1689891966249541632)
* **2023/08/14:** We identified the predictable random number generation issue in Trust Wallet’s code in 2018 and completed a PoC.
* **2023/08/16:** We reported the vulnerability to the Binance Trust Wallet team.
* **2023/08/17:** Binance confirmed our report and said they would discuss and further investigate the issue.

The timeline becomes boring when we converse with the Binance Team in the following **FIVE months**. But it is still essential because it clarifies what the Binance or Trust Wallet team and we have done during the past months. So, we summarize it here with Mistral LLM. We may publish the entire conversation history if anyone is interested in the details.

* **2023/08/21:** We inquired about the progress related to the vulnerability.
* **2023/08/23:** We reminded Binance about the vulnerability and informed them that we were considering applying for a CVE ID to standardize vulnerability disclosure.
* **2023/08/30:** We updated Binance about resolving the issue mentioned earlier on the 2018-07-XX issue. Now, we could restore many wallets created before that date. We asked Binance to share their progress or plans.
* **2023/09/05:** Binance requested active addresses vulnerable to the issue for verification purposes.
* **2023/09/06:** We explained the challenges in identifying active addresses, as it required sending many requests to nodes and was time-consuming. We provided Binance with a list of vulnerable ETH mainnet addresses created during a specific period that met the active description.
* **2023/09/20:** We asked Binance for updates, as we had been waiting to receive news for two weeks. We also informed them that we could provide all potential vulnerable ETH addresses from Trust Wallet.
* **2023/09/21:** Binance requested all potential vulnerable addresses. We shared the link to a file called `eth_addrs`.
* **2023/09/27:** We noticed that Binance had yet to download the data we provided and inquired if they had encountered any issues.
* **2023/10/03:** Binance informed us that the link had expired and requested a new one.
* **2023/10/07:** We provided Binance with a new link.
* **2023/10/19:** We followed up with Binance, requesting an update on the current status of the vulnerability’s resolution, an estimated timeline for complete resolution and public disclosure, and any additional information or assistance they might need from us.
* **2023/10/26:** We sent a final follow-up and notice of upcoming public disclosure due to the 90-day disclosure deadline, as it had been over two months since our initial communication, and we had yet to receive a substantive update or a clear resolution timeline from Binance.
* **2023/10/27:** Binance claimed they hadn’t found any active addresses or assets in the list. They also mentioned that they were still running scans and would provide further updates once completed.
* **2023/10/27:** We informed Binance that the hackers had already swept away the assets in the affected wallets and that their approach of individually notifying users after finding wallets with balance was too slow and ineffective.
* **2023/11/15:** We inquired if Binance had any updates, as the time mentioned earlier for disclosure had passed. We suggested that if Binance could not handle the issue quickly or correctly, it would be better to let the community help.
* **2023/11/17:** Binance informed us that there wasn’t any remaining balance within the affected ETH addresses, and they were reviewing the BSC addresses balances. They recalled informing users of the affected wallets in 2018 and suggested relocating their funds to a safer location. They were currently identifying whether any affected wallet users were using Trust Wallet and planned to send 1-1 notifications to each user, reminding them not to employ the compromised wallets again.
* **2023/11/17:** We expressed our doubts about Binance’s claim of informing affected users in 2018 and requested evidence of such notifications. We also suggested they proactively consider and mitigate the risks of notifying affected users.
* **2023/11/22:** Binance requested sample addresses compromised in the 2023-07-12 hack.
* **2023/11/22:** We provided Binance with compromised sample addresses that could be found in the `eth_addrs` list we provided earlier.
* **2023/12/04:** Binance informed us that there was no match with their DB on the addresses we shared, and they were still checking for the other addresses.
* **2023/12/04:** We questioned the accuracy of Binance’s DB and provided them with the addresses of two real users who created wallets using Trust Wallet and were hacked in the incident.
* **2024/01/08:** Binance claimed that the 2023-07-12 incident was not unique to Trust Wallet and may be attributed to various sources that generated weak private keys. They also mentioned an extremely low percentage of matches in their database and that the incident was unlikely to target Trust Wallet users.

Until now, too much time has been spent on dealing with and tracking this vulnerability. We cannot understand why this would take the Trust Wallet team so long to handle and ultimately lead to the conclusion that Trust Wallet users are not the primary victims.

## What Do We Think About Trust Wallet’s Response?

We provided the Trust Wallet team with the set of potential ETH addresses generated by the vulnerable Trust Wallet code. The address set is over 28 GB. We can recover the private keys for all of these addresses. We also analyzed all of the victim addresses in the hack on July 12, 2023, and found that out of the 2112 addresses, 1756 addresses can be matched with the address set we provided. Besides, we offered two real Trust Wallet users who were victims. Therefore, we believe that most users affected in the July 12, 2023 hack were Trust Wallet users or users of Trust Wallet Fork products.

However, the Trust Wallet team claims that most addresses were not found in their user database, and therefore the hack on July 12, 2023 was not targeted at Trust Wallet users.

As we analyzed from multiple other angles, such as on-chain data, Git commit history, and the popularity of Fomo3D at the time, it is clear that Trust Wallet is closely related to this hack.

The Trust Wallet team mentioned almost no balance on all the addresses we provided to them. In fact, all addresses with balances had been emptied by the hackers.

The Trust Wallet team claimed they notified the affected wallet addresses in 2018. The number of users using Trust Wallet is huge, and such a level of notification at that time would definitely become news. However, we cannot find any evidence. We hope that Trust Wallet can provide proof.

The Trust Wallet team wants to find the affected active addresses with balances. This is an impossible task because before the team finds them, the quick-acting hackers will definitely clean them out.

Considering the number of Trust Wallet users and potentially affected users, it is almost impossible for the Trust Wallet team to quietly complete the notification and migration work for the affected wallets.

Furthermore, we may understand that the Binance and Trust Wallet team do not have the motivation to dig into this issue. So we have decided to disclose this vulnerability now. As we previously mentioned to Trust Wallet, “If your team can’t handle this issue quickly/correctly, it would be better to let the community help you.”

Wallet products must prioritize user safety over any new features. We can easily find helpless victims [crying](https://www.reddit.com/r/trustwalletcommunity/comments/150qpcp/trust_wallet_hacked_trust_vulnerability/) on the internet. What is even more terrifying is that there are still many victims and potential victims who are not aware of this issue. Transparency is crucial.

In the crypto world, one of the scariest things we can imagine is that users carefully place their assets in a crypto wallet and guard them well. However, hackers can still calculate their mnemonic phrase and empty their lifetime savings, even if their device is not connected to the network and has no interaction with the outside world.

## What Is Behind This Vulnerability?

The vulnerability discovered in Trust Wallet stemmed from the misuse of the trezor-crypto library, a tool widely employed in the industry. Concerns about the potential problems arising from misusing trezor’s library were raised by @brandonarvanaghi on May 7, 2019, in this [article](https://medium.com/%40brandonarvanaghi/analyzing-trezor-firmware-mnemonic-seed-generation-for-bitcoin-and-ethereum-4b03fbaad24d).

> “It is ill-advised to provide a default implementation of a cryptography library that is completely insecure. The git history shows that random32() at one time pulled from /dev/urandom, and another time used a predictable timestamp as the seed. Throwing an exception is the only correct option here, regardless of allowing users to ’test’ the library out of the box.”

This concern became a reality in the case of Trust Wallet, leading to a vulnerability that was forked and utilized by numerous projects, causing widespread issues.

Of course, the Trust Wallet may not be the only one who misused the trezor-crypto library. There may be many other unknown projects that have similar vulnerabilities. Someone could even blame the trezor-crypto library for quietly changing to an insecure default implementation, causing fatal flaws in projects that use it as a underlying dependency.

However, after several similar security incidents, every crypto wallet developer and even user should conduct a self-check and ask a simple but vital question: Where does my wallet’s random number originate from, and is it secure enough?

Realizing that their wallet mnemonic words are insecure can be deeply unsettling for users. Even with caution and using a wallet as a cold storage solution, theft can still occur. Therefore, it is imperative not to trust any single wallet unquestioningly but to conduct your own research and consider utilizing a multi-signature wallet instead.

## What’s Next?

We have disclosed this vulnerability to the public and will continue to track the progress of the Trust Wallet team. We hope that they take this issue seriously and take action to protect their users.

There is still a lot of valuable and interesting work to be done, such as analyzing all vulnerable wallet addresses that have been used, and providing a service for users to check if they are affected. There is also a challenging task, which is to find an effective way to distinguish whether an affected wallet is from Trust Wallet, a forked product of Trust Wallet, or another project that misuses the trezor-crypto library.

As a wallet user, there will definitely be many **new migration or compensation scams** targeting Trust Wallet in the future. Please be careful and verify the authenticity of any statements. Only trust official announcements, and do not click on links carelessly. Do not share your mnemonic phrase with anyone.

## Credit

Thank you to all users who shared with us during the early investigation of the hack and vulnerability. Especially a [kind-hearted user](https://twitter.com/ellismarkman) who even shared his mnemonic phrase with us, which helped us greatly confirm the vulnerability.

Thank you to the Trust Wallet team for their years of open-source work, which has provided a certain degree of transparency.

Credit to @brandonarvanaghi for his early warning about the trezor-crypto library.

Credit to researchers who disclosed the [Milk Sad](https://milksad.info/) vulnerability in Libbitcoin.

We may also share more details about the vulnerability reproduction later on, as it’s not that easy, and more stories will be behind it.

Author
p0n1 and outoflegend

LastMod
2024-11-12
[(e33a3b2)](https://github.com/sec-bit/blog/commit/e33a3b25cd08c6b55f56e2de3213e80faf91512b "fix link to dune")

fix link to dune

License
If you need to reprint, please indicate the author and source of the article.

[Trust Wallet](https://sec-bit.github.io/blog/en/tags/trust-wallet/)
[Fomo3D](https://sec-bit.github.io/blog/en/tags/fomo3d/)
[Low Entropy](https://sec-bit.github.io/blog/en/tags/low-entropy/)
[Vulnerability](https://sec-bit.github.io/blog/en/tags/vulnerability/)
[Hacking](https://sec-bit.github.io/blog/en/tags/hacking/)
[Binance](https://sec-bit.github.io/blog/en/tags/binance/)
[Crypto Wallet](https://sec-bit.github.io/blog/en/tags/crypto-wallet/)
[Mnemonic](https://sec-bit.github.io/blog/en/tags/mnemonic/)
[Seed](https://sec-bit.github.io/blog/en/tags/seed/)
[Random Number](https://sec-bit.github.io/blog/en/tags/random-number/)
[Libbitcoin](https://sec-bit.github.io/blog/en/tags/libbitcoin/)
[Milk Sad](https://sec-bit.github.io/blog/en/tags/milk-sad/)

[Notes on FRI-Binius (Part I): Binary Towers
Prev](/blog/en/2024/10/31/binius-01/)
[The 'Input Aliasing' bug caused by a contract library of zkSNARKs
Next](/blog/en/2019/07/29/the-input-aliasing-bug-caused-by-a-contract-library-of-zksnarks/)

Table of Contents

* [How Did Our Investigation Begin?](#how-did-our-investigation-begin)
* [Were Single or Multiple Wallet Providers Affected? Why?](#were-single-or-multiple-wallet-providers-affected-why)
* [When Were the Affected Wallets Created?](#when-were-the-affected-wallets-created)
* [Is Trust Wallet Involved Once Again?](#is-trust-wallet-involved-once-again)
* [A New Disclosure Called Milk Sad Brings Us Back](#a-new-disclosure-called-milk-sad-brings-us-back)
* [Dig on Trust Wallet](#dig-on-trust-wallet)
* [What Was the Root Cause of the Vulnerability?](#what-was-the-root-cause-of-the-vulnerability)
* [Which Versions of Trust Wallet Were Affected and Vulnerable?](#which-versions-of-trust-wallet-were-affected-and-vulnerable)
* [Are There Any Wallets and Products Still Vulnerable in Production?](#are-there-any-wallets-and-products-still-vulnerable-in-production)
* [Some Fun Facts About What Is Trust Wallet’s “Fomo3D Summer”](#some-fun-facts-about-what-is-trust-wallets-fomo3d-summer)
* [What Has Been the Impact of This Vulnerability?](#what-has-been-the-impact-of-this-vulnerability)
* [Timeline](#timeline)
* [What Do We Think About Trust Wallet’s Response?](#what-do-we-think-about-trust-wallets-response)
* [What Is Behind This Vulnerability?](#what-is-behind-this-vulnerability)
* [What’s Next?](#whats-next)
* [Credit](#credit)

Powered by [Hugo](https://gohugo.io)

|
Theme - [Jane](https://github.com/xianmin/hugo-theme-jane)

©
2018 -
2024

SECBIT Labs



=== Content from github.com_f757b691_20250115_213031.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftrezor%2Ftrezor-crypto%2Fcommit%2F2e528be1e91dd48c0e55061fbdd40ccf8b285559)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftrezor%2Ftrezor-crypto%2Fcommit%2F2e528be1e91dd48c0e55061fbdd40ccf8b285559)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=trezor%2Ftrezor-crypto)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

This repository has been archived by the owner on Nov 16, 2021. It is now read-only.

[trezor](/trezor)
/
**[trezor-crypto](/trezor/trezor-crypto)**
Public archive

* [Notifications](/login?return_to=%2Ftrezor%2Ftrezor-crypto) You must be signed in to change notification settings
* [Fork
  204](/login?return_to=%2Ftrezor%2Ftrezor-crypto)
* [Star
   503](/login?return_to=%2Ftrezor%2Ftrezor-crypto)

* [Code](/trezor/trezor-crypto)
* [Issues
  0](/trezor/trezor-crypto/issues)
* [Pull requests
  0](/trezor/trezor-crypto/pulls)
* [Actions](/trezor/trezor-crypto/actions)
* [Projects
  0](/trezor/trezor-crypto/projects)
* [Security](/trezor/trezor-crypto/security)
* [Insights](/trezor/trezor-crypto/pulse)

Additional navigation options

* [Code](/trezor/trezor-crypto)
* [Issues](/trezor/trezor-crypto/issues)
* [Pull requests](/trezor/trezor-crypto/pulls)
* [Actions](/trezor/trezor-crypto/actions)
* [Projects](/trezor/trezor-crypto/projects)
* [Security](/trezor/trezor-crypto/security)
* [Insights](/trezor/trezor-crypto/pulse)

## Commit

[Permalink](/trezor/trezor-crypto/commit/2e528be1e91dd48c0e55061fbdd40ccf8b285559)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

add warning message to rand.c

[Browse files](/trezor/trezor-crypto/tree/2e528be1e91dd48c0e55061fbdd40ccf8b285559)
Browse the repository at this point in the history

* Loading branch information

[![@prusnak](https://avatars.githubusercontent.com/u/42201?s=40&v=4)](/prusnak)

[prusnak](/trezor/trezor-crypto/commits?author=prusnak "View all commits by prusnak")
committed
Jan 21, 2018

1 parent
[bb4c3d0](/trezor/trezor-crypto/commit/bb4c3d052561bd31856a03d975ca226571f6a893)

commit 2e528be

 Show file tree

 Hide file tree

Showing
**2 changed files**
with
**19 additions**
and
**23 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* rand.c
  [rand.c](#diff-f5da78f0f2e2c1b2d53f65e12d203219437dcc4fc4ddcd772c89375ec1791426)
* rand.h
  [rand.h](#diff-21acb16a7f9339fbe9d5e6b1016ba0ce6ced7ec905480a0422673e64757d02ac)

## There are no files selected for viewing

39 changes: 17 additions & 22 deletions

39
[rand.c](#diff-f5da78f0f2e2c1b2d53f65e12d203219437dcc4fc4ddcd772c89375ec1791426 "rand.c")

Show comments

[View file](/trezor/trezor-crypto/blob/2e528be1e91dd48c0e55061fbdd40ccf8b285559/rand.c)
Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -25,32 +25,27 @@ |
|  |  |  |
|  |  | #ifndef RAND\_PLATFORM\_INDEPENDENT |
|  |  |  |
|  |  |  |
|  |  | #pragma message("NOT SUITABLE FOR PRODUCTION USE!") |
|  |  |  |
|  |  | // The following code is not supposed to be used in a production environment. |
|  |  | // It's included only to make the library testable. |
|  |  | // The message above tries to prevent any accidental use outside of the test environment. |
|  |  | // |
|  |  | // You are supposed to replace the random32() function with your own secure code. |
|  |  | // There is also a possibility to replace the random\_buffer() function as it is defined as a weak symbol. |
|  |  |  |
|  |  | #include <stdio.h> |
|  |  | #ifdef \_WIN32 |
|  |  | #include <time.h> |
|  |  | #else |
|  |  | #include <assert.h> |
|  |  | #endif |
|  |  |  |
|  |  | uint32\_t random32(void) |
|  |  | { |
|  |  | #ifdef \_WIN32 |
|  |  | static int initialized = 0; |
|  |  | if (!initialized) { |
|  |  | srand((unsigned)time(NULL)); |
|  |  | initialized = 1; |
|  |  | } |
|  |  | return ((rand() % 0xFF) | ((rand() % 0xFF) << 8) | ((rand() % 0xFF) << 16) | ((rand() % 0xFF) << 24)); |
|  |  | #else |
|  |  | static FILE \*frand = NULL; |
|  |  | if (!frand) { |
|  |  | frand = fopen("/dev/urandom", "r"); |
|  |  | } |
|  |  | uint32\_t r; |
|  |  | size\_t len\_read = fread(&r, 1, sizeof(r), frand); |
|  |  | assert(len\_read == sizeof(r)); |
|  |  | return r; |
|  |  | #endif |
|  |  | } |
|  |  |  |
|  |  | #endif /\* RAND\_PLATFORM\_INDEPENDENT \*/ |
| Expand All | | @@ -59,13 +54,6 @@ uint32\_t random32(void) |
|  |  | // The following code is platform independent |
|  |  | // |
|  |  |  |
|  |  | uint32\_t random\_uniform(uint32\_t n) |
|  |  | { |
|  |  | uint32\_t x, max = 0xFFFFFFFF - (0xFFFFFFFF % n); |
|  |  | while ((x = random32()) >= max); |
|  |  | return x / (max / n); |
|  |  | } |
|  |  |  |
|  |  | void \_\_attribute\_\_((weak)) random\_buffer(uint8\_t \*buf, size\_t len) |
|  |  | { |
|  |  | uint32\_t r = 0; |
| Expand All | | @@ -77,6 +65,13 @@ void \_\_attribute\_\_((weak)) random\_buffer(uint8\_t \*buf, size\_t len) |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | uint32\_t random\_uniform(uint32\_t n) |
|  |  | { |
|  |  | uint32\_t x, max = 0xFFFFFFFF - (0xFFFFFFFF % n); |
|  |  | while ((x = random32()) >= max); |
|  |  | return x / (max / n); |
|  |  | } |
|  |  |  |
|  |  | void random\_permute(char \*str, size\_t len) |
|  |  | { |
|  |  | for (int i = len - 1; i >= 1; i--) { |
| Expand Down | |  |

3 changes: 2 additions & 1 deletion

3
[rand.h](#diff-21acb16a7f9339fbe9d5e6b1016ba0ce6ced7ec905480a0422673e64757d02ac "rand.h")

Show comments

[View file](/trezor/trezor-crypto/blob/2e528be1e91dd48c0e55061fbdd40ccf8b285559/rand.h)
Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -28,8 +28,9 @@ |
|  |  | #include <stdlib.h> |
|  |  |  |
|  |  | uint32\_t random32(void); |
|  |  | uint32\_t random\_uniform(uint32\_t n); |
|  |  | void random\_buffer(uint8\_t \*buf, size\_t len); |
|  |  |  |
|  |  | uint32\_t random\_uniform(uint32\_t n); |
|  |  | void random\_permute(char \*buf, size\_t len); |
|  |  |  |
|  |  | #endif |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `2e528be`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftrezor%2Ftrezor-crypto%2Fcommit%2F2e528be1e91dd48c0e55061fbdd40ccf8b285559) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_b1c6db9a_20250115_213032.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftrezor%2Ftrezor-crypto%2Fcommit%2F009850f6c9afcf60b4c6280afd46868b1a)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftrezor%2Ftrezor-crypto%2Fcommit%2F009850f6c9afcf60b4c6280afd46868b1a)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=trezor%2Ftrezor-crypto)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

This repository has been archived by the owner on Nov 16, 2021. It is now read-only.

[trezor](/trezor)
/
**[trezor-crypto](/trezor/trezor-crypto)**
Public archive

* [Notifications](/login?return_to=%2Ftrezor%2Ftrezor-crypto) You must be signed in to change notification settings
* [Fork
  204](/login?return_to=%2Ftrezor%2Ftrezor-crypto)
* [Star
   503](/login?return_to=%2Ftrezor%2Ftrezor-crypto)

* [Code](/trezor/trezor-crypto)
* [Issues
  0](/trezor/trezor-crypto/issues)
* [Pull requests
  0](/trezor/trezor-crypto/pulls)
* [Actions](/trezor/trezor-crypto/actions)
* [Projects
  0](/trezor/trezor-crypto/projects)
* [Security](/trezor/trezor-crypto/security)
* [Insights](/trezor/trezor-crypto/pulse)

Additional navigation options

* [Code](/trezor/trezor-crypto)
* [Issues](/trezor/trezor-crypto/issues)
* [Pull requests](/trezor/trezor-crypto/pulls)
* [Actions](/trezor/trezor-crypto/actions)
* [Projects](/trezor/trezor-crypto/projects)
* [Security](/trezor/trezor-crypto/security)
* [Insights](/trezor/trezor-crypto/pulse)

## Commit

[Permalink](/trezor/trezor-crypto/commit/009850f6c9afcf60b4c6280afd46868b1a7a1fdd)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Fixed undefined behavior

[Browse files](/trezor/trezor-crypto/tree/009850f6c9afcf60b4c6280afd46868b1a7a1fdd)
Browse the repository at this point in the history

```
This fixes a shift by 32 and shifts on signed integer that overflow.
```

* Loading branch information

[![@jhoenicke](https://avatars.githubusercontent.com/u/897826?s=40&v=4)](/jhoenicke) [![@prusnak](https://avatars.githubusercontent.com/u/42201?s=40&v=4)](/prusnak)

[jhoenicke](/trezor/trezor-crypto/commits?author=jhoenicke "View all commits by jhoenicke")
authored and
[prusnak](/trezor/trezor-crypto/commits?author=prusnak "View all commits by prusnak")
committed
Mar 27, 2018

1 parent
[49272f8](/trezor/trezor-crypto/commit/49272f8d869f1424608760ea52949595c17804e3)

commit 009850f

 Show file tree

 Hide file tree

Showing
**6 changed files**
with
**23 additions**
and
**23 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* address.c
  [address.c](#diff-cc6d43aa01d6b6fb8bc8a4112555b317c97a2e57b36118d806a64f3dc0ce250e)
* bignum.c
  [bignum.c](#diff-3d30768f8c0d6ac05da6b233e6ab24b60d60da374cd7454263405323a3474fe8)
* bip32.c
  [bip32.c](#diff-bc61c1212da56d9fbac6a91fb2437fc024516a42d163edb12575f5541cf64b1a)
* nem.c
  [nem.c](#diff-bcfd2a93f5247992af9082efcd3721931e8ef5ffa38e84122012745184c07470)
* rand.c
  [rand.c](#diff-f5da78f0f2e2c1b2d53f65e12d203219437dcc4fc4ddcd772c89375ec1791426)
* test\_check.c
  [test\_check.c](#diff-e6253fd3c4770767f40cb9b711420494717f3c3193d62b0c146ae9e108477663)

## There are no files selected for viewing

6 changes: 3 additions & 3 deletions

6
[address.c](#diff-cc6d43aa01d6b6fb8bc8a4112555b317c97a2e57b36118d806a64f3dc0ce250e "address.c")

Show comments

[View file](/trezor/trezor-crypto/blob/009850f6c9afcf60b4c6280afd46868b1a7a1fdd/address.c)
Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -45,12 +45,12 @@ bool address\_check\_prefix(const uint8\_t \*addr, uint32\_t address\_type) |
|  |  | return address\_type == (uint32\_t)(addr[0]); |
|  |  | } |
|  |  | if (address\_type <= 0xFFFF) { |
|  |  | return address\_type == ((uint32\_t)(addr[0] << 8) | (uint32\_t)(addr[1])); |
|  |  | return address\_type == (((uint32\_t) addr[0] << 8) | ((uint32\_t) addr[1])); |
|  |  | } |
|  |  | if (address\_type <= 0xFFFFFF) { |
|  |  | return address\_type == ((uint32\_t)(addr[0] << 16) | (uint32\_t)(addr[1] << 8) | (uint32\_t)(addr[2])); |
|  |  | return address\_type == (((uint32\_t) addr[0] << 16) | ((uint32\_t) addr[1] << 8) | ((uint32\_t) addr[2])); |
|  |  | } |
|  |  | return address\_type == ((uint32\_t)(addr[0] << 24) | (uint32\_t)(addr[1] << 16) | (uint32\_t)(addr[2] << 8) | (uint32\_t)(addr[3])); |
|  |  | return address\_type == (((uint32\_t) addr[0] << 24) | ((uint32\_t) addr[1] << 16) | ((uint32\_t) addr[2] << 8) | ((uint32\_t) addr[3])); |
|  |  | } |
|  |  |  |
|  |  | #if USE\_ETHEREUM |
| Expand Down | |  |

18 changes: 9 additions & 9 deletions

18
[bignum.c](#diff-3d30768f8c0d6ac05da6b233e6ab24b60d60da374cd7454263405323a3474fe8 "bignum.c")

Show comments

[View file](/trezor/trezor-crypto/blob/009850f6c9afcf60b4c6280afd46868b1a7a1fdd/bignum.c)
Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -111,13 +111,13 @@ void bn\_read\_be(const uint8\_t \*in\_number, bignum256 \*out\_number) |
|  |  | void bn\_write\_be(const bignum256 \*in\_number, uint8\_t \*out\_number) |
|  |  | { |
|  |  | int i; |
|  |  | uint32\_t temp = in\_number->val[8] << 16; |
|  |  | uint32\_t temp = in\_number->val[8]; |
|  |  | for (i = 0; i < 8; i++) { |
|  |  | // invariant: temp = (in\_number >> 30\*(8-i)) << (16 + 2i) |
|  |  | // invariant: temp = (in\_number >> 30\*(8-i)) |
|  |  | uint32\_t limb = in\_number->val[7 - i]; |
|  |  | temp |= limb >> (14 - 2\*i); |
|  |  | temp = (temp << (16 + 2\*i)) | (limb >> (14 - 2\*i)); |
|  |  | write\_be(out\_number + i \* 4, temp); |
|  |  | temp = limb << (18 + 2\*i); |
|  |  | temp = limb; |
|  |  | } |
|  |  | } |
|  |  |  |
| Expand Down  Expand Up | | @@ -146,13 +146,13 @@ void bn\_read\_le(const uint8\_t \*in\_number, bignum256 \*out\_number) |
|  |  | void bn\_write\_le(const bignum256 \*in\_number, uint8\_t \*out\_number) |
|  |  | { |
|  |  | int i; |
|  |  | uint32\_t temp = in\_number->val[8] << 16; |
|  |  | uint32\_t temp = in\_number->val[8]; |
|  |  | for (i = 0; i < 8; i++) { |
|  |  | // invariant: temp = (in\_number >> 30\*(8-i)) << (16 + 2i) |
|  |  | // invariant: temp = (in\_number >> 30\*(8-i)) |
|  |  | uint32\_t limb = in\_number->val[7 - i]; |
|  |  | temp |= limb >> (14 - 2\*i); |
|  |  | temp = (temp << (16 + 2\*i)) | (limb >> (14 - 2\*i)); |
|  |  | write\_le(out\_number + (7 - i) \* 4, temp); |
|  |  | temp = limb << (18 + 2\*i); |
|  |  | temp = limb; |
|  |  | } |
|  |  | } |
|  |  |  |
| Expand Down  Expand Up | | @@ -840,7 +840,7 @@ void bn\_inverse(bignum256 \*x, const bignum256 \*prime) |
|  |  | // s + factor\*prime mod 2^k == 0 |
|  |  | // i.e. factor = s \* -1/prime mod 2^k. |
|  |  | // Then compute s + factor\*prime and shift right by k bits. |
|  |  | uint32\_t mask = (1 << k) - 1; |
|  |  | uint32\_t mask = (1u << k) - 1; |
|  |  | uint32\_t factor = (inverse \* us.a[8]) & mask; |
|  |  | temp = (us.a[8] + (uint64\_t) pp[0] \* factor) >> k; |
|  |  | assert(((us.a[8] + pp[0] \* factor) & mask) == 0); |
| Expand Down | |  |

2 changes: 1 addition & 1 deletion

2
[bip32.c](#diff-bc61c1212da56d9fbac6a91fb2437fc024516a42d163edb12575f5541cf64b1a "bip32.c")

Show comments

[View file](/trezor/trezor-crypto/blob/009850f6c9afcf60b4c6280afd46868b1a7a1fdd/bip32.c)
Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -168,7 +168,7 @@ uint32\_t hdnode\_fingerprint(HDNode \*node) |
|  |  | hdnode\_fill\_public\_key(node); |
|  |  | hasher\_Raw(node->curve->hasher\_type, node->public\_key, 33, digest); |
|  |  | ripemd160(digest, 32, digest); |
|  |  | fingerprint = (digest[0] << 24) + (digest[1] << 16) + (digest[2] << 8) + digest[3]; |
|  |  | fingerprint = ((uint32\_t) digest[0] << 24) + (digest[1] << 16) + (digest[2] << 8) + digest[3]; |
|  |  | memzero(digest, sizeof(digest)); |
|  |  | return fingerprint; |
|  |  | } |
| Expand Down | |  |

16 changes: 8 additions & 8 deletions

16
[nem.c](#diff-bcfd2a93f5247992af9082efcd3721931e8ef5ffa38e84122012745184c07470 "nem.c")

Show comments

[View file](/trezor/trezor-crypto/blob/009850f6c9afcf60b4c6280afd46868b1a7a1fdd/nem.c)
Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -214,7 +214,7 @@ bool nem\_transaction\_create\_transfer(nem\_transaction\_ctx \*ctx, |
|  |  |  |
|  |  | bool ret = nem\_transaction\_write\_common(ctx, |
|  |  | NEM\_TRANSACTION\_TYPE\_TRANSFER, |
|  |  | network << 24 | (mosaics ? 2 : 1), |
|  |  | (uint32\_t) network << 24 | (mosaics ? 2 : 1), |
|  |  | timestamp, |
|  |  | signer, |
|  |  | fee, |
| Expand Down  Expand Up | | @@ -292,7 +292,7 @@ bool nem\_transaction\_create\_multisig(nem\_transaction\_ctx \*ctx, |
|  |  |  |
|  |  | bool ret = nem\_transaction\_write\_common(ctx, |
|  |  | NEM\_TRANSACTION\_TYPE\_MULTISIG, |
|  |  | network << 24 | 1, |
|  |  | (uint32\_t) network << 24 | 1, |
|  |  | timestamp, |
|  |  | signer, |
|  |  | fee, |
| Expand Down  Expand Up | | @@ -321,7 +321,7 @@ bool nem\_transaction\_create\_multisig\_signature(nem\_transaction\_ctx \*ctx, |
|  |  |  |
|  |  | bool ret = nem\_transaction\_write\_common(ctx, |
|  |  | NEM\_TRANSACTION\_TYPE\_MULTISIG\_SIGNATURE, |
|  |  | network << 24 | 1, |
|  |  | (uint32\_t) network << 24 | 1, |
|  |  | timestamp, |
|  |  | signer, |
|  |  | fee, |
| Expand Down  Expand Up | | @@ -361,7 +361,7 @@ bool nem\_transaction\_create\_provision\_namespace(nem\_transaction\_ctx \*ctx, |
|  |  |  |
|  |  | bool ret = nem\_transaction\_write\_common(ctx, |
|  |  | NEM\_TRANSACTION\_TYPE\_PROVISION\_NAMESPACE, |
|  |  | network << 24 | 1, |
|  |  | (uint32\_t) network << 24 | 1, |
|  |  | timestamp, |
|  |  | signer, |
|  |  | fee, |
| Expand Down  Expand Up | | @@ -420,7 +420,7 @@ bool nem\_transaction\_create\_mosaic\_creation(nem\_transaction\_ctx \*ctx, |
|  |  |  |
|  |  | bool ret = nem\_transaction\_write\_common(ctx, |
|  |  | NEM\_TRANSACTION\_TYPE\_MOSAIC\_CREATION, |
|  |  | network << 24 | 1, |
|  |  | (uint32\_t) network << 24 | 1, |
|  |  | timestamp, |
|  |  | signer, |
|  |  | fee, |
| Expand Down  Expand Up | | @@ -506,7 +506,7 @@ bool nem\_transaction\_create\_mosaic\_supply\_change(nem\_transaction\_ctx \*ctx, |
|  |  |  |
|  |  | bool ret = nem\_transaction\_write\_common(ctx, |
|  |  | NEM\_TRANSACTION\_TYPE\_MOSAIC\_SUPPLY\_CHANGE, |
|  |  | network << 24 | 1, |
|  |  | (uint32\_t) network << 24 | 1, |
|  |  | timestamp, |
|  |  | signer, |
|  |  | fee, |
| Expand Down  Expand Up | | @@ -544,7 +544,7 @@ bool nem\_transaction\_create\_aggregate\_modification(nem\_transaction\_ctx \*ctx, |
|  |  |  |
|  |  | bool ret = nem\_transaction\_write\_common(ctx, |
|  |  | NEM\_TRANSACTION\_TYPE\_AGGREGATE\_MODIFICATION, |
|  |  | network << 24 | (relative\_change ? 2 : 1), |
|  |  | (uint32\_t) network << 24 | (relative\_change ? 2 : 1), |
|  |  | timestamp, |
|  |  | signer, |
|  |  | fee, |
| Expand Down  Expand Up | | @@ -600,7 +600,7 @@ bool nem\_transaction\_create\_importance\_transfer(nem\_transaction\_ctx \*ctx, |
|  |  |  |
|  |  | bool ret = nem\_transaction\_write\_common(ctx, |
|  |  | NEM\_TRANSACTION\_TYPE\_IMPORTANCE\_TRANSFER, |
|  |  | network << 24 | 1, |
|  |  | (uint32\_t) network << 24 | 1, |
|  |  | timestamp, |
|  |  | signer, |
|  |  | fee, |
| Expand Down | |  |

2 changes: 1 addition & 1 deletion

2
[rand.c](#diff-f5da78f0f2e2c1b2d53f65e12d203219437dcc4fc4ddcd772c89375ec1791426 "rand.c")

Show comments

[View file](/trezor/trezor-crypto/blob/009850f6c9afcf60b4c6280afd46868b1a7a1fdd/rand.c)
Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -45,7 +45,7 @@ uint32\_t random32(void) |
|  |  | srand((unsigned)time(NULL)); |
|  |  | initialized = 1; |
|  |  | } |
|  |  | return ((rand() % 0xFF) | ((rand() % 0xFF) << 8) | ((rand() % 0xFF) << 16) | ((rand() % 0xFF) << 24)); |
|  |  | return ((rand() & 0xFF) | ((rand() & 0xFF) << 8) | ((rand() & 0xFF) << 16) | ((uint32\_t) (rand() & 0xFF) << 24)); |
|  |  | } |
|  |  |  |
|  |  | #endif /\* RAND\_PLATFORM\_INDEPENDENT \*/ |
| Expand Down | |  |

2 changes: 1 addition & 1 deletion

2
[test\_check.c](#diff-e6253fd3c4770767f40cb9b711420494717f3c3193d62b0c146ae9e108477663 "test_check.c")

Show comments

[View file](/trezor/trezor-crypto/blob/009850f6c9afcf60b4c6280afd46868b1a7a1fdd/test_check.c)
Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -3028,7 +3028,7 @@ static void test\_codepoints\_curve(const ecdsa\_curve \*curve) { |
|  |  | for (i = 0; i < 64; i++) { |
|  |  | for (j = 0; j < 8; j++) { |
|  |  | bn\_zero(&a); |
|  |  | a.val[(4\*i)/30] = (2\*j+1) << (4\*i % 30); |
|  |  | a.val[(4\*i)/30] = (uint32\_t) (2\*j+1) << (4\*i % 30); |
|  |  | bn\_normalize(&a); |
|  |  | // note that this is not a trivial test. We add 64 curve |
|  |  | // points in the table to get that particular curve point. |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `009850f`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftrezor%2Ftrezor-crypto%2Fcommit%2F009850f6c9afcf60b4c6280afd46868b1a) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from milksad.info_82165b23_20250115_213035.html ===


* [![](/assets/base/milksad_transparent.svg)
  Milk Sad](/)
* [/summary](/index.html)
* [/updates](/updates.html)
* [/full write-up](/disclosure.html)
* [/faq](/faq.html)

![](/assets/base/milksad_transparent.svg)

# Milk Sad Disclosure

A practical explanation of how weak entropy can ruin your day - and your savings.

## Vulnerability [CVE-2023-39910](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2023-39910)

* We discovered a cryptographic weakness in the widely utilized `Libbitcoin Explorer` (`bx`) cryptocurrency wallet tool while following up on mysterious wallet thefts.
* The `bx seed` subcommand for generation of new wallet private key entropy is flawed and produces insecure output.
* On `Libbitcoin Explorer` `3.x` versions, `bx seed` uses the [Mersenne Twister](https://en.wikipedia.org/wiki/Mersenne_Twister#Disadvantages) pseudorandom number generator (PRNG) [initialized](https://github.com/libbitcoin/libbitcoin-system/blob/a1b777fc51d9c04e0c7a1dec5cc746b82a6afe64/src/crypto/pseudo_random.cpp#L77) with 32 bits of system time.
* Bad actors have discovered this flaw and are actively exploiting it to steal funds from affected wallets on multiple blockchains.
* We have reasons to believe some `Libbitcoin Explorer` versions before `3.0.0` also produce weak `bx seed` output in some system environments.
* Think of this as securing your online bank account with a password manager that creates a long random password, but it often creates the same passwords for every user. Malicious people have figured this out and drained funds on any account they can find.

### How?

![](/assets/base/bx-mastering-bitcoin_left.jpg)
![](/assets/base/bx-mastering-bitcoin_right.jpg)

Mastering Bitcoin - Second Edition by Andreas M. Antonopoulos LLC is licensed under a Creative Commons Attribution-ShareAlike 4.0 International License.

* Popular documentation like â[Mastering Bitcoin](https://bitcoinbook.info)â suggests the usage of `bx seed` for wallet generation.
* Secure cryptography requires a source of large, non-guessable numbers. If the random number generator is weak, the resulting cryptographic usage is almost always compromised.
* For technical people: in this case, practical wallet security is reduced from 128 bit, 192 bit or 256 bit to a mere 32 bit of unknown key information.
* A 32 bit key space is 2^32, or 4,294,967,296 different unique combinations of derived [BIP39](https://en.bitcoin.it/wiki/BIP_0039) mnemonic phrases or other key formats ([BIP32](https://en.bitcoin.it/wiki/BIP_0032)). Spoiler: Thatâs not as many combinations as it sounds.
* With enough optimizations, a decent gaming PC can do a brute-force search through 2^32 wallet combinations in less than a day.
* Since `bx` has a configurable output length and can be used in several ways, there are a few variations the attacker needs to test for each case. This slows down practical attacks to a few days.
* Once an attacker finds a match of a wallet candidate with an actual wallet used on a blockchain, they are in full possession of the private keys and can steal remaining funds, trace all previous wallet history and sign messages.
* The attack works independent of the ownerâs current copy of the wallet secrets. In other words, even if you keep your paper wallet in a bank safe, your funds can still be stolen remotely. Crazy, right?
* Attackers are actively exploiting this and have been draining funds of wallets where the mnemonic was generated using this tool.
* Why the silly âMilk Sadâ name? Running `bx seed` on `3.x` versions with a system time of 0.0 always generates the following secret:
  > milk sad wage cup reward umbrella raven visa give list decorate bulb gold raise twenty fly manual stand float super gentle climb fold park

### When?

The main theft occurred around 12 July 2023, although initial exploitation likely began at a smaller scale in May 2023.

A separate but similar vulnerability in another wallet software was detected in November 2022 and actively exploited shortly after, which may be the prequel to this story.

### Who?

We did not identify who is behind the ongoing thefts from vulnerable wallets.

### Type

[CWE-338: Use of Cryptographically Weak Pseudo-Random Number Generator (PRNG)](https://cwe.mitre.org/data/definitions/338.html)

### Vendor

[Libbitcoin](https://github.com/libbitcoin)

### Further Reading

See our [technical writeup](/disclosure.html), [research updates](/updates.html) and [FAQ](/faq.html).

### Related Vulnerabilities

Trust Wallet:

* [CVE-2023-31290](https://nvd.nist.gov/vuln/detail/CVE-2023-31290) - [vendor advisory](https://community.trustwallet.com/t/browser-extension-wasm-vulnerability-postmortem/750787) and [Ledger Donjonâs technical writeup](https://blog.ledger.com/Funds-of-every-wallet-created-with-the-Trust-Wallet-browser-extension-could-have-been-stolen/)
* [CVE-2024-23660](https://nvd.nist.gov/vuln/detail/CVE-2024-23660) - SECBIT Labsâ [technical disclosure writeup](https://secbit.io/blog/en/2024/01/19/trust-wallets-fomo3d-summer-vuln/)

## Contact

* General requests and comments: email team@milksad.info
* Press: email press@milksad.info

## Team & Credits

* Core Team
  + ![distrust icon](/assets/base/distrust-white.svg) Distrust
    - Anton Livaja - anton@distrust.co
    - Lance R. Vick - lance@distrust.co, <https://lance.dev>
    - Ryan Heywood - ryan@distrust.co, <https://ryansquared.pub>
    - Shane Engelman - shane@distrust.co
  + Independent
    - Christian Reitter - <https://inhq.net>
    - Daniel Grove - danny@dannygrove.com
    - Dustin Johnson - milksad@di0.io
    - Heiko Schaefer - heiko@schaefer.name
    - James Callahan - james@wavesquid.com
    - Jochen Hoenicke - <https://jhoenicke.de>
    - John Naulty - jnaulty@dendritictech.com
    - Matthew Brooks - \*@logicwax.com
* Special Thanks
  + Jack Kearney - [Turnkey](https://turnkey.com)
  + Several trusted advisors that wish to remain uncredited. You know who you are.

[RSS](https://milksad.info/feed.xml),
[Git](https://git.distrust.co/milksad),
[data](https://git.distrust.co/milksad/data),
[old lookup](https://milksad.info/lookup.html) ![Milk Sad logo as icon](/assets/base/milksad_bottle_transparent.svg)2023-2024


