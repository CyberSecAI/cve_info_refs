=== Content from github.com_4f16c580_20250115_092800.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fnautobot%2Fnautobot%2Fcommit%2F64312a4297b5ca49b6cdedf477e41e8e4fd61cce)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fnautobot%2Fnautobot%2Fcommit%2F64312a4297b5ca49b6cdedf477e41e8e4fd61cce)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=nautobot%2Fnautobot)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[nautobot](/nautobot)
/
**[nautobot](/nautobot/nautobot)**
Public

* [Notifications](/login?return_to=%2Fnautobot%2Fnautobot) You must be signed in to change notification settings
* [Fork
  298](/login?return_to=%2Fnautobot%2Fnautobot)
* [Star
   1.1k](/login?return_to=%2Fnautobot%2Fnautobot)

* [Code](/nautobot/nautobot)
* [Issues
  864](/nautobot/nautobot/issues)
* [Pull requests
  26](/nautobot/nautobot/pulls)
* [Discussions](/nautobot/nautobot/discussions)
* [Actions](/nautobot/nautobot/actions)
* [Projects
  0](/nautobot/nautobot/projects)
* [Wiki](/nautobot/nautobot/wiki)
* [Security](/nautobot/nautobot/security)
* [Insights](/nautobot/nautobot/pulse)

Additional navigation options

* [Code](/nautobot/nautobot)
* [Issues](/nautobot/nautobot/issues)
* [Pull requests](/nautobot/nautobot/pulls)
* [Discussions](/nautobot/nautobot/discussions)
* [Actions](/nautobot/nautobot/actions)
* [Projects](/nautobot/nautobot/projects)
* [Wiki](/nautobot/nautobot/wiki)
* [Security](/nautobot/nautobot/security)
* [Insights](/nautobot/nautobot/pulse)

## Commit

[Permalink](/nautobot/nautobot/commit/64312a4297b5ca49b6cdedf477e41e8e4fd61cce)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

[1.6] Sanitize render\_markdown() output with nh3 library ([#5134](https://github.com/nautobot/nautobot/pull/5134))

[Browse files](/nautobot/nautobot/tree/64312a4297b5ca49b6cdedf477e41e8e4fd61cce)
Browse the repository at this point in the history

```
* Fix [GHSA-v4xv-795h-rv4h](https://github.com/advisories/GHSA-v4xv-795h-rv4h "GHSA-v4xv-795h-rv4h").

* Renumber change fragments

* Address review feedback

* Test fix

* Ruff

* Review feedback

* Update nautobot/utilities/forms/fields.py

Co-authored-by: Hanlin Miao <46973263+HanlinMiao@users.noreply.github.com>

* Update nautobot/utilities/forms/fields.py

---------

Co-authored-by: Hanlin Miao <46973263+HanlinMiao@users.noreply.github.com>
```

* Loading branch information

[![@glennmatthews](https://avatars.githubusercontent.com/u/5603551?s=40&v=4)](/glennmatthews) [![@HanlinMiao](https://avatars.githubusercontent.com/u/46973263?s=40&v=4)](/HanlinMiao)

[glennmatthews](/nautobot/nautobot/commits?author=glennmatthews "View all commits by glennmatthews")
and
[HanlinMiao](/nautobot/nautobot/commits?author=HanlinMiao "View all commits by HanlinMiao")
authored
Jan 19, 2024

1 parent
[1c3eea0](/nautobot/nautobot/commit/1c3eea04cae58fa95d5fe86026b899c9d03fbac7)

commit 64312a4

 Show file tree

 Hide file tree

Showing
**18 changed files**
with
**221 additions**
and
**45 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* changes

  + changes/5134.added
    [5134.added](#diff-71de4113a7003d58af930ff30a468428d7e4e6185d70355eea3b6b27de639430)
  + changes/5134.dependencies
    [5134.dependencies](#diff-c596753400bf0801dfc5bf368a0e244592271ce85844b069de3d7d6a7c2014f0)
  + changes/5134.security
    [5134.security](#diff-4b5998b4283ea0ed3daf9158d8919bfca183edde3ca67d3e8517ad8e8934bee6)
* nautobot

  + core

    - nautobot/core/settings.py
      [settings.py](#diff-6c6cc147c8188d94be8fd3b11345aa4bfef52a760e0961643b6b84d0c26da43a)
    - tests

      * nautobot/core/tests/test\_views.py
        [test\_views.py](#diff-00a6cfd44a817c7ab283eb0579d628b4a3babbae8a02287aecf8e82bc5072d79)
  + docs

    - additional-features

      * nautobot/docs/additional-features/jobs.md
        [jobs.md](#diff-1ad71b3f76caca51b9f6ed7d6f37253e33336ed2f62ac44be09ba77bf996a32e)
      * nautobot/docs/additional-features/template-filters.md
        [template-filters.md](#diff-615db515fb1e0c928afa6c8f421e7dbfbe4afd1c96b6cd381a95400b6cf3ea91)
    - configuration

      * nautobot/docs/configuration/optional-settings.md
        [optional-settings.md](#diff-55305b73fd56e28c32fc1eb37ca407c7d0fbff219988c08b6bc2331a5ea97d31)
    - models/extras

      * nautobot/docs/models/extras/note.md
        [note.md](#diff-47fd15f3f637863f50d5d9902c00853fe4872783dccdc800327b5433cabd20e8)
  + extras

    - forms

      * nautobot/extras/forms/forms.py
        [forms.py](#diff-a37c20d31f5341e2feb9acf32cbe495b0531e32c18ff72eac461c26d259450bd)
    - models

      * nautobot/extras/models/jobs.py
        [jobs.py](#diff-2c3ef3304c28292d8a530f19ddb14d3d52b9f153fc880b63ff2efa107c4a46f6)
  + utilities

    - nautobot/utilities/constants.py
      [constants.py](#diff-84d78968d728f1f13b132445ab5925a637d3cec885fd40ebd1a45b2fb73f8b6c)
    - forms

      * nautobot/utilities/forms/fields.py
        [fields.py](#diff-2b8d45fb821f9852b3de63ce5ce1a14214ba942e34466c386578500b5e42e735)
    - nautobot/utilities/logging.py
      [logging.py](#diff-926e781413734b36ef8b946e62b2fb4124488b93237055ad2e77f805559871f2)
    - templatetags

      * nautobot/utilities/templatetags/helpers.py
        [helpers.py](#diff-473815e5582260e6201f0daf0083d69561ecd6fa9290dd6ae5a361078b2cfa31)
    - tests

      * nautobot/utilities/tests/test\_templatetags\_helpers.py
        [test\_templatetags\_helpers.py](#diff-9cb35aef385db9d6b45482273cb12d4c579602166864a5a8ccde3b58d997a755)
* poetry.lock
  [poetry.lock](#diff-f53a023eedfa3fbf2925ec7dc76eecdc954ea94b7e47065393dbad519613dc89)
* pyproject.toml
  [pyproject.toml](#diff-50c86b7ed8ac2cf95bd48334961bf0530cdc77b5a56f852c5c61b89d735fd711)

## There are no files selected for viewing

1 change: 1 addition & 0 deletions

1
[changes/5134.added](#diff-71de4113a7003d58af930ff30a468428d7e4e6185d70355eea3b6b27de639430 "changes/5134.added")

Show comments

[View file](/nautobot/nautobot/blob/64312a4297b5ca49b6cdedf477e41e8e4fd61cce/changes/5134.added)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1 @@ |
|  |  | Enhanced Markdown-supporting fields (`comments`, `description`, Notes, Job log entries, etc.) to also permit the use of a limited subset of "safe" HTML tags and attributes. |

1 change: 1 addition & 0 deletions

1
[changes/5134.dependencies](#diff-c596753400bf0801dfc5bf368a0e244592271ce85844b069de3d7d6a7c2014f0 "changes/5134.dependencies")

Show comments

[View file](/nautobot/nautobot/blob/64312a4297b5ca49b6cdedf477e41e8e4fd61cce/changes/5134.dependencies)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1 @@ |
|  |  | Added `nh3` HTML sanitization library as a dependency. |

1 change: 1 addition & 0 deletions

1
[changes/5134.security](#diff-4b5998b4283ea0ed3daf9158d8919bfca183edde3ca67d3e8517ad8e8934bee6 "changes/5134.security")

Show comments

[View file](/nautobot/nautobot/blob/64312a4297b5ca49b6cdedf477e41e8e4fd61cce/changes/5134.security)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1 @@ |
|  |  | Fixed an XSS vulnerability ([GHSA-v4xv-795h-rv4h](https://github.com/nautobot/nautobot/security/advisories/GHSA-v4xv-795h-rv4h)) in the `render\_markdown()` utility function used to render comments, notes, job log entries, etc. |

3 changes: 2 additions & 1 deletion

3
[nautobot/core/settings.py](#diff-6c6cc147c8188d94be8fd3b11345aa4bfef52a760e0961643b6b84d0c26da43a "nautobot/core/settings.py")

Show comments

[View file](/nautobot/nautobot/blob/64312a4297b5ca49b6cdedf477e41e8e4fd61cce/nautobot/core/settings.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -671,7 +671,8 @@ |
|  |  | ], |
|  |  | "SUPPORT\_MESSAGE": [ |
|  |  | "", |
|  |  | "Help message to include on 4xx and 5xx error pages. Markdown is supported.\n" |
|  |  | "Help message to include on 4xx and 5xx error pages. " |
|  |  | "Markdown is supported, as are some HTML tags and attributes.\n" |
|  |  | "If unspecified, instructions to join Network to Code's Slack community will be provided.", |
|  |  | ], |
|  |  | } |
| Expand Down | |  |

14 changes: 7 additions & 7 deletions

14
[nautobot/core/tests/test\_views.py](#diff-00a6cfd44a817c7ab283eb0579d628b4a3babbae8a02287aecf8e82bc5072d79 "nautobot/core/tests/test_views.py")

Show comments

[View file](/nautobot/nautobot/blob/64312a4297b5ca49b6cdedf477e41e8e4fd61cce/nautobot/core/tests/test_views.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -370,9 +370,9 @@ def test\_404\_default\_support\_message(self): |
|  |  | self.assertContains(response, "Network to Code", status\_code=404) |
|  |  | response\_content = response.content.decode(response.charset) |
|  |  | self.assertInHTML( |
|  |  | "If further assistance is required, please join the <code>#nautobot</code> channel " |
|  |  | 'on <a href="https://slack.networktocode.com/">Network to Code\'s Slack community</a> ' |
|  |  | "and post your question.", |
|  |  | "If further assistance is required, please join the <code>#nautobot</code> channel on " |
|  |  | '<a href="https://slack.networktocode.com/" rel="noopener noreferrer">Network to Code\'s ' |
|  |  | "Slack community</a> and post your question.", |
|  |  | response\_content, |
|  |  | ) |
|  |  |  |
| Expand All | | @@ -396,16 +396,16 @@ def test\_500\_default\_support\_message(self, mock\_get): |
|  |  | self.assertContains(response, "Network to Code", status\_code=500) |
|  |  | response\_content = response.content.decode(response.charset) |
|  |  | self.assertInHTML( |
|  |  | "If further assistance is required, please join the <code>#nautobot</code> channel " |
|  |  | 'on <a href="https://slack.networktocode.com/">Network to Code\'s Slack community</a> ' |
|  |  | "and post your question.", |
|  |  | "If further assistance is required, please join the <code>#nautobot</code> channel on " |
|  |  | '<a href="https://slack.networktocode.com/" rel="noopener noreferrer">Network to Code\'s ' |
|  |  | "Slack community</a> and post your question.", |
|  |  | response\_content, |
|  |  | ) |
|  |  |  |
|  |  | @override\_settings(DEBUG=False, SUPPORT\_MESSAGE="Hello world!") |
|  |  | @mock.patch("nautobot.core.views.HomeView.get", side\_effect=Exception) |
|  |  | def test\_500\_custom\_support\_message(self, mock\_get): |
|  |  | """Nautobot's custom 500 page should be used and should include a default support message.""" |
|  |  | """Nautobot's custom 500 page should be used and should include a custom support message if defined.""" |
|  |  | url = reverse("home") |
|  |  | with self.assertTemplateUsed("500.html"): |
|  |  | self.client.raise\_request\_exception = False |
| Expand Down | |  |

4 changes: 2 additions & 2 deletions

4
[nautobot/docs/additional-features/jobs.md](#diff-1ad71b3f76caca51b9f6ed7d6f37253e33336ed2f62ac44be09ba77bf996a32e "nautobot/docs/additional-features/jobs.md")

Show comments

[View file](/nautobot/nautobot/blob/64312a4297b5ca49b6cdedf477e41e8e4fd61cce/nautobot/docs/additional-features/jobs.md)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

| Expand Up | | @@ -90,7 +90,7 @@ This is the human-friendly name of your job, as will be displayed in the Nautobo |
|  |  | #### `description` |
|  |  |  |
|  |  | An optional human-friendly description of what this job does. |
|  |  | This can accept either plain text or Markdown-formatted text. It can also be multiple lines: |
|  |  | This can accept either plain text, Markdown-formatted text, or [a limited subset of HTML](template-filters.md#render\_markdown). It can also be multiple lines: |
|  |  |  |
|  |  | ```python |
|  |  | class ExampleJob(Job): |
| Expand Down  Expand Up | | @@ -466,7 +466,7 @@ Messages recorded with `log()` or `log\_debug()` will appear in a job's results b |
|  |  |  |
|  |  | It is advised to log a message for each object that is evaluated so that the results will reflect how many objects are being manipulated or reported on. |
|  |  |  |
|  |  | Markdown rendering is supported for log messages. |
|  |  | Markdown rendering is supported for log messages, as well as [a limited subset of HTML](template-filters.md#render\_markdown). |
|  |  |  |
|  |  | +/- 1.3.4 |
|  |  | As a security measure, the `message` passed to any of these methods will be passed through the `nautobot.utilities.logging.sanitize()` function in an attempt to strip out information such as usernames/passwords that should not be saved to the logs. This is of course best-effort only, and Job authors should take pains to ensure that such information is not passed to the logging APIs in the first place. The set of redaction rules used by the `sanitize()` function can be configured as [settings.SANITIZER\_PATTERNS](../configuration/optional-settings.md#sanitizer\_patterns). |
| Expand Down | |  |

76 changes: 75 additions & 1 deletion

76
[nautobot/docs/additional-features/template-filters.md](#diff-615db515fb1e0c928afa6c8f421e7dbfbe4afd1c96b6cd381a95400b6cf3ea91 "nautobot/docs/additional-features/template-filters.md")

Show comments

[View file](/nautobot/nautobot/blob/64312a4297b5ca49b6cdedf477e41e8e4fd61cce/nautobot/docs/additional-features/template-filters.md)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

| Expand Up | | @@ -207,12 +207,86 @@ Render a dictionary as formatted JSON. |
|  |  |  |
|  |  | ### render\_markdown |
|  |  |  |
|  |  | Render text as Markdown. |
|  |  | Render and sanitize Markdown text into HTML. A limited subset of HTML tags and attributes are permitted in the text as well; non-permitted HTML will be stripped from the output for security. |
|  |  |  |
|  |  | ```django |
|  |  | {{ text | render\_markdown }} |
|  |  | ``` |
|  |  |  |
|  |  | #### Permitted HTML Tags and Attributes |
|  |  |  |
|  |  | +++ 1.6.10 |
|  |  |  |
|  |  | The set of permitted HTML tags is defined in `nautobot.core.constants.HTML\_ALLOWED\_TAGS`, and their permitted attributes are defined in `nautobot.core.constants.HTML\_ALLOWED\_ATTRIBUTES`. As of Nautobot 1.6.10 the following are permitted: |
|  |  |  |
|  |  | ??? info "Full list of HTML tags and attributes" |
|  |  | | Tag | Attributes | |
|  |  | | -------------- | -------------------------------------------------------------------- | |
|  |  | | `<a>` | `href`, `hreflang` | |
|  |  | | `<abbr>` | | |
|  |  | | `<acronym>` | | |
|  |  | | `<b>` | | |
|  |  | | `<bdi>` | | |
|  |  | | `<bdo>` | `dir` | |
|  |  | | `<blockquote>` | `cite` | |
|  |  | | `<br>` | | |
|  |  | | `<caption>` | | |
|  |  | | `<center>` | | |
|  |  | | `<cite>` | | |
|  |  | | `<code>` | | |
|  |  | | `<col>` | `align`, `char`, `charoff`, `span` | |
|  |  | | `<colgroup>` | `align`, `char`, `charoff`, `span` | |
|  |  | | `<dd>` | | |
|  |  | | `<del>` | `cite`, `datetime` | |
|  |  | | `<details>` | | |
|  |  | | `<div>` | | |
|  |  | | `<dl>` | | |
|  |  | | `<dt>` | | |
|  |  | | `<em>` | | |
|  |  | | `<h1>` | | |
|  |  | | `<h2>` | | |
|  |  | | `<h3>` | | |
|  |  | | `<h4>` | | |
|  |  | | `<h5>` | | |
|  |  | | `<h6>` | | |
|  |  | | `<hgroup>` | | |
|  |  | | `<hr>` | `align`, `size`, `width` | |
|  |  | | `<i>` | | |
|  |  | | `<img>` | `align`, `alt`, `height`, `src`, `width` | |
|  |  | | `<ins>` | `cite`, `datetime` | |
|  |  | | `<kbd>` | | |
|  |  | | `<li>` | | |
|  |  | | `<mark>` | | |
|  |  | | `<ol>` | `start` | |
|  |  | | `<p>` | | |
|  |  | | `<pre>` | | |
|  |  | | `<q>` | `cite` | |
|  |  | | `<rp>` | | |
|  |  | | `<rt>` | | |
|  |  | | `<rtc>` | | |
|  |  | | `<ruby>` | | |
|  |  | | `<s>` | | |
|  |  | | `<samp>` | | |
|  |  | | `<small>` | | |
|  |  | | `<span>` | | |
|  |  | | `<strike>` | | |
|  |  | | `<strong>` | | |
|  |  | | `<sub>` | | |
|  |  | | `<summary>` | | |
|  |  | | `<sup>` | | |
|  |  | | `<table>` | `align`, `char`, `charoff`, `summary` | |
|  |  | | `<tbody>` | `align`, `char`, `charoff` | |
|  |  | | `<td>` | `align`, `char`, `charoff`, `colspan`, `headers`, `rowspan` | |
|  |  | | `<th>` | `align`, `char`, `charoff`, `colspan`, `headers`, `rowspan`, `scope` | |
|  |  | | `<thead>` | `align`, `char`, `charoff` | |
|  |  | | `<time>` | | |
|  |  | | `<tr>` | `align`, `char`, `charoff` | |
|  |  | | `<tt>` | | |
|  |  | | `<u>` | | |
|  |  | | `<ul>` | | |
|  |  | | `<var>` | | |
|  |  | | `<wbr>` | | |
|  |  |  |
|  |  | ### render\_yaml |
|  |  |  |
|  |  | Render a dictionary as formatted YAML. |
| Expand Down | |  |

2 changes: 1 addition & 1 deletion

2
[nautobot/docs/configuration/optional-settings.md](#diff-55305b73fd56e28c32fc1eb37ca407c7d0fbff219988c08b6bc2331a5ea97d31 "nautobot/docs/configuration/optional-settings.md")

Show comments

[View file](/nautobot/nautobot/blob/64312a4297b5ca49b6cdedf477e41e8e4fd61cce/nautobot/docs/configuration/optional-settings.md)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

| Expand Up | | @@ -901,7 +901,7 @@ If set to `False`, unknown/unrecognized filter parameters will be discarded and |
|  |  |  |
|  |  | Default: `""` |
|  |  |  |
|  |  | A message to include on error pages (status code 403, 404, 500, etc.) when an error occurs. You can configure this to direct users to the appropriate contact(s) within your organization that provide support for Nautobot. Markdown formatting is supported within this message (raw HTML is not). |
|  |  | A message to include on error pages (status code 403, 404, 500, etc.) when an error occurs. You can configure this to direct users to the appropriate contact(s) within your organization that provide support for Nautobot. Markdown formatting is supported within this message, as well as [a limited subset of HTML](../additional-features/template-filters.md#render\_markdown). |
|  |  |  |
|  |  | If unset, the default message that will appear is `If further assistance is required, please join the #nautobot channel on [Network to Code's Slack community](https://slack.networktocode.com) and post your question.` |
|  |  |  |
| Expand Down | |  |

2 changes: 1 addition & 1 deletion

2
[nautobot/docs/models/extras/note.md](#diff-47fd15f3f637863f50d5d9902c00853fe4872783dccdc800327b5433cabd20e8 "nautobot/docs/models/extras/note.md")

Show comments

[View file](/nautobot/nautobot/blob/64312a4297b5ca49b6cdedf477e41e8e4fd61cce/nautobot/docs/models/extras/note.md)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

| Expand Up | | @@ -4,4 +4,4 @@ |
|  |  |  |
|  |  | Notes provide a place for you to store notes or general information on an object, such as a Device, that may not require a specific field for. This could be a note on a recent upgrade, a warning about a problematic device, or the reason the Rack was marked with the Status `Retired`. |
|  |  |  |
|  |  | The note field supports [Markdown Basic Syntax](https://www.markdownguide.org/cheat-sheet/#basic-syntax). |
|  |  | The note field supports [Markdown Basic Syntax](https://www.markdownguide.org/cheat-sheet/#basic-syntax) as well as [a limited subset of HTML](../../additional-features/template-filters.md#render\_markdown). |

14 changes: 9 additions & 5 deletions

14
[nautobot/extras/forms/forms.py](#diff-a37c20d31f5341e2feb9acf32cbe495b0531e32c18ff72eac461c26d259450bd "nautobot/extras/forms/forms.py")

Show comments

[View file](/nautobot/nautobot/blob/64312a4297b5ca49b6cdedf477e41e8e4fd61cce/nautobot/extras/forms/forms.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -360,18 +360,22 @@ class ConfigContextSchemaFilterForm(BootstrapMixin, forms.Form): |
|  |  | ) |
|  |  |  |
|  |  |  |
|  |  | class CustomFieldDescriptionField(CommentField): |
|  |  | @property |
|  |  | def default\_helptext(self): |
|  |  | return "Also used as the help text when editing models using this custom field.<br>" + super().default\_helptext |
|  |  |  |
|  |  |  |
|  |  | class CustomFieldForm(BootstrapMixin, forms.ModelForm): |
|  |  | label = forms.CharField(required=True, max\_length=50, help\_text="Name of the field as displayed to users.") |
|  |  | slug = SlugField( |
|  |  | max\_length=50, |
|  |  | slug\_source="label", |
|  |  | help\_text="Internal name of this field. Please use underscores rather than dashes.", |
|  |  | ) |
|  |  | description = forms.CharField( |
|  |  | description = CustomFieldDescriptionField( |
|  |  | label="Description", |
|  |  | required=False, |
|  |  | help\_text="Also used as the help text when editing models using this custom field.<br>" |
|  |  | '<a href="https://github.com/adam-p/markdown-here/wiki/Markdown-Cheatsheet" target="\_blank">' |
|  |  | "Markdown</a> syntax is supported.", |
|  |  | ) |
|  |  | content\_types = MultipleContentTypeField( |
|  |  | feature="custom\_fields", help\_text="The object(s) to which this field applies." |
| Expand Down  Expand Up | | @@ -1083,7 +1087,7 @@ class JobButtonFilterForm(BootstrapMixin, forms.Form): |
|  |  |  |
|  |  |  |
|  |  | class NoteForm(BootstrapMixin, forms.ModelForm): |
|  |  | note = CommentField |
|  |  | note = CommentField() |
|  |  |  |
|  |  | class Meta: |
|  |  | model = Note |
| Expand Down | |  |

5 changes: 4 additions & 1 deletion

5
[nautobot/extras/models/jobs.py](#diff-2c3ef3304c28292d8a530f19ddb14d3d52b9f153fc880b63ff2efa107c4a46f6 "nautobot/extras/models/jobs.py")

Show comments

[View file](/nautobot/nautobot/blob/64312a4297b5ca49b6cdedf477e41e8e4fd61cce/nautobot/extras/models/jobs.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -140,7 +140,10 @@ class Job(PrimaryModel): |
|  |  | help\_text="Human-readable name of this job", |
|  |  | db\_index=True, |
|  |  | ) |
|  |  | description = models.TextField(blank=True, help\_text="Markdown formatting is supported") |
|  |  | description = models.TextField( |
|  |  | blank=True, |
|  |  | help\_text="Markdown formatting and a limited subset of HTML are supported", |
|  |  | ) |
|  |  |  |
|  |  | # Control flags |
|  |  | installed = models.BooleanField( |
| Expand Down | |  |

33 changes: 33 additions & 0 deletions

33
[nautobot/utilities/constants.py](#diff-84d78968d728f1f13b132445ab5925a637d3cec885fd40ebd1a45b2fb73f8b6c "nautobot/utilities/constants.py")

Show comments

[View file](/nautobot/nautobot/blob/64312a4297b5ca49b6cdedf477e41e8e4fd61cce/nautobot/utilities/constants.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -1,3 +1,7 @@ |
|  |  | from copy import deepcopy |
|  |  |  |
|  |  | import nh3 |
|  |  |  |
|  |  | # |
|  |  | # Filter lookup expressions |
|  |  | # |
| Expand Down  Expand Up | | @@ -29,6 +33,35 @@ |
|  |  | FILTER\_NEGATION\_LOOKUP\_MAP = {"n": "exact"} |
|  |  |  |
|  |  |  |
|  |  | # |
|  |  | # User input sanitization |
|  |  | # |
|  |  |  |
|  |  | # Subset of the HTML tags allowed by default by ammonia: |
|  |  | # https://github.com/rust-ammonia/ammonia/blob/master/src/lib.rs |
|  |  | HTML\_ALLOWED\_TAGS = nh3.ALLOWED\_TAGS - { |
|  |  | # no image maps at present |
|  |  | "area", |
|  |  | "map", |
|  |  | # no document-level markup at present |
|  |  | "article", |
|  |  | "aside", |
|  |  | "footer", |
|  |  | "header", |
|  |  | "nav", |
|  |  | # miscellaneous out-of-scope for now |
|  |  | "data", |
|  |  | "dfn", |
|  |  | "figcaption", |
|  |  | "figure", |
|  |  | } |
|  |  |  |
|  |  | # Variant of the HTML attributes allowed by default by ammonia: |
|  |  | # https://github.com/rust-ammonia/ammonia/blob/master/src/lib.rs |
|  |  | # at present we just copy nh3.ALLOWED\_ATTRIBUTES but we can modify this later as desired and appropriate |
|  |  | HTML\_ALLOWED\_ATTRIBUTES = deepcopy(nh3.ALLOWED\_ATTRIBUTES) |
|  |  |  |
|  |  |  |
|  |  | # |
|  |  | # HTTP Request META safe copy |
|  |  | # |
| Expand Down | |  |

18 changes: 12 additions & 6 deletions

18
[nautobot/utilities/forms/fields.py](#diff-2b8d45fb821f9852b3de63ce5ce1a14214ba942e34466c386578500b5e42e735 "nautobot/utilities/forms/fields.py")

Show comments

[View file](/nautobot/nautobot/blob/64312a4297b5ca49b6cdedf477e41e8e4fd61cce/nautobot/utilities/forms/fields.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -12,7 +12,9 @@ |
|  |  | from django.core.exceptions import MultipleObjectsReturned, ObjectDoesNotExist, ValidationError |
|  |  | from django.db.models import Q |
|  |  | from django.forms.fields import BoundField, JSONField as \_JSONField, InvalidJSONInput |
|  |  | from django.templatetags.static import static |
|  |  | from django.urls import reverse |
|  |  | from django.utils.html import format\_html |
|  |  |  |
|  |  | from nautobot.extras.utils import FeatureQuery |
|  |  | from nautobot.utilities.choices import unpack\_grouped\_choices |
| Expand Down  Expand Up | | @@ -391,12 +393,16 @@ class CommentField(forms.CharField): |
|  |  |  |
|  |  | widget = forms.Textarea |
|  |  | default\_label = "" |
|  |  | # TODO: Port Markdown cheat sheet to internal documentation |
|  |  | default\_helptext = ( |
|  |  | '<i class="mdi mdi-information-outline"></i> ' |
|  |  | '<a href="https://github.com/adam-p/markdown-here/wiki/Markdown-Cheatsheet" target="\_blank">' |
|  |  | "Markdown</a> syntax is supported" |
|  |  | ) |
|  |  |  |
|  |  | @property |
|  |  | def default\_helptext(self): |
|  |  | # TODO: Port Markdown cheat sheet to internal documentation |
|  |  | return format\_html( |
|  |  | '<i class="mdi mdi-information-outline"></i> ' |
|  |  | '<a href="https://www.markdownguide.org/cheat-sheet/#basic-syntax" rel="noopener noreferrer">Markdown</a> ' |
|  |  | 'syntax is supported, as well as <a href="{}#render\_markdown">a limited subset of HTML</a>.', |
|  |  | static("docs/additional-features/template-filters.html"), |
|  |  | ) |
|  |  |  |
|  |  | def \_\_init\_\_(self, \*args, \*\*kwargs): |
|  |  | required = kwargs.pop("required", False) |
| Expand Down | |  |

13 changes: 13 additions & 0 deletions

13
[nautobot/utilities/logging.py](#diff-926e781413734b36ef8b946e62b2fb4124488b93237055ad2e77f805559871f2 "nautobot/utilities/logging.py")

Show comments

[View file](/nautobot/nautobot/blob/64312a4297b5ca49b6cdedf477e41e8e4fd61cce/nautobot/utilities/logging.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -4,6 +4,9 @@ |
|  |  | import re |
|  |  |  |
|  |  | from django.conf import settings |
|  |  | import nh3 |
|  |  |  |
|  |  | from nautobot.utilities import constants |
|  |  |  |
|  |  |  |
|  |  | logger = logging.getLogger(\_\_name\_\_) |
| Expand All | | @@ -27,3 +30,13 @@ def sanitize(string, replacement="(redacted)"): |
|  |  | logger.error('Error in string sanitization using "%s"', sanitizer) |
|  |  |  |
|  |  | return string |
|  |  |  |
|  |  |  |
|  |  | def clean\_html(html): |
|  |  | """Use nh3/ammonia to strip out all HTML tags and attributes except those explicitly permitted.""" |
|  |  | return nh3.clean( |
|  |  | html, |
|  |  | tags=constants.HTML\_ALLOWED\_TAGS, |
|  |  | attributes=constants.HTML\_ALLOWED\_ATTRIBUTES, |
|  |  | url\_schemes=set(settings.ALLOWED\_URL\_SCHEMES), |
|  |  | ) |

16 changes: 6 additions & 10 deletions

16
[nautobot/utilities/templatetags/helpers.py](#diff-473815e5582260e6201f0daf0083d69561ecd6fa9290dd6ae5a361078b2cfa31 "nautobot/utilities/templatetags/helpers.py")

Show comments

[View file](/nautobot/nautobot/blob/64312a4297b5ca49b6cdedf477e41e8e4fd61cce/nautobot/utilities/templatetags/helpers.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -8,13 +8,14 @@ |
|  |  | from django.contrib.staticfiles.finders import find |
|  |  | from django.templatetags.static import static, StaticNode |
|  |  | from django.urls import NoReverseMatch, reverse |
|  |  | from django.utils.html import format\_html, strip\_tags |
|  |  | from django.utils.html import format\_html |
|  |  | from django.utils.safestring import mark\_safe |
|  |  | from markdown import markdown |
|  |  | from django\_jinja import library |
|  |  |  |
|  |  | from nautobot.utilities.config import get\_settings\_or\_config |
|  |  | from nautobot.utilities.forms import TableConfigForm |
|  |  | from nautobot.utilities.logging import clean\_html |
|  |  | from nautobot.utilities.utils import foreground\_color, get\_route\_for\_model, UtilizationData |
|  |  |  |
|  |  | HTML\_TRUE = mark\_safe('<span class="text-success"><i class="mdi mdi-check-bold" title="Yes"></i></span>') # noqa: S308 |
| Expand Down  Expand Up | | @@ -162,18 +163,13 @@ def render\_markdown(value): |
|  |  | Example: |
|  |  | {{ text | render\_markdown }} |
|  |  | """ |
|  |  | # Strip HTML tags |
|  |  | value = strip\_tags(value) |
|  |  |  |
|  |  | # Sanitize Markdown links |
|  |  | schemes = "|".join(settings.ALLOWED\_URL\_SCHEMES) |
|  |  | pattern = rf"\[(.+)\]\((?!({schemes})).\*:(.+)\)" |
|  |  | value = re.sub(pattern, "[\\1](\\3)", value, flags=re.IGNORECASE) |
|  |  |  |
|  |  | # Render Markdown |
|  |  | html = markdown(value, extensions=["fenced\_code", "tables"]) |
|  |  |  |
|  |  | return mark\_safe(html) # noqa: S308 |
|  |  | # Sanitize rendered HTML |
|  |  | html = clean\_html(html) |
|  |  |  |
|  |  | return mark\_safe(html) # noqa: S308 # suspicious-mark-safe-usage, OK here since we sanitized the string earlier |
|  |  |  |
|  |  |  |
|  |  | @library.filter() |
| Expand Down | |  |

 Loading

Oops, something went wrong.
 Retry

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `64312a4`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fnautobot%2Fnautobot%2Fcommit%2F64312a4297b5ca49b6cdedf477e41e8e4fd61cce) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_100c6f95_20250115_092758.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fnautobot%2Fnautobot%2Fcommit%2F17effcbe84a72150c82b138565c311bbee357e80)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fnautobot%2Fnautobot%2Fcommit%2F17effcbe84a72150c82b138565c311bbee357e80)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=nautobot%2Fnautobot)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[nautobot](/nautobot)
/
**[nautobot](/nautobot/nautobot)**
Public

* [Notifications](/login?return_to=%2Fnautobot%2Fnautobot) You must be signed in to change notification settings
* [Fork
  298](/login?return_to=%2Fnautobot%2Fnautobot)
* [Star
   1.1k](/login?return_to=%2Fnautobot%2Fnautobot)

* [Code](/nautobot/nautobot)
* [Issues
  864](/nautobot/nautobot/issues)
* [Pull requests
  26](/nautobot/nautobot/pulls)
* [Discussions](/nautobot/nautobot/discussions)
* [Actions](/nautobot/nautobot/actions)
* [Projects
  0](/nautobot/nautobot/projects)
* [Wiki](/nautobot/nautobot/wiki)
* [Security](/nautobot/nautobot/security)
* [Insights](/nautobot/nautobot/pulse)

Additional navigation options

* [Code](/nautobot/nautobot)
* [Issues](/nautobot/nautobot/issues)
* [Pull requests](/nautobot/nautobot/pulls)
* [Discussions](/nautobot/nautobot/discussions)
* [Actions](/nautobot/nautobot/actions)
* [Projects](/nautobot/nautobot/projects)
* [Wiki](/nautobot/nautobot/wiki)
* [Security](/nautobot/nautobot/security)
* [Insights](/nautobot/nautobot/pulse)

## Commit

[Permalink](/nautobot/nautobot/commit/17effcbe84a72150c82b138565c311bbee357e80)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Sanitize `render_markdown()` output with `nh3` library ([#5133](https://github.com/nautobot/nautobot/pull/5133))

[Browse files](/nautobot/nautobot/tree/17effcbe84a72150c82b138565c311bbee357e80)
Browse the repository at this point in the history

```
* Fix [GHSA-v4xv-795h-rv4h](https://github.com/advisories/GHSA-v4xv-795h-rv4h "GHSA-v4xv-795h-rv4h").

* Renumber change fragments

* Address review feedback

* Test fix

* Ruff

* Review feedback

* Update nautobot/core/forms/fields.py
```

* Loading branch information

[![@glennmatthews](https://avatars.githubusercontent.com/u/5603551?s=40&v=4)](/glennmatthews)

[glennmatthews](/nautobot/nautobot/commits?author=glennmatthews "View all commits by glennmatthews")
authored
Jan 19, 2024

1 parent
[dbcc053](/nautobot/nautobot/commit/dbcc053cc04a213f883712a86f3d5e97254155d8)

commit 17effcb

 Show file tree

 Hide file tree

Showing
**18 changed files**
with
**221 additions**
and
**46 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* changes

  + changes/5133.added
    [5133.added](#diff-5a49b6250349611c5e50f47f30feab5d544f8d672ea1a39e4f9693c1fce8ab99)
  + changes/5133.dependencies
    [5133.dependencies](#diff-dd6d78b4a260bf31341e0147daad47b242bd33e27b17aa5af062eefce03e14e4)
  + changes/5133.security
    [5133.security](#diff-116a6eb9f0b38c08b0fa1811e03fb13c506ab0f4c57ee24e022111c6ff27beda)
* nautobot

  + core

    - nautobot/core/constants.py
      [constants.py](#diff-df7a75b9689e5473fc568b2e5fecae803214c9b9669027f83df5fc4f005577db)
    - forms

      * nautobot/core/forms/fields.py
        [fields.py](#diff-a9e4d95fa38571dcffc536b59856736ff183d82fca90d2eb52de03573b850d27)
    - nautobot/core/settings.py
      [settings.py](#diff-6c6cc147c8188d94be8fd3b11345aa4bfef52a760e0961643b6b84d0c26da43a)
    - templatetags

      * nautobot/core/templatetags/helpers.py
        [helpers.py](#diff-e2d6debf2c7892bab088f1ac872e538b659b456f37081f1d41bdbc739b17f265)
    - tests

      * nautobot/core/tests/test\_templatetags\_helpers.py
        [test\_templatetags\_helpers.py](#diff-89967611ada65421fe8c3c709cdc2813354fd70d13bd4fb73825c3e95ee8b217)
      * nautobot/core/tests/test\_views.py
        [test\_views.py](#diff-00a6cfd44a817c7ab283eb0579d628b4a3babbae8a02287aecf8e82bc5072d79)
    - utils

      * nautobot/core/utils/logging.py
        [logging.py](#diff-b85fe199733327e64d752d1d78bf3ea03e754ccf6b02d5e4785081e757c80097)
  + docs

    - development/jobs

      * nautobot/docs/development/jobs/index.md
        [index.md](#diff-c5e92851c8569e1a84670cbd371d91a8cb9562dcad842c29dd67539830ecc882)
    - user-guide

      * administration/configuration

        + nautobot/docs/user-guide/administration/configuration/optional-settings.md
          [optional-settings.md](#diff-c6506f07e39f5bc86850ba92b60a3ea2dabfed1922fc70acd994ca010b2bb24e)
      * platform-functionality

        + nautobot/docs/user-guide/platform-functionality/note.md
          [note.md](#diff-21b5ecc5acb61203d14fba55d0daacaf2926846e0fe341bd48df8afc4d9a04ae)
        + nautobot/docs/user-guide/platform-functionality/template-filters.md
          [template-filters.md](#diff-933228f192f274b0e753733b334d8ff27109f71b1ccfa8c464286496fc0d98c3)
  + extras

    - forms

      * nautobot/extras/forms/forms.py
        [forms.py](#diff-a37c20d31f5341e2feb9acf32cbe495b0531e32c18ff72eac461c26d259450bd)
    - models

      * nautobot/extras/models/jobs.py
        [jobs.py](#diff-2c3ef3304c28292d8a530f19ddb14d3d52b9f153fc880b63ff2efa107c4a46f6)
* poetry.lock
  [poetry.lock](#diff-f53a023eedfa3fbf2925ec7dc76eecdc954ea94b7e47065393dbad519613dc89)
* pyproject.toml
  [pyproject.toml](#diff-50c86b7ed8ac2cf95bd48334961bf0530cdc77b5a56f852c5c61b89d735fd711)

## There are no files selected for viewing

1 change: 1 addition & 0 deletions

1
[changes/5133.added](#diff-5a49b6250349611c5e50f47f30feab5d544f8d672ea1a39e4f9693c1fce8ab99 "changes/5133.added")

Show comments

[View file](/nautobot/nautobot/blob/17effcbe84a72150c82b138565c311bbee357e80/changes/5133.added)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1 @@ |
|  |  | Enhanced Markdown-supporting fields (`comments`, `description`, Notes, Job log entries, etc.) to also permit the use of a limited subset of "safe" HTML tags and attributes. |

1 change: 1 addition & 0 deletions

1
[changes/5133.dependencies](#diff-dd6d78b4a260bf31341e0147daad47b242bd33e27b17aa5af062eefce03e14e4 "changes/5133.dependencies")

Show comments

[View file](/nautobot/nautobot/blob/17effcbe84a72150c82b138565c311bbee357e80/changes/5133.dependencies)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1 @@ |
|  |  | Added `nh3` HTML sanitization library as a dependency. |

1 change: 1 addition & 0 deletions

1
[changes/5133.security](#diff-116a6eb9f0b38c08b0fa1811e03fb13c506ab0f4c57ee24e022111c6ff27beda "changes/5133.security")

Show comments

[View file](/nautobot/nautobot/blob/17effcbe84a72150c82b138565c311bbee357e80/changes/5133.security)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1 @@ |
|  |  | Fixed an XSS vulnerability ([GHSA-v4xv-795h-rv4h](https://github.com/nautobot/nautobot/security/advisories/GHSA-v4xv-795h-rv4h)) in the `render\_markdown()` utility function used to render comments, notes, job log entries, etc. |

33 changes: 33 additions & 0 deletions

33
[nautobot/core/constants.py](#diff-df7a75b9689e5473fc568b2e5fecae803214c9b9669027f83df5fc4f005577db "nautobot/core/constants.py")

Show comments

[View file](/nautobot/nautobot/blob/17effcbe84a72150c82b138565c311bbee357e80/nautobot/core/constants.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -1,3 +1,7 @@ |
|  |  | from copy import deepcopy |
|  |  |  |
|  |  | import nh3 |
|  |  |  |
|  |  | SEARCH\_MAX\_RESULTS = 15 |
|  |  |  |
|  |  | # |
| Expand Down  Expand Up | | @@ -32,6 +36,35 @@ |
|  |  |  |
|  |  | FILTER\_NEGATION\_LOOKUP\_MAP = {"n": "exact"} |
|  |  |  |
|  |  | # |
|  |  | # User input sanitization |
|  |  | # |
|  |  |  |
|  |  | # Subset of the HTML tags allowed by default by ammonia: |
|  |  | # https://github.com/rust-ammonia/ammonia/blob/master/src/lib.rs |
|  |  | HTML\_ALLOWED\_TAGS = nh3.ALLOWED\_TAGS - { |
|  |  | # no image maps at present |
|  |  | "area", |
|  |  | "map", |
|  |  | # no document-level markup at present |
|  |  | "article", |
|  |  | "aside", |
|  |  | "footer", |
|  |  | "header", |
|  |  | "nav", |
|  |  | # miscellaneous out-of-scope for now |
|  |  | "data", |
|  |  | "dfn", |
|  |  | "figcaption", |
|  |  | "figure", |
|  |  | } |
|  |  |  |
|  |  | # Variant of the HTML attributes allowed by default by ammonia: |
|  |  | # https://github.com/rust-ammonia/ammonia/blob/master/src/lib.rs |
|  |  | # at present we just copy nh3.ALLOWED\_ATTRIBUTES but we can modify this later as desired and appropriate |
|  |  | HTML\_ALLOWED\_ATTRIBUTES = deepcopy(nh3.ALLOWED\_ATTRIBUTES) |
|  |  |  |
|  |  |  |
|  |  | # |
|  |  | # Reserved Names |
|  |  | # |
| Expand Down | |  |

18 changes: 12 additions & 6 deletions

18
[nautobot/core/forms/fields.py](#diff-a9e4d95fa38571dcffc536b59856736ff183d82fca90d2eb52de03573b850d27 "nautobot/core/forms/fields.py")

Show comments

[View file](/nautobot/nautobot/blob/17effcbe84a72150c82b138565c311bbee357e80/nautobot/core/forms/fields.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -9,7 +9,9 @@ |
|  |  | from django.core.exceptions import MultipleObjectsReturned, ObjectDoesNotExist, ValidationError |
|  |  | from django.db.models import Q |
|  |  | from django.forms.fields import BoundField, InvalidJSONInput, JSONField as \_JSONField |
|  |  | from django.templatetags.static import static |
|  |  | from django.urls import reverse |
|  |  | from django.utils.html import format\_html |
|  |  | import django\_filters |
|  |  | from netaddr import EUI |
|  |  | from netaddr.core import AddrFormatError |
| Expand Down  Expand Up | | @@ -372,12 +374,16 @@ class CommentField(django\_forms.CharField): |
|  |  |  |
|  |  | widget = django\_forms.Textarea |
|  |  | default\_label = "" |
|  |  | # TODO: Port Markdown cheat sheet to internal documentation |
|  |  | default\_helptext = ( |
|  |  | '<i class="mdi mdi-information-outline"></i> ' |
|  |  | '<a href="https://github.com/adam-p/markdown-here/wiki/Markdown-Cheatsheet" target="\_blank">' |
|  |  | "Markdown</a> syntax is supported" |
|  |  | ) |
|  |  |  |
|  |  | @property |
|  |  | def default\_helptext(self): |
|  |  | # TODO: Port Markdown cheat sheet to internal documentation |
|  |  | return format\_html( |
|  |  | '<i class="mdi mdi-information-outline"></i> ' |
|  |  | '<a href="https://www.markdownguide.org/cheat-sheet/#basic-syntax" rel="noopener noreferrer">Markdown</a> ' |
|  |  | 'syntax is supported, as well as <a href="{}#render\_markdown">a limited subset of HTML</a>.', |
|  |  | static("docs/user-guide/platform-functionality/template-filters.html"), |
|  |  | ) |
|  |  |  |
|  |  | def \_\_init\_\_(self, \*args, \*\*kwargs): |
|  |  | required = kwargs.pop("required", False) |
| Expand Down | |  |

3 changes: 2 additions & 1 deletion

3
[nautobot/core/settings.py](#diff-6c6cc147c8188d94be8fd3b11345aa4bfef52a760e0961643b6b84d0c26da43a "nautobot/core/settings.py")

Show comments

[View file](/nautobot/nautobot/blob/17effcbe84a72150c82b138565c311bbee357e80/nautobot/core/settings.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -682,7 +682,8 @@ |
|  |  | ), |
|  |  | "SUPPORT\_MESSAGE": ConstanceConfigItem( |
|  |  | default="", |
|  |  | help\_text="Help message to include on 4xx and 5xx error pages. Markdown is supported.\n" |
|  |  | help\_text="Help message to include on 4xx and 5xx error pages. " |
|  |  | "Markdown is supported, as are some HTML tags and attributes.\n" |
|  |  | "If unspecified, instructions to join Network to Code's Slack community will be provided.", |
|  |  | ), |
|  |  | } |
| Expand Down | |  |

15 changes: 5 additions & 10 deletions

15
[nautobot/core/templatetags/helpers.py](#diff-e2d6debf2c7892bab088f1ac872e538b659b456f37081f1d41bdbc739b17f265 "nautobot/core/templatetags/helpers.py")

Show comments

[View file](/nautobot/nautobot/blob/17effcbe84a72150c82b138565c311bbee357e80/nautobot/core/templatetags/helpers.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -8,7 +8,7 @@ |
|  |  | from django.contrib.staticfiles.finders import find |
|  |  | from django.templatetags.static import static, StaticNode |
|  |  | from django.urls import NoReverseMatch, reverse |
|  |  | from django.utils.html import format\_html, strip\_tags |
|  |  | from django.utils.html import format\_html |
|  |  | from django.utils.safestring import mark\_safe |
|  |  | from django.utils.text import slugify as django\_slugify |
|  |  | from django\_jinja import library |
| Expand All | | @@ -17,7 +17,7 @@ |
|  |  |  |
|  |  | from nautobot.apps.config import get\_app\_settings\_or\_config |
|  |  | from nautobot.core import forms |
|  |  | from nautobot.core.utils import color, config, data, lookup |
|  |  | from nautobot.core.utils import color, config, data, logging as nautobot\_logging, lookup |
|  |  | from nautobot.core.utils.requests import add\_nautobot\_version\_query\_param\_to\_url |
|  |  |  |
|  |  | # S308 is suspicious-mark-safe-usage, but these are all using static strings that we know to be safe |
| Expand Down  Expand Up | | @@ -170,17 +170,12 @@ def render\_markdown(value): |
|  |  | Example: |
|  |  | {{ text | render\_markdown }} |
|  |  | """ |
|  |  | # Strip HTML tags |
|  |  | value = strip\_tags(value) |
|  |  |  |
|  |  | # Sanitize Markdown links |
|  |  | schemes = "|".join(settings.ALLOWED\_URL\_SCHEMES) |
|  |  | pattern = rf"\[(.+)\]\((?!({schemes})).\*:(.+)\)" |
|  |  | value = re.sub(pattern, "[\\1](\\3)", value, flags=re.IGNORECASE) |
|  |  |  |
|  |  | # Render Markdown |
|  |  | html = markdown(value, extensions=["fenced\_code", "tables"]) |
|  |  |  |
|  |  | # Sanitize rendered HTML |
|  |  | html = nautobot\_logging.clean\_html(html) |
|  |  |  |
|  |  | return mark\_safe(html) # noqa: S308 # suspicious-mark-safe-usage, OK here since we sanitized the string earlier |
|  |  |  |
|  |  |  |
| Expand Down | |  |

23 changes: 19 additions & 4 deletions

23
[nautobot/core/tests/test\_templatetags\_helpers.py](#diff-89967611ada65421fe8c3c709cdc2813354fd70d13bd4fb73825c3e95ee8b217 "nautobot/core/tests/test_templatetags_helpers.py")

Show comments

[View file](/nautobot/nautobot/blob/17effcbe84a72150c82b138565c311bbee357e80/nautobot/core/tests/test_templatetags_helpers.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -79,9 +79,24 @@ def test\_render\_markdown(self): |
|  |  | helpers.render\_markdown("\*\*bold and \_italics\_\*\*"), "<p><strong>bold and <em>italics</em></strong></p>" |
|  |  | ) |
|  |  | self.assertEqual(helpers.render\_markdown("\* list"), "<ul>\n<li>list</li>\n</ul>") |
|  |  | self.assertEqual( |
|  |  | self.assertHTMLEqual( |
|  |  | helpers.render\_markdown("[I am a link](https://www.example.com)"), |
|  |  | '<p><a href="https://www.example.com">I am a link</a></p>', |
|  |  | '<p><a href="https://www.example.com" rel="noopener noreferrer">I am a link</a></p>', |
|  |  | ) |
|  |  |  |
|  |  | def test\_render\_markdown\_security(self): |
|  |  | self.assertEqual(helpers.render\_markdown('<script>alert("XSS")</script>'), "") |
|  |  | self.assertHTMLEqual( |
|  |  | helpers.render\_markdown('[link](javascript:alert("XSS"))'), |
|  |  | '<p><a title="XSS" rel="noopener noreferrer">link</a>)</p>', # the trailing ) seems weird to me, but... |
|  |  | ) |
|  |  | self.assertHTMLEqual( |
|  |  | helpers.render\_markdown( |
|  |  | "[link\nJS]" |
|  |  | "(&#x6A&#x61&#x76&#x61&#x73&#x63&#x72&#x69&#x70&#x74&#x3A" # '(javascript:' |
|  |  | "&#x61&#x6C&#x65&#x72&#x74&#x28&#x27&#x58&#x53&#x53&#x27&#x29)" # 'alert("XSS"))' |
|  |  | ), |
|  |  | '<p><a rel="noopener noreferrer">link JS</a></p>', |
|  |  | ) |
|  |  |  |
|  |  | def test\_render\_json(self): |
| Expand Down  Expand Up | | @@ -240,8 +255,8 @@ def test\_support\_message(self): |
|  |  | self.assertHTMLEqual( |
|  |  | helpers.support\_message(), |
|  |  | "<p>If further assistance is required, please join the <code>#nautobot</code> channel " |
|  |  | 'on <a href="https://slack.networktocode.com/">Network to Code\'s Slack community</a> ' |
|  |  | "and post your question.</p>", |
|  |  | 'on <a href="https://slack.networktocode.com/" rel="noopener noreferrer">Network to Code\'s ' |
|  |  | "Slack community</a> and post your question.</p>", |
|  |  | ) |
|  |  |  |
|  |  | with override\_config(SUPPORT\_MESSAGE="Reach out to your support team for assistance."): |
| Expand Down | |  |

14 changes: 7 additions & 7 deletions

14
[nautobot/core/tests/test\_views.py](#diff-00a6cfd44a817c7ab283eb0579d628b4a3babbae8a02287aecf8e82bc5072d79 "nautobot/core/tests/test_views.py")

Show comments

[View file](/nautobot/nautobot/blob/17effcbe84a72150c82b138565c311bbee357e80/nautobot/core/tests/test_views.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -366,9 +366,9 @@ def test\_404\_default\_support\_message(self): |
|  |  | self.assertContains(response, "Network to Code", status\_code=404) |
|  |  | response\_content = response.content.decode(response.charset) |
|  |  | self.assertInHTML( |
|  |  | "If further assistance is required, please join the <code>#nautobot</code> channel " |
|  |  | 'on <a href="https://slack.networktocode.com/">Network to Code\'s Slack community</a> ' |
|  |  | "and post your question.", |
|  |  | "If further assistance is required, please join the <code>#nautobot</code> channel on " |
|  |  | '<a href="https://slack.networktocode.com/" rel="noopener noreferrer">Network to Code\'s ' |
|  |  | "Slack community</a> and post your question.", |
|  |  | response\_content, |
|  |  | ) |
|  |  |  |
| Expand All | | @@ -392,16 +392,16 @@ def test\_500\_default\_support\_message(self, mock\_get): |
|  |  | self.assertContains(response, "Network to Code", status\_code=500) |
|  |  | response\_content = response.content.decode(response.charset) |
|  |  | self.assertInHTML( |
|  |  | "If further assistance is required, please join the <code>#nautobot</code> channel " |
|  |  | 'on <a href="https://slack.networktocode.com/">Network to Code\'s Slack community</a> ' |
|  |  | "and post your question.", |
|  |  | "If further assistance is required, please join the <code>#nautobot</code> channel on " |
|  |  | '<a href="https://slack.networktocode.com/" rel="noopener noreferrer">Network to Code\'s ' |
|  |  | "Slack community</a> and post your question.", |
|  |  | response\_content, |
|  |  | ) |
|  |  |  |
|  |  | @override\_settings(DEBUG=False, SUPPORT\_MESSAGE="Hello world!") |
|  |  | @mock.patch("nautobot.core.views.HomeView.get", side\_effect=Exception) |
|  |  | def test\_500\_custom\_support\_message(self, mock\_get): |
|  |  | """Nautobot's custom 500 page should be used and should include a default support message.""" |
|  |  | """Nautobot's custom 500 page should be used and should include a custom support message if defined.""" |
|  |  | url = reverse("home") |
|  |  | with self.assertTemplateUsed("500.html"): |
|  |  | self.client.raise\_request\_exception = False |
| Expand Down | |  |

15 changes: 14 additions & 1 deletion

15
[nautobot/core/utils/logging.py](#diff-b85fe199733327e64d752d1d78bf3ea03e754ccf6b02d5e4785081e757c80097 "nautobot/core/utils/logging.py")

Show comments

[View file](/nautobot/nautobot/blob/17effcbe84a72150c82b138565c311bbee357e80/nautobot/core/utils/logging.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -1,9 +1,12 @@ |
|  |  | """Utilities for working with log messages and similar features.""" |
|  |  | """Utilities for working with log messages and similar user-authored data.""" |
|  |  |  |
|  |  | import logging |
|  |  | import re |
|  |  |  |
|  |  | from django.conf import settings |
|  |  | import nh3 |
|  |  |  |
|  |  | from nautobot.core import constants |
|  |  |  |
|  |  | logger = logging.getLogger(\_\_name\_\_) |
|  |  |  |
| Expand Down  Expand Up | | @@ -47,3 +50,13 @@ def sanitize(dirty, replacement="(redacted)"): |
|  |  |  |
|  |  | logger.warning("No sanitizer support for %s data", type(dirty)) |
|  |  | return dirty |
|  |  |  |
|  |  |  |
|  |  | def clean\_html(html): |
|  |  | """Use nh3/ammonia to strip out all HTML tags and attributes except those explicitly permitted.""" |
|  |  | return nh3.clean( |
|  |  | html, |
|  |  | tags=constants.HTML\_ALLOWED\_TAGS, |
|  |  | attributes=constants.HTML\_ALLOWED\_ATTRIBUTES, |
|  |  | url\_schemes=set(settings.ALLOWED\_URL\_SCHEMES), |
|  |  | ) |

4 changes: 2 additions & 2 deletions

4
[nautobot/docs/development/jobs/index.md](#diff-c5e92851c8569e1a84670cbd371d91a8cb9562dcad842c29dd67539830ecc882 "nautobot/docs/development/jobs/index.md")

Show comments

[View file](/nautobot/nautobot/blob/17effcbe84a72150c82b138565c311bbee357e80/nautobot/docs/development/jobs/index.md)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

| Expand Up | | @@ -113,7 +113,7 @@ This is the human-friendly name of your job, as will be displayed in the Nautobo |
|  |  | #### `description` |
|  |  |  |
|  |  | An optional human-friendly description of what this job does. |
|  |  | This can accept either plain text or Markdown-formatted text. It can also be multiple lines: |
|  |  | This can accept either plain text, Markdown-formatted text, or [a limited subset of HTML](../../user-guide/platform-functionality/template-filters.md#render\_markdown). It can also be multiple lines: |
|  |  |  |
|  |  | ```python |
|  |  | class ExampleJob(Job): |
| Expand Down  Expand Up | | @@ -512,7 +512,7 @@ To skip writing a log entry to the database, set the `skip\_db\_logging` key in th |
|  |  | logger.info("This job is running!", extra={"skip\_db\_logging": True}) |
|  |  | ``` |
|  |  |  |
|  |  | Markdown rendering is supported for log messages. |
|  |  | Markdown rendering is supported for log messages, as well as [a limited subset of HTML](../../user-guide/platform-functionality/template-filters.md#render\_markdown). |
|  |  |  |
|  |  | +/- 1.3.4 |
|  |  | As a security measure, the `message` passed to any of these methods will be passed through the `nautobot.core.utils.logging.sanitize()` function in an attempt to strip out information such as usernames/passwords that should not be saved to the logs. This is of course best-effort only, and Job authors should take pains to ensure that such information is not passed to the logging APIs in the first place. The set of redaction rules used by the `sanitize()` function can be configured as [settings.SANITIZER\_PATTERNS](../../user-guide/administration/configuration/optional-settings.md#sanitizer\_patterns). |
| Expand Down | |  |

2 changes: 1 addition & 1 deletion

2
[nautobot/docs/user-guide/administration/configuration/optional-settings.md](#diff-c6506f07e39f5bc86850ba92b60a3ea2dabfed1922fc70acd994ca010b2bb24e "nautobot/docs/user-guide/administration/configuration/optional-settings.md")

Show comments

[View file](/nautobot/nautobot/blob/17effcbe84a72150c82b138565c311bbee357e80/nautobot/docs/user-guide/administration/configuration/optional-settings.md)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

| Expand Up | | @@ -964,7 +964,7 @@ If set to `False`, unknown/unrecognized filter parameters will be discarded and |
|  |  |  |
|  |  | Default: `""` |
|  |  |  |
|  |  | A message to include on error pages (status code 403, 404, 500, etc.) when an error occurs. You can configure this to direct users to the appropriate contact(s) within your organization that provide support for Nautobot. Markdown formatting is supported within this message (raw HTML is not). |
|  |  | A message to include on error pages (status code 403, 404, 500, etc.) when an error occurs. You can configure this to direct users to the appropriate contact(s) within your organization that provide support for Nautobot. Markdown formatting is supported within this message, as well as [a limited subset of HTML](../../platform-functionality/template-filters.md#render\_markdown). |
|  |  |  |
|  |  | If unset, the default message that will appear is `If further assistance is required, please join the #nautobot channel on [Network to Code's Slack community](https://slack.networktocode.com) and post your question.` |
|  |  |  |
| Expand Down | |  |

2 changes: 1 addition & 1 deletion

2
[nautobot/docs/user-guide/platform-functionality/note.md](#diff-21b5ecc5acb61203d14fba55d0daacaf2926846e0fe341bd48df8afc4d9a04ae "nautobot/docs/user-guide/platform-functionality/note.md")

Show comments

[View file](/nautobot/nautobot/blob/17effcbe84a72150c82b138565c311bbee357e80/nautobot/docs/user-guide/platform-functionality/note.md)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

| Expand Up | | @@ -4,4 +4,4 @@ |
|  |  |  |
|  |  | Notes provide a place for you to store notes or general information on an object, such as a Device, that may not require a specific field for. This could be a note on a recent upgrade, a warning about a problematic device, or the reason the Rack was marked with the Status `Retired`. |
|  |  |  |
|  |  | The note field supports [Markdown Basic Syntax](https://www.markdownguide.org/cheat-sheet/#basic-syntax). |
|  |  | The note field supports [Markdown Basic Syntax](https://www.markdownguide.org/cheat-sheet/#basic-syntax) as well as [a limited subset of HTML](template-filters.md#render\_markdown). |

76 changes: 75 additions & 1 deletion

76
[nautobot/docs/user-guide/platform-functionality/template-filters.md](#diff-933228f192f274b0e753733b334d8ff27109f71b1ccfa8c464286496fc0d98c3 "nautobot/docs/user-guide/platform-functionality/template-filters.md")

Show comments

[View file](/nautobot/nautobot/blob/17effcbe84a72150c82b138565c311bbee357e80/nautobot/docs/user-guide/platform-functionality/template-filters.md)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

| Expand Up | | @@ -216,12 +216,86 @@ Render a dictionary as formatted JSON. |
|  |  |  |
|  |  | ### render\_markdown |
|  |  |  |
|  |  | Render text as Markdown. |
|  |  | Render and sanitize Markdown text into HTML. A limited subset of HTML tags and attributes are permitted in the text as well; non-permitted HTML will be stripped from the output for security. |
|  |  |  |
|  |  | ```django |
|  |  | {{ text | render\_markdown }} |
|  |  | ``` |
|  |  |  |
|  |  | #### Permitted HTML Tags and Attributes |
|  |  |  |
|  |  | +++ 2.1.2 |
|  |  |  |
|  |  | The set of permitted HTML tags is defined in `nautobot.core.constants.HTML\_ALLOWED\_TAGS`, and their permitted attributes are defined in `nautobot.core.constants.HTML\_ALLOWED\_ATTRIBUTES`. As of Nautobot 2.1.2 the following are permitted: |
|  |  |  |
|  |  | ??? info "Full list of HTML tags and attributes" |
|  |  | | Tag | Attributes | |
|  |  | | -------------- | -------------------------------------------------------------------- | |
|  |  | | `<a>` | `href`, `hreflang` | |
|  |  | | `<abbr>` | | |
|  |  | | `<acronym>` | | |
|  |  | | `<b>` | | |
|  |  | | `<bdi>` | | |
|  |  | | `<bdo>` | `dir` | |
|  |  | | `<blockquote>` | `cite` | |
|  |  | | `<br>` | | |
|  |  | | `<caption>` | | |
|  |  | | `<center>` | | |
|  |  | | `<cite>` | | |
|  |  | | `<code>` | | |
|  |  | | `<col>` | `align`, `char`, `charoff`, `span` | |
|  |  | | `<colgroup>` | `align`, `char`, `charoff`, `span` | |
|  |  | | `<dd>` | | |
|  |  | | `<del>` | `cite`, `datetime` | |
|  |  | | `<details>` | | |
|  |  | | `<div>` | | |
|  |  | | `<dl>` | | |
|  |  | | `<dt>` | | |
|  |  | | `<em>` | | |
|  |  | | `<h1>` | | |
|  |  | | `<h2>` | | |
|  |  | | `<h3>` | | |
|  |  | | `<h4>` | | |
|  |  | | `<h5>` | | |
|  |  | | `<h6>` | | |
|  |  | | `<hgroup>` | | |
|  |  | | `<hr>` | `align`, `size`, `width` | |
|  |  | | `<i>` | | |
|  |  | | `<img>` | `align`, `alt`, `height`, `src`, `width` | |
|  |  | | `<ins>` | `cite`, `datetime` | |
|  |  | | `<kbd>` | | |
|  |  | | `<li>` | | |
|  |  | | `<mark>` | | |
|  |  | | `<ol>` | `start` | |
|  |  | | `<p>` | | |
|  |  | | `<pre>` | | |
|  |  | | `<q>` | `cite` | |
|  |  | | `<rp>` | | |
|  |  | | `<rt>` | | |
|  |  | | `<rtc>` | | |
|  |  | | `<ruby>` | | |
|  |  | | `<s>` | | |
|  |  | | `<samp>` | | |
|  |  | | `<small>` | | |
|  |  | | `<span>` | | |
|  |  | | `<strike>` | | |
|  |  | | `<strong>` | | |
|  |  | | `<sub>` | | |
|  |  | | `<summary>` | | |
|  |  | | `<sup>` | | |
|  |  | | `<table>` | `align`, `char`, `charoff`, `summary` | |
|  |  | | `<tbody>` | `align`, `char`, `charoff` | |
|  |  | | `<td>` | `align`, `char`, `charoff`, `colspan`, `headers`, `rowspan` | |
|  |  | | `<th>` | `align`, `char`, `charoff`, `colspan`, `headers`, `rowspan`, `scope` | |
|  |  | | `<thead>` | `align`, `char`, `charoff` | |
|  |  | | `<time>` | | |
|  |  | | `<tr>` | `align`, `char`, `charoff` | |
|  |  | | `<tt>` | | |
|  |  | | `<u>` | | |
|  |  | | `<ul>` | | |
|  |  | | `<var>` | | |
|  |  | | `<wbr>` | | |
|  |  |  |
|  |  | ### render\_yaml |
|  |  |  |
|  |  | Render a dictionary as formatted YAML. |
| Expand Down | |  |

 Loading

Oops, something went wrong.
 Retry

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `17effcb`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fnautobot%2Fnautobot%2Fcommit%2F17effcbe84a72150c82b138565c311bbee357e80) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_7b2da15f_20250115_092808.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fnautobot%2Fnautobot%2Fsecurity%2Fadvisories%2FGHSA-v4xv-795h-rv4h)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fnautobot%2Fnautobot%2Fsecurity%2Fadvisories%2FGHSA-v4xv-795h-rv4h)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=nautobot%2Fnautobot)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[nautobot](/nautobot)
/
**[nautobot](/nautobot/nautobot)**
Public

* [Notifications](/login?return_to=%2Fnautobot%2Fnautobot) You must be signed in to change notification settings
* [Fork
  298](/login?return_to=%2Fnautobot%2Fnautobot)
* [Star
   1.1k](/login?return_to=%2Fnautobot%2Fnautobot)

* [Code](/nautobot/nautobot)
* [Issues
  864](/nautobot/nautobot/issues)
* [Pull requests
  26](/nautobot/nautobot/pulls)
* [Discussions](/nautobot/nautobot/discussions)
* [Actions](/nautobot/nautobot/actions)
* [Projects
  0](/nautobot/nautobot/projects)
* [Wiki](/nautobot/nautobot/wiki)
* [Security](/nautobot/nautobot/security)
* [Insights](/nautobot/nautobot/pulse)

Additional navigation options

* [Code](/nautobot/nautobot)
* [Issues](/nautobot/nautobot/issues)
* [Pull requests](/nautobot/nautobot/pulls)
* [Discussions](/nautobot/nautobot/discussions)
* [Actions](/nautobot/nautobot/actions)
* [Projects](/nautobot/nautobot/projects)
* [Wiki](/nautobot/nautobot/wiki)
* [Security](/nautobot/nautobot/security)
* [Insights](/nautobot/nautobot/pulse)

# XSS potential in rendered Markdown fields (comments, description, notes, etc.)

High

[glennmatthews](/glennmatthews)
published
GHSA-v4xv-795h-rv4h
Jan 22, 2024

## Package

pip

nautobot
([pip](/advisories?query=ecosystem%3Apip))

## Affected versions

<1.6.10,<2.1.2

## Patched versions

1.6.10,2.1.2

## Description

### Impact

*What kind of vulnerability is it? Who is impacted?*

All users of Nautobot versions earlier than 1.6.10 or 2.1.2 are potentially impacted.

Due to inadequate input sanitization, any user-editable fields that support Markdown rendering, including:

* `Circuit.comments`
* `Cluster.comments`
* `CustomField.description`
* `Device.comments`
* `DeviceRedundancyGroup.comments`
* `DeviceType.comments`
* `Job.description`
* `JobLogEntry.message`
* `Location.comments`
* `Note.note`
* `PowerFeed.comments`
* `Provider.noc_contact`
* `Provider.admin_contact`
* `Provider.comments`
* `ProviderNetwork.comments`
* `Rack.comments`
* `Tenant.comments`
* `VirtualMachine.comments`
* Contents of any custom fields of type `markdown`
* Job class `description` attributes
* The `SUPPORT_MESSAGE` system configuration setting

are potentially susceptible to cross-site scripting (XSS) attacks via maliciously crafted data.

### Patches

*Has the problem been patched? What versions should users upgrade to?*

Fixed in Nautobot versions 1.6.10 and 2.1.2.

### Workarounds

*Is there a way for users to fix or remediate the vulnerability without upgrading?*

### References

*Are there any links users can visit to find out more?*

[#5133](https://github.com/nautobot/nautobot/pull/5133)

[#5134](https://github.com/nautobot/nautobot/pull/5134)

### Severity

High

7.1

# CVSS overall score

 This score calculates overall vulnerability severity from 0 to 10 and is based on the Common Vulnerability Scoring System (CVSS).

 / 10

#### CVSS v3 base metrics

Attack vector
Network

Attack complexity
High

Privileges required
Low

User interaction
Required

Scope
Changed

Confidentiality
Low

Integrity
High

Availability
Low

Learn more about base metrics

# CVSS v3 base metrics

Attack vector:
More severe the more the remote (logically and physically) an attacker can be in order to exploit the vulnerability.

Attack complexity:
More severe for the least complex attacks.

Privileges required:
More severe if no privileges are required.

User interaction:
More severe when no user interaction is required.

Scope:
More severe when a scope change occurs, e.g. one vulnerable component impacts resources in components beyond its security scope.

Confidentiality:
More severe when loss of data confidentiality is highest, measuring the level of data access available to an unauthorized user.

Integrity:
More severe when loss of data integrity is the highest, measuring the consequence of data modification possible by an unauthorized user.

Availability:
More severe when the loss of impacted component availability is highest.

CVSS:3.1/AV:N/AC:H/PR:L/UI:R/S:C/C:L/I:H/A:L

### CVE ID

CVE-2024-23345

### Weaknesses

[CWE-80](/advisories?query=cwe%3A80)

### Credits

* [![@Kircheneer](https://avatars.githubusercontent.com/u/12400533?s=40&v=4)](/Kircheneer)
  [Kircheneer](/Kircheneer)
  Reporter

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_2c6b371d_20250115_092803.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fnautobot%2Fnautobot%2Fpull%2F5133)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fnautobot%2Fnautobot%2Fpull%2F5133)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fpull_requests_fragments%2Fpull_request_layout&source=header-repo&source_repo=nautobot%2Fnautobot)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[nautobot](/nautobot)
/
**[nautobot](/nautobot/nautobot)**
Public

* [Notifications](/login?return_to=%2Fnautobot%2Fnautobot) You must be signed in to change notification settings
* [Fork
  298](/login?return_to=%2Fnautobot%2Fnautobot)
* [Star
   1.1k](/login?return_to=%2Fnautobot%2Fnautobot)

* [Code](/nautobot/nautobot)
* [Issues
  864](/nautobot/nautobot/issues)
* [Pull requests
  26](/nautobot/nautobot/pulls)
* [Discussions](/nautobot/nautobot/discussions)
* [Actions](/nautobot/nautobot/actions)
* [Projects
  0](/nautobot/nautobot/projects)
* [Wiki](/nautobot/nautobot/wiki)
* [Security](/nautobot/nautobot/security)
* [Insights](/nautobot/nautobot/pulse)

Additional navigation options

* [Code](/nautobot/nautobot)
* [Issues](/nautobot/nautobot/issues)
* [Pull requests](/nautobot/nautobot/pulls)
* [Discussions](/nautobot/nautobot/discussions)
* [Actions](/nautobot/nautobot/actions)
* [Projects](/nautobot/nautobot/projects)
* [Wiki](/nautobot/nautobot/wiki)
* [Security](/nautobot/nautobot/security)
* [Insights](/nautobot/nautobot/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Fnautobot%2Fnautobot%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Fnautobot%2Fnautobot%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# Sanitize `render_markdown()` output with `nh3` library #5133

 Merged

[glennmatthews](/glennmatthews)
merged 9 commits into
[develop](/nautobot/nautobot/tree/develop "nautobot/nautobot:develop")
from
[GHSA-v4xv-795h-rv4h](/nautobot/nautobot/tree/GHSA-v4xv-795h-rv4h "nautobot/nautobot:GHSA-v4xv-795h-rv4h")

Jan 19, 2024

 Merged

# [Sanitize `render_markdown()` output with `nh3` library](#top) #5133

[glennmatthews](/glennmatthews)
merged 9 commits into
[develop](/nautobot/nautobot/tree/develop "nautobot/nautobot:develop")
from
[GHSA-v4xv-795h-rv4h](/nautobot/nautobot/tree/GHSA-v4xv-795h-rv4h "nautobot/nautobot:GHSA-v4xv-795h-rv4h")

Jan 19, 2024

[Conversation
11](/nautobot/nautobot/pull/5133)
[Commits
9](/nautobot/nautobot/pull/5133/commits)
[Checks
15](/nautobot/nautobot/pull/5133/checks)
[Files changed](/nautobot/nautobot/pull/5133/files)

## Conversation

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

[![glennmatthews](https://avatars.githubusercontent.com/u/5603551?s=60&v=4)](/glennmatthews)

Copy link

Contributor

### @glennmatthews **[glennmatthews](/glennmatthews)** commented [Jan 19, 2024](#issue-2090609752)

# What's Changed

* Add `nh3` (Python wrapper around `ammonia`) as an HTML sanitization library and use it in `render_markdown`.
  + This provides a more robust defense against potential XSS and obfuscated script-injection attacks than Django's built-in `strip_tags()` that we were previously using.
  + As a bonus, we are no longer stripping all HTML tags before rendering Markdown to HTML - "safe" tags and attributes defined in an allow-list constant are now preserved, meaning that the various Markdown fields we have now permit explicit HTML tags and attributes so long as they comply with the allow-lists.
* Update documentation
* Add test coverage for a specific reported XSS example and several other examples.

# Screenshots

Some notes that I authored in manual testing. The "Malicious link" would run JS code when rendered in develop and clicked, but now is just a no-op link to nowhere. The "Home" link, horizontal rule, table, and "Hello World" heading are all written directly as HTML rather than Markdown.

develop:

[![image](https://private-user-images.githubusercontent.com/5603551/298086294-2a1d49e7-6d4a-4f1f-811f-ab1e441a934f.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MzY5MzM1ODAsIm5iZiI6MTczNjkzMzI4MCwicGF0aCI6Ii81NjAzNTUxLzI5ODA4NjI5NC0yYTFkNDllNy02ZDRhLTRmMWYtODExZi1hYjFlNDQxYTkzNGYucG5nP1gtQW16LUFsZ29yaXRobT1BV1M0LUhNQUMtU0hBMjU2JlgtQW16LUNyZWRlbnRpYWw9QUtJQVZDT0RZTFNBNTNQUUs0WkElMkYyMDI1MDExNSUyRnVzLWVhc3QtMSUyRnMzJTJGYXdzNF9yZXF1ZXN0JlgtQW16LURhdGU9MjAyNTAxMTVUMDkyODAwWiZYLUFtei1FeHBpcmVzPTMwMCZYLUFtei1TaWduYXR1cmU9OGNiYWUxYWVjZjM2ZmYwNGM2ZTNkZjk1NTI1YWY0NjA4MWQyNThkZThmNjZmNjM2ZWE3ZGZiOTcxNzFiYjc2MSZYLUFtei1TaWduZWRIZWFkZXJzPWhvc3QifQ.gTDD1AjCMfPQoiApXLRdKE30FZTDojrvlk7qsV730C0)](https://private-user-images.githubusercontent.com/5603551/298086294-2a1d49e7-6d4a-4f1f-811f-ab1e441a934f.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MzY5MzM1ODAsIm5iZiI6MTczNjkzMzI4MCwicGF0aCI6Ii81NjAzNTUxLzI5ODA4NjI5NC0yYTFkNDllNy02ZDRhLTRmMWYtODExZi1hYjFlNDQxYTkzNGYucG5nP1gtQW16LUFsZ29yaXRobT1BV1M0LUhNQUMtU0hBMjU2JlgtQW16LUNyZWRlbnRpYWw9QUtJQVZDT0RZTFNBNTNQUUs0WkElMkYyMDI1MDExNSUyRnVzLWVhc3QtMSUyRnMzJTJGYXdzNF9yZXF1ZXN0JlgtQW16LURhdGU9MjAyNTAxMTVUMDkyODAwWiZYLUFtei1FeHBpcmVzPTMwMCZYLUFtei1TaWduYXR1cmU9OGNiYWUxYWVjZjM2ZmYwNGM2ZTNkZjk1NTI1YWY0NjA4MWQyNThkZThmNjZmNjM2ZWE3ZGZiOTcxNzFiYjc2MSZYLUFtei1TaWduZWRIZWFkZXJzPWhvc3QifQ.gTDD1AjCMfPQoiApXLRdKE30FZTDojrvlk7qsV730C0)

this branch:

[![image](https://private-user-images.githubusercontent.com/5603551/298086340-76221ca2-6651-4d9d-bf0e-aec6dfe2cf5d.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MzY5MzM1ODAsIm5iZiI6MTczNjkzMzI4MCwicGF0aCI6Ii81NjAzNTUxLzI5ODA4NjM0MC03NjIyMWNhMi02NjUxLTRkOWQtYmYwZS1hZWM2ZGZlMmNmNWQucG5nP1gtQW16LUFsZ29yaXRobT1BV1M0LUhNQUMtU0hBMjU2JlgtQW16LUNyZWRlbnRpYWw9QUtJQVZDT0RZTFNBNTNQUUs0WkElMkYyMDI1MDExNSUyRnVzLWVhc3QtMSUyRnMzJTJGYXdzNF9yZXF1ZXN0JlgtQW16LURhdGU9MjAyNTAxMTVUMDkyODAwWiZYLUFtei1FeHBpcmVzPTMwMCZYLUFtei1TaWduYXR1cmU9ODI4NmJkYWRkNGMxNWM0OTM2MjYyZDRiMjUxM2U0ZGFjNmYxNjFkZDc1NjU0NTY1MWNiNDEzZTkyYzkzMmU5ZiZYLUFtei1TaWduZWRIZWFkZXJzPWhvc3QifQ.TaP2WfAZwtBuild9RLn7dZHmCBnFn1zFx1TeqqYQu8c)](https://private-user-images.githubusercontent.com/5603551/298086340-76221ca2-6651-4d9d-bf0e-aec6dfe2cf5d.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MzY5MzM1ODAsIm5iZiI6MTczNjkzMzI4MCwicGF0aCI6Ii81NjAzNTUxLzI5ODA4NjM0MC03NjIyMWNhMi02NjUxLTRkOWQtYmYwZS1hZWM2ZGZlMmNmNWQucG5nP1gtQW16LUFsZ29yaXRobT1BV1M0LUhNQUMtU0hBMjU2JlgtQW16LUNyZWRlbnRpYWw9QUtJQVZDT0RZTFNBNTNQUUs0WkElMkYyMDI1MDExNSUyRnVzLWVhc3QtMSUyRnMzJTJGYXdzNF9yZXF1ZXN0JlgtQW16LURhdGU9MjAyNTAxMTVUMDkyODAwWiZYLUFtei1FeHBpcmVzPTMwMCZYLUFtei1TaWduYXR1cmU9ODI4NmJkYWRkNGMxNWM0OTM2MjYyZDRiMjUxM2U0ZGFjNmYxNjFkZDc1NjU0NTY1MWNiNDEzZTkyYzkzMmU5ZiZYLUFtei1TaWduZWRIZWFkZXJzPWhvc3QifQ.TaP2WfAZwtBuild9RLn7dZHmCBnFn1zFx1TeqqYQu8c)

# TODO

* Explanation of Change(s)
* Added change log fragment(s) (for more information see [the documentation](https://docs.nautobot.com/projects/core/en/stable/development/#creating-changelog-fragments))
* Attached Screenshots, Payload Example
* Unit, Integration Tests
* Documentation Updates (when adding/changing features)
* n/a Example Plugin Updates (when adding/changing features)
* Outline Remaining Work, Constraints from Design

Sorry, something went wrong.

All reactions

[![@glennmatthews](https://avatars.githubusercontent.com/u/5603551?s=40&v=4)](/glennmatthews)

`[Fix](/nautobot/nautobot/pull/5133/commits/b8f44f363cccaa6403105242b70649be45f6e69d "Fix GHSA-v4xv-795h-rv4h.") [GHSA-v4xv-795h-rv4h](https://github.com/advisories/GHSA-v4xv-795h-rv4h "GHSA-v4xv-795h-rv4h")[.](/nautobot/nautobot/pull/5133/commits/b8f44f363cccaa6403105242b70649be45f6e69d "Fix GHSA-v4xv-795h-rv4h.")`

`[b8f44f3](/nautobot/nautobot/pull/5133/commits/b8f44f363cccaa6403105242b70649be45f6e69d)`

[![@glennmatthews](https://avatars.githubusercontent.com/u/5603551?s=40&u=aeb82c68b75837a6043df546cb680c7b2c7b25d2&v=4)](/glennmatthews)
[glennmatthews](/glennmatthews)
mentioned this pull request
[Jan 19, 2024](#ref-pullrequest-2090616851)

[[1.6] Sanitize render\_markdown() output with nh3 library
#5134](/nautobot/nautobot/pull/5134)
 Merged

6 tasks

[![@glennmatthews](https://avatars.githubusercontent.com/u/5603551?s=40&u=aeb82c68b75837a6043df546cb680c7b2c7b25d2&v=4)](/glennmatthews)
[glennmatthews](/glennmatthews)
self-assigned this
[Jan 19, 2024](#event-11537873972)

 [glennmatthews](/glennmatthews)
added 5 commits
[January 19, 2024 08:52](#commits-pushed-82db516)

[![@glennmatthews](https://avatars.githubusercontent.com/u/5603551?s=40&v=4)](/glennmatthews)

`[Merge branch 'develop' into](/nautobot/nautobot/pull/5133/commits/82db516af771ad9a7f3a3ab3fc299670a478331b "Merge branch 'develop' into GHSA-v4xv-795h-rv4h") [GHSA-v4xv-795h-rv4h](https://github.com/advisories/GHSA-v4xv-795h-rv4h "GHSA-v4xv-795h-rv4h")`

`[82db516](/nautobot/nautobot/pull/5133/commits/82db516af771ad9a7f3a3ab3fc299670a478331b)`

[![@glennmatthews](https://avatars.githubusercontent.com/u/5603551?s=40&v=4)](/glennmatthews)

`[Renumber change fragments](/nautobot/nautobot/pull/5133/commits/36b1a53d2b3c3ad89c45d040e4cd1307656a6386 "Renumber change fragments")`

`[36b1a53](/nautobot/nautobot/pull/5133/commits/36b1a53d2b3c3ad89c45d040e4cd1307656a6386)`

[![@glennmatthews](https://avatars.githubusercontent.com/u/5603551?s=40&v=4)](/glennmatthews)

`[Address review feedback](/nautobot/nautobot/pull/5133/commits/82693e9d1717eca01839debc8581b83e42c7d908 "Address review feedback")`

`[82693e9](/nautobot/nautobot/pull/5133/commits/82693e9d1717eca01839debc8581b83e42c7d908)`

[![@glennmatthews](https://avatars.githubusercontent.com/u/5603551?s=40&v=4)](/glennmatthews)

`[Test fix](/nautobot/nautobot/pull/5133/commits/b614de6792ab533d42df036f1a19f5efe841835c "Test fix")`

`[b614de6](/nautobot/nautobot/pull/5133/commits/b614de6792ab533d42df036f1a19f5efe841835c)`

[![@glennmatthews](https://avatars.githubusercontent.com/u/5603551?s=40&v=4)](/glennmatthews)

`[Ruff](/nautobot/nautobot/pull/5133/commits/2311bae83afd08f5b4d0550157fe6a671a41049b "Ruff")`

`[2311bae](/nautobot/nautobot/pull/5133/commits/2311bae83afd08f5b4d0550157fe6a671a41049b)`

[![HanlinMiao](https://avatars.githubusercontent.com/u/46973263?s=60&v=4)](/HanlinMiao)

**[HanlinMiao](/HanlinMiao)**
reviewed
[Jan 19, 2024](#pullrequestreview-1833099316)

 [View reviewed changes](/nautobot/nautobot/pull/5133/files/2311bae83afd08f5b4d0550157fe6a671a41049b)

Copy link

Contributor

### @HanlinMiao **[HanlinMiao](/HanlinMiao)** left a comment

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

I'm a little confused as to why `rel="noopener noreferrer"` is present in some of the rendered markdown text.

Sorry, something went wrong.

All reactions

[nautobot/core/tests/test\_views.py](/nautobot/nautobot/pull/5133/files/2311bae83afd08f5b4d0550157fe6a671a41049b#diff-00a6cfd44a817c7ab283eb0579d628b4a3babbae8a02287aecf8e82bc5072d79)

Show resolved

Hide resolved

[nautobot/docs/user-guide/platform-functionality/template-filters.md](/nautobot/nautobot/pull/5133/files/2311bae83afd08f5b4d0550157fe6a671a41049b#diff-933228f192f274b0e753733b334d8ff27109f71b1ccfa8c464286496fc0d98c3)

|  |  | @@ -216,12 +216,86 @@ Render a dictionary as formatted JSON. | |
| --- | --- | --- | --- |
|  |  |  |
|  |  | ### render\_markdown |
|  |  |  |
|  |  | Render text as Markdown. |
|  |  | Render and sanitize Markdown text into HTML. A limited subset of HTML tags and attributes are permitted in the text as well; non-permitted HTML will be stripped from the output for security. |

Copy link

Contributor

### @HanlinMiao **[HanlinMiao](/HanlinMiao)** [Jan 19, 2024](#discussion_r1459238801)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Suggested change

|  | Render and sanitize Markdown text into HTML. A limited subset of HTML tags and attributes are permitted in the text as well; non-permitted HTML will be stripped from the output for security. |
| --- | --- |
|  | Render and sanitize Markdown text into HTML. A limited subset of HTML tags and attributes are permitted in the text; non-permitted HTML will be stripped from the output for security. |

Sorry, something went wrong.

All reactions

Copy link

Contributor

Author

### @glennmatthews **[glennmatthews](/glennmatthews)** [Jan 19, 2024](#discussion_r1459253989)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Reads more accurately/completely to me as is - but I'm open to convincing?

Sorry, something went wrong.

All reactions

Copy link

Contributor

### @HanlinMiao **[HanlinMiao](/HanlinMiao)** [Jan 19, 2024](#discussion_r1459334424)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Definitely a nit of all nits. "As well" sounds like there was something similar stated previously.

Sorry, something went wrong.

All reactions

Copy link

Contributor

Author

### @glennmatthews **[glennmatthews](/glennmatthews)** [Jan 19, 2024](#discussion_r1459390294)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

I was thinking "as well as Markdown".

Sorry, something went wrong.

 👍
1
 HanlinMiao reacted with thumbs up emoji

All reactions

* 👍
  1 reaction

[nautobot/core/settings.py](/nautobot/nautobot/pull/5133/files/2311bae83afd08f5b4d0550157fe6a671a41049b#diff-6c6cc147c8188d94be8fd3b11345aa4bfef52a760e0961643b6b84d0c26da43a)
Outdated

Show resolved

Hide resolved

[![@glennmatthews](https://avatars.githubusercontent.com/u/5603551?s=80&u=aeb82c68b75837a6043df546cb680c7b2c7b25d2&v=4)](/glennmatthews)

Copy link

Contributor

Author

### **[glennmatthews](/glennmatthews)** commented [Jan 19, 2024](#issuecomment-1900681117)

| I'm a little confused as to why `rel="noopener noreferrer"` is present in some of the rendered markdown text.  It's added automatically by `nh3`/`ammonia`; my limited understanding is that it prevents external links, when clicked on, from being able to introspect information from the previous (i.e. Nautobot) page context.   * <https://developer.mozilla.org/en-US/docs/Web/HTML/Attributes/rel/noopener> * <https://developer.mozilla.org/en-US/docs/Web/HTML/Attributes/rel/noreferrer> |
| --- |

 👍
1
 HanlinMiao reacted with thumbs up emoji

All reactions

* 👍
  1 reaction

Sorry, something went wrong.

 [glennmatthews](/glennmatthews)
added 2 commits
[January 19, 2024 11:11](#commits-pushed-e70fd5e)

[![@glennmatthews](https://avatars.githubusercontent.com/u/5603551?s=40&v=4)](/glennmatthews)

`[Merge branch 'develop' into](/nautobot/nautobot/pull/5133/commits/e70fd5e09a933370df59e7050a5466348ea5f53b "Merge branch 'develop' into GHSA-v4xv-795h-rv4h") [GHSA-v4xv-795h-rv4h](https://github.com/advisories/GHSA-v4xv-795h-rv4h "GHSA-v4xv-795h-rv4h")`

`[e70fd5e](/nautobot/nautobot/pull/5133/commits/e70fd5e09a933370df59e7050a5466348ea5f53b)`

[![@glennmatthews](https://avatars.githubusercontent.com/u/5603551?s=40&v=4)](/glennmatthews)

`[Review feedback](/nautobot/nautobot/pull/5133/commits/01215a5498fb66d571218a14c92a97133cdf9c28 "Review feedback")`

`[01215a5](/nautobot/nautobot/pull/5133/commits/01215a5498fb66d571218a14c92a97133cdf9c28)`

[![HanlinMiao](https://avatars.githubusercontent.com/u/46973263?s=60&v=4)](/HanlinMiao)

**[HanlinMiao](/HanlinMiao)**
approved these changes
[Jan 19, 2024](#pullrequestreview-1833246971)

 [View reviewed changes](/nautobot/nautobot/pull/5133/files/01215a5498fb66d571218a14c92a97133cdf9c28)

[![glennmatthews](https://avatars.githubusercontent.com/u/5603551?s=60&v=4)](/glennmatthews)

**[glennmatthews](/glennmatthews)**
commented
[Jan 19, 2024](#pullrequestreview-1833304100)

 [View reviewed changes](/nautobot/nautobot/pull/5133/files/01215a5498fb66d571218a14c92a97133cdf9c28)

[nautobot/core/forms/fields.py](/nautobot/nautobot/pull/5133/files/01215a5498fb66d571218a14c92a97133cdf9c28#diff-a9e4d95fa38571dcffc536b59856736ff183d82fca90d2eb52de03573b850d27)
Outdated

Show resolved

Hide resolved

[![@glennmatthews](https://avatars.githubusercontent.com/u/5603551?s=40&v=4)](/glennmatthews)

`[Update nautobot/core/forms/fields.py](/nautobot/nautobot/pull/5133/commits/677f7d6d43b7df3e75bef7450b1e44dcf59aabc9 "Update nautobot/core/forms/fields.py")`

`[677f7d6](/nautobot/nautobot/pull/5133/commits/677f7d6d43b7df3e75bef7450b1e44dcf59aabc9)`

 Hide details
View details

[![@glennmatthews](https://avatars.githubusercontent.com/u/5603551?s=40&u=aeb82c68b75837a6043df546cb680c7b2c7b25d2&v=4)](/glennmatthews)
[glennmatthews](/glennmatthews)
merged commit [`17effcb`](/nautobot/nautobot/commit/17effcbe84a72150c82b138565c311bbee357e80)
into
develop

[Jan 19, 2024](https://github.com/nautobot/nautobot/pull/5133#event-11542422439)
17 checks passed

 [![@glennmatthews](https://avatars.githubusercontent.com/u/5603551?s=40&u=aeb82c68b75837a6043df546cb680c7b2c7b25d2&v=4)](/glennmatthews)
[glennmatthews](/glennmatthews)
deleted the
GHSA-v4xv-795h-rv4h

branch
[January 19, 2024 21:37](#event-11542422555)

[glennmatthews](/glennmatthews)
added a commit
that referenced
this pull request
[Jan 22, 2024](#ref-commit-4b7fa19)
[![@glennmatthews](https://avatars.githubusercontent.com/u/5603551?s=40&u=aeb82c68b75837a6043df546cb680c7b2c7b25d2&v=4)](/glennmatthews) [![@timizuoebideri1](https://avatars.githubusercontent.com/u/94907097?s=40&u=0057bd503d2802afbacd9914e453ebbc5243ae16&v=4)](/timizuoebideri1)
[![@gsnider2195](https://avatars.githubusercontent.com/u/75227981?s=40&u=556af7718766ec60d0c51aae5de914385d2da776&v=4)](/gsnider2195) [![@Kircheneer](https://avatars.githubusercontent.com/u/12400533?s=40&u=ba68016d4725fe5b5a8f4f32f063e81d5ed45180&v=4)](/Kircheneer) [![@HanlinMiao](https://avatars.githubusercontent.com/u/46973263?s=40&u=ef6e6c194c0d07f6a0837f33ec4e95c49ab0082d&v=4)](/HanlinMiao) [![@erjac77](https://avatars.githubusercontent.com/u/767727?s=40&u=cd28b408563ebf97bba7ede2ccb134f3e50d44ac&v=4)](/erjac77) [![@housepbass](https://avatars.githubusercontent.com/u/80693460?s=40&v=4)](/housepbass) [![@bryanculver](https://avatars.githubusercontent.com/u/31187?s=40&u=d02c17eaa254fa067ba4ab2d0ef6e4ccacf1ce94&v=4)](/bryanculver) [![@dependabot](https://avatars.githubusercontent.com/in/29110?s=40&v=4)](/apps/dependabot) [![@lampwins](https://avatars.githubusercontent.com/u/1297132?s=40&u=b3080ef304df34d26c8fa4455f48f83d9cb7bb4e&v=4)](/lampwins) [![@jvanderaa](https://avatars.githubusercontent.com/u/22228848?s=40&u=e8a4039c1ea9864430ee69e0ef7e47468718df82&v=4)](/jvanderaa) [![@gertzakis](https://avatars.githubusercontent.com/u/7761756?s=40&u=71e6858b37186cf33cb2ffb517d6f0b470ae6646&v=4)](/gertzakis) [![@jeffkala](https://avatars.githubusercontent.com/u/48843785?s=40&u=a054bf30db4f4e08377d33ced646ffe0d8c6efbf&v=4)](/jeffkala) [![@jmcgill298](https://avatars.githubusercontent.com/u/9847006?s=40&u=37f22813e11d5bb33742c846c53c672fdcf96a72&v=4)](/jmcgill298) [![@joewesch](https://avatars.githubusercontent.com/u/10467633?s=40&u=152d2c800dc6718556f7be673dfb51423ddb8c05&v=4)](/joewesch) [![@tlourey](https://avatars.githubusercontent.com/u/9435779?s=40&v=4)](/tlourey) [![@TLCF](https://avatars.githubusercontent.com/u/31373129?s=40&v=4)](/TLCF)

`[Merge pull request](/nautobot/nautobot/commit/4b7fa19ac53314aec75bf68d04b0d2a6fb2dcce4 "Merge pull request #5136 from nautobot/release/2.1.2

* Added global filtering to Job Result log table

* Fix integration test failure

* Apply suggestions from code review

Co-authored-by: Gary Snider <75227981+gsnider2195@users.noreply.github.com>

* use self.browser.is_text_not_present instead of time.sleep

* PR feedback

* fix migration

* fixes early return conditional in ensure_git_repository - again. (#5043)

The type returned by `git.Repo.rev_parse(\"HEAD\")` was still off, i.e. not
a string. This commit fixes this by converting it to a string.

Co-authored-by: Hanlin Miao <46973263+HanlinMiao@users.noreply.github.com>
Co-authored-by: Glenn Matthews <glenn.matthews@networktocode.com>

* Improve IPAddressEditView and IPAddressAssignView logic (#5054)

* Improve IPAddressEditView and IPAddressAssignView logic.

* Number change fragments

* Make ruff happy

---------

Co-authored-by: Hanlin Miao <46973263+HanlinMiao@users.noreply.github.com>

* bump version

* Process CSV import one row at a time to permit back-references (#4977)

* Process CSV import one row at a time to permit back-references to earlier rows

* Fix failing test

* Change fragment

---------

Co-authored-by: Hanlin Miao <46973263+HanlinMiao@users.noreply.github.com>

* fix: devcontainer (#4906)

* fix: devcontainer

* refactor(devcontainer): remove pylint and pre-commit leftover

* fix(devcontainer): arch detection

* feat(devcontainer): replace black, flake8 and isort with ruff

* refactor(devcontainer): remove prettier and eslint extensions

* refactor: remove eslint fixall

* refactor(devcontainer): move superuser information to dev.env

* fix(devcontainer): update comment with ruff instead of black

* update docs and add changelogs

* Apply suggestions from code review

* move changelogs to housekeeping category

---------

Co-authored-by: Gary Snider <75227981+gsnider2195@users.noreply.github.com>
Co-authored-by: Glenn Matthews <glenn.matthews@networktocode.com>

* tt

* ruff fix

* Fixed bug with invoke cli and invoke nbshell. (#5079)

Co-authored-by: Glenn Matthews <glenn.matthews@networktocode.com>

* Increase grid breakpoints by 240px (#5080)

* Update nautobot/extras/tests/integration/test_jobs.py

* bump packaging (#5077)

* bump packaging

* update lock file

* create change fragment

* update packaging dependency spec to '>=23.1'

* Update changes/5076.housekeeping

Co-authored-by: Glenn Matthews <glenn.matthews@networktocode.com>

---------

Co-authored-by: Anthony House <anthony.house@networktocode.com>
Co-authored-by: Glenn Matthews <glenn.matthews@networktocode.com>

* Job-related bug fixes (#5095)

* Job-related bug fixes

* Renumber change fragment

* [Snyk] Security upgrade jinja2 from 3.1.2 to 3.1.3 (#5086)

* Bump gitpython from 3.1.40 to 3.1.41 (#5083)

* A few performance updates (#5024)

Co-authored-by: Glenn Matthews <glenn.matthews@networktocode.com>
Co-authored-by: Gary Snider <75227981+gsnider2195@users.noreply.github.com>

* Skip test

* Removes startplugin mgmt cmd. (#5082)

Co-authored-by: Glenn Matthews <glenn.matthews@networktocode.com>

* Remove `files/get` endpoint which is not used from Nautobot 2.0 (#5115)

* remove `files/get` endpoint

* Update nautobot/core/tests/test_views.py

Co-authored-by: Glenn Matthews <glenn.matthews@networktocode.com>

* update based on review

---------

Co-authored-by: Glenn Matthews <glenn.matthews@networktocode.com>

* more flexible default sanitizer pattern (#4994)

* more flexible default sanitizer pattern

* Fix re.compile syntax

* add test for new patterns create changelog fragment

* fix test cases for new pattern

* update other santization references

* add examples of matching patterns

---------

Co-authored-by: Hanlin Miao <46973263+HanlinMiao@users.noreply.github.com>
Co-authored-by: Glenn Matthews <glenn.matthews@networktocode.com>

* More job fixes (#5102)

* More job fixes

* Renumber change fragment

* Revert redundant logging

* Enhance sanitize() to handle data other than strings, fix tests

* Add checks to runjob command

* Ruff

* Additional change fragments

* Address review feedback, add test coverage

* BugFix cf table entry rendering (#5081)

* BugFix cf table entry rendering

* Update nautobot/core/tables.py

Co-authored-by: Glenn Matthews <glenn.matthews@networktocode.com>

* Create 5081.fixed

---------

Co-authored-by: Glenn Matthews <glenn.matthews@networktocode.com>

* Fix #4075 - sortability of Device Bays list view by installed device status (#5110)

Co-authored-by: Hanlin Miao <46973263+HanlinMiao@users.noreply.github.com>

* Update PULL_REQUEST_TEMPLATE.md (#5118)

* Update PULL_REQUEST_TEMPLATE.md

* Create 5118.housekeeping

---------

Co-authored-by: Glenn Matthews <glenn.matthews@networktocode.com>

* Fixed Sync Git Repository requires non-matching permissions for UI vs API (#5128)

* Adds location & rack group to device bulk edit query params (#5113)

* Sanitize `render_markdown()` output with `nh3` library (#5133)

* Fix GHSA-v4xv-795h-rv4h.

* Renumber change fragments

* Address review feedback

* Test fix

* Ruff

* Review feedback

* Update nautobot/core/forms/fields.py

* Towncrier and version bump

* Fixes #5058: use location instead of location_id in vm forms (#5124)

* Bug: VM Interface vlan list in UI uses invalid option
Fixes #5058

* added changelog fragment

* grammer

* Update changes/5058.fixed

Co-authored-by: Hanlin Miao <46973263+HanlinMiao@users.noreply.github.com>

---------

Co-authored-by: TLCF <31373129+TLCF@users.noreply.github.com>
Co-authored-by: Glenn Matthews <glenn.matthews@networktocode.com>
Co-authored-by: Hanlin Miao <46973263+HanlinMiao@users.noreply.github.com>

* Update release note

* Add `TreeManager.max_depth` cachedproperty as an alternative to `max_tree_depth()` (#5131)

* Add TreeManager.max_depth cachedproperty as an alternative to max_tree_depth()

* Change fragment

* Add signal to clear max_depth cache when needed and test case to verify it

* Update release-note

---------

Co-authored-by: Timizuo <ebideritimizuo@gmail.com>
Co-authored-by: Timizuo <94907097+timizuoebideri1@users.noreply.github.com>
Co-authored-by: Gary Snider <75227981+gsnider2195@users.noreply.github.com>
Co-authored-by: Leo Kirchner <Kircheneer@users.noreply.github.com>
Co-authored-by: Hanlin Miao <46973263+HanlinMiao@users.noreply.github.com>
Co-authored-by: Eric Jacob <erjac77@gmail.com>
Co-authored-by: housepbass <80693460+housepbass@users.noreply.github.com>
Co-authored-by: Anthony House <anthony.house@networktocode.com>
Co-authored-by: Bryan Culver <31187+bryanculver@users.noreply.github.com>
Co-authored-by: dependabot[bot] <49699333+dependabot[bot]@users.noreply.github.com>
Co-authored-by: John Anderson <lampwins@gmail.com>
Co-authored-by: Josh VanDeraa <jv@networktocode.com>
Co-authored-by: Gerasimos Tzakis <gertzakis@gmail.com>
Co-authored-by: Jeff Kala <48843785+jeffkala@users.noreply.github.com>
Co-authored-by: Jacob McGill <9847006+jmcgill298@users.noreply.github.com>
Co-authored-by: Joe Wesch <10467633+joewesch@users.noreply.github.com>
Co-authored-by: TL <9435779+tlourey@users.noreply.github.com>
Co-authored-by: TLCF <31373129+TLCF@users.noreply.github.com>") [#5136](https://github.com/nautobot/nautobot/pull/5136) [from nautobot/release/2.1.2](/nautobot/nautobot/commit/4b7fa19ac53314aec75bf68d04b0d2a6fb2dcce4 "Merge pull request #5136 from nautobot/release/2.1.2

* Added global filtering to Job Result log table

* Fix integration test failure

* Apply suggestions from code review

Co-authored-by: Gary Snider <75227981+gsnider2195@users.noreply.github.com>

* use self.browser.is_text_not_present instead of time.sleep

* PR feedback

* fix migration

* fixes early return conditional in ensure_git_repository - again. (#5043)

The type returned by `git.Repo.rev_parse(\"HEAD\")` was still off, i.e. not
a string. This commit fixes this by converting it to a string.

Co-authored-by: Hanlin Miao <46973263+HanlinMiao@users.noreply.github.com>
Co-authored-by: Glenn Matthews <glenn.matthews@networktocode.com>

* Improve IPAddressEditView and IPAddressAssignView logic (#5054)

* Improve IPAddressEditView and IPAddressAssignView logic.

* Number change fragments

* Make ruff happy

---------

Co-authored-by: Hanlin Miao <46973263+HanlinMiao@users.noreply.github.com>

* bump version

* Process CSV import one row at a time to permit back-references (#4977)

* Process CSV import one row at a time to permit back-references to earlier rows

* Fix failing test

* Change fragment

---------

Co-authored-by: Hanlin Miao <46973263+HanlinMiao@users.noreply.github.com>

* fix: devcontainer (#4906)

* fix: devcontainer

* refactor(devcontainer): remove pylint and pre-commit leftover

* fix(devcontainer): arch detection

* feat(devcontainer): replace black, flake8 and isort with ruff

* refactor(devcontainer): remove prettier and eslint extensions

* refactor: remove eslint fixall

* refactor(devcontainer): move superuser information to dev.env

* fix(devcontainer): update comment with ruff instead of black

* update docs and add changelogs

* Apply suggestions from code review

* move changelogs to housekeeping category

---------

Co-authored-by: Gary Snider <75227981+gsnider2195@users.noreply.github.com>
Co-authored-by: Glenn Matthews <glenn.matthews@networktocode.com>

* tt

* ruff fix

* Fixed bug with invoke cli and invoke nbshell. (#5079)

Co-authored-by: Glenn Matthews <glenn.matthews@networktocode.com>

* Increase grid breakpoints by 240px (#5080)

* Update nautobot/extras/tests/integration/test_jobs.py

* bump packaging (#5077)

* bump packaging

* update lock file

* create change fragment

* update packaging dependency spec to '>=23.1'

* Update changes/5076.housekeeping

Co-authored-by: Glenn Matthews <glenn.matthews@networktocode.com>

---------

Co-authored-by: Anthony House <anthony.house@networktocode.com>
Co-authored-by: Glenn Matthews <glenn.matthews@networktocode.com>

* Job-related bug fixes (#5095)

* Job-related bug fixes

* Renumber change fragment

* [Snyk] Security upgrade jinja2 from 3.1.2 to 3.1.3 (#5086)

* Bump gitpython from 3.1.40 to 3.1.41 (#5083)

* A few performance updates (#5024)

Co-authored-by: Glenn Matthews <glenn.matthews@networktocode.com>
Co-authored-by: Gary Snider <75227981+gsnider2195@users.noreply.github.com>

* Skip test

* Removes startplugin mgmt cmd. (#5082)

Co-authored-by: Glenn Matthews <glenn.matthews@networktocode.com>

* Remove `files/get` endpoint which is not used from Nautobot 2.0 (#5115)

* remove `files/get` endpoint

* Update nautobot/core/tests/test_views.py

Co-authored-by: Glenn Matthews <glenn.matthews@networktocode.com>

* update based on review

---------

Co-authored-by: Glenn Matthews <glenn.matthews@networktocode.com>

* more flexible default sanitizer pattern (#4994)

* more flexible default sanitizer pattern

* Fix re.compile syntax

* add test for new patterns create changelog fragment

* fix test cases for new pattern

* update other santization references

* add examples of matching patterns

---------

Co-authored-by: Hanlin Miao <46973263+HanlinMiao@users.noreply.github.com>
Co-authored-by: Glenn Matthews <glenn.matthews@networktocode.com>

* More job fixes (#5102)

* More job fixes

* Renumber change fragment

* Revert redundant logging

* Enhance sanitize() to handle data other than strings, fix tests

* Add checks to runjob command

* Ruff

* Additional change fragments

* Address review feedback, add test coverage

* BugFix cf table entry rendering (#5081)

* BugFix cf table entry rendering

* Update nautobot/core/tables.py

Co-authored-by: Glenn Matthews <glenn.matthews@networktocode.com>

* Create 5081.fixed

---------

Co-authored-by: Glenn Matthews <glenn.matthews@networktocode.com>

* Fix #4075 - sortability of Device Bays list view by installed device status (#5110)

Co-authored-by: Hanlin Miao <46973263+HanlinMiao@users.noreply.github.com>

* Update PULL_REQUEST_TEMPLATE.md (#5118)

* Update PULL_REQUEST_TEMPLATE.md

* Create 5118.housekeeping

---------

Co-authored-by: Glenn Matthews <glenn.matthews@networktocode.com>

* Fixed Sync Git Repository requires non-matching permissions for UI vs API (#5128)

* Adds location & rack group to device bulk edit query params (#5113)

* Sanitize `render_markdown()` output with `nh3` library (#5133)

* Fix GHSA-v4xv-795h-rv4h.

* Renumber change fragments

* Address review feedback

* Test fix

* Ruff

* Review feedback

* Update nautobot/core/forms/fields.py

* Towncrier and version bump

* Fixes #5058: use location instead of location_id in vm forms (#5124)

* Bug: VM Interface vlan list in UI uses invalid option
Fixes #5058

* added changelog fragment

* grammer

* Update changes/5058.fixed

Co-authored-by: Hanlin Miao <46973263+HanlinMiao@users.noreply.github.com>

---------

Co-authored-by: TLCF <31373129+TLCF@users.noreply.github.com>
Co-authored-by: Glenn Matthews <glenn.matthews@networktocode.com>
Co-authored-by: Hanlin Miao <46973263+HanlinMiao@users.noreply.github.com>

* Update release note

* Add `TreeManager.max_depth` cachedproperty as an alternative to `max_tree_depth()` (#5131)

* Add TreeManager.max_depth cachedproperty as an alternative to max_tree_depth()

* Change fragment

* Add signal to clear max_depth cache when needed and test case to verify it

* Update release-note

---------

Co-authored-by: Timizuo <ebideritimizuo@gmail.com>
Co-authored-by: Timizuo <94907097+timizuoebideri1@users.noreply.github.com>
Co-authored-by: Gary Snider <75227981+gsnider2195@users.noreply.github.com>
Co-authored-by: Leo Kirchner <Kircheneer@users.noreply.github.com>
Co-authored-by: Hanlin Miao <46973263+HanlinMiao@users.noreply.github.com>
Co-authored-by: Eric Jacob <erjac77@gmail.com>
Co-authored-by: housepbass <80693460+housepbass@users.noreply.github.com>
Co-authored-by: Anthony House <anthony.house@networktocode.com>
Co-authored-by: Bryan Culver <31187+bryanculver@users.noreply.github.com>
Co-authored-by: dependabot[bot] <49699333+dependabot[bot]@users.noreply.github.com>
Co-authored-by: John Anderson <lampwins@gmail.com>
Co-authored-by: Josh VanDeraa <jv@networktocode.com>
Co-authored-by: Gerasimos Tzakis <gertzakis@gmail.com>
Co-authored-by: Jeff Kala <48843785+jeffkala@users.noreply.github.com>
Co-authored-by: Jacob McGill <9847006+jmcgill298@users.noreply.github.com>
Co-authored-by: Joe Wesch <10467633+joewesch@users.noreply.github.com>
Co-authored-by: TL <9435779+tlourey@users.noreply.github.com>
Co-authored-by: TLCF <31373129+TLCF@users.noreply.github.com>")`
…

`[4b7fa19](/nautobot/nautobot/commit/4b7fa19ac53314aec75bf68d04b0d2a6fb2dcce4)`

```
* Added global filtering to Job Result log table

* Fix integration test failure

* Apply suggestions from code review

Co-authored-by: Gary Snider <75227981+gsnider2195@users.noreply.github.com>

* use self.browser.is_text_not_present instead of time.sleep

* PR feedback

* fix migration

* fixes early return conditional in ensure_git_repository - again. ([#5043](https://github.com/nautobot/nautobot/pull/5043))

The type returned by `git.Repo.rev_parse("HEAD")` was still off, i.e. not
a string. This commit fixes this by converting it to a string.

Co-authored-by: Hanlin Miao <46973263+HanlinMiao@users.noreply.github.com>
Co-authored-by: Glenn Matthews <glenn.matthews@networktocode.com>

* Improve IPAddressEditView and IPAddressAssignView logic ([#5054](https://github.com/nautobot/nautobot/pull/5054))

* Improve IPAddressEditView and IPAddressAssignView logic.

* Number change fragments

* Make ruff happy

---------

Co-authored-by: Hanlin Miao <46973263+HanlinMiao@users.noreply.github.com>

* bump version

* Process CSV import one row at a time to permit back-references ([#4977](https://github.com/nautobot/nautobot/pull/4977))

* Process CSV import one row at a time to permit back-references to earlier rows

* Fix failing test

* Change fragment

---------

Co-authored-by: Hanlin Miao <46973263+HanlinMiao@users.noreply.github.com>

* fix: devcontainer ([#4906](https://github.com/nautobot/nautobot/pull/4906))

* fix: devcontainer

* refactor(devcontainer): remove pylint and pre-commit leftover

* fix(devcontainer): arch detection

* feat(devcontainer): replace black, flake8 and isort with ruff

* refactor(devcontainer): remove prettier and eslint extensions

* refactor: remove eslint fixall

* refactor(devcontainer): move superuser information to dev.env

* fix(devcontainer): update comment with ruff instead of black

* update docs and add changelogs

* Apply suggestions from code review

* move changelogs to housekeeping category

---------

Co-authored-by: Gary Snider <75227981+gsnider2195@users.noreply.github.com>
Co-authored-by: Glenn Matthews <glenn.matthews@networktocode.com>

* tt

* ruff fix

* Fixed bug with invoke cli and invoke nbshell. ([#5079](https://github.com/nautobot/nautobot/pull/5079))

Co-authored-by: Glenn Matthews <glenn.matthews@networktocode.com>

* Increase grid breakpoints by 240px ([#5080](https://github.com/nautobot/nautobot/pull/5080))

* Update nautobot/extras/tests/integration/test_jobs.py

* bump packaging ([#5077](https://github.com/nautobot/nautobot/pull/5077))

* bump packaging

* update lock file

* create change fragment

* update packaging dependency spec to '>=23.1'

* Update changes/5076.housekeeping

Co-authored-by: Glenn Matthews <glenn.matthews@networktocode.com>

---------

Co-authored-by: Anthony House <anthony.house@networktocode.com>
Co-authored-by: Glenn Matthews <glenn.matthews@networktocode.com>

* Job-related bug fixes ([#5095](https://github.com/nautobot/nautobot/pull/5095))

* Job-related bug fixes

* Renumber change fragment

* [Snyk] Security upgrade jinja2 from 3.1.2 to 3.1.3 ([#5086](https://github.com/nautobot/nautobot/pull/5086))

* Bump gitpython from 3.1.40 to 3.1.41 ([#5083](https://github.com/nautobot/nautobot/pull/5083))

* A few performance updates ([#5024](https://github.com/nautobot/nautobot/pull/5024))

Co-authored-by: Glenn Matthews <glenn.matthews@networktocode.com>
Co-authored-by: Gary Snider <75227981+gsnider2195@users.noreply.github.com>

* Skip test

* Removes startplugin mgmt cmd. ([#5082](https://github.com/nautobot/nautobot/pull/5082))

Co-authored-by: Glenn Matthews <glenn.matthews@networktocode.com>

* Remove `files/get` endpoint which is not used from Nautobot 2.0 ([#5115](https://github.com/nautobot/nautobot/pull/5115))

* remove `files/get` endpoint

* Update nautobot/core/tests/test_views.py

Co-authored-by: Glenn Matthews <glenn.matthews@networktocode.com>

* update based on review

---------

Co-authored-by: Glenn Matthews <glenn.matthews@networktocode.com>

* more flexible default sanitizer pattern ([#4994](https://github.com/nautobot/nautobot/pull/4994))

* more flexible default sanitizer pattern

* Fix re.compile syntax

* add test for new patterns create changelog fragment

* fix test cases for new pattern

* update other santization references

* add examples of matching patterns

---------

Co-authored-by: Hanlin Miao <46973263+HanlinMiao@users.noreply.github.com>
Co-authored-by: Glenn Matthews <glenn.matthews@networktocode.com>

* More job fixes ([#5102](https://github.com/nautobot/nautobot/pull/5102))

* More job fixes

* Renumber change fragment

* Revert redundant logging

* Enhance sanitize() to handle data other than strings, fix tests

* Add checks to runjob command

* Ruff

* Additional change fragments

* Address review feedback, add test coverage

* BugFix cf table entry rendering ([#5081](https://github.com/nautobot/nautobot/pull/5081))

* BugFix cf table entry rendering

* Update nautobot/core/tables.py

Co-authored-by: Glenn Matthews <glenn.matthews@networktocode.com>

* Create 5081.fixed

---------

Co-authored-by: Glenn Matthews <glenn.matthews@networktocode.com>

* Fix [#4075](https://github.com/nautobot/nautobot/issues/4075) - sortability of Device Bays list view by installed device status ([#5110](https://github.com/nautobot/nautobot/pull/5110))

Co-authored-by: Hanlin Miao <46973263+HanlinMiao@users.noreply.github.com>

* Update PULL_REQUEST_TEMPLATE.md ([#5118](https://github.com/nautobot/nautobot/pull/5118))

* Update PULL_REQUEST_TEMPLATE.md

* Create 5118.housekeeping

---------

Co-authored-by: Glenn Matthews <glenn.matthews@networktocode.com>

* Fixed Sync Git Repository requires non-matching permissions for UI vs API ([#5128](https://github.com/nautobot/nautobot/pull/5128))

* Adds location & rack group to device bulk edit query params ([#5113](https://github.com/nautobot/nautobot/pull/5113))

* Sanitize `render_markdown()` output with `nh3` library ([#5133](https://github.com/nautobot/nautobot/pull/5133))

* Fix [GHSA-v4xv-795h-rv4h](https://github.com/advisories/GHSA-v4xv-795h-rv4h "GHSA-v4xv-795h-rv4h").

* Renumber change fragments

* Address review feedback

* Test fix

* Ruff

* Review feedback

* Update nautobot/core/forms/fields.py

* Towncrier and version bump

* Fixes [#5058](https://github.com/nautobot/nautobot/issues/5058): use location instead of location_id in vm forms ([#5124](https://github.com/nautobot/nautobot/pull/5124))

* Bug: VM Interface vlan list in UI uses invalid option
Fixes [#5058](https://github.com/nautobot/nautobot/issues/5058)

* added changelog fragment

* grammer

* Update changes/5058.fixed

Co-authored-by: Hanlin Miao <46973263+HanlinMiao@users.noreply.github.com>

---------

Co-authored-by: TLCF <31373129+TLCF@users.noreply.github.com>
Co-authored-by: Glenn Matthews <glenn.matthews@networktocode.com>
Co-authored-by: Hanlin Miao <46973263+HanlinMiao@users.noreply.github.com>

* Update release note

* Add `TreeManager.max_depth` cachedproperty as an alternative to `max_tree_depth()` ([#5131](https://github.com/nautobot/nautobot/pull/5131))

* Add TreeManager.max_depth cachedproperty as an alternative to max_tree_depth()

* Change fragment

* Add signal to clear max_depth cache when needed and test case to verify it

* Update release-note

---------

Co-authored-by: Timizuo <ebideritimizuo@gmail.com>
Co-authored-by: Timizuo <94907097+timizuoebideri1@users.noreply.github.com>
Co-authored-by: Gary Snider <75227981+gsnider2195@users.noreply.github.com>
Co-authored-by: Leo Kirchner <Kircheneer@users.noreply.github.com>
Co-authored-by: Hanlin Miao <46973263+HanlinMiao@users.noreply.github.com>
Co-authored-by: Eric Jacob <erjac77@gmail.com>
Co-authored-by: housepbass <80693460+housepbass@users.noreply.github.com>
Co-authored-by: Anthony House <anthony.house@networktocode.com>
Co-authored-by: Bryan Culver <31187+bryanculver@users.noreply.github.com>
Co-authored-by: dependabot[bot] <49699333+dependabot[bot]@users.noreply.github.com>
Co-authored-by: John Anderson <lampwins@gmail.com>
Co-authored-by: Josh VanDeraa <jv@networktocode.com>
Co-authored-by: Gerasimos Tzakis <gertzakis@gmail.com>
Co-authored-by: Jeff Kala <48843785+jeffkala@users.noreply.github.com>
Co-authored-by: Jacob McGill <9847006+jmcgill298@users.noreply.github.com>
Co-authored-by: Joe Wesch <10467633+joewesch@users.noreply.github.com>
Co-authored-by: TL <9435779+tlourey@users.noreply.github.com>
Co-authored-by: TLCF <31373129+TLCF@users.noreply.github.com>
```

[![@gioccher](https://avatars.githubusercontent.com/u/921538?s=40&v=4)](/gioccher)
[gioccher](/gioccher)
mentioned this pull request
[May 21, 2024](#ref-issue-2308627743)

[Add markdown and/or sanitized HTML support to Computed Fields
#5743](/nautobot/nautobot/issues/5743)

Open

12 tasks

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Fnautobot%2Fnautobot%2Fpull%2F5133)

Reviewers

[![@HanlinMiao](https://avatars.githubusercontent.com/u/46973263?s=40&v=4)](/HanlinMiao) [HanlinMiao](/HanlinMiao)

HanlinMiao approved these changes

Assignees

[![@glennmatthews](https://avatars.githubusercontent.com/u/5603551?s=40&v=4)](/glennmatthews) [glennmatthews](/glennmatthews)

Labels

None yet

Projects

None yet

Milestone

No milestone

Development

Successfully merging this pull request may close these issues.

2 participants

[![@glennmatthews](https://avatars.githubusercontent.com/u/5603551?s=52&v=4)](/glennmatthews) [![@HanlinMiao](https://avatars.githubusercontent.com/u/46973263?s=52&v=4)](/HanlinMiao)

Add this suggestion to a batch that can be applied as a single commit.
This suggestion is invalid because no changes were made to the code.
Suggestions cannot be applied while the pull request is closed.
Suggestions cannot be applied while viewing a subset of changes.
Only one suggestion per line can be applied in a batch.
Add this suggestion to a batch that can be applied as a single commit.
Applying suggestions on deleted lines is not supported.
You must change the existing code in this line in order to create a valid suggestion.
Outdated suggestions cannot be applied.
This suggestion has been applied or marked resolved.
Suggestions cannot be applied from pending reviews.
Suggestions cannot be applied on multi-line comments.
Suggestions cannot be applied while the pull request is queued to merge.
Suggestion cannot be applied right now. Please check back later.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_565aa3dd_20250115_092807.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fnautobot%2Fnautobot%2Fpull%2F5134)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fnautobot%2Fnautobot%2Fpull%2F5134)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fpull_requests_fragments%2Fpull_request_layout&source=header-repo&source_repo=nautobot%2Fnautobot)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[nautobot](/nautobot)
/
**[nautobot](/nautobot/nautobot)**
Public

* [Notifications](/login?return_to=%2Fnautobot%2Fnautobot) You must be signed in to change notification settings
* [Fork
  298](/login?return_to=%2Fnautobot%2Fnautobot)
* [Star
   1.1k](/login?return_to=%2Fnautobot%2Fnautobot)

* [Code](/nautobot/nautobot)
* [Issues
  864](/nautobot/nautobot/issues)
* [Pull requests
  26](/nautobot/nautobot/pulls)
* [Discussions](/nautobot/nautobot/discussions)
* [Actions](/nautobot/nautobot/actions)
* [Projects
  0](/nautobot/nautobot/projects)
* [Wiki](/nautobot/nautobot/wiki)
* [Security](/nautobot/nautobot/security)
* [Insights](/nautobot/nautobot/pulse)

Additional navigation options

* [Code](/nautobot/nautobot)
* [Issues](/nautobot/nautobot/issues)
* [Pull requests](/nautobot/nautobot/pulls)
* [Discussions](/nautobot/nautobot/discussions)
* [Actions](/nautobot/nautobot/actions)
* [Projects](/nautobot/nautobot/projects)
* [Wiki](/nautobot/nautobot/wiki)
* [Security](/nautobot/nautobot/security)
* [Insights](/nautobot/nautobot/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Fnautobot%2Fnautobot%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Fnautobot%2Fnautobot%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# [1.6] Sanitize render\_markdown() output with nh3 library #5134

 Merged

[glennmatthews](/glennmatthews)
merged 9 commits into
[ltm-1.6](/nautobot/nautobot/tree/ltm-1.6 "nautobot/nautobot:ltm-1.6")
from
[GHSA-v4xv-795h-rv4h-LTM](/nautobot/nautobot/tree/GHSA-v4xv-795h-rv4h-LTM "nautobot/nautobot:GHSA-v4xv-795h-rv4h-LTM")

Jan 19, 2024

 Merged

# [[1.6] Sanitize render\_markdown() output with nh3 library](#top) #5134

[glennmatthews](/glennmatthews)
merged 9 commits into
[ltm-1.6](/nautobot/nautobot/tree/ltm-1.6 "nautobot/nautobot:ltm-1.6")
from
[GHSA-v4xv-795h-rv4h-LTM](/nautobot/nautobot/tree/GHSA-v4xv-795h-rv4h-LTM "nautobot/nautobot:GHSA-v4xv-795h-rv4h-LTM")

Jan 19, 2024

[Conversation
4](/nautobot/nautobot/pull/5134)
[Commits
9](/nautobot/nautobot/pull/5134/commits)
[Checks
16](/nautobot/nautobot/pull/5134/checks)
[Files changed](/nautobot/nautobot/pull/5134/files)

## Conversation

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

[![glennmatthews](https://avatars.githubusercontent.com/u/5603551?s=60&v=4)](/glennmatthews)

Copy link

Contributor

### @glennmatthews **[glennmatthews](/glennmatthews)** commented [Jan 19, 2024](#issue-2090616851)

# What's Changed

1.6 backport of [#5133](https://github.com/nautobot/nautobot/pull/5133). Some code location changes (e.g. `nautobot/utilities` vs `nautobot/core`) but otherwise the same code.

# Screenshots

# TODO

* Explanation of Change(s)
* Added change log fragment(s) (for more information see [the documentation](https://docs.nautobot.com/projects/core/en/stable/development/#creating-changelog-fragments))
* Attached Screenshots, Payload Example
* Unit, Integration Tests
* Documentation Updates (when adding/changing features)
* n/a Example Plugin Updates (when adding/changing features)
* Outline Remaining Work, Constraints from Design

Sorry, something went wrong.

All reactions

[![@glennmatthews](https://avatars.githubusercontent.com/u/5603551?s=40&v=4)](/glennmatthews)

`[Fix](/nautobot/nautobot/pull/5134/commits/b7a2bfeb07b72755055278abc30201bb627bfc9a "Fix GHSA-v4xv-795h-rv4h.") [GHSA-v4xv-795h-rv4h](https://github.com/advisories/GHSA-v4xv-795h-rv4h "GHSA-v4xv-795h-rv4h")[.](/nautobot/nautobot/pull/5134/commits/b7a2bfeb07b72755055278abc30201bb627bfc9a "Fix GHSA-v4xv-795h-rv4h.")`

`[b7a2bfe](/nautobot/nautobot/pull/5134/commits/b7a2bfeb07b72755055278abc30201bb627bfc9a)`

[![@glennmatthews](https://avatars.githubusercontent.com/u/5603551?s=40&u=aeb82c68b75837a6043df546cb680c7b2c7b25d2&v=4)](/glennmatthews)
[glennmatthews](/glennmatthews)
self-assigned this
[Jan 19, 2024](#event-11537870676)

 [glennmatthews](/glennmatthews)
added 5 commits
[January 19, 2024 08:55](#commits-pushed-1a121dc)

[![@glennmatthews](https://avatars.githubusercontent.com/u/5603551?s=40&v=4)](/glennmatthews)

`[Renumber change fragments](/nautobot/nautobot/pull/5134/commits/1a121dccd87a306b949191c8a83702435cbe1985 "Renumber change fragments")`

`[1a121dc](/nautobot/nautobot/pull/5134/commits/1a121dccd87a306b949191c8a83702435cbe1985)`

[![@glennmatthews](https://avatars.githubusercontent.com/u/5603551?s=40&v=4)](/glennmatthews)

`[Address review feedback](/nautobot/nautobot/pull/5134/commits/9b04a323c70785f5add175e00f91368ce387c234 "Address review feedback")`

`[9b04a32](/nautobot/nautobot/pull/5134/commits/9b04a323c70785f5add175e00f91368ce387c234)`

[![@glennmatthews](https://avatars.githubusercontent.com/u/5603551?s=40&v=4)](/glennmatthews)

`[Test fix](/nautobot/nautobot/pull/5134/commits/02a0e38a2761ff22a3b24617f6474178551bc079 "Test fix")`

`[02a0e38](/nautobot/nautobot/pull/5134/commits/02a0e38a2761ff22a3b24617f6474178551bc079)`

[![@glennmatthews](https://avatars.githubusercontent.com/u/5603551?s=40&v=4)](/glennmatthews)

`[Ruff](/nautobot/nautobot/pull/5134/commits/c76666cd2db1fbf5cc25bdf5aa2ba9f8c86e5b25 "Ruff")`

`[c76666c](/nautobot/nautobot/pull/5134/commits/c76666cd2db1fbf5cc25bdf5aa2ba9f8c86e5b25)`

[![@glennmatthews](https://avatars.githubusercontent.com/u/5603551?s=40&v=4)](/glennmatthews)

`[Review feedback](/nautobot/nautobot/pull/5134/commits/291bd6e912dd8220c55550c66382e0824ee22a64 "Review feedback")`

`[291bd6e](/nautobot/nautobot/pull/5134/commits/291bd6e912dd8220c55550c66382e0824ee22a64)`

[![HanlinMiao](https://avatars.githubusercontent.com/u/46973263?s=60&v=4)](/HanlinMiao)

**[HanlinMiao](/HanlinMiao)**
approved these changes
[Jan 19, 2024](#pullrequestreview-1833261712)

 [View reviewed changes](/nautobot/nautobot/pull/5134/files/291bd6e912dd8220c55550c66382e0824ee22a64)

[nautobot/utilities/forms/fields.py](/nautobot/nautobot/pull/5134/files/291bd6e912dd8220c55550c66382e0824ee22a64#diff-2b8d45fb821f9852b3de63ce5ce1a14214ba942e34466c386578500b5e42e735)
Outdated

Show resolved

Hide resolved

[![@glennmatthews](https://avatars.githubusercontent.com/u/5603551?s=40&v=4)](/glennmatthews) [![@HanlinMiao](https://avatars.githubusercontent.com/u/46973263?s=40&v=4)](/HanlinMiao)

`[Update nautobot/utilities/forms/fields.py](/nautobot/nautobot/pull/5134/commits/a2080b01a998064083aa540f1c3f71035d95555b "Update nautobot/utilities/forms/fields.py

Co-authored-by: Hanlin Miao <46973263+HanlinMiao@users.noreply.github.com>")`
 …

`[a2080b0](/nautobot/nautobot/pull/5134/commits/a2080b01a998064083aa540f1c3f71035d95555b)`

```
Co-authored-by: Hanlin Miao <46973263+HanlinMiao@users.noreply.github.com>
```

[![glennmatthews](https://avatars.githubusercontent.com/u/5603551?s=60&v=4)](/glennmatthews)

**[glennmatthews](/glennmatthews)**
commented
[Jan 19, 2024](#pullrequestreview-1833305200)

 [View reviewed changes](/nautobot/nautobot/pull/5134/files/a2080b01a998064083aa540f1c3f71035d95555b)

[nautobot/utilities/forms/fields.py](/nautobot/nautobot/pull/5134/files/a2080b01a998064083aa540f1c3f71035d95555b#diff-2b8d45fb821f9852b3de63ce5ce1a14214ba942e34466c386578500b5e42e735)
Outdated

Show resolved

Hide resolved

 [glennmatthews](/glennmatthews)
added 2 commits
[January 19, 2024 12:21](#commits-pushed-1ea92ae)

[![@glennmatthews](https://avatars.githubusercontent.com/u/5603551?s=40&v=4)](/glennmatthews)

`[Update nautobot/utilities/forms/fields.py](/nautobot/nautobot/pull/5134/commits/1ea92aed69f48fa60fa73f6df78ccb7f46e874a9 "Update nautobot/utilities/forms/fields.py")`

`[1ea92ae](/nautobot/nautobot/pull/5134/commits/1ea92aed69f48fa60fa73f6df78ccb7f46e874a9)`

[![@glennmatthews](https://avatars.githubusercontent.com/u/5603551?s=40&v=4)](/glennmatthews)

`[Merge branch 'ltm-1.6' into](/nautobot/nautobot/pull/5134/commits/00eda1620a62899ce107d31a105678ed06533575 "Merge branch 'ltm-1.6' into GHSA-v4xv-795h-rv4h-LTM") [GHSA-v4xv-795h-rv4h](https://github.com/advisories/GHSA-v4xv-795h-rv4h "GHSA-v4xv-795h-rv4h")[-LTM](/nautobot/nautobot/pull/5134/commits/00eda1620a62899ce107d31a105678ed06533575 "Merge branch 'ltm-1.6' into GHSA-v4xv-795h-rv4h-LTM")`

`[00eda16](/nautobot/nautobot/pull/5134/commits/00eda1620a62899ce107d31a105678ed06533575)`

[![gsnider2195](https://avatars.githubusercontent.com/u/75227981?s=60&v=4)](/gsnider2195)

**[gsnider2195](/gsnider2195)**
reviewed
[Jan 19, 2024](#pullrequestreview-1833718101)

 [View reviewed changes](/nautobot/nautobot/pull/5134/files/00eda1620a62899ce107d31a105678ed06533575)

[nautobot/utilities/templatetags/helpers.py](/nautobot/nautobot/pull/5134/files/00eda1620a62899ce107d31a105678ed06533575#diff-473815e5582260e6201f0daf0083d69561ecd6fa9290dd6ae5a361078b2cfa31)

Comment on lines
+170
 to
+172

|  |  | html = clean\_html(html) |
| --- | --- | --- |
|  |  |  |
|  |  | return mark\_safe(html) # noqa: S308 # suspicious-mark-safe-usage, OK here since we sanitized the string earlier |

Copy link

Contributor

### @gsnider2195 **[gsnider2195](/gsnider2195)** [Jan 19, 2024](#discussion_r1459770567)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Not blocking, but I wonder if `clean_html` should return a safe string?

Sorry, something went wrong.

All reactions

Copy link

Contributor

Author

### @glennmatthews **[glennmatthews](/glennmatthews)** [Jan 19, 2024](#discussion_r1459814499)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Maybe so - can revisit this once we have more than a single consumer of `clean_html` to think about?

Sorry, something went wrong.

All reactions

[![gsnider2195](https://avatars.githubusercontent.com/u/75227981?s=60&v=4)](/gsnider2195)

**[gsnider2195](/gsnider2195)**
approved these changes
[Jan 19, 2024](#pullrequestreview-1833720258)

 [View reviewed changes](/nautobot/nautobot/pull/5134/files/00eda1620a62899ce107d31a105678ed06533575)

 Hide details
View details

[![@glennmatthews](https://avatars.githubusercontent.com/u/5603551?s=40&u=aeb82c68b75837a6043df546cb680c7b2c7b25d2&v=4)](/glennmatthews)
[glennmatthews](/glennmatthews)
merged commit [`64312a4`](/nautobot/nautobot/commit/64312a4297b5ca49b6cdedf477e41e8e4fd61cce)
into
ltm-1.6

[Jan 19, 2024](https://github.com/nautobot/nautobot/pull/5134#event-11542424703)
19 checks passed

 [![@glennmatthews](https://avatars.githubusercontent.com/u/5603551?s=40&u=aeb82c68b75837a6043df546cb680c7b2c7b25d2&v=4)](/glennmatthews)
[glennmatthews](/glennmatthews)
deleted the
GHSA-v4xv-795h-rv4h-LTM

branch
[January 19, 2024 21:37](#event-11542424835)

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Fnautobot%2Fnautobot%2Fpull%2F5134)

Reviewers

[![@gsnider2195](https://avatars.githubusercontent.com/u/75227981?s=40&v=4)](/gsnider2195) [gsnider2195](/gsnider2195)

gsnider2195 approved these changes

[![@HanlinMiao](https://avatars.githubusercontent.com/u/46973263?s=40&v=4)](/HanlinMiao) [HanlinMiao](/HanlinMiao)

HanlinMiao approved these changes

Assignees

[![@glennmatthews](https://avatars.githubusercontent.com/u/5603551?s=40&v=4)](/glennmatthews) [glennmatthews](/glennmatthews)

Labels

None yet

Projects

None yet

Milestone

No milestone

Development

Successfully merging this pull request may close these issues.

3 participants

[![@glennmatthews](https://avatars.githubusercontent.com/u/5603551?s=52&v=4)](/glennmatthews) [![@HanlinMiao](https://avatars.githubusercontent.com/u/46973263?s=52&v=4)](/HanlinMiao) [![@gsnider2195](https://avatars.githubusercontent.com/u/75227981?s=52&v=4)](/gsnider2195)

Add this suggestion to a batch that can be applied as a single commit.
This suggestion is invalid because no changes were made to the code.
Suggestions cannot be applied while the pull request is closed.
Suggestions cannot be applied while viewing a subset of changes.
Only one suggestion per line can be applied in a batch.
Add this suggestion to a batch that can be applied as a single commit.
Applying suggestions on deleted lines is not supported.
You must change the existing code in this line in order to create a valid suggestion.
Outdated suggestions cannot be applied.
This suggestion has been applied or marked resolved.
Suggestions cannot be applied from pending reviews.
Suggestions cannot be applied on multi-line comments.
Suggestions cannot be applied while the pull request is queued to merge.
Suggestion cannot be applied right now. Please check back later.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


