=== Content from git.kernel.org_2cc4c8ea_20250114_225845.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=683fcd90ba22507ebeb1921a26dfe77efff8c266)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=683fcd90ba22507ebeb1921a26dfe77efff8c266)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=683fcd90ba22507ebeb1921a26dfe77efff8c266)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=683fcd90ba22507ebeb1921a26dfe77efff8c266)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Pavan Kumar Linga <pavan.kumar.linga@intel.com> | 2024-10-25 11:38:43 -0700 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-11-14 13:21:10 +0100 |
| commit | [683fcd90ba22507ebeb1921a26dfe77efff8c266](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=683fcd90ba22507ebeb1921a26dfe77efff8c266) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=683fcd90ba22507ebeb1921a26dfe77efff8c266)) | |
| tree | [fc9566034cfa341bcafd33facc480d7e63357052](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=683fcd90ba22507ebeb1921a26dfe77efff8c266) | |
| parent | [fa4d906ad0fb63a980a1d586a061c78ea1a345ba](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=fa4d906ad0fb63a980a1d586a061c78ea1a345ba) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=683fcd90ba22507ebeb1921a26dfe77efff8c266&id2=fa4d906ad0fb63a980a1d586a061c78ea1a345ba)) | |
| download | [linux-683fcd90ba22507ebeb1921a26dfe77efff8c266.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-683fcd90ba22507ebeb1921a26dfe77efff8c266.tar.gz) | |

idpf: fix idpf\_vc\_core\_init error pathcommit 9b58031ff96b84a38d7b73b23c7ecfb2e0557f43 upstream.
In an event where the platform running the device control plane
is rebooted, reset is detected on the driver. It releases
all the resources and waits for the reset to complete. Once the
reset is done, it tries to build the resources back. At this
time if the device control plane is not yet started, then
the driver timeouts on the virtchnl message and retries to
establish the mailbox again.
In the retry flow, mailbox is deinitialized but the mailbox
workqueue is still alive and polling for the mailbox message.
This results in accessing the released control queue leading to
null-ptr-deref. Fix it by unrolling the work queue cancellation
and mailbox deinitialization in the reverse order which they got
initialized.
Fixes: 4930fbf419a7 ("idpf: add core init and interrupt request")
Fixes: 34c21fa894a1 ("idpf: implement virtchnl transaction manager")
Cc: stable@vger.kernel.org # 6.9+
Reviewed-by: Tarun K Singh <tarun.k.singh@intel.com>
Signed-off-by: Pavan Kumar Linga <pavan.kumar.linga@intel.com>
Tested-by: Krishneil Singh <krishneil.k.singh@intel.com>
Signed-off-by: Tony Nguyen <anthony.l.nguyen@intel.com>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=683fcd90ba22507ebeb1921a26dfe77efff8c266)

| -rw-r--r-- | [drivers/net/ethernet/intel/idpf/idpf\_lib.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/ethernet/intel/idpf/idpf_lib.c?id=683fcd90ba22507ebeb1921a26dfe77efff8c266) | 1 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |
| -rw-r--r-- | [drivers/net/ethernet/intel/idpf/idpf\_virtchnl.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/ethernet/intel/idpf/idpf_virtchnl.c?id=683fcd90ba22507ebeb1921a26dfe77efff8c266) | 1 | |  |  |  | | --- | --- | --- | |

2 files changed, 1 insertions, 1 deletions

| diff --git a/drivers/net/ethernet/intel/idpf/idpf\_lib.c b/drivers/net/ethernet/intel/idpf/idpf\_lib.cindex a1b0d8d8a380fb..e46b1a60f1f443 100644--- a/[drivers/net/ethernet/intel/idpf/idpf\_lib.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/intel/idpf/idpf_lib.c?id=fa4d906ad0fb63a980a1d586a061c78ea1a345ba)+++ b/[drivers/net/ethernet/intel/idpf/idpf\_lib.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/intel/idpf/idpf_lib.c?id=683fcd90ba22507ebeb1921a26dfe77efff8c266)@@ -1799,6 +1799,7 @@ static int idpf\_init\_hard\_reset(struct idpf\_adapter \*adapter) \*/ err = idpf\_vc\_core\_init(adapter); if (err) {+ cancel\_delayed\_work\_sync(&adapter->mbx\_task); idpf\_deinit\_dflt\_mbx(adapter); goto unlock\_mutex; }diff --git a/drivers/net/ethernet/intel/idpf/idpf\_virtchnl.c b/drivers/net/ethernet/intel/idpf/idpf\_virtchnl.cindex b80fa4d9f5b214..c477d4453e9057 100644--- a/[drivers/net/ethernet/intel/idpf/idpf\_virtchnl.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/intel/idpf/idpf_virtchnl.c?id=fa4d906ad0fb63a980a1d586a061c78ea1a345ba)+++ b/[drivers/net/ethernet/intel/idpf/idpf\_virtchnl.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/intel/idpf/idpf_virtchnl.c?id=683fcd90ba22507ebeb1921a26dfe77efff8c266)@@ -3063,7 +3063,6 @@ init\_failed: adapter->state = \_\_IDPF\_VER\_CHECK; if (adapter->vcxn\_mngr) idpf\_vc\_xn\_shutdown(adapter->vcxn\_mngr);- idpf\_deinit\_dflt\_mbx(adapter); set\_bit(IDPF\_HR\_DRV\_LOAD, adapter->flags); queue\_delayed\_work(adapter->vc\_event\_wq, &adapter->vc\_event\_task, msecs\_to\_jiffies(task\_delay)); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 22:57:22 +0000



=== Content from git.kernel.org_6eaa3c2e_20250114_225846.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=9b58031ff96b84a38d7b73b23c7ecfb2e0557f43)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=9b58031ff96b84a38d7b73b23c7ecfb2e0557f43)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=9b58031ff96b84a38d7b73b23c7ecfb2e0557f43)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=9b58031ff96b84a38d7b73b23c7ecfb2e0557f43)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Pavan Kumar Linga <pavan.kumar.linga@intel.com> | 2024-10-25 11:38:43 -0700 |
| --- | --- | --- |
| committer | Tony Nguyen <anthony.l.nguyen@intel.com> | 2024-11-04 13:09:34 -0800 |
| commit | [9b58031ff96b84a38d7b73b23c7ecfb2e0557f43](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=9b58031ff96b84a38d7b73b23c7ecfb2e0557f43) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=9b58031ff96b84a38d7b73b23c7ecfb2e0557f43)) | |
| tree | [1c720ec76a8048a47588548af461f2c19aeb298d](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=9b58031ff96b84a38d7b73b23c7ecfb2e0557f43) | |
| parent | [81d2fb4c7c18a3b36ba3e00b9d5b753107472d75](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=81d2fb4c7c18a3b36ba3e00b9d5b753107472d75) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=9b58031ff96b84a38d7b73b23c7ecfb2e0557f43&id2=81d2fb4c7c18a3b36ba3e00b9d5b753107472d75)) | |
| download | [linux-9b58031ff96b84a38d7b73b23c7ecfb2e0557f43.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-9b58031ff96b84a38d7b73b23c7ecfb2e0557f43.tar.gz) | |

idpf: fix idpf\_vc\_core\_init error pathIn an event where the platform running the device control plane
is rebooted, reset is detected on the driver. It releases
all the resources and waits for the reset to complete. Once the
reset is done, it tries to build the resources back. At this
time if the device control plane is not yet started, then
the driver timeouts on the virtchnl message and retries to
establish the mailbox again.
In the retry flow, mailbox is deinitialized but the mailbox
workqueue is still alive and polling for the mailbox message.
This results in accessing the released control queue leading to
null-ptr-deref. Fix it by unrolling the work queue cancellation
and mailbox deinitialization in the reverse order which they got
initialized.
Fixes: 4930fbf419a7 ("idpf: add core init and interrupt request")
Fixes: 34c21fa894a1 ("idpf: implement virtchnl transaction manager")
Cc: stable@vger.kernel.org # 6.9+
Reviewed-by: Tarun K Singh <tarun.k.singh@intel.com>
Signed-off-by: Pavan Kumar Linga <pavan.kumar.linga@intel.com>
Tested-by: Krishneil Singh <krishneil.k.singh@intel.com>
Signed-off-by: Tony Nguyen <anthony.l.nguyen@intel.com>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=9b58031ff96b84a38d7b73b23c7ecfb2e0557f43)

| -rw-r--r-- | [drivers/net/ethernet/intel/idpf/idpf\_lib.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/ethernet/intel/idpf/idpf_lib.c?id=9b58031ff96b84a38d7b73b23c7ecfb2e0557f43) | 1 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |
| -rw-r--r-- | [drivers/net/ethernet/intel/idpf/idpf\_virtchnl.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/ethernet/intel/idpf/idpf_virtchnl.c?id=9b58031ff96b84a38d7b73b23c7ecfb2e0557f43) | 1 | |  |  |  | | --- | --- | --- | |

2 files changed, 1 insertions, 1 deletions

| diff --git a/drivers/net/ethernet/intel/idpf/idpf\_lib.c b/drivers/net/ethernet/intel/idpf/idpf\_lib.cindex c3848e10e7dbef..b4fbb99bfad208 100644--- a/[drivers/net/ethernet/intel/idpf/idpf\_lib.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/intel/idpf/idpf_lib.c?id=81d2fb4c7c18a3b36ba3e00b9d5b753107472d75)+++ b/[drivers/net/ethernet/intel/idpf/idpf\_lib.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/intel/idpf/idpf_lib.c?id=9b58031ff96b84a38d7b73b23c7ecfb2e0557f43)@@ -1786,6 +1786,7 @@ static int idpf\_init\_hard\_reset(struct idpf\_adapter \*adapter) \*/ err = idpf\_vc\_core\_init(adapter); if (err) {+ cancel\_delayed\_work\_sync(&adapter->mbx\_task); idpf\_deinit\_dflt\_mbx(adapter); goto unlock\_mutex; }diff --git a/drivers/net/ethernet/intel/idpf/idpf\_virtchnl.c b/drivers/net/ethernet/intel/idpf/idpf\_virtchnl.cindex ce217e274506db..d46c95f91b0d81 100644--- a/[drivers/net/ethernet/intel/idpf/idpf\_virtchnl.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/intel/idpf/idpf_virtchnl.c?id=81d2fb4c7c18a3b36ba3e00b9d5b753107472d75)+++ b/[drivers/net/ethernet/intel/idpf/idpf\_virtchnl.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/intel/idpf/idpf_virtchnl.c?id=9b58031ff96b84a38d7b73b23c7ecfb2e0557f43)@@ -3063,7 +3063,6 @@ init\_failed: adapter->state = \_\_IDPF\_VER\_CHECK; if (adapter->vcxn\_mngr) idpf\_vc\_xn\_shutdown(adapter->vcxn\_mngr);- idpf\_deinit\_dflt\_mbx(adapter); set\_bit(IDPF\_HR\_DRV\_LOAD, adapter->flags); queue\_delayed\_work(adapter->vc\_event\_wq, &adapter->vc\_event\_task, msecs\_to\_jiffies(task\_delay)); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 22:57:23 +0000


