=== Content from git.kernel.org_a1841e64_20250114_204448.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=21e1cf688fb0397788c8dd42e1e0b08d58ac5c7b)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=21e1cf688fb0397788c8dd42e1e0b08d58ac5c7b)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=21e1cf688fb0397788c8dd42e1e0b08d58ac5c7b)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=21e1cf688fb0397788c8dd42e1e0b08d58ac5c7b)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Chuck Lever <chuck.lever@oracle.com> | 2024-09-17 12:15:29 -0400 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-14 19:51:06 +0100 |
| commit | [21e1cf688fb0397788c8dd42e1e0b08d58ac5c7b](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=21e1cf688fb0397788c8dd42e1e0b08d58ac5c7b) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=21e1cf688fb0397788c8dd42e1e0b08d58ac5c7b)) | |
| tree | [5f2ff067c12d9f9662c88085b5d656a227479a0a](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=21e1cf688fb0397788c8dd42e1e0b08d58ac5c7b) | |
| parent | [3ffaa3205380c8354dd8fae01064984a9a489dd8](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=3ffaa3205380c8354dd8fae01064984a9a489dd8) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=21e1cf688fb0397788c8dd42e1e0b08d58ac5c7b&id2=3ffaa3205380c8354dd8fae01064984a9a489dd8)) | |
| download | [linux-21e1cf688fb0397788c8dd42e1e0b08d58ac5c7b.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-21e1cf688fb0397788c8dd42e1e0b08d58ac5c7b.tar.gz) | |

svcrdma: Address an integer overflow[ Upstream commit 3c63d8946e578663b868cb9912dac616ea68bfd0 ]
Dan Carpenter reports:
> Commit 78147ca8b4a9 ("svcrdma: Add a "parsed chunk list" data
> structure") from Jun 22, 2020 (linux-next), leads to the following
> Smatch static checker warning:
>
> net/sunrpc/xprtrdma/svc\_rdma\_recvfrom.c:498 xdr\_check\_write\_chunk()
> warn: potential user controlled sizeof overflow 'segcount \* 4 \* 4'
>
> net/sunrpc/xprtrdma/svc\_rdma\_recvfrom.c
> 488 static bool xdr\_check\_write\_chunk(struct svc\_rdma\_recv\_ctxt \*rctxt)
> 489 {
> 490 u32 segcount;
> 491 \_\_be32 \*p;
> 492
> 493 if (xdr\_stream\_decode\_u32(&rctxt->rc\_stream, &segcount))
> ^^^^^^^^
>
> 494 return false;
> 495
> 496 /\* A bogus segcount causes this buffer overflow check to fail. \*/
> 497 p = xdr\_inline\_decode(&rctxt->rc\_stream,
> --> 498 segcount \* rpcrdma\_segment\_maxsz \* sizeof(\*p));
>
>
> segcount is an untrusted u32. On 32bit systems anything >= SIZE\_MAX / 16 will
> have an integer overflow and some those values will be accepted by
> xdr\_inline\_decode().
Reported-by: Dan Carpenter <dan.carpenter@linaro.org>
Fixes: 78147ca8b4a9 ("svcrdma: Add a "parsed chunk list" data structure")
Reviewed-by: Jeff Layton <jlayton@kernel.org>
Signed-off-by: Chuck Lever <chuck.lever@oracle.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=21e1cf688fb0397788c8dd42e1e0b08d58ac5c7b)

| -rw-r--r-- | [net/sunrpc/xprtrdma/svc\_rdma\_recvfrom.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/sunrpc/xprtrdma/svc_rdma_recvfrom.c?id=21e1cf688fb0397788c8dd42e1e0b08d58ac5c7b) | 8 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 7 insertions, 1 deletions

| diff --git a/net/sunrpc/xprtrdma/svc\_rdma\_recvfrom.c b/net/sunrpc/xprtrdma/svc\_rdma\_recvfrom.cindex 9a80d3be1f6353..adfe05f19060a8 100644--- a/[net/sunrpc/xprtrdma/svc\_rdma\_recvfrom.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/sunrpc/xprtrdma/svc_rdma_recvfrom.c?id=3ffaa3205380c8354dd8fae01064984a9a489dd8)+++ b/[net/sunrpc/xprtrdma/svc\_rdma\_recvfrom.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/sunrpc/xprtrdma/svc_rdma_recvfrom.c?id=21e1cf688fb0397788c8dd42e1e0b08d58ac5c7b)@@ -477,7 +477,13 @@ static bool xdr\_check\_write\_chunk(struct svc\_rdma\_recv\_ctxt \*rctxt) if (xdr\_stream\_decode\_u32(&rctxt->rc\_stream, &segcount)) return false; - /\* A bogus segcount causes this buffer overflow check to fail. \*/+ /\* Before trusting the segcount value enough to use it in+ \* a computation, perform a simple range check. This is an+ \* arbitrary but sensible limit (ie, not architectural).+ \*/+ if (unlikely(segcount > RPCSVC\_MAXPAGES))+ return false;+ p = xdr\_inline\_decode(&rctxt->rc\_stream, segcount \* rpcrdma\_segment\_maxsz \* sizeof(\*p)); return p != NULL; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 20:43:24 +0000



=== Content from git.kernel.org_9cdea70b_20250114_204449.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=4cbc3ba6dc2f746497cade60bcbaa82ae3696689)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=4cbc3ba6dc2f746497cade60bcbaa82ae3696689)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=4cbc3ba6dc2f746497cade60bcbaa82ae3696689)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=4cbc3ba6dc2f746497cade60bcbaa82ae3696689)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Chuck Lever <chuck.lever@oracle.com> | 2024-09-17 12:15:29 -0400 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-05 13:53:51 +0100 |
| commit | [4cbc3ba6dc2f746497cade60bcbaa82ae3696689](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=4cbc3ba6dc2f746497cade60bcbaa82ae3696689) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=4cbc3ba6dc2f746497cade60bcbaa82ae3696689)) | |
| tree | [dfcf70fef58cacc165ef88cd3f1b3fc371af29bd](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=4cbc3ba6dc2f746497cade60bcbaa82ae3696689) | |
| parent | [cad49f6a45bdbca6ac12994c6fe9a3307db7ff91](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=cad49f6a45bdbca6ac12994c6fe9a3307db7ff91) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=4cbc3ba6dc2f746497cade60bcbaa82ae3696689&id2=cad49f6a45bdbca6ac12994c6fe9a3307db7ff91)) | |
| download | [linux-4cbc3ba6dc2f746497cade60bcbaa82ae3696689.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-4cbc3ba6dc2f746497cade60bcbaa82ae3696689.tar.gz) | |

svcrdma: Address an integer overflow[ Upstream commit 3c63d8946e578663b868cb9912dac616ea68bfd0 ]
Dan Carpenter reports:
> Commit 78147ca8b4a9 ("svcrdma: Add a "parsed chunk list" data
> structure") from Jun 22, 2020 (linux-next), leads to the following
> Smatch static checker warning:
>
> net/sunrpc/xprtrdma/svc\_rdma\_recvfrom.c:498 xdr\_check\_write\_chunk()
> warn: potential user controlled sizeof overflow 'segcount \* 4 \* 4'
>
> net/sunrpc/xprtrdma/svc\_rdma\_recvfrom.c
> 488 static bool xdr\_check\_write\_chunk(struct svc\_rdma\_recv\_ctxt \*rctxt)
> 489 {
> 490 u32 segcount;
> 491 \_\_be32 \*p;
> 492
> 493 if (xdr\_stream\_decode\_u32(&rctxt->rc\_stream, &segcount))
> ^^^^^^^^
>
> 494 return false;
> 495
> 496 /\* A bogus segcount causes this buffer overflow check to fail. \*/
> 497 p = xdr\_inline\_decode(&rctxt->rc\_stream,
> --> 498 segcount \* rpcrdma\_segment\_maxsz \* sizeof(\*p));
>
>
> segcount is an untrusted u32. On 32bit systems anything >= SIZE\_MAX / 16 will
> have an integer overflow and some those values will be accepted by
> xdr\_inline\_decode().
Reported-by: Dan Carpenter <dan.carpenter@linaro.org>
Fixes: 78147ca8b4a9 ("svcrdma: Add a "parsed chunk list" data structure")
Reviewed-by: Jeff Layton <jlayton@kernel.org>
Signed-off-by: Chuck Lever <chuck.lever@oracle.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=4cbc3ba6dc2f746497cade60bcbaa82ae3696689)

| -rw-r--r-- | [net/sunrpc/xprtrdma/svc\_rdma\_recvfrom.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/sunrpc/xprtrdma/svc_rdma_recvfrom.c?id=4cbc3ba6dc2f746497cade60bcbaa82ae3696689) | 8 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 7 insertions, 1 deletions

| diff --git a/net/sunrpc/xprtrdma/svc\_rdma\_recvfrom.c b/net/sunrpc/xprtrdma/svc\_rdma\_recvfrom.cindex d72953f2925827..69d497a0ca204c 100644--- a/[net/sunrpc/xprtrdma/svc\_rdma\_recvfrom.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/sunrpc/xprtrdma/svc_rdma_recvfrom.c?id=cad49f6a45bdbca6ac12994c6fe9a3307db7ff91)+++ b/[net/sunrpc/xprtrdma/svc\_rdma\_recvfrom.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/sunrpc/xprtrdma/svc_rdma_recvfrom.c?id=4cbc3ba6dc2f746497cade60bcbaa82ae3696689)@@ -493,7 +493,13 @@ static bool xdr\_check\_write\_chunk(struct svc\_rdma\_recv\_ctxt \*rctxt) if (xdr\_stream\_decode\_u32(&rctxt->rc\_stream, &segcount)) return false; - /\* A bogus segcount causes this buffer overflow check to fail. \*/+ /\* Before trusting the segcount value enough to use it in+ \* a computation, perform a simple range check. This is an+ \* arbitrary but sensible limit (ie, not architectural).+ \*/+ if (unlikely(segcount > RPCSVC\_MAXPAGES))+ return false;+ p = xdr\_inline\_decode(&rctxt->rc\_stream, segcount \* rpcrdma\_segment\_maxsz \* sizeof(\*p)); return p != NULL; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 20:43:27 +0000



=== Content from git.kernel.org_34b19577_20250114_204449.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=3c63d8946e578663b868cb9912dac616ea68bfd0)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=3c63d8946e578663b868cb9912dac616ea68bfd0)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=3c63d8946e578663b868cb9912dac616ea68bfd0)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=3c63d8946e578663b868cb9912dac616ea68bfd0)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Chuck Lever <chuck.lever@oracle.com> | 2024-09-17 12:15:29 -0400 |
| --- | --- | --- |
| committer | Chuck Lever <chuck.lever@oracle.com> | 2024-11-11 13:41:57 -0500 |
| commit | [3c63d8946e578663b868cb9912dac616ea68bfd0](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=3c63d8946e578663b868cb9912dac616ea68bfd0) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=3c63d8946e578663b868cb9912dac616ea68bfd0)) | |
| tree | [ba7eba233f140c3bee39fe83ec16d26e622f628c](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=3c63d8946e578663b868cb9912dac616ea68bfd0) | |
| parent | [7f33b92e5b18e904a481e6e208486da43e4dc841](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=7f33b92e5b18e904a481e6e208486da43e4dc841) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=3c63d8946e578663b868cb9912dac616ea68bfd0&id2=7f33b92e5b18e904a481e6e208486da43e4dc841)) | |
| download | [linux-3c63d8946e578663b868cb9912dac616ea68bfd0.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-3c63d8946e578663b868cb9912dac616ea68bfd0.tar.gz) | |

svcrdma: Address an integer overflowDan Carpenter reports:
> Commit 78147ca8b4a9 ("svcrdma: Add a "parsed chunk list" data
> structure") from Jun 22, 2020 (linux-next), leads to the following
> Smatch static checker warning:
>
> net/sunrpc/xprtrdma/svc\_rdma\_recvfrom.c:498 xdr\_check\_write\_chunk()
> warn: potential user controlled sizeof overflow 'segcount \* 4 \* 4'
>
> net/sunrpc/xprtrdma/svc\_rdma\_recvfrom.c
> 488 static bool xdr\_check\_write\_chunk(struct svc\_rdma\_recv\_ctxt \*rctxt)
> 489 {
> 490 u32 segcount;
> 491 \_\_be32 \*p;
> 492
> 493 if (xdr\_stream\_decode\_u32(&rctxt->rc\_stream, &segcount))
> ^^^^^^^^
>
> 494 return false;
> 495
> 496 /\* A bogus segcount causes this buffer overflow check to fail. \*/
> 497 p = xdr\_inline\_decode(&rctxt->rc\_stream,
> --> 498 segcount \* rpcrdma\_segment\_maxsz \* sizeof(\*p));
>
>
> segcount is an untrusted u32. On 32bit systems anything >= SIZE\_MAX / 16 will
> have an integer overflow and some those values will be accepted by
> xdr\_inline\_decode().
Reported-by: Dan Carpenter <dan.carpenter@linaro.org>
Fixes: 78147ca8b4a9 ("svcrdma: Add a "parsed chunk list" data structure")
Reviewed-by: Jeff Layton <jlayton@kernel.org>
Signed-off-by: Chuck Lever <chuck.lever@oracle.com>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=3c63d8946e578663b868cb9912dac616ea68bfd0)

| -rw-r--r-- | [net/sunrpc/xprtrdma/svc\_rdma\_recvfrom.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/sunrpc/xprtrdma/svc_rdma_recvfrom.c?id=3c63d8946e578663b868cb9912dac616ea68bfd0) | 8 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 7 insertions, 1 deletions

| diff --git a/net/sunrpc/xprtrdma/svc\_rdma\_recvfrom.c b/net/sunrpc/xprtrdma/svc\_rdma\_recvfrom.cindex ae3fb9bc8a2168..292022f0976e17 100644--- a/[net/sunrpc/xprtrdma/svc\_rdma\_recvfrom.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/sunrpc/xprtrdma/svc_rdma_recvfrom.c?id=7f33b92e5b18e904a481e6e208486da43e4dc841)+++ b/[net/sunrpc/xprtrdma/svc\_rdma\_recvfrom.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/sunrpc/xprtrdma/svc_rdma_recvfrom.c?id=3c63d8946e578663b868cb9912dac616ea68bfd0)@@ -493,7 +493,13 @@ static bool xdr\_check\_write\_chunk(struct svc\_rdma\_recv\_ctxt \*rctxt) if (xdr\_stream\_decode\_u32(&rctxt->rc\_stream, &segcount)) return false; - /\* A bogus segcount causes this buffer overflow check to fail. \*/+ /\* Before trusting the segcount value enough to use it in+ \* a computation, perform a simple range check. This is an+ \* arbitrary but sensible limit (ie, not architectural).+ \*/+ if (unlikely(segcount > RPCSVC\_MAXPAGES))+ return false;+ p = xdr\_inline\_decode(&rctxt->rc\_stream, segcount \* rpcrdma\_segment\_maxsz \* sizeof(\*p)); return p != NULL; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 20:43:26 +0000



=== Content from git.kernel.org_cfa19a13_20250114_204451.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=c1f8195bf68edd2cef0f18a4cead394075a54b5a)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=c1f8195bf68edd2cef0f18a4cead394075a54b5a)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=c1f8195bf68edd2cef0f18a4cead394075a54b5a)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=c1f8195bf68edd2cef0f18a4cead394075a54b5a)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Chuck Lever <chuck.lever@oracle.com> | 2024-09-17 12:15:29 -0400 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-14 19:53:46 +0100 |
| commit | [c1f8195bf68edd2cef0f18a4cead394075a54b5a](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=c1f8195bf68edd2cef0f18a4cead394075a54b5a) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=c1f8195bf68edd2cef0f18a4cead394075a54b5a)) | |
| tree | [be10c464fef33ba4a4c61984feda01fd274347d0](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=c1f8195bf68edd2cef0f18a4cead394075a54b5a) | |
| parent | [bab3e342768e64d2472b6d53537e6d6f1a189690](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=bab3e342768e64d2472b6d53537e6d6f1a189690) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=c1f8195bf68edd2cef0f18a4cead394075a54b5a&id2=bab3e342768e64d2472b6d53537e6d6f1a189690)) | |
| download | [linux-c1f8195bf68edd2cef0f18a4cead394075a54b5a.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-c1f8195bf68edd2cef0f18a4cead394075a54b5a.tar.gz) | |

svcrdma: Address an integer overflow[ Upstream commit 3c63d8946e578663b868cb9912dac616ea68bfd0 ]
Dan Carpenter reports:
> Commit 78147ca8b4a9 ("svcrdma: Add a "parsed chunk list" data
> structure") from Jun 22, 2020 (linux-next), leads to the following
> Smatch static checker warning:
>
> net/sunrpc/xprtrdma/svc\_rdma\_recvfrom.c:498 xdr\_check\_write\_chunk()
> warn: potential user controlled sizeof overflow 'segcount \* 4 \* 4'
>
> net/sunrpc/xprtrdma/svc\_rdma\_recvfrom.c
> 488 static bool xdr\_check\_write\_chunk(struct svc\_rdma\_recv\_ctxt \*rctxt)
> 489 {
> 490 u32 segcount;
> 491 \_\_be32 \*p;
> 492
> 493 if (xdr\_stream\_decode\_u32(&rctxt->rc\_stream, &segcount))
> ^^^^^^^^
>
> 494 return false;
> 495
> 496 /\* A bogus segcount causes this buffer overflow check to fail. \*/
> 497 p = xdr\_inline\_decode(&rctxt->rc\_stream,
> --> 498 segcount \* rpcrdma\_segment\_maxsz \* sizeof(\*p));
>
>
> segcount is an untrusted u32. On 32bit systems anything >= SIZE\_MAX / 16 will
> have an integer overflow and some those values will be accepted by
> xdr\_inline\_decode().
Reported-by: Dan Carpenter <dan.carpenter@linaro.org>
Fixes: 78147ca8b4a9 ("svcrdma: Add a "parsed chunk list" data structure")
Reviewed-by: Jeff Layton <jlayton@kernel.org>
Signed-off-by: Chuck Lever <chuck.lever@oracle.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=c1f8195bf68edd2cef0f18a4cead394075a54b5a)

| -rw-r--r-- | [net/sunrpc/xprtrdma/svc\_rdma\_recvfrom.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/sunrpc/xprtrdma/svc_rdma_recvfrom.c?id=c1f8195bf68edd2cef0f18a4cead394075a54b5a) | 8 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 7 insertions, 1 deletions

| diff --git a/net/sunrpc/xprtrdma/svc\_rdma\_recvfrom.c b/net/sunrpc/xprtrdma/svc\_rdma\_recvfrom.cindex b2dd01e5274e99..186c9c12432b1b 100644--- a/[net/sunrpc/xprtrdma/svc\_rdma\_recvfrom.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/sunrpc/xprtrdma/svc_rdma_recvfrom.c?id=bab3e342768e64d2472b6d53537e6d6f1a189690)+++ b/[net/sunrpc/xprtrdma/svc\_rdma\_recvfrom.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/sunrpc/xprtrdma/svc_rdma_recvfrom.c?id=c1f8195bf68edd2cef0f18a4cead394075a54b5a)@@ -482,7 +482,13 @@ static bool xdr\_check\_write\_chunk(struct svc\_rdma\_recv\_ctxt \*rctxt) if (xdr\_stream\_decode\_u32(&rctxt->rc\_stream, &segcount)) return false; - /\* A bogus segcount causes this buffer overflow check to fail. \*/+ /\* Before trusting the segcount value enough to use it in+ \* a computation, perform a simple range check. This is an+ \* arbitrary but sensible limit (ie, not architectural).+ \*/+ if (unlikely(segcount > RPCSVC\_MAXPAGES))+ return false;+ p = xdr\_inline\_decode(&rctxt->rc\_stream, segcount \* rpcrdma\_segment\_maxsz \* sizeof(\*p)); return p != NULL; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 20:43:28 +0000



=== Content from git.kernel.org_94134925_20250114_204450.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=838dd342962cef4c320632a5af48d3c31f2f9877)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=838dd342962cef4c320632a5af48d3c31f2f9877)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=838dd342962cef4c320632a5af48d3c31f2f9877)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=838dd342962cef4c320632a5af48d3c31f2f9877)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Chuck Lever <chuck.lever@oracle.com> | 2024-09-17 12:15:29 -0400 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-09 10:32:28 +0100 |
| commit | [838dd342962cef4c320632a5af48d3c31f2f9877](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=838dd342962cef4c320632a5af48d3c31f2f9877) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=838dd342962cef4c320632a5af48d3c31f2f9877)) | |
| tree | [85d8d51e9da614f26f323d5b61ab2f61e4ab64fc](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=838dd342962cef4c320632a5af48d3c31f2f9877) | |
| parent | [022c3fc12850acdefaf5c4cf5badd8eff88c76c7](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=022c3fc12850acdefaf5c4cf5badd8eff88c76c7) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=838dd342962cef4c320632a5af48d3c31f2f9877&id2=022c3fc12850acdefaf5c4cf5badd8eff88c76c7)) | |
| download | [linux-838dd342962cef4c320632a5af48d3c31f2f9877.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-838dd342962cef4c320632a5af48d3c31f2f9877.tar.gz) | |

svcrdma: Address an integer overflow[ Upstream commit 3c63d8946e578663b868cb9912dac616ea68bfd0 ]
Dan Carpenter reports:
> Commit 78147ca8b4a9 ("svcrdma: Add a "parsed chunk list" data
> structure") from Jun 22, 2020 (linux-next), leads to the following
> Smatch static checker warning:
>
> net/sunrpc/xprtrdma/svc\_rdma\_recvfrom.c:498 xdr\_check\_write\_chunk()
> warn: potential user controlled sizeof overflow 'segcount \* 4 \* 4'
>
> net/sunrpc/xprtrdma/svc\_rdma\_recvfrom.c
> 488 static bool xdr\_check\_write\_chunk(struct svc\_rdma\_recv\_ctxt \*rctxt)
> 489 {
> 490 u32 segcount;
> 491 \_\_be32 \*p;
> 492
> 493 if (xdr\_stream\_decode\_u32(&rctxt->rc\_stream, &segcount))
> ^^^^^^^^
>
> 494 return false;
> 495
> 496 /\* A bogus segcount causes this buffer overflow check to fail. \*/
> 497 p = xdr\_inline\_decode(&rctxt->rc\_stream,
> --> 498 segcount \* rpcrdma\_segment\_maxsz \* sizeof(\*p));
>
>
> segcount is an untrusted u32. On 32bit systems anything >= SIZE\_MAX / 16 will
> have an integer overflow and some those values will be accepted by
> xdr\_inline\_decode().
Reported-by: Dan Carpenter <dan.carpenter@linaro.org>
Fixes: 78147ca8b4a9 ("svcrdma: Add a "parsed chunk list" data structure")
Reviewed-by: Jeff Layton <jlayton@kernel.org>
Signed-off-by: Chuck Lever <chuck.lever@oracle.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=838dd342962cef4c320632a5af48d3c31f2f9877)

| -rw-r--r-- | [net/sunrpc/xprtrdma/svc\_rdma\_recvfrom.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/sunrpc/xprtrdma/svc_rdma_recvfrom.c?id=838dd342962cef4c320632a5af48d3c31f2f9877) | 8 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 7 insertions, 1 deletions

| diff --git a/net/sunrpc/xprtrdma/svc\_rdma\_recvfrom.c b/net/sunrpc/xprtrdma/svc\_rdma\_recvfrom.cindex 3b05f90a3e50dd..9cec7bcb8a9768 100644--- a/[net/sunrpc/xprtrdma/svc\_rdma\_recvfrom.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/sunrpc/xprtrdma/svc_rdma_recvfrom.c?id=022c3fc12850acdefaf5c4cf5badd8eff88c76c7)+++ b/[net/sunrpc/xprtrdma/svc\_rdma\_recvfrom.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/sunrpc/xprtrdma/svc_rdma_recvfrom.c?id=838dd342962cef4c320632a5af48d3c31f2f9877)@@ -478,7 +478,13 @@ static bool xdr\_check\_write\_chunk(struct svc\_rdma\_recv\_ctxt \*rctxt) if (xdr\_stream\_decode\_u32(&rctxt->rc\_stream, &segcount)) return false; - /\* A bogus segcount causes this buffer overflow check to fail. \*/+ /\* Before trusting the segcount value enough to use it in+ \* a computation, perform a simple range check. This is an+ \* arbitrary but sensible limit (ie, not architectural).+ \*/+ if (unlikely(segcount > RPCSVC\_MAXPAGES))+ return false;+ p = xdr\_inline\_decode(&rctxt->rc\_stream, segcount \* rpcrdma\_segment\_maxsz \* sizeof(\*p)); return p != NULL; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 20:43:27 +0000



=== Content from git.kernel.org_4e0dd9d9_20250114_204452.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=e5c440c227ecdc721f2da0dd88b6358afd1031a7)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=e5c440c227ecdc721f2da0dd88b6358afd1031a7)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=e5c440c227ecdc721f2da0dd88b6358afd1031a7)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e5c440c227ecdc721f2da0dd88b6358afd1031a7)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Chuck Lever <chuck.lever@oracle.com> | 2024-09-17 12:15:29 -0400 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-05 14:02:24 +0100 |
| commit | [e5c440c227ecdc721f2da0dd88b6358afd1031a7](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=e5c440c227ecdc721f2da0dd88b6358afd1031a7) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=e5c440c227ecdc721f2da0dd88b6358afd1031a7)) | |
| tree | [7450aa0f7131ea1f802f994ba9d421b706a57034](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=e5c440c227ecdc721f2da0dd88b6358afd1031a7) | |
| parent | [fe1b4c7164695eb7e75b5504a6270496a150c4a0](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=fe1b4c7164695eb7e75b5504a6270496a150c4a0) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e5c440c227ecdc721f2da0dd88b6358afd1031a7&id2=fe1b4c7164695eb7e75b5504a6270496a150c4a0)) | |
| download | [linux-e5c440c227ecdc721f2da0dd88b6358afd1031a7.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-e5c440c227ecdc721f2da0dd88b6358afd1031a7.tar.gz) | |

svcrdma: Address an integer overflow[ Upstream commit 3c63d8946e578663b868cb9912dac616ea68bfd0 ]
Dan Carpenter reports:
> Commit 78147ca8b4a9 ("svcrdma: Add a "parsed chunk list" data
> structure") from Jun 22, 2020 (linux-next), leads to the following
> Smatch static checker warning:
>
> net/sunrpc/xprtrdma/svc\_rdma\_recvfrom.c:498 xdr\_check\_write\_chunk()
> warn: potential user controlled sizeof overflow 'segcount \* 4 \* 4'
>
> net/sunrpc/xprtrdma/svc\_rdma\_recvfrom.c
> 488 static bool xdr\_check\_write\_chunk(struct svc\_rdma\_recv\_ctxt \*rctxt)
> 489 {
> 490 u32 segcount;
> 491 \_\_be32 \*p;
> 492
> 493 if (xdr\_stream\_decode\_u32(&rctxt->rc\_stream, &segcount))
> ^^^^^^^^
>
> 494 return false;
> 495
> 496 /\* A bogus segcount causes this buffer overflow check to fail. \*/
> 497 p = xdr\_inline\_decode(&rctxt->rc\_stream,
> --> 498 segcount \* rpcrdma\_segment\_maxsz \* sizeof(\*p));
>
>
> segcount is an untrusted u32. On 32bit systems anything >= SIZE\_MAX / 16 will
> have an integer overflow and some those values will be accepted by
> xdr\_inline\_decode().
Reported-by: Dan Carpenter <dan.carpenter@linaro.org>
Fixes: 78147ca8b4a9 ("svcrdma: Add a "parsed chunk list" data structure")
Reviewed-by: Jeff Layton <jlayton@kernel.org>
Signed-off-by: Chuck Lever <chuck.lever@oracle.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e5c440c227ecdc721f2da0dd88b6358afd1031a7)

| -rw-r--r-- | [net/sunrpc/xprtrdma/svc\_rdma\_recvfrom.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/sunrpc/xprtrdma/svc_rdma_recvfrom.c?id=e5c440c227ecdc721f2da0dd88b6358afd1031a7) | 8 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 7 insertions, 1 deletions

| diff --git a/net/sunrpc/xprtrdma/svc\_rdma\_recvfrom.c b/net/sunrpc/xprtrdma/svc\_rdma\_recvfrom.cindex ae3fb9bc8a2168..292022f0976e17 100644--- a/[net/sunrpc/xprtrdma/svc\_rdma\_recvfrom.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/sunrpc/xprtrdma/svc_rdma_recvfrom.c?id=fe1b4c7164695eb7e75b5504a6270496a150c4a0)+++ b/[net/sunrpc/xprtrdma/svc\_rdma\_recvfrom.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/sunrpc/xprtrdma/svc_rdma_recvfrom.c?id=e5c440c227ecdc721f2da0dd88b6358afd1031a7)@@ -493,7 +493,13 @@ static bool xdr\_check\_write\_chunk(struct svc\_rdma\_recv\_ctxt \*rctxt) if (xdr\_stream\_decode\_u32(&rctxt->rc\_stream, &segcount)) return false; - /\* A bogus segcount causes this buffer overflow check to fail. \*/+ /\* Before trusting the segcount value enough to use it in+ \* a computation, perform a simple range check. This is an+ \* arbitrary but sensible limit (ie, not architectural).+ \*/+ if (unlikely(segcount > RPCSVC\_MAXPAGES))+ return false;+ p = xdr\_inline\_decode(&rctxt->rc\_stream, segcount \* rpcrdma\_segment\_maxsz \* sizeof(\*p)); return p != NULL; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 20:43:29 +0000


