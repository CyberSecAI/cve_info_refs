=== Content from git.kernel.org_288169e1_20250115_085808.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=9c98ee7ea463a838235e7a0e35851b38476364f2)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=9c98ee7ea463a838235e7a0e35851b38476364f2)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=9c98ee7ea463a838235e7a0e35851b38476364f2)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=9c98ee7ea463a838235e7a0e35851b38476364f2)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Daniel Gabay <daniel.gabay@intel.com> | 2024-10-10 14:05:05 +0300 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-11-08 16:20:52 +0100 |
| commit | [9c98ee7ea463a838235e7a0e35851b38476364f2](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=9c98ee7ea463a838235e7a0e35851b38476364f2) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=9c98ee7ea463a838235e7a0e35851b38476364f2)) | |
| tree | [c8363ddf0c91237e7e22701289ee0fd8655b3f17](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=9c98ee7ea463a838235e7a0e35851b38476364f2) | |
| parent | [8b30a66a94ea1b1c0c052996567d1838f3dc8888](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=8b30a66a94ea1b1c0c052996567d1838f3dc8888) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=9c98ee7ea463a838235e7a0e35851b38476364f2&id2=8b30a66a94ea1b1c0c052996567d1838f3dc8888)) | |
| download | [linux-9c98ee7ea463a838235e7a0e35851b38476364f2.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-9c98ee7ea463a838235e7a0e35851b38476364f2.tar.gz) | |

wifi: iwlwifi: mvm: Fix response handling in iwl\_mvm\_send\_recovery\_cmd()[ Upstream commit 07a6e3b78a65f4b2796a8d0d4adb1a15a81edead ]
1. The size of the response packet is not validated.
2. The response buffer is not freed.
Resolve these issues by switching to iwl\_mvm\_send\_cmd\_status(),
which handles both size validation and frees the buffer.
Fixes: f130bb75d881 ("iwlwifi: add FW recovery flow")
Signed-off-by: Daniel Gabay <daniel.gabay@intel.com>
Signed-off-by: Miri Korenblit <miriam.rachel.korenblit@intel.com>
Link: [https://patch.msgid.link/20241010140328.76c73185951e.Id3b6ca82ced2081f5ee4f33c997491d0ebda83f7@changeid](https://patch.msgid.link/20241010140328.76c73185951e.Id3b6ca82ced2081f5ee4f33c997491d0ebda83f7%40changeid)
Signed-off-by: Johannes Berg <johannes.berg@intel.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=9c98ee7ea463a838235e7a0e35851b38476364f2)

| -rw-r--r-- | [drivers/net/wireless/intel/iwlwifi/mvm/fw.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/wireless/intel/iwlwifi/mvm/fw.c?id=9c98ee7ea463a838235e7a0e35851b38476364f2) | 10 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 4 insertions, 6 deletions

| diff --git a/drivers/net/wireless/intel/iwlwifi/mvm/fw.c b/drivers/net/wireless/intel/iwlwifi/mvm/fw.cindex 16bf070566e6c9..287f9c551525c1 100644--- a/[drivers/net/wireless/intel/iwlwifi/mvm/fw.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/wireless/intel/iwlwifi/mvm/fw.c?id=8b30a66a94ea1b1c0c052996567d1838f3dc8888)+++ b/[drivers/net/wireless/intel/iwlwifi/mvm/fw.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/wireless/intel/iwlwifi/mvm/fw.c?id=9c98ee7ea463a838235e7a0e35851b38476364f2)@@ -1192,8 +1192,8 @@ static void iwl\_mvm\_disconnect\_iterator(void \*data, u8 \*mac, void iwl\_mvm\_send\_recovery\_cmd(struct iwl\_mvm \*mvm, u32 flags) { u32 error\_log\_size = mvm->fw->ucode\_capa.error\_log\_size;+ u32 status = 0; int ret;- u32 resp;  struct iwl\_fw\_error\_recovery\_cmd recovery\_cmd = { .flags = cpu\_to\_le32(flags),@@ -1201,7 +1201,6 @@ void iwl\_mvm\_send\_recovery\_cmd(struct iwl\_mvm \*mvm, u32 flags) }; struct iwl\_host\_cmd host\_cmd = { .id = WIDE\_ID(SYSTEM\_GROUP, FW\_ERROR\_RECOVERY\_CMD),- .flags = CMD\_WANT\_SKB, .data = {&recovery\_cmd, }, .len = {sizeof(recovery\_cmd), }, };@@ -1221,7 +1220,7 @@ void iwl\_mvm\_send\_recovery\_cmd(struct iwl\_mvm \*mvm, u32 flags) recovery\_cmd.buf\_size = cpu\_to\_le32(error\_log\_size); } - ret = iwl\_mvm\_send\_cmd(mvm, &host\_cmd);+ ret = iwl\_mvm\_send\_cmd\_status(mvm, &host\_cmd, &status); kfree(mvm->error\_recovery\_buf); mvm->error\_recovery\_buf = NULL; @@ -1232,11 +1231,10 @@ void iwl\_mvm\_send\_recovery\_cmd(struct iwl\_mvm \*mvm, u32 flags)  /\* skb respond is only relevant in ERROR\_RECOVERY\_UPDATE\_DB \*/ if (flags & ERROR\_RECOVERY\_UPDATE\_DB) {- resp = le32\_to\_cpu(\*(\_\_le32 \*)host\_cmd.resp\_pkt->data);- if (resp) {+ if (status) { IWL\_ERR(mvm, "Failed to send recovery cmd blob was invalid %d\n",- resp);+ status);  ieee80211\_iterate\_interfaces(mvm->hw, 0, iwl\_mvm\_disconnect\_iterator, |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-15 08:56:44 +0000



=== Content from git.kernel.org_bed027af_20250115_085801.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=07a6e3b78a65f4b2796a8d0d4adb1a15a81edead)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=07a6e3b78a65f4b2796a8d0d4adb1a15a81edead)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=07a6e3b78a65f4b2796a8d0d4adb1a15a81edead)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=07a6e3b78a65f4b2796a8d0d4adb1a15a81edead)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Daniel Gabay <daniel.gabay@intel.com> | 2024-10-10 14:05:05 +0300 |
| --- | --- | --- |
| committer | Johannes Berg <johannes.berg@intel.com> | 2024-10-25 17:53:33 +0200 |
| commit | [07a6e3b78a65f4b2796a8d0d4adb1a15a81edead](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=07a6e3b78a65f4b2796a8d0d4adb1a15a81edead) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=07a6e3b78a65f4b2796a8d0d4adb1a15a81edead)) | |
| tree | [21d84710ade4961b4b44133e0bdfbb03726b1cc9](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=07a6e3b78a65f4b2796a8d0d4adb1a15a81edead) | |
| parent | [32d95ab330069f9c551b8e99770bb4e799730b55](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=32d95ab330069f9c551b8e99770bb4e799730b55) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=07a6e3b78a65f4b2796a8d0d4adb1a15a81edead&id2=32d95ab330069f9c551b8e99770bb4e799730b55)) | |
| download | [linux-07a6e3b78a65f4b2796a8d0d4adb1a15a81edead.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-07a6e3b78a65f4b2796a8d0d4adb1a15a81edead.tar.gz) | |

wifi: iwlwifi: mvm: Fix response handling in iwl\_mvm\_send\_recovery\_cmd()1. The size of the response packet is not validated.
2. The response buffer is not freed.
Resolve these issues by switching to iwl\_mvm\_send\_cmd\_status(),
which handles both size validation and frees the buffer.
Fixes: f130bb75d881 ("iwlwifi: add FW recovery flow")
Signed-off-by: Daniel Gabay <daniel.gabay@intel.com>
Signed-off-by: Miri Korenblit <miriam.rachel.korenblit@intel.com>
Link: [https://patch.msgid.link/20241010140328.76c73185951e.Id3b6ca82ced2081f5ee4f33c997491d0ebda83f7@changeid](https://patch.msgid.link/20241010140328.76c73185951e.Id3b6ca82ced2081f5ee4f33c997491d0ebda83f7%40changeid)
Signed-off-by: Johannes Berg <johannes.berg@intel.com>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=07a6e3b78a65f4b2796a8d0d4adb1a15a81edead)

| -rw-r--r-- | [drivers/net/wireless/intel/iwlwifi/mvm/fw.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/wireless/intel/iwlwifi/mvm/fw.c?id=07a6e3b78a65f4b2796a8d0d4adb1a15a81edead) | 10 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 4 insertions, 6 deletions

| diff --git a/drivers/net/wireless/intel/iwlwifi/mvm/fw.c b/drivers/net/wireless/intel/iwlwifi/mvm/fw.cindex 08546e673cf51e..f30b0fc8eca97d 100644--- a/[drivers/net/wireless/intel/iwlwifi/mvm/fw.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/wireless/intel/iwlwifi/mvm/fw.c?id=32d95ab330069f9c551b8e99770bb4e799730b55)+++ b/[drivers/net/wireless/intel/iwlwifi/mvm/fw.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/wireless/intel/iwlwifi/mvm/fw.c?id=07a6e3b78a65f4b2796a8d0d4adb1a15a81edead)@@ -1307,8 +1307,8 @@ static void iwl\_mvm\_disconnect\_iterator(void \*data, u8 \*mac, void iwl\_mvm\_send\_recovery\_cmd(struct iwl\_mvm \*mvm, u32 flags) { u32 error\_log\_size = mvm->fw->ucode\_capa.error\_log\_size;+ u32 status = 0; int ret;- u32 resp;  struct iwl\_fw\_error\_recovery\_cmd recovery\_cmd = { .flags = cpu\_to\_le32(flags),@@ -1316,7 +1316,6 @@ void iwl\_mvm\_send\_recovery\_cmd(struct iwl\_mvm \*mvm, u32 flags) }; struct iwl\_host\_cmd host\_cmd = { .id = WIDE\_ID(SYSTEM\_GROUP, FW\_ERROR\_RECOVERY\_CMD),- .flags = CMD\_WANT\_SKB, .data = {&recovery\_cmd, }, .len = {sizeof(recovery\_cmd), }, };@@ -1336,7 +1335,7 @@ void iwl\_mvm\_send\_recovery\_cmd(struct iwl\_mvm \*mvm, u32 flags) recovery\_cmd.buf\_size = cpu\_to\_le32(error\_log\_size); } - ret = iwl\_mvm\_send\_cmd(mvm, &host\_cmd);+ ret = iwl\_mvm\_send\_cmd\_status(mvm, &host\_cmd, &status); kfree(mvm->error\_recovery\_buf); mvm->error\_recovery\_buf = NULL; @@ -1347,11 +1346,10 @@ void iwl\_mvm\_send\_recovery\_cmd(struct iwl\_mvm \*mvm, u32 flags)  /\* skb respond is only relevant in ERROR\_RECOVERY\_UPDATE\_DB \*/ if (flags & ERROR\_RECOVERY\_UPDATE\_DB) {- resp = le32\_to\_cpu(\*(\_\_le32 \*)host\_cmd.resp\_pkt->data);- if (resp) {+ if (status) { IWL\_ERR(mvm, "Failed to send recovery cmd blob was invalid %d\n",- resp);+ status);  ieee80211\_iterate\_interfaces(mvm->hw, 0, iwl\_mvm\_disconnect\_iterator, |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-15 08:56:38 +0000



=== Content from git.kernel.org_0798a74b_20250115_085802.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=3f45d590ccbae6dfd6faef54efe74c30bd85d3da)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=3f45d590ccbae6dfd6faef54efe74c30bd85d3da)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=3f45d590ccbae6dfd6faef54efe74c30bd85d3da)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=3f45d590ccbae6dfd6faef54efe74c30bd85d3da)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Daniel Gabay <daniel.gabay@intel.com> | 2024-10-10 14:05:05 +0300 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-11-08 16:25:52 +0100 |
| commit | [3f45d590ccbae6dfd6faef54efe74c30bd85d3da](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=3f45d590ccbae6dfd6faef54efe74c30bd85d3da) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=3f45d590ccbae6dfd6faef54efe74c30bd85d3da)) | |
| tree | [692702365416383ec39ea467c02af6ecd61df9a3](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=3f45d590ccbae6dfd6faef54efe74c30bd85d3da) | |
| parent | [daa426f19aad7924690c26e76500ddad3f484d9f](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=daa426f19aad7924690c26e76500ddad3f484d9f) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=3f45d590ccbae6dfd6faef54efe74c30bd85d3da&id2=daa426f19aad7924690c26e76500ddad3f484d9f)) | |
| download | [linux-3f45d590ccbae6dfd6faef54efe74c30bd85d3da.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-3f45d590ccbae6dfd6faef54efe74c30bd85d3da.tar.gz) | |

wifi: iwlwifi: mvm: Fix response handling in iwl\_mvm\_send\_recovery\_cmd()[ Upstream commit 07a6e3b78a65f4b2796a8d0d4adb1a15a81edead ]
1. The size of the response packet is not validated.
2. The response buffer is not freed.
Resolve these issues by switching to iwl\_mvm\_send\_cmd\_status(),
which handles both size validation and frees the buffer.
Fixes: f130bb75d881 ("iwlwifi: add FW recovery flow")
Signed-off-by: Daniel Gabay <daniel.gabay@intel.com>
Signed-off-by: Miri Korenblit <miriam.rachel.korenblit@intel.com>
Link: [https://patch.msgid.link/20241010140328.76c73185951e.Id3b6ca82ced2081f5ee4f33c997491d0ebda83f7@changeid](https://patch.msgid.link/20241010140328.76c73185951e.Id3b6ca82ced2081f5ee4f33c997491d0ebda83f7%40changeid)
Signed-off-by: Johannes Berg <johannes.berg@intel.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=3f45d590ccbae6dfd6faef54efe74c30bd85d3da)

| -rw-r--r-- | [drivers/net/wireless/intel/iwlwifi/mvm/fw.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/wireless/intel/iwlwifi/mvm/fw.c?id=3f45d590ccbae6dfd6faef54efe74c30bd85d3da) | 10 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 4 insertions, 6 deletions

| diff --git a/drivers/net/wireless/intel/iwlwifi/mvm/fw.c b/drivers/net/wireless/intel/iwlwifi/mvm/fw.cindex 62f16966899eb2..3009fff9086f56 100644--- a/[drivers/net/wireless/intel/iwlwifi/mvm/fw.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/wireless/intel/iwlwifi/mvm/fw.c?id=daa426f19aad7924690c26e76500ddad3f484d9f)+++ b/[drivers/net/wireless/intel/iwlwifi/mvm/fw.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/wireless/intel/iwlwifi/mvm/fw.c?id=3f45d590ccbae6dfd6faef54efe74c30bd85d3da)@@ -1282,8 +1282,8 @@ static void iwl\_mvm\_disconnect\_iterator(void \*data, u8 \*mac, void iwl\_mvm\_send\_recovery\_cmd(struct iwl\_mvm \*mvm, u32 flags) { u32 error\_log\_size = mvm->fw->ucode\_capa.error\_log\_size;+ u32 status = 0; int ret;- u32 resp;  struct iwl\_fw\_error\_recovery\_cmd recovery\_cmd = { .flags = cpu\_to\_le32(flags),@@ -1291,7 +1291,6 @@ void iwl\_mvm\_send\_recovery\_cmd(struct iwl\_mvm \*mvm, u32 flags) }; struct iwl\_host\_cmd host\_cmd = { .id = WIDE\_ID(SYSTEM\_GROUP, FW\_ERROR\_RECOVERY\_CMD),- .flags = CMD\_WANT\_SKB, .data = {&recovery\_cmd, }, .len = {sizeof(recovery\_cmd), }, };@@ -1311,7 +1310,7 @@ void iwl\_mvm\_send\_recovery\_cmd(struct iwl\_mvm \*mvm, u32 flags) recovery\_cmd.buf\_size = cpu\_to\_le32(error\_log\_size); } - ret = iwl\_mvm\_send\_cmd(mvm, &host\_cmd);+ ret = iwl\_mvm\_send\_cmd\_status(mvm, &host\_cmd, &status); kfree(mvm->error\_recovery\_buf); mvm->error\_recovery\_buf = NULL; @@ -1322,11 +1321,10 @@ void iwl\_mvm\_send\_recovery\_cmd(struct iwl\_mvm \*mvm, u32 flags)  /\* skb respond is only relevant in ERROR\_RECOVERY\_UPDATE\_DB \*/ if (flags & ERROR\_RECOVERY\_UPDATE\_DB) {- resp = le32\_to\_cpu(\*(\_\_le32 \*)host\_cmd.resp\_pkt->data);- if (resp) {+ if (status) { IWL\_ERR(mvm, "Failed to send recovery cmd blob was invalid %d\n",- resp);+ status);  ieee80211\_iterate\_interfaces(mvm->hw, 0, iwl\_mvm\_disconnect\_iterator, |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-15 08:56:39 +0000



=== Content from git.kernel.org_67e3045c_20250115_085802.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=3eb986c64c6bfb721950f9666a3b723cf65d043f)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=3eb986c64c6bfb721950f9666a3b723cf65d043f)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=3eb986c64c6bfb721950f9666a3b723cf65d043f)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=3eb986c64c6bfb721950f9666a3b723cf65d043f)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Daniel Gabay <daniel.gabay@intel.com> | 2024-10-10 14:05:05 +0300 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-11-08 16:28:17 +0100 |
| commit | [3eb986c64c6bfb721950f9666a3b723cf65d043f](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=3eb986c64c6bfb721950f9666a3b723cf65d043f) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=3eb986c64c6bfb721950f9666a3b723cf65d043f)) | |
| tree | [48c60a7ddd5d5275083a6c74e6d7cccd629bf094](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=3eb986c64c6bfb721950f9666a3b723cf65d043f) | |
| parent | [3b01b9985a543a597a8abe2948e9ebb23cc5a23b](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=3b01b9985a543a597a8abe2948e9ebb23cc5a23b) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=3eb986c64c6bfb721950f9666a3b723cf65d043f&id2=3b01b9985a543a597a8abe2948e9ebb23cc5a23b)) | |
| download | [linux-3eb986c64c6bfb721950f9666a3b723cf65d043f.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-3eb986c64c6bfb721950f9666a3b723cf65d043f.tar.gz) | |

wifi: iwlwifi: mvm: Fix response handling in iwl\_mvm\_send\_recovery\_cmd()[ Upstream commit 07a6e3b78a65f4b2796a8d0d4adb1a15a81edead ]
1. The size of the response packet is not validated.
2. The response buffer is not freed.
Resolve these issues by switching to iwl\_mvm\_send\_cmd\_status(),
which handles both size validation and frees the buffer.
Fixes: f130bb75d881 ("iwlwifi: add FW recovery flow")
Signed-off-by: Daniel Gabay <daniel.gabay@intel.com>
Signed-off-by: Miri Korenblit <miriam.rachel.korenblit@intel.com>
Link: [https://patch.msgid.link/20241010140328.76c73185951e.Id3b6ca82ced2081f5ee4f33c997491d0ebda83f7@changeid](https://patch.msgid.link/20241010140328.76c73185951e.Id3b6ca82ced2081f5ee4f33c997491d0ebda83f7%40changeid)
Signed-off-by: Johannes Berg <johannes.berg@intel.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=3eb986c64c6bfb721950f9666a3b723cf65d043f)

| -rw-r--r-- | [drivers/net/wireless/intel/iwlwifi/mvm/fw.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/wireless/intel/iwlwifi/mvm/fw.c?id=3eb986c64c6bfb721950f9666a3b723cf65d043f) | 10 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 4 insertions, 6 deletions

| diff --git a/drivers/net/wireless/intel/iwlwifi/mvm/fw.c b/drivers/net/wireless/intel/iwlwifi/mvm/fw.cindex 4bc395a5731b2e..80b5c20d3a4804 100644--- a/[drivers/net/wireless/intel/iwlwifi/mvm/fw.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/wireless/intel/iwlwifi/mvm/fw.c?id=3b01b9985a543a597a8abe2948e9ebb23cc5a23b)+++ b/[drivers/net/wireless/intel/iwlwifi/mvm/fw.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/wireless/intel/iwlwifi/mvm/fw.c?id=3eb986c64c6bfb721950f9666a3b723cf65d043f)@@ -1404,8 +1404,8 @@ static void iwl\_mvm\_disconnect\_iterator(void \*data, u8 \*mac, void iwl\_mvm\_send\_recovery\_cmd(struct iwl\_mvm \*mvm, u32 flags) { u32 error\_log\_size = mvm->fw->ucode\_capa.error\_log\_size;+ u32 status = 0; int ret;- u32 resp;  struct iwl\_fw\_error\_recovery\_cmd recovery\_cmd = { .flags = cpu\_to\_le32(flags),@@ -1413,7 +1413,6 @@ void iwl\_mvm\_send\_recovery\_cmd(struct iwl\_mvm \*mvm, u32 flags) }; struct iwl\_host\_cmd host\_cmd = { .id = WIDE\_ID(SYSTEM\_GROUP, FW\_ERROR\_RECOVERY\_CMD),- .flags = CMD\_WANT\_SKB, .data = {&recovery\_cmd, }, .len = {sizeof(recovery\_cmd), }, };@@ -1433,7 +1432,7 @@ void iwl\_mvm\_send\_recovery\_cmd(struct iwl\_mvm \*mvm, u32 flags) recovery\_cmd.buf\_size = cpu\_to\_le32(error\_log\_size); } - ret = iwl\_mvm\_send\_cmd(mvm, &host\_cmd);+ ret = iwl\_mvm\_send\_cmd\_status(mvm, &host\_cmd, &status); kfree(mvm->error\_recovery\_buf); mvm->error\_recovery\_buf = NULL; @@ -1444,11 +1443,10 @@ void iwl\_mvm\_send\_recovery\_cmd(struct iwl\_mvm \*mvm, u32 flags)  /\* skb respond is only relevant in ERROR\_RECOVERY\_UPDATE\_DB \*/ if (flags & ERROR\_RECOVERY\_UPDATE\_DB) {- resp = le32\_to\_cpu(\*(\_\_le32 \*)host\_cmd.resp\_pkt->data);- if (resp) {+ if (status) { IWL\_ERR(mvm, "Failed to send recovery cmd blob was invalid %d\n",- resp);+ status);  ieee80211\_iterate\_interfaces(mvm->hw, 0, iwl\_mvm\_disconnect\_iterator, |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-15 08:56:39 +0000



=== Content from git.kernel.org_c4ddb6eb_20250115_085803.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=45a628911d3c68e024eed337054a0452b064f450)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=45a628911d3c68e024eed337054a0452b064f450)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=45a628911d3c68e024eed337054a0452b064f450)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=45a628911d3c68e024eed337054a0452b064f450)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Daniel Gabay <daniel.gabay@intel.com> | 2024-10-10 14:05:05 +0300 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-11-08 16:22:01 +0100 |
| commit | [45a628911d3c68e024eed337054a0452b064f450](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=45a628911d3c68e024eed337054a0452b064f450) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=45a628911d3c68e024eed337054a0452b064f450)) | |
| tree | [95faf27d107f538303877f958f368779bbff13e1](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=45a628911d3c68e024eed337054a0452b064f450) | |
| parent | [66e35e42f51e897dde6186229ace3a8079446a4d](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=66e35e42f51e897dde6186229ace3a8079446a4d) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=45a628911d3c68e024eed337054a0452b064f450&id2=66e35e42f51e897dde6186229ace3a8079446a4d)) | |
| download | [linux-45a628911d3c68e024eed337054a0452b064f450.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-45a628911d3c68e024eed337054a0452b064f450.tar.gz) | |

wifi: iwlwifi: mvm: Fix response handling in iwl\_mvm\_send\_recovery\_cmd()[ Upstream commit 07a6e3b78a65f4b2796a8d0d4adb1a15a81edead ]
1. The size of the response packet is not validated.
2. The response buffer is not freed.
Resolve these issues by switching to iwl\_mvm\_send\_cmd\_status(),
which handles both size validation and frees the buffer.
Fixes: f130bb75d881 ("iwlwifi: add FW recovery flow")
Signed-off-by: Daniel Gabay <daniel.gabay@intel.com>
Signed-off-by: Miri Korenblit <miriam.rachel.korenblit@intel.com>
Link: [https://patch.msgid.link/20241010140328.76c73185951e.Id3b6ca82ced2081f5ee4f33c997491d0ebda83f7@changeid](https://patch.msgid.link/20241010140328.76c73185951e.Id3b6ca82ced2081f5ee4f33c997491d0ebda83f7%40changeid)
Signed-off-by: Johannes Berg <johannes.berg@intel.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=45a628911d3c68e024eed337054a0452b064f450)

| -rw-r--r-- | [drivers/net/wireless/intel/iwlwifi/mvm/fw.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/wireless/intel/iwlwifi/mvm/fw.c?id=45a628911d3c68e024eed337054a0452b064f450) | 10 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 4 insertions, 6 deletions

| diff --git a/drivers/net/wireless/intel/iwlwifi/mvm/fw.c b/drivers/net/wireless/intel/iwlwifi/mvm/fw.cindex 594c88a9ac4966..553117e8fdd90b 100644--- a/[drivers/net/wireless/intel/iwlwifi/mvm/fw.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/wireless/intel/iwlwifi/mvm/fw.c?id=66e35e42f51e897dde6186229ace3a8079446a4d)+++ b/[drivers/net/wireless/intel/iwlwifi/mvm/fw.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/wireless/intel/iwlwifi/mvm/fw.c?id=45a628911d3c68e024eed337054a0452b064f450)@@ -1261,8 +1261,8 @@ static void iwl\_mvm\_disconnect\_iterator(void \*data, u8 \*mac, void iwl\_mvm\_send\_recovery\_cmd(struct iwl\_mvm \*mvm, u32 flags) { u32 error\_log\_size = mvm->fw->ucode\_capa.error\_log\_size;+ u32 status = 0; int ret;- u32 resp;  struct iwl\_fw\_error\_recovery\_cmd recovery\_cmd = { .flags = cpu\_to\_le32(flags),@@ -1270,7 +1270,6 @@ void iwl\_mvm\_send\_recovery\_cmd(struct iwl\_mvm \*mvm, u32 flags) }; struct iwl\_host\_cmd host\_cmd = { .id = WIDE\_ID(SYSTEM\_GROUP, FW\_ERROR\_RECOVERY\_CMD),- .flags = CMD\_WANT\_SKB, .data = {&recovery\_cmd, }, .len = {sizeof(recovery\_cmd), }, };@@ -1290,7 +1289,7 @@ void iwl\_mvm\_send\_recovery\_cmd(struct iwl\_mvm \*mvm, u32 flags) recovery\_cmd.buf\_size = cpu\_to\_le32(error\_log\_size); } - ret = iwl\_mvm\_send\_cmd(mvm, &host\_cmd);+ ret = iwl\_mvm\_send\_cmd\_status(mvm, &host\_cmd, &status); kfree(mvm->error\_recovery\_buf); mvm->error\_recovery\_buf = NULL; @@ -1301,11 +1300,10 @@ void iwl\_mvm\_send\_recovery\_cmd(struct iwl\_mvm \*mvm, u32 flags)  /\* skb respond is only relevant in ERROR\_RECOVERY\_UPDATE\_DB \*/ if (flags & ERROR\_RECOVERY\_UPDATE\_DB) {- resp = le32\_to\_cpu(\*(\_\_le32 \*)host\_cmd.resp\_pkt->data);- if (resp) {+ if (status) { IWL\_ERR(mvm, "Failed to send recovery cmd blob was invalid %d\n",- resp);+ status);  ieee80211\_iterate\_interfaces(mvm->hw, 0, iwl\_mvm\_disconnect\_iterator, |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-15 08:56:40 +0000



=== Content from git.kernel.org_efe1a81e_20250115_085807.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=9480c3045f302f43f9910d2d556d6cf5a62c1822)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=9480c3045f302f43f9910d2d556d6cf5a62c1822)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=9480c3045f302f43f9910d2d556d6cf5a62c1822)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=9480c3045f302f43f9910d2d556d6cf5a62c1822)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Daniel Gabay <daniel.gabay@intel.com> | 2024-10-10 14:05:05 +0300 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-11-08 16:30:46 +0100 |
| commit | [9480c3045f302f43f9910d2d556d6cf5a62c1822](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=9480c3045f302f43f9910d2d556d6cf5a62c1822) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=9480c3045f302f43f9910d2d556d6cf5a62c1822)) | |
| tree | [fe477f2a3677eb08ee0708f266c3663cf684dc15](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=9480c3045f302f43f9910d2d556d6cf5a62c1822) | |
| parent | [d903059f1ad5fcdd45ba4c53e254c97477c03195](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=d903059f1ad5fcdd45ba4c53e254c97477c03195) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=9480c3045f302f43f9910d2d556d6cf5a62c1822&id2=d903059f1ad5fcdd45ba4c53e254c97477c03195)) | |
| download | [linux-9480c3045f302f43f9910d2d556d6cf5a62c1822.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-9480c3045f302f43f9910d2d556d6cf5a62c1822.tar.gz) | |

wifi: iwlwifi: mvm: Fix response handling in iwl\_mvm\_send\_recovery\_cmd()[ Upstream commit 07a6e3b78a65f4b2796a8d0d4adb1a15a81edead ]
1. The size of the response packet is not validated.
2. The response buffer is not freed.
Resolve these issues by switching to iwl\_mvm\_send\_cmd\_status(),
which handles both size validation and frees the buffer.
Fixes: f130bb75d881 ("iwlwifi: add FW recovery flow")
Signed-off-by: Daniel Gabay <daniel.gabay@intel.com>
Signed-off-by: Miri Korenblit <miriam.rachel.korenblit@intel.com>
Link: [https://patch.msgid.link/20241010140328.76c73185951e.Id3b6ca82ced2081f5ee4f33c997491d0ebda83f7@changeid](https://patch.msgid.link/20241010140328.76c73185951e.Id3b6ca82ced2081f5ee4f33c997491d0ebda83f7%40changeid)
Signed-off-by: Johannes Berg <johannes.berg@intel.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=9480c3045f302f43f9910d2d556d6cf5a62c1822)

| -rw-r--r-- | [drivers/net/wireless/intel/iwlwifi/mvm/fw.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/wireless/intel/iwlwifi/mvm/fw.c?id=9480c3045f302f43f9910d2d556d6cf5a62c1822) | 10 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 4 insertions, 6 deletions

| diff --git a/drivers/net/wireless/intel/iwlwifi/mvm/fw.c b/drivers/net/wireless/intel/iwlwifi/mvm/fw.cindex 08c4898c8f1a33..49d5278d078a58 100644--- a/[drivers/net/wireless/intel/iwlwifi/mvm/fw.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/wireless/intel/iwlwifi/mvm/fw.c?id=d903059f1ad5fcdd45ba4c53e254c97477c03195)+++ b/[drivers/net/wireless/intel/iwlwifi/mvm/fw.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/wireless/intel/iwlwifi/mvm/fw.c?id=9480c3045f302f43f9910d2d556d6cf5a62c1822)@@ -1288,8 +1288,8 @@ static void iwl\_mvm\_disconnect\_iterator(void \*data, u8 \*mac, void iwl\_mvm\_send\_recovery\_cmd(struct iwl\_mvm \*mvm, u32 flags) { u32 error\_log\_size = mvm->fw->ucode\_capa.error\_log\_size;+ u32 status = 0; int ret;- u32 resp;  struct iwl\_fw\_error\_recovery\_cmd recovery\_cmd = { .flags = cpu\_to\_le32(flags),@@ -1297,7 +1297,6 @@ void iwl\_mvm\_send\_recovery\_cmd(struct iwl\_mvm \*mvm, u32 flags) }; struct iwl\_host\_cmd host\_cmd = { .id = WIDE\_ID(SYSTEM\_GROUP, FW\_ERROR\_RECOVERY\_CMD),- .flags = CMD\_WANT\_SKB, .data = {&recovery\_cmd, }, .len = {sizeof(recovery\_cmd), }, };@@ -1317,7 +1316,7 @@ void iwl\_mvm\_send\_recovery\_cmd(struct iwl\_mvm \*mvm, u32 flags) recovery\_cmd.buf\_size = cpu\_to\_le32(error\_log\_size); } - ret = iwl\_mvm\_send\_cmd(mvm, &host\_cmd);+ ret = iwl\_mvm\_send\_cmd\_status(mvm, &host\_cmd, &status); kfree(mvm->error\_recovery\_buf); mvm->error\_recovery\_buf = NULL; @@ -1328,11 +1327,10 @@ void iwl\_mvm\_send\_recovery\_cmd(struct iwl\_mvm \*mvm, u32 flags)  /\* skb respond is only relevant in ERROR\_RECOVERY\_UPDATE\_DB \*/ if (flags & ERROR\_RECOVERY\_UPDATE\_DB) {- resp = le32\_to\_cpu(\*(\_\_le32 \*)host\_cmd.resp\_pkt->data);- if (resp) {+ if (status) { IWL\_ERR(mvm, "Failed to send recovery cmd blob was invalid %d\n",- resp);+ status);  ieee80211\_iterate\_interfaces(mvm->hw, 0, iwl\_mvm\_disconnect\_iterator, |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-15 08:56:43 +0000



=== Content from git.kernel.org_44d6fdd2_20250115_085805.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=64d63557ded6ff3ce72b18ab87a6c4b1b652161c)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=64d63557ded6ff3ce72b18ab87a6c4b1b652161c)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=64d63557ded6ff3ce72b18ab87a6c4b1b652161c)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=64d63557ded6ff3ce72b18ab87a6c4b1b652161c)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Daniel Gabay <daniel.gabay@intel.com> | 2024-10-10 14:05:05 +0300 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-11-08 16:26:41 +0100 |
| commit | [64d63557ded6ff3ce72b18ab87a6c4b1b652161c](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=64d63557ded6ff3ce72b18ab87a6c4b1b652161c) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=64d63557ded6ff3ce72b18ab87a6c4b1b652161c)) | |
| tree | [e8b03cd01c107ed0c189ec353ce64b456c7b82c3](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=64d63557ded6ff3ce72b18ab87a6c4b1b652161c) | |
| parent | [a9faac8818e302c8e0ba20367035ff97215fd6c3](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=a9faac8818e302c8e0ba20367035ff97215fd6c3) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=64d63557ded6ff3ce72b18ab87a6c4b1b652161c&id2=a9faac8818e302c8e0ba20367035ff97215fd6c3)) | |
| download | [linux-64d63557ded6ff3ce72b18ab87a6c4b1b652161c.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-64d63557ded6ff3ce72b18ab87a6c4b1b652161c.tar.gz) | |

wifi: iwlwifi: mvm: Fix response handling in iwl\_mvm\_send\_recovery\_cmd()[ Upstream commit 07a6e3b78a65f4b2796a8d0d4adb1a15a81edead ]
1. The size of the response packet is not validated.
2. The response buffer is not freed.
Resolve these issues by switching to iwl\_mvm\_send\_cmd\_status(),
which handles both size validation and frees the buffer.
Fixes: f130bb75d881 ("iwlwifi: add FW recovery flow")
Signed-off-by: Daniel Gabay <daniel.gabay@intel.com>
Signed-off-by: Miri Korenblit <miriam.rachel.korenblit@intel.com>
Link: [https://patch.msgid.link/20241010140328.76c73185951e.Id3b6ca82ced2081f5ee4f33c997491d0ebda83f7@changeid](https://patch.msgid.link/20241010140328.76c73185951e.Id3b6ca82ced2081f5ee4f33c997491d0ebda83f7%40changeid)
Signed-off-by: Johannes Berg <johannes.berg@intel.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=64d63557ded6ff3ce72b18ab87a6c4b1b652161c)

| -rw-r--r-- | [drivers/net/wireless/intel/iwlwifi/mvm/fw.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/wireless/intel/iwlwifi/mvm/fw.c?id=64d63557ded6ff3ce72b18ab87a6c4b1b652161c) | 10 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 4 insertions, 6 deletions

| diff --git a/drivers/net/wireless/intel/iwlwifi/mvm/fw.c b/drivers/net/wireless/intel/iwlwifi/mvm/fw.cindex bf305f1e3ea1df..4706df3ae81bb5 100644--- a/[drivers/net/wireless/intel/iwlwifi/mvm/fw.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/wireless/intel/iwlwifi/mvm/fw.c?id=a9faac8818e302c8e0ba20367035ff97215fd6c3)+++ b/[drivers/net/wireless/intel/iwlwifi/mvm/fw.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/wireless/intel/iwlwifi/mvm/fw.c?id=64d63557ded6ff3ce72b18ab87a6c4b1b652161c)@@ -1358,8 +1358,8 @@ static void iwl\_mvm\_disconnect\_iterator(void \*data, u8 \*mac, void iwl\_mvm\_send\_recovery\_cmd(struct iwl\_mvm \*mvm, u32 flags) { u32 error\_log\_size = mvm->fw->ucode\_capa.error\_log\_size;+ u32 status = 0; int ret;- u32 resp;  struct iwl\_fw\_error\_recovery\_cmd recovery\_cmd = { .flags = cpu\_to\_le32(flags),@@ -1367,7 +1367,6 @@ void iwl\_mvm\_send\_recovery\_cmd(struct iwl\_mvm \*mvm, u32 flags) }; struct iwl\_host\_cmd host\_cmd = { .id = WIDE\_ID(SYSTEM\_GROUP, FW\_ERROR\_RECOVERY\_CMD),- .flags = CMD\_WANT\_SKB, .data = {&recovery\_cmd, }, .len = {sizeof(recovery\_cmd), }, };@@ -1387,7 +1386,7 @@ void iwl\_mvm\_send\_recovery\_cmd(struct iwl\_mvm \*mvm, u32 flags) recovery\_cmd.buf\_size = cpu\_to\_le32(error\_log\_size); } - ret = iwl\_mvm\_send\_cmd(mvm, &host\_cmd);+ ret = iwl\_mvm\_send\_cmd\_status(mvm, &host\_cmd, &status); kfree(mvm->error\_recovery\_buf); mvm->error\_recovery\_buf = NULL; @@ -1398,11 +1397,10 @@ void iwl\_mvm\_send\_recovery\_cmd(struct iwl\_mvm \*mvm, u32 flags)  /\* skb respond is only relevant in ERROR\_RECOVERY\_UPDATE\_DB \*/ if (flags & ERROR\_RECOVERY\_UPDATE\_DB) {- resp = le32\_to\_cpu(\*(\_\_le32 \*)host\_cmd.resp\_pkt->data);- if (resp) {+ if (status) { IWL\_ERR(mvm, "Failed to send recovery cmd blob was invalid %d\n",- resp);+ status);  ieee80211\_iterate\_interfaces(mvm->hw, 0, iwl\_mvm\_disconnect\_iterator, |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-15 08:56:42 +0000


