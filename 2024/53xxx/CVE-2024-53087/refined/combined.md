=== Content from git.kernel.org_f4427c0a_20250114_214448.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=af797b831d8975cb4610f396dcb7f03f4b9908e7)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=af797b831d8975cb4610f396dcb7f03f4b9908e7)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=af797b831d8975cb4610f396dcb7f03f4b9908e7)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=af797b831d8975cb4610f396dcb7f03f4b9908e7)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Matthew Brost <matthew.brost@intel.com> | 2024-11-04 20:35:23 -0800 |
| --- | --- | --- |
| committer | Lucas De Marchi <lucas.demarchi@intel.com> | 2024-11-05 15:40:12 -0800 |
| commit | [af797b831d8975cb4610f396dcb7f03f4b9908e7](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=af797b831d8975cb4610f396dcb7f03f4b9908e7) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=af797b831d8975cb4610f396dcb7f03f4b9908e7)) | |
| tree | [89e4c8d846ce403b3b6afe806a695c2f06e8b5c8](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=af797b831d8975cb4610f396dcb7f03f4b9908e7) | |
| parent | [1491efb39acee3848b61fcb3e5cc4be8de304352](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=1491efb39acee3848b61fcb3e5cc4be8de304352) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=af797b831d8975cb4610f396dcb7f03f4b9908e7&id2=1491efb39acee3848b61fcb3e5cc4be8de304352)) | |
| download | [linux-af797b831d8975cb4610f396dcb7f03f4b9908e7.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-af797b831d8975cb4610f396dcb7f03f4b9908e7.tar.gz) | |

drm/xe: Fix possible exec queue leak in exec IOCTLIn a couple of places after an exec queue is looked up the exec IOCTL
returns on input errors without dropping the exec queue ref. Fix this
ensuring the exec queue ref is dropped on input error.
Fixes: dd08ebf6c352 ("drm/xe: Introduce a new DRM driver for Intel GPUs")
Cc: <stable@vger.kernel.org>
Signed-off-by: Matthew Brost <matthew.brost@intel.com>
Reviewed-by: Tejas Upadhyay <tejas.upadhyay@intel.com>
Reviewed-by: Rodrigo Vivi <rodrigo.vivi@intel.com>
Link: [https://patchwork.freedesktop.org/patch/msgid/20241105043524.4062774-2-matthew.brost@intel.com](https://patchwork.freedesktop.org/patch/msgid/20241105043524.4062774-2-matthew.brost%40intel.com)
(cherry picked from commit 07064a200b40ac2195cb6b7b779897d9377e5e6f)
Signed-off-by: Lucas De Marchi <lucas.demarchi@intel.com>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=af797b831d8975cb4610f396dcb7f03f4b9908e7)

| -rw-r--r-- | [drivers/gpu/drm/xe/xe\_exec.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/gpu/drm/xe/xe_exec.c?id=af797b831d8975cb4610f396dcb7f03f4b9908e7) | 12 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 8 insertions, 4 deletions

| diff --git a/drivers/gpu/drm/xe/xe\_exec.c b/drivers/gpu/drm/xe/xe\_exec.cindex f23ac1e2ed88c4..6de12f91b865b8 100644--- a/[drivers/gpu/drm/xe/xe\_exec.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/xe/xe_exec.c?id=1491efb39acee3848b61fcb3e5cc4be8de304352)+++ b/[drivers/gpu/drm/xe/xe\_exec.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/xe/xe_exec.c?id=af797b831d8975cb4610f396dcb7f03f4b9908e7)@@ -132,12 +132,16 @@ int xe\_exec\_ioctl(struct drm\_device \*dev, void \*data, struct drm\_file \*file) if (XE\_IOCTL\_DBG(xe, !q)) return -ENOENT; - if (XE\_IOCTL\_DBG(xe, q->flags & EXEC\_QUEUE\_FLAG\_VM))- return -EINVAL;+ if (XE\_IOCTL\_DBG(xe, q->flags & EXEC\_QUEUE\_FLAG\_VM)) {+ err = -EINVAL;+ goto err\_exec\_queue;+ }  if (XE\_IOCTL\_DBG(xe, args->num\_batch\_buffer &&- q->width != args->num\_batch\_buffer))- return -EINVAL;+ q->width != args->num\_batch\_buffer)) {+ err = -EINVAL;+ goto err\_exec\_queue;+ }  if (XE\_IOCTL\_DBG(xe, q->ops->reset\_status(q))) { err = -ECANCELED; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 21:43:25 +0000



=== Content from git.kernel.org_78e3029b_20250114_214448.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=2f92b77a8ce043fbda2664d9be4b66bdc57f67b7)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=2f92b77a8ce043fbda2664d9be4b66bdc57f67b7)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=2f92b77a8ce043fbda2664d9be4b66bdc57f67b7)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=2f92b77a8ce043fbda2664d9be4b66bdc57f67b7)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Matthew Brost <matthew.brost@intel.com> | 2024-11-04 20:35:23 -0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-11-14 13:21:05 +0100 |
| commit | [2f92b77a8ce043fbda2664d9be4b66bdc57f67b7](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=2f92b77a8ce043fbda2664d9be4b66bdc57f67b7) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=2f92b77a8ce043fbda2664d9be4b66bdc57f67b7)) | |
| tree | [2071392a6ba713b411958f00d272d2933840a42c](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=2f92b77a8ce043fbda2664d9be4b66bdc57f67b7) | |
| parent | [1b6ad475d4ed577d34e0157eb507be00c588bf5c](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=1b6ad475d4ed577d34e0157eb507be00c588bf5c) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=2f92b77a8ce043fbda2664d9be4b66bdc57f67b7&id2=1b6ad475d4ed577d34e0157eb507be00c588bf5c)) | |
| download | [linux-2f92b77a8ce043fbda2664d9be4b66bdc57f67b7.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-2f92b77a8ce043fbda2664d9be4b66bdc57f67b7.tar.gz) | |

drm/xe: Fix possible exec queue leak in exec IOCTLcommit af797b831d8975cb4610f396dcb7f03f4b9908e7 upstream.
In a couple of places after an exec queue is looked up the exec IOCTL
returns on input errors without dropping the exec queue ref. Fix this
ensuring the exec queue ref is dropped on input error.
Fixes: dd08ebf6c352 ("drm/xe: Introduce a new DRM driver for Intel GPUs")
Cc: <stable@vger.kernel.org>
Signed-off-by: Matthew Brost <matthew.brost@intel.com>
Reviewed-by: Tejas Upadhyay <tejas.upadhyay@intel.com>
Reviewed-by: Rodrigo Vivi <rodrigo.vivi@intel.com>
Link: [https://patchwork.freedesktop.org/patch/msgid/20241105043524.4062774-2-matthew.brost@intel.com](https://patchwork.freedesktop.org/patch/msgid/20241105043524.4062774-2-matthew.brost%40intel.com)
(cherry picked from commit 07064a200b40ac2195cb6b7b779897d9377e5e6f)
Signed-off-by: Lucas De Marchi <lucas.demarchi@intel.com>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=2f92b77a8ce043fbda2664d9be4b66bdc57f67b7)

| -rw-r--r-- | [drivers/gpu/drm/xe/xe\_exec.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/gpu/drm/xe/xe_exec.c?id=2f92b77a8ce043fbda2664d9be4b66bdc57f67b7) | 12 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 8 insertions, 4 deletions

| diff --git a/drivers/gpu/drm/xe/xe\_exec.c b/drivers/gpu/drm/xe/xe\_exec.cindex 6e5ba381eadedd..c0121801caef0a 100644--- a/[drivers/gpu/drm/xe/xe\_exec.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/xe/xe_exec.c?id=1b6ad475d4ed577d34e0157eb507be00c588bf5c)+++ b/[drivers/gpu/drm/xe/xe\_exec.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/xe/xe_exec.c?id=2f92b77a8ce043fbda2664d9be4b66bdc57f67b7)@@ -129,12 +129,16 @@ int xe\_exec\_ioctl(struct drm\_device \*dev, void \*data, struct drm\_file \*file) if (XE\_IOCTL\_DBG(xe, !q)) return -ENOENT; - if (XE\_IOCTL\_DBG(xe, q->flags & EXEC\_QUEUE\_FLAG\_VM))- return -EINVAL;+ if (XE\_IOCTL\_DBG(xe, q->flags & EXEC\_QUEUE\_FLAG\_VM)) {+ err = -EINVAL;+ goto err\_exec\_queue;+ }  if (XE\_IOCTL\_DBG(xe, args->num\_batch\_buffer &&- q->width != args->num\_batch\_buffer))- return -EINVAL;+ q->width != args->num\_batch\_buffer)) {+ err = -EINVAL;+ goto err\_exec\_queue;+ }  if (XE\_IOCTL\_DBG(xe, q->ops->reset\_status(q))) { err = -ECANCELED; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 21:43:25 +0000


