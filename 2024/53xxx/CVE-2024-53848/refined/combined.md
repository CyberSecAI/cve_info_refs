=== Content from github.com_4e03a766_20250114_192343.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpython-jsonschema%2Fcheck-jsonschema%2Fcommit%2Fc52714b85e6725b1b24516fbdedacb333b939152)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpython-jsonschema%2Fcheck-jsonschema%2Fcommit%2Fc52714b85e6725b1b24516fbdedacb333b939152)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=python-jsonschema%2Fcheck-jsonschema)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[python-jsonschema](/python-jsonschema)
/
**[check-jsonschema](/python-jsonschema/check-jsonschema)**
Public

* [Notifications](/login?return_to=%2Fpython-jsonschema%2Fcheck-jsonschema) You must be signed in to change notification settings
* [Fork
  42](/login?return_to=%2Fpython-jsonschema%2Fcheck-jsonschema)
* [Star
   228](/login?return_to=%2Fpython-jsonschema%2Fcheck-jsonschema)

* [Code](/python-jsonschema/check-jsonschema)
* [Issues
  19](/python-jsonschema/check-jsonschema/issues)
* [Pull requests
  2](/python-jsonschema/check-jsonschema/pulls)
* [Actions](/python-jsonschema/check-jsonschema/actions)
* [Security](/python-jsonschema/check-jsonschema/security)
* [Insights](/python-jsonschema/check-jsonschema/pulse)

Additional navigation options

* [Code](/python-jsonschema/check-jsonschema)
* [Issues](/python-jsonschema/check-jsonschema/issues)
* [Pull requests](/python-jsonschema/check-jsonschema/pulls)
* [Actions](/python-jsonschema/check-jsonschema/actions)
* [Security](/python-jsonschema/check-jsonschema/security)
* [Insights](/python-jsonschema/check-jsonschema/pulse)

## Commit

[Permalink](/python-jsonschema/check-jsonschema/commit/c52714b85e6725b1b24516fbdedacb333b939152)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Merge pull request [#503](https://github.com/python-jsonschema/check-jsonschema/pull/503) from python-jsonschema/fix-caching

[Browse files](/python-jsonschema/check-jsonschema/tree/c52714b85e6725b1b24516fbdedacb333b939152)
Browse the repository at this point in the history

```
Fix caching behavior to always use hashed URLs for the cache filenames
```

* Loading branch information

[![@sirosen](https://avatars.githubusercontent.com/u/1300022?s=40&v=4)](/sirosen)

[sirosen](/python-jsonschema/check-jsonschema/commits?author=sirosen "View all commits by sirosen")
authored
Nov 29, 2024

2 parents
[85aa1cc](/python-jsonschema/check-jsonschema/commit/85aa1cc060e60bcd7a8753826f2af81282b1c6ec)
+
[6e94302](/python-jsonschema/check-jsonschema/commit/6e943027eb1d941132ca6efb2eb85136f4176461)

commit c52714b

 Show file tree

 Hide file tree

Showing
**8 changed files**
with
**101 additions**
and
**104 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* docs

  + docs/usage.rst
    [usage.rst](#diff-c4b284a0e8c330264ebefb4d3d14dd5bb68fe3b72c2ae656f49132e2c134b84f)
* src/check\_jsonschema

  + src/check\_jsonschema/cachedownloader.py
    [cachedownloader.py](#diff-5090b3d4657379895497068e4f3862e9dc8476427185c5fdce3dc48ecffc35d1)
  + cli

    - src/check\_jsonschema/cli/main\_command.py
      [main\_command.py](#diff-8f4945c34d9810da6ffe6ea1004108f492a0161c8fac9031d8793fe1253931db)
  + schema\_loader

    - src/check\_jsonschema/schema\_loader/main.py
      [main.py](#diff-a2bff9f6ea2b5d7e090c5861547516be8f47b70f74a1149e8d1043bacdb1621b)
    - src/check\_jsonschema/schema\_loader/readers.py
      [readers.py](#diff-69bab74b03948e20de9762991991f8e463ee3ca8fcdf9c39dbba7376c6cae7ea)
    - src/check\_jsonschema/schema\_loader/resolver.py
      [resolver.py](#diff-ef309c7bde59a4ad729da2865cc1fa7a9a71030c563a52f3fed7ed0b9cb5c467)
* tests

  + tests/conftest.py
    [conftest.py](#diff-e52e4ddd58b7ef887ab03c04116e676f6280b824ab7469d5d3080e5cba4f2128)
  + unit

    - tests/unit/test\_cachedownloader.py
      [test\_cachedownloader.py](#diff-72c0d68856546446086ca5f8ada5c93582bb181b904b7f4ebeaab1771ac1d111)

## There are no files selected for viewing

7 changes: 4 additions & 3 deletions

7
[docs/usage.rst](#diff-c4b284a0e8c330264ebefb4d3d14dd5bb68fe3b72c2ae656f49132e2c134b84f "docs/usage.rst")

Show comments

[View file](/python-jsonschema/check-jsonschema/blob/c52714b85e6725b1b24516fbdedacb333b939152/docs/usage.rst)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

| Expand Up | | @@ -118,6 +118,10 @@ Downloading and Caching |
|  |  | By default, when ``--schemafile`` is used to refer to an ``http://`` or |
|  |  | ``https://`` location, the schema is downloaded and cached based on the |
|  |  | schema's Last-Modified time. |
|  |  |  |
|  |  | Additionally, when ``$ref``\s are looked up during schema resolution, they are |
|  |  | similarly cached. |
|  |  |  |
|  |  | The following options control caching behaviors. |
|  |  |  |
|  |  | .. list-table:: Caching Options |
| Expand All | | @@ -128,9 +132,6 @@ The following options control caching behaviors. |
|  |  | - Description |
|  |  | \* - ``--no-cache`` |
|  |  | - Disable caching. |
|  |  | \* - ``--cache-filename`` |
|  |  | - The name to use for caching a remote schema. |
|  |  | Defaults to using the last slash-delimited part of the URI. |
|  |  |  |
|  |  | "format" Validation Options |
|  |  | --------------------------- |
| Expand Down | |  |

37 changes: 26 additions & 11 deletions

37
[src/check\_jsonschema/cachedownloader.py](#diff-5090b3d4657379895497068e4f3862e9dc8476427185c5fdce3dc48ecffc35d1 "src/check_jsonschema/cachedownloader.py")

Show comments

[View file](/python-jsonschema/check-jsonschema/blob/c52714b85e6725b1b24516fbdedacb333b939152/src/check_jsonschema/cachedownloader.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -1,6 +1,7 @@ |
|  |  | from \_\_future\_\_ import annotations |
|  |  |  |
|  |  | import contextlib |
|  |  | import hashlib |
|  |  | import io |
|  |  | import os |
|  |  | import platform |
| Expand Down  Expand Up | | @@ -33,7 +34,7 @@ def \_base\_cache\_dir() -> str | None: |
|  |  | return cache\_dir |
|  |  |  |
|  |  |  |
|  |  | def \_resolve\_cache\_dir(dirname: str = "downloads") -> str | None: |
|  |  | def \_resolve\_cache\_dir(dirname: str) -> str | None: |
|  |  | cache\_dir = \_base\_cache\_dir() |
|  |  | if cache\_dir: |
|  |  | cache\_dir = os.path.join(cache\_dir, "check\_jsonschema", dirname) |
| Expand Down  Expand Up | | @@ -95,18 +96,32 @@ def \_cache\_hit(cachefile: str, response: requests.Response) -> bool: |
|  |  | return local\_mtime >= remote\_mtime |
|  |  |  |
|  |  |  |
|  |  | def url\_to\_cache\_filename(ref\_url: str) -> str: |
|  |  | """ |
|  |  | Given a schema URL, convert it to a filename for caching in a cache dir. |
|  |  |  |
|  |  | Rules are as follows: |
|  |  | - the base filename is an sha256 hash of the URL |
|  |  | - if the filename ends in an extension (.json, .yaml, etc) that extension |
|  |  | is appended to the hash |
|  |  |  |
|  |  | Preserving file extensions preserves the extension-based logic used for parsing, and |
|  |  | it also helps a local editor (browsing the cache) identify filetypes. |
|  |  | """ |
|  |  | filename = hashlib.sha256(ref\_url.encode()).hexdigest() |
|  |  | if "." in (last\_part := ref\_url.rpartition("/")[-1]): |
|  |  | \_, \_, extension = last\_part.rpartition(".") |
|  |  | filename = f"{filename}.{extension}" |
|  |  | return filename |
|  |  |  |
|  |  |  |
|  |  | class FailedDownloadError(Exception): |
|  |  | pass |
|  |  |  |
|  |  |  |
|  |  | class CacheDownloader: |
|  |  | def \_\_init\_\_( |
|  |  | self, cache\_dir: str | None = None, disable\_cache: bool = False |
|  |  | ) -> None: |
|  |  | if cache\_dir is None: |
|  |  | self.\_cache\_dir = \_resolve\_cache\_dir() |
|  |  | else: |
|  |  | self.\_cache\_dir = \_resolve\_cache\_dir(cache\_dir) |
|  |  | def \_\_init\_\_(self, cache\_dir: str, \*, disable\_cache: bool = False) -> None: |
|  |  | self.\_cache\_dir = \_resolve\_cache\_dir(cache\_dir) |
|  |  | self.\_disable\_cache = disable\_cache |
|  |  |  |
|  |  | def \_download( |
| Expand Down  Expand Up | | @@ -160,21 +175,21 @@ def bind( |
|  |  | validation\_callback: t.Callable[[bytes], t.Any] | None = None, |
|  |  | ) -> BoundCacheDownloader: |
|  |  | return BoundCacheDownloader( |
|  |  | file\_url, filename, self, validation\_callback=validation\_callback |
|  |  | file\_url, self, filename=filename, validation\_callback=validation\_callback |
|  |  | ) |
|  |  |  |
|  |  |  |
|  |  | class BoundCacheDownloader: |
|  |  | def \_\_init\_\_( |
|  |  | self, |
|  |  | file\_url: str, |
|  |  | filename: str | None, |
|  |  | downloader: CacheDownloader, |
|  |  | \*, |
|  |  | filename: str | None = None, |
|  |  | validation\_callback: t.Callable[[bytes], t.Any] | None = None, |
|  |  | ) -> None: |
|  |  | self.\_file\_url = file\_url |
|  |  | self.\_filename = filename or file\_url.split("/")[-1] |
|  |  | self.\_filename = filename or url\_to\_cache\_filename(file\_url) |
|  |  | self.\_downloader = downloader |
|  |  | self.\_validation\_callback = validation\_callback |
|  |  |  |
| Expand Down | |  |

9 changes: 1 addition & 8 deletions

9
[src/check\_jsonschema/cli/main\_command.py](#diff-8f4945c34d9810da6ffe6ea1004108f492a0161c8fac9031d8793fe1253931db "src/check_jsonschema/cli/main_command.py")

Show comments

[View file](/python-jsonschema/check-jsonschema/blob/c52714b85e6725b1b24516fbdedacb333b939152/src/check_jsonschema/cli/main_command.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -130,11 +130,7 @@ def pretty\_helptext\_list(values: list[str] | tuple[str, ...]) -> str: |
|  |  | help="Disable schema caching. Always download remote schemas.", |
|  |  | ) |
|  |  | @click.option( |
|  |  | "--cache-filename", |
|  |  | help=( |
|  |  | "The name to use for caching a remote schema. " |
|  |  | "Defaults to the last slash-delimited part of the URI." |
|  |  | ), |
|  |  | "--cache-filename", help="Deprecated. This option no longer has any effect." |
|  |  | ) |
|  |  | @click.option( |
|  |  | "--disable-formats", |
| Expand Down  Expand Up | | @@ -271,8 +267,6 @@ def main( |
|  |  | args.disable\_cache = no\_cache |
|  |  | args.default\_filetype = default\_filetype |
|  |  | args.fill\_defaults = fill\_defaults |
|  |  | if cache\_filename is not None: |
|  |  | args.cache\_filename = cache\_filename |
|  |  | if data\_transform is not None: |
|  |  | args.data\_transform = TRANSFORM\_LIBRARY[data\_transform] |
|  |  |  |
| Expand Down  Expand Up | | @@ -300,7 +294,6 @@ def build\_schema\_loader(args: ParseResult) -> SchemaLoaderBase: |
|  |  | assert args.schema\_path is not None |
|  |  | return SchemaLoader( |
|  |  | args.schema\_path, |
|  |  | cache\_filename=args.cache\_filename, |
|  |  | disable\_cache=args.disable\_cache, |
|  |  | base\_uri=args.base\_uri, |
|  |  | validator\_class=args.validator\_class, |
| Expand Down | |  |

8 changes: 1 addition & 7 deletions

8
[src/check\_jsonschema/schema\_loader/main.py](#diff-a2bff9f6ea2b5d7e090c5861547516be8f47b70f74a1149e8d1043bacdb1621b "src/check_jsonschema/schema_loader/main.py")

Show comments

[View file](/python-jsonschema/check-jsonschema/blob/c52714b85e6725b1b24516fbdedacb333b939152/src/check_jsonschema/schema_loader/main.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -64,14 +64,12 @@ def \_\_init\_\_( |
|  |  | self, |
|  |  | schemafile: str, |
|  |  | \*, |
|  |  | cache\_filename: str | None = None, |
|  |  | base\_uri: str | None = None, |
|  |  | validator\_class: type[jsonschema.protocols.Validator] | None = None, |
|  |  | disable\_cache: bool = True, |
|  |  | ) -> None: |
|  |  | # record input parameters (these are not to be modified) |
|  |  | self.schemafile = schemafile |
|  |  | self.cache\_filename = cache\_filename |
|  |  | self.disable\_cache = disable\_cache |
|  |  | self.base\_uri = base\_uri |
|  |  | self.validator\_class = validator\_class |
| Expand Down  Expand Up | | @@ -105,11 +103,7 @@ def \_get\_schema\_reader( |
|  |  | return LocalSchemaReader(self.schemafile) |
|  |  |  |
|  |  | if self.url\_info.scheme in ("http", "https"): |
|  |  | return HttpSchemaReader( |
|  |  | self.schemafile, |
|  |  | self.cache\_filename, |
|  |  | self.disable\_cache, |
|  |  | ) |
|  |  | return HttpSchemaReader(self.schemafile, self.disable\_cache) |
|  |  | else: |
|  |  | raise UnsupportedUrlScheme( |
|  |  | "check-jsonschema only supports http, https, and local files. " |
| Expand Down | |  |

7 changes: 3 additions & 4 deletions

7
[src/check\_jsonschema/schema\_loader/readers.py](#diff-69bab74b03948e20de9762991991f8e463ee3ca8fcdf9c39dbba7376c6cae7ea "src/check_jsonschema/schema_loader/readers.py")

Show comments

[View file](/python-jsonschema/check-jsonschema/blob/c52714b85e6725b1b24516fbdedacb333b939152/src/check_jsonschema/schema_loader/readers.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -73,14 +73,13 @@ class HttpSchemaReader: |
|  |  | def \_\_init\_\_( |
|  |  | self, |
|  |  | url: str, |
|  |  | cache\_filename: str | None, |
|  |  | disable\_cache: bool, |
|  |  | ) -> None: |
|  |  | self.url = url |
|  |  | self.parsers = ParserSet() |
|  |  | self.downloader = CacheDownloader( |
|  |  | disable\_cache=disable\_cache, |
|  |  | ).bind(url, cache\_filename, validation\_callback=self.\_parse) |
|  |  | self.downloader = CacheDownloader("schemas", disable\_cache=disable\_cache).bind( |
|  |  | url, validation\_callback=self.\_parse |
|  |  | ) |
|  |  | self.\_parsed\_schema: dict | \_UnsetType = \_UNSET |
|  |  |  |
|  |  | def \_parse(self, schema\_bytes: bytes) -> t.Any: |
| Expand Down | |  |

22 changes: 2 additions & 20 deletions

22
[src/check\_jsonschema/schema\_loader/resolver.py](#diff-ef309c7bde59a4ad729da2865cc1fa7a9a71030c563a52f3fed7ed0b9cb5c467 "src/check_jsonschema/schema_loader/resolver.py")

Show comments

[View file](/python-jsonschema/check-jsonschema/blob/c52714b85e6725b1b24516fbdedacb333b939152/src/check_jsonschema/schema_loader/resolver.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -1,6 +1,5 @@ |
|  |  | from \_\_future\_\_ import annotations |
|  |  |  |
|  |  | import hashlib |
|  |  | import typing as t |
|  |  | import urllib.parse |
|  |  |  |
| Expand All | | @@ -12,21 +11,6 @@ |
|  |  | from ..utils import filename2path |
|  |  |  |
|  |  |  |
|  |  | def ref\_url\_to\_cache\_filename(ref\_url: str) -> str: |
|  |  | """ |
|  |  | Given a $ref URL, convert it to the filename in the refs/ cache dir. |
|  |  | Rules are as follows: |
|  |  | - the base filename is an md5 hash of the URL |
|  |  | - if the filename ends in an extension (.json, .yaml, etc) that extension |
|  |  | is appended to the hash |
|  |  | """ |
|  |  | filename = hashlib.md5(ref\_url.encode()).hexdigest() |
|  |  | if "." in (last\_part := ref\_url.rpartition("/")[-1]): |
|  |  | \_, \_, extension = last\_part.rpartition(".") |
|  |  | filename = f"{filename}.{extension}" |
|  |  | return filename |
|  |  |  |
|  |  |  |
|  |  | def make\_reference\_registry( |
|  |  | parsers: ParserSet, retrieval\_uri: str | None, schema: dict, disable\_cache: bool |
|  |  | ) -> referencing.Registry: |
| Expand Down  Expand Up | | @@ -66,7 +50,7 @@ def create\_retrieve\_callable( |
|  |  | base\_uri = retrieval\_uri |
|  |  |  |
|  |  | cache = ResourceCache() |
|  |  | downloader = CacheDownloader("refs", disable\_cache) |
|  |  | downloader = CacheDownloader("refs", disable\_cache=disable\_cache) |
|  |  |  |
|  |  | def get\_local\_file(uri: str) -> t.Any: |
|  |  | path = filename2path(uri) |
| Expand All | | @@ -89,9 +73,7 @@ def validation\_callback(content: bytes) -> None: |
|  |  | parser\_set.parse\_data\_with\_path(content, full\_uri, "json") |
|  |  |  |
|  |  | bound\_downloader = downloader.bind( |
|  |  | full\_uri, |
|  |  | ref\_url\_to\_cache\_filename(full\_uri), |
|  |  | validation\_callback, |
|  |  | full\_uri, validation\_callback=validation\_callback |
|  |  | ) |
|  |  | with bound\_downloader.open() as fp: |
|  |  | data = fp.read() |
| Expand Down | |  |

24 changes: 16 additions & 8 deletions

24
[tests/conftest.py](#diff-e52e4ddd58b7ef887ab03c04116e676f6280b824ab7469d5d3080e5cba4f2128 "tests/conftest.py")

Show comments

[View file](/python-jsonschema/check-jsonschema/blob/c52714b85e6725b1b24516fbdedacb333b939152/tests/conftest.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -62,15 +62,25 @@ def patch\_cache\_dir(monkeypatch, cache\_dir): |
|  |  | yield m |
|  |  |  |
|  |  |  |
|  |  | @pytest.fixture |
|  |  | def url2cachepath(): |
|  |  | from check\_jsonschema.cachedownloader import url\_to\_cache\_filename |
|  |  |  |
|  |  | def \_get(cache\_dir, url): |
|  |  | return cache\_dir / url\_to\_cache\_filename(url) |
|  |  |  |
|  |  | return \_get |
|  |  |  |
|  |  |  |
|  |  | @pytest.fixture |
|  |  | def downloads\_cache\_dir(tmp\_path): |
|  |  | return tmp\_path / ".cache" / "check\_jsonschema" / "downloads" |
|  |  |  |
|  |  |  |
|  |  | @pytest.fixture |
|  |  | def get\_download\_cache\_loc(downloads\_cache\_dir): |
|  |  | def \_get(uri): |
|  |  | return downloads\_cache\_dir / uri.split("/")[-1] |
|  |  | def get\_download\_cache\_loc(downloads\_cache\_dir, url2cachepath): |
|  |  | def \_get(url): |
|  |  | return url2cachepath(downloads\_cache\_dir, url) |
|  |  |  |
|  |  | return \_get |
|  |  |  |
| Expand All | | @@ -94,11 +104,9 @@ def refs\_cache\_dir(tmp\_path): |
|  |  |  |
|  |  |  |
|  |  | @pytest.fixture |
|  |  | def get\_ref\_cache\_loc(refs\_cache\_dir): |
|  |  | from check\_jsonschema.schema\_loader.resolver import ref\_url\_to\_cache\_filename |
|  |  |  |
|  |  | def \_get(uri): |
|  |  | return refs\_cache\_dir / ref\_url\_to\_cache\_filename(uri) |
|  |  | def get\_ref\_cache\_loc(refs\_cache\_dir, url2cachepath): |
|  |  | def \_get(url): |
|  |  | return url2cachepath(refs\_cache\_dir, url) |
|  |  |  |
|  |  | return \_get |
|  |  |  |
| Expand Down | |  |

 Loading

Oops, something went wrong.
 Retry

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `c52714b`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpython-jsonschema%2Fcheck-jsonschema%2Fcommit%2Fc52714b85e6725b1b24516fbdedacb333b939152) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_cf5484b4_20250114_192345.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpython-jsonschema%2Fcheck-jsonschema%2Fsecurity%2Fadvisories%2FGHSA-q6mv-284r-mp36)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpython-jsonschema%2Fcheck-jsonschema%2Fsecurity%2Fadvisories%2FGHSA-q6mv-284r-mp36)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=python-jsonschema%2Fcheck-jsonschema)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[python-jsonschema](/python-jsonschema)
/
**[check-jsonschema](/python-jsonschema/check-jsonschema)**
Public

* [Notifications](/login?return_to=%2Fpython-jsonschema%2Fcheck-jsonschema) You must be signed in to change notification settings
* [Fork
  42](/login?return_to=%2Fpython-jsonschema%2Fcheck-jsonschema)
* [Star
   228](/login?return_to=%2Fpython-jsonschema%2Fcheck-jsonschema)

* [Code](/python-jsonschema/check-jsonschema)
* [Issues
  19](/python-jsonschema/check-jsonschema/issues)
* [Pull requests
  2](/python-jsonschema/check-jsonschema/pulls)
* [Actions](/python-jsonschema/check-jsonschema/actions)
* [Security](/python-jsonschema/check-jsonschema/security)
* [Insights](/python-jsonschema/check-jsonschema/pulse)

Additional navigation options

* [Code](/python-jsonschema/check-jsonschema)
* [Issues](/python-jsonschema/check-jsonschema/issues)
* [Pull requests](/python-jsonschema/check-jsonschema/pulls)
* [Actions](/python-jsonschema/check-jsonschema/actions)
* [Security](/python-jsonschema/check-jsonschema/security)
* [Insights](/python-jsonschema/check-jsonschema/pulse)

# check-jsonschema default caching for remote schemas allows for cache confusion

High

[sirosen](/sirosen)
published
GHSA-q6mv-284r-mp36
Nov 29, 2024

## Package

pip

check-jsonschema
([pip](/advisories?query=ecosystem%3Apip))

## Affected versions

<0.30.0

## Patched versions

>=0.30.0

## Description

### Impact

The default cache strategy uses the basename of a remote schema as the name of the file in the cache, e.g. `https://example.org/schema.json` will be stored as `schema.json`. This naming allows for conflicts. If an attacker can get a user to run `check-jsonschema` against a malicious schema URL, e.g., `https://example.evil.org/schema.json`, they can insert their own schema into the cache and it will be picked up and used instead of the appropriate schema.

Such a cache confusion attack could be used to allow data to pass validation which should have been rejected.

### Patches

A patch is in progress but has not yet been released.

### Workarounds

* Users can use `--no-cache` to disable caching.
* Users can use `--cache-filename` to select filenames for use in the cache, or to ensure that other usages do not overwrite the cached schema. (Note: this flag is being deprecated as part of the remediation effort.)
* Users can explicitly download the schema before use as a local file, as in `curl -LOs https://example.org/schema.json; check-jsonschema --schemafile ./schema.json`

### Severity

High

7.1

# CVSS overall score

 This score calculates overall vulnerability severity from 0 to 10 and is based on the Common Vulnerability Scoring System (CVSS).

 / 10

#### CVSS v3 base metrics

Attack vector
Local

Attack complexity
Low

Privileges required
None

User interaction
None

Scope
Changed

Confidentiality
None

Integrity
High

Availability
None

Learn more about base metrics

# CVSS v3 base metrics

Attack vector:
More severe the more the remote (logically and physically) an attacker can be in order to exploit the vulnerability.

Attack complexity:
More severe for the least complex attacks.

Privileges required:
More severe if no privileges are required.

User interaction:
More severe when no user interaction is required.

Scope:
More severe when a scope change occurs, e.g. one vulnerable component impacts resources in components beyond its security scope.

Confidentiality:
More severe when loss of data confidentiality is highest, measuring the level of data access available to an unauthorized user.

Integrity:
More severe when loss of data integrity is the highest, measuring the consequence of data modification possible by an unauthorized user.

Availability:
More severe when the loss of impacted component availability is highest.

CVSS:3.1/AV:L/AC:L/PR:N/UI:N/S:C/C:N/I:H/A:N

### CVE ID

CVE-2024-53848

### Weaknesses

[CWE-349](/advisories?query=cwe%3A349)

### Credits

* [![@sethmlarson](https://avatars.githubusercontent.com/u/18519037?s=40&v=4)](/sethmlarson)
  [sethmlarson](/sethmlarson)
  Reporter
* [![@sirosen](https://avatars.githubusercontent.com/u/1300022?s=40&v=4)](/sirosen)
  [sirosen](/sirosen)
  Remediation developer

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


