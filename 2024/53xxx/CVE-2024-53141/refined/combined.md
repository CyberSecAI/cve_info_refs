=== Content from git.kernel.org_44c49d47_20250114_202705.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=856023ef032d824309abd5c747241dffa33aae8c)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=856023ef032d824309abd5c747241dffa33aae8c)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=856023ef032d824309abd5c747241dffa33aae8c)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=856023ef032d824309abd5c747241dffa33aae8c)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Jeongjun Park <aha310510@gmail.com> | 2024-11-13 22:02:09 +0900 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-09 10:32:47 +0100 |
| commit | [856023ef032d824309abd5c747241dffa33aae8c](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=856023ef032d824309abd5c747241dffa33aae8c) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=856023ef032d824309abd5c747241dffa33aae8c)) | |
| tree | [6fe45b2b3ab4731db0300fca1472f6c47fc6ac09](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=856023ef032d824309abd5c747241dffa33aae8c) | |
| parent | [5691e457251bd868be7fa09b7271d97cb8b80042](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=5691e457251bd868be7fa09b7271d97cb8b80042) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=856023ef032d824309abd5c747241dffa33aae8c&id2=5691e457251bd868be7fa09b7271d97cb8b80042)) | |
| download | [linux-856023ef032d824309abd5c747241dffa33aae8c.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-856023ef032d824309abd5c747241dffa33aae8c.tar.gz) | |

netfilter: ipset: add missing range check in bitmap\_ip\_uadtcommit 35f56c554eb1b56b77b3cf197a6b00922d49033d upstream.
When tb[IPSET\_ATTR\_IP\_TO] is not present but tb[IPSET\_ATTR\_CIDR] exists,
the values of ip and ip\_to are slightly swapped. Therefore, the range check
for ip should be done later, but this part is missing and it seems that the
vulnerability occurs.
So we should add missing range checks and remove unnecessary range checks.
Cc: <stable@vger.kernel.org>
Reported-by: syzbot+58c872f7790a4d2ac951@syzkaller.appspotmail.com
Fixes: 72205fc68bd1 ("netfilter: ipset: bitmap:ip set type support")
Signed-off-by: Jeongjun Park <aha310510@gmail.com>
Acked-by: Jozsef Kadlecsik <kadlec@blackhole.kfki.hu>
Signed-off-by: Pablo Neira Ayuso <pablo@netfilter.org>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=856023ef032d824309abd5c747241dffa33aae8c)

| -rw-r--r-- | [net/netfilter/ipset/ip\_set\_bitmap\_ip.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/netfilter/ipset/ip_set_bitmap_ip.c?id=856023ef032d824309abd5c747241dffa33aae8c) | 7 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 2 insertions, 5 deletions

| diff --git a/net/netfilter/ipset/ip\_set\_bitmap\_ip.c b/net/netfilter/ipset/ip\_set\_bitmap\_ip.cindex e4fa00abde6a2a..5988b9bb9029dc 100644--- a/[net/netfilter/ipset/ip\_set\_bitmap\_ip.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/netfilter/ipset/ip_set_bitmap_ip.c?id=5691e457251bd868be7fa09b7271d97cb8b80042)+++ b/[net/netfilter/ipset/ip\_set\_bitmap\_ip.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/netfilter/ipset/ip_set_bitmap_ip.c?id=856023ef032d824309abd5c747241dffa33aae8c)@@ -163,11 +163,8 @@ bitmap\_ip\_uadt(struct ip\_set \*set, struct nlattr \*tb[], ret = ip\_set\_get\_hostipaddr4(tb[IPSET\_ATTR\_IP\_TO], &ip\_to); if (ret) return ret;- if (ip > ip\_to) {+ if (ip > ip\_to) swap(ip, ip\_to);- if (ip < map->first\_ip)- return -IPSET\_ERR\_BITMAP\_RANGE;- } } else if (tb[IPSET\_ATTR\_CIDR]) { u8 cidr = nla\_get\_u8(tb[IPSET\_ATTR\_CIDR]); @@ -178,7 +175,7 @@ bitmap\_ip\_uadt(struct ip\_set \*set, struct nlattr \*tb[], ip\_to = ip; } - if (ip\_to > map->last\_ip)+ if (ip < map->first\_ip || ip\_to > map->last\_ip) return -IPSET\_ERR\_BITMAP\_RANGE;  for (; !before(ip\_to, ip); ip += map->hosts) { |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 20:25:42 +0000



=== Content from git.kernel.org_0fa50b8b_20250114_202703.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=7ffef5e5d5eeecd9687204a5ec2d863752aafb7e)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=7ffef5e5d5eeecd9687204a5ec2d863752aafb7e)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=7ffef5e5d5eeecd9687204a5ec2d863752aafb7e)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=7ffef5e5d5eeecd9687204a5ec2d863752aafb7e)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Jeongjun Park <aha310510@gmail.com> | 2024-11-13 22:02:09 +0900 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-14 19:54:01 +0100 |
| commit | [7ffef5e5d5eeecd9687204a5ec2d863752aafb7e](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=7ffef5e5d5eeecd9687204a5ec2d863752aafb7e) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=7ffef5e5d5eeecd9687204a5ec2d863752aafb7e)) | |
| tree | [6bd0db5a8a092d63e50462b28f2a83e7608061a0](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=7ffef5e5d5eeecd9687204a5ec2d863752aafb7e) | |
| parent | [69418eec0c9746cbf6d3f2f0666b4f7270bf25c8](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=69418eec0c9746cbf6d3f2f0666b4f7270bf25c8) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=7ffef5e5d5eeecd9687204a5ec2d863752aafb7e&id2=69418eec0c9746cbf6d3f2f0666b4f7270bf25c8)) | |
| download | [linux-7ffef5e5d5eeecd9687204a5ec2d863752aafb7e.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-7ffef5e5d5eeecd9687204a5ec2d863752aafb7e.tar.gz) | |

netfilter: ipset: add missing range check in bitmap\_ip\_uadtcommit 35f56c554eb1b56b77b3cf197a6b00922d49033d upstream.
When tb[IPSET\_ATTR\_IP\_TO] is not present but tb[IPSET\_ATTR\_CIDR] exists,
the values of ip and ip\_to are slightly swapped. Therefore, the range check
for ip should be done later, but this part is missing and it seems that the
vulnerability occurs.
So we should add missing range checks and remove unnecessary range checks.
Cc: <stable@vger.kernel.org>
Reported-by: syzbot+58c872f7790a4d2ac951@syzkaller.appspotmail.com
Fixes: 72205fc68bd1 ("netfilter: ipset: bitmap:ip set type support")
Signed-off-by: Jeongjun Park <aha310510@gmail.com>
Acked-by: Jozsef Kadlecsik <kadlec@blackhole.kfki.hu>
Signed-off-by: Pablo Neira Ayuso <pablo@netfilter.org>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=7ffef5e5d5eeecd9687204a5ec2d863752aafb7e)

| -rw-r--r-- | [net/netfilter/ipset/ip\_set\_bitmap\_ip.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/netfilter/ipset/ip_set_bitmap_ip.c?id=7ffef5e5d5eeecd9687204a5ec2d863752aafb7e) | 7 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 2 insertions, 5 deletions

| diff --git a/net/netfilter/ipset/ip\_set\_bitmap\_ip.c b/net/netfilter/ipset/ip\_set\_bitmap\_ip.cindex e4fa00abde6a2a..5988b9bb9029dc 100644--- a/[net/netfilter/ipset/ip\_set\_bitmap\_ip.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/netfilter/ipset/ip_set_bitmap_ip.c?id=69418eec0c9746cbf6d3f2f0666b4f7270bf25c8)+++ b/[net/netfilter/ipset/ip\_set\_bitmap\_ip.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/netfilter/ipset/ip_set_bitmap_ip.c?id=7ffef5e5d5eeecd9687204a5ec2d863752aafb7e)@@ -163,11 +163,8 @@ bitmap\_ip\_uadt(struct ip\_set \*set, struct nlattr \*tb[], ret = ip\_set\_get\_hostipaddr4(tb[IPSET\_ATTR\_IP\_TO], &ip\_to); if (ret) return ret;- if (ip > ip\_to) {+ if (ip > ip\_to) swap(ip, ip\_to);- if (ip < map->first\_ip)- return -IPSET\_ERR\_BITMAP\_RANGE;- } } else if (tb[IPSET\_ATTR\_CIDR]) { u8 cidr = nla\_get\_u8(tb[IPSET\_ATTR\_CIDR]); @@ -178,7 +175,7 @@ bitmap\_ip\_uadt(struct ip\_set \*set, struct nlattr \*tb[], ip\_to = ip; } - if (ip\_to > map->last\_ip)+ if (ip < map->first\_ip || ip\_to > map->last\_ip) return -IPSET\_ERR\_BITMAP\_RANGE;  for (; !before(ip\_to, ip); ip += map->hosts) { |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 20:25:40 +0000



=== Content from git.kernel.org_59b033bc_20250114_202702.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=78b0f2028f1043227a8eb0c41944027fc6a04596)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=78b0f2028f1043227a8eb0c41944027fc6a04596)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=78b0f2028f1043227a8eb0c41944027fc6a04596)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=78b0f2028f1043227a8eb0c41944027fc6a04596)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Jeongjun Park <aha310510@gmail.com> | 2024-11-13 22:02:09 +0900 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-14 19:44:37 +0100 |
| commit | [78b0f2028f1043227a8eb0c41944027fc6a04596](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=78b0f2028f1043227a8eb0c41944027fc6a04596) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=78b0f2028f1043227a8eb0c41944027fc6a04596)) | |
| tree | [22973bd1495c19a11074a08a64b7743aa54ba54d](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=78b0f2028f1043227a8eb0c41944027fc6a04596) | |
| parent | [2d64a005baa775d6b1fdc665943d308d11f7646c](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=2d64a005baa775d6b1fdc665943d308d11f7646c) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=78b0f2028f1043227a8eb0c41944027fc6a04596&id2=2d64a005baa775d6b1fdc665943d308d11f7646c)) | |
| download | [linux-78b0f2028f1043227a8eb0c41944027fc6a04596.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-78b0f2028f1043227a8eb0c41944027fc6a04596.tar.gz) | |

netfilter: ipset: add missing range check in bitmap\_ip\_uadtcommit 35f56c554eb1b56b77b3cf197a6b00922d49033d upstream.
When tb[IPSET\_ATTR\_IP\_TO] is not present but tb[IPSET\_ATTR\_CIDR] exists,
the values of ip and ip\_to are slightly swapped. Therefore, the range check
for ip should be done later, but this part is missing and it seems that the
vulnerability occurs.
So we should add missing range checks and remove unnecessary range checks.
Cc: <stable@vger.kernel.org>
Reported-by: syzbot+58c872f7790a4d2ac951@syzkaller.appspotmail.com
Fixes: 72205fc68bd1 ("netfilter: ipset: bitmap:ip set type support")
Signed-off-by: Jeongjun Park <aha310510@gmail.com>
Acked-by: Jozsef Kadlecsik <kadlec@blackhole.kfki.hu>
Signed-off-by: Pablo Neira Ayuso <pablo@netfilter.org>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=78b0f2028f1043227a8eb0c41944027fc6a04596)

| -rw-r--r-- | [net/netfilter/ipset/ip\_set\_bitmap\_ip.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/netfilter/ipset/ip_set_bitmap_ip.c?id=78b0f2028f1043227a8eb0c41944027fc6a04596) | 7 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 2 insertions, 5 deletions

| diff --git a/net/netfilter/ipset/ip\_set\_bitmap\_ip.c b/net/netfilter/ipset/ip\_set\_bitmap\_ip.cindex 194d775ce4cc19..e758b81200204b 100644--- a/[net/netfilter/ipset/ip\_set\_bitmap\_ip.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/netfilter/ipset/ip_set_bitmap_ip.c?id=2d64a005baa775d6b1fdc665943d308d11f7646c)+++ b/[net/netfilter/ipset/ip\_set\_bitmap\_ip.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/netfilter/ipset/ip_set_bitmap_ip.c?id=78b0f2028f1043227a8eb0c41944027fc6a04596)@@ -163,11 +163,8 @@ bitmap\_ip\_uadt(struct ip\_set \*set, struct nlattr \*tb[], ret = ip\_set\_get\_hostipaddr4(tb[IPSET\_ATTR\_IP\_TO], &ip\_to); if (ret) return ret;- if (ip > ip\_to) {+ if (ip > ip\_to) swap(ip, ip\_to);- if (ip < map->first\_ip)- return -IPSET\_ERR\_BITMAP\_RANGE;- } } else if (tb[IPSET\_ATTR\_CIDR]) { u8 cidr = nla\_get\_u8(tb[IPSET\_ATTR\_CIDR]); @@ -178,7 +175,7 @@ bitmap\_ip\_uadt(struct ip\_set \*set, struct nlattr \*tb[], ip\_to = ip; } - if (ip\_to > map->last\_ip)+ if (ip < map->first\_ip || ip\_to > map->last\_ip) return -IPSET\_ERR\_BITMAP\_RANGE;  for (; !before(ip\_to, ip); ip += map->hosts) { |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 20:25:39 +0000



=== Content from git.kernel.org_bff25871_20250114_202659.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=15794835378ed56fb9bacc6a5dd3b9f33520604e)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=15794835378ed56fb9bacc6a5dd3b9f33520604e)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=15794835378ed56fb9bacc6a5dd3b9f33520604e)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=15794835378ed56fb9bacc6a5dd3b9f33520604e)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Jeongjun Park <aha310510@gmail.com> | 2024-11-13 22:02:09 +0900 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-05 14:02:51 +0100 |
| commit | [15794835378ed56fb9bacc6a5dd3b9f33520604e](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=15794835378ed56fb9bacc6a5dd3b9f33520604e) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=15794835378ed56fb9bacc6a5dd3b9f33520604e)) | |
| tree | [026cc9c31d10e8053fa051537f5bb2e37fd852be](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=15794835378ed56fb9bacc6a5dd3b9f33520604e) | |
| parent | [b3cb59cfaa17afd3210ade3d9ed473ee38ca2e64](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=b3cb59cfaa17afd3210ade3d9ed473ee38ca2e64) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=15794835378ed56fb9bacc6a5dd3b9f33520604e&id2=b3cb59cfaa17afd3210ade3d9ed473ee38ca2e64)) | |
| download | [linux-15794835378ed56fb9bacc6a5dd3b9f33520604e.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-15794835378ed56fb9bacc6a5dd3b9f33520604e.tar.gz) | |

netfilter: ipset: add missing range check in bitmap\_ip\_uadtcommit 35f56c554eb1b56b77b3cf197a6b00922d49033d upstream.
When tb[IPSET\_ATTR\_IP\_TO] is not present but tb[IPSET\_ATTR\_CIDR] exists,
the values of ip and ip\_to are slightly swapped. Therefore, the range check
for ip should be done later, but this part is missing and it seems that the
vulnerability occurs.
So we should add missing range checks and remove unnecessary range checks.
Cc: <stable@vger.kernel.org>
Reported-by: syzbot+58c872f7790a4d2ac951@syzkaller.appspotmail.com
Fixes: 72205fc68bd1 ("netfilter: ipset: bitmap:ip set type support")
Signed-off-by: Jeongjun Park <aha310510@gmail.com>
Acked-by: Jozsef Kadlecsik <kadlec@blackhole.kfki.hu>
Signed-off-by: Pablo Neira Ayuso <pablo@netfilter.org>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=15794835378ed56fb9bacc6a5dd3b9f33520604e)

| -rw-r--r-- | [net/netfilter/ipset/ip\_set\_bitmap\_ip.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/netfilter/ipset/ip_set_bitmap_ip.c?id=15794835378ed56fb9bacc6a5dd3b9f33520604e) | 7 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 2 insertions, 5 deletions

| diff --git a/net/netfilter/ipset/ip\_set\_bitmap\_ip.c b/net/netfilter/ipset/ip\_set\_bitmap\_ip.cindex e4fa00abde6a2a..5988b9bb9029dc 100644--- a/[net/netfilter/ipset/ip\_set\_bitmap\_ip.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/netfilter/ipset/ip_set_bitmap_ip.c?id=b3cb59cfaa17afd3210ade3d9ed473ee38ca2e64)+++ b/[net/netfilter/ipset/ip\_set\_bitmap\_ip.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/netfilter/ipset/ip_set_bitmap_ip.c?id=15794835378ed56fb9bacc6a5dd3b9f33520604e)@@ -163,11 +163,8 @@ bitmap\_ip\_uadt(struct ip\_set \*set, struct nlattr \*tb[], ret = ip\_set\_get\_hostipaddr4(tb[IPSET\_ATTR\_IP\_TO], &ip\_to); if (ret) return ret;- if (ip > ip\_to) {+ if (ip > ip\_to) swap(ip, ip\_to);- if (ip < map->first\_ip)- return -IPSET\_ERR\_BITMAP\_RANGE;- } } else if (tb[IPSET\_ATTR\_CIDR]) { u8 cidr = nla\_get\_u8(tb[IPSET\_ATTR\_CIDR]); @@ -178,7 +175,7 @@ bitmap\_ip\_uadt(struct ip\_set \*set, struct nlattr \*tb[], ip\_to = ip; } - if (ip\_to > map->last\_ip)+ if (ip < map->first\_ip || ip\_to > map->last\_ip) return -IPSET\_ERR\_BITMAP\_RANGE;  for (; !before(ip\_to, ip); ip += map->hosts) { |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 20:25:36 +0000



=== Content from git.kernel.org_ad35ff48_20250114_202702.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=591efa494a1cf649f50a35def649c43ae984cd03)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=591efa494a1cf649f50a35def649c43ae984cd03)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=591efa494a1cf649f50a35def649c43ae984cd03)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=591efa494a1cf649f50a35def649c43ae984cd03)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Jeongjun Park <aha310510@gmail.com> | 2024-11-13 22:02:09 +0900 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-05 13:54:16 +0100 |
| commit | [591efa494a1cf649f50a35def649c43ae984cd03](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=591efa494a1cf649f50a35def649c43ae984cd03) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=591efa494a1cf649f50a35def649c43ae984cd03)) | |
| tree | [d41ebbb757edac25418cad19f56faca7d0ad35fe](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=591efa494a1cf649f50a35def649c43ae984cd03) | |
| parent | [e0c8cf450d7b0c75b31f63aa0c63bae3bb885ade](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=e0c8cf450d7b0c75b31f63aa0c63bae3bb885ade) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=591efa494a1cf649f50a35def649c43ae984cd03&id2=e0c8cf450d7b0c75b31f63aa0c63bae3bb885ade)) | |
| download | [linux-591efa494a1cf649f50a35def649c43ae984cd03.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-591efa494a1cf649f50a35def649c43ae984cd03.tar.gz) | |

netfilter: ipset: add missing range check in bitmap\_ip\_uadtcommit 35f56c554eb1b56b77b3cf197a6b00922d49033d upstream.
When tb[IPSET\_ATTR\_IP\_TO] is not present but tb[IPSET\_ATTR\_CIDR] exists,
the values of ip and ip\_to are slightly swapped. Therefore, the range check
for ip should be done later, but this part is missing and it seems that the
vulnerability occurs.
So we should add missing range checks and remove unnecessary range checks.
Cc: <stable@vger.kernel.org>
Reported-by: syzbot+58c872f7790a4d2ac951@syzkaller.appspotmail.com
Fixes: 72205fc68bd1 ("netfilter: ipset: bitmap:ip set type support")
Signed-off-by: Jeongjun Park <aha310510@gmail.com>
Acked-by: Jozsef Kadlecsik <kadlec@blackhole.kfki.hu>
Signed-off-by: Pablo Neira Ayuso <pablo@netfilter.org>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=591efa494a1cf649f50a35def649c43ae984cd03)

| -rw-r--r-- | [net/netfilter/ipset/ip\_set\_bitmap\_ip.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/netfilter/ipset/ip_set_bitmap_ip.c?id=591efa494a1cf649f50a35def649c43ae984cd03) | 7 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 2 insertions, 5 deletions

| diff --git a/net/netfilter/ipset/ip\_set\_bitmap\_ip.c b/net/netfilter/ipset/ip\_set\_bitmap\_ip.cindex e4fa00abde6a2a..5988b9bb9029dc 100644--- a/[net/netfilter/ipset/ip\_set\_bitmap\_ip.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/netfilter/ipset/ip_set_bitmap_ip.c?id=e0c8cf450d7b0c75b31f63aa0c63bae3bb885ade)+++ b/[net/netfilter/ipset/ip\_set\_bitmap\_ip.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/netfilter/ipset/ip_set_bitmap_ip.c?id=591efa494a1cf649f50a35def649c43ae984cd03)@@ -163,11 +163,8 @@ bitmap\_ip\_uadt(struct ip\_set \*set, struct nlattr \*tb[], ret = ip\_set\_get\_hostipaddr4(tb[IPSET\_ATTR\_IP\_TO], &ip\_to); if (ret) return ret;- if (ip > ip\_to) {+ if (ip > ip\_to) swap(ip, ip\_to);- if (ip < map->first\_ip)- return -IPSET\_ERR\_BITMAP\_RANGE;- } } else if (tb[IPSET\_ATTR\_CIDR]) { u8 cidr = nla\_get\_u8(tb[IPSET\_ATTR\_CIDR]); @@ -178,7 +175,7 @@ bitmap\_ip\_uadt(struct ip\_set \*set, struct nlattr \*tb[], ip\_to = ip; } - if (ip\_to > map->last\_ip)+ if (ip < map->first\_ip || ip\_to > map->last\_ip) return -IPSET\_ERR\_BITMAP\_RANGE;  for (; !before(ip\_to, ip); ip += map->hosts) { |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 20:25:39 +0000



=== Content from git.kernel.org_57598cf3_20250114_202701.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=3c20b5948f119ae61ee35ad8584d666020c91581)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=3c20b5948f119ae61ee35ad8584d666020c91581)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=3c20b5948f119ae61ee35ad8584d666020c91581)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=3c20b5948f119ae61ee35ad8584d666020c91581)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Jeongjun Park <aha310510@gmail.com> | 2024-11-13 22:02:09 +0900 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-05 10:59:39 +0100 |
| commit | [3c20b5948f119ae61ee35ad8584d666020c91581](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=3c20b5948f119ae61ee35ad8584d666020c91581) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=3c20b5948f119ae61ee35ad8584d666020c91581)) | |
| tree | [bab722c8313be13a5590783079421ed54228bd58](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=3c20b5948f119ae61ee35ad8584d666020c91581) | |
| parent | [80cf84dd61babdf011dd79dbb8d4d85e1315a012](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=80cf84dd61babdf011dd79dbb8d4d85e1315a012) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=3c20b5948f119ae61ee35ad8584d666020c91581&id2=80cf84dd61babdf011dd79dbb8d4d85e1315a012)) | |
| download | [linux-3c20b5948f119ae61ee35ad8584d666020c91581.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-3c20b5948f119ae61ee35ad8584d666020c91581.tar.gz) | |

netfilter: ipset: add missing range check in bitmap\_ip\_uadtcommit 35f56c554eb1b56b77b3cf197a6b00922d49033d upstream.
When tb[IPSET\_ATTR\_IP\_TO] is not present but tb[IPSET\_ATTR\_CIDR] exists,
the values of ip and ip\_to are slightly swapped. Therefore, the range check
for ip should be done later, but this part is missing and it seems that the
vulnerability occurs.
So we should add missing range checks and remove unnecessary range checks.
Cc: <stable@vger.kernel.org>
Reported-by: syzbot+58c872f7790a4d2ac951@syzkaller.appspotmail.com
Fixes: 72205fc68bd1 ("netfilter: ipset: bitmap:ip set type support")
Signed-off-by: Jeongjun Park <aha310510@gmail.com>
Acked-by: Jozsef Kadlecsik <kadlec@blackhole.kfki.hu>
Signed-off-by: Pablo Neira Ayuso <pablo@netfilter.org>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=3c20b5948f119ae61ee35ad8584d666020c91581)

| -rw-r--r-- | [net/netfilter/ipset/ip\_set\_bitmap\_ip.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/netfilter/ipset/ip_set_bitmap_ip.c?id=3c20b5948f119ae61ee35ad8584d666020c91581) | 7 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 2 insertions, 5 deletions

| diff --git a/net/netfilter/ipset/ip\_set\_bitmap\_ip.c b/net/netfilter/ipset/ip\_set\_bitmap\_ip.cindex 1b9df64c62360a..b3ca8e87f62928 100644--- a/[net/netfilter/ipset/ip\_set\_bitmap\_ip.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/netfilter/ipset/ip_set_bitmap_ip.c?id=80cf84dd61babdf011dd79dbb8d4d85e1315a012)+++ b/[net/netfilter/ipset/ip\_set\_bitmap\_ip.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/netfilter/ipset/ip_set_bitmap_ip.c?id=3c20b5948f119ae61ee35ad8584d666020c91581)@@ -166,11 +166,8 @@ bitmap\_ip\_uadt(struct ip\_set \*set, struct nlattr \*tb[], ret = ip\_set\_get\_hostipaddr4(tb[IPSET\_ATTR\_IP\_TO], &ip\_to); if (ret) return ret;- if (ip > ip\_to) {+ if (ip > ip\_to) swap(ip, ip\_to);- if (ip < map->first\_ip)- return -IPSET\_ERR\_BITMAP\_RANGE;- } } else if (tb[IPSET\_ATTR\_CIDR]) { u8 cidr = nla\_get\_u8(tb[IPSET\_ATTR\_CIDR]); @@ -181,7 +178,7 @@ bitmap\_ip\_uadt(struct ip\_set \*set, struct nlattr \*tb[], ip\_to = ip; } - if (ip\_to > map->last\_ip)+ if (ip < map->first\_ip || ip\_to > map->last\_ip) return -IPSET\_ERR\_BITMAP\_RANGE;  for (; !before(ip\_to, ip); ip += map->hosts) { |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 20:25:38 +0000



=== Content from git.kernel.org_a930626a_20250114_202700.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=2e151b8ca31607d14fddc4ad0f14da0893e1a7c7)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=2e151b8ca31607d14fddc4ad0f14da0893e1a7c7)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=2e151b8ca31607d14fddc4ad0f14da0893e1a7c7)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=2e151b8ca31607d14fddc4ad0f14da0893e1a7c7)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Jeongjun Park <aha310510@gmail.com> | 2024-11-13 22:02:09 +0900 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-14 19:48:10 +0100 |
| commit | [2e151b8ca31607d14fddc4ad0f14da0893e1a7c7](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=2e151b8ca31607d14fddc4ad0f14da0893e1a7c7) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=2e151b8ca31607d14fddc4ad0f14da0893e1a7c7)) | |
| tree | [ad4affe6a4a6b049189f00011bfe6d95b3b4b290](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=2e151b8ca31607d14fddc4ad0f14da0893e1a7c7) | |
| parent | [fa0e202e23ff1ded146d338ed81cd2bcaac49925](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=fa0e202e23ff1ded146d338ed81cd2bcaac49925) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=2e151b8ca31607d14fddc4ad0f14da0893e1a7c7&id2=fa0e202e23ff1ded146d338ed81cd2bcaac49925)) | |
| download | [linux-2e151b8ca31607d14fddc4ad0f14da0893e1a7c7.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-2e151b8ca31607d14fddc4ad0f14da0893e1a7c7.tar.gz) | |

netfilter: ipset: add missing range check in bitmap\_ip\_uadtcommit 35f56c554eb1b56b77b3cf197a6b00922d49033d upstream.
When tb[IPSET\_ATTR\_IP\_TO] is not present but tb[IPSET\_ATTR\_CIDR] exists,
the values of ip and ip\_to are slightly swapped. Therefore, the range check
for ip should be done later, but this part is missing and it seems that the
vulnerability occurs.
So we should add missing range checks and remove unnecessary range checks.
Cc: <stable@vger.kernel.org>
Reported-by: syzbot+58c872f7790a4d2ac951@syzkaller.appspotmail.com
Fixes: 72205fc68bd1 ("netfilter: ipset: bitmap:ip set type support")
Signed-off-by: Jeongjun Park <aha310510@gmail.com>
Acked-by: Jozsef Kadlecsik <kadlec@blackhole.kfki.hu>
Signed-off-by: Pablo Neira Ayuso <pablo@netfilter.org>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=2e151b8ca31607d14fddc4ad0f14da0893e1a7c7)

| -rw-r--r-- | [net/netfilter/ipset/ip\_set\_bitmap\_ip.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/netfilter/ipset/ip_set_bitmap_ip.c?id=2e151b8ca31607d14fddc4ad0f14da0893e1a7c7) | 7 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 2 insertions, 5 deletions

| diff --git a/net/netfilter/ipset/ip\_set\_bitmap\_ip.c b/net/netfilter/ipset/ip\_set\_bitmap\_ip.cindex e4fa00abde6a2a..5988b9bb9029dc 100644--- a/[net/netfilter/ipset/ip\_set\_bitmap\_ip.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/netfilter/ipset/ip_set_bitmap_ip.c?id=fa0e202e23ff1ded146d338ed81cd2bcaac49925)+++ b/[net/netfilter/ipset/ip\_set\_bitmap\_ip.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/netfilter/ipset/ip_set_bitmap_ip.c?id=2e151b8ca31607d14fddc4ad0f14da0893e1a7c7)@@ -163,11 +163,8 @@ bitmap\_ip\_uadt(struct ip\_set \*set, struct nlattr \*tb[], ret = ip\_set\_get\_hostipaddr4(tb[IPSET\_ATTR\_IP\_TO], &ip\_to); if (ret) return ret;- if (ip > ip\_to) {+ if (ip > ip\_to) swap(ip, ip\_to);- if (ip < map->first\_ip)- return -IPSET\_ERR\_BITMAP\_RANGE;- } } else if (tb[IPSET\_ATTR\_CIDR]) { u8 cidr = nla\_get\_u8(tb[IPSET\_ATTR\_CIDR]); @@ -178,7 +175,7 @@ bitmap\_ip\_uadt(struct ip\_set \*set, struct nlattr \*tb[], ip\_to = ip; } - if (ip\_to > map->last\_ip)+ if (ip < map->first\_ip || ip\_to > map->last\_ip) return -IPSET\_ERR\_BITMAP\_RANGE;  for (; !before(ip\_to, ip); ip += map->hosts) { |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 20:25:37 +0000



=== Content from git.kernel.org_3ed18132_20250114_202700.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=35f56c554eb1b56b77b3cf197a6b00922d49033d)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=35f56c554eb1b56b77b3cf197a6b00922d49033d)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=35f56c554eb1b56b77b3cf197a6b00922d49033d)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=35f56c554eb1b56b77b3cf197a6b00922d49033d)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Jeongjun Park <aha310510@gmail.com> | 2024-11-13 22:02:09 +0900 |
| --- | --- | --- |
| committer | Pablo Neira Ayuso <pablo@netfilter.org> | 2024-11-14 13:47:26 +0100 |
| commit | [35f56c554eb1b56b77b3cf197a6b00922d49033d](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=35f56c554eb1b56b77b3cf197a6b00922d49033d) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=35f56c554eb1b56b77b3cf197a6b00922d49033d)) | |
| tree | [c665c48d31261c415f978d73078a530578b6b74d](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=35f56c554eb1b56b77b3cf197a6b00922d49033d) | |
| parent | [041bd1e4f2d82859690cd8b41c35f0f9404c3770](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=041bd1e4f2d82859690cd8b41c35f0f9404c3770) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=35f56c554eb1b56b77b3cf197a6b00922d49033d&id2=041bd1e4f2d82859690cd8b41c35f0f9404c3770)) | |
| download | [linux-35f56c554eb1b56b77b3cf197a6b00922d49033d.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-35f56c554eb1b56b77b3cf197a6b00922d49033d.tar.gz) | |

netfilter: ipset: add missing range check in bitmap\_ip\_uadtWhen tb[IPSET\_ATTR\_IP\_TO] is not present but tb[IPSET\_ATTR\_CIDR] exists,
the values of ip and ip\_to are slightly swapped. Therefore, the range check
for ip should be done later, but this part is missing and it seems that the
vulnerability occurs.
So we should add missing range checks and remove unnecessary range checks.
Cc: <stable@vger.kernel.org>
Reported-by: syzbot+58c872f7790a4d2ac951@syzkaller.appspotmail.com
Fixes: 72205fc68bd1 ("netfilter: ipset: bitmap:ip set type support")
Signed-off-by: Jeongjun Park <aha310510@gmail.com>
Acked-by: Jozsef Kadlecsik <kadlec@blackhole.kfki.hu>
Signed-off-by: Pablo Neira Ayuso <pablo@netfilter.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=35f56c554eb1b56b77b3cf197a6b00922d49033d)

| -rw-r--r-- | [net/netfilter/ipset/ip\_set\_bitmap\_ip.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/netfilter/ipset/ip_set_bitmap_ip.c?id=35f56c554eb1b56b77b3cf197a6b00922d49033d) | 7 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 2 insertions, 5 deletions

| diff --git a/net/netfilter/ipset/ip\_set\_bitmap\_ip.c b/net/netfilter/ipset/ip\_set\_bitmap\_ip.cindex e4fa00abde6a2a..5988b9bb9029dc 100644--- a/[net/netfilter/ipset/ip\_set\_bitmap\_ip.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/netfilter/ipset/ip_set_bitmap_ip.c?id=041bd1e4f2d82859690cd8b41c35f0f9404c3770)+++ b/[net/netfilter/ipset/ip\_set\_bitmap\_ip.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/netfilter/ipset/ip_set_bitmap_ip.c?id=35f56c554eb1b56b77b3cf197a6b00922d49033d)@@ -163,11 +163,8 @@ bitmap\_ip\_uadt(struct ip\_set \*set, struct nlattr \*tb[], ret = ip\_set\_get\_hostipaddr4(tb[IPSET\_ATTR\_IP\_TO], &ip\_to); if (ret) return ret;- if (ip > ip\_to) {+ if (ip > ip\_to) swap(ip, ip\_to);- if (ip < map->first\_ip)- return -IPSET\_ERR\_BITMAP\_RANGE;- } } else if (tb[IPSET\_ATTR\_CIDR]) { u8 cidr = nla\_get\_u8(tb[IPSET\_ATTR\_CIDR]); @@ -178,7 +175,7 @@ bitmap\_ip\_uadt(struct ip\_set \*set, struct nlattr \*tb[], ip\_to = ip; } - if (ip\_to > map->last\_ip)+ if (ip < map->first\_ip || ip\_to > map->last\_ip) return -IPSET\_ERR\_BITMAP\_RANGE;  for (; !before(ip\_to, ip); ip += map->hosts) { |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 20:25:37 +0000



=== Content from git.kernel.org_8a94e2f0_20250114_202706.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=e67471437ae9083fa73fa67eee1573fec1b7c8cf)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=e67471437ae9083fa73fa67eee1573fec1b7c8cf)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=e67471437ae9083fa73fa67eee1573fec1b7c8cf)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e67471437ae9083fa73fa67eee1573fec1b7c8cf)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Jeongjun Park <aha310510@gmail.com> | 2024-11-13 22:02:09 +0900 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-14 19:51:15 +0100 |
| commit | [e67471437ae9083fa73fa67eee1573fec1b7c8cf](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=e67471437ae9083fa73fa67eee1573fec1b7c8cf) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=e67471437ae9083fa73fa67eee1573fec1b7c8cf)) | |
| tree | [07c2eb24b8d9806c653e8a67eb70a844c098b4ef](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=e67471437ae9083fa73fa67eee1573fec1b7c8cf) | |
| parent | [9f2d8f3e813d356de15e842cea35e333bb53cfa5](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=9f2d8f3e813d356de15e842cea35e333bb53cfa5) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e67471437ae9083fa73fa67eee1573fec1b7c8cf&id2=9f2d8f3e813d356de15e842cea35e333bb53cfa5)) | |
| download | [linux-e67471437ae9083fa73fa67eee1573fec1b7c8cf.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-e67471437ae9083fa73fa67eee1573fec1b7c8cf.tar.gz) | |

netfilter: ipset: add missing range check in bitmap\_ip\_uadtcommit 35f56c554eb1b56b77b3cf197a6b00922d49033d upstream.
When tb[IPSET\_ATTR\_IP\_TO] is not present but tb[IPSET\_ATTR\_CIDR] exists,
the values of ip and ip\_to are slightly swapped. Therefore, the range check
for ip should be done later, but this part is missing and it seems that the
vulnerability occurs.
So we should add missing range checks and remove unnecessary range checks.
Cc: <stable@vger.kernel.org>
Reported-by: syzbot+58c872f7790a4d2ac951@syzkaller.appspotmail.com
Fixes: 72205fc68bd1 ("netfilter: ipset: bitmap:ip set type support")
Signed-off-by: Jeongjun Park <aha310510@gmail.com>
Acked-by: Jozsef Kadlecsik <kadlec@blackhole.kfki.hu>
Signed-off-by: Pablo Neira Ayuso <pablo@netfilter.org>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e67471437ae9083fa73fa67eee1573fec1b7c8cf)

| -rw-r--r-- | [net/netfilter/ipset/ip\_set\_bitmap\_ip.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/netfilter/ipset/ip_set_bitmap_ip.c?id=e67471437ae9083fa73fa67eee1573fec1b7c8cf) | 7 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 2 insertions, 5 deletions

| diff --git a/net/netfilter/ipset/ip\_set\_bitmap\_ip.c b/net/netfilter/ipset/ip\_set\_bitmap\_ip.cindex e4fa00abde6a2a..5988b9bb9029dc 100644--- a/[net/netfilter/ipset/ip\_set\_bitmap\_ip.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/netfilter/ipset/ip_set_bitmap_ip.c?id=9f2d8f3e813d356de15e842cea35e333bb53cfa5)+++ b/[net/netfilter/ipset/ip\_set\_bitmap\_ip.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/netfilter/ipset/ip_set_bitmap_ip.c?id=e67471437ae9083fa73fa67eee1573fec1b7c8cf)@@ -163,11 +163,8 @@ bitmap\_ip\_uadt(struct ip\_set \*set, struct nlattr \*tb[], ret = ip\_set\_get\_hostipaddr4(tb[IPSET\_ATTR\_IP\_TO], &ip\_to); if (ret) return ret;- if (ip > ip\_to) {+ if (ip > ip\_to) swap(ip, ip\_to);- if (ip < map->first\_ip)- return -IPSET\_ERR\_BITMAP\_RANGE;- } } else if (tb[IPSET\_ATTR\_CIDR]) { u8 cidr = nla\_get\_u8(tb[IPSET\_ATTR\_CIDR]); @@ -178,7 +175,7 @@ bitmap\_ip\_uadt(struct ip\_set \*set, struct nlattr \*tb[], ip\_to = ip; } - if (ip\_to > map->last\_ip)+ if (ip < map->first\_ip || ip\_to > map->last\_ip) return -IPSET\_ERR\_BITMAP\_RANGE;  for (; !before(ip\_to, ip); ip += map->hosts) { |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 20:25:43 +0000


