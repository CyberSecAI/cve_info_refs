=== Content from git.kernel.org_d8c24c15_20250114_232030.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=d43f1430d47c22a0727c05b6f156ed25fecdfeb4)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=d43f1430d47c22a0727c05b6f156ed25fecdfeb4)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=d43f1430d47c22a0727c05b6f156ed25fecdfeb4)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=d43f1430d47c22a0727c05b6f156ed25fecdfeb4)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Qun-Wei Lin <qun-wei.lin@mediatek.com> | 2024-10-25 16:58:11 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-11-17 15:06:26 +0100 |
| commit | [d43f1430d47c22a0727c05b6f156ed25fecdfeb4](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=d43f1430d47c22a0727c05b6f156ed25fecdfeb4) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=d43f1430d47c22a0727c05b6f156ed25fecdfeb4)) | |
| tree | [cd4db8cc9f9bf18befa421e5e50987549a6d7c83](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=d43f1430d47c22a0727c05b6f156ed25fecdfeb4) | |
| parent | [97ed7ff58de66c544692b3c2b988f3f594348de0](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=97ed7ff58de66c544692b3c2b988f3f594348de0) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=d43f1430d47c22a0727c05b6f156ed25fecdfeb4&id2=97ed7ff58de66c544692b3c2b988f3f594348de0)) | |
| download | [linux-d43f1430d47c22a0727c05b6f156ed25fecdfeb4.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-d43f1430d47c22a0727c05b6f156ed25fecdfeb4.tar.gz) | |

mm: krealloc: Fix MTE false alarm in \_\_do\_krealloccommit 704573851b51808b45dae2d62059d1d8189138a2 upstream.
This patch addresses an issue introduced by commit 1a83a716ec233 ("mm:
krealloc: consider spare memory for \_\_GFP\_ZERO") which causes MTE
(Memory Tagging Extension) to falsely report a slab-out-of-bounds error.
The problem occurs when zeroing out spare memory in \_\_do\_krealloc. The
original code only considered software-based KASAN and did not account
for MTE. It does not reset the KASAN tag before calling memset, leading
to a mismatch between the pointer tag and the memory tag, resulting
in a false positive.
Example of the error:
==================================================================
swapper/0: BUG: KASAN: slab-out-of-bounds in \_\_memset+0x84/0x188
swapper/0: Write at addr f4ffff8005f0fdf0 by task swapper/0/1
swapper/0: Pointer tag: [f4], memory tag: [fe]
swapper/0:
swapper/0: CPU: 4 UID: 0 PID: 1 Comm: swapper/0 Not tainted 6.12.
swapper/0: Hardware name: MT6991(ENG) (DT)
swapper/0: Call trace:
swapper/0: dump\_backtrace+0xfc/0x17c
swapper/0: show\_stack+0x18/0x28
swapper/0: dump\_stack\_lvl+0x40/0xa0
swapper/0: print\_report+0x1b8/0x71c
swapper/0: kasan\_report+0xec/0x14c
swapper/0: \_\_do\_kernel\_fault+0x60/0x29c
swapper/0: do\_bad\_area+0x30/0xdc
swapper/0: do\_tag\_check\_fault+0x20/0x34
swapper/0: do\_mem\_abort+0x58/0x104
swapper/0: el1\_abort+0x3c/0x5c
swapper/0: el1h\_64\_sync\_handler+0x80/0xcc
swapper/0: el1h\_64\_sync+0x68/0x6c
swapper/0: \_\_memset+0x84/0x188
swapper/0: btf\_populate\_kfunc\_set+0x280/0x3d8
swapper/0: \_\_register\_btf\_kfunc\_id\_set+0x43c/0x468
swapper/0: register\_btf\_kfunc\_id\_set+0x48/0x60
swapper/0: register\_nf\_nat\_bpf+0x1c/0x40
swapper/0: nf\_nat\_init+0xc0/0x128
swapper/0: do\_one\_initcall+0x184/0x464
swapper/0: do\_initcall\_level+0xdc/0x1b0
swapper/0: do\_initcalls+0x70/0xc0
swapper/0: do\_basic\_setup+0x1c/0x28
swapper/0: kernel\_init\_freeable+0x144/0x1b8
swapper/0: kernel\_init+0x20/0x1a8
swapper/0: ret\_from\_fork+0x10/0x20
==================================================================
Fixes: 1a83a716ec233 ("mm: krealloc: consider spare memory for \_\_GFP\_ZERO")
Signed-off-by: Qun-Wei Lin <qun-wei.lin@mediatek.com>
Acked-by: David Rientjes <rientjes@google.com>
Signed-off-by: Vlastimil Babka <vbabka@suse.cz>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=d43f1430d47c22a0727c05b6f156ed25fecdfeb4)

| -rw-r--r-- | [mm/slab\_common.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/mm/slab_common.c?id=d43f1430d47c22a0727c05b6f156ed25fecdfeb4) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 1 deletions

| diff --git a/mm/slab\_common.c b/mm/slab\_common.cindex 3173c8a1790464..f684b06649c3ee 100644--- a/[mm/slab\_common.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/mm/slab_common.c?id=97ed7ff58de66c544692b3c2b988f3f594348de0)+++ b/[mm/slab\_common.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/mm/slab_common.c?id=d43f1430d47c22a0727c05b6f156ed25fecdfeb4)@@ -1213,7 +1213,7 @@ static \_\_always\_inline void \*\_\_do\_krealloc(const void \*p, size\_t new\_size, /\* Zero out spare memory. \*/ if (want\_init\_on\_alloc(flags)) { kasan\_disable\_current();- memset((void \*)p + new\_size, 0, ks - new\_size);+ memset(kasan\_reset\_tag(p) + new\_size, 0, ks - new\_size); kasan\_enable\_current(); } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 23:19:07 +0000



=== Content from git.kernel.org_ac7b7494_20250114_232026.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=486aeb5f1855c75dd810c25036134961bd2a6722)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=486aeb5f1855c75dd810c25036134961bd2a6722)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=486aeb5f1855c75dd810c25036134961bd2a6722)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=486aeb5f1855c75dd810c25036134961bd2a6722)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Qun-Wei Lin <qun-wei.lin@mediatek.com> | 2024-10-25 16:58:11 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-11-17 15:07:22 +0100 |
| commit | [486aeb5f1855c75dd810c25036134961bd2a6722](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=486aeb5f1855c75dd810c25036134961bd2a6722) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=486aeb5f1855c75dd810c25036134961bd2a6722)) | |
| tree | [6246d92cc509a2b415cbfecf146b107ba27bab35](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=486aeb5f1855c75dd810c25036134961bd2a6722) | |
| parent | [b22346eec479a30bfa4a02ad2c551b54809694d0](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=b22346eec479a30bfa4a02ad2c551b54809694d0) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=486aeb5f1855c75dd810c25036134961bd2a6722&id2=b22346eec479a30bfa4a02ad2c551b54809694d0)) | |
| download | [linux-486aeb5f1855c75dd810c25036134961bd2a6722.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-486aeb5f1855c75dd810c25036134961bd2a6722.tar.gz) | |

mm: krealloc: Fix MTE false alarm in \_\_do\_krealloccommit 704573851b51808b45dae2d62059d1d8189138a2 upstream.
This patch addresses an issue introduced by commit 1a83a716ec233 ("mm:
krealloc: consider spare memory for \_\_GFP\_ZERO") which causes MTE
(Memory Tagging Extension) to falsely report a slab-out-of-bounds error.
The problem occurs when zeroing out spare memory in \_\_do\_krealloc. The
original code only considered software-based KASAN and did not account
for MTE. It does not reset the KASAN tag before calling memset, leading
to a mismatch between the pointer tag and the memory tag, resulting
in a false positive.
Example of the error:
==================================================================
swapper/0: BUG: KASAN: slab-out-of-bounds in \_\_memset+0x84/0x188
swapper/0: Write at addr f4ffff8005f0fdf0 by task swapper/0/1
swapper/0: Pointer tag: [f4], memory tag: [fe]
swapper/0:
swapper/0: CPU: 4 UID: 0 PID: 1 Comm: swapper/0 Not tainted 6.12.
swapper/0: Hardware name: MT6991(ENG) (DT)
swapper/0: Call trace:
swapper/0: dump\_backtrace+0xfc/0x17c
swapper/0: show\_stack+0x18/0x28
swapper/0: dump\_stack\_lvl+0x40/0xa0
swapper/0: print\_report+0x1b8/0x71c
swapper/0: kasan\_report+0xec/0x14c
swapper/0: \_\_do\_kernel\_fault+0x60/0x29c
swapper/0: do\_bad\_area+0x30/0xdc
swapper/0: do\_tag\_check\_fault+0x20/0x34
swapper/0: do\_mem\_abort+0x58/0x104
swapper/0: el1\_abort+0x3c/0x5c
swapper/0: el1h\_64\_sync\_handler+0x80/0xcc
swapper/0: el1h\_64\_sync+0x68/0x6c
swapper/0: \_\_memset+0x84/0x188
swapper/0: btf\_populate\_kfunc\_set+0x280/0x3d8
swapper/0: \_\_register\_btf\_kfunc\_id\_set+0x43c/0x468
swapper/0: register\_btf\_kfunc\_id\_set+0x48/0x60
swapper/0: register\_nf\_nat\_bpf+0x1c/0x40
swapper/0: nf\_nat\_init+0xc0/0x128
swapper/0: do\_one\_initcall+0x184/0x464
swapper/0: do\_initcall\_level+0xdc/0x1b0
swapper/0: do\_initcalls+0x70/0xc0
swapper/0: do\_basic\_setup+0x1c/0x28
swapper/0: kernel\_init\_freeable+0x144/0x1b8
swapper/0: kernel\_init+0x20/0x1a8
swapper/0: ret\_from\_fork+0x10/0x20
==================================================================
Fixes: 1a83a716ec233 ("mm: krealloc: consider spare memory for \_\_GFP\_ZERO")
Signed-off-by: Qun-Wei Lin <qun-wei.lin@mediatek.com>
Acked-by: David Rientjes <rientjes@google.com>
Signed-off-by: Vlastimil Babka <vbabka@suse.cz>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=486aeb5f1855c75dd810c25036134961bd2a6722)

| -rw-r--r-- | [mm/slab\_common.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/mm/slab_common.c?id=486aeb5f1855c75dd810c25036134961bd2a6722) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 1 deletions

| diff --git a/mm/slab\_common.c b/mm/slab\_common.cindex a14d655bddc680..d89e0846cb1687 100644--- a/[mm/slab\_common.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/mm/slab_common.c?id=b22346eec479a30bfa4a02ad2c551b54809694d0)+++ b/[mm/slab\_common.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/mm/slab_common.c?id=486aeb5f1855c75dd810c25036134961bd2a6722)@@ -1325,7 +1325,7 @@ \_\_do\_krealloc(const void \*p, size\_t new\_size, gfp\_t flags) /\* Zero out spare memory. \*/ if (want\_init\_on\_alloc(flags)) { kasan\_disable\_current();- memset((void \*)p + new\_size, 0, ks - new\_size);+ memset(kasan\_reset\_tag(p) + new\_size, 0, ks - new\_size); kasan\_enable\_current(); } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 23:19:04 +0000



=== Content from git.kernel.org_b68f1617_20250114_232028.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=71548fada7ee0eb50cc6ccda82dff010c745f92c)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=71548fada7ee0eb50cc6ccda82dff010c745f92c)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=71548fada7ee0eb50cc6ccda82dff010c745f92c)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=71548fada7ee0eb50cc6ccda82dff010c745f92c)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Qun-Wei Lin <qun-wei.lin@mediatek.com> | 2024-10-25 16:58:11 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-11-17 15:08:58 +0100 |
| commit | [71548fada7ee0eb50cc6ccda82dff010c745f92c](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=71548fada7ee0eb50cc6ccda82dff010c745f92c) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=71548fada7ee0eb50cc6ccda82dff010c745f92c)) | |
| tree | [d886651248041ca0ac618e4dd1c2ad3650f10ca9](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=71548fada7ee0eb50cc6ccda82dff010c745f92c) | |
| parent | [950ac86cff338ab56e2eaf611f4936ee34893b63](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=950ac86cff338ab56e2eaf611f4936ee34893b63) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=71548fada7ee0eb50cc6ccda82dff010c745f92c&id2=950ac86cff338ab56e2eaf611f4936ee34893b63)) | |
| download | [linux-71548fada7ee0eb50cc6ccda82dff010c745f92c.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-71548fada7ee0eb50cc6ccda82dff010c745f92c.tar.gz) | |

mm: krealloc: Fix MTE false alarm in \_\_do\_krealloccommit 704573851b51808b45dae2d62059d1d8189138a2 upstream.
This patch addresses an issue introduced by commit 1a83a716ec233 ("mm:
krealloc: consider spare memory for \_\_GFP\_ZERO") which causes MTE
(Memory Tagging Extension) to falsely report a slab-out-of-bounds error.
The problem occurs when zeroing out spare memory in \_\_do\_krealloc. The
original code only considered software-based KASAN and did not account
for MTE. It does not reset the KASAN tag before calling memset, leading
to a mismatch between the pointer tag and the memory tag, resulting
in a false positive.
Example of the error:
==================================================================
swapper/0: BUG: KASAN: slab-out-of-bounds in \_\_memset+0x84/0x188
swapper/0: Write at addr f4ffff8005f0fdf0 by task swapper/0/1
swapper/0: Pointer tag: [f4], memory tag: [fe]
swapper/0:
swapper/0: CPU: 4 UID: 0 PID: 1 Comm: swapper/0 Not tainted 6.12.
swapper/0: Hardware name: MT6991(ENG) (DT)
swapper/0: Call trace:
swapper/0: dump\_backtrace+0xfc/0x17c
swapper/0: show\_stack+0x18/0x28
swapper/0: dump\_stack\_lvl+0x40/0xa0
swapper/0: print\_report+0x1b8/0x71c
swapper/0: kasan\_report+0xec/0x14c
swapper/0: \_\_do\_kernel\_fault+0x60/0x29c
swapper/0: do\_bad\_area+0x30/0xdc
swapper/0: do\_tag\_check\_fault+0x20/0x34
swapper/0: do\_mem\_abort+0x58/0x104
swapper/0: el1\_abort+0x3c/0x5c
swapper/0: el1h\_64\_sync\_handler+0x80/0xcc
swapper/0: el1h\_64\_sync+0x68/0x6c
swapper/0: \_\_memset+0x84/0x188
swapper/0: btf\_populate\_kfunc\_set+0x280/0x3d8
swapper/0: \_\_register\_btf\_kfunc\_id\_set+0x43c/0x468
swapper/0: register\_btf\_kfunc\_id\_set+0x48/0x60
swapper/0: register\_nf\_nat\_bpf+0x1c/0x40
swapper/0: nf\_nat\_init+0xc0/0x128
swapper/0: do\_one\_initcall+0x184/0x464
swapper/0: do\_initcall\_level+0xdc/0x1b0
swapper/0: do\_initcalls+0x70/0xc0
swapper/0: do\_basic\_setup+0x1c/0x28
swapper/0: kernel\_init\_freeable+0x144/0x1b8
swapper/0: kernel\_init+0x20/0x1a8
swapper/0: ret\_from\_fork+0x10/0x20
==================================================================
Fixes: 1a83a716ec233 ("mm: krealloc: consider spare memory for \_\_GFP\_ZERO")
Signed-off-by: Qun-Wei Lin <qun-wei.lin@mediatek.com>
Acked-by: David Rientjes <rientjes@google.com>
Signed-off-by: Vlastimil Babka <vbabka@suse.cz>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=71548fada7ee0eb50cc6ccda82dff010c745f92c)

| -rw-r--r-- | [mm/slab\_common.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/mm/slab_common.c?id=71548fada7ee0eb50cc6ccda82dff010c745f92c) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 1 deletions

| diff --git a/mm/slab\_common.c b/mm/slab\_common.cindex ef971fcdaa0708..2e2b43fae2c3f8 100644--- a/[mm/slab\_common.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/mm/slab_common.c?id=950ac86cff338ab56e2eaf611f4936ee34893b63)+++ b/[mm/slab\_common.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/mm/slab_common.c?id=71548fada7ee0eb50cc6ccda82dff010c745f92c)@@ -1391,7 +1391,7 @@ \_\_do\_krealloc(const void \*p, size\_t new\_size, gfp\_t flags) /\* Zero out spare memory. \*/ if (want\_init\_on\_alloc(flags)) { kasan\_disable\_current();- memset((void \*)p + new\_size, 0, ks - new\_size);+ memset(kasan\_reset\_tag(p) + new\_size, 0, ks - new\_size); kasan\_enable\_current(); } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 23:19:05 +0000



=== Content from git.kernel.org_ad94f3a3_20250114_232029.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=d02492863023431c31f85d570f718433c22b9311)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=d02492863023431c31f85d570f718433c22b9311)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=d02492863023431c31f85d570f718433c22b9311)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=d02492863023431c31f85d570f718433c22b9311)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Qun-Wei Lin <qun-wei.lin@mediatek.com> | 2024-10-25 16:58:11 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-11-17 14:59:40 +0100 |
| commit | [d02492863023431c31f85d570f718433c22b9311](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=d02492863023431c31f85d570f718433c22b9311) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=d02492863023431c31f85d570f718433c22b9311)) | |
| tree | [a901044b11ae7fef72218e448285a1104ef513bd](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=d02492863023431c31f85d570f718433c22b9311) | |
| parent | [b17397a0a5c56e111f61cb5b77d162664dc00de9](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=b17397a0a5c56e111f61cb5b77d162664dc00de9) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=d02492863023431c31f85d570f718433c22b9311&id2=b17397a0a5c56e111f61cb5b77d162664dc00de9)) | |
| download | [linux-d02492863023431c31f85d570f718433c22b9311.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-d02492863023431c31f85d570f718433c22b9311.tar.gz) | |

mm: krealloc: Fix MTE false alarm in \_\_do\_krealloccommit 704573851b51808b45dae2d62059d1d8189138a2 upstream.
This patch addresses an issue introduced by commit 1a83a716ec233 ("mm:
krealloc: consider spare memory for \_\_GFP\_ZERO") which causes MTE
(Memory Tagging Extension) to falsely report a slab-out-of-bounds error.
The problem occurs when zeroing out spare memory in \_\_do\_krealloc. The
original code only considered software-based KASAN and did not account
for MTE. It does not reset the KASAN tag before calling memset, leading
to a mismatch between the pointer tag and the memory tag, resulting
in a false positive.
Example of the error:
==================================================================
swapper/0: BUG: KASAN: slab-out-of-bounds in \_\_memset+0x84/0x188
swapper/0: Write at addr f4ffff8005f0fdf0 by task swapper/0/1
swapper/0: Pointer tag: [f4], memory tag: [fe]
swapper/0:
swapper/0: CPU: 4 UID: 0 PID: 1 Comm: swapper/0 Not tainted 6.12.
swapper/0: Hardware name: MT6991(ENG) (DT)
swapper/0: Call trace:
swapper/0: dump\_backtrace+0xfc/0x17c
swapper/0: show\_stack+0x18/0x28
swapper/0: dump\_stack\_lvl+0x40/0xa0
swapper/0: print\_report+0x1b8/0x71c
swapper/0: kasan\_report+0xec/0x14c
swapper/0: \_\_do\_kernel\_fault+0x60/0x29c
swapper/0: do\_bad\_area+0x30/0xdc
swapper/0: do\_tag\_check\_fault+0x20/0x34
swapper/0: do\_mem\_abort+0x58/0x104
swapper/0: el1\_abort+0x3c/0x5c
swapper/0: el1h\_64\_sync\_handler+0x80/0xcc
swapper/0: el1h\_64\_sync+0x68/0x6c
swapper/0: \_\_memset+0x84/0x188
swapper/0: btf\_populate\_kfunc\_set+0x280/0x3d8
swapper/0: \_\_register\_btf\_kfunc\_id\_set+0x43c/0x468
swapper/0: register\_btf\_kfunc\_id\_set+0x48/0x60
swapper/0: register\_nf\_nat\_bpf+0x1c/0x40
swapper/0: nf\_nat\_init+0xc0/0x128
swapper/0: do\_one\_initcall+0x184/0x464
swapper/0: do\_initcall\_level+0xdc/0x1b0
swapper/0: do\_initcalls+0x70/0xc0
swapper/0: do\_basic\_setup+0x1c/0x28
swapper/0: kernel\_init\_freeable+0x144/0x1b8
swapper/0: kernel\_init+0x20/0x1a8
swapper/0: ret\_from\_fork+0x10/0x20
==================================================================
Fixes: 1a83a716ec233 ("mm: krealloc: consider spare memory for \_\_GFP\_ZERO")
Signed-off-by: Qun-Wei Lin <qun-wei.lin@mediatek.com>
Acked-by: David Rientjes <rientjes@google.com>
Signed-off-by: Vlastimil Babka <vbabka@suse.cz>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=d02492863023431c31f85d570f718433c22b9311)

| -rw-r--r-- | [mm/slab\_common.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/mm/slab_common.c?id=d02492863023431c31f85d570f718433c22b9311) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 1 deletions

| diff --git a/mm/slab\_common.c b/mm/slab\_common.cindex 2faea1ecd8116f..c034b2a3d49ef4 100644--- a/[mm/slab\_common.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/mm/slab_common.c?id=b17397a0a5c56e111f61cb5b77d162664dc00de9)+++ b/[mm/slab\_common.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/mm/slab_common.c?id=d02492863023431c31f85d570f718433c22b9311)@@ -1075,7 +1075,7 @@ static \_\_always\_inline void \*\_\_do\_krealloc(const void \*p, size\_t new\_size, /\* Zero out spare memory. \*/ if (want\_init\_on\_alloc(flags)) { kasan\_disable\_current();- memset((void \*)p + new\_size, 0, ks - new\_size);+ memset(kasan\_reset\_tag(p) + new\_size, 0, ks - new\_size); kasan\_enable\_current(); } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 23:19:06 +0000



=== Content from git.kernel.org_8a9e9c85_20250114_232026.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=3dfb40da84f26dd35dd9bbaf626a2424565b8406)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=3dfb40da84f26dd35dd9bbaf626a2424565b8406)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=3dfb40da84f26dd35dd9bbaf626a2424565b8406)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=3dfb40da84f26dd35dd9bbaf626a2424565b8406)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Qun-Wei Lin <qun-wei.lin@mediatek.com> | 2024-10-25 16:58:11 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-11-17 15:09:55 +0100 |
| commit | [3dfb40da84f26dd35dd9bbaf626a2424565b8406](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=3dfb40da84f26dd35dd9bbaf626a2424565b8406) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=3dfb40da84f26dd35dd9bbaf626a2424565b8406)) | |
| tree | [17e65abc41b9c43cfe143c6ee4f766913c8c1b6a](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=3dfb40da84f26dd35dd9bbaf626a2424565b8406) | |
| parent | [7d19d9eeefaf01f52c1e11f8b2a142bf4c4ac4e4](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=7d19d9eeefaf01f52c1e11f8b2a142bf4c4ac4e4) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=3dfb40da84f26dd35dd9bbaf626a2424565b8406&id2=7d19d9eeefaf01f52c1e11f8b2a142bf4c4ac4e4)) | |
| download | [linux-3dfb40da84f26dd35dd9bbaf626a2424565b8406.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-3dfb40da84f26dd35dd9bbaf626a2424565b8406.tar.gz) | |

mm: krealloc: Fix MTE false alarm in \_\_do\_krealloccommit 704573851b51808b45dae2d62059d1d8189138a2 upstream.
This patch addresses an issue introduced by commit 1a83a716ec233 ("mm:
krealloc: consider spare memory for \_\_GFP\_ZERO") which causes MTE
(Memory Tagging Extension) to falsely report a slab-out-of-bounds error.
The problem occurs when zeroing out spare memory in \_\_do\_krealloc. The
original code only considered software-based KASAN and did not account
for MTE. It does not reset the KASAN tag before calling memset, leading
to a mismatch between the pointer tag and the memory tag, resulting
in a false positive.
Example of the error:
==================================================================
swapper/0: BUG: KASAN: slab-out-of-bounds in \_\_memset+0x84/0x188
swapper/0: Write at addr f4ffff8005f0fdf0 by task swapper/0/1
swapper/0: Pointer tag: [f4], memory tag: [fe]
swapper/0:
swapper/0: CPU: 4 UID: 0 PID: 1 Comm: swapper/0 Not tainted 6.12.
swapper/0: Hardware name: MT6991(ENG) (DT)
swapper/0: Call trace:
swapper/0: dump\_backtrace+0xfc/0x17c
swapper/0: show\_stack+0x18/0x28
swapper/0: dump\_stack\_lvl+0x40/0xa0
swapper/0: print\_report+0x1b8/0x71c
swapper/0: kasan\_report+0xec/0x14c
swapper/0: \_\_do\_kernel\_fault+0x60/0x29c
swapper/0: do\_bad\_area+0x30/0xdc
swapper/0: do\_tag\_check\_fault+0x20/0x34
swapper/0: do\_mem\_abort+0x58/0x104
swapper/0: el1\_abort+0x3c/0x5c
swapper/0: el1h\_64\_sync\_handler+0x80/0xcc
swapper/0: el1h\_64\_sync+0x68/0x6c
swapper/0: \_\_memset+0x84/0x188
swapper/0: btf\_populate\_kfunc\_set+0x280/0x3d8
swapper/0: \_\_register\_btf\_kfunc\_id\_set+0x43c/0x468
swapper/0: register\_btf\_kfunc\_id\_set+0x48/0x60
swapper/0: register\_nf\_nat\_bpf+0x1c/0x40
swapper/0: nf\_nat\_init+0xc0/0x128
swapper/0: do\_one\_initcall+0x184/0x464
swapper/0: do\_initcall\_level+0xdc/0x1b0
swapper/0: do\_initcalls+0x70/0xc0
swapper/0: do\_basic\_setup+0x1c/0x28
swapper/0: kernel\_init\_freeable+0x144/0x1b8
swapper/0: kernel\_init+0x20/0x1a8
swapper/0: ret\_from\_fork+0x10/0x20
==================================================================
Fixes: 1a83a716ec233 ("mm: krealloc: consider spare memory for \_\_GFP\_ZERO")
Signed-off-by: Qun-Wei Lin <qun-wei.lin@mediatek.com>
Acked-by: David Rientjes <rientjes@google.com>
Signed-off-by: Vlastimil Babka <vbabka@suse.cz>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=3dfb40da84f26dd35dd9bbaf626a2424565b8406)

| -rw-r--r-- | [mm/slab\_common.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/mm/slab_common.c?id=3dfb40da84f26dd35dd9bbaf626a2424565b8406) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 1 deletions

| diff --git a/mm/slab\_common.c b/mm/slab\_common.cindex cf70eda8895650..f320b0da8a5848 100644--- a/[mm/slab\_common.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/mm/slab_common.c?id=7d19d9eeefaf01f52c1e11f8b2a142bf4c4ac4e4)+++ b/[mm/slab\_common.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/mm/slab_common.c?id=3dfb40da84f26dd35dd9bbaf626a2424565b8406)@@ -1285,7 +1285,7 @@ \_\_do\_krealloc(const void \*p, size\_t new\_size, gfp\_t flags) /\* Zero out spare memory. \*/ if (want\_init\_on\_alloc(flags)) { kasan\_disable\_current();- memset((void \*)p + new\_size, 0, ks - new\_size);+ memset(kasan\_reset\_tag(p) + new\_size, 0, ks - new\_size); kasan\_enable\_current(); } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 23:19:03 +0000



=== Content from git.kernel.org_fc284338_20250114_232028.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=8ebee7565effdeae6085458f8f8463363120a871)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=8ebee7565effdeae6085458f8f8463363120a871)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=8ebee7565effdeae6085458f8f8463363120a871)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=8ebee7565effdeae6085458f8f8463363120a871)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Qun-Wei Lin <qun-wei.lin@mediatek.com> | 2024-10-25 16:58:11 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-11-08 16:20:54 +0100 |
| commit | [8ebee7565effdeae6085458f8f8463363120a871](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=8ebee7565effdeae6085458f8f8463363120a871) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=8ebee7565effdeae6085458f8f8463363120a871)) | |
| tree | [7c4a66d5b328a4ddbc0bfce5351295761d229eb9](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=8ebee7565effdeae6085458f8f8463363120a871) | |
| parent | [c6ab967946b1df99cb3170e0c66627d26628cbdc](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=c6ab967946b1df99cb3170e0c66627d26628cbdc) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=8ebee7565effdeae6085458f8f8463363120a871&id2=c6ab967946b1df99cb3170e0c66627d26628cbdc)) | |
| download | [linux-8ebee7565effdeae6085458f8f8463363120a871.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-8ebee7565effdeae6085458f8f8463363120a871.tar.gz) | |

mm: krealloc: Fix MTE false alarm in \_\_do\_krealloccommit 704573851b51808b45dae2d62059d1d8189138a2 upstream.
This patch addresses an issue introduced by commit 1a83a716ec233 ("mm:
krealloc: consider spare memory for \_\_GFP\_ZERO") which causes MTE
(Memory Tagging Extension) to falsely report a slab-out-of-bounds error.
The problem occurs when zeroing out spare memory in \_\_do\_krealloc. The
original code only considered software-based KASAN and did not account
for MTE. It does not reset the KASAN tag before calling memset, leading
to a mismatch between the pointer tag and the memory tag, resulting
in a false positive.
Example of the error:
==================================================================
swapper/0: BUG: KASAN: slab-out-of-bounds in \_\_memset+0x84/0x188
swapper/0: Write at addr f4ffff8005f0fdf0 by task swapper/0/1
swapper/0: Pointer tag: [f4], memory tag: [fe]
swapper/0:
swapper/0: CPU: 4 UID: 0 PID: 1 Comm: swapper/0 Not tainted 6.12.
swapper/0: Hardware name: MT6991(ENG) (DT)
swapper/0: Call trace:
swapper/0: dump\_backtrace+0xfc/0x17c
swapper/0: show\_stack+0x18/0x28
swapper/0: dump\_stack\_lvl+0x40/0xa0
swapper/0: print\_report+0x1b8/0x71c
swapper/0: kasan\_report+0xec/0x14c
swapper/0: \_\_do\_kernel\_fault+0x60/0x29c
swapper/0: do\_bad\_area+0x30/0xdc
swapper/0: do\_tag\_check\_fault+0x20/0x34
swapper/0: do\_mem\_abort+0x58/0x104
swapper/0: el1\_abort+0x3c/0x5c
swapper/0: el1h\_64\_sync\_handler+0x80/0xcc
swapper/0: el1h\_64\_sync+0x68/0x6c
swapper/0: \_\_memset+0x84/0x188
swapper/0: btf\_populate\_kfunc\_set+0x280/0x3d8
swapper/0: \_\_register\_btf\_kfunc\_id\_set+0x43c/0x468
swapper/0: register\_btf\_kfunc\_id\_set+0x48/0x60
swapper/0: register\_nf\_nat\_bpf+0x1c/0x40
swapper/0: nf\_nat\_init+0xc0/0x128
swapper/0: do\_one\_initcall+0x184/0x464
swapper/0: do\_initcall\_level+0xdc/0x1b0
swapper/0: do\_initcalls+0x70/0xc0
swapper/0: do\_basic\_setup+0x1c/0x28
swapper/0: kernel\_init\_freeable+0x144/0x1b8
swapper/0: kernel\_init+0x20/0x1a8
swapper/0: ret\_from\_fork+0x10/0x20
==================================================================
Fixes: 1a83a716ec233 ("mm: krealloc: consider spare memory for \_\_GFP\_ZERO")
Signed-off-by: Qun-Wei Lin <qun-wei.lin@mediatek.com>
Acked-by: David Rientjes <rientjes@google.com>
Signed-off-by: Vlastimil Babka <vbabka@suse.cz>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=8ebee7565effdeae6085458f8f8463363120a871)

| -rw-r--r-- | [mm/slab\_common.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/mm/slab_common.c?id=8ebee7565effdeae6085458f8f8463363120a871) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 1 deletions

| diff --git a/mm/slab\_common.c b/mm/slab\_common.cindex c5aacb359de3b5..dfe060a74c820f 100644--- a/[mm/slab\_common.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/mm/slab_common.c?id=c6ab967946b1df99cb3170e0c66627d26628cbdc)+++ b/[mm/slab\_common.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/mm/slab_common.c?id=8ebee7565effdeae6085458f8f8463363120a871)@@ -1683,7 +1683,7 @@ static \_\_always\_inline void \*\_\_do\_krealloc(const void \*p, size\_t new\_size, /\* Zero out spare memory. \*/ if (want\_init\_on\_alloc(flags)) { kasan\_disable\_current();- memset((void \*)p + new\_size, 0, ks - new\_size);+ memset(kasan\_reset\_tag(p) + new\_size, 0, ks - new\_size); kasan\_enable\_current(); } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 23:19:05 +0000



=== Content from git.kernel.org_d8e2ad0a_20250114_232027.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=704573851b51808b45dae2d62059d1d8189138a2)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=704573851b51808b45dae2d62059d1d8189138a2)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=704573851b51808b45dae2d62059d1d8189138a2)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=704573851b51808b45dae2d62059d1d8189138a2)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Qun-Wei Lin <qun-wei.lin@mediatek.com> | 2024-10-25 16:58:11 +0800 |
| --- | --- | --- |
| committer | Vlastimil Babka <vbabka@suse.cz> | 2024-10-29 10:40:53 +0100 |
| commit | [704573851b51808b45dae2d62059d1d8189138a2](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=704573851b51808b45dae2d62059d1d8189138a2) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=704573851b51808b45dae2d62059d1d8189138a2)) | |
| tree | [d619dd2cf99243f2cb5e72d515777032c21ea00c](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=704573851b51808b45dae2d62059d1d8189138a2) | |
| parent | [2b059d0d1e624adc6e69a754bc48057f8bf459dc](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=2b059d0d1e624adc6e69a754bc48057f8bf459dc) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=704573851b51808b45dae2d62059d1d8189138a2&id2=2b059d0d1e624adc6e69a754bc48057f8bf459dc)) | |
| download | [linux-704573851b51808b45dae2d62059d1d8189138a2.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-704573851b51808b45dae2d62059d1d8189138a2.tar.gz) | |

mm: krealloc: Fix MTE false alarm in \_\_do\_kreallocThis patch addresses an issue introduced by commit 1a83a716ec233 ("mm:
krealloc: consider spare memory for \_\_GFP\_ZERO") which causes MTE
(Memory Tagging Extension) to falsely report a slab-out-of-bounds error.
The problem occurs when zeroing out spare memory in \_\_do\_krealloc. The
original code only considered software-based KASAN and did not account
for MTE. It does not reset the KASAN tag before calling memset, leading
to a mismatch between the pointer tag and the memory tag, resulting
in a false positive.
Example of the error:
==================================================================
swapper/0: BUG: KASAN: slab-out-of-bounds in \_\_memset+0x84/0x188
swapper/0: Write at addr f4ffff8005f0fdf0 by task swapper/0/1
swapper/0: Pointer tag: [f4], memory tag: [fe]
swapper/0:
swapper/0: CPU: 4 UID: 0 PID: 1 Comm: swapper/0 Not tainted 6.12.
swapper/0: Hardware name: MT6991(ENG) (DT)
swapper/0: Call trace:
swapper/0: dump\_backtrace+0xfc/0x17c
swapper/0: show\_stack+0x18/0x28
swapper/0: dump\_stack\_lvl+0x40/0xa0
swapper/0: print\_report+0x1b8/0x71c
swapper/0: kasan\_report+0xec/0x14c
swapper/0: \_\_do\_kernel\_fault+0x60/0x29c
swapper/0: do\_bad\_area+0x30/0xdc
swapper/0: do\_tag\_check\_fault+0x20/0x34
swapper/0: do\_mem\_abort+0x58/0x104
swapper/0: el1\_abort+0x3c/0x5c
swapper/0: el1h\_64\_sync\_handler+0x80/0xcc
swapper/0: el1h\_64\_sync+0x68/0x6c
swapper/0: \_\_memset+0x84/0x188
swapper/0: btf\_populate\_kfunc\_set+0x280/0x3d8
swapper/0: \_\_register\_btf\_kfunc\_id\_set+0x43c/0x468
swapper/0: register\_btf\_kfunc\_id\_set+0x48/0x60
swapper/0: register\_nf\_nat\_bpf+0x1c/0x40
swapper/0: nf\_nat\_init+0xc0/0x128
swapper/0: do\_one\_initcall+0x184/0x464
swapper/0: do\_initcall\_level+0xdc/0x1b0
swapper/0: do\_initcalls+0x70/0xc0
swapper/0: do\_basic\_setup+0x1c/0x28
swapper/0: kernel\_init\_freeable+0x144/0x1b8
swapper/0: kernel\_init+0x20/0x1a8
swapper/0: ret\_from\_fork+0x10/0x20
==================================================================
Fixes: 1a83a716ec233 ("mm: krealloc: consider spare memory for \_\_GFP\_ZERO")
Signed-off-by: Qun-Wei Lin <qun-wei.lin@mediatek.com>
Acked-by: David Rientjes <rientjes@google.com>
Signed-off-by: Vlastimil Babka <vbabka@suse.cz>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=704573851b51808b45dae2d62059d1d8189138a2)

| -rw-r--r-- | [mm/slab\_common.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/mm/slab_common.c?id=704573851b51808b45dae2d62059d1d8189138a2) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 1 deletions

| diff --git a/mm/slab\_common.c b/mm/slab\_common.cindex 3d26c257ed8b57..552b92dfdac775 100644--- a/[mm/slab\_common.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/mm/slab_common.c?id=2b059d0d1e624adc6e69a754bc48057f8bf459dc)+++ b/[mm/slab\_common.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/mm/slab_common.c?id=704573851b51808b45dae2d62059d1d8189138a2)@@ -1209,7 +1209,7 @@ \_\_do\_krealloc(const void \*p, size\_t new\_size, gfp\_t flags) /\* Zero out spare memory. \*/ if (want\_init\_on\_alloc(flags)) { kasan\_disable\_current();- memset((void \*)p + new\_size, 0, ks - new\_size);+ memset(kasan\_reset\_tag(p) + new\_size, 0, ks - new\_size); kasan\_enable\_current(); } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 23:19:04 +0000


