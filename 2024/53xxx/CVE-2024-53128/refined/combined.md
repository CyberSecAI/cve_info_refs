=== Content from git.kernel.org_e3fdfe8a_20250114_224705.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=fd7b4f9f46d46acbc7af3a439bb0d869efdc5c58)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=fd7b4f9f46d46acbc7af3a439bb0d869efdc5c58)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=fd7b4f9f46d46acbc7af3a439bb0d869efdc5c58)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=fd7b4f9f46d46acbc7af3a439bb0d869efdc5c58)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Qun-Wei Lin <qun-wei.lin@mediatek.com> | 2024-11-13 12:25:43 +0800 |
| --- | --- | --- |
| committer | Andrew Morton <akpm@linux-foundation.org> | 2024-11-14 22:43:48 -0800 |
| commit | [fd7b4f9f46d46acbc7af3a439bb0d869efdc5c58](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=fd7b4f9f46d46acbc7af3a439bb0d869efdc5c58) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=fd7b4f9f46d46acbc7af3a439bb0d869efdc5c58)) | |
| tree | [45e9ad75c65e700d7bce047bd9bee0c24dde32a3](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=fd7b4f9f46d46acbc7af3a439bb0d869efdc5c58) | |
| parent | [31daa34315d45d3fe77f2158d889d523d78852ea](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=31daa34315d45d3fe77f2158d889d523d78852ea) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=fd7b4f9f46d46acbc7af3a439bb0d869efdc5c58&id2=31daa34315d45d3fe77f2158d889d523d78852ea)) | |
| download | [linux-fd7b4f9f46d46acbc7af3a439bb0d869efdc5c58.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-fd7b4f9f46d46acbc7af3a439bb0d869efdc5c58.tar.gz) | |

sched/task\_stack: fix object\_is\_on\_stack() for KASAN tagged pointersWhen CONFIG\_KASAN\_SW\_TAGS and CONFIG\_KASAN\_STACK are enabled, the
object\_is\_on\_stack() function may produce incorrect results due to the
presence of tags in the obj pointer, while the stack pointer does not have
tags. This discrepancy can lead to incorrect stack object detection and
subsequently trigger warnings if CONFIG\_DEBUG\_OBJECTS is also enabled.
Example of the warning:
ODEBUG: object 3eff800082ea7bb0 is NOT on stack ffff800082ea0000, but annotated.
------------[ cut here ]------------
WARNING: CPU: 0 PID: 1 at lib/debugobjects.c:557 \_\_debug\_object\_init+0x330/0x364
Modules linked in:
CPU: 0 UID: 0 PID: 1 Comm: swapper/0 Not tainted 6.12.0-rc5 #4
Hardware name: linux,dummy-virt (DT)
pstate: 600000c5 (nZCv daIF -PAN -UAO -TCO -DIT -SSBS BTYPE=--)
pc : \_\_debug\_object\_init+0x330/0x364
lr : \_\_debug\_object\_init+0x330/0x364
sp : ffff800082ea7b40
x29: ffff800082ea7b40 x28: 98ff0000c0164518 x27: 98ff0000c0164534
x26: ffff800082d93ec8 x25: 0000000000000001 x24: 1cff0000c00172a0
x23: 0000000000000000 x22: ffff800082d93ed0 x21: ffff800081a24418
x20: 3eff800082ea7bb0 x19: efff800000000000 x18: 0000000000000000
x17: 00000000000000ff x16: 0000000000000047 x15: 206b63617473206e
x14: 0000000000000018 x13: ffff800082ea7780 x12: 0ffff800082ea78e
x11: 0ffff800082ea790 x10: 0ffff800082ea79d x9 : 34d77febe173e800
x8 : 34d77febe173e800 x7 : 0000000000000001 x6 : 0000000000000001
x5 : feff800082ea74b8 x4 : ffff800082870a90 x3 : ffff80008018d3c4
x2 : 0000000000000001 x1 : ffff800082858810 x0 : 0000000000000050
Call trace:
\_\_debug\_object\_init+0x330/0x364
debug\_object\_init\_on\_stack+0x30/0x3c
schedule\_hrtimeout\_range\_clock+0xac/0x26c
schedule\_hrtimeout+0x1c/0x30
wait\_task\_inactive+0x1d4/0x25c
kthread\_bind\_mask+0x28/0x98
init\_rescuer+0x1e8/0x280
workqueue\_init+0x1a0/0x3cc
kernel\_init\_freeable+0x118/0x200
kernel\_init+0x28/0x1f0
ret\_from\_fork+0x10/0x20
---[ end trace 0000000000000000 ]---
ODEBUG: object 3eff800082ea7bb0 is NOT on stack ffff800082ea0000, but annotated.
------------[ cut here ]------------
Link: [https://lkml.kernel.org/r/20241113042544.19095-1-qun-wei.lin@mediatek.com](https://lkml.kernel.org/r/20241113042544.19095-1-qun-wei.lin%40mediatek.com)
Signed-off-by: Qun-Wei Lin <qun-wei.lin@mediatek.com>
Cc: Andrew Yang <andrew.yang@mediatek.com>
Cc: AngeloGioacchino Del Regno <angelogioacchino.delregno@collabora.com>
Cc: Casper Li <casper.li@mediatek.com>
Cc: Catalin Marinas <catalin.marinas@arm.com>
Cc: Chinwen Chang <chinwen.chang@mediatek.com>
Cc: Kent Overstreet <kent.overstreet@linux.dev>
Cc: Matthias Brugger <matthias.bgg@gmail.com>
Cc: Pasha Tatashin <pasha.tatashin@soleen.com>
Cc: Shakeel Butt <shakeel.butt@linux.dev>
Cc: <stable@vger.kernel.org>
Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=fd7b4f9f46d46acbc7af3a439bb0d869efdc5c58)

| -rw-r--r-- | [include/linux/sched/task\_stack.h](/pub/scm/linux/kernel/git/stable/linux.git/diff/include/linux/sched/task_stack.h?id=fd7b4f9f46d46acbc7af3a439bb0d869efdc5c58) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 2 insertions, 0 deletions

| diff --git a/include/linux/sched/task\_stack.h b/include/linux/sched/task\_stack.hindex bf10bdb487ddc4..6c2fef89a4fdb5 100644--- a/[include/linux/sched/task\_stack.h](/pub/scm/linux/kernel/git/stable/linux.git/tree/include/linux/sched/task_stack.h?id=31daa34315d45d3fe77f2158d889d523d78852ea)+++ b/[include/linux/sched/task\_stack.h](/pub/scm/linux/kernel/git/stable/linux.git/tree/include/linux/sched/task_stack.h?id=fd7b4f9f46d46acbc7af3a439bb0d869efdc5c58)@@ -9,6 +9,7 @@ #include <linux/sched.h> #include <linux/magic.h> #include <linux/refcount.h>+#include <linux/kasan.h>  #ifdef CONFIG\_THREAD\_INFO\_IN\_TASK @@ -89,6 +90,7 @@ static inline int object\_is\_on\_stack(const void \*obj) { void \*stack = task\_stack\_page(current); + obj = kasan\_reset\_tag(obj); return (obj >= stack) && (obj < (stack + THREAD\_SIZE)); } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 22:45:42 +0000



=== Content from git.kernel.org_3bd1ed59_20250114_224704.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=fbfe23012cec509dfbe09852019c4e4bb84999d0)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=fbfe23012cec509dfbe09852019c4e4bb84999d0)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=fbfe23012cec509dfbe09852019c4e4bb84999d0)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=fbfe23012cec509dfbe09852019c4e4bb84999d0)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Qun-Wei Lin <qun-wei.lin@mediatek.com> | 2024-11-13 12:25:43 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-11-22 15:39:51 +0100 |
| commit | [fbfe23012cec509dfbe09852019c4e4bb84999d0](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=fbfe23012cec509dfbe09852019c4e4bb84999d0) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=fbfe23012cec509dfbe09852019c4e4bb84999d0)) | |
| tree | [3a35b027a28c43b9f750be6ef3471e64c6ab9bfa](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=fbfe23012cec509dfbe09852019c4e4bb84999d0) | |
| parent | [7739f283c5ddcd6a12b699771b3fae48545ae2e3](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=7739f283c5ddcd6a12b699771b3fae48545ae2e3) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=fbfe23012cec509dfbe09852019c4e4bb84999d0&id2=7739f283c5ddcd6a12b699771b3fae48545ae2e3)) | |
| download | [linux-fbfe23012cec509dfbe09852019c4e4bb84999d0.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-fbfe23012cec509dfbe09852019c4e4bb84999d0.tar.gz) | |

sched/task\_stack: fix object\_is\_on\_stack() for KASAN tagged pointerscommit fd7b4f9f46d46acbc7af3a439bb0d869efdc5c58 upstream.
When CONFIG\_KASAN\_SW\_TAGS and CONFIG\_KASAN\_STACK are enabled, the
object\_is\_on\_stack() function may produce incorrect results due to the
presence of tags in the obj pointer, while the stack pointer does not have
tags. This discrepancy can lead to incorrect stack object detection and
subsequently trigger warnings if CONFIG\_DEBUG\_OBJECTS is also enabled.
Example of the warning:
ODEBUG: object 3eff800082ea7bb0 is NOT on stack ffff800082ea0000, but annotated.
------------[ cut here ]------------
WARNING: CPU: 0 PID: 1 at lib/debugobjects.c:557 \_\_debug\_object\_init+0x330/0x364
Modules linked in:
CPU: 0 UID: 0 PID: 1 Comm: swapper/0 Not tainted 6.12.0-rc5 #4
Hardware name: linux,dummy-virt (DT)
pstate: 600000c5 (nZCv daIF -PAN -UAO -TCO -DIT -SSBS BTYPE=--)
pc : \_\_debug\_object\_init+0x330/0x364
lr : \_\_debug\_object\_init+0x330/0x364
sp : ffff800082ea7b40
x29: ffff800082ea7b40 x28: 98ff0000c0164518 x27: 98ff0000c0164534
x26: ffff800082d93ec8 x25: 0000000000000001 x24: 1cff0000c00172a0
x23: 0000000000000000 x22: ffff800082d93ed0 x21: ffff800081a24418
x20: 3eff800082ea7bb0 x19: efff800000000000 x18: 0000000000000000
x17: 00000000000000ff x16: 0000000000000047 x15: 206b63617473206e
x14: 0000000000000018 x13: ffff800082ea7780 x12: 0ffff800082ea78e
x11: 0ffff800082ea790 x10: 0ffff800082ea79d x9 : 34d77febe173e800
x8 : 34d77febe173e800 x7 : 0000000000000001 x6 : 0000000000000001
x5 : feff800082ea74b8 x4 : ffff800082870a90 x3 : ffff80008018d3c4
x2 : 0000000000000001 x1 : ffff800082858810 x0 : 0000000000000050
Call trace:
\_\_debug\_object\_init+0x330/0x364
debug\_object\_init\_on\_stack+0x30/0x3c
schedule\_hrtimeout\_range\_clock+0xac/0x26c
schedule\_hrtimeout+0x1c/0x30
wait\_task\_inactive+0x1d4/0x25c
kthread\_bind\_mask+0x28/0x98
init\_rescuer+0x1e8/0x280
workqueue\_init+0x1a0/0x3cc
kernel\_init\_freeable+0x118/0x200
kernel\_init+0x28/0x1f0
ret\_from\_fork+0x10/0x20
---[ end trace 0000000000000000 ]---
ODEBUG: object 3eff800082ea7bb0 is NOT on stack ffff800082ea0000, but annotated.
------------[ cut here ]------------
Link: [https://lkml.kernel.org/r/20241113042544.19095-1-qun-wei.lin@mediatek.com](https://lkml.kernel.org/r/20241113042544.19095-1-qun-wei.lin%40mediatek.com)
Signed-off-by: Qun-Wei Lin <qun-wei.lin@mediatek.com>
Cc: Andrew Yang <andrew.yang@mediatek.com>
Cc: AngeloGioacchino Del Regno <angelogioacchino.delregno@collabora.com>
Cc: Casper Li <casper.li@mediatek.com>
Cc: Catalin Marinas <catalin.marinas@arm.com>
Cc: Chinwen Chang <chinwen.chang@mediatek.com>
Cc: Kent Overstreet <kent.overstreet@linux.dev>
Cc: Matthias Brugger <matthias.bgg@gmail.com>
Cc: Pasha Tatashin <pasha.tatashin@soleen.com>
Cc: Shakeel Butt <shakeel.butt@linux.dev>
Cc: <stable@vger.kernel.org>
Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=fbfe23012cec509dfbe09852019c4e4bb84999d0)

| -rw-r--r-- | [include/linux/sched/task\_stack.h](/pub/scm/linux/kernel/git/stable/linux.git/diff/include/linux/sched/task_stack.h?id=fbfe23012cec509dfbe09852019c4e4bb84999d0) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 2 insertions, 0 deletions

| diff --git a/include/linux/sched/task\_stack.h b/include/linux/sched/task\_stack.hindex ccd72b978e1fc7..4ac64f68dcf03f 100644--- a/[include/linux/sched/task\_stack.h](/pub/scm/linux/kernel/git/stable/linux.git/tree/include/linux/sched/task_stack.h?id=7739f283c5ddcd6a12b699771b3fae48545ae2e3)+++ b/[include/linux/sched/task\_stack.h](/pub/scm/linux/kernel/git/stable/linux.git/tree/include/linux/sched/task_stack.h?id=fbfe23012cec509dfbe09852019c4e4bb84999d0)@@ -9,6 +9,7 @@ #include <linux/sched.h> #include <linux/magic.h> #include <linux/refcount.h>+#include <linux/kasan.h>  #ifdef CONFIG\_THREAD\_INFO\_IN\_TASK @@ -89,6 +90,7 @@ static inline int object\_is\_on\_stack(const void \*obj) { void \*stack = task\_stack\_page(current); + obj = kasan\_reset\_tag(obj); return (obj >= stack) && (obj < (stack + THREAD\_SIZE)); } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 22:45:41 +0000



=== Content from git.kernel.org_459b5fc9_20250114_224703.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=2d2b19ed4169c38dc6c61a186c5f7bdafc709691)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=2d2b19ed4169c38dc6c61a186c5f7bdafc709691)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=2d2b19ed4169c38dc6c61a186c5f7bdafc709691)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=2d2b19ed4169c38dc6c61a186c5f7bdafc709691)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Qun-Wei Lin <qun-wei.lin@mediatek.com> | 2024-12-24 16:10:57 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2025-01-02 10:32:07 +0100 |
| commit | [2d2b19ed4169c38dc6c61a186c5f7bdafc709691](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=2d2b19ed4169c38dc6c61a186c5f7bdafc709691) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=2d2b19ed4169c38dc6c61a186c5f7bdafc709691)) | |
| tree | [eeeda6afaee117ec7fab86a267f4aa7a413a00ba](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=2d2b19ed4169c38dc6c61a186c5f7bdafc709691) | |
| parent | [1258986bbd17954c674562971ad9a01171ff2127](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=1258986bbd17954c674562971ad9a01171ff2127) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=2d2b19ed4169c38dc6c61a186c5f7bdafc709691&id2=1258986bbd17954c674562971ad9a01171ff2127)) | |
| download | [linux-2d2b19ed4169c38dc6c61a186c5f7bdafc709691.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-2d2b19ed4169c38dc6c61a186c5f7bdafc709691.tar.gz) | |

sched/task\_stack: fix object\_is\_on\_stack() for KASAN tagged pointers[ Upstream commit fd7b4f9f46d46acbc7af3a439bb0d869efdc5c58 ]
When CONFIG\_KASAN\_SW\_TAGS and CONFIG\_KASAN\_STACK are enabled, the
object\_is\_on\_stack() function may produce incorrect results due to the
presence of tags in the obj pointer, while the stack pointer does not have
tags. This discrepancy can lead to incorrect stack object detection and
subsequently trigger warnings if CONFIG\_DEBUG\_OBJECTS is also enabled.
Example of the warning:
ODEBUG: object 3eff800082ea7bb0 is NOT on stack ffff800082ea0000, but annotated.
------------[ cut here ]------------
WARNING: CPU: 0 PID: 1 at lib/debugobjects.c:557 \_\_debug\_object\_init+0x330/0x364
Modules linked in:
CPU: 0 UID: 0 PID: 1 Comm: swapper/0 Not tainted 6.12.0-rc5 #4
Hardware name: linux,dummy-virt (DT)
pstate: 600000c5 (nZCv daIF -PAN -UAO -TCO -DIT -SSBS BTYPE=--)
pc : \_\_debug\_object\_init+0x330/0x364
lr : \_\_debug\_object\_init+0x330/0x364
sp : ffff800082ea7b40
x29: ffff800082ea7b40 x28: 98ff0000c0164518 x27: 98ff0000c0164534
x26: ffff800082d93ec8 x25: 0000000000000001 x24: 1cff0000c00172a0
x23: 0000000000000000 x22: ffff800082d93ed0 x21: ffff800081a24418
x20: 3eff800082ea7bb0 x19: efff800000000000 x18: 0000000000000000
x17: 00000000000000ff x16: 0000000000000047 x15: 206b63617473206e
x14: 0000000000000018 x13: ffff800082ea7780 x12: 0ffff800082ea78e
x11: 0ffff800082ea790 x10: 0ffff800082ea79d x9 : 34d77febe173e800
x8 : 34d77febe173e800 x7 : 0000000000000001 x6 : 0000000000000001
x5 : feff800082ea74b8 x4 : ffff800082870a90 x3 : ffff80008018d3c4
x2 : 0000000000000001 x1 : ffff800082858810 x0 : 0000000000000050
Call trace:
\_\_debug\_object\_init+0x330/0x364
debug\_object\_init\_on\_stack+0x30/0x3c
schedule\_hrtimeout\_range\_clock+0xac/0x26c
schedule\_hrtimeout+0x1c/0x30
wait\_task\_inactive+0x1d4/0x25c
kthread\_bind\_mask+0x28/0x98
init\_rescuer+0x1e8/0x280
workqueue\_init+0x1a0/0x3cc
kernel\_init\_freeable+0x118/0x200
kernel\_init+0x28/0x1f0
ret\_from\_fork+0x10/0x20
---[ end trace 0000000000000000 ]---
ODEBUG: object 3eff800082ea7bb0 is NOT on stack ffff800082ea0000, but annotated.
------------[ cut here ]------------
Link: [https://lkml.kernel.org/r/20241113042544.19095-1-qun-wei.lin@mediatek.com](https://lkml.kernel.org/r/20241113042544.19095-1-qun-wei.lin%40mediatek.com)
Signed-off-by: Qun-Wei Lin <qun-wei.lin@mediatek.com>
Cc: Andrew Yang <andrew.yang@mediatek.com>
Cc: AngeloGioacchino Del Regno <angelogioacchino.delregno@collabora.com>
Cc: Casper Li <casper.li@mediatek.com>
Cc: Catalin Marinas <catalin.marinas@arm.com>
Cc: Chinwen Chang <chinwen.chang@mediatek.com>
Cc: Kent Overstreet <kent.overstreet@linux.dev>
Cc: Matthias Brugger <matthias.bgg@gmail.com>
Cc: Pasha Tatashin <pasha.tatashin@soleen.com>
Cc: Shakeel Butt <shakeel.butt@linux.dev>
Cc: <stable@vger.kernel.org>
Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
[ Resolve line conflicts ]
Signed-off-by: Wenshan Lan <jetlan9@163.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=2d2b19ed4169c38dc6c61a186c5f7bdafc709691)

| -rw-r--r-- | [include/linux/sched/task\_stack.h](/pub/scm/linux/kernel/git/stable/linux.git/diff/include/linux/sched/task_stack.h?id=2d2b19ed4169c38dc6c61a186c5f7bdafc709691) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 2 insertions, 0 deletions

| diff --git a/include/linux/sched/task\_stack.h b/include/linux/sched/task\_stack.hindex f158b025c17509..d2117e1c8fa581 100644--- a/[include/linux/sched/task\_stack.h](/pub/scm/linux/kernel/git/stable/linux.git/tree/include/linux/sched/task_stack.h?id=1258986bbd17954c674562971ad9a01171ff2127)+++ b/[include/linux/sched/task\_stack.h](/pub/scm/linux/kernel/git/stable/linux.git/tree/include/linux/sched/task_stack.h?id=2d2b19ed4169c38dc6c61a186c5f7bdafc709691)@@ -8,6 +8,7 @@  #include <linux/sched.h> #include <linux/magic.h>+#include <linux/kasan.h>  #ifdef CONFIG\_THREAD\_INFO\_IN\_TASK @@ -88,6 +89,7 @@ static inline int object\_is\_on\_stack(const void \*obj) { void \*stack = task\_stack\_page(current); + obj = kasan\_reset\_tag(obj); return (obj >= stack) && (obj < (stack + THREAD\_SIZE)); } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 22:45:40 +0000


