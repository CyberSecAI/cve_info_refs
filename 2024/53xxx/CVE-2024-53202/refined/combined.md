=== Content from git.kernel.org_e790cf92_20250115_084438.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=369a9c046c2fdfe037f05b43b84c386bdbccc103)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=369a9c046c2fdfe037f05b43b84c386bdbccc103)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=369a9c046c2fdfe037f05b43b84c386bdbccc103)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=369a9c046c2fdfe037f05b43b84c386bdbccc103)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Gaosheng Cui <cuigaosheng1@huawei.com> | 2024-10-16 19:03:35 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-11-13 07:13:50 +0100 |
| commit | [369a9c046c2fdfe037f05b43b84c386bdbccc103](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=369a9c046c2fdfe037f05b43b84c386bdbccc103) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=369a9c046c2fdfe037f05b43b84c386bdbccc103)) | |
| tree | [8941ff0031688db0690ad6dc0d39db6e4ec3c20b](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=369a9c046c2fdfe037f05b43b84c386bdbccc103) | |
| parent | [f841224f03029225dec70ee1f12ffc2473ed067a](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=f841224f03029225dec70ee1f12ffc2473ed067a) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=369a9c046c2fdfe037f05b43b84c386bdbccc103&id2=f841224f03029225dec70ee1f12ffc2473ed067a)) | |
| download | [linux-369a9c046c2fdfe037f05b43b84c386bdbccc103.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-369a9c046c2fdfe037f05b43b84c386bdbccc103.tar.gz) | |

firmware\_loader: Fix possible resource leak in fw\_log\_firmware\_info()The alg instance should be released under the exception path, otherwise
there may be resource leak here.
To mitigate this, free the alg instance with crypto\_free\_shash when kmalloc
fails.
Fixes: 02fe26f25325 ("firmware\_loader: Add debug message with checksum for FW file")
Signed-off-by: Gaosheng Cui <cuigaosheng1@huawei.com>
Reviewed-by: Amadeusz Sławiński <amadeuszx.slawinski@linux.intel.com>
Reviewed-by: Russ Weight <russ.weight@linux.dev>
Link: [https://lore.kernel.org/r/20241016110335.3677924-1-cuigaosheng1@huawei.com](https://lore.kernel.org/r/20241016110335.3677924-1-cuigaosheng1%40huawei.com)
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=369a9c046c2fdfe037f05b43b84c386bdbccc103)

| -rw-r--r-- | [drivers/base/firmware\_loader/main.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/base/firmware_loader/main.c?id=369a9c046c2fdfe037f05b43b84c386bdbccc103) | 5 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 2 insertions, 3 deletions

| diff --git a/drivers/base/firmware\_loader/main.c b/drivers/base/firmware\_loader/main.cindex bb368193d96972..cb0912ea3e627e 100644--- a/[drivers/base/firmware\_loader/main.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/base/firmware_loader/main.c?id=f841224f03029225dec70ee1f12ffc2473ed067a)+++ b/[drivers/base/firmware\_loader/main.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/base/firmware_loader/main.c?id=369a9c046c2fdfe037f05b43b84c386bdbccc103)@@ -829,19 +829,18 @@ static void fw\_log\_firmware\_info(const struct firmware \*fw, const char \*name, st shash->tfm = alg;  if (crypto\_shash\_digest(shash, fw->data, fw->size, sha256buf) < 0)- goto out\_shash;+ goto out\_free;  for (int i = 0; i < SHA256\_DIGEST\_SIZE; i++) sprintf(&outbuf[i \* 2], "%02x", sha256buf[i]); outbuf[SHA256\_BLOCK\_SIZE] = 0; dev\_dbg(device, "Loaded FW: %s, sha256: %s\n", name, outbuf); -out\_shash:- crypto\_free\_shash(alg); out\_free: kfree(shash); kfree(outbuf); kfree(sha256buf);+ crypto\_free\_shash(alg); } #else static void fw\_log\_firmware\_info(const struct firmware \*fw, const char \*name, |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-15 08:43:14 +0000



=== Content from git.kernel.org_9306de3d_20250115_084441.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=f380f895dbb2a11d62ca6df9e82d995f4bc26b84)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=f380f895dbb2a11d62ca6df9e82d995f4bc26b84)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=f380f895dbb2a11d62ca6df9e82d995f4bc26b84)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=f380f895dbb2a11d62ca6df9e82d995f4bc26b84)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Gaosheng Cui <cuigaosheng1@huawei.com> | 2024-10-16 19:03:35 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-05 14:02:38 +0100 |
| commit | [f380f895dbb2a11d62ca6df9e82d995f4bc26b84](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=f380f895dbb2a11d62ca6df9e82d995f4bc26b84) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=f380f895dbb2a11d62ca6df9e82d995f4bc26b84)) | |
| tree | [451e991f4ea367a946a6de93fc86f8d7c7e37478](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=f380f895dbb2a11d62ca6df9e82d995f4bc26b84) | |
| parent | [56971710cd541f2f05160a84b3183477d34a1be9](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=56971710cd541f2f05160a84b3183477d34a1be9) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=f380f895dbb2a11d62ca6df9e82d995f4bc26b84&id2=56971710cd541f2f05160a84b3183477d34a1be9)) | |
| download | [linux-f380f895dbb2a11d62ca6df9e82d995f4bc26b84.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-f380f895dbb2a11d62ca6df9e82d995f4bc26b84.tar.gz) | |

firmware\_loader: Fix possible resource leak in fw\_log\_firmware\_info()[ Upstream commit 369a9c046c2fdfe037f05b43b84c386bdbccc103 ]
The alg instance should be released under the exception path, otherwise
there may be resource leak here.
To mitigate this, free the alg instance with crypto\_free\_shash when kmalloc
fails.
Fixes: 02fe26f25325 ("firmware\_loader: Add debug message with checksum for FW file")
Signed-off-by: Gaosheng Cui <cuigaosheng1@huawei.com>
Reviewed-by: Amadeusz Sławiński <amadeuszx.slawinski@linux.intel.com>
Reviewed-by: Russ Weight <russ.weight@linux.dev>
Link: [https://lore.kernel.org/r/20241016110335.3677924-1-cuigaosheng1@huawei.com](https://lore.kernel.org/r/20241016110335.3677924-1-cuigaosheng1%40huawei.com)
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=f380f895dbb2a11d62ca6df9e82d995f4bc26b84)

| -rw-r--r-- | [drivers/base/firmware\_loader/main.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/base/firmware_loader/main.c?id=f380f895dbb2a11d62ca6df9e82d995f4bc26b84) | 5 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 2 insertions, 3 deletions

| diff --git a/drivers/base/firmware\_loader/main.c b/drivers/base/firmware\_loader/main.cindex 324a9a3c087aa2..c6664a78796979 100644--- a/[drivers/base/firmware\_loader/main.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/base/firmware_loader/main.c?id=56971710cd541f2f05160a84b3183477d34a1be9)+++ b/[drivers/base/firmware\_loader/main.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/base/firmware_loader/main.c?id=f380f895dbb2a11d62ca6df9e82d995f4bc26b84)@@ -829,19 +829,18 @@ static void fw\_log\_firmware\_info(const struct firmware \*fw, const char \*name, st shash->tfm = alg;  if (crypto\_shash\_digest(shash, fw->data, fw->size, sha256buf) < 0)- goto out\_shash;+ goto out\_free;  for (int i = 0; i < SHA256\_DIGEST\_SIZE; i++) sprintf(&outbuf[i \* 2], "%02x", sha256buf[i]); outbuf[SHA256\_BLOCK\_SIZE] = 0; dev\_dbg(device, "Loaded FW: %s, sha256: %s\n", name, outbuf); -out\_shash:- crypto\_free\_shash(alg); out\_free: kfree(shash); kfree(outbuf); kfree(sha256buf);+ crypto\_free\_shash(alg); } #else static void fw\_log\_firmware\_info(const struct firmware \*fw, const char \*name, |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-15 08:43:18 +0000



=== Content from git.kernel.org_666c1342_20250115_084439.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=789a72498d32f88d24371c10985aceb46397056c)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=789a72498d32f88d24371c10985aceb46397056c)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=789a72498d32f88d24371c10985aceb46397056c)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=789a72498d32f88d24371c10985aceb46397056c)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Gaosheng Cui <cuigaosheng1@huawei.com> | 2024-10-16 19:03:35 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-09 10:32:37 +0100 |
| commit | [789a72498d32f88d24371c10985aceb46397056c](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=789a72498d32f88d24371c10985aceb46397056c) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=789a72498d32f88d24371c10985aceb46397056c)) | |
| tree | [537d34a7730ec959e2e97ec495ed5847307e902f](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=789a72498d32f88d24371c10985aceb46397056c) | |
| parent | [4a92e10302422ce181a20797d552fba6b09e3b1a](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=4a92e10302422ce181a20797d552fba6b09e3b1a) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=789a72498d32f88d24371c10985aceb46397056c&id2=4a92e10302422ce181a20797d552fba6b09e3b1a)) | |
| download | [linux-789a72498d32f88d24371c10985aceb46397056c.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-789a72498d32f88d24371c10985aceb46397056c.tar.gz) | |

firmware\_loader: Fix possible resource leak in fw\_log\_firmware\_info()[ Upstream commit 369a9c046c2fdfe037f05b43b84c386bdbccc103 ]
The alg instance should be released under the exception path, otherwise
there may be resource leak here.
To mitigate this, free the alg instance with crypto\_free\_shash when kmalloc
fails.
Fixes: 02fe26f25325 ("firmware\_loader: Add debug message with checksum for FW file")
Signed-off-by: Gaosheng Cui <cuigaosheng1@huawei.com>
Reviewed-by: Amadeusz Sławiński <amadeuszx.slawinski@linux.intel.com>
Reviewed-by: Russ Weight <russ.weight@linux.dev>
Link: [https://lore.kernel.org/r/20241016110335.3677924-1-cuigaosheng1@huawei.com](https://lore.kernel.org/r/20241016110335.3677924-1-cuigaosheng1%40huawei.com)
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=789a72498d32f88d24371c10985aceb46397056c)

| -rw-r--r-- | [drivers/base/firmware\_loader/main.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/base/firmware_loader/main.c?id=789a72498d32f88d24371c10985aceb46397056c) | 5 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 2 insertions, 3 deletions

| diff --git a/drivers/base/firmware\_loader/main.c b/drivers/base/firmware\_loader/main.cindex 0b18c6b46e65d8..f3133ba831c5e0 100644--- a/[drivers/base/firmware\_loader/main.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/base/firmware_loader/main.c?id=4a92e10302422ce181a20797d552fba6b09e3b1a)+++ b/[drivers/base/firmware\_loader/main.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/base/firmware_loader/main.c?id=789a72498d32f88d24371c10985aceb46397056c)@@ -824,19 +824,18 @@ static void fw\_log\_firmware\_info(const struct firmware \*fw, const char \*name, st shash->tfm = alg;  if (crypto\_shash\_digest(shash, fw->data, fw->size, sha256buf) < 0)- goto out\_shash;+ goto out\_free;  for (int i = 0; i < SHA256\_DIGEST\_SIZE; i++) sprintf(&outbuf[i \* 2], "%02x", sha256buf[i]); outbuf[SHA256\_BLOCK\_SIZE] = 0; dev\_dbg(device, "Loaded FW: %s, sha256: %s\n", name, outbuf); -out\_shash:- crypto\_free\_shash(alg); out\_free: kfree(shash); kfree(outbuf); kfree(sha256buf);+ crypto\_free\_shash(alg); } #else static void fw\_log\_firmware\_info(const struct firmware \*fw, const char \*name, |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-15 08:43:16 +0000



=== Content from git.kernel.org_da01d341_20250115_084440.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=eb5d67d00ad17a5bd0920f455160dc2ccbd2dc78)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=eb5d67d00ad17a5bd0920f455160dc2ccbd2dc78)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=eb5d67d00ad17a5bd0920f455160dc2ccbd2dc78)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=eb5d67d00ad17a5bd0920f455160dc2ccbd2dc78)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Gaosheng Cui <cuigaosheng1@huawei.com> | 2024-10-16 19:03:35 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-05 13:54:04 +0100 |
| commit | [eb5d67d00ad17a5bd0920f455160dc2ccbd2dc78](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=eb5d67d00ad17a5bd0920f455160dc2ccbd2dc78) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=eb5d67d00ad17a5bd0920f455160dc2ccbd2dc78)) | |
| tree | [1a12c998a76067ad06cdb81b7b59332cab9561ba](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=eb5d67d00ad17a5bd0920f455160dc2ccbd2dc78) | |
| parent | [ef92cd55289a282910575c5b9d87f646f2d39b38](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=ef92cd55289a282910575c5b9d87f646f2d39b38) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=eb5d67d00ad17a5bd0920f455160dc2ccbd2dc78&id2=ef92cd55289a282910575c5b9d87f646f2d39b38)) | |
| download | [linux-eb5d67d00ad17a5bd0920f455160dc2ccbd2dc78.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-eb5d67d00ad17a5bd0920f455160dc2ccbd2dc78.tar.gz) | |

firmware\_loader: Fix possible resource leak in fw\_log\_firmware\_info()[ Upstream commit 369a9c046c2fdfe037f05b43b84c386bdbccc103 ]
The alg instance should be released under the exception path, otherwise
there may be resource leak here.
To mitigate this, free the alg instance with crypto\_free\_shash when kmalloc
fails.
Fixes: 02fe26f25325 ("firmware\_loader: Add debug message with checksum for FW file")
Signed-off-by: Gaosheng Cui <cuigaosheng1@huawei.com>
Reviewed-by: Amadeusz Sławiński <amadeuszx.slawinski@linux.intel.com>
Reviewed-by: Russ Weight <russ.weight@linux.dev>
Link: [https://lore.kernel.org/r/20241016110335.3677924-1-cuigaosheng1@huawei.com](https://lore.kernel.org/r/20241016110335.3677924-1-cuigaosheng1%40huawei.com)
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=eb5d67d00ad17a5bd0920f455160dc2ccbd2dc78)

| -rw-r--r-- | [drivers/base/firmware\_loader/main.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/base/firmware_loader/main.c?id=eb5d67d00ad17a5bd0920f455160dc2ccbd2dc78) | 5 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 2 insertions, 3 deletions

| diff --git a/drivers/base/firmware\_loader/main.c b/drivers/base/firmware\_loader/main.cindex 324a9a3c087aa2..c6664a78796979 100644--- a/[drivers/base/firmware\_loader/main.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/base/firmware_loader/main.c?id=ef92cd55289a282910575c5b9d87f646f2d39b38)+++ b/[drivers/base/firmware\_loader/main.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/base/firmware_loader/main.c?id=eb5d67d00ad17a5bd0920f455160dc2ccbd2dc78)@@ -829,19 +829,18 @@ static void fw\_log\_firmware\_info(const struct firmware \*fw, const char \*name, st shash->tfm = alg;  if (crypto\_shash\_digest(shash, fw->data, fw->size, sha256buf) < 0)- goto out\_shash;+ goto out\_free;  for (int i = 0; i < SHA256\_DIGEST\_SIZE; i++) sprintf(&outbuf[i \* 2], "%02x", sha256buf[i]); outbuf[SHA256\_BLOCK\_SIZE] = 0; dev\_dbg(device, "Loaded FW: %s, sha256: %s\n", name, outbuf); -out\_shash:- crypto\_free\_shash(alg); out\_free: kfree(shash); kfree(outbuf); kfree(sha256buf);+ crypto\_free\_shash(alg); } #else static void fw\_log\_firmware\_info(const struct firmware \*fw, const char \*name, |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-15 08:43:17 +0000


