=== Content from git.kernel.org_4ab18909_20250114_191407.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=e29306c0e1ae4b434db32c90705844c77f701be5)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=e29306c0e1ae4b434db32c90705844c77f701be5)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=e29306c0e1ae4b434db32c90705844c77f701be5)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e29306c0e1ae4b434db32c90705844c77f701be5)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Sergio Paracuellos <sergio.paracuellos@gmail.com> | 2024-09-10 06:40:23 +0200 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-05 14:02:15 +0100 |
| commit | [e29306c0e1ae4b434db32c90705844c77f701be5](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=e29306c0e1ae4b434db32c90705844c77f701be5) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=e29306c0e1ae4b434db32c90705844c77f701be5)) | |
| tree | [793749f8d0d66f4860c7716a2c4db59ad21b03d5](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=e29306c0e1ae4b434db32c90705844c77f701be5) | |
| parent | [17d3309201f1a972acbe7db76784f57d40b85a9c](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=17d3309201f1a972acbe7db76784f57d40b85a9c) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e29306c0e1ae4b434db32c90705844c77f701be5&id2=17d3309201f1a972acbe7db76784f57d40b85a9c)) | |
| download | [linux-e29306c0e1ae4b434db32c90705844c77f701be5.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-e29306c0e1ae4b434db32c90705844c77f701be5.tar.gz) | |

clk: ralink: mtmips: fix clocks probe order in oldest ralink SoCs[ Upstream commit d34db686a3d74bd564bfce2ada15011c556269fc ]
Base clocks are the first in being probed and are real dependencies of the
rest of fixed, factor and peripheral clocks. For old ralink SoCs RT2880,
RT305x and RT3883 'xtal' must be defined first since in any other case,
when fixed clocks are probed they are delayed until 'xtal' is probed so the
following warning appears:
WARNING: CPU: 0 PID: 0 at drivers/clk/ralink/clk-mtmips.c:499 rt3883\_bus\_recalc\_rate+0x98/0x138
Modules linked in:
CPU: 0 PID: 0 Comm: swapper Not tainted 6.6.43 #0
Stack : 805e58d0 00000000 00000004 8004f950 00000000 00000004 00000000 00000000
80669c54 80830000 80700000 805ae570 80670068 00000001 80669bf8 00000000
00000000 00000000 805ae570 80669b38 00000020 804db7dc 00000000 00000000
203a6d6d 80669b78 80669e48 70617773 00000000 805ae570 00000000 00000009
00000000 00000001 00000004 00000001 00000000 00000000 83fe43b0 00000000
...
Call Trace:
[<800065d0>] show\_stack+0x64/0xf4
[<804bca14>] dump\_stack\_lvl+0x38/0x60
[<800218ac>] \_\_warn+0x94/0xe4
[<8002195c>] warn\_slowpath\_fmt+0x60/0x94
[<80259ff8>] rt3883\_bus\_recalc\_rate+0x98/0x138
[<80254530>] \_\_clk\_register+0x568/0x688
[<80254838>] of\_clk\_hw\_register+0x18/0x2c
[<8070b910>] rt2880\_clk\_of\_clk\_init\_driver+0x18c/0x594
[<8070b628>] of\_clk\_init+0x1c0/0x23c
[<806fc448>] plat\_time\_init+0x58/0x18c
[<806fdaf0>] time\_init+0x10/0x6c
[<806f9bc4>] start\_kernel+0x458/0x67c
---[ end trace 0000000000000000 ]---
When this driver was mainlined we could not find any active users of old
ralink SoCs so we cannot perform any real tests for them. Now, one user
of a Belkin f9k1109 version 1 device which uses RT3883 SoC appeared and
reported some issues in openWRT:
- https://github.com/openwrt/openwrt/issues/16054
Thus, define a 'rt2880\_xtal\_recalc\_rate()' just returning the expected
frequency 40Mhz and use it along the old ralink SoCs to have a correct
boot trace with no warnings and a working clock plan from the beggining.
Fixes: 6f3b15586eef ("clk: ralink: add clock and reset driver for MTMIPS SoCs")
Signed-off-by: Sergio Paracuellos <sergio.paracuellos@gmail.com>
Link: [https://lore.kernel.org/r/20240910044024.120009-3-sergio.paracuellos@gmail.com](https://lore.kernel.org/r/20240910044024.120009-3-sergio.paracuellos%40gmail.com)
Signed-off-by: Stephen Boyd <sboyd@kernel.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e29306c0e1ae4b434db32c90705844c77f701be5)

| -rw-r--r-- | [drivers/clk/ralink/clk-mtmips.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/clk/ralink/clk-mtmips.c?id=e29306c0e1ae4b434db32c90705844c77f701be5) | 21 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 13 insertions, 8 deletions

| diff --git a/drivers/clk/ralink/clk-mtmips.c b/drivers/clk/ralink/clk-mtmips.cindex 62f9801ecd3a4c..76285fbbdeaa2d 100644--- a/[drivers/clk/ralink/clk-mtmips.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/clk/ralink/clk-mtmips.c?id=17d3309201f1a972acbe7db76784f57d40b85a9c)+++ b/[drivers/clk/ralink/clk-mtmips.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/clk/ralink/clk-mtmips.c?id=e29306c0e1ae4b434db32c90705844c77f701be5)@@ -263,10 +263,6 @@ err\_clk\_unreg: .rate = \_rate \ } -static struct mtmips\_clk\_fixed rt305x\_fixed\_clocks[] = {- CLK\_FIXED("xtal", NULL, 40000000)-};- static struct mtmips\_clk\_fixed rt3883\_fixed\_clocks[] = { CLK\_FIXED("xtal", NULL, 40000000), CLK\_FIXED("periph", "xtal", 40000000)@@ -371,6 +367,12 @@ static inline struct mtmips\_clk \*to\_mtmips\_clk(struct clk\_hw \*hw) return container\_of(hw, struct mtmips\_clk, hw); } +static unsigned long rt2880\_xtal\_recalc\_rate(struct clk\_hw \*hw,+ unsigned long parent\_rate)+{+ return 40000000;+}+ static unsigned long rt5350\_xtal\_recalc\_rate(struct clk\_hw \*hw, unsigned long parent\_rate) {@@ -682,10 +684,12 @@ static unsigned long mt76x8\_cpu\_recalc\_rate(struct clk\_hw \*hw, }  static struct mtmips\_clk rt2880\_clks\_base[] = {+ { CLK\_BASE("xtal", NULL, rt2880\_xtal\_recalc\_rate) }, { CLK\_BASE("cpu", "xtal", rt2880\_cpu\_recalc\_rate) } };  static struct mtmips\_clk rt305x\_clks\_base[] = {+ { CLK\_BASE("xtal", NULL, rt2880\_xtal\_recalc\_rate) }, { CLK\_BASE("cpu", "xtal", rt305x\_cpu\_recalc\_rate) } }; @@ -695,6 +699,7 @@ static struct mtmips\_clk rt3352\_clks\_base[] = { };  static struct mtmips\_clk rt3883\_clks\_base[] = {+ { CLK\_BASE("xtal", NULL, rt2880\_xtal\_recalc\_rate) }, { CLK\_BASE("cpu", "xtal", rt3883\_cpu\_recalc\_rate) }, { CLK\_BASE("bus", "cpu", rt3883\_bus\_recalc\_rate) } };@@ -751,8 +756,8 @@ err\_clk\_unreg: static const struct mtmips\_clk\_data rt2880\_clk\_data = { .clk\_base = rt2880\_clks\_base, .num\_clk\_base = ARRAY\_SIZE(rt2880\_clks\_base),- .clk\_fixed = rt305x\_fixed\_clocks,- .num\_clk\_fixed = ARRAY\_SIZE(rt305x\_fixed\_clocks),+ .clk\_fixed = NULL,+ .num\_clk\_fixed = 0, .clk\_factor = rt2880\_factor\_clocks, .num\_clk\_factor = ARRAY\_SIZE(rt2880\_factor\_clocks), .clk\_periph = rt2880\_pherip\_clks,@@ -762,8 +767,8 @@ static const struct mtmips\_clk\_data rt2880\_clk\_data = { static const struct mtmips\_clk\_data rt305x\_clk\_data = { .clk\_base = rt305x\_clks\_base, .num\_clk\_base = ARRAY\_SIZE(rt305x\_clks\_base),- .clk\_fixed = rt305x\_fixed\_clocks,- .num\_clk\_fixed = ARRAY\_SIZE(rt305x\_fixed\_clocks),+ .clk\_fixed = NULL,+ .num\_clk\_fixed = 0, .clk\_factor = rt305x\_factor\_clocks, .num\_clk\_factor = ARRAY\_SIZE(rt305x\_factor\_clocks), .clk\_periph = rt305x\_pherip\_clks, |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 19:12:44 +0000



=== Content from git.kernel.org_52dafd4e_20250114_191408.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=fe09d609f2304c7775789090e3f006d786852148)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=fe09d609f2304c7775789090e3f006d786852148)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=fe09d609f2304c7775789090e3f006d786852148)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=fe09d609f2304c7775789090e3f006d786852148)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Sergio Paracuellos <sergio.paracuellos@gmail.com> | 2024-09-10 06:40:23 +0200 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-05 13:53:43 +0100 |
| commit | [fe09d609f2304c7775789090e3f006d786852148](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=fe09d609f2304c7775789090e3f006d786852148) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=fe09d609f2304c7775789090e3f006d786852148)) | |
| tree | [a4fbfddbf81f0e23951de1325bb91249f3a3add1](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=fe09d609f2304c7775789090e3f006d786852148) | |
| parent | [9afb8e46bbc4b6f9f16f8bf3ca21d1c55232e990](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=9afb8e46bbc4b6f9f16f8bf3ca21d1c55232e990) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=fe09d609f2304c7775789090e3f006d786852148&id2=9afb8e46bbc4b6f9f16f8bf3ca21d1c55232e990)) | |
| download | [linux-fe09d609f2304c7775789090e3f006d786852148.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-fe09d609f2304c7775789090e3f006d786852148.tar.gz) | |

clk: ralink: mtmips: fix clocks probe order in oldest ralink SoCs[ Upstream commit d34db686a3d74bd564bfce2ada15011c556269fc ]
Base clocks are the first in being probed and are real dependencies of the
rest of fixed, factor and peripheral clocks. For old ralink SoCs RT2880,
RT305x and RT3883 'xtal' must be defined first since in any other case,
when fixed clocks are probed they are delayed until 'xtal' is probed so the
following warning appears:
WARNING: CPU: 0 PID: 0 at drivers/clk/ralink/clk-mtmips.c:499 rt3883\_bus\_recalc\_rate+0x98/0x138
Modules linked in:
CPU: 0 PID: 0 Comm: swapper Not tainted 6.6.43 #0
Stack : 805e58d0 00000000 00000004 8004f950 00000000 00000004 00000000 00000000
80669c54 80830000 80700000 805ae570 80670068 00000001 80669bf8 00000000
00000000 00000000 805ae570 80669b38 00000020 804db7dc 00000000 00000000
203a6d6d 80669b78 80669e48 70617773 00000000 805ae570 00000000 00000009
00000000 00000001 00000004 00000001 00000000 00000000 83fe43b0 00000000
...
Call Trace:
[<800065d0>] show\_stack+0x64/0xf4
[<804bca14>] dump\_stack\_lvl+0x38/0x60
[<800218ac>] \_\_warn+0x94/0xe4
[<8002195c>] warn\_slowpath\_fmt+0x60/0x94
[<80259ff8>] rt3883\_bus\_recalc\_rate+0x98/0x138
[<80254530>] \_\_clk\_register+0x568/0x688
[<80254838>] of\_clk\_hw\_register+0x18/0x2c
[<8070b910>] rt2880\_clk\_of\_clk\_init\_driver+0x18c/0x594
[<8070b628>] of\_clk\_init+0x1c0/0x23c
[<806fc448>] plat\_time\_init+0x58/0x18c
[<806fdaf0>] time\_init+0x10/0x6c
[<806f9bc4>] start\_kernel+0x458/0x67c
---[ end trace 0000000000000000 ]---
When this driver was mainlined we could not find any active users of old
ralink SoCs so we cannot perform any real tests for them. Now, one user
of a Belkin f9k1109 version 1 device which uses RT3883 SoC appeared and
reported some issues in openWRT:
- https://github.com/openwrt/openwrt/issues/16054
Thus, define a 'rt2880\_xtal\_recalc\_rate()' just returning the expected
frequency 40Mhz and use it along the old ralink SoCs to have a correct
boot trace with no warnings and a working clock plan from the beggining.
Fixes: 6f3b15586eef ("clk: ralink: add clock and reset driver for MTMIPS SoCs")
Signed-off-by: Sergio Paracuellos <sergio.paracuellos@gmail.com>
Link: [https://lore.kernel.org/r/20240910044024.120009-3-sergio.paracuellos@gmail.com](https://lore.kernel.org/r/20240910044024.120009-3-sergio.paracuellos%40gmail.com)
Signed-off-by: Stephen Boyd <sboyd@kernel.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=fe09d609f2304c7775789090e3f006d786852148)

| -rw-r--r-- | [drivers/clk/ralink/clk-mtmips.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/clk/ralink/clk-mtmips.c?id=fe09d609f2304c7775789090e3f006d786852148) | 21 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 13 insertions, 8 deletions

| diff --git a/drivers/clk/ralink/clk-mtmips.c b/drivers/clk/ralink/clk-mtmips.cindex 62f9801ecd3a4c..76285fbbdeaa2d 100644--- a/[drivers/clk/ralink/clk-mtmips.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/clk/ralink/clk-mtmips.c?id=9afb8e46bbc4b6f9f16f8bf3ca21d1c55232e990)+++ b/[drivers/clk/ralink/clk-mtmips.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/clk/ralink/clk-mtmips.c?id=fe09d609f2304c7775789090e3f006d786852148)@@ -263,10 +263,6 @@ err\_clk\_unreg: .rate = \_rate \ } -static struct mtmips\_clk\_fixed rt305x\_fixed\_clocks[] = {- CLK\_FIXED("xtal", NULL, 40000000)-};- static struct mtmips\_clk\_fixed rt3883\_fixed\_clocks[] = { CLK\_FIXED("xtal", NULL, 40000000), CLK\_FIXED("periph", "xtal", 40000000)@@ -371,6 +367,12 @@ static inline struct mtmips\_clk \*to\_mtmips\_clk(struct clk\_hw \*hw) return container\_of(hw, struct mtmips\_clk, hw); } +static unsigned long rt2880\_xtal\_recalc\_rate(struct clk\_hw \*hw,+ unsigned long parent\_rate)+{+ return 40000000;+}+ static unsigned long rt5350\_xtal\_recalc\_rate(struct clk\_hw \*hw, unsigned long parent\_rate) {@@ -682,10 +684,12 @@ static unsigned long mt76x8\_cpu\_recalc\_rate(struct clk\_hw \*hw, }  static struct mtmips\_clk rt2880\_clks\_base[] = {+ { CLK\_BASE("xtal", NULL, rt2880\_xtal\_recalc\_rate) }, { CLK\_BASE("cpu", "xtal", rt2880\_cpu\_recalc\_rate) } };  static struct mtmips\_clk rt305x\_clks\_base[] = {+ { CLK\_BASE("xtal", NULL, rt2880\_xtal\_recalc\_rate) }, { CLK\_BASE("cpu", "xtal", rt305x\_cpu\_recalc\_rate) } }; @@ -695,6 +699,7 @@ static struct mtmips\_clk rt3352\_clks\_base[] = { };  static struct mtmips\_clk rt3883\_clks\_base[] = {+ { CLK\_BASE("xtal", NULL, rt2880\_xtal\_recalc\_rate) }, { CLK\_BASE("cpu", "xtal", rt3883\_cpu\_recalc\_rate) }, { CLK\_BASE("bus", "cpu", rt3883\_bus\_recalc\_rate) } };@@ -751,8 +756,8 @@ err\_clk\_unreg: static const struct mtmips\_clk\_data rt2880\_clk\_data = { .clk\_base = rt2880\_clks\_base, .num\_clk\_base = ARRAY\_SIZE(rt2880\_clks\_base),- .clk\_fixed = rt305x\_fixed\_clocks,- .num\_clk\_fixed = ARRAY\_SIZE(rt305x\_fixed\_clocks),+ .clk\_fixed = NULL,+ .num\_clk\_fixed = 0, .clk\_factor = rt2880\_factor\_clocks, .num\_clk\_factor = ARRAY\_SIZE(rt2880\_factor\_clocks), .clk\_periph = rt2880\_pherip\_clks,@@ -762,8 +767,8 @@ static const struct mtmips\_clk\_data rt2880\_clk\_data = { static const struct mtmips\_clk\_data rt305x\_clk\_data = { .clk\_base = rt305x\_clks\_base, .num\_clk\_base = ARRAY\_SIZE(rt305x\_clks\_base),- .clk\_fixed = rt305x\_fixed\_clocks,- .num\_clk\_fixed = ARRAY\_SIZE(rt305x\_fixed\_clocks),+ .clk\_fixed = NULL,+ .num\_clk\_fixed = 0, .clk\_factor = rt305x\_factor\_clocks, .num\_clk\_factor = ARRAY\_SIZE(rt305x\_factor\_clocks), .clk\_periph = rt305x\_pherip\_clks, |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 19:12:45 +0000



=== Content from git.kernel.org_82d4c35f_20250114_191406.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=d34db686a3d74bd564bfce2ada15011c556269fc)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=d34db686a3d74bd564bfce2ada15011c556269fc)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=d34db686a3d74bd564bfce2ada15011c556269fc)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=d34db686a3d74bd564bfce2ada15011c556269fc)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Sergio Paracuellos <sergio.paracuellos@gmail.com> | 2024-09-10 06:40:23 +0200 |
| --- | --- | --- |
| committer | Stephen Boyd <sboyd@kernel.org> | 2024-11-14 12:49:29 -0800 |
| commit | [d34db686a3d74bd564bfce2ada15011c556269fc](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=d34db686a3d74bd564bfce2ada15011c556269fc) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=d34db686a3d74bd564bfce2ada15011c556269fc)) | |
| tree | [982fb11d20af08de465bccbc5c5aa873a6359b42](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=d34db686a3d74bd564bfce2ada15011c556269fc) | |
| parent | [33239152305567b3e9bf052f71fd4baecd626341](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=33239152305567b3e9bf052f71fd4baecd626341) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=d34db686a3d74bd564bfce2ada15011c556269fc&id2=33239152305567b3e9bf052f71fd4baecd626341)) | |
| download | [linux-d34db686a3d74bd564bfce2ada15011c556269fc.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-d34db686a3d74bd564bfce2ada15011c556269fc.tar.gz) | |

clk: ralink: mtmips: fix clocks probe order in oldest ralink SoCsBase clocks are the first in being probed and are real dependencies of the
rest of fixed, factor and peripheral clocks. For old ralink SoCs RT2880,
RT305x and RT3883 'xtal' must be defined first since in any other case,
when fixed clocks are probed they are delayed until 'xtal' is probed so the
following warning appears:
WARNING: CPU: 0 PID: 0 at drivers/clk/ralink/clk-mtmips.c:499 rt3883\_bus\_recalc\_rate+0x98/0x138
Modules linked in:
CPU: 0 PID: 0 Comm: swapper Not tainted 6.6.43 #0
Stack : 805e58d0 00000000 00000004 8004f950 00000000 00000004 00000000 00000000
80669c54 80830000 80700000 805ae570 80670068 00000001 80669bf8 00000000
00000000 00000000 805ae570 80669b38 00000020 804db7dc 00000000 00000000
203a6d6d 80669b78 80669e48 70617773 00000000 805ae570 00000000 00000009
00000000 00000001 00000004 00000001 00000000 00000000 83fe43b0 00000000
...
Call Trace:
[<800065d0>] show\_stack+0x64/0xf4
[<804bca14>] dump\_stack\_lvl+0x38/0x60
[<800218ac>] \_\_warn+0x94/0xe4
[<8002195c>] warn\_slowpath\_fmt+0x60/0x94
[<80259ff8>] rt3883\_bus\_recalc\_rate+0x98/0x138
[<80254530>] \_\_clk\_register+0x568/0x688
[<80254838>] of\_clk\_hw\_register+0x18/0x2c
[<8070b910>] rt2880\_clk\_of\_clk\_init\_driver+0x18c/0x594
[<8070b628>] of\_clk\_init+0x1c0/0x23c
[<806fc448>] plat\_time\_init+0x58/0x18c
[<806fdaf0>] time\_init+0x10/0x6c
[<806f9bc4>] start\_kernel+0x458/0x67c
---[ end trace 0000000000000000 ]---
When this driver was mainlined we could not find any active users of old
ralink SoCs so we cannot perform any real tests for them. Now, one user
of a Belkin f9k1109 version 1 device which uses RT3883 SoC appeared and
reported some issues in openWRT:
- https://github.com/openwrt/openwrt/issues/16054
Thus, define a 'rt2880\_xtal\_recalc\_rate()' just returning the expected
frequency 40Mhz and use it along the old ralink SoCs to have a correct
boot trace with no warnings and a working clock plan from the beggining.
Fixes: 6f3b15586eef ("clk: ralink: add clock and reset driver for MTMIPS SoCs")
Signed-off-by: Sergio Paracuellos <sergio.paracuellos@gmail.com>
Link: [https://lore.kernel.org/r/20240910044024.120009-3-sergio.paracuellos@gmail.com](https://lore.kernel.org/r/20240910044024.120009-3-sergio.paracuellos%40gmail.com)
Signed-off-by: Stephen Boyd <sboyd@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=d34db686a3d74bd564bfce2ada15011c556269fc)

| -rw-r--r-- | [drivers/clk/ralink/clk-mtmips.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/clk/ralink/clk-mtmips.c?id=d34db686a3d74bd564bfce2ada15011c556269fc) | 21 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 13 insertions, 8 deletions

| diff --git a/drivers/clk/ralink/clk-mtmips.c b/drivers/clk/ralink/clk-mtmips.cindex 62f9801ecd3a4c..76285fbbdeaa2d 100644--- a/[drivers/clk/ralink/clk-mtmips.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/clk/ralink/clk-mtmips.c?id=33239152305567b3e9bf052f71fd4baecd626341)+++ b/[drivers/clk/ralink/clk-mtmips.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/clk/ralink/clk-mtmips.c?id=d34db686a3d74bd564bfce2ada15011c556269fc)@@ -263,10 +263,6 @@ err\_clk\_unreg: .rate = \_rate \ } -static struct mtmips\_clk\_fixed rt305x\_fixed\_clocks[] = {- CLK\_FIXED("xtal", NULL, 40000000)-};- static struct mtmips\_clk\_fixed rt3883\_fixed\_clocks[] = { CLK\_FIXED("xtal", NULL, 40000000), CLK\_FIXED("periph", "xtal", 40000000)@@ -371,6 +367,12 @@ static inline struct mtmips\_clk \*to\_mtmips\_clk(struct clk\_hw \*hw) return container\_of(hw, struct mtmips\_clk, hw); } +static unsigned long rt2880\_xtal\_recalc\_rate(struct clk\_hw \*hw,+ unsigned long parent\_rate)+{+ return 40000000;+}+ static unsigned long rt5350\_xtal\_recalc\_rate(struct clk\_hw \*hw, unsigned long parent\_rate) {@@ -682,10 +684,12 @@ static unsigned long mt76x8\_cpu\_recalc\_rate(struct clk\_hw \*hw, }  static struct mtmips\_clk rt2880\_clks\_base[] = {+ { CLK\_BASE("xtal", NULL, rt2880\_xtal\_recalc\_rate) }, { CLK\_BASE("cpu", "xtal", rt2880\_cpu\_recalc\_rate) } };  static struct mtmips\_clk rt305x\_clks\_base[] = {+ { CLK\_BASE("xtal", NULL, rt2880\_xtal\_recalc\_rate) }, { CLK\_BASE("cpu", "xtal", rt305x\_cpu\_recalc\_rate) } }; @@ -695,6 +699,7 @@ static struct mtmips\_clk rt3352\_clks\_base[] = { };  static struct mtmips\_clk rt3883\_clks\_base[] = {+ { CLK\_BASE("xtal", NULL, rt2880\_xtal\_recalc\_rate) }, { CLK\_BASE("cpu", "xtal", rt3883\_cpu\_recalc\_rate) }, { CLK\_BASE("bus", "cpu", rt3883\_bus\_recalc\_rate) } };@@ -751,8 +756,8 @@ err\_clk\_unreg: static const struct mtmips\_clk\_data rt2880\_clk\_data = { .clk\_base = rt2880\_clks\_base, .num\_clk\_base = ARRAY\_SIZE(rt2880\_clks\_base),- .clk\_fixed = rt305x\_fixed\_clocks,- .num\_clk\_fixed = ARRAY\_SIZE(rt305x\_fixed\_clocks),+ .clk\_fixed = NULL,+ .num\_clk\_fixed = 0, .clk\_factor = rt2880\_factor\_clocks, .num\_clk\_factor = ARRAY\_SIZE(rt2880\_factor\_clocks), .clk\_periph = rt2880\_pherip\_clks,@@ -762,8 +767,8 @@ static const struct mtmips\_clk\_data rt2880\_clk\_data = { static const struct mtmips\_clk\_data rt305x\_clk\_data = { .clk\_base = rt305x\_clks\_base, .num\_clk\_base = ARRAY\_SIZE(rt305x\_clks\_base),- .clk\_fixed = rt305x\_fixed\_clocks,- .num\_clk\_fixed = ARRAY\_SIZE(rt305x\_fixed\_clocks),+ .clk\_fixed = NULL,+ .num\_clk\_fixed = 0, .clk\_factor = rt305x\_factor\_clocks, .num\_clk\_factor = ARRAY\_SIZE(rt305x\_factor\_clocks), .clk\_periph = rt305x\_pherip\_clks, |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 19:12:42 +0000



=== Content from git.kernel.org_c395626e_20250114_191408.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=fbb13732c6ffa9d58cedafabcd5ce8fd7ef8ae5a)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=fbb13732c6ffa9d58cedafabcd5ce8fd7ef8ae5a)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=fbb13732c6ffa9d58cedafabcd5ce8fd7ef8ae5a)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=fbb13732c6ffa9d58cedafabcd5ce8fd7ef8ae5a)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Sergio Paracuellos <sergio.paracuellos@gmail.com> | 2024-09-10 06:40:23 +0200 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-09 10:32:22 +0100 |
| commit | [fbb13732c6ffa9d58cedafabcd5ce8fd7ef8ae5a](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=fbb13732c6ffa9d58cedafabcd5ce8fd7ef8ae5a) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=fbb13732c6ffa9d58cedafabcd5ce8fd7ef8ae5a)) | |
| tree | [91e56f318b6704dcb85ad3e4356cdafbc2061a58](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=fbb13732c6ffa9d58cedafabcd5ce8fd7ef8ae5a) | |
| parent | [f85a1d06afbcc57ac44176db8f9d7a934979952c](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=f85a1d06afbcc57ac44176db8f9d7a934979952c) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=fbb13732c6ffa9d58cedafabcd5ce8fd7ef8ae5a&id2=f85a1d06afbcc57ac44176db8f9d7a934979952c)) | |
| download | [linux-fbb13732c6ffa9d58cedafabcd5ce8fd7ef8ae5a.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-fbb13732c6ffa9d58cedafabcd5ce8fd7ef8ae5a.tar.gz) | |

clk: ralink: mtmips: fix clocks probe order in oldest ralink SoCs[ Upstream commit d34db686a3d74bd564bfce2ada15011c556269fc ]
Base clocks are the first in being probed and are real dependencies of the
rest of fixed, factor and peripheral clocks. For old ralink SoCs RT2880,
RT305x and RT3883 'xtal' must be defined first since in any other case,
when fixed clocks are probed they are delayed until 'xtal' is probed so the
following warning appears:
WARNING: CPU: 0 PID: 0 at drivers/clk/ralink/clk-mtmips.c:499 rt3883\_bus\_recalc\_rate+0x98/0x138
Modules linked in:
CPU: 0 PID: 0 Comm: swapper Not tainted 6.6.43 #0
Stack : 805e58d0 00000000 00000004 8004f950 00000000 00000004 00000000 00000000
80669c54 80830000 80700000 805ae570 80670068 00000001 80669bf8 00000000
00000000 00000000 805ae570 80669b38 00000020 804db7dc 00000000 00000000
203a6d6d 80669b78 80669e48 70617773 00000000 805ae570 00000000 00000009
00000000 00000001 00000004 00000001 00000000 00000000 83fe43b0 00000000
...
Call Trace:
[<800065d0>] show\_stack+0x64/0xf4
[<804bca14>] dump\_stack\_lvl+0x38/0x60
[<800218ac>] \_\_warn+0x94/0xe4
[<8002195c>] warn\_slowpath\_fmt+0x60/0x94
[<80259ff8>] rt3883\_bus\_recalc\_rate+0x98/0x138
[<80254530>] \_\_clk\_register+0x568/0x688
[<80254838>] of\_clk\_hw\_register+0x18/0x2c
[<8070b910>] rt2880\_clk\_of\_clk\_init\_driver+0x18c/0x594
[<8070b628>] of\_clk\_init+0x1c0/0x23c
[<806fc448>] plat\_time\_init+0x58/0x18c
[<806fdaf0>] time\_init+0x10/0x6c
[<806f9bc4>] start\_kernel+0x458/0x67c
---[ end trace 0000000000000000 ]---
When this driver was mainlined we could not find any active users of old
ralink SoCs so we cannot perform any real tests for them. Now, one user
of a Belkin f9k1109 version 1 device which uses RT3883 SoC appeared and
reported some issues in openWRT:
- https://github.com/openwrt/openwrt/issues/16054
Thus, define a 'rt2880\_xtal\_recalc\_rate()' just returning the expected
frequency 40Mhz and use it along the old ralink SoCs to have a correct
boot trace with no warnings and a working clock plan from the beggining.
Fixes: 6f3b15586eef ("clk: ralink: add clock and reset driver for MTMIPS SoCs")
Signed-off-by: Sergio Paracuellos <sergio.paracuellos@gmail.com>
Link: [https://lore.kernel.org/r/20240910044024.120009-3-sergio.paracuellos@gmail.com](https://lore.kernel.org/r/20240910044024.120009-3-sergio.paracuellos%40gmail.com)
Signed-off-by: Stephen Boyd <sboyd@kernel.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=fbb13732c6ffa9d58cedafabcd5ce8fd7ef8ae5a)

| -rw-r--r-- | [drivers/clk/ralink/clk-mtmips.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/clk/ralink/clk-mtmips.c?id=fbb13732c6ffa9d58cedafabcd5ce8fd7ef8ae5a) | 21 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 13 insertions, 8 deletions

| diff --git a/drivers/clk/ralink/clk-mtmips.c b/drivers/clk/ralink/clk-mtmips.cindex 62f9801ecd3a4c..76285fbbdeaa2d 100644--- a/[drivers/clk/ralink/clk-mtmips.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/clk/ralink/clk-mtmips.c?id=f85a1d06afbcc57ac44176db8f9d7a934979952c)+++ b/[drivers/clk/ralink/clk-mtmips.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/clk/ralink/clk-mtmips.c?id=fbb13732c6ffa9d58cedafabcd5ce8fd7ef8ae5a)@@ -263,10 +263,6 @@ err\_clk\_unreg: .rate = \_rate \ } -static struct mtmips\_clk\_fixed rt305x\_fixed\_clocks[] = {- CLK\_FIXED("xtal", NULL, 40000000)-};- static struct mtmips\_clk\_fixed rt3883\_fixed\_clocks[] = { CLK\_FIXED("xtal", NULL, 40000000), CLK\_FIXED("periph", "xtal", 40000000)@@ -371,6 +367,12 @@ static inline struct mtmips\_clk \*to\_mtmips\_clk(struct clk\_hw \*hw) return container\_of(hw, struct mtmips\_clk, hw); } +static unsigned long rt2880\_xtal\_recalc\_rate(struct clk\_hw \*hw,+ unsigned long parent\_rate)+{+ return 40000000;+}+ static unsigned long rt5350\_xtal\_recalc\_rate(struct clk\_hw \*hw, unsigned long parent\_rate) {@@ -682,10 +684,12 @@ static unsigned long mt76x8\_cpu\_recalc\_rate(struct clk\_hw \*hw, }  static struct mtmips\_clk rt2880\_clks\_base[] = {+ { CLK\_BASE("xtal", NULL, rt2880\_xtal\_recalc\_rate) }, { CLK\_BASE("cpu", "xtal", rt2880\_cpu\_recalc\_rate) } };  static struct mtmips\_clk rt305x\_clks\_base[] = {+ { CLK\_BASE("xtal", NULL, rt2880\_xtal\_recalc\_rate) }, { CLK\_BASE("cpu", "xtal", rt305x\_cpu\_recalc\_rate) } }; @@ -695,6 +699,7 @@ static struct mtmips\_clk rt3352\_clks\_base[] = { };  static struct mtmips\_clk rt3883\_clks\_base[] = {+ { CLK\_BASE("xtal", NULL, rt2880\_xtal\_recalc\_rate) }, { CLK\_BASE("cpu", "xtal", rt3883\_cpu\_recalc\_rate) }, { CLK\_BASE("bus", "cpu", rt3883\_bus\_recalc\_rate) } };@@ -751,8 +756,8 @@ err\_clk\_unreg: static const struct mtmips\_clk\_data rt2880\_clk\_data = { .clk\_base = rt2880\_clks\_base, .num\_clk\_base = ARRAY\_SIZE(rt2880\_clks\_base),- .clk\_fixed = rt305x\_fixed\_clocks,- .num\_clk\_fixed = ARRAY\_SIZE(rt305x\_fixed\_clocks),+ .clk\_fixed = NULL,+ .num\_clk\_fixed = 0, .clk\_factor = rt2880\_factor\_clocks, .num\_clk\_factor = ARRAY\_SIZE(rt2880\_factor\_clocks), .clk\_periph = rt2880\_pherip\_clks,@@ -762,8 +767,8 @@ static const struct mtmips\_clk\_data rt2880\_clk\_data = { static const struct mtmips\_clk\_data rt305x\_clk\_data = { .clk\_base = rt305x\_clks\_base, .num\_clk\_base = ARRAY\_SIZE(rt305x\_clks\_base),- .clk\_fixed = rt305x\_fixed\_clocks,- .num\_clk\_fixed = ARRAY\_SIZE(rt305x\_fixed\_clocks),+ .clk\_fixed = NULL,+ .num\_clk\_fixed = 0, .clk\_factor = rt305x\_factor\_clocks, .num\_clk\_factor = ARRAY\_SIZE(rt305x\_factor\_clocks), .clk\_periph = rt305x\_pherip\_clks, |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 19:12:45 +0000


