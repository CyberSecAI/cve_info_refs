=== Content from git.kernel.org_ab5fa792_20250115_091249.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=9c17085fabbde2041c893d29599800f2d4992b23)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=9c17085fabbde2041c893d29599800f2d4992b23)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=9c17085fabbde2041c893d29599800f2d4992b23)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=9c17085fabbde2041c893d29599800f2d4992b23)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Mauro Carvalho Chehab <mchehab+huawei@kernel.org> | 2024-10-15 15:23:01 +0200 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-11-14 13:21:01 +0100 |
| commit | [9c17085fabbde2041c893d29599800f2d4992b23](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=9c17085fabbde2041c893d29599800f2d4992b23) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=9c17085fabbde2041c893d29599800f2d4992b23)) | |
| tree | [74e23952e72902835a609a5bb396435975b66659](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=9c17085fabbde2041c893d29599800f2d4992b23) | |
| parent | [76a2ce1f8b9fd823e7b8b943132fe40df8d5f3e8](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=76a2ce1f8b9fd823e7b8b943132fe40df8d5f3e8) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=9c17085fabbde2041c893d29599800f2d4992b23&id2=76a2ce1f8b9fd823e7b8b943132fe40df8d5f3e8)) | |
| download | [linux-9c17085fabbde2041c893d29599800f2d4992b23.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-9c17085fabbde2041c893d29599800f2d4992b23.tar.gz) | |

media: dvbdev: prevent the risk of out of memory access[ Upstream commit 972e63e895abbe8aa1ccbdbb4e6362abda7cd457 ]
The dvbdev contains a static variable used to store dvb minors.
The behavior of it depends if CONFIG\_DVB\_DYNAMIC\_MINORS is set
or not. When not set, dvb\_register\_device() won't check for
boundaries, as it will rely that a previous call to
dvb\_register\_adapter() would already be enforcing it.
On a similar way, dvb\_device\_open() uses the assumption
that the register functions already did the needed checks.
This can be fragile if some device ends using different
calls. This also generate warnings on static check analysers
like Coverity.
So, add explicit guards to prevent potential risk of OOM issues.
Fixes: 5dd3f3071070 ("V4L/DVB (9361): Dynamic DVB minor allocation")
Signed-off-by: Mauro Carvalho Chehab <mchehab+huawei@kernel.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=9c17085fabbde2041c893d29599800f2d4992b23)

| -rw-r--r-- | [drivers/media/dvb-core/dvbdev.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/media/dvb-core/dvbdev.c?id=9c17085fabbde2041c893d29599800f2d4992b23) | 17 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 15 insertions, 2 deletions

| diff --git a/drivers/media/dvb-core/dvbdev.c b/drivers/media/dvb-core/dvbdev.cindex b43695bc51e754..14f323fbada719 100644--- a/[drivers/media/dvb-core/dvbdev.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/media/dvb-core/dvbdev.c?id=76a2ce1f8b9fd823e7b8b943132fe40df8d5f3e8)+++ b/[drivers/media/dvb-core/dvbdev.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/media/dvb-core/dvbdev.c?id=9c17085fabbde2041c893d29599800f2d4992b23)@@ -86,10 +86,15 @@ static DECLARE\_RWSEM(minor\_rwsem); static int dvb\_device\_open(struct inode \*inode, struct file \*file) { struct dvb\_device \*dvbdev;+ unsigned int minor = iminor(inode);++ if (minor >= MAX\_DVB\_MINORS)+ return -ENODEV;  mutex\_lock(&dvbdev\_mutex); down\_read(&minor\_rwsem);- dvbdev = dvb\_minors[iminor(inode)];++ dvbdev = dvb\_minors[minor];  if (dvbdev && dvbdev->fops) { int err = 0;@@ -525,7 +530,7 @@ int dvb\_register\_device(struct dvb\_adapter \*adap, struct dvb\_device \*\*pdvbdev, for (minor = 0; minor < MAX\_DVB\_MINORS; minor++) if (!dvb\_minors[minor]) break;- if (minor == MAX\_DVB\_MINORS) {+ if (minor >= MAX\_DVB\_MINORS) { if (new\_node) { list\_del(&new\_node->list\_head); kfree(dvbdevfops);@@ -540,6 +545,14 @@ int dvb\_register\_device(struct dvb\_adapter \*adap, struct dvb\_device \*\*pdvbdev, } #else minor = nums2minor(adap->num, type, id);+ if (minor >= MAX\_DVB\_MINORS) {+ dvb\_media\_device\_free(dvbdev);+ list\_del(&dvbdev->list\_head);+ kfree(dvbdev);+ \*pdvbdev = NULL;+ mutex\_unlock(&dvbdev\_register\_lock);+ return ret;+ } #endif dvbdev->minor = minor; dvb\_minors[minor] = dvb\_device\_get(dvbdev); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-15 09:11:26 +0000



=== Content from git.kernel.org_12947802_20250115_091248.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=972e63e895abbe8aa1ccbdbb4e6362abda7cd457)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=972e63e895abbe8aa1ccbdbb4e6362abda7cd457)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=972e63e895abbe8aa1ccbdbb4e6362abda7cd457)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=972e63e895abbe8aa1ccbdbb4e6362abda7cd457)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Mauro Carvalho Chehab <mchehab+huawei@kernel.org> | 2024-10-15 15:23:01 +0200 |
| --- | --- | --- |
| committer | Mauro Carvalho Chehab <mchehab+huawei@kernel.org> | 2024-10-18 10:43:03 +0200 |
| commit | [972e63e895abbe8aa1ccbdbb4e6362abda7cd457](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=972e63e895abbe8aa1ccbdbb4e6362abda7cd457) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=972e63e895abbe8aa1ccbdbb4e6362abda7cd457)) | |
| tree | [42e2ca9dcddd8c93a1f5b30280ca6763df5ed13d](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=972e63e895abbe8aa1ccbdbb4e6362abda7cd457) | |
| parent | [e6a3ea83fbe15d4818d01804e904cbb0e64e543b](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=e6a3ea83fbe15d4818d01804e904cbb0e64e543b) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=972e63e895abbe8aa1ccbdbb4e6362abda7cd457&id2=e6a3ea83fbe15d4818d01804e904cbb0e64e543b)) | |
| download | [linux-972e63e895abbe8aa1ccbdbb4e6362abda7cd457.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-972e63e895abbe8aa1ccbdbb4e6362abda7cd457.tar.gz) | |

media: dvbdev: prevent the risk of out of memory accessThe dvbdev contains a static variable used to store dvb minors.
The behavior of it depends if CONFIG\_DVB\_DYNAMIC\_MINORS is set
or not. When not set, dvb\_register\_device() won't check for
boundaries, as it will rely that a previous call to
dvb\_register\_adapter() would already be enforcing it.
On a similar way, dvb\_device\_open() uses the assumption
that the register functions already did the needed checks.
This can be fragile if some device ends using different
calls. This also generate warnings on static check analysers
like Coverity.
So, add explicit guards to prevent potential risk of OOM issues.
Fixes: 5dd3f3071070 ("V4L/DVB (9361): Dynamic DVB minor allocation")
Signed-off-by: Mauro Carvalho Chehab <mchehab+huawei@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=972e63e895abbe8aa1ccbdbb4e6362abda7cd457)

| -rw-r--r-- | [drivers/media/dvb-core/dvbdev.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/media/dvb-core/dvbdev.c?id=972e63e895abbe8aa1ccbdbb4e6362abda7cd457) | 17 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 15 insertions, 2 deletions

| diff --git a/drivers/media/dvb-core/dvbdev.c b/drivers/media/dvb-core/dvbdev.cindex b43695bc51e754..14f323fbada719 100644--- a/[drivers/media/dvb-core/dvbdev.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/media/dvb-core/dvbdev.c?id=e6a3ea83fbe15d4818d01804e904cbb0e64e543b)+++ b/[drivers/media/dvb-core/dvbdev.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/media/dvb-core/dvbdev.c?id=972e63e895abbe8aa1ccbdbb4e6362abda7cd457)@@ -86,10 +86,15 @@ static DECLARE\_RWSEM(minor\_rwsem); static int dvb\_device\_open(struct inode \*inode, struct file \*file) { struct dvb\_device \*dvbdev;+ unsigned int minor = iminor(inode);++ if (minor >= MAX\_DVB\_MINORS)+ return -ENODEV;  mutex\_lock(&dvbdev\_mutex); down\_read(&minor\_rwsem);- dvbdev = dvb\_minors[iminor(inode)];++ dvbdev = dvb\_minors[minor];  if (dvbdev && dvbdev->fops) { int err = 0;@@ -525,7 +530,7 @@ int dvb\_register\_device(struct dvb\_adapter \*adap, struct dvb\_device \*\*pdvbdev, for (minor = 0; minor < MAX\_DVB\_MINORS; minor++) if (!dvb\_minors[minor]) break;- if (minor == MAX\_DVB\_MINORS) {+ if (minor >= MAX\_DVB\_MINORS) { if (new\_node) { list\_del(&new\_node->list\_head); kfree(dvbdevfops);@@ -540,6 +545,14 @@ int dvb\_register\_device(struct dvb\_adapter \*adap, struct dvb\_device \*\*pdvbdev, } #else minor = nums2minor(adap->num, type, id);+ if (minor >= MAX\_DVB\_MINORS) {+ dvb\_media\_device\_free(dvbdev);+ list\_del(&dvbdev->list\_head);+ kfree(dvbdev);+ \*pdvbdev = NULL;+ mutex\_unlock(&dvbdev\_register\_lock);+ return ret;+ } #endif dvbdev->minor = minor; dvb\_minors[minor] = dvb\_device\_get(dvbdev); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-15 09:11:25 +0000



=== Content from git.kernel.org_d3b43b50_20250115_091252.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=b751a96025275c17f04083cbfe856822f1658946)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=b751a96025275c17f04083cbfe856822f1658946)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=b751a96025275c17f04083cbfe856822f1658946)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b751a96025275c17f04083cbfe856822f1658946)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Mauro Carvalho Chehab <mchehab+huawei@kernel.org> | 2024-10-15 15:23:01 +0200 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-11-14 13:15:12 +0100 |
| commit | [b751a96025275c17f04083cbfe856822f1658946](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=b751a96025275c17f04083cbfe856822f1658946) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=b751a96025275c17f04083cbfe856822f1658946)) | |
| tree | [adc757dec1a227b14244ccb87feb265ae40516ba](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=b751a96025275c17f04083cbfe856822f1658946) | |
| parent | [d6386b279d7581a1e04454e9cb5ac303157082d3](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=d6386b279d7581a1e04454e9cb5ac303157082d3) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b751a96025275c17f04083cbfe856822f1658946&id2=d6386b279d7581a1e04454e9cb5ac303157082d3)) | |
| download | [linux-b751a96025275c17f04083cbfe856822f1658946.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-b751a96025275c17f04083cbfe856822f1658946.tar.gz) | |

media: dvbdev: prevent the risk of out of memory access[ Upstream commit 972e63e895abbe8aa1ccbdbb4e6362abda7cd457 ]
The dvbdev contains a static variable used to store dvb minors.
The behavior of it depends if CONFIG\_DVB\_DYNAMIC\_MINORS is set
or not. When not set, dvb\_register\_device() won't check for
boundaries, as it will rely that a previous call to
dvb\_register\_adapter() would already be enforcing it.
On a similar way, dvb\_device\_open() uses the assumption
that the register functions already did the needed checks.
This can be fragile if some device ends using different
calls. This also generate warnings on static check analysers
like Coverity.
So, add explicit guards to prevent potential risk of OOM issues.
Fixes: 5dd3f3071070 ("V4L/DVB (9361): Dynamic DVB minor allocation")
Signed-off-by: Mauro Carvalho Chehab <mchehab+huawei@kernel.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b751a96025275c17f04083cbfe856822f1658946)

| -rw-r--r-- | [drivers/media/dvb-core/dvbdev.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/media/dvb-core/dvbdev.c?id=b751a96025275c17f04083cbfe856822f1658946) | 17 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 15 insertions, 2 deletions

| diff --git a/drivers/media/dvb-core/dvbdev.c b/drivers/media/dvb-core/dvbdev.cindex 04b7ce479fc381..d1212acb70932d 100644--- a/[drivers/media/dvb-core/dvbdev.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/media/dvb-core/dvbdev.c?id=d6386b279d7581a1e04454e9cb5ac303157082d3)+++ b/[drivers/media/dvb-core/dvbdev.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/media/dvb-core/dvbdev.c?id=b751a96025275c17f04083cbfe856822f1658946)@@ -86,10 +86,15 @@ static DECLARE\_RWSEM(minor\_rwsem); static int dvb\_device\_open(struct inode \*inode, struct file \*file) { struct dvb\_device \*dvbdev;+ unsigned int minor = iminor(inode);++ if (minor >= MAX\_DVB\_MINORS)+ return -ENODEV;  mutex\_lock(&dvbdev\_mutex); down\_read(&minor\_rwsem);- dvbdev = dvb\_minors[iminor(inode)];++ dvbdev = dvb\_minors[minor];  if (dvbdev && dvbdev->fops) { int err = 0;@@ -529,7 +534,7 @@ int dvb\_register\_device(struct dvb\_adapter \*adap, struct dvb\_device \*\*pdvbdev, for (minor = 0; minor < MAX\_DVB\_MINORS; minor++) if (dvb\_minors[minor] == NULL) break;- if (minor == MAX\_DVB\_MINORS) {+ if (minor >= MAX\_DVB\_MINORS) { if (new\_node) { list\_del (&new\_node->list\_head); kfree(dvbdevfops);@@ -544,6 +549,14 @@ int dvb\_register\_device(struct dvb\_adapter \*adap, struct dvb\_device \*\*pdvbdev, } #else minor = nums2minor(adap->num, type, id);+ if (minor >= MAX\_DVB\_MINORS) {+ dvb\_media\_device\_free(dvbdev);+ list\_del(&dvbdev->list\_head);+ kfree(dvbdev);+ \*pdvbdev = NULL;+ mutex\_unlock(&dvbdev\_register\_lock);+ return ret;+ } #endif dvbdev->minor = minor; dvb\_minors[minor] = dvb\_device\_get(dvbdev); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-15 09:11:29 +0000



=== Content from git.kernel.org_0e7208d8_20250115_091253.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=fedfde9deb83ac8d2f3d5f36f111023df34b1684)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=fedfde9deb83ac8d2f3d5f36f111023df34b1684)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=fedfde9deb83ac8d2f3d5f36f111023df34b1684)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=fedfde9deb83ac8d2f3d5f36f111023df34b1684)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Mauro Carvalho Chehab <mchehab+huawei@kernel.org> | 2024-10-15 15:23:01 +0200 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-11-17 14:58:06 +0100 |
| commit | [fedfde9deb83ac8d2f3d5f36f111023df34b1684](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=fedfde9deb83ac8d2f3d5f36f111023df34b1684) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=fedfde9deb83ac8d2f3d5f36f111023df34b1684)) | |
| tree | [8be0e782d2c72ca81b8598c0e8d0f8e0765022f2](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=fedfde9deb83ac8d2f3d5f36f111023df34b1684) | |
| parent | [12d05b707489f251d46b190f518de3afe5b8c9e9](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=12d05b707489f251d46b190f518de3afe5b8c9e9) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=fedfde9deb83ac8d2f3d5f36f111023df34b1684&id2=12d05b707489f251d46b190f518de3afe5b8c9e9)) | |
| download | [linux-fedfde9deb83ac8d2f3d5f36f111023df34b1684.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-fedfde9deb83ac8d2f3d5f36f111023df34b1684.tar.gz) | |

media: dvbdev: prevent the risk of out of memory access[ Upstream commit 972e63e895abbe8aa1ccbdbb4e6362abda7cd457 ]
The dvbdev contains a static variable used to store dvb minors.
The behavior of it depends if CONFIG\_DVB\_DYNAMIC\_MINORS is set
or not. When not set, dvb\_register\_device() won't check for
boundaries, as it will rely that a previous call to
dvb\_register\_adapter() would already be enforcing it.
On a similar way, dvb\_device\_open() uses the assumption
that the register functions already did the needed checks.
This can be fragile if some device ends using different
calls. This also generate warnings on static check analysers
like Coverity.
So, add explicit guards to prevent potential risk of OOM issues.
Fixes: 5dd3f3071070 ("V4L/DVB (9361): Dynamic DVB minor allocation")
Signed-off-by: Mauro Carvalho Chehab <mchehab+huawei@kernel.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=fedfde9deb83ac8d2f3d5f36f111023df34b1684)

| -rw-r--r-- | [drivers/media/dvb-core/dvbdev.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/media/dvb-core/dvbdev.c?id=fedfde9deb83ac8d2f3d5f36f111023df34b1684) | 17 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 15 insertions, 2 deletions

| diff --git a/drivers/media/dvb-core/dvbdev.c b/drivers/media/dvb-core/dvbdev.cindex 5124f412c05dc2..49d55c5bf717fb 100644--- a/[drivers/media/dvb-core/dvbdev.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/media/dvb-core/dvbdev.c?id=12d05b707489f251d46b190f518de3afe5b8c9e9)+++ b/[drivers/media/dvb-core/dvbdev.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/media/dvb-core/dvbdev.c?id=fedfde9deb83ac8d2f3d5f36f111023df34b1684)@@ -96,10 +96,15 @@ static DECLARE\_RWSEM(minor\_rwsem); static int dvb\_device\_open(struct inode \*inode, struct file \*file) { struct dvb\_device \*dvbdev;+ unsigned int minor = iminor(inode);++ if (minor >= MAX\_DVB\_MINORS)+ return -ENODEV;  mutex\_lock(&dvbdev\_mutex); down\_read(&minor\_rwsem);- dvbdev = dvb\_minors[iminor(inode)];++ dvbdev = dvb\_minors[minor];  if (dvbdev && dvbdev->fops) { int err = 0;@@ -539,7 +544,7 @@ int dvb\_register\_device(struct dvb\_adapter \*adap, struct dvb\_device \*\*pdvbdev, for (minor = 0; minor < MAX\_DVB\_MINORS; minor++) if (dvb\_minors[minor] == NULL) break;- if (minor == MAX\_DVB\_MINORS) {+ if (minor >= MAX\_DVB\_MINORS) { if (new\_node) { list\_del (&new\_node->list\_head); kfree(dvbdevfops);@@ -554,6 +559,14 @@ int dvb\_register\_device(struct dvb\_adapter \*adap, struct dvb\_device \*\*pdvbdev, } #else minor = nums2minor(adap->num, type, id);+ if (minor >= MAX\_DVB\_MINORS) {+ dvb\_media\_device\_free(dvbdev);+ list\_del(&dvbdev->list\_head);+ kfree(dvbdev);+ \*pdvbdev = NULL;+ mutex\_unlock(&dvbdev\_register\_lock);+ return ret;+ } #endif dvbdev->minor = minor; dvb\_minors[minor] = dvb\_device\_get(dvbdev); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-15 09:11:30 +0000



=== Content from git.kernel.org_b0cc292e_20250115_091247.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=5f76f7df14861e3a560898fa41979ec92424b58f)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=5f76f7df14861e3a560898fa41979ec92424b58f)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=5f76f7df14861e3a560898fa41979ec92424b58f)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=5f76f7df14861e3a560898fa41979ec92424b58f)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Mauro Carvalho Chehab <mchehab+huawei@kernel.org> | 2024-10-15 15:23:01 +0200 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-11-14 13:13:37 +0100 |
| commit | [5f76f7df14861e3a560898fa41979ec92424b58f](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=5f76f7df14861e3a560898fa41979ec92424b58f) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=5f76f7df14861e3a560898fa41979ec92424b58f)) | |
| tree | [3026a45f29c9a0846549f8681018bbe10bc099bf](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=5f76f7df14861e3a560898fa41979ec92424b58f) | |
| parent | [2de476e842c991e3c8f635d8b589c0a188ee934b](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=2de476e842c991e3c8f635d8b589c0a188ee934b) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=5f76f7df14861e3a560898fa41979ec92424b58f&id2=2de476e842c991e3c8f635d8b589c0a188ee934b)) | |
| download | [linux-5f76f7df14861e3a560898fa41979ec92424b58f.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-5f76f7df14861e3a560898fa41979ec92424b58f.tar.gz) | |

media: dvbdev: prevent the risk of out of memory access[ Upstream commit 972e63e895abbe8aa1ccbdbb4e6362abda7cd457 ]
The dvbdev contains a static variable used to store dvb minors.
The behavior of it depends if CONFIG\_DVB\_DYNAMIC\_MINORS is set
or not. When not set, dvb\_register\_device() won't check for
boundaries, as it will rely that a previous call to
dvb\_register\_adapter() would already be enforcing it.
On a similar way, dvb\_device\_open() uses the assumption
that the register functions already did the needed checks.
This can be fragile if some device ends using different
calls. This also generate warnings on static check analysers
like Coverity.
So, add explicit guards to prevent potential risk of OOM issues.
Fixes: 5dd3f3071070 ("V4L/DVB (9361): Dynamic DVB minor allocation")
Signed-off-by: Mauro Carvalho Chehab <mchehab+huawei@kernel.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=5f76f7df14861e3a560898fa41979ec92424b58f)

| -rw-r--r-- | [drivers/media/dvb-core/dvbdev.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/media/dvb-core/dvbdev.c?id=5f76f7df14861e3a560898fa41979ec92424b58f) | 17 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 15 insertions, 2 deletions

| diff --git a/drivers/media/dvb-core/dvbdev.c b/drivers/media/dvb-core/dvbdev.cindex 661588fc64f6a8..71344ae26fea73 100644--- a/[drivers/media/dvb-core/dvbdev.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/media/dvb-core/dvbdev.c?id=2de476e842c991e3c8f635d8b589c0a188ee934b)+++ b/[drivers/media/dvb-core/dvbdev.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/media/dvb-core/dvbdev.c?id=5f76f7df14861e3a560898fa41979ec92424b58f)@@ -96,10 +96,15 @@ static DECLARE\_RWSEM(minor\_rwsem); static int dvb\_device\_open(struct inode \*inode, struct file \*file) { struct dvb\_device \*dvbdev;+ unsigned int minor = iminor(inode);++ if (minor >= MAX\_DVB\_MINORS)+ return -ENODEV;  mutex\_lock(&dvbdev\_mutex); down\_read(&minor\_rwsem);- dvbdev = dvb\_minors[iminor(inode)];++ dvbdev = dvb\_minors[minor];  if (dvbdev && dvbdev->fops) { int err = 0;@@ -539,7 +544,7 @@ int dvb\_register\_device(struct dvb\_adapter \*adap, struct dvb\_device \*\*pdvbdev, for (minor = 0; minor < MAX\_DVB\_MINORS; minor++) if (dvb\_minors[minor] == NULL) break;- if (minor == MAX\_DVB\_MINORS) {+ if (minor >= MAX\_DVB\_MINORS) { if (new\_node) { list\_del (&new\_node->list\_head); kfree(dvbdevfops);@@ -554,6 +559,14 @@ int dvb\_register\_device(struct dvb\_adapter \*adap, struct dvb\_device \*\*pdvbdev, } #else minor = nums2minor(adap->num, type, id);+ if (minor >= MAX\_DVB\_MINORS) {+ dvb\_media\_device\_free(dvbdev);+ list\_del(&dvbdev->list\_head);+ kfree(dvbdev);+ \*pdvbdev = NULL;+ mutex\_unlock(&dvbdev\_register\_lock);+ return ret;+ } #endif dvbdev->minor = minor; dvb\_minors[minor] = dvb\_device\_get(dvbdev); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-15 09:11:25 +0000



=== Content from git.kernel.org_8a6492bc_20250115_091245.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=1e461672616b726f29261ee81bb991528818537c)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=1e461672616b726f29261ee81bb991528818537c)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=1e461672616b726f29261ee81bb991528818537c)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=1e461672616b726f29261ee81bb991528818537c)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Mauro Carvalho Chehab <mchehab+huawei@kernel.org> | 2024-10-15 15:23:01 +0200 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-11-14 13:19:33 +0100 |
| commit | [1e461672616b726f29261ee81bb991528818537c](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=1e461672616b726f29261ee81bb991528818537c) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=1e461672616b726f29261ee81bb991528818537c)) | |
| tree | [02bef4cf12ed5286b7858fcb005bdfe98e721f31](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=1e461672616b726f29261ee81bb991528818537c) | |
| parent | [c776231e3d0bd818809223c0e002f3e819f508eb](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=c776231e3d0bd818809223c0e002f3e819f508eb) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=1e461672616b726f29261ee81bb991528818537c&id2=c776231e3d0bd818809223c0e002f3e819f508eb)) | |
| download | [linux-1e461672616b726f29261ee81bb991528818537c.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-1e461672616b726f29261ee81bb991528818537c.tar.gz) | |

media: dvbdev: prevent the risk of out of memory access[ Upstream commit 972e63e895abbe8aa1ccbdbb4e6362abda7cd457 ]
The dvbdev contains a static variable used to store dvb minors.
The behavior of it depends if CONFIG\_DVB\_DYNAMIC\_MINORS is set
or not. When not set, dvb\_register\_device() won't check for
boundaries, as it will rely that a previous call to
dvb\_register\_adapter() would already be enforcing it.
On a similar way, dvb\_device\_open() uses the assumption
that the register functions already did the needed checks.
This can be fragile if some device ends using different
calls. This also generate warnings on static check analysers
like Coverity.
So, add explicit guards to prevent potential risk of OOM issues.
Fixes: 5dd3f3071070 ("V4L/DVB (9361): Dynamic DVB minor allocation")
Signed-off-by: Mauro Carvalho Chehab <mchehab+huawei@kernel.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=1e461672616b726f29261ee81bb991528818537c)

| -rw-r--r-- | [drivers/media/dvb-core/dvbdev.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/media/dvb-core/dvbdev.c?id=1e461672616b726f29261ee81bb991528818537c) | 17 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 15 insertions, 2 deletions

| diff --git a/drivers/media/dvb-core/dvbdev.c b/drivers/media/dvb-core/dvbdev.cindex b43695bc51e754..14f323fbada719 100644--- a/[drivers/media/dvb-core/dvbdev.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/media/dvb-core/dvbdev.c?id=c776231e3d0bd818809223c0e002f3e819f508eb)+++ b/[drivers/media/dvb-core/dvbdev.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/media/dvb-core/dvbdev.c?id=1e461672616b726f29261ee81bb991528818537c)@@ -86,10 +86,15 @@ static DECLARE\_RWSEM(minor\_rwsem); static int dvb\_device\_open(struct inode \*inode, struct file \*file) { struct dvb\_device \*dvbdev;+ unsigned int minor = iminor(inode);++ if (minor >= MAX\_DVB\_MINORS)+ return -ENODEV;  mutex\_lock(&dvbdev\_mutex); down\_read(&minor\_rwsem);- dvbdev = dvb\_minors[iminor(inode)];++ dvbdev = dvb\_minors[minor];  if (dvbdev && dvbdev->fops) { int err = 0;@@ -525,7 +530,7 @@ int dvb\_register\_device(struct dvb\_adapter \*adap, struct dvb\_device \*\*pdvbdev, for (minor = 0; minor < MAX\_DVB\_MINORS; minor++) if (!dvb\_minors[minor]) break;- if (minor == MAX\_DVB\_MINORS) {+ if (minor >= MAX\_DVB\_MINORS) { if (new\_node) { list\_del(&new\_node->list\_head); kfree(dvbdevfops);@@ -540,6 +545,14 @@ int dvb\_register\_device(struct dvb\_adapter \*adap, struct dvb\_device \*\*pdvbdev, } #else minor = nums2minor(adap->num, type, id);+ if (minor >= MAX\_DVB\_MINORS) {+ dvb\_media\_device\_free(dvbdev);+ list\_del(&dvbdev->list\_head);+ kfree(dvbdev);+ \*pdvbdev = NULL;+ mutex\_unlock(&dvbdev\_register\_lock);+ return ret;+ } #endif dvbdev->minor = minor; dvb\_minors[minor] = dvb\_device\_get(dvbdev); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-15 09:11:22 +0000



=== Content from git.kernel.org_253f94fe_20250115_091246.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=3b88675e18b6517043a6f734eaa8ea6eb3bfa140)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=3b88675e18b6517043a6f734eaa8ea6eb3bfa140)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=3b88675e18b6517043a6f734eaa8ea6eb3bfa140)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=3b88675e18b6517043a6f734eaa8ea6eb3bfa140)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Mauro Carvalho Chehab <mchehab+huawei@kernel.org> | 2024-10-15 15:23:01 +0200 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-11-17 14:58:50 +0100 |
| commit | [3b88675e18b6517043a6f734eaa8ea6eb3bfa140](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=3b88675e18b6517043a6f734eaa8ea6eb3bfa140) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=3b88675e18b6517043a6f734eaa8ea6eb3bfa140)) | |
| tree | [981d7d1116e4e4ed378a1b601c6a7ebbe3aef740](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=3b88675e18b6517043a6f734eaa8ea6eb3bfa140) | |
| parent | [39023c18e805773866bcf2d8aa6aa280bcbe68a1](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=39023c18e805773866bcf2d8aa6aa280bcbe68a1) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=3b88675e18b6517043a6f734eaa8ea6eb3bfa140&id2=39023c18e805773866bcf2d8aa6aa280bcbe68a1)) | |
| download | [linux-3b88675e18b6517043a6f734eaa8ea6eb3bfa140.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-3b88675e18b6517043a6f734eaa8ea6eb3bfa140.tar.gz) | |

media: dvbdev: prevent the risk of out of memory access[ Upstream commit 972e63e895abbe8aa1ccbdbb4e6362abda7cd457 ]
The dvbdev contains a static variable used to store dvb minors.
The behavior of it depends if CONFIG\_DVB\_DYNAMIC\_MINORS is set
or not. When not set, dvb\_register\_device() won't check for
boundaries, as it will rely that a previous call to
dvb\_register\_adapter() would already be enforcing it.
On a similar way, dvb\_device\_open() uses the assumption
that the register functions already did the needed checks.
This can be fragile if some device ends using different
calls. This also generate warnings on static check analysers
like Coverity.
So, add explicit guards to prevent potential risk of OOM issues.
Fixes: 5dd3f3071070 ("V4L/DVB (9361): Dynamic DVB minor allocation")
Signed-off-by: Mauro Carvalho Chehab <mchehab+huawei@kernel.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=3b88675e18b6517043a6f734eaa8ea6eb3bfa140)

| -rw-r--r-- | [drivers/media/dvb-core/dvbdev.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/media/dvb-core/dvbdev.c?id=3b88675e18b6517043a6f734eaa8ea6eb3bfa140) | 17 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 15 insertions, 2 deletions

| diff --git a/drivers/media/dvb-core/dvbdev.c b/drivers/media/dvb-core/dvbdev.cindex ba91c6f8fe1d8d..4a6e8a6b36f453 100644--- a/[drivers/media/dvb-core/dvbdev.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/media/dvb-core/dvbdev.c?id=39023c18e805773866bcf2d8aa6aa280bcbe68a1)+++ b/[drivers/media/dvb-core/dvbdev.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/media/dvb-core/dvbdev.c?id=3b88675e18b6517043a6f734eaa8ea6eb3bfa140)@@ -96,10 +96,15 @@ static DECLARE\_RWSEM(minor\_rwsem); static int dvb\_device\_open(struct inode \*inode, struct file \*file) { struct dvb\_device \*dvbdev;+ unsigned int minor = iminor(inode);++ if (minor >= MAX\_DVB\_MINORS)+ return -ENODEV;  mutex\_lock(&dvbdev\_mutex); down\_read(&minor\_rwsem);- dvbdev = dvb\_minors[iminor(inode)];++ dvbdev = dvb\_minors[minor];  if (dvbdev && dvbdev->fops) { int err = 0;@@ -539,7 +544,7 @@ int dvb\_register\_device(struct dvb\_adapter \*adap, struct dvb\_device \*\*pdvbdev, for (minor = 0; minor < MAX\_DVB\_MINORS; minor++) if (dvb\_minors[minor] == NULL) break;- if (minor == MAX\_DVB\_MINORS) {+ if (minor >= MAX\_DVB\_MINORS) { if (new\_node) { list\_del (&new\_node->list\_head); kfree(dvbdevfops);@@ -554,6 +559,14 @@ int dvb\_register\_device(struct dvb\_adapter \*adap, struct dvb\_device \*\*pdvbdev, } #else minor = nums2minor(adap->num, type, id);+ if (minor >= MAX\_DVB\_MINORS) {+ dvb\_media\_device\_free(dvbdev);+ list\_del(&dvbdev->list\_head);+ kfree(dvbdev);+ \*pdvbdev = NULL;+ mutex\_unlock(&dvbdev\_register\_lock);+ return ret;+ } #endif dvbdev->minor = minor; dvb\_minors[minor] = dvb\_device\_get(dvbdev); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-15 09:11:23 +0000



=== Content from git.kernel.org_01d74a7d_20250115_091251.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=a4a17210c03ade1c8d9a9f193a105654b7a05c11)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=a4a17210c03ade1c8d9a9f193a105654b7a05c11)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=a4a17210c03ade1c8d9a9f193a105654b7a05c11)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=a4a17210c03ade1c8d9a9f193a105654b7a05c11)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Mauro Carvalho Chehab <mchehab+huawei@kernel.org> | 2024-10-15 15:23:01 +0200 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-11-17 14:59:36 +0100 |
| commit | [a4a17210c03ade1c8d9a9f193a105654b7a05c11](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=a4a17210c03ade1c8d9a9f193a105654b7a05c11) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=a4a17210c03ade1c8d9a9f193a105654b7a05c11)) | |
| tree | [b12a6eaca21af3d9a8649b072103d5ddf58d2582](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=a4a17210c03ade1c8d9a9f193a105654b7a05c11) | |
| parent | [ae6fd157eae4444623650ef2faa40ed5463e1c47](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=ae6fd157eae4444623650ef2faa40ed5463e1c47) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=a4a17210c03ade1c8d9a9f193a105654b7a05c11&id2=ae6fd157eae4444623650ef2faa40ed5463e1c47)) | |
| download | [linux-a4a17210c03ade1c8d9a9f193a105654b7a05c11.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-a4a17210c03ade1c8d9a9f193a105654b7a05c11.tar.gz) | |

media: dvbdev: prevent the risk of out of memory access[ Upstream commit 972e63e895abbe8aa1ccbdbb4e6362abda7cd457 ]
The dvbdev contains a static variable used to store dvb minors.
The behavior of it depends if CONFIG\_DVB\_DYNAMIC\_MINORS is set
or not. When not set, dvb\_register\_device() won't check for
boundaries, as it will rely that a previous call to
dvb\_register\_adapter() would already be enforcing it.
On a similar way, dvb\_device\_open() uses the assumption
that the register functions already did the needed checks.
This can be fragile if some device ends using different
calls. This also generate warnings on static check analysers
like Coverity.
So, add explicit guards to prevent potential risk of OOM issues.
Fixes: 5dd3f3071070 ("V4L/DVB (9361): Dynamic DVB minor allocation")
Signed-off-by: Mauro Carvalho Chehab <mchehab+huawei@kernel.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=a4a17210c03ade1c8d9a9f193a105654b7a05c11)

| -rw-r--r-- | [drivers/media/dvb-core/dvbdev.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/media/dvb-core/dvbdev.c?id=a4a17210c03ade1c8d9a9f193a105654b7a05c11) | 17 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 15 insertions, 2 deletions

| diff --git a/drivers/media/dvb-core/dvbdev.c b/drivers/media/dvb-core/dvbdev.cindex 661588fc64f6a8..71344ae26fea73 100644--- a/[drivers/media/dvb-core/dvbdev.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/media/dvb-core/dvbdev.c?id=ae6fd157eae4444623650ef2faa40ed5463e1c47)+++ b/[drivers/media/dvb-core/dvbdev.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/media/dvb-core/dvbdev.c?id=a4a17210c03ade1c8d9a9f193a105654b7a05c11)@@ -96,10 +96,15 @@ static DECLARE\_RWSEM(minor\_rwsem); static int dvb\_device\_open(struct inode \*inode, struct file \*file) { struct dvb\_device \*dvbdev;+ unsigned int minor = iminor(inode);++ if (minor >= MAX\_DVB\_MINORS)+ return -ENODEV;  mutex\_lock(&dvbdev\_mutex); down\_read(&minor\_rwsem);- dvbdev = dvb\_minors[iminor(inode)];++ dvbdev = dvb\_minors[minor];  if (dvbdev && dvbdev->fops) { int err = 0;@@ -539,7 +544,7 @@ int dvb\_register\_device(struct dvb\_adapter \*adap, struct dvb\_device \*\*pdvbdev, for (minor = 0; minor < MAX\_DVB\_MINORS; minor++) if (dvb\_minors[minor] == NULL) break;- if (minor == MAX\_DVB\_MINORS) {+ if (minor >= MAX\_DVB\_MINORS) { if (new\_node) { list\_del (&new\_node->list\_head); kfree(dvbdevfops);@@ -554,6 +559,14 @@ int dvb\_register\_device(struct dvb\_adapter \*adap, struct dvb\_device \*\*pdvbdev, } #else minor = nums2minor(adap->num, type, id);+ if (minor >= MAX\_DVB\_MINORS) {+ dvb\_media\_device\_free(dvbdev);+ list\_del(&dvbdev->list\_head);+ kfree(dvbdev);+ \*pdvbdev = NULL;+ mutex\_unlock(&dvbdev\_register\_lock);+ return ret;+ } #endif dvbdev->minor = minor; dvb\_minors[minor] = dvb\_device\_get(dvbdev); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-15 09:11:27 +0000


