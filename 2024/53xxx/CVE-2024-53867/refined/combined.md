=== Content from github.com_71a872df_20250114_181908.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmatrix-org%2Fmatrix-spec-proposals%2Fpull%2F4186)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmatrix-org%2Fmatrix-spec-proposals%2Fpull%2F4186)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fpull_requests_fragments%2Fpull_request_layout&source=header-repo&source_repo=matrix-org%2Fmatrix-spec-proposals)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[matrix-org](/matrix-org)
/
**[matrix-spec-proposals](/matrix-org/matrix-spec-proposals)**
Public

* [Notifications](/login?return_to=%2Fmatrix-org%2Fmatrix-spec-proposals) You must be signed in to change notification settings
* [Fork
  385](/login?return_to=%2Fmatrix-org%2Fmatrix-spec-proposals)
* [Star
   1k](/login?return_to=%2Fmatrix-org%2Fmatrix-spec-proposals)

* [Code](/matrix-org/matrix-spec-proposals)
* [Issues
  15](/matrix-org/matrix-spec-proposals/issues)
* [Pull requests
  501](/matrix-org/matrix-spec-proposals/pulls)
* [Actions](/matrix-org/matrix-spec-proposals/actions)
* [Projects
  1](/matrix-org/matrix-spec-proposals/projects)
* [Security](/matrix-org/matrix-spec-proposals/security)
* [Insights](/matrix-org/matrix-spec-proposals/pulse)

Additional navigation options

* [Code](/matrix-org/matrix-spec-proposals)
* [Issues](/matrix-org/matrix-spec-proposals/issues)
* [Pull requests](/matrix-org/matrix-spec-proposals/pulls)
* [Actions](/matrix-org/matrix-spec-proposals/actions)
* [Projects](/matrix-org/matrix-spec-proposals/projects)
* [Security](/matrix-org/matrix-spec-proposals/security)
* [Insights](/matrix-org/matrix-spec-proposals/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Fmatrix-org%2Fmatrix-spec-proposals%2Fissues%2Fnew%2Fchoose)

By clicking ‚ÄúSign up for GitHub‚Äù, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We‚Äôll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Fmatrix-org%2Fmatrix-spec-proposals%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# MSC4186: Simplified Sliding Sync #4186

 Open

[erikjohnston](/erikjohnston)
wants to merge
5
commits into
[main](/matrix-org/matrix-spec-proposals/tree/main "matrix-org/matrix-spec-proposals:main")
*base:*
main

Choose a base branch

Branches
Tags

Could not load branches

Branch not found: **{{ refName }}**

 Loading

{{ refName }}
default

Could not load tags

Nothing to show

{{ refName }}
default

 Loading

### Are you sure you want to change the base?

Some commits from the old base branch may be removed from the timeline,
and old review comments may become outdated.

 Loading

Change base

from
[erikj/sss](/matrix-org/matrix-spec-proposals/tree/erikj/sss "matrix-org/matrix-spec-proposals:erikj/sss")

 Open

# [MSC4186: Simplified Sliding Sync](#top) #4186

[erikjohnston](/erikjohnston)
wants to merge
5
commits into
[main](/matrix-org/matrix-spec-proposals/tree/main "matrix-org/matrix-spec-proposals:main")
from
[erikj/sss](/matrix-org/matrix-spec-proposals/tree/erikj/sss "matrix-org/matrix-spec-proposals:erikj/sss")

[Conversation
69](/matrix-org/matrix-spec-proposals/pull/4186)
[Commits
5](/matrix-org/matrix-spec-proposals/pull/4186/commits)
[Checks
1](/matrix-org/matrix-spec-proposals/pull/4186/checks)
[Files changed](/matrix-org/matrix-spec-proposals/pull/4186/files)

## Conversation

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

[![erikjohnston](https://avatars.githubusercontent.com/u/8428120?s=60&v=4)](/erikjohnston)

Copy link

Member

### @erikjohnston **[erikjohnston](/erikjohnston)** commented [Aug 30, 2024](#issue-2496583666) ‚Ä¢ edited Loading

[Rendered](https://github.com/matrix-org/matrix-spec-proposals/blob/erikj/sss/proposals/4186-simplified-sliding-sync.md)

Sorry, something went wrong.

 üëç
4
 Hywan, ara4n, 6543, and melroy89 reacted with thumbs up emoji
 üéâ
8
 ara4n, morguldir, anoadragon453, Johennes, MatMaul, Hywan, ptman, and teutat3s reacted with hooray emoji
 üöÄ
4
 ara4n, MatMaul, Hywan, and erlend-sh reacted with rocket emoji

All reactions

* üëç
  4 reactions
* üéâ
  8 reactions
* üöÄ
  4 reactions

[![@erikjohnston](https://avatars.githubusercontent.com/u/8428120?s=40&v=4)](/erikjohnston)

`[Simplified sliding sync](/matrix-org/matrix-spec-proposals/pull/4186/commits/8cc34dfc550bf36ef7a71ac0da08a1ad8fd0046e "Simplified sliding sync")`

`[8cc34df](/matrix-org/matrix-spec-proposals/pull/4186/commits/8cc34dfc550bf36ef7a71ac0da08a1ad8fd0046e)`

 [![@erikjohnston](https://avatars.githubusercontent.com/u/8428120?s=40&u=bc841c19ba33f4e3b66732ec1ebf9f3c8cd64b8e&v=4)](/erikjohnston)
[erikjohnston](/erikjohnston)
[force-pushed](/matrix-org/matrix-spec-proposals/compare/806e455dd057b1fe8b6a37581c8a3a7c602d982c..8cc34dfc550bf36ef7a71ac0da08a1ad8fd0046e)
the
erikj/sss

branch
from
[`806e455`](/matrix-org/matrix-spec-proposals/commit/806e455dd057b1fe8b6a37581c8a3a7c602d982c) to
[`8cc34df`](/matrix-org/matrix-spec-proposals/commit/8cc34dfc550bf36ef7a71ac0da08a1ad8fd0046e)  [Compare](/matrix-org/matrix-spec-proposals/compare/806e455dd057b1fe8b6a37581c8a3a7c602d982c..8cc34dfc550bf36ef7a71ac0da08a1ad8fd0046e)
[August 30, 2024 09:25](#event-14078138071)

 [erikjohnston](/erikjohnston)
added 2 commits
[August 30, 2024 10:52](#commits-pushed-456db3b)

[![@erikjohnston](https://avatars.githubusercontent.com/u/8428120?s=40&v=4)](/erikjohnston)

`[Add example usage](/matrix-org/matrix-spec-proposals/pull/4186/commits/456db3b9d3b936457c9e780e439e4e6cd30f28a9 "Add example usage")`

`[456db3b](/matrix-org/matrix-spec-proposals/pull/4186/commits/456db3b9d3b936457c9e780e439e4e6cd30f28a9)`

[![@erikjohnston](https://avatars.githubusercontent.com/u/8428120?s=40&v=4)](/erikjohnston)

`[Add security and unstable prefix](/matrix-org/matrix-spec-proposals/pull/4186/commits/6fe4ba72da515f3e473be42a57a7a32f03e303f8 "Add security and unstable prefix")`

`[6fe4ba7](/matrix-org/matrix-spec-proposals/pull/4186/commits/6fe4ba72da515f3e473be42a57a7a32f03e303f8)`

 [![@erikjohnston](https://avatars.githubusercontent.com/u/8428120?s=40&u=bc841c19ba33f4e3b66732ec1ebf9f3c8cd64b8e&v=4)](/erikjohnston)
[erikjohnston](/erikjohnston)
marked this pull request as ready for review
[August 30, 2024 09:59](#event-14078624323)

[![Gnuxie](https://avatars.githubusercontent.com/u/50846879?s=60&v=4)](/Gnuxie)

**[Gnuxie](/Gnuxie)**
reviewed
[Aug 30, 2024](#pullrequestreview-2272120694)

 [View reviewed changes](/matrix-org/matrix-spec-proposals/pull/4186/files/6fe4ba72da515f3e473be42a57a7a32f03e303f8)

[proposals/4186-simplified-sliding-sync.md](/matrix-org/matrix-spec-proposals/pull/4186/files/6fe4ba72da515f3e473be42a57a7a32f03e303f8#diff-43c51cf6108a7004b0d27da42a67f6874a8d34975fa4375b6d1bca9c0fb8d44b)

|  |  | "initial": true|null, |
| --- | --- | --- |
|  |  |  |
|  |  | // Same as in sync v2. Indicates whether there are more events to fetch than those in the timeline. |
|  |  | "limited:" true|null, |

Copy link

Contributor

### @Gnuxie **[Gnuxie](/Gnuxie)** [Aug 30, 2024](#discussion_r1738535216)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Are the options in the request and response supposed to be in a union with `null`?

Isn't it the convention in the spec that the property is omitted entirely rather than given the value `null`?

(For clarity, this is something that jumps out at me since frequently people don't realise omitting a property and giving the value null are distinct things in JSON. Again, I'm not sure what the convention is for the CS-API though.)

Sorry, something went wrong.

 üëç
2
 MTRNord and clokep reacted with thumbs up emoji

All reactions

* üëç
  2 reactions

Copy link

Contributor

### @Gnuxie **[Gnuxie](/Gnuxie)** [Aug 30, 2024](#discussion_r1738576763) ‚Ä¢ edited Loading

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Hmm, seems like `limited` is already optional in the timeline portion of sync? <https://github.com/matrix-org/matrix-spec/blob/7f2f100420a355cf8ea50d08329e6f98989fc975/data/api/client-server/definitions/timeline_batch.yaml#L15-L36>

But this does not imply a union with `null` (it's not explicit). It could if there is another section of the specification that says something to the effect "all unrequired properties in responses and requests should be treated as though their values are in a union with `null`" somewhere?

Sorry, something went wrong.

All reactions

Copy link

Contributor

### @Gnuxie **[Gnuxie](/Gnuxie)** [Aug 30, 2024](#discussion_r1738977977)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

It might be better to rewrite this section using JSONSchema so that the intent is clearer in either case.

Sorry, something went wrong.

All reactions

[![@anoadragon453](https://avatars.githubusercontent.com/u/1342360?s=40&u=7f088d81b921aa0a2915a336c647e7813ca85e1a&v=4)](/anoadragon453)
[anoadragon453](/anoadragon453)
added
[feature](/matrix-org/matrix-spec-proposals/labels/feature)
Suggestion for a significant extension which needs considerable consideration
[proposal](/matrix-org/matrix-spec-proposals/labels/proposal)
A matrix spec change proposal
[kind:core](/matrix-org/matrix-spec-proposals/labels/kind%3Acore)
MSC which is critical to the protocol's success
labels
[Aug 30, 2024](#event-14082682892)

[![@uhoreg](https://avatars.githubusercontent.com/u/1012976?s=40&v=4)](/uhoreg)
[uhoreg](/uhoreg)
added
the
[client-server](/matrix-org/matrix-spec-proposals/labels/client-server)
Client-Server API
label
[Aug 30, 2024](#event-14082693685)

[![@turt2live](https://avatars.githubusercontent.com/u/1190097?s=40&u=4897d21a28d80c6f8e5762712720c6dc566e641e&v=4)](/turt2live)
[turt2live](/turt2live)
added
the
[needs-implementation](/matrix-org/matrix-spec-proposals/labels/needs-implementation)
This MSC does not have a qualifying implementation for the SCT to review. The MSC cannot enter FCP.
label
[Aug 30, 2024](#event-14082891909)

[![turt2live](https://avatars.githubusercontent.com/u/1190097?s=60&v=4)](/turt2live)

**[turt2live](/turt2live)**
reviewed
[Aug 30, 2024](#pullrequestreview-2272704434)

 [View reviewed changes](/matrix-org/matrix-spec-proposals/pull/4186/files/6fe4ba72da515f3e473be42a57a7a32f03e303f8)

[proposals/4186-simplified-sliding-sync.md](/matrix-org/matrix-spec-proposals/pull/4186/files/6fe4ba72da515f3e473be42a57a7a32f03e303f8#diff-43c51cf6108a7004b0d27da42a67f6874a8d34975fa4375b6d1bca9c0fb8d44b)

Copy link

Member

### @turt2live **[turt2live](/turt2live)** [Aug 30, 2024](#discussion_r1738898852)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Implementation requirements:

* Client (ideally multiple)
* Server

Sorry, something went wrong.

All reactions

Copy link

Member

### @anoadragon453 **[anoadragon453](/anoadragon453)** [Nov 27, 2024](#discussion_r1860367373)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Current implementations to my knowledge:

* Client implementation: [matrix-rust-sdk](https://github.com/matrix-org/matrix-rust-sdk/) ([PR](https://github.com/matrix-org/matrix-rust-sdk/pull/3676))
* Server implementation: has been implemented in [Synapse](https://github.com/element-hq/synapse/) across 10s of PRs. (Perhaps [@MadLittleMods](https://github.com/MadLittleMods), the implementer, can give better link(s) here.)

Sorry, something went wrong.

All reactions

Copy link

Contributor

### @MadLittleMods **[MadLittleMods](/MadLittleMods)** [Nov 27, 2024](#discussion_r1861070371)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

#### Synapse server implementation

Maybe it's easiest to point to the main directories where the code lives:

* [`element-hq/synapse` -> `synapse/rest/client/sync.py#L782`](https://github.com/element-hq/synapse/blob/59ad4b18fc81f373c57a7c7d09a2f340a129de76/synapse/rest/client/sync.py#L782)
* [`element-hq/synapse` -> `synapse/handlers/sliding_sync/`](https://github.com/element-hq/synapse/tree/59ad4b18fc81f373c57a7c7d09a2f340a129de76/synapse/handlers/sliding_sync)
* [`element-hq/synapse` -> `tests/rest/client/sliding_sync/`](https://github.com/element-hq/synapse/tree/59ad4b18fc81f373c57a7c7d09a2f340a129de76/tests/rest/client/sliding_sync)

The PRs between [@MadLittleMods](https://github.com/MadLittleMods) and [@erikjohnston](https://github.com/erikjohnston) with the ~A-Sync label are also a pretty good encapsulation:

* <https://github.com/element-hq/synapse/pulls?q=+is%3Apr+author%3AMadLittleMods+label%3AA-Sync>
* <https://github.com/element-hq/synapse/pulls?q=+is%3Apr+author%3Aerikjohnston+label%3AA-Sync>

Sorry, something went wrong.

All reactions

[![Gnuxie](https://avatars.githubusercontent.com/u/50846879?s=60&v=4)](/Gnuxie)

**[Gnuxie](/Gnuxie)**
reviewed
[Aug 30, 2024](#pullrequestreview-2272881629)

 [View reviewed changes](/matrix-org/matrix-spec-proposals/pull/4186/files/6fe4ba72da515f3e473be42a57a7a32f03e303f8)

[proposals/4186-simplified-sliding-sync.md](/matrix-org/matrix-spec-proposals/pull/4186/files/6fe4ba72da515f3e473be42a57a7a32f03e303f8#diff-43c51cf6108a7004b0d27da42a67f6874a8d34975fa4375b6d1bca9c0fb8d44b)
Outdated

Comment on lines
180
 to
183

|  |  | // Flag which only returns rooms which have an `m.room.encryption` state event. If unset, |
| --- | --- | --- |
|  |  | // both encrypted and unencrypted rooms are returned. If false, only unencrypted rooms |
|  |  | // are returned. If true, only encrypted rooms are returned. |
|  |  | "is\_invite": true|false|null, |

Copy link

Contributor

### @Gnuxie **[Gnuxie](/Gnuxie)** [Aug 30, 2024](#discussion_r1739011739)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

documentation is copied across from `is_encrypted`

Sorry, something went wrong.

 üëç
1
 HarHarLinks reacted with thumbs up emoji

All reactions

* üëç
  1 reaction

[![Gnuxie](https://avatars.githubusercontent.com/u/50846879?s=60&v=4)](/Gnuxie)

**[Gnuxie](/Gnuxie)**
reviewed
[Aug 30, 2024](#pullrequestreview-2272989981)

 [View reviewed changes](/matrix-org/matrix-spec-proposals/pull/4186/files/6fe4ba72da515f3e473be42a57a7a32f03e303f8)

[proposals/4186-simplified-sliding-sync.md](/matrix-org/matrix-spec-proposals/pull/4186/files/6fe4ba72da515f3e473be42a57a7a32f03e303f8#diff-43c51cf6108a7004b0d27da42a67f6874a8d34975fa4375b6d1bca9c0fb8d44b)

Comment on lines
+364
 to
+372

|  |  | The format of returned state in `required\_state` is a list of events. This does now allow the server to indicate if a |
| --- | --- | --- |
|  |  | "state reset" has happened which removed an entry from the state entirely (rather than it being replaced with another |
|  |  | event). |
|  |  |  |
|  |  | This is particularly problematic if the user gets "state reset" out of the room, where the server has no mechanism to |
|  |  | indicate to the client that the user has effectively left the room (the server has no leave event to return). |
|  |  |  |
|  |  | We may want to allow special entries in the `required\_state` list of the form |
|  |  | `{"type": .., "state\_key": .., content: null}` to indicate that the state entry has been removed. |

Copy link

Contributor

### @Gnuxie **[Gnuxie](/Gnuxie)** [Aug 30, 2024](#discussion_r1739078822) ‚Ä¢ edited Loading

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

This is pretty serious and I don't think we can leave it up to clients to figure out somehow. Since that requires client authors to both be extremely knowledgeable about how room state works and also write perfect code. The chances of both of those happening is slim. For example, I tried to write some code to track room state from legacy `/sync` (by also using `/state`) in Draupnir and it seems like I haven't even been able to do that right. <https://github.com/Gnuxie/matrix-protection-suite/blob/main/src/StateTracking/StateChangeType.ts#L13-L64>, <https://github.com/Gnuxie/matrix-protection-suite/blob/main/src/StateTracking/StateChangeType.ts#L83-L123>. The situation where a state event can be removed entirely via a state reset is not even accounted for. Partially because I was under the impression that this was not something that could happen, as I was a dumbass.

You can read more about the way Draupnir collects state here <https://marewolf.me/posts/draupnir/2402.html#development-room-state-tracking>. But it would be good if clients didn't need to calculate state deltas at all and there was more specialized API support for that. There'd need to be consideration for how such an API would interact with timeline gaps if it was done alongside `/sync`.

Sorry, something went wrong.

All reactions

[![@erebion](https://avatars.githubusercontent.com/u/104499031?s=40&v=4)](/erebion)
[erebion](/erebion)
mentioned this pull request
[Sep 3, 2024](#ref-issue-2502169115)

[Sliding Sync does not seem to work
element-hq/synapse#17651](/element-hq/synapse/issues/17651)

Closed

[![Johennes](https://avatars.githubusercontent.com/u/1137962?s=60&v=4)](/Johennes)

**[Johennes](/Johennes)**
reviewed
[Sep 3, 2024](#pullrequestreview-2277553347)

 [View reviewed changes](/matrix-org/matrix-spec-proposals/pull/4186/files/6fe4ba72da515f3e473be42a57a7a32f03e303f8)

[proposals/4186-simplified-sliding-sync.md](/matrix-org/matrix-spec-proposals/pull/4186/files/6fe4ba72da515f3e473be42a57a7a32f03e303f8#diff-43c51cf6108a7004b0d27da42a67f6874a8d34975fa4375b6d1bca9c0fb8d44b)
Outdated

Show resolved

Hide resolved

[![clokep](https://avatars.githubusercontent.com/u/517124?s=60&v=4)](/clokep)

**[clokep](/clokep)**
reviewed
[Sep 3, 2024](#pullrequestreview-2277581763)

 [View reviewed changes](/matrix-org/matrix-spec-proposals/pull/4186/files/6fe4ba72da515f3e473be42a57a7a32f03e303f8)

[proposals/4186-simplified-sliding-sync.md](/matrix-org/matrix-spec-proposals/pull/4186/files/6fe4ba72da515f3e473be42a57a7a32f03e303f8#diff-43c51cf6108a7004b0d27da42a67f6874a8d34975fa4375b6d1bca9c0fb8d44b)

|  |  |  |
| --- | --- | --- |
|  |  | The current `/sync` endpoint scales badly as the number of rooms on an account increases. It scales badly because all |
|  |  | rooms are returned to the client, incremental syncs are unbounded and slow down based on how long the user has been |
|  |  | offline, and clients cannot opt-out of a large amount of extraneous data such as receipts. On large accounts with |

Copy link

Member

### @clokep **[clokep](/clokep)** [Sep 3, 2024](#discussion_r1742145645)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Can't data be removed with filters? (See [`RoomFilter`](https://spec.matrix.org/v1.11/client-server-api/#post_matrixclientv3useruseridfilter_request_roomfilter))

Sorry, something went wrong.

All reactions

Copy link

### @olivia-fl **[olivia-fl](/olivia-fl)** [Dec 16, 2024](#discussion_r1887714070)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Specifically, I believe you can opt-out of receipts with `RoomFilter.ephemeral.not_types = [ "m.read.*" ]` or similar. When I was working on filtering support in grapevine, we had a fast path for filters like this that would skip reading any of the receipt data from the db server-side. That work hasn't been finished yet, and I have no idea if synapse has a similar fast-path.

One of the difficulties with v3 sync filtering in general is that performance can vary wildly wildly depending on server implementation details. The spec doesn't indicate which fast-paths should exist, and whether or not you hit a fast-path can also affect how many events are returned in the sync window ([matrix-org/matrix-spec#1887](https://github.com/matrix-org/matrix-spec/issues/1887)).

Sorry, something went wrong.

All reactions

[proposals/4186-simplified-sliding-sync.md](/matrix-org/matrix-spec-proposals/pull/4186/files/6fe4ba72da515f3e473be42a57a7a32f03e303f8#diff-43c51cf6108a7004b0d27da42a67f6874a8d34975fa4375b6d1bca9c0fb8d44b)
Outdated

Show resolved

Hide resolved

[proposals/4186-simplified-sliding-sync.md](/matrix-org/matrix-spec-proposals/pull/4186/files/6fe4ba72da515f3e473be42a57a7a32f03e303f8#diff-43c51cf6108a7004b0d27da42a67f6874a8d34975fa4375b6d1bca9c0fb8d44b)

Show resolved

Hide resolved

[proposals/4186-simplified-sliding-sync.md](/matrix-org/matrix-spec-proposals/pull/4186/files/6fe4ba72da515f3e473be42a57a7a32f03e303f8#diff-43c51cf6108a7004b0d27da42a67f6874a8d34975fa4375b6d1bca9c0fb8d44b)

|  |  | The core component of a sliding sync request is ‚Äúlists‚Äù, which specify what information to return about which rooms. |
| --- | --- | --- |
|  |  | Each list specifies some filters on rooms (e.g. ignore spaces), the range of filtered rooms to select (e.g. the most |
|  |  | recent 20 filtered rooms), and the config for the data to return for those rooms (e.g. the required state, timeline |
|  |  | limit, etc). The order of rooms is always done based on when the server received the most recent event for the room. |

Copy link

Member

### @clokep **[clokep](/clokep)** [Sep 3, 2024](#discussion_r1742162694)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

"Stream order" in synapse parlance?

Sorry, something went wrong.

All reactions

Copy link

Contributor

### @MadLittleMods **[MadLittleMods](/MadLittleMods)** [Sep 11, 2024](#discussion_r1755518070)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Yes, should [standardize this type of language](https://github.com/matrix-org/matrix-spec/issues/1334#issuecomment-2269948258).

Suggested change

|  | limit, etc). The order of rooms is always done based on when the server received the most recent event for the room. |
| --- | --- |
|  | limit, etc). The order of rooms is always done based on the arrival time of the most recent event for the room on the homeserver. |

Sorry, something went wrong.

All reactions

[proposals/4186-simplified-sliding-sync.md](/matrix-org/matrix-spec-proposals/pull/4186/files/6fe4ba72da515f3e473be42a57a7a32f03e303f8#diff-43c51cf6108a7004b0d27da42a67f6874a8d34975fa4375b6d1bca9c0fb8d44b)

Comment on lines
+58
 to
+60

|  |  | Multiple lists and subscriptions can be specified in a request. If a room matches multiple lists/subscriptions then the |
| --- | --- | --- |
|  |  | config is ‚Äúcombined‚Äù to be the superset of all configs (e.g. take the maximum timeline limit). See below for the exact |
|  |  | algorithm. |

Copy link

Member

### @clokep **[clokep](/clokep)** [Sep 3, 2024](#discussion_r1742175974)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

So lists + subscriptions replace filters?

Sorry, something went wrong.

All reactions

9 hidden conversations

Load more‚Ä¶

[proposals/4186-simplified-sliding-sync.md](/matrix-org/matrix-spec-proposals/pull/4186/files/6fe4ba72da515f3e473be42a57a7a32f03e303f8#diff-43c51cf6108a7004b0d27da42a67f6874a8d34975fa4375b6d1bca9c0fb8d44b)
Outdated

Show resolved

Hide resolved

[proposals/4186-simplified-sliding-sync.md](/matrix-org/matrix-spec-proposals/pull/4186/files/6fe4ba72da515f3e473be42a57a7a32f03e303f8#diff-43c51cf6108a7004b0d27da42a67f6874a8d34975fa4375b6d1bca9c0fb8d44b)
Outdated

Show resolved

Hide resolved

[proposals/4186-simplified-sliding-sync.md](/matrix-org/matrix-spec-proposals/pull/4186/files/6fe4ba72da515f3e473be42a57a7a32f03e303f8#diff-43c51cf6108a7004b0d27da42a67f6874a8d34975fa4375b6d1bca9c0fb8d44b)

|  |  | rooms. If there are more rooms to send to the client (beyond `page\_size`), then the client can request to "paginate" in |
| --- | --- | --- |
|  |  | these missed updates in subsequent updates. |
|  |  |  |
|  |  | Since this would require client side changes, this should be explored in a separate MSC. |

Copy link

Member

### @clokep **[clokep](/clokep)** [Sep 3, 2024](#discussion_r1742216079)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Doesn't all of this require client side changes?

Sorry, something went wrong.

All reactions

[proposals/4186-simplified-sliding-sync.md](/matrix-org/matrix-spec-proposals/pull/4186/files/6fe4ba72da515f3e473be42a57a7a32f03e303f8#diff-43c51cf6108a7004b0d27da42a67f6874a8d34975fa4375b6d1bca9c0fb8d44b)

|  |  | We could implement a bulk `/messages` endpoint, where the client would specify multiple rooms and `prev\_batch` tokens. |
| --- | --- | --- |
|  |  | We can also add a flag to disable attempting to backfill over pagination (to match the behaviour of the sync timeline). |
|  |  |  |
|  |  | ## `required\_state` response format |

Copy link

Member

### @clokep **[clokep](/clokep)** [Sep 3, 2024](#discussion_r1742218559)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

This section seems to contradict the opening that this MSC solves the issue of clients having incorrect state.

Sorry, something went wrong.

All reactions

[proposals/4186-simplified-sliding-sync.md](/matrix-org/matrix-spec-proposals/pull/4186/files/6fe4ba72da515f3e473be42a57a7a32f03e303f8#diff-43c51cf6108a7004b0d27da42a67f6874a8d34975fa4375b6d1bca9c0fb8d44b)

Comment on lines
+234
 to
+236

|  |  | // The position to use as the `since` token in the next sliding sync request. |
| --- | --- | --- |
|  |  | // c.f. Connections. |
|  |  | "pos": "<opaque string>", |

Copy link

Member

### @clokep **[clokep](/clokep)** [Sep 3, 2024](#discussion_r1742221179)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

I think there was an effort to standardize pagination terminology?

Sorry, something went wrong.

All reactions

[![MadLittleMods](https://avatars.githubusercontent.com/u/558581?s=60&v=4)](/MadLittleMods)

**[MadLittleMods](/MadLittleMods)**
reviewed
[Sep 5, 2024](#pullrequestreview-2283740985)

 [View reviewed changes](/matrix-org/matrix-spec-proposals/pull/4186/files/6fe4ba72da515f3e473be42a57a7a32f03e303f8)

[proposals/4186-simplified-sliding-sync.md](/matrix-org/matrix-spec-proposals/pull/4186/files/6fe4ba72da515f3e473be42a57a7a32f03e303f8#diff-43c51cf6108a7004b0d27da42a67f6874a8d34975fa4375b6d1bca9c0fb8d44b)

Show resolved

Hide resolved

[![MadLittleMods](https://avatars.githubusercontent.com/u/558581?s=60&v=4)](/MadLittleMods)

**[MadLittleMods](/MadLittleMods)**
reviewed
[Sep 5, 2024](#pullrequestreview-2283758736)

 [View reviewed changes](/matrix-org/matrix-spec-proposals/pull/4186/files/6fe4ba72da515f3e473be42a57a7a32f03e303f8)

[proposals/4186-simplified-sliding-sync.md](/matrix-org/matrix-spec-proposals/pull/4186/files/6fe4ba72da515f3e473be42a57a7a32f03e303f8#diff-43c51cf6108a7004b0d27da42a67f6874a8d34975fa4375b6d1bca9c0fb8d44b)

|  |  | // The "heroes" for the room, if there is no room name. Only sent initially and when it changes. |
| --- | --- | --- |
|  |  | "heroes": [ |
|  |  | {"user\_id":"@alice:example.com","displayname":"Alice","avatar\_url":"mxc://..."}, |
|  |  | ], |

Copy link

Contributor

### @MadLittleMods **[MadLittleMods](/MadLittleMods)** [Sep 5, 2024](#discussion_r1745962353) ‚Ä¢ edited Loading

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Do the `heroes` membership state events need to be included in `required_state` response when requesting `required_state: ["m.room.member", "$LAZY"]` (lazy-loading room members)?

Sync v2 says this:

> When lazy-loading room members is enabled, the membership events for the heroes MUST be included in the `state`, unless they are redundant. When the list of users changes, the server notifies the client by sending a fresh list of heroes. If there are no changes since the last sync, this field may be omitted.

But I think that's because `m.heroes` in Sync v2 is only a list of user ID's. Whereas, in the sliding sync response here, we already have all of the info necessary in these stripped events.

One alternative is to match Sync v2 and only list the user ID's in `heroes` and include the membership events in `required_state`.

Sorry, something went wrong.

All reactions

[![MadLittleMods](https://avatars.githubusercontent.com/u/558581?s=60&v=4)](/MadLittleMods)

**[MadLittleMods](/MadLittleMods)**
reviewed
[Sep 5, 2024](#pullrequestreview-2283767218)

 [View reviewed changes](/matrix-org/matrix-spec-proposals/pull/4186/files/6fe4ba72da515f3e473be42a57a7a32f03e303f8)

[proposals/4186-simplified-sliding-sync.md](/matrix-org/matrix-spec-proposals/pull/4186/files/6fe4ba72da515f3e473be42a57a7a32f03e303f8#diff-43c51cf6108a7004b0d27da42a67f6874a8d34975fa4375b6d1bca9c0fb8d44b)
Outdated

Show resolved

Hide resolved

[![@MadLittleMods](https://avatars.githubusercontent.com/u/558581?s=40&v=4)](/MadLittleMods)
[MadLittleMods](/MadLittleMods)
mentioned this pull request
[Sep 5, 2024](#ref-pullrequest-1084636368)

[MSC3575: Sliding Sync (aka Sync v3)
#3575](/matrix-org/matrix-spec-proposals/pull/3575)
 Open

[![MadLittleMods](https://avatars.githubusercontent.com/u/558581?s=60&v=4)](/MadLittleMods)

**[MadLittleMods](/MadLittleMods)**
reviewed
[Sep 5, 2024](#pullrequestreview-2283789340)

 [View reviewed changes](/matrix-org/matrix-spec-proposals/pull/4186/files/6fe4ba72da515f3e473be42a57a7a32f03e303f8)

[proposals/4186-simplified-sliding-sync.md](/matrix-org/matrix-spec-proposals/pull/4186/files/6fe4ba72da515f3e473be42a57a7a32f03e303f8#diff-43c51cf6108a7004b0d27da42a67f6874a8d34975fa4375b6d1bca9c0fb8d44b)
Outdated

Comment on lines
270
 to
273

|  |  | // The list of events, sorted least to most recent. |
| --- | --- | --- |
|  |  | "timeline": [ ... ], |
|  |  | // The current state of the room as a list of events |
|  |  | "required\_state": [ ... ], |

Copy link

Contributor

### @MadLittleMods **[MadLittleMods](/MadLittleMods)** [Sep 5, 2024](#discussion_r1745980679)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

We should call out that the `required_state`, `timeline`, `limited`, `num_live`, `prev_batch` fields will be omitted for `invite`/`knock` rooms. Only `invite_state`/`knock_state` is provided.

The reason these can't be included is because we don't have any of that information for remote invites and the user isn't participating in the room yet so we shouldn't leak anything to them. We can only rely on the information in the invite event.

Related previous conversation: [#3575 (comment)](https://github.com/matrix-org/matrix-spec-proposals/pull/3575#discussion_r1653045932)

Sorry, something went wrong.

 üëç
1
 hughns reacted with thumbs up emoji

All reactions

* üëç
  1 reaction

[![MadLittleMods](https://avatars.githubusercontent.com/u/558581?s=60&v=4)](/MadLittleMods)

**[MadLittleMods](/MadLittleMods)**
reviewed
[Sep 5, 2024](#pullrequestreview-2283806782)

 [View reviewed changes](/matrix-org/matrix-spec-proposals/pull/4186/files/6fe4ba72da515f3e473be42a57a7a32f03e303f8)

[proposals/4186-simplified-sliding-sync.md](/matrix-org/matrix-spec-proposals/pull/4186/files/6fe4ba72da515f3e473be42a57a7a32f03e303f8#diff-43c51cf6108a7004b0d27da42a67f6874a8d34975fa4375b6d1bca9c0fb8d44b)

Comment on lines
+256
 to
+258

|  |  | "heroes": [ |
| --- | --- | --- |
|  |  | {"user\_id":"@alice:example.com","displayname":"Alice","avatar\_url":"mxc://..."}, |
|  |  | ], |

Copy link

Contributor

### @MadLittleMods **[MadLittleMods](/MadLittleMods)** [Sep 5, 2024](#discussion_r1745991652)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

One weird corner with the current spec: If the room doesn't have a name set and the user is invited/knock to the room, we don't have any `heroes` to provide here. This is because `heroes` membership isn't included in the stripped state that the server receives when they are invited/knocked over federation.

Related to [matrix-org/matrix-spec#380](https://github.com/matrix-org/matrix-spec/issues/380)

This was solved for partial-joins via [MSC3943](https://github.com/matrix-org/matrix-spec-proposals/pull/3943)

Not necessarily a blocker but just calling out something that won't work completely until that spec issue is solved.

Sorry, something went wrong.

All reactions

This was referenced Sep 9, 2024

[fix(sdk): Mark tracked users as dirty when the SS connection is reset.
matrix-org/matrix-rust-sdk#3965](/matrix-org/matrix-rust-sdk/pull/3965)
 Merged

[client-api: Implement MSC4186
ruma/ruma#1907](/ruma/ruma/pull/1907)
 Merged

[![@kfiven](https://avatars.githubusercontent.com/u/33421343?s=40&v=4)](/kfiven)
[kfiven](/kfiven)
mentioned this pull request
[Sep 14, 2024](#ref-issue-1914432205)

[Sliding sync
cinnyapp/cinny#1436](/cinnyapp/cinny/issues/1436)

Open

[netbsd-srcmastr](/netbsd-srcmastr)
pushed a commit
to NetBSD/pkgsrc
that referenced
this pull request
[Sep 14, 2024](#ref-commit-d95af47)
[![@Midar](https://avatars.githubusercontent.com/u/752237?s=40&u=81dfb9be718247c7664693c556bf3fdfb6715545&v=4)](/Midar)

`[Update devel/matrix-synapse to 1.114.0](/NetBSD/pkgsrc/commit/d95af471af9ca34135319666b18d6563872fd69b "Update devel/matrix-synapse to 1.114.0

# Synapse 1.114.0 (2024-09-02)

This release enables support for
[MSC4186](https://github.com/matrix-org/matrix-spec-proposals/pull/4186) ‚Äî
Simplified Sliding Sync. This allows using the upcoming releases of the Element
X mobile apps without having to run a Sliding Sync Proxy.

### Features

- Enable native sliding sync support ([MSC3575](https://github.com/matrix-org/matrix-spec-proposals/pull/3575) and [MSC4186](https://github.com/matrix-org/matrix-spec-proposals/pull/4186)) by default. ([\#17648](https://github.com/element-hq/synapse/issues/17648))

# Synapse 1.114.0rc3 (2024-08-30)

### Bugfixes

- Fix regression in v1.114.0rc2 that caused workers to fail to start. ([\#17626](https://github.com/element-hq/synapse/issues/17626))

# Synapse 1.114.0rc2 (2024-08-30)

### Features

- Improve cross-signing upload when using [MSC3861](https://github.com/matrix-org/matrix-spec-proposals/pull/3861) to use a custom UIA flow stage, with web fallback support. ([\#17509](https://github.com/element-hq/synapse/issues/17509))
- Make `hash_password` script accept password input from stdin. ([\#17608](https://github.com/element-hq/synapse/issues/17608))

### Bugfixes

- Fix hierarchy returning 403 when room is accessible through federation. Contributed by Krishan (@kfiven). ([\#17194](https://github.com/element-hq/synapse/issues/17194))
- Fix content-length on federation `/thumbnail` responses. ([\#17532](https://github.com/element-hq/synapse/issues/17532))
- Fix authenticated media responses using a wrong limit when following redirects over federation. ([\#17543](https://github.com/element-hq/synapse/issues/17543))

### Internal Changes

- MSC3861: load the issuer and account management URLs from OIDC discovery. ([\#17407](https://github.com/element-hq/synapse/issues/17407))
- Refactor sliding sync class into multiple files. ([\#17595](https://github.com/element-hq/synapse/issues/17595))
- Store sliding sync per-connection state in the database. ([\#17599](https://github.com/element-hq/synapse/issues/17599))
- Make the sliding sync `PerConnectionState` class immutable. ([\#17600](https://github.com/element-hq/synapse/issues/17600))
- Add support to `@tag_args` for standalone functions. ([\#17604](https://github.com/element-hq/synapse/issues/17604))
- Speed up incremental syncs in sliding sync by adding some more caching. ([\#17606](https://github.com/element-hq/synapse/issues/17606))
- Always return the user's own read receipts in sliding sync. ([\#17617](https://github.com/element-hq/synapse/issues/17617))
- Replace `isort` and `black` with `ruff`. ([\#17620](https://github.com/element-hq/synapse/issues/17620))
- Refactor sliding sync code to move room list logic out into a separate class. ([\#17622](https://github.com/element-hq/synapse/issues/17622))

### Updates to locked dependencies

* Bump attrs from 23.2.0 to 24.2.0. ([\#17609](https://github.com/element-hq/synapse/issues/17609))
* Bump cryptography from 42.0.8 to 43.0.0. ([\#17584](https://github.com/element-hq/synapse/issues/17584))
* Bump phonenumbers from 8.13.43 to 8.13.44. ([\#17610](https://github.com/element-hq/synapse/issues/17610))
* Bump pygithub from 2.3.0 to 2.4.0. ([\#17612](https://github.com/element-hq/synapse/issues/17612))
* Bump pyyaml from 6.0.1 to 6.0.2. ([\#17611](https://github.com/element-hq/synapse/issues/17611))
* Bump sentry-sdk from 2.12.0 to 2.13.0. ([\#17585](https://github.com/element-hq/synapse/issues/17585))
* Bump serde from 1.0.206 to 1.0.208. ([\#17581](https://github.com/element-hq/synapse/issues/17581))
* Bump serde from 1.0.208 to 1.0.209. ([\#17613](https://github.com/element-hq/synapse/issues/17613))
* Bump serde_json from 1.0.124 to 1.0.125. ([\#17582](https://github.com/element-hq/synapse/issues/17582))
* Bump serde_json from 1.0.125 to 1.0.127. ([\#17614](https://github.com/element-hq/synapse/issues/17614))
* Bump types-jsonschema from 4.23.0.20240712 to 4.23.0.20240813. ([\#17583](https://github.com/element-hq/synapse/issues/17583))
* Bump types-setuptools from 71.1.0.20240726 to 71.1.0.20240818. ([\#17586](https://github.com/element-hq/synapse/issues/17586))

# Synapse 1.114.0rc1 (2024-08-20)

### Features

- Add a flag to `/versions`, `org.matrix.simplified_msc3575`, to indicate whether experimental sliding sync support has been enabled. ([\#17571](https://github.com/element-hq/synapse/issues/17571))
- Handle changes in `timeline_limit` in experimental sliding sync. ([\#17579](https://github.com/element-hq/synapse/issues/17579))
- Correctly track read receipts that should be sent down in experimental sliding sync. ([\#17575](https://github.com/element-hq/synapse/issues/17575), [\#17589](https://github.com/element-hq/synapse/issues/17589), [\#17592](https://github.com/element-hq/synapse/issues/17592))

### Bugfixes

- Start handlers for new media endpoints when media resource configured. ([\#17483](https://github.com/element-hq/synapse/issues/17483))
- Fix timeline ordering (using `stream_ordering` instead of topological ordering) in experimental [MSC3575](https://github.com/matrix-org/matrix-spec-proposals/pull/3575) Sliding Sync `/sync` endpoint. ([\#17510](https://github.com/element-hq/synapse/issues/17510))
- Fix experimental sliding sync implementation to remember any updates in rooms that were not sent down immediately. ([\#17535](https://github.com/element-hq/synapse/issues/17535))
- Better exclude partially stated rooms if we must await full state in experimental [MSC3575](https://github.com/matrix-org/matrix-spec-proposals/pull/3575) Sliding Sync `/sync` endpoint. ([\#17538](https://github.com/element-hq/synapse/issues/17538))
- Handle lower-case http headers in `_Mulitpart_Parser_Protocol`. ([\#17545](https://github.com/element-hq/synapse/issues/17545))
- Fix fetching federation signing keys from servers that omit `old_verify_keys`. Contributed by @tulir @ Beeper. ([\#17568](https://github.com/element-hq/synapse/issues/17568))
- Fix bug where we would respond with an error when a remote server asked for media that had a length of 0, using the new multipart federation media endpoint. ([\#17570](https://github.com/element-hq/synapse/issues/17570))

### Improved Documentation

- Clarify default behaviour of the
  [`auto_accept_invites.worker_to_run_on`](https://element-hq.github.io/synapse/develop/usage/configuration/config_documentation.html#auto-accept-invites)
  option. ([\#17515](https://github.com/element-hq/synapse/issues/17515))
- Improve docstrings for profile methods. ([\#17559](https://github.com/element-hq/synapse/issues/17559))

### Internal Changes

- Add more tracing to experimental [MSC3575](https://github.com/matrix-org/matrix-spec-proposals/pull/3575) Sliding Sync `/sync` endpoint. ([\#17514](https://github.com/element-hq/synapse/issues/17514))
- Fixup comment in sliding sync implementation. ([\#17531](https://github.com/element-hq/synapse/issues/17531))
- Replace override of deprecated method `HTTPAdapter.get_connection` with `get_connection_with_tls_context`. ([\#17536](https://github.com/element-hq/synapse/issues/17536))
- Fix performance of device lists in `/key/changes` and sliding sync. ([\#17537](https://github.com/element-hq/synapse/issues/17537), [\#17548](https://github.com/element-hq/synapse/issues/17548))
- Bump setuptools from 67.6.0 to 72.1.0. ([\#17542](https://github.com/element-hq/synapse/issues/17542))
- Add a utility function for generating random event IDs. ([\#17557](https://github.com/element-hq/synapse/issues/17557))
- Speed up responding to media requests. ([\#17558](https://github.com/element-hq/synapse/issues/17558), [\#17561](https://github.com/element-hq/synapse/issues/17561), [\#17564](https://github.com/element-hq/synapse/issues/17564), [\#17566](https://github.com/element-hq/synapse/issues/17566), [\#17567](https://github.com/element-hq/synapse/issues/17567), [\#17569](https://github.com/element-hq/synapse/issues/17569))
- Test github token before running release script steps. ([\#17562](https://github.com/element-hq/synapse/issues/17562))
- Reduce log spam of multipart files. ([\#17563](https://github.com/element-hq/synapse/issues/17563))
- Refactor per-connection state in experimental sliding sync handler. ([\#17574](https://github.com/element-hq/synapse/issues/17574))
- Add histogram metrics for sliding sync processing time. ([\#17593](https://github.com/element-hq/synapse/issues/17593))

### Updates to locked dependencies

* Bump bytes from 1.6.1 to 1.7.1. ([\#17526](https://github.com/element-hq/synapse/issues/17526))
* Bump lxml from 5.2.2 to 5.3.0. ([\#17550](https://github.com/element-hq/synapse/issues/17550))
* Bump phonenumbers from 8.13.42 to 8.13.43. ([\#17551](https://github.com/element-hq/synapse/issues/17551))
* Bump regex from 1.10.5 to 1.10.6. ([\#17527](https://github.com/element-hq/synapse/issues/17527))
* Bump sentry-sdk from 2.10.0 to 2.12.0. ([\#17553](https://github.com/element-hq/synapse/issues/17553))
* Bump serde from 1.0.204 to 1.0.206. ([\#17556](https://github.com/element-hq/synapse/issues/17556))
* Bump serde_json from 1.0.122 to 1.0.124. ([\#17555](https://github.com/element-hq/synapse/issues/17555))
* Bump sigstore/cosign-installer from 3.5.0 to 3.6.0. ([\#17549](https://github.com/element-hq/synapse/issues/17549))
* Bump types-pyyaml from 6.0.12.20240311 to 6.0.12.20240808. ([\#17552](https://github.com/element-hq/synapse/issues/17552))
* Bump types-requests from 2.31.0.20240406 to 2.32.0.20240712. ([\#17524](https://github.com/element-hq/synapse/issues/17524))

# Synapse 1.113.0 (2024-08-13)

No significant changes since 1.113.0rc1.

# Synapse 1.113.0rc1 (2024-08-06)

### Features

- Track which rooms have been sent to clients in the experimental [MSC3575](https://github.com/matrix-org/matrix-spec-proposals/pull/3575) Sliding Sync `/sync` endpoint. ([\#17447](https://github.com/element-hq/synapse/issues/17447))
- Add Account Data extension support to experimental [MSC3575](https://github.com/matrix-org/matrix-spec-proposals/pull/3575) Sliding Sync `/sync` endpoint. ([\#17477](https://github.com/element-hq/synapse/issues/17477))
- Add receipts extension support to experimental [MSC3575](https://github.com/matrix-org/matrix-spec-proposals/pull/3575) Sliding Sync `/sync` endpoint. ([\#17489](https://github.com/element-hq/synapse/issues/17489))
- Add typing notification extension support to experimental [MSC3575](https://github.com/matrix-org/matrix-spec-proposals/pull/3575) Sliding Sync `/sync` endpoint. ([\#17505](https://github.com/element-hq/synapse/issues/17505))

### Bugfixes

- Update experimental [MSC3575](https://github.com/matrix-org/matrix-spec-proposals/pull/3575) Sliding Sync `/sync` endpoint to handle invite/knock rooms when filtering. ([\#17450](https://github.com/element-hq/synapse/issues/17450))
- Fix a bug introduced in v1.110.0 which caused `/keys/query` to return incomplete results, leading to high network activity and CPU usage on Matrix clients. ([\#17499](https://github.com/element-hq/synapse/issues/17499))

### Improved Documentation

- Update the [`allowed_local_3pids`](https://element-hq.github.io/synapse/v1.112/usage/configuration/config_documentation.html#allowed_local_3pids) config option's msisdn address to a working example. ([\#17476](https://github.com/element-hq/synapse/issues/17476))

### Internal Changes

- Change sliding sync to use their own token format in preparation for storing per-connection state. ([\#17452](https://github.com/element-hq/synapse/issues/17452))
- Ensure we don't send down negative `bump_stamp` in experimental sliding sync endpoint. ([\#17478](https://github.com/element-hq/synapse/issues/17478))
- Do not send down empty room entries down experimental sliding sync endpoint. ([\#17479](https://github.com/element-hq/synapse/issues/17479))
- Refactor Sliding Sync tests to better utilize the `SlidingSyncBase`. ([\#17481](https://github.com/element-hq/synapse/issues/17481), [\#17482](https://github.com/element-hq/synapse/issues/17482))
- Add some opentracing tags and logging to the experimental sliding sync implementation. ([\#17501](https://github.com/element-hq/synapse/issues/17501))
- Split and move Sliding Sync tests so we have some more sane test file sizes. ([\#17504](https://github.com/element-hq/synapse/issues/17504))
- Update the `limited` field description in the Sliding Sync response to accurately describe what it actually represents. ([\#17507](https://github.com/element-hq/synapse/issues/17507))
- Easier to understand `timeline` assertions in Sliding Sync tests. ([\#17511](https://github.com/element-hq/synapse/issues/17511))
- Reset the sliding sync connection if we don't recognize the per-connection state position. ([\#17529](https://github.com/element-hq/synapse/issues/17529))

### Updates to locked dependencies

* Bump bcrypt from 4.1.3 to 4.2.0. ([\#17495](https://github.com/element-hq/synapse/issues/17495))
* Bump black from 24.4.2 to 24.8.0. ([\#17522](https://github.com/element-hq/synapse/issues/17522))
* Bump phonenumbers from 8.13.39 to 8.13.42. ([\#17521](https://github.com/element-hq/synapse/issues/17521))
* Bump ruff from 0.5.4 to 0.5.5. ([\#17494](https://github.com/element-hq/synapse/issues/17494))
* Bump serde_json from 1.0.120 to 1.0.121. ([\#17493](https://github.com/element-hq/synapse/issues/17493))
* Bump serde_json from 1.0.121 to 1.0.122. ([\#17525](https://github.com/element-hq/synapse/issues/17525))
* Bump towncrier from 23.11.0 to 24.7.1. ([\#17523](https://github.com/element-hq/synapse/issues/17523))
* Bump types-pyopenssl from 24.1.0.20240425 to 24.1.0.20240722. ([\#17496](https://github.com/element-hq/synapse/issues/17496))
* Bump types-setuptools from 70.1.0.20240627 to 71.1.0.20240726. ([\#17497](https://github.com/element-hq/synapse/issues/17497))")`
‚Ä¶

`[d95af47](/NetBSD/pkgsrc/commit/d95af471af9ca34135319666b18d6563872fd69b)`

```
# Synapse 1.114.0 (2024-09-02)

This release enables support for
[MSC4186]([matrix-org/matrix-spec-proposals#4186](https://github.com/matrix-org/matrix-spec-proposals/pull/4186)) ‚Äî
Simplified Sliding Sync. This allows using the upcoming releases of the Element
X mobile apps without having to run a Sliding Sync Proxy.

### Features

- Enable native sliding sync support ([MSC3575]([matrix-org/matrix-spec-proposals#3575](https://github.com/matrix-org/matrix-spec-proposals/pull/3575)) and [MSC4186]([matrix-org/matrix-spec-proposals#4186](https://github.com/matrix-org/matrix-spec-proposals/pull/4186))) by default. ([\#17648]([element-hq/synapse#17648](https://github.com/element-hq/synapse/pull/17648)))

# Synapse 1.114.0rc3 (2024-08-30)

### Bugfixes

- Fix regression in v1.114.0rc2 that caused workers to fail to start. ([\#17626]([element-hq/synapse#17626](https://github.com/element-hq/synapse/pull/17626)))

# Synapse 1.114.0rc2 (2024-08-30)

### Features

- Improve cross-signing upload when using [MSC3861]([matrix-org/matrix-spec-proposals#3861](https://github.com/matrix-org/matrix-spec-proposals/pull/3861)) to use a custom UIA flow stage, with web fallback support. ([\#17509]([element-hq/synapse#17509](https://github.com/element-hq/synapse/pull/17509)))
- Make `hash_password` script accept password input from stdin. ([\#17608]([element-hq/synapse#17608](https://github.com/element-hq/synapse/pull/17608)))

### Bugfixes

- Fix hierarchy returning 403 when room is accessible through federation. Contributed by Krishan ([@kfiven](https://github.com/kfiven)). ([\#17194]([element-hq/synapse#17194](https://github.com/element-hq/synapse/pull/17194)))
- Fix content-length on federation `/thumbnail` responses. ([\#17532]([element-hq/synapse#17532](https://github.com/element-hq/synapse/pull/17532)))
- Fix authenticated media responses using a wrong limit when following redirects over federation. ([\#17543]([element-hq/synapse#17543](https://github.com/element-hq/synapse/pull/17543)))

### Internal Changes

- MSC3861: load the issuer and account management URLs from OIDC discovery. ([\#17407]([element-hq/synapse#17407](https://github.com/element-hq/synapse/pull/17407)))
- Refactor sliding sync class into multiple files. ([\#17595]([element-hq/synapse#17595](https://github.com/element-hq/synapse/pull/17595)))
- Store sliding sync per-connection state in the database. ([\#17599]([element-hq/synapse#17599](https://github.com/element-hq/synapse/pull/17599)))
- Make the sliding sync `PerConnectionState` class immutable. ([\#17600]([element-hq/synapse#17600](https://github.com/element-hq/synapse/pull/17600)))
- Add support to `@tag_args` for standalone functions. ([\#17604]([element-hq/synapse#17604](https://github.com/element-hq/synapse/pull/17604)))
- Speed up incremental syncs in sliding sync by adding some more caching. ([\#17606]([element-hq/synapse#17606](https://github.com/element-hq/synapse/pull/17606)))
- Always return the user's own read receipts in sliding sync. ([\#17617]([element-hq/synapse#17617](https://github.com/element-hq/synapse/pull/17617)))
- Replace `isort` and `black` with `ruff`. ([\#17620]([element-hq/synapse#17620](https://github.com/element-hq/synapse/pull/17620)))
- Refactor sliding sync code to move room list logic out into a separate class. ([\#17622]([element-hq/synapse#17622](https://github.com/element-hq/synapse/pull/17622)))

### Updates to locked dependencies

* Bump attrs from 23.2.0 to 24.2.0. ([\#17609]([element-hq/synapse#17609](https://github.com/element-hq/synapse/pull/17609)))
* Bump cryptography from 42.0.8 to 43.0.0. ([\#17584]([element-hq/synapse#17584](https://github.com/element-hq/synapse/pull/17584)))
* Bump phonenumbers from 8.13.43 to 8.13.44. ([\#17610]([element-hq/synapse#17610](https://github.com/element-hq/synapse/pull/17610)))
* Bump pygithub from 2.3.0 to 2.4.0. ([\#17612]([element-hq/synapse#17612](https://github.com/element-hq/synapse/pull/17612)))
* Bump pyyaml from 6.0.1 to 6.0.2. ([\#17611]([element-hq/synapse#17611](https://github.com/element-hq/synapse/pull/17611)))
* Bump sentry-sdk from 2.12.0 to 2.13.0. ([\#17585]([element-hq/synapse#17585](https://github.com/element-hq/synapse/pull/17585)))
* Bump serde from 1.0.206 to 1.0.208. ([\#17581]([element-hq/synapse#17581](https://github.com/element-hq/synapse/pull/17581)))
* Bump serde from 1.0.208 to 1.0.209. ([\#17613]([element-hq/synapse#17613](https://github.com/element-hq/synapse/pull/17613)))
* Bump serde_json from 1.0.124 to 1.0.125. ([\#17582]([element-hq/synapse#17582](https://github.com/element-hq/synapse/pull/17582)))
* Bump serde_json from 1.0.125 to 1.0.127. ([\#17614]([element-hq/synapse#17614](https://github.com/element-hq/synapse/pull/17614)))
* Bump types-jsonschema from 4.23.0.20240712 to 4.23.0.20240813. ([\#17583]([element-hq/synapse#17583](https://github.com/element-hq/synapse/pull/17583)))
* Bump types-setuptools from 71.1.0.20240726 to 71.1.0.20240818. ([\#17586]([element-hq/synapse#17586](https://github.com/element-hq/synapse/pull/17586)))

# Synapse 1.114.0rc1 (2024-08-20)

### Features

- Add a flag to `/versions`, `org.matrix.simplified_msc3575`, to indicate whether experimental sliding sync support has been enabled. ([\#17571]([element-hq/synapse#17571](https://github.com/element-hq/synapse/pull/17571)))
- Handle changes in `timeline_limit` in experimental sliding sync. ([\#17579]([element-hq/synapse#17579](https://github.com/element-hq/synapse/pull/17579)))
- Correctly track read receipts that should be sent down in experimental sliding sync. ([\#17575]([element-hq/synapse#17575](https://github.com/element-hq/synapse/pull/17575)), [\#17589]([element-hq/synapse#17589](https://github.com/element-hq/synapse/pull/17589)), [\#17592]([element-hq/synapse#17592](https://github.com/element-hq/synapse/pull/17592)))

### Bugfixes

- Start handlers for new media endpoints when media resource configured. ([\#17483]([element-hq/synapse#17483](https://github.com/element-hq/synapse/pull/17483)))
- Fix timeline ordering (using `stream_ordering` instead of topological ordering) in experimental [MSC3575]([matrix-org/matrix-spec-proposals#3575](https://github.com/matrix-org/matrix-spec-proposals/pull/3575)) Sliding Sync `/sync` endpoint. ([\#17510]([element-hq/synapse#17510](https://github.com/element-hq/synapse/pull/17510)))
- Fix experimental sliding sync implementation to remember any updates in rooms that were not sent down immediately. ([\#17535]([element-hq/synapse#17535](https://github.com/element-hq/synapse/pull/17535)))
- Better exclude partially stated rooms if we must await full state in experimental [MSC3575]([matrix-org/matrix-spec-proposals#3575](https://github.com/matrix-org/matrix-spec-proposals/pull/3575)) Sliding Sync `/sync` endpoint. ([\#17538]([element-hq/synapse#17538](https://github.com/element-hq/synapse/pull/17538)))
- Handle lower-case http headers in `_Mulitpart_Parser_Protocol`. ([\#17545]([element-hq/synapse#17545](https://github.com/element-hq/synapse/pull/17545)))
- Fix fetching federation signing keys from servers that omit `old_verify_keys`. Contributed by [@tulir](https://github.com/tulir) @ Beeper. ([\#17568]([element-hq/synapse#17568](https://github.com/element-hq/synapse/pull/17568)))
- Fix bug where we would respond with an error when a remote server asked for media that had a length of 0, using the new multipart federation media endpoint. ([\#17570]([element-hq/synapse#17570](https://github.com/element-hq/synapse/pull/17570)))

### Improved Documentation

- Clarify default behaviour of the
  [`auto_accept_invites.worker_to_run_on`](<https://element-hq.github.io/synapse/develop/usage/configuration/config_documentation.html#auto-accept-invites>)
  option. ([\#17515]([element-hq/synapse#17515](https://github.com/element-hq/synapse/pull/17515)))
- Improve docstrings for profile methods. ([\#17559]([element-hq/synapse#17559](https://github.com/element-hq/synapse/pull/17559)))

### Internal Changes

- Add more tracing to experimental [MSC3575]([matrix-org/matrix-spec-proposals#3575](https://github.com/matrix-org/matrix-spec-proposals/pull/3575)) Sliding Sync `/sync` endpoint. ([\#17514]([element-hq/synapse#17514](https://github.com/element-hq/synapse/pull/17514)))
- Fixup comment in sliding sync implementation. ([\#17531]([element-hq/synapse#17531](https://github.com/element-hq/synapse/pull/17531)))
- Replace override of deprecated method `HTTPAdapter.get_connection` with `get_connection_with_tls_context`. ([\#17536]([element-hq/synapse#17536](https://github.com/element-hq/synapse/pull/17536)))
- Fix performance of device lists in `/key/changes` and sliding sync. ([\#17537]([element-hq/synapse#17537](https://github.com/element-hq/synapse/pull/17537)), [\#17548]([element-hq/synapse#17548](https://github.com/element-hq/synapse/pull/17548)))
- Bump setuptools from 67.6.0 to 72.1.0. ([\#17542]([element-hq/synapse#17542](https://github.com/element-hq/synapse/pull/17542)))
- Add a utility function for generating random event IDs. ([\#17557]([element-hq/synapse#17557](https://github.com/element-hq/synapse/pull/17557)))
- Speed up responding to media requests. ([\#17558]([element-hq/synapse#17558](https://github.com/element-hq/synapse/pull/17558)), [\#17561]([element-hq/synapse#17561](https://github.com/element-hq/synapse/pull/17561)), [\#17564]([element-hq/synapse#17564](https://github.com/element-hq/synapse/pull/17564)), [\#17566]([element-hq/synapse#17566](https://github.com/element-hq/synapse/pull/17566)), [\#17567]([element-hq/synapse#17567](https://github.com/element-hq/synapse/pull/17567)), [\#17569]([element-hq/synapse#17569](https://github.com/element-hq/synapse/pull/17569)))
- Test github token before running release script steps. ([\#17562]([element-hq/synapse#17562](https://github.com/element-hq/synapse/pull/17562)))
- Reduce log spam of multipart files. ([\#17563]([element-hq/synapse#17563](https://github.com/element-hq/synapse/pull/17563)))
- Refactor per-connection state in experimental sliding sync handler. ([\#17574]([element-hq/synapse#17574](https://github.com/element-hq/synapse/pull/17574)))
- Add histogram metrics for sliding sync processing time. ([\#17593]([element-hq/synapse#17593](https://github.com/element-hq/synapse/pull/17593)))

### Updates to locked dependencies

* Bump bytes from 1.6.1 to 1.7.1. ([\#17526]([element-hq/synapse#17526](https://github.com/element-hq/synapse/pull/17526)))
* Bump lxml from 5.2.2 to 5.3.0. ([\#17550]([element-hq/synapse#17550](https://github.com/element-hq/synapse/pull/17550)))
* Bump phonenumbers from 8.13.42 to 8.13.43. ([\#17551]([element-hq/synapse#17551](https://github.com/element-hq/synapse/pull/17551)))
* Bump regex from 1.10.5 to 1.10.6. ([\#17527]([element-hq/synapse#17527](https://github.com/element-hq/synapse/pull/17527)))
* Bump sentry-sdk from 2.10.0 to 2.12.0. ([\#17553]([element-hq/synapse#17553](https://github.com/element-hq/synapse/pull/17553)))
* Bump serde from 1.0.204 to 1.0.206. ([\#17556]([element-hq/synapse#17556](https://github.com/element-hq/synapse/pull/17556)))
* Bump serde_json from 1.0.122 to 1.0.124. ([\#17555]([element-hq/synapse#17555](https://github.com/element-hq/synapse/pull/17555)))
* Bump sigstore/cosign-installer from 3.5.0 to 3.6.0. ([\#17549]([element-hq/synapse#17549](https://github.com/element-hq/synapse/pull/17549)))
* Bump types-pyyaml from 6.0.12.20240311 to 6.0.12.20240808. ([\#17552]([element-hq/synapse#17552](https://github.com/element-hq/synapse/pull/17552)))
* Bump types-requests from 2.31.0.20240406 to 2.32.0.20240712. ([\#17524]([element-hq/synapse#17524](https://github.com/element-hq/synapse/pull/17524)))

# Synapse 1.113.0 (2024-08-13)

No significant changes since 1.113.0rc1.

# Synapse 1.113.0rc1 (2024-08-06)

### Features

- Track which rooms have been sent to clients in the experimental [MSC3575]([matrix-org/matrix-spec-proposals#3575](https://github.com/matrix-org/matrix-spec-proposals/pull/3575)) Sliding Sync `/sync` endpoint. ([\#17447]([element-hq/synapse#17447](https://github.com/element-hq/synapse/pull/17447)))
- Add Account Data extension support to experimental [MSC3575]([matrix-org/matrix-spec-proposals#3575](https://github.com/matrix-org/matrix-spec-proposals/pull/3575)) Sliding Sync `/sync` endpoint. ([\#17477]([element-hq/synapse#17477](https://github.com/element-hq/synapse/pull/17477)))
- Add receipts extension support to experimental [MSC3575]([matrix-org/matrix-spec-proposals#3575](https://github.com/matrix-org/matrix-spec-proposals/pull/3575)) Sliding Sync `/sync` endpoint. ([\#17489]([element-hq/synapse#17489](https://github.com/element-hq/synapse/pull/17489)))
- Add typing notification extension support to experimental [MSC3575]([matrix-org/matrix-spec-proposals#3575](https://github.com/matrix-org/matrix-spec-proposals/pull/3575)) Sliding Sync `/sync` endpoint. ([\#17505]([element-hq/synapse#17505](https://github.com/element-hq/synapse/pull/17505)))

### Bugfixes

- Update experimental [MSC3575]([matrix-org/matrix-spec-proposals#3575](https://github.com/matrix-org/matrix-spec-proposals/pull/3575)) Sliding Sync `/sync` endpoint to handle invite/knock rooms when filtering. ([\#17450]([element-hq/synapse#17450](https://github.com/element-hq/synapse/pull/17450)))
- Fix a bug introduced in v1.110.0 which caused `/keys/query` to return incomplete results, leading to high network activity and CPU usage on Matrix clients. ([\#17499]([element-hq/synapse#17499](https://github.com/element-hq/synapse/pull/17499)))

### Improved Documentation

- Update the [`allowed_local_3pids`](<https://element-hq.github.io/synapse/v1.112/usage/configuration/config_documentation.html#allowed_local_3pids>) config option's msisdn address to a working example. ([\#17476]([element-hq/synapse#17476](https://github.com/element-hq/synapse/pull/17476)))

### Internal Changes

- Change sliding sync to use their own token format in preparation for storing per-connection state. ([\#17452]([element-hq/synapse#17452](https://github.com/element-hq/synapse/pull/17452)))
- Ensure we don't send down negative `bump_stamp` in experimental sliding sync endpoint. ([\#17478]([element-hq/synapse#17478](https://github.com/element-hq/synapse/pull/17478)))
- Do not send down empty room entries down experimental sliding sync endpoint. ([\#17479]([element-hq/synapse#17479](https://github.com/element-hq/synapse/pull/17479)))
- Refactor Sliding Sync tests to better utilize the `SlidingSyncBase`. ([\#17481]([element-hq/synapse#17481](https://github.com/element-hq/synapse/pull/17481)), [\#17482]([element-hq/synapse#17482](https://github.com/element-hq/synapse/pull/17482)))
- Add some opentracing tags and logging to the experimental sliding sync implementation. ([\#17501]([element-hq/synapse#17501](https://github.com/element-hq/synapse/pull/17501)))
- Split and move Sliding Sync tests so we have some more sane test file sizes. ([\#17504]([element-hq/synapse#17504](https://github.com/element-hq/synapse/pull/17504)))
- Update the `limited` field description in the Sliding Sync response to accurately describe what it actually represents. ([\#17507]([element-hq/synapse#17507](https://github.com/element-hq/synapse/pull/17507)))
- Easier to understand `timeline` assertions in Sliding Sync tests. ([\#17511]([element-hq/synapse#17511](https://github.com/element-hq/synapse/pull/17511)))
- Reset the sliding sync connection if we don't recognize the per-connection state position. ([\#17529]([element-hq/synapse#17529](https://github.com/element-hq/synapse/pull/17529)))

### Updates to locked dependencies

* Bump bcrypt from 4.1.3 to 4.2.0. ([\#17495]([element-hq/synapse#17495](https://github.com/element-hq/synapse/pull/17495)))
* Bump black from 24.4.2 to 24.8.0. ([\#17522]([element-hq/synapse#17522](https://github.com/element-hq/synapse/pull/17522)))
* Bump phonenumbers from 8.13.39 to 8.13.42. ([\#17521]([element-hq/synapse#17521](https://github.com/element-hq/synapse/pull/17521)))
* Bump ruff from 0.5.4 to 0.5.5. ([\#17494]([element-hq/synapse#17494](https://github.com/element-hq/synapse/pull/17494)))
* Bump serde_json from 1.0.120 to 1.0.121. ([\#17493]([element-hq/synapse#17493](https://github.com/element-hq/synapse/pull/17493)))
* Bump serde_json from 1.0.121 to 1.0.122. ([\#17525]([element-hq/synapse#17525](https://github.com/element-hq/synapse/pull/17525)))
* Bump towncrier from 23.11.0 to 24.7.1. ([\#17523]([element-hq/synapse#17523](https://github.com/element-hq/synapse/pull/17523)))
* Bump types-pyopenssl from 24.1.0.20240425 to 24.1.0.20240722. ([\#17496]([element-hq/synapse#17496](https://github.com/element-hq/synapse/pull/17496)))
* Bump types-setuptools from 70.1.0.20240627 to 71.1.0.20240726. ([\#17497]([element-hq/synapse#17497](https://github.com/element-hq/synapse/pull/17497)))
```

[![@tcpipuk](https://avatars.githubusercontent.com/u/20157053?s=40&v=4)](/tcpipuk)
[tcpipuk](/tcpipuk)
mentioned this pull request
[Sep 19, 2024](#ref-issue-2535068317)

[accuracy of the nginx routing rules with the recent changes in auth media and sliding sync?
tcpipuk/tcpipuk.github.io#20](/tcpipuk/tcpipuk.github.io/issues/20)

Closed

[![deepbluev7](https://avatars.githubusercontent.com/u/16312324?s=60&v=4)](/deepbluev7)

**[deepbluev7](/deepbluev7)**
reviewed
[Sep 19, 2024](#pullrequestreview-2315503086)

 [View reviewed changes](/matrix-org/matrix-spec-proposals/pull/4186/files/6fe4ba72da515f3e473be42a57a7a32f03e303f8)

[proposals/4186-simplified-sliding-sync.md](/matrix-org/matrix-spec-proposals/pull/4186/files/6fe4ba72da515f3e473be42a57a7a32f03e303f8#diff-43c51cf6108a7004b0d27da42a67f6874a8d34975fa4375b6d1bca9c0fb8d44b)

|  |  | // Flag which only returns rooms which have an `m.room.encryption` state event. If unset, |
| --- | --- | --- |
|  |  | // both encrypted and unencrypted rooms are returned. If false, only unencrypted rooms |
|  |  | // are returned. If true, only encrypted rooms are returned. |
|  |  | "is\_invite": true|false|null, |

Copy link

Contributor

### @deepbluev7 **[deepbluev7](/deepbluev7)** [Sep 19, 2024](#discussion_r1766810405)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

How will knocks and left rooms be handled? Maybe this should be a string and be the current membership of the user?

Sorry, something went wrong.

All reactions

[![MadLittleMods](https://avatars.githubusercontent.com/u/558581?s=60&v=4)](/MadLittleMods)

**[MadLittleMods](/MadLittleMods)**
reviewed
[Sep 19, 2024](#pullrequestreview-2316007888)

 [View reviewed changes](/matrix-org/matrix-spec-proposals/pull/4186/files/6fe4ba72da515f3e473be42a57a7a32f03e303f8)

[proposals/4186-simplified-sliding-sync.md](/matrix-org/matrix-spec-proposals/pull/4186/files/6fe4ba72da515f3e473be42a57a7a32f03e303f8#diff-43c51cf6108a7004b0d27da42a67f6874a8d34975fa4375b6d1bca9c0fb8d44b)

Comment on lines
+265
 to
+266

|  |  | // Same as in sync v2. Indicates whether there are more events to fetch than those in the timeline. |
| --- | --- | --- |
|  |  | "limited:" true|null, |

Copy link

Contributor

### @MadLittleMods **[MadLittleMods](/MadLittleMods)** [Sep 19, 2024](#discussion_r1767108713)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Clarify what `limited` means when complicating it with gaps, newly joined, newly joined a room where you can't see the history, etc

Sync v2 in Synapse is a bit crazy with the logic probably because the spec isn't clear.

The existing definition seems accurate "Indicates whether there are more events to fetch than those in the timeline." Could maybe clarify that you can be `limited` if there is timeline gap and you stop at the gap and say `limited: true` so the client paginates over the gap themselves. And maybe also need to say that being newly joined doesn't factor in.

Sorry, something went wrong.

All reactions

2 hidden items

Load more‚Ä¶

[![MadLittleMods](https://avatars.githubusercontent.com/u/558581?s=60&v=4)](/MadLittleMods)

**[MadLittleMods](/MadLittleMods)**
reviewed
[Sep 19, 2024](#pullrequestreview-2316589387)

 [View reviewed changes](/matrix-org/matrix-spec-proposals/pull/4186/files/6fe4ba72da515f3e473be42a57a7a32f03e303f8)

[proposals/4186-simplified-sliding-sync.md](/matrix-org/matrix-spec-proposals/pull/4186/files/6fe4ba72da515f3e473be42a57a7a32f03e303f8#diff-43c51cf6108a7004b0d27da42a67f6874a8d34975fa4375b6d1bca9c0fb8d44b)

Comment on lines
+349
 to
+360

|  |  | ## Timeline event trickling |
| --- | --- | --- |
|  |  |  |
|  |  | If the `timeline\_limit` is increased then the server will send down historic data (c.f. "Room config changes"), which |
|  |  | allows the clients to easily preload more history in recent rooms. |
|  |  |  |
|  |  | This mechanism is fiddly to implement, and ends up resending down events that we have previously sent to the client. |
|  |  |  |
|  |  | A simpler alternative is to use `/messages` to fetch the history. This has two main problems: 1) clients generally want |
|  |  | to preload history for multiple rooms at once, and 2) `/messages` can be slow if it tries to backfill over federation. |
|  |  |  |
|  |  | We could implement a bulk `/messages` endpoint, where the client would specify multiple rooms and `prev\_batch` tokens. |
|  |  | We can also add a flag to disable attempting to backfill over pagination (to match the behaviour of the sync timeline). |

Copy link

Contributor

### @MadLittleMods **[MadLittleMods](/MadLittleMods)** [Sep 19, 2024](#discussion_r1767500062) ‚Ä¢ edited Loading

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Please kill `unstable_expanded_timeline` with one of these alternatives. It was implemented in Simplified Sliding Sync solely to match what the [Sliding Sync proxy](https://github.com/matrix-org/sliding-sync) did. And the proxy behavior was a [bug not a feature](https://github.com/element-hq/synapse/pull/17503#discussion_r1718416282) (self-described)

Previous conversation:

* [Sliding Sync: Handle room\_subscriptions that increase the `timeline_limit`¬†element-hq/synapse#17503 (comment)](https://github.com/element-hq/synapse/pull/17503#discussion_r1697697828)
* [Sliding Sync: Handle timeline limit changes (take 2)¬†element-hq/synapse#17579 (comment)](https://github.com/element-hq/synapse/pull/17579#discussion_r1722359771)

Sorry, something went wrong.

All reactions

[![MadLittleMods](https://avatars.githubusercontent.com/u/558581?s=60&v=4)](/MadLittleMods)

**[MadLittleMods](/MadLittleMods)**
reviewed
[Sep 19, 2024](#pullrequestreview-2316616878)

 [View reviewed changes](/matrix-org/matrix-spec-proposals/pull/4186/files/6fe4ba72da515f3e473be42a57a7a32f03e303f8)

[proposals/4186-simplified-sliding-sync.md](/matrix-org/matrix-spec-proposals/pull/4186/files/6fe4ba72da515f3e473be42a57a7a32f03e303f8#diff-43c51cf6108a7004b0d27da42a67f6874a8d34975fa4375b6d1bca9c0fb8d44b)

Comment on lines
+247
 to
+249

|  |  | // Aggregated rooms from lists and room subscriptions. There will be one entry per room, even if |
| --- | --- | --- |
|  |  | // the room appears in multiple lists and/or room subscriptions. |
|  |  | "rooms": { |

Copy link

Contributor

### @MadLittleMods **[MadLittleMods](/MadLittleMods)** [Sep 19, 2024](#discussion_r1767516414)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Clarify which rooms should be showing up.

We want to return every room where the user has membership except rooms that the user has left themselves; unless "newly left" (left since the last incremental sync `pos` token) because we want everything that's *still* relevant to the user. We include "newly left" rooms because the last event that the user should see is their own `leave` event.

A `leave` != kick (leave events where the sender is not the same user). Kicks should always be included.

To say it another way, here is a list:

* `join`
* `invite`
* `knock`
* `ban`
* Kicks (`leave` where the `sender` doesn't match the `state_key`)
* Newly left rooms (`leave` membership that happened since the last incremental sync `pos` token)

Sorry, something went wrong.

All reactions

Copy link

Member

### @clokep **[clokep](/clokep)** [Sep 20, 2024](#discussion_r1767747047)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Should you only include `ban` if there is a previous `join`, `invite`, or `knock`? :) (Maybe scope creep.)

Sorry, something went wrong.

All reactions

Copy link

Contributor

### @MadLittleMods **[MadLittleMods](/MadLittleMods)** [Sep 20, 2024](#discussion_r1767891429)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

I also had that in mind but I'm not sure (could go either way). It's kinda the same as an unsolicited invite (optionally followed by a kick/`ban`).

Ideally, we probably wouldn't show those kind of `ban`

Sorry, something went wrong.

 üëç
1
 clokep reacted with thumbs up emoji

All reactions

* üëç
  1 reaction

[![MadLittleMods](https://avatars.githubusercontent.com/u/558581?s=60&v=4)](/MadLittleMods)

**[MadLittleMods](/MadLittleMods)**
reviewed
[Sep 19, 2024](#pullrequestreview-2316725402)

 [View reviewed changes](/matrix-org/matrix-spec-proposals/pull/4186/files/6fe4ba72da515f3e473be42a57a7a32f03e303f8)

[proposals/4186-simplified-sliding-sync.md](/matrix-org/matrix-spec-proposals/pull/4186/files/6fe4ba72da515f3e473be42a57a7a32f03e303f8#diff-43c51cf6108a7004b0d27da42a67f6874a8d34975fa4375b6d1bca9c0fb8d44b)

Comment on lines
+214
 to
+216

|  |  | "room\_subscriptions": { |
| --- | --- | --- |
|  |  | // The key is the room to subscribe to. |
|  |  | "!foo:example.com": { |

Copy link

Contributor

### @MadLittleMods **[MadLittleMods](/MadLittleMods)** [Sep 19, 2024](#discussion_r1767582765)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

*Re-adding [this discussion](https://github.com/matrix-org/matrix-spec-proposals/pull/3575#discussion_r1638988556) from the other [MSC3575](https://github.com/matrix-org/matrix-doc/pull/3575):*

What should happen if you try to subscribe to a room you are not part of (or not allowed)?

The easy option would be to ignore it but then clients have no feedback about what they did wrong.

Perhaps entries in the `rooms` map could also have an `errcode`/`error` field. We could also just blow up the whole request with an error and point out which `room_id` is wrong although that isn't very machine-readable.

---

Can you subscribe to a public `world_readable` room that you're not part of?

Sorry, something went wrong.

All reactions

[![Hywan](https://avatars.githubusercontent.com/u/946104?s=60&v=4)](/Hywan)

**[Hywan](/Hywan)**
reviewed
[Sep 24, 2024](#pullrequestreview-2324473161)

 [View reviewed changes](/matrix-org/matrix-spec-proposals/pull/4186/files/6fe4ba72da515f3e473be42a57a7a32f03e303f8)

[proposals/4186-simplified-sliding-sync.md](/matrix-org/matrix-spec-proposals/pull/4186/files/6fe4ba72da515f3e473be42a57a7a32f03e303f8#diff-43c51cf6108a7004b0d27da42a67f6874a8d34975fa4375b6d1bca9c0fb8d44b)

|  |  | // Whether the room is a DM room. |
| --- | --- | --- |
|  |  | "is\_dm": true|null, |
|  |  |  |
|  |  | // An opaque integer that can be used to sort the rooms by "Bump Stamp" |

Copy link

Member

### @Hywan **[Hywan](/Hywan)** [Sep 24, 2024](#discussion_r1772874064)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Suggested change

|  | // An opaque integer that can be used to sort the rooms by "Bump Stamp" |
| --- | --- |
|  | // An opaque unsigned 64-bits integer that can be used to sort the rooms by "Bump Stamp" |

We may also precise that `bump_stamp` has a [total order](https://en.wikipedia.org/wiki/Total_order).

Sorry, something went wrong.

All reactions

[![ara4n](https://avatars.githubusercontent.com/u/1294269?s=60&v=4)](/ara4n)

**[ara4n](/ara4n)**
reviewed
[Sep 24, 2024](#pullrequestreview-2324790884)

 [View reviewed changes](/matrix-org/matrix-spec-proposals/pull/4186/files/6fe4ba72da515f3e473be42a57a7a32f03e303f8)

[proposals/4186-simplified-sliding-sync.md](/matrix-org/matrix-spec-proposals/pull/4186/files/6fe4ba72da515f3e473be42a57a7a32f03e303f8#diff-43c51cf6108a7004b0d27da42a67f6874a8d34975fa4375b6d1bca9c0fb8d44b)

|  |  | This is particularly problematic if the user gets "state reset" out of the room, where the server has no mechanism to |
| --- | --- | --- |
|  |  | indicate to the client that the user has effectively left the room (the server has no leave event to return). |
|  |  |  |
|  |  | We may want to allow special entries in the `required\_state` list of the form |

Copy link

Member

### @ara4n **[ara4n](/ara4n)** [Sep 24, 2024](#discussion_r1773067823)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Surely this isn't a nice-to-have but a requirement, otherwise we end up back in [matrix-org/matrix-spec#1209](https://github.com/matrix-org/matrix-spec/issues/1209)

Sorry, something went wrong.

 üëç
1
 Cadair reacted with thumbs up emoji

All reactions

* üëç
  1 reaction

[![Hywan](https://avatars.githubusercontent.com/u/946104?s=60&v=4)](/Hywan)

**[Hywan](/Hywan)**
reviewed
[Sep 25, 2024](#pullrequestreview-2327518581)

 [View reviewed changes](/matrix-org/matrix-spec-proposals/pull/4186/files/6fe4ba72da515f3e473be42a57a7a32f03e303f8)

[proposals/4186-simplified-sliding-sync.md](/matrix-org/matrix-spec-proposals/pull/4186/files/6fe4ba72da515f3e473be42a57a7a32f03e303f8#diff-43c51cf6108a7004b0d27da42a67f6874a8d34975fa4375b6d1bca9c0fb8d44b)

|  |  | "bump\_stamp": 1, |
| --- | --- | --- |
|  |  |  |
|  |  | // These are the same as sync v2. |
|  |  | "joined\_count": 1, |

Copy link

Member

### @Hywan **[Hywan](/Hywan)** [Sep 25, 2024](#discussion_r1774775560)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Should be precised that `joined_count` is given only if the room has been joined. For invite room, this value will be missing.

Sorry, something went wrong.

All reactions

[![@Hywan](https://avatars.githubusercontent.com/u/946104?s=40&v=4)](/Hywan)
[Hywan](/Hywan)
mentioned this pull request
[Sep 25, 2024](#ref-issue-2545854976)

[Sliding sync returns `initial: false` for a first response
element-hq/synapse#17754](/element-hq/synapse/issues/17754)

Closed

[Hywan](/Hywan)
added a commit
to Hywan/matrix-rust-sdk
that referenced
this pull request
[Sep 25, 2024](#ref-commit-076ad38)
[![@Hywan](https://avatars.githubusercontent.com/u/946104?s=40&v=4)](/Hywan)

`[test(integration): Enable test_notification.](/Hywan/matrix-rust-sdk/commit/076ad38e346039537b5d6891dda9bb09dba3e45c "test(integration): Enable `test_notification`.

This test was failing since the migration from the sliding sync proxy
to Synapse.

This patch fixes the test. The failing part was:

```rust
assert_eq!(notification.joined_members_count, 1);
```

This patch changes the value from 1 to 0. Indeed, Synapse doesn't share
this data for the sake of privacy because the room is not joined.

A comment has been made on MSC4186 to precise this behaviour:
https://github.com/matrix-org/matrix-spec-proposals/pull/4186#discussion_r1774775560.

Moreover, this test was asserting a bug (which is alright), but now
a bug report has been made. The patch contains the link to this bug
report.

The code has been a bit rewritten to make it simpler, and more comments
have been added.")`
‚Ä¶

`[076ad38](/Hywan/matrix-rust-sdk/commit/076ad38e346039537b5d6891dda9bb09dba3e45c)`

```
This test was failing since the migration from the sliding sync proxy
to Synapse.

This patch fixes the test. The failing part was:

```rust
assert_eq!(notification.joined_members_count, 1);
```

This patch changes the value from 1 to 0. Indeed, Synapse doesn't share
this data for the sake of privacy because the room is not joined.

A comment has been made on MSC4186 to precise this behaviour:
[matrix-org/matrix-spec-proposals#4186 (comment)](https://github.com/matrix-org/matrix-spec-proposals/pull/4186#discussion_r1774775560).

Moreover, this test was asserting a bug (which is alright), but now
a bug report has been made. The patch contains the link to this bug
report.

The code has been a bit rewritten to make it simpler, and more comments
have been added.
```

[![@Hywan](https://avatars.githubusercontent.com/u/946104?s=40&v=4)](/Hywan)
[Hywan](/Hywan)
mentioned this pull request
[Sep 25, 2024](#ref-pullrequest-2547369522)

[test(integration): Enable `test_notification`
matrix-org/matrix-rust-sdk#4029](/matrix-org/matrix-rust-sdk/pull/4029)
 Merged

[Hywan](/Hywan)
added a commit
to Hywan/matrix-rust-sdk
that referenced
this pull request
[Sep 25, 2024](#ref-commit-06f5b2a)
[![@Hywan](https://avatars.githubusercontent.com/u/946104?s=40&v=4)](/Hywan)

`[test(integration): Enable test_notification.](/Hywan/matrix-rust-sdk/commit/06f5b2a77aedd440670f43bc6b821d072082289c "test(integration): Enable `test_notification`.

This test was failing since the migration from the sliding sync proxy
to Synapse.

This patch fixes the test. The failing part was:

```rust
assert_eq!(notification.joined_members_count, 1);
```

This patch changes the value from 1 to 0. Indeed, Synapse doesn't share
this data for the sake of privacy because the room is not joined.

A comment has been made on MSC4186 to precise this behaviour:
https://github.com/matrix-org/matrix-spec-proposals/pull/4186#discussion_r1774775560.

Moreover, this test was asserting a bug (which is alright), but now
a bug report has been made. The patch contains the link to this bug
report.

The code has been a bit rewritten to make it simpler, and more comments
have been added.")`
‚Ä¶

`[06f5b2a](/Hywan/matrix-rust-sdk/commit/06f5b2a77aedd440670f43bc6b821d072082289c)`

```
This test was failing since the migration from the sliding sync proxy
to Synapse.

This patch fixes the test. The failing part was:

```rust
assert_eq!(notification.joined_members_count, 1);
```

This patch changes the value from 1 to 0. Indeed, Synapse doesn't share
this data for the sake of privacy because the room is not joined.

A comment has been made on MSC4186 to precise this behaviour:
[matrix-org/matrix-spec-proposals#4186 (comment)](https://github.com/matrix-org/matrix-spec-proposals/pull/4186#discussion_r1774775560).

Moreover, this test was asserting a bug (which is alright), but now
a bug report has been made. The patch contains the link to this bug
report.

The code has been a bit rewritten to make it simpler, and more comments
have been added.
```

[![Hywan](https://avatars.githubusercontent.com/u/946104?s=60&v=4)](/Hywan)

**[Hywan](/Hywan)**
reviewed
[Sep 25, 2024](#pullrequestreview-2328108923)

 [View reviewed changes](/matrix-org/matrix-spec-proposals/pull/4186/files/6fe4ba72da515f3e473be42a57a7a32f03e303f8)

[proposals/4186-simplified-sliding-sync.md](/matrix-org/matrix-spec-proposals/pull/4186/files/6fe4ba72da515f3e473be42a57a7a32f03e303f8#diff-43c51cf6108a7004b0d27da42a67f6874a8d34975fa4375b6d1bca9c0fb8d44b)

|  |  | }, |
| --- | --- | --- |
|  |  |  |
|  |  | // The maximum number of timeline events to return per response. |
|  |  | "timeline\_limit": 10, |

Copy link

Member

### @Hywan **[Hywan](/Hywan)** [Sep 25, 2024](#discussion_r1775138458)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

[MSC3575](https://github.com/matrix-org/matrix-doc/pull/3575) (at least its implementation inside the sliding sync proxy) allowed `timeline_limit` to be null. This is NOT the case with [MSC4186](https://github.com/matrix-org/matrix-doc/pull/4186) (as implemented inside Synapse). I believe the MSC should clarify this value is required.

Sorry, something went wrong.

All reactions

[Hywan](/Hywan)
added a commit
to Hywan/matrix-rust-sdk
that referenced
this pull request
[Sep 25, 2024](#ref-commit-a623d64)
[![@Hywan](https://avatars.githubusercontent.com/u/946104?s=40&v=4)](/Hywan)

`[test(integration): Enable test_notification.](/Hywan/matrix-rust-sdk/commit/a623d64f7c9b9753af5c4c65763da1f5bd11753f "test(integration): Enable `test_notification`.

This test was failing since the migration from the sliding sync proxy
to Synapse.

This patch fixes the test. The failing part was:

```rust
assert_eq!(notification.joined_members_count, 1);
```

This patch changes the value from 1 to 0. Indeed, Synapse doesn't share
this data for the sake of privacy because the room is not joined.

A comment has been made on MSC4186 to precise this behaviour:
https://github.com/matrix-org/matrix-spec-proposals/pull/4186#discussion_r1774775560.

Moreover, this test was asserting a bug (which is alright), but now
a bug report has been made. The patch contains the link to this bug
report.

The code has been a bit rewritten to make it simpler, and more comments
have been added.")`
‚Ä¶

`[a623d64](/Hywan/matrix-rust-sdk/commit/a623d64f7c9b9753af5c4c65763da1f5bd11753f)`

```
This test was failing since the migration from the sliding sync proxy
to Synapse.

This patch fixes the test. The failing part was:

```rust
assert_eq!(notification.joined_members_count, 1);
```

This patch changes the value from 1 to 0. Indeed, Synapse doesn't share
this data for the sake of privacy because the room is not joined.

A comment has been made on MSC4186 to precise this behaviour:
[matrix-org/matrix-spec-proposals#4186 (comment)](https://github.com/matrix-org/matrix-spec-proposals/pull/4186#discussion_r1774775560).

Moreover, this test was asserting a bug (which is alright), but now
a bug report has been made. The patch contains the link to this bug
report.

The code has been a bit rewritten to make it simpler, and more comments
have been added.
```

[Hywan](/Hywan)
added a commit
to matrix-org/matrix-rust-sdk
that referenced
this pull request
[Sep 25, 2024](#ref-commit-c3caf6c)
[![@Hywan](https://avatars.githubusercontent.com/u/946104?s=40&v=4)](/Hywan)

`[test(integration): Enable test_notification.](/matrix-org/matrix-rust-sdk/commit/c3caf6cbca8ec88a960575db0dc2263a84680f2c "test(integration): Enable `test_notification`.

This test was failing since the migration from the sliding sync proxy
to Synapse.

This patch fixes the test. The failing part was:

```rust
assert_eq!(notification.joined_members_count, 1);
```

This patch changes the value from 1 to 0. Indeed, Synapse doesn't share
this data for the sake of privacy because the room is not joined.

A comment has been made on MSC4186 to precise this behaviour:
https://github.com/matrix-org/matrix-spec-proposals/pull/4186#discussion_r1774775560.

Moreover, this test was asserting a bug (which is alright), but now
a bug report has been made. The patch contains the link to this bug
report.

The code has been a bit rewritten to make it simpler, and more comments
have been added.")`
‚Ä¶

`[c3caf6c](/matrix-org/matrix-rust-sdk/commit/c3caf6cbca8ec88a960575db0dc2263a84680f2c)`

```
This test was failing since the migration from the sliding sync proxy
to Synapse.

This patch fixes the test. The failing part was:

```rust
assert_eq!(notification.joined_members_count, 1);
```

This patch changes the value from 1 to 0. Indeed, Synapse doesn't share
this data for the sake of privacy because the room is not joined.

A comment has been made on [MSC4186](https://github.com/matrix-org/matrix-spec-proposals/pull/4186) to precise this behaviour:
[matrix-org/matrix-spec-proposals#4186 (comment)](https://github.com/matrix-org/matrix-spec-proposals/pull/4186#discussion_r1774775560).

Moreover, this test was asserting a bug (which is alright), but now
a bug report has been made. The patch contains the link to this bug
report.

The code has been a bit rewritten to make it simpler, and more comments
have been added.
```

[![@gnunicorn](https://avatars.githubusercontent.com/u/40496?s=40&v=4)](/gnunicorn)
[gnunicorn](/gnunicorn)
mentioned this pull request
[Oct 6, 2024](#ref-issue-2568677097)

[Implement Simplified Sliding Sync
acterglobal/a3#2225](/acterglobal/a3/issues/2225)

Open

[![@jmartinesp](https://avatars.githubusercontent.com/u/480955?s=80&u=955dbff0f73abed2d5c79cd2fad566c5814eab31&v=4)](/jmartinesp)

Copy link

### **[jmartinesp](/jmartinesp)** commented [Oct 16, 2024](#issuecomment-2417104725)

| I've made a suggestion [in Synapse](https://github.com/element-hq/synapse/issues/17838) to implement a `membership` field for Room objects. This would simplify the logic for the clients a lot, avoiding checks and assumptions, and make sure they'll have consistent behaviours since it'll be the server who explicitly sets this value. |
| --- |

 ‚ù§Ô∏è
1
 bnjbvr reacted with heart emoji

All reactions

* ‚ù§Ô∏è
  1 reaction

Sorry, something went wrong.

[![@MadLittleMods](https://avatars.githubusercontent.com/u/558581?s=40&v=4)](/MadLittleMods)
[MadLittleMods](/MadLittleMods)
mentioned this pull request
[Oct 16, 2024](#ref-issue-2592159657)

[Native sliding sync: add `membership` field to rooms
element-hq/synapse#17838](/element-hq/synapse/issues/17838)

Open

[![jmartinesp](https://avatars.githubusercontent.com/u/480955?s=60&v=4)](/jmartinesp)

**[jmartinesp](/jmartinesp)**
reviewed
[Oct 17, 2024](#pullrequestreview-2374312450)

 [View reviewed changes](/matrix-org/matrix-spec-proposals/pull/4186/files/6fe4ba72da515f3e473be42a57a7a32f03e303f8)

[proposals/4186-simplified-sliding-sync.md](/matrix-org/matrix-spec-proposals/pull/4186/files/6fe4ba72da515f3e473be42a57a7a32f03e303f8#diff-43c51cf6108a7004b0d27da42a67f6874a8d34975fa4375b6d1bca9c0fb8d44b)

Comment on lines
+280
 to
+284

|  |  | // For invites this is the stripped state of the room at the time of invite |
| --- | --- | --- |
|  |  | "invite\_state": [ .. ], |
|  |  |  |
|  |  | // For knocks this is the stripped state of the room at time of knock |
|  |  | "knock\_state": [ .. ], |

Copy link

### @jmartinesp **[jmartinesp](/jmartinesp)** [Oct 17, 2024](#discussion_r1804209410)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

As mentioned [in a comment below](https://github.com/matrix-org/matrix-spec-proposals/pull/4186#issuecomment-2417104725) it would be super useful to have a separate field indicating the user's membership state in a room instead of relying on some rules around `required_state` and `invite_state` and finding the membership event in the client-side.

Also note the current simplified sliding sync version implementation in Synapse uses a single `invite_state` array instead of separate ones for invite and knock. I think it was discussed to rename it to `stripped_state` or something along the lines?

Sorry, something went wrong.

All reactions

[![@Gnuxie](https://avatars.githubusercontent.com/u/50846879?s=40&v=4)](/Gnuxie)
[Gnuxie](/Gnuxie)
mentioned this pull request
[Oct 29, 2024](#ref-pullrequest-2621514027)

[MSC4222: Adding `state_after` to sync v2
#4222](/matrix-org/matrix-spec-proposals/pull/4222)
 Open

[![HarHarLinks](https://avatars.githubusercontent.com/u/2803622?s=60&v=4)](/HarHarLinks)

**[HarHarLinks](/HarHarLinks)**
reviewed
[Nov 2, 2024](#pullrequestreview-2411256264)

 [View reviewed changes](/matrix-org/matrix-spec-proposals/pull/4186/files/6fe4ba72da515f3e473be42a57a7a32f03e303f8)

[proposals/4186-simplified-sliding-sync.md](/matrix-org/matrix-spec-proposals/pull/4186/files/6fe4ba72da515f3e473be42a57a7a32f03e303f8#diff-43c51cf6108a7004b0d27da42a67f6874a8d34975fa4375b6d1bca9c0fb8d44b)

|  |  |  |
| --- | --- | --- |
|  |  | # Unstable prefix |
|  |  |  |
|  |  | The unstable URL for simplified sliding sync is `/org.matrix.simplified\_msc3575/sync`. The flag in `/versions` is |

Copy link

Contributor

### @HarHarLinks **[HarHarLinks](/HarHarLinks)** [Nov 2, 2024](#discussion_r1826574585)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Suggested change

|  | The unstable URL for simplified sliding sync is `/org.matrix.simplified\_msc3575/sync`. The flag in `/versions` is |
| --- | --- |
|  | The unstable URL for simplified sliding sync is `/\_matrix/client/unstable/org.matrix.simplified\_msc3575/sync`. The flag in `/\_matrix/client/versions` is |

Sorry, something went wrong.

All reactions

[![HarHarLinks](https://avatars.githubusercontent.com/u/2803622?s=60&v=4)](/HarHarLinks)

**[HarHarLinks](/HarHarLinks)**
reviewed
[Nov 2, 2024](#pullrequestreview-2411260364)

 [View reviewed changes](/matrix-org/matrix-spec-proposals/pull/4186/files/6fe4ba72da515f3e473be42a57a7a32f03e303f8)

[proposals/4186-simplified-sliding-sync.md](/matrix-org/matrix-spec-proposals/pull/4186/files/6fe4ba72da515f3e473be42a57a7a32f03e303f8#diff-43c51cf6108a7004b0d27da42a67f6874a8d34975fa4375b6d1bca9c0fb8d44b)

|  |  | \*\*TODO\*\* explain how these interact with the room lists, this is the same as in |
| --- | --- | --- |
|  |  | [MSC3575](https://github.com/matrix-org/matrix-spec-proposals/pull/3575) |
|  |  |  |
|  |  | ## Request format |

Copy link

Contributor

### @HarHarLinks **[HarHarLinks](/HarHarLinks)** [Nov 2, 2024](#discussion_r1826577660)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

which of these are required and which optional?

Sorry, something went wrong.

 üëç
1
 olivia-fl reacted with thumbs up emoji

All reactions

* üëç
  1 reaction

[![MadLittleMods](https://avatars.githubusercontent.com/u/558581?s=60&v=4)](/MadLittleMods)

**[MadLittleMods](/MadLittleMods)**
reviewed
[Nov 19, 2024](#pullrequestreview-2446659894)

 [View reviewed changes](/matrix-org/matrix-spec-proposals/pull/4186/files/6fe4ba72da515f3e473be42a57a7a32f03e303f8)

[proposals/4186-simplified-sliding-sync.md](/matrix-org/matrix-spec-proposals/pull/4186/files/6fe4ba72da515f3e473be42a57a7a32f03e303f8#diff-43c51cf6108a7004b0d27da42a67f6874a8d34975fa4375b6d1bca9c0fb8d44b)

|  |  | // event \_except\_ for @alice:example.com, and include every other state event. |
| --- | --- | --- |
|  |  | // In addition, ["\*", "\*"], ["m.space.child", "\*"] is an error, the m.space.child filter is not |
|  |  | // required as it would have been returned anyway. |
|  |  | "required\_state": [ ... ], |

Copy link

Contributor

### @MadLittleMods **[MadLittleMods](/MadLittleMods)** [Nov 19, 2024](#discussion_r1849059281) ‚Ä¢ edited Loading

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Clarify that `$LAZY` loading room members should also include invite, ban, kick, membership targets (`state_key`) alongside the `senders` of any events in the timeline.

This ensures that we send down membership updates whenever we see it change in the timeline. This allows clients to cache the membership list for as long as it doesn't get a gappy sync, but still ensures for large gaps the server doesn't need to send down all membership changes.

Reference: [element-hq/synapse#17929](https://github.com/element-hq/synapse/issues/17929)

Sorry, something went wrong.

All reactions

[![turt2live](https://avatars.githubusercontent.com/u/1190097?s=60&v=4)](/turt2live)

**[turt2live](/turt2live)**
reviewed
[Nov 28, 2024](#pullrequestreview-2468714415)

 [View reviewed changes](/matrix-org/matrix-spec-proposals/pull/4186/files/6fe4ba72da515f3e473be42a57a7a32f03e303f8)

[proposals/4186-simplified-sliding-sync.md](/matrix-org/matrix-spec-proposals/pull/4186/files/6fe4ba72da515f3e473be42a57a7a32f03e303f8#diff-43c51cf6108a7004b0d27da42a67f6874a8d34975fa4375b6d1bca9c0fb8d44b)

|  |  | "invite\_state": [ .. ], |
| --- | --- | --- |
|  |  |  |
|  |  | // For knocks this is the stripped state of the room at time of knock |
|  |  | "knock\_state": [ .. ], |

Copy link

Member

### @turt2live **[turt2live](/turt2live)** [Nov 28, 2024](#discussion_r1862594459)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

There should also be a `knock_servers` field, copying [#4233](https://github.com/matrix-org/matrix-spec-proposals/pull/4233)

Sorry, something went wrong.

All reactions

[![foresto](https://avatars.githubusercontent.com/u/322134?s=60&v=4)](/foresto)

**[foresto](/foresto)**
reviewed
[Nov 30, 2024](#pullrequestreview-2470613782)

 [View reviewed changes](/matrix-org/matrix-spec-proposals/pull/4186/files/6fe4ba72da515f3e473be42a57a7a32f03e303f8)

[proposals/4186-simplified-sliding-sync.md](/matrix-org/matrix-spec-proposals/pull/4186/files/6fe4ba72da515f3e473be42a57a7a32f03e303f8#diff-43c51cf6108a7004b0d27da42a67f6874a8d34975fa4375b6d1bca9c0fb8d44b)

|  |  | // all state events are returned by default, and additional entries FILTER OUT the returned set |
| --- | --- | --- |
|  |  | // of state events. These additional entries cannot use '\*' themselves. |
|  |  | // For example, ["\*", "\*"], ["m.room.member", "@alice:example.com"] will \_exclude\_ every m.room.member |
|  |  | // event \_except\_ for @alice:example.com, and include every other state event. |

Copy link

### @foresto **[foresto](/foresto)** [Nov 30, 2024](#discussion_r1864013276) ‚Ä¢ edited Loading

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

I find this confusing.

> One unique exception is when you request all state events via ["*", "*"]. When used,
>
> all state events are returned by default, and additional entries FILTER OUT the returned set
>
> of state events.

Okay, so `["*", "*"]` is an *include* directive, and should yield all the events except those indicated by additional tuples. In other words, additional tuples will be *exclude* directives modifying this wildcard *include*. That seems fine so far, but...

> For example, ["*", "*"], ["m.room.member", "[@alice](https://github.com/alice):example.com"] will *exclude* every m.room.member
>
> event *except* for [@alice](https://github.com/alice):example.com,

Here we have an additional tuple. Its first member is an *exclude* directive modifying the wildcard tuple, just as expected. But its second member is an *include* directive modifying the first part of the tuple itself? Is that right?

Why overload a single tuple to both modify the preceding wildcard tuple and modify itself? This seems inconsistent to me. Why overload it to be both an *exclude* and an *include* directive? I suppose it might be a convenient way to succinctly express commonly wanted filters, but it makes the earlier statement, "additional entries FILTER OUT the returned set of state events to return," something of a contradiction.

If this really is the intent, I think some clarification and elaboration would be helpful. At the very least, rephrasing to remove the apparent contradiction. As it stands, this section leaves me wondering if a mistake was introduced in one of the drafts that led here. I'm not confident implementing a client based on it.

Sorry, something went wrong.

All reactions

Copy link

Contributor

### @MadLittleMods **[MadLittleMods](/MadLittleMods)** [Nov 30, 2024](#discussion_r1864067139)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

This behavior comes from the prior art in [MSC3575](https://github.com/matrix-org/matrix-spec-proposals/pull/3575).

Proposed alternative in [#4186 (comment)](https://github.com/matrix-org/matrix-spec-proposals/pull/4186#discussion_r1742194906) which is a lot more straight-forward üëç

Sorry, something went wrong.

 üëç
1
 foresto reacted with thumbs up emoji

All reactions

* üëç
  1 reaction

Copy link

### @foresto **[foresto](/foresto)** [Nov 30, 2024](#discussion_r1864662200)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

I agree with that proposal: Using `state` and `not_state`, with the same semantics as used elsewhere in the protocol. It would be easier to understand, and consistent both locally and with other parts of the spec.

(It follows the convention established by `room_types` / `not_room_types` in this proposal's room lists, and `rooms` / `not_rooms` in Matrix v1.12's [RoomFilter](https://spec.matrix.org/v1.12/client-server-api/#post_matrixclientv3useruseridfilter) object.)

Sorry, something went wrong.

All reactions

Copy link

### @foresto **[foresto](/foresto)** [Nov 30, 2024](#discussion_r1864668168) ‚Ä¢ edited Loading

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Would it then make sense to merge `room_types` / `not_room_types` into `state` / `not_state`? The `m.room.create` event is a state event, after all.

They reference different sub-fields, though: `type` vs. `state_key`. So merging them would require some way to indicate which sub-field applies in any given tuple. Perhaps that would be too complex? Or even if not too complex, perhaps having room type filters separate from membership filters is a better fit for common use cases?

I suppose merging them could always be considered in a future protocol version, if real-world usage proves that doing so would be an improvement.

Sorry, something went wrong.

All reactions

[![@foresto](https://avatars.githubusercontent.com/u/322134?s=80&u=d5b31922dee4d31874bf19814b881f052b1e1186&v=4)](/foresto)

Copy link

### **[foresto](/foresto)** commented [Nov 30, 2024](#issuecomment-2509481505) ‚Ä¢ edited Loading

| It would be nice if room lists had a way to filter by room tags. For example, a client might want only rooms with the `m.favourite` tag, or to exclude rooms with the `m.lowpriority` tag. (In fact, I have a non-chat client that wants the latter by default.)  Tags are [stored in a room's account data](https://spec.matrix.org/v1.12/client-server-api/#room-tagging), though. I see that this proposal explicitly relegates account data *retrieval* to an extension ([MSC3959](https://github.com/matrix-org/matrix-doc/pull/3959)). What about account data as a *filtering* condition?  I don't know how widely users are tagging their rooms today, but if it's common (or ever becomes so), this would seem a good opportunity to lighten the load on the servers and make clients feel faster. And having the capability here the core protocol, rather than an extension, would make clients more likely to implement it. |
| --- |

All reactions

Sorry, something went wrong.

[![olivia-fl](https://avatars.githubusercontent.com/u/6504174?s=60&v=4)](/olivia-fl)

**[olivia-fl](/olivia-fl)**
reviewed
[Dec 16, 2024](#pullrequestreview-2507577525)

 [View reviewed changes](/matrix-org/matrix-spec-proposals/pull/4186/files/6fe4ba72da515f3e473be42a57a7a32f03e303f8)

[proposals/4186-simplified-sliding-sync.md](/matrix-org/matrix-spec-proposals/pull/4186/files/6fe4ba72da515f3e473be42a57a7a32f03e303f8#diff-43c51cf6108a7004b0d27da42a67f6874a8d34975fa4375b6d1bca9c0fb8d44b)

|  |  | If new entries are added to `required\_state` then the server must send down matching current state events. |
| --- | --- | --- |
|  |  |  |
|  |  |  |
|  |  | ## Extensions |

Copy link

### @olivia-fl **[olivia-fl](/olivia-fl)** [Dec 16, 2024](#discussion_r1887718340)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

My understanding is that this MSC doesn't have any support for timeline filtering. The SS MSC [called this out explicitly](https://github.com/matrix-org/matrix-spec-proposals/pull/3575/files#diff-1f7276cbbee4eeaaca06b07d2fe58312eab735259f2490e28e04710dde77fdccR1188), and it would probably be good to do that here as well. Timeline filtering on /v3/sync is used heavily by some bot and tool clients.

Sorry, something went wrong.

All reactions

[proposals/4186-simplified-sliding-sync.md](/matrix-org/matrix-spec-proposals/pull/4186/files/6fe4ba72da515f3e473be42a57a7a32f03e303f8#diff-43c51cf6108a7004b0d27da42a67f6874a8d34975fa4375b6d1bca9c0fb8d44b)

|  |  | These goals shaped the design of this proposal. |
| --- | --- | --- |
|  |  |  |
|  |  |  |
|  |  | # Proposal |

Copy link

### @olivia-fl **[olivia-fl](/olivia-fl)** [Dec 16, 2024](#discussion_r1887720755)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

How does SSS interact with the ignored user list? In /v3/sync, the server omits events sent by ignored users, requiring the client to perform a second initial sync if they want to retroactively see messages when unignoring. The choice to do server-side ignored user filtering in sync also doesn't really simplify client implementation, because you still need client-side filtering for events received before the user was ignored.

My preference would be to drop this requirement entirely for SSS, now that we have a chance to do it in a backwards-compatible way.

Sorry, something went wrong.

All reactions

[![@dbkr](https://avatars.githubusercontent.com/u/986903?s=40&v=4)](/dbkr)
[dbkr](/dbkr)
mentioned this pull request
[Dec 19, 2024](#ref-issue-2738887614)

[[Epic] Simplified Sliding Sync in Element Web
element-hq/element-web#28736](/element-hq/element-web/issues/28736)

Open

10 tasks

[yingziwu](/yingziwu)
added a commit
to yingziwu/synapse
that referenced
this pull request
[Dec 20, 2024](#ref-commit-3ca171d)
[![@yingziwu](https://avatars.githubusercontent.com/u/22741471?s=40&u=0b64cb873a93b925b25eaac11b6127f15c938754&v=4)](/yingziwu)

`[Merge tag 'v1.121.0' into develop](/yingziwu/synapse/commit/3ca171d2ea02db170a2aa35c8f9be0eac036e9fa "Merge tag 'v1.121.0' into develop

This release contains the security fixes from [v1.120.2](https://github.com/element-hq/synapse/releases/tag/v1.120.2).

- Fix release process to not create duplicate releases. ([\#18025](https://github.com/element-hq/synapse/issues/18025))

- Support for [MSC4190](https://github.com/matrix-org/matrix-spec-proposals/pull/4190): device management for Application Services. ([\#17705](https://github.com/element-hq/synapse/issues/17705))
- Update [MSC4186](https://github.com/matrix-org/matrix-spec-proposals/pull/4186) Sliding Sync to include invite, ban, kick, targets when `$LAZY`-loading room members. ([\#17947](https://github.com/element-hq/synapse/issues/17947))
- Use stable `M_USER_LOCKED` error code for locked accounts, as per [Matrix 1.12](https://spec.matrix.org/v1.12/client-server-api/#account-locking). ([\#17965](https://github.com/element-hq/synapse/issues/17965))
- [MSC4076](https://github.com/matrix-org/matrix-spec-proposals/pull/4076): Add `disable_badge_count` to pusher configuration. ([\#17975](https://github.com/element-hq/synapse/issues/17975))

- Fix long-standing bug where read receipts could get overly delayed being sent over federation. ([\#17933](https://github.com/element-hq/synapse/issues/17933))

- Add OIDC example configuration for Forgejo (fork of Gitea). ([\#17872](https://github.com/element-hq/synapse/issues/17872))
- Link to element-docker-demo from contrib/docker*. ([\#17953](https://github.com/element-hq/synapse/issues/17953))

- [MSC4108](https://github.com/matrix-org/matrix-spec-proposals/pull/4108): Add a `Content-Type` header on the `PUT` response to work around a faulty behavior in some caching reverse proxies. ([\#17253](https://github.com/element-hq/synapse/issues/17253))
- Fix incorrect comment in new schema delta. ([\#17936](https://github.com/element-hq/synapse/issues/17936))
- Raise setuptools_rust version cap to 1.10.2. ([\#17944](https://github.com/element-hq/synapse/issues/17944))
- Enable encrypted appservice related experimental features in the complement docker image. ([\#17945](https://github.com/element-hq/synapse/issues/17945))
- Return whether the user is suspended when querying the user account in the Admin API. ([\#17952](https://github.com/element-hq/synapse/issues/17952))
- Fix new scheduled tasks jumping the queue. ([\#17962](https://github.com/element-hq/synapse/issues/17962))
- Bump pyo3 and dependencies to v0.23.2. ([\#17966](https://github.com/element-hq/synapse/issues/17966))
- Update setuptools-rust and fix building abi3 wheels in latest version. ([\#17969](https://github.com/element-hq/synapse/issues/17969))
- Consolidate SSO redirects through `/_matrix/client/v3/login/sso/redirect(/{idpId})`. ([\#17972](https://github.com/element-hq/synapse/issues/17972))
- Fix Docker and Complement config to be able to use `public_baseurl`. ([\#17986](https://github.com/element-hq/synapse/issues/17986))
- Fix building wheels for MacOS which was temporarily disabled in Synapse 1.120.2. ([\#17993](https://github.com/element-hq/synapse/issues/17993))
- Fix release process to not create duplicate releases. ([\#17970](https://github.com/element-hq/synapse/issues/17970), [\#17995](https://github.com/element-hq/synapse/issues/17995))

* Bump bytes from 1.8.0 to 1.9.0. ([\#17982](https://github.com/element-hq/synapse/issues/17982))
* Bump pysaml2 from 7.3.1 to 7.5.0. ([\#17978](https://github.com/element-hq/synapse/issues/17978))
* Bump serde_json from 1.0.132 to 1.0.133. ([\#17939](https://github.com/element-hq/synapse/issues/17939))
* Bump tomli from 2.0.2 to 2.1.0. ([\#17959](https://github.com/element-hq/synapse/issues/17959))
* Bump tomli from 2.1.0 to 2.2.1. ([\#17979](https://github.com/element-hq/synapse/issues/17979))
* Bump tornado from 6.4.1 to 6.4.2. ([\#17955](https://github.com/element-hq/synapse/issues/17955))")`
‚Ä¶

`[3ca171d](/yingziwu/synapse/commit/3ca171d2ea02db170a2aa35c8f9be0eac036e9fa)`

```
This release contains the security fixes from [v1.120.2](<https://github.com/element-hq/synapse/releases/tag/v1.120.2>).

- Fix release process to not create duplicate releases. ([\#18025]([element-hq/synapse#18025](https://github.com/element-hq/synapse/pull/18025)))

- Support for [MSC4190]([matrix-org/matrix-spec-proposals#4190](https://github.com/matrix-org/matrix-spec-proposals/pull/4190)): device management for Application Services. ([\#17705]([element-hq/synapse#17705](https://github.com/element-hq/synapse/pull/17705)))
- Update [MSC4186]([matrix-org/matrix-spec-proposals#4186](https://github.com/matrix-org/matrix-spec-proposals/pull/4186)) Sliding Sync to include invite, ban, kick, targets when `$LAZY`-loading room members. ([\#17947]([element-hq/synapse#17947](https://github.com/element-hq/synapse/pull/17947)))
- Use stable `M_USER_LOCKED` error code for locked accounts, as per [Matrix 1.12](<https://spec.matrix.org/v1.12/client-server-api/#account-locking>). ([\#17965]([element-hq/synapse#17965](https://github.com/element-hq/synapse/pull/17965)))
- [MSC4076]([matrix-org/matrix-spec-proposals#4076](https://github.com/matrix-org/matrix-spec-proposals/pull/4076)): Add `disable_badge_count` to pusher configuration. ([\#17975]([element-hq/synapse#17975](https://github.com/element-hq/synapse/pull/17975)))

- Fix long-standing bug where read receipts could get overly delayed being sent over federation. ([\#17933]([element-hq/synapse#17933](https://github.com/element-hq/synapse/pull/17933)))

- Add OIDC example configuration for Forgejo (fork of Gitea). ([\#17872]([element-hq/synapse#17872](https://github.com/element-hq/synapse/pull/17872)))
- Link to element-docker-demo from contrib/docker*. ([\#17953]([element-hq/synapse#17953](https://github.com/element-hq/synapse/pull/17953)))

- [MSC4108]([matrix-org/matrix-spec-proposals#4108](https://github.com/matrix-org/matrix-spec-proposals/pull/4108)): Add a `Content-Type` header on the `PUT` response to work around a faulty behavior in some caching reverse proxies. ([\#17253]([element-hq/synapse#17253](https://github.com/element-hq/synapse/pull/17253)))
- Fix incorrect comment in new schema delta. ([\#17936]([element-hq/synapse#17936](https://github.com/element-hq/synapse/pull/17936)))
- Raise setuptools_rust version cap to 1.10.2. ([\#17944]([element-hq/synapse#17944](https://github.com/element-hq/synapse/pull/17944)))
- Enable encrypted appservice related experimental features in the complement docker image. ([\#17945]([element-hq/synapse#17945](https://github.com/element-hq/synapse/pull/17945)))
- Return whether the user is suspended when querying the user account in the Admin API. ([\#17952]([element-hq/synapse#17952](https://github.com/element-hq/synapse/pull/17952)))
- Fix new scheduled tasks jumping the queue. ([\#17962]([element-hq/synapse#17962](https://github.com/element-hq/synapse/pull/17962)))
- Bump pyo3 and dependencies to v0.23.2. ([\#17966]([element-hq/synapse#17966](https://github.com/element-hq/synapse/pull/17966)))
- Update setuptools-rust and fix building abi3 wheels in latest version. ([\#17969]([element-hq/synapse#17969](https://github.com/element-hq/synapse/pull/17969)))
- Consolidate SSO redirects through `/_matrix/client/v3/login/sso/redirect(/{idpId})`. ([\#17972]([element-hq/synapse#17972](https://github.com/element-hq/synapse/pull/17972)))
- Fix Docker and Complement config to be able to use `public_baseurl`. ([\#17986]([element-hq/synapse#17986](https://github.com/element-hq/synapse/pull/17986)))
- Fix building wheels for MacOS which was temporarily disabled in Synapse 1.120.2. ([\#17993]([element-hq/synapse#17993](https://github.com/element-hq/synapse/pull/17993)))
- Fix release process to not create duplicate releases. ([\#17970]([element-hq/synapse#17970](https://github.com/element-hq/synapse/pull/17970)), [\#17995]([element-hq/synapse#17995](https://github.com/element-hq/synapse/pull/17995)))

* Bump bytes from 1.8.0 to 1.9.0. ([\#17982]([element-hq/synapse#17982](https://github.com/element-hq/synapse/pull/17982)))
* Bump pysaml2 from 7.3.1 to 7.5.0. ([\#17978]([element-hq/synapse#17978](https://github.com/element-hq/synapse/pull/17978)))
* Bump serde_json from 1.0.132 to 1.0.133. ([\#17939]([element-hq/synapse#17939](https://github.com/element-hq/synapse/pull/17939)))
* Bump tomli from 2.0.2 to 2.1.0. ([\#17959]([element-hq/synapse#17959](https://github.com/element-hq/synapse/pull/17959)))
* Bump tomli from 2.1.0 to 2.2.1. ([\#17979]([element-hq/synapse#17979](https://github.com/element-hq/synapse/pull/17979)))
* Bump tornado from 6.4.1 to 6.4.2. ([\#17955]([element-hq/synapse#17955](https://github.com/element-hq/synapse/pull/17955)))
```

[![@S7evinK](https://avatars.githubusercontent.com/u/2353100?s=40&v=4)](/S7evinK)
[S7evinK](/S7evinK)
mentioned this pull request
[Jan 6, 2025](#ref-issue-2629998483)

[Embedded / Support sliding sync /syncv3
element-hq/dendrite#3236](/element-hq/dendrite/issues/3236)

Open

 [erikjohnston](/erikjohnston)
and others
added 2 commits
[January 8, 2025 14:40](#commits-pushed-a5dc74b)

[![@erikjohnston](https://avatars.githubusercontent.com/u/8428120?s=40&v=4)](/erikjohnston) [![@Johennes](https://avatars.githubusercontent.com/u/1137962?s=40&v=4)](/Johennes)

`[Update proposals/4186-simplified-sliding-sync.md](/matrix-org/matrix-spec-proposals/pull/4186/commits/a5dc74bc409900c23cabf689857c9398e1b78ad0 "Update proposals/4186-simplified-sliding-sync.md

Co-authored-by: Johannes Marbach <n0-0ne+github@mailbox.org>")`
 ‚Ä¶

`[a5dc74b](/matrix-org/matrix-spec-proposals/pull/4186/commits/a5dc74bc409900c23cabf689857c9398e1b78ad0)`

```
Co-authored-by: Johannes Marbach <n0-0ne+github@mailbox.org>
```

[![@erikjohnston](https://avatars.githubusercontent.com/u/8428120?s=40&v=4)](/erikjohnston)

`[Some clarifications](/matrix-org/matrix-spec-proposals/pull/4186/commits/4c47844771bb160a4efefe4bd063efd33902df73 "Some clarifications")`

`[4c47844](/matrix-org/matrix-spec-proposals/pull/4186/commits/4c47844771bb160a4efefe4bd063efd33902df73)`

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Fmatrix-org%2Fmatrix-spec-proposals%2Fpull%2F4186)

Reviewers

[![@kegsay](https://avatars.githubusercontent.com/u/7190048?s=40&v=4)](/kegsay) [kegsay](/kegsay)

kegsay left review comments

[![@olivia-fl](https://avatars.githubusercontent.com/u/6504174?s=40&v=4)](/olivia-fl) [olivia-fl](/olivia-fl)

olivia-fl left review comments

[![@HarHarLinks](https://avatars.githubusercontent.com/u/2803622?s=40&v=4)](/HarHarLinks) [HarHarLinks](/HarHarLinks)

HarHarLinks left review comments

[![@anoadragon453](https://avatars.githubusercontent.com/u/1342360?s=40&v=4)](/anoadragon453) [anoadragon453](/anoadragon453)

anoadragon453 left review comments

[![@ara4n](https://avatars.githubusercontent.com/u/1294269?s=40&v=4)](/ara4n) [ara4n](/ara4n)

ara4n left review comments

[![@Gnuxie](https://avatars.githubusercontent.com/u/50846879?s=40&v=4)](/Gnuxie) [Gnuxie](/Gnuxie)

Gnuxie left review comments

[![@Johennes](https://avatars.githubusercontent.com/u/1137962?s=40&v=4)](/Johennes) [Johennes](/Johennes)

Johennes left review comments

[![@Hywan](https://avatars.githubusercontent.com/u/946104?s=40&v=4)](/Hywan) [Hywan](/Hywan)

Hywan left review comments

[![@MadLittleMods](https://avatars.githubusercontent.com/u/558581?s=40&v=4)](/MadLittleMods) [MadLittleMods](/MadLittleMods)

MadLittleMods left review comments

[![@clokep](https://avatars.githubusercontent.com/u/517124?s=40&v=4)](/clokep) [clokep](/clokep)

clokep left review comments

[![@jmartinesp](https://avatars.githubusercontent.com/u/480955?s=40&v=4)](/jmartinesp) [jmartinesp](/jmartinesp)

jmartinesp left review comments

[![@deepbluev7](https://avatars.githubusercontent.com/u/16312324?s=40&v=4)](/deepbluev7) [deepbluev7](/deepbluev7)

deepbluev7 left review comments

[![@foresto](https://avatars.githubusercontent.com/u/322134?s=40&v=4)](/foresto) [foresto](/foresto)

foresto left review comments

[![@turt2live](https://avatars.githubusercontent.com/u/1190097?s=40&v=4)](/turt2live) [turt2live](/turt2live)

turt2live left review comments

Assignees

No one assigned

Labels

[client-server](/matrix-org/matrix-spec-proposals/labels/client-server)
Client-Server API
[feature](/matrix-org/matrix-spec-proposals/labels/feature)
Suggestion for a significant extension which needs considerable consideration
[kind:core](/matrix-org/matrix-spec-proposals/labels/kind%3Acore)
MSC which is critical to the protocol's success
[needs-implementation](/matrix-org/matrix-spec-proposals/labels/needs-implementation)
This MSC does not have a qualifying implementation for the SCT to review. The MSC cannot enter FCP.
[proposal](/matrix-org/matrix-spec-proposals/labels/proposal)
A matrix spec change proposal

Projects

None yet

Milestone

No milestone

Development

Successfully merging this pull request may close these issues.

16 participants

[![@erikjohnston](https://avatars.githubusercontent.com/u/8428120?s=52&v=4)](/erikjohnston) [![@jmartinesp](https://avatars.githubusercontent.com/u/480955?s=52&v=4)](/jmartinesp) [![@foresto](https://avatars.githubusercontent.com/u/322134?s=52&v=4)](/foresto) [![@clokep](https://avatars.githubusercontent.com/u/517124?s=52&v=4)](/clokep) [![@MadLittleMods](https://avatars.githubusercontent.com/u/558581?s=52&v=4)](/MadLittleMods) [![@Hywan](https://avatars.githubusercontent.com/u/946104?s=52&v=4)](/Hywan) [![@Johennes](https://avatars.githubusercontent.com/u/1137962?s=52&v=4)](/Johennes) [![@turt2live](https://avatars.githubusercontent.com/u/1190097?s=52&v=4)](/turt2live) [![@ara4n](https://avatars.githubusercontent.com/u/1294269?s=52&v=4)](/ara4n) [![@anoadragon453](https://avatars.githubusercontent.com/u/1342360?s=52&v=4)](/anoadragon453) [![@HarHarLinks](https://avatars.githubusercontent.com/u/2803622?s=52&v=4)](/HarHarLinks) [![@olivia-fl](https://avatars.githubusercontent.com/u/6504174?s=52&v=4)](/olivia-fl) [![@kegsay](https://avatars.githubusercontent.com/u/7190048?s=52&v=4)](/kegsay) [![@deepbluev7](https://avatars.githubusercontent.com/u/16312324?s=52&v=4)](/deepbluev7) [![@Gnuxie](https://avatars.githubusercontent.com/u/50846879?s=52&v=4)](/Gnuxie) [![@uhoreg](https://avatars.githubusercontent.com/u/1012976?s=52&v=4)](/uhoreg)

Add this suggestion to a batch that can be applied as a single commit.
This suggestion is invalid because no changes were made to the code.
Suggestions cannot be applied while the pull request is closed.
Suggestions cannot be applied while viewing a subset of changes.
Only one suggestion per line can be applied in a batch.
Add this suggestion to a batch that can be applied as a single commit.
Applying suggestions on deleted lines is not supported.
You must change the existing code in this line in order to create a valid suggestion.
Outdated suggestions cannot be applied.
This suggestion has been applied or marked resolved.
Suggestions cannot be applied from pending reviews.
Suggestions cannot be applied on multi-line comments.
Suggestions cannot be applied while the pull request is queued to merge.
Suggestion cannot be applied right now. Please check back later.

## Footer

¬© 2025 GitHub,¬†Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can‚Äôt perform that action at this time.



=== Content from github.com_40d2c8f7_20250114_181902.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Felement-hq%2Fsynapse%2Fsecurity%2Fadvisories%2FGHSA-56w4-5538-8v8h)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Felement-hq%2Fsynapse%2Fsecurity%2Fadvisories%2FGHSA-56w4-5538-8v8h)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=element-hq%2Fsynapse)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[element-hq](/element-hq)
/
**[synapse](/element-hq/synapse)**
Public

* [Notifications](/login?return_to=%2Felement-hq%2Fsynapse) You must be signed in to change notification settings
* [Fork
  226](/login?return_to=%2Felement-hq%2Fsynapse)
* [Star
   1.8k](/login?return_to=%2Felement-hq%2Fsynapse)

* [Code](/element-hq/synapse)
* [Issues
  1.7k](/element-hq/synapse/issues)
* [Pull requests
  77](/element-hq/synapse/pulls)
* [Actions](/element-hq/synapse/actions)
* [Projects
  0](/element-hq/synapse/projects)
* [Security](/element-hq/synapse/security)
* [Insights](/element-hq/synapse/pulse)

Additional navigation options

* [Code](/element-hq/synapse)
* [Issues](/element-hq/synapse/issues)
* [Pull requests](/element-hq/synapse/pulls)
* [Actions](/element-hq/synapse/actions)
* [Projects](/element-hq/synapse/projects)
* [Security](/element-hq/synapse/security)
* [Insights](/element-hq/synapse/pulse)

# Partial room state leak via Sliding Sync

Moderate

[sandhose](/sandhose)
published
GHSA-56w4-5538-8v8h
Dec 3, 2024

## Package

pip

matrix-synapse
([pip](/advisories?query=ecosystem%3Apip))

## Affected versions

>= 1.113.0rc1, < 1.120.1

## Patched versions

1.120.1

## Description

### Impact

The Sliding Sync feature on Synapse versions between 1.113.0rc1 and 1.120.0 can leak partial room state changes to users no longer in a room. Non-state events, like messages, are unaffected.

### Patches

Synapse version 1.120.1 fixes the problem.

### Workarounds

Disable Sliding Sync.

### References

[matrix-org/matrix-spec-proposals#4186](https://github.com/matrix-org/matrix-spec-proposals/pull/4186)

[synapse/synapse/config/experimental.py](https://github.com/element-hq/synapse/blob/d80cd57c54427687afcb48740d99219c88a0fff1/synapse/config/experimental.py#L341-L344)

Lines 341 to 344
in
[d80cd57](/element-hq/synapse/commit/d80cd57c54427687afcb48740d99219c88a0fff1)

|  | # MSC3575 (Sliding Sync) alternate endpoints, c.f. MSC4186. |
| --- | --- |
|  | # |
|  | # This is enabled by default as a replacement for the sliding sync proxy. |
|  | self.msc3575\_enabled: bool = experimental.get("msc3575\_enabled", True) |

### For more information

If you have any questions or comments about this advisory, please email us at security at element.io.

### Severity

Moderate

4.3

# CVSS overall score

 This score calculates overall vulnerability severity from 0 to 10 and is based on the Common Vulnerability Scoring System (CVSS).

 / 10

#### CVSS v3 base metrics

Attack vector
Network

Attack complexity
Low

Privileges required
Low

User interaction
None

Scope
Unchanged

Confidentiality
Low

Integrity
None

Availability
None

Learn more about base metrics

# CVSS v3 base metrics

Attack vector:
More severe the more the remote (logically and physically) an attacker can be in order to exploit the vulnerability.

Attack complexity:
More severe for the least complex attacks.

Privileges required:
More severe if no privileges are required.

User interaction:
More severe when no user interaction is required.

Scope:
More severe when a scope change occurs, e.g. one vulnerable component impacts resources in components beyond its security scope.

Confidentiality:
More severe when loss of data confidentiality is highest, measuring the level of data access available to an unauthorized user.

Integrity:
More severe when loss of data integrity is the highest, measuring the consequence of data modification possible by an unauthorized user.

Availability:
More severe when the loss of impacted component availability is highest.

CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:L/I:N/A:N

### CVE ID

CVE-2024-53867

### Weaknesses

[CWE-497](/advisories?query=cwe%3A497)

## Footer

¬© 2025 GitHub,¬†Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can‚Äôt perform that action at this time.


