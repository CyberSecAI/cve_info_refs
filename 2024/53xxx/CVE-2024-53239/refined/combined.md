=== Content from git.kernel.org_2e5f260a_20250114_231037.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=b754e831a94f82f2593af806741392903f359168)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=b754e831a94f82f2593af806741392903f359168)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=b754e831a94f82f2593af806741392903f359168)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b754e831a94f82f2593af806741392903f359168)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Takashi Iwai <tiwai@suse.de> | 2024-11-13 12:10:39 +0100 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-09 10:32:11 +0100 |
| commit | [b754e831a94f82f2593af806741392903f359168](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=b754e831a94f82f2593af806741392903f359168) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=b754e831a94f82f2593af806741392903f359168)) | |
| tree | [e1e66bdae194bba352a807a4a947f75d36c7fc2d](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=b754e831a94f82f2593af806741392903f359168) | |
| parent | [4507a8b9b30344c5ddd8219945f446d47e966a6d](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=4507a8b9b30344c5ddd8219945f446d47e966a6d) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b754e831a94f82f2593af806741392903f359168&id2=4507a8b9b30344c5ddd8219945f446d47e966a6d)) | |
| download | [linux-b754e831a94f82f2593af806741392903f359168.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-b754e831a94f82f2593af806741392903f359168.tar.gz) | |

ALSA: 6fire: Release resources at card release[ Upstream commit a0810c3d6dd2d29a9b92604d682eacd2902ce947 ]
The current 6fire code tries to release the resources right after the
call of usb6fire\_chip\_abort(). But at this moment, the card object
might be still in use (as we're calling snd\_card\_free\_when\_closed()).
For avoid potential UAFs, move the release of resources to the card's
private\_free instead of the manual call of usb6fire\_chip\_destroy() at
the USB disconnect callback.
Fixes: c6d43ba816d1 ("ALSA: usb/6fire - Driver for TerraTec DMX 6Fire USB")
Signed-off-by: Takashi Iwai <tiwai@suse.de>
Link: [https://patch.msgid.link/20241113111042.15058-6-tiwai@suse.de](https://patch.msgid.link/20241113111042.15058-6-tiwai%40suse.de)
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b754e831a94f82f2593af806741392903f359168)

| -rw-r--r-- | [sound/usb/6fire/chip.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/sound/usb/6fire/chip.c?id=b754e831a94f82f2593af806741392903f359168) | 10 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 5 insertions, 5 deletions

| diff --git a/sound/usb/6fire/chip.c b/sound/usb/6fire/chip.cindex 33e962178c9363..d562a30b087f01 100644--- a/[sound/usb/6fire/chip.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/sound/usb/6fire/chip.c?id=4507a8b9b30344c5ddd8219945f446d47e966a6d)+++ b/[sound/usb/6fire/chip.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/sound/usb/6fire/chip.c?id=b754e831a94f82f2593af806741392903f359168)@@ -61,8 +61,10 @@ static void usb6fire\_chip\_abort(struct sfire\_chip \*chip) } } -static void usb6fire\_chip\_destroy(struct sfire\_chip \*chip)+static void usb6fire\_card\_free(struct snd\_card \*card) {+ struct sfire\_chip \*chip = card->private\_data;+ if (chip) { if (chip->pcm) usb6fire\_pcm\_destroy(chip);@@ -72,8 +74,6 @@ static void usb6fire\_chip\_destroy(struct sfire\_chip \*chip) usb6fire\_comm\_destroy(chip); if (chip->control) usb6fire\_control\_destroy(chip);- if (chip->card)- snd\_card\_free(chip->card); } } @@ -136,6 +136,7 @@ static int usb6fire\_chip\_probe(struct usb\_interface \*intf, chip->regidx = regidx; chip->intf\_count = 1; chip->card = card;+ card->private\_free = usb6fire\_card\_free;  ret = usb6fire\_comm\_init(chip); if (ret < 0)@@ -162,7 +163,7 @@ static int usb6fire\_chip\_probe(struct usb\_interface \*intf, return 0;  destroy\_chip:- usb6fire\_chip\_destroy(chip);+ snd\_card\_free(card); return ret; } @@ -181,7 +182,6 @@ static void usb6fire\_chip\_disconnect(struct usb\_interface \*intf)  chip->shutdown = true; usb6fire\_chip\_abort(chip);- usb6fire\_chip\_destroy(chip); } } } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 23:09:15 +0000



=== Content from git.kernel.org_c98f72c5_20250114_231039.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=ea8cc56db659cf0ae57073e32a4735ead7bd7ee3)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=ea8cc56db659cf0ae57073e32a4735ead7bd7ee3)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=ea8cc56db659cf0ae57073e32a4735ead7bd7ee3)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=ea8cc56db659cf0ae57073e32a4735ead7bd7ee3)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Takashi Iwai <tiwai@suse.de> | 2024-11-13 12:10:39 +0100 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-14 19:53:34 +0100 |
| commit | [ea8cc56db659cf0ae57073e32a4735ead7bd7ee3](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=ea8cc56db659cf0ae57073e32a4735ead7bd7ee3) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=ea8cc56db659cf0ae57073e32a4735ead7bd7ee3)) | |
| tree | [2425ba34e35e148bf66cf0d71e0ca4cb92cc90b6](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=ea8cc56db659cf0ae57073e32a4735ead7bd7ee3) | |
| parent | [237f3faf0177bdde728fa3106d730d806436aa4d](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=237f3faf0177bdde728fa3106d730d806436aa4d) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=ea8cc56db659cf0ae57073e32a4735ead7bd7ee3&id2=237f3faf0177bdde728fa3106d730d806436aa4d)) | |
| download | [linux-ea8cc56db659cf0ae57073e32a4735ead7bd7ee3.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-ea8cc56db659cf0ae57073e32a4735ead7bd7ee3.tar.gz) | |

ALSA: 6fire: Release resources at card release[ Upstream commit a0810c3d6dd2d29a9b92604d682eacd2902ce947 ]
The current 6fire code tries to release the resources right after the
call of usb6fire\_chip\_abort(). But at this moment, the card object
might be still in use (as we're calling snd\_card\_free\_when\_closed()).
For avoid potential UAFs, move the release of resources to the card's
private\_free instead of the manual call of usb6fire\_chip\_destroy() at
the USB disconnect callback.
Fixes: c6d43ba816d1 ("ALSA: usb/6fire - Driver for TerraTec DMX 6Fire USB")
Signed-off-by: Takashi Iwai <tiwai@suse.de>
Link: [https://patch.msgid.link/20241113111042.15058-6-tiwai@suse.de](https://patch.msgid.link/20241113111042.15058-6-tiwai%40suse.de)
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=ea8cc56db659cf0ae57073e32a4735ead7bd7ee3)

| -rw-r--r-- | [sound/usb/6fire/chip.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/sound/usb/6fire/chip.c?id=ea8cc56db659cf0ae57073e32a4735ead7bd7ee3) | 10 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 5 insertions, 5 deletions

| diff --git a/sound/usb/6fire/chip.c b/sound/usb/6fire/chip.cindex 33e962178c9363..d562a30b087f01 100644--- a/[sound/usb/6fire/chip.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/sound/usb/6fire/chip.c?id=237f3faf0177bdde728fa3106d730d806436aa4d)+++ b/[sound/usb/6fire/chip.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/sound/usb/6fire/chip.c?id=ea8cc56db659cf0ae57073e32a4735ead7bd7ee3)@@ -61,8 +61,10 @@ static void usb6fire\_chip\_abort(struct sfire\_chip \*chip) } } -static void usb6fire\_chip\_destroy(struct sfire\_chip \*chip)+static void usb6fire\_card\_free(struct snd\_card \*card) {+ struct sfire\_chip \*chip = card->private\_data;+ if (chip) { if (chip->pcm) usb6fire\_pcm\_destroy(chip);@@ -72,8 +74,6 @@ static void usb6fire\_chip\_destroy(struct sfire\_chip \*chip) usb6fire\_comm\_destroy(chip); if (chip->control) usb6fire\_control\_destroy(chip);- if (chip->card)- snd\_card\_free(chip->card); } } @@ -136,6 +136,7 @@ static int usb6fire\_chip\_probe(struct usb\_interface \*intf, chip->regidx = regidx; chip->intf\_count = 1; chip->card = card;+ card->private\_free = usb6fire\_card\_free;  ret = usb6fire\_comm\_init(chip); if (ret < 0)@@ -162,7 +163,7 @@ static int usb6fire\_chip\_probe(struct usb\_interface \*intf, return 0;  destroy\_chip:- usb6fire\_chip\_destroy(chip);+ snd\_card\_free(card); return ret; } @@ -181,7 +182,6 @@ static void usb6fire\_chip\_disconnect(struct usb\_interface \*intf)  chip->shutdown = true; usb6fire\_chip\_abort(chip);- usb6fire\_chip\_destroy(chip); } } } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 23:09:16 +0000



=== Content from git.kernel.org_d01367d3_20250114_231038.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=b889a7d68d7e76b8795b754a75c91a2d561d5e8c)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=b889a7d68d7e76b8795b754a75c91a2d561d5e8c)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=b889a7d68d7e76b8795b754a75c91a2d561d5e8c)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b889a7d68d7e76b8795b754a75c91a2d561d5e8c)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Takashi Iwai <tiwai@suse.de> | 2024-11-13 12:10:39 +0100 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-14 19:50:59 +0100 |
| commit | [b889a7d68d7e76b8795b754a75c91a2d561d5e8c](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=b889a7d68d7e76b8795b754a75c91a2d561d5e8c) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=b889a7d68d7e76b8795b754a75c91a2d561d5e8c)) | |
| tree | [bfda1e4ede083acf545daf402a07c42b8497b2f9](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=b889a7d68d7e76b8795b754a75c91a2d561d5e8c) | |
| parent | [cadf1d8e9ddcd74584ec961aeac14ac549b261d8](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=cadf1d8e9ddcd74584ec961aeac14ac549b261d8) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b889a7d68d7e76b8795b754a75c91a2d561d5e8c&id2=cadf1d8e9ddcd74584ec961aeac14ac549b261d8)) | |
| download | [linux-b889a7d68d7e76b8795b754a75c91a2d561d5e8c.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-b889a7d68d7e76b8795b754a75c91a2d561d5e8c.tar.gz) | |

ALSA: 6fire: Release resources at card release[ Upstream commit a0810c3d6dd2d29a9b92604d682eacd2902ce947 ]
The current 6fire code tries to release the resources right after the
call of usb6fire\_chip\_abort(). But at this moment, the card object
might be still in use (as we're calling snd\_card\_free\_when\_closed()).
For avoid potential UAFs, move the release of resources to the card's
private\_free instead of the manual call of usb6fire\_chip\_destroy() at
the USB disconnect callback.
Fixes: c6d43ba816d1 ("ALSA: usb/6fire - Driver for TerraTec DMX 6Fire USB")
Signed-off-by: Takashi Iwai <tiwai@suse.de>
Link: [https://patch.msgid.link/20241113111042.15058-6-tiwai@suse.de](https://patch.msgid.link/20241113111042.15058-6-tiwai%40suse.de)
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b889a7d68d7e76b8795b754a75c91a2d561d5e8c)

| -rw-r--r-- | [sound/usb/6fire/chip.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/sound/usb/6fire/chip.c?id=b889a7d68d7e76b8795b754a75c91a2d561d5e8c) | 10 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 5 insertions, 5 deletions

| diff --git a/sound/usb/6fire/chip.c b/sound/usb/6fire/chip.cindex 33e962178c9363..d562a30b087f01 100644--- a/[sound/usb/6fire/chip.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/sound/usb/6fire/chip.c?id=cadf1d8e9ddcd74584ec961aeac14ac549b261d8)+++ b/[sound/usb/6fire/chip.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/sound/usb/6fire/chip.c?id=b889a7d68d7e76b8795b754a75c91a2d561d5e8c)@@ -61,8 +61,10 @@ static void usb6fire\_chip\_abort(struct sfire\_chip \*chip) } } -static void usb6fire\_chip\_destroy(struct sfire\_chip \*chip)+static void usb6fire\_card\_free(struct snd\_card \*card) {+ struct sfire\_chip \*chip = card->private\_data;+ if (chip) { if (chip->pcm) usb6fire\_pcm\_destroy(chip);@@ -72,8 +74,6 @@ static void usb6fire\_chip\_destroy(struct sfire\_chip \*chip) usb6fire\_comm\_destroy(chip); if (chip->control) usb6fire\_control\_destroy(chip);- if (chip->card)- snd\_card\_free(chip->card); } } @@ -136,6 +136,7 @@ static int usb6fire\_chip\_probe(struct usb\_interface \*intf, chip->regidx = regidx; chip->intf\_count = 1; chip->card = card;+ card->private\_free = usb6fire\_card\_free;  ret = usb6fire\_comm\_init(chip); if (ret < 0)@@ -162,7 +163,7 @@ static int usb6fire\_chip\_probe(struct usb\_interface \*intf, return 0;  destroy\_chip:- usb6fire\_chip\_destroy(chip);+ snd\_card\_free(card); return ret; } @@ -181,7 +182,6 @@ static void usb6fire\_chip\_disconnect(struct usb\_interface \*intf)  chip->shutdown = true; usb6fire\_chip\_abort(chip);- usb6fire\_chip\_destroy(chip); } } } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 23:09:15 +0000



=== Content from git.kernel.org_119820fd_20250114_231040.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=f2d06d4e129e2508e356136f99bb20a332ff1a00)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=f2d06d4e129e2508e356136f99bb20a332ff1a00)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=f2d06d4e129e2508e356136f99bb20a332ff1a00)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=f2d06d4e129e2508e356136f99bb20a332ff1a00)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Takashi Iwai <tiwai@suse.de> | 2024-11-13 12:10:39 +0100 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-14 19:47:56 +0100 |
| commit | [f2d06d4e129e2508e356136f99bb20a332ff1a00](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=f2d06d4e129e2508e356136f99bb20a332ff1a00) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=f2d06d4e129e2508e356136f99bb20a332ff1a00)) | |
| tree | [84dd4760749e8b630a136ea2fb0ecbe5c3028a9f](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=f2d06d4e129e2508e356136f99bb20a332ff1a00) | |
| parent | [4dd821dcbfcecf7af6a08370b0b217cde2818acf](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=4dd821dcbfcecf7af6a08370b0b217cde2818acf) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=f2d06d4e129e2508e356136f99bb20a332ff1a00&id2=4dd821dcbfcecf7af6a08370b0b217cde2818acf)) | |
| download | [linux-f2d06d4e129e2508e356136f99bb20a332ff1a00.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-f2d06d4e129e2508e356136f99bb20a332ff1a00.tar.gz) | |

ALSA: 6fire: Release resources at card release[ Upstream commit a0810c3d6dd2d29a9b92604d682eacd2902ce947 ]
The current 6fire code tries to release the resources right after the
call of usb6fire\_chip\_abort(). But at this moment, the card object
might be still in use (as we're calling snd\_card\_free\_when\_closed()).
For avoid potential UAFs, move the release of resources to the card's
private\_free instead of the manual call of usb6fire\_chip\_destroy() at
the USB disconnect callback.
Fixes: c6d43ba816d1 ("ALSA: usb/6fire - Driver for TerraTec DMX 6Fire USB")
Signed-off-by: Takashi Iwai <tiwai@suse.de>
Link: [https://patch.msgid.link/20241113111042.15058-6-tiwai@suse.de](https://patch.msgid.link/20241113111042.15058-6-tiwai%40suse.de)
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=f2d06d4e129e2508e356136f99bb20a332ff1a00)

| -rw-r--r-- | [sound/usb/6fire/chip.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/sound/usb/6fire/chip.c?id=f2d06d4e129e2508e356136f99bb20a332ff1a00) | 10 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 5 insertions, 5 deletions

| diff --git a/sound/usb/6fire/chip.c b/sound/usb/6fire/chip.cindex 08c6e6a52eb98a..ad6f89845a5c2f 100644--- a/[sound/usb/6fire/chip.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/sound/usb/6fire/chip.c?id=4dd821dcbfcecf7af6a08370b0b217cde2818acf)+++ b/[sound/usb/6fire/chip.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/sound/usb/6fire/chip.c?id=f2d06d4e129e2508e356136f99bb20a332ff1a00)@@ -62,8 +62,10 @@ static void usb6fire\_chip\_abort(struct sfire\_chip \*chip) } } -static void usb6fire\_chip\_destroy(struct sfire\_chip \*chip)+static void usb6fire\_card\_free(struct snd\_card \*card) {+ struct sfire\_chip \*chip = card->private\_data;+ if (chip) { if (chip->pcm) usb6fire\_pcm\_destroy(chip);@@ -73,8 +75,6 @@ static void usb6fire\_chip\_destroy(struct sfire\_chip \*chip) usb6fire\_comm\_destroy(chip); if (chip->control) usb6fire\_control\_destroy(chip);- if (chip->card)- snd\_card\_free(chip->card); } } @@ -137,6 +137,7 @@ static int usb6fire\_chip\_probe(struct usb\_interface \*intf, chip->regidx = regidx; chip->intf\_count = 1; chip->card = card;+ card->private\_free = usb6fire\_card\_free;  ret = usb6fire\_comm\_init(chip); if (ret < 0)@@ -163,7 +164,7 @@ static int usb6fire\_chip\_probe(struct usb\_interface \*intf, return 0;  destroy\_chip:- usb6fire\_chip\_destroy(chip);+ snd\_card\_free(card); return ret; } @@ -182,7 +183,6 @@ static void usb6fire\_chip\_disconnect(struct usb\_interface \*intf)  chip->shutdown = true; usb6fire\_chip\_abort(chip);- usb6fire\_chip\_destroy(chip); } } } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 23:09:17 +0000



=== Content from git.kernel.org_8c02c706_20250114_231034.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=0df7f4b5cc10f5adf98be0845372e9eef7bb5b09)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=0df7f4b5cc10f5adf98be0845372e9eef7bb5b09)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=0df7f4b5cc10f5adf98be0845372e9eef7bb5b09)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=0df7f4b5cc10f5adf98be0845372e9eef7bb5b09)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Takashi Iwai <tiwai@suse.de> | 2024-11-13 12:10:39 +0100 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-05 13:53:26 +0100 |
| commit | [0df7f4b5cc10f5adf98be0845372e9eef7bb5b09](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=0df7f4b5cc10f5adf98be0845372e9eef7bb5b09) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=0df7f4b5cc10f5adf98be0845372e9eef7bb5b09)) | |
| tree | [8fcef7f96f6a7217110116ad0e9626a20b303059](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=0df7f4b5cc10f5adf98be0845372e9eef7bb5b09) | |
| parent | [dd0de8cb708951cebf727aa045e8242ba651bb52](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=dd0de8cb708951cebf727aa045e8242ba651bb52) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=0df7f4b5cc10f5adf98be0845372e9eef7bb5b09&id2=dd0de8cb708951cebf727aa045e8242ba651bb52)) | |
| download | [linux-0df7f4b5cc10f5adf98be0845372e9eef7bb5b09.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-0df7f4b5cc10f5adf98be0845372e9eef7bb5b09.tar.gz) | |

ALSA: 6fire: Release resources at card release[ Upstream commit a0810c3d6dd2d29a9b92604d682eacd2902ce947 ]
The current 6fire code tries to release the resources right after the
call of usb6fire\_chip\_abort(). But at this moment, the card object
might be still in use (as we're calling snd\_card\_free\_when\_closed()).
For avoid potential UAFs, move the release of resources to the card's
private\_free instead of the manual call of usb6fire\_chip\_destroy() at
the USB disconnect callback.
Fixes: c6d43ba816d1 ("ALSA: usb/6fire - Driver for TerraTec DMX 6Fire USB")
Signed-off-by: Takashi Iwai <tiwai@suse.de>
Link: [https://patch.msgid.link/20241113111042.15058-6-tiwai@suse.de](https://patch.msgid.link/20241113111042.15058-6-tiwai%40suse.de)
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=0df7f4b5cc10f5adf98be0845372e9eef7bb5b09)

| -rw-r--r-- | [sound/usb/6fire/chip.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/sound/usb/6fire/chip.c?id=0df7f4b5cc10f5adf98be0845372e9eef7bb5b09) | 10 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 5 insertions, 5 deletions

| diff --git a/sound/usb/6fire/chip.c b/sound/usb/6fire/chip.cindex 33e962178c9363..d562a30b087f01 100644--- a/[sound/usb/6fire/chip.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/sound/usb/6fire/chip.c?id=dd0de8cb708951cebf727aa045e8242ba651bb52)+++ b/[sound/usb/6fire/chip.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/sound/usb/6fire/chip.c?id=0df7f4b5cc10f5adf98be0845372e9eef7bb5b09)@@ -61,8 +61,10 @@ static void usb6fire\_chip\_abort(struct sfire\_chip \*chip) } } -static void usb6fire\_chip\_destroy(struct sfire\_chip \*chip)+static void usb6fire\_card\_free(struct snd\_card \*card) {+ struct sfire\_chip \*chip = card->private\_data;+ if (chip) { if (chip->pcm) usb6fire\_pcm\_destroy(chip);@@ -72,8 +74,6 @@ static void usb6fire\_chip\_destroy(struct sfire\_chip \*chip) usb6fire\_comm\_destroy(chip); if (chip->control) usb6fire\_control\_destroy(chip);- if (chip->card)- snd\_card\_free(chip->card); } } @@ -136,6 +136,7 @@ static int usb6fire\_chip\_probe(struct usb\_interface \*intf, chip->regidx = regidx; chip->intf\_count = 1; chip->card = card;+ card->private\_free = usb6fire\_card\_free;  ret = usb6fire\_comm\_init(chip); if (ret < 0)@@ -162,7 +163,7 @@ static int usb6fire\_chip\_probe(struct usb\_interface \*intf, return 0;  destroy\_chip:- usb6fire\_chip\_destroy(chip);+ snd\_card\_free(card); return ret; } @@ -181,7 +182,6 @@ static void usb6fire\_chip\_disconnect(struct usb\_interface \*intf)  chip->shutdown = true; usb6fire\_chip\_abort(chip);- usb6fire\_chip\_destroy(chip); } } } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 23:09:11 +0000



=== Content from git.kernel.org_58751664_20250114_231036.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=74357d0b5cd3ef544752bc9f21cbeee4902fae6c)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=74357d0b5cd3ef544752bc9f21cbeee4902fae6c)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=74357d0b5cd3ef544752bc9f21cbeee4902fae6c)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=74357d0b5cd3ef544752bc9f21cbeee4902fae6c)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Takashi Iwai <tiwai@suse.de> | 2024-11-13 12:10:39 +0100 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-05 10:59:33 +0100 |
| commit | [74357d0b5cd3ef544752bc9f21cbeee4902fae6c](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=74357d0b5cd3ef544752bc9f21cbeee4902fae6c) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=74357d0b5cd3ef544752bc9f21cbeee4902fae6c)) | |
| tree | [a727a0ca3f4d68e6d884ded0b235d55a6cd0d128](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=74357d0b5cd3ef544752bc9f21cbeee4902fae6c) | |
| parent | [3993edf44d3df7b6e8c753eac6ac8783473fcbab](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=3993edf44d3df7b6e8c753eac6ac8783473fcbab) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=74357d0b5cd3ef544752bc9f21cbeee4902fae6c&id2=3993edf44d3df7b6e8c753eac6ac8783473fcbab)) | |
| download | [linux-74357d0b5cd3ef544752bc9f21cbeee4902fae6c.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-74357d0b5cd3ef544752bc9f21cbeee4902fae6c.tar.gz) | |

ALSA: 6fire: Release resources at card release[ Upstream commit a0810c3d6dd2d29a9b92604d682eacd2902ce947 ]
The current 6fire code tries to release the resources right after the
call of usb6fire\_chip\_abort(). But at this moment, the card object
might be still in use (as we're calling snd\_card\_free\_when\_closed()).
For avoid potential UAFs, move the release of resources to the card's
private\_free instead of the manual call of usb6fire\_chip\_destroy() at
the USB disconnect callback.
Fixes: c6d43ba816d1 ("ALSA: usb/6fire - Driver for TerraTec DMX 6Fire USB")
Signed-off-by: Takashi Iwai <tiwai@suse.de>
Link: [https://patch.msgid.link/20241113111042.15058-6-tiwai@suse.de](https://patch.msgid.link/20241113111042.15058-6-tiwai%40suse.de)
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=74357d0b5cd3ef544752bc9f21cbeee4902fae6c)

| -rw-r--r-- | [sound/usb/6fire/chip.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/sound/usb/6fire/chip.c?id=74357d0b5cd3ef544752bc9f21cbeee4902fae6c) | 10 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 5 insertions, 5 deletions

| diff --git a/sound/usb/6fire/chip.c b/sound/usb/6fire/chip.cindex 17d5e3ee6d7380..f5a9b7a0b5851b 100644--- a/[sound/usb/6fire/chip.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/sound/usb/6fire/chip.c?id=3993edf44d3df7b6e8c753eac6ac8783473fcbab)+++ b/[sound/usb/6fire/chip.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/sound/usb/6fire/chip.c?id=74357d0b5cd3ef544752bc9f21cbeee4902fae6c)@@ -66,8 +66,10 @@ static void usb6fire\_chip\_abort(struct sfire\_chip \*chip) } } -static void usb6fire\_chip\_destroy(struct sfire\_chip \*chip)+static void usb6fire\_card\_free(struct snd\_card \*card) {+ struct sfire\_chip \*chip = card->private\_data;+ if (chip) { if (chip->pcm) usb6fire\_pcm\_destroy(chip);@@ -77,8 +79,6 @@ static void usb6fire\_chip\_destroy(struct sfire\_chip \*chip) usb6fire\_comm\_destroy(chip); if (chip->control) usb6fire\_control\_destroy(chip);- if (chip->card)- snd\_card\_free(chip->card); } } @@ -141,6 +141,7 @@ static int usb6fire\_chip\_probe(struct usb\_interface \*intf, chip->regidx = regidx; chip->intf\_count = 1; chip->card = card;+ card->private\_free = usb6fire\_card\_free;  ret = usb6fire\_comm\_init(chip); if (ret < 0)@@ -167,7 +168,7 @@ static int usb6fire\_chip\_probe(struct usb\_interface \*intf, return 0;  destroy\_chip:- usb6fire\_chip\_destroy(chip);+ snd\_card\_free(card); return ret; } @@ -186,7 +187,6 @@ static void usb6fire\_chip\_disconnect(struct usb\_interface \*intf)  chip->shutdown = true; usb6fire\_chip\_abort(chip);- usb6fire\_chip\_destroy(chip); } } } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 23:09:13 +0000



=== Content from git.kernel.org_6f4a64bd_20250114_231037.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=a0810c3d6dd2d29a9b92604d682eacd2902ce947)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=a0810c3d6dd2d29a9b92604d682eacd2902ce947)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=a0810c3d6dd2d29a9b92604d682eacd2902ce947)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=a0810c3d6dd2d29a9b92604d682eacd2902ce947)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Takashi Iwai <tiwai@suse.de> | 2024-11-13 12:10:39 +0100 |
| --- | --- | --- |
| committer | Takashi Iwai <tiwai@suse.de> | 2024-11-13 13:33:47 +0100 |
| commit | [a0810c3d6dd2d29a9b92604d682eacd2902ce947](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=a0810c3d6dd2d29a9b92604d682eacd2902ce947) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=a0810c3d6dd2d29a9b92604d682eacd2902ce947)) | |
| tree | [e697682ee4027cc29f0cd36dc7533cc39c451101](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=a0810c3d6dd2d29a9b92604d682eacd2902ce947) | |
| parent | [b04dcbb7f7b1908806b7dc22671cdbe78ff2b82c](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=b04dcbb7f7b1908806b7dc22671cdbe78ff2b82c) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=a0810c3d6dd2d29a9b92604d682eacd2902ce947&id2=b04dcbb7f7b1908806b7dc22671cdbe78ff2b82c)) | |
| download | [linux-a0810c3d6dd2d29a9b92604d682eacd2902ce947.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-a0810c3d6dd2d29a9b92604d682eacd2902ce947.tar.gz) | |

ALSA: 6fire: Release resources at card releaseThe current 6fire code tries to release the resources right after the
call of usb6fire\_chip\_abort(). But at this moment, the card object
might be still in use (as we're calling snd\_card\_free\_when\_closed()).
For avoid potential UAFs, move the release of resources to the card's
private\_free instead of the manual call of usb6fire\_chip\_destroy() at
the USB disconnect callback.
Fixes: c6d43ba816d1 ("ALSA: usb/6fire - Driver for TerraTec DMX 6Fire USB")
Signed-off-by: Takashi Iwai <tiwai@suse.de>
Link: [https://patch.msgid.link/20241113111042.15058-6-tiwai@suse.de](https://patch.msgid.link/20241113111042.15058-6-tiwai%40suse.de)
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=a0810c3d6dd2d29a9b92604d682eacd2902ce947)

| -rw-r--r-- | [sound/usb/6fire/chip.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/sound/usb/6fire/chip.c?id=a0810c3d6dd2d29a9b92604d682eacd2902ce947) | 10 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 5 insertions, 5 deletions

| diff --git a/sound/usb/6fire/chip.c b/sound/usb/6fire/chip.cindex 33e962178c9363..d562a30b087f01 100644--- a/[sound/usb/6fire/chip.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/sound/usb/6fire/chip.c?id=b04dcbb7f7b1908806b7dc22671cdbe78ff2b82c)+++ b/[sound/usb/6fire/chip.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/sound/usb/6fire/chip.c?id=a0810c3d6dd2d29a9b92604d682eacd2902ce947)@@ -61,8 +61,10 @@ static void usb6fire\_chip\_abort(struct sfire\_chip \*chip) } } -static void usb6fire\_chip\_destroy(struct sfire\_chip \*chip)+static void usb6fire\_card\_free(struct snd\_card \*card) {+ struct sfire\_chip \*chip = card->private\_data;+ if (chip) { if (chip->pcm) usb6fire\_pcm\_destroy(chip);@@ -72,8 +74,6 @@ static void usb6fire\_chip\_destroy(struct sfire\_chip \*chip) usb6fire\_comm\_destroy(chip); if (chip->control) usb6fire\_control\_destroy(chip);- if (chip->card)- snd\_card\_free(chip->card); } } @@ -136,6 +136,7 @@ static int usb6fire\_chip\_probe(struct usb\_interface \*intf, chip->regidx = regidx; chip->intf\_count = 1; chip->card = card;+ card->private\_free = usb6fire\_card\_free;  ret = usb6fire\_comm\_init(chip); if (ret < 0)@@ -162,7 +163,7 @@ static int usb6fire\_chip\_probe(struct usb\_interface \*intf, return 0;  destroy\_chip:- usb6fire\_chip\_destroy(chip);+ snd\_card\_free(card); return ret; } @@ -181,7 +182,6 @@ static void usb6fire\_chip\_disconnect(struct usb\_interface \*intf)  chip->shutdown = true; usb6fire\_chip\_abort(chip);- usb6fire\_chip\_destroy(chip); } } } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 23:09:14 +0000



=== Content from git.kernel.org_b9411311_20250114_231035.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=57860a80f03f9dc69a34a5c37b0941ad032a0a8c)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=57860a80f03f9dc69a34a5c37b0941ad032a0a8c)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=57860a80f03f9dc69a34a5c37b0941ad032a0a8c)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=57860a80f03f9dc69a34a5c37b0941ad032a0a8c)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Takashi Iwai <tiwai@suse.de> | 2024-11-13 12:10:39 +0100 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-05 14:01:58 +0100 |
| commit | [57860a80f03f9dc69a34a5c37b0941ad032a0a8c](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=57860a80f03f9dc69a34a5c37b0941ad032a0a8c) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=57860a80f03f9dc69a34a5c37b0941ad032a0a8c)) | |
| tree | [c27737babfa9198d159cede6d303f5dccdf90253](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=57860a80f03f9dc69a34a5c37b0941ad032a0a8c) | |
| parent | [a3f9314752dbb6f6aa1f0f2b4c58243bda800738](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=a3f9314752dbb6f6aa1f0f2b4c58243bda800738) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=57860a80f03f9dc69a34a5c37b0941ad032a0a8c&id2=a3f9314752dbb6f6aa1f0f2b4c58243bda800738)) | |
| download | [linux-57860a80f03f9dc69a34a5c37b0941ad032a0a8c.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-57860a80f03f9dc69a34a5c37b0941ad032a0a8c.tar.gz) | |

ALSA: 6fire: Release resources at card release[ Upstream commit a0810c3d6dd2d29a9b92604d682eacd2902ce947 ]
The current 6fire code tries to release the resources right after the
call of usb6fire\_chip\_abort(). But at this moment, the card object
might be still in use (as we're calling snd\_card\_free\_when\_closed()).
For avoid potential UAFs, move the release of resources to the card's
private\_free instead of the manual call of usb6fire\_chip\_destroy() at
the USB disconnect callback.
Fixes: c6d43ba816d1 ("ALSA: usb/6fire - Driver for TerraTec DMX 6Fire USB")
Signed-off-by: Takashi Iwai <tiwai@suse.de>
Link: [https://patch.msgid.link/20241113111042.15058-6-tiwai@suse.de](https://patch.msgid.link/20241113111042.15058-6-tiwai%40suse.de)
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=57860a80f03f9dc69a34a5c37b0941ad032a0a8c)

| -rw-r--r-- | [sound/usb/6fire/chip.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/sound/usb/6fire/chip.c?id=57860a80f03f9dc69a34a5c37b0941ad032a0a8c) | 10 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 5 insertions, 5 deletions

| diff --git a/sound/usb/6fire/chip.c b/sound/usb/6fire/chip.cindex 33e962178c9363..d562a30b087f01 100644--- a/[sound/usb/6fire/chip.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/sound/usb/6fire/chip.c?id=a3f9314752dbb6f6aa1f0f2b4c58243bda800738)+++ b/[sound/usb/6fire/chip.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/sound/usb/6fire/chip.c?id=57860a80f03f9dc69a34a5c37b0941ad032a0a8c)@@ -61,8 +61,10 @@ static void usb6fire\_chip\_abort(struct sfire\_chip \*chip) } } -static void usb6fire\_chip\_destroy(struct sfire\_chip \*chip)+static void usb6fire\_card\_free(struct snd\_card \*card) {+ struct sfire\_chip \*chip = card->private\_data;+ if (chip) { if (chip->pcm) usb6fire\_pcm\_destroy(chip);@@ -72,8 +74,6 @@ static void usb6fire\_chip\_destroy(struct sfire\_chip \*chip) usb6fire\_comm\_destroy(chip); if (chip->control) usb6fire\_control\_destroy(chip);- if (chip->card)- snd\_card\_free(chip->card); } } @@ -136,6 +136,7 @@ static int usb6fire\_chip\_probe(struct usb\_interface \*intf, chip->regidx = regidx; chip->intf\_count = 1; chip->card = card;+ card->private\_free = usb6fire\_card\_free;  ret = usb6fire\_comm\_init(chip); if (ret < 0)@@ -162,7 +163,7 @@ static int usb6fire\_chip\_probe(struct usb\_interface \*intf, return 0;  destroy\_chip:- usb6fire\_chip\_destroy(chip);+ snd\_card\_free(card); return ret; } @@ -181,7 +182,6 @@ static void usb6fire\_chip\_disconnect(struct usb\_interface \*intf)  chip->shutdown = true; usb6fire\_chip\_abort(chip);- usb6fire\_chip\_destroy(chip); } } } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 23:09:13 +0000



=== Content from git.kernel.org_0f51f581_20250114_231035.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=273eec23467dfbfbd0e4c10302579ba441fb1e13)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=273eec23467dfbfbd0e4c10302579ba441fb1e13)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=273eec23467dfbfbd0e4c10302579ba441fb1e13)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=273eec23467dfbfbd0e4c10302579ba441fb1e13)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Takashi Iwai <tiwai@suse.de> | 2024-11-13 12:10:39 +0100 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-14 19:44:27 +0100 |
| commit | [273eec23467dfbfbd0e4c10302579ba441fb1e13](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=273eec23467dfbfbd0e4c10302579ba441fb1e13) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=273eec23467dfbfbd0e4c10302579ba441fb1e13)) | |
| tree | [a600f098d39943c3f57b3154f8d11403b1641e13](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=273eec23467dfbfbd0e4c10302579ba441fb1e13) | |
| parent | [ebad462eec93b0f701dfe4de98990e7355283801](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=ebad462eec93b0f701dfe4de98990e7355283801) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=273eec23467dfbfbd0e4c10302579ba441fb1e13&id2=ebad462eec93b0f701dfe4de98990e7355283801)) | |
| download | [linux-273eec23467dfbfbd0e4c10302579ba441fb1e13.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-273eec23467dfbfbd0e4c10302579ba441fb1e13.tar.gz) | |

ALSA: 6fire: Release resources at card release[ Upstream commit a0810c3d6dd2d29a9b92604d682eacd2902ce947 ]
The current 6fire code tries to release the resources right after the
call of usb6fire\_chip\_abort(). But at this moment, the card object
might be still in use (as we're calling snd\_card\_free\_when\_closed()).
For avoid potential UAFs, move the release of resources to the card's
private\_free instead of the manual call of usb6fire\_chip\_destroy() at
the USB disconnect callback.
Fixes: c6d43ba816d1 ("ALSA: usb/6fire - Driver for TerraTec DMX 6Fire USB")
Signed-off-by: Takashi Iwai <tiwai@suse.de>
Link: [https://patch.msgid.link/20241113111042.15058-6-tiwai@suse.de](https://patch.msgid.link/20241113111042.15058-6-tiwai%40suse.de)
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=273eec23467dfbfbd0e4c10302579ba441fb1e13)

| -rw-r--r-- | [sound/usb/6fire/chip.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/sound/usb/6fire/chip.c?id=273eec23467dfbfbd0e4c10302579ba441fb1e13) | 10 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 5 insertions, 5 deletions

| diff --git a/sound/usb/6fire/chip.c b/sound/usb/6fire/chip.cindex 08c6e6a52eb98a..ad6f89845a5c2f 100644--- a/[sound/usb/6fire/chip.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/sound/usb/6fire/chip.c?id=ebad462eec93b0f701dfe4de98990e7355283801)+++ b/[sound/usb/6fire/chip.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/sound/usb/6fire/chip.c?id=273eec23467dfbfbd0e4c10302579ba441fb1e13)@@ -62,8 +62,10 @@ static void usb6fire\_chip\_abort(struct sfire\_chip \*chip) } } -static void usb6fire\_chip\_destroy(struct sfire\_chip \*chip)+static void usb6fire\_card\_free(struct snd\_card \*card) {+ struct sfire\_chip \*chip = card->private\_data;+ if (chip) { if (chip->pcm) usb6fire\_pcm\_destroy(chip);@@ -73,8 +75,6 @@ static void usb6fire\_chip\_destroy(struct sfire\_chip \*chip) usb6fire\_comm\_destroy(chip); if (chip->control) usb6fire\_control\_destroy(chip);- if (chip->card)- snd\_card\_free(chip->card); } } @@ -137,6 +137,7 @@ static int usb6fire\_chip\_probe(struct usb\_interface \*intf, chip->regidx = regidx; chip->intf\_count = 1; chip->card = card;+ card->private\_free = usb6fire\_card\_free;  ret = usb6fire\_comm\_init(chip); if (ret < 0)@@ -163,7 +164,7 @@ static int usb6fire\_chip\_probe(struct usb\_interface \*intf, return 0;  destroy\_chip:- usb6fire\_chip\_destroy(chip);+ snd\_card\_free(card); return ret; } @@ -182,7 +183,6 @@ static void usb6fire\_chip\_disconnect(struct usb\_interface \*intf)  chip->shutdown = true; usb6fire\_chip\_abort(chip);- usb6fire\_chip\_destroy(chip); } } } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 23:09:12 +0000


