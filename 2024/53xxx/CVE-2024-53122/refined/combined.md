=== Content from git.kernel.org_092c2a38_20250115_101108.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=24995851d58c4a205ad0ffa7b2f21e479a9c8527)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=24995851d58c4a205ad0ffa7b2f21e479a9c8527)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=24995851d58c4a205ad0ffa7b2f21e479a9c8527)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=24995851d58c4a205ad0ffa7b2f21e479a9c8527)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Paolo Abeni <pabeni@redhat.com> | 2024-11-19 09:35:49 +0100 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-11-22 15:37:33 +0100 |
| commit | [24995851d58c4a205ad0ffa7b2f21e479a9c8527](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=24995851d58c4a205ad0ffa7b2f21e479a9c8527) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=24995851d58c4a205ad0ffa7b2f21e479a9c8527)) | |
| tree | [60ad4825b2bc0f71528938398dcf9db8daa1b52b](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=24995851d58c4a205ad0ffa7b2f21e479a9c8527) | |
| parent | [949ee5d44d1fd95119b29b3382a933cdc617bf9e](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=949ee5d44d1fd95119b29b3382a933cdc617bf9e) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=24995851d58c4a205ad0ffa7b2f21e479a9c8527&id2=949ee5d44d1fd95119b29b3382a933cdc617bf9e)) | |
| download | [linux-24995851d58c4a205ad0ffa7b2f21e479a9c8527.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-24995851d58c4a205ad0ffa7b2f21e479a9c8527.tar.gz) | |

mptcp: cope racing subflow creation in mptcp\_rcv\_space\_adjustcommit ce7356ae35943cc6494cc692e62d51a734062b7d upstream.
Additional active subflows - i.e. created by the in kernel path
manager - are included into the subflow list before starting the
3whs.
A racing recvmsg() spooling data received on an already established
subflow would unconditionally call tcp\_cleanup\_rbuf() on all the
current subflows, potentially hitting a divide by zero error on
the newly created ones.
Explicitly check that the subflow is in a suitable state before
invoking tcp\_cleanup\_rbuf().
Fixes: c76c6956566f ("mptcp: call tcp\_cleanup\_rbuf on subflows")
Signed-off-by: Paolo Abeni <pabeni@redhat.com>
Reviewed-by: Matthieu Baerts (NGI0) <matttbe@kernel.org>
Link: [https://patch.msgid.link/02374660836e1b52afc91966b7535c8c5f7bafb0.1731060874.git.pabeni@redhat.com](https://patch.msgid.link/02374660836e1b52afc91966b7535c8c5f7bafb0.1731060874.git.pabeni%40redhat.com)
Signed-off-by: Jakub Kicinski <kuba@kernel.org>
[ Conflicts in protocol.c, because commit f410cbea9f3d ("tcp: annotate
data-races around tp->window\_clamp") has not been backported to this
version. The conflict is easy to resolve, because only the context is
different, but not the line to modify. ]
Signed-off-by: Matthieu Baerts (NGI0) <matttbe@kernel.org>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=24995851d58c4a205ad0ffa7b2f21e479a9c8527)

| -rw-r--r-- | [net/mptcp/protocol.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/mptcp/protocol.c?id=24995851d58c4a205ad0ffa7b2f21e479a9c8527) | 3 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 2 insertions, 1 deletions

| diff --git a/net/mptcp/protocol.c b/net/mptcp/protocol.cindex 78ac5c538e139f..1acd4e37a0ea6c 100644--- a/[net/mptcp/protocol.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/mptcp/protocol.c?id=949ee5d44d1fd95119b29b3382a933cdc617bf9e)+++ b/[net/mptcp/protocol.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/mptcp/protocol.c?id=24995851d58c4a205ad0ffa7b2f21e479a9c8527)@@ -2057,7 +2057,8 @@ static void mptcp\_rcv\_space\_adjust(struct mptcp\_sock \*msk, int copied) slow = lock\_sock\_fast(ssk); WRITE\_ONCE(ssk->sk\_rcvbuf, rcvbuf); tcp\_sk(ssk)->window\_clamp = window\_clamp;- tcp\_cleanup\_rbuf(ssk, 1);+ if (tcp\_can\_send\_ack(ssk))+ tcp\_cleanup\_rbuf(ssk, 1); unlock\_sock\_fast(ssk, slow); } } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-15 10:09:45 +0000



=== Content from git.kernel.org_c52d2a0d_20250115_101109.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=ce7356ae35943cc6494cc692e62d51a734062b7d)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=ce7356ae35943cc6494cc692e62d51a734062b7d)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=ce7356ae35943cc6494cc692e62d51a734062b7d)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=ce7356ae35943cc6494cc692e62d51a734062b7d)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Paolo Abeni <pabeni@redhat.com> | 2024-11-08 11:58:17 +0100 |
| --- | --- | --- |
| committer | Jakub Kicinski <kuba@kernel.org> | 2024-11-11 19:06:34 -0800 |
| commit | [ce7356ae35943cc6494cc692e62d51a734062b7d](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=ce7356ae35943cc6494cc692e62d51a734062b7d) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=ce7356ae35943cc6494cc692e62d51a734062b7d)) | |
| tree | [f7408edcd3a86c30f596825043f2bbe52f07f770](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=ce7356ae35943cc6494cc692e62d51a734062b7d) | |
| parent | [581302298524e9d77c4c44ff5156a6cd112227ae](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=581302298524e9d77c4c44ff5156a6cd112227ae) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=ce7356ae35943cc6494cc692e62d51a734062b7d&id2=581302298524e9d77c4c44ff5156a6cd112227ae)) | |
| download | [linux-ce7356ae35943cc6494cc692e62d51a734062b7d.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-ce7356ae35943cc6494cc692e62d51a734062b7d.tar.gz) | |

mptcp: cope racing subflow creation in mptcp\_rcv\_space\_adjustAdditional active subflows - i.e. created by the in kernel path
manager - are included into the subflow list before starting the
3whs.
A racing recvmsg() spooling data received on an already established
subflow would unconditionally call tcp\_cleanup\_rbuf() on all the
current subflows, potentially hitting a divide by zero error on
the newly created ones.
Explicitly check that the subflow is in a suitable state before
invoking tcp\_cleanup\_rbuf().
Fixes: c76c6956566f ("mptcp: call tcp\_cleanup\_rbuf on subflows")
Signed-off-by: Paolo Abeni <pabeni@redhat.com>
Reviewed-by: Matthieu Baerts (NGI0) <matttbe@kernel.org>
Link: [https://patch.msgid.link/02374660836e1b52afc91966b7535c8c5f7bafb0.1731060874.git.pabeni@redhat.com](https://patch.msgid.link/02374660836e1b52afc91966b7535c8c5f7bafb0.1731060874.git.pabeni%40redhat.com)
Signed-off-by: Jakub Kicinski <kuba@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=ce7356ae35943cc6494cc692e62d51a734062b7d)

| -rw-r--r-- | [net/mptcp/protocol.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/mptcp/protocol.c?id=ce7356ae35943cc6494cc692e62d51a734062b7d) | 3 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 2 insertions, 1 deletions

| diff --git a/net/mptcp/protocol.c b/net/mptcp/protocol.cindex 95a5a3da394474..48d480982b7870 100644--- a/[net/mptcp/protocol.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/mptcp/protocol.c?id=581302298524e9d77c4c44ff5156a6cd112227ae)+++ b/[net/mptcp/protocol.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/mptcp/protocol.c?id=ce7356ae35943cc6494cc692e62d51a734062b7d)@@ -2082,7 +2082,8 @@ static void mptcp\_rcv\_space\_adjust(struct mptcp\_sock \*msk, int copied) slow = lock\_sock\_fast(ssk); WRITE\_ONCE(ssk->sk\_rcvbuf, rcvbuf); WRITE\_ONCE(tcp\_sk(ssk)->window\_clamp, window\_clamp);- tcp\_cleanup\_rbuf(ssk, 1);+ if (tcp\_can\_send\_ack(ssk))+ tcp\_cleanup\_rbuf(ssk, 1); unlock\_sock\_fast(ssk, slow); } } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-15 10:09:46 +0000



=== Content from git.kernel.org_741e75c9_20250115_101107.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=0a9a182ea5c7bb0374e527130fd85024ace7279b)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=0a9a182ea5c7bb0374e527130fd85024ace7279b)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=0a9a182ea5c7bb0374e527130fd85024ace7279b)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=0a9a182ea5c7bb0374e527130fd85024ace7279b)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Paolo Abeni <pabeni@redhat.com> | 2024-11-08 11:58:17 +0100 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-14 19:50:38 +0100 |
| commit | [0a9a182ea5c7bb0374e527130fd85024ace7279b](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=0a9a182ea5c7bb0374e527130fd85024ace7279b) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=0a9a182ea5c7bb0374e527130fd85024ace7279b)) | |
| tree | [c771bb9ee4fb5e59e09bef643b0b14bc91fe157a](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=0a9a182ea5c7bb0374e527130fd85024ace7279b) | |
| parent | [9467c49437e948c541569007cd412d577942e635](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=9467c49437e948c541569007cd412d577942e635) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=0a9a182ea5c7bb0374e527130fd85024ace7279b&id2=9467c49437e948c541569007cd412d577942e635)) | |
| download | [linux-0a9a182ea5c7bb0374e527130fd85024ace7279b.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-0a9a182ea5c7bb0374e527130fd85024ace7279b.tar.gz) | |

mptcp: cope racing subflow creation in mptcp\_rcv\_space\_adjustcommit ce7356ae35943cc6494cc692e62d51a734062b7d upstream.
Additional active subflows - i.e. created by the in kernel path
manager - are included into the subflow list before starting the
3whs.
A racing recvmsg() spooling data received on an already established
subflow would unconditionally call tcp\_cleanup\_rbuf() on all the
current subflows, potentially hitting a divide by zero error on
the newly created ones.
Explicitly check that the subflow is in a suitable state before
invoking tcp\_cleanup\_rbuf().
Fixes: c76c6956566f ("mptcp: call tcp\_cleanup\_rbuf on subflows")
Signed-off-by: Paolo Abeni <pabeni@redhat.com>
Reviewed-by: Matthieu Baerts (NGI0) <matttbe@kernel.org>
Link: [https://patch.msgid.link/02374660836e1b52afc91966b7535c8c5f7bafb0.1731060874.git.pabeni@redhat.com](https://patch.msgid.link/02374660836e1b52afc91966b7535c8c5f7bafb0.1731060874.git.pabeni%40redhat.com)
Signed-off-by: Jakub Kicinski <kuba@kernel.org>
[ Conflicts in protocol.c, because commit f410cbea9f3d ("tcp: annotate
data-races around tp->window\_clamp") has not been backported to this
version. The conflict is easy to resolve, because only the context is
different, but not the line to modify. ]
Signed-off-by: Matthieu Baerts (NGI0) <matttbe@kernel.org>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=0a9a182ea5c7bb0374e527130fd85024ace7279b)

| -rw-r--r-- | [net/mptcp/protocol.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/mptcp/protocol.c?id=0a9a182ea5c7bb0374e527130fd85024ace7279b) | 3 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 2 insertions, 1 deletions

| diff --git a/net/mptcp/protocol.c b/net/mptcp/protocol.cindex 34c98596350e87..bcbb1f92ce249f 100644--- a/[net/mptcp/protocol.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/mptcp/protocol.c?id=9467c49437e948c541569007cd412d577942e635)+++ b/[net/mptcp/protocol.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/mptcp/protocol.c?id=0a9a182ea5c7bb0374e527130fd85024ace7279b)@@ -1986,7 +1986,8 @@ static void mptcp\_rcv\_space\_adjust(struct mptcp\_sock \*msk, int copied) slow = lock\_sock\_fast(ssk); WRITE\_ONCE(ssk->sk\_rcvbuf, rcvbuf); tcp\_sk(ssk)->window\_clamp = window\_clamp;- tcp\_cleanup\_rbuf(ssk, 1);+ if (tcp\_can\_send\_ack(ssk))+ tcp\_cleanup\_rbuf(ssk, 1); unlock\_sock\_fast(ssk, slow); } } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-15 10:09:44 +0000



=== Content from git.kernel.org_31a6ece9_20250115_101110.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=ff825ab2f455299c0c7287550915a8878e2a66e0)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=ff825ab2f455299c0c7287550915a8878e2a66e0)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=ff825ab2f455299c0c7287550915a8878e2a66e0)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=ff825ab2f455299c0c7287550915a8878e2a66e0)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Paolo Abeni <pabeni@redhat.com> | 2024-11-08 11:58:17 +0100 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-11-22 15:38:31 +0100 |
| commit | [ff825ab2f455299c0c7287550915a8878e2a66e0](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=ff825ab2f455299c0c7287550915a8878e2a66e0) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=ff825ab2f455299c0c7287550915a8878e2a66e0)) | |
| tree | [2cbf79aab4701cdec4b350114c9efec229ef4c94](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=ff825ab2f455299c0c7287550915a8878e2a66e0) | |
| parent | [a66805c9b22caf4e42af7a616f6c6b83c90d1010](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=a66805c9b22caf4e42af7a616f6c6b83c90d1010) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=ff825ab2f455299c0c7287550915a8878e2a66e0&id2=a66805c9b22caf4e42af7a616f6c6b83c90d1010)) | |
| download | [linux-ff825ab2f455299c0c7287550915a8878e2a66e0.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-ff825ab2f455299c0c7287550915a8878e2a66e0.tar.gz) | |

mptcp: cope racing subflow creation in mptcp\_rcv\_space\_adjust[ Upstream commit ce7356ae35943cc6494cc692e62d51a734062b7d ]
Additional active subflows - i.e. created by the in kernel path
manager - are included into the subflow list before starting the
3whs.
A racing recvmsg() spooling data received on an already established
subflow would unconditionally call tcp\_cleanup\_rbuf() on all the
current subflows, potentially hitting a divide by zero error on
the newly created ones.
Explicitly check that the subflow is in a suitable state before
invoking tcp\_cleanup\_rbuf().
Fixes: c76c6956566f ("mptcp: call tcp\_cleanup\_rbuf on subflows")
Signed-off-by: Paolo Abeni <pabeni@redhat.com>
Reviewed-by: Matthieu Baerts (NGI0) <matttbe@kernel.org>
Link: [https://patch.msgid.link/02374660836e1b52afc91966b7535c8c5f7bafb0.1731060874.git.pabeni@redhat.com](https://patch.msgid.link/02374660836e1b52afc91966b7535c8c5f7bafb0.1731060874.git.pabeni%40redhat.com)
Signed-off-by: Jakub Kicinski <kuba@kernel.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=ff825ab2f455299c0c7287550915a8878e2a66e0)

| -rw-r--r-- | [net/mptcp/protocol.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/mptcp/protocol.c?id=ff825ab2f455299c0c7287550915a8878e2a66e0) | 3 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 2 insertions, 1 deletions

| diff --git a/net/mptcp/protocol.c b/net/mptcp/protocol.cindex e99ef1e67e9573..b8357d7c6b3a10 100644--- a/[net/mptcp/protocol.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/mptcp/protocol.c?id=a66805c9b22caf4e42af7a616f6c6b83c90d1010)+++ b/[net/mptcp/protocol.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/mptcp/protocol.c?id=ff825ab2f455299c0c7287550915a8878e2a66e0)@@ -2045,7 +2045,8 @@ static void mptcp\_rcv\_space\_adjust(struct mptcp\_sock \*msk, int copied) slow = lock\_sock\_fast(ssk); WRITE\_ONCE(ssk->sk\_rcvbuf, rcvbuf); WRITE\_ONCE(tcp\_sk(ssk)->window\_clamp, window\_clamp);- tcp\_cleanup\_rbuf(ssk, 1);+ if (tcp\_can\_send\_ack(ssk))+ tcp\_cleanup\_rbuf(ssk, 1); unlock\_sock\_fast(ssk, slow); } } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-15 10:09:47 +0000



=== Content from git.kernel.org_fb629e87_20250115_101109.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=aad6412c63baa39dd813e81f16a14d976b3de2e8)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=aad6412c63baa39dd813e81f16a14d976b3de2e8)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=aad6412c63baa39dd813e81f16a14d976b3de2e8)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=aad6412c63baa39dd813e81f16a14d976b3de2e8)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Paolo Abeni <pabeni@redhat.com> | 2024-11-08 11:58:17 +0100 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-11-22 15:39:47 +0100 |
| commit | [aad6412c63baa39dd813e81f16a14d976b3de2e8](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=aad6412c63baa39dd813e81f16a14d976b3de2e8) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=aad6412c63baa39dd813e81f16a14d976b3de2e8)) | |
| tree | [b81621957750231d1d412786a731728e8ac10c7c](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=aad6412c63baa39dd813e81f16a14d976b3de2e8) | |
| parent | [955388e1d5d222c4101c596b536d41b91a8b212e](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=955388e1d5d222c4101c596b536d41b91a8b212e) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=aad6412c63baa39dd813e81f16a14d976b3de2e8&id2=955388e1d5d222c4101c596b536d41b91a8b212e)) | |
| download | [linux-aad6412c63baa39dd813e81f16a14d976b3de2e8.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-aad6412c63baa39dd813e81f16a14d976b3de2e8.tar.gz) | |

mptcp: cope racing subflow creation in mptcp\_rcv\_space\_adjust[ Upstream commit ce7356ae35943cc6494cc692e62d51a734062b7d ]
Additional active subflows - i.e. created by the in kernel path
manager - are included into the subflow list before starting the
3whs.
A racing recvmsg() spooling data received on an already established
subflow would unconditionally call tcp\_cleanup\_rbuf() on all the
current subflows, potentially hitting a divide by zero error on
the newly created ones.
Explicitly check that the subflow is in a suitable state before
invoking tcp\_cleanup\_rbuf().
Fixes: c76c6956566f ("mptcp: call tcp\_cleanup\_rbuf on subflows")
Signed-off-by: Paolo Abeni <pabeni@redhat.com>
Reviewed-by: Matthieu Baerts (NGI0) <matttbe@kernel.org>
Link: [https://patch.msgid.link/02374660836e1b52afc91966b7535c8c5f7bafb0.1731060874.git.pabeni@redhat.com](https://patch.msgid.link/02374660836e1b52afc91966b7535c8c5f7bafb0.1731060874.git.pabeni%40redhat.com)
Signed-off-by: Jakub Kicinski <kuba@kernel.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=aad6412c63baa39dd813e81f16a14d976b3de2e8)

| -rw-r--r-- | [net/mptcp/protocol.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/mptcp/protocol.c?id=aad6412c63baa39dd813e81f16a14d976b3de2e8) | 3 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 2 insertions, 1 deletions

| diff --git a/net/mptcp/protocol.c b/net/mptcp/protocol.cindex f3e54c836ba565..7913ba6b5daa38 100644--- a/[net/mptcp/protocol.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/mptcp/protocol.c?id=955388e1d5d222c4101c596b536d41b91a8b212e)+++ b/[net/mptcp/protocol.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/mptcp/protocol.c?id=aad6412c63baa39dd813e81f16a14d976b3de2e8)@@ -2082,7 +2082,8 @@ static void mptcp\_rcv\_space\_adjust(struct mptcp\_sock \*msk, int copied) slow = lock\_sock\_fast(ssk); WRITE\_ONCE(ssk->sk\_rcvbuf, rcvbuf); WRITE\_ONCE(tcp\_sk(ssk)->window\_clamp, window\_clamp);- tcp\_cleanup\_rbuf(ssk, 1);+ if (tcp\_can\_send\_ack(ssk))+ tcp\_cleanup\_rbuf(ssk, 1); unlock\_sock\_fast(ssk, slow); } } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-15 10:09:46 +0000


