=== Content from git.kernel.org_de93c1cf_20250114_222659.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=ea4c990fa9e19ffef0648e40c566b94ba5ab31be)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=ea4c990fa9e19ffef0648e40c566b94ba5ab31be)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=ea4c990fa9e19ffef0648e40c566b94ba5ab31be)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=ea4c990fa9e19ffef0648e40c566b94ba5ab31be)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Zhu Yanjun <yanjun.zhu@linux.dev> | 2024-10-25 17:20:36 +0200 |
| --- | --- | --- |
| committer | Leon Romanovsky <leon@kernel.org> | 2024-10-30 14:22:03 +0200 |
| commit | [ea4c990fa9e19ffef0648e40c566b94ba5ab31be](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=ea4c990fa9e19ffef0648e40c566b94ba5ab31be) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=ea4c990fa9e19ffef0648e40c566b94ba5ab31be)) | |
| tree | [604ce1a6b62d33508baa1487eac1208db0e037a6](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=ea4c990fa9e19ffef0648e40c566b94ba5ab31be) | |
| parent | [323275ac2ff15b2b7b3eac391ae5d8c5a3c3a999](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=323275ac2ff15b2b7b3eac391ae5d8c5a3c3a999) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=ea4c990fa9e19ffef0648e40c566b94ba5ab31be&id2=323275ac2ff15b2b7b3eac391ae5d8c5a3c3a999)) | |
| download | [linux-ea4c990fa9e19ffef0648e40c566b94ba5ab31be.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-ea4c990fa9e19ffef0648e40c566b94ba5ab31be.tar.gz) | |

RDMA/rxe: Fix the qp flush warnings in reqWhen the qp is in error state, the status of WQEs in the queue should be
set to error. Or else the following will appear.
[ 920.617269] WARNING: CPU: 1 PID: 21 at drivers/infiniband/sw/rxe/rxe\_comp.c:756 rxe\_completer+0x989/0xcc0 [rdma\_rxe]
[ 920.617744] Modules linked in: rnbd\_client(O) rtrs\_client(O) rtrs\_core(O) rdma\_ucm rdma\_cm iw\_cm ib\_cm crc32\_generic rdma\_rxe ip6\_udp\_tunnel udp\_tunnel ib\_uverbs ib\_core loop brd null\_blk ipv6
[ 920.618516] CPU: 1 PID: 21 Comm: ksoftirqd/1 Tainted: G O 6.1.113-storage+ #65
[ 920.618986] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS 1.15.0-1 04/01/2014
[ 920.619396] RIP: 0010:rxe\_completer+0x989/0xcc0 [rdma\_rxe]
[ 920.619658] Code: 0f b6 84 24 3a 02 00 00 41 89 84 24 44 04 00 00 e9 2a f7 ff ff 39 ca bb 03 00 00 00 b8 0e 00 00 00 48 0f 45 d8 e9 15 f7 ff ff <0f> 0b e9 cb f8 ff ff 41 bf f5 ff ff ff e9 08 f8 ff ff 49 8d bc 24
[ 920.620482] RSP: 0018:ffff97b7c00bbc38 EFLAGS: 00010246
[ 920.620817] RAX: 0000000000000000 RBX: 000000000000000c RCX: 0000000000000008
[ 920.621183] RDX: ffff960dc396ebc0 RSI: 0000000000005400 RDI: ffff960dc4e2fbac
[ 920.621548] RBP: 0000000000000000 R08: 0000000000000001 R09: ffffffffac406450
[ 920.621884] R10: ffffffffac4060c0 R11: 0000000000000001 R12: ffff960dc4e2f800
[ 920.622254] R13: ffff960dc4e2f928 R14: ffff97b7c029c580 R15: 0000000000000000
[ 920.622609] FS: 0000000000000000(0000) GS:ffff960ef7d00000(0000) knlGS:0000000000000000
[ 920.622979] CS: 0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[ 920.623245] CR2: 00007fa056965e90 CR3: 00000001107f1000 CR4: 00000000000006e0
[ 920.623680] Call Trace:
[ 920.623815] <TASK>
[ 920.623933] ? \_\_warn+0x79/0xc0
[ 920.624116] ? rxe\_completer+0x989/0xcc0 [rdma\_rxe]
[ 920.624356] ? report\_bug+0xfb/0x150
[ 920.624594] ? handle\_bug+0x3c/0x60
[ 920.624796] ? exc\_invalid\_op+0x14/0x70
[ 920.624976] ? asm\_exc\_invalid\_op+0x16/0x20
[ 920.625203] ? rxe\_completer+0x989/0xcc0 [rdma\_rxe]
[ 920.625474] ? rxe\_completer+0x329/0xcc0 [rdma\_rxe]
[ 920.625749] rxe\_do\_task+0x80/0x110 [rdma\_rxe]
[ 920.626037] rxe\_requester+0x625/0xde0 [rdma\_rxe]
[ 920.626310] ? rxe\_cq\_post+0xe2/0x180 [rdma\_rxe]
[ 920.626583] ? do\_complete+0x18d/0x220 [rdma\_rxe]
[ 920.626812] ? rxe\_completer+0x1a3/0xcc0 [rdma\_rxe]
[ 920.627050] rxe\_do\_task+0x80/0x110 [rdma\_rxe]
[ 920.627285] tasklet\_action\_common.constprop.0+0xa4/0x120
[ 920.627522] handle\_softirqs+0xc2/0x250
[ 920.627728] ? sort\_range+0x20/0x20
[ 920.627942] run\_ksoftirqd+0x1f/0x30
[ 920.628158] smpboot\_thread\_fn+0xc7/0x1b0
[ 920.628334] kthread+0xd6/0x100
[ 920.628504] ? kthread\_complete\_and\_exit+0x20/0x20
[ 920.628709] ret\_from\_fork+0x1f/0x30
[ 920.628892] </TASK>
Fixes: ae720bdb703b ("RDMA/rxe: Generate error completion for error requester QP state")
Signed-off-by: Zhu Yanjun <yanjun.zhu@linux.dev>
Link: [https://patch.msgid.link/20241025152036.121417-1-yanjun.zhu@linux.dev](https://patch.msgid.link/20241025152036.121417-1-yanjun.zhu%40linux.dev)
Signed-off-by: Leon Romanovsky <leon@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=ea4c990fa9e19ffef0648e40c566b94ba5ab31be)

| -rw-r--r-- | [drivers/infiniband/sw/rxe/rxe\_req.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/infiniband/sw/rxe/rxe_req.c?id=ea4c990fa9e19ffef0648e40c566b94ba5ab31be) | 6 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 4 insertions, 2 deletions

| diff --git a/drivers/infiniband/sw/rxe/rxe\_req.c b/drivers/infiniband/sw/rxe/rxe\_req.cindex 479c07e6e4ed3e..87a02f0deb0001 100644--- a/[drivers/infiniband/sw/rxe/rxe\_req.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/infiniband/sw/rxe/rxe_req.c?id=323275ac2ff15b2b7b3eac391ae5d8c5a3c3a999)+++ b/[drivers/infiniband/sw/rxe/rxe\_req.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/infiniband/sw/rxe/rxe_req.c?id=ea4c990fa9e19ffef0648e40c566b94ba5ab31be)@@ -663,10 +663,12 @@ int rxe\_requester(struct rxe\_qp \*qp) if (unlikely(qp\_state(qp) == IB\_QPS\_ERR)) { wqe = \_\_req\_next\_wqe(qp); spin\_unlock\_irqrestore(&qp->state\_lock, flags);- if (wqe)+ if (wqe) {+ wqe->status = IB\_WC\_WR\_FLUSH\_ERR; goto err;- else+ } else { goto exit;+ } }  if (unlikely(qp\_state(qp) == IB\_QPS\_RESET)) { |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 22:25:36 +0000



=== Content from git.kernel.org_7201877c_20250114_222657.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=e4f26fae6075f136616d12a369b0ef7f0cf16436)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=e4f26fae6075f136616d12a369b0ef7f0cf16436)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=e4f26fae6075f136616d12a369b0ef7f0cf16436)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e4f26fae6075f136616d12a369b0ef7f0cf16436)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Zhu Yanjun <yanjun.zhu@linux.dev> | 2024-10-25 17:20:36 +0200 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-05 13:53:35 +0100 |
| commit | [e4f26fae6075f136616d12a369b0ef7f0cf16436](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=e4f26fae6075f136616d12a369b0ef7f0cf16436) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=e4f26fae6075f136616d12a369b0ef7f0cf16436)) | |
| tree | [a096d1c3aa284d8610a813e943dca2c68ca65dad](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=e4f26fae6075f136616d12a369b0ef7f0cf16436) | |
| parent | [a0e4c78770faa0d56d47391476fe1d827e72eded](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=a0e4c78770faa0d56d47391476fe1d827e72eded) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e4f26fae6075f136616d12a369b0ef7f0cf16436&id2=a0e4c78770faa0d56d47391476fe1d827e72eded)) | |
| download | [linux-e4f26fae6075f136616d12a369b0ef7f0cf16436.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-e4f26fae6075f136616d12a369b0ef7f0cf16436.tar.gz) | |

RDMA/rxe: Fix the qp flush warnings in req[ Upstream commit ea4c990fa9e19ffef0648e40c566b94ba5ab31be ]
When the qp is in error state, the status of WQEs in the queue should be
set to error. Or else the following will appear.
[ 920.617269] WARNING: CPU: 1 PID: 21 at drivers/infiniband/sw/rxe/rxe\_comp.c:756 rxe\_completer+0x989/0xcc0 [rdma\_rxe]
[ 920.617744] Modules linked in: rnbd\_client(O) rtrs\_client(O) rtrs\_core(O) rdma\_ucm rdma\_cm iw\_cm ib\_cm crc32\_generic rdma\_rxe ip6\_udp\_tunnel udp\_tunnel ib\_uverbs ib\_core loop brd null\_blk ipv6
[ 920.618516] CPU: 1 PID: 21 Comm: ksoftirqd/1 Tainted: G O 6.1.113-storage+ #65
[ 920.618986] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS 1.15.0-1 04/01/2014
[ 920.619396] RIP: 0010:rxe\_completer+0x989/0xcc0 [rdma\_rxe]
[ 920.619658] Code: 0f b6 84 24 3a 02 00 00 41 89 84 24 44 04 00 00 e9 2a f7 ff ff 39 ca bb 03 00 00 00 b8 0e 00 00 00 48 0f 45 d8 e9 15 f7 ff ff <0f> 0b e9 cb f8 ff ff 41 bf f5 ff ff ff e9 08 f8 ff ff 49 8d bc 24
[ 920.620482] RSP: 0018:ffff97b7c00bbc38 EFLAGS: 00010246
[ 920.620817] RAX: 0000000000000000 RBX: 000000000000000c RCX: 0000000000000008
[ 920.621183] RDX: ffff960dc396ebc0 RSI: 0000000000005400 RDI: ffff960dc4e2fbac
[ 920.621548] RBP: 0000000000000000 R08: 0000000000000001 R09: ffffffffac406450
[ 920.621884] R10: ffffffffac4060c0 R11: 0000000000000001 R12: ffff960dc4e2f800
[ 920.622254] R13: ffff960dc4e2f928 R14: ffff97b7c029c580 R15: 0000000000000000
[ 920.622609] FS: 0000000000000000(0000) GS:ffff960ef7d00000(0000) knlGS:0000000000000000
[ 920.622979] CS: 0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[ 920.623245] CR2: 00007fa056965e90 CR3: 00000001107f1000 CR4: 00000000000006e0
[ 920.623680] Call Trace:
[ 920.623815] <TASK>
[ 920.623933] ? \_\_warn+0x79/0xc0
[ 920.624116] ? rxe\_completer+0x989/0xcc0 [rdma\_rxe]
[ 920.624356] ? report\_bug+0xfb/0x150
[ 920.624594] ? handle\_bug+0x3c/0x60
[ 920.624796] ? exc\_invalid\_op+0x14/0x70
[ 920.624976] ? asm\_exc\_invalid\_op+0x16/0x20
[ 920.625203] ? rxe\_completer+0x989/0xcc0 [rdma\_rxe]
[ 920.625474] ? rxe\_completer+0x329/0xcc0 [rdma\_rxe]
[ 920.625749] rxe\_do\_task+0x80/0x110 [rdma\_rxe]
[ 920.626037] rxe\_requester+0x625/0xde0 [rdma\_rxe]
[ 920.626310] ? rxe\_cq\_post+0xe2/0x180 [rdma\_rxe]
[ 920.626583] ? do\_complete+0x18d/0x220 [rdma\_rxe]
[ 920.626812] ? rxe\_completer+0x1a3/0xcc0 [rdma\_rxe]
[ 920.627050] rxe\_do\_task+0x80/0x110 [rdma\_rxe]
[ 920.627285] tasklet\_action\_common.constprop.0+0xa4/0x120
[ 920.627522] handle\_softirqs+0xc2/0x250
[ 920.627728] ? sort\_range+0x20/0x20
[ 920.627942] run\_ksoftirqd+0x1f/0x30
[ 920.628158] smpboot\_thread\_fn+0xc7/0x1b0
[ 920.628334] kthread+0xd6/0x100
[ 920.628504] ? kthread\_complete\_and\_exit+0x20/0x20
[ 920.628709] ret\_from\_fork+0x1f/0x30
[ 920.628892] </TASK>
Fixes: ae720bdb703b ("RDMA/rxe: Generate error completion for error requester QP state")
Signed-off-by: Zhu Yanjun <yanjun.zhu@linux.dev>
Link: [https://patch.msgid.link/20241025152036.121417-1-yanjun.zhu@linux.dev](https://patch.msgid.link/20241025152036.121417-1-yanjun.zhu%40linux.dev)
Signed-off-by: Leon Romanovsky <leon@kernel.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e4f26fae6075f136616d12a369b0ef7f0cf16436)

| -rw-r--r-- | [drivers/infiniband/sw/rxe/rxe\_req.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/infiniband/sw/rxe/rxe_req.c?id=e4f26fae6075f136616d12a369b0ef7f0cf16436) | 6 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 4 insertions, 2 deletions

| diff --git a/drivers/infiniband/sw/rxe/rxe\_req.c b/drivers/infiniband/sw/rxe/rxe\_req.cindex 479c07e6e4ed3e..87a02f0deb0001 100644--- a/[drivers/infiniband/sw/rxe/rxe\_req.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/infiniband/sw/rxe/rxe_req.c?id=a0e4c78770faa0d56d47391476fe1d827e72eded)+++ b/[drivers/infiniband/sw/rxe/rxe\_req.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/infiniband/sw/rxe/rxe_req.c?id=e4f26fae6075f136616d12a369b0ef7f0cf16436)@@ -663,10 +663,12 @@ int rxe\_requester(struct rxe\_qp \*qp) if (unlikely(qp\_state(qp) == IB\_QPS\_ERR)) { wqe = \_\_req\_next\_wqe(qp); spin\_unlock\_irqrestore(&qp->state\_lock, flags);- if (wqe)+ if (wqe) {+ wqe->status = IB\_WC\_WR\_FLUSH\_ERR; goto err;- else+ } else { goto exit;+ } }  if (unlikely(qp\_state(qp) == IB\_QPS\_RESET)) { |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 22:25:34 +0000



=== Content from git.kernel.org_d8768be1_20250114_222656.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=cc341b5d761a8a16693fe406b8127e4378747f85)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=cc341b5d761a8a16693fe406b8127e4378747f85)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=cc341b5d761a8a16693fe406b8127e4378747f85)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=cc341b5d761a8a16693fe406b8127e4378747f85)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Zhu Yanjun <yanjun.zhu@linux.dev> | 2024-10-25 17:20:36 +0200 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-05 14:02:07 +0100 |
| commit | [cc341b5d761a8a16693fe406b8127e4378747f85](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=cc341b5d761a8a16693fe406b8127e4378747f85) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=cc341b5d761a8a16693fe406b8127e4378747f85)) | |
| tree | [4c6c3c414dd659fa7fd106c41ee237dd2b5f5a71](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=cc341b5d761a8a16693fe406b8127e4378747f85) | |
| parent | [e2e64f9c42c717beb459ab209ec1c4baa73d3760](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=e2e64f9c42c717beb459ab209ec1c4baa73d3760) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=cc341b5d761a8a16693fe406b8127e4378747f85&id2=e2e64f9c42c717beb459ab209ec1c4baa73d3760)) | |
| download | [linux-cc341b5d761a8a16693fe406b8127e4378747f85.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-cc341b5d761a8a16693fe406b8127e4378747f85.tar.gz) | |

RDMA/rxe: Fix the qp flush warnings in req[ Upstream commit ea4c990fa9e19ffef0648e40c566b94ba5ab31be ]
When the qp is in error state, the status of WQEs in the queue should be
set to error. Or else the following will appear.
[ 920.617269] WARNING: CPU: 1 PID: 21 at drivers/infiniband/sw/rxe/rxe\_comp.c:756 rxe\_completer+0x989/0xcc0 [rdma\_rxe]
[ 920.617744] Modules linked in: rnbd\_client(O) rtrs\_client(O) rtrs\_core(O) rdma\_ucm rdma\_cm iw\_cm ib\_cm crc32\_generic rdma\_rxe ip6\_udp\_tunnel udp\_tunnel ib\_uverbs ib\_core loop brd null\_blk ipv6
[ 920.618516] CPU: 1 PID: 21 Comm: ksoftirqd/1 Tainted: G O 6.1.113-storage+ #65
[ 920.618986] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS 1.15.0-1 04/01/2014
[ 920.619396] RIP: 0010:rxe\_completer+0x989/0xcc0 [rdma\_rxe]
[ 920.619658] Code: 0f b6 84 24 3a 02 00 00 41 89 84 24 44 04 00 00 e9 2a f7 ff ff 39 ca bb 03 00 00 00 b8 0e 00 00 00 48 0f 45 d8 e9 15 f7 ff ff <0f> 0b e9 cb f8 ff ff 41 bf f5 ff ff ff e9 08 f8 ff ff 49 8d bc 24
[ 920.620482] RSP: 0018:ffff97b7c00bbc38 EFLAGS: 00010246
[ 920.620817] RAX: 0000000000000000 RBX: 000000000000000c RCX: 0000000000000008
[ 920.621183] RDX: ffff960dc396ebc0 RSI: 0000000000005400 RDI: ffff960dc4e2fbac
[ 920.621548] RBP: 0000000000000000 R08: 0000000000000001 R09: ffffffffac406450
[ 920.621884] R10: ffffffffac4060c0 R11: 0000000000000001 R12: ffff960dc4e2f800
[ 920.622254] R13: ffff960dc4e2f928 R14: ffff97b7c029c580 R15: 0000000000000000
[ 920.622609] FS: 0000000000000000(0000) GS:ffff960ef7d00000(0000) knlGS:0000000000000000
[ 920.622979] CS: 0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[ 920.623245] CR2: 00007fa056965e90 CR3: 00000001107f1000 CR4: 00000000000006e0
[ 920.623680] Call Trace:
[ 920.623815] <TASK>
[ 920.623933] ? \_\_warn+0x79/0xc0
[ 920.624116] ? rxe\_completer+0x989/0xcc0 [rdma\_rxe]
[ 920.624356] ? report\_bug+0xfb/0x150
[ 920.624594] ? handle\_bug+0x3c/0x60
[ 920.624796] ? exc\_invalid\_op+0x14/0x70
[ 920.624976] ? asm\_exc\_invalid\_op+0x16/0x20
[ 920.625203] ? rxe\_completer+0x989/0xcc0 [rdma\_rxe]
[ 920.625474] ? rxe\_completer+0x329/0xcc0 [rdma\_rxe]
[ 920.625749] rxe\_do\_task+0x80/0x110 [rdma\_rxe]
[ 920.626037] rxe\_requester+0x625/0xde0 [rdma\_rxe]
[ 920.626310] ? rxe\_cq\_post+0xe2/0x180 [rdma\_rxe]
[ 920.626583] ? do\_complete+0x18d/0x220 [rdma\_rxe]
[ 920.626812] ? rxe\_completer+0x1a3/0xcc0 [rdma\_rxe]
[ 920.627050] rxe\_do\_task+0x80/0x110 [rdma\_rxe]
[ 920.627285] tasklet\_action\_common.constprop.0+0xa4/0x120
[ 920.627522] handle\_softirqs+0xc2/0x250
[ 920.627728] ? sort\_range+0x20/0x20
[ 920.627942] run\_ksoftirqd+0x1f/0x30
[ 920.628158] smpboot\_thread\_fn+0xc7/0x1b0
[ 920.628334] kthread+0xd6/0x100
[ 920.628504] ? kthread\_complete\_and\_exit+0x20/0x20
[ 920.628709] ret\_from\_fork+0x1f/0x30
[ 920.628892] </TASK>
Fixes: ae720bdb703b ("RDMA/rxe: Generate error completion for error requester QP state")
Signed-off-by: Zhu Yanjun <yanjun.zhu@linux.dev>
Link: [https://patch.msgid.link/20241025152036.121417-1-yanjun.zhu@linux.dev](https://patch.msgid.link/20241025152036.121417-1-yanjun.zhu%40linux.dev)
Signed-off-by: Leon Romanovsky <leon@kernel.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=cc341b5d761a8a16693fe406b8127e4378747f85)

| -rw-r--r-- | [drivers/infiniband/sw/rxe/rxe\_req.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/infiniband/sw/rxe/rxe_req.c?id=cc341b5d761a8a16693fe406b8127e4378747f85) | 6 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 4 insertions, 2 deletions

| diff --git a/drivers/infiniband/sw/rxe/rxe\_req.c b/drivers/infiniband/sw/rxe/rxe\_req.cindex 479c07e6e4ed3e..87a02f0deb0001 100644--- a/[drivers/infiniband/sw/rxe/rxe\_req.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/infiniband/sw/rxe/rxe_req.c?id=e2e64f9c42c717beb459ab209ec1c4baa73d3760)+++ b/[drivers/infiniband/sw/rxe/rxe\_req.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/infiniband/sw/rxe/rxe_req.c?id=cc341b5d761a8a16693fe406b8127e4378747f85)@@ -663,10 +663,12 @@ int rxe\_requester(struct rxe\_qp \*qp) if (unlikely(qp\_state(qp) == IB\_QPS\_ERR)) { wqe = \_\_req\_next\_wqe(qp); spin\_unlock\_irqrestore(&qp->state\_lock, flags);- if (wqe)+ if (wqe) {+ wqe->status = IB\_WC\_WR\_FLUSH\_ERR; goto err;- else+ } else { goto exit;+ } }  if (unlikely(qp\_state(qp) == IB\_QPS\_RESET)) { |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 22:25:33 +0000



=== Content from git.kernel.org_688c81e6_20250114_222654.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=31978d5c5aef034d96fc53b4a9cb3c6e11dbb94d)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=31978d5c5aef034d96fc53b4a9cb3c6e11dbb94d)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=31978d5c5aef034d96fc53b4a9cb3c6e11dbb94d)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=31978d5c5aef034d96fc53b4a9cb3c6e11dbb94d)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Zhu Yanjun <yanjun.zhu@linux.dev> | 2024-10-25 17:20:36 +0200 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-09 10:32:16 +0100 |
| commit | [31978d5c5aef034d96fc53b4a9cb3c6e11dbb94d](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=31978d5c5aef034d96fc53b4a9cb3c6e11dbb94d) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=31978d5c5aef034d96fc53b4a9cb3c6e11dbb94d)) | |
| tree | [a3206872990617404a599d2ca27eee71603c6985](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=31978d5c5aef034d96fc53b4a9cb3c6e11dbb94d) | |
| parent | [b4ba31e5aaffbda9b22d9a35c40b16dc39e475a6](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=b4ba31e5aaffbda9b22d9a35c40b16dc39e475a6) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=31978d5c5aef034d96fc53b4a9cb3c6e11dbb94d&id2=b4ba31e5aaffbda9b22d9a35c40b16dc39e475a6)) | |
| download | [linux-31978d5c5aef034d96fc53b4a9cb3c6e11dbb94d.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-31978d5c5aef034d96fc53b4a9cb3c6e11dbb94d.tar.gz) | |

RDMA/rxe: Fix the qp flush warnings in req[ Upstream commit ea4c990fa9e19ffef0648e40c566b94ba5ab31be ]
When the qp is in error state, the status of WQEs in the queue should be
set to error. Or else the following will appear.
[ 920.617269] WARNING: CPU: 1 PID: 21 at drivers/infiniband/sw/rxe/rxe\_comp.c:756 rxe\_completer+0x989/0xcc0 [rdma\_rxe]
[ 920.617744] Modules linked in: rnbd\_client(O) rtrs\_client(O) rtrs\_core(O) rdma\_ucm rdma\_cm iw\_cm ib\_cm crc32\_generic rdma\_rxe ip6\_udp\_tunnel udp\_tunnel ib\_uverbs ib\_core loop brd null\_blk ipv6
[ 920.618516] CPU: 1 PID: 21 Comm: ksoftirqd/1 Tainted: G O 6.1.113-storage+ #65
[ 920.618986] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS 1.15.0-1 04/01/2014
[ 920.619396] RIP: 0010:rxe\_completer+0x989/0xcc0 [rdma\_rxe]
[ 920.619658] Code: 0f b6 84 24 3a 02 00 00 41 89 84 24 44 04 00 00 e9 2a f7 ff ff 39 ca bb 03 00 00 00 b8 0e 00 00 00 48 0f 45 d8 e9 15 f7 ff ff <0f> 0b e9 cb f8 ff ff 41 bf f5 ff ff ff e9 08 f8 ff ff 49 8d bc 24
[ 920.620482] RSP: 0018:ffff97b7c00bbc38 EFLAGS: 00010246
[ 920.620817] RAX: 0000000000000000 RBX: 000000000000000c RCX: 0000000000000008
[ 920.621183] RDX: ffff960dc396ebc0 RSI: 0000000000005400 RDI: ffff960dc4e2fbac
[ 920.621548] RBP: 0000000000000000 R08: 0000000000000001 R09: ffffffffac406450
[ 920.621884] R10: ffffffffac4060c0 R11: 0000000000000001 R12: ffff960dc4e2f800
[ 920.622254] R13: ffff960dc4e2f928 R14: ffff97b7c029c580 R15: 0000000000000000
[ 920.622609] FS: 0000000000000000(0000) GS:ffff960ef7d00000(0000) knlGS:0000000000000000
[ 920.622979] CS: 0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[ 920.623245] CR2: 00007fa056965e90 CR3: 00000001107f1000 CR4: 00000000000006e0
[ 920.623680] Call Trace:
[ 920.623815] <TASK>
[ 920.623933] ? \_\_warn+0x79/0xc0
[ 920.624116] ? rxe\_completer+0x989/0xcc0 [rdma\_rxe]
[ 920.624356] ? report\_bug+0xfb/0x150
[ 920.624594] ? handle\_bug+0x3c/0x60
[ 920.624796] ? exc\_invalid\_op+0x14/0x70
[ 920.624976] ? asm\_exc\_invalid\_op+0x16/0x20
[ 920.625203] ? rxe\_completer+0x989/0xcc0 [rdma\_rxe]
[ 920.625474] ? rxe\_completer+0x329/0xcc0 [rdma\_rxe]
[ 920.625749] rxe\_do\_task+0x80/0x110 [rdma\_rxe]
[ 920.626037] rxe\_requester+0x625/0xde0 [rdma\_rxe]
[ 920.626310] ? rxe\_cq\_post+0xe2/0x180 [rdma\_rxe]
[ 920.626583] ? do\_complete+0x18d/0x220 [rdma\_rxe]
[ 920.626812] ? rxe\_completer+0x1a3/0xcc0 [rdma\_rxe]
[ 920.627050] rxe\_do\_task+0x80/0x110 [rdma\_rxe]
[ 920.627285] tasklet\_action\_common.constprop.0+0xa4/0x120
[ 920.627522] handle\_softirqs+0xc2/0x250
[ 920.627728] ? sort\_range+0x20/0x20
[ 920.627942] run\_ksoftirqd+0x1f/0x30
[ 920.628158] smpboot\_thread\_fn+0xc7/0x1b0
[ 920.628334] kthread+0xd6/0x100
[ 920.628504] ? kthread\_complete\_and\_exit+0x20/0x20
[ 920.628709] ret\_from\_fork+0x1f/0x30
[ 920.628892] </TASK>
Fixes: ae720bdb703b ("RDMA/rxe: Generate error completion for error requester QP state")
Signed-off-by: Zhu Yanjun <yanjun.zhu@linux.dev>
Link: [https://patch.msgid.link/20241025152036.121417-1-yanjun.zhu@linux.dev](https://patch.msgid.link/20241025152036.121417-1-yanjun.zhu%40linux.dev)
Signed-off-by: Leon Romanovsky <leon@kernel.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=31978d5c5aef034d96fc53b4a9cb3c6e11dbb94d)

| -rw-r--r-- | [drivers/infiniband/sw/rxe/rxe\_req.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/infiniband/sw/rxe/rxe_req.c?id=31978d5c5aef034d96fc53b4a9cb3c6e11dbb94d) | 6 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 4 insertions, 2 deletions

| diff --git a/drivers/infiniband/sw/rxe/rxe\_req.c b/drivers/infiniband/sw/rxe/rxe\_req.cindex 7a36080d2baef5..7ff152ffe15b9f 100644--- a/[drivers/infiniband/sw/rxe/rxe\_req.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/infiniband/sw/rxe/rxe_req.c?id=b4ba31e5aaffbda9b22d9a35c40b16dc39e475a6)+++ b/[drivers/infiniband/sw/rxe/rxe\_req.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/infiniband/sw/rxe/rxe_req.c?id=31978d5c5aef034d96fc53b4a9cb3c6e11dbb94d)@@ -693,10 +693,12 @@ int rxe\_requester(struct rxe\_qp \*qp) if (unlikely(qp\_state(qp) == IB\_QPS\_ERR)) { wqe = \_\_req\_next\_wqe(qp); spin\_unlock\_irqrestore(&qp->state\_lock, flags);- if (wqe)+ if (wqe) {+ wqe->status = IB\_WC\_WR\_FLUSH\_ERR; goto err;- else+ } else { goto exit;+ } }  if (unlikely(qp\_state(qp) == IB\_QPS\_RESET)) { |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 22:25:31 +0000


