=== Content from git.kernel.org_2c0b9a55_20250114_220950.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=9e11b1d5fda972f6be60ab732976a7c8e064cd56)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=9e11b1d5fda972f6be60ab732976a7c8e064cd56)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=9e11b1d5fda972f6be60ab732976a7c8e064cd56)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=9e11b1d5fda972f6be60ab732976a7c8e064cd56)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Ye Bin <yebin10@huawei.com> | 2024-10-12 00:44:50 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-05 14:02:19 +0100 |
| commit | [9e11b1d5fda972f6be60ab732976a7c8e064cd56](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=9e11b1d5fda972f6be60ab732976a7c8e064cd56) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=9e11b1d5fda972f6be60ab732976a7c8e064cd56)) | |
| tree | [981639eae251e3916f26c80c763fa5b5099fcb29](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=9e11b1d5fda972f6be60ab732976a7c8e064cd56) | |
| parent | [a26ace3c6efe3da38a8e388b2a04519065513a70](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=a26ace3c6efe3da38a8e388b2a04519065513a70) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=9e11b1d5fda972f6be60ab732976a7c8e064cd56&id2=a26ace3c6efe3da38a8e388b2a04519065513a70)) | |
| download | [linux-9e11b1d5fda972f6be60ab732976a7c8e064cd56.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-9e11b1d5fda972f6be60ab732976a7c8e064cd56.tar.gz) | |

f2fs: fix null-ptr-deref in f2fs\_submit\_page\_bio()[ Upstream commit b7d0a97b28083084ebdd8e5c6bccd12e6ec18faa ]
There's issue as follows when concurrently installing the f2fs.ko
module and mounting the f2fs file system:
KASAN: null-ptr-deref in range [0x0000000000000020-0x0000000000000027]
RIP: 0010:\_\_bio\_alloc+0x2fb/0x6c0 [f2fs]
Call Trace:
<TASK>
f2fs\_submit\_page\_bio+0x126/0x8b0 [f2fs]
\_\_get\_meta\_page+0x1d4/0x920 [f2fs]
get\_checkpoint\_version.constprop.0+0x2b/0x3c0 [f2fs]
validate\_checkpoint+0xac/0x290 [f2fs]
f2fs\_get\_valid\_checkpoint+0x207/0x950 [f2fs]
f2fs\_fill\_super+0x1007/0x39b0 [f2fs]
mount\_bdev+0x183/0x250
legacy\_get\_tree+0xf4/0x1e0
vfs\_get\_tree+0x88/0x340
do\_new\_mount+0x283/0x5e0
path\_mount+0x2b2/0x15b0
\_\_x64\_sys\_mount+0x1fe/0x270
do\_syscall\_64+0x5f/0x170
entry\_SYSCALL\_64\_after\_hwframe+0x76/0x7e
Above issue happens as the biset of the f2fs file system is not
initialized before register "f2fs\_fs\_type".
To address above issue just register "f2fs\_fs\_type" at the last in
init\_f2fs\_fs(). Ensure that all f2fs file system resources are
initialized.
Fixes: f543805fcd60 ("f2fs: introduce private bioset")
Signed-off-by: Ye Bin <yebin10@huawei.com>
Reviewed-by: Chao Yu <chao@kernel.org>
Signed-off-by: Jaegeuk Kim <jaegeuk@kernel.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=9e11b1d5fda972f6be60ab732976a7c8e064cd56)

| -rw-r--r-- | [fs/f2fs/super.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/fs/f2fs/super.c?id=9e11b1d5fda972f6be60ab732976a7c8e064cd56) | 12 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 6 insertions, 6 deletions

| diff --git a/fs/f2fs/super.c b/fs/f2fs/super.cindex 87ab5696bd482c..8d4ecb2e855e67 100644--- a/[fs/f2fs/super.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/f2fs/super.c?id=a26ace3c6efe3da38a8e388b2a04519065513a70)+++ b/[fs/f2fs/super.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/f2fs/super.c?id=9e11b1d5fda972f6be60ab732976a7c8e064cd56)@@ -4991,9 +4991,6 @@ static int \_\_init init\_f2fs\_fs(void) err = f2fs\_init\_shrinker(); if (err) goto free\_sysfs;- err = register\_filesystem(&f2fs\_fs\_type);- if (err)- goto free\_shrinker; f2fs\_create\_root\_stats(); err = f2fs\_init\_post\_read\_processing(); if (err)@@ -5016,7 +5013,12 @@ static int \_\_init init\_f2fs\_fs(void) err = f2fs\_create\_casefold\_cache(); if (err) goto free\_compress\_cache;+ err = register\_filesystem(&f2fs\_fs\_type);+ if (err)+ goto free\_casefold\_cache; return 0;+free\_casefold\_cache:+ f2fs\_destroy\_casefold\_cache(); free\_compress\_cache: f2fs\_destroy\_compress\_cache(); free\_compress\_mempool:@@ -5031,8 +5033,6 @@ free\_post\_read: f2fs\_destroy\_post\_read\_processing(); free\_root\_stats: f2fs\_destroy\_root\_stats();- unregister\_filesystem(&f2fs\_fs\_type);-free\_shrinker: f2fs\_exit\_shrinker(); free\_sysfs: f2fs\_exit\_sysfs();@@ -5056,6 +5056,7 @@ fail:  static void \_\_exit exit\_f2fs\_fs(void) {+ unregister\_filesystem(&f2fs\_fs\_type); f2fs\_destroy\_casefold\_cache(); f2fs\_destroy\_compress\_cache(); f2fs\_destroy\_compress\_mempool();@@ -5064,7 +5065,6 @@ static void \_\_exit exit\_f2fs\_fs(void) f2fs\_destroy\_iostat\_processing(); f2fs\_destroy\_post\_read\_processing(); f2fs\_destroy\_root\_stats();- unregister\_filesystem(&f2fs\_fs\_type); f2fs\_exit\_shrinker(); f2fs\_exit\_sysfs(); f2fs\_destroy\_garbage\_collection\_cache(); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 22:08:27 +0000



=== Content from git.kernel.org_895a2b94_20250114_220950.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=32f5e291b7677495f98246eec573767430321c08)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=32f5e291b7677495f98246eec573767430321c08)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=32f5e291b7677495f98246eec573767430321c08)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=32f5e291b7677495f98246eec573767430321c08)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Ye Bin <yebin10@huawei.com> | 2024-10-12 00:44:50 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-05 13:53:46 +0100 |
| commit | [32f5e291b7677495f98246eec573767430321c08](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=32f5e291b7677495f98246eec573767430321c08) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=32f5e291b7677495f98246eec573767430321c08)) | |
| tree | [e0e8c18db4cfe2aa999777011837b07b6b738c85](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=32f5e291b7677495f98246eec573767430321c08) | |
| parent | [9073773005e3f40d36918c3aa13a7c72fca12bf6](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=9073773005e3f40d36918c3aa13a7c72fca12bf6) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=32f5e291b7677495f98246eec573767430321c08&id2=9073773005e3f40d36918c3aa13a7c72fca12bf6)) | |
| download | [linux-32f5e291b7677495f98246eec573767430321c08.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-32f5e291b7677495f98246eec573767430321c08.tar.gz) | |

f2fs: fix null-ptr-deref in f2fs\_submit\_page\_bio()[ Upstream commit b7d0a97b28083084ebdd8e5c6bccd12e6ec18faa ]
There's issue as follows when concurrently installing the f2fs.ko
module and mounting the f2fs file system:
KASAN: null-ptr-deref in range [0x0000000000000020-0x0000000000000027]
RIP: 0010:\_\_bio\_alloc+0x2fb/0x6c0 [f2fs]
Call Trace:
<TASK>
f2fs\_submit\_page\_bio+0x126/0x8b0 [f2fs]
\_\_get\_meta\_page+0x1d4/0x920 [f2fs]
get\_checkpoint\_version.constprop.0+0x2b/0x3c0 [f2fs]
validate\_checkpoint+0xac/0x290 [f2fs]
f2fs\_get\_valid\_checkpoint+0x207/0x950 [f2fs]
f2fs\_fill\_super+0x1007/0x39b0 [f2fs]
mount\_bdev+0x183/0x250
legacy\_get\_tree+0xf4/0x1e0
vfs\_get\_tree+0x88/0x340
do\_new\_mount+0x283/0x5e0
path\_mount+0x2b2/0x15b0
\_\_x64\_sys\_mount+0x1fe/0x270
do\_syscall\_64+0x5f/0x170
entry\_SYSCALL\_64\_after\_hwframe+0x76/0x7e
Above issue happens as the biset of the f2fs file system is not
initialized before register "f2fs\_fs\_type".
To address above issue just register "f2fs\_fs\_type" at the last in
init\_f2fs\_fs(). Ensure that all f2fs file system resources are
initialized.
Fixes: f543805fcd60 ("f2fs: introduce private bioset")
Signed-off-by: Ye Bin <yebin10@huawei.com>
Reviewed-by: Chao Yu <chao@kernel.org>
Signed-off-by: Jaegeuk Kim <jaegeuk@kernel.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=32f5e291b7677495f98246eec573767430321c08)

| -rw-r--r-- | [fs/f2fs/super.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/fs/f2fs/super.c?id=32f5e291b7677495f98246eec573767430321c08) | 12 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 6 insertions, 6 deletions

| diff --git a/fs/f2fs/super.c b/fs/f2fs/super.cindex 0f6e2b3f6a4c51..615ca1f0ef59ba 100644--- a/[fs/f2fs/super.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/f2fs/super.c?id=9073773005e3f40d36918c3aa13a7c72fca12bf6)+++ b/[fs/f2fs/super.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/f2fs/super.c?id=32f5e291b7677495f98246eec573767430321c08)@@ -4972,9 +4972,6 @@ static int \_\_init init\_f2fs\_fs(void) err = f2fs\_init\_shrinker(); if (err) goto free\_sysfs;- err = register\_filesystem(&f2fs\_fs\_type);- if (err)- goto free\_shrinker; f2fs\_create\_root\_stats(); err = f2fs\_init\_post\_read\_processing(); if (err)@@ -4997,7 +4994,12 @@ static int \_\_init init\_f2fs\_fs(void) err = f2fs\_create\_casefold\_cache(); if (err) goto free\_compress\_cache;+ err = register\_filesystem(&f2fs\_fs\_type);+ if (err)+ goto free\_casefold\_cache; return 0;+free\_casefold\_cache:+ f2fs\_destroy\_casefold\_cache(); free\_compress\_cache: f2fs\_destroy\_compress\_cache(); free\_compress\_mempool:@@ -5012,8 +5014,6 @@ free\_post\_read: f2fs\_destroy\_post\_read\_processing(); free\_root\_stats: f2fs\_destroy\_root\_stats();- unregister\_filesystem(&f2fs\_fs\_type);-free\_shrinker: f2fs\_exit\_shrinker(); free\_sysfs: f2fs\_exit\_sysfs();@@ -5037,6 +5037,7 @@ fail:  static void \_\_exit exit\_f2fs\_fs(void) {+ unregister\_filesystem(&f2fs\_fs\_type); f2fs\_destroy\_casefold\_cache(); f2fs\_destroy\_compress\_cache(); f2fs\_destroy\_compress\_mempool();@@ -5045,7 +5046,6 @@ static void \_\_exit exit\_f2fs\_fs(void) f2fs\_destroy\_iostat\_processing(); f2fs\_destroy\_post\_read\_processing(); f2fs\_destroy\_root\_stats();- unregister\_filesystem(&f2fs\_fs\_type); f2fs\_exit\_shrinker(); f2fs\_exit\_sysfs(); f2fs\_destroy\_garbage\_collection\_cache(); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 22:08:27 +0000



=== Content from git.kernel.org_bc00b6ac_20250114_220951.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=b7d0a97b28083084ebdd8e5c6bccd12e6ec18faa)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=b7d0a97b28083084ebdd8e5c6bccd12e6ec18faa)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=b7d0a97b28083084ebdd8e5c6bccd12e6ec18faa)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b7d0a97b28083084ebdd8e5c6bccd12e6ec18faa)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Ye Bin <yebin10@huawei.com> | 2024-10-12 00:44:50 +0800 |
| --- | --- | --- |
| committer | Jaegeuk Kim <jaegeuk@kernel.org> | 2024-10-14 20:04:57 +0000 |
| commit | [b7d0a97b28083084ebdd8e5c6bccd12e6ec18faa](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=b7d0a97b28083084ebdd8e5c6bccd12e6ec18faa) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=b7d0a97b28083084ebdd8e5c6bccd12e6ec18faa)) | |
| tree | [a586ede1c07d756080310e992d437a6b906eb0e2](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=b7d0a97b28083084ebdd8e5c6bccd12e6ec18faa) | |
| parent | [d5c367ef8287fb4d235c46a2f8c8d68715f3a0ca](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=d5c367ef8287fb4d235c46a2f8c8d68715f3a0ca) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b7d0a97b28083084ebdd8e5c6bccd12e6ec18faa&id2=d5c367ef8287fb4d235c46a2f8c8d68715f3a0ca)) | |
| download | [linux-b7d0a97b28083084ebdd8e5c6bccd12e6ec18faa.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-b7d0a97b28083084ebdd8e5c6bccd12e6ec18faa.tar.gz) | |

f2fs: fix null-ptr-deref in f2fs\_submit\_page\_bio()There's issue as follows when concurrently installing the f2fs.ko
module and mounting the f2fs file system:
KASAN: null-ptr-deref in range [0x0000000000000020-0x0000000000000027]
RIP: 0010:\_\_bio\_alloc+0x2fb/0x6c0 [f2fs]
Call Trace:
<TASK>
f2fs\_submit\_page\_bio+0x126/0x8b0 [f2fs]
\_\_get\_meta\_page+0x1d4/0x920 [f2fs]
get\_checkpoint\_version.constprop.0+0x2b/0x3c0 [f2fs]
validate\_checkpoint+0xac/0x290 [f2fs]
f2fs\_get\_valid\_checkpoint+0x207/0x950 [f2fs]
f2fs\_fill\_super+0x1007/0x39b0 [f2fs]
mount\_bdev+0x183/0x250
legacy\_get\_tree+0xf4/0x1e0
vfs\_get\_tree+0x88/0x340
do\_new\_mount+0x283/0x5e0
path\_mount+0x2b2/0x15b0
\_\_x64\_sys\_mount+0x1fe/0x270
do\_syscall\_64+0x5f/0x170
entry\_SYSCALL\_64\_after\_hwframe+0x76/0x7e
Above issue happens as the biset of the f2fs file system is not
initialized before register "f2fs\_fs\_type".
To address above issue just register "f2fs\_fs\_type" at the last in
init\_f2fs\_fs(). Ensure that all f2fs file system resources are
initialized.
Fixes: f543805fcd60 ("f2fs: introduce private bioset")
Signed-off-by: Ye Bin <yebin10@huawei.com>
Reviewed-by: Chao Yu <chao@kernel.org>
Signed-off-by: Jaegeuk Kim <jaegeuk@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b7d0a97b28083084ebdd8e5c6bccd12e6ec18faa)

| -rw-r--r-- | [fs/f2fs/super.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/fs/f2fs/super.c?id=b7d0a97b28083084ebdd8e5c6bccd12e6ec18faa) | 12 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 6 insertions, 6 deletions

| diff --git a/fs/f2fs/super.c b/fs/f2fs/super.cindex 87ab5696bd482c..8d4ecb2e855e67 100644--- a/[fs/f2fs/super.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/f2fs/super.c?id=d5c367ef8287fb4d235c46a2f8c8d68715f3a0ca)+++ b/[fs/f2fs/super.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/f2fs/super.c?id=b7d0a97b28083084ebdd8e5c6bccd12e6ec18faa)@@ -4991,9 +4991,6 @@ static int \_\_init init\_f2fs\_fs(void) err = f2fs\_init\_shrinker(); if (err) goto free\_sysfs;- err = register\_filesystem(&f2fs\_fs\_type);- if (err)- goto free\_shrinker; f2fs\_create\_root\_stats(); err = f2fs\_init\_post\_read\_processing(); if (err)@@ -5016,7 +5013,12 @@ static int \_\_init init\_f2fs\_fs(void) err = f2fs\_create\_casefold\_cache(); if (err) goto free\_compress\_cache;+ err = register\_filesystem(&f2fs\_fs\_type);+ if (err)+ goto free\_casefold\_cache; return 0;+free\_casefold\_cache:+ f2fs\_destroy\_casefold\_cache(); free\_compress\_cache: f2fs\_destroy\_compress\_cache(); free\_compress\_mempool:@@ -5031,8 +5033,6 @@ free\_post\_read: f2fs\_destroy\_post\_read\_processing(); free\_root\_stats: f2fs\_destroy\_root\_stats();- unregister\_filesystem(&f2fs\_fs\_type);-free\_shrinker: f2fs\_exit\_shrinker(); free\_sysfs: f2fs\_exit\_sysfs();@@ -5056,6 +5056,7 @@ fail:  static void \_\_exit exit\_f2fs\_fs(void) {+ unregister\_filesystem(&f2fs\_fs\_type); f2fs\_destroy\_casefold\_cache(); f2fs\_destroy\_compress\_cache(); f2fs\_destroy\_compress\_mempool();@@ -5064,7 +5065,6 @@ static void \_\_exit exit\_f2fs\_fs(void) f2fs\_destroy\_iostat\_processing(); f2fs\_destroy\_post\_read\_processing(); f2fs\_destroy\_root\_stats();- unregister\_filesystem(&f2fs\_fs\_type); f2fs\_exit\_shrinker(); f2fs\_exit\_sysfs(); f2fs\_destroy\_garbage\_collection\_cache(); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 22:08:28 +0000


