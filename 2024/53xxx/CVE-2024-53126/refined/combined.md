=== Content from git.kernel.org_c7a56914_20250115_102533.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=0b364cf53b20204e92bac7c6ebd1ee7d3ec62931)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=0b364cf53b20204e92bac7c6ebd1ee7d3ec62931)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=0b364cf53b20204e92bac7c6ebd1ee7d3ec62931)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=0b364cf53b20204e92bac7c6ebd1ee7d3ec62931)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Philipp Stanner <pstanner@redhat.com> | 2024-10-28 08:43:59 +0100 |
| --- | --- | --- |
| committer | Michael S. Tsirkin <mst@redhat.com> | 2024-11-06 04:40:07 -0500 |
| commit | [0b364cf53b20204e92bac7c6ebd1ee7d3ec62931](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=0b364cf53b20204e92bac7c6ebd1ee7d3ec62931) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=0b364cf53b20204e92bac7c6ebd1ee7d3ec62931)) | |
| tree | [5a1b30274b55aaffee970c1843aca06f31a94542](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=0b364cf53b20204e92bac7c6ebd1ee7d3ec62931) | |
| parent | [6ca575374dd9a507cdd16dfa0e78c2e9e20bd05f](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=6ca575374dd9a507cdd16dfa0e78c2e9e20bd05f) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=0b364cf53b20204e92bac7c6ebd1ee7d3ec62931&id2=6ca575374dd9a507cdd16dfa0e78c2e9e20bd05f)) | |
| download | [linux-0b364cf53b20204e92bac7c6ebd1ee7d3ec62931.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-0b364cf53b20204e92bac7c6ebd1ee7d3ec62931.tar.gz) | |

vdpa: solidrun: Fix UB bug with devresIn psnet\_open\_pf\_bar() and snet\_open\_vf\_bar() a string later passed to
pcim\_iomap\_regions() is placed on the stack. Neither
pcim\_iomap\_regions() nor the functions it calls copy that string.
Should the string later ever be used, this, consequently, causes
undefined behavior since the stack frame will by then have disappeared.
Fix the bug by allocating the strings on the heap through
devm\_kasprintf().
Cc: stable@vger.kernel.org # v6.3
Fixes: 51a8f9d7f587 ("virtio: vdpa: new SolidNET DPU driver.")
Reported-by: Christophe JAILLET <christophe.jaillet@wanadoo.fr>
Closes: https://lore.kernel.org/all/74e9109a-ac59-49e2-9b1d-d825c9c9f891@wanadoo.fr/
Suggested-by: Andy Shevchenko <andy@kernel.org>
Signed-off-by: Philipp Stanner <pstanner@redhat.com>
Reviewed-by: Stefano Garzarella <sgarzare@redhat.com>
Message-Id: <20241028074357.9104-3-pstanner@redhat.com>
Signed-off-by: Michael S. Tsirkin <mst@redhat.com>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=0b364cf53b20204e92bac7c6ebd1ee7d3ec62931)

| -rw-r--r-- | [drivers/vdpa/solidrun/snet\_main.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/vdpa/solidrun/snet_main.c?id=0b364cf53b20204e92bac7c6ebd1ee7d3ec62931) | 14 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 10 insertions, 4 deletions

| diff --git a/drivers/vdpa/solidrun/snet\_main.c b/drivers/vdpa/solidrun/snet\_main.cindex 99428a04068d2d..c8b74980dbd172 100644--- a/[drivers/vdpa/solidrun/snet\_main.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/vdpa/solidrun/snet_main.c?id=6ca575374dd9a507cdd16dfa0e78c2e9e20bd05f)+++ b/[drivers/vdpa/solidrun/snet\_main.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/vdpa/solidrun/snet_main.c?id=0b364cf53b20204e92bac7c6ebd1ee7d3ec62931)@@ -555,7 +555,7 @@ static const struct vdpa\_config\_ops snet\_config\_ops = {  static int psnet\_open\_pf\_bar(struct pci\_dev \*pdev, struct psnet \*psnet) {- char name[50];+ char \*name; int ret, i, mask = 0; /\* We don't know which BAR will be used to communicate.. \* We will map every bar with len > 0.@@ -573,7 +573,10 @@ static int psnet\_open\_pf\_bar(struct pci\_dev \*pdev, struct psnet \*psnet) return -ENODEV; } - snprintf(name, sizeof(name), "psnet[%s]-bars", pci\_name(pdev));+ name = devm\_kasprintf(&pdev->dev, GFP\_KERNEL, "psnet[%s]-bars", pci\_name(pdev));+ if (!name)+ return -ENOMEM;+ ret = pcim\_iomap\_regions(pdev, mask, name); if (ret) { SNET\_ERR(pdev, "Failed to request and map PCI BARs\n");@@ -590,10 +593,13 @@ static int psnet\_open\_pf\_bar(struct pci\_dev \*pdev, struct psnet \*psnet)  static int snet\_open\_vf\_bar(struct pci\_dev \*pdev, struct snet \*snet) {- char name[50];+ char \*name; int ret; - snprintf(name, sizeof(name), "snet[%s]-bar", pci\_name(pdev));+ name = devm\_kasprintf(&pdev->dev, GFP\_KERNEL, "snet[%s]-bars", pci\_name(pdev));+ if (!name)+ return -ENOMEM;+ /\* Request and map BAR \*/ ret = pcim\_iomap\_regions(pdev, BIT(snet->psnet->cfg.vf\_bar), name); if (ret) { |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-15 10:24:10 +0000



=== Content from git.kernel.org_3306b801_20250115_102534.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=d372dd09cfbf1324f54cbffd81fcaf6cdf3e608e)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=d372dd09cfbf1324f54cbffd81fcaf6cdf3e608e)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=d372dd09cfbf1324f54cbffd81fcaf6cdf3e608e)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=d372dd09cfbf1324f54cbffd81fcaf6cdf3e608e)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Philipp Stanner <pstanner@redhat.com> | 2024-10-28 08:43:59 +0100 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-11-22 15:38:33 +0100 |
| commit | [d372dd09cfbf1324f54cbffd81fcaf6cdf3e608e](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=d372dd09cfbf1324f54cbffd81fcaf6cdf3e608e) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=d372dd09cfbf1324f54cbffd81fcaf6cdf3e608e)) | |
| tree | [c2c388d6d3728e5f129002c21be8c26c6f143b3d](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=d372dd09cfbf1324f54cbffd81fcaf6cdf3e608e) | |
| parent | [64e67e8694252c1bf01b802ee911be3fee62c36b](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=64e67e8694252c1bf01b802ee911be3fee62c36b) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=d372dd09cfbf1324f54cbffd81fcaf6cdf3e608e&id2=64e67e8694252c1bf01b802ee911be3fee62c36b)) | |
| download | [linux-d372dd09cfbf1324f54cbffd81fcaf6cdf3e608e.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-d372dd09cfbf1324f54cbffd81fcaf6cdf3e608e.tar.gz) | |

vdpa: solidrun: Fix UB bug with devrescommit 0b364cf53b20204e92bac7c6ebd1ee7d3ec62931 upstream.
In psnet\_open\_pf\_bar() and snet\_open\_vf\_bar() a string later passed to
pcim\_iomap\_regions() is placed on the stack. Neither
pcim\_iomap\_regions() nor the functions it calls copy that string.
Should the string later ever be used, this, consequently, causes
undefined behavior since the stack frame will by then have disappeared.
Fix the bug by allocating the strings on the heap through
devm\_kasprintf().
Cc: stable@vger.kernel.org # v6.3
Fixes: 51a8f9d7f587 ("virtio: vdpa: new SolidNET DPU driver.")
Reported-by: Christophe JAILLET <christophe.jaillet@wanadoo.fr>
Closes: https://lore.kernel.org/all/74e9109a-ac59-49e2-9b1d-d825c9c9f891@wanadoo.fr/
Suggested-by: Andy Shevchenko <andy@kernel.org>
Signed-off-by: Philipp Stanner <pstanner@redhat.com>
Reviewed-by: Stefano Garzarella <sgarzare@redhat.com>
Message-Id: <20241028074357.9104-3-pstanner@redhat.com>
Signed-off-by: Michael S. Tsirkin <mst@redhat.com>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=d372dd09cfbf1324f54cbffd81fcaf6cdf3e608e)

| -rw-r--r-- | [drivers/vdpa/solidrun/snet\_main.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/vdpa/solidrun/snet_main.c?id=d372dd09cfbf1324f54cbffd81fcaf6cdf3e608e) | 14 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 10 insertions, 4 deletions

| diff --git a/drivers/vdpa/solidrun/snet\_main.c b/drivers/vdpa/solidrun/snet\_main.cindex 99428a04068d2d..c8b74980dbd172 100644--- a/[drivers/vdpa/solidrun/snet\_main.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/vdpa/solidrun/snet_main.c?id=64e67e8694252c1bf01b802ee911be3fee62c36b)+++ b/[drivers/vdpa/solidrun/snet\_main.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/vdpa/solidrun/snet_main.c?id=d372dd09cfbf1324f54cbffd81fcaf6cdf3e608e)@@ -555,7 +555,7 @@ static const struct vdpa\_config\_ops snet\_config\_ops = {  static int psnet\_open\_pf\_bar(struct pci\_dev \*pdev, struct psnet \*psnet) {- char name[50];+ char \*name; int ret, i, mask = 0; /\* We don't know which BAR will be used to communicate.. \* We will map every bar with len > 0.@@ -573,7 +573,10 @@ static int psnet\_open\_pf\_bar(struct pci\_dev \*pdev, struct psnet \*psnet) return -ENODEV; } - snprintf(name, sizeof(name), "psnet[%s]-bars", pci\_name(pdev));+ name = devm\_kasprintf(&pdev->dev, GFP\_KERNEL, "psnet[%s]-bars", pci\_name(pdev));+ if (!name)+ return -ENOMEM;+ ret = pcim\_iomap\_regions(pdev, mask, name); if (ret) { SNET\_ERR(pdev, "Failed to request and map PCI BARs\n");@@ -590,10 +593,13 @@ static int psnet\_open\_pf\_bar(struct pci\_dev \*pdev, struct psnet \*psnet)  static int snet\_open\_vf\_bar(struct pci\_dev \*pdev, struct snet \*snet) {- char name[50];+ char \*name; int ret; - snprintf(name, sizeof(name), "snet[%s]-bar", pci\_name(pdev));+ name = devm\_kasprintf(&pdev->dev, GFP\_KERNEL, "snet[%s]-bars", pci\_name(pdev));+ if (!name)+ return -ENOMEM;+ /\* Request and map BAR \*/ ret = pcim\_iomap\_regions(pdev, BIT(snet->psnet->cfg.vf\_bar), name); if (ret) { |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-15 10:24:11 +0000



=== Content from git.kernel.org_bd8ea5b4_20250115_102534.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=5bb287da2d2d5bb8f7376e223b02edb16998982e)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=5bb287da2d2d5bb8f7376e223b02edb16998982e)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=5bb287da2d2d5bb8f7376e223b02edb16998982e)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=5bb287da2d2d5bb8f7376e223b02edb16998982e)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Philipp Stanner <pstanner@redhat.com> | 2024-10-28 08:43:59 +0100 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-11-22 15:39:51 +0100 |
| commit | [5bb287da2d2d5bb8f7376e223b02edb16998982e](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=5bb287da2d2d5bb8f7376e223b02edb16998982e) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=5bb287da2d2d5bb8f7376e223b02edb16998982e)) | |
| tree | [243a6c369b103b1d3b9bd9182b26750c2e8c8df8](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=5bb287da2d2d5bb8f7376e223b02edb16998982e) | |
| parent | [901dc2ad7c3789fa87dc3956f6697c5d62d5cf7e](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=901dc2ad7c3789fa87dc3956f6697c5d62d5cf7e) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=5bb287da2d2d5bb8f7376e223b02edb16998982e&id2=901dc2ad7c3789fa87dc3956f6697c5d62d5cf7e)) | |
| download | [linux-5bb287da2d2d5bb8f7376e223b02edb16998982e.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-5bb287da2d2d5bb8f7376e223b02edb16998982e.tar.gz) | |

vdpa: solidrun: Fix UB bug with devrescommit 0b364cf53b20204e92bac7c6ebd1ee7d3ec62931 upstream.
In psnet\_open\_pf\_bar() and snet\_open\_vf\_bar() a string later passed to
pcim\_iomap\_regions() is placed on the stack. Neither
pcim\_iomap\_regions() nor the functions it calls copy that string.
Should the string later ever be used, this, consequently, causes
undefined behavior since the stack frame will by then have disappeared.
Fix the bug by allocating the strings on the heap through
devm\_kasprintf().
Cc: stable@vger.kernel.org # v6.3
Fixes: 51a8f9d7f587 ("virtio: vdpa: new SolidNET DPU driver.")
Reported-by: Christophe JAILLET <christophe.jaillet@wanadoo.fr>
Closes: https://lore.kernel.org/all/74e9109a-ac59-49e2-9b1d-d825c9c9f891@wanadoo.fr/
Suggested-by: Andy Shevchenko <andy@kernel.org>
Signed-off-by: Philipp Stanner <pstanner@redhat.com>
Reviewed-by: Stefano Garzarella <sgarzare@redhat.com>
Message-Id: <20241028074357.9104-3-pstanner@redhat.com>
Signed-off-by: Michael S. Tsirkin <mst@redhat.com>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=5bb287da2d2d5bb8f7376e223b02edb16998982e)

| -rw-r--r-- | [drivers/vdpa/solidrun/snet\_main.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/vdpa/solidrun/snet_main.c?id=5bb287da2d2d5bb8f7376e223b02edb16998982e) | 14 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 10 insertions, 4 deletions

| diff --git a/drivers/vdpa/solidrun/snet\_main.c b/drivers/vdpa/solidrun/snet\_main.cindex 99428a04068d2d..c8b74980dbd172 100644--- a/[drivers/vdpa/solidrun/snet\_main.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/vdpa/solidrun/snet_main.c?id=901dc2ad7c3789fa87dc3956f6697c5d62d5cf7e)+++ b/[drivers/vdpa/solidrun/snet\_main.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/vdpa/solidrun/snet_main.c?id=5bb287da2d2d5bb8f7376e223b02edb16998982e)@@ -555,7 +555,7 @@ static const struct vdpa\_config\_ops snet\_config\_ops = {  static int psnet\_open\_pf\_bar(struct pci\_dev \*pdev, struct psnet \*psnet) {- char name[50];+ char \*name; int ret, i, mask = 0; /\* We don't know which BAR will be used to communicate.. \* We will map every bar with len > 0.@@ -573,7 +573,10 @@ static int psnet\_open\_pf\_bar(struct pci\_dev \*pdev, struct psnet \*psnet) return -ENODEV; } - snprintf(name, sizeof(name), "psnet[%s]-bars", pci\_name(pdev));+ name = devm\_kasprintf(&pdev->dev, GFP\_KERNEL, "psnet[%s]-bars", pci\_name(pdev));+ if (!name)+ return -ENOMEM;+ ret = pcim\_iomap\_regions(pdev, mask, name); if (ret) { SNET\_ERR(pdev, "Failed to request and map PCI BARs\n");@@ -590,10 +593,13 @@ static int psnet\_open\_pf\_bar(struct pci\_dev \*pdev, struct psnet \*psnet)  static int snet\_open\_vf\_bar(struct pci\_dev \*pdev, struct snet \*snet) {- char name[50];+ char \*name; int ret; - snprintf(name, sizeof(name), "snet[%s]-bar", pci\_name(pdev));+ name = devm\_kasprintf(&pdev->dev, GFP\_KERNEL, "snet[%s]-bars", pci\_name(pdev));+ if (!name)+ return -ENOMEM;+ /\* Request and map BAR \*/ ret = pcim\_iomap\_regions(pdev, BIT(snet->psnet->cfg.vf\_bar), name); if (ret) { |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-15 10:24:11 +0000


