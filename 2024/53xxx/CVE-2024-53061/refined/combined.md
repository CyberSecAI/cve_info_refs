=== Content from git.kernel.org_34245adc_20250114_201106.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=f54e8e1e39dacccebcfb9a9a36f0552a0a97e2ef)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=f54e8e1e39dacccebcfb9a9a36f0552a0a97e2ef)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=f54e8e1e39dacccebcfb9a9a36f0552a0a97e2ef)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=f54e8e1e39dacccebcfb9a9a36f0552a0a97e2ef)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Mauro Carvalho Chehab <mchehab+huawei@kernel.org> | 2024-10-15 11:10:31 +0200 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-11-17 14:59:36 +0100 |
| commit | [f54e8e1e39dacccebcfb9a9a36f0552a0a97e2ef](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=f54e8e1e39dacccebcfb9a9a36f0552a0a97e2ef) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=f54e8e1e39dacccebcfb9a9a36f0552a0a97e2ef)) | |
| tree | [fed817e1c5e8bea1ad0a591dacf8de73379d9473](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=f54e8e1e39dacccebcfb9a9a36f0552a0a97e2ef) | |
| parent | [3a977b554f668382dfba31fd62e4cce4fe5643db](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=3a977b554f668382dfba31fd62e4cce4fe5643db) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=f54e8e1e39dacccebcfb9a9a36f0552a0a97e2ef&id2=3a977b554f668382dfba31fd62e4cce4fe5643db)) | |
| download | [linux-f54e8e1e39dacccebcfb9a9a36f0552a0a97e2ef.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-f54e8e1e39dacccebcfb9a9a36f0552a0a97e2ef.tar.gz) | |

media: s5p-jpeg: prevent buffer overflowscommit 14a22762c3daeac59a5a534e124acbb4d7a79b3a upstream.
The current logic allows word to be less than 2. If this happens,
there will be buffer overflows, as reported by smatch. Add extra
checks to prevent it.
While here, remove an unused word = 0 assignment.
Fixes: 6c96dbbc2aa9 ("[media] s5p-jpeg: add support for 5433")
Cc: stable@vger.kernel.org
Signed-off-by: Mauro Carvalho Chehab <mchehab+huawei@kernel.org>
Reviewed-by: Jacek Anaszewski <jacek.anaszewski@gmail.com>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=f54e8e1e39dacccebcfb9a9a36f0552a0a97e2ef)

| -rw-r--r-- | [drivers/media/platform/s5p-jpeg/jpeg-core.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/media/platform/s5p-jpeg/jpeg-core.c?id=f54e8e1e39dacccebcfb9a9a36f0552a0a97e2ef) | 17 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 11 insertions, 6 deletions

| diff --git a/drivers/media/platform/s5p-jpeg/jpeg-core.c b/drivers/media/platform/s5p-jpeg/jpeg-core.cindex d515eb08c3ee47..55d0ba45a970ce 100644--- a/[drivers/media/platform/s5p-jpeg/jpeg-core.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/media/platform/s5p-jpeg/jpeg-core.c?id=3a977b554f668382dfba31fd62e4cce4fe5643db)+++ b/[drivers/media/platform/s5p-jpeg/jpeg-core.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/media/platform/s5p-jpeg/jpeg-core.c?id=f54e8e1e39dacccebcfb9a9a36f0552a0a97e2ef)@@ -775,11 +775,14 @@ static void exynos4\_jpeg\_parse\_decode\_h\_tbl(struct s5p\_jpeg\_ctx \*ctx) (unsigned long)vb2\_plane\_vaddr(&vb->vb2\_buf, 0) + ctx->out\_q.sos + 2; jpeg\_buffer.curr = 0; - word = 0;- if (get\_word\_be(&jpeg\_buffer, &word)) return;- jpeg\_buffer.size = (long)word - 2;++ if (word < 2)+ jpeg\_buffer.size = 0;+ else+ jpeg\_buffer.size = (long)word - 2;+ jpeg\_buffer.data += 2; jpeg\_buffer.curr = 0; @@ -1058,6 +1061,7 @@ static int get\_word\_be(struct s5p\_jpeg\_buffer \*buf, unsigned int \*word) if (byte == -1) return -1; \*word = (unsigned int)byte | temp;+ return 0; } @@ -1145,7 +1149,7 @@ static bool s5p\_jpeg\_parse\_hdr(struct s5p\_jpeg\_q\_data \*result, if (get\_word\_be(&jpeg\_buffer, &word)) break; length = (long)word - 2;- if (!length)+ if (length <= 0) return false; sof = jpeg\_buffer.curr; /\* after 0xffc0 \*/ sof\_len = length;@@ -1176,7 +1180,7 @@ static bool s5p\_jpeg\_parse\_hdr(struct s5p\_jpeg\_q\_data \*result, if (get\_word\_be(&jpeg\_buffer, &word)) break; length = (long)word - 2;- if (!length)+ if (length <= 0) return false; if (n\_dqt >= S5P\_JPEG\_MAX\_MARKER) return false;@@ -1189,7 +1193,7 @@ static bool s5p\_jpeg\_parse\_hdr(struct s5p\_jpeg\_q\_data \*result, if (get\_word\_be(&jpeg\_buffer, &word)) break; length = (long)word - 2;- if (!length)+ if (length <= 0) return false; if (n\_dht >= S5P\_JPEG\_MAX\_MARKER) return false;@@ -1214,6 +1218,7 @@ static bool s5p\_jpeg\_parse\_hdr(struct s5p\_jpeg\_q\_data \*result, if (get\_word\_be(&jpeg\_buffer, &word)) break; length = (long)word - 2;+ /\* No need to check underflows as skip() does it \*/ skip(&jpeg\_buffer, length); break; } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 20:09:43 +0000



=== Content from git.kernel.org_a195a2c7_20250114_201100.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=784bc785a453eb2f8433dd62075befdfa1b2d6fd)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=784bc785a453eb2f8433dd62075befdfa1b2d6fd)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=784bc785a453eb2f8433dd62075befdfa1b2d6fd)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=784bc785a453eb2f8433dd62075befdfa1b2d6fd)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Mauro Carvalho Chehab <mchehab+huawei@kernel.org> | 2024-10-15 11:10:31 +0200 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-11-14 13:19:34 +0100 |
| commit | [784bc785a453eb2f8433dd62075befdfa1b2d6fd](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=784bc785a453eb2f8433dd62075befdfa1b2d6fd) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=784bc785a453eb2f8433dd62075befdfa1b2d6fd)) | |
| tree | [2f86df03484e1cb2d03dbb8f349dd82615f9ef7e](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=784bc785a453eb2f8433dd62075befdfa1b2d6fd) | |
| parent | [a244b82d0ae60326901f2b50c15e3118298b7ecd](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=a244b82d0ae60326901f2b50c15e3118298b7ecd) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=784bc785a453eb2f8433dd62075befdfa1b2d6fd&id2=a244b82d0ae60326901f2b50c15e3118298b7ecd)) | |
| download | [linux-784bc785a453eb2f8433dd62075befdfa1b2d6fd.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-784bc785a453eb2f8433dd62075befdfa1b2d6fd.tar.gz) | |

media: s5p-jpeg: prevent buffer overflowscommit 14a22762c3daeac59a5a534e124acbb4d7a79b3a upstream.
The current logic allows word to be less than 2. If this happens,
there will be buffer overflows, as reported by smatch. Add extra
checks to prevent it.
While here, remove an unused word = 0 assignment.
Fixes: 6c96dbbc2aa9 ("[media] s5p-jpeg: add support for 5433")
Cc: stable@vger.kernel.org
Signed-off-by: Mauro Carvalho Chehab <mchehab+huawei@kernel.org>
Reviewed-by: Jacek Anaszewski <jacek.anaszewski@gmail.com>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=784bc785a453eb2f8433dd62075befdfa1b2d6fd)

| -rw-r--r-- | [drivers/media/platform/samsung/s5p-jpeg/jpeg-core.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/media/platform/samsung/s5p-jpeg/jpeg-core.c?id=784bc785a453eb2f8433dd62075befdfa1b2d6fd) | 17 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 11 insertions, 6 deletions

| diff --git a/drivers/media/platform/samsung/s5p-jpeg/jpeg-core.c b/drivers/media/platform/samsung/s5p-jpeg/jpeg-core.cindex d2c4a0178b3c5c..1db4609b35574f 100644--- a/[drivers/media/platform/samsung/s5p-jpeg/jpeg-core.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/media/platform/samsung/s5p-jpeg/jpeg-core.c?id=a244b82d0ae60326901f2b50c15e3118298b7ecd)+++ b/[drivers/media/platform/samsung/s5p-jpeg/jpeg-core.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/media/platform/samsung/s5p-jpeg/jpeg-core.c?id=784bc785a453eb2f8433dd62075befdfa1b2d6fd)@@ -775,11 +775,14 @@ static void exynos4\_jpeg\_parse\_decode\_h\_tbl(struct s5p\_jpeg\_ctx \*ctx) (unsigned long)vb2\_plane\_vaddr(&vb->vb2\_buf, 0) + ctx->out\_q.sos + 2; jpeg\_buffer.curr = 0; - word = 0;- if (get\_word\_be(&jpeg\_buffer, &word)) return;- jpeg\_buffer.size = (long)word - 2;++ if (word < 2)+ jpeg\_buffer.size = 0;+ else+ jpeg\_buffer.size = (long)word - 2;+ jpeg\_buffer.data += 2; jpeg\_buffer.curr = 0; @@ -1058,6 +1061,7 @@ static int get\_word\_be(struct s5p\_jpeg\_buffer \*buf, unsigned int \*word) if (byte == -1) return -1; \*word = (unsigned int)byte | temp;+ return 0; } @@ -1145,7 +1149,7 @@ static bool s5p\_jpeg\_parse\_hdr(struct s5p\_jpeg\_q\_data \*result, if (get\_word\_be(&jpeg\_buffer, &word)) break; length = (long)word - 2;- if (!length)+ if (length <= 0) return false; sof = jpeg\_buffer.curr; /\* after 0xffc0 \*/ sof\_len = length;@@ -1176,7 +1180,7 @@ static bool s5p\_jpeg\_parse\_hdr(struct s5p\_jpeg\_q\_data \*result, if (get\_word\_be(&jpeg\_buffer, &word)) break; length = (long)word - 2;- if (!length)+ if (length <= 0) return false; if (n\_dqt >= S5P\_JPEG\_MAX\_MARKER) return false;@@ -1189,7 +1193,7 @@ static bool s5p\_jpeg\_parse\_hdr(struct s5p\_jpeg\_q\_data \*result, if (get\_word\_be(&jpeg\_buffer, &word)) break; length = (long)word - 2;- if (!length)+ if (length <= 0) return false; if (n\_dht >= S5P\_JPEG\_MAX\_MARKER) return false;@@ -1214,6 +1218,7 @@ static bool s5p\_jpeg\_parse\_hdr(struct s5p\_jpeg\_q\_data \*result, if (get\_word\_be(&jpeg\_buffer, &word)) break; length = (long)word - 2;+ /\* No need to check underflows as skip() does it \*/ skip(&jpeg\_buffer, length); break; } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 20:09:37 +0000



=== Content from git.kernel.org_bb4cb86b_20250114_201059.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=14a22762c3daeac59a5a534e124acbb4d7a79b3a)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=14a22762c3daeac59a5a534e124acbb4d7a79b3a)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=14a22762c3daeac59a5a534e124acbb4d7a79b3a)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=14a22762c3daeac59a5a534e124acbb4d7a79b3a)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Mauro Carvalho Chehab <mchehab+huawei@kernel.org> | 2024-10-15 11:10:31 +0200 |
| --- | --- | --- |
| committer | Mauro Carvalho Chehab <mchehab+huawei@kernel.org> | 2024-10-18 10:43:03 +0200 |
| commit | [14a22762c3daeac59a5a534e124acbb4d7a79b3a](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=14a22762c3daeac59a5a534e124acbb4d7a79b3a) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=14a22762c3daeac59a5a534e124acbb4d7a79b3a)) | |
| tree | [671c52f257f9a406f663bb0dc27679f562da4d07](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=14a22762c3daeac59a5a534e124acbb4d7a79b3a) | |
| parent | [458ea1c0be991573ec436aa0afa23baacfae101a](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=458ea1c0be991573ec436aa0afa23baacfae101a) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=14a22762c3daeac59a5a534e124acbb4d7a79b3a&id2=458ea1c0be991573ec436aa0afa23baacfae101a)) | |
| download | [linux-14a22762c3daeac59a5a534e124acbb4d7a79b3a.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-14a22762c3daeac59a5a534e124acbb4d7a79b3a.tar.gz) | |

media: s5p-jpeg: prevent buffer overflowsThe current logic allows word to be less than 2. If this happens,
there will be buffer overflows, as reported by smatch. Add extra
checks to prevent it.
While here, remove an unused word = 0 assignment.
Fixes: 6c96dbbc2aa9 ("[media] s5p-jpeg: add support for 5433")
Cc: stable@vger.kernel.org
Signed-off-by: Mauro Carvalho Chehab <mchehab+huawei@kernel.org>
Reviewed-by: Jacek Anaszewski <jacek.anaszewski@gmail.com>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=14a22762c3daeac59a5a534e124acbb4d7a79b3a)

| -rw-r--r-- | [drivers/media/platform/samsung/s5p-jpeg/jpeg-core.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/media/platform/samsung/s5p-jpeg/jpeg-core.c?id=14a22762c3daeac59a5a534e124acbb4d7a79b3a) | 17 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 11 insertions, 6 deletions

| diff --git a/drivers/media/platform/samsung/s5p-jpeg/jpeg-core.c b/drivers/media/platform/samsung/s5p-jpeg/jpeg-core.cindex d2c4a0178b3c5c..1db4609b35574f 100644--- a/[drivers/media/platform/samsung/s5p-jpeg/jpeg-core.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/media/platform/samsung/s5p-jpeg/jpeg-core.c?id=458ea1c0be991573ec436aa0afa23baacfae101a)+++ b/[drivers/media/platform/samsung/s5p-jpeg/jpeg-core.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/media/platform/samsung/s5p-jpeg/jpeg-core.c?id=14a22762c3daeac59a5a534e124acbb4d7a79b3a)@@ -775,11 +775,14 @@ static void exynos4\_jpeg\_parse\_decode\_h\_tbl(struct s5p\_jpeg\_ctx \*ctx) (unsigned long)vb2\_plane\_vaddr(&vb->vb2\_buf, 0) + ctx->out\_q.sos + 2; jpeg\_buffer.curr = 0; - word = 0;- if (get\_word\_be(&jpeg\_buffer, &word)) return;- jpeg\_buffer.size = (long)word - 2;++ if (word < 2)+ jpeg\_buffer.size = 0;+ else+ jpeg\_buffer.size = (long)word - 2;+ jpeg\_buffer.data += 2; jpeg\_buffer.curr = 0; @@ -1058,6 +1061,7 @@ static int get\_word\_be(struct s5p\_jpeg\_buffer \*buf, unsigned int \*word) if (byte == -1) return -1; \*word = (unsigned int)byte | temp;+ return 0; } @@ -1145,7 +1149,7 @@ static bool s5p\_jpeg\_parse\_hdr(struct s5p\_jpeg\_q\_data \*result, if (get\_word\_be(&jpeg\_buffer, &word)) break; length = (long)word - 2;- if (!length)+ if (length <= 0) return false; sof = jpeg\_buffer.curr; /\* after 0xffc0 \*/ sof\_len = length;@@ -1176,7 +1180,7 @@ static bool s5p\_jpeg\_parse\_hdr(struct s5p\_jpeg\_q\_data \*result, if (get\_word\_be(&jpeg\_buffer, &word)) break; length = (long)word - 2;- if (!length)+ if (length <= 0) return false; if (n\_dqt >= S5P\_JPEG\_MAX\_MARKER) return false;@@ -1189,7 +1193,7 @@ static bool s5p\_jpeg\_parse\_hdr(struct s5p\_jpeg\_q\_data \*result, if (get\_word\_be(&jpeg\_buffer, &word)) break; length = (long)word - 2;- if (!length)+ if (length <= 0) return false; if (n\_dht >= S5P\_JPEG\_MAX\_MARKER) return false;@@ -1214,6 +1218,7 @@ static bool s5p\_jpeg\_parse\_hdr(struct s5p\_jpeg\_q\_data \*result, if (get\_word\_be(&jpeg\_buffer, &word)) break; length = (long)word - 2;+ /\* No need to check underflows as skip() does it \*/ skip(&jpeg\_buffer, length); break; } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 20:09:36 +0000



=== Content from git.kernel.org_832e6593_20250114_201105.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=c951a0859fdacf49a2298b5551a7e52b95ff6f51)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=c951a0859fdacf49a2298b5551a7e52b95ff6f51)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=c951a0859fdacf49a2298b5551a7e52b95ff6f51)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=c951a0859fdacf49a2298b5551a7e52b95ff6f51)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Mauro Carvalho Chehab <mchehab+huawei@kernel.org> | 2024-10-15 11:10:31 +0200 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-11-14 13:21:03 +0100 |
| commit | [c951a0859fdacf49a2298b5551a7e52b95ff6f51](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=c951a0859fdacf49a2298b5551a7e52b95ff6f51) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=c951a0859fdacf49a2298b5551a7e52b95ff6f51)) | |
| tree | [20a4a0c2866a4d55b47bd72afd8b544d9701d3a9](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=c951a0859fdacf49a2298b5551a7e52b95ff6f51) | |
| parent | [97ed0c0332d5525653668b31acf62ff1e6b50784](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=97ed0c0332d5525653668b31acf62ff1e6b50784) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=c951a0859fdacf49a2298b5551a7e52b95ff6f51&id2=97ed0c0332d5525653668b31acf62ff1e6b50784)) | |
| download | [linux-c951a0859fdacf49a2298b5551a7e52b95ff6f51.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-c951a0859fdacf49a2298b5551a7e52b95ff6f51.tar.gz) | |

media: s5p-jpeg: prevent buffer overflowscommit 14a22762c3daeac59a5a534e124acbb4d7a79b3a upstream.
The current logic allows word to be less than 2. If this happens,
there will be buffer overflows, as reported by smatch. Add extra
checks to prevent it.
While here, remove an unused word = 0 assignment.
Fixes: 6c96dbbc2aa9 ("[media] s5p-jpeg: add support for 5433")
Cc: stable@vger.kernel.org
Signed-off-by: Mauro Carvalho Chehab <mchehab+huawei@kernel.org>
Reviewed-by: Jacek Anaszewski <jacek.anaszewski@gmail.com>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=c951a0859fdacf49a2298b5551a7e52b95ff6f51)

| -rw-r--r-- | [drivers/media/platform/samsung/s5p-jpeg/jpeg-core.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/media/platform/samsung/s5p-jpeg/jpeg-core.c?id=c951a0859fdacf49a2298b5551a7e52b95ff6f51) | 17 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 11 insertions, 6 deletions

| diff --git a/drivers/media/platform/samsung/s5p-jpeg/jpeg-core.c b/drivers/media/platform/samsung/s5p-jpeg/jpeg-core.cindex d2c4a0178b3c5c..1db4609b35574f 100644--- a/[drivers/media/platform/samsung/s5p-jpeg/jpeg-core.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/media/platform/samsung/s5p-jpeg/jpeg-core.c?id=97ed0c0332d5525653668b31acf62ff1e6b50784)+++ b/[drivers/media/platform/samsung/s5p-jpeg/jpeg-core.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/media/platform/samsung/s5p-jpeg/jpeg-core.c?id=c951a0859fdacf49a2298b5551a7e52b95ff6f51)@@ -775,11 +775,14 @@ static void exynos4\_jpeg\_parse\_decode\_h\_tbl(struct s5p\_jpeg\_ctx \*ctx) (unsigned long)vb2\_plane\_vaddr(&vb->vb2\_buf, 0) + ctx->out\_q.sos + 2; jpeg\_buffer.curr = 0; - word = 0;- if (get\_word\_be(&jpeg\_buffer, &word)) return;- jpeg\_buffer.size = (long)word - 2;++ if (word < 2)+ jpeg\_buffer.size = 0;+ else+ jpeg\_buffer.size = (long)word - 2;+ jpeg\_buffer.data += 2; jpeg\_buffer.curr = 0; @@ -1058,6 +1061,7 @@ static int get\_word\_be(struct s5p\_jpeg\_buffer \*buf, unsigned int \*word) if (byte == -1) return -1; \*word = (unsigned int)byte | temp;+ return 0; } @@ -1145,7 +1149,7 @@ static bool s5p\_jpeg\_parse\_hdr(struct s5p\_jpeg\_q\_data \*result, if (get\_word\_be(&jpeg\_buffer, &word)) break; length = (long)word - 2;- if (!length)+ if (length <= 0) return false; sof = jpeg\_buffer.curr; /\* after 0xffc0 \*/ sof\_len = length;@@ -1176,7 +1180,7 @@ static bool s5p\_jpeg\_parse\_hdr(struct s5p\_jpeg\_q\_data \*result, if (get\_word\_be(&jpeg\_buffer, &word)) break; length = (long)word - 2;- if (!length)+ if (length <= 0) return false; if (n\_dqt >= S5P\_JPEG\_MAX\_MARKER) return false;@@ -1189,7 +1193,7 @@ static bool s5p\_jpeg\_parse\_hdr(struct s5p\_jpeg\_q\_data \*result, if (get\_word\_be(&jpeg\_buffer, &word)) break; length = (long)word - 2;- if (!length)+ if (length <= 0) return false; if (n\_dht >= S5P\_JPEG\_MAX\_MARKER) return false;@@ -1214,6 +1218,7 @@ static bool s5p\_jpeg\_parse\_hdr(struct s5p\_jpeg\_q\_data \*result, if (get\_word\_be(&jpeg\_buffer, &word)) break; length = (long)word - 2;+ /\* No need to check underflows as skip() does it \*/ skip(&jpeg\_buffer, length); break; } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 20:09:42 +0000



=== Content from git.kernel.org_47e6bd08_20250114_201101.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=a930cddfd153b5d4401df0c01effa14c831ff21e)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=a930cddfd153b5d4401df0c01effa14c831ff21e)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=a930cddfd153b5d4401df0c01effa14c831ff21e)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=a930cddfd153b5d4401df0c01effa14c831ff21e)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Mauro Carvalho Chehab <mchehab+huawei@kernel.org> | 2024-10-15 11:10:31 +0200 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-11-14 13:13:38 +0100 |
| commit | [a930cddfd153b5d4401df0c01effa14c831ff21e](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=a930cddfd153b5d4401df0c01effa14c831ff21e) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=a930cddfd153b5d4401df0c01effa14c831ff21e)) | |
| tree | [024d93dee31223c2fb690201bc42b6c674b22e7c](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=a930cddfd153b5d4401df0c01effa14c831ff21e) | |
| parent | [0d75f887aabd80cf37ea48d28f159afa7850ea28](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=0d75f887aabd80cf37ea48d28f159afa7850ea28) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=a930cddfd153b5d4401df0c01effa14c831ff21e&id2=0d75f887aabd80cf37ea48d28f159afa7850ea28)) | |
| download | [linux-a930cddfd153b5d4401df0c01effa14c831ff21e.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-a930cddfd153b5d4401df0c01effa14c831ff21e.tar.gz) | |

media: s5p-jpeg: prevent buffer overflowscommit 14a22762c3daeac59a5a534e124acbb4d7a79b3a upstream.
The current logic allows word to be less than 2. If this happens,
there will be buffer overflows, as reported by smatch. Add extra
checks to prevent it.
While here, remove an unused word = 0 assignment.
Fixes: 6c96dbbc2aa9 ("[media] s5p-jpeg: add support for 5433")
Cc: stable@vger.kernel.org
Signed-off-by: Mauro Carvalho Chehab <mchehab+huawei@kernel.org>
Reviewed-by: Jacek Anaszewski <jacek.anaszewski@gmail.com>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=a930cddfd153b5d4401df0c01effa14c831ff21e)

| -rw-r--r-- | [drivers/media/platform/s5p-jpeg/jpeg-core.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/media/platform/s5p-jpeg/jpeg-core.c?id=a930cddfd153b5d4401df0c01effa14c831ff21e) | 17 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 11 insertions, 6 deletions

| diff --git a/drivers/media/platform/s5p-jpeg/jpeg-core.c b/drivers/media/platform/s5p-jpeg/jpeg-core.cindex 7d0ab19c38bb91..5cfb49ddcbeead 100644--- a/[drivers/media/platform/s5p-jpeg/jpeg-core.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/media/platform/s5p-jpeg/jpeg-core.c?id=0d75f887aabd80cf37ea48d28f159afa7850ea28)+++ b/[drivers/media/platform/s5p-jpeg/jpeg-core.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/media/platform/s5p-jpeg/jpeg-core.c?id=a930cddfd153b5d4401df0c01effa14c831ff21e)@@ -775,11 +775,14 @@ static void exynos4\_jpeg\_parse\_decode\_h\_tbl(struct s5p\_jpeg\_ctx \*ctx) (unsigned long)vb2\_plane\_vaddr(&vb->vb2\_buf, 0) + ctx->out\_q.sos + 2; jpeg\_buffer.curr = 0; - word = 0;- if (get\_word\_be(&jpeg\_buffer, &word)) return;- jpeg\_buffer.size = (long)word - 2;++ if (word < 2)+ jpeg\_buffer.size = 0;+ else+ jpeg\_buffer.size = (long)word - 2;+ jpeg\_buffer.data += 2; jpeg\_buffer.curr = 0; @@ -1058,6 +1061,7 @@ static int get\_word\_be(struct s5p\_jpeg\_buffer \*buf, unsigned int \*word) if (byte == -1) return -1; \*word = (unsigned int)byte | temp;+ return 0; } @@ -1145,7 +1149,7 @@ static bool s5p\_jpeg\_parse\_hdr(struct s5p\_jpeg\_q\_data \*result, if (get\_word\_be(&jpeg\_buffer, &word)) break; length = (long)word - 2;- if (!length)+ if (length <= 0) return false; sof = jpeg\_buffer.curr; /\* after 0xffc0 \*/ sof\_len = length;@@ -1176,7 +1180,7 @@ static bool s5p\_jpeg\_parse\_hdr(struct s5p\_jpeg\_q\_data \*result, if (get\_word\_be(&jpeg\_buffer, &word)) break; length = (long)word - 2;- if (!length)+ if (length <= 0) return false; if (n\_dqt >= S5P\_JPEG\_MAX\_MARKER) return false;@@ -1189,7 +1193,7 @@ static bool s5p\_jpeg\_parse\_hdr(struct s5p\_jpeg\_q\_data \*result, if (get\_word\_be(&jpeg\_buffer, &word)) break; length = (long)word - 2;- if (!length)+ if (length <= 0) return false; if (n\_dht >= S5P\_JPEG\_MAX\_MARKER) return false;@@ -1214,6 +1218,7 @@ static bool s5p\_jpeg\_parse\_hdr(struct s5p\_jpeg\_q\_data \*result, if (get\_word\_be(&jpeg\_buffer, &word)) break; length = (long)word - 2;+ /\* No need to check underflows as skip() does it \*/ skip(&jpeg\_buffer, length); break; } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 20:09:38 +0000



=== Content from git.kernel.org_328751a0_20250114_201105.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=e5117f6e7adcf9fd7546cdd0edc9abe4474bc98b)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=e5117f6e7adcf9fd7546cdd0edc9abe4474bc98b)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=e5117f6e7adcf9fd7546cdd0edc9abe4474bc98b)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e5117f6e7adcf9fd7546cdd0edc9abe4474bc98b)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Mauro Carvalho Chehab <mchehab+huawei@kernel.org> | 2024-10-15 11:10:31 +0200 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-11-17 14:58:50 +0100 |
| commit | [e5117f6e7adcf9fd7546cdd0edc9abe4474bc98b](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=e5117f6e7adcf9fd7546cdd0edc9abe4474bc98b) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=e5117f6e7adcf9fd7546cdd0edc9abe4474bc98b)) | |
| tree | [52037795b766a92a6dca6f259b9b0c72f6801bd6](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=e5117f6e7adcf9fd7546cdd0edc9abe4474bc98b) | |
| parent | [2df76b10cbb343f7e3a59893f1ade3a6fe4df002](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=2df76b10cbb343f7e3a59893f1ade3a6fe4df002) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e5117f6e7adcf9fd7546cdd0edc9abe4474bc98b&id2=2df76b10cbb343f7e3a59893f1ade3a6fe4df002)) | |
| download | [linux-e5117f6e7adcf9fd7546cdd0edc9abe4474bc98b.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-e5117f6e7adcf9fd7546cdd0edc9abe4474bc98b.tar.gz) | |

media: s5p-jpeg: prevent buffer overflowscommit 14a22762c3daeac59a5a534e124acbb4d7a79b3a upstream.
The current logic allows word to be less than 2. If this happens,
there will be buffer overflows, as reported by smatch. Add extra
checks to prevent it.
While here, remove an unused word = 0 assignment.
Fixes: 6c96dbbc2aa9 ("[media] s5p-jpeg: add support for 5433")
Cc: stable@vger.kernel.org
Signed-off-by: Mauro Carvalho Chehab <mchehab+huawei@kernel.org>
Reviewed-by: Jacek Anaszewski <jacek.anaszewski@gmail.com>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e5117f6e7adcf9fd7546cdd0edc9abe4474bc98b)

| -rw-r--r-- | [drivers/media/platform/s5p-jpeg/jpeg-core.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/media/platform/s5p-jpeg/jpeg-core.c?id=e5117f6e7adcf9fd7546cdd0edc9abe4474bc98b) | 17 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 11 insertions, 6 deletions

| diff --git a/drivers/media/platform/s5p-jpeg/jpeg-core.c b/drivers/media/platform/s5p-jpeg/jpeg-core.cindex 06e17946bbb644..4ee1e275ba8949 100644--- a/[drivers/media/platform/s5p-jpeg/jpeg-core.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/media/platform/s5p-jpeg/jpeg-core.c?id=2df76b10cbb343f7e3a59893f1ade3a6fe4df002)+++ b/[drivers/media/platform/s5p-jpeg/jpeg-core.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/media/platform/s5p-jpeg/jpeg-core.c?id=e5117f6e7adcf9fd7546cdd0edc9abe4474bc98b)@@ -774,11 +774,14 @@ static void exynos4\_jpeg\_parse\_decode\_h\_tbl(struct s5p\_jpeg\_ctx \*ctx) (unsigned long)vb2\_plane\_vaddr(&vb->vb2\_buf, 0) + ctx->out\_q.sos + 2; jpeg\_buffer.curr = 0; - word = 0;- if (get\_word\_be(&jpeg\_buffer, &word)) return;- jpeg\_buffer.size = (long)word - 2;++ if (word < 2)+ jpeg\_buffer.size = 0;+ else+ jpeg\_buffer.size = (long)word - 2;+ jpeg\_buffer.data += 2; jpeg\_buffer.curr = 0; @@ -1057,6 +1060,7 @@ static int get\_word\_be(struct s5p\_jpeg\_buffer \*buf, unsigned int \*word) if (byte == -1) return -1; \*word = (unsigned int)byte | temp;+ return 0; } @@ -1144,7 +1148,7 @@ static bool s5p\_jpeg\_parse\_hdr(struct s5p\_jpeg\_q\_data \*result, if (get\_word\_be(&jpeg\_buffer, &word)) break; length = (long)word - 2;- if (!length)+ if (length <= 0) return false; sof = jpeg\_buffer.curr; /\* after 0xffc0 \*/ sof\_len = length;@@ -1175,7 +1179,7 @@ static bool s5p\_jpeg\_parse\_hdr(struct s5p\_jpeg\_q\_data \*result, if (get\_word\_be(&jpeg\_buffer, &word)) break; length = (long)word - 2;- if (!length)+ if (length <= 0) return false; if (n\_dqt >= S5P\_JPEG\_MAX\_MARKER) return false;@@ -1188,7 +1192,7 @@ static bool s5p\_jpeg\_parse\_hdr(struct s5p\_jpeg\_q\_data \*result, if (get\_word\_be(&jpeg\_buffer, &word)) break; length = (long)word - 2;- if (!length)+ if (length <= 0) return false; if (n\_dht >= S5P\_JPEG\_MAX\_MARKER) return false;@@ -1213,6 +1217,7 @@ static bool s5p\_jpeg\_parse\_hdr(struct s5p\_jpeg\_q\_data \*result, if (get\_word\_be(&jpeg\_buffer, &word)) break; length = (long)word - 2;+ /\* No need to check underflows as skip() does it \*/ skip(&jpeg\_buffer, length); break; } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 20:09:43 +0000



=== Content from git.kernel.org_6cc0be5e_20250114_201104.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=c85db2d4432de4ff9d97006691ce2dcb5bda660e)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=c85db2d4432de4ff9d97006691ce2dcb5bda660e)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=c85db2d4432de4ff9d97006691ce2dcb5bda660e)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=c85db2d4432de4ff9d97006691ce2dcb5bda660e)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Mauro Carvalho Chehab <mchehab+huawei@kernel.org> | 2024-10-15 11:10:31 +0200 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-11-14 13:15:13 +0100 |
| commit | [c85db2d4432de4ff9d97006691ce2dcb5bda660e](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=c85db2d4432de4ff9d97006691ce2dcb5bda660e) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=c85db2d4432de4ff9d97006691ce2dcb5bda660e)) | |
| tree | [53e6ea301ab0037f45e93e3208f743280f9f7b8a](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=c85db2d4432de4ff9d97006691ce2dcb5bda660e) | |
| parent | [5e1523076acf95b4ea68d19b6f27e6891267cc24](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=5e1523076acf95b4ea68d19b6f27e6891267cc24) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=c85db2d4432de4ff9d97006691ce2dcb5bda660e&id2=5e1523076acf95b4ea68d19b6f27e6891267cc24)) | |
| download | [linux-c85db2d4432de4ff9d97006691ce2dcb5bda660e.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-c85db2d4432de4ff9d97006691ce2dcb5bda660e.tar.gz) | |

media: s5p-jpeg: prevent buffer overflowscommit 14a22762c3daeac59a5a534e124acbb4d7a79b3a upstream.
The current logic allows word to be less than 2. If this happens,
there will be buffer overflows, as reported by smatch. Add extra
checks to prevent it.
While here, remove an unused word = 0 assignment.
Fixes: 6c96dbbc2aa9 ("[media] s5p-jpeg: add support for 5433")
Cc: stable@vger.kernel.org
Signed-off-by: Mauro Carvalho Chehab <mchehab+huawei@kernel.org>
Reviewed-by: Jacek Anaszewski <jacek.anaszewski@gmail.com>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=c85db2d4432de4ff9d97006691ce2dcb5bda660e)

| -rw-r--r-- | [drivers/media/platform/samsung/s5p-jpeg/jpeg-core.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/media/platform/samsung/s5p-jpeg/jpeg-core.c?id=c85db2d4432de4ff9d97006691ce2dcb5bda660e) | 17 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 11 insertions, 6 deletions

| diff --git a/drivers/media/platform/samsung/s5p-jpeg/jpeg-core.c b/drivers/media/platform/samsung/s5p-jpeg/jpeg-core.cindex 55814041b8d8f3..d8d1f17cee83f3 100644--- a/[drivers/media/platform/samsung/s5p-jpeg/jpeg-core.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/media/platform/samsung/s5p-jpeg/jpeg-core.c?id=5e1523076acf95b4ea68d19b6f27e6891267cc24)+++ b/[drivers/media/platform/samsung/s5p-jpeg/jpeg-core.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/media/platform/samsung/s5p-jpeg/jpeg-core.c?id=c85db2d4432de4ff9d97006691ce2dcb5bda660e)@@ -775,11 +775,14 @@ static void exynos4\_jpeg\_parse\_decode\_h\_tbl(struct s5p\_jpeg\_ctx \*ctx) (unsigned long)vb2\_plane\_vaddr(&vb->vb2\_buf, 0) + ctx->out\_q.sos + 2; jpeg\_buffer.curr = 0; - word = 0;- if (get\_word\_be(&jpeg\_buffer, &word)) return;- jpeg\_buffer.size = (long)word - 2;++ if (word < 2)+ jpeg\_buffer.size = 0;+ else+ jpeg\_buffer.size = (long)word - 2;+ jpeg\_buffer.data += 2; jpeg\_buffer.curr = 0; @@ -1058,6 +1061,7 @@ static int get\_word\_be(struct s5p\_jpeg\_buffer \*buf, unsigned int \*word) if (byte == -1) return -1; \*word = (unsigned int)byte | temp;+ return 0; } @@ -1145,7 +1149,7 @@ static bool s5p\_jpeg\_parse\_hdr(struct s5p\_jpeg\_q\_data \*result, if (get\_word\_be(&jpeg\_buffer, &word)) break; length = (long)word - 2;- if (!length)+ if (length <= 0) return false; sof = jpeg\_buffer.curr; /\* after 0xffc0 \*/ sof\_len = length;@@ -1176,7 +1180,7 @@ static bool s5p\_jpeg\_parse\_hdr(struct s5p\_jpeg\_q\_data \*result, if (get\_word\_be(&jpeg\_buffer, &word)) break; length = (long)word - 2;- if (!length)+ if (length <= 0) return false; if (n\_dqt >= S5P\_JPEG\_MAX\_MARKER) return false;@@ -1189,7 +1193,7 @@ static bool s5p\_jpeg\_parse\_hdr(struct s5p\_jpeg\_q\_data \*result, if (get\_word\_be(&jpeg\_buffer, &word)) break; length = (long)word - 2;- if (!length)+ if (length <= 0) return false; if (n\_dht >= S5P\_JPEG\_MAX\_MARKER) return false;@@ -1214,6 +1218,7 @@ static bool s5p\_jpeg\_parse\_hdr(struct s5p\_jpeg\_q\_data \*result, if (get\_word\_be(&jpeg\_buffer, &word)) break; length = (long)word - 2;+ /\* No need to check underflows as skip() does it \*/ skip(&jpeg\_buffer, length); break; } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 20:09:40 +0000



=== Content from git.kernel.org_64c14c02_20250114_201102.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=c5f6fefcda8fac8f082b6c5bf416567f4e100c51)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=c5f6fefcda8fac8f082b6c5bf416567f4e100c51)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=c5f6fefcda8fac8f082b6c5bf416567f4e100c51)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=c5f6fefcda8fac8f082b6c5bf416567f4e100c51)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Mauro Carvalho Chehab <mchehab+huawei@kernel.org> | 2024-10-15 11:10:31 +0200 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-11-17 14:58:06 +0100 |
| commit | [c5f6fefcda8fac8f082b6c5bf416567f4e100c51](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=c5f6fefcda8fac8f082b6c5bf416567f4e100c51) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=c5f6fefcda8fac8f082b6c5bf416567f4e100c51)) | |
| tree | [824b95c62ca87eb0ef28ee3a5489c45ce008f538](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=c5f6fefcda8fac8f082b6c5bf416567f4e100c51) | |
| parent | [bf8a1e1449c20908f74de3392dbe72fdcfb6f44a](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=bf8a1e1449c20908f74de3392dbe72fdcfb6f44a) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=c5f6fefcda8fac8f082b6c5bf416567f4e100c51&id2=bf8a1e1449c20908f74de3392dbe72fdcfb6f44a)) | |
| download | [linux-c5f6fefcda8fac8f082b6c5bf416567f4e100c51.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-c5f6fefcda8fac8f082b6c5bf416567f4e100c51.tar.gz) | |

media: s5p-jpeg: prevent buffer overflowscommit 14a22762c3daeac59a5a534e124acbb4d7a79b3a upstream.
The current logic allows word to be less than 2. If this happens,
there will be buffer overflows, as reported by smatch. Add extra
checks to prevent it.
While here, remove an unused word = 0 assignment.
Fixes: 6c96dbbc2aa9 ("[media] s5p-jpeg: add support for 5433")
Cc: stable@vger.kernel.org
Signed-off-by: Mauro Carvalho Chehab <mchehab+huawei@kernel.org>
Reviewed-by: Jacek Anaszewski <jacek.anaszewski@gmail.com>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=c5f6fefcda8fac8f082b6c5bf416567f4e100c51)

| -rw-r--r-- | [drivers/media/platform/s5p-jpeg/jpeg-core.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/media/platform/s5p-jpeg/jpeg-core.c?id=c5f6fefcda8fac8f082b6c5bf416567f4e100c51) | 17 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 11 insertions, 6 deletions

| diff --git a/drivers/media/platform/s5p-jpeg/jpeg-core.c b/drivers/media/platform/s5p-jpeg/jpeg-core.cindex fa7c42cf4b4ef1..7d36e0fdb8cc14 100644--- a/[drivers/media/platform/s5p-jpeg/jpeg-core.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/media/platform/s5p-jpeg/jpeg-core.c?id=bf8a1e1449c20908f74de3392dbe72fdcfb6f44a)+++ b/[drivers/media/platform/s5p-jpeg/jpeg-core.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/media/platform/s5p-jpeg/jpeg-core.c?id=c5f6fefcda8fac8f082b6c5bf416567f4e100c51)@@ -803,11 +803,14 @@ static void exynos4\_jpeg\_parse\_decode\_h\_tbl(struct s5p\_jpeg\_ctx \*ctx) (unsigned long)vb2\_plane\_vaddr(&vb->vb2\_buf, 0) + ctx->out\_q.sos + 2; jpeg\_buffer.curr = 0; - word = 0;- if (get\_word\_be(&jpeg\_buffer, &word)) return;- jpeg\_buffer.size = (long)word - 2;++ if (word < 2)+ jpeg\_buffer.size = 0;+ else+ jpeg\_buffer.size = (long)word - 2;+ jpeg\_buffer.data += 2; jpeg\_buffer.curr = 0; @@ -1086,6 +1089,7 @@ static int get\_word\_be(struct s5p\_jpeg\_buffer \*buf, unsigned int \*word) if (byte == -1) return -1; \*word = (unsigned int)byte | temp;+ return 0; } @@ -1173,7 +1177,7 @@ static bool s5p\_jpeg\_parse\_hdr(struct s5p\_jpeg\_q\_data \*result, if (get\_word\_be(&jpeg\_buffer, &word)) break; length = (long)word - 2;- if (!length)+ if (length <= 0) return false; sof = jpeg\_buffer.curr; /\* after 0xffc0 \*/ sof\_len = length;@@ -1204,7 +1208,7 @@ static bool s5p\_jpeg\_parse\_hdr(struct s5p\_jpeg\_q\_data \*result, if (get\_word\_be(&jpeg\_buffer, &word)) break; length = (long)word - 2;- if (!length)+ if (length <= 0) return false; if (n\_dqt >= S5P\_JPEG\_MAX\_MARKER) return false;@@ -1217,7 +1221,7 @@ static bool s5p\_jpeg\_parse\_hdr(struct s5p\_jpeg\_q\_data \*result, if (get\_word\_be(&jpeg\_buffer, &word)) break; length = (long)word - 2;- if (!length)+ if (length <= 0) return false; if (n\_dht >= S5P\_JPEG\_MAX\_MARKER) return false;@@ -1242,6 +1246,7 @@ static bool s5p\_jpeg\_parse\_hdr(struct s5p\_jpeg\_q\_data \*result, if (get\_word\_be(&jpeg\_buffer, &word)) break; length = (long)word - 2;+ /\* No need to check underflows as skip() does it \*/ skip(&jpeg\_buffer, length); break; } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 20:09:39 +0000


