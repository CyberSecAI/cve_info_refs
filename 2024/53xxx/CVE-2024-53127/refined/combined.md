=== Content from git.kernel.org_255b2ce9_20250114_230840.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=1635e407a4a64d08a8517ac59ca14ad4fc785e75)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=1635e407a4a64d08a8517ac59ca14ad4fc785e75)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=1635e407a4a64d08a8517ac59ca14ad4fc785e75)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=1635e407a4a64d08a8517ac59ca14ad4fc785e75)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Aurelien Jarno <aurelien@aurel32.net> | 2024-11-10 12:46:36 +0100 |
| --- | --- | --- |
| committer | Ulf Hansson <ulf.hansson@linaro.org> | 2024-11-12 19:40:40 +0100 |
| commit | [1635e407a4a64d08a8517ac59ca14ad4fc785e75](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=1635e407a4a64d08a8517ac59ca14ad4fc785e75) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=1635e407a4a64d08a8517ac59ca14ad4fc785e75)) | |
| tree | [a266863f533c4463e72863795acbcab74424dc4f](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=1635e407a4a64d08a8517ac59ca14ad4fc785e75) | |
| parent | [85b580afc2c215394e08974bf033de9face94955](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=85b580afc2c215394e08974bf033de9face94955) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=1635e407a4a64d08a8517ac59ca14ad4fc785e75&id2=85b580afc2c215394e08974bf033de9face94955)) | |
| download | [linux-1635e407a4a64d08a8517ac59ca14ad4fc785e75.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-1635e407a4a64d08a8517ac59ca14ad4fc785e75.tar.gz) | |

Revert "mmc: dw\_mmc: Fix IDMAC operation with pages bigger than 4K"The commit 8396c793ffdf ("mmc: dw\_mmc: Fix IDMAC operation with pages
bigger than 4K") increased the max\_req\_size, even for 4K pages, causing
various issues:
- Panic booting the kernel/rootfs from an SD card on Rockchip RK3566
- Panic booting the kernel/rootfs from an SD card on StarFive JH7100
- "swiotlb buffer is full" and data corruption on StarFive JH7110
At this stage no fix have been found, so it's probably better to just
revert the change.
This reverts commit 8396c793ffdf28bb8aee7cfe0891080f8cab7890.
Cc: stable@vger.kernel.org
Cc: Sam Protsenko <semen.protsenko@linaro.org>
Fixes: 8396c793ffdf ("mmc: dw\_mmc: Fix IDMAC operation with pages bigger than 4K")
Closes: https://lore.kernel.org/linux-mmc/614692b4-1dbe-31b8-a34d-cb6db1909bb7@w6rz.net/
Closes: https://lore.kernel.org/linux-mmc/CAC8uq=Ppnmv98mpa1CrWLawWoPnu5abtU69v-=G-P7ysATQ2Pw@mail.gmail.com/
Signed-off-by: Aurelien Jarno <aurelien@aurel32.net>
Message-ID: <20241110114700.622372-1-aurelien@aurel32.net>
Signed-off-by: Ulf Hansson <ulf.hansson@linaro.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=1635e407a4a64d08a8517ac59ca14ad4fc785e75)

| -rw-r--r-- | [drivers/mmc/host/dw\_mmc.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/mmc/host/dw_mmc.c?id=1635e407a4a64d08a8517ac59ca14ad4fc785e75) | 4 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 2 insertions, 2 deletions

| diff --git a/drivers/mmc/host/dw\_mmc.c b/drivers/mmc/host/dw\_mmc.cindex 41e451235f6373..e9f6e4e622901a 100644--- a/[drivers/mmc/host/dw\_mmc.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/mmc/host/dw_mmc.c?id=85b580afc2c215394e08974bf033de9face94955)+++ b/[drivers/mmc/host/dw\_mmc.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/mmc/host/dw_mmc.c?id=1635e407a4a64d08a8517ac59ca14ad4fc785e75)@@ -2957,8 +2957,8 @@ static int dw\_mci\_init\_slot(struct dw\_mci \*host) if (host->use\_dma == TRANS\_MODE\_IDMAC) { mmc->max\_segs = host->ring\_size; mmc->max\_blk\_size = 65535;- mmc->max\_req\_size = DW\_MCI\_DESC\_DATA\_LENGTH \* host->ring\_size;- mmc->max\_seg\_size = mmc->max\_req\_size;+ mmc->max\_seg\_size = 0x1000;+ mmc->max\_req\_size = mmc->max\_seg\_size \* host->ring\_size; mmc->max\_blk\_count = mmc->max\_req\_size / 512; } else if (host->use\_dma == TRANS\_MODE\_EDMAC) { mmc->max\_segs = 64; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 23:07:17 +0000



=== Content from git.kernel.org_294226eb_20250114_230841.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=47693ba35bccaa16efa465159a1c12d78258349e)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=47693ba35bccaa16efa465159a1c12d78258349e)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=47693ba35bccaa16efa465159a1c12d78258349e)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=47693ba35bccaa16efa465159a1c12d78258349e)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Aurelien Jarno <aurelien@aurel32.net> | 2024-11-10 12:46:36 +0100 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-14 19:44:19 +0100 |
| commit | [47693ba35bccaa16efa465159a1c12d78258349e](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=47693ba35bccaa16efa465159a1c12d78258349e) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=47693ba35bccaa16efa465159a1c12d78258349e)) | |
| tree | [1d5983cc0ef7bb16611d32a58d9cc73564276e6e](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=47693ba35bccaa16efa465159a1c12d78258349e) | |
| parent | [0ce59fb1c73fdd5b6028226aeb46259a0cdc0957](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=0ce59fb1c73fdd5b6028226aeb46259a0cdc0957) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=47693ba35bccaa16efa465159a1c12d78258349e&id2=0ce59fb1c73fdd5b6028226aeb46259a0cdc0957)) | |
| download | [linux-47693ba35bccaa16efa465159a1c12d78258349e.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-47693ba35bccaa16efa465159a1c12d78258349e.tar.gz) | |

Revert "mmc: dw\_mmc: Fix IDMAC operation with pages bigger than 4K"commit 1635e407a4a64d08a8517ac59ca14ad4fc785e75 upstream.
The commit 8396c793ffdf ("mmc: dw\_mmc: Fix IDMAC operation with pages
bigger than 4K") increased the max\_req\_size, even for 4K pages, causing
various issues:
- Panic booting the kernel/rootfs from an SD card on Rockchip RK3566
- Panic booting the kernel/rootfs from an SD card on StarFive JH7100
- "swiotlb buffer is full" and data corruption on StarFive JH7110
At this stage no fix have been found, so it's probably better to just
revert the change.
This reverts commit 8396c793ffdf28bb8aee7cfe0891080f8cab7890.
Cc: stable@vger.kernel.org
Cc: Sam Protsenko <semen.protsenko@linaro.org>
Fixes: 8396c793ffdf ("mmc: dw\_mmc: Fix IDMAC operation with pages bigger than 4K")
Closes: https://lore.kernel.org/linux-mmc/614692b4-1dbe-31b8-a34d-cb6db1909bb7@w6rz.net/
Closes: https://lore.kernel.org/linux-mmc/CAC8uq=Ppnmv98mpa1CrWLawWoPnu5abtU69v-=G-P7ysATQ2Pw@mail.gmail.com/
Signed-off-by: Aurelien Jarno <aurelien@aurel32.net>
Message-ID: <20241110114700.622372-1-aurelien@aurel32.net>
Signed-off-by: Ulf Hansson <ulf.hansson@linaro.org>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=47693ba35bccaa16efa465159a1c12d78258349e)

| -rw-r--r-- | [drivers/mmc/host/dw\_mmc.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/mmc/host/dw_mmc.c?id=47693ba35bccaa16efa465159a1c12d78258349e) | 4 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 2 insertions, 2 deletions

| diff --git a/drivers/mmc/host/dw\_mmc.c b/drivers/mmc/host/dw\_mmc.cindex 7c5ce9c96841ac..78e20327828adf 100644--- a/[drivers/mmc/host/dw\_mmc.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/mmc/host/dw_mmc.c?id=0ce59fb1c73fdd5b6028226aeb46259a0cdc0957)+++ b/[drivers/mmc/host/dw\_mmc.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/mmc/host/dw_mmc.c?id=47693ba35bccaa16efa465159a1c12d78258349e)@@ -2831,8 +2831,8 @@ static int dw\_mci\_init\_slot(struct dw\_mci \*host) if (host->use\_dma == TRANS\_MODE\_IDMAC) { mmc->max\_segs = host->ring\_size; mmc->max\_blk\_size = 65535;- mmc->max\_req\_size = DW\_MCI\_DESC\_DATA\_LENGTH \* host->ring\_size;- mmc->max\_seg\_size = mmc->max\_req\_size;+ mmc->max\_seg\_size = 0x1000;+ mmc->max\_req\_size = mmc->max\_seg\_size \* host->ring\_size; mmc->max\_blk\_count = mmc->max\_req\_size / 512; } else if (host->use\_dma == TRANS\_MODE\_EDMAC) { mmc->max\_segs = 64; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 23:07:19 +0000



=== Content from git.kernel.org_3f354e4e_20250114_230843.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=8f9416147d7ed414109d3501f1cb3d7a1735b25a)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=8f9416147d7ed414109d3501f1cb3d7a1735b25a)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=8f9416147d7ed414109d3501f1cb3d7a1735b25a)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=8f9416147d7ed414109d3501f1cb3d7a1735b25a)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Aurelien Jarno <aurelien@aurel32.net> | 2024-11-10 12:46:36 +0100 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-11-22 15:37:31 +0100 |
| commit | [8f9416147d7ed414109d3501f1cb3d7a1735b25a](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=8f9416147d7ed414109d3501f1cb3d7a1735b25a) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=8f9416147d7ed414109d3501f1cb3d7a1735b25a)) | |
| tree | [8955cacc96b28d59b2914fa052fc3d38baf1d0dc](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=8f9416147d7ed414109d3501f1cb3d7a1735b25a) | |
| parent | [86b19031dbc79abc378dfae357f6ea33ebeb0c95](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=86b19031dbc79abc378dfae357f6ea33ebeb0c95) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=8f9416147d7ed414109d3501f1cb3d7a1735b25a&id2=86b19031dbc79abc378dfae357f6ea33ebeb0c95)) | |
| download | [linux-8f9416147d7ed414109d3501f1cb3d7a1735b25a.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-8f9416147d7ed414109d3501f1cb3d7a1735b25a.tar.gz) | |

Revert "mmc: dw\_mmc: Fix IDMAC operation with pages bigger than 4K"commit 1635e407a4a64d08a8517ac59ca14ad4fc785e75 upstream.
The commit 8396c793ffdf ("mmc: dw\_mmc: Fix IDMAC operation with pages
bigger than 4K") increased the max\_req\_size, even for 4K pages, causing
various issues:
- Panic booting the kernel/rootfs from an SD card on Rockchip RK3566
- Panic booting the kernel/rootfs from an SD card on StarFive JH7100
- "swiotlb buffer is full" and data corruption on StarFive JH7110
At this stage no fix have been found, so it's probably better to just
revert the change.
This reverts commit 8396c793ffdf28bb8aee7cfe0891080f8cab7890.
Cc: stable@vger.kernel.org
Cc: Sam Protsenko <semen.protsenko@linaro.org>
Fixes: 8396c793ffdf ("mmc: dw\_mmc: Fix IDMAC operation with pages bigger than 4K")
Closes: https://lore.kernel.org/linux-mmc/614692b4-1dbe-31b8-a34d-cb6db1909bb7@w6rz.net/
Closes: https://lore.kernel.org/linux-mmc/CAC8uq=Ppnmv98mpa1CrWLawWoPnu5abtU69v-=G-P7ysATQ2Pw@mail.gmail.com/
Signed-off-by: Aurelien Jarno <aurelien@aurel32.net>
Message-ID: <20241110114700.622372-1-aurelien@aurel32.net>
Signed-off-by: Ulf Hansson <ulf.hansson@linaro.org>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=8f9416147d7ed414109d3501f1cb3d7a1735b25a)

| -rw-r--r-- | [drivers/mmc/host/dw\_mmc.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/mmc/host/dw_mmc.c?id=8f9416147d7ed414109d3501f1cb3d7a1735b25a) | 4 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 2 insertions, 2 deletions

| diff --git a/drivers/mmc/host/dw\_mmc.c b/drivers/mmc/host/dw\_mmc.cindex 121e833efe2891..d0da4573b38cd5 100644--- a/[drivers/mmc/host/dw\_mmc.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/mmc/host/dw_mmc.c?id=86b19031dbc79abc378dfae357f6ea33ebeb0c95)+++ b/[drivers/mmc/host/dw\_mmc.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/mmc/host/dw_mmc.c?id=8f9416147d7ed414109d3501f1cb3d7a1735b25a)@@ -2952,8 +2952,8 @@ static int dw\_mci\_init\_slot(struct dw\_mci \*host) if (host->use\_dma == TRANS\_MODE\_IDMAC) { mmc->max\_segs = host->ring\_size; mmc->max\_blk\_size = 65535;- mmc->max\_req\_size = DW\_MCI\_DESC\_DATA\_LENGTH \* host->ring\_size;- mmc->max\_seg\_size = mmc->max\_req\_size;+ mmc->max\_seg\_size = 0x1000;+ mmc->max\_req\_size = mmc->max\_seg\_size \* host->ring\_size; mmc->max\_blk\_count = mmc->max\_req\_size / 512; } else if (host->use\_dma == TRANS\_MODE\_EDMAC) { mmc->max\_segs = 64; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 23:07:20 +0000



=== Content from git.kernel.org_50e40ff8_20250114_230844.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=a4685366f07448420badb710ff5c12aaaadf63ad)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=a4685366f07448420badb710ff5c12aaaadf63ad)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=a4685366f07448420badb710ff5c12aaaadf63ad)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=a4685366f07448420badb710ff5c12aaaadf63ad)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Aurelien Jarno <aurelien@aurel32.net> | 2024-11-10 12:46:36 +0100 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-11-22 15:39:53 +0100 |
| commit | [a4685366f07448420badb710ff5c12aaaadf63ad](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=a4685366f07448420badb710ff5c12aaaadf63ad) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=a4685366f07448420badb710ff5c12aaaadf63ad)) | |
| tree | [9bff5b57b1a36188374c469e070cb7f254ed9cbf](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=a4685366f07448420badb710ff5c12aaaadf63ad) | |
| parent | [017f0ad64013bb2b1c31718cf71d99e29293f69f](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=017f0ad64013bb2b1c31718cf71d99e29293f69f) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=a4685366f07448420badb710ff5c12aaaadf63ad&id2=017f0ad64013bb2b1c31718cf71d99e29293f69f)) | |
| download | [linux-a4685366f07448420badb710ff5c12aaaadf63ad.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-a4685366f07448420badb710ff5c12aaaadf63ad.tar.gz) | |

Revert "mmc: dw\_mmc: Fix IDMAC operation with pages bigger than 4K"commit 1635e407a4a64d08a8517ac59ca14ad4fc785e75 upstream.
The commit 8396c793ffdf ("mmc: dw\_mmc: Fix IDMAC operation with pages
bigger than 4K") increased the max\_req\_size, even for 4K pages, causing
various issues:
- Panic booting the kernel/rootfs from an SD card on Rockchip RK3566
- Panic booting the kernel/rootfs from an SD card on StarFive JH7100
- "swiotlb buffer is full" and data corruption on StarFive JH7110
At this stage no fix have been found, so it's probably better to just
revert the change.
This reverts commit 8396c793ffdf28bb8aee7cfe0891080f8cab7890.
Cc: stable@vger.kernel.org
Cc: Sam Protsenko <semen.protsenko@linaro.org>
Fixes: 8396c793ffdf ("mmc: dw\_mmc: Fix IDMAC operation with pages bigger than 4K")
Closes: https://lore.kernel.org/linux-mmc/614692b4-1dbe-31b8-a34d-cb6db1909bb7@w6rz.net/
Closes: https://lore.kernel.org/linux-mmc/CAC8uq=Ppnmv98mpa1CrWLawWoPnu5abtU69v-=G-P7ysATQ2Pw@mail.gmail.com/
Signed-off-by: Aurelien Jarno <aurelien@aurel32.net>
Message-ID: <20241110114700.622372-1-aurelien@aurel32.net>
Signed-off-by: Ulf Hansson <ulf.hansson@linaro.org>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=a4685366f07448420badb710ff5c12aaaadf63ad)

| -rw-r--r-- | [drivers/mmc/host/dw\_mmc.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/mmc/host/dw_mmc.c?id=a4685366f07448420badb710ff5c12aaaadf63ad) | 4 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 2 insertions, 2 deletions

| diff --git a/drivers/mmc/host/dw\_mmc.c b/drivers/mmc/host/dw\_mmc.cindex 41e451235f6373..e9f6e4e622901a 100644--- a/[drivers/mmc/host/dw\_mmc.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/mmc/host/dw_mmc.c?id=017f0ad64013bb2b1c31718cf71d99e29293f69f)+++ b/[drivers/mmc/host/dw\_mmc.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/mmc/host/dw_mmc.c?id=a4685366f07448420badb710ff5c12aaaadf63ad)@@ -2957,8 +2957,8 @@ static int dw\_mci\_init\_slot(struct dw\_mci \*host) if (host->use\_dma == TRANS\_MODE\_IDMAC) { mmc->max\_segs = host->ring\_size; mmc->max\_blk\_size = 65535;- mmc->max\_req\_size = DW\_MCI\_DESC\_DATA\_LENGTH \* host->ring\_size;- mmc->max\_seg\_size = mmc->max\_req\_size;+ mmc->max\_seg\_size = 0x1000;+ mmc->max\_req\_size = mmc->max\_seg\_size \* host->ring\_size; mmc->max\_blk\_count = mmc->max\_req\_size / 512; } else if (host->use\_dma == TRANS\_MODE\_EDMAC) { mmc->max\_segs = 64; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 23:07:21 +0000



=== Content from git.kernel.org_a56847ea_20250114_230844.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=938c13740f8b555986e53c0fcbaf00dcd1fabd4c)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=938c13740f8b555986e53c0fcbaf00dcd1fabd4c)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=938c13740f8b555986e53c0fcbaf00dcd1fabd4c)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=938c13740f8b555986e53c0fcbaf00dcd1fabd4c)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Aurelien Jarno <aurelien@aurel32.net> | 2024-11-10 12:46:36 +0100 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-14 19:47:39 +0100 |
| commit | [938c13740f8b555986e53c0fcbaf00dcd1fabd4c](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=938c13740f8b555986e53c0fcbaf00dcd1fabd4c) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=938c13740f8b555986e53c0fcbaf00dcd1fabd4c)) | |
| tree | [76fb730c5d6eacdcd930a8e21ad7f2f2dd7d7111](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=938c13740f8b555986e53c0fcbaf00dcd1fabd4c) | |
| parent | [0a5014ad37c77ac6a2c525137c00a0e1724f6020](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=0a5014ad37c77ac6a2c525137c00a0e1724f6020) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=938c13740f8b555986e53c0fcbaf00dcd1fabd4c&id2=0a5014ad37c77ac6a2c525137c00a0e1724f6020)) | |
| download | [linux-938c13740f8b555986e53c0fcbaf00dcd1fabd4c.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-938c13740f8b555986e53c0fcbaf00dcd1fabd4c.tar.gz) | |

Revert "mmc: dw\_mmc: Fix IDMAC operation with pages bigger than 4K"commit 1635e407a4a64d08a8517ac59ca14ad4fc785e75 upstream.
The commit 8396c793ffdf ("mmc: dw\_mmc: Fix IDMAC operation with pages
bigger than 4K") increased the max\_req\_size, even for 4K pages, causing
various issues:
- Panic booting the kernel/rootfs from an SD card on Rockchip RK3566
- Panic booting the kernel/rootfs from an SD card on StarFive JH7100
- "swiotlb buffer is full" and data corruption on StarFive JH7110
At this stage no fix have been found, so it's probably better to just
revert the change.
This reverts commit 8396c793ffdf28bb8aee7cfe0891080f8cab7890.
Cc: stable@vger.kernel.org
Cc: Sam Protsenko <semen.protsenko@linaro.org>
Fixes: 8396c793ffdf ("mmc: dw\_mmc: Fix IDMAC operation with pages bigger than 4K")
Closes: https://lore.kernel.org/linux-mmc/614692b4-1dbe-31b8-a34d-cb6db1909bb7@w6rz.net/
Closes: https://lore.kernel.org/linux-mmc/CAC8uq=Ppnmv98mpa1CrWLawWoPnu5abtU69v-=G-P7ysATQ2Pw@mail.gmail.com/
Signed-off-by: Aurelien Jarno <aurelien@aurel32.net>
Message-ID: <20241110114700.622372-1-aurelien@aurel32.net>
Signed-off-by: Ulf Hansson <ulf.hansson@linaro.org>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=938c13740f8b555986e53c0fcbaf00dcd1fabd4c)

| -rw-r--r-- | [drivers/mmc/host/dw\_mmc.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/mmc/host/dw_mmc.c?id=938c13740f8b555986e53c0fcbaf00dcd1fabd4c) | 4 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 2 insertions, 2 deletions

| diff --git a/drivers/mmc/host/dw\_mmc.c b/drivers/mmc/host/dw\_mmc.cindex dc7a5ad41c4206..4da525f9c11f04 100644--- a/[drivers/mmc/host/dw\_mmc.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/mmc/host/dw_mmc.c?id=0a5014ad37c77ac6a2c525137c00a0e1724f6020)+++ b/[drivers/mmc/host/dw\_mmc.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/mmc/host/dw_mmc.c?id=938c13740f8b555986e53c0fcbaf00dcd1fabd4c)@@ -2826,8 +2826,8 @@ static int dw\_mci\_init\_slot(struct dw\_mci \*host) if (host->use\_dma == TRANS\_MODE\_IDMAC) { mmc->max\_segs = host->ring\_size; mmc->max\_blk\_size = 65535;- mmc->max\_req\_size = DW\_MCI\_DESC\_DATA\_LENGTH \* host->ring\_size;- mmc->max\_seg\_size = mmc->max\_req\_size;+ mmc->max\_seg\_size = 0x1000;+ mmc->max\_req\_size = mmc->max\_seg\_size \* host->ring\_size; mmc->max\_blk\_count = mmc->max\_req\_size / 512; } else if (host->use\_dma == TRANS\_MODE\_EDMAC) { mmc->max\_segs = 64; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 23:07:21 +0000



=== Content from git.kernel.org_555bbb55_20250114_230845.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=f701eb601470bfc0a551913ce5f6ebaa770f0ce0)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=f701eb601470bfc0a551913ce5f6ebaa770f0ce0)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=f701eb601470bfc0a551913ce5f6ebaa770f0ce0)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=f701eb601470bfc0a551913ce5f6ebaa770f0ce0)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Aurelien Jarno <aurelien@aurel32.net> | 2024-11-10 12:46:36 +0100 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-14 19:50:36 +0100 |
| commit | [f701eb601470bfc0a551913ce5f6ebaa770f0ce0](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=f701eb601470bfc0a551913ce5f6ebaa770f0ce0) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=f701eb601470bfc0a551913ce5f6ebaa770f0ce0)) | |
| tree | [0e05e3b5dc5bd180db6b0ad0dc9553ec60287449](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=f701eb601470bfc0a551913ce5f6ebaa770f0ce0) | |
| parent | [d904e4d845aafbcfd8a40c1df7d999f02f062be8](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=d904e4d845aafbcfd8a40c1df7d999f02f062be8) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=f701eb601470bfc0a551913ce5f6ebaa770f0ce0&id2=d904e4d845aafbcfd8a40c1df7d999f02f062be8)) | |
| download | [linux-f701eb601470bfc0a551913ce5f6ebaa770f0ce0.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-f701eb601470bfc0a551913ce5f6ebaa770f0ce0.tar.gz) | |

Revert "mmc: dw\_mmc: Fix IDMAC operation with pages bigger than 4K"commit 1635e407a4a64d08a8517ac59ca14ad4fc785e75 upstream.
The commit 8396c793ffdf ("mmc: dw\_mmc: Fix IDMAC operation with pages
bigger than 4K") increased the max\_req\_size, even for 4K pages, causing
various issues:
- Panic booting the kernel/rootfs from an SD card on Rockchip RK3566
- Panic booting the kernel/rootfs from an SD card on StarFive JH7100
- "swiotlb buffer is full" and data corruption on StarFive JH7110
At this stage no fix have been found, so it's probably better to just
revert the change.
This reverts commit 8396c793ffdf28bb8aee7cfe0891080f8cab7890.
Cc: stable@vger.kernel.org
Cc: Sam Protsenko <semen.protsenko@linaro.org>
Fixes: 8396c793ffdf ("mmc: dw\_mmc: Fix IDMAC operation with pages bigger than 4K")
Closes: https://lore.kernel.org/linux-mmc/614692b4-1dbe-31b8-a34d-cb6db1909bb7@w6rz.net/
Closes: https://lore.kernel.org/linux-mmc/CAC8uq=Ppnmv98mpa1CrWLawWoPnu5abtU69v-=G-P7ysATQ2Pw@mail.gmail.com/
Signed-off-by: Aurelien Jarno <aurelien@aurel32.net>
Message-ID: <20241110114700.622372-1-aurelien@aurel32.net>
Signed-off-by: Ulf Hansson <ulf.hansson@linaro.org>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=f701eb601470bfc0a551913ce5f6ebaa770f0ce0)

| -rw-r--r-- | [drivers/mmc/host/dw\_mmc.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/mmc/host/dw_mmc.c?id=f701eb601470bfc0a551913ce5f6ebaa770f0ce0) | 4 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 2 insertions, 2 deletions

| diff --git a/drivers/mmc/host/dw\_mmc.c b/drivers/mmc/host/dw\_mmc.cindex 9a80de37acd44b..32927e66b60ca4 100644--- a/[drivers/mmc/host/dw\_mmc.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/mmc/host/dw_mmc.c?id=d904e4d845aafbcfd8a40c1df7d999f02f062be8)+++ b/[drivers/mmc/host/dw\_mmc.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/mmc/host/dw_mmc.c?id=f701eb601470bfc0a551913ce5f6ebaa770f0ce0)@@ -2903,8 +2903,8 @@ static int dw\_mci\_init\_slot(struct dw\_mci \*host) if (host->use\_dma == TRANS\_MODE\_IDMAC) { mmc->max\_segs = host->ring\_size; mmc->max\_blk\_size = 65535;- mmc->max\_req\_size = DW\_MCI\_DESC\_DATA\_LENGTH \* host->ring\_size;- mmc->max\_seg\_size = mmc->max\_req\_size;+ mmc->max\_seg\_size = 0x1000;+ mmc->max\_req\_size = mmc->max\_seg\_size \* host->ring\_size; mmc->max\_blk\_count = mmc->max\_req\_size / 512; } else if (host->use\_dma == TRANS\_MODE\_EDMAC) { mmc->max\_segs = 64; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 23:07:22 +0000



=== Content from git.kernel.org_d05ea2ba_20250114_230842.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=56de724c58c07a7ca3aac027cfd2ccb184ed9e4e)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=56de724c58c07a7ca3aac027cfd2ccb184ed9e4e)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=56de724c58c07a7ca3aac027cfd2ccb184ed9e4e)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=56de724c58c07a7ca3aac027cfd2ccb184ed9e4e)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Aurelien Jarno <aurelien@aurel32.net> | 2024-11-10 12:46:36 +0100 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-11-22 15:38:35 +0100 |
| commit | [56de724c58c07a7ca3aac027cfd2ccb184ed9e4e](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=56de724c58c07a7ca3aac027cfd2ccb184ed9e4e) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=56de724c58c07a7ca3aac027cfd2ccb184ed9e4e)) | |
| tree | [4400c09d8fe9d6b94381f33d98351cbd2a7b53a4](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=56de724c58c07a7ca3aac027cfd2ccb184ed9e4e) | |
| parent | [32fc8cedcba673096694804a908a2d95110113f5](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=32fc8cedcba673096694804a908a2d95110113f5) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=56de724c58c07a7ca3aac027cfd2ccb184ed9e4e&id2=32fc8cedcba673096694804a908a2d95110113f5)) | |
| download | [linux-56de724c58c07a7ca3aac027cfd2ccb184ed9e4e.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-56de724c58c07a7ca3aac027cfd2ccb184ed9e4e.tar.gz) | |

Revert "mmc: dw\_mmc: Fix IDMAC operation with pages bigger than 4K"commit 1635e407a4a64d08a8517ac59ca14ad4fc785e75 upstream.
The commit 8396c793ffdf ("mmc: dw\_mmc: Fix IDMAC operation with pages
bigger than 4K") increased the max\_req\_size, even for 4K pages, causing
various issues:
- Panic booting the kernel/rootfs from an SD card on Rockchip RK3566
- Panic booting the kernel/rootfs from an SD card on StarFive JH7100
- "swiotlb buffer is full" and data corruption on StarFive JH7110
At this stage no fix have been found, so it's probably better to just
revert the change.
This reverts commit 8396c793ffdf28bb8aee7cfe0891080f8cab7890.
Cc: stable@vger.kernel.org
Cc: Sam Protsenko <semen.protsenko@linaro.org>
Fixes: 8396c793ffdf ("mmc: dw\_mmc: Fix IDMAC operation with pages bigger than 4K")
Closes: https://lore.kernel.org/linux-mmc/614692b4-1dbe-31b8-a34d-cb6db1909bb7@w6rz.net/
Closes: https://lore.kernel.org/linux-mmc/CAC8uq=Ppnmv98mpa1CrWLawWoPnu5abtU69v-=G-P7ysATQ2Pw@mail.gmail.com/
Signed-off-by: Aurelien Jarno <aurelien@aurel32.net>
Message-ID: <20241110114700.622372-1-aurelien@aurel32.net>
Signed-off-by: Ulf Hansson <ulf.hansson@linaro.org>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=56de724c58c07a7ca3aac027cfd2ccb184ed9e4e)

| -rw-r--r-- | [drivers/mmc/host/dw\_mmc.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/mmc/host/dw_mmc.c?id=56de724c58c07a7ca3aac027cfd2ccb184ed9e4e) | 4 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 2 insertions, 2 deletions

| diff --git a/drivers/mmc/host/dw\_mmc.c b/drivers/mmc/host/dw\_mmc.cindex 2f0bc79ef856a8..02bee7afab37ef 100644--- a/[drivers/mmc/host/dw\_mmc.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/mmc/host/dw_mmc.c?id=32fc8cedcba673096694804a908a2d95110113f5)+++ b/[drivers/mmc/host/dw\_mmc.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/mmc/host/dw_mmc.c?id=56de724c58c07a7ca3aac027cfd2ccb184ed9e4e)@@ -2952,8 +2952,8 @@ static int dw\_mci\_init\_slot(struct dw\_mci \*host) if (host->use\_dma == TRANS\_MODE\_IDMAC) { mmc->max\_segs = host->ring\_size; mmc->max\_blk\_size = 65535;- mmc->max\_req\_size = DW\_MCI\_DESC\_DATA\_LENGTH \* host->ring\_size;- mmc->max\_seg\_size = mmc->max\_req\_size;+ mmc->max\_seg\_size = 0x1000;+ mmc->max\_req\_size = mmc->max\_seg\_size \* host->ring\_size; mmc->max\_blk\_count = mmc->max\_req\_size / 512; } else if (host->use\_dma == TRANS\_MODE\_EDMAC) { mmc->max\_segs = 64; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 23:07:19 +0000



=== Content from git.kernel.org_f1ef5ed3_20250114_230839.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=00bff71745bc3583bd5ca59be91e0ee1d27f1944)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=00bff71745bc3583bd5ca59be91e0ee1d27f1944)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=00bff71745bc3583bd5ca59be91e0ee1d27f1944)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=00bff71745bc3583bd5ca59be91e0ee1d27f1944)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Aurelien Jarno <aurelien@aurel32.net> | 2024-11-10 12:46:36 +0100 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-05 10:59:28 +0100 |
| commit | [00bff71745bc3583bd5ca59be91e0ee1d27f1944](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=00bff71745bc3583bd5ca59be91e0ee1d27f1944) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=00bff71745bc3583bd5ca59be91e0ee1d27f1944)) | |
| tree | [b52b80ba5214c35366f75313d007cd9ace43eabf](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=00bff71745bc3583bd5ca59be91e0ee1d27f1944) | |
| parent | [7af3309c7a2ef26831a67125b11c34a7e01c1b2a](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=7af3309c7a2ef26831a67125b11c34a7e01c1b2a) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=00bff71745bc3583bd5ca59be91e0ee1d27f1944&id2=7af3309c7a2ef26831a67125b11c34a7e01c1b2a)) | |
| download | [linux-00bff71745bc3583bd5ca59be91e0ee1d27f1944.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-00bff71745bc3583bd5ca59be91e0ee1d27f1944.tar.gz) | |

Revert "mmc: dw\_mmc: Fix IDMAC operation with pages bigger than 4K"commit 1635e407a4a64d08a8517ac59ca14ad4fc785e75 upstream.
The commit 8396c793ffdf ("mmc: dw\_mmc: Fix IDMAC operation with pages
bigger than 4K") increased the max\_req\_size, even for 4K pages, causing
various issues:
- Panic booting the kernel/rootfs from an SD card on Rockchip RK3566
- Panic booting the kernel/rootfs from an SD card on StarFive JH7100
- "swiotlb buffer is full" and data corruption on StarFive JH7110
At this stage no fix have been found, so it's probably better to just
revert the change.
This reverts commit 8396c793ffdf28bb8aee7cfe0891080f8cab7890.
Cc: stable@vger.kernel.org
Cc: Sam Protsenko <semen.protsenko@linaro.org>
Fixes: 8396c793ffdf ("mmc: dw\_mmc: Fix IDMAC operation with pages bigger than 4K")
Closes: https://lore.kernel.org/linux-mmc/614692b4-1dbe-31b8-a34d-cb6db1909bb7@w6rz.net/
Closes: https://lore.kernel.org/linux-mmc/CAC8uq=Ppnmv98mpa1CrWLawWoPnu5abtU69v-=G-P7ysATQ2Pw@mail.gmail.com/
Signed-off-by: Aurelien Jarno <aurelien@aurel32.net>
Message-ID: <20241110114700.622372-1-aurelien@aurel32.net>
Signed-off-by: Ulf Hansson <ulf.hansson@linaro.org>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=00bff71745bc3583bd5ca59be91e0ee1d27f1944)

| -rw-r--r-- | [drivers/mmc/host/dw\_mmc.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/mmc/host/dw_mmc.c?id=00bff71745bc3583bd5ca59be91e0ee1d27f1944) | 4 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 2 insertions, 2 deletions

| diff --git a/drivers/mmc/host/dw\_mmc.c b/drivers/mmc/host/dw\_mmc.cindex a35526ae7a258b..75355abe03c997 100644--- a/[drivers/mmc/host/dw\_mmc.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/mmc/host/dw_mmc.c?id=7af3309c7a2ef26831a67125b11c34a7e01c1b2a)+++ b/[drivers/mmc/host/dw\_mmc.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/mmc/host/dw_mmc.c?id=00bff71745bc3583bd5ca59be91e0ee1d27f1944)@@ -2857,8 +2857,8 @@ static int dw\_mci\_init\_slot(struct dw\_mci \*host) if (host->use\_dma == TRANS\_MODE\_IDMAC) { mmc->max\_segs = host->ring\_size; mmc->max\_blk\_size = 65535;- mmc->max\_req\_size = DW\_MCI\_DESC\_DATA\_LENGTH \* host->ring\_size;- mmc->max\_seg\_size = mmc->max\_req\_size;+ mmc->max\_seg\_size = 0x1000;+ mmc->max\_req\_size = mmc->max\_seg\_size \* host->ring\_size; mmc->max\_blk\_count = mmc->max\_req\_size / 512; } else if (host->use\_dma == TRANS\_MODE\_EDMAC) { mmc->max\_segs = 64; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 23:07:16 +0000


