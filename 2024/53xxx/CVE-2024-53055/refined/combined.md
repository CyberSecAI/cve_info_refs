=== Content from git.kernel.org_2849895b_20250114_202112.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=cde8a7eb5c6762264ff0f4433358e0a0d250c875)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=cde8a7eb5c6762264ff0f4433358e0a0d250c875)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=cde8a7eb5c6762264ff0f4433358e0a0d250c875)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=cde8a7eb5c6762264ff0f4433358e0a0d250c875)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Johannes Berg <johannes.berg@intel.com> | 2024-10-23 09:17:44 +0200 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-11-08 16:26:48 +0100 |
| commit | [cde8a7eb5c6762264ff0f4433358e0a0d250c875](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=cde8a7eb5c6762264ff0f4433358e0a0d250c875) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=cde8a7eb5c6762264ff0f4433358e0a0d250c875)) | |
| tree | [2ecc23f12743c6f28d446a729456f9b48718a438](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=cde8a7eb5c6762264ff0f4433358e0a0d250c875) | |
| parent | [cd0cdb51b15203fa27d4b714be83b7dfffa0b752](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=cd0cdb51b15203fa27d4b714be83b7dfffa0b752) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=cde8a7eb5c6762264ff0f4433358e0a0d250c875&id2=cd0cdb51b15203fa27d4b714be83b7dfffa0b752)) | |
| download | [linux-cde8a7eb5c6762264ff0f4433358e0a0d250c875.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-cde8a7eb5c6762264ff0f4433358e0a0d250c875.tar.gz) | |

wifi: iwlwifi: mvm: fix 6 GHz scan constructioncommit 7245012f0f496162dd95d888ed2ceb5a35170f1a upstream.
If more than 255 colocated APs exist for the set of all
APs found during 2.4/5 GHz scanning, then the 6 GHz scan
construction will loop forever since the loop variable
has type u8, which can never reach the number found when
that's bigger than 255, and is stored in a u32 variable.
Also move it into the loops to have a smaller scope.
Using a u32 there is fine, we limit the number of APs in
the scan list and each has a limit on the number of RNR
entries due to the frame size. With a limit of 1000 scan
results, a frame size upper bound of 4096 (really it's
more like ~2300) and a TBTT entry size of at least 11,
we get an upper bound for the number of ~372k, well in
the bounds of a u32.
Cc: stable@vger.kernel.org
Fixes: eae94cf82d74 ("iwlwifi: mvm: add support for 6GHz")
Closes: https://bugzilla.kernel.org/show\_bug.cgi?id=219375
Link: [https://patch.msgid.link/20241023091744.f4baed5c08a1.I8b417148bbc8c5d11c101e1b8f5bf372e17bf2a7@changeid](https://patch.msgid.link/20241023091744.f4baed5c08a1.I8b417148bbc8c5d11c101e1b8f5bf372e17bf2a7%40changeid)
Signed-off-by: Johannes Berg <johannes.berg@intel.com>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=cde8a7eb5c6762264ff0f4433358e0a0d250c875)

| -rw-r--r-- | [drivers/net/wireless/intel/iwlwifi/mvm/scan.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/wireless/intel/iwlwifi/mvm/scan.c?id=cde8a7eb5c6762264ff0f4433358e0a0d250c875) | 3 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 2 insertions, 1 deletions

| diff --git a/drivers/net/wireless/intel/iwlwifi/mvm/scan.c b/drivers/net/wireless/intel/iwlwifi/mvm/scan.cindex 1785fded6290ef..2a4c59c7144819 100644--- a/[drivers/net/wireless/intel/iwlwifi/mvm/scan.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/wireless/intel/iwlwifi/mvm/scan.c?id=cd0cdb51b15203fa27d4b714be83b7dfffa0b752)+++ b/[drivers/net/wireless/intel/iwlwifi/mvm/scan.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/wireless/intel/iwlwifi/mvm/scan.c?id=cde8a7eb5c6762264ff0f4433358e0a0d250c875)@@ -1739,7 +1739,8 @@ iwl\_mvm\_umac\_scan\_cfg\_channels\_v6\_6g(struct iwl\_mvm \*mvm, &cp->channel\_config[ch\_cnt];  u32 s\_ssid\_bitmap = 0, bssid\_bitmap = 0, flags = 0;- u8 j, k, s\_max = 0, b\_max = 0, n\_used\_bssid\_entries;+ u8 k, s\_max = 0, b\_max = 0, n\_used\_bssid\_entries;+ u32 j; bool force\_passive, found = false, allow\_passive = true, unsolicited\_probe\_on\_chan = false, psc\_no\_listen = false; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 20:19:48 +0000



=== Content from git.kernel.org_dd37800c_20250114_202109.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=2ccd5badadab2d586e91546bf5af3deda07fef1f)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=2ccd5badadab2d586e91546bf5af3deda07fef1f)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=2ccd5badadab2d586e91546bf5af3deda07fef1f)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=2ccd5badadab2d586e91546bf5af3deda07fef1f)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Johannes Berg <johannes.berg@intel.com> | 2024-10-23 09:17:44 +0200 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-11-08 16:30:54 +0100 |
| commit | [2ccd5badadab2d586e91546bf5af3deda07fef1f](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=2ccd5badadab2d586e91546bf5af3deda07fef1f) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=2ccd5badadab2d586e91546bf5af3deda07fef1f)) | |
| tree | [24679a98d9bcc7cea1eff900bcb676ad3065a86d](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=2ccd5badadab2d586e91546bf5af3deda07fef1f) | |
| parent | [8af8294d369a871cdbcdbb4d13b87d2d6e490a1f](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=8af8294d369a871cdbcdbb4d13b87d2d6e490a1f) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=2ccd5badadab2d586e91546bf5af3deda07fef1f&id2=8af8294d369a871cdbcdbb4d13b87d2d6e490a1f)) | |
| download | [linux-2ccd5badadab2d586e91546bf5af3deda07fef1f.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-2ccd5badadab2d586e91546bf5af3deda07fef1f.tar.gz) | |

wifi: iwlwifi: mvm: fix 6 GHz scan constructioncommit 7245012f0f496162dd95d888ed2ceb5a35170f1a upstream.
If more than 255 colocated APs exist for the set of all
APs found during 2.4/5 GHz scanning, then the 6 GHz scan
construction will loop forever since the loop variable
has type u8, which can never reach the number found when
that's bigger than 255, and is stored in a u32 variable.
Also move it into the loops to have a smaller scope.
Using a u32 there is fine, we limit the number of APs in
the scan list and each has a limit on the number of RNR
entries due to the frame size. With a limit of 1000 scan
results, a frame size upper bound of 4096 (really it's
more like ~2300) and a TBTT entry size of at least 11,
we get an upper bound for the number of ~372k, well in
the bounds of a u32.
Cc: stable@vger.kernel.org
Fixes: eae94cf82d74 ("iwlwifi: mvm: add support for 6GHz")
Closes: https://bugzilla.kernel.org/show\_bug.cgi?id=219375
Link: [https://patch.msgid.link/20241023091744.f4baed5c08a1.I8b417148bbc8c5d11c101e1b8f5bf372e17bf2a7@changeid](https://patch.msgid.link/20241023091744.f4baed5c08a1.I8b417148bbc8c5d11c101e1b8f5bf372e17bf2a7%40changeid)
Signed-off-by: Johannes Berg <johannes.berg@intel.com>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=2ccd5badadab2d586e91546bf5af3deda07fef1f)

| -rw-r--r-- | [drivers/net/wireless/intel/iwlwifi/mvm/scan.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/wireless/intel/iwlwifi/mvm/scan.c?id=2ccd5badadab2d586e91546bf5af3deda07fef1f) | 6 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 3 insertions, 3 deletions

| diff --git a/drivers/net/wireless/intel/iwlwifi/mvm/scan.c b/drivers/net/wireless/intel/iwlwifi/mvm/scan.cindex 3a9018595ea909..cfc50c7b294922 100644--- a/[drivers/net/wireless/intel/iwlwifi/mvm/scan.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/wireless/intel/iwlwifi/mvm/scan.c?id=8af8294d369a871cdbcdbb4d13b87d2d6e490a1f)+++ b/[drivers/net/wireless/intel/iwlwifi/mvm/scan.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/wireless/intel/iwlwifi/mvm/scan.c?id=2ccd5badadab2d586e91546bf5af3deda07fef1f)@@ -1774,7 +1774,7 @@ iwl\_mvm\_umac\_scan\_cfg\_channels\_v7\_6g(struct iwl\_mvm \*mvm, &cp->channel\_config[ch\_cnt];  u32 s\_ssid\_bitmap = 0, bssid\_bitmap = 0, flags = 0;- u8 j, k, n\_s\_ssids = 0, n\_bssids = 0;+ u8 k, n\_s\_ssids = 0, n\_bssids = 0; u8 max\_s\_ssids, max\_bssids; bool force\_passive = false, found = false, allow\_passive = true, unsolicited\_probe\_on\_chan = false, psc\_no\_listen = false;@@ -1799,7 +1799,7 @@ iwl\_mvm\_umac\_scan\_cfg\_channels\_v7\_6g(struct iwl\_mvm \*mvm, cfg->v5.iter\_count = 1; cfg->v5.iter\_interval = 0; - for (j = 0; j < params->n\_6ghz\_params; j++) {+ for (u32 j = 0; j < params->n\_6ghz\_params; j++) { s8 tmp\_psd\_20;  if (!(scan\_6ghz\_params[j].channel\_idx == i))@@ -1873,7 +1873,7 @@ iwl\_mvm\_umac\_scan\_cfg\_channels\_v7\_6g(struct iwl\_mvm \*mvm, \* SSID. \* TODO: improve this logic \*/- for (j = 0; j < params->n\_6ghz\_params; j++) {+ for (u32 j = 0; j < params->n\_6ghz\_params; j++) { if (!(scan\_6ghz\_params[j].channel\_idx == i)) continue; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 20:19:45 +0000



=== Content from git.kernel.org_67f6b802_20250114_202107.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=2ac15e5a8f42fed5d90ed9e1197600913678c50f)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=2ac15e5a8f42fed5d90ed9e1197600913678c50f)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=2ac15e5a8f42fed5d90ed9e1197600913678c50f)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=2ac15e5a8f42fed5d90ed9e1197600913678c50f)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Johannes Berg <johannes.berg@intel.com> | 2024-10-23 09:17:44 +0200 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-11-08 16:25:56 +0100 |
| commit | [2ac15e5a8f42fed5d90ed9e1197600913678c50f](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=2ac15e5a8f42fed5d90ed9e1197600913678c50f) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=2ac15e5a8f42fed5d90ed9e1197600913678c50f)) | |
| tree | [43df178524fc805abdfd09b776c8d5994cfb7834](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=2ac15e5a8f42fed5d90ed9e1197600913678c50f) | |
| parent | [f05dbebb8ee34882505d53d83af7d18f28a49248](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=f05dbebb8ee34882505d53d83af7d18f28a49248) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=2ac15e5a8f42fed5d90ed9e1197600913678c50f&id2=f05dbebb8ee34882505d53d83af7d18f28a49248)) | |
| download | [linux-2ac15e5a8f42fed5d90ed9e1197600913678c50f.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-2ac15e5a8f42fed5d90ed9e1197600913678c50f.tar.gz) | |

wifi: iwlwifi: mvm: fix 6 GHz scan constructioncommit 7245012f0f496162dd95d888ed2ceb5a35170f1a upstream.
If more than 255 colocated APs exist for the set of all
APs found during 2.4/5 GHz scanning, then the 6 GHz scan
construction will loop forever since the loop variable
has type u8, which can never reach the number found when
that's bigger than 255, and is stored in a u32 variable.
Also move it into the loops to have a smaller scope.
Using a u32 there is fine, we limit the number of APs in
the scan list and each has a limit on the number of RNR
entries due to the frame size. With a limit of 1000 scan
results, a frame size upper bound of 4096 (really it's
more like ~2300) and a TBTT entry size of at least 11,
we get an upper bound for the number of ~372k, well in
the bounds of a u32.
Cc: stable@vger.kernel.org
Fixes: eae94cf82d74 ("iwlwifi: mvm: add support for 6GHz")
Closes: https://bugzilla.kernel.org/show\_bug.cgi?id=219375
Link: [https://patch.msgid.link/20241023091744.f4baed5c08a1.I8b417148bbc8c5d11c101e1b8f5bf372e17bf2a7@changeid](https://patch.msgid.link/20241023091744.f4baed5c08a1.I8b417148bbc8c5d11c101e1b8f5bf372e17bf2a7%40changeid)
Signed-off-by: Johannes Berg <johannes.berg@intel.com>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=2ac15e5a8f42fed5d90ed9e1197600913678c50f)

| -rw-r--r-- | [drivers/net/wireless/intel/iwlwifi/mvm/scan.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/wireless/intel/iwlwifi/mvm/scan.c?id=2ac15e5a8f42fed5d90ed9e1197600913678c50f) | 3 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 2 insertions, 1 deletions

| diff --git a/drivers/net/wireless/intel/iwlwifi/mvm/scan.c b/drivers/net/wireless/intel/iwlwifi/mvm/scan.cindex aa6ef649120563..16818dcdae2247 100644--- a/[drivers/net/wireless/intel/iwlwifi/mvm/scan.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/wireless/intel/iwlwifi/mvm/scan.c?id=f05dbebb8ee34882505d53d83af7d18f28a49248)+++ b/[drivers/net/wireless/intel/iwlwifi/mvm/scan.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/wireless/intel/iwlwifi/mvm/scan.c?id=2ac15e5a8f42fed5d90ed9e1197600913678c50f)@@ -1753,7 +1753,8 @@ iwl\_mvm\_umac\_scan\_cfg\_channels\_v6\_6g(struct iwl\_mvm\_scan\_params \*params, &cp->channel\_config[i];  u32 s\_ssid\_bitmap = 0, bssid\_bitmap = 0, flags = 0;- u8 j, k, s\_max = 0, b\_max = 0, n\_used\_bssid\_entries;+ u8 k, s\_max = 0, b\_max = 0, n\_used\_bssid\_entries;+ u32 j; bool force\_passive, found = false, allow\_passive = true, unsolicited\_probe\_on\_chan = false, psc\_no\_listen = false; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 20:19:44 +0000



=== Content from git.kernel.org_ed214157_20250114_202115.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=fc621e7a043de346c33bd7ae7e2e0c651d6152ef)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=fc621e7a043de346c33bd7ae7e2e0c651d6152ef)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=fc621e7a043de346c33bd7ae7e2e0c651d6152ef)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=fc621e7a043de346c33bd7ae7e2e0c651d6152ef)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Johannes Berg <johannes.berg@intel.com> | 2024-10-23 09:17:44 +0200 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-11-08 16:28:27 +0100 |
| commit | [fc621e7a043de346c33bd7ae7e2e0c651d6152ef](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=fc621e7a043de346c33bd7ae7e2e0c651d6152ef) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=fc621e7a043de346c33bd7ae7e2e0c651d6152ef)) | |
| tree | [cebcf864560064a3f1109a84154506dda7fe8256](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=fc621e7a043de346c33bd7ae7e2e0c651d6152ef) | |
| parent | [f2f1fa446676c21edb777e6d2bc4fa8f956fab68](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=f2f1fa446676c21edb777e6d2bc4fa8f956fab68) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=fc621e7a043de346c33bd7ae7e2e0c651d6152ef&id2=f2f1fa446676c21edb777e6d2bc4fa8f956fab68)) | |
| download | [linux-fc621e7a043de346c33bd7ae7e2e0c651d6152ef.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-fc621e7a043de346c33bd7ae7e2e0c651d6152ef.tar.gz) | |

wifi: iwlwifi: mvm: fix 6 GHz scan constructioncommit 7245012f0f496162dd95d888ed2ceb5a35170f1a upstream.
If more than 255 colocated APs exist for the set of all
APs found during 2.4/5 GHz scanning, then the 6 GHz scan
construction will loop forever since the loop variable
has type u8, which can never reach the number found when
that's bigger than 255, and is stored in a u32 variable.
Also move it into the loops to have a smaller scope.
Using a u32 there is fine, we limit the number of APs in
the scan list and each has a limit on the number of RNR
entries due to the frame size. With a limit of 1000 scan
results, a frame size upper bound of 4096 (really it's
more like ~2300) and a TBTT entry size of at least 11,
we get an upper bound for the number of ~372k, well in
the bounds of a u32.
Cc: stable@vger.kernel.org
Fixes: eae94cf82d74 ("iwlwifi: mvm: add support for 6GHz")
Closes: https://bugzilla.kernel.org/show\_bug.cgi?id=219375
Link: [https://patch.msgid.link/20241023091744.f4baed5c08a1.I8b417148bbc8c5d11c101e1b8f5bf372e17bf2a7@changeid](https://patch.msgid.link/20241023091744.f4baed5c08a1.I8b417148bbc8c5d11c101e1b8f5bf372e17bf2a7%40changeid)
Signed-off-by: Johannes Berg <johannes.berg@intel.com>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=fc621e7a043de346c33bd7ae7e2e0c651d6152ef)

| -rw-r--r-- | [drivers/net/wireless/intel/iwlwifi/mvm/scan.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/wireless/intel/iwlwifi/mvm/scan.c?id=fc621e7a043de346c33bd7ae7e2e0c651d6152ef) | 3 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 2 insertions, 1 deletions

| diff --git a/drivers/net/wireless/intel/iwlwifi/mvm/scan.c b/drivers/net/wireless/intel/iwlwifi/mvm/scan.cindex ded06602f6ced3..cc866401aad0ba 100644--- a/[drivers/net/wireless/intel/iwlwifi/mvm/scan.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/wireless/intel/iwlwifi/mvm/scan.c?id=f2f1fa446676c21edb777e6d2bc4fa8f956fab68)+++ b/[drivers/net/wireless/intel/iwlwifi/mvm/scan.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/wireless/intel/iwlwifi/mvm/scan.c?id=fc621e7a043de346c33bd7ae7e2e0c651d6152ef)@@ -1751,7 +1751,8 @@ iwl\_mvm\_umac\_scan\_cfg\_channels\_v7\_6g(struct iwl\_mvm \*mvm, &cp->channel\_config[ch\_cnt];  u32 s\_ssid\_bitmap = 0, bssid\_bitmap = 0, flags = 0;- u8 j, k, s\_max = 0, b\_max = 0, n\_used\_bssid\_entries;+ u8 k, s\_max = 0, b\_max = 0, n\_used\_bssid\_entries;+ u32 j; bool force\_passive, found = false, allow\_passive = true, unsolicited\_probe\_on\_chan = false, psc\_no\_listen = false; s8 psd\_20 = IEEE80211\_RNR\_TBTT\_PARAMS\_PSD\_RESERVED; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 20:19:51 +0000



=== Content from git.kernel.org_340ab9aa_20250114_202110.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=7245012f0f496162dd95d888ed2ceb5a35170f1a)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=7245012f0f496162dd95d888ed2ceb5a35170f1a)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=7245012f0f496162dd95d888ed2ceb5a35170f1a)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=7245012f0f496162dd95d888ed2ceb5a35170f1a)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Johannes Berg <johannes.berg@intel.com> | 2024-10-23 09:17:44 +0200 |
| --- | --- | --- |
| committer | Johannes Berg <johannes.berg@intel.com> | 2024-10-25 17:53:47 +0200 |
| commit | [7245012f0f496162dd95d888ed2ceb5a35170f1a](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=7245012f0f496162dd95d888ed2ceb5a35170f1a) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=7245012f0f496162dd95d888ed2ceb5a35170f1a)) | |
| tree | [805499752f92833abe637e9c60b7914a55fefb69](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=7245012f0f496162dd95d888ed2ceb5a35170f1a) | |
| parent | [d5fee261dfd9e17b08b1df8471ac5d5736070917](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=d5fee261dfd9e17b08b1df8471ac5d5736070917) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=7245012f0f496162dd95d888ed2ceb5a35170f1a&id2=d5fee261dfd9e17b08b1df8471ac5d5736070917)) | |
| download | [linux-7245012f0f496162dd95d888ed2ceb5a35170f1a.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-7245012f0f496162dd95d888ed2ceb5a35170f1a.tar.gz) | |

wifi: iwlwifi: mvm: fix 6 GHz scan constructionIf more than 255 colocated APs exist for the set of all
APs found during 2.4/5 GHz scanning, then the 6 GHz scan
construction will loop forever since the loop variable
has type u8, which can never reach the number found when
that's bigger than 255, and is stored in a u32 variable.
Also move it into the loops to have a smaller scope.
Using a u32 there is fine, we limit the number of APs in
the scan list and each has a limit on the number of RNR
entries due to the frame size. With a limit of 1000 scan
results, a frame size upper bound of 4096 (really it's
more like ~2300) and a TBTT entry size of at least 11,
we get an upper bound for the number of ~372k, well in
the bounds of a u32.
Cc: stable@vger.kernel.org
Fixes: eae94cf82d74 ("iwlwifi: mvm: add support for 6GHz")
Closes: https://bugzilla.kernel.org/show\_bug.cgi?id=219375
Link: [https://patch.msgid.link/20241023091744.f4baed5c08a1.I8b417148bbc8c5d11c101e1b8f5bf372e17bf2a7@changeid](https://patch.msgid.link/20241023091744.f4baed5c08a1.I8b417148bbc8c5d11c101e1b8f5bf372e17bf2a7%40changeid)
Signed-off-by: Johannes Berg <johannes.berg@intel.com>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=7245012f0f496162dd95d888ed2ceb5a35170f1a)

| -rw-r--r-- | [drivers/net/wireless/intel/iwlwifi/mvm/scan.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/wireless/intel/iwlwifi/mvm/scan.c?id=7245012f0f496162dd95d888ed2ceb5a35170f1a) | 6 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 3 insertions, 3 deletions

| diff --git a/drivers/net/wireless/intel/iwlwifi/mvm/scan.c b/drivers/net/wireless/intel/iwlwifi/mvm/scan.cindex 3ce9150213a744..ddcbd80a49fb2b 100644--- a/[drivers/net/wireless/intel/iwlwifi/mvm/scan.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/wireless/intel/iwlwifi/mvm/scan.c?id=d5fee261dfd9e17b08b1df8471ac5d5736070917)+++ b/[drivers/net/wireless/intel/iwlwifi/mvm/scan.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/wireless/intel/iwlwifi/mvm/scan.c?id=7245012f0f496162dd95d888ed2ceb5a35170f1a)@@ -1774,7 +1774,7 @@ iwl\_mvm\_umac\_scan\_cfg\_channels\_v7\_6g(struct iwl\_mvm \*mvm, &cp->channel\_config[ch\_cnt];  u32 s\_ssid\_bitmap = 0, bssid\_bitmap = 0, flags = 0;- u8 j, k, n\_s\_ssids = 0, n\_bssids = 0;+ u8 k, n\_s\_ssids = 0, n\_bssids = 0; u8 max\_s\_ssids, max\_bssids; bool force\_passive = false, found = false, allow\_passive = true, unsolicited\_probe\_on\_chan = false, psc\_no\_listen = false;@@ -1799,7 +1799,7 @@ iwl\_mvm\_umac\_scan\_cfg\_channels\_v7\_6g(struct iwl\_mvm \*mvm, cfg->v5.iter\_count = 1; cfg->v5.iter\_interval = 0; - for (j = 0; j < params->n\_6ghz\_params; j++) {+ for (u32 j = 0; j < params->n\_6ghz\_params; j++) { s8 tmp\_psd\_20;  if (!(scan\_6ghz\_params[j].channel\_idx == i))@@ -1873,7 +1873,7 @@ iwl\_mvm\_umac\_scan\_cfg\_channels\_v7\_6g(struct iwl\_mvm \*mvm, \* SSID. \* TODO: improve this logic \*/- for (j = 0; j < params->n\_6ghz\_params; j++) {+ for (u32 j = 0; j < params->n\_6ghz\_params; j++) { if (!(scan\_6ghz\_params[j].channel\_idx == i)) continue; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 20:19:47 +0000


