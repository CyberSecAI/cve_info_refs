The provided content is related to CVE-2024-53089.

**Root cause of the vulnerability:**
The root cause is that on PREEMPT_RT enabled kernels, hrtimers that are not explicitly marked to expire in hard interrupt context are moved into soft interrupt expiry mode by default. This causes issues because the timers are canceled from a preempt-notifier, which is invoked with disabled preemption, which is not allowed on PREEMPT_RT. This leads to "scheduling while atomic" errors.

**Weaknesses/vulnerabilities present:**
- Incorrect hrtimer configuration for KVM on LoongArch architecture when PREEMPT_RT is enabled.
-  The hrtimer was not configured to expire in hard interrupt context and therefore defaulted to soft interrupt expiry mode.
- Canceling the timer from a preempt-notifier with disabled preemption is not allowed on PREEMPT_RT kernels.

**Impact of exploitation:**
- A "scheduling while atomic" bug occurs, leading to kernel panic and denial of service.
- The system can become unstable.

**Attack vectors:**
- The vulnerability is triggered when using KVM virtualization on LoongArch architecture with a PREEMPT_RT enabled kernel.
- An attacker could trigger this vulnerability by running a virtual machine in this environment.

**Required attacker capabilities/position:**
- The attacker needs to be able to run a virtual machine using KVM on a LoongArch system with a PREEMPT_RT enabled kernel.

**Additional details:**

The fix involves modifying the hrtimer initialization and start parameters to use `HRTIMER_MODE_ABS_PINNED_HARD` instead of `HRTIMER_MODE_ABS_PINNED`, which ensures the timer expires in hard-IRQ context even on -RT kernels. This prevents the "scheduling while atomic" error. The fix was applied to the `arch/loongarch/kvm/timer.c` and `arch/loongarch/kvm/vcpu.c` files.