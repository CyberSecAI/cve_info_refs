=== Content from git.kernel.org_600683a2_20250115_100312.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=73adbd92f3223dc0c3506822b71c6b259d5d537b)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=73adbd92f3223dc0c3506822b71c6b259d5d537b)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=73adbd92f3223dc0c3506822b71c6b259d5d537b)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=73adbd92f3223dc0c3506822b71c6b259d5d537b)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Huacai Chen <chenhuacai@loongson.cn> | 2024-10-23 22:15:44 +0800 |
| --- | --- | --- |
| committer | Huacai Chen <chenhuacai@loongson.cn> | 2024-10-23 22:15:44 +0800 |
| commit | [73adbd92f3223dc0c3506822b71c6b259d5d537b](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=73adbd92f3223dc0c3506822b71c6b259d5d537b) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=73adbd92f3223dc0c3506822b71c6b259d5d537b)) | |
| tree | [00d8093b9fada98dd53f67670aeecee70a39c38f](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=73adbd92f3223dc0c3506822b71c6b259d5d537b) | |
| parent | [3c252263be801f937f56b4bcd8e8e2b5307c1ce5](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=3c252263be801f937f56b4bcd8e8e2b5307c1ce5) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=73adbd92f3223dc0c3506822b71c6b259d5d537b&id2=3c252263be801f937f56b4bcd8e8e2b5307c1ce5)) | |
| download | [linux-73adbd92f3223dc0c3506822b71c6b259d5d537b.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-73adbd92f3223dc0c3506822b71c6b259d5d537b.tar.gz) | |

LoongArch: KVM: Mark hrtimer to expire in hard interrupt contextLike commit 2c0d278f3293f ("KVM: LAPIC: Mark hrtimer to expire in hard
interrupt context") and commit 9090825fa9974 ("KVM: arm/arm64: Let the
timer expire in hardirq context on RT"), On PREEMPT\_RT enabled kernels
unmarked hrtimers are moved into soft interrupt expiry mode by default.
Then the timers are canceled from an preempt-notifier which is invoked
with disabled preemption which is not allowed on PREEMPT\_RT.
The timer callback is short so in could be invoked in hard-IRQ context.
So let the timer expire on hard-IRQ context even on -RT.
This fix a "scheduling while atomic" bug for PREEMPT\_RT enabled kernels:
BUG: scheduling while atomic: qemu-system-loo/1011/0x00000002
Modules linked in: amdgpu rfkill nft\_fib\_inet nft\_fib\_ipv4 nft\_fib\_ipv6 nft\_fib nft\_reject\_inet nf\_reject\_ipv4 nf\_reject\_ipv6 nft\_reject nft\_ct nft\_chain\_nat ns
CPU: 1 UID: 0 PID: 1011 Comm: qemu-system-loo Tainted: G W 6.12.0-rc2+ #1774
Tainted: [W]=WARN
Hardware name: Loongson Loongson-3A5000-7A1000-1w-CRB/Loongson-LS3A5000-7A1000-1w-CRB, BIOS vUDK2018-LoongArch-V2.0.0-prebeta9 10/21/2022
Stack : ffffffffffffffff 0000000000000000 9000000004e3ea38 9000000116744000
90000001167475a0 0000000000000000 90000001167475a8 9000000005644830
90000000058dc000 90000000058dbff8 9000000116747420 0000000000000001
0000000000000001 6a613fc938313980 000000000790c000 90000001001c1140
00000000000003fe 0000000000000001 000000000000000d 0000000000000003
0000000000000030 00000000000003f3 000000000790c000 9000000116747830
90000000057ef000 0000000000000000 9000000005644830 0000000000000004
0000000000000000 90000000057f4b58 0000000000000001 9000000116747868
900000000451b600 9000000005644830 9000000003a13998 0000000010000020
00000000000000b0 0000000000000004 0000000000000000 0000000000071c1d
...
Call Trace:
[<9000000003a13998>] show\_stack+0x38/0x180
[<9000000004e3ea34>] dump\_stack\_lvl+0x84/0xc0
[<9000000003a71708>] \_\_schedule\_bug+0x48/0x60
[<9000000004e45734>] \_\_schedule+0x1114/0x1660
[<9000000004e46040>] schedule\_rtlock+0x20/0x60
[<9000000004e4e330>] rtlock\_slowlock\_locked+0x3f0/0x10a0
[<9000000004e4f038>] rt\_spin\_lock+0x58/0x80
[<9000000003b02d68>] hrtimer\_cancel\_wait\_running+0x68/0xc0
[<9000000003b02e30>] hrtimer\_cancel+0x70/0x80
[<ffff80000235eb70>] kvm\_restore\_timer+0x50/0x1a0 [kvm]
[<ffff8000023616c8>] kvm\_arch\_vcpu\_load+0x68/0x2a0 [kvm]
[<ffff80000234c2d4>] kvm\_sched\_in+0x34/0x60 [kvm]
[<9000000003a749a0>] finish\_task\_switch.isra.0+0x140/0x2e0
[<9000000004e44a70>] \_\_schedule+0x450/0x1660
[<9000000004e45cb0>] schedule+0x30/0x180
[<ffff800002354c70>] kvm\_vcpu\_block+0x70/0x120 [kvm]
[<ffff800002354d80>] kvm\_vcpu\_halt+0x60/0x3e0 [kvm]
[<ffff80000235b194>] kvm\_handle\_gspr+0x3f4/0x4e0 [kvm]
[<ffff80000235f548>] kvm\_handle\_exit+0x1c8/0x260 [kvm]
Reviewed-by: Bibo Mao <maobibo@loongson.cn>
Signed-off-by: Huacai Chen <chenhuacai@loongson.cn>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=73adbd92f3223dc0c3506822b71c6b259d5d537b)

| -rw-r--r-- | [arch/loongarch/kvm/timer.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/arch/loongarch/kvm/timer.c?id=73adbd92f3223dc0c3506822b71c6b259d5d537b) | 7 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |
| -rw-r--r-- | [arch/loongarch/kvm/vcpu.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/arch/loongarch/kvm/vcpu.c?id=73adbd92f3223dc0c3506822b71c6b259d5d537b) | 2 | |  |  |  | | --- | --- | --- | |

2 files changed, 5 insertions, 4 deletions

| diff --git a/arch/loongarch/kvm/timer.c b/arch/loongarch/kvm/timer.cindex 74a4b5c272d60e..32dc213374beac 100644--- a/[arch/loongarch/kvm/timer.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/loongarch/kvm/timer.c?id=3c252263be801f937f56b4bcd8e8e2b5307c1ce5)+++ b/[arch/loongarch/kvm/timer.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/loongarch/kvm/timer.c?id=73adbd92f3223dc0c3506822b71c6b259d5d537b)@@ -161,10 +161,11 @@ static void \_kvm\_save\_timer(struct kvm\_vcpu \*vcpu) if (kvm\_vcpu\_is\_blocking(vcpu)) {  /\*- \* HRTIMER\_MODE\_PINNED is suggested since vcpu may run in- \* the same physical cpu in next time+ \* HRTIMER\_MODE\_PINNED\_HARD is suggested since vcpu may run in+ \* the same physical cpu in next time, and the timer should run+ \* in hardirq context even in the PREEMPT\_RT case. \*/- hrtimer\_start(&vcpu->arch.swtimer, expire, HRTIMER\_MODE\_ABS\_PINNED);+ hrtimer\_start(&vcpu->arch.swtimer, expire, HRTIMER\_MODE\_ABS\_PINNED\_HARD); } } diff --git a/arch/loongarch/kvm/vcpu.c b/arch/loongarch/kvm/vcpu.cindex 0697b106425116..174734a23d0ac8 100644--- a/[arch/loongarch/kvm/vcpu.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/loongarch/kvm/vcpu.c?id=3c252263be801f937f56b4bcd8e8e2b5307c1ce5)+++ b/[arch/loongarch/kvm/vcpu.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/loongarch/kvm/vcpu.c?id=73adbd92f3223dc0c3506822b71c6b259d5d537b)@@ -1457,7 +1457,7 @@ int kvm\_arch\_vcpu\_create(struct kvm\_vcpu \*vcpu) vcpu->arch.vpid = 0; vcpu->arch.flush\_gpa = INVALID\_GPA; - hrtimer\_init(&vcpu->arch.swtimer, CLOCK\_MONOTONIC, HRTIMER\_MODE\_ABS\_PINNED);+ hrtimer\_init(&vcpu->arch.swtimer, CLOCK\_MONOTONIC, HRTIMER\_MODE\_ABS\_PINNED\_HARD); vcpu->arch.swtimer.function = kvm\_swtimer\_wakeup;  vcpu->arch.handle\_exit = kvm\_handle\_exit; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-15 10:01:48 +0000



=== Content from git.kernel.org_0489b4c6_20250115_100311.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=1e4c384a4be9ed1e069e24f388ab2ee9951b77b5)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=1e4c384a4be9ed1e069e24f388ab2ee9951b77b5)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=1e4c384a4be9ed1e069e24f388ab2ee9951b77b5)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=1e4c384a4be9ed1e069e24f388ab2ee9951b77b5)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Huacai Chen <chenhuacai@loongson.cn> | 2024-10-23 22:15:44 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-11-17 15:09:54 +0100 |
| commit | [1e4c384a4be9ed1e069e24f388ab2ee9951b77b5](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=1e4c384a4be9ed1e069e24f388ab2ee9951b77b5) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=1e4c384a4be9ed1e069e24f388ab2ee9951b77b5)) | |
| tree | [05e6b163adad483a5c9acfe2199866901653c34f](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=1e4c384a4be9ed1e069e24f388ab2ee9951b77b5) | |
| parent | [263ae51914d1ebbb847a50118936841238a22b3c](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=263ae51914d1ebbb847a50118936841238a22b3c) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=1e4c384a4be9ed1e069e24f388ab2ee9951b77b5&id2=263ae51914d1ebbb847a50118936841238a22b3c)) | |
| download | [linux-1e4c384a4be9ed1e069e24f388ab2ee9951b77b5.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-1e4c384a4be9ed1e069e24f388ab2ee9951b77b5.tar.gz) | |

LoongArch: KVM: Mark hrtimer to expire in hard interrupt context[ Upstream commit 73adbd92f3223dc0c3506822b71c6b259d5d537b ]
Like commit 2c0d278f3293f ("KVM: LAPIC: Mark hrtimer to expire in hard
interrupt context") and commit 9090825fa9974 ("KVM: arm/arm64: Let the
timer expire in hardirq context on RT"), On PREEMPT\_RT enabled kernels
unmarked hrtimers are moved into soft interrupt expiry mode by default.
Then the timers are canceled from an preempt-notifier which is invoked
with disabled preemption which is not allowed on PREEMPT\_RT.
The timer callback is short so in could be invoked in hard-IRQ context.
So let the timer expire on hard-IRQ context even on -RT.
This fix a "scheduling while atomic" bug for PREEMPT\_RT enabled kernels:
BUG: scheduling while atomic: qemu-system-loo/1011/0x00000002
Modules linked in: amdgpu rfkill nft\_fib\_inet nft\_fib\_ipv4 nft\_fib\_ipv6 nft\_fib nft\_reject\_inet nf\_reject\_ipv4 nf\_reject\_ipv6 nft\_reject nft\_ct nft\_chain\_nat ns
CPU: 1 UID: 0 PID: 1011 Comm: qemu-system-loo Tainted: G W 6.12.0-rc2+ #1774
Tainted: [W]=WARN
Hardware name: Loongson Loongson-3A5000-7A1000-1w-CRB/Loongson-LS3A5000-7A1000-1w-CRB, BIOS vUDK2018-LoongArch-V2.0.0-prebeta9 10/21/2022
Stack : ffffffffffffffff 0000000000000000 9000000004e3ea38 9000000116744000
90000001167475a0 0000000000000000 90000001167475a8 9000000005644830
90000000058dc000 90000000058dbff8 9000000116747420 0000000000000001
0000000000000001 6a613fc938313980 000000000790c000 90000001001c1140
00000000000003fe 0000000000000001 000000000000000d 0000000000000003
0000000000000030 00000000000003f3 000000000790c000 9000000116747830
90000000057ef000 0000000000000000 9000000005644830 0000000000000004
0000000000000000 90000000057f4b58 0000000000000001 9000000116747868
900000000451b600 9000000005644830 9000000003a13998 0000000010000020
00000000000000b0 0000000000000004 0000000000000000 0000000000071c1d
...
Call Trace:
[<9000000003a13998>] show\_stack+0x38/0x180
[<9000000004e3ea34>] dump\_stack\_lvl+0x84/0xc0
[<9000000003a71708>] \_\_schedule\_bug+0x48/0x60
[<9000000004e45734>] \_\_schedule+0x1114/0x1660
[<9000000004e46040>] schedule\_rtlock+0x20/0x60
[<9000000004e4e330>] rtlock\_slowlock\_locked+0x3f0/0x10a0
[<9000000004e4f038>] rt\_spin\_lock+0x58/0x80
[<9000000003b02d68>] hrtimer\_cancel\_wait\_running+0x68/0xc0
[<9000000003b02e30>] hrtimer\_cancel+0x70/0x80
[<ffff80000235eb70>] kvm\_restore\_timer+0x50/0x1a0 [kvm]
[<ffff8000023616c8>] kvm\_arch\_vcpu\_load+0x68/0x2a0 [kvm]
[<ffff80000234c2d4>] kvm\_sched\_in+0x34/0x60 [kvm]
[<9000000003a749a0>] finish\_task\_switch.isra.0+0x140/0x2e0
[<9000000004e44a70>] \_\_schedule+0x450/0x1660
[<9000000004e45cb0>] schedule+0x30/0x180
[<ffff800002354c70>] kvm\_vcpu\_block+0x70/0x120 [kvm]
[<ffff800002354d80>] kvm\_vcpu\_halt+0x60/0x3e0 [kvm]
[<ffff80000235b194>] kvm\_handle\_gspr+0x3f4/0x4e0 [kvm]
[<ffff80000235f548>] kvm\_handle\_exit+0x1c8/0x260 [kvm]
Reviewed-by: Bibo Mao <maobibo@loongson.cn>
Signed-off-by: Huacai Chen <chenhuacai@loongson.cn>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=1e4c384a4be9ed1e069e24f388ab2ee9951b77b5)

| -rw-r--r-- | [arch/loongarch/kvm/timer.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/arch/loongarch/kvm/timer.c?id=1e4c384a4be9ed1e069e24f388ab2ee9951b77b5) | 7 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |
| -rw-r--r-- | [arch/loongarch/kvm/vcpu.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/arch/loongarch/kvm/vcpu.c?id=1e4c384a4be9ed1e069e24f388ab2ee9951b77b5) | 2 | |  |  |  | | --- | --- | --- | |

2 files changed, 5 insertions, 4 deletions

| diff --git a/arch/loongarch/kvm/timer.c b/arch/loongarch/kvm/timer.cindex 74a4b5c272d60e..32dc213374beac 100644--- a/[arch/loongarch/kvm/timer.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/loongarch/kvm/timer.c?id=263ae51914d1ebbb847a50118936841238a22b3c)+++ b/[arch/loongarch/kvm/timer.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/loongarch/kvm/timer.c?id=1e4c384a4be9ed1e069e24f388ab2ee9951b77b5)@@ -161,10 +161,11 @@ static void \_kvm\_save\_timer(struct kvm\_vcpu \*vcpu) if (kvm\_vcpu\_is\_blocking(vcpu)) {  /\*- \* HRTIMER\_MODE\_PINNED is suggested since vcpu may run in- \* the same physical cpu in next time+ \* HRTIMER\_MODE\_PINNED\_HARD is suggested since vcpu may run in+ \* the same physical cpu in next time, and the timer should run+ \* in hardirq context even in the PREEMPT\_RT case. \*/- hrtimer\_start(&vcpu->arch.swtimer, expire, HRTIMER\_MODE\_ABS\_PINNED);+ hrtimer\_start(&vcpu->arch.swtimer, expire, HRTIMER\_MODE\_ABS\_PINNED\_HARD); } } diff --git a/arch/loongarch/kvm/vcpu.c b/arch/loongarch/kvm/vcpu.cindex 6905283f535b96..9218fc521c22dc 100644--- a/[arch/loongarch/kvm/vcpu.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/loongarch/kvm/vcpu.c?id=263ae51914d1ebbb847a50118936841238a22b3c)+++ b/[arch/loongarch/kvm/vcpu.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/loongarch/kvm/vcpu.c?id=1e4c384a4be9ed1e069e24f388ab2ee9951b77b5)@@ -1144,7 +1144,7 @@ int kvm\_arch\_vcpu\_create(struct kvm\_vcpu \*vcpu) vcpu->arch.vpid = 0; vcpu->arch.flush\_gpa = INVALID\_GPA; - hrtimer\_init(&vcpu->arch.swtimer, CLOCK\_MONOTONIC, HRTIMER\_MODE\_ABS\_PINNED);+ hrtimer\_init(&vcpu->arch.swtimer, CLOCK\_MONOTONIC, HRTIMER\_MODE\_ABS\_PINNED\_HARD); vcpu->arch.swtimer.function = kvm\_swtimer\_wakeup;  vcpu->arch.handle\_exit = kvm\_handle\_exit; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-15 10:01:48 +0000


