=== Content from git.kernel.org_9f2ac9de_20250115_080813.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=1cfae9575296f5040cdc84b0730e79078c081d2d)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=1cfae9575296f5040cdc84b0730e79078c081d2d)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=1cfae9575296f5040cdc84b0730e79078c081d2d)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=1cfae9575296f5040cdc84b0730e79078c081d2d)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Trond Myklebust <trond.myklebust@hammerspace.com> | 2024-11-08 12:13:31 -0500 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-05 10:59:41 +0100 |
| commit | [1cfae9575296f5040cdc84b0730e79078c081d2d](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=1cfae9575296f5040cdc84b0730e79078c081d2d) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=1cfae9575296f5040cdc84b0730e79078c081d2d)) | |
| tree | [fa39ab47a8e565d872936a136c611549c6ad92ce](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=1cfae9575296f5040cdc84b0730e79078c081d2d) | |
| parent | [8ff07524ca2972db2d0e40d6fbf4ff36693155b0](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=8ff07524ca2972db2d0e40d6fbf4ff36693155b0) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=1cfae9575296f5040cdc84b0730e79078c081d2d&id2=8ff07524ca2972db2d0e40d6fbf4ff36693155b0)) | |
| download | [linux-1cfae9575296f5040cdc84b0730e79078c081d2d.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-1cfae9575296f5040cdc84b0730e79078c081d2d.tar.gz) | |

NFSv4.0: Fix a use-after-free problem in the asynchronous open()[ Upstream commit 2fdb05dc0931250574f0cb0ebeb5ed8e20f4a889 ]
Yang Erkun reports that when two threads are opening files at the same
time, and are forced to abort before a reply is seen, then the call to
nfs\_release\_seqid() in nfs4\_opendata\_free() can result in a
use-after-free of the pointer to the defunct rpc task of the other
thread.
The fix is to ensure that if the RPC call is aborted before the call to
nfs\_wait\_on\_sequence() is complete, then we must call nfs\_release\_seqid()
in nfs4\_open\_release() before the rpc\_task is freed.
Reported-by: Yang Erkun <yangerkun@huawei.com>
Fixes: 24ac23ab88df ("NFSv4: Convert open() into an asynchronous RPC call")
Reviewed-by: Yang Erkun <yangerkun@huawei.com>
Signed-off-by: Trond Myklebust <trond.myklebust@hammerspace.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=1cfae9575296f5040cdc84b0730e79078c081d2d)

| -rw-r--r-- | [fs/nfs/nfs4proc.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/fs/nfs/nfs4proc.c?id=1cfae9575296f5040cdc84b0730e79078c081d2d) | 8 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 5 insertions, 3 deletions

| diff --git a/fs/nfs/nfs4proc.c b/fs/nfs/nfs4proc.cindex c9db9a0fc7337b..66db81a90ceeee 100644--- a/[fs/nfs/nfs4proc.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/nfs/nfs4proc.c?id=8ff07524ca2972db2d0e40d6fbf4ff36693155b0)+++ b/[fs/nfs/nfs4proc.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/nfs/nfs4proc.c?id=1cfae9575296f5040cdc84b0730e79078c081d2d)@@ -2379,12 +2379,14 @@ static void nfs4\_open\_release(void \*calldata) struct nfs4\_opendata \*data = calldata; struct nfs4\_state \*state = NULL; + /\* In case of error, no cleanup! \*/+ if (data->rpc\_status != 0 || !data->rpc\_done) {+ nfs\_release\_seqid(data->o\_arg.seqid);+ goto out\_free;+ } /\* If this request hasn't been cancelled, do nothing \*/ if (!data->cancelled) goto out\_free;- /\* In case of error, no cleanup! \*/- if (data->rpc\_status != 0 || !data->rpc\_done)- goto out\_free; /\* In case we need an open\_confirm, no cleanup! \*/ if (data->o\_res.rflags & NFS4\_OPEN\_RESULT\_CONFIRM) goto out\_free; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-15 08:06:50 +0000



=== Content from git.kernel.org_14047ac0_20250115_080824.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=ba6e6c04f60fe52d91520ac4d749d372d4c74521)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=ba6e6c04f60fe52d91520ac4d749d372d4c74521)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=ba6e6c04f60fe52d91520ac4d749d372d4c74521)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=ba6e6c04f60fe52d91520ac4d749d372d4c74521)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Trond Myklebust <trond.myklebust@hammerspace.com> | 2024-11-08 12:13:31 -0500 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-14 19:54:07 +0100 |
| commit | [ba6e6c04f60fe52d91520ac4d749d372d4c74521](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=ba6e6c04f60fe52d91520ac4d749d372d4c74521) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=ba6e6c04f60fe52d91520ac4d749d372d4c74521)) | |
| tree | [1a973e0ffd1023b74cc849d8e135eb1e875d5f94](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=ba6e6c04f60fe52d91520ac4d749d372d4c74521) | |
| parent | [8a73401dacf0d93febadc2e1457fae2f9e2b066f](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=8a73401dacf0d93febadc2e1457fae2f9e2b066f) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=ba6e6c04f60fe52d91520ac4d749d372d4c74521&id2=8a73401dacf0d93febadc2e1457fae2f9e2b066f)) | |
| download | [linux-ba6e6c04f60fe52d91520ac4d749d372d4c74521.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-ba6e6c04f60fe52d91520ac4d749d372d4c74521.tar.gz) | |

NFSv4.0: Fix a use-after-free problem in the asynchronous open()[ Upstream commit 2fdb05dc0931250574f0cb0ebeb5ed8e20f4a889 ]
Yang Erkun reports that when two threads are opening files at the same
time, and are forced to abort before a reply is seen, then the call to
nfs\_release\_seqid() in nfs4\_opendata\_free() can result in a
use-after-free of the pointer to the defunct rpc task of the other
thread.
The fix is to ensure that if the RPC call is aborted before the call to
nfs\_wait\_on\_sequence() is complete, then we must call nfs\_release\_seqid()
in nfs4\_open\_release() before the rpc\_task is freed.
Reported-by: Yang Erkun <yangerkun@huawei.com>
Fixes: 24ac23ab88df ("NFSv4: Convert open() into an asynchronous RPC call")
Reviewed-by: Yang Erkun <yangerkun@huawei.com>
Signed-off-by: Trond Myklebust <trond.myklebust@hammerspace.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=ba6e6c04f60fe52d91520ac4d749d372d4c74521)

| -rw-r--r-- | [fs/nfs/nfs4proc.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/fs/nfs/nfs4proc.c?id=ba6e6c04f60fe52d91520ac4d749d372d4c74521) | 8 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 5 insertions, 3 deletions

| diff --git a/fs/nfs/nfs4proc.c b/fs/nfs/nfs4proc.cindex 1e97de7c8c204b..5b06b8d4e01475 100644--- a/[fs/nfs/nfs4proc.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/nfs/nfs4proc.c?id=8a73401dacf0d93febadc2e1457fae2f9e2b066f)+++ b/[fs/nfs/nfs4proc.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/nfs/nfs4proc.c?id=ba6e6c04f60fe52d91520ac4d749d372d4c74521)@@ -2528,12 +2528,14 @@ static void nfs4\_open\_release(void \*calldata) struct nfs4\_opendata \*data = calldata; struct nfs4\_state \*state = NULL; + /\* In case of error, no cleanup! \*/+ if (data->rpc\_status != 0 || !data->rpc\_done) {+ nfs\_release\_seqid(data->o\_arg.seqid);+ goto out\_free;+ } /\* If this request hasn't been cancelled, do nothing \*/ if (!data->cancelled) goto out\_free;- /\* In case of error, no cleanup! \*/- if (data->rpc\_status != 0 || !data->rpc\_done)- goto out\_free; /\* In case we need an open\_confirm, no cleanup! \*/ if (data->o\_res.rflags & NFS4\_OPEN\_RESULT\_CONFIRM) goto out\_free; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-15 08:07:00 +0000



=== Content from git.kernel.org_b8ffda6f_20250115_080822.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=b56ae8e715557b4fc227c9381d2e681ffafe7b15)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=b56ae8e715557b4fc227c9381d2e681ffafe7b15)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=b56ae8e715557b4fc227c9381d2e681ffafe7b15)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b56ae8e715557b4fc227c9381d2e681ffafe7b15)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Trond Myklebust <trond.myklebust@hammerspace.com> | 2024-11-08 12:13:31 -0500 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-05 14:03:03 +0100 |
| commit | [b56ae8e715557b4fc227c9381d2e681ffafe7b15](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=b56ae8e715557b4fc227c9381d2e681ffafe7b15) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=b56ae8e715557b4fc227c9381d2e681ffafe7b15)) | |
| tree | [35eb47ee995117d234f5e11ff938a93d5e03c652](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=b56ae8e715557b4fc227c9381d2e681ffafe7b15) | |
| parent | [f1ed1fbad9a841df324464c1ee4631c1b9633869](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=f1ed1fbad9a841df324464c1ee4631c1b9633869) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b56ae8e715557b4fc227c9381d2e681ffafe7b15&id2=f1ed1fbad9a841df324464c1ee4631c1b9633869)) | |
| download | [linux-b56ae8e715557b4fc227c9381d2e681ffafe7b15.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-b56ae8e715557b4fc227c9381d2e681ffafe7b15.tar.gz) | |

NFSv4.0: Fix a use-after-free problem in the asynchronous open()[ Upstream commit 2fdb05dc0931250574f0cb0ebeb5ed8e20f4a889 ]
Yang Erkun reports that when two threads are opening files at the same
time, and are forced to abort before a reply is seen, then the call to
nfs\_release\_seqid() in nfs4\_opendata\_free() can result in a
use-after-free of the pointer to the defunct rpc task of the other
thread.
The fix is to ensure that if the RPC call is aborted before the call to
nfs\_wait\_on\_sequence() is complete, then we must call nfs\_release\_seqid()
in nfs4\_open\_release() before the rpc\_task is freed.
Reported-by: Yang Erkun <yangerkun@huawei.com>
Fixes: 24ac23ab88df ("NFSv4: Convert open() into an asynchronous RPC call")
Reviewed-by: Yang Erkun <yangerkun@huawei.com>
Signed-off-by: Trond Myklebust <trond.myklebust@hammerspace.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b56ae8e715557b4fc227c9381d2e681ffafe7b15)

| -rw-r--r-- | [fs/nfs/nfs4proc.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/fs/nfs/nfs4proc.c?id=b56ae8e715557b4fc227c9381d2e681ffafe7b15) | 8 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 5 insertions, 3 deletions

| diff --git a/fs/nfs/nfs4proc.c b/fs/nfs/nfs4proc.cindex 9d40319e063dea..405f17e6e0b45b 100644--- a/[fs/nfs/nfs4proc.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/nfs/nfs4proc.c?id=f1ed1fbad9a841df324464c1ee4631c1b9633869)+++ b/[fs/nfs/nfs4proc.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/nfs/nfs4proc.c?id=b56ae8e715557b4fc227c9381d2e681ffafe7b15)@@ -2603,12 +2603,14 @@ static void nfs4\_open\_release(void \*calldata) struct nfs4\_opendata \*data = calldata; struct nfs4\_state \*state = NULL; + /\* In case of error, no cleanup! \*/+ if (data->rpc\_status != 0 || !data->rpc\_done) {+ nfs\_release\_seqid(data->o\_arg.seqid);+ goto out\_free;+ } /\* If this request hasn't been cancelled, do nothing \*/ if (!data->cancelled) goto out\_free;- /\* In case of error, no cleanup! \*/- if (data->rpc\_status != 0 || !data->rpc\_done)- goto out\_free; /\* In case we need an open\_confirm, no cleanup! \*/ if (data->o\_res.rflags & NFS4\_OPEN\_RESULT\_CONFIRM) goto out\_free; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-15 08:06:59 +0000



=== Content from git.kernel.org_de108a5a_20250115_080815.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=229a30ed42bb87bcb044c5523fabd9e4f0e75648)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=229a30ed42bb87bcb044c5523fabd9e4f0e75648)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=229a30ed42bb87bcb044c5523fabd9e4f0e75648)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=229a30ed42bb87bcb044c5523fabd9e4f0e75648)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Trond Myklebust <trond.myklebust@hammerspace.com> | 2024-11-08 12:13:31 -0500 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-09 10:32:54 +0100 |
| commit | [229a30ed42bb87bcb044c5523fabd9e4f0e75648](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=229a30ed42bb87bcb044c5523fabd9e4f0e75648) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=229a30ed42bb87bcb044c5523fabd9e4f0e75648)) | |
| tree | [f4fea9e3026caf17342f0cf8f33c1dc4c1384c61](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=229a30ed42bb87bcb044c5523fabd9e4f0e75648) | |
| parent | [e7b5a40b9b3878698f5c550e6413dd19113acda8](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=e7b5a40b9b3878698f5c550e6413dd19113acda8) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=229a30ed42bb87bcb044c5523fabd9e4f0e75648&id2=e7b5a40b9b3878698f5c550e6413dd19113acda8)) | |
| download | [linux-229a30ed42bb87bcb044c5523fabd9e4f0e75648.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-229a30ed42bb87bcb044c5523fabd9e4f0e75648.tar.gz) | |

NFSv4.0: Fix a use-after-free problem in the asynchronous open()[ Upstream commit 2fdb05dc0931250574f0cb0ebeb5ed8e20f4a889 ]
Yang Erkun reports that when two threads are opening files at the same
time, and are forced to abort before a reply is seen, then the call to
nfs\_release\_seqid() in nfs4\_opendata\_free() can result in a
use-after-free of the pointer to the defunct rpc task of the other
thread.
The fix is to ensure that if the RPC call is aborted before the call to
nfs\_wait\_on\_sequence() is complete, then we must call nfs\_release\_seqid()
in nfs4\_open\_release() before the rpc\_task is freed.
Reported-by: Yang Erkun <yangerkun@huawei.com>
Fixes: 24ac23ab88df ("NFSv4: Convert open() into an asynchronous RPC call")
Reviewed-by: Yang Erkun <yangerkun@huawei.com>
Signed-off-by: Trond Myklebust <trond.myklebust@hammerspace.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=229a30ed42bb87bcb044c5523fabd9e4f0e75648)

| -rw-r--r-- | [fs/nfs/nfs4proc.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/fs/nfs/nfs4proc.c?id=229a30ed42bb87bcb044c5523fabd9e4f0e75648) | 8 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 5 insertions, 3 deletions

| diff --git a/fs/nfs/nfs4proc.c b/fs/nfs/nfs4proc.cindex 299ea2b86df668..4b12e45f575394 100644--- a/[fs/nfs/nfs4proc.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/nfs/nfs4proc.c?id=e7b5a40b9b3878698f5c550e6413dd19113acda8)+++ b/[fs/nfs/nfs4proc.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/nfs/nfs4proc.c?id=229a30ed42bb87bcb044c5523fabd9e4f0e75648)@@ -2528,12 +2528,14 @@ static void nfs4\_open\_release(void \*calldata) struct nfs4\_opendata \*data = calldata; struct nfs4\_state \*state = NULL; + /\* In case of error, no cleanup! \*/+ if (data->rpc\_status != 0 || !data->rpc\_done) {+ nfs\_release\_seqid(data->o\_arg.seqid);+ goto out\_free;+ } /\* If this request hasn't been cancelled, do nothing \*/ if (!data->cancelled) goto out\_free;- /\* In case of error, no cleanup! \*/- if (data->rpc\_status != 0 || !data->rpc\_done)- goto out\_free; /\* In case we need an open\_confirm, no cleanup! \*/ if (data->o\_res.rflags & NFS4\_OPEN\_RESULT\_CONFIRM) goto out\_free; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-15 08:06:52 +0000



=== Content from git.kernel.org_7b0473b0_20250115_080825.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=e2277a1d9d5cd0d625a4fd7c04fce2b53e66df77)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=e2277a1d9d5cd0d625a4fd7c04fce2b53e66df77)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=e2277a1d9d5cd0d625a4fd7c04fce2b53e66df77)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e2277a1d9d5cd0d625a4fd7c04fce2b53e66df77)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Trond Myklebust <trond.myklebust@hammerspace.com> | 2024-11-08 12:13:31 -0500 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-05 13:54:27 +0100 |
| commit | [e2277a1d9d5cd0d625a4fd7c04fce2b53e66df77](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=e2277a1d9d5cd0d625a4fd7c04fce2b53e66df77) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=e2277a1d9d5cd0d625a4fd7c04fce2b53e66df77)) | |
| tree | [da99fd6ff7e67477177cb39d860336f34cf816cf](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=e2277a1d9d5cd0d625a4fd7c04fce2b53e66df77) | |
| parent | [7e8cf283d25f3acf247d6e2d5f72f0a07db81ada](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=7e8cf283d25f3acf247d6e2d5f72f0a07db81ada) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e2277a1d9d5cd0d625a4fd7c04fce2b53e66df77&id2=7e8cf283d25f3acf247d6e2d5f72f0a07db81ada)) | |
| download | [linux-e2277a1d9d5cd0d625a4fd7c04fce2b53e66df77.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-e2277a1d9d5cd0d625a4fd7c04fce2b53e66df77.tar.gz) | |

NFSv4.0: Fix a use-after-free problem in the asynchronous open()[ Upstream commit 2fdb05dc0931250574f0cb0ebeb5ed8e20f4a889 ]
Yang Erkun reports that when two threads are opening files at the same
time, and are forced to abort before a reply is seen, then the call to
nfs\_release\_seqid() in nfs4\_opendata\_free() can result in a
use-after-free of the pointer to the defunct rpc task of the other
thread.
The fix is to ensure that if the RPC call is aborted before the call to
nfs\_wait\_on\_sequence() is complete, then we must call nfs\_release\_seqid()
in nfs4\_open\_release() before the rpc\_task is freed.
Reported-by: Yang Erkun <yangerkun@huawei.com>
Fixes: 24ac23ab88df ("NFSv4: Convert open() into an asynchronous RPC call")
Reviewed-by: Yang Erkun <yangerkun@huawei.com>
Signed-off-by: Trond Myklebust <trond.myklebust@hammerspace.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e2277a1d9d5cd0d625a4fd7c04fce2b53e66df77)

| -rw-r--r-- | [fs/nfs/nfs4proc.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/fs/nfs/nfs4proc.c?id=e2277a1d9d5cd0d625a4fd7c04fce2b53e66df77) | 8 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 5 insertions, 3 deletions

| diff --git a/fs/nfs/nfs4proc.c b/fs/nfs/nfs4proc.cindex 9d40319e063dea..405f17e6e0b45b 100644--- a/[fs/nfs/nfs4proc.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/nfs/nfs4proc.c?id=7e8cf283d25f3acf247d6e2d5f72f0a07db81ada)+++ b/[fs/nfs/nfs4proc.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/nfs/nfs4proc.c?id=e2277a1d9d5cd0d625a4fd7c04fce2b53e66df77)@@ -2603,12 +2603,14 @@ static void nfs4\_open\_release(void \*calldata) struct nfs4\_opendata \*data = calldata; struct nfs4\_state \*state = NULL; + /\* In case of error, no cleanup! \*/+ if (data->rpc\_status != 0 || !data->rpc\_done) {+ nfs\_release\_seqid(data->o\_arg.seqid);+ goto out\_free;+ } /\* If this request hasn't been cancelled, do nothing \*/ if (!data->cancelled) goto out\_free;- /\* In case of error, no cleanup! \*/- if (data->rpc\_status != 0 || !data->rpc\_done)- goto out\_free; /\* In case we need an open\_confirm, no cleanup! \*/ if (data->o\_res.rflags & NFS4\_OPEN\_RESULT\_CONFIRM) goto out\_free; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-15 08:07:02 +0000



=== Content from git.kernel.org_5ebc2ca2_20250115_080819.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=5237a297ffd374a1c4157a53543b7a69d7bbbc03)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=5237a297ffd374a1c4157a53543b7a69d7bbbc03)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=5237a297ffd374a1c4157a53543b7a69d7bbbc03)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=5237a297ffd374a1c4157a53543b7a69d7bbbc03)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Trond Myklebust <trond.myklebust@hammerspace.com> | 2024-11-08 12:13:31 -0500 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-14 19:48:13 +0100 |
| commit | [5237a297ffd374a1c4157a53543b7a69d7bbbc03](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=5237a297ffd374a1c4157a53543b7a69d7bbbc03) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=5237a297ffd374a1c4157a53543b7a69d7bbbc03)) | |
| tree | [a502e23573ccc5ad00e5db000677d9d4a1c957a8](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=5237a297ffd374a1c4157a53543b7a69d7bbbc03) | |
| parent | [2365f57820c0fbecf4dc8ce4c8b3b1077b60e1f0](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=2365f57820c0fbecf4dc8ce4c8b3b1077b60e1f0) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=5237a297ffd374a1c4157a53543b7a69d7bbbc03&id2=2365f57820c0fbecf4dc8ce4c8b3b1077b60e1f0)) | |
| download | [linux-5237a297ffd374a1c4157a53543b7a69d7bbbc03.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-5237a297ffd374a1c4157a53543b7a69d7bbbc03.tar.gz) | |

NFSv4.0: Fix a use-after-free problem in the asynchronous open()[ Upstream commit 2fdb05dc0931250574f0cb0ebeb5ed8e20f4a889 ]
Yang Erkun reports that when two threads are opening files at the same
time, and are forced to abort before a reply is seen, then the call to
nfs\_release\_seqid() in nfs4\_opendata\_free() can result in a
use-after-free of the pointer to the defunct rpc task of the other
thread.
The fix is to ensure that if the RPC call is aborted before the call to
nfs\_wait\_on\_sequence() is complete, then we must call nfs\_release\_seqid()
in nfs4\_open\_release() before the rpc\_task is freed.
Reported-by: Yang Erkun <yangerkun@huawei.com>
Fixes: 24ac23ab88df ("NFSv4: Convert open() into an asynchronous RPC call")
Reviewed-by: Yang Erkun <yangerkun@huawei.com>
Signed-off-by: Trond Myklebust <trond.myklebust@hammerspace.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=5237a297ffd374a1c4157a53543b7a69d7bbbc03)

| -rw-r--r-- | [fs/nfs/nfs4proc.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/fs/nfs/nfs4proc.c?id=5237a297ffd374a1c4157a53543b7a69d7bbbc03) | 8 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 5 insertions, 3 deletions

| diff --git a/fs/nfs/nfs4proc.c b/fs/nfs/nfs4proc.cindex 1ff3f9efbe5193..ac3fab214df125 100644--- a/[fs/nfs/nfs4proc.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/nfs/nfs4proc.c?id=2365f57820c0fbecf4dc8ce4c8b3b1077b60e1f0)+++ b/[fs/nfs/nfs4proc.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/nfs/nfs4proc.c?id=5237a297ffd374a1c4157a53543b7a69d7bbbc03)@@ -2518,12 +2518,14 @@ static void nfs4\_open\_release(void \*calldata) struct nfs4\_opendata \*data = calldata; struct nfs4\_state \*state = NULL; + /\* In case of error, no cleanup! \*/+ if (data->rpc\_status != 0 || !data->rpc\_done) {+ nfs\_release\_seqid(data->o\_arg.seqid);+ goto out\_free;+ } /\* If this request hasn't been cancelled, do nothing \*/ if (!data->cancelled) goto out\_free;- /\* In case of error, no cleanup! \*/- if (data->rpc\_status != 0 || !data->rpc\_done)- goto out\_free; /\* In case we need an open\_confirm, no cleanup! \*/ if (data->o\_res.rflags & NFS4\_OPEN\_RESULT\_CONFIRM) goto out\_free; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-15 08:06:56 +0000



=== Content from git.kernel.org_3f4e5a94_20250115_080816.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=2ab9639f16b05d948066a6c4cf19a0fdc61046ff)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=2ab9639f16b05d948066a6c4cf19a0fdc61046ff)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=2ab9639f16b05d948066a6c4cf19a0fdc61046ff)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=2ab9639f16b05d948066a6c4cf19a0fdc61046ff)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Trond Myklebust <trond.myklebust@hammerspace.com> | 2024-11-08 12:13:31 -0500 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-14 19:51:19 +0100 |
| commit | [2ab9639f16b05d948066a6c4cf19a0fdc61046ff](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=2ab9639f16b05d948066a6c4cf19a0fdc61046ff) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=2ab9639f16b05d948066a6c4cf19a0fdc61046ff)) | |
| tree | [304879aecf5a2628c641b3b009f1ee858c095802](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=2ab9639f16b05d948066a6c4cf19a0fdc61046ff) | |
| parent | [fcf32ea8193f3e1171f13d195fa297e05d1c542a](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=fcf32ea8193f3e1171f13d195fa297e05d1c542a) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=2ab9639f16b05d948066a6c4cf19a0fdc61046ff&id2=fcf32ea8193f3e1171f13d195fa297e05d1c542a)) | |
| download | [linux-2ab9639f16b05d948066a6c4cf19a0fdc61046ff.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-2ab9639f16b05d948066a6c4cf19a0fdc61046ff.tar.gz) | |

NFSv4.0: Fix a use-after-free problem in the asynchronous open()[ Upstream commit 2fdb05dc0931250574f0cb0ebeb5ed8e20f4a889 ]
Yang Erkun reports that when two threads are opening files at the same
time, and are forced to abort before a reply is seen, then the call to
nfs\_release\_seqid() in nfs4\_opendata\_free() can result in a
use-after-free of the pointer to the defunct rpc task of the other
thread.
The fix is to ensure that if the RPC call is aborted before the call to
nfs\_wait\_on\_sequence() is complete, then we must call nfs\_release\_seqid()
in nfs4\_open\_release() before the rpc\_task is freed.
Reported-by: Yang Erkun <yangerkun@huawei.com>
Fixes: 24ac23ab88df ("NFSv4: Convert open() into an asynchronous RPC call")
Reviewed-by: Yang Erkun <yangerkun@huawei.com>
Signed-off-by: Trond Myklebust <trond.myklebust@hammerspace.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=2ab9639f16b05d948066a6c4cf19a0fdc61046ff)

| -rw-r--r-- | [fs/nfs/nfs4proc.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/fs/nfs/nfs4proc.c?id=2ab9639f16b05d948066a6c4cf19a0fdc61046ff) | 8 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 5 insertions, 3 deletions

| diff --git a/fs/nfs/nfs4proc.c b/fs/nfs/nfs4proc.cindex f1c351e40c7a51..4a0691aeb7c1db 100644--- a/[fs/nfs/nfs4proc.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/nfs/nfs4proc.c?id=fcf32ea8193f3e1171f13d195fa297e05d1c542a)+++ b/[fs/nfs/nfs4proc.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/nfs/nfs4proc.c?id=2ab9639f16b05d948066a6c4cf19a0fdc61046ff)@@ -2537,12 +2537,14 @@ static void nfs4\_open\_release(void \*calldata) struct nfs4\_opendata \*data = calldata; struct nfs4\_state \*state = NULL; + /\* In case of error, no cleanup! \*/+ if (data->rpc\_status != 0 || !data->rpc\_done) {+ nfs\_release\_seqid(data->o\_arg.seqid);+ goto out\_free;+ } /\* If this request hasn't been cancelled, do nothing \*/ if (!data->cancelled) goto out\_free;- /\* In case of error, no cleanup! \*/- if (data->rpc\_status != 0 || !data->rpc\_done)- goto out\_free; /\* In case we need an open\_confirm, no cleanup! \*/ if (data->o\_res.rflags & NFS4\_OPEN\_RESULT\_CONFIRM) goto out\_free; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-15 08:06:54 +0000



=== Content from git.kernel.org_c207b61e_20250115_080818.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=2fdb05dc0931250574f0cb0ebeb5ed8e20f4a889)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=2fdb05dc0931250574f0cb0ebeb5ed8e20f4a889)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=2fdb05dc0931250574f0cb0ebeb5ed8e20f4a889)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=2fdb05dc0931250574f0cb0ebeb5ed8e20f4a889)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Trond Myklebust <trond.myklebust@hammerspace.com> | 2024-11-08 12:13:31 -0500 |
| --- | --- | --- |
| committer | Trond Myklebust <trond.myklebust@hammerspace.com> | 2024-11-09 11:01:35 -0500 |
| commit | [2fdb05dc0931250574f0cb0ebeb5ed8e20f4a889](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=2fdb05dc0931250574f0cb0ebeb5ed8e20f4a889) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=2fdb05dc0931250574f0cb0ebeb5ed8e20f4a889)) | |
| tree | [9d16fa0c4294a128a9331e3a9fe50d318213053f](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=2fdb05dc0931250574f0cb0ebeb5ed8e20f4a889) | |
| parent | [c968fd23c68e9929ab6cad4faffc8ea603e98e5d](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=c968fd23c68e9929ab6cad4faffc8ea603e98e5d) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=2fdb05dc0931250574f0cb0ebeb5ed8e20f4a889&id2=c968fd23c68e9929ab6cad4faffc8ea603e98e5d)) | |
| download | [linux-2fdb05dc0931250574f0cb0ebeb5ed8e20f4a889.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-2fdb05dc0931250574f0cb0ebeb5ed8e20f4a889.tar.gz) | |

NFSv4.0: Fix a use-after-free problem in the asynchronous open()Yang Erkun reports that when two threads are opening files at the same
time, and are forced to abort before a reply is seen, then the call to
nfs\_release\_seqid() in nfs4\_opendata\_free() can result in a
use-after-free of the pointer to the defunct rpc task of the other
thread.
The fix is to ensure that if the RPC call is aborted before the call to
nfs\_wait\_on\_sequence() is complete, then we must call nfs\_release\_seqid()
in nfs4\_open\_release() before the rpc\_task is freed.
Reported-by: Yang Erkun <yangerkun@huawei.com>
Fixes: 24ac23ab88df ("NFSv4: Convert open() into an asynchronous RPC call")
Reviewed-by: Yang Erkun <yangerkun@huawei.com>
Signed-off-by: Trond Myklebust <trond.myklebust@hammerspace.com>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=2fdb05dc0931250574f0cb0ebeb5ed8e20f4a889)

| -rw-r--r-- | [fs/nfs/nfs4proc.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/fs/nfs/nfs4proc.c?id=2fdb05dc0931250574f0cb0ebeb5ed8e20f4a889) | 8 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 5 insertions, 3 deletions

| diff --git a/fs/nfs/nfs4proc.c b/fs/nfs/nfs4proc.cindex 9d40319e063dea..405f17e6e0b45b 100644--- a/[fs/nfs/nfs4proc.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/nfs/nfs4proc.c?id=c968fd23c68e9929ab6cad4faffc8ea603e98e5d)+++ b/[fs/nfs/nfs4proc.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/nfs/nfs4proc.c?id=2fdb05dc0931250574f0cb0ebeb5ed8e20f4a889)@@ -2603,12 +2603,14 @@ static void nfs4\_open\_release(void \*calldata) struct nfs4\_opendata \*data = calldata; struct nfs4\_state \*state = NULL; + /\* In case of error, no cleanup! \*/+ if (data->rpc\_status != 0 || !data->rpc\_done) {+ nfs\_release\_seqid(data->o\_arg.seqid);+ goto out\_free;+ } /\* If this request hasn't been cancelled, do nothing \*/ if (!data->cancelled) goto out\_free;- /\* In case of error, no cleanup! \*/- if (data->rpc\_status != 0 || !data->rpc\_done)- goto out\_free; /\* In case we need an open\_confirm, no cleanup! \*/ if (data->o\_res.rflags & NFS4\_OPEN\_RESULT\_CONFIRM) goto out\_free; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-15 08:06:55 +0000



=== Content from git.kernel.org_082a4cbb_20250115_080820.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=7bf6bf130af8ee7d93a99c28a7512df3017ec759)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=7bf6bf130af8ee7d93a99c28a7512df3017ec759)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=7bf6bf130af8ee7d93a99c28a7512df3017ec759)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=7bf6bf130af8ee7d93a99c28a7512df3017ec759)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Trond Myklebust <trond.myklebust@hammerspace.com> | 2024-11-08 12:13:31 -0500 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-14 19:44:40 +0100 |
| commit | [7bf6bf130af8ee7d93a99c28a7512df3017ec759](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=7bf6bf130af8ee7d93a99c28a7512df3017ec759) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=7bf6bf130af8ee7d93a99c28a7512df3017ec759)) | |
| tree | [0e229f862ffdaacd1f1a9787262a6e10eb6fc8fa](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=7bf6bf130af8ee7d93a99c28a7512df3017ec759) | |
| parent | [9e497ef3a6cfa1b211626b24312b440339509893](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=9e497ef3a6cfa1b211626b24312b440339509893) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=7bf6bf130af8ee7d93a99c28a7512df3017ec759&id2=9e497ef3a6cfa1b211626b24312b440339509893)) | |
| download | [linux-7bf6bf130af8ee7d93a99c28a7512df3017ec759.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-7bf6bf130af8ee7d93a99c28a7512df3017ec759.tar.gz) | |

NFSv4.0: Fix a use-after-free problem in the asynchronous open()[ Upstream commit 2fdb05dc0931250574f0cb0ebeb5ed8e20f4a889 ]
Yang Erkun reports that when two threads are opening files at the same
time, and are forced to abort before a reply is seen, then the call to
nfs\_release\_seqid() in nfs4\_opendata\_free() can result in a
use-after-free of the pointer to the defunct rpc task of the other
thread.
The fix is to ensure that if the RPC call is aborted before the call to
nfs\_wait\_on\_sequence() is complete, then we must call nfs\_release\_seqid()
in nfs4\_open\_release() before the rpc\_task is freed.
Reported-by: Yang Erkun <yangerkun@huawei.com>
Fixes: 24ac23ab88df ("NFSv4: Convert open() into an asynchronous RPC call")
Reviewed-by: Yang Erkun <yangerkun@huawei.com>
Signed-off-by: Trond Myklebust <trond.myklebust@hammerspace.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=7bf6bf130af8ee7d93a99c28a7512df3017ec759)

| -rw-r--r-- | [fs/nfs/nfs4proc.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/fs/nfs/nfs4proc.c?id=7bf6bf130af8ee7d93a99c28a7512df3017ec759) | 8 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 5 insertions, 3 deletions

| diff --git a/fs/nfs/nfs4proc.c b/fs/nfs/nfs4proc.cindex 31503bade33582..632cea3fb91dad 100644--- a/[fs/nfs/nfs4proc.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/nfs/nfs4proc.c?id=9e497ef3a6cfa1b211626b24312b440339509893)+++ b/[fs/nfs/nfs4proc.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/nfs/nfs4proc.c?id=7bf6bf130af8ee7d93a99c28a7512df3017ec759)@@ -2477,12 +2477,14 @@ static void nfs4\_open\_release(void \*calldata) struct nfs4\_opendata \*data = calldata; struct nfs4\_state \*state = NULL; + /\* In case of error, no cleanup! \*/+ if (data->rpc\_status != 0 || !data->rpc\_done) {+ nfs\_release\_seqid(data->o\_arg.seqid);+ goto out\_free;+ } /\* If this request hasn't been cancelled, do nothing \*/ if (!data->cancelled) goto out\_free;- /\* In case of error, no cleanup! \*/- if (data->rpc\_status != 0 || !data->rpc\_done)- goto out\_free; /\* In case we need an open\_confirm, no cleanup! \*/ if (data->o\_res.rflags & NFS4\_OPEN\_RESULT\_CONFIRM) goto out\_free; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-15 08:06:57 +0000


