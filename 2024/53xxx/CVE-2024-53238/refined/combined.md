=== Content from git.kernel.org_54168676_20250114_204112.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=1219c211ccd061cde002cc5708692efca515a7a0)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=1219c211ccd061cde002cc5708692efca515a7a0)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=1219c211ccd061cde002cc5708692efca515a7a0)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=1219c211ccd061cde002cc5708692efca515a7a0)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Chris Lu <chris.lu@mediatek.com> | 2024-10-25 14:07:17 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-05 14:01:59 +0100 |
| commit | [1219c211ccd061cde002cc5708692efca515a7a0](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=1219c211ccd061cde002cc5708692efca515a7a0) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=1219c211ccd061cde002cc5708692efca515a7a0)) | |
| tree | [bf58427d5077f1464d51318028ded32a209868d7](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=1219c211ccd061cde002cc5708692efca515a7a0) | |
| parent | [90fe2941f54e0250c15bd6bd3f24082c7ebf3fa1](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=90fe2941f54e0250c15bd6bd3f24082c7ebf3fa1) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=1219c211ccd061cde002cc5708692efca515a7a0&id2=90fe2941f54e0250c15bd6bd3f24082c7ebf3fa1)) | |
| download | [linux-1219c211ccd061cde002cc5708692efca515a7a0.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-1219c211ccd061cde002cc5708692efca515a7a0.tar.gz) | |

Bluetooth: btmtk: adjust the position to init iso data anchor[ Upstream commit 61c5a3def90ac729a538e5ca5ff7f461cff72776 ]
MediaTek iso data anchor init should be moved to where MediaTek
claims iso data interface.
If there is an unexpected BT usb disconnect during setup flow,
it will cause a NULL pointer crash issue when releasing iso
anchor since the anchor wasn't been init yet. Adjust the position
to do iso data anchor init.
[ 17.137991] pc : usb\_kill\_anchored\_urbs+0x60/0x168
[ 17.137998] lr : usb\_kill\_anchored\_urbs+0x44/0x168
[ 17.137999] sp : ffffffc0890cb5f0
[ 17.138000] x29: ffffffc0890cb5f0 x28: ffffff80bb6c2e80
[ 17.144081] gpio gpiochip0: registered chardev handle for 1 lines
[ 17.148421] x27: 0000000000000000
[ 17.148422] x26: ffffffd301ff4298 x25: 0000000000000003 x24: 00000000000000f0
[ 17.148424] x23: 0000000000000000 x22: 00000000ffffffff x21: 0000000000000001
[ 17.148425] x20: ffffffffffffffd8 x19: ffffff80c0f25560 x18: 0000000000000000
[ 17.148427] x17: ffffffd33864e408 x16: ffffffd33808f7c8 x15: 0000000000200000
[ 17.232789] x14: e0cd73cf80ffffff x13: 50f2137c0a0338c9 x12: 0000000000000001
[ 17.239912] x11: 0000000080150011 x10: 0000000000000002 x9 : 0000000000000001
[ 17.247035] x8 : 0000000000000000 x7 : 0000000000008080 x6 : 8080000000000000
[ 17.254158] x5 : ffffffd33808ebc0 x4 : fffffffe033dcf20 x3 : 0000000080150011
[ 17.261281] x2 : ffffff8087a91400 x1 : 0000000000000000 x0 : ffffff80c0f25588
[ 17.268404] Call trace:
[ 17.270841] usb\_kill\_anchored\_urbs+0x60/0x168
[ 17.275274] btusb\_mtk\_release\_iso\_intf+0x2c/0xd8 [btusb (HASH:5afe 6)]
[ 17.284226] btusb\_mtk\_disconnect+0x14/0x28 [btusb (HASH:5afe 6)]
[ 17.292652] btusb\_disconnect+0x70/0x140 [btusb (HASH:5afe 6)]
[ 17.300818] usb\_unbind\_interface+0xc4/0x240
[ 17.305079] device\_release\_driver\_internal+0x18c/0x258
[ 17.310296] device\_release\_driver+0x1c/0x30
[ 17.314557] bus\_remove\_device+0x140/0x160
[ 17.318643] device\_del+0x1c0/0x330
[ 17.322121] usb\_disable\_device+0x80/0x180
[ 17.326207] usb\_disconnect+0xec/0x300
[ 17.329948] hub\_quiesce+0x80/0xd0
[ 17.333339] hub\_disconnect+0x44/0x190
[ 17.337078] usb\_unbind\_interface+0xc4/0x240
[ 17.341337] device\_release\_driver\_internal+0x18c/0x258
[ 17.346551] device\_release\_driver+0x1c/0x30
[ 17.350810] usb\_driver\_release\_interface+0x70/0x88
[ 17.355677] proc\_ioctl+0x13c/0x228
[ 17.359157] proc\_ioctl\_default+0x50/0x80
[ 17.363155] usbdev\_ioctl+0x830/0xd08
[ 17.366808] \_\_arm64\_sys\_ioctl+0x94/0xd0
[ 17.370723] invoke\_syscall+0x6c/0xf8
[ 17.374377] el0\_svc\_common+0x84/0xe0
[ 17.378030] do\_el0\_svc+0x20/0x30
[ 17.381334] el0\_svc+0x34/0x60
[ 17.384382] el0t\_64\_sync\_handler+0x88/0xf0
[ 17.388554] el0t\_64\_sync+0x180/0x188
[ 17.392208] Code: f9400677 f100a2f4 54fffea0 d503201f (b8350288)
[ 17.398289] ---[ end trace 0000000000000000 ]---
Fixes: ceac1cb0259d ("Bluetooth: btusb: mediatek: add ISO data transmission functions")
Signed-off-by: Chris Lu <chris.lu@mediatek.com>
Signed-off-by: Luiz Augusto von Dentz <luiz.von.dentz@intel.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=1219c211ccd061cde002cc5708692efca515a7a0)

| -rw-r--r-- | [drivers/bluetooth/btmtk.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/bluetooth/btmtk.c?id=1219c211ccd061cde002cc5708692efca515a7a0) | 1 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |
| -rw-r--r-- | [drivers/bluetooth/btusb.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/bluetooth/btusb.c?id=1219c211ccd061cde002cc5708692efca515a7a0) | 1 | |  |  |  | | --- | --- | --- | |

2 files changed, 1 insertions, 1 deletions

| diff --git a/drivers/bluetooth/btmtk.c b/drivers/bluetooth/btmtk.cindex 9bbf205021634f..480e4adba9faa6 100644--- a/[drivers/bluetooth/btmtk.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/bluetooth/btmtk.c?id=90fe2941f54e0250c15bd6bd3f24082c7ebf3fa1)+++ b/[drivers/bluetooth/btmtk.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/bluetooth/btmtk.c?id=1219c211ccd061cde002cc5708692efca515a7a0)@@ -1215,7 +1215,6 @@ static int btmtk\_usb\_isointf\_init(struct hci\_dev \*hdev) struct sk\_buff \*skb; int err; - init\_usb\_anchor(&btmtk\_data->isopkt\_anchor); spin\_lock\_init(&btmtk\_data->isorxlock);  \_\_set\_mtk\_intr\_interface(hdev);diff --git a/drivers/bluetooth/btusb.c b/drivers/bluetooth/btusb.cindex e9534fbc92e32f..4ccaddb46ddd81 100644--- a/[drivers/bluetooth/btusb.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/bluetooth/btusb.c?id=90fe2941f54e0250c15bd6bd3f24082c7ebf3fa1)+++ b/[drivers/bluetooth/btusb.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/bluetooth/btusb.c?id=1219c211ccd061cde002cc5708692efca515a7a0)@@ -2616,6 +2616,7 @@ static void btusb\_mtk\_claim\_iso\_intf(struct btusb\_data \*data) }  set\_bit(BTMTK\_ISOPKT\_OVER\_INTR, &btmtk\_data->flags);+ init\_usb\_anchor(&btmtk\_data->isopkt\_anchor); }  static void btusb\_mtk\_release\_iso\_intf(struct btusb\_data \*data) |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 20:39:49 +0000



=== Content from git.kernel.org_18d5f97d_20250114_204115.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=d8bd79f0eea9c07d90ce870a714ab5c10afaa4b3)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=d8bd79f0eea9c07d90ce870a714ab5c10afaa4b3)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=d8bd79f0eea9c07d90ce870a714ab5c10afaa4b3)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=d8bd79f0eea9c07d90ce870a714ab5c10afaa4b3)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Chris Lu <chris.lu@mediatek.com> | 2024-10-25 14:07:17 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-05 13:53:27 +0100 |
| commit | [d8bd79f0eea9c07d90ce870a714ab5c10afaa4b3](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=d8bd79f0eea9c07d90ce870a714ab5c10afaa4b3) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=d8bd79f0eea9c07d90ce870a714ab5c10afaa4b3)) | |
| tree | [9ca405828958884700bd29120b4d35ceaf597776](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=d8bd79f0eea9c07d90ce870a714ab5c10afaa4b3) | |
| parent | [1b3688d0463cf3de095302d5bd7e81f88615623f](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=1b3688d0463cf3de095302d5bd7e81f88615623f) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=d8bd79f0eea9c07d90ce870a714ab5c10afaa4b3&id2=1b3688d0463cf3de095302d5bd7e81f88615623f)) | |
| download | [linux-d8bd79f0eea9c07d90ce870a714ab5c10afaa4b3.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-d8bd79f0eea9c07d90ce870a714ab5c10afaa4b3.tar.gz) | |

Bluetooth: btmtk: adjust the position to init iso data anchor[ Upstream commit 61c5a3def90ac729a538e5ca5ff7f461cff72776 ]
MediaTek iso data anchor init should be moved to where MediaTek
claims iso data interface.
If there is an unexpected BT usb disconnect during setup flow,
it will cause a NULL pointer crash issue when releasing iso
anchor since the anchor wasn't been init yet. Adjust the position
to do iso data anchor init.
[ 17.137991] pc : usb\_kill\_anchored\_urbs+0x60/0x168
[ 17.137998] lr : usb\_kill\_anchored\_urbs+0x44/0x168
[ 17.137999] sp : ffffffc0890cb5f0
[ 17.138000] x29: ffffffc0890cb5f0 x28: ffffff80bb6c2e80
[ 17.144081] gpio gpiochip0: registered chardev handle for 1 lines
[ 17.148421] x27: 0000000000000000
[ 17.148422] x26: ffffffd301ff4298 x25: 0000000000000003 x24: 00000000000000f0
[ 17.148424] x23: 0000000000000000 x22: 00000000ffffffff x21: 0000000000000001
[ 17.148425] x20: ffffffffffffffd8 x19: ffffff80c0f25560 x18: 0000000000000000
[ 17.148427] x17: ffffffd33864e408 x16: ffffffd33808f7c8 x15: 0000000000200000
[ 17.232789] x14: e0cd73cf80ffffff x13: 50f2137c0a0338c9 x12: 0000000000000001
[ 17.239912] x11: 0000000080150011 x10: 0000000000000002 x9 : 0000000000000001
[ 17.247035] x8 : 0000000000000000 x7 : 0000000000008080 x6 : 8080000000000000
[ 17.254158] x5 : ffffffd33808ebc0 x4 : fffffffe033dcf20 x3 : 0000000080150011
[ 17.261281] x2 : ffffff8087a91400 x1 : 0000000000000000 x0 : ffffff80c0f25588
[ 17.268404] Call trace:
[ 17.270841] usb\_kill\_anchored\_urbs+0x60/0x168
[ 17.275274] btusb\_mtk\_release\_iso\_intf+0x2c/0xd8 [btusb (HASH:5afe 6)]
[ 17.284226] btusb\_mtk\_disconnect+0x14/0x28 [btusb (HASH:5afe 6)]
[ 17.292652] btusb\_disconnect+0x70/0x140 [btusb (HASH:5afe 6)]
[ 17.300818] usb\_unbind\_interface+0xc4/0x240
[ 17.305079] device\_release\_driver\_internal+0x18c/0x258
[ 17.310296] device\_release\_driver+0x1c/0x30
[ 17.314557] bus\_remove\_device+0x140/0x160
[ 17.318643] device\_del+0x1c0/0x330
[ 17.322121] usb\_disable\_device+0x80/0x180
[ 17.326207] usb\_disconnect+0xec/0x300
[ 17.329948] hub\_quiesce+0x80/0xd0
[ 17.333339] hub\_disconnect+0x44/0x190
[ 17.337078] usb\_unbind\_interface+0xc4/0x240
[ 17.341337] device\_release\_driver\_internal+0x18c/0x258
[ 17.346551] device\_release\_driver+0x1c/0x30
[ 17.350810] usb\_driver\_release\_interface+0x70/0x88
[ 17.355677] proc\_ioctl+0x13c/0x228
[ 17.359157] proc\_ioctl\_default+0x50/0x80
[ 17.363155] usbdev\_ioctl+0x830/0xd08
[ 17.366808] \_\_arm64\_sys\_ioctl+0x94/0xd0
[ 17.370723] invoke\_syscall+0x6c/0xf8
[ 17.374377] el0\_svc\_common+0x84/0xe0
[ 17.378030] do\_el0\_svc+0x20/0x30
[ 17.381334] el0\_svc+0x34/0x60
[ 17.384382] el0t\_64\_sync\_handler+0x88/0xf0
[ 17.388554] el0t\_64\_sync+0x180/0x188
[ 17.392208] Code: f9400677 f100a2f4 54fffea0 d503201f (b8350288)
[ 17.398289] ---[ end trace 0000000000000000 ]---
Fixes: ceac1cb0259d ("Bluetooth: btusb: mediatek: add ISO data transmission functions")
Signed-off-by: Chris Lu <chris.lu@mediatek.com>
Signed-off-by: Luiz Augusto von Dentz <luiz.von.dentz@intel.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=d8bd79f0eea9c07d90ce870a714ab5c10afaa4b3)

| -rw-r--r-- | [drivers/bluetooth/btmtk.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/bluetooth/btmtk.c?id=d8bd79f0eea9c07d90ce870a714ab5c10afaa4b3) | 1 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |
| -rw-r--r-- | [drivers/bluetooth/btusb.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/bluetooth/btusb.c?id=d8bd79f0eea9c07d90ce870a714ab5c10afaa4b3) | 1 | |  |  |  | | --- | --- | --- | |

2 files changed, 1 insertions, 1 deletions

| diff --git a/drivers/bluetooth/btmtk.c b/drivers/bluetooth/btmtk.cindex 2b7c80043aa2eb..4b30d13ad5e960 100644--- a/[drivers/bluetooth/btmtk.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/bluetooth/btmtk.c?id=1b3688d0463cf3de095302d5bd7e81f88615623f)+++ b/[drivers/bluetooth/btmtk.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/bluetooth/btmtk.c?id=d8bd79f0eea9c07d90ce870a714ab5c10afaa4b3)@@ -1215,7 +1215,6 @@ static int btmtk\_usb\_isointf\_init(struct hci\_dev \*hdev) struct sk\_buff \*skb; int err; - init\_usb\_anchor(&btmtk\_data->isopkt\_anchor); spin\_lock\_init(&btmtk\_data->isorxlock);  \_\_set\_mtk\_intr\_interface(hdev);diff --git a/drivers/bluetooth/btusb.c b/drivers/bluetooth/btusb.cindex 2408e50743ca64..09afd75145ed9c 100644--- a/[drivers/bluetooth/btusb.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/bluetooth/btusb.c?id=1b3688d0463cf3de095302d5bd7e81f88615623f)+++ b/[drivers/bluetooth/btusb.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/bluetooth/btusb.c?id=d8bd79f0eea9c07d90ce870a714ab5c10afaa4b3)@@ -2670,6 +2670,7 @@ static void btusb\_mtk\_claim\_iso\_intf(struct btusb\_data \*data) }  set\_bit(BTMTK\_ISOPKT\_OVER\_INTR, &btmtk\_data->flags);+ init\_usb\_anchor(&btmtk\_data->isopkt\_anchor); }  static void btusb\_mtk\_release\_iso\_intf(struct btusb\_data \*data) |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 20:39:51 +0000



=== Content from git.kernel.org_36ed0b6d_20250114_204113.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=61c5a3def90ac729a538e5ca5ff7f461cff72776)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=61c5a3def90ac729a538e5ca5ff7f461cff72776)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=61c5a3def90ac729a538e5ca5ff7f461cff72776)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=61c5a3def90ac729a538e5ca5ff7f461cff72776)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Chris Lu <chris.lu@mediatek.com> | 2024-10-25 14:07:17 +0800 |
| --- | --- | --- |
| committer | Luiz Augusto von Dentz <luiz.von.dentz@intel.com> | 2024-11-14 15:35:00 -0500 |
| commit | [61c5a3def90ac729a538e5ca5ff7f461cff72776](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=61c5a3def90ac729a538e5ca5ff7f461cff72776) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=61c5a3def90ac729a538e5ca5ff7f461cff72776)) | |
| tree | [090c47266dea5c028bbc39040a937aac73cc2722](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=61c5a3def90ac729a538e5ca5ff7f461cff72776) | |
| parent | [41f4ff86e795bf2e51ba5c86a6f3a06564a23f18](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=41f4ff86e795bf2e51ba5c86a6f3a06564a23f18) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=61c5a3def90ac729a538e5ca5ff7f461cff72776&id2=41f4ff86e795bf2e51ba5c86a6f3a06564a23f18)) | |
| download | [linux-61c5a3def90ac729a538e5ca5ff7f461cff72776.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-61c5a3def90ac729a538e5ca5ff7f461cff72776.tar.gz) | |

Bluetooth: btmtk: adjust the position to init iso data anchorMediaTek iso data anchor init should be moved to where MediaTek
claims iso data interface.
If there is an unexpected BT usb disconnect during setup flow,
it will cause a NULL pointer crash issue when releasing iso
anchor since the anchor wasn't been init yet. Adjust the position
to do iso data anchor init.
[ 17.137991] pc : usb\_kill\_anchored\_urbs+0x60/0x168
[ 17.137998] lr : usb\_kill\_anchored\_urbs+0x44/0x168
[ 17.137999] sp : ffffffc0890cb5f0
[ 17.138000] x29: ffffffc0890cb5f0 x28: ffffff80bb6c2e80
[ 17.144081] gpio gpiochip0: registered chardev handle for 1 lines
[ 17.148421] x27: 0000000000000000
[ 17.148422] x26: ffffffd301ff4298 x25: 0000000000000003 x24: 00000000000000f0
[ 17.148424] x23: 0000000000000000 x22: 00000000ffffffff x21: 0000000000000001
[ 17.148425] x20: ffffffffffffffd8 x19: ffffff80c0f25560 x18: 0000000000000000
[ 17.148427] x17: ffffffd33864e408 x16: ffffffd33808f7c8 x15: 0000000000200000
[ 17.232789] x14: e0cd73cf80ffffff x13: 50f2137c0a0338c9 x12: 0000000000000001
[ 17.239912] x11: 0000000080150011 x10: 0000000000000002 x9 : 0000000000000001
[ 17.247035] x8 : 0000000000000000 x7 : 0000000000008080 x6 : 8080000000000000
[ 17.254158] x5 : ffffffd33808ebc0 x4 : fffffffe033dcf20 x3 : 0000000080150011
[ 17.261281] x2 : ffffff8087a91400 x1 : 0000000000000000 x0 : ffffff80c0f25588
[ 17.268404] Call trace:
[ 17.270841] usb\_kill\_anchored\_urbs+0x60/0x168
[ 17.275274] btusb\_mtk\_release\_iso\_intf+0x2c/0xd8 [btusb (HASH:5afe 6)]
[ 17.284226] btusb\_mtk\_disconnect+0x14/0x28 [btusb (HASH:5afe 6)]
[ 17.292652] btusb\_disconnect+0x70/0x140 [btusb (HASH:5afe 6)]
[ 17.300818] usb\_unbind\_interface+0xc4/0x240
[ 17.305079] device\_release\_driver\_internal+0x18c/0x258
[ 17.310296] device\_release\_driver+0x1c/0x30
[ 17.314557] bus\_remove\_device+0x140/0x160
[ 17.318643] device\_del+0x1c0/0x330
[ 17.322121] usb\_disable\_device+0x80/0x180
[ 17.326207] usb\_disconnect+0xec/0x300
[ 17.329948] hub\_quiesce+0x80/0xd0
[ 17.333339] hub\_disconnect+0x44/0x190
[ 17.337078] usb\_unbind\_interface+0xc4/0x240
[ 17.341337] device\_release\_driver\_internal+0x18c/0x258
[ 17.346551] device\_release\_driver+0x1c/0x30
[ 17.350810] usb\_driver\_release\_interface+0x70/0x88
[ 17.355677] proc\_ioctl+0x13c/0x228
[ 17.359157] proc\_ioctl\_default+0x50/0x80
[ 17.363155] usbdev\_ioctl+0x830/0xd08
[ 17.366808] \_\_arm64\_sys\_ioctl+0x94/0xd0
[ 17.370723] invoke\_syscall+0x6c/0xf8
[ 17.374377] el0\_svc\_common+0x84/0xe0
[ 17.378030] do\_el0\_svc+0x20/0x30
[ 17.381334] el0\_svc+0x34/0x60
[ 17.384382] el0t\_64\_sync\_handler+0x88/0xf0
[ 17.388554] el0t\_64\_sync+0x180/0x188
[ 17.392208] Code: f9400677 f100a2f4 54fffea0 d503201f (b8350288)
[ 17.398289] ---[ end trace 0000000000000000 ]---
Fixes: ceac1cb0259d ("Bluetooth: btusb: mediatek: add ISO data transmission functions")
Signed-off-by: Chris Lu <chris.lu@mediatek.com>
Signed-off-by: Luiz Augusto von Dentz <luiz.von.dentz@intel.com>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=61c5a3def90ac729a538e5ca5ff7f461cff72776)

| -rw-r--r-- | [drivers/bluetooth/btmtk.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/bluetooth/btmtk.c?id=61c5a3def90ac729a538e5ca5ff7f461cff72776) | 1 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |
| -rw-r--r-- | [drivers/bluetooth/btusb.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/bluetooth/btusb.c?id=61c5a3def90ac729a538e5ca5ff7f461cff72776) | 1 | |  |  |  | | --- | --- | --- | |

2 files changed, 1 insertions, 1 deletions

| diff --git a/drivers/bluetooth/btmtk.c b/drivers/bluetooth/btmtk.cindex b7fc14aafc7455..8a3f7c3fcfec87 100644--- a/[drivers/bluetooth/btmtk.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/bluetooth/btmtk.c?id=41f4ff86e795bf2e51ba5c86a6f3a06564a23f18)+++ b/[drivers/bluetooth/btmtk.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/bluetooth/btmtk.c?id=61c5a3def90ac729a538e5ca5ff7f461cff72776)@@ -1215,7 +1215,6 @@ static int btmtk\_usb\_isointf\_init(struct hci\_dev \*hdev) struct sk\_buff \*skb; int err; - init\_usb\_anchor(&btmtk\_data->isopkt\_anchor); spin\_lock\_init(&btmtk\_data->isorxlock);  \_\_set\_mtk\_intr\_interface(hdev);diff --git a/drivers/bluetooth/btusb.c b/drivers/bluetooth/btusb.cindex 9970470c9d156f..514d593923ad0c 100644--- a/[drivers/bluetooth/btusb.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/bluetooth/btusb.c?id=41f4ff86e795bf2e51ba5c86a6f3a06564a23f18)+++ b/[drivers/bluetooth/btusb.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/bluetooth/btusb.c?id=61c5a3def90ac729a538e5ca5ff7f461cff72776)@@ -2637,6 +2637,7 @@ static void btusb\_mtk\_claim\_iso\_intf(struct btusb\_data \*data) }  set\_bit(BTMTK\_ISOPKT\_OVER\_INTR, &btmtk\_data->flags);+ init\_usb\_anchor(&btmtk\_data->isopkt\_anchor); }  static void btusb\_mtk\_release\_iso\_intf(struct hci\_dev \*hdev) |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 20:39:50 +0000


