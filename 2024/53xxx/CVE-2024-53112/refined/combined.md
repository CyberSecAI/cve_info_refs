=== Content from git.kernel.org_9ad80c87_20250115_090356.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=28d4ed71ae0b4baedca3e85ee6d8f227ec75ebf6)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=28d4ed71ae0b4baedca3e85ee6d8f227ec75ebf6)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=28d4ed71ae0b4baedca3e85ee6d8f227ec75ebf6)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=28d4ed71ae0b4baedca3e85ee6d8f227ec75ebf6)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Dmitry Antipov <dmantipov@yandex.ru> | 2024-11-14 07:38:44 +0300 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-14 19:47:38 +0100 |
| commit | [28d4ed71ae0b4baedca3e85ee6d8f227ec75ebf6](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=28d4ed71ae0b4baedca3e85ee6d8f227ec75ebf6) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=28d4ed71ae0b4baedca3e85ee6d8f227ec75ebf6)) | |
| tree | [e66a28468263696c78ce5c27b31ac34588e7a9ea](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=28d4ed71ae0b4baedca3e85ee6d8f227ec75ebf6) | |
| parent | [5fe8bcc82f1d436f7874ba5466915cef989cc1c4](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=5fe8bcc82f1d436f7874ba5466915cef989cc1c4) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=28d4ed71ae0b4baedca3e85ee6d8f227ec75ebf6&id2=5fe8bcc82f1d436f7874ba5466915cef989cc1c4)) | |
| download | [linux-28d4ed71ae0b4baedca3e85ee6d8f227ec75ebf6.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-28d4ed71ae0b4baedca3e85ee6d8f227ec75ebf6.tar.gz) | |

ocfs2: uncache inode which has failed entering the groupcommit 737f34137844d6572ab7d473c998c7f977ff30eb upstream.
Syzbot has reported the following BUG:
kernel BUG at fs/ocfs2/uptodate.c:509!
...
Call Trace:
<TASK>
? \_\_die\_body+0x5f/0xb0
? die+0x9e/0xc0
? do\_trap+0x15a/0x3a0
? ocfs2\_set\_new\_buffer\_uptodate+0x145/0x160
? do\_error\_trap+0x1dc/0x2c0
? ocfs2\_set\_new\_buffer\_uptodate+0x145/0x160
? \_\_pfx\_do\_error\_trap+0x10/0x10
? handle\_invalid\_op+0x34/0x40
? ocfs2\_set\_new\_buffer\_uptodate+0x145/0x160
? exc\_invalid\_op+0x38/0x50
? asm\_exc\_invalid\_op+0x1a/0x20
? ocfs2\_set\_new\_buffer\_uptodate+0x2e/0x160
? ocfs2\_set\_new\_buffer\_uptodate+0x144/0x160
? ocfs2\_set\_new\_buffer\_uptodate+0x145/0x160
ocfs2\_group\_add+0x39f/0x15a0
? \_\_pfx\_ocfs2\_group\_add+0x10/0x10
? \_\_pfx\_lock\_acquire+0x10/0x10
? mnt\_get\_write\_access+0x68/0x2b0
? \_\_pfx\_lock\_release+0x10/0x10
? rcu\_read\_lock\_any\_held+0xb7/0x160
? \_\_pfx\_rcu\_read\_lock\_any\_held+0x10/0x10
? smack\_log+0x123/0x540
? mnt\_get\_write\_access+0x68/0x2b0
? mnt\_get\_write\_access+0x68/0x2b0
? mnt\_get\_write\_access+0x226/0x2b0
ocfs2\_ioctl+0x65e/0x7d0
? \_\_pfx\_ocfs2\_ioctl+0x10/0x10
? smack\_file\_ioctl+0x29e/0x3a0
? \_\_pfx\_smack\_file\_ioctl+0x10/0x10
? lockdep\_hardirqs\_on\_prepare+0x43d/0x780
? \_\_pfx\_lockdep\_hardirqs\_on\_prepare+0x10/0x10
? \_\_pfx\_ocfs2\_ioctl+0x10/0x10
\_\_se\_sys\_ioctl+0xfb/0x170
do\_syscall\_64+0xf3/0x230
entry\_SYSCALL\_64\_after\_hwframe+0x77/0x7f
...
</TASK>
When 'ioctl(OCFS2\_IOC\_GROUP\_ADD, ...)' has failed for the particular
inode in 'ocfs2\_verify\_group\_and\_input()', corresponding buffer head
remains cached and subsequent call to the same 'ioctl()' for the same
inode issues the BUG() in 'ocfs2\_set\_new\_buffer\_uptodate()' (trying
to cache the same buffer head of that inode). Fix this by uncaching
the buffer head with 'ocfs2\_remove\_from\_cache()' on error path in
'ocfs2\_group\_add()'.
Link: [https://lkml.kernel.org/r/20241114043844.111847-1-dmantipov@yandex.ru](https://lkml.kernel.org/r/20241114043844.111847-1-dmantipov%40yandex.ru)
Fixes: 7909f2bf8353 ("[PATCH 2/2] ocfs2: Implement group add for online resize")
Signed-off-by: Dmitry Antipov <dmantipov@yandex.ru>
Reported-by: syzbot+453873f1588c2d75b447@syzkaller.appspotmail.com
Closes: https://syzkaller.appspot.com/bug?extid=453873f1588c2d75b447
Reviewed-by: Joseph Qi <joseph.qi@linux.alibaba.com>
Cc: Dmitry Antipov <dmantipov@yandex.ru>
Cc: Joel Becker <jlbec@evilplan.org>
Cc: Mark Fasheh <mark@fasheh.com>
Cc: Junxiao Bi <junxiao.bi@oracle.com>
Cc: Changwei Ge <gechangwei@live.cn>
Cc: Jun Piao <piaojun@huawei.com>
Cc: <stable@vger.kernel.org>
Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=28d4ed71ae0b4baedca3e85ee6d8f227ec75ebf6)

| -rw-r--r-- | [fs/ocfs2/resize.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/fs/ocfs2/resize.c?id=28d4ed71ae0b4baedca3e85ee6d8f227ec75ebf6) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 2 insertions, 0 deletions

| diff --git a/fs/ocfs2/resize.c b/fs/ocfs2/resize.cindex 24eb52f9059ca5..78788659ccf5de 100644--- a/[fs/ocfs2/resize.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/ocfs2/resize.c?id=5fe8bcc82f1d436f7874ba5466915cef989cc1c4)+++ b/[fs/ocfs2/resize.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/ocfs2/resize.c?id=28d4ed71ae0b4baedca3e85ee6d8f227ec75ebf6)@@ -568,6 +568,8 @@ out\_commit: ocfs2\_commit\_trans(osb, handle);  out\_free\_group\_bh:+ if (ret < 0)+ ocfs2\_remove\_from\_cache(INODE\_CACHE(inode), group\_bh); brelse(group\_bh);  out\_unlock: |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-15 09:02:33 +0000



=== Content from git.kernel.org_1247096e_20250115_090357.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=5ae8cc0b0c027e9cab22596049bc4dd1cbc37ee4)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=5ae8cc0b0c027e9cab22596049bc4dd1cbc37ee4)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=5ae8cc0b0c027e9cab22596049bc4dd1cbc37ee4)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=5ae8cc0b0c027e9cab22596049bc4dd1cbc37ee4)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Dmitry Antipov <dmantipov@yandex.ru> | 2024-11-14 07:38:44 +0300 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-14 19:44:18 +0100 |
| commit | [5ae8cc0b0c027e9cab22596049bc4dd1cbc37ee4](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=5ae8cc0b0c027e9cab22596049bc4dd1cbc37ee4) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=5ae8cc0b0c027e9cab22596049bc4dd1cbc37ee4)) | |
| tree | [e12db114d041158d73b160acfa8e62d1fdb110de](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=5ae8cc0b0c027e9cab22596049bc4dd1cbc37ee4) | |
| parent | [a0ddb20a748b122ea86003485f7992fa5e84cc95](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=a0ddb20a748b122ea86003485f7992fa5e84cc95) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=5ae8cc0b0c027e9cab22596049bc4dd1cbc37ee4&id2=a0ddb20a748b122ea86003485f7992fa5e84cc95)) | |
| download | [linux-5ae8cc0b0c027e9cab22596049bc4dd1cbc37ee4.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-5ae8cc0b0c027e9cab22596049bc4dd1cbc37ee4.tar.gz) | |

ocfs2: uncache inode which has failed entering the groupcommit 737f34137844d6572ab7d473c998c7f977ff30eb upstream.
Syzbot has reported the following BUG:
kernel BUG at fs/ocfs2/uptodate.c:509!
...
Call Trace:
<TASK>
? \_\_die\_body+0x5f/0xb0
? die+0x9e/0xc0
? do\_trap+0x15a/0x3a0
? ocfs2\_set\_new\_buffer\_uptodate+0x145/0x160
? do\_error\_trap+0x1dc/0x2c0
? ocfs2\_set\_new\_buffer\_uptodate+0x145/0x160
? \_\_pfx\_do\_error\_trap+0x10/0x10
? handle\_invalid\_op+0x34/0x40
? ocfs2\_set\_new\_buffer\_uptodate+0x145/0x160
? exc\_invalid\_op+0x38/0x50
? asm\_exc\_invalid\_op+0x1a/0x20
? ocfs2\_set\_new\_buffer\_uptodate+0x2e/0x160
? ocfs2\_set\_new\_buffer\_uptodate+0x144/0x160
? ocfs2\_set\_new\_buffer\_uptodate+0x145/0x160
ocfs2\_group\_add+0x39f/0x15a0
? \_\_pfx\_ocfs2\_group\_add+0x10/0x10
? \_\_pfx\_lock\_acquire+0x10/0x10
? mnt\_get\_write\_access+0x68/0x2b0
? \_\_pfx\_lock\_release+0x10/0x10
? rcu\_read\_lock\_any\_held+0xb7/0x160
? \_\_pfx\_rcu\_read\_lock\_any\_held+0x10/0x10
? smack\_log+0x123/0x540
? mnt\_get\_write\_access+0x68/0x2b0
? mnt\_get\_write\_access+0x68/0x2b0
? mnt\_get\_write\_access+0x226/0x2b0
ocfs2\_ioctl+0x65e/0x7d0
? \_\_pfx\_ocfs2\_ioctl+0x10/0x10
? smack\_file\_ioctl+0x29e/0x3a0
? \_\_pfx\_smack\_file\_ioctl+0x10/0x10
? lockdep\_hardirqs\_on\_prepare+0x43d/0x780
? \_\_pfx\_lockdep\_hardirqs\_on\_prepare+0x10/0x10
? \_\_pfx\_ocfs2\_ioctl+0x10/0x10
\_\_se\_sys\_ioctl+0xfb/0x170
do\_syscall\_64+0xf3/0x230
entry\_SYSCALL\_64\_after\_hwframe+0x77/0x7f
...
</TASK>
When 'ioctl(OCFS2\_IOC\_GROUP\_ADD, ...)' has failed for the particular
inode in 'ocfs2\_verify\_group\_and\_input()', corresponding buffer head
remains cached and subsequent call to the same 'ioctl()' for the same
inode issues the BUG() in 'ocfs2\_set\_new\_buffer\_uptodate()' (trying
to cache the same buffer head of that inode). Fix this by uncaching
the buffer head with 'ocfs2\_remove\_from\_cache()' on error path in
'ocfs2\_group\_add()'.
Link: [https://lkml.kernel.org/r/20241114043844.111847-1-dmantipov@yandex.ru](https://lkml.kernel.org/r/20241114043844.111847-1-dmantipov%40yandex.ru)
Fixes: 7909f2bf8353 ("[PATCH 2/2] ocfs2: Implement group add for online resize")
Signed-off-by: Dmitry Antipov <dmantipov@yandex.ru>
Reported-by: syzbot+453873f1588c2d75b447@syzkaller.appspotmail.com
Closes: https://syzkaller.appspot.com/bug?extid=453873f1588c2d75b447
Reviewed-by: Joseph Qi <joseph.qi@linux.alibaba.com>
Cc: Dmitry Antipov <dmantipov@yandex.ru>
Cc: Joel Becker <jlbec@evilplan.org>
Cc: Mark Fasheh <mark@fasheh.com>
Cc: Junxiao Bi <junxiao.bi@oracle.com>
Cc: Changwei Ge <gechangwei@live.cn>
Cc: Jun Piao <piaojun@huawei.com>
Cc: <stable@vger.kernel.org>
Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=5ae8cc0b0c027e9cab22596049bc4dd1cbc37ee4)

| -rw-r--r-- | [fs/ocfs2/resize.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/fs/ocfs2/resize.c?id=5ae8cc0b0c027e9cab22596049bc4dd1cbc37ee4) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 2 insertions, 0 deletions

| diff --git a/fs/ocfs2/resize.c b/fs/ocfs2/resize.cindex 24eb52f9059ca5..78788659ccf5de 100644--- a/[fs/ocfs2/resize.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/ocfs2/resize.c?id=a0ddb20a748b122ea86003485f7992fa5e84cc95)+++ b/[fs/ocfs2/resize.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/ocfs2/resize.c?id=5ae8cc0b0c027e9cab22596049bc4dd1cbc37ee4)@@ -568,6 +568,8 @@ out\_commit: ocfs2\_commit\_trans(osb, handle);  out\_free\_group\_bh:+ if (ret < 0)+ ocfs2\_remove\_from\_cache(INODE\_CACHE(inode), group\_bh); brelse(group\_bh);  out\_unlock: |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-15 09:02:34 +0000



=== Content from git.kernel.org_857bb577_20250115_090358.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=620d22598110b0d0cb97a3fcca65fc473ea86e73)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=620d22598110b0d0cb97a3fcca65fc473ea86e73)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=620d22598110b0d0cb97a3fcca65fc473ea86e73)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=620d22598110b0d0cb97a3fcca65fc473ea86e73)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Dmitry Antipov <dmantipov@yandex.ru> | 2024-11-14 07:38:44 +0300 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-11-22 15:37:30 +0100 |
| commit | [620d22598110b0d0cb97a3fcca65fc473ea86e73](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=620d22598110b0d0cb97a3fcca65fc473ea86e73) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=620d22598110b0d0cb97a3fcca65fc473ea86e73)) | |
| tree | [042d9d3fa03fc5059ed86b4cc01ba9392d1a9749](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=620d22598110b0d0cb97a3fcca65fc473ea86e73) | |
| parent | [6addb2d9501ec866d7b3a3b4e665307c437e9be2](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=6addb2d9501ec866d7b3a3b4e665307c437e9be2) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=620d22598110b0d0cb97a3fcca65fc473ea86e73&id2=6addb2d9501ec866d7b3a3b4e665307c437e9be2)) | |
| download | [linux-620d22598110b0d0cb97a3fcca65fc473ea86e73.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-620d22598110b0d0cb97a3fcca65fc473ea86e73.tar.gz) | |

ocfs2: uncache inode which has failed entering the groupcommit 737f34137844d6572ab7d473c998c7f977ff30eb upstream.
Syzbot has reported the following BUG:
kernel BUG at fs/ocfs2/uptodate.c:509!
...
Call Trace:
<TASK>
? \_\_die\_body+0x5f/0xb0
? die+0x9e/0xc0
? do\_trap+0x15a/0x3a0
? ocfs2\_set\_new\_buffer\_uptodate+0x145/0x160
? do\_error\_trap+0x1dc/0x2c0
? ocfs2\_set\_new\_buffer\_uptodate+0x145/0x160
? \_\_pfx\_do\_error\_trap+0x10/0x10
? handle\_invalid\_op+0x34/0x40
? ocfs2\_set\_new\_buffer\_uptodate+0x145/0x160
? exc\_invalid\_op+0x38/0x50
? asm\_exc\_invalid\_op+0x1a/0x20
? ocfs2\_set\_new\_buffer\_uptodate+0x2e/0x160
? ocfs2\_set\_new\_buffer\_uptodate+0x144/0x160
? ocfs2\_set\_new\_buffer\_uptodate+0x145/0x160
ocfs2\_group\_add+0x39f/0x15a0
? \_\_pfx\_ocfs2\_group\_add+0x10/0x10
? \_\_pfx\_lock\_acquire+0x10/0x10
? mnt\_get\_write\_access+0x68/0x2b0
? \_\_pfx\_lock\_release+0x10/0x10
? rcu\_read\_lock\_any\_held+0xb7/0x160
? \_\_pfx\_rcu\_read\_lock\_any\_held+0x10/0x10
? smack\_log+0x123/0x540
? mnt\_get\_write\_access+0x68/0x2b0
? mnt\_get\_write\_access+0x68/0x2b0
? mnt\_get\_write\_access+0x226/0x2b0
ocfs2\_ioctl+0x65e/0x7d0
? \_\_pfx\_ocfs2\_ioctl+0x10/0x10
? smack\_file\_ioctl+0x29e/0x3a0
? \_\_pfx\_smack\_file\_ioctl+0x10/0x10
? lockdep\_hardirqs\_on\_prepare+0x43d/0x780
? \_\_pfx\_lockdep\_hardirqs\_on\_prepare+0x10/0x10
? \_\_pfx\_ocfs2\_ioctl+0x10/0x10
\_\_se\_sys\_ioctl+0xfb/0x170
do\_syscall\_64+0xf3/0x230
entry\_SYSCALL\_64\_after\_hwframe+0x77/0x7f
...
</TASK>
When 'ioctl(OCFS2\_IOC\_GROUP\_ADD, ...)' has failed for the particular
inode in 'ocfs2\_verify\_group\_and\_input()', corresponding buffer head
remains cached and subsequent call to the same 'ioctl()' for the same
inode issues the BUG() in 'ocfs2\_set\_new\_buffer\_uptodate()' (trying
to cache the same buffer head of that inode). Fix this by uncaching
the buffer head with 'ocfs2\_remove\_from\_cache()' on error path in
'ocfs2\_group\_add()'.
Link: [https://lkml.kernel.org/r/20241114043844.111847-1-dmantipov@yandex.ru](https://lkml.kernel.org/r/20241114043844.111847-1-dmantipov%40yandex.ru)
Fixes: 7909f2bf8353 ("[PATCH 2/2] ocfs2: Implement group add for online resize")
Signed-off-by: Dmitry Antipov <dmantipov@yandex.ru>
Reported-by: syzbot+453873f1588c2d75b447@syzkaller.appspotmail.com
Closes: https://syzkaller.appspot.com/bug?extid=453873f1588c2d75b447
Reviewed-by: Joseph Qi <joseph.qi@linux.alibaba.com>
Cc: Dmitry Antipov <dmantipov@yandex.ru>
Cc: Joel Becker <jlbec@evilplan.org>
Cc: Mark Fasheh <mark@fasheh.com>
Cc: Junxiao Bi <junxiao.bi@oracle.com>
Cc: Changwei Ge <gechangwei@live.cn>
Cc: Jun Piao <piaojun@huawei.com>
Cc: <stable@vger.kernel.org>
Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=620d22598110b0d0cb97a3fcca65fc473ea86e73)

| -rw-r--r-- | [fs/ocfs2/resize.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/fs/ocfs2/resize.c?id=620d22598110b0d0cb97a3fcca65fc473ea86e73) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 2 insertions, 0 deletions

| diff --git a/fs/ocfs2/resize.c b/fs/ocfs2/resize.cindex d65d43c61857a4..b2b47bb7952962 100644--- a/[fs/ocfs2/resize.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/ocfs2/resize.c?id=6addb2d9501ec866d7b3a3b4e665307c437e9be2)+++ b/[fs/ocfs2/resize.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/ocfs2/resize.c?id=620d22598110b0d0cb97a3fcca65fc473ea86e73)@@ -566,6 +566,8 @@ out\_commit: ocfs2\_commit\_trans(osb, handle);  out\_free\_group\_bh:+ if (ret < 0)+ ocfs2\_remove\_from\_cache(INODE\_CACHE(inode), group\_bh); brelse(group\_bh);  out\_unlock: |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-15 09:02:35 +0000



=== Content from git.kernel.org_b58b5e0f_20250115_090400.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=ac0cfe8ac35cf1be54131b90d114087b558777ca)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=ac0cfe8ac35cf1be54131b90d114087b558777ca)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=ac0cfe8ac35cf1be54131b90d114087b558777ca)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=ac0cfe8ac35cf1be54131b90d114087b558777ca)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Dmitry Antipov <dmantipov@yandex.ru> | 2024-11-14 07:38:44 +0300 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-05 10:59:28 +0100 |
| commit | [ac0cfe8ac35cf1be54131b90d114087b558777ca](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=ac0cfe8ac35cf1be54131b90d114087b558777ca) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=ac0cfe8ac35cf1be54131b90d114087b558777ca)) | |
| tree | [50631996e5220ec3a596befc7e58c52b418f34fb](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=ac0cfe8ac35cf1be54131b90d114087b558777ca) | |
| parent | [114a61d8d94ae3a43b82446cf737fd757021b834](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=114a61d8d94ae3a43b82446cf737fd757021b834) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=ac0cfe8ac35cf1be54131b90d114087b558777ca&id2=114a61d8d94ae3a43b82446cf737fd757021b834)) | |
| download | [linux-ac0cfe8ac35cf1be54131b90d114087b558777ca.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-ac0cfe8ac35cf1be54131b90d114087b558777ca.tar.gz) | |

ocfs2: uncache inode which has failed entering the groupcommit 737f34137844d6572ab7d473c998c7f977ff30eb upstream.
Syzbot has reported the following BUG:
kernel BUG at fs/ocfs2/uptodate.c:509!
...
Call Trace:
<TASK>
? \_\_die\_body+0x5f/0xb0
? die+0x9e/0xc0
? do\_trap+0x15a/0x3a0
? ocfs2\_set\_new\_buffer\_uptodate+0x145/0x160
? do\_error\_trap+0x1dc/0x2c0
? ocfs2\_set\_new\_buffer\_uptodate+0x145/0x160
? \_\_pfx\_do\_error\_trap+0x10/0x10
? handle\_invalid\_op+0x34/0x40
? ocfs2\_set\_new\_buffer\_uptodate+0x145/0x160
? exc\_invalid\_op+0x38/0x50
? asm\_exc\_invalid\_op+0x1a/0x20
? ocfs2\_set\_new\_buffer\_uptodate+0x2e/0x160
? ocfs2\_set\_new\_buffer\_uptodate+0x144/0x160
? ocfs2\_set\_new\_buffer\_uptodate+0x145/0x160
ocfs2\_group\_add+0x39f/0x15a0
? \_\_pfx\_ocfs2\_group\_add+0x10/0x10
? \_\_pfx\_lock\_acquire+0x10/0x10
? mnt\_get\_write\_access+0x68/0x2b0
? \_\_pfx\_lock\_release+0x10/0x10
? rcu\_read\_lock\_any\_held+0xb7/0x160
? \_\_pfx\_rcu\_read\_lock\_any\_held+0x10/0x10
? smack\_log+0x123/0x540
? mnt\_get\_write\_access+0x68/0x2b0
? mnt\_get\_write\_access+0x68/0x2b0
? mnt\_get\_write\_access+0x226/0x2b0
ocfs2\_ioctl+0x65e/0x7d0
? \_\_pfx\_ocfs2\_ioctl+0x10/0x10
? smack\_file\_ioctl+0x29e/0x3a0
? \_\_pfx\_smack\_file\_ioctl+0x10/0x10
? lockdep\_hardirqs\_on\_prepare+0x43d/0x780
? \_\_pfx\_lockdep\_hardirqs\_on\_prepare+0x10/0x10
? \_\_pfx\_ocfs2\_ioctl+0x10/0x10
\_\_se\_sys\_ioctl+0xfb/0x170
do\_syscall\_64+0xf3/0x230
entry\_SYSCALL\_64\_after\_hwframe+0x77/0x7f
...
</TASK>
When 'ioctl(OCFS2\_IOC\_GROUP\_ADD, ...)' has failed for the particular
inode in 'ocfs2\_verify\_group\_and\_input()', corresponding buffer head
remains cached and subsequent call to the same 'ioctl()' for the same
inode issues the BUG() in 'ocfs2\_set\_new\_buffer\_uptodate()' (trying
to cache the same buffer head of that inode). Fix this by uncaching
the buffer head with 'ocfs2\_remove\_from\_cache()' on error path in
'ocfs2\_group\_add()'.
Link: [https://lkml.kernel.org/r/20241114043844.111847-1-dmantipov@yandex.ru](https://lkml.kernel.org/r/20241114043844.111847-1-dmantipov%40yandex.ru)
Fixes: 7909f2bf8353 ("[PATCH 2/2] ocfs2: Implement group add for online resize")
Signed-off-by: Dmitry Antipov <dmantipov@yandex.ru>
Reported-by: syzbot+453873f1588c2d75b447@syzkaller.appspotmail.com
Closes: https://syzkaller.appspot.com/bug?extid=453873f1588c2d75b447
Reviewed-by: Joseph Qi <joseph.qi@linux.alibaba.com>
Cc: Dmitry Antipov <dmantipov@yandex.ru>
Cc: Joel Becker <jlbec@evilplan.org>
Cc: Mark Fasheh <mark@fasheh.com>
Cc: Junxiao Bi <junxiao.bi@oracle.com>
Cc: Changwei Ge <gechangwei@live.cn>
Cc: Jun Piao <piaojun@huawei.com>
Cc: <stable@vger.kernel.org>
Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=ac0cfe8ac35cf1be54131b90d114087b558777ca)

| -rw-r--r-- | [fs/ocfs2/resize.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/fs/ocfs2/resize.c?id=ac0cfe8ac35cf1be54131b90d114087b558777ca) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 2 insertions, 0 deletions

| diff --git a/fs/ocfs2/resize.c b/fs/ocfs2/resize.cindex 18451e0fab8192..b0be92d2f05f96 100644--- a/[fs/ocfs2/resize.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/ocfs2/resize.c?id=114a61d8d94ae3a43b82446cf737fd757021b834)+++ b/[fs/ocfs2/resize.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/ocfs2/resize.c?id=ac0cfe8ac35cf1be54131b90d114087b558777ca)@@ -582,6 +582,8 @@ out\_commit: ocfs2\_commit\_trans(osb, handle);  out\_free\_group\_bh:+ if (ret < 0)+ ocfs2\_remove\_from\_cache(INODE\_CACHE(inode), group\_bh); brelse(group\_bh);  out\_unlock: |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-15 09:02:37 +0000



=== Content from git.kernel.org_9b855047_20250115_090356.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=0e04746db2ec4aec04cef5763b9d9aa32829ae2f)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=0e04746db2ec4aec04cef5763b9d9aa32829ae2f)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=0e04746db2ec4aec04cef5763b9d9aa32829ae2f)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=0e04746db2ec4aec04cef5763b9d9aa32829ae2f)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Dmitry Antipov <dmantipov@yandex.ru> | 2024-11-14 07:38:44 +0300 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-14 19:50:35 +0100 |
| commit | [0e04746db2ec4aec04cef5763b9d9aa32829ae2f](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=0e04746db2ec4aec04cef5763b9d9aa32829ae2f) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=0e04746db2ec4aec04cef5763b9d9aa32829ae2f)) | |
| tree | [d5fbdae8143da2b89524b6541ee0f7e2155d3fa9](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=0e04746db2ec4aec04cef5763b9d9aa32829ae2f) | |
| parent | [903d896448c2e50e8652aaba529a30d4d1eaa0e5](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=903d896448c2e50e8652aaba529a30d4d1eaa0e5) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=0e04746db2ec4aec04cef5763b9d9aa32829ae2f&id2=903d896448c2e50e8652aaba529a30d4d1eaa0e5)) | |
| download | [linux-0e04746db2ec4aec04cef5763b9d9aa32829ae2f.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-0e04746db2ec4aec04cef5763b9d9aa32829ae2f.tar.gz) | |

ocfs2: uncache inode which has failed entering the groupcommit 737f34137844d6572ab7d473c998c7f977ff30eb upstream.
Syzbot has reported the following BUG:
kernel BUG at fs/ocfs2/uptodate.c:509!
...
Call Trace:
<TASK>
? \_\_die\_body+0x5f/0xb0
? die+0x9e/0xc0
? do\_trap+0x15a/0x3a0
? ocfs2\_set\_new\_buffer\_uptodate+0x145/0x160
? do\_error\_trap+0x1dc/0x2c0
? ocfs2\_set\_new\_buffer\_uptodate+0x145/0x160
? \_\_pfx\_do\_error\_trap+0x10/0x10
? handle\_invalid\_op+0x34/0x40
? ocfs2\_set\_new\_buffer\_uptodate+0x145/0x160
? exc\_invalid\_op+0x38/0x50
? asm\_exc\_invalid\_op+0x1a/0x20
? ocfs2\_set\_new\_buffer\_uptodate+0x2e/0x160
? ocfs2\_set\_new\_buffer\_uptodate+0x144/0x160
? ocfs2\_set\_new\_buffer\_uptodate+0x145/0x160
ocfs2\_group\_add+0x39f/0x15a0
? \_\_pfx\_ocfs2\_group\_add+0x10/0x10
? \_\_pfx\_lock\_acquire+0x10/0x10
? mnt\_get\_write\_access+0x68/0x2b0
? \_\_pfx\_lock\_release+0x10/0x10
? rcu\_read\_lock\_any\_held+0xb7/0x160
? \_\_pfx\_rcu\_read\_lock\_any\_held+0x10/0x10
? smack\_log+0x123/0x540
? mnt\_get\_write\_access+0x68/0x2b0
? mnt\_get\_write\_access+0x68/0x2b0
? mnt\_get\_write\_access+0x226/0x2b0
ocfs2\_ioctl+0x65e/0x7d0
? \_\_pfx\_ocfs2\_ioctl+0x10/0x10
? smack\_file\_ioctl+0x29e/0x3a0
? \_\_pfx\_smack\_file\_ioctl+0x10/0x10
? lockdep\_hardirqs\_on\_prepare+0x43d/0x780
? \_\_pfx\_lockdep\_hardirqs\_on\_prepare+0x10/0x10
? \_\_pfx\_ocfs2\_ioctl+0x10/0x10
\_\_se\_sys\_ioctl+0xfb/0x170
do\_syscall\_64+0xf3/0x230
entry\_SYSCALL\_64\_after\_hwframe+0x77/0x7f
...
</TASK>
When 'ioctl(OCFS2\_IOC\_GROUP\_ADD, ...)' has failed for the particular
inode in 'ocfs2\_verify\_group\_and\_input()', corresponding buffer head
remains cached and subsequent call to the same 'ioctl()' for the same
inode issues the BUG() in 'ocfs2\_set\_new\_buffer\_uptodate()' (trying
to cache the same buffer head of that inode). Fix this by uncaching
the buffer head with 'ocfs2\_remove\_from\_cache()' on error path in
'ocfs2\_group\_add()'.
Link: [https://lkml.kernel.org/r/20241114043844.111847-1-dmantipov@yandex.ru](https://lkml.kernel.org/r/20241114043844.111847-1-dmantipov%40yandex.ru)
Fixes: 7909f2bf8353 ("[PATCH 2/2] ocfs2: Implement group add for online resize")
Signed-off-by: Dmitry Antipov <dmantipov@yandex.ru>
Reported-by: syzbot+453873f1588c2d75b447@syzkaller.appspotmail.com
Closes: https://syzkaller.appspot.com/bug?extid=453873f1588c2d75b447
Reviewed-by: Joseph Qi <joseph.qi@linux.alibaba.com>
Cc: Dmitry Antipov <dmantipov@yandex.ru>
Cc: Joel Becker <jlbec@evilplan.org>
Cc: Mark Fasheh <mark@fasheh.com>
Cc: Junxiao Bi <junxiao.bi@oracle.com>
Cc: Changwei Ge <gechangwei@live.cn>
Cc: Jun Piao <piaojun@huawei.com>
Cc: <stable@vger.kernel.org>
Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=0e04746db2ec4aec04cef5763b9d9aa32829ae2f)

| -rw-r--r-- | [fs/ocfs2/resize.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/fs/ocfs2/resize.c?id=0e04746db2ec4aec04cef5763b9d9aa32829ae2f) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 2 insertions, 0 deletions

| diff --git a/fs/ocfs2/resize.c b/fs/ocfs2/resize.cindex d65d43c61857a4..b2b47bb7952962 100644--- a/[fs/ocfs2/resize.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/ocfs2/resize.c?id=903d896448c2e50e8652aaba529a30d4d1eaa0e5)+++ b/[fs/ocfs2/resize.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/ocfs2/resize.c?id=0e04746db2ec4aec04cef5763b9d9aa32829ae2f)@@ -566,6 +566,8 @@ out\_commit: ocfs2\_commit\_trans(osb, handle);  out\_free\_group\_bh:+ if (ret < 0)+ ocfs2\_remove\_from\_cache(INODE\_CACHE(inode), group\_bh); brelse(group\_bh);  out\_unlock: |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-15 09:02:33 +0000



=== Content from git.kernel.org_1801afde_20250115_090359.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=737f34137844d6572ab7d473c998c7f977ff30eb)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=737f34137844d6572ab7d473c998c7f977ff30eb)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=737f34137844d6572ab7d473c998c7f977ff30eb)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=737f34137844d6572ab7d473c998c7f977ff30eb)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Dmitry Antipov <dmantipov@yandex.ru> | 2024-11-14 07:38:44 +0300 |
| --- | --- | --- |
| committer | Andrew Morton <akpm@linux-foundation.org> | 2024-11-14 22:43:48 -0800 |
| commit | [737f34137844d6572ab7d473c998c7f977ff30eb](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=737f34137844d6572ab7d473c998c7f977ff30eb) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=737f34137844d6572ab7d473c998c7f977ff30eb)) | |
| tree | [155bf18b0923ff20af5a5d5794edcfeb4d94898b](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=737f34137844d6572ab7d473c998c7f977ff30eb) | |
| parent | [8ce41b0f9d77cca074df25afd39b86e2ee3aa68e](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=8ce41b0f9d77cca074df25afd39b86e2ee3aa68e) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=737f34137844d6572ab7d473c998c7f977ff30eb&id2=8ce41b0f9d77cca074df25afd39b86e2ee3aa68e)) | |
| download | [linux-737f34137844d6572ab7d473c998c7f977ff30eb.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-737f34137844d6572ab7d473c998c7f977ff30eb.tar.gz) | |

ocfs2: uncache inode which has failed entering the groupSyzbot has reported the following BUG:
kernel BUG at fs/ocfs2/uptodate.c:509!
...
Call Trace:
<TASK>
? \_\_die\_body+0x5f/0xb0
? die+0x9e/0xc0
? do\_trap+0x15a/0x3a0
? ocfs2\_set\_new\_buffer\_uptodate+0x145/0x160
? do\_error\_trap+0x1dc/0x2c0
? ocfs2\_set\_new\_buffer\_uptodate+0x145/0x160
? \_\_pfx\_do\_error\_trap+0x10/0x10
? handle\_invalid\_op+0x34/0x40
? ocfs2\_set\_new\_buffer\_uptodate+0x145/0x160
? exc\_invalid\_op+0x38/0x50
? asm\_exc\_invalid\_op+0x1a/0x20
? ocfs2\_set\_new\_buffer\_uptodate+0x2e/0x160
? ocfs2\_set\_new\_buffer\_uptodate+0x144/0x160
? ocfs2\_set\_new\_buffer\_uptodate+0x145/0x160
ocfs2\_group\_add+0x39f/0x15a0
? \_\_pfx\_ocfs2\_group\_add+0x10/0x10
? \_\_pfx\_lock\_acquire+0x10/0x10
? mnt\_get\_write\_access+0x68/0x2b0
? \_\_pfx\_lock\_release+0x10/0x10
? rcu\_read\_lock\_any\_held+0xb7/0x160
? \_\_pfx\_rcu\_read\_lock\_any\_held+0x10/0x10
? smack\_log+0x123/0x540
? mnt\_get\_write\_access+0x68/0x2b0
? mnt\_get\_write\_access+0x68/0x2b0
? mnt\_get\_write\_access+0x226/0x2b0
ocfs2\_ioctl+0x65e/0x7d0
? \_\_pfx\_ocfs2\_ioctl+0x10/0x10
? smack\_file\_ioctl+0x29e/0x3a0
? \_\_pfx\_smack\_file\_ioctl+0x10/0x10
? lockdep\_hardirqs\_on\_prepare+0x43d/0x780
? \_\_pfx\_lockdep\_hardirqs\_on\_prepare+0x10/0x10
? \_\_pfx\_ocfs2\_ioctl+0x10/0x10
\_\_se\_sys\_ioctl+0xfb/0x170
do\_syscall\_64+0xf3/0x230
entry\_SYSCALL\_64\_after\_hwframe+0x77/0x7f
...
</TASK>
When 'ioctl(OCFS2\_IOC\_GROUP\_ADD, ...)' has failed for the particular
inode in 'ocfs2\_verify\_group\_and\_input()', corresponding buffer head
remains cached and subsequent call to the same 'ioctl()' for the same
inode issues the BUG() in 'ocfs2\_set\_new\_buffer\_uptodate()' (trying
to cache the same buffer head of that inode). Fix this by uncaching
the buffer head with 'ocfs2\_remove\_from\_cache()' on error path in
'ocfs2\_group\_add()'.
Link: [https://lkml.kernel.org/r/20241114043844.111847-1-dmantipov@yandex.ru](https://lkml.kernel.org/r/20241114043844.111847-1-dmantipov%40yandex.ru)
Fixes: 7909f2bf8353 ("[PATCH 2/2] ocfs2: Implement group add for online resize")
Signed-off-by: Dmitry Antipov <dmantipov@yandex.ru>
Reported-by: syzbot+453873f1588c2d75b447@syzkaller.appspotmail.com
Closes: https://syzkaller.appspot.com/bug?extid=453873f1588c2d75b447
Reviewed-by: Joseph Qi <joseph.qi@linux.alibaba.com>
Cc: Dmitry Antipov <dmantipov@yandex.ru>
Cc: Joel Becker <jlbec@evilplan.org>
Cc: Mark Fasheh <mark@fasheh.com>
Cc: Junxiao Bi <junxiao.bi@oracle.com>
Cc: Changwei Ge <gechangwei@live.cn>
Cc: Jun Piao <piaojun@huawei.com>
Cc: <stable@vger.kernel.org>
Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=737f34137844d6572ab7d473c998c7f977ff30eb)

| -rw-r--r-- | [fs/ocfs2/resize.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/fs/ocfs2/resize.c?id=737f34137844d6572ab7d473c998c7f977ff30eb) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 2 insertions, 0 deletions

| diff --git a/fs/ocfs2/resize.c b/fs/ocfs2/resize.cindex c4a4016d3866a3..b0733c08ed13b1 100644--- a/[fs/ocfs2/resize.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/ocfs2/resize.c?id=8ce41b0f9d77cca074df25afd39b86e2ee3aa68e)+++ b/[fs/ocfs2/resize.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/ocfs2/resize.c?id=737f34137844d6572ab7d473c998c7f977ff30eb)@@ -574,6 +574,8 @@ out\_commit: ocfs2\_commit\_trans(osb, handle);  out\_free\_group\_bh:+ if (ret < 0)+ ocfs2\_remove\_from\_cache(INODE\_CACHE(inode), group\_bh); brelse(group\_bh);  out\_unlock: |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-15 09:02:36 +0000



=== Content from git.kernel.org_6f0a4584_20250115_090400.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=843dfc804af4b338ead42331dd58081b428ecdf8)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=843dfc804af4b338ead42331dd58081b428ecdf8)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=843dfc804af4b338ead42331dd58081b428ecdf8)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=843dfc804af4b338ead42331dd58081b428ecdf8)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Dmitry Antipov <dmantipov@yandex.ru> | 2024-11-14 07:38:44 +0300 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-11-22 15:38:33 +0100 |
| commit | [843dfc804af4b338ead42331dd58081b428ecdf8](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=843dfc804af4b338ead42331dd58081b428ecdf8) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=843dfc804af4b338ead42331dd58081b428ecdf8)) | |
| tree | [d5b410435ef53515d66d0d8f5350f3894a868c24](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=843dfc804af4b338ead42331dd58081b428ecdf8) | |
| parent | [d0f16cec79774c3132df006cf771eddd89d08f58](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=d0f16cec79774c3132df006cf771eddd89d08f58) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=843dfc804af4b338ead42331dd58081b428ecdf8&id2=d0f16cec79774c3132df006cf771eddd89d08f58)) | |
| download | [linux-843dfc804af4b338ead42331dd58081b428ecdf8.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-843dfc804af4b338ead42331dd58081b428ecdf8.tar.gz) | |

ocfs2: uncache inode which has failed entering the groupcommit 737f34137844d6572ab7d473c998c7f977ff30eb upstream.
Syzbot has reported the following BUG:
kernel BUG at fs/ocfs2/uptodate.c:509!
...
Call Trace:
<TASK>
? \_\_die\_body+0x5f/0xb0
? die+0x9e/0xc0
? do\_trap+0x15a/0x3a0
? ocfs2\_set\_new\_buffer\_uptodate+0x145/0x160
? do\_error\_trap+0x1dc/0x2c0
? ocfs2\_set\_new\_buffer\_uptodate+0x145/0x160
? \_\_pfx\_do\_error\_trap+0x10/0x10
? handle\_invalid\_op+0x34/0x40
? ocfs2\_set\_new\_buffer\_uptodate+0x145/0x160
? exc\_invalid\_op+0x38/0x50
? asm\_exc\_invalid\_op+0x1a/0x20
? ocfs2\_set\_new\_buffer\_uptodate+0x2e/0x160
? ocfs2\_set\_new\_buffer\_uptodate+0x144/0x160
? ocfs2\_set\_new\_buffer\_uptodate+0x145/0x160
ocfs2\_group\_add+0x39f/0x15a0
? \_\_pfx\_ocfs2\_group\_add+0x10/0x10
? \_\_pfx\_lock\_acquire+0x10/0x10
? mnt\_get\_write\_access+0x68/0x2b0
? \_\_pfx\_lock\_release+0x10/0x10
? rcu\_read\_lock\_any\_held+0xb7/0x160
? \_\_pfx\_rcu\_read\_lock\_any\_held+0x10/0x10
? smack\_log+0x123/0x540
? mnt\_get\_write\_access+0x68/0x2b0
? mnt\_get\_write\_access+0x68/0x2b0
? mnt\_get\_write\_access+0x226/0x2b0
ocfs2\_ioctl+0x65e/0x7d0
? \_\_pfx\_ocfs2\_ioctl+0x10/0x10
? smack\_file\_ioctl+0x29e/0x3a0
? \_\_pfx\_smack\_file\_ioctl+0x10/0x10
? lockdep\_hardirqs\_on\_prepare+0x43d/0x780
? \_\_pfx\_lockdep\_hardirqs\_on\_prepare+0x10/0x10
? \_\_pfx\_ocfs2\_ioctl+0x10/0x10
\_\_se\_sys\_ioctl+0xfb/0x170
do\_syscall\_64+0xf3/0x230
entry\_SYSCALL\_64\_after\_hwframe+0x77/0x7f
...
</TASK>
When 'ioctl(OCFS2\_IOC\_GROUP\_ADD, ...)' has failed for the particular
inode in 'ocfs2\_verify\_group\_and\_input()', corresponding buffer head
remains cached and subsequent call to the same 'ioctl()' for the same
inode issues the BUG() in 'ocfs2\_set\_new\_buffer\_uptodate()' (trying
to cache the same buffer head of that inode). Fix this by uncaching
the buffer head with 'ocfs2\_remove\_from\_cache()' on error path in
'ocfs2\_group\_add()'.
Link: [https://lkml.kernel.org/r/20241114043844.111847-1-dmantipov@yandex.ru](https://lkml.kernel.org/r/20241114043844.111847-1-dmantipov%40yandex.ru)
Fixes: 7909f2bf8353 ("[PATCH 2/2] ocfs2: Implement group add for online resize")
Signed-off-by: Dmitry Antipov <dmantipov@yandex.ru>
Reported-by: syzbot+453873f1588c2d75b447@syzkaller.appspotmail.com
Closes: https://syzkaller.appspot.com/bug?extid=453873f1588c2d75b447
Reviewed-by: Joseph Qi <joseph.qi@linux.alibaba.com>
Cc: Dmitry Antipov <dmantipov@yandex.ru>
Cc: Joel Becker <jlbec@evilplan.org>
Cc: Mark Fasheh <mark@fasheh.com>
Cc: Junxiao Bi <junxiao.bi@oracle.com>
Cc: Changwei Ge <gechangwei@live.cn>
Cc: Jun Piao <piaojun@huawei.com>
Cc: <stable@vger.kernel.org>
Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=843dfc804af4b338ead42331dd58081b428ecdf8)

| -rw-r--r-- | [fs/ocfs2/resize.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/fs/ocfs2/resize.c?id=843dfc804af4b338ead42331dd58081b428ecdf8) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 2 insertions, 0 deletions

| diff --git a/fs/ocfs2/resize.c b/fs/ocfs2/resize.cindex d65d43c61857a4..b2b47bb7952962 100644--- a/[fs/ocfs2/resize.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/ocfs2/resize.c?id=d0f16cec79774c3132df006cf771eddd89d08f58)+++ b/[fs/ocfs2/resize.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/ocfs2/resize.c?id=843dfc804af4b338ead42331dd58081b428ecdf8)@@ -566,6 +566,8 @@ out\_commit: ocfs2\_commit\_trans(osb, handle);  out\_free\_group\_bh:+ if (ret < 0)+ ocfs2\_remove\_from\_cache(INODE\_CACHE(inode), group\_bh); brelse(group\_bh);  out\_unlock: |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-15 09:02:37 +0000



=== Content from git.kernel.org_0459f5d4_20250115_090401.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=b751c50e19d66cfb7360c0b55cf17b0722252d12)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=b751c50e19d66cfb7360c0b55cf17b0722252d12)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=b751c50e19d66cfb7360c0b55cf17b0722252d12)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b751c50e19d66cfb7360c0b55cf17b0722252d12)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Dmitry Antipov <dmantipov@yandex.ru> | 2024-11-14 07:38:44 +0300 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-11-22 15:39:51 +0100 |
| commit | [b751c50e19d66cfb7360c0b55cf17b0722252d12](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=b751c50e19d66cfb7360c0b55cf17b0722252d12) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=b751c50e19d66cfb7360c0b55cf17b0722252d12)) | |
| tree | [144bf0aa3b857b25c37fdb8f5faa5a890add6ac0](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=b751c50e19d66cfb7360c0b55cf17b0722252d12) | |
| parent | [31502374627ba9ec3e710dbd0bb00457cc6d2c19](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=31502374627ba9ec3e710dbd0bb00457cc6d2c19) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b751c50e19d66cfb7360c0b55cf17b0722252d12&id2=31502374627ba9ec3e710dbd0bb00457cc6d2c19)) | |
| download | [linux-b751c50e19d66cfb7360c0b55cf17b0722252d12.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-b751c50e19d66cfb7360c0b55cf17b0722252d12.tar.gz) | |

ocfs2: uncache inode which has failed entering the groupcommit 737f34137844d6572ab7d473c998c7f977ff30eb upstream.
Syzbot has reported the following BUG:
kernel BUG at fs/ocfs2/uptodate.c:509!
...
Call Trace:
<TASK>
? \_\_die\_body+0x5f/0xb0
? die+0x9e/0xc0
? do\_trap+0x15a/0x3a0
? ocfs2\_set\_new\_buffer\_uptodate+0x145/0x160
? do\_error\_trap+0x1dc/0x2c0
? ocfs2\_set\_new\_buffer\_uptodate+0x145/0x160
? \_\_pfx\_do\_error\_trap+0x10/0x10
? handle\_invalid\_op+0x34/0x40
? ocfs2\_set\_new\_buffer\_uptodate+0x145/0x160
? exc\_invalid\_op+0x38/0x50
? asm\_exc\_invalid\_op+0x1a/0x20
? ocfs2\_set\_new\_buffer\_uptodate+0x2e/0x160
? ocfs2\_set\_new\_buffer\_uptodate+0x144/0x160
? ocfs2\_set\_new\_buffer\_uptodate+0x145/0x160
ocfs2\_group\_add+0x39f/0x15a0
? \_\_pfx\_ocfs2\_group\_add+0x10/0x10
? \_\_pfx\_lock\_acquire+0x10/0x10
? mnt\_get\_write\_access+0x68/0x2b0
? \_\_pfx\_lock\_release+0x10/0x10
? rcu\_read\_lock\_any\_held+0xb7/0x160
? \_\_pfx\_rcu\_read\_lock\_any\_held+0x10/0x10
? smack\_log+0x123/0x540
? mnt\_get\_write\_access+0x68/0x2b0
? mnt\_get\_write\_access+0x68/0x2b0
? mnt\_get\_write\_access+0x226/0x2b0
ocfs2\_ioctl+0x65e/0x7d0
? \_\_pfx\_ocfs2\_ioctl+0x10/0x10
? smack\_file\_ioctl+0x29e/0x3a0
? \_\_pfx\_smack\_file\_ioctl+0x10/0x10
? lockdep\_hardirqs\_on\_prepare+0x43d/0x780
? \_\_pfx\_lockdep\_hardirqs\_on\_prepare+0x10/0x10
? \_\_pfx\_ocfs2\_ioctl+0x10/0x10
\_\_se\_sys\_ioctl+0xfb/0x170
do\_syscall\_64+0xf3/0x230
entry\_SYSCALL\_64\_after\_hwframe+0x77/0x7f
...
</TASK>
When 'ioctl(OCFS2\_IOC\_GROUP\_ADD, ...)' has failed for the particular
inode in 'ocfs2\_verify\_group\_and\_input()', corresponding buffer head
remains cached and subsequent call to the same 'ioctl()' for the same
inode issues the BUG() in 'ocfs2\_set\_new\_buffer\_uptodate()' (trying
to cache the same buffer head of that inode). Fix this by uncaching
the buffer head with 'ocfs2\_remove\_from\_cache()' on error path in
'ocfs2\_group\_add()'.
Link: [https://lkml.kernel.org/r/20241114043844.111847-1-dmantipov@yandex.ru](https://lkml.kernel.org/r/20241114043844.111847-1-dmantipov%40yandex.ru)
Fixes: 7909f2bf8353 ("[PATCH 2/2] ocfs2: Implement group add for online resize")
Signed-off-by: Dmitry Antipov <dmantipov@yandex.ru>
Reported-by: syzbot+453873f1588c2d75b447@syzkaller.appspotmail.com
Closes: https://syzkaller.appspot.com/bug?extid=453873f1588c2d75b447
Reviewed-by: Joseph Qi <joseph.qi@linux.alibaba.com>
Cc: Dmitry Antipov <dmantipov@yandex.ru>
Cc: Joel Becker <jlbec@evilplan.org>
Cc: Mark Fasheh <mark@fasheh.com>
Cc: Junxiao Bi <junxiao.bi@oracle.com>
Cc: Changwei Ge <gechangwei@live.cn>
Cc: Jun Piao <piaojun@huawei.com>
Cc: <stable@vger.kernel.org>
Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b751c50e19d66cfb7360c0b55cf17b0722252d12)

| -rw-r--r-- | [fs/ocfs2/resize.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/fs/ocfs2/resize.c?id=b751c50e19d66cfb7360c0b55cf17b0722252d12) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 2 insertions, 0 deletions

| diff --git a/fs/ocfs2/resize.c b/fs/ocfs2/resize.cindex c4a4016d3866a3..b0733c08ed13b1 100644--- a/[fs/ocfs2/resize.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/ocfs2/resize.c?id=31502374627ba9ec3e710dbd0bb00457cc6d2c19)+++ b/[fs/ocfs2/resize.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/ocfs2/resize.c?id=b751c50e19d66cfb7360c0b55cf17b0722252d12)@@ -574,6 +574,8 @@ out\_commit: ocfs2\_commit\_trans(osb, handle);  out\_free\_group\_bh:+ if (ret < 0)+ ocfs2\_remove\_from\_cache(INODE\_CACHE(inode), group\_bh); brelse(group\_bh);  out\_unlock: |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-15 09:02:38 +0000


