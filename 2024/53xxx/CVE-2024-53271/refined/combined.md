=== Content from github.com_3f98c1a8_20250115_102240.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fenvoyproxy%2Fenvoy%2Fsecurity%2Fadvisories%2FGHSA-rmm5-h2wv-mg4f)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fenvoyproxy%2Fenvoy%2Fsecurity%2Fadvisories%2FGHSA-rmm5-h2wv-mg4f)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=envoyproxy%2Fenvoy)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[envoyproxy](/envoyproxy)
/
**[envoy](/envoyproxy/envoy)**
Public

* [Notifications](/login?return_to=%2Fenvoyproxy%2Fenvoy) You must be signed in to change notification settings
* [Fork
  4.9k](/login?return_to=%2Fenvoyproxy%2Fenvoy)
* [Star
   25.3k](/login?return_to=%2Fenvoyproxy%2Fenvoy)

* [Code](/envoyproxy/envoy)
* [Issues
  1.5k](/envoyproxy/envoy/issues)
* [Pull requests
  130](/envoyproxy/envoy/pulls)
* [Actions](/envoyproxy/envoy/actions)
* [Projects
  0](/envoyproxy/envoy/projects)
* [Wiki](/envoyproxy/envoy/wiki)
* [Security](/envoyproxy/envoy/security)
* [Insights](/envoyproxy/envoy/pulse)

Additional navigation options

* [Code](/envoyproxy/envoy)
* [Issues](/envoyproxy/envoy/issues)
* [Pull requests](/envoyproxy/envoy/pulls)
* [Actions](/envoyproxy/envoy/actions)
* [Projects](/envoyproxy/envoy/projects)
* [Wiki](/envoyproxy/envoy/wiki)
* [Security](/envoyproxy/envoy/security)
* [Insights](/envoyproxy/envoy/pulse)

# HTTP/1.1 multiple issues with envoy.reloadable\_features.http1\_balsa\_delay\_reset

High

[phlax](/phlax)
published
GHSA-rmm5-h2wv-mg4f
Dec 18, 2024

## Package

envoy

## Affected versions

> 1.31.0

## Patched versions

1.32.3, 1.31.5

## Description

### Summary

After upgrade envoy-1.29 to envoy-1.31.\* started observing increased number of failures on downstream services, failing with parsing errors etc.

### Details

setup where issue is reproduceable, however could not find a minimal working environment ALB->HTTP/1.1->EnvoyA->HTTP2->EnvoyB->HTTP/1.1->Custom HTTP/1.1 SRV

EnvoyB performs queueing with disabled outlier detection through upstream cluster config:

```
    outlier_detection:
      consecutive_5xx: 0
      enforcing_consecutive_5xx: 0
      consecutive_gateway_failure: 0
      enforcing_consecutive_gateway_failure: 0
      split_external_local_origin_errors: true
      consecutive_local_origin_failure: 0
      enforcing_consecutive_local_origin_failure: 0
      enforcing_local_origin_success_rate: 0
    circuit_breakers:
      thresholds:
      - priority: DEFAULT
        max_connections: 1536
        max_requests: 2048
        max_pending_requests: 2048
        max_retries: 512
      - priority: HIGH
        max_connections: 1536
        max_requests: 2048
        max_pending_requests: 2048
        max_retries: 512
      per_host_thresholds:
      - priority: DEFAULT
        max_connections: 3
      - priority: HIGH
        max_connections: 3
    typed_extension_protocol_options:
      envoy.extensions.upstreams.http.v3.HttpProtocolOptions:
        "@type": type.googleapis.com/envoy.extensions.upstreams.http.v3.HttpProtocolOptions
        common_http_protocol_options:
          idle_timeout: 90s
          max_requests_per_connection: 64
        explicit_http_config:
          http_protocol_options:
            allow_chunked_length: false
            override_stream_error_on_invalid_http_message: false

```

Original hypothesis was that some of requests got entangled, which was confirmed during research. Investigation leads to envoy.reloadable\_features.http1\_balsa\_delay\_reset flag which is set to true by default, together with another leading observation that HEAD request could not flow though envoyB always failing through UT/DR (depends on client timeout settings) and parser failure when SRV response is coupled with `102 Processing` here is the log of simple curl request:

lifecycle of a head request with 102 :
```
{"line":"[2024-10-22 16:12:28.264][60][debug][pool] [external/envoy/source/common/conn\_pool/conn\_pool\_base.cc:495] [Tags: \"ConnectionId\":\"87\"] client disconnected, failure reason: "}}
{"line":"[2024-10-22 16:12:28.264][60][debug][client] [external/envoy/source/common/http/codec\_client.cc:107] [Tags: \"ConnectionId\":\"87\"] disconnect. resetting 0 pending requests"}}
{"line":"[2024-10-22 16:12:28.264][60][trace][connection] [external/envoy/source/common/network/connection\_impl.cc:469] [Tags: \"ConnectionId\":\"87\"] raising connection event 1"}}
{"line":"[2024-10-22 16:12:28.264][60][debug][connection] [external/envoy/source/common/tls/ssl\_socket.cc:334] [Tags: \"ConnectionId\":\"87\"] SSL shutdown: rc=0"}}
{"line":"[2024-10-22 16:12:28.264][60][debug][connection] [external/envoy/source/common/network/connection\_impl.cc:276] [Tags: \"ConnectionId\":\"87\"] closing socket: 1"}}
{"line":"[2024-10-22 16:12:28.264][60][debug][connection] [external/envoy/source/common/network/connection\_impl.cc:150] [Tags: \"ConnectionId\":\"87\"] closing data\_to\_write=0 type=1"}}
{"line":"[2024-10-22 16:12:28.264][60][debug][client] [external/envoy/source/common/http/codec\_client.cc:171] [Tags: \"ConnectionId\":\"87\"] Error dispatching received data: "}}
{"line":"[2024-10-22 16:12:28.264][60][trace][http] [external/envoy/source/common/http/http1/codec\_impl.cc:1486] [Tags: \"ConnectionId\":\"87\"] status\_code 200"}}
{"line":"[2024-10-22 16:12:28.264][60][trace][http] [external/envoy/source/common/http/http1/codec\_impl.cc:544] [Tags: \"ConnectionId\":\"87\"] completed header: key=Content-Length value=0"}}
{"line":"[2024-10-22 16:12:28.264][60][trace][http] [external/envoy/source/common/http/http1/codec\_impl.cc:838] [Tags: \"ConnectionId\":\"87\"] onHeadersCompleteImpl"}}
{"line":"[2024-10-22 16:12:28.264][60][trace][http] [external/envoy/source/common/http/http1/codec\_impl.cc:544] [Tags: \"ConnectionId\":\"87\"] completed header: key=... value=..."}}
{"line":"[2024-10-22 16:12:28.264][60][trace][http] [external/envoy/source/common/http/http1/codec\_impl.cc:544] [Tags: \"ConnectionId\":\"87\"] completed header: key=... value=...."}}
{"line":"[2024-10-22 16:12:28.264][60][trace][http] [external/envoy/source/common/http/http1/codec\_impl.cc:544] [Tags: \"ConnectionId\":\"87\"] completed header: key=Content-Type value=application/xml"}}
{"line":"[2024-10-22 16:12:28.264][60][trace][http] [external/envoy/source/common/http/http1/codec\_impl.cc:544] [Tags: \"ConnectionId\":\"87\"] completed header: key=... value=..."}}
{"line":"[2024-10-22 16:12:28.264][60][trace][http] [external/envoy/source/common/http/http1/codec\_impl.cc:544] [Tags: \"ConnectionId\":\"87\"] completed header: key=... value=..."}}
{"line":"[2024-10-22 16:12:28.264][60][trace][http] [external/envoy/source/common/http/http1/codec\_impl.cc:544] [Tags: \"ConnectionId\":\"87\"] completed header: key=Set-Cookie ..."}}
{"line":"[2024-10-22 16:12:28.264][60][trace][http] [external/envoy/source/common/http/http1/codec\_impl.cc:544] [Tags: \"ConnectionId\":\"87\"] completed header: key=Set-Cookie ..."}}
{"line":"[2024-10-22 16:12:28.264][60][trace][http] [external/envoy/source/common/http/http1/codec\_impl.cc:544] [Tags: \"ConnectionId\":\"87\"] completed header: key=Set-Cookie ..."}}
{"line":"[2024-10-22 16:12:28.264][60][trace][http] [external/envoy/source/common/http/http1/codec\_impl.cc:544] [Tags: \"ConnectionId\":\"87\"] completed header: key=Set-Cookie ..."}}
{"line":"[2024-10-22 16:12:28.264][60][trace][http] [external/envoy/source/common/http/http1/codec\_impl.cc:587] [Tags: \"ConnectionId\":\"87\"] message begin"}}
{"line":"[2024-10-22 16:12:28.264][60][trace][http] [external/envoy/source/common/http/http1/codec\_impl.cc:645] [Tags: \"ConnectionId\":\"87\"] parsing 593 bytes"}}
{"line":"[2024-10-22 16:12:28.264][60][trace][connection] [external/envoy/source/common/tls/ssl\_socket.cc:168] [Tags: \"ConnectionId\":\"87\"] ssl read 593 bytes"}}
{"line":"[2024-10-22 16:12:28.264][60][trace][connection] [external/envoy/source/common/tls/ssl\_socket.cc:132] [Tags: \"ConnectionId\":\"87\"] ssl error occurred while read: WANT\_READ"}}
{"line":"[2024-10-22 16:12:28.264][60][trace][connection] [external/envoy/source/common/tls/ssl\_socket.cc:92] [Tags: \"ConnectionId\":\"87\"] ssl read returns: -1"}}
{"line":"[2024-10-22 16:12:28.264][60][trace][connection] [external/envoy/source/common/tls/ssl\_socket.cc:92] [Tags: \"ConnectionId\":\"87\"] ssl read returns: 593"}}
{"line":"[2024-10-22 16:12:28.264][60][trace][connection] [external/envoy/source/common/network/connection\_impl.cc:654] [Tags: \"ConnectionId\":\"87\"] read ready. dispatch\_buffered\_data=0"}}
{"line":"[2024-10-22 16:12:28.264][60][trace][connection] [external/envoy/source/common/network/connection\_impl.cc:737] [Tags: \"ConnectionId\":\"87\"] write ready"}}
{"line":"[2024-10-22 16:12:28.264][60][trace][connection] [external/envoy/source/common/network/connection\_impl.cc:614] [Tags: \"ConnectionId\":\"87\"] socket event: 3"}}
{"line":"[2024-10-22 16:12:28.259][60][trace][http] [external/envoy/source/common/http/http1/codec\_impl.cc:695] [Tags: \"ConnectionId\":\"87\"] parsed 27 bytes"}}
{"line":"[2024-10-22 16:12:28.259][60][debug][pool] [external/envoy/source/common/conn\_pool/conn\_pool\_base.cc:215] [Tags: \"ConnectionId\":\"87\"] destroying stream: 0 remaining"}}
{"line":"[2024-10-22 16:12:28.259][60][debug][pool] [external/envoy/source/common/http/http1/conn\_pool.cc:53] [Tags: \"ConnectionId\":\"87\"] response complete"}}
{"line":"[2024-10-22 16:12:28.259][60][debug][client] [external/envoy/source/common/http/codec\_client.cc:129] [Tags: \"ConnectionId\":\"87\"] response complete"}}
{"line":"[2024-10-22 16:12:28.259][60][trace][http] [external/envoy/source/common/http/http1/codec\_impl.cc:1568] [Tags: \"ConnectionId\":\"87\"] message complete"}}
{"line":"[2024-10-22 16:12:28.259][60][trace][http] [external/envoy/source/common/http/http1/codec\_impl.cc:942] [Tags: \"ConnectionId\":\"87\"] message complete"}}
{"line":"[2024-10-22 16:12:28.259][60][trace][http] [external/envoy/source/common/http/http1/codec\_impl.cc:1568] [Tags: \"ConnectionId\":\"87\"] message complete"}}
{"line":"[2024-10-22 16:12:28.259][60][trace][http] [external/envoy/source/common/http/http1/codec\_impl.cc:942] [Tags: \"ConnectionId\":\"87\"] message complete"}}
{"line":"[2024-10-22 16:12:28.259][60][trace][http] [external/envoy/source/common/http/http1/codec\_impl.cc:1496] [Tags: \"ConnectionId\":\"87\"] Client: onHeadersComplete size=0"}}
{"line":"[2024-10-22 16:12:28.259][60][trace][http] [external/envoy/source/common/http/http1/codec\_impl.cc:1486] [Tags: \"ConnectionId\":\"87\"] status\_code 102"}}
{"line":"[2024-10-22 16:12:28.259][60][trace][http] [external/envoy/source/common/http/http1/codec\_impl.cc:544] [Tags: \"ConnectionId\":\"87\"] completed header: key= value="}}
{"line":"[2024-10-22 16:12:28.259][60][trace][http] [external/envoy/source/common/http/http1/codec\_impl.cc:838] [Tags: \"ConnectionId\":\"87\"] onHeadersCompleteImpl"}}
{"line":"[2024-10-22 16:12:28.259][60][trace][http] [external/envoy/source/common/http/http1/codec\_impl.cc:587] [Tags: \"ConnectionId\":\"87\"] message begin"}}
{"line":"[2024-10-22 16:12:28.259][60][trace][http] [external/envoy/source/common/http/http1/codec\_impl.cc:645] [Tags: \"ConnectionId\":\"87\"] parsing 27 bytes"}}
{"line":"[2024-10-22 16:12:28.259][60][trace][connection] [external/envoy/source/common/tls/ssl\_socket.cc:168] [Tags: \"ConnectionId\":\"87\"] ssl read 27 bytes"}}
{"line":"[2024-10-22 16:12:28.259][60][trace][connection] [external/envoy/source/common/tls/ssl\_socket.cc:132] [Tags: \"ConnectionId\":\"87\"] ssl error occurred while read: WANT\_READ"}}
{"line":"[2024-10-22 16:12:28.259][60][trace][connection] [external/envoy/source/common/tls/ssl\_socket.cc:92] [Tags: \"ConnectionId\":\"87\"] ssl read returns: -1"}}
{"line":"[2024-10-22 16:12:28.258][60][trace][connection] [external/envoy/source/common/tls/ssl\_socket.cc:92] [Tags: \"ConnectionId\":\"87\"] ssl read returns: 27"}}
{"line":"[2024-10-22 16:12:28.258][60][trace][connection] [external/envoy/source/common/network/connection\_impl.cc:654] [Tags: \"ConnectionId\":\"87\"] read ready. dispatch\_buffered\_data=0"}}
{"line":"[2024-10-22 16:12:28.258][60][trace][connection] [external/envoy/source/common/network/connection\_impl.cc:737] [Tags: \"ConnectionId\":\"87\"] write ready"}}
{"line":"[2024-10-22 16:12:28.258][60][trace][connection] [external/envoy/source/common/network/connection\_impl.cc:614] [Tags: \"ConnectionId\":\"87\"] socket event: 3"}}
{"line":"[2024-10-22 16:12:28.258][60][trace][connection] [external/envoy/source/common/tls/ssl\_socket.cc:168] [Tags: \"ConnectionId\":\"87\"] ssl read 0 bytes"}}
{"line":"[2024-10-22 16:12:28.258][60][trace][connection] [external/envoy/source/common/tls/ssl\_socket.cc:132] [Tags: \"ConnectionId\":\"87\"] ssl error occurred while read: WANT\_READ"}}
{"line":"[2024-10-22 16:12:28.258][60][trace][connection] [external/envoy/source/common/tls/ssl\_socket.cc:92] [Tags: \"ConnectionId\":\"87\"] ssl read returns: -1"}}
{"line":"[2024-10-22 16:12:28.258][60][trace][connection] [external/envoy/source/common/network/connection\_impl.cc:654] [Tags: \"ConnectionId\":\"87\"] read ready. dispatch\_buffered\_data=0"}}
{"line":"[2024-10-22 16:12:28.258][60][trace][connection] [external/envoy/source/common/network/connection\_impl.cc:737] [Tags: \"ConnectionId\":\"87\"] write ready"}}
{"line":"[2024-10-22 16:12:28.258][60][trace][connection] [external/envoy/source/common/network/connection\_impl.cc:614] [Tags: \"ConnectionId\":\"87\"] socket event: 3"}}
{"line":"[2024-10-22 16:12:28.258][60][trace][connection] [external/envoy/source/common/network/connection\_impl.cc:737] [Tags: \"ConnectionId\":\"87\"] write ready"}}
{"line":"[2024-10-22 16:12:28.258][60][trace][connection] [external/envoy/source/common/network/connection\_impl.cc:614] [Tags: \"ConnectionId\":\"87\"] socket event: 2"}}
{"line":"[2024-10-22 16:12:28.258][60][trace][connection] [external/envoy/source/common/tls/ssl\_socket.cc:168] [Tags: \"ConnectionId\":\"87\"] ssl read 0 bytes"}}
{"line":"[2024-10-22 16:12:28.258][60][trace][connection] [external/envoy/source/common/tls/ssl\_socket.cc:132] [Tags: \"ConnectionId\":\"87\"] ssl error occurred while read: WANT\_READ"}}
{"line":"[2024-10-22 16:12:28.258][60][trace][connection] [external/envoy/source/common/tls/ssl\_socket.cc:92] [Tags: \"ConnectionId\":\"87\"] ssl read returns: -1"}}
{"line":"[2024-10-22 16:12:28.257][60][trace][connection] [external/envoy/source/common/network/connection\_impl.cc:654] [Tags: \"ConnectionId\":\"87\"] read ready. dispatch\_buffered\_data=0"}}
{"line":"[2024-10-22 16:12:28.257][60][trace][connection] [external/envoy/source/common/tls/ssl\_socket.cc:282] [Tags: \"ConnectionId\":\"87\"] ssl write returns: 626"}}
{"line":"[2024-10-22 16:12:28.257][60][trace][connection] [external/envoy/source/common/network/connection\_impl.cc:737] [Tags: \"ConnectionId\":\"87\"] write ready"}}
{"line":"[2024-10-22 16:12:28.257][60][debug][client] [external/envoy/source/common/http/codec\_client.cc:142] [Tags: \"ConnectionId\":\"87\"] encode complete"}}
{"line":"[2024-10-22 16:12:28.257][60][trace][connection] [external/envoy/source/common/network/connection\_impl.cc:529] [Tags: \"ConnectionId\":\"87\"] writing 626 bytes, end\_stream false"}}
{"line":"[2024-10-22 16:12:28.257][60][debug][pool] [external/envoy/source/common/conn\_pool/conn\_pool\_base.cc:182] [Tags: \"ConnectionId\":\"87\"] creating stream"}}
{"line":"[2024-10-22 16:12:28.257][60][debug][pool] [external/envoy/source/common/conn\_pool/conn\_pool\_base.cc:328] [Tags: \"ConnectionId\":\"87\"] attaching to next stream"}}
{"line":"[2024-10-22 16:12:28.257][60][debug][client] [external/envoy/source/common/http/codec\_client.cc:88] [Tags: \"ConnectionId\":\"87\"] connected"}}
{"line":"[2024-10-22 16:12:28.257][60][trace][connection] [external/envoy/source/common/network/connection\_impl.cc:469] [Tags: \"ConnectionId\":\"87\"] raising connection event 2"}}
{"line":"[2024-10-22 16:12:28.257][60][trace][connection] [external/envoy/source/common/network/connection\_impl.cc:737] [Tags: \"ConnectionId\":\"87\"] write ready"}}
{"line":"[2024-10-22 16:12:28.257][60][trace][connection] [external/envoy/source/common/network/connection\_impl.cc:614] [Tags: \"ConnectionId\":\"87\"] socket event: 3"}}
{"line":"[2024-10-22 16:12:28.254][60][trace][connection] [external/envoy/source/common/tls/ssl\_handshaker.cc:149] [Tags: \"ConnectionId\":\"87\"] ssl error occurred while read: WANT\_READ"}}
{"line":"[2024-10-22 16:12:28.254][60][debug][connection] [external/envoy/source/common/network/connection\_impl.cc:746] [Tags: \"ConnectionId\":\"87\"] connected"}}
{"line":"[2024-10-22 16:12:28.254][60][trace][connection] [external/envoy/source/common/network/connection\_impl.cc:737] [Tags: \"ConnectionId\":\"87\"] write ready"}}
{"line":"[2024-10-22 16:12:28.254][60][trace][connection] [external/envoy/source/common/network/connection\_impl.cc:614] [Tags: \"ConnectionId\":\"87\"] socket event: 2"}}
{"line":"[2024-10-22 16:12:28.253][60][debug][connection] [external/envoy/source/common/network/connection\_impl.cc:1036] [Tags: \"ConnectionId\":\"87\"] connection in progress"}}
{"line":"[2024-10-22 16:12:28.253][60][debug][connection] [external/envoy/source/common/network/connection\_impl.cc:1017] [Tags: \"ConnectionId\":\"87\"] connecting to 10.104.108.183:50089"}}
{"line":"[2024-10-22 16:12:28.253][60][debug][client] [external/envoy/source/common/http/codec\_client.cc:57] [Tags: \"ConnectionId\":\"87\"] connecting"}}
{"line":"[2024-10-22 16:12:28.253][60][debug][connection] [external/envoy/source/common/network/connection\_impl.h:98] [Tags: \"ConnectionId\":\"87\"] current connecting state: true"}}
```

the theory is that configuration somehow triggers the problem in the parser and make it even worse if response from the server is not

well formatted single response, as a result other components become unreliable, while we would UPE or something similar.

### PoC

in test environment were able to easily reproduce by submitting `HEAD` requests, and server response as sequence of:

```
HTTP/1.1 102 Processing\r\n
\r\n
HTTP/1.1 200 Ok \r\n
......

```

25 clients. one instance of envoyB, all requests hitting same SRV instance(process is sequential), Client timeout ~ 150ms, Request Duration ~30ms, Avg Response on client ~ 440ms,, 65% of request failing with DC on envoyA, %50 of requests got to envoyB failing with DR, rest of requests has `200 ok`

was not able to reproduce the request entanglement without keep-alive `max_requests_per_connection: 1` or with disabled delayed reset: `envoy.reloadable_features.http1_balsa_delay_reset=false`

### Impact

High, users who are using keep-alive http/1.1 upstream and/or vulnerable upstream server which not strictly posing single well formatted responses

### Mitigation

* Disable envoy.reloadable\_features.http1\_balsa\_delay\_reset

### Severity

High

7.1

# CVSS overall score

 This score calculates overall vulnerability severity from 0 to 10 and is based on the Common Vulnerability Scoring System (CVSS).

 / 10

#### CVSS v3 base metrics

Attack vector
Network

Attack complexity
Low

Privileges required
None

User interaction
Required

Scope
Unchanged

Confidentiality
Low

Integrity
None

Availability
High

Learn more about base metrics

# CVSS v3 base metrics

Attack vector:
More severe the more the remote (logically and physically) an attacker can be in order to exploit the vulnerability.

Attack complexity:
More severe for the least complex attacks.

Privileges required:
More severe if no privileges are required.

User interaction:
More severe when no user interaction is required.

Scope:
More severe when a scope change occurs, e.g. one vulnerable component impacts resources in components beyond its security scope.

Confidentiality:
More severe when loss of data confidentiality is highest, measuring the level of data access available to an unauthorized user.

Integrity:
More severe when loss of data integrity is the highest, measuring the consequence of data modification possible by an unauthorized user.

Availability:
More severe when the loss of impacted component availability is highest.

CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:U/C:L/I:N/A:H

### CVE ID

CVE-2024-53271

### Weaknesses

No CWEs

### Credits

* [![@tedjpoole](https://avatars.githubusercontent.com/u/97459248?s=40&v=4)](/tedjpoole)
  [tedjpoole](/tedjpoole)
  Coordinator
* [![@paul-r-gall](https://avatars.githubusercontent.com/u/16453581?s=40&v=4)](/paul-r-gall)
  [paul-r-gall](/paul-r-gall)
  Remediation developer
* [![@phlax](https://avatars.githubusercontent.com/u/454682?s=40&v=4)](/phlax)
  [phlax](/phlax)
  Coordinator

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_5d36c6de_20250115_102239.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fenvoyproxy%2Fenvoy%2Fcommit%2Fda56f6da63079baecef9183436ee5f4141a59af8)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fenvoyproxy%2Fenvoy%2Fcommit%2Fda56f6da63079baecef9183436ee5f4141a59af8)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=envoyproxy%2Fenvoy)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[envoyproxy](/envoyproxy)
/
**[envoy](/envoyproxy/envoy)**
Public

* [Notifications](/login?return_to=%2Fenvoyproxy%2Fenvoy) You must be signed in to change notification settings
* [Fork
  4.9k](/login?return_to=%2Fenvoyproxy%2Fenvoy)
* [Star
   25.3k](/login?return_to=%2Fenvoyproxy%2Fenvoy)

* [Code](/envoyproxy/envoy)
* [Issues
  1.5k](/envoyproxy/envoy/issues)
* [Pull requests
  130](/envoyproxy/envoy/pulls)
* [Actions](/envoyproxy/envoy/actions)
* [Projects
  0](/envoyproxy/envoy/projects)
* [Wiki](/envoyproxy/envoy/wiki)
* [Security](/envoyproxy/envoy/security)
* [Insights](/envoyproxy/envoy/pulse)

Additional navigation options

* [Code](/envoyproxy/envoy)
* [Issues](/envoyproxy/envoy/issues)
* [Pull requests](/envoyproxy/envoy/pulls)
* [Actions](/envoyproxy/envoy/actions)
* [Projects](/envoyproxy/envoy/projects)
* [Wiki](/envoyproxy/envoy/wiki)
* [Security](/envoyproxy/envoy/security)
* [Insights](/envoyproxy/envoy/pulse)

## Commit

[Permalink](/envoyproxy/envoy/commit/da56f6da63079baecef9183436ee5f4141a59af8)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

[balsa] fix for 1xx response mixup

[Browse files](/envoyproxy/envoy/tree/da56f6da63079baecef9183436ee5f4141a59af8)
Browse the repository at this point in the history

```
Signed-off-by: Paul Ogilby <pgal@google.com>

Signed-off-by: Ryan Northey <ryan@synca.io>
```

* Loading branch information

[![@paul-r-gall](https://avatars.githubusercontent.com/u/16453581?s=40&v=4)](/paul-r-gall) [![@phlax](https://avatars.githubusercontent.com/u/454682?s=40&v=4)](/phlax)

[paul-r-gall](/envoyproxy/envoy/commits?author=paul-r-gall "View all commits by paul-r-gall")
authored and
[phlax](/envoyproxy/envoy/commits?author=phlax "View all commits by phlax")
committed
Dec 18, 2024

1 parent
[c312e48](/envoyproxy/envoy/commit/c312e483b32e5c09b10946d50f08c07988a7a1cd)

commit da56f6d

 Show file tree

 Hide file tree

Showing
**5 changed files**
with
**96 additions**
and
**1 deletion**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* changelogs

  + changelogs/current.yaml
    [current.yaml](#diff-6f9c718224c533c13c2c0ba1d5abaab86be9d0cc73808749c77934e9f9b0d5d0)
* source/common

  + http/http1

    - source/common/http/http1/balsa\_parser.cc
      [balsa\_parser.cc](#diff-341675e75f7d6a320a4cf40f4cca36f3e4a979399d34a7d384c705629497109f)
    - source/common/http/http1/balsa\_parser.h
      [balsa\_parser.h](#diff-d090773a5817f91ffacc547a3ebe5bf2fcb8cfd009f80d457ec150cfea85b132)
  + runtime

    - source/common/runtime/runtime\_features.cc
      [runtime\_features.cc](#diff-564059d71ff5c0acfb543ba9d9d652bcd7b716e741dcc45c6b8e4d60ff5428c0)
* test/integration

  + test/integration/protocol\_integration\_test.cc
    [protocol\_integration\_test.cc](#diff-478cdae3dba52e78ed6d1a2e4e4eb4a1aba3e80178b6c8d14707501fc1fb2ddb)

## There are no files selected for viewing

4 changes: 4 additions & 0 deletions

4
[changelogs/current.yaml](#diff-6f9c718224c533c13c2c0ba1d5abaab86be9d0cc73808749c77934e9f9b0d5d0 "changelogs/current.yaml")

Show comments

[View file](/envoyproxy/envoy/blob/da56f6da63079baecef9183436ee5f4141a59af8/changelogs/current.yaml)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -169,6 +169,10 @@ bug\_fixes: |
|  |  | - area: happy\_eyeballs |
|  |  | change: | |
|  |  | Validate that ``additional\_address`` are IP addresses instead of crashing when sorting. |
|  |  | - area: balsa |
|  |  | change: | |
|  |  | Fix incorrect handling of non-101 1xx responses. This fix can be temporarily reverted by setting runtime guard |
|  |  | ``envoy.reloadable\_features.wait\_for\_first\_byte\_before\_balsa\_msg\_done`` to false. |
|  |  |  |
|  |  | removed\_config\_or\_runtime: |
|  |  | # \*Normally occurs at the end of the\* :ref:`deprecation period <deprecated>` |
| Expand Down | |  |

5 changes: 4 additions & 1 deletion

5
[source/common/http/http1/balsa\_parser.cc](#diff-341675e75f7d6a320a4cf40f4cca36f3e4a979399d34a7d384c705629497109f "source/common/http/http1/balsa_parser.cc")

Show comments

[View file](/envoyproxy/envoy/blob/da56f6da63079baecef9183436ee5f4141a59af8/source/common/http/http1/balsa_parser.cc)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -360,7 +360,10 @@ void BalsaParser::HeaderDone() { |
|  |  | void BalsaParser::ContinueHeaderDone() {} |
|  |  |  |
|  |  | void BalsaParser::MessageDone() { |
|  |  | if (status\_ == ParserStatus::Error) { |
|  |  | if (status\_ == ParserStatus::Error || |
|  |  | // In the case of early 1xx, MessageDone() can be called twice in a row. |
|  |  | // The !first\_byte\_processed\_ check is to make this function idempotent. |
|  |  | (wait\_for\_first\_byte\_before\_msg\_done\_ && !first\_byte\_processed\_)) { |
|  |  | return; |
|  |  | } |
|  |  | status\_ = convertResult(connection\_->onMessageComplete()); |
| Expand Down | |  |

3 changes: 3 additions & 0 deletions

3
[source/common/http/http1/balsa\_parser.h](#diff-d090773a5817f91ffacc547a3ebe5bf2fcb8cfd009f80d457ec150cfea85b132 "source/common/http/http1/balsa_parser.h")

Show comments

[View file](/envoyproxy/envoy/blob/da56f6da63079baecef9183436ee5f4141a59af8/source/common/http/http1/balsa_parser.h)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -85,6 +85,9 @@ class BalsaParser : public Parser, public quiche::BalsaVisitorInterface { |
|  |  | // Latched value of `envoy.reloadable\_features.http1\_balsa\_delay\_reset`. |
|  |  | const bool delay\_reset\_ = |
|  |  | Runtime::runtimeFeatureEnabled("envoy.reloadable\_features.http1\_balsa\_delay\_reset"); |
|  |  | // Latched value of `envoy.reloadable\_features.wait\_for\_first\_byte\_before\_balsa\_msg\_done`. |
|  |  | const bool wait\_for\_first\_byte\_before\_msg\_done\_ = Runtime::runtimeFeatureEnabled( |
|  |  | "envoy.reloadable\_features.wait\_for\_first\_byte\_before\_balsa\_msg\_done"); |
|  |  | }; |
|  |  |  |
|  |  | } // namespace Http1 |
| Expand Down | |  |

1 change: 1 addition & 0 deletions

1
[source/common/runtime/runtime\_features.cc](#diff-564059d71ff5c0acfb543ba9d9d652bcd7b716e741dcc45c6b8e4d60ff5428c0 "source/common/runtime/runtime_features.cc")

Show comments

[View file](/envoyproxy/envoy/blob/da56f6da63079baecef9183436ee5f4141a59af8/source/common/runtime/runtime_features.cc)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -102,6 +102,7 @@ RUNTIME\_GUARD(envoy\_reloadable\_features\_use\_route\_host\_mutation\_for\_auto\_sni\_san |
|  |  | RUNTIME\_GUARD(envoy\_reloadable\_features\_use\_typed\_metadata\_in\_proxy\_protocol\_listener); |
|  |  | RUNTIME\_GUARD(envoy\_reloadable\_features\_validate\_connect); |
|  |  | RUNTIME\_GUARD(envoy\_reloadable\_features\_validate\_upstream\_headers); |
|  |  | RUNTIME\_GUARD(envoy\_reloadable\_features\_wait\_for\_first\_byte\_before\_balsa\_msg\_done); |
|  |  | RUNTIME\_GUARD(envoy\_reloadable\_features\_xds\_failover\_to\_primary\_enabled); |
|  |  | RUNTIME\_GUARD(envoy\_reloadable\_features\_xds\_prevent\_resource\_copy); |
|  |  | RUNTIME\_GUARD(envoy\_reloadable\_features\_xdstp\_path\_avoid\_colon\_encoding); |
| Expand Down | |  |

84 changes: 84 additions & 0 deletions

84
[test/integration/protocol\_integration\_test.cc](#diff-478cdae3dba52e78ed6d1a2e4e4eb4a1aba3e80178b6c8d14707501fc1fb2ddb "test/integration/protocol_integration_test.cc")

Show comments

[View file](/envoyproxy/envoy/blob/da56f6da63079baecef9183436ee5f4141a59af8/test/integration/protocol_integration_test.cc)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -1551,6 +1551,90 @@ TEST\_P(ProtocolIntegrationTest, EnvoyProxying104) { |
|  |  | testEnvoyProxying1xx(false, false, false, "104"); |
|  |  | } |
|  |  |  |
|  |  | TEST\_P(DownstreamProtocolIntegrationTest, EnvoyProxying102DelayBalsaReset) { |
|  |  | if (GetParam().http1\_implementation != Http1ParserImpl::BalsaParser || |
|  |  | GetParam().upstream\_protocol != Http::CodecType::HTTP1 || |
|  |  | GetParam().downstream\_protocol != Http::CodecType::HTTP1) { |
|  |  | GTEST\_SKIP() << "This test is only relevant for HTTP1 BalsaParser"; |
|  |  | } |
|  |  | config\_helper\_.addConfigModifier( |
|  |  | [&](envoy::extensions::filters::network::http\_connection\_manager::v3::HttpConnectionManager& |
|  |  | hcm) -> void { hcm.set\_proxy\_100\_continue(true); }); |
|  |  | config\_helper\_.addRuntimeOverride( |
|  |  | "envoy.reloadable\_features.wait\_for\_first\_byte\_before\_balsa\_msg\_done", "false"); |
|  |  | config\_helper\_.addRuntimeOverride("envoy.reloadable\_features.http1\_balsa\_delay\_reset", "true"); |
|  |  | initialize(); |
|  |  |  |
|  |  | codec\_client\_ = makeHttpConnection(lookupPort("http")); |
|  |  | auto response = codec\_client\_->makeHeaderOnlyRequest( |
|  |  | Http::TestRequestHeaderMapImpl{{":method", "HEAD"}, |
|  |  | {":path", "/dynamo/url"}, |
|  |  | {":scheme", "http"}, |
|  |  | {":authority", "sni.lyft.com"}, |
|  |  | {"expect", "100-contINUE"}}); |
|  |  | waitForNextUpstreamRequest(); |
|  |  | upstream\_request\_->encode1xxHeaders(Http::TestResponseHeaderMapImpl{{":status", "102"}}); |
|  |  | response->waitFor1xxHeaders(); |
|  |  | upstream\_request\_->encodeHeaders(default\_response\_headers\_, true); |
|  |  |  |
|  |  | EXPECT\_FALSE(response->waitForEndStream()); |
|  |  |  |
|  |  | cleanupUpstreamAndDownstream(); |
|  |  | } |
|  |  |  |
|  |  | TEST\_P(DownstreamProtocolIntegrationTest, EnvoyProxying102DelayBalsaResetWaitForFirstByte) { |
|  |  | if (GetParam().http1\_implementation != Http1ParserImpl::BalsaParser || |
|  |  | GetParam().upstream\_protocol != Http::CodecType::HTTP1) { |
|  |  | GTEST\_SKIP() << "This test is only relevant for HTTP1 upstream with BalsaParser"; |
|  |  | } |
|  |  | config\_helper\_.addConfigModifier( |
|  |  | [&](envoy::extensions::filters::network::http\_connection\_manager::v3::HttpConnectionManager& |
|  |  | hcm) -> void { hcm.set\_proxy\_100\_continue(true); }); |
|  |  | config\_helper\_.addRuntimeOverride( |
|  |  | "envoy.reloadable\_features.wait\_for\_first\_byte\_before\_balsa\_msg\_done", "true"); |
|  |  | config\_helper\_.addRuntimeOverride("envoy.reloadable\_features.http1\_balsa\_delay\_reset", "true"); |
|  |  | initialize(); |
|  |  |  |
|  |  | codec\_client\_ = makeHttpConnection(lookupPort("http")); |
|  |  | auto response = codec\_client\_->makeHeaderOnlyRequest( |
|  |  | Http::TestRequestHeaderMapImpl{{":method", "HEAD"}, |
|  |  | {":path", "/dynamo/url"}, |
|  |  | {":scheme", "http"}, |
|  |  | {":authority", "sni.lyft.com"}, |
|  |  | {"expect", "100-contINUE"}}); |
|  |  | waitForNextUpstreamRequest(); |
|  |  | upstream\_request\_->encode1xxHeaders(Http::TestResponseHeaderMapImpl{{":status", "102"}}); |
|  |  | response->waitFor1xxHeaders(); |
|  |  | upstream\_request\_->encodeHeaders(default\_response\_headers\_, true); |
|  |  | ASSERT\_TRUE(response->waitForEndStream()); |
|  |  | } |
|  |  |  |
|  |  | TEST\_P(DownstreamProtocolIntegrationTest, EnvoyProxying102NoDelayBalsaReset) { |
|  |  | if (GetParam().http1\_implementation != Http1ParserImpl::BalsaParser || |
|  |  | GetParam().upstream\_protocol != Http::CodecType::HTTP1) { |
|  |  | GTEST\_SKIP() << "This test is only relevant for HTTP1 upstream with BalsaParser"; |
|  |  | } |
|  |  | config\_helper\_.addConfigModifier( |
|  |  | [&](envoy::extensions::filters::network::http\_connection\_manager::v3::HttpConnectionManager& |
|  |  | hcm) -> void { hcm.set\_proxy\_100\_continue(true); }); |
|  |  | config\_helper\_.addRuntimeOverride("envoy.reloadable\_features.http1\_balsa\_delay\_reset", "false"); |
|  |  | initialize(); |
|  |  |  |
|  |  | codec\_client\_ = makeHttpConnection(lookupPort("http")); |
|  |  | auto response = codec\_client\_->makeHeaderOnlyRequest( |
|  |  | Http::TestRequestHeaderMapImpl{{":method", "HEAD"}, |
|  |  | {":path", "/dynamo/url"}, |
|  |  | {":scheme", "http"}, |
|  |  | {":authority", "sni.lyft.com"}, |
|  |  | {"expect", "100-contINUE"}}); |
|  |  |  |
|  |  | waitForNextUpstreamRequest(); |
|  |  | upstream\_request\_->encode1xxHeaders(Http::TestResponseHeaderMapImpl{{":status", "102"}}); |
|  |  | response->waitFor1xxHeaders(); |
|  |  | upstream\_request\_->encodeHeaders(default\_response\_headers\_, true); |
|  |  | ASSERT\_TRUE(response->waitForEndStream()); |
|  |  | } |
|  |  |  |
|  |  | TEST\_P(ProtocolIntegrationTest, TwoRequests) { testTwoRequests(); } |
|  |  |  |
|  |  | TEST\_P(ProtocolIntegrationTest, TwoRequestsWithForcedBackup) { testTwoRequests(true); } |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `da56f6d`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fenvoyproxy%2Fenvoy%2Fcommit%2Fda56f6da63079baecef9183436ee5f4141a59af8) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


