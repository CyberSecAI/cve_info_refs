=== Content from git.kernel.org_aacf3895_20250114_212541.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=cdbd5a1dcdc2c27ac076f91b03b9add3fefa1a82)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=cdbd5a1dcdc2c27ac076f91b03b9add3fefa1a82)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=cdbd5a1dcdc2c27ac076f91b03b9add3fefa1a82)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=cdbd5a1dcdc2c27ac076f91b03b9add3fefa1a82)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Tiwei Bie <tiwei.btw@antgroup.com> | 2024-11-05 00:32:02 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-09 10:32:49 +0100 |
| commit | [cdbd5a1dcdc2c27ac076f91b03b9add3fefa1a82](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=cdbd5a1dcdc2c27ac076f91b03b9add3fefa1a82) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=cdbd5a1dcdc2c27ac076f91b03b9add3fefa1a82)) | |
| tree | [60f506cce7ec572f6599a5d978750e0870ffa809](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=cdbd5a1dcdc2c27ac076f91b03b9add3fefa1a82) | |
| parent | [2d194d951895df214e066d08146e77cb6e02c1d4](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=2d194d951895df214e066d08146e77cb6e02c1d4) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=cdbd5a1dcdc2c27ac076f91b03b9add3fefa1a82&id2=2d194d951895df214e066d08146e77cb6e02c1d4)) | |
| download | [linux-cdbd5a1dcdc2c27ac076f91b03b9add3fefa1a82.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-cdbd5a1dcdc2c27ac076f91b03b9add3fefa1a82.tar.gz) | |

um: net: Do not use drvdata in releasecommit d1db692a9be3b4bd3473b64fcae996afaffe8438 upstream.
The drvdata is not available in release. Let's just use container\_of()
to get the uml\_net instance. Otherwise, removing a network device will
result in a crash:
RIP: 0033:net\_device\_release+0x10/0x6f
RSP: 00000000e20c7c40 EFLAGS: 00010206
RAX: 000000006002e4e7 RBX: 00000000600f1baf RCX: 00000000624074e0
RDX: 0000000062778000 RSI: 0000000060551c80 RDI: 00000000627af028
RBP: 00000000e20c7c50 R08: 00000000603ad594 R09: 00000000e20c7b70
R10: 000000000000135a R11: 00000000603ad422 R12: 0000000000000000
R13: 0000000062c7af00 R14: 0000000062406d60 R15: 00000000627700b6
Kernel panic - not syncing: Segfault with no mm
CPU: 0 UID: 0 PID: 29 Comm: kworker/0:2 Not tainted 6.12.0-rc6-g59b723cd2adb #1
Workqueue: events mc\_work\_proc
Stack:
627af028 62c7af00 e20c7c80 60276fcd
62778000 603f5820 627af028 00000000
e20c7cb0 603a2bcd 627af000 62770010
Call Trace:
[<60276fcd>] device\_release+0x70/0xba
[<603a2bcd>] kobject\_put+0xba/0xe7
[<60277265>] put\_device+0x19/0x1c
[<60281266>] platform\_device\_put+0x26/0x29
[<60281e5f>] platform\_device\_unregister+0x2c/0x2e
[<6002ec9c>] net\_remove+0x63/0x69
[<60031316>] ? mconsole\_reply+0x0/0x50
[<600310c8>] mconsole\_remove+0x160/0x1cc
[<60087d40>] ? \_\_remove\_hrtimer+0x38/0x74
[<60087ff8>] ? hrtimer\_try\_to\_cancel+0x8c/0x98
[<6006b3cf>] ? dl\_server\_stop+0x3f/0x48
[<6006b390>] ? dl\_server\_stop+0x0/0x48
[<600672e8>] ? dequeue\_entities+0x327/0x390
[<60038fa6>] ? um\_set\_signals+0x0/0x43
[<6003070c>] mc\_work\_proc+0x77/0x91
[<60057664>] process\_scheduled\_works+0x1b3/0x2dd
[<60055f32>] ? assign\_work+0x0/0x58
[<60057f0a>] worker\_thread+0x1e9/0x293
[<6005406f>] ? set\_pf\_worker+0x0/0x64
[<6005d65d>] ? arch\_local\_irq\_save+0x0/0x2d
[<6005d748>] ? kthread\_exit+0x0/0x3a
[<60057d21>] ? worker\_thread+0x0/0x293
[<6005dbf1>] kthread+0x126/0x12b
[<600219c5>] new\_thread\_handler+0x85/0xb6
Cc: stable@vger.kernel.org
Signed-off-by: Tiwei Bie <tiwei.btw@antgroup.com>
Acked-By: Anton Ivanov <anton.ivanov@cambridgegreys.com>
Link: [https://patch.msgid.link/20241104163203.435515-4-tiwei.btw@antgroup.com](https://patch.msgid.link/20241104163203.435515-4-tiwei.btw%40antgroup.com)
Signed-off-by: Johannes Berg <johannes.berg@intel.com>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=cdbd5a1dcdc2c27ac076f91b03b9add3fefa1a82)

| -rw-r--r-- | [arch/um/drivers/net\_kern.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/arch/um/drivers/net_kern.c?id=cdbd5a1dcdc2c27ac076f91b03b9add3fefa1a82) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 1 deletions

| diff --git a/arch/um/drivers/net\_kern.c b/arch/um/drivers/net\_kern.cindex cabcc501b448a3..de187e58dc2b19 100644--- a/[arch/um/drivers/net\_kern.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/um/drivers/net_kern.c?id=2d194d951895df214e066d08146e77cb6e02c1d4)+++ b/[arch/um/drivers/net\_kern.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/um/drivers/net_kern.c?id=cdbd5a1dcdc2c27ac076f91b03b9add3fefa1a82)@@ -336,7 +336,7 @@ static struct platform\_driver uml\_net\_driver = {  static void net\_device\_release(struct device \*dev) {- struct uml\_net \*device = dev\_get\_drvdata(dev);+ struct uml\_net \*device = container\_of(dev, struct uml\_net, pdev.dev); struct net\_device \*netdev = device->dev; struct uml\_net\_private \*lp = netdev\_priv(netdev); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 21:24:18 +0000



=== Content from git.kernel.org_e77a175c_20250114_212543.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=f04cd022ee1fde219e0db1086c27a0a5ba1914db)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=f04cd022ee1fde219e0db1086c27a0a5ba1914db)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=f04cd022ee1fde219e0db1086c27a0a5ba1914db)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=f04cd022ee1fde219e0db1086c27a0a5ba1914db)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Tiwei Bie <tiwei.btw@antgroup.com> | 2024-11-05 00:32:02 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-05 14:02:53 +0100 |
| commit | [f04cd022ee1fde219e0db1086c27a0a5ba1914db](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=f04cd022ee1fde219e0db1086c27a0a5ba1914db) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=f04cd022ee1fde219e0db1086c27a0a5ba1914db)) | |
| tree | [05fb9101e325b1701ddb1788559102be14e79eb8](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=f04cd022ee1fde219e0db1086c27a0a5ba1914db) | |
| parent | [16cf8511680809a9f20b3dd224c06d482648f9e2](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=16cf8511680809a9f20b3dd224c06d482648f9e2) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=f04cd022ee1fde219e0db1086c27a0a5ba1914db&id2=16cf8511680809a9f20b3dd224c06d482648f9e2)) | |
| download | [linux-f04cd022ee1fde219e0db1086c27a0a5ba1914db.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-f04cd022ee1fde219e0db1086c27a0a5ba1914db.tar.gz) | |

um: net: Do not use drvdata in releasecommit d1db692a9be3b4bd3473b64fcae996afaffe8438 upstream.
The drvdata is not available in release. Let's just use container\_of()
to get the uml\_net instance. Otherwise, removing a network device will
result in a crash:
RIP: 0033:net\_device\_release+0x10/0x6f
RSP: 00000000e20c7c40 EFLAGS: 00010206
RAX: 000000006002e4e7 RBX: 00000000600f1baf RCX: 00000000624074e0
RDX: 0000000062778000 RSI: 0000000060551c80 RDI: 00000000627af028
RBP: 00000000e20c7c50 R08: 00000000603ad594 R09: 00000000e20c7b70
R10: 000000000000135a R11: 00000000603ad422 R12: 0000000000000000
R13: 0000000062c7af00 R14: 0000000062406d60 R15: 00000000627700b6
Kernel panic - not syncing: Segfault with no mm
CPU: 0 UID: 0 PID: 29 Comm: kworker/0:2 Not tainted 6.12.0-rc6-g59b723cd2adb #1
Workqueue: events mc\_work\_proc
Stack:
627af028 62c7af00 e20c7c80 60276fcd
62778000 603f5820 627af028 00000000
e20c7cb0 603a2bcd 627af000 62770010
Call Trace:
[<60276fcd>] device\_release+0x70/0xba
[<603a2bcd>] kobject\_put+0xba/0xe7
[<60277265>] put\_device+0x19/0x1c
[<60281266>] platform\_device\_put+0x26/0x29
[<60281e5f>] platform\_device\_unregister+0x2c/0x2e
[<6002ec9c>] net\_remove+0x63/0x69
[<60031316>] ? mconsole\_reply+0x0/0x50
[<600310c8>] mconsole\_remove+0x160/0x1cc
[<60087d40>] ? \_\_remove\_hrtimer+0x38/0x74
[<60087ff8>] ? hrtimer\_try\_to\_cancel+0x8c/0x98
[<6006b3cf>] ? dl\_server\_stop+0x3f/0x48
[<6006b390>] ? dl\_server\_stop+0x0/0x48
[<600672e8>] ? dequeue\_entities+0x327/0x390
[<60038fa6>] ? um\_set\_signals+0x0/0x43
[<6003070c>] mc\_work\_proc+0x77/0x91
[<60057664>] process\_scheduled\_works+0x1b3/0x2dd
[<60055f32>] ? assign\_work+0x0/0x58
[<60057f0a>] worker\_thread+0x1e9/0x293
[<6005406f>] ? set\_pf\_worker+0x0/0x64
[<6005d65d>] ? arch\_local\_irq\_save+0x0/0x2d
[<6005d748>] ? kthread\_exit+0x0/0x3a
[<60057d21>] ? worker\_thread+0x0/0x293
[<6005dbf1>] kthread+0x126/0x12b
[<600219c5>] new\_thread\_handler+0x85/0xb6
Cc: stable@vger.kernel.org
Signed-off-by: Tiwei Bie <tiwei.btw@antgroup.com>
Acked-By: Anton Ivanov <anton.ivanov@cambridgegreys.com>
Link: [https://patch.msgid.link/20241104163203.435515-4-tiwei.btw@antgroup.com](https://patch.msgid.link/20241104163203.435515-4-tiwei.btw%40antgroup.com)
Signed-off-by: Johannes Berg <johannes.berg@intel.com>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=f04cd022ee1fde219e0db1086c27a0a5ba1914db)

| -rw-r--r-- | [arch/um/drivers/net\_kern.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/arch/um/drivers/net_kern.c?id=f04cd022ee1fde219e0db1086c27a0a5ba1914db) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 1 deletions

| diff --git a/arch/um/drivers/net\_kern.c b/arch/um/drivers/net\_kern.cindex 77c4afb8ab9071..75d04fb4994a06 100644--- a/[arch/um/drivers/net\_kern.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/um/drivers/net_kern.c?id=16cf8511680809a9f20b3dd224c06d482648f9e2)+++ b/[arch/um/drivers/net\_kern.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/um/drivers/net_kern.c?id=f04cd022ee1fde219e0db1086c27a0a5ba1914db)@@ -336,7 +336,7 @@ static struct platform\_driver uml\_net\_driver = {  static void net\_device\_release(struct device \*dev) {- struct uml\_net \*device = dev\_get\_drvdata(dev);+ struct uml\_net \*device = container\_of(dev, struct uml\_net, pdev.dev); struct net\_device \*netdev = device->dev; struct uml\_net\_private \*lp = netdev\_priv(netdev); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 21:24:20 +0000



=== Content from git.kernel.org_aaca8416_20250114_212540.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=8d9d174d3f55daaf5e7b48e9d7f53c723adbed86)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=8d9d174d3f55daaf5e7b48e9d7f53c723adbed86)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=8d9d174d3f55daaf5e7b48e9d7f53c723adbed86)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=8d9d174d3f55daaf5e7b48e9d7f53c723adbed86)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Tiwei Bie <tiwei.btw@antgroup.com> | 2024-11-05 00:32:02 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-14 19:44:37 +0100 |
| commit | [8d9d174d3f55daaf5e7b48e9d7f53c723adbed86](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=8d9d174d3f55daaf5e7b48e9d7f53c723adbed86) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=8d9d174d3f55daaf5e7b48e9d7f53c723adbed86)) | |
| tree | [79f60e3b74b800b8dabed4b2f54908ae4d3a07da](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=8d9d174d3f55daaf5e7b48e9d7f53c723adbed86) | |
| parent | [300e277e463e6326938dd55ea560eafa0f5c88a5](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=300e277e463e6326938dd55ea560eafa0f5c88a5) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=8d9d174d3f55daaf5e7b48e9d7f53c723adbed86&id2=300e277e463e6326938dd55ea560eafa0f5c88a5)) | |
| download | [linux-8d9d174d3f55daaf5e7b48e9d7f53c723adbed86.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-8d9d174d3f55daaf5e7b48e9d7f53c723adbed86.tar.gz) | |

um: net: Do not use drvdata in releasecommit d1db692a9be3b4bd3473b64fcae996afaffe8438 upstream.
The drvdata is not available in release. Let's just use container\_of()
to get the uml\_net instance. Otherwise, removing a network device will
result in a crash:
RIP: 0033:net\_device\_release+0x10/0x6f
RSP: 00000000e20c7c40 EFLAGS: 00010206
RAX: 000000006002e4e7 RBX: 00000000600f1baf RCX: 00000000624074e0
RDX: 0000000062778000 RSI: 0000000060551c80 RDI: 00000000627af028
RBP: 00000000e20c7c50 R08: 00000000603ad594 R09: 00000000e20c7b70
R10: 000000000000135a R11: 00000000603ad422 R12: 0000000000000000
R13: 0000000062c7af00 R14: 0000000062406d60 R15: 00000000627700b6
Kernel panic - not syncing: Segfault with no mm
CPU: 0 UID: 0 PID: 29 Comm: kworker/0:2 Not tainted 6.12.0-rc6-g59b723cd2adb #1
Workqueue: events mc\_work\_proc
Stack:
627af028 62c7af00 e20c7c80 60276fcd
62778000 603f5820 627af028 00000000
e20c7cb0 603a2bcd 627af000 62770010
Call Trace:
[<60276fcd>] device\_release+0x70/0xba
[<603a2bcd>] kobject\_put+0xba/0xe7
[<60277265>] put\_device+0x19/0x1c
[<60281266>] platform\_device\_put+0x26/0x29
[<60281e5f>] platform\_device\_unregister+0x2c/0x2e
[<6002ec9c>] net\_remove+0x63/0x69
[<60031316>] ? mconsole\_reply+0x0/0x50
[<600310c8>] mconsole\_remove+0x160/0x1cc
[<60087d40>] ? \_\_remove\_hrtimer+0x38/0x74
[<60087ff8>] ? hrtimer\_try\_to\_cancel+0x8c/0x98
[<6006b3cf>] ? dl\_server\_stop+0x3f/0x48
[<6006b390>] ? dl\_server\_stop+0x0/0x48
[<600672e8>] ? dequeue\_entities+0x327/0x390
[<60038fa6>] ? um\_set\_signals+0x0/0x43
[<6003070c>] mc\_work\_proc+0x77/0x91
[<60057664>] process\_scheduled\_works+0x1b3/0x2dd
[<60055f32>] ? assign\_work+0x0/0x58
[<60057f0a>] worker\_thread+0x1e9/0x293
[<6005406f>] ? set\_pf\_worker+0x0/0x64
[<6005d65d>] ? arch\_local\_irq\_save+0x0/0x2d
[<6005d748>] ? kthread\_exit+0x0/0x3a
[<60057d21>] ? worker\_thread+0x0/0x293
[<6005dbf1>] kthread+0x126/0x12b
[<600219c5>] new\_thread\_handler+0x85/0xb6
Cc: stable@vger.kernel.org
Signed-off-by: Tiwei Bie <tiwei.btw@antgroup.com>
Acked-By: Anton Ivanov <anton.ivanov@cambridgegreys.com>
Link: [https://patch.msgid.link/20241104163203.435515-4-tiwei.btw@antgroup.com](https://patch.msgid.link/20241104163203.435515-4-tiwei.btw%40antgroup.com)
Signed-off-by: Johannes Berg <johannes.berg@intel.com>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=8d9d174d3f55daaf5e7b48e9d7f53c723adbed86)

| -rw-r--r-- | [arch/um/drivers/net\_kern.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/arch/um/drivers/net_kern.c?id=8d9d174d3f55daaf5e7b48e9d7f53c723adbed86) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 1 deletions

| diff --git a/arch/um/drivers/net\_kern.c b/arch/um/drivers/net\_kern.cindex db15a456482fc6..edc8fedca8b948 100644--- a/[arch/um/drivers/net\_kern.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/um/drivers/net_kern.c?id=300e277e463e6326938dd55ea560eafa0f5c88a5)+++ b/[arch/um/drivers/net\_kern.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/um/drivers/net_kern.c?id=8d9d174d3f55daaf5e7b48e9d7f53c723adbed86)@@ -347,7 +347,7 @@ static struct platform\_driver uml\_net\_driver = {  static void net\_device\_release(struct device \*dev) {- struct uml\_net \*device = dev\_get\_drvdata(dev);+ struct uml\_net \*device = container\_of(dev, struct uml\_net, pdev.dev); struct net\_device \*netdev = device->dev; struct uml\_net\_private \*lp = netdev\_priv(netdev); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 21:24:17 +0000



=== Content from git.kernel.org_9f1d4c95_20250114_212539.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=468c2e5394afc848efb1eae6e1961a3c855cf35e)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=468c2e5394afc848efb1eae6e1961a3c855cf35e)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=468c2e5394afc848efb1eae6e1961a3c855cf35e)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=468c2e5394afc848efb1eae6e1961a3c855cf35e)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Tiwei Bie <tiwei.btw@antgroup.com> | 2024-11-05 00:32:02 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-05 13:54:19 +0100 |
| commit | [468c2e5394afc848efb1eae6e1961a3c855cf35e](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=468c2e5394afc848efb1eae6e1961a3c855cf35e) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=468c2e5394afc848efb1eae6e1961a3c855cf35e)) | |
| tree | [bf64f4b84bb3d7a0f5504ab09bd1803c72c323ce](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=468c2e5394afc848efb1eae6e1961a3c855cf35e) | |
| parent | [e6e5a4cded9bef3a1b0a4fac815b7176eb9a18ec](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=e6e5a4cded9bef3a1b0a4fac815b7176eb9a18ec) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=468c2e5394afc848efb1eae6e1961a3c855cf35e&id2=e6e5a4cded9bef3a1b0a4fac815b7176eb9a18ec)) | |
| download | [linux-468c2e5394afc848efb1eae6e1961a3c855cf35e.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-468c2e5394afc848efb1eae6e1961a3c855cf35e.tar.gz) | |

um: net: Do not use drvdata in releasecommit d1db692a9be3b4bd3473b64fcae996afaffe8438 upstream.
The drvdata is not available in release. Let's just use container\_of()
to get the uml\_net instance. Otherwise, removing a network device will
result in a crash:
RIP: 0033:net\_device\_release+0x10/0x6f
RSP: 00000000e20c7c40 EFLAGS: 00010206
RAX: 000000006002e4e7 RBX: 00000000600f1baf RCX: 00000000624074e0
RDX: 0000000062778000 RSI: 0000000060551c80 RDI: 00000000627af028
RBP: 00000000e20c7c50 R08: 00000000603ad594 R09: 00000000e20c7b70
R10: 000000000000135a R11: 00000000603ad422 R12: 0000000000000000
R13: 0000000062c7af00 R14: 0000000062406d60 R15: 00000000627700b6
Kernel panic - not syncing: Segfault with no mm
CPU: 0 UID: 0 PID: 29 Comm: kworker/0:2 Not tainted 6.12.0-rc6-g59b723cd2adb #1
Workqueue: events mc\_work\_proc
Stack:
627af028 62c7af00 e20c7c80 60276fcd
62778000 603f5820 627af028 00000000
e20c7cb0 603a2bcd 627af000 62770010
Call Trace:
[<60276fcd>] device\_release+0x70/0xba
[<603a2bcd>] kobject\_put+0xba/0xe7
[<60277265>] put\_device+0x19/0x1c
[<60281266>] platform\_device\_put+0x26/0x29
[<60281e5f>] platform\_device\_unregister+0x2c/0x2e
[<6002ec9c>] net\_remove+0x63/0x69
[<60031316>] ? mconsole\_reply+0x0/0x50
[<600310c8>] mconsole\_remove+0x160/0x1cc
[<60087d40>] ? \_\_remove\_hrtimer+0x38/0x74
[<60087ff8>] ? hrtimer\_try\_to\_cancel+0x8c/0x98
[<6006b3cf>] ? dl\_server\_stop+0x3f/0x48
[<6006b390>] ? dl\_server\_stop+0x0/0x48
[<600672e8>] ? dequeue\_entities+0x327/0x390
[<60038fa6>] ? um\_set\_signals+0x0/0x43
[<6003070c>] mc\_work\_proc+0x77/0x91
[<60057664>] process\_scheduled\_works+0x1b3/0x2dd
[<60055f32>] ? assign\_work+0x0/0x58
[<60057f0a>] worker\_thread+0x1e9/0x293
[<6005406f>] ? set\_pf\_worker+0x0/0x64
[<6005d65d>] ? arch\_local\_irq\_save+0x0/0x2d
[<6005d748>] ? kthread\_exit+0x0/0x3a
[<60057d21>] ? worker\_thread+0x0/0x293
[<6005dbf1>] kthread+0x126/0x12b
[<600219c5>] new\_thread\_handler+0x85/0xb6
Cc: stable@vger.kernel.org
Signed-off-by: Tiwei Bie <tiwei.btw@antgroup.com>
Acked-By: Anton Ivanov <anton.ivanov@cambridgegreys.com>
Link: [https://patch.msgid.link/20241104163203.435515-4-tiwei.btw@antgroup.com](https://patch.msgid.link/20241104163203.435515-4-tiwei.btw%40antgroup.com)
Signed-off-by: Johannes Berg <johannes.berg@intel.com>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=468c2e5394afc848efb1eae6e1961a3c855cf35e)

| -rw-r--r-- | [arch/um/drivers/net\_kern.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/arch/um/drivers/net_kern.c?id=468c2e5394afc848efb1eae6e1961a3c855cf35e) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 1 deletions

| diff --git a/arch/um/drivers/net\_kern.c b/arch/um/drivers/net\_kern.cindex 77c4afb8ab9071..75d04fb4994a06 100644--- a/[arch/um/drivers/net\_kern.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/um/drivers/net_kern.c?id=e6e5a4cded9bef3a1b0a4fac815b7176eb9a18ec)+++ b/[arch/um/drivers/net\_kern.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/um/drivers/net_kern.c?id=468c2e5394afc848efb1eae6e1961a3c855cf35e)@@ -336,7 +336,7 @@ static struct platform\_driver uml\_net\_driver = {  static void net\_device\_release(struct device \*dev) {- struct uml\_net \*device = dev\_get\_drvdata(dev);+ struct uml\_net \*device = container\_of(dev, struct uml\_net, pdev.dev); struct net\_device \*netdev = device->dev; struct uml\_net\_private \*lp = netdev\_priv(netdev); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 21:24:16 +0000



=== Content from git.kernel.org_ea469673_20250114_212539.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=6be99d4c117b9642a44d9f54f034b67615be2b2b)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=6be99d4c117b9642a44d9f54f034b67615be2b2b)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=6be99d4c117b9642a44d9f54f034b67615be2b2b)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=6be99d4c117b9642a44d9f54f034b67615be2b2b)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Tiwei Bie <tiwei.btw@antgroup.com> | 2024-11-05 00:32:02 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-14 19:48:10 +0100 |
| commit | [6be99d4c117b9642a44d9f54f034b67615be2b2b](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=6be99d4c117b9642a44d9f54f034b67615be2b2b) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=6be99d4c117b9642a44d9f54f034b67615be2b2b)) | |
| tree | [fa35e357a274e7b230984793cf4d8aa6f66569a5](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=6be99d4c117b9642a44d9f54f034b67615be2b2b) | |
| parent | [509ba8746f812e45a05034ba18b73db574693d11](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=509ba8746f812e45a05034ba18b73db574693d11) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=6be99d4c117b9642a44d9f54f034b67615be2b2b&id2=509ba8746f812e45a05034ba18b73db574693d11)) | |
| download | [linux-6be99d4c117b9642a44d9f54f034b67615be2b2b.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-6be99d4c117b9642a44d9f54f034b67615be2b2b.tar.gz) | |

um: net: Do not use drvdata in releasecommit d1db692a9be3b4bd3473b64fcae996afaffe8438 upstream.
The drvdata is not available in release. Let's just use container\_of()
to get the uml\_net instance. Otherwise, removing a network device will
result in a crash:
RIP: 0033:net\_device\_release+0x10/0x6f
RSP: 00000000e20c7c40 EFLAGS: 00010206
RAX: 000000006002e4e7 RBX: 00000000600f1baf RCX: 00000000624074e0
RDX: 0000000062778000 RSI: 0000000060551c80 RDI: 00000000627af028
RBP: 00000000e20c7c50 R08: 00000000603ad594 R09: 00000000e20c7b70
R10: 000000000000135a R11: 00000000603ad422 R12: 0000000000000000
R13: 0000000062c7af00 R14: 0000000062406d60 R15: 00000000627700b6
Kernel panic - not syncing: Segfault with no mm
CPU: 0 UID: 0 PID: 29 Comm: kworker/0:2 Not tainted 6.12.0-rc6-g59b723cd2adb #1
Workqueue: events mc\_work\_proc
Stack:
627af028 62c7af00 e20c7c80 60276fcd
62778000 603f5820 627af028 00000000
e20c7cb0 603a2bcd 627af000 62770010
Call Trace:
[<60276fcd>] device\_release+0x70/0xba
[<603a2bcd>] kobject\_put+0xba/0xe7
[<60277265>] put\_device+0x19/0x1c
[<60281266>] platform\_device\_put+0x26/0x29
[<60281e5f>] platform\_device\_unregister+0x2c/0x2e
[<6002ec9c>] net\_remove+0x63/0x69
[<60031316>] ? mconsole\_reply+0x0/0x50
[<600310c8>] mconsole\_remove+0x160/0x1cc
[<60087d40>] ? \_\_remove\_hrtimer+0x38/0x74
[<60087ff8>] ? hrtimer\_try\_to\_cancel+0x8c/0x98
[<6006b3cf>] ? dl\_server\_stop+0x3f/0x48
[<6006b390>] ? dl\_server\_stop+0x0/0x48
[<600672e8>] ? dequeue\_entities+0x327/0x390
[<60038fa6>] ? um\_set\_signals+0x0/0x43
[<6003070c>] mc\_work\_proc+0x77/0x91
[<60057664>] process\_scheduled\_works+0x1b3/0x2dd
[<60055f32>] ? assign\_work+0x0/0x58
[<60057f0a>] worker\_thread+0x1e9/0x293
[<6005406f>] ? set\_pf\_worker+0x0/0x64
[<6005d65d>] ? arch\_local\_irq\_save+0x0/0x2d
[<6005d748>] ? kthread\_exit+0x0/0x3a
[<60057d21>] ? worker\_thread+0x0/0x293
[<6005dbf1>] kthread+0x126/0x12b
[<600219c5>] new\_thread\_handler+0x85/0xb6
Cc: stable@vger.kernel.org
Signed-off-by: Tiwei Bie <tiwei.btw@antgroup.com>
Acked-By: Anton Ivanov <anton.ivanov@cambridgegreys.com>
Link: [https://patch.msgid.link/20241104163203.435515-4-tiwei.btw@antgroup.com](https://patch.msgid.link/20241104163203.435515-4-tiwei.btw%40antgroup.com)
Signed-off-by: Johannes Berg <johannes.berg@intel.com>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=6be99d4c117b9642a44d9f54f034b67615be2b2b)

| -rw-r--r-- | [arch/um/drivers/net\_kern.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/arch/um/drivers/net_kern.c?id=6be99d4c117b9642a44d9f54f034b67615be2b2b) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 1 deletions

| diff --git a/arch/um/drivers/net\_kern.c b/arch/um/drivers/net\_kern.cindex ee55333255d022..1e4046cf6f4cfb 100644--- a/[arch/um/drivers/net\_kern.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/um/drivers/net_kern.c?id=509ba8746f812e45a05034ba18b73db574693d11)+++ b/[arch/um/drivers/net\_kern.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/um/drivers/net_kern.c?id=6be99d4c117b9642a44d9f54f034b67615be2b2b)@@ -335,7 +335,7 @@ static struct platform\_driver uml\_net\_driver = {  static void net\_device\_release(struct device \*dev) {- struct uml\_net \*device = dev\_get\_drvdata(dev);+ struct uml\_net \*device = container\_of(dev, struct uml\_net, pdev.dev); struct net\_device \*netdev = device->dev; struct uml\_net\_private \*lp = netdev\_priv(netdev); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 21:24:16 +0000



=== Content from git.kernel.org_f5c4e7f5_20250114_212541.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=b174ab33aaafd556a1ead72fa8e35d70b6fb1e39)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=b174ab33aaafd556a1ead72fa8e35d70b6fb1e39)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=b174ab33aaafd556a1ead72fa8e35d70b6fb1e39)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b174ab33aaafd556a1ead72fa8e35d70b6fb1e39)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Tiwei Bie <tiwei.btw@antgroup.com> | 2024-11-05 00:32:02 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-05 10:59:40 +0100 |
| commit | [b174ab33aaafd556a1ead72fa8e35d70b6fb1e39](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=b174ab33aaafd556a1ead72fa8e35d70b6fb1e39) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=b174ab33aaafd556a1ead72fa8e35d70b6fb1e39)) | |
| tree | [6f40ae5646392871119d2cb979823aaeb9863a15](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=b174ab33aaafd556a1ead72fa8e35d70b6fb1e39) | |
| parent | [23d742a3fcd4781eed015a3a93e6a0e3ab1ef2a8](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=23d742a3fcd4781eed015a3a93e6a0e3ab1ef2a8) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b174ab33aaafd556a1ead72fa8e35d70b6fb1e39&id2=23d742a3fcd4781eed015a3a93e6a0e3ab1ef2a8)) | |
| download | [linux-b174ab33aaafd556a1ead72fa8e35d70b6fb1e39.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-b174ab33aaafd556a1ead72fa8e35d70b6fb1e39.tar.gz) | |

um: net: Do not use drvdata in releasecommit d1db692a9be3b4bd3473b64fcae996afaffe8438 upstream.
The drvdata is not available in release. Let's just use container\_of()
to get the uml\_net instance. Otherwise, removing a network device will
result in a crash:
RIP: 0033:net\_device\_release+0x10/0x6f
RSP: 00000000e20c7c40 EFLAGS: 00010206
RAX: 000000006002e4e7 RBX: 00000000600f1baf RCX: 00000000624074e0
RDX: 0000000062778000 RSI: 0000000060551c80 RDI: 00000000627af028
RBP: 00000000e20c7c50 R08: 00000000603ad594 R09: 00000000e20c7b70
R10: 000000000000135a R11: 00000000603ad422 R12: 0000000000000000
R13: 0000000062c7af00 R14: 0000000062406d60 R15: 00000000627700b6
Kernel panic - not syncing: Segfault with no mm
CPU: 0 UID: 0 PID: 29 Comm: kworker/0:2 Not tainted 6.12.0-rc6-g59b723cd2adb #1
Workqueue: events mc\_work\_proc
Stack:
627af028 62c7af00 e20c7c80 60276fcd
62778000 603f5820 627af028 00000000
e20c7cb0 603a2bcd 627af000 62770010
Call Trace:
[<60276fcd>] device\_release+0x70/0xba
[<603a2bcd>] kobject\_put+0xba/0xe7
[<60277265>] put\_device+0x19/0x1c
[<60281266>] platform\_device\_put+0x26/0x29
[<60281e5f>] platform\_device\_unregister+0x2c/0x2e
[<6002ec9c>] net\_remove+0x63/0x69
[<60031316>] ? mconsole\_reply+0x0/0x50
[<600310c8>] mconsole\_remove+0x160/0x1cc
[<60087d40>] ? \_\_remove\_hrtimer+0x38/0x74
[<60087ff8>] ? hrtimer\_try\_to\_cancel+0x8c/0x98
[<6006b3cf>] ? dl\_server\_stop+0x3f/0x48
[<6006b390>] ? dl\_server\_stop+0x0/0x48
[<600672e8>] ? dequeue\_entities+0x327/0x390
[<60038fa6>] ? um\_set\_signals+0x0/0x43
[<6003070c>] mc\_work\_proc+0x77/0x91
[<60057664>] process\_scheduled\_works+0x1b3/0x2dd
[<60055f32>] ? assign\_work+0x0/0x58
[<60057f0a>] worker\_thread+0x1e9/0x293
[<6005406f>] ? set\_pf\_worker+0x0/0x64
[<6005d65d>] ? arch\_local\_irq\_save+0x0/0x2d
[<6005d748>] ? kthread\_exit+0x0/0x3a
[<60057d21>] ? worker\_thread+0x0/0x293
[<6005dbf1>] kthread+0x126/0x12b
[<600219c5>] new\_thread\_handler+0x85/0xb6
Cc: stable@vger.kernel.org
Signed-off-by: Tiwei Bie <tiwei.btw@antgroup.com>
Acked-By: Anton Ivanov <anton.ivanov@cambridgegreys.com>
Link: [https://patch.msgid.link/20241104163203.435515-4-tiwei.btw@antgroup.com](https://patch.msgid.link/20241104163203.435515-4-tiwei.btw%40antgroup.com)
Signed-off-by: Johannes Berg <johannes.berg@intel.com>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b174ab33aaafd556a1ead72fa8e35d70b6fb1e39)

| -rw-r--r-- | [arch/um/drivers/net\_kern.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/arch/um/drivers/net_kern.c?id=b174ab33aaafd556a1ead72fa8e35d70b6fb1e39) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 1 deletions

| diff --git a/arch/um/drivers/net\_kern.c b/arch/um/drivers/net\_kern.cindex 0216e3254c90f4..85291e50d047b1 100644--- a/[arch/um/drivers/net\_kern.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/um/drivers/net_kern.c?id=23d742a3fcd4781eed015a3a93e6a0e3ab1ef2a8)+++ b/[arch/um/drivers/net\_kern.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/um/drivers/net_kern.c?id=b174ab33aaafd556a1ead72fa8e35d70b6fb1e39)@@ -349,7 +349,7 @@ static struct platform\_driver uml\_net\_driver = {  static void net\_device\_release(struct device \*dev) {- struct uml\_net \*device = dev\_get\_drvdata(dev);+ struct uml\_net \*device = container\_of(dev, struct uml\_net, pdev.dev); struct net\_device \*netdev = device->dev; struct uml\_net\_private \*lp = netdev\_priv(netdev); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 21:24:18 +0000



=== Content from git.kernel.org_3f3c6a72_20250114_212537.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=160cd5f956d191eb97664afd31ca59284c08d876)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=160cd5f956d191eb97664afd31ca59284c08d876)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=160cd5f956d191eb97664afd31ca59284c08d876)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=160cd5f956d191eb97664afd31ca59284c08d876)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Tiwei Bie <tiwei.btw@antgroup.com> | 2024-11-05 00:32:02 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-14 19:54:02 +0100 |
| commit | [160cd5f956d191eb97664afd31ca59284c08d876](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=160cd5f956d191eb97664afd31ca59284c08d876) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=160cd5f956d191eb97664afd31ca59284c08d876)) | |
| tree | [c0796b08e051e812349fc5385785d4b8b019889d](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=160cd5f956d191eb97664afd31ca59284c08d876) | |
| parent | [a5a75207efae4b558aaa34c288de7d6f2e926b4b](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=a5a75207efae4b558aaa34c288de7d6f2e926b4b) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=160cd5f956d191eb97664afd31ca59284c08d876&id2=a5a75207efae4b558aaa34c288de7d6f2e926b4b)) | |
| download | [linux-160cd5f956d191eb97664afd31ca59284c08d876.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-160cd5f956d191eb97664afd31ca59284c08d876.tar.gz) | |

um: net: Do not use drvdata in releasecommit d1db692a9be3b4bd3473b64fcae996afaffe8438 upstream.
The drvdata is not available in release. Let's just use container\_of()
to get the uml\_net instance. Otherwise, removing a network device will
result in a crash:
RIP: 0033:net\_device\_release+0x10/0x6f
RSP: 00000000e20c7c40 EFLAGS: 00010206
RAX: 000000006002e4e7 RBX: 00000000600f1baf RCX: 00000000624074e0
RDX: 0000000062778000 RSI: 0000000060551c80 RDI: 00000000627af028
RBP: 00000000e20c7c50 R08: 00000000603ad594 R09: 00000000e20c7b70
R10: 000000000000135a R11: 00000000603ad422 R12: 0000000000000000
R13: 0000000062c7af00 R14: 0000000062406d60 R15: 00000000627700b6
Kernel panic - not syncing: Segfault with no mm
CPU: 0 UID: 0 PID: 29 Comm: kworker/0:2 Not tainted 6.12.0-rc6-g59b723cd2adb #1
Workqueue: events mc\_work\_proc
Stack:
627af028 62c7af00 e20c7c80 60276fcd
62778000 603f5820 627af028 00000000
e20c7cb0 603a2bcd 627af000 62770010
Call Trace:
[<60276fcd>] device\_release+0x70/0xba
[<603a2bcd>] kobject\_put+0xba/0xe7
[<60277265>] put\_device+0x19/0x1c
[<60281266>] platform\_device\_put+0x26/0x29
[<60281e5f>] platform\_device\_unregister+0x2c/0x2e
[<6002ec9c>] net\_remove+0x63/0x69
[<60031316>] ? mconsole\_reply+0x0/0x50
[<600310c8>] mconsole\_remove+0x160/0x1cc
[<60087d40>] ? \_\_remove\_hrtimer+0x38/0x74
[<60087ff8>] ? hrtimer\_try\_to\_cancel+0x8c/0x98
[<6006b3cf>] ? dl\_server\_stop+0x3f/0x48
[<6006b390>] ? dl\_server\_stop+0x0/0x48
[<600672e8>] ? dequeue\_entities+0x327/0x390
[<60038fa6>] ? um\_set\_signals+0x0/0x43
[<6003070c>] mc\_work\_proc+0x77/0x91
[<60057664>] process\_scheduled\_works+0x1b3/0x2dd
[<60055f32>] ? assign\_work+0x0/0x58
[<60057f0a>] worker\_thread+0x1e9/0x293
[<6005406f>] ? set\_pf\_worker+0x0/0x64
[<6005d65d>] ? arch\_local\_irq\_save+0x0/0x2d
[<6005d748>] ? kthread\_exit+0x0/0x3a
[<60057d21>] ? worker\_thread+0x0/0x293
[<6005dbf1>] kthread+0x126/0x12b
[<600219c5>] new\_thread\_handler+0x85/0xb6
Cc: stable@vger.kernel.org
Signed-off-by: Tiwei Bie <tiwei.btw@antgroup.com>
Acked-By: Anton Ivanov <anton.ivanov@cambridgegreys.com>
Link: [https://patch.msgid.link/20241104163203.435515-4-tiwei.btw@antgroup.com](https://patch.msgid.link/20241104163203.435515-4-tiwei.btw%40antgroup.com)
Signed-off-by: Johannes Berg <johannes.berg@intel.com>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=160cd5f956d191eb97664afd31ca59284c08d876)

| -rw-r--r-- | [arch/um/drivers/net\_kern.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/arch/um/drivers/net_kern.c?id=160cd5f956d191eb97664afd31ca59284c08d876) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 1 deletions

| diff --git a/arch/um/drivers/net\_kern.c b/arch/um/drivers/net\_kern.cindex cabcc501b448a3..de187e58dc2b19 100644--- a/[arch/um/drivers/net\_kern.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/um/drivers/net_kern.c?id=a5a75207efae4b558aaa34c288de7d6f2e926b4b)+++ b/[arch/um/drivers/net\_kern.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/um/drivers/net_kern.c?id=160cd5f956d191eb97664afd31ca59284c08d876)@@ -336,7 +336,7 @@ static struct platform\_driver uml\_net\_driver = {  static void net\_device\_release(struct device \*dev) {- struct uml\_net \*device = dev\_get\_drvdata(dev);+ struct uml\_net \*device = container\_of(dev, struct uml\_net, pdev.dev); struct net\_device \*netdev = device->dev; struct uml\_net\_private \*lp = netdev\_priv(netdev); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 21:24:14 +0000



=== Content from git.kernel.org_1fbc7ee9_20250114_212542.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=d1db692a9be3b4bd3473b64fcae996afaffe8438)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=d1db692a9be3b4bd3473b64fcae996afaffe8438)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=d1db692a9be3b4bd3473b64fcae996afaffe8438)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=d1db692a9be3b4bd3473b64fcae996afaffe8438)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Tiwei Bie <tiwei.btw@antgroup.com> | 2024-11-05 00:32:02 +0800 |
| --- | --- | --- |
| committer | Johannes Berg <johannes.berg@intel.com> | 2024-11-07 18:05:22 +0100 |
| commit | [d1db692a9be3b4bd3473b64fcae996afaffe8438](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=d1db692a9be3b4bd3473b64fcae996afaffe8438) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=d1db692a9be3b4bd3473b64fcae996afaffe8438)) | |
| tree | [3484064291e53c7feb71a376560eec50d6350b79](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=d1db692a9be3b4bd3473b64fcae996afaffe8438) | |
| parent | [5bee35e5389f450a7eea7318deb9073e9414d3b1](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=5bee35e5389f450a7eea7318deb9073e9414d3b1) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=d1db692a9be3b4bd3473b64fcae996afaffe8438&id2=5bee35e5389f450a7eea7318deb9073e9414d3b1)) | |
| download | [linux-d1db692a9be3b4bd3473b64fcae996afaffe8438.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-d1db692a9be3b4bd3473b64fcae996afaffe8438.tar.gz) | |

um: net: Do not use drvdata in releaseThe drvdata is not available in release. Let's just use container\_of()
to get the uml\_net instance. Otherwise, removing a network device will
result in a crash:
RIP: 0033:net\_device\_release+0x10/0x6f
RSP: 00000000e20c7c40 EFLAGS: 00010206
RAX: 000000006002e4e7 RBX: 00000000600f1baf RCX: 00000000624074e0
RDX: 0000000062778000 RSI: 0000000060551c80 RDI: 00000000627af028
RBP: 00000000e20c7c50 R08: 00000000603ad594 R09: 00000000e20c7b70
R10: 000000000000135a R11: 00000000603ad422 R12: 0000000000000000
R13: 0000000062c7af00 R14: 0000000062406d60 R15: 00000000627700b6
Kernel panic - not syncing: Segfault with no mm
CPU: 0 UID: 0 PID: 29 Comm: kworker/0:2 Not tainted 6.12.0-rc6-g59b723cd2adb #1
Workqueue: events mc\_work\_proc
Stack:
627af028 62c7af00 e20c7c80 60276fcd
62778000 603f5820 627af028 00000000
e20c7cb0 603a2bcd 627af000 62770010
Call Trace:
[<60276fcd>] device\_release+0x70/0xba
[<603a2bcd>] kobject\_put+0xba/0xe7
[<60277265>] put\_device+0x19/0x1c
[<60281266>] platform\_device\_put+0x26/0x29
[<60281e5f>] platform\_device\_unregister+0x2c/0x2e
[<6002ec9c>] net\_remove+0x63/0x69
[<60031316>] ? mconsole\_reply+0x0/0x50
[<600310c8>] mconsole\_remove+0x160/0x1cc
[<60087d40>] ? \_\_remove\_hrtimer+0x38/0x74
[<60087ff8>] ? hrtimer\_try\_to\_cancel+0x8c/0x98
[<6006b3cf>] ? dl\_server\_stop+0x3f/0x48
[<6006b390>] ? dl\_server\_stop+0x0/0x48
[<600672e8>] ? dequeue\_entities+0x327/0x390
[<60038fa6>] ? um\_set\_signals+0x0/0x43
[<6003070c>] mc\_work\_proc+0x77/0x91
[<60057664>] process\_scheduled\_works+0x1b3/0x2dd
[<60055f32>] ? assign\_work+0x0/0x58
[<60057f0a>] worker\_thread+0x1e9/0x293
[<6005406f>] ? set\_pf\_worker+0x0/0x64
[<6005d65d>] ? arch\_local\_irq\_save+0x0/0x2d
[<6005d748>] ? kthread\_exit+0x0/0x3a
[<60057d21>] ? worker\_thread+0x0/0x293
[<6005dbf1>] kthread+0x126/0x12b
[<600219c5>] new\_thread\_handler+0x85/0xb6
Cc: stable@vger.kernel.org
Signed-off-by: Tiwei Bie <tiwei.btw@antgroup.com>
Acked-By: Anton Ivanov <anton.ivanov@cambridgegreys.com>
Link: [https://patch.msgid.link/20241104163203.435515-4-tiwei.btw@antgroup.com](https://patch.msgid.link/20241104163203.435515-4-tiwei.btw%40antgroup.com)
Signed-off-by: Johannes Berg <johannes.berg@intel.com>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=d1db692a9be3b4bd3473b64fcae996afaffe8438)

| -rw-r--r-- | [arch/um/drivers/net\_kern.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/arch/um/drivers/net_kern.c?id=d1db692a9be3b4bd3473b64fcae996afaffe8438) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 1 deletions

| diff --git a/arch/um/drivers/net\_kern.c b/arch/um/drivers/net\_kern.cindex 77c4afb8ab9071..75d04fb4994a06 100644--- a/[arch/um/drivers/net\_kern.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/um/drivers/net_kern.c?id=5bee35e5389f450a7eea7318deb9073e9414d3b1)+++ b/[arch/um/drivers/net\_kern.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/um/drivers/net_kern.c?id=d1db692a9be3b4bd3473b64fcae996afaffe8438)@@ -336,7 +336,7 @@ static struct platform\_driver uml\_net\_driver = {  static void net\_device\_release(struct device \*dev) {- struct uml\_net \*device = dev\_get\_drvdata(dev);+ struct uml\_net \*device = container\_of(dev, struct uml\_net, pdev.dev); struct net\_device \*netdev = device->dev; struct uml\_net\_private \*lp = netdev\_priv(netdev); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 21:24:19 +0000



=== Content from git.kernel.org_06ccf3cd_20250114_212538.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=1635d9a0ff1b8bd7aa4767d4ea7b3de72cd36f28)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=1635d9a0ff1b8bd7aa4767d4ea7b3de72cd36f28)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=1635d9a0ff1b8bd7aa4767d4ea7b3de72cd36f28)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=1635d9a0ff1b8bd7aa4767d4ea7b3de72cd36f28)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Tiwei Bie <tiwei.btw@antgroup.com> | 2024-11-05 00:32:02 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-14 19:51:16 +0100 |
| commit | [1635d9a0ff1b8bd7aa4767d4ea7b3de72cd36f28](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=1635d9a0ff1b8bd7aa4767d4ea7b3de72cd36f28) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=1635d9a0ff1b8bd7aa4767d4ea7b3de72cd36f28)) | |
| tree | [80f4fa7e25dacf1e5c96cc6a461494e49173e334](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=1635d9a0ff1b8bd7aa4767d4ea7b3de72cd36f28) | |
| parent | [5727343348f34e11a7c5a2a944d5aa505731d876](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=5727343348f34e11a7c5a2a944d5aa505731d876) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=1635d9a0ff1b8bd7aa4767d4ea7b3de72cd36f28&id2=5727343348f34e11a7c5a2a944d5aa505731d876)) | |
| download | [linux-1635d9a0ff1b8bd7aa4767d4ea7b3de72cd36f28.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-1635d9a0ff1b8bd7aa4767d4ea7b3de72cd36f28.tar.gz) | |

um: net: Do not use drvdata in releasecommit d1db692a9be3b4bd3473b64fcae996afaffe8438 upstream.
The drvdata is not available in release. Let's just use container\_of()
to get the uml\_net instance. Otherwise, removing a network device will
result in a crash:
RIP: 0033:net\_device\_release+0x10/0x6f
RSP: 00000000e20c7c40 EFLAGS: 00010206
RAX: 000000006002e4e7 RBX: 00000000600f1baf RCX: 00000000624074e0
RDX: 0000000062778000 RSI: 0000000060551c80 RDI: 00000000627af028
RBP: 00000000e20c7c50 R08: 00000000603ad594 R09: 00000000e20c7b70
R10: 000000000000135a R11: 00000000603ad422 R12: 0000000000000000
R13: 0000000062c7af00 R14: 0000000062406d60 R15: 00000000627700b6
Kernel panic - not syncing: Segfault with no mm
CPU: 0 UID: 0 PID: 29 Comm: kworker/0:2 Not tainted 6.12.0-rc6-g59b723cd2adb #1
Workqueue: events mc\_work\_proc
Stack:
627af028 62c7af00 e20c7c80 60276fcd
62778000 603f5820 627af028 00000000
e20c7cb0 603a2bcd 627af000 62770010
Call Trace:
[<60276fcd>] device\_release+0x70/0xba
[<603a2bcd>] kobject\_put+0xba/0xe7
[<60277265>] put\_device+0x19/0x1c
[<60281266>] platform\_device\_put+0x26/0x29
[<60281e5f>] platform\_device\_unregister+0x2c/0x2e
[<6002ec9c>] net\_remove+0x63/0x69
[<60031316>] ? mconsole\_reply+0x0/0x50
[<600310c8>] mconsole\_remove+0x160/0x1cc
[<60087d40>] ? \_\_remove\_hrtimer+0x38/0x74
[<60087ff8>] ? hrtimer\_try\_to\_cancel+0x8c/0x98
[<6006b3cf>] ? dl\_server\_stop+0x3f/0x48
[<6006b390>] ? dl\_server\_stop+0x0/0x48
[<600672e8>] ? dequeue\_entities+0x327/0x390
[<60038fa6>] ? um\_set\_signals+0x0/0x43
[<6003070c>] mc\_work\_proc+0x77/0x91
[<60057664>] process\_scheduled\_works+0x1b3/0x2dd
[<60055f32>] ? assign\_work+0x0/0x58
[<60057f0a>] worker\_thread+0x1e9/0x293
[<6005406f>] ? set\_pf\_worker+0x0/0x64
[<6005d65d>] ? arch\_local\_irq\_save+0x0/0x2d
[<6005d748>] ? kthread\_exit+0x0/0x3a
[<60057d21>] ? worker\_thread+0x0/0x293
[<6005dbf1>] kthread+0x126/0x12b
[<600219c5>] new\_thread\_handler+0x85/0xb6
Cc: stable@vger.kernel.org
Signed-off-by: Tiwei Bie <tiwei.btw@antgroup.com>
Acked-By: Anton Ivanov <anton.ivanov@cambridgegreys.com>
Link: [https://patch.msgid.link/20241104163203.435515-4-tiwei.btw@antgroup.com](https://patch.msgid.link/20241104163203.435515-4-tiwei.btw%40antgroup.com)
Signed-off-by: Johannes Berg <johannes.berg@intel.com>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=1635d9a0ff1b8bd7aa4767d4ea7b3de72cd36f28)

| -rw-r--r-- | [arch/um/drivers/net\_kern.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/arch/um/drivers/net_kern.c?id=1635d9a0ff1b8bd7aa4767d4ea7b3de72cd36f28) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 1 deletions

| diff --git a/arch/um/drivers/net\_kern.c b/arch/um/drivers/net\_kern.cindex e24bc9aaff4a1c..6e02233aa25f2c 100644--- a/[arch/um/drivers/net\_kern.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/um/drivers/net_kern.c?id=5727343348f34e11a7c5a2a944d5aa505731d876)+++ b/[arch/um/drivers/net\_kern.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/um/drivers/net_kern.c?id=1635d9a0ff1b8bd7aa4767d4ea7b3de72cd36f28)@@ -335,7 +335,7 @@ static struct platform\_driver uml\_net\_driver = {  static void net\_device\_release(struct device \*dev) {- struct uml\_net \*device = dev\_get\_drvdata(dev);+ struct uml\_net \*device = container\_of(dev, struct uml\_net, pdev.dev); struct net\_device \*netdev = device->dev; struct uml\_net\_private \*lp = netdev\_priv(netdev); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 21:24:15 +0000


