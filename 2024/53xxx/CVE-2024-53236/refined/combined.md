=== Content from git.kernel.org_d9fc72ac_20250114_201135.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=7f0d0dd5a7f437d83cff954bc321f1a9b181efd5)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=7f0d0dd5a7f437d83cff954bc321f1a9b181efd5)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=7f0d0dd5a7f437d83cff954bc321f1a9b181efd5)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=7f0d0dd5a7f437d83cff954bc321f1a9b181efd5)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Felix Maurer <fmaurer@redhat.com> | 2024-11-14 12:30:05 +0100 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-05 13:53:28 +0100 |
| commit | [7f0d0dd5a7f437d83cff954bc321f1a9b181efd5](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=7f0d0dd5a7f437d83cff954bc321f1a9b181efd5) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=7f0d0dd5a7f437d83cff954bc321f1a9b181efd5)) | |
| tree | [316891908a52ffb180ec75a70f043a9c3ffd929b](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=7f0d0dd5a7f437d83cff954bc321f1a9b181efd5) | |
| parent | [91e2a2e4d1336333804cd31162984f01ad8cc70f](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=91e2a2e4d1336333804cd31162984f01ad8cc70f) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=7f0d0dd5a7f437d83cff954bc321f1a9b181efd5&id2=91e2a2e4d1336333804cd31162984f01ad8cc70f)) | |
| download | [linux-7f0d0dd5a7f437d83cff954bc321f1a9b181efd5.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-7f0d0dd5a7f437d83cff954bc321f1a9b181efd5.tar.gz) | |

xsk: Free skb when TX metadata options are invalid[ Upstream commit 0c0d0f42ffa6ac94cd79893b7ed419c15e1b45de ]
When a new skb is allocated for transmitting an xsk descriptor, i.e., for
every non-multibuf descriptor or the first frag of a multibuf descriptor,
but the descriptor is later found to have invalid options set for the TX
metadata, the new skb is never freed. This can leak skbs until the send
buffer is full which makes sending more packets impossible.
Fix this by freeing the skb in the error path if we are currently dealing
with the first frag, i.e., an skb allocated in this iteration of
xsk\_build\_skb.
Fixes: 48eb03dd2630 ("xsk: Add TX timestamp and TX checksum offload support")
Reported-by: Michal Schmidt <mschmidt@redhat.com>
Signed-off-by: Felix Maurer <fmaurer@redhat.com>
Reviewed-by: Toke Høiland-Jørgensen <toke@redhat.com>
Acked-by: Stanislav Fomichev <sdf@fomichev.me>
Acked-by: Martin KaFai Lau <martin.lau@kernel.org>
Link: [https://patch.msgid.link/edb9b00fb19e680dff5a3350cd7581c5927975a8.1731581697.git.fmaurer@redhat.com](https://patch.msgid.link/edb9b00fb19e680dff5a3350cd7581c5927975a8.1731581697.git.fmaurer%40redhat.com)
Signed-off-by: Jakub Kicinski <kuba@kernel.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=7f0d0dd5a7f437d83cff954bc321f1a9b181efd5)

| -rw-r--r-- | [net/xdp/xsk.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/xdp/xsk.c?id=7f0d0dd5a7f437d83cff954bc321f1a9b181efd5) | 11 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 6 insertions, 5 deletions

| diff --git a/net/xdp/xsk.c b/net/xdp/xsk.cindex 7e16336044b2d6..6c042e03dad3c5 100644--- a/[net/xdp/xsk.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/xdp/xsk.c?id=91e2a2e4d1336333804cd31162984f01ad8cc70f)+++ b/[net/xdp/xsk.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/xdp/xsk.c?id=7f0d0dd5a7f437d83cff954bc321f1a9b181efd5)@@ -675,6 +675,8 @@ static struct sk\_buff \*xsk\_build\_skb(struct xdp\_sock \*xs, len = desc->len;  if (!skb) {+ first\_frag = true;+ hr = max(NET\_SKB\_PAD, L1\_CACHE\_ALIGN(dev->needed\_headroom)); tr = dev->needed\_tailroom; skb = sock\_alloc\_send\_skb(&xs->sk, hr + len + tr, 1, &err);@@ -685,12 +687,8 @@ static struct sk\_buff \*xsk\_build\_skb(struct xdp\_sock \*xs, skb\_put(skb, len);  err = skb\_store\_bits(skb, 0, buffer, len);- if (unlikely(err)) {- kfree\_skb(skb);+ if (unlikely(err)) goto free\_err;- }-- first\_frag = true; } else { int nr\_frags = skb\_shinfo(skb)->nr\_frags; struct page \*page;@@ -758,6 +756,9 @@ static struct sk\_buff \*xsk\_build\_skb(struct xdp\_sock \*xs, return skb;  free\_err:+ if (first\_frag && skb)+ kfree\_skb(skb);+ if (err == -EOVERFLOW) { /\* Drop the packet \*/ xsk\_set\_destructor\_arg(xs->skb); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 20:10:12 +0000



=== Content from git.kernel.org_3597751f_20250114_201134.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=0c0d0f42ffa6ac94cd79893b7ed419c15e1b45de)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=0c0d0f42ffa6ac94cd79893b7ed419c15e1b45de)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=0c0d0f42ffa6ac94cd79893b7ed419c15e1b45de)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=0c0d0f42ffa6ac94cd79893b7ed419c15e1b45de)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Felix Maurer <fmaurer@redhat.com> | 2024-11-14 12:30:05 +0100 |
| --- | --- | --- |
| committer | Jakub Kicinski <kuba@kernel.org> | 2024-11-15 14:26:40 -0800 |
| commit | [0c0d0f42ffa6ac94cd79893b7ed419c15e1b45de](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=0c0d0f42ffa6ac94cd79893b7ed419c15e1b45de) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=0c0d0f42ffa6ac94cd79893b7ed419c15e1b45de)) | |
| tree | [6a4f23392edcca153b201a2bd85ebaeeff2f39d4](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=0c0d0f42ffa6ac94cd79893b7ed419c15e1b45de) | |
| parent | [8807850697715b6ed3498adf6b6b2411ccfa52c6](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=8807850697715b6ed3498adf6b6b2411ccfa52c6) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=0c0d0f42ffa6ac94cd79893b7ed419c15e1b45de&id2=8807850697715b6ed3498adf6b6b2411ccfa52c6)) | |
| download | [linux-0c0d0f42ffa6ac94cd79893b7ed419c15e1b45de.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-0c0d0f42ffa6ac94cd79893b7ed419c15e1b45de.tar.gz) | |

xsk: Free skb when TX metadata options are invalidWhen a new skb is allocated for transmitting an xsk descriptor, i.e., for
every non-multibuf descriptor or the first frag of a multibuf descriptor,
but the descriptor is later found to have invalid options set for the TX
metadata, the new skb is never freed. This can leak skbs until the send
buffer is full which makes sending more packets impossible.
Fix this by freeing the skb in the error path if we are currently dealing
with the first frag, i.e., an skb allocated in this iteration of
xsk\_build\_skb.
Fixes: 48eb03dd2630 ("xsk: Add TX timestamp and TX checksum offload support")
Reported-by: Michal Schmidt <mschmidt@redhat.com>
Signed-off-by: Felix Maurer <fmaurer@redhat.com>
Reviewed-by: Toke Høiland-Jørgensen <toke@redhat.com>
Acked-by: Stanislav Fomichev <sdf@fomichev.me>
Acked-by: Martin KaFai Lau <martin.lau@kernel.org>
Link: [https://patch.msgid.link/edb9b00fb19e680dff5a3350cd7581c5927975a8.1731581697.git.fmaurer@redhat.com](https://patch.msgid.link/edb9b00fb19e680dff5a3350cd7581c5927975a8.1731581697.git.fmaurer%40redhat.com)
Signed-off-by: Jakub Kicinski <kuba@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=0c0d0f42ffa6ac94cd79893b7ed419c15e1b45de)

| -rw-r--r-- | [net/xdp/xsk.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/xdp/xsk.c?id=0c0d0f42ffa6ac94cd79893b7ed419c15e1b45de) | 11 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 6 insertions, 5 deletions

| diff --git a/net/xdp/xsk.c b/net/xdp/xsk.cindex 1140b2a120caec..b57d5d2904eb46 100644--- a/[net/xdp/xsk.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/xdp/xsk.c?id=8807850697715b6ed3498adf6b6b2411ccfa52c6)+++ b/[net/xdp/xsk.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/xdp/xsk.c?id=0c0d0f42ffa6ac94cd79893b7ed419c15e1b45de)@@ -675,6 +675,8 @@ static struct sk\_buff \*xsk\_build\_skb(struct xdp\_sock \*xs, len = desc->len;  if (!skb) {+ first\_frag = true;+ hr = max(NET\_SKB\_PAD, L1\_CACHE\_ALIGN(dev->needed\_headroom)); tr = dev->needed\_tailroom; skb = sock\_alloc\_send\_skb(&xs->sk, hr + len + tr, 1, &err);@@ -685,12 +687,8 @@ static struct sk\_buff \*xsk\_build\_skb(struct xdp\_sock \*xs, skb\_put(skb, len);  err = skb\_store\_bits(skb, 0, buffer, len);- if (unlikely(err)) {- kfree\_skb(skb);+ if (unlikely(err)) goto free\_err;- }-- first\_frag = true; } else { int nr\_frags = skb\_shinfo(skb)->nr\_frags; struct page \*page;@@ -758,6 +756,9 @@ static struct sk\_buff \*xsk\_build\_skb(struct xdp\_sock \*xs, return skb;  free\_err:+ if (first\_frag && skb)+ kfree\_skb(skb);+ if (err == -EOVERFLOW) { /\* Drop the packet \*/ xsk\_set\_destructor\_arg(xs->skb); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 20:10:11 +0000



=== Content from git.kernel.org_7b95ad34_20250114_201137.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=d5d346deb65efa8453f8481bcea75c1a590439e7)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=d5d346deb65efa8453f8481bcea75c1a590439e7)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=d5d346deb65efa8453f8481bcea75c1a590439e7)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=d5d346deb65efa8453f8481bcea75c1a590439e7)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Felix Maurer <fmaurer@redhat.com> | 2024-11-14 12:30:05 +0100 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-05 14:02:00 +0100 |
| commit | [d5d346deb65efa8453f8481bcea75c1a590439e7](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=d5d346deb65efa8453f8481bcea75c1a590439e7) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=d5d346deb65efa8453f8481bcea75c1a590439e7)) | |
| tree | [d410a49f10e8d9ef5a57d49c5bab3e374d8dd22d](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=d5d346deb65efa8453f8481bcea75c1a590439e7) | |
| parent | [7b277bd569bb6a2777f0014f84b4344f444fd49d](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=7b277bd569bb6a2777f0014f84b4344f444fd49d) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=d5d346deb65efa8453f8481bcea75c1a590439e7&id2=7b277bd569bb6a2777f0014f84b4344f444fd49d)) | |
| download | [linux-d5d346deb65efa8453f8481bcea75c1a590439e7.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-d5d346deb65efa8453f8481bcea75c1a590439e7.tar.gz) | |

xsk: Free skb when TX metadata options are invalid[ Upstream commit 0c0d0f42ffa6ac94cd79893b7ed419c15e1b45de ]
When a new skb is allocated for transmitting an xsk descriptor, i.e., for
every non-multibuf descriptor or the first frag of a multibuf descriptor,
but the descriptor is later found to have invalid options set for the TX
metadata, the new skb is never freed. This can leak skbs until the send
buffer is full which makes sending more packets impossible.
Fix this by freeing the skb in the error path if we are currently dealing
with the first frag, i.e., an skb allocated in this iteration of
xsk\_build\_skb.
Fixes: 48eb03dd2630 ("xsk: Add TX timestamp and TX checksum offload support")
Reported-by: Michal Schmidt <mschmidt@redhat.com>
Signed-off-by: Felix Maurer <fmaurer@redhat.com>
Reviewed-by: Toke Høiland-Jørgensen <toke@redhat.com>
Acked-by: Stanislav Fomichev <sdf@fomichev.me>
Acked-by: Martin KaFai Lau <martin.lau@kernel.org>
Link: [https://patch.msgid.link/edb9b00fb19e680dff5a3350cd7581c5927975a8.1731581697.git.fmaurer@redhat.com](https://patch.msgid.link/edb9b00fb19e680dff5a3350cd7581c5927975a8.1731581697.git.fmaurer%40redhat.com)
Signed-off-by: Jakub Kicinski <kuba@kernel.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=d5d346deb65efa8453f8481bcea75c1a590439e7)

| -rw-r--r-- | [net/xdp/xsk.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/xdp/xsk.c?id=d5d346deb65efa8453f8481bcea75c1a590439e7) | 11 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 6 insertions, 5 deletions

| diff --git a/net/xdp/xsk.c b/net/xdp/xsk.cindex 1140b2a120caec..b57d5d2904eb46 100644--- a/[net/xdp/xsk.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/xdp/xsk.c?id=7b277bd569bb6a2777f0014f84b4344f444fd49d)+++ b/[net/xdp/xsk.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/xdp/xsk.c?id=d5d346deb65efa8453f8481bcea75c1a590439e7)@@ -675,6 +675,8 @@ static struct sk\_buff \*xsk\_build\_skb(struct xdp\_sock \*xs, len = desc->len;  if (!skb) {+ first\_frag = true;+ hr = max(NET\_SKB\_PAD, L1\_CACHE\_ALIGN(dev->needed\_headroom)); tr = dev->needed\_tailroom; skb = sock\_alloc\_send\_skb(&xs->sk, hr + len + tr, 1, &err);@@ -685,12 +687,8 @@ static struct sk\_buff \*xsk\_build\_skb(struct xdp\_sock \*xs, skb\_put(skb, len);  err = skb\_store\_bits(skb, 0, buffer, len);- if (unlikely(err)) {- kfree\_skb(skb);+ if (unlikely(err)) goto free\_err;- }-- first\_frag = true; } else { int nr\_frags = skb\_shinfo(skb)->nr\_frags; struct page \*page;@@ -758,6 +756,9 @@ static struct sk\_buff \*xsk\_build\_skb(struct xdp\_sock \*xs, return skb;  free\_err:+ if (first\_frag && skb)+ kfree\_skb(skb);+ if (err == -EOVERFLOW) { /\* Drop the packet \*/ xsk\_set\_destructor\_arg(xs->skb); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 20:10:14 +0000


