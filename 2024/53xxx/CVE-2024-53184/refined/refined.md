```
{
  "vulnerability": {
    "root_cause": "The `ubd_device_release` function in the Linux kernel's User-Mode driver (um) for the UBD (User-Mode Block Device) was using `dev_get_drvdata(dev)` to retrieve the `ubd` instance. However, this data is not available during the release phase of the device, leading to a null pointer dereference.",
    "weaknesses": [
      "Incorrect use of `dev_get_drvdata` in the device release function.",
       "Accessing driver data that might not be available."
    ],
    "impact": "A crash (kernel panic) due to a null pointer dereference, rendering the system unusable. The specific crash occurs in `blk_mq_free_tag_set`.",
    "attack_vectors": "Removing a UBD device.",
    "required_capabilities": "The attacker needs to trigger the removal of a UBD device to trigger the vulnerability."
  },
  "affected_component": "Linux kernel's User-Mode driver for UBD (arch/um/drivers/ubd_kern.c)",
  "affected_versions": "Linux kernel versions before the fix (see commit IDs)",
  "fixed_versions": "Linux kernel versions containing the fix (see commit IDs)",
   "fix": "Replaced `dev_get_drvdata(dev)` with `container_of(dev, struct ubd, pdev.dev)` in `ubd_device_release` function.",
    "commits": [
        {
            "commit_id": "a5a75207efae4b558aaa34c288de7d6f2e926b4b",
            "diff": "diff --git a/arch/um/drivers/ubd_kern.c b/arch/um/drivers/ubd_kern.c\nindex 1203f5078cb571..18e85f929d7032 100644\n--- a/arch/um/drivers/ubd_kern.c\n+++ b/arch/um/drivers/ubd_kern.c\n@@ -799,7 +799,7 @@\n static int ubd_open_dev(struct ubd *ubd_dev)\n {\n \n-static void ubd_device_release(struct device *dev)\n-{\n-       struct ubd *ubd_dev = dev_get_drvdata(dev);\n+static void ubd_device_release(struct device *dev)\n+{\n+       struct ubd *ubd_dev = container_of(dev, struct ubd, pdev.dev);\n        blk_mq_free_tag_set(&ubd_dev->tag_set);\n        *ubd_dev = ((struct ubd) DEFAULT_UBD);\n",
            "commit_message": "um: ubd: Do not use drvdata in release"
        },
        {
            "commit_id": "5bee35e5389f450a7eea7318deb9073e9414d3b1",
            "diff": "diff --git a/arch/um/drivers/ubd_kern.c b/arch/um/drivers/ubd_kern.c\nindex f19173da64d83c..66c1a8835e3627 100644\n--- a/arch/um/drivers/ubd_kern.c\n+++ b/arch/um/drivers/ubd_kern.c\n@@ -779,7 +779,7 @@\n static int ubd_open_dev(struct ubd *ubd_dev)\n {\n \n-static void ubd_device_release(struct device *dev)\n-{\n-       struct ubd *ubd_dev = dev_get_drvdata(dev);\n+static void ubd_device_release(struct device *dev)\n+{\n+       struct ubd *ubd_dev = container_of(dev, struct ubd, pdev.dev);\n        blk_mq_free_tag_set(&ubd_dev->tag_set);\n        *ubd_dev = ((struct ubd) DEFAULT_UBD);\n",
           "commit_message": "um: ubd: Do not use drvdata in release"
        },
        {
            "commit_id": "e6e5a4cded9bef3a1b0a4fac815b7176eb9a18ec",
            "diff": "diff --git a/arch/um/drivers/ubd_kern.c b/arch/um/drivers/ubd_kern.c\nindex 7f28ec1929dc0b..119df766270021 100644\n--- a/arch/um/drivers/ubd_kern.c\n+++ b/arch/um/drivers/ubd_kern.c\n@@ -779,7 +779,7 @@\n static int ubd_open_dev(struct ubd *ubd_dev)\n {\n \n-static void ubd_device_release(struct device *dev)\n-{\n-       struct ubd *ubd_dev = dev_get_drvdata(dev);\n+static void ubd_device_release(struct device *dev)\n+{\n+       struct ubd *ubd_dev = container_of(dev, struct ubd, pdev.dev);\n        blk_mq_free_tag_set(&ubd_dev->tag_set);\n        *ubd_dev = ((struct ubd) DEFAULT_UBD);\n",
            "commit_message": "um: ubd: Do not use drvdata in release"
        },
       {
            "commit_id": "5727343348f34e11a7c5a2a944d5aa505731d876",
            "diff": "diff --git a/arch/um/drivers/ubd_kern.c b/arch/um/drivers/ubd_kern.c\nindex b3a4cc5a2091fb..b5f3fa514be16b 100644\n--- a/arch/um/drivers/ubd_kern.c\n+++ b/arch/um/drivers/ubd_kern.c\n@@ -814,7 +814,7 @@\n static int ubd_open_dev(struct ubd *ubd_dev)\n {\n \n-static void ubd_device_release(struct device *dev)\n-{\n-       struct ubd *ubd_dev = dev_get_drvdata(dev);\n+static void ubd_device_release(struct device *dev)\n+{\n+       struct ubd *ubd_dev = container_of(dev, struct ubd, pdev.dev);\n        blk_mq_free_tag_set(&ubd_dev->tag_set);\n        *ubd_dev = ((struct ubd) DEFAULT_UBD);\n",
           "commit_message": "um: ubd: Do not use drvdata in release"
        },
        {
            "commit_id": "300e277e463e6326938dd55ea560eafa0f5c88a5",
            "diff": "diff --git a/arch/um/drivers/ubd_kern.c b/arch/um/drivers/ubd_kern.c\nindex a4e531f0e3b96f..70d3e46774431a 100644\n--- a/arch/um/drivers/ubd_kern.c\n+++ b/arch/um/drivers/ubd_kern.c\n@@ -860,7 +860,7 @@\n static int ubd_open_dev(struct ubd *ubd_dev)\n {\n \n-static void ubd_device_release(struct device *dev)\n-{\n-       struct ubd *ubd_dev = dev_get_drvdata(dev);\n+static void ubd_device_release(struct device *dev)\n+{\n+       struct ubd *ubd_dev = container_of(dev, struct ubd, pdev.dev);\n        blk_cleanup_queue(ubd_dev->queue);\n        blk_mq_free_tag_set(&ubd_dev->tag_set);\n",
            "commit_message": "um: ubd: Do not use drvdata in release"
        },
        {
            "commit_id":"23d742a3fcd4781eed015a3a93e6a0e3ab1ef2a8",
            "diff":"diff --git a/arch/um/drivers/ubd_kern.c b/arch/um/drivers/ubd_kern.c\nindex 4a32df89a491e8..7f82f1fbb8917c 100644\n--- a/arch/um/drivers/ubd_kern.c\n+++ b/arch/um/drivers/ubd_kern.c\n@@ -854,7 +854,7 @@\n static int ubd_open_dev(struct ubd *ubd_dev)\n {\n \n-static void ubd_device_release(struct device *dev)\n-{\n-       struct ubd *ubd_dev = dev_get_drvdata(dev);\n+static void ubd_device_release(struct device *dev)\n+{\n+       struct ubd *ubd_dev = container_of(dev, struct ubd, pdev.dev);\n        blk_cleanup_queue(ubd_dev->queue);\n        *ubd_dev = ((struct ubd) DEFAULT_UBD);\n",
            "commit_message": "um: ubd: Do not use drvdata in release"
        },
        {
            "commit_id": "2d194d951895df214e066d08146e77cb6e02c1d4",
            "diff": "diff --git a/arch/um/drivers/ubd_kern.c b/arch/um/drivers/ubd_kern.c\nindex ef7b4b911a455a..7ddda2c0ae436f 100644\n--- a/arch/um/drivers/ubd_kern.c\n+++ b/arch/um/drivers/ubd_kern.c\n@@ -799,7 +799,7 @@\n static int ubd_open_dev(struct ubd *ubd_dev)\n {\n \n-static void ubd_device_release(struct device *dev)\n-{\n-       struct ubd *ubd_dev = dev_get_drvdata(dev);\n+static void ubd_device_release(struct device *dev)\n+{\n+       struct ubd *ubd_dev = container_of(dev, struct ubd, pdev.dev);\n        blk_mq_free_tag_set(&ubd_dev->tag_set);\n        *ubd_dev = ((struct ubd) DEFAULT_UBD);\n",
            "commit_message":"um: ubd: Do not use drvdata in release"
        },
        {
             "commit_id": "16cf8511680809a9f20b3dd224c06d482648f9e2",
             "diff": "diff --git a/arch/um/drivers/ubd_kern.c b/arch/um/drivers/ubd_kern.c\nindex 7f28ec1929dc0b..119df766270021 100644\n--- a/arch/um/drivers/ubd_kern.c\n+++ b/arch/um/drivers/ubd_kern.c\n@@ -779,7 +779,7 @@\n static int ubd_open_dev(struct ubd *ubd_dev)\n {\n \n-static void ubd_device_release(struct device *dev)\n-{\n-       struct ubd *ubd_dev = dev_get_drvdata(dev);\n+static void ubd_device_release(struct device *dev)\n+{\n+       struct ubd *ubd_dev = container_of(dev, struct ubd, pdev.dev);\n        blk_mq_free_tag_set(&ubd_dev->tag_set);\n        *ubd_dev = ((struct ubd) DEFAULT_UBD);\n",
             "commit_message": "um: ubd: Do not use drvdata in release"
        },
        {
            "commit_id": "509ba8746f812e45a05034ba18b73db574693d11",
             "diff": "diff --git a/arch/um/drivers/ubd_kern.c b/arch/um/drivers/ubd_kern.c\nindex de28ce711687e8..7a66b88275cf75 100644\n--- a/arch/um/drivers/ubd_kern.c\n+++ b/arch/um/drivers/ubd_kern.c\n@@ -861,7 +861,7 @@\n static int ubd_open_dev(struct ubd *ubd_dev)\n {\n \n-static void ubd_device_release(struct device *dev)\n-{\n-       struct ubd *ubd_dev = dev_get_drvdata(dev);\n+static void ubd_device_release(struct device *dev)\n+{\n+       struct ubd *ubd_dev = container_of(dev, struct ubd, pdev.dev);\n        blk_cleanup_queue(ubd_dev->queue);\n        blk_mq_free_tag_set(&ubd_dev->tag_set);\n",
            "commit_message": "um: ubd: Do not use drvdata in release"
        }
    ]
}
```