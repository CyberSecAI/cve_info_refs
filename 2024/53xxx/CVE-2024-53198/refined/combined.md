=== Content from git.kernel.org_a4c48cef_20250114_231548.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=87106169b4ce26f85561f953d13d1fd86d99b612)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=87106169b4ce26f85561f953d13d1fd86d99b612)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=87106169b4ce26f85561f953d13d1fd86d99b612)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=87106169b4ce26f85561f953d13d1fd86d99b612)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Qiu-ji Chen <chenqiuji666@gmail.com> | 2024-11-05 21:09:19 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-14 19:44:47 +0100 |
| commit | [87106169b4ce26f85561f953d13d1fd86d99b612](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=87106169b4ce26f85561f953d13d1fd86d99b612) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=87106169b4ce26f85561f953d13d1fd86d99b612)) | |
| tree | [843a9f75a99fc9702d36c76de1dafe21d6a3b2ae](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=87106169b4ce26f85561f953d13d1fd86d99b612) | |
| parent | [1c264dd6430261780de4edb3fe3a1c153e761b7f](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=1c264dd6430261780de4edb3fe3a1c153e761b7f) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=87106169b4ce26f85561f953d13d1fd86d99b612&id2=1c264dd6430261780de4edb3fe3a1c153e761b7f)) | |
| download | [linux-87106169b4ce26f85561f953d13d1fd86d99b612.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-87106169b4ce26f85561f953d13d1fd86d99b612.tar.gz) | |

xen: Fix the issue of resource not being properly released in xenbus\_dev\_probe()[ Upstream commit afc545da381ba0c651b2658966ac737032676f01 ]
This patch fixes an issue in the function xenbus\_dev\_probe(). In the
xenbus\_dev\_probe() function, within the if (err) branch at line 313, the
program incorrectly returns err directly without releasing the resources
allocated by err = drv->probe(dev, id). As the return value is non-zero,
the upper layers assume the processing logic has failed. However, the probe
operation was performed earlier without a corresponding remove operation.
Since the probe actually allocates resources, failing to perform the remove
operation could lead to problems.
To fix this issue, we followed the resource release logic of the
xenbus\_dev\_remove() function by adding a new block fail\_remove before the
fail\_put block. After entering the branch if (err) at line 313, the
function will use a goto statement to jump to the fail\_remove block,
ensuring that the previously acquired resources are correctly released,
thus preventing the reference count leak.
This bug was identified by an experimental static analysis tool developed
by our team. The tool specializes in analyzing reference count operations
and detecting potential issues where resources are not properly managed.
In this case, the tool flagged the missing release operation as a
potential problem, which led to the development of this patch.
Fixes: 4bac07c993d0 ("xen: add the Xenbus sysfs and virtual device hotplug driver")
Cc: stable@vger.kernel.org
Signed-off-by: Qiu-ji Chen <chenqiuji666@gmail.com>
Reviewed-by: Juergen Gross <jgross@suse.com>
Message-ID: <20241105130919.4621-1-chenqiuji666@gmail.com>
Signed-off-by: Juergen Gross <jgross@suse.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=87106169b4ce26f85561f953d13d1fd86d99b612)

| -rw-r--r-- | [drivers/xen/xenbus/xenbus\_probe.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/xen/xenbus/xenbus_probe.c?id=87106169b4ce26f85561f953d13d1fd86d99b612) | 8 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 7 insertions, 1 deletions

| diff --git a/drivers/xen/xenbus/xenbus\_probe.c b/drivers/xen/xenbus/xenbus\_probe.cindex b88512d92ef52c..fd686b962727a8 100644--- a/[drivers/xen/xenbus/xenbus\_probe.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/xen/xenbus/xenbus_probe.c?id=1c264dd6430261780de4edb3fe3a1c153e761b7f)+++ b/[drivers/xen/xenbus/xenbus\_probe.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/xen/xenbus/xenbus_probe.c?id=87106169b4ce26f85561f953d13d1fd86d99b612)@@ -250,10 +250,16 @@ int xenbus\_dev\_probe(struct device \*\_dev) if (err) { dev\_warn(&dev->dev, "watch\_otherend on %s failed.\n", dev->nodename);- return err;+ goto fail\_remove; }  return 0;+fail\_remove:+ if (drv->remove) {+ down(&dev->reclaim\_sem);+ drv->remove(dev);+ up(&dev->reclaim\_sem);+ } fail\_put: module\_put(drv->driver.owner); fail: |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 23:14:25 +0000



=== Content from git.kernel.org_f6d768ab_20250114_231544.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=0aa9e30b5b4af5dd504801689d6d84c584290a45)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=0aa9e30b5b4af5dd504801689d6d84c584290a45)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=0aa9e30b5b4af5dd504801689d6d84c584290a45)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=0aa9e30b5b4af5dd504801689d6d84c584290a45)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Qiu-ji Chen <chenqiuji666@gmail.com> | 2024-11-05 21:09:19 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-14 19:48:07 +0100 |
| commit | [0aa9e30b5b4af5dd504801689d6d84c584290a45](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=0aa9e30b5b4af5dd504801689d6d84c584290a45) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=0aa9e30b5b4af5dd504801689d6d84c584290a45)) | |
| tree | [35573bc6d21a53e2538d066a8e1134df126394f8](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=0aa9e30b5b4af5dd504801689d6d84c584290a45) | |
| parent | [e47f0e95441be944f2aa077958d2beacc4d6e27d](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=e47f0e95441be944f2aa077958d2beacc4d6e27d) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=0aa9e30b5b4af5dd504801689d6d84c584290a45&id2=e47f0e95441be944f2aa077958d2beacc4d6e27d)) | |
| download | [linux-0aa9e30b5b4af5dd504801689d6d84c584290a45.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-0aa9e30b5b4af5dd504801689d6d84c584290a45.tar.gz) | |

xen: Fix the issue of resource not being properly released in xenbus\_dev\_probe()commit afc545da381ba0c651b2658966ac737032676f01 upstream.
This patch fixes an issue in the function xenbus\_dev\_probe(). In the
xenbus\_dev\_probe() function, within the if (err) branch at line 313, the
program incorrectly returns err directly without releasing the resources
allocated by err = drv->probe(dev, id). As the return value is non-zero,
the upper layers assume the processing logic has failed. However, the probe
operation was performed earlier without a corresponding remove operation.
Since the probe actually allocates resources, failing to perform the remove
operation could lead to problems.
To fix this issue, we followed the resource release logic of the
xenbus\_dev\_remove() function by adding a new block fail\_remove before the
fail\_put block. After entering the branch if (err) at line 313, the
function will use a goto statement to jump to the fail\_remove block,
ensuring that the previously acquired resources are correctly released,
thus preventing the reference count leak.
This bug was identified by an experimental static analysis tool developed
by our team. The tool specializes in analyzing reference count operations
and detecting potential issues where resources are not properly managed.
In this case, the tool flagged the missing release operation as a
potential problem, which led to the development of this patch.
Fixes: 4bac07c993d0 ("xen: add the Xenbus sysfs and virtual device hotplug driver")
Cc: stable@vger.kernel.org
Signed-off-by: Qiu-ji Chen <chenqiuji666@gmail.com>
Reviewed-by: Juergen Gross <jgross@suse.com>
Message-ID: <20241105130919.4621-1-chenqiuji666@gmail.com>
Signed-off-by: Juergen Gross <jgross@suse.com>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=0aa9e30b5b4af5dd504801689d6d84c584290a45)

| -rw-r--r-- | [drivers/xen/xenbus/xenbus\_probe.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/xen/xenbus/xenbus_probe.c?id=0aa9e30b5b4af5dd504801689d6d84c584290a45) | 8 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 7 insertions, 1 deletions

| diff --git a/drivers/xen/xenbus/xenbus\_probe.c b/drivers/xen/xenbus/xenbus\_probe.cindex 98d870672dc5ef..743795d402cb08 100644--- a/[drivers/xen/xenbus/xenbus\_probe.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/xen/xenbus/xenbus_probe.c?id=e47f0e95441be944f2aa077958d2beacc4d6e27d)+++ b/[drivers/xen/xenbus/xenbus\_probe.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/xen/xenbus/xenbus_probe.c?id=0aa9e30b5b4af5dd504801689d6d84c584290a45)@@ -250,10 +250,16 @@ int xenbus\_dev\_probe(struct device \*\_dev) if (err) { dev\_warn(&dev->dev, "watch\_otherend on %s failed.\n", dev->nodename);- return err;+ goto fail\_remove; }  return 0;+fail\_remove:+ if (drv->remove) {+ down(&dev->reclaim\_sem);+ drv->remove(dev);+ up(&dev->reclaim\_sem);+ } fail\_put: module\_put(drv->driver.owner); fail: |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 23:14:21 +0000



=== Content from git.kernel.org_40e1f6ba_20250114_231546.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=3fc0996d2fefe61219375fd650601724b8cf2d30)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=3fc0996d2fefe61219375fd650601724b8cf2d30)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=3fc0996d2fefe61219375fd650601724b8cf2d30)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=3fc0996d2fefe61219375fd650601724b8cf2d30)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Qiu-ji Chen <chenqiuji666@gmail.com> | 2024-11-05 21:09:19 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-14 19:53:54 +0100 |
| commit | [3fc0996d2fefe61219375fd650601724b8cf2d30](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=3fc0996d2fefe61219375fd650601724b8cf2d30) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=3fc0996d2fefe61219375fd650601724b8cf2d30)) | |
| tree | [f5ec6734fd0667a435ad9649e36a3379baf9ab2d](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=3fc0996d2fefe61219375fd650601724b8cf2d30) | |
| parent | [d1e3efe783365db59da88f08a2e0bfe1cc95b143](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=d1e3efe783365db59da88f08a2e0bfe1cc95b143) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=3fc0996d2fefe61219375fd650601724b8cf2d30&id2=d1e3efe783365db59da88f08a2e0bfe1cc95b143)) | |
| download | [linux-3fc0996d2fefe61219375fd650601724b8cf2d30.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-3fc0996d2fefe61219375fd650601724b8cf2d30.tar.gz) | |

xen: Fix the issue of resource not being properly released in xenbus\_dev\_probe()commit afc545da381ba0c651b2658966ac737032676f01 upstream.
This patch fixes an issue in the function xenbus\_dev\_probe(). In the
xenbus\_dev\_probe() function, within the if (err) branch at line 313, the
program incorrectly returns err directly without releasing the resources
allocated by err = drv->probe(dev, id). As the return value is non-zero,
the upper layers assume the processing logic has failed. However, the probe
operation was performed earlier without a corresponding remove operation.
Since the probe actually allocates resources, failing to perform the remove
operation could lead to problems.
To fix this issue, we followed the resource release logic of the
xenbus\_dev\_remove() function by adding a new block fail\_remove before the
fail\_put block. After entering the branch if (err) at line 313, the
function will use a goto statement to jump to the fail\_remove block,
ensuring that the previously acquired resources are correctly released,
thus preventing the reference count leak.
This bug was identified by an experimental static analysis tool developed
by our team. The tool specializes in analyzing reference count operations
and detecting potential issues where resources are not properly managed.
In this case, the tool flagged the missing release operation as a
potential problem, which led to the development of this patch.
Fixes: 4bac07c993d0 ("xen: add the Xenbus sysfs and virtual device hotplug driver")
Cc: stable@vger.kernel.org
Signed-off-by: Qiu-ji Chen <chenqiuji666@gmail.com>
Reviewed-by: Juergen Gross <jgross@suse.com>
Message-ID: <20241105130919.4621-1-chenqiuji666@gmail.com>
Signed-off-by: Juergen Gross <jgross@suse.com>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=3fc0996d2fefe61219375fd650601724b8cf2d30)

| -rw-r--r-- | [drivers/xen/xenbus/xenbus\_probe.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/xen/xenbus/xenbus_probe.c?id=3fc0996d2fefe61219375fd650601724b8cf2d30) | 8 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 7 insertions, 1 deletions

| diff --git a/drivers/xen/xenbus/xenbus\_probe.c b/drivers/xen/xenbus/xenbus\_probe.cindex 1a9ded0cddcb0f..25164d56c9d995 100644--- a/[drivers/xen/xenbus/xenbus\_probe.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/xen/xenbus/xenbus_probe.c?id=d1e3efe783365db59da88f08a2e0bfe1cc95b143)+++ b/[drivers/xen/xenbus/xenbus\_probe.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/xen/xenbus/xenbus_probe.c?id=3fc0996d2fefe61219375fd650601724b8cf2d30)@@ -313,7 +313,7 @@ int xenbus\_dev\_probe(struct device \*\_dev) if (err) { dev\_warn(&dev->dev, "watch\_otherend on %s failed.\n", dev->nodename);- return err;+ goto fail\_remove; }  dev->spurious\_threshold = 1;@@ -322,6 +322,12 @@ int xenbus\_dev\_probe(struct device \*\_dev) dev->nodename);  return 0;+fail\_remove:+ if (drv->remove) {+ down(&dev->reclaim\_sem);+ drv->remove(dev);+ up(&dev->reclaim\_sem);+ } fail\_put: module\_put(drv->driver.owner); fail: |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 23:14:23 +0000



=== Content from git.kernel.org_8fadc60e_20250114_231547.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=804b96f8d0a02fa10b92f28b2e042f9128ed3ffc)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=804b96f8d0a02fa10b92f28b2e042f9128ed3ffc)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=804b96f8d0a02fa10b92f28b2e042f9128ed3ffc)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=804b96f8d0a02fa10b92f28b2e042f9128ed3ffc)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Qiu-ji Chen <chenqiuji666@gmail.com> | 2024-11-05 21:09:19 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-09 10:32:39 +0100 |
| commit | [804b96f8d0a02fa10b92f28b2e042f9128ed3ffc](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=804b96f8d0a02fa10b92f28b2e042f9128ed3ffc) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=804b96f8d0a02fa10b92f28b2e042f9128ed3ffc)) | |
| tree | [016a41d24768e3429006a6bdb17f868af98d0de5](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=804b96f8d0a02fa10b92f28b2e042f9128ed3ffc) | |
| parent | [7cd9f0a33e738cd58876f1bc8d6c1aa5bc4fc8c1](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=7cd9f0a33e738cd58876f1bc8d6c1aa5bc4fc8c1) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=804b96f8d0a02fa10b92f28b2e042f9128ed3ffc&id2=7cd9f0a33e738cd58876f1bc8d6c1aa5bc4fc8c1)) | |
| download | [linux-804b96f8d0a02fa10b92f28b2e042f9128ed3ffc.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-804b96f8d0a02fa10b92f28b2e042f9128ed3ffc.tar.gz) | |

xen: Fix the issue of resource not being properly released in xenbus\_dev\_probe()commit afc545da381ba0c651b2658966ac737032676f01 upstream.
This patch fixes an issue in the function xenbus\_dev\_probe(). In the
xenbus\_dev\_probe() function, within the if (err) branch at line 313, the
program incorrectly returns err directly without releasing the resources
allocated by err = drv->probe(dev, id). As the return value is non-zero,
the upper layers assume the processing logic has failed. However, the probe
operation was performed earlier without a corresponding remove operation.
Since the probe actually allocates resources, failing to perform the remove
operation could lead to problems.
To fix this issue, we followed the resource release logic of the
xenbus\_dev\_remove() function by adding a new block fail\_remove before the
fail\_put block. After entering the branch if (err) at line 313, the
function will use a goto statement to jump to the fail\_remove block,
ensuring that the previously acquired resources are correctly released,
thus preventing the reference count leak.
This bug was identified by an experimental static analysis tool developed
by our team. The tool specializes in analyzing reference count operations
and detecting potential issues where resources are not properly managed.
In this case, the tool flagged the missing release operation as a
potential problem, which led to the development of this patch.
Fixes: 4bac07c993d0 ("xen: add the Xenbus sysfs and virtual device hotplug driver")
Cc: stable@vger.kernel.org
Signed-off-by: Qiu-ji Chen <chenqiuji666@gmail.com>
Reviewed-by: Juergen Gross <jgross@suse.com>
Message-ID: <20241105130919.4621-1-chenqiuji666@gmail.com>
Signed-off-by: Juergen Gross <jgross@suse.com>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=804b96f8d0a02fa10b92f28b2e042f9128ed3ffc)

| -rw-r--r-- | [drivers/xen/xenbus/xenbus\_probe.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/xen/xenbus/xenbus_probe.c?id=804b96f8d0a02fa10b92f28b2e042f9128ed3ffc) | 8 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 7 insertions, 1 deletions

| diff --git a/drivers/xen/xenbus/xenbus\_probe.c b/drivers/xen/xenbus/xenbus\_probe.cindex 1a9ded0cddcb0f..25164d56c9d995 100644--- a/[drivers/xen/xenbus/xenbus\_probe.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/xen/xenbus/xenbus_probe.c?id=7cd9f0a33e738cd58876f1bc8d6c1aa5bc4fc8c1)+++ b/[drivers/xen/xenbus/xenbus\_probe.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/xen/xenbus/xenbus_probe.c?id=804b96f8d0a02fa10b92f28b2e042f9128ed3ffc)@@ -313,7 +313,7 @@ int xenbus\_dev\_probe(struct device \*\_dev) if (err) { dev\_warn(&dev->dev, "watch\_otherend on %s failed.\n", dev->nodename);- return err;+ goto fail\_remove; }  dev->spurious\_threshold = 1;@@ -322,6 +322,12 @@ int xenbus\_dev\_probe(struct device \*\_dev) dev->nodename);  return 0;+fail\_remove:+ if (drv->remove) {+ down(&dev->reclaim\_sem);+ drv->remove(dev);+ up(&dev->reclaim\_sem);+ } fail\_put: module\_put(drv->driver.owner); fail: |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 23:14:24 +0000



=== Content from git.kernel.org_2d31b9a6_20250114_231548.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=afc545da381ba0c651b2658966ac737032676f01)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=afc545da381ba0c651b2658966ac737032676f01)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=afc545da381ba0c651b2658966ac737032676f01)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=afc545da381ba0c651b2658966ac737032676f01)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Qiu-ji Chen <chenqiuji666@gmail.com> | 2024-11-05 21:09:19 +0800 |
| --- | --- | --- |
| committer | Juergen Gross <jgross@suse.com> | 2024-11-13 20:11:26 +0100 |
| commit | [afc545da381ba0c651b2658966ac737032676f01](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=afc545da381ba0c651b2658966ac737032676f01) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=afc545da381ba0c651b2658966ac737032676f01)) | |
| tree | [51ffa42b36fa0f3298000f1e71ef445c487b106f](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=afc545da381ba0c651b2658966ac737032676f01) | |
| parent | [5c6808d1a9dd83853ff39684aeb812be39e108e8](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=5c6808d1a9dd83853ff39684aeb812be39e108e8) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=afc545da381ba0c651b2658966ac737032676f01&id2=5c6808d1a9dd83853ff39684aeb812be39e108e8)) | |
| download | [linux-afc545da381ba0c651b2658966ac737032676f01.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-afc545da381ba0c651b2658966ac737032676f01.tar.gz) | |

xen: Fix the issue of resource not being properly released in xenbus\_dev\_probe()This patch fixes an issue in the function xenbus\_dev\_probe(). In the
xenbus\_dev\_probe() function, within the if (err) branch at line 313, the
program incorrectly returns err directly without releasing the resources
allocated by err = drv->probe(dev, id). As the return value is non-zero,
the upper layers assume the processing logic has failed. However, the probe
operation was performed earlier without a corresponding remove operation.
Since the probe actually allocates resources, failing to perform the remove
operation could lead to problems.
To fix this issue, we followed the resource release logic of the
xenbus\_dev\_remove() function by adding a new block fail\_remove before the
fail\_put block. After entering the branch if (err) at line 313, the
function will use a goto statement to jump to the fail\_remove block,
ensuring that the previously acquired resources are correctly released,
thus preventing the reference count leak.
This bug was identified by an experimental static analysis tool developed
by our team. The tool specializes in analyzing reference count operations
and detecting potential issues where resources are not properly managed.
In this case, the tool flagged the missing release operation as a
potential problem, which led to the development of this patch.
Fixes: 4bac07c993d0 ("xen: add the Xenbus sysfs and virtual device hotplug driver")
Cc: stable@vger.kernel.org
Signed-off-by: Qiu-ji Chen <chenqiuji666@gmail.com>
Reviewed-by: Juergen Gross <jgross@suse.com>
Message-ID: <20241105130919.4621-1-chenqiuji666@gmail.com>
Signed-off-by: Juergen Gross <jgross@suse.com>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=afc545da381ba0c651b2658966ac737032676f01)

| -rw-r--r-- | [drivers/xen/xenbus/xenbus\_probe.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/xen/xenbus/xenbus_probe.c?id=afc545da381ba0c651b2658966ac737032676f01) | 8 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 7 insertions, 1 deletions

| diff --git a/drivers/xen/xenbus/xenbus\_probe.c b/drivers/xen/xenbus/xenbus\_probe.cindex 9f097f1f4a4cf3..6d32ffb0113650 100644--- a/[drivers/xen/xenbus/xenbus\_probe.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/xen/xenbus/xenbus_probe.c?id=5c6808d1a9dd83853ff39684aeb812be39e108e8)+++ b/[drivers/xen/xenbus/xenbus\_probe.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/xen/xenbus/xenbus_probe.c?id=afc545da381ba0c651b2658966ac737032676f01)@@ -313,7 +313,7 @@ int xenbus\_dev\_probe(struct device \*\_dev) if (err) { dev\_warn(&dev->dev, "watch\_otherend on %s failed.\n", dev->nodename);- return err;+ goto fail\_remove; }  dev->spurious\_threshold = 1;@@ -322,6 +322,12 @@ int xenbus\_dev\_probe(struct device \*\_dev) dev->nodename);  return 0;+fail\_remove:+ if (drv->remove) {+ down(&dev->reclaim\_sem);+ drv->remove(dev);+ up(&dev->reclaim\_sem);+ } fail\_put: module\_put(drv->driver.owner); fail: |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 23:14:25 +0000



=== Content from git.kernel.org_3fa31877_20250114_231549.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=e8823e6ff313465910edea07581627d85e68d9fd)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=e8823e6ff313465910edea07581627d85e68d9fd)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=e8823e6ff313465910edea07581627d85e68d9fd)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e8823e6ff313465910edea07581627d85e68d9fd)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Qiu-ji Chen <chenqiuji666@gmail.com> | 2024-11-05 21:09:19 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-14 19:51:11 +0100 |
| commit | [e8823e6ff313465910edea07581627d85e68d9fd](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=e8823e6ff313465910edea07581627d85e68d9fd) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=e8823e6ff313465910edea07581627d85e68d9fd)) | |
| tree | [15d8f93170de866e18404bffd32ff34b2679e6b3](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=e8823e6ff313465910edea07581627d85e68d9fd) | |
| parent | [cb645064e0811053c94e86677f2e58ed29359d62](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=cb645064e0811053c94e86677f2e58ed29359d62) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e8823e6ff313465910edea07581627d85e68d9fd&id2=cb645064e0811053c94e86677f2e58ed29359d62)) | |
| download | [linux-e8823e6ff313465910edea07581627d85e68d9fd.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-e8823e6ff313465910edea07581627d85e68d9fd.tar.gz) | |

xen: Fix the issue of resource not being properly released in xenbus\_dev\_probe()commit afc545da381ba0c651b2658966ac737032676f01 upstream.
This patch fixes an issue in the function xenbus\_dev\_probe(). In the
xenbus\_dev\_probe() function, within the if (err) branch at line 313, the
program incorrectly returns err directly without releasing the resources
allocated by err = drv->probe(dev, id). As the return value is non-zero,
the upper layers assume the processing logic has failed. However, the probe
operation was performed earlier without a corresponding remove operation.
Since the probe actually allocates resources, failing to perform the remove
operation could lead to problems.
To fix this issue, we followed the resource release logic of the
xenbus\_dev\_remove() function by adding a new block fail\_remove before the
fail\_put block. After entering the branch if (err) at line 313, the
function will use a goto statement to jump to the fail\_remove block,
ensuring that the previously acquired resources are correctly released,
thus preventing the reference count leak.
This bug was identified by an experimental static analysis tool developed
by our team. The tool specializes in analyzing reference count operations
and detecting potential issues where resources are not properly managed.
In this case, the tool flagged the missing release operation as a
potential problem, which led to the development of this patch.
Fixes: 4bac07c993d0 ("xen: add the Xenbus sysfs and virtual device hotplug driver")
Cc: stable@vger.kernel.org
Signed-off-by: Qiu-ji Chen <chenqiuji666@gmail.com>
Reviewed-by: Juergen Gross <jgross@suse.com>
Message-ID: <20241105130919.4621-1-chenqiuji666@gmail.com>
Signed-off-by: Juergen Gross <jgross@suse.com>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e8823e6ff313465910edea07581627d85e68d9fd)

| -rw-r--r-- | [drivers/xen/xenbus/xenbus\_probe.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/xen/xenbus/xenbus_probe.c?id=e8823e6ff313465910edea07581627d85e68d9fd) | 8 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 7 insertions, 1 deletions

| diff --git a/drivers/xen/xenbus/xenbus\_probe.c b/drivers/xen/xenbus/xenbus\_probe.cindex fe360c33ce717f..e680bd1adf9c4e 100644--- a/[drivers/xen/xenbus/xenbus\_probe.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/xen/xenbus/xenbus_probe.c?id=cb645064e0811053c94e86677f2e58ed29359d62)+++ b/[drivers/xen/xenbus/xenbus\_probe.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/xen/xenbus/xenbus_probe.c?id=e8823e6ff313465910edea07581627d85e68d9fd)@@ -308,7 +308,7 @@ int xenbus\_dev\_probe(struct device \*\_dev) if (err) { dev\_warn(&dev->dev, "watch\_otherend on %s failed.\n", dev->nodename);- return err;+ goto fail\_remove; }  dev->spurious\_threshold = 1;@@ -317,6 +317,12 @@ int xenbus\_dev\_probe(struct device \*\_dev) dev->nodename);  return 0;+fail\_remove:+ if (drv->remove) {+ down(&dev->reclaim\_sem);+ drv->remove(dev);+ up(&dev->reclaim\_sem);+ } fail\_put: module\_put(drv->driver.owner); fail: |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 23:14:26 +0000



=== Content from git.kernel.org_7d56f2dc_20250114_231545.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=217bdce88b104269b73603b84d0ab4dd04f481bc)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=217bdce88b104269b73603b84d0ab4dd04f481bc)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=217bdce88b104269b73603b84d0ab4dd04f481bc)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=217bdce88b104269b73603b84d0ab4dd04f481bc)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Qiu-ji Chen <chenqiuji666@gmail.com> | 2024-11-05 21:09:19 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-05 13:54:06 +0100 |
| commit | [217bdce88b104269b73603b84d0ab4dd04f481bc](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=217bdce88b104269b73603b84d0ab4dd04f481bc) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=217bdce88b104269b73603b84d0ab4dd04f481bc)) | |
| tree | [af4a51e6983d657b0e450efdf62de0cc24921377](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=217bdce88b104269b73603b84d0ab4dd04f481bc) | |
| parent | [acf2cd0ebb499f4be4812dd5824f9bbe73e84427](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=acf2cd0ebb499f4be4812dd5824f9bbe73e84427) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=217bdce88b104269b73603b84d0ab4dd04f481bc&id2=acf2cd0ebb499f4be4812dd5824f9bbe73e84427)) | |
| download | [linux-217bdce88b104269b73603b84d0ab4dd04f481bc.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-217bdce88b104269b73603b84d0ab4dd04f481bc.tar.gz) | |

xen: Fix the issue of resource not being properly released in xenbus\_dev\_probe()commit afc545da381ba0c651b2658966ac737032676f01 upstream.
This patch fixes an issue in the function xenbus\_dev\_probe(). In the
xenbus\_dev\_probe() function, within the if (err) branch at line 313, the
program incorrectly returns err directly without releasing the resources
allocated by err = drv->probe(dev, id). As the return value is non-zero,
the upper layers assume the processing logic has failed. However, the probe
operation was performed earlier without a corresponding remove operation.
Since the probe actually allocates resources, failing to perform the remove
operation could lead to problems.
To fix this issue, we followed the resource release logic of the
xenbus\_dev\_remove() function by adding a new block fail\_remove before the
fail\_put block. After entering the branch if (err) at line 313, the
function will use a goto statement to jump to the fail\_remove block,
ensuring that the previously acquired resources are correctly released,
thus preventing the reference count leak.
This bug was identified by an experimental static analysis tool developed
by our team. The tool specializes in analyzing reference count operations
and detecting potential issues where resources are not properly managed.
In this case, the tool flagged the missing release operation as a
potential problem, which led to the development of this patch.
Fixes: 4bac07c993d0 ("xen: add the Xenbus sysfs and virtual device hotplug driver")
Cc: stable@vger.kernel.org
Signed-off-by: Qiu-ji Chen <chenqiuji666@gmail.com>
Reviewed-by: Juergen Gross <jgross@suse.com>
Message-ID: <20241105130919.4621-1-chenqiuji666@gmail.com>
Signed-off-by: Juergen Gross <jgross@suse.com>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=217bdce88b104269b73603b84d0ab4dd04f481bc)

| -rw-r--r-- | [drivers/xen/xenbus/xenbus\_probe.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/xen/xenbus/xenbus_probe.c?id=217bdce88b104269b73603b84d0ab4dd04f481bc) | 8 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 7 insertions, 1 deletions

| diff --git a/drivers/xen/xenbus/xenbus\_probe.c b/drivers/xen/xenbus/xenbus\_probe.cindex 9f097f1f4a4cf3..6d32ffb0113650 100644--- a/[drivers/xen/xenbus/xenbus\_probe.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/xen/xenbus/xenbus_probe.c?id=acf2cd0ebb499f4be4812dd5824f9bbe73e84427)+++ b/[drivers/xen/xenbus/xenbus\_probe.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/xen/xenbus/xenbus_probe.c?id=217bdce88b104269b73603b84d0ab4dd04f481bc)@@ -313,7 +313,7 @@ int xenbus\_dev\_probe(struct device \*\_dev) if (err) { dev\_warn(&dev->dev, "watch\_otherend on %s failed.\n", dev->nodename);- return err;+ goto fail\_remove; }  dev->spurious\_threshold = 1;@@ -322,6 +322,12 @@ int xenbus\_dev\_probe(struct device \*\_dev) dev->nodename);  return 0;+fail\_remove:+ if (drv->remove) {+ down(&dev->reclaim\_sem);+ drv->remove(dev);+ up(&dev->reclaim\_sem);+ } fail\_put: module\_put(drv->driver.owner); fail: |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 23:14:22 +0000



=== Content from git.kernel.org_a9bbc510_20250114_231545.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=2f977a4c82d35d063f5fe198bbc501c4b1c5ea0e)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=2f977a4c82d35d063f5fe198bbc501c4b1c5ea0e)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=2f977a4c82d35d063f5fe198bbc501c4b1c5ea0e)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=2f977a4c82d35d063f5fe198bbc501c4b1c5ea0e)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Qiu-ji Chen <chenqiuji666@gmail.com> | 2024-11-05 21:09:19 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-05 14:02:40 +0100 |
| commit | [2f977a4c82d35d063f5fe198bbc501c4b1c5ea0e](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=2f977a4c82d35d063f5fe198bbc501c4b1c5ea0e) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=2f977a4c82d35d063f5fe198bbc501c4b1c5ea0e)) | |
| tree | [2117a931121b1558901f2191ac7ee0de8dc4b3bd](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=2f977a4c82d35d063f5fe198bbc501c4b1c5ea0e) | |
| parent | [d716851d0acfa2de5a9483fffc27d32878f29b7d](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=d716851d0acfa2de5a9483fffc27d32878f29b7d) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=2f977a4c82d35d063f5fe198bbc501c4b1c5ea0e&id2=d716851d0acfa2de5a9483fffc27d32878f29b7d)) | |
| download | [linux-2f977a4c82d35d063f5fe198bbc501c4b1c5ea0e.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-2f977a4c82d35d063f5fe198bbc501c4b1c5ea0e.tar.gz) | |

xen: Fix the issue of resource not being properly released in xenbus\_dev\_probe()commit afc545da381ba0c651b2658966ac737032676f01 upstream.
This patch fixes an issue in the function xenbus\_dev\_probe(). In the
xenbus\_dev\_probe() function, within the if (err) branch at line 313, the
program incorrectly returns err directly without releasing the resources
allocated by err = drv->probe(dev, id). As the return value is non-zero,
the upper layers assume the processing logic has failed. However, the probe
operation was performed earlier without a corresponding remove operation.
Since the probe actually allocates resources, failing to perform the remove
operation could lead to problems.
To fix this issue, we followed the resource release logic of the
xenbus\_dev\_remove() function by adding a new block fail\_remove before the
fail\_put block. After entering the branch if (err) at line 313, the
function will use a goto statement to jump to the fail\_remove block,
ensuring that the previously acquired resources are correctly released,
thus preventing the reference count leak.
This bug was identified by an experimental static analysis tool developed
by our team. The tool specializes in analyzing reference count operations
and detecting potential issues where resources are not properly managed.
In this case, the tool flagged the missing release operation as a
potential problem, which led to the development of this patch.
Fixes: 4bac07c993d0 ("xen: add the Xenbus sysfs and virtual device hotplug driver")
Cc: stable@vger.kernel.org
Signed-off-by: Qiu-ji Chen <chenqiuji666@gmail.com>
Reviewed-by: Juergen Gross <jgross@suse.com>
Message-ID: <20241105130919.4621-1-chenqiuji666@gmail.com>
Signed-off-by: Juergen Gross <jgross@suse.com>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=2f977a4c82d35d063f5fe198bbc501c4b1c5ea0e)

| -rw-r--r-- | [drivers/xen/xenbus/xenbus\_probe.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/xen/xenbus/xenbus_probe.c?id=2f977a4c82d35d063f5fe198bbc501c4b1c5ea0e) | 8 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 7 insertions, 1 deletions

| diff --git a/drivers/xen/xenbus/xenbus\_probe.c b/drivers/xen/xenbus/xenbus\_probe.cindex 9f097f1f4a4cf3..6d32ffb0113650 100644--- a/[drivers/xen/xenbus/xenbus\_probe.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/xen/xenbus/xenbus_probe.c?id=d716851d0acfa2de5a9483fffc27d32878f29b7d)+++ b/[drivers/xen/xenbus/xenbus\_probe.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/xen/xenbus/xenbus_probe.c?id=2f977a4c82d35d063f5fe198bbc501c4b1c5ea0e)@@ -313,7 +313,7 @@ int xenbus\_dev\_probe(struct device \*\_dev) if (err) { dev\_warn(&dev->dev, "watch\_otherend on %s failed.\n", dev->nodename);- return err;+ goto fail\_remove; }  dev->spurious\_threshold = 1;@@ -322,6 +322,12 @@ int xenbus\_dev\_probe(struct device \*\_dev) dev->nodename);  return 0;+fail\_remove:+ if (drv->remove) {+ down(&dev->reclaim\_sem);+ drv->remove(dev);+ up(&dev->reclaim\_sem);+ } fail\_put: module\_put(drv->driver.owner); fail: |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 23:14:22 +0000


