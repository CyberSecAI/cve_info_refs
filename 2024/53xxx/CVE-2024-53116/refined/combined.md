=== Content from git.kernel.org_b3b1fc02_20250114_185910.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=d3e61af64b770e0038470c81f42bd1d0598f6bcc)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=d3e61af64b770e0038470c81f42bd1d0598f6bcc)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=d3e61af64b770e0038470c81f42bd1d0598f6bcc)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=d3e61af64b770e0038470c81f42bd1d0598f6bcc)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Akash Goel <akash.goel@arm.com> | 2024-11-11 13:47:20 +0000 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-11-22 15:39:49 +0100 |
| commit | [d3e61af64b770e0038470c81f42bd1d0598f6bcc](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=d3e61af64b770e0038470c81f42bd1d0598f6bcc) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=d3e61af64b770e0038470c81f42bd1d0598f6bcc)) | |
| tree | [0a1aab896d0d111ed8c27bc72fdbbce81d6e3d85](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=d3e61af64b770e0038470c81f42bd1d0598f6bcc) | |
| parent | [532b68b9a183c0e7fd0a27d7003275e531a7f165](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=532b68b9a183c0e7fd0a27d7003275e531a7f165) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=d3e61af64b770e0038470c81f42bd1d0598f6bcc&id2=532b68b9a183c0e7fd0a27d7003275e531a7f165)) | |
| download | [linux-d3e61af64b770e0038470c81f42bd1d0598f6bcc.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-d3e61af64b770e0038470c81f42bd1d0598f6bcc.tar.gz) | |

drm/panthor: Fix handling of partial GPU mapping of BOs[ Upstream commit 3387e043918e154ca08d83954966a8b087fe2835 ]
This commit fixes the bug in the handling of partial mapping of the
buffer objects to the GPU, which caused kernel warnings.
Panthor didn't correctly handle the case where the partial mapping
spanned multiple scatterlists and the mapping offset didn't point
to the 1st page of starting scatterlist. The offset variable was
not cleared after reaching the starting scatterlist.
Following warning messages were seen.
WARNING: CPU: 1 PID: 650 at drivers/iommu/io-pgtable-arm.c:659 \_\_arm\_lpae\_unmap+0x254/0x5a0
<snip>
pc : \_\_arm\_lpae\_unmap+0x254/0x5a0
lr : \_\_arm\_lpae\_unmap+0x2cc/0x5a0
<snip>
Call trace:
\_\_arm\_lpae\_unmap+0x254/0x5a0
\_\_arm\_lpae\_unmap+0x108/0x5a0
\_\_arm\_lpae\_unmap+0x108/0x5a0
\_\_arm\_lpae\_unmap+0x108/0x5a0
arm\_lpae\_unmap\_pages+0x80/0xa0
panthor\_vm\_unmap\_pages+0xac/0x1c8 [panthor]
panthor\_gpuva\_sm\_step\_unmap+0x4c/0xc8 [panthor]
op\_unmap\_cb.isra.23.constprop.30+0x54/0x80
\_\_drm\_gpuvm\_sm\_unmap+0x184/0x1c8
drm\_gpuvm\_sm\_unmap+0x40/0x60
panthor\_vm\_exec\_op+0xa8/0x120 [panthor]
panthor\_vm\_bind\_exec\_sync\_op+0xc4/0xe8 [panthor]
panthor\_ioctl\_vm\_bind+0x10c/0x170 [panthor]
drm\_ioctl\_kernel+0xbc/0x138
drm\_ioctl+0x210/0x4b0
\_\_arm64\_sys\_ioctl+0xb0/0xf8
invoke\_syscall+0x4c/0x110
el0\_svc\_common.constprop.1+0x98/0xf8
do\_el0\_svc+0x24/0x38
el0\_svc+0x34/0xc8
el0t\_64\_sync\_handler+0xa0/0xc8
el0t\_64\_sync+0x174/0x178
<snip>
panthor : [drm] drm\_WARN\_ON(unmapped\_sz != pgsize \* pgcount)
WARNING: CPU: 1 PID: 650 at drivers/gpu/drm/panthor/panthor\_mmu.c:922 panthor\_vm\_unmap\_pages+0x124/0x1c8 [panthor]
<snip>
pc : panthor\_vm\_unmap\_pages+0x124/0x1c8 [panthor]
lr : panthor\_vm\_unmap\_pages+0x124/0x1c8 [panthor]
<snip>
panthor : [drm] \*ERROR\* failed to unmap range ffffa388f000-ffffa3890000 (requested range ffffa388c000-ffffa3890000)
Fixes: 647810ec2476 ("drm/panthor: Add the MMU/VM logical block")
Signed-off-by: Akash Goel <akash.goel@arm.com>
Reviewed-by: Liviu Dudau <liviu.dudau@arm.com>
Reviewed-by: Steven Price <steven.price@arm.com>
Reviewed-by: Boris Brezillon <boris.brezillon@collabora.com>
Link: [https://patchwork.freedesktop.org/patch/msgid/20241111134720.780403-1-akash.goel@arm.com](https://patchwork.freedesktop.org/patch/msgid/20241111134720.780403-1-akash.goel%40arm.com)
Signed-off-by: Liviu Dudau <liviu.dudau@arm.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=d3e61af64b770e0038470c81f42bd1d0598f6bcc)

| -rw-r--r-- | [drivers/gpu/drm/panthor/panthor\_mmu.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/gpu/drm/panthor/panthor_mmu.c?id=d3e61af64b770e0038470c81f42bd1d0598f6bcc) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 2 insertions, 0 deletions

| diff --git a/drivers/gpu/drm/panthor/panthor\_mmu.c b/drivers/gpu/drm/panthor/panthor\_mmu.cindex d18f32640a79fb..64378e8f124bde 100644--- a/[drivers/gpu/drm/panthor/panthor\_mmu.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/panthor/panthor_mmu.c?id=532b68b9a183c0e7fd0a27d7003275e531a7f165)+++ b/[drivers/gpu/drm/panthor/panthor\_mmu.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/panthor/panthor_mmu.c?id=d3e61af64b770e0038470c81f42bd1d0598f6bcc)@@ -990,6 +990,8 @@ panthor\_vm\_map\_pages(struct panthor\_vm \*vm, u64 iova, int prot,  if (!size) break;++ offset = 0; }  return panthor\_vm\_flush\_range(vm, start\_iova, iova - start\_iova); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 18:57:47 +0000



=== Content from git.kernel.org_968292cb_20250114_185909.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=3387e043918e154ca08d83954966a8b087fe2835)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=3387e043918e154ca08d83954966a8b087fe2835)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=3387e043918e154ca08d83954966a8b087fe2835)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=3387e043918e154ca08d83954966a8b087fe2835)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Akash Goel <akash.goel@arm.com> | 2024-11-11 13:47:20 +0000 |
| --- | --- | --- |
| committer | Liviu Dudau <liviu.dudau@arm.com> | 2024-11-13 00:30:37 +0000 |
| commit | [3387e043918e154ca08d83954966a8b087fe2835](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=3387e043918e154ca08d83954966a8b087fe2835) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=3387e043918e154ca08d83954966a8b087fe2835)) | |
| tree | [086862def6181a70e002d19fb723019917cdd961](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=3387e043918e154ca08d83954966a8b087fe2835) | |
| parent | [14062c267f09c7b33a8d5a7d9eb3908b9941aae4](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=14062c267f09c7b33a8d5a7d9eb3908b9941aae4) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=3387e043918e154ca08d83954966a8b087fe2835&id2=14062c267f09c7b33a8d5a7d9eb3908b9941aae4)) | |
| download | [linux-3387e043918e154ca08d83954966a8b087fe2835.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-3387e043918e154ca08d83954966a8b087fe2835.tar.gz) | |

drm/panthor: Fix handling of partial GPU mapping of BOsThis commit fixes the bug in the handling of partial mapping of the
buffer objects to the GPU, which caused kernel warnings.
Panthor didn't correctly handle the case where the partial mapping
spanned multiple scatterlists and the mapping offset didn't point
to the 1st page of starting scatterlist. The offset variable was
not cleared after reaching the starting scatterlist.
Following warning messages were seen.
WARNING: CPU: 1 PID: 650 at drivers/iommu/io-pgtable-arm.c:659 \_\_arm\_lpae\_unmap+0x254/0x5a0
<snip>
pc : \_\_arm\_lpae\_unmap+0x254/0x5a0
lr : \_\_arm\_lpae\_unmap+0x2cc/0x5a0
<snip>
Call trace:
\_\_arm\_lpae\_unmap+0x254/0x5a0
\_\_arm\_lpae\_unmap+0x108/0x5a0
\_\_arm\_lpae\_unmap+0x108/0x5a0
\_\_arm\_lpae\_unmap+0x108/0x5a0
arm\_lpae\_unmap\_pages+0x80/0xa0
panthor\_vm\_unmap\_pages+0xac/0x1c8 [panthor]
panthor\_gpuva\_sm\_step\_unmap+0x4c/0xc8 [panthor]
op\_unmap\_cb.isra.23.constprop.30+0x54/0x80
\_\_drm\_gpuvm\_sm\_unmap+0x184/0x1c8
drm\_gpuvm\_sm\_unmap+0x40/0x60
panthor\_vm\_exec\_op+0xa8/0x120 [panthor]
panthor\_vm\_bind\_exec\_sync\_op+0xc4/0xe8 [panthor]
panthor\_ioctl\_vm\_bind+0x10c/0x170 [panthor]
drm\_ioctl\_kernel+0xbc/0x138
drm\_ioctl+0x210/0x4b0
\_\_arm64\_sys\_ioctl+0xb0/0xf8
invoke\_syscall+0x4c/0x110
el0\_svc\_common.constprop.1+0x98/0xf8
do\_el0\_svc+0x24/0x38
el0\_svc+0x34/0xc8
el0t\_64\_sync\_handler+0xa0/0xc8
el0t\_64\_sync+0x174/0x178
<snip>
panthor : [drm] drm\_WARN\_ON(unmapped\_sz != pgsize \* pgcount)
WARNING: CPU: 1 PID: 650 at drivers/gpu/drm/panthor/panthor\_mmu.c:922 panthor\_vm\_unmap\_pages+0x124/0x1c8 [panthor]
<snip>
pc : panthor\_vm\_unmap\_pages+0x124/0x1c8 [panthor]
lr : panthor\_vm\_unmap\_pages+0x124/0x1c8 [panthor]
<snip>
panthor : [drm] \*ERROR\* failed to unmap range ffffa388f000-ffffa3890000 (requested range ffffa388c000-ffffa3890000)
Fixes: 647810ec2476 ("drm/panthor: Add the MMU/VM logical block")
Signed-off-by: Akash Goel <akash.goel@arm.com>
Reviewed-by: Liviu Dudau <liviu.dudau@arm.com>
Reviewed-by: Steven Price <steven.price@arm.com>
Reviewed-by: Boris Brezillon <boris.brezillon@collabora.com>
Link: [https://patchwork.freedesktop.org/patch/msgid/20241111134720.780403-1-akash.goel@arm.com](https://patchwork.freedesktop.org/patch/msgid/20241111134720.780403-1-akash.goel%40arm.com)
Signed-off-by: Liviu Dudau <liviu.dudau@arm.com>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=3387e043918e154ca08d83954966a8b087fe2835)

| -rw-r--r-- | [drivers/gpu/drm/panthor/panthor\_mmu.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/gpu/drm/panthor/panthor_mmu.c?id=3387e043918e154ca08d83954966a8b087fe2835) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 2 insertions, 0 deletions

| diff --git a/drivers/gpu/drm/panthor/panthor\_mmu.c b/drivers/gpu/drm/panthor/panthor\_mmu.cindex 7db2edb3374c9d..0e6f94df690dd3 100644--- a/[drivers/gpu/drm/panthor/panthor\_mmu.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/panthor/panthor_mmu.c?id=14062c267f09c7b33a8d5a7d9eb3908b9941aae4)+++ b/[drivers/gpu/drm/panthor/panthor\_mmu.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/panthor/panthor_mmu.c?id=3387e043918e154ca08d83954966a8b087fe2835)@@ -990,6 +990,8 @@ panthor\_vm\_map\_pages(struct panthor\_vm \*vm, u64 iova, int prot,  if (!size) break;++ offset = 0; }  return panthor\_vm\_flush\_range(vm, start\_iova, iova - start\_iova); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 18:57:47 +0000


