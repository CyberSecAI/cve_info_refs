=== Content from github.com_44446c5f_20250114_222428.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FiBotPeaches%2FApktool%2Fsecurity%2Fadvisories%2FGHSA-2hqv-2xv4-5h5w)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FiBotPeaches%2FApktool%2Fsecurity%2Fadvisories%2FGHSA-2hqv-2xv4-5h5w)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=iBotPeaches%2FApktool)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[iBotPeaches](/iBotPeaches)
/
**[Apktool](/iBotPeaches/Apktool)**
Public

* [Notifications](/login?return_to=%2FiBotPeaches%2FApktool) You must be signed in to change notification settings
* [Fork
  3.6k](/login?return_to=%2FiBotPeaches%2FApktool)
* [Star
   20.7k](/login?return_to=%2FiBotPeaches%2FApktool)

* [Code](/iBotPeaches/Apktool)
* [Issues
  70](/iBotPeaches/Apktool/issues)
* [Pull requests
  8](/iBotPeaches/Apktool/pulls)
* [Discussions](/iBotPeaches/Apktool/discussions)
* [Actions](/iBotPeaches/Apktool/actions)
* [Security](/iBotPeaches/Apktool/security)
* [Insights](/iBotPeaches/Apktool/pulse)

Additional navigation options

* [Code](/iBotPeaches/Apktool)
* [Issues](/iBotPeaches/Apktool/issues)
* [Pull requests](/iBotPeaches/Apktool/pulls)
* [Discussions](/iBotPeaches/Apktool/discussions)
* [Actions](/iBotPeaches/Apktool/actions)
* [Security](/iBotPeaches/Apktool/security)
* [Insights](/iBotPeaches/Apktool/pulse)

# Arbitrary file write on Decoding

High

[iBotPeaches](/iBotPeaches)
published
GHSA-2hqv-2xv4-5h5w
Jan 3, 2024

## Package

No package listed

## Affected versions

<=2.9.1

## Patched versions

2.9.2

## Description

### Summary

Apktool infers resource files' output path according to their resource names which can be manipulated by attacker to place files at desired location on the system Apktool runs on

### Details

* Apktool infers resource files' output path according to their resource names ([output-dir]/res/[type]/[resource-name]+[ext of (resource-file)] )
* E.g. a resource named "foo" with path of "res/raw/bar", is extracted to res/raw/foo
* But resource name is never sanitized, therefore altering the resource name from "foo" to "../../../../../../../../../../../../tmp/poc" will end up placing "res/raw/bar" file to /tmp/poc in linux systems, but vulnerability exists in windows as well, didn't check for macOS but it seems generic

### PoC

* Generate Payload

[![apk](https://user-images.githubusercontent.com/26827438/291109805-82b187a5-7754-47f6-91bf-e445b5267c6c.png)](https://user-images.githubusercontent.com/26827438/291109805-82b187a5-7754-47f6-91bf-e445b5267c6c.png)

* Run

[![apk](https://user-images.githubusercontent.com/26827438/291110488-ade8b84a-f488-4209-a9c8-947993fcc351.png)](https://user-images.githubusercontent.com/26827438/291110488-ade8b84a-f488-4209-a9c8-947993fcc351.png)

### Impact

* Attacker may write/overwrite any file that user has write access (e.g. under certain conditions\* shell init files or authorized keys can be overwritten)

  \*Either user name is known or cwd is under user folder (note that an apk may contain 0xFFFF (65535) raw resources, this allows attacker to brute-force his target file)

### Vulnerable code

[![source-code](https://user-images.githubusercontent.com/26827438/291109819-a409dbeb-2910-48e8-8544-8ac691ffde00.png)](https://user-images.githubusercontent.com/26827438/291109819-a409dbeb-2910-48e8-8544-8ac691ffde00.png)

### Patch

* I suggest use of original path as destination path while extracting resources

```
From 50f90be4de46781e2015eac671f1fa8355bb8b87 Mon Sep 17 00:00:00 2001
From: 0x33c0unt <26827438+0x33c0unt@users.noreply.github.com>
Date: Sun, 17 Dec 2023 22:26:32 +0100
Subject: [PATCH] Extract resource files according to their original path
 inside of the APK

---
 .../brut/androlib/res/ResourcesDecoder.java   |  8 ++--
 .../androlib/res/decoder/ResFileDecoder.java  | 47 +++++--------------
 2 files changed, 17 insertions(+), 38 deletions(-)

diff --git a/brut.apktool/apktool-lib/src/main/java/brut/androlib/res/ResourcesDecoder.java b/brut.apktool/apktool-lib/src/main/java/brut/androlib/res/ResourcesDecoder.java
index a9507b6b..976e5885 100644
--- a/brut.apktool/apktool-lib/src/main/java/brut/androlib/res/ResourcesDecoder.java
+++ b/brut.apktool/apktool-lib/src/main/java/brut/androlib/res/ResourcesDecoder.java
@@ -154,12 +154,12 @@ public class ResourcesDecoder {
         decoders.setDecoder("xml", new XmlPullStreamDecoder(axmlParser, getResXmlSerializer()));

         ResFileDecoder fileDecoder = new ResFileDecoder(decoders);
-        Directory in, out;
+        Directory in, out, outRes;

         try {
             out = new FileDirectory(outDir);
             in = mApkInfo.getApkFile().getDirectory();
-            out = out.createDir("res");
+            outRes = out.createDir("res");
         } catch (DirectoryException ex) {
             throw new AndrolibException(ex);
         }
@@ -174,9 +174,9 @@ public class ResourcesDecoder {

             LOGGER.info("Decoding values */* XMLs...");
             for (ResValuesFile valuesFile : pkg.listValuesFiles()) {
-                generateValuesFile(valuesFile, out, xmlSerializer);
+                generateValuesFile(valuesFile, outRes, xmlSerializer);
             }
-            generatePublicXml(pkg, out, xmlSerializer);
+            generatePublicXml(pkg, outRes, xmlSerializer);
         }

         AndrolibException decodeError = axmlParser.getFirstError();
diff --git a/brut.apktool/apktool-lib/src/main/java/brut/androlib/res/decoder/ResFileDecoder.java b/brut.apktool/apktool-lib/src/main/java/brut/androlib/res/decoder/ResFileDecoder.java
index 9bab7c98..d4956f6d 100644
--- a/brut.apktool/apktool-lib/src/main/java/brut/androlib/res/decoder/ResFileDecoder.java
+++ b/brut.apktool/apktool-lib/src/main/java/brut/androlib/res/decoder/ResFileDecoder.java
@@ -42,92 +42,71 @@ public class ResFileDecoder {
             throws AndrolibException {

         ResFileValue fileValue = (ResFileValue) res.getValue();
-        String inFilePath = fileValue.toString();
+        String filePath = fileValue.toString();
         String inFileName = fileValue.getStrippedPath();
-        String outResName = res.getFilePath();
         String typeName = res.getResSpec().getType().getName();
-
         String ext = null;
-        String outFileName;
         int extPos = inFileName.lastIndexOf(".");
-        if (extPos == -1) {
-            outFileName = outResName;
-        } else {
+        if (extPos != -1) {
             ext = inFileName.substring(extPos).toLowerCase();
-            outFileName = outResName + ext;
-        }
-
-        String outFilePath = "res/" + outFileName;
-        if (!inFilePath.equals(outFilePath)) {
-            resFileMapping.put(inFilePath, outFilePath);
         }
-
-        LOGGER.fine("Decoding file " + inFilePath + " to " + outFilePath);
+        LOGGER.fine("Decoding file " + filePath);

         try {
             if (typeName.equals("raw")) {
-                decode(inDir, inFilePath, outDir, outFileName, "raw");
+                decode(inDir, filePath, outDir, filePath, "raw");
                 return;
             }
             if (typeName.equals("font") && !".xml".equals(ext)) {
-                decode(inDir, inFilePath, outDir, outFileName, "raw");
+                decode(inDir, filePath, outDir, filePath, "raw");
                 return;
             }
             if (typeName.equals("drawable") || typeName.equals("mipmap")) {
                 if (inFileName.toLowerCase().endsWith(".9" + ext)) {
-                    outFileName = outResName + ".9" + ext;
-
-                    // check for htc .r.9.png
-                    if (inFileName.toLowerCase().endsWith(".r.9" + ext)) {
-                        outFileName = outResName + ".r.9" + ext;
-                    }
-
                     // check for raw 9patch images
                     for (String extension : RAW_9PATCH_IMAGE_EXTENSIONS) {
                         if (inFileName.toLowerCase().endsWith("." + extension)) {
-                            copyRaw(inDir, outDir, inFilePath, outFileName);
+                            copyRaw(inDir, outDir, filePath, filePath);
                             return;
                         }
                     }
-
                     // check for xml 9 patches which are just xml files
                     if (inFileName.toLowerCase().endsWith(".xml")) {
-                        decode(inDir, inFilePath, outDir, outFileName, "xml");
+                        decode(inDir, filePath, outDir, filePath, "xml");
                         return;
                     }

                     try {
-                        decode(inDir, inFilePath, outDir, outFileName, "9patch");
+                        decode(inDir, filePath, outDir, filePath, "9patch");
                         return;
                     } catch (CantFind9PatchChunkException ex) {
                         LOGGER.log(Level.WARNING, String.format(
                             "Cant find 9patch chunk in file: \"%s\". Renaming it to *.png.", inFileName
                         ), ex);
-                        outDir.removeFile(outFileName);
-                        outFileName = outResName + ext;
+                        outDir.removeFile(filePath);
                     }
                 }

                 // check for raw image
                 for (String extension : RAW_IMAGE_EXTENSIONS) {
                     if (inFileName.toLowerCase().endsWith("." + extension)) {
-                        copyRaw(inDir, outDir, inFilePath, outFileName);
+                        copyRaw(inDir, outDir, filePath, filePath);
                         return;
                     }
                 }

                 if (!".xml".equals(ext)) {
-                    decode(inDir, inFilePath, outDir, outFileName, "raw");
+                    decode(inDir, filePath, outDir, filePath, "raw");
                     return;
                 }
             }

-            decode(inDir, inFilePath, outDir, outFileName, "xml");
+            decode(inDir, filePath, outDir, filePath, "xml");
         } catch (RawXmlEncounteredException ex) {
             // If we got an error to decode XML, lets assume the file is in raw format.
             // This is a large assumption, that might increase runtime, but will save us for situations where
             // XSD files are AXML`d on aapt1, but left in plaintext in aapt2.
-            decode(inDir, inFilePath, outDir, outFileName, "raw");
+            decode(inDir, filePath, outDir, filePath, "raw");
         } catch (AndrolibException ex) {
             LOGGER.log(Level.SEVERE, String.format(
                 "Could not decode file, replacing by FALSE value: %s",
--
2.39.3 (Apple Git-145)

```
### Credits

* [Denuvo](https://irdeto.com/denuvo/), although it is not part of my job to dig for vulnerabilities, this vulnerability was spot by coincidence during my shift.

### Severity

High

7.8

# CVSS overall score

 This score calculates overall vulnerability severity from 0 to 10 and is based on the Common Vulnerability Scoring System (CVSS).

 / 10

#### CVSS v3 base metrics

Attack vector
Local

Attack complexity
Low

Privileges required
None

User interaction
Required

Scope
Unchanged

Confidentiality
High

Integrity
High

Availability
High

Learn more about base metrics

# CVSS v3 base metrics

Attack vector:
More severe the more the remote (logically and physically) an attacker can be in order to exploit the vulnerability.

Attack complexity:
More severe for the least complex attacks.

Privileges required:
More severe if no privileges are required.

User interaction:
More severe when no user interaction is required.

Scope:
More severe when a scope change occurs, e.g. one vulnerable component impacts resources in components beyond its security scope.

Confidentiality:
More severe when loss of data confidentiality is highest, measuring the level of data access available to an unauthorized user.

Integrity:
More severe when loss of data integrity is the highest, measuring the consequence of data modification possible by an unauthorized user.

Availability:
More severe when the loss of impacted component availability is highest.

CVSS:3.1/AV:L/AC:L/PR:N/UI:R/S:U/C:H/I:H/A:H

### CVE ID

CVE-2024-21633

### Weaknesses

[CWE-22](/advisories?query=cwe%3A22)

### Credits

* [![@0x33c0unt](https://avatars.githubusercontent.com/u/26827438?s=40&v=4)](/0x33c0unt)
  [0x33c0unt](/0x33c0unt)
  Reporter
* [![@iBotPeaches](https://avatars.githubusercontent.com/u/611784?s=40&v=4)](/iBotPeaches)
  [iBotPeaches](/iBotPeaches)
  Remediation developer

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_9a6348e0_20250114_222425.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FiBotPeaches%2FApktool%2Fcommit%2Fd348c43b24a9de350ff6e5bd610545a10c1fc712)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FiBotPeaches%2FApktool%2Fcommit%2Fd348c43b24a9de350ff6e5bd610545a10c1fc712)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=iBotPeaches%2FApktool)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[iBotPeaches](/iBotPeaches)
/
**[Apktool](/iBotPeaches/Apktool)**
Public

* [Notifications](/login?return_to=%2FiBotPeaches%2FApktool) You must be signed in to change notification settings
* [Fork
  3.6k](/login?return_to=%2FiBotPeaches%2FApktool)
* [Star
   20.7k](/login?return_to=%2FiBotPeaches%2FApktool)

* [Code](/iBotPeaches/Apktool)
* [Issues
  70](/iBotPeaches/Apktool/issues)
* [Pull requests
  8](/iBotPeaches/Apktool/pulls)
* [Discussions](/iBotPeaches/Apktool/discussions)
* [Actions](/iBotPeaches/Apktool/actions)
* [Security](/iBotPeaches/Apktool/security)
* [Insights](/iBotPeaches/Apktool/pulse)

Additional navigation options

* [Code](/iBotPeaches/Apktool)
* [Issues](/iBotPeaches/Apktool/issues)
* [Pull requests](/iBotPeaches/Apktool/pulls)
* [Discussions](/iBotPeaches/Apktool/discussions)
* [Actions](/iBotPeaches/Apktool/actions)
* [Security](/iBotPeaches/Apktool/security)
* [Insights](/iBotPeaches/Apktool/pulse)

## Commit

[Permalink](/iBotPeaches/Apktool/commit/d348c43b24a9de350ff6e5bd610545a10c1fc712)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Prevent arbitrary file writes with malicious resource names. ([#3484](https://github.com/iBotPeaches/Apktool/pull/3484))

[Browse files](/iBotPeaches/Apktool/tree/d348c43b24a9de350ff6e5bd610545a10c1fc712)
Browse the repository at this point in the history

```
* refactor: rename sanitize function

* fix: expose getDir

* fix: safe handling of untrusted resource names

 - fixes: [GHSA-2hqv-2xv4-5h5w](https://github.com/iBotPeaches/Apktool/security/advisories/GHSA-2hqv-2xv4-5h5w "GHSA-2hqv-2xv4-5h5w")

* test: sample file for [GHSA-2hqv-2xv4-5h5w](https://github.com/iBotPeaches/Apktool/security/advisories/GHSA-2hqv-2xv4-5h5w "GHSA-2hqv-2xv4-5h5w")

* refactor: avoid detection of absolute files for resource check

* chore: enable info mode on gradle

* test: skip test on windows

* chore: debug windows handling

* fix: normalize entry with file separators

* fix: normalize filepath after cleansing

* chore: Android paths are not OS specific

* refactor: use java.nio for path traversal checking

* chore: align path separator on Windows for Zip files

* chore: rework towards basic directory traversal

* chore: remove '--info' on build.yml
```

* Loading branch information

[![@iBotPeaches](https://avatars.githubusercontent.com/u/611784?s=40&v=4)](/iBotPeaches)

[iBotPeaches](/iBotPeaches/Apktool/commits?author=iBotPeaches "View all commits by iBotPeaches")
authored
Jan 2, 2024

1 parent
[e5c88ec](/iBotPeaches/Apktool/commit/e5c88ece1b7881879ed1a6f65e5f81d3cf788c4c)

commit d348c43

 Show file tree

 Hide file tree

Showing
**10 changed files**
with
**100 additions**
and
**20 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* brut.apktool/apktool-lib/src

  + main/java/brut/androlib

    - brut.apktool/apktool-lib/src/main/java/brut/androlib/ApkBuilder.java
      [ApkBuilder.java](#diff-fdfc6e92350769aa504031079e728cee1df3287085d1ad0ed62b55afb9c0dfb2)
    - res

      * brut.apktool/apktool-lib/src/main/java/brut/androlib/res/ResourcesDecoder.java
        [ResourcesDecoder.java](#diff-bc263ab616a6e1bfab6e5922280966e3d0c45ef07f1d1ad1a23834e51a3daa62)
      * decoder

        + brut.apktool/apktool-lib/src/main/java/brut/androlib/res/decoder/ResFileDecoder.java
          [ResFileDecoder.java](#diff-cd531ebe1014bfd18185bf21585ca5cdb16fbcb07703ebc47949a1b4e4e36bc3)
  + test

    - java/brut/androlib

      * decode

        + brut.apktool/apktool-lib/src/test/java/brut/androlib/decode/ResourceDirectoryTraversalTest.java
          [ResourceDirectoryTraversalTest.java](#diff-5d6a88aa51ebd15714a278efe3a7288a85c38f59f4f1dcbe1ff11b87fb76241e)
      * util

        + brut.apktool/apktool-lib/src/test/java/brut/androlib/util/UnknownDirectoryTraversalTest.java
          [UnknownDirectoryTraversalTest.java](#diff-e64fc1e6d430677caf34b754a7ca06c1210580570d037efe4500f24ce38a7a0f)
    - resources/decode/arbitrary-write

      * brut.apktool/apktool-lib/src/test/resources/decode/arbitrary-write/GHSA-2hqv-2xv4-5h5w.apk
        [GHSA-2hqv-2xv4-5h5w.apk](#diff-a65cad1312b3acdf62727c1aebe5d827c52602070ae79d2b76fdb722ad4150d2)
* brut.j.dir/src/main/java/brut/directory

  + brut.j.dir/src/main/java/brut/directory/DirUtil.java
    [DirUtil.java](#diff-83cce6e4c6756d3ca0b1040b532ccaddd4ca0fa347a23b0baea5edb411d76981)
  + brut.j.dir/src/main/java/brut/directory/FileDirectory.java
    [FileDirectory.java](#diff-32cefa3277e49751e515a063b864a577085b8ee34cae915d6768f90ca6b1e2dc)
  + brut.j.dir/src/main/java/brut/directory/ZipUtils.java
    [ZipUtils.java](#diff-9e7b947b44dd4d1b871a6868b6e538e8126569c1401ac98b28ddde44e4f25dff)
* brut.j.util/src/main/java/brut/util

  + brut.j.util/src/main/java/brut/util/BrutIO.java
    [BrutIO.java](#diff-032d3e940a07a9aeb5e7ee3687a906d8409052f69401ea5ae4f2759c9fc1d9ab)

## There are no files selected for viewing

2 changes: 1 addition & 1 deletion

2
[brut.apktool/apktool-lib/src/main/java/brut/androlib/ApkBuilder.java](#diff-fdfc6e92350769aa504031079e728cee1df3287085d1ad0ed62b55afb9c0dfb2 "brut.apktool/apktool-lib/src/main/java/brut/androlib/ApkBuilder.java")

Show comments

[View file](/iBotPeaches/Apktool/blob/d348c43b24a9de350ff6e5bd610545a10c1fc712/brut.apktool/apktool-lib/src/main/java/brut/androlib/ApkBuilder.java)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -480,7 +480,7 @@ private void copyUnknownFiles(ZipOutputStream outputFile, Map<String, String> fi |
|  |  | File inputFile; |
|  |  |  |
|  |  | try { |
|  |  | inputFile = new File(unknownFileDir, BrutIO.sanitizeUnknownFile(unknownFileDir, unknownFileInfo.getKey())); |
|  |  | inputFile = new File(unknownFileDir, BrutIO.sanitizeFilepath(unknownFileDir, unknownFileInfo.getKey())); |
|  |  | } catch (RootUnknownFileException | InvalidUnknownFileException | TraversalUnknownFileException exception) { |
|  |  | LOGGER.warning(String.format("Skipping file %s (%s)", unknownFileInfo.getKey(), exception.getMessage())); |
|  |  | continue; |
| Expand Down | |  |

10 changes: 5 additions & 5 deletions

10
[brut.apktool/apktool-lib/src/main/java/brut/androlib/res/ResourcesDecoder.java](#diff-bc263ab616a6e1bfab6e5922280966e3d0c45ef07f1d1ad1a23834e51a3daa62 "brut.apktool/apktool-lib/src/main/java/brut/androlib/res/ResourcesDecoder.java")

Show comments

[View file](/iBotPeaches/Apktool/blob/d348c43b24a9de350ff6e5bd610545a10c1fc712/brut.apktool/apktool-lib/src/main/java/brut/androlib/res/ResourcesDecoder.java)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -154,12 +154,12 @@ public void decodeResources(File outDir) throws AndrolibException { |
|  |  | decoders.setDecoder("xml", new XmlPullStreamDecoder(axmlParser, getResXmlSerializer())); |
|  |  |  |
|  |  | ResFileDecoder fileDecoder = new ResFileDecoder(decoders); |
|  |  | Directory in, out; |
|  |  | Directory in, out, outRes; |
|  |  |  |
|  |  | try { |
|  |  | out = new FileDirectory(outDir); |
|  |  | in = mApkInfo.getApkFile().getDirectory(); |
|  |  | out = out.createDir("res"); |
|  |  | outRes = out.createDir("res"); |
|  |  | } catch (DirectoryException ex) { |
|  |  | throw new AndrolibException(ex); |
|  |  | } |
| Expand All | | @@ -169,14 +169,14 @@ public void decodeResources(File outDir) throws AndrolibException { |
|  |  |  |
|  |  | LOGGER.info("Decoding file-resources..."); |
|  |  | for (ResResource res : pkg.listFiles()) { |
|  |  | fileDecoder.decode(res, in, out, mResFileMapping); |
|  |  | fileDecoder.decode(res, in, outRes, mResFileMapping); |
|  |  | } |
|  |  |  |
|  |  | LOGGER.info("Decoding values \*/\* XMLs..."); |
|  |  | for (ResValuesFile valuesFile : pkg.listValuesFiles()) { |
|  |  | generateValuesFile(valuesFile, out, xmlSerializer); |
|  |  | generateValuesFile(valuesFile, outRes, xmlSerializer); |
|  |  | } |
|  |  | generatePublicXml(pkg, out, xmlSerializer); |
|  |  | generatePublicXml(pkg, outRes, xmlSerializer); |
|  |  | } |
|  |  |  |
|  |  | AndrolibException decodeError = axmlParser.getFirstError(); |
| Expand Down | |  |

10 changes: 9 additions & 1 deletion

10
[brut.apktool/apktool-lib/src/main/java/brut/androlib/res/decoder/ResFileDecoder.java](#diff-cd531ebe1014bfd18185bf21585ca5cdb16fbcb07703ebc47949a1b4e4e36bc3 "brut.apktool/apktool-lib/src/main/java/brut/androlib/res/decoder/ResFileDecoder.java")

Show comments

[View file](/iBotPeaches/Apktool/blob/d348c43b24a9de350ff6e5bd610545a10c1fc712/brut.apktool/apktool-lib/src/main/java/brut/androlib/res/decoder/ResFileDecoder.java)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -25,6 +25,7 @@ |
|  |  | import brut.directory.DirUtil; |
|  |  | import brut.directory.Directory; |
|  |  | import brut.directory.DirectoryException; |
|  |  | import brut.util.BrutIO; |
|  |  |  |
|  |  | import java.io.\*; |
|  |  | import java.util.Map; |
| Expand All | | @@ -44,8 +45,15 @@ public void decode(ResResource res, Directory inDir, Directory outDir, Map<Strin |
|  |  | ResFileValue fileValue = (ResFileValue) res.getValue(); |
|  |  | String inFilePath = fileValue.toString(); |
|  |  | String inFileName = fileValue.getStrippedPath(); |
|  |  | String outResName = res.getFilePath(); |
|  |  | String typeName = res.getResSpec().getType().getName(); |
|  |  | String outResName = res.getFilePath(); |
|  |  |  |
|  |  | if (BrutIO.detectPossibleDirectoryTraversal(outResName)) { |
|  |  | outResName = inFileName; |
|  |  | LOGGER.warning(String.format( |
|  |  | "Potentially malicious file path: %s, using instead %s", res.getFilePath(), outResName |
|  |  | )); |
|  |  | } |
|  |  |  |
|  |  | String ext = null; |
|  |  | String outFileName; |
| Expand Down | |  |

65 changes: 65 additions & 0 deletions

65
[...pktool/apktool-lib/src/test/java/brut/androlib/decode/ResourceDirectoryTraversalTest.java](#diff-5d6a88aa51ebd15714a278efe3a7288a85c38f59f4f1dcbe1ff11b87fb76241e "brut.apktool/apktool-lib/src/test/java/brut/androlib/decode/ResourceDirectoryTraversalTest.java")

Show comments

[View file](/iBotPeaches/Apktool/blob/d348c43b24a9de350ff6e5bd610545a10c1fc712/brut.apktool/apktool-lib/src/test/java/brut/androlib/decode/ResourceDirectoryTraversalTest.java)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,65 @@ |
|  |  | /\* |
|  |  | \* Copyright (C) 2010 Ryszard Wiśniewski <brut.alll@gmail.com> |
|  |  | \* Copyright (C) 2010 Connor Tumbleson <connor.tumbleson@gmail.com> |
|  |  | \* |
|  |  | \* Licensed under the Apache License, Version 2.0 (the "License"); |
|  |  | \* you may not use this file except in compliance with the License. |
|  |  | \* You may obtain a copy of the License at |
|  |  | \* |
|  |  | \* https://www.apache.org/licenses/LICENSE-2.0 |
|  |  | \* |
|  |  | \* Unless required by applicable law or agreed to in writing, software |
|  |  | \* distributed under the License is distributed on an "AS IS" BASIS, |
|  |  | \* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. |
|  |  | \* See the License for the specific language governing permissions and |
|  |  | \* limitations under the License. |
|  |  | \*/ |
|  |  | package brut.androlib.decode; |
|  |  |  |
|  |  | import brut.androlib.ApkDecoder; |
|  |  | import brut.androlib.BaseTest; |
|  |  | import brut.androlib.Config; |
|  |  | import brut.androlib.TestUtils; |
|  |  | import brut.common.BrutException; |
|  |  | import brut.directory.ExtFile; |
|  |  | import brut.util.OS; |
|  |  | import brut.util.OSDetection; |
|  |  | import org.junit.AfterClass; |
|  |  | import org.junit.Assume; |
|  |  | import org.junit.BeforeClass; |
|  |  | import org.junit.Test; |
|  |  |  |
|  |  | import java.io.File; |
|  |  | import java.io.IOException; |
|  |  |  |
|  |  | import static org.junit.Assert.assertTrue; |
|  |  |  |
|  |  | public class ResourceDirectoryTraversalTest extends BaseTest { |
|  |  |  |
|  |  | @BeforeClass |
|  |  | public static void beforeClass() throws Exception { |
|  |  | TestUtils.cleanFrameworkFile(); |
|  |  | sTmpDir = new ExtFile(OS.createTempDirectory()); |
|  |  | TestUtils.copyResourceDir(ResourceDirectoryTraversalTest.class, "decode/arbitrary-write/", sTmpDir); |
|  |  | Assume.assumeFalse(OSDetection.isWindows()); |
|  |  | } |
|  |  |  |
|  |  | @AfterClass |
|  |  | public static void afterClass() throws BrutException { |
|  |  | OS.rmdir(sTmpDir); |
|  |  | } |
|  |  |  |
|  |  | @Test |
|  |  | public void checkIfMaliciousRawFileIsDisassembledProperly() throws BrutException, IOException { |
|  |  | String apk = "GHSA-2hqv-2xv4-5h5w.apk"; |
|  |  |  |
|  |  | Config config = Config.getDefaultConfig(); |
|  |  | config.forceDelete = true; |
|  |  | ApkDecoder apkDecoder = new ApkDecoder(config, new File(sTmpDir + File.separator + apk)); |
|  |  | File outDir = new File(sTmpDir + File.separator + apk + ".out"); |
|  |  | apkDecoder.decode(outDir); |
|  |  |  |
|  |  | File pocTestFile = new File(outDir,"res/raw/poc"); |
|  |  | assertTrue(pocTestFile.exists()); |
|  |  | } |
|  |  | } |

12 changes: 6 additions & 6 deletions

12
[brut.apktool/apktool-lib/src/test/java/brut/androlib/util/UnknownDirectoryTraversalTest.java](#diff-e64fc1e6d430677caf34b754a7ca06c1210580570d037efe4500f24ce38a7a0f "brut.apktool/apktool-lib/src/test/java/brut/androlib/util/UnknownDirectoryTraversalTest.java")

Show comments

[View file](/iBotPeaches/Apktool/blob/d348c43b24a9de350ff6e5bd610545a10c1fc712/brut.apktool/apktool-lib/src/test/java/brut/androlib/util/UnknownDirectoryTraversalTest.java)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -51,7 +51,7 @@ public static void afterClass() throws BrutException { |
|  |  |  |
|  |  | @Test |
|  |  | public void validFileTest() throws IOException, BrutException { |
|  |  | String validFilename = BrutIO.sanitizeUnknownFile(sTmpDir, "file"); |
|  |  | String validFilename = BrutIO.sanitizeFilepath(sTmpDir, "file"); |
|  |  | assertEquals(validFilename, "file"); |
|  |  |  |
|  |  | File validFile = new File(sTmpDir, validFilename); |
| Expand All | | @@ -60,18 +60,18 @@ public void validFileTest() throws IOException, BrutException { |
|  |  |  |
|  |  | @Test(expected = TraversalUnknownFileException.class) |
|  |  | public void invalidBackwardFileTest() throws IOException, BrutException { |
|  |  | BrutIO.sanitizeUnknownFile(sTmpDir, "../file"); |
|  |  | BrutIO.sanitizeFilepath(sTmpDir, "../file"); |
|  |  | } |
|  |  |  |
|  |  | @Test(expected = RootUnknownFileException.class) |
|  |  | public void invalidRootFileTest() throws IOException, BrutException { |
|  |  | String rootLocation = OSDetection.isWindows() ? "C:/" : File.separator; |
|  |  | BrutIO.sanitizeUnknownFile(sTmpDir, rootLocation + "file"); |
|  |  | BrutIO.sanitizeFilepath(sTmpDir, rootLocation + "file"); |
|  |  | } |
|  |  |  |
|  |  | @Test(expected = InvalidUnknownFileException.class) |
|  |  | public void noFilePassedTest() throws IOException, BrutException { |
|  |  | BrutIO.sanitizeUnknownFile(sTmpDir, ""); |
|  |  | BrutIO.sanitizeFilepath(sTmpDir, ""); |
|  |  | } |
|  |  |  |
|  |  | @Test(expected = TraversalUnknownFileException.class) |
| Expand All | | @@ -83,12 +83,12 @@ public void invalidBackwardPathOnWindows() throws IOException, BrutException { |
|  |  | invalidPath = "..\\..\\app.exe"; |
|  |  | } |
|  |  |  |
|  |  | BrutIO.sanitizeUnknownFile(sTmpDir, invalidPath); |
|  |  | BrutIO.sanitizeFilepath(sTmpDir, invalidPath); |
|  |  | } |
|  |  |  |
|  |  | @Test |
|  |  | public void validDirectoryFileTest() throws IOException, BrutException { |
|  |  | String validFilename = BrutIO.sanitizeUnknownFile(sTmpDir, "dir" + File.separator + "file"); |
|  |  | String validFilename = BrutIO.sanitizeFilepath(sTmpDir, "dir" + File.separator + "file"); |
|  |  | assertEquals("dir" + File.separator + "file", validFilename); |
|  |  | } |
|  |  | } |

Binary file added
BIN
+49.6 KB

[brut.apktool/apktool-lib/src/test/resources/decode/arbitrary-write/GHSA-2hqv-2xv4-5h5w.apk](#diff-a65cad1312b3acdf62727c1aebe5d827c52602070ae79d2b76fdb722ad4150d2 "brut.apktool/apktool-lib/src/test/resources/decode/arbitrary-write/GHSA-2hqv-2xv4-5h5w.apk")

Show comments

[View file](/iBotPeaches/Apktool/blob/d348c43b24a9de350ff6e5bd610545a10c1fc712/brut.apktool/apktool-lib/src/test/resources/decode/arbitrary-write/GHSA-2hqv-2xv4-5h5w.apk)
Edit file

Delete file

Binary file not shown.

2 changes: 1 addition & 1 deletion

2
[brut.j.dir/src/main/java/brut/directory/DirUtil.java](#diff-83cce6e4c6756d3ca0b1040b532ccaddd4ca0fa347a23b0baea5edb411d76981 "brut.j.dir/src/main/java/brut/directory/DirUtil.java")

Show comments

[View file](/iBotPeaches/Apktool/blob/d348c43b24a9de350ff6e5bd610545a10c1fc712/brut.j.dir/src/main/java/brut/directory/DirUtil.java)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -89,7 +89,7 @@ public static void copyToDir(Directory in, File out, String fileName) |
|  |  | } else if (!in.containsDir(fileName) && !in.containsFile(fileName)) { |
|  |  | // Skip copies of directories/files not found. |
|  |  | } else { |
|  |  | String cleanedFilename = BrutIO.sanitizeUnknownFile(out, fileName); |
|  |  | String cleanedFilename = BrutIO.sanitizeFilepath(out, fileName); |
|  |  | if (! cleanedFilename.isEmpty()) { |
|  |  | File outFile = new File(out, cleanedFilename); |
|  |  | //noinspection ResultOfMethodCallIgnored |
| Expand Down | |  |

2 changes: 1 addition & 1 deletion

2
[brut.j.dir/src/main/java/brut/directory/FileDirectory.java](#diff-32cefa3277e49751e515a063b864a577085b8ee34cae915d6768f90ca6b1e2dc "brut.j.dir/src/main/java/brut/directory/FileDirectory.java")

Show comments

[View file](/iBotPeaches/Apktool/blob/d348c43b24a9de350ff6e5bd610545a10c1fc712/brut.j.dir/src/main/java/brut/directory/FileDirectory.java)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -119,7 +119,7 @@ private void loadAll() { |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | private File getDir() { |
|  |  | public File getDir() { |
|  |  | return mDir; |
|  |  | } |
|  |  | } |

4 changes: 2 additions & 2 deletions

4
[brut.j.dir/src/main/java/brut/directory/ZipUtils.java](#diff-9e7b947b44dd4d1b871a6868b6e538e8126569c1401ac98b28ddde44e4f25dff "brut.j.dir/src/main/java/brut/directory/ZipUtils.java")

Show comments

[View file](/iBotPeaches/Apktool/blob/d348c43b24a9de350ff6e5bd610545a10c1fc712/brut.j.dir/src/main/java/brut/directory/ZipUtils.java)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -57,8 +57,8 @@ private static void processFolder(final File folder, final ZipOutputStream zipOu |
|  |  | throws BrutException, IOException { |
|  |  | for (final File file : folder.listFiles()) { |
|  |  | if (file.isFile()) { |
|  |  | final String cleanedPath = BrutIO.sanitizeUnknownFile(folder, file.getPath().substring(prefixLength)); |
|  |  | final ZipEntry zipEntry = new ZipEntry(BrutIO.normalizePath(cleanedPath)); |
|  |  | final String cleanedPath = BrutIO.sanitizeFilepath(folder, file.getPath().substring(prefixLength)); |
|  |  | final ZipEntry zipEntry = new ZipEntry(BrutIO.adaptSeparatorToUnix(cleanedPath)); |
|  |  |  |
|  |  | // aapt binary by default takes in parameters via -0 arsc to list extensions that shouldn't be |
|  |  | // compressed. We will replicate that behavior |
| Expand Down | |  |

13 changes: 10 additions & 3 deletions

13
[brut.j.util/src/main/java/brut/util/BrutIO.java](#diff-032d3e940a07a9aeb5e7ee3687a906d8409052f69401ea5ae4f2759c9fc1d9ab "brut.j.util/src/main/java/brut/util/BrutIO.java")

Show comments

[View file](/iBotPeaches/Apktool/blob/d348c43b24a9de350ff6e5bd610545a10c1fc712/brut.j.util/src/main/java/brut/util/BrutIO.java)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -74,8 +74,8 @@ public static CRC32 calculateCrc(InputStream input) throws IOException { |
|  |  | return crc; |
|  |  | } |
|  |  |  |
|  |  | public static String sanitizeUnknownFile(final File directory, final String entry) throws IOException, BrutException { |
|  |  | if (entry.length() == 0) { |
|  |  | public static String sanitizeFilepath(final File directory, final String entry) throws IOException, BrutException { |
|  |  | if (entry.isEmpty()) { |
|  |  | throw new InvalidUnknownFileException("Invalid Unknown File"); |
|  |  | } |
|  |  |  |
| Expand All | | @@ -94,7 +94,14 @@ public static String sanitizeUnknownFile(final File directory, final String entr |
|  |  | return canonicalEntryPath.substring(canonicalDirPath.length()); |
|  |  | } |
|  |  |  |
|  |  | public static String normalizePath(String path) { |
|  |  | public static boolean detectPossibleDirectoryTraversal(String entry) { |
|  |  | if (OSDetection.isWindows()) { |
|  |  | return entry.contains("..\\") || entry.contains("\\.."); |
|  |  | } |
|  |  | return entry.contains("../") || entry.contains("/.."); |
|  |  | } |
|  |  |  |
|  |  | public static String adaptSeparatorToUnix(String path) { |
|  |  | char separator = File.separatorChar; |
|  |  |  |
|  |  | if (separator != '/') { |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `d348c43`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FiBotPeaches%2FApktool%2Fcommit%2Fd348c43b24a9de350ff6e5bd610545a10c1fc712) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


