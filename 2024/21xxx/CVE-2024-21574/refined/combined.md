=== Content from github.com_dc3a2d08_20250114_220904.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fltdrdata%2FComfyUI-Manager%2Fblob%2Fffc095a3e5acc1c404773a0510e6d055a6a72b0e%2Fglob%2Fmanager_server.py)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fltdrdata%2FComfyUI-Manager%2Fblob%2Fffc095a3e5acc1c404773a0510e6d055a6a72b0e%2Fglob%2Fmanager_server.py)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=ltdrdata%2FComfyUI-Manager)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[ltdrdata](/ltdrdata)
/
**[ComfyUI-Manager](/ltdrdata/ComfyUI-Manager)**
Public

* [Notifications](/login?return_to=%2Fltdrdata%2FComfyUI-Manager) You must be signed in to change notification settings
* [Fork
  1k](/login?return_to=%2Fltdrdata%2FComfyUI-Manager)
* [Star
   7.9k](/login?return_to=%2Fltdrdata%2FComfyUI-Manager)

* [Code](/ltdrdata/ComfyUI-Manager)
* [Issues
  115](/ltdrdata/ComfyUI-Manager/issues)
* [Pull requests
  9](/ltdrdata/ComfyUI-Manager/pulls)
* [Discussions](/ltdrdata/ComfyUI-Manager/discussions)
* [Actions](/ltdrdata/ComfyUI-Manager/actions)
* [Projects
  0](/ltdrdata/ComfyUI-Manager/projects)
* [Security](/ltdrdata/ComfyUI-Manager/security)
* [Insights](/ltdrdata/ComfyUI-Manager/pulse)

Additional navigation options

* [Code](/ltdrdata/ComfyUI-Manager)
* [Issues](/ltdrdata/ComfyUI-Manager/issues)
* [Pull requests](/ltdrdata/ComfyUI-Manager/pulls)
* [Discussions](/ltdrdata/ComfyUI-Manager/discussions)
* [Actions](/ltdrdata/ComfyUI-Manager/actions)
* [Projects](/ltdrdata/ComfyUI-Manager/projects)
* [Security](/ltdrdata/ComfyUI-Manager/security)
* [Insights](/ltdrdata/ComfyUI-Manager/pulse)

## Files

 ffc095a
## Breadcrumbs

1. [ComfyUI-Manager](/ltdrdata/ComfyUI-Manager/tree/ffc095a3e5acc1c404773a0510e6d055a6a72b0e)
2. /[glob](/ltdrdata/ComfyUI-Manager/tree/ffc095a3e5acc1c404773a0510e6d055a6a72b0e/glob)
/
# manager\_server.py

Copy path Blame  Blame
## Latest commit

## History

[History](/ltdrdata/ComfyUI-Manager/commits/ffc095a3e5acc1c404773a0510e6d055a6a72b0e/glob/manager_server.py)1366 lines (994 loc) · 46.4 KB ffc095a
## Breadcrumbs

1. [ComfyUI-Manager](/ltdrdata/ComfyUI-Manager/tree/ffc095a3e5acc1c404773a0510e6d055a6a72b0e)
2. /[glob](/ltdrdata/ComfyUI-Manager/tree/ffc095a3e5acc1c404773a0510e6d055a6a72b0e/glob)
/
# manager\_server.py

Top
## File metadata and controls

* Code
* Blame

1366 lines (994 loc) · 46.4 KB[Raw](https://github.com/ltdrdata/ComfyUI-Manager/raw/ffc095a3e5acc1c404773a0510e6d055a6a72b0e/glob/manager_server.py)1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192939495969798991001011021031041051061071081091101111121131141151161171181191201211221231241251261271281291301311321331341351361371381391401411421431441451461471481491501511521531541551561571581591601611621631641651661671681691701711721731741751761771781791801811821831841851861871881891901911921931941951961971981992002012022032042052062072082092102112122132142152162172182192202212222232242252262272282292302312322332342352362372382392402412422432442452462472482492502512522532542552562572582592602612622632642652662672682692702712722732742752762772782792802812822832842852862872882892902912922932942952962972982993003013023033043053063073083093103113123133143153163173183193203213223233243253263273283293303313323333343353363373383393403413423433443453463473483493503513523533543553563573583593603613623633643653663673683693703713723733743753763773783793803813823833843853863873883893903913923933943953963973983994004014024034044054064074084094104114124134144154164174184194204214224234244254264274284294304314324334344354364374384394404414424434444454464474484494504514524534544554564574584594604614624634644654664674684694704714724734744754764774784794804814824834844854864874884894904914924934944954964974984995005015025035045055065075085095105115125135145155165175185195205215225235245255265275285295305315325335345355365375385395405415425435445455465475485495505515525535545555565575585595605615625635645655665675685695705715725735745755765775785795805815825835845855865875885895905915925935945955965975985996006016026036046056066076086096106116126136146156166176186196206216226236246256266276286296306316326336346356366376386396406416426436446456466476486496506516526536546556566576586596606616626636646656666676686696706716726736746756766776786796806816826836846856866876886896906916926936946956966976986997007017027037047057067077087097107117127137147157167177187197207217227237247257267277287297307317327337347357367377387397407417427437447457467477487497507517527537547557567577587597607617627637647657667677687697707717727737747757767777787797807817827837847857867877887897907917927937947957967977987998008018028038048058068078088098108118128138148158168178188198208218228238248258268278288298308318328338348358368378388398408418428438448458468478488498508518528538548558568578588598608618628638648658668678688698708718728738748758768778788798808818828838848858868878888898908918928938948958968978988999009019029039049059069079089099109119129139149159169179189199209219229239249259269279289299309319329339349359369379389399409419429439449459469479489499509519529539549559569579589599609619629639649659669679689699709719729739749759769779789799809819829839849859869879889899909919929939949959969979989991000import traceback
import folder\_pathsimport localeimport subprocess # don't remove thisimport concurrentimport nodesimport osimport sysimport threadingimport reimport shutilimport git
from server import PromptServerimport manager\_core as coreimport cm\_global
print(f"### Loading: ComfyUI-Manager ({core.version\_str})")
comfy\_ui\_hash = "-"
SECURITY\_MESSAGE\_MIDDLE\_OR\_BELOW = f"ERROR: To use this action, a security\_level of `middle or below` is required. Please contact the administrator.\nReference: https://github.com/ltdrdata/ComfyUI-Manager#security-policy"SECURITY\_MESSAGE\_NORMAL\_MINUS = f"ERROR: To use this feature, you must either set '--listen' to a local IP and set the security level to 'normal-' or lower, or set the security level to 'middle' or 'weak'. Please contact the administrator.\nReference: https://github.com/ltdrdata/ComfyUI-Manager#security-policy"SECURITY\_MESSAGE\_GENERAL = f"ERROR: This installation is not allowed in this security\_level. Please contact the administrator.\nReference: https://github.com/ltdrdata/ComfyUI-Manager#security-policy"
def handle\_stream(stream, prefix): stream.reconfigure(encoding=locale.getpreferredencoding(), errors='replace') for msg in stream: if prefix == '[!]' and ('it/s]' in msg or 's/it]' in msg) and ('%|' in msg or 'it [' in msg): if msg.startswith('100%'): print('\r' + msg, end="", file=sys.stderr), else: print('\r' + msg[:-1], end="", file=sys.stderr), else: if prefix == '[!]': print(prefix, msg, end="", file=sys.stderr) else: print(prefix, msg, end="")
from comfy.cli\_args import argsimport latent\_preview
is\_local\_mode = args.listen.startswith('127.') or args.listen.startswith('local.')
def is\_allowed\_security\_level(level): if level == 'block': return False elif level == 'high': if is\_local\_mode: return core.get\_config()['security\_level'].lower() in ['weak', 'normal-'] else: return core.get\_config()['security\_level'].lower() == 'weak' elif level == 'middle': return core.get\_config()['security\_level'].lower() in ['weak', 'normal', 'normal-'] else: return True
async def get\_risky\_level(files, pip\_packages): json\_data1 = await core.get\_data\_by\_mode('local', 'custom-node-list.json') json\_data2 = await core.get\_data\_by\_mode('cache', 'custom-node-list.json', channel\_url='https://github.com/ltdrdata/ComfyUI-Manager/raw/main')
 all\_urls = set() for x in json\_data1['custom\_nodes'] + json\_data2['custom\_nodes']: all\_urls.update(x['files'])
 for x in files: if x not in all\_urls: return "high"
 all\_pip\_packages = set() for x in json\_data1['custom\_nodes'] + json\_data2['custom\_nodes']: if "pip" in x: all\_pip\_packages.update(x['pip'])
 for p in pip\_packages: if p not in all\_pip\_packages: return "block"
 return "middle"
class ManagerFuncsInComfyUI(core.ManagerFuncs): def get\_current\_preview\_method(self): if args.preview\_method == latent\_preview.LatentPreviewMethod.Auto: return "auto" elif args.preview\_method == latent\_preview.LatentPreviewMethod.Latent2RGB: return "latent2rgb" elif args.preview\_method == latent\_preview.LatentPreviewMethod.TAESD: return "taesd" else: return "none"
 def run\_script(self, cmd, cwd='.'): if len(cmd) > 0 and cmd[0].startswith("#"): print(f"[ComfyUI-Manager] Unexpected behavior: `{cmd}`") return 0
 process = subprocess.Popen(cmd, cwd=cwd, stdout=subprocess.PIPE, stderr=subprocess.PIPE, text=True, bufsize=1)
 stdout\_thread = threading.Thread(target=handle\_stream, args=(process.stdout, "")) stderr\_thread = threading.Thread(target=handle\_stream, args=(process.stderr, "[!]"))
 stdout\_thread.start() stderr\_thread.start()
 stdout\_thread.join() stderr\_thread.join()
 return process.wait()
core.manager\_funcs = ManagerFuncsInComfyUI()
sys.path.append('../..')
from manager\_downloader import download\_url
core.comfy\_path = os.path.dirname(folder\_paths.\_\_file\_\_)core.js\_path = os.path.join(core.comfy\_path, "web", "extensions")
local\_db\_model = os.path.join(core.comfyui\_manager\_path, "model-list.json")local\_db\_alter = os.path.join(core.comfyui\_manager\_path, "alter-list.json")local\_db\_custom\_node\_list = os.path.join(core.comfyui\_manager\_path, "custom-node-list.json")local\_db\_extension\_node\_mappings = os.path.join(core.comfyui\_manager\_path, "extension-node-map.json")components\_path = os.path.join(core.comfyui\_manager\_path, 'components')
def set\_preview\_method(method): if method == 'auto': args.preview\_method = latent\_preview.LatentPreviewMethod.Auto elif method == 'latent2rgb': args.preview\_method = latent\_preview.LatentPreviewMethod.Latent2RGB elif method == 'taesd': args.preview\_method = latent\_preview.LatentPreviewMethod.TAESD else: args.preview\_method = latent\_preview.LatentPreviewMethod.NoPreviews
 core.get\_config()['preview\_method'] = args.preview\_method
set\_preview\_method(core.get\_config()['preview\_method'])
def set\_badge\_mode(mode): core.get\_config()['badge\_mode'] = mode
def set\_default\_ui\_mode(mode): core.get\_config()['default\_ui'] = mode
def set\_component\_policy(mode): core.get\_config()['component\_policy'] = mode
def set\_double\_click\_policy(mode): core.get\_config()['double\_click\_policy'] = mode
def print\_comfyui\_version(): global comfy\_ui\_hash
 is\_detached = False try: repo = git.Repo(os.path.dirname(folder\_paths.\_\_file\_\_)) core.comfy\_ui\_revision = len(list(repo.iter\_commits('HEAD')))
 comfy\_ui\_hash = repo.head.commit.hexsha cm\_global.variables['comfyui.revision'] = core.comfy\_ui\_revision
 core.comfy\_ui\_commit\_datetime = repo.head.commit.committed\_datetime cm\_global.variables['comfyui.commit\_datetime'] = core.comfy\_ui\_commit\_datetime
 is\_detached = repo.head.is\_detached current\_branch = repo.active\_branch.name
 try: if core.comfy\_ui\_commit\_datetime.date() < core.comfy\_ui\_required\_commit\_datetime.date(): print(f"\n\n## [WARN] ComfyUI-Manager: Your ComfyUI version ({core.comfy\_ui\_revision})[{core.comfy\_ui\_commit\_datetime.date()}] is too old. Please update to the latest version. ##\n\n") except: pass
 # process on\_revision\_detected --> if 'cm.on\_revision\_detected\_handler' in cm\_global.variables: for k, f in cm\_global.variables['cm.on\_revision\_detected\_handler']: try: f(core.comfy\_ui\_revision) except Exception: print(f"[ERROR] '{k}' on\_revision\_detected\_handler") traceback.print\_exc()
 del cm\_global.variables['cm.on\_revision\_detected\_handler'] else: print(f"[ComfyUI-Manager] Some features are restricted due to your ComfyUI being outdated.") # <--
 if current\_branch == "master": print(f"### ComfyUI Revision: {core.comfy\_ui\_revision} [{comfy\_ui\_hash[:8]}] | Released on '{core.comfy\_ui\_commit\_datetime.date()}'") else: print(f"### ComfyUI Revision: {core.comfy\_ui\_revision} on '{current\_branch}' [{comfy\_ui\_hash[:8]}] | Released on '{core.comfy\_ui\_commit\_datetime.date()}'") except: if is\_detached: print(f"### ComfyUI Revision: {core.comfy\_ui\_revision} [{comfy\_ui\_hash[:8]}] \*DETACHED | Released on '{core.comfy\_ui\_commit\_datetime.date()}'") else: print("### ComfyUI Revision: UNKNOWN (The currently installed ComfyUI is not a Git repository)")
print\_comfyui\_version()
async def populate\_github\_stats(json\_obj, json\_obj\_github): if 'custom\_nodes' in json\_obj: for i, node in enumerate(json\_obj['custom\_nodes']): url = node['reference'] if url in json\_obj\_github: json\_obj['custom\_nodes'][i]['stars'] = json\_obj\_github[url]['stars'] json\_obj['custom\_nodes'][i]['last\_update'] = json\_obj\_github[url]['last\_update'] json\_obj['custom\_nodes'][i]['trust'] = json\_obj\_github[url]['author\_account\_age\_days'] > 180 else: json\_obj['custom\_nodes'][i]['stars'] = -1 json\_obj['custom\_nodes'][i]['last\_update'] = -1 json\_obj['custom\_nodes'][i]['trust'] = False return json\_obj
def setup\_environment(): git\_exe = core.get\_config()['git\_exe']
 if git\_exe != '': git.Git().update\_environment(GIT\_PYTHON\_GIT\_EXECUTABLE=git\_exe)
setup\_environment()
# Expand Server api
import serverfrom aiohttp import webimport aiohttpimport jsonimport zipfileimport urllib.request
def get\_model\_dir(data): if data['save\_path'] != 'default': if '..' in data['save\_path'] or data['save\_path'].startswith('/'): print(f"[WARN] '{data['save\_path']}' is not allowed path. So it will be saved into 'models/etc'.") base\_model = os.path.join(folder\_paths.models\_dir, "etc") else: if data['save\_path'].startswith("custom\_nodes"): base\_model = os.path.join(core.comfy\_path, data['save\_path']) else: base\_model = os.path.join(folder\_paths.models\_dir, data['save\_path']) else: model\_type = data['type'] if model\_type == "checkpoints" or model\_type == "checkpoint": base\_model = folder\_paths.folder\_names\_and\_paths["checkpoints"][0][0] elif model\_type == "unclip": base\_model = folder\_paths.folder\_names\_and\_paths["checkpoints"][0][0] elif model\_type == "clip": base\_model = folder\_paths.folder\_names\_and\_paths["clip"][0][0] elif model\_type == "VAE": base\_model = folder\_paths.folder\_names\_and\_paths["vae"][0][0] elif model\_type == "lora": base\_model = folder\_paths.folder\_names\_and\_paths["loras"][0][0] elif model\_type == "T2I-Adapter": base\_model = folder\_paths.folder\_names\_and\_paths["controlnet"][0][0] elif model\_type == "T2I-Style": base\_model = folder\_paths.folder\_names\_and\_paths["controlnet"][0][0] elif model\_type == "controlnet": base\_model = folder\_paths.folder\_names\_and\_paths["controlnet"][0][0] elif model\_type == "clip\_vision": base\_model = folder\_paths.folder\_names\_and\_paths["clip\_vision"][0][0] elif model\_type == "gligen": base\_model = folder\_paths.folder\_names\_and\_paths["gligen"][0][0] elif model\_type == "upscale": base\_model = folder\_paths.folder\_names\_and\_paths["upscale\_models"][0][0] elif model\_type == "embeddings": base\_model = folder\_paths.folder\_names\_and\_paths["embeddings"][0][0] elif model\_type == "unet" or model\_type == "diffusion\_model": if folder\_paths.folder\_names\_and\_paths.get("diffusion\_models"): base\_model = folder\_paths.folder\_names\_and\_paths["diffusion\_models"][0][1] else: print(f"[ComfyUI-Manager] Your ComfyUI is outdated version.") base\_model = folder\_paths.folder\_names\_and\_paths["unet"][0][0] # outdated version else: base\_model = os.path.join(folder\_paths.models\_dir, "etc")
 return base\_model
def get\_model\_path(data): base\_model = get\_model\_dir(data) return os.path.join(base\_model, data['filename'])
def check\_custom\_nodes\_installed(json\_obj, do\_fetch=False, do\_update\_check=True, do\_update=False): if do\_fetch: print("Start fetching...", end="") elif do\_update: print("Start updating...", end="") elif do\_update\_check: print("Start update check...", end="")
 def process\_custom\_node(item): core.check\_a\_custom\_node\_installed(item, do\_fetch, do\_update\_check, do\_update)
 with concurrent.futures.ThreadPoolExecutor(4) as executor: for item in json\_obj['custom\_nodes']: executor.submit(process\_custom\_node, item)
 if do\_fetch: print(f"\x1b[2K\rFetching done.") elif do\_update: update\_exists = any(item['installed'] == 'Update' for item in json\_obj['custom\_nodes']) if update\_exists: print(f"\x1b[2K\rUpdate done.") else: print(f"\x1b[2K\rAll extensions are already up-to-date.") elif do\_update\_check: print(f"\x1b[2K\rUpdate check done.")
def nickname\_filter(json\_obj): preemptions\_map = {}
 for k, x in json\_obj.items(): if 'preemptions' in x[1]: for y in x[1]['preemptions']: preemptions\_map[y] = k elif k.endswith("/ComfyUI"): for y in x[0]: preemptions\_map[y] = k
 updates = {} for k, x in json\_obj.items(): removes = set() for y in x[0]: k2 = preemptions\_map.get(y) if k2 is not None and k != k2: removes.add(y)
 if len(removes) > 0: updates[k] = [y for y in x[0] if y not in removes]
 for k, v in updates.items(): json\_obj[k][0] = v
 return json\_obj
@PromptServer.instance.routes.get("/customnode/getmappings")async def fetch\_customnode\_mappings(request): mode = request.rel\_url.query["mode"]
 nickname\_mode = False if mode == "nickname": mode = "local" nickname\_mode = True
 json\_obj = await core.get\_data\_by\_mode(mode, 'extension-node-map.json')
 if nickname\_mode: json\_obj = nickname\_filter(json\_obj)
 all\_nodes = set() patterns = [] for k, x in json\_obj.items(): all\_nodes.update(set(x[0]))
 if 'nodename\_pattern' in x[1]: patterns.append((x[1]['nodename\_pattern'], x[0]))
 missing\_nodes = set(nodes.NODE\_CLASS\_MAPPINGS.keys()) - all\_nodes
 for x in missing\_nodes: for pat, item in patterns: if re.match(pat, x): item.append(x)
 return web.json\_response(json\_obj, content\_type='application/json')
@PromptServer.instance.routes.get("/customnode/fetch\_updates")async def fetch\_updates(request): try: json\_obj = await core.get\_data\_by\_mode(request.rel\_url.query["mode"], 'custom-node-list.json')
 check\_custom\_nodes\_installed(json\_obj, True)
 update\_exists = any('custom\_nodes' in json\_obj and 'installed' in node and node['installed'] == 'Update' for node in json\_obj['custom\_nodes'])
 if update\_exists: return web.Response(status=201)
 return web.Response(status=200) except: return web.Response(status=400)
@PromptServer.instance.routes.get("/customnode/update\_all")async def update\_all(request): if not is\_allowed\_security\_level('middle'): print(SECURITY\_MESSAGE\_MIDDLE\_OR\_BELOW) return web.Response(status=403)
 try: core.save\_snapshot\_with\_postfix('autosave')
 json\_obj = await core.get\_data\_by\_mode(request.rel\_url.query["mode"], 'custom-node-list.json')
 check\_custom\_nodes\_installed(json\_obj, do\_update=True)
 updated = [item['title'] for item in json\_obj['custom\_nodes'] if item['installed'] == 'Update'] failed = [item['title'] for item in json\_obj['custom\_nodes'] if item['installed'] == 'Fail']
 res = {'updated': updated, 'failed': failed}
 if len(updated) == 0 and len(failed) == 0: status = 200 else: status = 201
 return web.json\_response(res, status=status, content\_type='application/json') except: return web.Response(status=400) finally: core.clear\_pip\_cache()
def convert\_markdown\_to\_html(input\_text): pattern\_a = re.compile(r'\[a/([^]]+)\]\(([^)]+)\)') pattern\_w = re.compile(r'\[w/([^]]+)\]') pattern\_i = re.compile(r'\[i/([^]]+)\]') pattern\_bold = re.compile(r'\\*\\*([^\*]+)\\*\\*') pattern\_white = re.compile(r'%%([^\*]+)%%')
 def replace\_a(match): return f"<a href='{match.group(2)}' target='blank'>{match.group(1)}</a>"
 def replace\_w(match): return f"<p class='cm-warn-note'>{match.group(1)}</p>"
 def replace\_i(match): return f"<p class='cm-info-note'>{match.group(1)}</p>"
 def replace\_bold(match): return f"<B>{match.group(1)}</B>"
 def replace\_white(match): return f"<font color='white'>{match.group(1)}</font>"
 input\_text = input\_text.replace('\\[', '&#91;').replace('\\]', '&#93;').replace('<', '&lt;').replace('>', '&gt;')
 result\_text = re.sub(pattern\_a, replace\_a, input\_text) result\_text = re.sub(pattern\_w, replace\_w, result\_text) result\_text = re.sub(pattern\_i, replace\_i, result\_text) result\_text = re.sub(pattern\_bold, replace\_bold, result\_text) result\_text = re.sub(pattern\_white, replace\_white, result\_text)
 return result\_text.replace("\n", "<BR>")
def populate\_markdown(x): if 'description' in x: x['description'] = convert\_markdown\_to\_html(x['description'])
 if 'name' in x: x['name'] = x['name'].replace('<', '&lt;').replace('>', '&gt;')
 if 'title' in x: x['title'] = x['title'].replace('<', '&lt;').replace('>', '&gt;')
@PromptServer.instance.routes.get("/customnode/getlist")async def fetch\_customnode\_list(request): if "skip\_update" in request.rel\_url.query and request.rel\_url.query["skip\_update"] == "true": skip\_update = True else: skip\_update = False
 if request.rel\_url.query["mode"] == "local": channel = 'local' else: channel = core.get\_config()['channel\_url']
 json\_obj = await core.get\_data\_by\_mode(request.rel\_url.query["mode"], 'custom-node-list.json') json\_obj\_github = await core.get\_data\_by\_mode(request.rel\_url.query["mode"], 'github-stats.json', 'default') json\_obj = await populate\_github\_stats(json\_obj, json\_obj\_github)
 def is\_ignored\_notice(code): if code is not None and code.startswith('#NOTICE\_'): try: notice\_version = [int(x) for x in code[8:].split('.')] return notice\_version[0] < core.version[0] or (notice\_version[0] == core.version[0] and notice\_version[1] <= core.version[1]) except Exception: return False else: return False
 json\_obj['custom\_nodes'] = [record for record in json\_obj['custom\_nodes'] if not is\_ignored\_notice(record.get('author'))]
 check\_custom\_nodes\_installed(json\_obj, False, not skip\_update)
 for x in json\_obj['custom\_nodes']: populate\_markdown(x)
 if channel != 'local': found = 'custom'
 for name, url in core.get\_channel\_dict().items(): if url == channel: found = name break
 channel = found
 json\_obj['channel'] = channel
 return web.json\_response(json\_obj, content\_type='application/json')
@PromptServer.instance.routes.get("/customnode/alternatives")async def fetch\_customnode\_alternatives(request): alter\_json = await core.get\_data\_by\_mode(request.rel\_url.query["mode"], 'alter-list.json')
 for item in alter\_json['items']: populate\_markdown(item)  return web.json\_response(alter\_json, content\_type='application/json')
@PromptServer.instance.routes.get("/alternatives/getlist")async def fetch\_alternatives\_list(request): if "skip\_update" in request.rel\_url.query and request.rel\_url.query["skip\_update"] == "true": skip\_update = True else: skip\_update = False
 alter\_json = await core.get\_data\_by\_mode(request.rel\_url.query["mode"], 'alter-list.json') custom\_node\_json = await core.get\_data\_by\_mode(request.rel\_url.query["mode"], 'custom-node-list.json')
 fileurl\_to\_custom\_node = {}
 for item in custom\_node\_json['custom\_nodes']: for fileurl in item['files']: fileurl\_to\_custom\_node[fileurl] = item
 for item in alter\_json['items']: fileurl = item['id'] if fileurl in fileurl\_to\_custom\_node: custom\_node = fileurl\_to\_custom\_node[fileurl] core.check\_a\_custom\_node\_installed(custom\_node, not skip\_update)
 populate\_markdown(item) populate\_markdown(custom\_node) item['custom\_node'] = custom\_node
 return web.json\_response(alter\_json, content\_type='application/json')
def check\_model\_installed(json\_obj): def process\_model(item): model\_path = get\_model\_path(item) item['installed'] = 'None'
 if model\_path is not None: if model\_path.endswith('.zip'): if os.path.exists(model\_path[:-4]): item['installed'] = 'True' else: item['installed'] = 'False' elif os.path.exists(model\_path): item['installed'] = 'True' else: item['installed'] = 'False'
 with concurrent.futures.ThreadPoolExecutor(8) as executor: for item in json\_obj['models']: executor.submit(process\_model, item)
@PromptServer.instance.routes.get("/externalmodel/getlist")async def fetch\_externalmodel\_list(request): json\_obj = await core.get\_data\_by\_mode(request.rel\_url.query["mode"], 'model-list.json')
 check\_model\_installed(json\_obj)
 for x in json\_obj['models']: populate\_markdown(x)
 return web.json\_response(json\_obj, content\_type='application/json')
@PromptServer.instance.routes.get("/snapshot/getlist")async def get\_snapshot\_list(request): snapshots\_directory = os.path.join(core.comfyui\_manager\_path, 'snapshots') items = [f[:-5] for f in os.listdir(snapshots\_directory) if f.endswith('.json')] items.sort(reverse=True) return web.json\_response({'items': items}, content\_type='application/json')
@PromptServer.instance.routes.get("/snapshot/remove")async def remove\_snapshot(request): if not is\_allowed\_security\_level('middle'): print(SECURITY\_MESSAGE\_MIDDLE\_OR\_BELOW) return web.Response(status=403)  try: target = request.rel\_url.query["target"]
 path = os.path.join(core.comfyui\_manager\_path, 'snapshots', f"{target}.json") if os.path.exists(path): os.remove(path)
 return web.Response(status=200) except: return web.Response(status=400)
@PromptServer.instance.routes.get("/snapshot/restore")async def remove\_snapshot(request): if not is\_allowed\_security\_level('middle'): print(SECURITY\_MESSAGE\_MIDDLE\_OR\_BELOW) return web.Response(status=403)  try: target = request.rel\_url.query["target"]
 path = os.path.join(core.comfyui\_manager\_path, 'snapshots', f"{target}.json") if os.path.exists(path): if not os.path.exists(core.startup\_script\_path): os.makedirs(core.startup\_script\_path)
 target\_path = os.path.join(core.startup\_script\_path, "restore-snapshot.json") shutil.copy(path, target\_path)
 print(f"Snapshot restore scheduled: `{target}`") return web.Response(status=200)
 print(f"Snapshot file not found: `{path}`") return web.Response(status=400) except: return web.Response(status=400)
@PromptServer.instance.routes.get("/snapshot/get\_current")async def get\_current\_snapshot\_api(request): try: return web.json\_response(core.get\_current\_snapshot(), content\_type='application/json') except: return web.Response(status=400)
@PromptServer.instance.routes.get("/snapshot/save")async def save\_snapshot(request): try: core.save\_snapshot\_with\_postfix('snapshot') return web.Response(status=200) except: return web.Response(status=400)
def unzip\_install(files): temp\_filename = 'manager-temp.zip' for url in files: if url.endswith("/"): url = url[:-1] try: headers = { 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/58.0.3029.110 Safari/537.3'}
 req = urllib.request.Request(url, headers=headers) response = urllib.request.urlopen(req) data = response.read()
 with open(temp\_filename, 'wb') as f: f.write(data)
 with zipfile.ZipFile(temp\_filename, 'r') as zip\_ref: zip\_ref.extractall(core.custom\_nodes\_path)
 os.remove(temp\_filename) except Exception as e: print(f"Install(unzip) error: {url} / {e}", file=sys.stderr) return False
 print("Installation was successful.") return True
def download\_url\_with\_agent(url, save\_path): try: headers = { 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/58.0.3029.110 Safari/537.3'}
 req = urllib.request.Request(url, headers=headers) response = urllib.request.urlopen(req) data = response.read()
 if not os.path.exists(os.path.dirname(save\_path)): os.makedirs(os.path.dirname(save\_path))
 with open(save\_path, 'wb') as f: f.write(data)
 except Exception as e: print(f"Download error: {url} / {e}", file=sys.stderr) return False
 print("Installation was successful.") return True
def copy\_install(files, js\_path\_name=None): for url in files: if url.endswith("/"): url = url[:-1] try: filename = os.path.basename(url) if url.endswith(".py"): download\_url(url, core.custom\_nodes\_path, filename) else: path = os.path.join(core.js\_path, js\_path\_name) if js\_path\_name is not None else core.js\_path if not os.path.exists(path): os.makedirs(path) download\_url(url, path, filename)
 except Exception as e: print(f"Install(copy) error: {url} / {e}", file=sys.stderr) return False
 print("Installation was successful.") return True
def copy\_uninstall(files, js\_path\_name='.'): for url in files: if url.endswith("/"): url = url[:-1] dir\_name = os.path.basename(url) base\_path = core.custom\_nodes\_path if url.endswith('.py') else os.path.join(core.js\_path, js\_path\_name) file\_path = os.path.join(base\_path, dir\_name)
 try: if os.path.exists(file\_path): os.remove(file\_path) elif os.path.exists(file\_path + ".disabled"): os.remove(file\_path + ".disabled") except Exception as e: print(f"Uninstall(copy) error: {url} / {e}", file=sys.stderr) return False
 print("Uninstallation was successful.") return True
def copy\_set\_active(files, is\_disable, js\_path\_name='.'): if is\_disable: action\_name = "Disable" else: action\_name = "Enable"
 for url in files: if url.endswith("/"): url = url[:-1] dir\_name = os.path.basename(url) base\_path = core.custom\_nodes\_path if url.endswith('.py') else os.path.join(core.js\_path, js\_path\_name) file\_path = os.path.join(base\_path, dir\_name)
 try: if is\_disable: current\_name = file\_path new\_name = file\_path + ".disabled" else: current\_name = file\_path + ".disabled" new\_name = file\_path
 os.rename(current\_name, new\_name)
 except Exception as e: print(f"{action\_name}(copy) error: {url} / {e}", file=sys.stderr)
 return False
 print(f"{action\_name} was successful.") return True
@PromptServer.instance.routes.post("/customnode/install")async def install\_custom\_node(request): if not is\_allowed\_security\_level('middle'): print(SECURITY\_MESSAGE\_MIDDLE\_OR\_BELOW) return web.Response(status=403)
 json\_data = await request.json()
 risky\_level = await get\_risky\_level(json\_data['files'], json\_data.get('pip', [])) if not is\_allowed\_security\_level(risky\_level): print(SECURITY\_MESSAGE\_GENERAL) return web.Response(status=404)
 install\_type = json\_data['install\_type']
 print(f"Install custom node '{json\_data['title']}'")
 res = False
 if len(json\_data['files']) == 0: return web.Response(status=400)
 if install\_type == "unzip": res = unzip\_install(json\_data['files'])
 if install\_type == "copy": js\_path\_name = json\_data['js\_path'] if 'js\_path' in json\_data else '.' res = copy\_install(json\_data['files'], js\_path\_name)
 elif install\_type == "git-clone": res = core.gitclone\_install(json\_data['files'])
 if 'pip' in json\_data: for pname in json\_data['pip']: pkg = core.remap\_pip\_package(pname) install\_cmd = [sys.executable, "-m", "pip", "install", pkg] core.try\_install\_script(json\_data['files'][0], ".", install\_cmd)
 core.clear\_pip\_cache()
 if res: print(f"After restarting ComfyUI, please refresh the browser.") return web.json\_response({}, content\_type='application/json')
 return web.Response(status=400)
@PromptServer.instance.routes.post("/customnode/fix")async def fix\_custom\_node(request): if not is\_allowed\_security\_level('middle'): print(SECURITY\_MESSAGE\_MIDDLE\_OR\_BELOW) return web.Response(status=403)
 json\_data = await request.json()
 install\_type = json\_data['install\_type']
 print(f"Install custom node '{json\_data['title']}'")
 res = False
 if len(json\_data['files']) == 0: return web.Response(status=400)
 if install\_type == "git-clone": res = core.gitclone\_fix(json\_data['files']) else: return web.Response(status=400)
 if 'pip' in json\_data: for pname in json\_data['pip']: install\_cmd = [sys.executable, "-m", "pip", "install", '-U', pname] core.try\_install\_script(json\_data['files'][0], ".", install\_cmd)
 # HOTFIX: force downgrade to numpy<2 install\_cmd = [sys.executable, "-m", "pip", "install", "numpy<2"] core.try\_install\_script(json\_data['files'][0], ".", install\_cmd)
 if res: print(f"After restarting ComfyUI, please refresh the browser.") return web.json\_response({}, content\_type='application/json')
 return web.Response(status=400)
@PromptServer.instance.routes.post("/customnode/install/git\_url")async def install\_custom\_node\_git\_url(request): if not is\_allowed\_security\_level('high'): print(SECURITY\_MESSAGE\_NORMAL\_MINUS) return web.Response(status=403)
 url = await request.text() res = core.gitclone\_install([url])
 if res: print(f"After restarting ComfyUI, please refresh the browser.") return web.Response(status=200)
 return web.Response(status=400)
@PromptServer.instance.routes.post("/customnode/install/pip")async def install\_custom\_node\_git\_url(request): if not is\_allowed\_security\_level('high'): print(SECURITY\_MESSAGE\_NORMAL\_MINUS) return web.Response(status=403)
 packages = await request.text() core.pip\_install(packages.split(' '))
 return web.Response(status=200)
@PromptServer.instance.routes.post("/customnode/uninstall")async def uninstall\_custom\_node(request): if not is\_allowed\_security\_level('middle'): print(SECURITY\_MESSAGE\_MIDDLE\_OR\_BELOW) return web.Response(status=403)
 json\_data = await request.json()
 install\_type = json\_data['install\_type']
 print(f"Uninstall custom node '{json\_data['title']}'")
 res = False
 if install\_type == "copy": js\_path\_name = json\_data['js\_path'] if 'js\_path' in json\_data else '.' res = copy\_uninstall(json\_data['files'], js\_path\_name)
 elif install\_type == "git-clone": res = core.gitclone\_uninstall(json\_data['files'])
 if res: print(f"After restarting ComfyUI, please refresh the browser.") return web.json\_response({}, content\_type='application/json')
 return web.Response(status=400)
@PromptServer.instance.routes.post("/customnode/update")async def update\_custom\_node(request): if not is\_allowed\_security\_level('middle'): print(SECURITY\_MESSAGE\_MIDDLE\_OR\_BELOW) return web.Response(status=403)
 json\_data = await request.json()
 install\_type = json\_data['install\_type']
 print(f"Update custom node '{json\_data['title']}'")
 res = False
 if install\_type == "git-clone": res = core.gitclone\_update(json\_data['files'])
 core.clear\_pip\_cache()
 if res: print(f"After restarting ComfyUI, please refresh the browser.") return web.json\_response({}, content\_type='application/json')
 return web.Response(status=400)
@PromptServer.instance.routes.get("/comfyui\_manager/update\_comfyui")async def update\_comfyui(request): print(f"Update ComfyUI")
 try: repo\_path = os.path.dirname(folder\_paths.\_\_file\_\_) res = core.update\_path(repo\_path) if res == "fail": print(f"ComfyUI update fail: The installed ComfyUI does not have a Git repository.") return web.Response(status=400) elif res == "updated": return web.Response(status=201) else: # skipped return web.Response(status=200) except Exception as e: print(f"ComfyUI update fail: {e}", file=sys.stderr)
 return web.Response(status=400)
@PromptServer.instance.routes.post("/customnode/toggle\_active")async def toggle\_active(request): json\_data = await request.json()
 install\_type = json\_data['install\_type'] is\_disabled = json\_data['installed'] == "Disabled"
 print(f"Update custom node '{json\_data['title']}'")
 res = False
 if install\_type == "git-clone": res = core.gitclone\_set\_active(json\_data['files'], not is\_disabled) elif install\_type == "copy": res = copy\_set\_active(json\_data['files'], not is\_disabled, json\_data.get('js\_path', None))
 if res:[View remainder of file in raw view](https://github.com/ltdrdata/ComfyUI-Manager/raw/ffc095a3e5acc1c404773a0510e6d055a6a72b0e/glob/manager_server.py)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_a314b223_20250114_220906.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fltdrdata%2FComfyUI-Manager%2Fcommit%2Fffc095a3e5acc1c404773a0510e6d055a6a72b0e)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fltdrdata%2FComfyUI-Manager%2Fcommit%2Fffc095a3e5acc1c404773a0510e6d055a6a72b0e)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=ltdrdata%2FComfyUI-Manager)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[ltdrdata](/ltdrdata)
/
**[ComfyUI-Manager](/ltdrdata/ComfyUI-Manager)**
Public

* [Notifications](/login?return_to=%2Fltdrdata%2FComfyUI-Manager) You must be signed in to change notification settings
* [Fork
  1k](/login?return_to=%2Fltdrdata%2FComfyUI-Manager)
* [Star
   7.9k](/login?return_to=%2Fltdrdata%2FComfyUI-Manager)

* [Code](/ltdrdata/ComfyUI-Manager)
* [Issues
  115](/ltdrdata/ComfyUI-Manager/issues)
* [Pull requests
  9](/ltdrdata/ComfyUI-Manager/pulls)
* [Discussions](/ltdrdata/ComfyUI-Manager/discussions)
* [Actions](/ltdrdata/ComfyUI-Manager/actions)
* [Projects
  0](/ltdrdata/ComfyUI-Manager/projects)
* [Security](/ltdrdata/ComfyUI-Manager/security)
* [Insights](/ltdrdata/ComfyUI-Manager/pulse)

Additional navigation options

* [Code](/ltdrdata/ComfyUI-Manager)
* [Issues](/ltdrdata/ComfyUI-Manager/issues)
* [Pull requests](/ltdrdata/ComfyUI-Manager/pulls)
* [Discussions](/ltdrdata/ComfyUI-Manager/discussions)
* [Actions](/ltdrdata/ComfyUI-Manager/actions)
* [Projects](/ltdrdata/ComfyUI-Manager/projects)
* [Security](/ltdrdata/ComfyUI-Manager/security)
* [Insights](/ltdrdata/ComfyUI-Manager/pulse)

## Commit

[Permalink](/ltdrdata/ComfyUI-Manager/commit/ffc095a3e5acc1c404773a0510e6d055a6a72b0e)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

robust validation

[Browse files](/ltdrdata/ComfyUI-Manager/tree/ffc095a3e5acc1c404773a0510e6d055a6a72b0e)
Browse the repository at this point in the history

* Loading branch information

[![@ltdrdata](https://avatars.githubusercontent.com/u/128333288?s=40&v=4)](/ltdrdata)

[ltdrdata](/ltdrdata/ComfyUI-Manager/commits?author=ltdrdata "View all commits by ltdrdata")
committed
Sep 23, 2024

1 parent
[8db932a](/ltdrdata/ComfyUI-Manager/commit/8db932afd9c508fde14a7a721720d13f8a5c0680)

commit ffc095a

 Show file tree

 Hide file tree

Showing
**3 changed files**
with
**16 additions**
and
**5 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* glob

  + glob/manager\_core.py
    [manager\_core.py](#diff-072d070db24c8b304f2499fd9fd83954a35723cbf60fbcf82436837cca42255e)
  + glob/manager\_server.py
    [manager\_server.py](#diff-bfe7e5707ce15e6d90d0ff6ea0a98a778d21916c8d4e476b2d807945403ec027)
* pyproject.toml
  [pyproject.toml](#diff-50c86b7ed8ac2cf95bd48334961bf0530cdc77b5a56f852c5c61b89d735fd711)

## There are no files selected for viewing

2 changes: 1 addition & 1 deletion

2
[glob/manager\_core.py](#diff-072d070db24c8b304f2499fd9fd83954a35723cbf60fbcf82436837cca42255e "glob/manager_core.py")

Show comments

[View file](/ltdrdata/ComfyUI-Manager/blob/ffc095a3e5acc1c404773a0510e6d055a6a72b0e/glob/manager_core.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -23,7 +23,7 @@ |
|  |  | import cm\_global |
|  |  | from manager\_util import \* |
|  |  |  |
|  |  | version = [2, 51] |
|  |  | version = [2, 51, 1] |
|  |  | version\_str = f"V{version[0]}.{version[1]}" + (f'.{version[2]}' if len(version) > 2 else '') |
|  |  |  |
|  |  |  |
| Expand Down | |  |

17 changes: 14 additions & 3 deletions

17
[glob/manager\_server.py](#diff-bfe7e5707ce15e6d90d0ff6ea0a98a778d21916c8d4e476b2d807945403ec027 "glob/manager_server.py")

Show comments

[View file](/ltdrdata/ComfyUI-Manager/blob/ffc095a3e5acc1c404773a0510e6d055a6a72b0e/glob/manager_server.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -47,7 +47,9 @@ def handle\_stream(stream, prefix): |
|  |  |  |
|  |  |  |
|  |  | def is\_allowed\_security\_level(level): |
|  |  | if level == 'high': |
|  |  | if level == 'block': |
|  |  | return False |
|  |  | elif level == 'high': |
|  |  | if is\_local\_mode: |
|  |  | return core.get\_config()['security\_level'].lower() in ['weak', 'normal-'] |
|  |  | else: |
| Expand All | | @@ -58,7 +60,7 @@ def is\_allowed\_security\_level(level): |
|  |  | return True |
|  |  |  |
|  |  |  |
|  |  | async def get\_risky\_level(files): |
|  |  | async def get\_risky\_level(files, pip\_packages): |
|  |  | json\_data1 = await core.get\_data\_by\_mode('local', 'custom-node-list.json') |
|  |  | json\_data2 = await core.get\_data\_by\_mode('cache', 'custom-node-list.json', channel\_url='https://github.com/ltdrdata/ComfyUI-Manager/raw/main') |
|  |  |  |
| Expand All | | @@ -70,6 +72,15 @@ async def get\_risky\_level(files): |
|  |  | if x not in all\_urls: |
|  |  | return "high" |
|  |  |  |
|  |  | all\_pip\_packages = set() |
|  |  | for x in json\_data1['custom\_nodes'] + json\_data2['custom\_nodes']: |
|  |  | if "pip" in x: |
|  |  | all\_pip\_packages.update(x['pip']) |
|  |  |  |
|  |  | for p in pip\_packages: |
|  |  | if p not in all\_pip\_packages: |
|  |  | return "block" |
|  |  |  |
|  |  | return "middle" |
|  |  |  |
|  |  |  |
| Expand Down  Expand Up | | @@ -791,7 +802,7 @@ async def install\_custom\_node(request): |
|  |  |  |
|  |  | json\_data = await request.json() |
|  |  |  |
|  |  | risky\_level = await get\_risky\_level(json\_data['files']) |
|  |  | risky\_level = await get\_risky\_level(json\_data['files'], json\_data.get('pip', [])) |
|  |  | if not is\_allowed\_security\_level(risky\_level): |
|  |  | print(SECURITY\_MESSAGE\_GENERAL) |
|  |  | return web.Response(status=404) |
| Expand Down | |  |

2 changes: 1 addition & 1 deletion

2
[pyproject.toml](#diff-50c86b7ed8ac2cf95bd48334961bf0530cdc77b5a56f852c5c61b89d735fd711 "pyproject.toml")

Show comments

[View file](/ltdrdata/ComfyUI-Manager/blob/ffc095a3e5acc1c404773a0510e6d055a6a72b0e/pyproject.toml)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -1,7 +1,7 @@ |
|  |  | [project] |
|  |  | name = "comfyui-manager" |
|  |  | description = "ComfyUI-Manager provides features to install and manage custom nodes for ComfyUI, as well as various functionalities to assist with ComfyUI." |
|  |  | version = "2.51" |
|  |  | version = "2.51.1" |
|  |  | license = { file = "LICENSE.txt" } |
|  |  | dependencies = ["GitPython", "PyGithub", "matrix-client==0.4.0", "transformers", "huggingface-hub>0.20", "typer", "rich", "typing-extensions"] |
|  |  |  |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `ffc095a`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fltdrdata%2FComfyUI-Manager%2Fcommit%2Fffc095a3e5acc1c404773a0510e6d055a6a72b0e) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


