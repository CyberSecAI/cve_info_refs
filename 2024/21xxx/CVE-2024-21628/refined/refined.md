Based on the provided content, here's an analysis of CVE-2024-21628:

**Root Cause of Vulnerability:**
- The vulnerability stems from the lack of proper sanitization of user-provided input in the "add a message form" on the order detail page in the front office (FO) of PrestaShop. Specifically, the `isCleanHtml` method was not being used to sanitize the message content before storing it in the database.

**Weaknesses/Vulnerabilities Present:**
- **Cross-Site Scripting (XSS):** The primary vulnerability is a stored XSS. Malicious HTML code can be injected into the message field and stored in the database without proper sanitization.

**Impact of Exploitation:**
- **Front Office XSS:** The injected XSS payload is executed when the message is displayed in the front office. This impacts only the customer who sent the message or the customer session from which it was sent.
- **Potential for Wider Impact:** The advisory warns that if a module fetches these messages from the database and displays them without escaping the HTML, it could lead to a broader XSS vulnerability affecting other users.
- **Limited Back Office Impact:** The HTML is not interpreted in the back office due to Twig's escape mechanism.

**Attack Vectors:**
- The attack vector is a network-based attack.
- The attacker utilizes the "add a message form" on the order detail page in the FO to inject malicious HTML code into the message field.

**Required Attacker Capabilities/Position:**
- The attacker needs to be a customer with low privileges and the ability to access the "add a message form" in the front office.
- The attacker requires user interaction in order to trigger the exploit.

**Additional Details:**
- The provided commit diff shows that the fix involved adding the `validate => 'isCleanHtml'` to the `message` field definition within the `CustomerMessage.php` file. This ensures that all HTML content is sanitized before being stored in the database.
- The vulnerability was reported by Rona Febriana.
- The CVSS score is 5.4 (Moderate), with specific CVSS v3 base metrics detailed in the report.