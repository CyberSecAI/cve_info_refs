=== Content from github.com_20392366_20250114_201424.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fwintercms%2Fwinter%2Fsecurity%2Fadvisories%2FGHSA-xhw3-4j3m-hq53)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fwintercms%2Fwinter%2Fsecurity%2Fadvisories%2FGHSA-xhw3-4j3m-hq53)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=wintercms%2Fwinter)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[wintercms](/wintercms)
/
**[winter](/wintercms/winter)**
Public

* [Notifications](/login?return_to=%2Fwintercms%2Fwinter) You must be signed in to change notification settings
* [Fork
  197](/login?return_to=%2Fwintercms%2Fwinter)
* [Star
   1.4k](/login?return_to=%2Fwintercms%2Fwinter)

* [Code](/wintercms/winter)
* [Issues
  44](/wintercms/winter/issues)
* [Pull requests
  34](/wintercms/winter/pulls)
* [Discussions](/wintercms/winter/discussions)
* [Actions](/wintercms/winter/actions)
* [Projects
  0](/wintercms/winter/projects)
* [Security](/wintercms/winter/security)
* [Insights](/wintercms/winter/pulse)

Additional navigation options

* [Code](/wintercms/winter)
* [Issues](/wintercms/winter/issues)
* [Pull requests](/wintercms/winter/pulls)
* [Discussions](/wintercms/winter/discussions)
* [Actions](/wintercms/winter/actions)
* [Projects](/wintercms/winter/projects)
* [Security](/wintercms/winter/security)
* [Insights](/wintercms/winter/pulse)

# Sandbox bypass in Twig templates leading to data modification and deletion

High

[bennothommo](/bennothommo)
published
GHSA-xhw3-4j3m-hq53
Dec 9, 2024

## Package

composer

winter/wn-cms-module
([Composer](/advisories?query=ecosystem%3Acomposer))

## Affected versions

<= 1.2.6, <= 1.1.10, <= 1.0.475

## Patched versions

1.2.7, 1.1.11, 1.0.476

## Description

### Impact

Affected versions of Winter CMS allow users with access to the CMS templates sections that modify Twig files to bypass the sandbox placed on Twig files and modify resources such as theme customisation values or modify, or remove, templates in the theme even if not provided direct access via the permissions.

As all objects passed through to Twig are references to the live objects, it is also possible to also manipulate model data if models are passed directly to Twig, including changing attributes or even removing records entirely. In most cases, this is unwanted behavior and potentially dangerous.

To actively exploit this security issue, an attacker would need access to the Backend with a user account with any of the following permissions:

* `cms.manage_layouts`
* `cms.manage_pages`
* `cms.manage_partials`

The Winter CMS maintainers strongly recommend that these permissions only be reserved to trusted administrators and developers in general.

### Patches

In order to mitigate this issue, we have significantly increased the scope of the sandbox, effectively making all models and datasources read-only in Twig.

This security issue has been fixed as of [fb88e6f](https://github.com/wintercms/winter/commit/fb88e6fabde3b3278ce1844e581c87dcf7daee22).

### Workarounds

If you cannot upgrade, you may apply commit [fb88e6f](https://github.com/wintercms/winter/commit/fb88e6fabde3b3278ce1844e581c87dcf7daee22) to your Winter CMS installation manually to resolve this issue.

In the rare event that you were relying on being able to write to models/datasources within your Twig templates, you should instead use or create components to make changes to your models.

### Severity

High

8.5

# CVSS overall score

 This score calculates overall vulnerability severity from 0 to 10 and is based on the Common Vulnerability Scoring System (CVSS).

 / 10

#### CVSS v3 base metrics

Attack vector
Network

Attack complexity
Low

Privileges required
High

User interaction
Required

Scope
Changed

Confidentiality
High

Integrity
High

Availability
High

Learn more about base metrics

# CVSS v3 base metrics

Attack vector:
More severe the more the remote (logically and physically) an attacker can be in order to exploit the vulnerability.

Attack complexity:
More severe for the least complex attacks.

Privileges required:
More severe if no privileges are required.

User interaction:
More severe when no user interaction is required.

Scope:
More severe when a scope change occurs, e.g. one vulnerable component impacts resources in components beyond its security scope.

Confidentiality:
More severe when loss of data confidentiality is highest, measuring the level of data access available to an unauthorized user.

Integrity:
More severe when loss of data integrity is the highest, measuring the consequence of data modification possible by an unauthorized user.

Availability:
More severe when the loss of impacted component availability is highest.

CVSS:3.1/AV:N/AC:L/PR:H/UI:R/S:C/C:H/I:H/A:H

### CVE ID

CVE-2024-54149

### Weaknesses

No CWEs

### Credits

* [![@bennothommo](https://avatars.githubusercontent.com/u/15900351?s=40&v=4)](/bennothommo)
  [bennothommo](/bennothommo)
  Reporter

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_ceff771a_20250114_201422.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fwintercms%2Fwinter%2Fcommit%2Ffb88e6fabde3b3278ce1844e581c87dcf7daee22)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fwintercms%2Fwinter%2Fcommit%2Ffb88e6fabde3b3278ce1844e581c87dcf7daee22)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=wintercms%2Fwinter)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[wintercms](/wintercms)
/
**[winter](/wintercms/winter)**
Public

* [Notifications](/login?return_to=%2Fwintercms%2Fwinter) You must be signed in to change notification settings
* [Fork
  197](/login?return_to=%2Fwintercms%2Fwinter)
* [Star
   1.4k](/login?return_to=%2Fwintercms%2Fwinter)

* [Code](/wintercms/winter)
* [Issues
  44](/wintercms/winter/issues)
* [Pull requests
  34](/wintercms/winter/pulls)
* [Discussions](/wintercms/winter/discussions)
* [Actions](/wintercms/winter/actions)
* [Projects
  0](/wintercms/winter/projects)
* [Security](/wintercms/winter/security)
* [Insights](/wintercms/winter/pulse)

Additional navigation options

* [Code](/wintercms/winter)
* [Issues](/wintercms/winter/issues)
* [Pull requests](/wintercms/winter/pulls)
* [Discussions](/wintercms/winter/discussions)
* [Actions](/wintercms/winter/actions)
* [Projects](/wintercms/winter/projects)
* [Security](/wintercms/winter/security)
* [Insights](/wintercms/winter/pulse)

## Commit

[Permalink](/wintercms/winter/commit/fb88e6fabde3b3278ce1844e581c87dcf7daee22)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Merge commit from fork

[Browse files](/wintercms/winter/tree/fb88e6fabde3b3278ce1844e581c87dcf7daee22)
Browse the repository at this point in the history

```
* Harden theme objects, prevent certain properties from being passed through to ThemeData object

* Improve and properly scope Twig security policy

- Deny access to "include" and "extends" tags/functions, as per Markup docs
- Block methods that write, delete or modify records and attributes in Database/Eloquent and Halcyon models
- Block access to theme datasource
- Prevent extensions from being created or directly interacted with (models and properties provided to extended objects should still be OK)

* Minor

* Make theme magic method calls case insensitive

* Allow include and extends tags/functions

* Add additional blocked methods

* Add test cases
```

* Loading branch information

[![@bennothommo](https://avatars.githubusercontent.com/u/15900351?s=40&v=4)](/bennothommo)

[bennothommo](/wintercms/winter/commits?author=bennothommo "View all commits by bennothommo")
authored
Oct 16, 2024

1 parent
[5f53526](/wintercms/winter/commit/5f53526035ee07317100ced658c469ed3656a0b2)

commit fb88e6f

 Show file tree

 Hide file tree

Showing
**4 changed files**
with
**411 additions**
and
**38 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* modules

  + cms

    - classes

      * modules/cms/classes/Theme.php
        [Theme.php](#diff-0c4213f30b10b01d2c609333086c5b46ae3b9a830f863648d8b2e687b108b68c)
    - models

      * modules/cms/models/ThemeData.php
        [ThemeData.php](#diff-87e2a30b243b1c15dd6fe837795bcc3c7eb5cfdf069f57af8879e79cec9dd5a5)
  + system

    - tests/twig

      * modules/system/tests/twig/SecurityPolicyTest.php
        [SecurityPolicyTest.php](#diff-f73b365b576b41256d6fd81c2a3fe585341430151fb7c39547da8abb40e83e51)
    - twig

      * modules/system/twig/SecurityPolicy.php
        [SecurityPolicy.php](#diff-347d3e6f6f84697f5be048027169529a5ed7e782fcf2dcf62dcdbf560a0a4f77)

## There are no files selected for viewing

34 changes: 23 additions & 11 deletions

34
[modules/cms/classes/Theme.php](#diff-0c4213f30b10b01d2c609333086c5b46ae3b9a830f863648d8b2e687b108b68c "modules/cms/classes/Theme.php")

Show comments

[View file](/wintercms/winter/blob/fb88e6fabde3b3278ce1844e581c87dcf7daee22/modules/cms/classes/Theme.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -1,22 +1,25 @@ |
|  |  | <?php namespace Cms\Classes; |
|  |  | <?php |
|  |  |  |
|  |  | namespace Cms\Classes; |
|  |  |  |
|  |  | use App; |
|  |  | use ApplicationException; |
|  |  | use Cache; |
|  |  | use Cms\Models\ThemeData; |
|  |  | use Config; |
|  |  | use DirectoryIterator; |
|  |  | use Event; |
|  |  | use Exception; |
|  |  | use File; |
|  |  | use Lang; |
|  |  | use Illuminate\Support\Facades\App; |
|  |  | use Illuminate\Support\Facades\Cache; |
|  |  | use Illuminate\Support\Facades\Lang; |
|  |  | use System\Models\Parameter; |
|  |  | use SystemException; |
|  |  | use Url; |
|  |  | use Winter\Storm\Exception\ApplicationException; |
|  |  | use Winter\Storm\Exception\SystemException; |
|  |  | use Winter\Storm\Halcyon\Datasource\DatasourceInterface; |
|  |  | use Winter\Storm\Halcyon\Datasource\DbDatasource; |
|  |  | use Winter\Storm\Halcyon\Datasource\FileDatasource; |
|  |  | use Yaml; |
|  |  | use Winter\Storm\Support\Facades\Config; |
|  |  | use Winter\Storm\Support\Facades\Event; |
|  |  | use Winter\Storm\Support\Facades\File; |
|  |  | use Winter\Storm\Support\Facades\Url; |
|  |  | use Winter\Storm\Support\Facades\Yaml; |
|  |  | use Winter\Storm\Support\Str; |
|  |  |  |
|  |  | /\*\* |
|  |  | \* This class represents the CMS theme. |
| Expand Down  Expand Up | | @@ -682,6 +685,11 @@ public function getDatasource(): DatasourceInterface |
|  |  | \*/ |
|  |  | public function \_\_get($name) |
|  |  | { |
|  |  | if (in\_array(strtolower($name), ['id', 'path', 'dirname', 'config', 'formconfig', 'previewimageurl'])) { |
|  |  | $method = 'get'. ucfirst($name); |
|  |  | return $this->$method(); |
|  |  | } |
|  |  |  |
|  |  | if ($this->hasCustomData()) { |
|  |  | return $this->getCustomData()->{$name}; |
|  |  | } |
| Expand All | | @@ -694,6 +702,10 @@ public function \_\_get($name) |
|  |  | \*/ |
|  |  | public function \_\_isset($key) |
|  |  | { |
|  |  | if (in\_array(strtolower($key), ['id', 'path', 'dirname', 'config', 'formconfig', 'previewimageurl'])) { |
|  |  | return true; |
|  |  | } |
|  |  |  |
|  |  | if ($this->hasCustomData()) { |
|  |  | $theme = $this->getCustomData(); |
|  |  | return $theme->offsetExists($key); |
| Expand Down | |  |

10 changes: 6 additions & 4 deletions

10
[modules/cms/models/ThemeData.php](#diff-87e2a30b243b1c15dd6fe837795bcc3c7eb5cfdf069f57af8879e79cec9dd5a5 "modules/cms/models/ThemeData.php")

Show comments

[View file](/wintercms/winter/blob/fb88e6fabde3b3278ce1844e581c87dcf7daee22/modules/cms/models/ThemeData.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -1,11 +1,13 @@ |
|  |  | <?php namespace Cms\Models; |
|  |  | <?php |
|  |  |  |
|  |  | namespace Cms\Models; |
|  |  |  |
|  |  | use Lang; |
|  |  | use Model; |
|  |  | use Cms\Classes\Theme as CmsTheme; |
|  |  | use System\Classes\CombineAssets; |
|  |  | use Exception; |
|  |  | use Illuminate\Support\Facades\Lang; |
|  |  | use System\Classes\CombineAssets; |
|  |  | use System\Models\File; |
|  |  | use Winter\Storm\Database\Model; |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Customization data used by a theme |
| Expand Down | |  |

269 changes: 269 additions & 0 deletions

269
[modules/system/tests/twig/SecurityPolicyTest.php](#diff-f73b365b576b41256d6fd81c2a3fe585341430151fb7c39547da8abb40e83e51 "modules/system/tests/twig/SecurityPolicyTest.php")

Show comments

[View file](/wintercms/winter/blob/fb88e6fabde3b3278ce1844e581c87dcf7daee22/modules/system/tests/twig/SecurityPolicyTest.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,269 @@ |
|  |  | <?php |
|  |  |  |
|  |  | namespace System\Tests\Twig; |
|  |  |  |
|  |  | use Cms\Classes\Controller; |
|  |  | use Cms\Classes\Page; |
|  |  | use Cms\Classes\Theme; |
|  |  | use System\Tests\Bootstrap\TestCase; |
|  |  | use Twig\Environment; |
|  |  | use Winter\Storm\Filesystem\Filesystem; |
|  |  | use Winter\Storm\Halcyon\Datasource\FileDatasource; |
|  |  |  |
|  |  | class SecurityPolicyTest extends TestCase |
|  |  | { |
|  |  | protected Environment $twig; |
|  |  |  |
|  |  | public function testCannotGetTwigInstanceFromCmsController() |
|  |  | { |
|  |  | $this->expectException(\Twig\Sandbox\SecurityNotAllowedMethodError::class); |
|  |  |  |
|  |  | $this->renderTwigInCmsController(' |
|  |  | {% set twig = this.controller.getTwig() %} |
|  |  | {{ this.controller.getTwig() }} |
|  |  | '); |
|  |  | } |
|  |  |  |
|  |  | public function testCannotGetTwigLoaderFromCmsController() |
|  |  | { |
|  |  | $this->expectException(\Twig\Sandbox\SecurityNotAllowedMethodError::class); |
|  |  |  |
|  |  | $this->renderTwigInCmsController(' |
|  |  | {% set loader = this.controller.getLoader() %} |
|  |  | {{ loader.load(\'/\') }} |
|  |  | '); |
|  |  | } |
|  |  |  |
|  |  | public function testCannotRunAPageObjectFromWithinTwig() |
|  |  | { |
|  |  | $this->expectException(\Twig\Sandbox\SecurityNotAllowedMethodError::class); |
|  |  |  |
|  |  | $this->renderTwigInCmsController(' |
|  |  | {{ this.controller.runPage() }} |
|  |  | '); |
|  |  | } |
|  |  |  |
|  |  | public function testCannotExtendAPageWithADynamicMethod() |
|  |  | { |
|  |  | $this->expectException(\Twig\Sandbox\SecurityNotAllowedMethodError::class); |
|  |  |  |
|  |  | $this->renderTwigInCmsController(' |
|  |  | {% set page = this.page.addDynamicMethod("test") %} |
|  |  | '); |
|  |  | } |
|  |  |  |
|  |  | public function testCannotExtendAPageWithADynamicProperty() |
|  |  | { |
|  |  | $this->expectException(\Twig\Sandbox\SecurityNotAllowedMethodError::class); |
|  |  |  |
|  |  | $this->renderTwigInCmsController(' |
|  |  | {% set page = this.page.addDynamicProperty("test", "value") %} |
|  |  | '); |
|  |  | } |
|  |  |  |
|  |  | public function testCannotWriteToAModel() |
|  |  | { |
|  |  | $this->expectException(\Twig\Sandbox\SecurityNotAllowedMethodError::class); |
|  |  |  |
|  |  | $this->renderTwigInCmsController(' |
|  |  | {% set modelTest = model.setAttribute("test", "value") %} |
|  |  | ', [ |
|  |  | 'model' => new \Winter\Storm\Database\Model(), |
|  |  | ]); |
|  |  | } |
|  |  |  |
|  |  | public function testCanReadFromAModel() |
|  |  | { |
|  |  | $model = new \Winter\Storm\Database\Model(); |
|  |  | $model->test = 'value'; |
|  |  |  |
|  |  | $result = trim($this->renderTwigInCmsController(' |
|  |  | {% set modelTest = model.getAttribute("test") %} |
|  |  | {{- modelTest -}} |
|  |  | ', [ |
|  |  | 'model' => $model, |
|  |  | ])); |
|  |  | $this->assertEquals('value', $result); |
|  |  | } |
|  |  |  |
|  |  | public function testCannotFillAModel() |
|  |  | { |
|  |  | $this->expectException(\Twig\Sandbox\SecurityNotAllowedMethodError::class); |
|  |  |  |
|  |  | try { |
|  |  | $model = new \Winter\Storm\Database\Model(); |
|  |  | $model->addFillable('test'); |
|  |  | $model->test = 'value'; |
|  |  |  |
|  |  | $this->renderTwigInCmsController(' |
|  |  | {% set modelTest = model.fill({ test: \'value2\' }) %} |
|  |  | ', [ |
|  |  | 'model' => new \Winter\Storm\Database\Model(), |
|  |  | ]); |
|  |  | } catch (\Twig\Sandbox\SecurityNotAllowedMethodError $e) { |
|  |  | // Ensure value hasn't changed |
|  |  | $this->assertEquals('value', $model->test); |
|  |  | throw $e; |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | public function testCannotSaveAModel() |
|  |  | { |
|  |  | $this->expectException(\Twig\Sandbox\SecurityNotAllowedMethodError::class); |
|  |  |  |
|  |  | $this->renderTwigInCmsController(' |
|  |  | {% set modelTest = model.save() %} |
|  |  | ', [ |
|  |  | 'model' => new \Winter\Storm\Database\Model(), |
|  |  | ]); |
|  |  | } |
|  |  |  |
|  |  | public function testCannotPushAModel() |
|  |  | { |
|  |  | $this->expectException(\Twig\Sandbox\SecurityNotAllowedMethodError::class); |
|  |  |  |
|  |  | $this->renderTwigInCmsController(' |
|  |  | {% set modelTest = model.push() %} |
|  |  | ', [ |
|  |  | 'model' => new \Winter\Storm\Database\Model(), |
|  |  | ]); |
|  |  | } |
|  |  |  |
|  |  | public function testCannotUpdateAModel() |
|  |  | { |
|  |  | $this->expectException(\Twig\Sandbox\SecurityNotAllowedMethodError::class); |
|  |  |  |
|  |  | $model = new \Winter\Storm\Database\Model(); |
|  |  | $model->addFillable('test'); |
|  |  | $model->test = 'value'; |
|  |  |  |
|  |  | $this->renderTwigInCmsController(' |
|  |  | {% set modelTest = model.update({ test: \'value2\' }) %} |
|  |  | ', [ |
|  |  | 'model' => $model, |
|  |  | ]); |
|  |  | } |
|  |  |  |
|  |  | public function testCannotDeleteAModel() |
|  |  | { |
|  |  | $this->expectException(\Twig\Sandbox\SecurityNotAllowedMethodError::class); |
|  |  |  |
|  |  | $this->renderTwigInCmsController(' |
|  |  | {% set modelTest = model.delete() %} |
|  |  | ', [ |
|  |  | 'model' => new \Winter\Storm\Database\Model(), |
|  |  | ]); |
|  |  | } |
|  |  |  |
|  |  | public function testCannotForceDeleteAModel() |
|  |  | { |
|  |  | $this->expectException(\Twig\Sandbox\SecurityNotAllowedMethodError::class); |
|  |  |  |
|  |  | $this->renderTwigInCmsController(' |
|  |  | {% set modelTest = model.forceDelete() %} |
|  |  | ', [ |
|  |  | 'model' => new \Winter\Storm\Database\Model(), |
|  |  | ]); |
|  |  | } |
|  |  |  |
|  |  | public function testCannotExtendAModelWithABehaviour() |
|  |  | { |
|  |  | $this->expectException(\Twig\Sandbox\SecurityNotAllowedMethodError::class); |
|  |  |  |
|  |  | $this->renderTwigInCmsController(' |
|  |  | {% set model = model.extendClassWith("Winter\Storm\Database\Behaviors\Encryptable") %} |
|  |  | ', [ |
|  |  | 'model' => new \Winter\Storm\Database\Model(), |
|  |  | ]); |
|  |  | } |
|  |  |  |
|  |  | public function testExtendingModelBeforePassingIntoTwigShouldStillWork() |
|  |  | { |
|  |  | $model = new \Winter\Storm\Database\Model(); |
|  |  | $model->addDynamicMethod('foo', function () { |
|  |  | return 'foo'; |
|  |  | }); |
|  |  |  |
|  |  | $result = trim($this->renderTwigInCmsController(' |
|  |  | {{- model.foo() -}} |
|  |  | ', [ |
|  |  | 'model' => $model, |
|  |  | ])); |
|  |  | $this->assertEquals('foo', $result); |
|  |  | } |
|  |  |  |
|  |  | public function testCannotGetDatasourceFromTheme() |
|  |  | { |
|  |  | $this->expectException(\Twig\Sandbox\SecurityNotAllowedMethodError::class); |
|  |  |  |
|  |  | $this->renderTwigInCmsController(' |
|  |  | {% set datasource = this.theme.getDatasource() %} |
|  |  | '); |
|  |  | } |
|  |  |  |
|  |  | // Even if someone decides to be clever and make the datasource available, you shouldn't be able to insert/delete/update |
|  |  | public function testCannotDeleteInDatasource() |
|  |  | { |
|  |  | $this->expectException(\Twig\Sandbox\SecurityNotAllowedMethodError::class); |
|  |  |  |
|  |  | $this->renderTwigInCmsController(' |
|  |  | {% set datasource = datasource.delete() %} |
|  |  | ', [ |
|  |  | 'datasource' => new FileDatasource( |
|  |  | base\_path('modules/system/tests/fixtures/themes/test'), |
|  |  | new Filesystem() |
|  |  | ), |
|  |  | ]); |
|  |  | } |
|  |  |  |
|  |  | public function testCannotInsertInDatasource() |
|  |  | { |
|  |  | $this->expectException(\Twig\Sandbox\SecurityNotAllowedMethodError::class); |
|  |  |  |
|  |  | $this->renderTwigInCmsController(' |
|  |  | {% set datasource = datasource.insert() %} |
|  |  | ', [ |
|  |  | 'datasource' => new FileDatasource( |
|  |  | base\_path('modules/system/tests/fixtures/themes/test'), |
|  |  | new Filesystem() |
|  |  | ), |
|  |  | ]); |
|  |  | } |
|  |  |  |
|  |  | public function testCannotUpdateInDatasource() |
|  |  | { |
|  |  | $this->expectException(\Twig\Sandbox\SecurityNotAllowedMethodError::class); |
|  |  |  |
|  |  | $this->renderTwigInCmsController(' |
|  |  | {% set datasource = datasource.update() %} |
|  |  | ', [ |
|  |  | 'datasource' => new FileDatasource( |
|  |  | base\_path('modules/system/tests/fixtures/themes/test'), |
|  |  | new Filesystem() |
|  |  | ), |
|  |  | ]); |
|  |  | } |
|  |  |  |
|  |  | public function testCannotChangeThemeDirectory() |
|  |  | { |
|  |  | $this->expectException(\Twig\Sandbox\SecurityNotAllowedMethodError::class); |
|  |  |  |
|  |  | $this->renderTwigInCmsController(' |
|  |  | {% set theme = this.theme.setDirName("test") %} |
|  |  | '); |
|  |  | } |
|  |  |  |
|  |  | protected function renderTwigInCmsController(string $source, array $vars = []) |
|  |  | { |
|  |  | $controller = new Controller(); |
|  |  | $twig = $controller->getTwig(); |
|  |  | $template = $twig->createTemplate($source, 'test.case'); |
|  |  | return $twig->render($template, [ |
|  |  | 'this' => [ |
|  |  | 'controller' => $controller, |
|  |  | 'page' => new Page(), |
|  |  | 'theme' => new Theme() |
|  |  | ], |
|  |  | ] + $vars); |
|  |  | } |
|  |  | } |

 Loading

Oops, something went wrong.
 Retry

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `fb88e6f`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fwintercms%2Fwinter%2Fcommit%2Ffb88e6fabde3b3278ce1844e581c87dcf7daee22) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


