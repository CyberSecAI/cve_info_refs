=== Content from www.wordfence.com_189acdc2_20250115_083822.html ===


[![](https://www.wordfence.com/img/wordfence-intelligence-logo.svg)](/threat-intel/)

Have you found a vulnerability in a WordPress plugin or theme? Report vulnerabilities in WordPress plugins and themes through our [bug bounty program](https://www.wordfence.com/threat-intel/bug-bounty-program) and earn a bounty on all in-scope submissions, while we handle the responsible disclosure process on your behalf.

As a reminder, the Wordfence Intelligence Vulnerability Database API is completely free to query and utilize, both personally and commercially, and contains all the same vulnerability data as the user interface. Please review the API documentation and Webhook documentation for more information on how to query the vulnerability API endpoints and configure webhooks utilizing all the same data present in the Wordfence Intelligence user interface.

# PCRecruiter Extensions <= 1.4.22 - Authenticated (Contributor+) Stored Cross-Site Scripting

 [Wordfence Intelligence](https://www.wordfence.com/threat-intel)   >    [Vulnerability Database](https://www.wordfence.com/threat-intel/vulnerabilities)   >   PCRecruiter Extensions <= 1.4.22 - Authenticated (Contributor+) Stored Cross-Site Scripting

6.4

**Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')**
**CVSS Vector**
[CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:C/C:L/I:L/A:N](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:C/C:L/I:L/A:N)

| CVE | [CVE-2024-11776](https://www.cve.org/CVERecord?id=CVE-2024-11776) |
| --- | --- |
| CVSS | 6.4 (Medium) |
| Publicly Published | December 19, 2024 |
| Last Updated | December 21, 2024 |
| Researcher | [yudha](https://www.wordfence.com/threat-intel/vulnerabilities/researchers/yudha) |

### Description

The PCRecruiter Extensions plugin for WordPress is vulnerable to Stored Cross-Site Scripting via the plugin's 'PCRecruiter' shortcode in all versions up to, and including, 1.4.22 due to insufficient input sanitization and output escaping on user supplied attributes. This makes it possible for authenticated attackers, with contributor-level access and above, to inject arbitrary web scripts in pages that will execute whenever a user accesses an injected page.

#### References

* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/browser/pcrecruiter-extensions/trunk/PCRecruiter-Extensions.php#L21)

#### Share

[Facebook](https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fpcrecruiter-extensions%2Fpcrecruiter-extensions-1410-authenticated-contributor-stored-cross-site-scripting&t=PCRecruiter%20Extensions%20%3C%3D%201.4.22%20-%20Authenticated%20%28Contributor%2B%29%20Stored%20Cross-Site%20Scripting "Facebook")
[Twitter](https://twitter.com/share?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fpcrecruiter-extensions%2Fpcrecruiter-extensions-1410-authenticated-contributor-stored-cross-site-scripting&text=PCRecruiter%20Extensions%20%3C%3D%201.4.22%20-%20Authenticated%20%28Contributor%2B%29%20Stored%20Cross-Site%20Scripting "Twitter")
[LinkedIn](https://www.linkedin.com/shareArticle?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fpcrecruiter-extensions%2Fpcrecruiter-extensions-1410-authenticated-contributor-stored-cross-site-scripting "LinkedIn")
Email

## Vulnerability Details for PCRecruiter Extensions

#### [PCRecruiter Extensions](https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/pcrecruiter-extensions)

| Software Type | Plugin |
| --- | --- |
| Software Slug | pcrecruiter-extensions [(view on wordpress.org)](https://wordpress.org/plugins/pcrecruiter-extensions) |
| Patched? | Yes |
| Remediation | Update to version 1.4.23, or a newer patched version |
| Affected Version | * <= 1.4.22 |
| Patched Version | * 1.4.23 |

This record contains material that is subject to copyright.

**Copyright 2012-2025 Defiant Inc.**

**License:**
Defiant hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute this software vulnerability information. Any copy of the software vulnerability information you make for such purposes is authorized provided that you include a hyperlink to this vulnerability record and reproduce Defiant's copyright designation and this license in any such copy.
**[Read more.](https://www.wordfence.com/wordfence-intelligence-terms-and-conditions/)**

**Copyright 1999-2025 The MITRE Corporation**

**License:**
CVE Usage: MITRE hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute Common Vulnerabilities and Exposures (CVE®). Any copy you make for such purposes is authorized provided that you reproduce MITRE's copyright designation and this license in any such copy.
**[Read more.](https://www.cve.org/Legal/TermsOfUse)**

Have information to add, or spot any errors? Contact us at wfi-support@wordfence.com so we can make any appropriate adjustments.

Did you know Wordfence Intelligence provides free personal and commercial API access to our comprehensive WordPress vulnerability database, along with a free webhook integration to stay on top of the latest vulnerabilities added and updated in the database? Get started today!

Learn more

Want to get notified of the latest vulnerabilities that may affect your WordPress site?
 Install Wordfence on your site today to get notified immediately if your site is affected by a vulnerability that has been added to our database.

Get Wordfence

The Wordfence Intelligence WordPress vulnerability database is completely free to access and query via API. Please review the documentation on how to access and consume the vulnerability data via API.

Documentation



=== Content from plugins.trac.wordpress.org_c65e109a_20250115_083821.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fbrowser%2Fpcrecruiter-extensions%2Ftrunk%2FPCRecruiter-Extensions.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Revision](/browser/pcrecruiter-extensions/trunk/PCRecruiter-Extensions.php?rev=3214900 "Revision 3214900")
* Next Revision →
* [Blame](/browser/pcrecruiter-extensions/trunk/PCRecruiter-Extensions.php?annotate=blame "Annotate each line with the last changed revision (this can be time consuming...)")
* [Revision Log](/log/pcrecruiter-extensions/trunk/PCRecruiter-Extensions.php)

---

# [source:](/browser?order=name "Go to repository root") [pcrecruiter-extensions](/browser/pcrecruiter-extensions?order=name "View pcrecruiter-extensions")/[trunk](/browser/pcrecruiter-extensions/trunk?order=name "View trunk")/[PCRecruiter-Extensions.php](/browser/pcrecruiter-extensions/trunk/PCRecruiter-Extensions.php?order=name "View PCRecruiter-Extensions.php")

View diff against:

View revision:

| [Last change](/changeset/3220322/pcrecruiter-extensions/trunk/PCRecruiter-Extensions.php "View differences") on this file was [3220322](/changeset/3220322/ "View changeset 3220322"), checked in by arothman, [5 days ago](/timeline?from=2025-01-10T16%3A03%3A53Z&precision=second "See timeline at 01/10/2025 04:03:53 PM") |
| --- |
| Adjusted regex to allow the underscore character. |
| **File size:** 21.7 KB | |

| Line |  |
| --- | --- |
| [1](#L1) | <?php |
| [2](#L2) | /\* |
| [3](#L3) | Plugin Name: PCRecruiter Extensions |
| [4](#L4) | Plugin URI: https://www.pcrecruiter.net |
| [5](#L5) | Description: Embeds PCRecruiter forms and iframe content via shortcodes, and facilitiates RSS/XML Job Feeds. |
| [6](#L6) | Version: 1.4.32 |
| [7](#L7) | Author: Main Sequence Technology, Inc. |
| [8](#L8) | Author URI: https://www.pcrecruiter.net |
| [9](#L9) | License: GPLv2 or later |
| [10](#L10) | License URI: https://www.gnu.org/licenses/gpl-2.0.html |
| [11](#L11) | \*/ |
| [12](#L12) |  |
| [13](#L13) | /\* |
| [14](#L14) | Job Feed Display on page |
| [15](#L15) | \*/ |
| [16](#L16) |  |
| [17](#L17) | function pcr\_assets() { |
| [18](#L18) | wp\_register\_script( 'pcr-iframe', 'https://www2.pcrecruiter.net/pcrimg/inc/pcrframehost.js', false, false, false); |
| [19](#L19) | wp\_enqueue\_script( 'pcr-iframe' ); |
| [20](#L20) | } |
| [21](#L21) | add\_action( 'wp\_enqueue\_scripts', 'pcr\_assets' ); |
| [22](#L22) | function sanitize\_loadurl($urlparam) |
| [23](#L23) | { |
| [24](#L24) | // Allow only letters, numbers, periods, equals, colons, hyphens, question marks, hyphens, forward slashes, percent signs, spaces, and ampersands |
| [25](#L25) | return preg\_replace('/[^a-zA-Z0-9\.\=\:\?\/%\s&\-\_]/', '', $urlparam); |
| [26](#L26) | } |
| [27](#L27) |  |
| [28](#L28) | function pcr\_frame($atts) |
| [29](#L29) | { |
| [30](#L30) | $a = shortcode\_atts([ |
| [31](#L31) | 'link' => 'about:blank', |
| [32](#L32) | 'background' => 'transparent', |
| [33](#L33) | 'initialheight' => '640', |
| [34](#L34) | 'form' => '' |
| [35](#L35) | ], $atts); |
| [36](#L36) |  |
| [37](#L37) | $sid = intval($a['form']); |
| [38](#L38) | $loadurl = $a['link']; |
| [39](#L39) | $loadurl = htmlspecialchars\_decode($loadurl, ENT\_QUOTES); |
| [40](#L40) | $loadurl = sanitize\_loadurl($loadurl); |
| [41](#L41) |  |
| [42](#L42) |  |
| [43](#L43) |  |
| [44](#L44) | $initialheight = intval($a['initialheight']); |
| [45](#L45) | $background = preg\_match('/^#[a-fA-F0-9]{3,6}$|^transparent$/', $a['background']) ? $a['background'] : 'transparent'; |
| [46](#L46) | $pcrframecss = '<link rel="stylesheet" href="https://www2.pcrecruiter.net/pcrimg/inc/pcrframehost.css">'; |
| [47](#L47) |  |
| [48](#L48) |  |
| [49](#L49) | // Modify the URL when needed |
| [50](#L50) | if (strpos($loadurl,'jobboard.') > -1 || strpos($loadurl,'temphrs.') > -1 || strpos($loadurl,'employer.') > -1 || strpos($loadurl,'/reg') > -1) { |
| [51](#L51) |  |
| [52](#L52) | } else { |
| [53](#L53) | if ($sid < 1 || strpos($loadurl, '.asp?') === false || strpos($loadurl, '.exe?') === false || strpos($loadurl, '.aspx?') === false) { |
| [54](#L54) | $loadurl = 'jobboard.aspx?uid=' . $loadurl; |
| [55](#L55) | $pcrframecss = ''; |
| [56](#L56) | } |
| [57](#L57) | } |
| [58](#L58) |  |
| [59](#L59) | // If a custom form is specified |
| [60](#L60) | if ($sid && $loadurl !== "about:blank") { |
| [61](#L61) | // Create the <script> tag with DOMDocument |
| [62](#L62) | $doc = new DOMDocument('1.0', 'UTF-8'); |
| [63](#L63) | $script = $doc->createElement('script'); |
| [64](#L64) | $loadurl = urldecode($loadurl); |
| [65](#L65) | $script->setAttribute('src', "https://host.pcrecruiter.net/pcrbin/{$loadurl}&action=opencustomform&sid={$sid}"); |
| [66](#L66) | $doc->appendChild($script); |
| [67](#L67) |  |
| [68](#L68) | return "<!-- Start PCRecruiter Form -->" |
| [69](#L69) | . $doc->saveHTML() |
| [70](#L70) | . "<!-- End PCRecruiter Form -->"; |
| [71](#L71) | } |
| [72](#L72) |  |
| [73](#L73) | // Prepend URL based on the link |
| [74](#L74) | if (substr($loadurl, 0, 4) !== "http") { |
| [75](#L75) | $prefix = (substr($loadurl, 0, 8) === "jobboard") |
| [76](#L76) | ? 'https://host.pcrecruiter.net/pcrbin/' |
| [77](#L77) | : 'https://www2.pcrecruiter.net/pcrbin/'; |
| [78](#L78) | $loadurl = $prefix . $loadurl; |
| [79](#L79) | } |
| [80](#L80) |  |
| [81](#L81) | $loadurl = str\_replace('http:','https:',$loadurl); |
| [82](#L82) | $loadurl = str\_replace('.exe?','.aspx?',$loadurl); |
| [83](#L83) |  |
| [84](#L84) | // Create iframe with DOMDocument |
| [85](#L85) | $doc = new DOMDocument('1.0', 'UTF-8'); |
| [86](#L86) | $iframe = $doc->createElement('iframe'); |
| [87](#L87) | $iframe->setAttribute('frameborder', '0'); |
| [88](#L88) | $iframe->setAttribute('host', $loadurl); |
| [89](#L89) | $iframe->setAttribute('id', 'pcrframe'); |
| [90](#L90) | $iframe->setAttribute('name', 'pcrframe'); |
| [91](#L91) | $iframe->setAttribute('src', 'about:blank'); |
| [92](#L92) | $iframe->setAttribute('style', "height:{$a['initialheight']}px;width:100%;background-color:{$a['background']};border:0;margin:0;padding:0"); |
| [93](#L93) | $iframe->setAttribute('onload', 'pcrframeurl();'); |
| [94](#L94) |  |
| [95](#L95) | $doc->appendChild($iframe); |
| [96](#L96) |  |
| [97](#L97) | return "<!-- Start PCRecruiter WP 1.4.32-->" |
| [98](#L98) | . $pcrframecss |
| [99](#L99) | . $doc->saveHTML() |
| [100](#L100) | . "<!-- End PCRecruiter WP -->"; |
| [101](#L101) | } |
| [102](#L102) |  |
| [103](#L103) | add\_shortcode('PCRecruiter', 'pcr\_frame'); |
| [104](#L104) |  |
| [105](#L105) |  |
| [106](#L106) | /\* Remove Canonical Link \*/ |
| [107](#L107) | remove\_action('wp\_head', 'rel\_canonical'); |
| [108](#L108) | add\_filter( 'wpseo\_canonical', '\_\_return\_false' ); |
| [109](#L109) |  |
| [110](#L110) | /\* |
| [111](#L111) |  |
| [112](#L112) | BEGIN Get PCR Feed |
| [113](#L113) |  |
| [114](#L114) | \*/ |
| [115](#L115) |  |
| [116](#L116) | // checkop() to see if options exist. If not, set the defaults |
| [117](#L117) | function checkop() { |
| [118](#L118) | //check if option is already present |
| [119](#L119) | //option key is pcr\_feed\_options |
| [120](#L120) | if(!get\_option('pcr\_feed\_options')) { |
| [121](#L121) | //not present, so add |
| [122](#L122) | $pcr\_options = array( |
| [123](#L123) | //'activation'    =>  'true', |
| [124](#L124) | 'frequency'     =>  'daily', |
| [125](#L125) | 'query'         =>  'Status%20eq%20Available%20and%20ShowOnWeb%20eq%20true%20and%20%28NumberOfOpenings%20ne%200%20OR%20NumberOfOpenings%20eq%20%27%27)', |
| [126](#L126) | 'mode'          =>  'job', |
| [127](#L127) | ); |
| [128](#L128) | add\_option('pcr\_feed\_options', $pcr\_options); |
| [129](#L129) | } |
| [130](#L130) | } |
| [131](#L131) |  |
| [132](#L132) | register\_activation\_hook(\_\_FILE\_\_, 'pcr\_feed\_activation'); |
| [133](#L133) |  |
| [134](#L134) | function pcr\_feed\_activation(){ |
| [135](#L135) | // set the defaults with checkop() |
| [136](#L136) | checkop(); |
| [137](#L137) | pcr\_feed\_func(); |
| [138](#L138) | } |
| [139](#L139) | add\_action('pcr\_feed', 'pcr\_feed\_activation'); |
| [140](#L140) |  |
| [141](#L141) | function pcr\_feed\_func(){ |
| [142](#L142) | // do this via cron |
| [143](#L143) | $pcr\_feed\_options = get\_option('pcr\_feed\_options', array()); |
| [144](#L144) | $pcr\_customfields = str\_replace(' ', '%20', $pcr\_feed\_options['custom\_fields']  ?? ''); |
| [145](#L145) | $pcr\_standardfields = str\_replace(' ', '%20', $pcr\_feed\_options['standard\_fields']  ?? ''); |
| [146](#L146) | $pcr\_id\_number = $pcr\_feed\_options['id\_number'] ?? ''; |
| [147](#L147) | $pcr\_activation = $pcr\_feed\_options['activation'] ?? ''; |
| [148](#L148) | $url = "https://host.pcrecruiter.net/pcrbin/feeds.aspx?action=customfeed&query=". $pcr\_feed\_options['query'] ."&xtransform=RSS2&SessionId=" . $pcr\_id\_number . "&FieldsPlus=" . $pcr\_standardfields . "&custom=" . $pcr\_customfields . "&mode=" . $pcr\_feed\_options['mode']; |
| [149](#L149) |  |
| [150](#L150) |  |
| [151](#L151) | if($pcr\_activation){ |
| [152](#L152) |  |
| [153](#L153) | // JSON |
| [154](#L154) | //$xml = simplexml\_load\_string($url, null, LIBXML\_NOCDATA, "http://www.pcrecruiter.net"); |
| [155](#L155) | $buffer = file\_get\_contents($url); |
| [156](#L156) | $buffer = str\_replace(array("\n", "\r", "\t"), '', $buffer); |
| [157](#L157) | $xml = simplexml\_load\_string($buffer, null, LIBXML\_NOCDATA); |
| [158](#L158) | $namespaces = $xml->getDocNamespaces(true); |
| [159](#L159) |  |
| [160](#L160) | //var\_dump($namespaces); |
| [161](#L161) |  |
| [162](#L162) | $array = []; |
| [163](#L163) | foreach ($namespaces as $namespace) { |
| [164](#L164) | if (is\_object($namespace) && property\_exists($namespace, 'key')) { |
| [165](#L165) | $xml = simplexml\_load\_string($buffer, null, LIBXML\_NOCDATA, $namespace->key); |
| [166](#L166) | $array = array\_merge\_recursive($array, (array) $xml); |
| [167](#L167) | } else { |
| [168](#L168) | // Handle the case where $namespace is not a valid object with a 'key' property |
| [169](#L169) | // For example: log an error or skip this iteration |
| [170](#L170) | } |
| [171](#L171) | } |
| [172](#L172) |  |
| [173](#L173) | $json = json\_encode($array, JSON\_PRETTY\_PRINT); |
| [174](#L174) |  |
| [175](#L175) | //$xml = file\_get\_contents($url); |
| [176](#L176) | //$xml = str\_replace('<pcr:', '<', $xml); |
| [177](#L177) | //$xml = simplexml\_load\_string($xml, null, LIBXML\_NOCDATA); |
| [178](#L178) | // |
| [179](#L179) | //$xml->channel->item->children('pcr', true); |
| [180](#L180) | //$xml->registerXPathNamespace('pcr', 'http://www.pcrecruiter.net'); |
| [181](#L181) | // use XPath to get all pcr:\* nodes |
| [182](#L182) | /\* |
| [183](#L183) | $items = $xml->xpath('//pcr:\*'); |
| [184](#L184) | foreach($items as $item) { |
| [185](#L185) | $pcrItems = $pcrItems . $item; |
| [186](#L186) | } |
| [187](#L187) | \*/ |
| [188](#L188) | // |
| [189](#L189) | //$xml->createElementNS('//pcr:\*', '//\*'); // no prefix |
| [190](#L190) | //$json = json\_encode($xml, JSON\_PRETTY\_PRINT); |
| [191](#L191) | //$array = json\_decode($json,TRUE); |
| [192](#L192) | //$fileContents = str\_replace(array("\n", "\r", "\t"), '', $fileContents); |
| [193](#L193) | //$fileContents = trim(str\_replace('"', "'", $fileContents)); |
| [194](#L194) | //$simpleXml = simplexml\_load\_string($fileContents); |
| [195](#L195) | //$json\_data = json\_encode($fileContents); |
| [196](#L196) | file\_put\_contents(WP\_CONTENT\_DIR . '/uploads/pcrjobfeed.json', $json); |
| [197](#L197) |  |
| [198](#L198) | if (!copy($url, WP\_CONTENT\_DIR . "/uploads/pcrjobfeed.xml")) { |
| [199](#L199) |  |
| [200](#L200) | } else { |
| [201](#L201) |  |
| [202](#L202) | } |
| [203](#L203) | } |
| [204](#L204) | } |
| [205](#L205) |  |
| [206](#L206) | // deactivate hook |
| [207](#L207) | register\_deactivation\_hook(\_\_FILE\_\_, 'pcr\_deactivation'); |
| [208](#L208) | function pcr\_deactivation(){ |
| [209](#L209) | wp\_clear\_scheduled\_hook('pcr\_feed'); |
| [210](#L210) | } |
| [211](#L211) | /\*\*/ |
| [212](#L212) | /\* |
| [213](#L213) | END Get PCR Feed |
| [214](#L214) | \*/ |
| [215](#L215) | /\* |
| [216](#L216) | Settings for the PCRecruiter Extensions Plugin |
| [217](#L217) | \*/ |
| [218](#L218) | class PcrSettingsPage |
| [219](#L219) | { |
| [220](#L220) | /\*\* |
| [221](#L221) | \* Holds the values to be used in the fields callbacks |
| [222](#L222) | \*/ |
| [223](#L223) | private $options; |
| [224](#L224) |  |
| [225](#L225) | /\*\* |
| [226](#L226) | \* Start up |
| [227](#L227) | \*/ |
| [228](#L228) | public function \_\_construct() |
| [229](#L229) | { |
| [230](#L230) | add\_action( 'admin\_menu', array( $this, 'add\_plugin\_page' ) ); |
| [231](#L231) | add\_action( 'admin\_init', array( $this, 'page\_init' ) ); |
| [232](#L232) | } |
| [233](#L233) |  |
| [234](#L234) | /\*\* |
| [235](#L235) | \* Add options page |
| [236](#L236) | \*/ |
| [237](#L237) | public function add\_plugin\_page() |
| [238](#L238) | { |
| [239](#L239) | // This page will be under "Settings" |
| [240](#L240) | add\_options\_page( |
| [241](#L241) | 'Settings Admin', |
| [242](#L242) | 'PCRecruiter Extensions', |
| [243](#L243) | 'manage\_options', |
| [244](#L244) | 'pcr-ext-setting-admin', |
| [245](#L245) | array( $this, 'create\_admin\_page' ) |
| [246](#L246) | ); |
| [247](#L247) | } |
| [248](#L248) |  |
| [249](#L249) | /\*\* |
| [250](#L250) | \* Options page callback |
| [251](#L251) | \*/ |
| [252](#L252) | public function create\_admin\_page() |
| [253](#L253) | { |
| [254](#L254) | $this->show\_cron\_status(); |
| [255](#L255) | // Set class property |
| [256](#L256) | $this->options = get\_option( 'pcr\_feed\_options' ); |
| [257](#L257) | ?> |
| [258](#L258) | <div class="wrap"> |
| [259](#L259) | <h1>PCRecruiter Extensions Settings</h1> |
| [260](#L260) | <form method="post" onsubmit="return validatePCRfeed()" action="options.php"> |
| [261](#L261) | <?php |
| [262](#L262) | // This prints out all hidden setting fields |
| [263](#L263) | settings\_fields( 'pcr\_ext\_option\_group' ); |
| [264](#L264) | do\_settings\_sections( 'pcr-ext-setting-admin' ); |
| [265](#L265) | ?> |
| [266](#L266) |  |
| [267](#L267) | <?php submit\_button();?> |
| [268](#L268) | </form> |
| [269](#L269) | </div> |
| [270](#L270) | <?php |
| [271](#L271) | } |
| [272](#L272) | /\*\* |
| [273](#L273) | \* Gets the status of cron functionality on the site by performing a test spawn. Cached for one hour when all is well. |
| [274](#L274) | \* |
| [275](#L275) | \* @param bool $cache Whether to use the cached result from previous calls. |
| [276](#L276) | \* @return true|WP\_Error Boolean true if the cron spawner is working as expected, or a WP\_Error object if not. |
| [277](#L277) | \*/ |
| [278](#L278) | public function test\_cron\_spawn( $cache = true ) { |
| [279](#L279) | global $wp\_version; |
| [280](#L280) |  |
| [281](#L281) | if ( defined( 'DISABLE\_WP\_CRON' ) && DISABLE\_WP\_CRON ) { |
| [282](#L282) | /\* translators: 1: The name of the PHP constant that is set. \*/ |
| [283](#L283) | return new WP\_Error( 'cron\_info', sprintf( \_\_( 'The %s constant is set to true. WP-Cron spawning is disabled.', 'wp-cron' ), 'DISABLE\_WP\_CRON' ) ); |
| [284](#L284) | } |
| [285](#L285) |  |
| [286](#L286) | if ( defined( 'ALTERNATE\_WP\_CRON' ) && ALTERNATE\_WP\_CRON ) { |
| [287](#L287) | /\* translators: 1: The name of the PHP constant that is set. \*/ |
| [288](#L288) | return new WP\_Error( 'cron\_info', sprintf( \_\_( 'The %s constant is set to true.', 'wp-cron' ), 'ALTERNATE\_WP\_CRON' ) ); |
| [289](#L289) | } |
| [290](#L290) |  |
| [291](#L291) | $cached\_status = get\_transient( 'wp-cron-test-ok' ); |
| [292](#L292) |  |
| [293](#L293) | if ( $cache && $cached\_status ) { |
| [294](#L294) | return true; |
| [295](#L295) | } |
| [296](#L296) |  |
| [297](#L297) | $sslverify     = version\_compare( $wp\_version, 4.0, '<' ); |
| [298](#L298) | $doing\_wp\_cron = sprintf( '%.22F', microtime( true ) ); |
| [299](#L299) |  |
| [300](#L300) | $cron\_request = apply\_filters( 'cron\_request', array( |
| [301](#L301) | 'url'  => site\_url( 'wp-cron.php?doing\_wp\_cron=' . $doing\_wp\_cron ), |
| [302](#L302) | 'key'  => $doing\_wp\_cron, |
| [303](#L303) | 'args' => array( |
| [304](#L304) | 'timeout'   => 3, |
| [305](#L305) | 'blocking'  => true, |
| [306](#L306) | 'sslverify' => apply\_filters( 'https\_local\_ssl\_verify', $sslverify ), |
| [307](#L307) | ), |
| [308](#L308) | ) ); |
| [309](#L309) |  |
| [310](#L310) | $cron\_request['args']['blocking'] = true; |
| [311](#L311) |  |
| [312](#L312) | $result = wp\_remote\_post( $cron\_request['url'], $cron\_request['args'] ); |
| [313](#L313) |  |
| [314](#L314) | if ( is\_wp\_error( $result ) ) { |
| [315](#L315) | return $result; |
| [316](#L316) | } elseif ( wp\_remote\_retrieve\_response\_code( $result ) >= 300 ) { |
| [317](#L317) | return new WP\_Error( 'unexpected\_http\_response\_code', sprintf( |
| [318](#L318) | /\* translators: 1: The HTTP response code. \*/ |
| [319](#L319) | \_\_( 'Unexpected HTTP response code: %s', 'wp-cron' ), |
| [320](#L320) | intval( wp\_remote\_retrieve\_response\_code( $result ) ) |
| [321](#L321) | ) ); |
| [322](#L322) | } else { |
| [323](#L323) | set\_transient( 'wp-cron-test-ok', 1, 3600 ); |
| [324](#L324) | return true; |
| [325](#L325) | } |
| [326](#L326) |  |
| [327](#L327) | } |
| [328](#L328) | /\*\* |
| [329](#L329) | \* Shows the status of cron functionality on the site. Only displays a message when there's a problem. |
| [330](#L330) | \*/ |
| [331](#L331) | public function show\_cron\_status() { |
| [332](#L332) |  |
| [333](#L333) | $status = $this->test\_cron\_spawn(); |
| [334](#L334) |  |
| [335](#L335) | if ( is\_wp\_error( $status ) ) { |
| [336](#L336) | if ( 'cron\_info' === $status->get\_error\_code() ) { |
| [337](#L337) | ?> |
| [338](#L338) | <div id="cron-status-notice" class="notice notice-info"> |
| [339](#L339) | <p><?php echo esc\_html( $status->get\_error\_message() ); ?></p> |
| [340](#L340) | </div> |
| [341](#L341) | <?php |
| [342](#L342) | } else { |
| [343](#L343) | ?> |
| [344](#L344) | <div id="cron-status-error" class="error"> |
| [345](#L345) | <p> |
| [346](#L346) | <?php |
| [347](#L347) | printf( |
| [348](#L348) | /\* translators: 1: Error message text. \*/ |
| [349](#L349) | esc\_html\_\_( 'There was a problem with your cron configuration. The cron events on your site may not work. The problem was: %s', 'wp-cron' ), |
| [350](#L350) | '<br><strong>' . esc\_html( $status->get\_error\_message() ) . '</strong>' |
| [351](#L351) | ); |
| [352](#L352) | ?> |
| [353](#L353) | </p> |
| [354](#L354) | </div> |
| [355](#L355) | <?php |
| [356](#L356) | } |
| [357](#L357) | } |
| [358](#L358) | } |
| [359](#L359) |  |
| [360](#L360) | /\*\* |
| [361](#L361) | \* Register and add settings |
| [362](#L362) | \*/ |
| [363](#L363) | public function page\_init() |
| [364](#L364) | { |
| [365](#L365) |  |
| [366](#L366) | register\_setting( |
| [367](#L367) | 'pcr\_ext\_option\_group', // Option group |
| [368](#L368) | 'pcr\_feed\_options', // Option name |
| [369](#L369) | array( $this, 'sanitize' ) // Sanitize |
| [370](#L370) | ); |
| [371](#L371) |  |
| [372](#L372) | add\_settings\_section( |
| [373](#L373) | 'setting\_section\_id', // ID |
| [374](#L374) | 'PCRecruiter Feed Settings (Optional)', // Title |
| [375](#L375) | array( $this, 'print\_section\_info' ), // Callback |
| [376](#L376) | 'pcr-ext-setting-admin' // Page |
| [377](#L377) | ); |
| [378](#L378) |  |
| [379](#L379) | add\_settings\_field( |
| [380](#L380) | 'activation', |
| [381](#L381) | 'Job Feed Enabled', |
| [382](#L382) | array( $this, 'activation\_callback' ), |
| [383](#L383) | 'pcr-ext-setting-admin', |
| [384](#L384) | 'setting\_section\_id' |
| [385](#L385) | ); |
| [386](#L386) |  |
| [387](#L387) | add\_settings\_field( |
| [388](#L388) | 'frequency', |
| [389](#L389) | 'Frequency of Update', |
| [390](#L390) | array( $this, 'frequency\_callback' ), |
| [391](#L391) | 'pcr-ext-setting-admin', |
| [392](#L392) | 'setting\_section\_id' |
| [393](#L393) | ); |
| [394](#L394) |  |
| [395](#L395) | add\_settings\_field( |
| [396](#L396) | 'id\_number', // ID |
| [397](#L397) | 'PCR SessionID', // Title |
| [398](#L398) | array( $this, 'id\_number\_callback' ), // Callback |
| [399](#L399) | 'pcr-ext-setting-admin', // Page |
| [400](#L400) | 'setting\_section\_id' // Section |
| [401](#L401) | ); |
| [402](#L402) |  |
| [403](#L403) | add\_settings\_field( |
| [404](#L404) | 'standard\_fields', // ID |
| [405](#L405) | 'Standard Fields', // Title |
| [406](#L406) | array( $this, 'standard\_fields\_callback' ), // Callback |
| [407](#L407) | 'pcr-ext-setting-admin', // Page |
| [408](#L408) | 'setting\_section\_id' // Section |
| [409](#L409) | ); |
| [410](#L410) |  |
| [411](#L411) | add\_settings\_field( |
| [412](#L412) | 'custom\_fields', // ID |
| [413](#L413) | 'Custom Fields', // Title |
| [414](#L414) | array( $this, 'custom\_fields\_callback' ), // Callback |
| [415](#L415) | 'pcr-ext-setting-admin', // Page |
| [416](#L416) | 'setting\_section\_id' // Section |
| [417](#L417) | ); |
| [418](#L418) |  |
| [419](#L419) | add\_settings\_field( |
| [420](#L420) | 'query', // ID |
| [421](#L421) | 'Query', // Title |
| [422](#L422) | array( $this, 'query\_callback' ), // Callback |
| [423](#L423) | 'pcr-ext-setting-admin', // Page |
| [424](#L424) | 'setting\_section\_id' // Section |
| [425](#L425) | ); |
| [426](#L426) |  |
| [427](#L427) | add\_settings\_field( |
| [428](#L428) | 'mode', // ID |
| [429](#L429) | 'Mode', // Title |
| [430](#L430) | array( $this, 'mode\_callback' ), // Callback |
| [431](#L431) | 'pcr-ext-setting-admin', // Page |
| [432](#L432) | 'setting\_section\_id' // Section |
| [433](#L433) | ); |
| [434](#L434) | } |
| [435](#L435) |  |
| [436](#L436) | /\*\* |
| [437](#L437) | \* Sanitize each setting field as needed |
| [438](#L438) | \* |
| [439](#L439) | \* @param array $input Contains all settings fields as array keys |
| [440](#L440) | \*/ |
| [441](#L441) | public function sanitize( $input ) |
| [442](#L442) | { |
| [443](#L443) | $new\_input = array(); |
| [444](#L444) |  |
| [445](#L445) |  |
| [446](#L446) | if( isset( $input['activation'] ) ) |
| [447](#L447) | $new\_input['activation'] = sanitize\_text\_field( $input['activation'] ); |
| [448](#L448) |  |
| [449](#L449) | if( isset( $input['frequency'] ) ) |
| [450](#L450) | $new\_input['frequency'] = sanitize\_text\_field( $input['frequency'] ); |
| [451](#L451) |  |
| [452](#L452) | if( isset( $input['id\_number'] ) ) |
| [453](#L453) | $new\_input['id\_number'] = $input['id\_number']; |
| [454](#L454) |  |
| [455](#L455) | if( isset( $input['standard\_fields'] ) ) |
| [456](#L456) | $new\_input['standard\_fields'] = sanitize\_text\_field( $input['standard\_fields'] ); |
| [457](#L457) |  |
| [458](#L458) | if( isset( $input['custom\_fields'] ) ) |
| [459](#L459) | $new\_input['custom\_fields'] = sanitize\_text\_field( $input['custom\_fields'] ); |
| [460](#L460) |  |
| [461](#L461) | if( isset( $input['query'] ) ) |
| [462](#L462) | $new\_input['query'] = $input['query']; |
| [463](#L463) |  |
| [464](#L464) | if( isset( $input['mode'] ) ) |
| [465](#L465) | $new\_input['mode'] = $input['mode']; |
| [466](#L466) |  |
| [467](#L467) | return $new\_input; |
| [468](#L468) | } |
| [469](#L469) |  |
| [470](#L470) | /\*\* |
| [471](#L471) | \* Print the Section text |
| [472](#L472) | \*/ |
| [473](#L473) | public function print\_section\_info() |
| [474](#L474) | { |
| [475](#L475) | echo '<p>When enabled, this feature will duplicate PCRecruiter\'s dynamic RSS feed as a static file at <a target="\_blank" href="'. esc\_url( site\_url() ) .'/wp-content/uploads/pcrjobfeed.xml">'. esc\_url( site\_url() ) .'/wp-content/uploads/pcrjobfeed.xml</a>. You may use this data as a source for plugins and other third-party feed utilities.</p>'; |
| [476](#L476) | // Check to see if "Store Local Feed" is active. If it is, show the manual save button |
| [477](#L477) | if($this->options['activation'] ?? false){ |
| [478](#L478) | $filename = 'pcrjobfeed.xml'; |
| [479](#L479) | $fname = WP\_CONTENT\_DIR . "/uploads/".$filename; |
| [480](#L480) | if (file\_exists($fname)) { |
| [481](#L481) | $d = date ("F d Y H:i:s", filectime($fname)); |
| [482](#L482) | echo "<em style=\"font-weight:bold\">" . esc\_html( $filename ) . " last updated: " . esc\_html( $d ) . " (UTC).</em>"; |
| [483](#L483) | } else { |
| [484](#L484) | echo "<i>File " . esc\_html( $fname ) . " doesn't exist...</i>"; |
| [485](#L485) | } |
| [486](#L486) | } |
| [487](#L487) | } |
| [488](#L488) |  |
| [489](#L489) | /\*\* |
| [490](#L490) | \* Get the settings option array and print one of its values |
| [491](#L491) | \*/ |
| [492](#L492) |  |
| [493](#L493) | public function activation\_callback() |
| [494](#L494) | { |
| [495](#L495) | printf( |
| [496](#L496) | '<input id="activation" name="pcr\_feed\_options[activation]" type="checkbox" %2$s />', |
| [497](#L497) | 'activation', |
| [498](#L498) | checked( isset( $this->options['activation'] ), true, false ) |
| [499](#L499) | ); |
| [500](#L500) | } |
| [501](#L501) |  |
| [502](#L502) | public function frequency\_callback() |
| [503](#L503) | { |
| [504](#L504) | $options = $this->options['frequency']; |
| [505](#L505) | $items = array("daily", "hourly", "twicedaily"); |
| [506](#L506) | echo "<select id='frequency' name='pcr\_feed\_options[frequency]'>"; |
| [507](#L507) | foreach($items as $item) { |
| [508](#L508) | $selected = ($this->options['frequency'] == $item) ? 'selected="selected"' : ''; |
| [509](#L509) | echo "<option value='" . esc\_attr( $item ) . "' " . esc\_attr( $selected ) . ">" . esc\_html( $item ) . "</option>"; |
| [510](#L510) | } |
| [511](#L511) | echo "</select>"; |
| [512](#L512) | } |
| [513](#L513) |  |
| [514](#L514) | public function id\_number\_callback() |
| [515](#L515) | { |
| [516](#L516) | printf( |
| [517](#L517) | '<input type="text" id="id\_number" name="pcr\_feed\_options[id\_number]" value="%s" size="60" />', |
| [518](#L518) | isset( $this->options['id\_number'] ) ? esc\_attr( $this->options['id\_number']) : '' |
| [519](#L519) | ); |
| [520](#L520) | } |
| [521](#L521) |  |
| [522](#L522) | public function standard\_fields\_callback() |
| [523](#L523) | { |
| [524](#L524) | printf( |
| [525](#L525) | '<input type="text" id="standard\_fields" name="pcr\_feed\_options[standard\_fields]" value="%s" size="60" /><br /><span style="font-size:.8em;">Comma separated.</span>', |
| [526](#L526) | isset( $this->options['standard\_fields'] ) ? esc\_attr( $this->options['standard\_fields']) : '' |
| [527](#L527) | ); |
| [528](#L528) | } |
| [529](#L529) |  |
| [530](#L530) | public function custom\_fields\_callback() |
| [531](#L531) | { |
| [532](#L532) |  |
| [533](#L533) | printf( |
| [534](#L534) | '<input type="text" id="custom\_fields" name="pcr\_feed\_options[custom\_fields]" value="%s" size="60" /><br /><span style="font-size:.8em;">Comma separated. Be sure to replace any %%20 characters with spaces.</span>', |
| [535](#L535) | isset( $this->options['custom\_fields'] ) ? esc\_attr( $this->options['custom\_fields']) : '' |
| [536](#L536) | ); |
| [537](#L537) | } |
| [538](#L538) |  |
| [539](#L539) | public function query\_callback() |
| [540](#L540) | { |
| [541](#L541) | printf( |
| [542](#L542) | '<input type="text" id="query" name="pcr\_feed\_options[query]" value="%s" rows="4" size="60" />', |
| [543](#L543) | isset( $this->options['query'] ) ? esc\_attr( $this->options['query']) : '' |
| [544](#L544) | ); |
| [545](#L545) | } |
| [546](#L546) |  |
| [547](#L547) | public function mode\_callback() |
| [548](#L548) | { |
| [549](#L549) | if($this->options['mode'] == "job"){ |
| [550](#L550) | $check1 = "checked"; |
| [551](#L551) | $check2 = ""; |
| [552](#L552) | } else if($this->options['mode'] == "apply"){ |
| [553](#L553) | $check2 = "checked"; |
| [554](#L554) | $check1 = ""; |
| [555](#L555) | } else { |
| [556](#L556) | $check1 = "checked"; |
| [557](#L557) | $check2 = ""; |
| [558](#L558) | } |
| [559](#L559) | printf('<input type="radio" id="%s" name="pcr\_feed\_options[mode]" value="job" %s /> %s<br />', |
| [560](#L560) | esc\_attr('job'), |
| [561](#L561) | esc\_attr($check1), |
| [562](#L562) | esc\_html('Job Link') |
| [563](#L563) | ); |
| [564](#L564) | printf('<input type="radio" id="%s" name="pcr\_feed\_options[mode]" value="apply" %s /> %s<br />', |
| [565](#L565) | esc\_attr('apply'), |
| [566](#L566) | esc\_attr($check2), |
| [567](#L567) | esc\_html('Apply Link') |
| [568](#L568) | ); |
| [569](#L569) | } |
| [570](#L570) | } |
| [571](#L571) |  |
| [572](#L572) |  |
| [573](#L573) |  |
| [574](#L574) | /\* Begin update cron schedule if frequency changes \*/ |
| [575](#L575) | function update\_cron() { |
| [576](#L576) | register\_setting('pcr\_ext\_option\_group', 'pcr\_feed\_options'); |
| [577](#L577) | } |
| [578](#L578) | add\_action('admin\_init', 'update\_cron'); |
| [579](#L579) |  |
| [580](#L580) | function do\_after\_update($old, $new) { |
| [581](#L581) | // Do the stuff here |
| [582](#L582) | $pcr\_feed\_options = get\_option('pcr\_feed\_options', array()); |
| [583](#L583) | $current\_frequency = $pcr\_feed\_options['frequency']; |
| [584](#L584) | $activated = $pcr\_feed\_options['activation'] ?? ''; |
| [585](#L585) | wp\_clear\_scheduled\_hook('pcr\_feed'); |
| [586](#L586) | if($activated){ |
| [587](#L587) | wp\_schedule\_event( time(), $current\_frequency, 'pcr\_feed' ); |
| [588](#L588) | pcr\_feed\_func(); |
| [589](#L589) | } else { |
| [590](#L590) | $feedlinkxml = WP\_CONTENT\_DIR . "/uploads/pcrjobfeed.xml"; |
| [591](#L591) | $feedlinkjson = WP\_CONTENT\_DIR . "/uploads/pcrjobfeed.json"; |
| [592](#L592) | if (file\_exists($feedlinkxml)) { |
| [593](#L593) | unlink(WP\_CONTENT\_DIR . "/uploads/pcrjobfeed.xml"); |
| [594](#L594) | } else {} |
| [595](#L595) | if (file\_exists($feedlinkjson)) { |
| [596](#L596) | unlink(WP\_CONTENT\_DIR . "/uploads/pcrjobfeed.json"); |
| [597](#L597) | } else {} |
| [598](#L598) | } |
| [599](#L599) | } |
| [600](#L600) | add\_action('update\_option\_pcr\_feed\_options','do\_after\_update', 10, 2); |
| [601](#L601) | /\* End update cron schedule if frequency changes \*/ |
| [602](#L602) |  |
| [603](#L603) |  |
| [604](#L604) | if( is\_admin() ) |
| [605](#L605) | $my\_settings\_page = new PcrSettingsPage(); |
| [606](#L606) |  |
| [607](#L607) | // JS for Admin Panel |
| [608](#L608) | function pcr\_settings\_scripts(){ |
| [609](#L609) | wp\_enqueue\_media(); |
| [610](#L610) | wp\_register\_script('pcr-settings-scripts',plugin\_dir\_url( \_\_DIR\_\_ ) .'pcrecruiter-extensions/assets/js/pcr-admin.js', array('jquery'), '1.0.0', true); |
| [611](#L611) | wp\_enqueue\_script('pcr-settings-scripts'); |
| [612](#L612) | } |
| [613](#L613) | add\_action( 'admin\_enqueue\_scripts', 'pcr\_settings\_scripts' ); |

**Note:** See [TracBrowser](/wiki/TracBrowser)
for help on using the repository browser.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Plain Text](/browser/pcrecruiter-extensions/trunk/PCRecruiter-Extensions.php?format=txt)
* [Original Format](/export/3222683/pcrecruiter-extensions/trunk/PCRecruiter-Extensions.php)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)


