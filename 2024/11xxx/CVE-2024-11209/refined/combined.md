=== Content from gist.github.com_c3ef6d7d_20250114_191542.html ===

[Skip to content](#start-of-content)

[All gists](/discover)
[Back to GitHub](https://github.com)
[Sign in](https://gist.github.com/auth/github?return_to=https%3A%2F%2Fgist.github.com%2F0xArthurSouza%2F281e8ea8a797abc8371a8ced31dc5562)
[Sign up](/join?return_to=https%3A%2F%2Fgist.github.com%2F0xArthurSouza%2F281e8ea8a797abc8371a8ced31dc5562&source=header-gist)

[Sign in](https://gist.github.com/auth/github?return_to=https%3A%2F%2Fgist.github.com%2F0xArthurSouza%2F281e8ea8a797abc8371a8ced31dc5562) [Sign up](/join?return_to=https%3A%2F%2Fgist.github.com%2F0xArthurSouza%2F281e8ea8a797abc8371a8ced31dc5562&source=header-gist)

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

Instantly share code, notes, and snippets.

[![@0xArthurSouza](https://avatars.githubusercontent.com/u/61798441?s=64&v=4)](/0xArthurSouza)

# [0xArthurSouza](/0xArthurSouza)/**[Multi-Factor Authentication (MFA) Bypass via Execution Manipulation in CAS.md](/0xArthurSouza/281e8ea8a797abc8371a8ced31dc5562)** Secret

Created
November 5, 2024 00:36

Show Gist options

* [Download ZIP](/0xArthurSouza/281e8ea8a797abc8371a8ced31dc5562/archive/6287119509635c493c4edebc1850e80276003529.zip)

* [Star
  (0)
  0](/login?return_to=https%3A%2F%2Fgist.github.com%2F0xArthurSouza%2F281e8ea8a797abc8371a8ced31dc5562)You must be signed in to star a gist
* [Fork
  (0)
  0](/login?return_to=https%3A%2F%2Fgist.github.com%2F0xArthurSouza%2F281e8ea8a797abc8371a8ced31dc5562)You must be signed in to fork a gist

* Embed

  + Embed
     Embed this gist in your website.
  + Share
     Copy sharable link for this gist.
  + Clone via HTTPS
     Clone using the web URL.
  + [Learn more about clone URLs](https://docs.github.com/articles/which-remote-url-should-i-use)

  Clone this repository at &lt;script src=&quot;https://gist.github.com/0xArthurSouza/281e8ea8a797abc8371a8ced31dc5562.js&quot;&gt;&lt;/script&gt;
* Save 0xArthurSouza/281e8ea8a797abc8371a8ced31dc5562 to your computer and use it in GitHub Desktop.

[Code](/0xArthurSouza/281e8ea8a797abc8371a8ced31dc5562)
[Revisions
1](/0xArthurSouza/281e8ea8a797abc8371a8ced31dc5562/revisions)

Embed

* Embed
   Embed this gist in your website.
* Share
   Copy sharable link for this gist.
* Clone via HTTPS
   Clone using the web URL.
* [Learn more about clone URLs](https://docs.github.com/articles/which-remote-url-should-i-use)

Clone this repository at &lt;script src=&quot;https://gist.github.com/0xArthurSouza/281e8ea8a797abc8371a8ced31dc5562.js&quot;&gt;&lt;/script&gt;

Save 0xArthurSouza/281e8ea8a797abc8371a8ced31dc5562 to your computer and use it in GitHub Desktop.

[Download ZIP](/0xArthurSouza/281e8ea8a797abc8371a8ced31dc5562/archive/6287119509635c493c4edebc1850e80276003529.zip)

 [Raw](/0xArthurSouza/281e8ea8a797abc8371a8ced31dc5562/raw/6287119509635c493c4edebc1850e80276003529/Multi-Factor%2520Authentication%2520%28MFA%29%2520Bypass%2520via%2520Execution%2520Manipulation%2520in%2520CAS.md)

[**Multi-Factor Authentication (MFA) Bypass via Execution Manipulation in CAS.md**](#file-multi-factor-authentication-mfa-bypass-via-execution-manipulation-in-cas-md)

## **Affected Version:**

* **Apereo CAS**: 6.6.x
* [apereo/cas: Apereo CAS - Identity & Single Sign On for all earthlings and beyond.](https://github.com/apereo/cas)

## **Vulnerability Information:**

* **Vulnerability Type:** Multi-Factor Authentication (MFA) Bypass via Execution Manipulation in CAS
* **Status:** Unpatched

## **Vulnerable Endpoint:**

* **Path:** `/login?service=`

## **Vulnerability Description:**

The web application allows the reuse of an *execution* generated during the authentication process, which enables bypassing critical validation steps, such as credential verification, CAPTCHA, and OTP code entry. The *execution* generated after the OTP input can be captured from a valid session and reused in subsequent login attempts, allowing an attacker to bypass all required authentication steps and gain direct access to the application without providing valid credentials or an OTP.

This enables attackers to compromise the authentication process, facilitating unauthorized access to the application without the need for valid credentials or OTP verification. This could result in the compromise of user accounts, including privileged accounts, and expose the system to further attacks, such as data theft, information manipulation, and malicious actions within the authenticated environment.

---

## **Proof of Concept (PoC):**

During the authentication process, password, CAPTCHA validation, and an OTP code generated by CAS (Central Authentication Service) are required.

Using a tool like Burp Suite to monitor requests, the following flow is observed:

* The client performs a `POST /login?service=https%3A%2F%2Fsmtplw.com.br%2Fusers%2Fservice HTTP/1.1`, which generates an *execution*.

<https://ibb.co/q7BMP5m>

For the OTP, the application sends the *execution* generated from the provided credentials and returns a second *execution* in the response:

<https://ibb.co/xGTk6Qz>

Subsequent requests are used only for device registration and redirection to the requested application. It was identified that the *execution* generated after the OTP input can be reused to bypass both credential and OTP verification steps.

If this *execution* is captured from a valid session, it can be reused to bypass the entire CAS validation process, including credential verification, CAPTCHA, and OTP. Even when entering invalid credentials, such as a nonexistent username or password, it is possible to inspect the response with Burp Suite and manipulate the request by inserting the captured *execution*. This way, the attacker would be redirected to the application without proper authentication validation.

<https://ibb.co/mBCftWD>

After response manipulation:

<https://ibb.co/drQwgLG>

<https://ibb.co/fQT6Zj3>

The application correctly validates credentials and CAPTCHA before requesting the OTP. However, by manipulating the response with a valid *execution*, it is possible to bypass these validations, including the OTP verification. The user is then redirected to the device registration screen and subsequently to the requested application, without completing the required authentication steps.

## **Impact:**

* **Account Takeover:** Attackers could bypass the MFA requirement, gaining unauthorized access to user accounts and sensitive information.
* **Privilege Escalation:** Once authenticated, attackers could access restricted areas or perform actions at a higher privilege level.
* **Data Breach Risk:** Unauthorized access may lead to data exposure, with attackers viewing, modifying, or deleting sensitive data.
* **Compliance Violation:** Security regulations requiring MFA could be violated, leading to potential legal and compliance issues.
* **Reputational Damage:** Bypassing MFA reduces trust in the application’s security measures, as users may perceive it as vulnerable to targeted attacks.

---

## **Mitigation Recommendations:**

* **Strict MFA Enforcement:** Ensure MFA validation is consistently enforced across all entry points, and any modifications to the authentication flow require MFA re-authentication.
* **Request Validation Tokens:** Use request-specific tokens that verify MFA completion at each sensitive action, ensuring it was validated by the user.
* **Session Binding:** Bind MFA status to session attributes, preventing attackers from altering session state to bypass MFA requirements.
* **Monitoring and Alerts:** Implement logging and monitoring for suspicious access patterns, such as attempts to bypass MFA, and alert administrators of potential exploitation.
* **Regular Security Testing and Auditing:** Conduct penetration tests and audits focusing on MFA integrity, especially in the CAS flow, to detect and fix bypass vulnerabilities.

---

[Sign up for free](/join?source=comment-gist)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgist.github.com%2F0xArthurSouza%2F281e8ea8a797abc8371a8ced31dc5562)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


