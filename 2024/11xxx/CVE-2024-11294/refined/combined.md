=== Content from www.wordfence.com_5fe45516_20250114_192408.html ===


[![](https://www.wordfence.com/img/wordfence-intelligence-logo.svg)](/threat-intel/)

Have you found a vulnerability in a WordPress plugin or theme? Report vulnerabilities in WordPress plugins and themes through our [bug bounty program](https://www.wordfence.com/threat-intel/bug-bounty-program) and earn a bounty on all in-scope submissions, while we handle the responsible disclosure process on your behalf.

As a reminder, the Wordfence Intelligence Vulnerability Database API is completely free to query and utilize, both personally and commercially, and contains all the same vulnerability data as the user interface. Please review the API documentation and Webhook documentation for more information on how to query the vulnerability API endpoints and configure webhooks utilizing all the same data present in the Wordfence Intelligence user interface.

# Memberful <= 1.73.9 - Unauthenticated Content Restriction Bypass to Sensitive Information Exposure

 [Wordfence Intelligence](https://www.wordfence.com/threat-intel)   >    [Vulnerability Database](https://www.wordfence.com/threat-intel/vulnerabilities)   >   Memberful <= 1.73.9 - Unauthenticated Content Restriction Bypass to Sensitive Information Exposure

5.3

**Exposure of Sensitive Information to an Unauthorized Actor**
**CVSS Vector**
[CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:L/I:N/A:N](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:L/I:N/A:N)

| CVE | [CVE-2024-11294](https://www.cve.org/CVERecord?id=CVE-2024-11294) |
| --- | --- |
| CVSS | 5.3 (Medium) |
| Publicly Published | December 16, 2024 |
| Last Updated | December 17, 2024 |
| Researcher | [Francesco Carlucci](https://www.wordfence.com/threat-intel/vulnerabilities/researchers/francesco-carlucci) |

### Description

The Memberful plugin for WordPress is vulnerable to Sensitive Information Exposure in all versions up to, and including, 1.73.9 via the WordPress core search feature. This makes it possible for unauthenticated attackers to extract sensitive data from posts that have been restricted to higher-level roles such as site members.

#### References

* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/changeset/3204895/memberful-wp)

#### Share

[Facebook](https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fmemberful-wp%2Fmemberful-1739-unauthenticated-content-restriction-bypass-to-sensitive-information-exposure&t=Memberful%20%3C%3D%201.73.9%20-%20Unauthenticated%20Content%20Restriction%20Bypass%20to%20Sensitive%20Information%20Exposure "Facebook")
[Twitter](https://twitter.com/share?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fmemberful-wp%2Fmemberful-1739-unauthenticated-content-restriction-bypass-to-sensitive-information-exposure&text=Memberful%20%3C%3D%201.73.9%20-%20Unauthenticated%20Content%20Restriction%20Bypass%20to%20Sensitive%20Information%20Exposure "Twitter")
[LinkedIn](https://www.linkedin.com/shareArticle?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fmemberful-wp%2Fmemberful-1739-unauthenticated-content-restriction-bypass-to-sensitive-information-exposure "LinkedIn")
Email

## Vulnerability Details for Memberful – Membership Plugin

#### [Memberful – Membership Plugin](https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/memberful-wp)

| Software Type | Plugin |
| --- | --- |
| Software Slug | memberful-wp [(view on wordpress.org)](https://wordpress.org/plugins/memberful-wp) |
| Patched? | Yes |
| Remediation | Update to version 1.74.0, or a newer patched version |
| Affected Version | * <= 1.73.9 |
| Patched Version | * 1.74.0 |

This record contains material that is subject to copyright.

**Copyright 2012-2025 Defiant Inc.**

**License:**
Defiant hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute this software vulnerability information. Any copy of the software vulnerability information you make for such purposes is authorized provided that you include a hyperlink to this vulnerability record and reproduce Defiant's copyright designation and this license in any such copy.
**[Read more.](https://www.wordfence.com/wordfence-intelligence-terms-and-conditions/)**

**Copyright 1999-2025 The MITRE Corporation**

**License:**
CVE Usage: MITRE hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute Common Vulnerabilities and Exposures (CVE®). Any copy you make for such purposes is authorized provided that you reproduce MITRE's copyright designation and this license in any such copy.
**[Read more.](https://www.cve.org/Legal/TermsOfUse)**

Have information to add, or spot any errors? Contact us at wfi-support@wordfence.com so we can make any appropriate adjustments.

Did you know Wordfence Intelligence provides free personal and commercial API access to our comprehensive WordPress vulnerability database, along with a free webhook integration to stay on top of the latest vulnerabilities added and updated in the database? Get started today!

Learn more

Want to get notified of the latest vulnerabilities that may affect your WordPress site?
 Install Wordfence on your site today to get notified immediately if your site is affected by a vulnerability that has been added to our database.

Get Wordfence

The Wordfence Intelligence WordPress vulnerability database is completely free to access and query via API. Please review the documentation on how to access and consume the vulnerability data via API.

Documentation



=== Content from plugins.trac.wordpress.org_459759f7_20250114_192407.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fchangeset%2F3204895%2Fmemberful-wp)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Change](/changeset/3170895/memberful-wp "Changeset 3170895 for memberful-wp")
* [Next Change](/changeset/3204896/memberful-wp "Changeset 3204896 for memberful-wp") →

---

# Changeset [3204895](/changeset/3204895 "Show full changeset") for [memberful-wp](/browser/memberful-wp?rev=3204895 "Show entry in browser")

View differences
inline
side by side

Show
lines around each change

Show the changes in full context

Ignore:

Blank lines

Case changes

White space changes

Timestamp:
12/09/2024 01:47:05 PM
([5 weeks](/timeline?from=2024-12-09T13%3A47%3A05Z&precision=second "See timeline at 12/09/2024 01:47:05 PM") ago)

Author:
patrikmemberful
Message:

Tagging version 1.74.0

Location:
[memberful-wp/trunk](/browser/memberful-wp/trunk?rev=3204895)
Files:

1 added
7 edited

* [memberful-wp.php](/browser/memberful-wp/trunk/memberful-wp.php?rev=3204895 "Show entry in browser")
  (modified)
  ([3 diffs](#file0 "Show differences"))
* [readme.txt](/browser/memberful-wp/trunk/readme.txt?rev=3204895 "Show entry in browser")
  (modified)
  ([2 diffs](#file1 "Show differences"))
* [src/acl.php](/browser/memberful-wp/trunk/src/acl.php?rev=3204895 "Show entry in browser")
  (modified)
  ([5 diffs](#file2 "Show differences"))
* [src/acl/post\_options.php](/browser/memberful-wp/trunk/src/acl/post_options.php?rev=3204895 "Show entry in browser")
  (modified)
  ([4 diffs](#file3 "Show differences"))
* [src/acl/term\_options.php](/browser/memberful-wp/trunk/src/acl/term_options.php?rev=3204895 "Show entry in browser")
  (modified)
  ([4 diffs](#file4 "Show differences"))
* [src/global\_marketing.php](/browser/memberful-wp/trunk/src/global_marketing.php?rev=3204895 "Show entry in browser")
  (modified)
  ([2 diffs](#file5 "Show differences"))
* [src/marketing\_content.php](/browser/memberful-wp/trunk/src/marketing_content.php?rev=3204895 "Show entry in browser")
  (modified)
  ([1 diff](#file6 "Show differences"))
* [src/search\_filter.php](/browser/memberful-wp/trunk/src/search_filter.php?rev=3204895 "Show entry in browser")
  (added)

### Legend:

Unmodified
Added
Removed

* ## [memberful-wp/trunk/memberful-wp.php](/changeset/3204895/memberful-wp/trunk/memberful-wp.php "Show the changeset 3204895 restricted to memberful-wp/trunk/memberful-wp.php")

  | [r3170893](/browser/memberful-wp/trunk/memberful-wp.php?rev=3170893#L4 "Show revision 3170893 of this file in browser") | [r3204895](/browser/memberful-wp/trunk/memberful-wp.php?rev=3204895#L4 "Show revision 3204895 of this file in browser") |  |
  | --- | --- | --- |
  | 4 | 4 | Plugin URI: http://github.com/memberful/memberful-wp |
  | 5 | 5 | Description: Sell memberships and restrict access to content with WordPress and Memberful. |
  | 6 |  | Version: 1.7~~3.9~~ |
  |  | 6 | Version: 1.74.0 |
  | 7 | 7 | Author: Memberful |
  | 8 | 8 | Author URI: http://memberful.com |
  | […](/browser/memberful-wp/trunk/memberful-wp.php?rev=3170893#L11) | […](/browser/memberful-wp/trunk/memberful-wp.php?rev=3204895#L11) |  |
  | 11 | 11 |  |
  | 12 | 12 | if ( ! defined( 'MEMBERFUL\_VERSION' ) ) |
  | 13 |  | define( 'MEMBERFUL\_VERSION', '1.7~~3.9~~' ); |
  |  | 13 | define( 'MEMBERFUL\_VERSION', '1.74.0' ); |
  | 14 | 14 |  |
  | 15 | 15 | if ( ! defined( 'MEMBERFUL\_PLUGIN\_FILE' ) ) |
  | […](/browser/memberful-wp/trunk/memberful-wp.php?rev=3170893#L47) | […](/browser/memberful-wp/trunk/memberful-wp.php?rev=3204895#L47) |  |
  | 47 | 47 | require\_once MEMBERFUL\_DIR . '/src/marketing\_content.php'; |
  | 48 | 48 | require\_once MEMBERFUL\_DIR . '/src/content\_filter.php'; |
  |  | 49 | require\_once MEMBERFUL\_DIR . '/src/search\_filter.php'; |
  | 49 | 50 | require\_once MEMBERFUL\_DIR . '/src/entities.php'; |
  | 50 | 51 | require\_once MEMBERFUL\_DIR . '/src/embed.php'; |
* ## [memberful-wp/trunk/readme.txt](/changeset/3204895/memberful-wp/trunk/readme.txt "Show the changeset 3204895 restricted to memberful-wp/trunk/readme.txt")

  | [r3170893](/browser/memberful-wp/trunk/readme.txt?rev=3170893#L5 "Show revision 3170893 of this file in browser") | [r3204895](/browser/memberful-wp/trunk/readme.txt?rev=3204895#L5 "Show revision 3204895 of this file in browser") |  |
  | --- | --- | --- |
  | 5 | 5 | Tested up to: 6.5 |
  | 6 | 6 | Requires PHP: 7.0 |
  | 7 |  | Stable tag: 1.7~~3.9~~ |
  |  | 7 | Stable tag: 1.74.0 |
  | 8 | 8 | License: GPLv2 or later |
  | 9 | 9 |  |
  | […](/browser/memberful-wp/trunk/readme.txt?rev=3170893#L112) | […](/browser/memberful-wp/trunk/readme.txt?rev=3204895#L112) |  |
  | 112 | 112 | == Changelog == |
  | 113 | 113 |  |
  |  | 114 | = 1.74.0 = |
  |  | 115 |  |
  |  | 116 | \* Exclude protected posts from search results |
  |  | 117 | \* Improve teaser generation for global marketing content |
  |  | 118 |  |
  | 114 | 119 | = 1.73.9 = |
  | 115 | 120 |  |
* ## [memberful-wp/trunk/src/acl.php](/changeset/3204895/memberful-wp/trunk/src/acl.php "Show the changeset 3204895 restricted to memberful-wp/trunk/src/acl.php")

  | [r2656824](/browser/memberful-wp/trunk/src/acl.php?rev=2656824#L5 "Show revision 2656824 of this file in browser") | [r3204895](/browser/memberful-wp/trunk/src/acl.php?rev=3204895#L5 "Show revision 3204895 of this file in browser") |  |
  | --- | --- | --- |
  | 5 | 5 |  |
  | 6 | 6 | /\*\* |
  | 7 |  | \* Determines the set of post IDs that the current user cannot access |
  | 8 |  | \* |
  | 9 |  | \* If a page/post requires products a,b then the user will be granted access |
  | 10 |  | \* to the content if they have bought either product a or b |
  | 11 |  | \* |
  | 12 |  | \* TODO: This is calculated on every page load, maybe use a cache? |
  | 13 |  | \* |
  | 14 |  | \* @return array Map of post ID => post ID |
  |  | 7 | \* Returns an array of post IDs that the user is not allowed to access. |
  |  | 8 | \* Includes posts disallowed by both Post ACL and Term ACL. |
  |  | 9 | \* |
  |  | 10 | \* @return array An array of post IDs that the user is not allowed to access. |
  | 15 | 11 | \*/ |
  | 16 | 12 | function memberful\_wp\_user\_disallowed\_post\_ids( $user\_id ) { |
  | 17 |  | if ( isset( $disallowed\_post\_ids )) { |
  | 18 |  | return $disallowed\_post\_ids; |
  |  | 13 | $user\_posts = \_memberful\_wp\_items\_from\_acl( |
  |  | 14 | get\_option( 'memberful\_acl', array() ), |
  |  | 15 | $user\_id, |
  |  | 16 | memberful\_wp\_posts\_for\_subscribers(), |
  |  | 17 | memberful\_wp\_posts\_for\_registered\_users() |
  |  | 18 | ); |
  |  | 19 |  |
  |  | 20 | $user\_terms = \_memberful\_wp\_items\_from\_acl( |
  |  | 21 | get\_option( 'memberful\_term\_acl', array() ), |
  |  | 22 | $user\_id, |
  |  | 23 | memberful\_wp\_terms\_for\_subscribers(), |
  |  | 24 | memberful\_wp\_terms\_for\_registered\_users() |
  |  | 25 | ); |
  |  | 26 |  |
  |  | 27 | $posts\_allowed\_by\_terms = \_memberful\_wp\_posts\_with\_terms( $user\_terms['allowed'] ); |
  |  | 28 | $posts\_restricted\_by\_terms = \_memberful\_wp\_posts\_with\_terms( $user\_terms['restricted'] ); |
  |  | 29 |  |
  |  | 30 | // Merge posts disallowed by Post ACL and Term ACL |
  |  | 31 | $disallowed\_posts = array\_unique( array\_merge( $user\_posts['restricted'], $posts\_restricted\_by\_terms ) ); |
  |  | 32 |  |
  |  | 33 | // Remove posts allowed by Post ACL or Term ACL |
  |  | 34 | $disallowed\_posts = array\_diff( $disallowed\_posts, $user\_posts['allowed'], $posts\_allowed\_by\_terms ); |
  |  | 35 |  |
  |  | 36 | return $disallowed\_posts; |
  |  | 37 | } |
  |  | 38 |  |
  |  | 39 | /\*\* |
  |  | 40 | \* Returns an array of post IDs that the user is not allowed to access. |
  |  | 41 | \* Includes only posts disallowed by Post ACL, not Term ACL. |
  |  | 42 | \* |
  |  | 43 | \* @return array An associative array where the keys and values are post IDs |
  |  | 44 | \*               that the user is not allowed to access. |
  |  | 45 | \*/ |
  |  | 46 | function memberful\_wp\_post\_ids\_disallowed\_by\_post\_acl( $user\_id ) { |
  |  | 47 | static $cache = array(); |
  |  | 48 |  |
  |  | 49 | if ( isset( $cache[$user\_id] ) ) { |
  |  | 50 | return $cache[$user\_id]; |
  |  | 51 | } |
  |  | 52 |  |
  |  | 53 | $protected\_posts = \_memberful\_wp\_items\_from\_acl( |
  |  | 54 | get\_option( 'memberful\_acl', array() ), |
  |  | 55 | $user\_id, |
  |  | 56 | memberful\_wp\_posts\_for\_subscribers(), |
  |  | 57 | memberful\_wp\_posts\_for\_registered\_users() |
  |  | 58 | ); |
  |  | 59 |  |
  |  | 60 | $cache[$user\_id] = array\_combine( $protected\_posts['restricted'], $protected\_posts['restricted'] ); |
  |  | 61 |  |
  |  | 62 | return $cache[$user\_id]; |
  |  | 63 | } |
  |  | 64 |  |
  |  | 65 | /\*\* |
  |  | 66 | \* Returns an array of term IDs that the user is not allowed to access. |
  |  | 67 | \* |
  |  | 68 | \* @return array An array of term IDs that the user is not allowed to access. |
  |  | 69 | \*/ |
  |  | 70 | function memberful\_wp\_user\_disallowed\_term\_ids( $user\_id ) { |
  |  | 71 | static $cache = array(); |
  |  | 72 |  |
  |  | 73 | if ( isset( $cache[$user\_id] ) ) { |
  |  | 74 | return $cache[$user\_id]; |
  |  | 75 | } |
  |  | 76 |  |
  |  | 77 | $protected\_terms = \_memberful\_wp\_items\_from\_acl( |
  |  | 78 | get\_option( 'memberful\_term\_acl', array() ), |
  |  | 79 | $user\_id, |
  |  | 80 | memberful\_wp\_terms\_for\_subscribers(), |
  |  | 81 | memberful\_wp\_terms\_for\_registered\_users() |
  |  | 82 | ); |
  |  | 83 |  |
  |  | 84 | $cache[$user\_id] = $protected\_terms['restricted']; |
  |  | 85 |  |
  |  | 86 | return $cache[$user\_id]; |
  |  | 87 | } |
  |  | 88 |  |
  |  | 89 | /\*\* |
  |  | 90 | \* Returns an array of items (posts or terms) that are either accessible or restricted |
  |  | 91 | \* for a user, based on the Access Control List (ACL), the user's products, subscriptions, |
  |  | 92 | \* registration status, and subscription status. |
  |  | 93 | \* |
  |  | 94 | \* Note: Items without an ACL configuration will not be included in either the allowed or restricted lists. |
  |  | 95 | \* |
  |  | 96 | \* @param array  $acl                        The access control list, containing 'product' and 'subscription' keys. |
  |  | 97 | \* @param int    $user\_id                    The ID of the user. A value of 0 indicates an unauthenticated user. |
  |  | 98 | \* @param array  $items\_for\_subscribers      An array of items accessible to subscribers. |
  |  | 99 | \* @param array  $items\_for\_registered\_users An array of items accessible to registered users. |
  |  | 100 | \* |
  |  | 101 | \* @return array An associative array with two keys: |
  |  | 102 | \*               - 'allowed': An array of items the user is allowed to access. |
  |  | 103 | \*               - 'restricted': An array of items the user is not allowed to access. |
  |  | 104 | \*/ |
  |  | 105 | function \_memberful\_wp\_items\_from\_acl( $acl, $user\_id, $items\_for\_subscribers, $items\_for\_registered\_users ) { |
  |  | 106 | $user\_products = memberful\_wp\_user\_downloads( $user\_id ); |
  |  | 107 | $user\_subs = memberful\_wp\_user\_plans\_subscribed\_to( $user\_id ); |
  |  | 108 | $user\_signed\_in = $user\_id !== 0; |
  |  | 109 |  |
  |  | 110 | $product\_acl = isset( $acl['product'] ) ? $acl['product'] : array(); |
  |  | 111 | $subscription\_acl = isset( $acl['subscription'] ) ? $acl['subscription'] : array(); |
  |  | 112 |  |
  |  | 113 | // Work out the set of items the user is and isn't allowed to access |
  |  | 114 | $user\_product\_acl      = memberful\_wp\_generate\_user\_specific\_acl\_from\_global\_acl( $user\_products, $product\_acl ); |
  |  | 115 | $user\_subscription\_acl = memberful\_wp\_generate\_user\_specific\_acl\_from\_global\_acl( $user\_subs, $subscription\_acl ); |
  |  | 116 |  |
  |  | 117 | $allowed\_items    = array\_merge( $user\_product\_acl['allowed'],    $user\_subscription\_acl['allowed'] ); |
  |  | 118 | $restricted\_items = array\_merge( $user\_product\_acl['restricted'], $user\_subscription\_acl['restricted'] ); |
  |  | 119 |  |
  |  | 120 | if ( $user\_signed\_in ) { |
  |  | 121 | $allowed\_items = array\_merge( $allowed\_items, $items\_for\_registered\_users ); |
  | 19 | 122 | } else { |
  | 20 |  | static $disallowed\_post\_ids = array(); |
  | 21 |  | $acl = get\_option( 'memberful\_acl', array() ); |
  | 22 |  | $disallowed\_post\_ids = memberful\_wp\_user\_disallowed\_ids\_from\_acl( $user\_id, $acl); |
  | 23 |  |  |
  | 24 |  | return $disallowed\_post\_ids; |
  | 25 |  | } |
  | 26 |  | } |
  | 27 |  |  |
  | 28 |  | function memberful\_wp\_user\_disallowed\_term\_ids( $user\_id ) { |
  | 29 |  | if ( isset( $disallowed\_term\_ids )) { |
  | 30 |  | return $disallowed\_term\_ids; |
  |  | 123 | $restricted\_items = array\_merge( $restricted\_items, $items\_for\_registered\_users ); |
  |  | 124 | } |
  |  | 125 |  |
  |  | 126 | if ( empty( $user\_subs ) ) { |
  |  | 127 | $restricted\_items = array\_merge( $restricted\_items, $items\_for\_subscribers ); |
  | 31 | 128 | } else { |
  | 32 |  | static $disallowed\_term\_ids = array(); |
  | 33 |  | $acl = get\_option( 'memberful\_term\_acl', array() ); |
  | 34 |  | $disallowed\_term\_ids = memberful\_wp\_user\_disallowed\_ids\_from\_acl( $user\_id, $acl); |
  | 35 |  |  |
  | 36 |  | return $disallowed\_term\_ids; |
  | 37 |  | } |
  | 38 |  | } |
  | 39 |  |  |
  | 40 |  | function memberful\_wp\_user\_disallowed\_ids\_from\_acl( $user\_id, $acl ) { |
  | 41 |  | $user\_id        = (int) $user\_id; |
  | 42 |  | $user\_signed\_in = $user\_id !== 0; |
  | 43 |  |  |
  | 44 |  | $global\_product\_acl = isset( $acl['product'] ) ? $acl['product'] : array(); |
  | 45 |  | $global\_subscription\_acl = isset( $acl['subscription'] ) ? $acl['subscription'] : array(); |
  | 46 |  | $posts\_for\_any\_registered\_users = memberful\_wp\_get\_all\_posts\_available\_to\_any\_registered\_user(); |
  | 47 |  | $posts\_for\_anybody\_subscribed\_to\_a\_plan = memberful\_wp\_get\_all\_posts\_available\_to\_anybody\_subscribed\_to\_a\_plan(); |
  | 48 |  |  |
  | 49 |  | // Items the user has access to |
  | 50 |  | $user\_products = memberful\_wp\_user\_downloads( $user\_id ); |
  | 51 |  | $user\_subs     = memberful\_wp\_user\_plans\_subscribed\_to( $user\_id ); |
  | 52 |  |  |
  | 53 |  | // Work out the set of posts the user is and isn't allowed to access |
  | 54 |  | $user\_product\_acl      = memberful\_wp\_generate\_user\_specific\_acl\_from\_global\_acl( $user\_products, $global\_product\_acl ); |
  | 55 |  | $user\_subscription\_acl = memberful\_wp\_generate\_user\_specific\_acl\_from\_global\_acl( $user\_subs, $global\_subscription\_acl ); |
  | 56 |  |  |
  | 57 |  | $user\_allowed\_posts    = array\_merge( $user\_product\_acl['allowed'],    $user\_subscription\_acl['allowed'] ); |
  | 58 |  | // At this point we dont know if the user is signed in, so assume they're not & that they can't access |
  | 59 |  | // "registered users only" posts |
  | 60 |  | $user\_restricted\_posts = array\_merge( $user\_product\_acl['restricted'], $user\_subscription\_acl['restricted'], $posts\_for\_any\_registered\_users, $posts\_for\_anybody\_subscribed\_to\_a\_plan ); |
  | 61 |  |  |
  | 62 |  | // Remove the set of posts a user can access from the set they can't. |
  | 63 |  | // If a post requires 1 of 2 subscriptions, and a member only has 1 of them |
  | 64 |  | // then the post will be in the restricted set and the allowed set |
  | 65 |  | $posts\_user\_is\_not\_allowed\_to\_access = array\_diff( $user\_restricted\_posts, $user\_allowed\_posts ); |
  | 66 |  |  |
  | 67 |  | if ( $user\_signed\_in ) { |
  | 68 |  | $posts\_user\_is\_not\_allowed\_to\_access = array\_diff( $posts\_user\_is\_not\_allowed\_to\_access, $posts\_for\_any\_registered\_users); |
  | 69 |  |  |
  | 70 |  | if ( !empty($user\_subs) ) { |
  | 71 |  | $posts\_user\_is\_not\_allowed\_to\_access = array\_diff( $posts\_user\_is\_not\_allowed\_to\_access, $posts\_for\_anybody\_subscribed\_to\_a\_plan ); |
  | 72 |  | } |
  | 73 |  | } |
  | 74 |  |  |
  | 75 |  | return ( empty( $posts\_user\_is\_not\_allowed\_to\_access ) ) ? array() : array\_combine( $posts\_user\_is\_not\_allowed\_to\_access, $posts\_user\_is\_not\_allowed\_to\_access ); |
  |  | 129 | $allowed\_items = array\_merge( $allowed\_items, $items\_for\_subscribers ); |
  |  | 130 | } |
  |  | 131 |  |
  |  | 132 | $restricted\_items = array\_diff( $restricted\_items, $allowed\_items ); |
  |  | 133 |  |
  |  | 134 | return array( 'allowed' => $allowed\_items, 'restricted' => $restricted\_items ); |
  | 76 | 135 | } |
  | 77 | 136 |  |
  | […](/browser/memberful-wp/trunk/src/acl.php?rev=2656824#L286) | […](/browser/memberful-wp/trunk/src/acl.php?rev=3204895#L345) |  |
  | 286 | 345 |  |
  | 287 | 346 | function memberful\_wp\_post\_viewable\_by\_any\_registered\_user( $post, $terms\_for\_post ) { |
  | 288 |  | $posts\_for\_any\_registered\_users = memberful\_wp\_~~get\_all\_posts\_available\_to\_any\_registered\_user~~(); |
  | 289 |  | $terms\_for\_any\_registered\_users = memberful\_wp\_~~get\_all\_terms\_available\_to\_any\_registered\_user~~(); |
  |  | 347 | $posts\_for\_any\_registered\_users = memberful\_wp\_posts\_for\_registered\_users(); |
  |  | 348 | $terms\_for\_any\_registered\_users = memberful\_wp\_terms\_for\_registered\_users(); |
  | 290 | 349 |  |
  | 291 | 350 | return ( in\_array( $post, $posts\_for\_any\_registered\_users ) || array\_intersect( $terms\_for\_post, $terms\_for\_any\_registered\_users )); |
  | […](/browser/memberful-wp/trunk/src/acl.php?rev=2656824#L293) | […](/browser/memberful-wp/trunk/src/acl.php?rev=3204895#L352) |  |
  | 293 | 352 |  |
  | 294 | 353 | function memberful\_wp\_post\_viewable\_by\_any\_subscriber( $post, $terms\_for\_post ) { |
  | 295 |  | $posts\_for\_anybody\_subscribed\_to\_a\_plan = memberful\_wp\_~~get\_all\_posts\_available\_to\_anybody\_subscribed\_to\_a\_plan~~(); |
  | 296 |  | $terms\_for\_anybody\_subscribed\_to\_a\_plan = memberful\_wp\_~~get\_all\_terms\_available\_to\_anybody\_subscribed\_to\_a\_plan~~(); |
  |  | 354 | $posts\_for\_anybody\_subscribed\_to\_a\_plan = memberful\_wp\_posts\_for\_subscribers(); |
  |  | 355 | $terms\_for\_anybody\_subscribed\_to\_a\_plan = memberful\_wp\_terms\_for\_subscribers(); |
  | 297 | 356 |  |
  | 298 | 357 | return ( in\_array( $post, $posts\_for\_anybody\_subscribed\_to\_a\_plan ) || array\_intersect( $terms\_for\_post, $terms\_for\_anybody\_subscribed\_to\_a\_plan )); |
  | […](/browser/memberful-wp/trunk/src/acl.php?rev=2656824#L300) | […](/browser/memberful-wp/trunk/src/acl.php?rev=3204895#L359) |  |
  | 300 | 359 |  |
  | 301 | 360 | function memberful\_first\_term\_restricting\_post( $user, $post ) { |
  | 302 |  | $restricted\_terms = ~~array\_values( memberful\_wp\_user\_disallowed\_term\_ids( $user )~~); |
  |  | 361 | $restricted\_terms = memberful\_wp\_user\_disallowed\_term\_ids( $user ); |
  | 303 | 362 | $post\_terms = memberful\_wp\_get\_term\_ids\_for\_post( $post ); |
  | 304 |  |  |
  | 305 |  | ~~if ( !$user ) {~~ |
  | 306 |  | ~~$terms\_requiring\_any\_user = array\_intersect( $post\_terms, memberful\_wp\_get\_all\_terms\_available\_to\_any\_registered\_user() );~~ |
  | 307 |  |  |
  | 308 |  | ~~if ( !empty( $terms\_requiring\_any\_user )) {~~ |
  | 309 |  | ~~return reset ( $terms\_requiring\_any\_user );~~ |
  | 310 |  | ~~}~~ |
  | 311 |  | ~~}~~ |
  | 312 |  |  |
  | 313 |  | ~~if ( !$user || empty( memberful\_wp\_user\_plans\_subscribed\_to( $user ))) {~~ |
  | 314 |  | ~~$terms\_requiring\_any\_active\_plan = array\_intersect( $post\_terms, memberful\_wp\_get\_all\_terms\_available\_to\_anybody\_subscribed\_to\_a\_plan() );~~ |
  | 315 |  |  |
  | 316 |  | ~~if ( !empty( $terms\_requiring\_any\_active\_plan )) {~~ |
  | 317 |  | ~~return reset ( $terms\_requiring\_any\_active\_plan );~~ |
  | 318 |  | ~~}~~ |
  | 319 |  | ~~}~~ |
  | 320 | 363 |  |
  | 321 | 364 | if ( !empty( $restricted\_terms ) && !empty( $post\_terms )) { |
  | […](/browser/memberful-wp/trunk/src/acl.php?rev=2656824#L350) | […](/browser/memberful-wp/trunk/src/acl.php?rev=3204895#L393) |  |
  | 350 | 393 | return $taxonomies; |
  | 351 | 394 | } |
  |  | 395 |  |
  |  | 396 | function \_memberful\_wp\_posts\_with\_terms( $terms ) { |
  |  | 397 | if ( empty( $terms )) { |
  |  | 398 | return array(); |
  |  | 399 | } |
  |  | 400 |  |
  |  | 401 | $tax\_query = array(); |
  |  | 402 |  |
  |  | 403 | $grouped\_terms = \_memberful\_wp\_group\_terms\_by\_taxonomy( $terms ); |
  |  | 404 |  |
  |  | 405 | foreach ( $grouped\_terms as $taxonomy => $term\_ids ) { |
  |  | 406 | $tax\_query[] = array( |
  |  | 407 | 'taxonomy' => $taxonomy, |
  |  | 408 | 'field'    => 'term\_id', |
  |  | 409 | 'terms'    => $term\_ids, |
  |  | 410 | 'operator' => 'IN', |
  |  | 411 | ); |
  |  | 412 | } |
  |  | 413 |  |
  |  | 414 | if ( count( $tax\_query ) > 1 ) { |
  |  | 415 | $tax\_query = array\_merge( array( 'relation' => 'OR' ), $tax\_query ); |
  |  | 416 | } |
  |  | 417 |  |
  |  | 418 | return get\_posts( array( 'tax\_query' => $tax\_query, 'fields' => 'ids', 'numberposts' => -1 ) ); |
  |  | 419 | } |
  |  | 420 |  |
  |  | 421 | function \_memberful\_wp\_group\_terms\_by\_taxonomy( $term\_ids ) { |
  |  | 422 | $terms = get\_terms( array( 'include' => $term\_ids, 'hide\_empty' => false) ); |
  |  | 423 |  |
  |  | 424 | $grouped\_terms = array(); |
  |  | 425 |  |
  |  | 426 | foreach ( $terms as $term ) { |
  |  | 427 | $grouped\_terms[$term->taxonomy][] = $term->term\_id; |
  |  | 428 | } |
  |  | 429 |  |
  |  | 430 | return $grouped\_terms; |
  |  | 431 | } |
* ## [memberful-wp/trunk/src/acl/post\_options.php](/changeset/3204895/memberful-wp/trunk/src/acl/post_options.php "Show the changeset 3204895 restricted to memberful-wp/trunk/src/acl/post_options.php")

  | [r2137878](/browser/memberful-wp/trunk/src/acl/post_options.php?rev=2137878#L8 "Show revision 2137878 of this file in browser") | [r3204895](/browser/memberful-wp/trunk/src/acl/post_options.php?rev=3204895#L8 "Show revision 3204895 of this file in browser") |  |
  | --- | --- | --- |
  | 8 | 8 | update\_post\_meta( $post\_id, 'memberful\_available\_to\_any\_registered\_user', $is\_viewable\_by\_any\_registered\_users); |
  | 9 | 9 |  |
  | 10 |  | $globally\_viewable\_by\_by\_any\_registered\_users = memberful\_wp\_~~get\_all\_posts\_available\_to\_any\_registered\_user~~(); |
  |  | 10 | $globally\_viewable\_by\_by\_any\_registered\_users = memberful\_wp\_posts\_for\_registered\_users(); |
  | 11 | 11 |  |
  | 12 | 12 | if ( $is\_viewable\_by\_any\_registered\_users ) { |
  | […](/browser/memberful-wp/trunk/src/acl/post_options.php?rev=2137878#L19) | […](/browser/memberful-wp/trunk/src/acl/post_options.php?rev=3204895#L19) |  |
  | 19 | 19 | } |
  | 20 | 20 |  |
  | 21 |  | function memberful\_wp\_~~get\_all\_posts\_available\_to\_any\_registered\_user~~() { |
  |  | 21 | function memberful\_wp\_posts\_for\_registered\_users() { |
  | 22 | 22 | return get\_option( 'memberful\_posts\_available\_to\_any\_registered\_user', array() ); |
  | 23 | 23 | } |
  | […](/browser/memberful-wp/trunk/src/acl/post_options.php?rev=2137878#L30) | […](/browser/memberful-wp/trunk/src/acl/post_options.php?rev=3204895#L30) |  |
  | 30 | 30 | update\_post\_meta( $post\_id, 'memberful\_available\_to\_anybody\_subscribed\_to\_a\_plan', $is\_viewable ); |
  | 31 | 31 |  |
  | 32 |  | $posts\_available\_to\_anybody\_subscribed\_to\_a\_plan = memberful\_wp\_~~get\_all\_posts\_available\_to\_anybody\_subscribed\_to\_a\_plan~~(); |
  |  | 32 | $posts\_available\_to\_anybody\_subscribed\_to\_a\_plan = memberful\_wp\_posts\_for\_subscribers(); |
  | 33 | 33 |  |
  | 34 | 34 | if ( $is\_viewable ) { |
  | […](/browser/memberful-wp/trunk/src/acl/post_options.php?rev=2137878#L41) | […](/browser/memberful-wp/trunk/src/acl/post_options.php?rev=3204895#L41) |  |
  | 41 | 41 | } |
  | 42 | 42 |  |
  | 43 |  | function memberful\_wp\_~~get\_all\_posts\_available\_to\_anybody\_subscribed\_to\_a\_plan~~() { |
  |  | 43 | function memberful\_wp\_posts\_for\_subscribers() { |
  | 44 | 44 | return get\_option( 'memberful\_posts\_available\_to\_anybody\_subscribed\_to\_a\_plan', array() ); |
  | 45 | 45 | } |
* ## [memberful-wp/trunk/src/acl/term\_options.php](/changeset/3204895/memberful-wp/trunk/src/acl/term_options.php "Show the changeset 3204895 restricted to memberful-wp/trunk/src/acl/term_options.php")

  | [r2540631](/browser/memberful-wp/trunk/src/acl/term_options.php?rev=2540631#L8 "Show revision 2540631 of this file in browser") | [r3204895](/browser/memberful-wp/trunk/src/acl/term_options.php?rev=3204895#L8 "Show revision 3204895 of this file in browser") |  |
  | --- | --- | --- |
  | 8 | 8 | update\_term\_meta( $term\_id, 'memberful\_available\_to\_any\_registered\_user', $is\_viewable\_by\_any\_registered\_users); |
  | 9 | 9 |  |
  | 10 |  | $globally\_viewable\_by\_any\_registered\_users = memberful\_wp\_~~get\_all\_terms\_available\_to\_any\_registered\_user~~(); |
  |  | 10 | $globally\_viewable\_by\_any\_registered\_users = memberful\_wp\_terms\_for\_registered\_users(); |
  | 11 | 11 |  |
  | 12 | 12 | if ( $is\_viewable\_by\_any\_registered\_users ) { |
  | […](/browser/memberful-wp/trunk/src/acl/term_options.php?rev=2540631#L19) | […](/browser/memberful-wp/trunk/src/acl/term_options.php?rev=3204895#L19) |  |
  | 19 | 19 | } |
  | 20 | 20 |  |
  | 21 |  | function memberful\_wp\_~~get\_all\_terms\_available\_to\_any\_registered\_user~~() { |
  |  | 21 | function memberful\_wp\_terms\_for\_registered\_users() { |
  | 22 | 22 | return get\_option( 'memberful\_terms\_available\_to\_any\_registered\_user', array() ); |
  | 23 | 23 | } |
  | […](/browser/memberful-wp/trunk/src/acl/term_options.php?rev=2540631#L30) | […](/browser/memberful-wp/trunk/src/acl/term_options.php?rev=3204895#L30) |  |
  | 30 | 30 | update\_term\_meta( $term\_id, 'memberful\_available\_to\_anybody\_subscribed\_to\_a\_plan', $is\_viewable ); |
  | 31 | 31 |  |
  | 32 |  | $terms\_available\_to\_anybody\_subscribed\_to\_a\_plan = memberful\_wp\_~~get\_all\_terms\_available\_to\_anybody\_subscribed\_to\_a\_plan~~(); |
  |  | 32 | $terms\_available\_to\_anybody\_subscribed\_to\_a\_plan = memberful\_wp\_terms\_for\_subscribers(); |
  | 33 | 33 |  |
  | 34 | 34 | if ( $is\_viewable ) { |
  | […](/browser/memberful-wp/trunk/src/acl/term_options.php?rev=2540631#L41) | […](/browser/memberful-wp/trunk/src/acl/term_options.php?rev=3204895#L41) |  |
  | 41 | 41 | } |
  | 42 | 42 |  |
  | 43 |  | function memberful\_wp\_~~get\_all\_terms\_available\_to\_anybody\_subscribed\_to\_a\_plan~~() { |
  |  | 43 | function memberful\_wp\_terms\_for\_subscribers() { |
  | 44 | 44 | return get\_option( 'memberful\_terms\_available\_to\_anybody\_subscribed\_to\_a\_plan', array() ); |
  | 45 | 45 | } |
* ## [memberful-wp/trunk/src/global\_marketing.php](/changeset/3204895/memberful-wp/trunk/src/global_marketing.php "Show the changeset 3204895 restricted to memberful-wp/trunk/src/global_marketing.php")

  | [r2818405](/browser/memberful-wp/trunk/src/global_marketing.php?rev=2818405#L53 "Show revision 2818405 of this file in browser") | [r3204895](/browser/memberful-wp/trunk/src/global_marketing.php?rev=3204895#L53 "Show revision 3204895 of this file in browser") |  |
  | --- | --- | --- |
  | 53 | 53 | add\_action( 'the\_content', 'memberful\_wp\_protect\_content', -10 ); |
  | 54 | 54 |  |
  | 55 |  | $offset = 0; |
  | 56 |  | for ( $i = 0; $i < MEMBERFUL\_PARAGRAPH\_COUNT; $i++ ) { |
  | 57 |  | $offset = strpos( $original\_content, '</p>', $offset ) + 5; |
  | 58 |  | if( $offset === strlen($original\_content) ){ |
  | 59 |  | continue; |
  |  | 55 | $has\_teaser = false; |
  |  | 56 | $teaser = ''; |
  |  | 57 |  |
  |  | 58 | if ( !empty( $original\_content ) ) { |
  |  | 59 | $teaser\_offset = 0; |
  |  | 60 |  |
  |  | 61 | for ( $i = 0; $i < MEMBERFUL\_PARAGRAPH\_COUNT; $i++ ) { |
  |  | 62 | $paragraph\_offset = strpos( $original\_content, '</p>', $teaser\_offset ); |
  |  | 63 |  |
  |  | 64 | if ( $paragraph\_offset === false ) { |
  |  | 65 | break; |
  |  | 66 | } else { |
  |  | 67 | $teaser\_offset = $paragraph\_offset + 4; // Move past the </p> tag |
  |  | 68 | } |
  |  | 69 |  |
  |  | 70 | if ( $teaser\_offset === strlen( $original\_content ) ) { |
  |  | 71 | break; |
  |  | 72 | } |
  | 60 | 73 | } |
  | 61 |  | ~~}~~ |
  | 62 |  | ~~$has\_teaser= $offset < strlen($original\_content);~~ |
  | 63 | 74 |  |
  | 64 |  | if($has\_teaser){ |
  | 65 |  | $teaser = force\_balance\_tags(substr( $original\_content, 0, $offset )); |
  | 66 |  | } else { |
  | 67 |  | $teaser = ''; |
  |  | 75 | $has\_teaser = $teaser\_offset <= strlen($original\_content); |
  |  | 76 |  |
  |  | 77 | if ( $has\_teaser ) { |
  |  | 78 | $teaser = force\_balance\_tags(substr( $original\_content, 0, $teaser\_offset )); |
  |  | 79 | } |
  | 68 | 80 | } |
  | 69 | 81 |  |
  | […](/browser/memberful-wp/trunk/src/global_marketing.php?rev=2818405#L71) | […](/browser/memberful-wp/trunk/src/global_marketing.php?rev=3204895#L83) |  |
  | 71 | 83 |  |
  | 72 | 84 | if ( $has\_teaser && ! did\_action( 'memberful\_teaser\_css' ) ) { |
  | 73 |  | $wrapped\_teaser.= apply\_filters( 'memberful\_teaser\_css', memberful\_get\_teaser\_css() ); |
  |  | 85 | $wrapped\_teaser .= apply\_filters( 'memberful\_teaser\_css', memberful\_get\_teaser\_css() ); |
  | 74 | 86 | } |
  | 75 | 87 |  |
* ## [memberful-wp/trunk/src/marketing\_content.php](/changeset/3204895/memberful-wp/trunk/src/marketing_content.php "Show the changeset 3204895 restricted to memberful-wp/trunk/src/marketing_content.php")

  | [r2861829](/browser/memberful-wp/trunk/src/marketing_content.php?rev=2861829#L5 "Show revision 2861829 of this file in browser") | [r3204895](/browser/memberful-wp/trunk/src/marketing_content.php?rev=3204895#L5 "Show revision 3204895 of this file in browser") |  |
  | --- | --- | --- |
  | 5 | 5 | // Get marketing content for the frontend |
  | 6 | 6 | function memberful\_marketing\_content( $post\_id ) { |
  | 7 |  | $user\_id = ~~is\_user\_logged\_in() ? get\_current\_user\_id() : 0~~; |
  | 8 |  | $restricted\_posts = memberful\_wp\_~~user\_disallowed\_post\_ids~~( $user\_id ); |
  |  | 7 | $user\_id = get\_current\_user\_id(); |
  |  | 8 | $restricted\_posts = memberful\_wp\_post\_ids\_disallowed\_by\_post\_acl( $user\_id ); |
  | 9 | 9 |  |
  | 10 | 10 | if ( isset( $restricted\_posts[$post\_id] )) { |

**Note:** See [TracChangeset](/wiki/TracChangeset)
for help on using the changeset viewer.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Unified Diff](?format=diff&new=3204895)
* [Zip Archive](?format=zip&new=3204895)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)


