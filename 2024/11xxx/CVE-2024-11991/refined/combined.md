=== Content from github.com_c22e8695_20250115_085102.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fdfinity%2Fmotoko%2Fpull%2F4677)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fdfinity%2Fmotoko%2Fpull%2F4677)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fpull_requests_fragments%2Fpull_request_layout&source=header-repo&source_repo=dfinity%2Fmotoko)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[dfinity](/dfinity)
/
**[motoko](/dfinity/motoko)**
Public

* [Notifications](/login?return_to=%2Fdfinity%2Fmotoko) You must be signed in to change notification settings
* [Fork
  100](/login?return_to=%2Fdfinity%2Fmotoko)
* [Star
   525](/login?return_to=%2Fdfinity%2Fmotoko)

* [Code](/dfinity/motoko)
* [Issues
  353](/dfinity/motoko/issues)
* [Pull requests
  16](/dfinity/motoko/pulls)
* [Discussions](/dfinity/motoko/discussions)
* [Actions](/dfinity/motoko/actions)
* [Security](/dfinity/motoko/security)
* [Insights](/dfinity/motoko/pulse)

Additional navigation options

* [Code](/dfinity/motoko)
* [Issues](/dfinity/motoko/issues)
* [Pull requests](/dfinity/motoko/pulls)
* [Discussions](/dfinity/motoko/discussions)
* [Actions](/dfinity/motoko/actions)
* [Security](/dfinity/motoko/security)
* [Insights](/dfinity/motoko/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Fdfinity%2Fmotoko%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Fdfinity%2Fmotoko%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# chore: Upgrade RTS Dependencies #4677

 Merged

[mergify](/apps/mergify)
merged 21 commits into
[master](/dfinity/motoko/tree/master "dfinity/motoko:master")
from
[luc/upgrade-rts-dependencies](/dfinity/motoko/tree/luc/upgrade-rts-dependencies "dfinity/motoko:luc/upgrade-rts-dependencies")

Nov 29, 2024

 Merged

# [chore: Upgrade RTS Dependencies](#top) #4677

[mergify](/apps/mergify)
merged 21 commits into
[master](/dfinity/motoko/tree/master "dfinity/motoko:master")
from
[luc/upgrade-rts-dependencies](/dfinity/motoko/tree/luc/upgrade-rts-dependencies "dfinity/motoko:luc/upgrade-rts-dependencies")

Nov 29, 2024

[Conversation
40](/dfinity/motoko/pull/4677)
[Commits
21](/dfinity/motoko/pull/4677/commits)
[Checks
11](/dfinity/motoko/pull/4677/checks)
[Files changed](/dfinity/motoko/pull/4677/files)

## Conversation

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

[![luc-blaeser](https://avatars.githubusercontent.com/u/112870813?s=60&v=4)](/luc-blaeser)

Copy link

Contributor

### @luc-blaeser **[luc-blaeser](/luc-blaeser)** commented [Aug 29, 2024](#issue-2493867091) • edited Loading

Upgrading Motoko RTS dependencies:

* LLVM 18.1.8
* Rust 1.82.0

Special aspects:

* Support new `dylink.0` instead of `dylink`.
* Support `GOT.mem` for RTS in the Motoko linker.
* Adjusting the RTS code in line with the latest Rust features/rules.
* No longer needing `emscripten`: Use custom Rust targets .
* Get rid of `emscripten` by using custom Rust targets for generating PIC-relocatable Wasm.
* Get rid of `musl` by using Rust builtins instead.
* Float formatting changes due to removal of `musl`: The output format of `NaN` and `infinity` has changed. Moreover, one particular output format (hexadecimal float) is no longer supported. Updating the documentation and base library is needed.
* Optimization: Use bulk-memory operations because memcpy of Rust is slower than `musl`.

Note:

* If your `nix-shell` crashes with a segmentation fault with this PR, you need to upgrade `nix`. For this, you need to manually uninstall and re-install `nix`.

Sorry, something went wrong.

All reactions

 [luc-blaeser](/luc-blaeser)
added 3 commits
[August 29, 2024 10:29](#commits-pushed-4984cd5)

[![@luc-blaeser](https://avatars.githubusercontent.com/u/112870813?s=40&v=4)](/luc-blaeser)

`[Upgrade RTS dependencies](/dfinity/motoko/pull/4677/commits/4984cd5a76a72976c837f4c48fdc9aceed9bb908 "Upgrade RTS dependencies")`

`[4984cd5](/dfinity/motoko/pull/4677/commits/4984cd5a76a72976c837f4c48fdc9aceed9bb908)`

[![@luc-blaeser](https://avatars.githubusercontent.com/u/112870813?s=40&v=4)](/luc-blaeser)

`[Shrink RTS size](/dfinity/motoko/pull/4677/commits/fdd2ff2db91a6f7de95e96ba5ba6ce7312cdd68c "Shrink RTS size")`

`[fdd2ff2](/dfinity/motoko/pull/4677/commits/fdd2ff2db91a6f7de95e96ba5ba6ce7312cdd68c)`

[![@luc-blaeser](https://avatars.githubusercontent.com/u/112870813?s=40&v=4)](/luc-blaeser)

`[Link 64-bit RTS Rust code to one shared object file](/dfinity/motoko/pull/4677/commits/9153fca31bc723ba27ed21b8481ed4828aa89fa7 "Link 64-bit RTS Rust code to one shared object file")`

`[9153fca](/dfinity/motoko/pull/4677/commits/9153fca31bc723ba27ed21b8481ed4828aa89fa7)`

This was referenced Aug 29, 2024

[EOP: Rust Upgrade for RTS
#4648](/dfinity/motoko/pull/4648)
 Closed

[Experiment: RTS Size Optimizations
#4661](/dfinity/motoko/pull/4661)
 Closed

[![@luc-blaeser](https://avatars.githubusercontent.com/u/112870813?s=40&u=8f80722f8de7e9a2473fc8ce4563ad206d4b57bf&v=4)](/luc-blaeser)
[luc-blaeser](/luc-blaeser)
self-assigned this
[Aug 29, 2024](#event-14058735314)

[![@luc-blaeser](https://avatars.githubusercontent.com/u/112870813?s=40&u=8f80722f8de7e9a2473fc8ce4563ad206d4b57bf&v=4)](/luc-blaeser)
[luc-blaeser](/luc-blaeser)
added
the
[dependencies](/dfinity/motoko/labels/dependencies)
Pull requests that update a dependency file
label
[Aug 29, 2024](#event-14058737253)

[![@github-actions](https://avatars.githubusercontent.com/in/15368?s=80&v=4)](/apps/github-actions)
[![GitHub Actions](https://avatars.githubusercontent.com/in/15368?s=40&u=167a342ed94d2a713daf64a8b476ead2cebe1852&v=4)](https://github.com/apps/github-actions)

Copy link

### **[github-actions](/apps/github-actions) bot** commented [Aug 29, 2024](#issuecomment-2317357917) • edited Loading

| Comparing from [aebc110](https://github.com/dfinity/motoko/commit/aebc110e98dd51749fe5c2dcd8b78344d2c6216b) to [bd845da](https://github.com/dfinity/motoko/commit/bd845da9e4a4f87b803a64e26f77476cf3662c52): In terms of gas, 3 tests regressed, 2 tests improved and the mean change is -0.0%. In terms of size, 5 tests improved and the mean change is -1.6%. |
| --- |

 ❤️
1
 ggreif reacted with heart emoji

All reactions

* ❤️
  1 reaction

Sorry, something went wrong.

 [![@luc-blaeser](https://avatars.githubusercontent.com/u/112870813?s=40&u=8f80722f8de7e9a2473fc8ce4563ad206d4b57bf&v=4)](/luc-blaeser)
[luc-blaeser](/luc-blaeser)
marked this pull request as ready for review
[August 29, 2024 11:57](#event-14060534120)

[![@luc-blaeser](https://avatars.githubusercontent.com/u/112870813?s=40&u=8f80722f8de7e9a2473fc8ce4563ad206d4b57bf&v=4)](/luc-blaeser)
[luc-blaeser](/luc-blaeser)
mentioned this pull request
[Aug 29, 2024](#ref-pullrequest-1902910000)

[Base Library Adjustments for Latest Motoko RTS
dfinity/motoko-base#589](/dfinity/motoko-base/pull/589)
 Merged

[![@luc-blaeser](https://avatars.githubusercontent.com/u/112870813?s=40&v=4)](/luc-blaeser)

`[Update Motoko base dependency](/dfinity/motoko/pull/4677/commits/a6d1305b087e5968ddba40452cacaa0ef1223a80 "Update Motoko base dependency")`

`[a6d1305](/dfinity/motoko/pull/4677/commits/a6d1305b087e5968ddba40452cacaa0ef1223a80)`

 [![@luc-blaeser](https://avatars.githubusercontent.com/u/112870813?s=40&u=8f80722f8de7e9a2473fc8ce4563ad206d4b57bf&v=4)](/luc-blaeser)
[luc-blaeser](/luc-blaeser)
requested a review
from [ggreif](/ggreif)
[August 29, 2024 12:58](#event-14061432335)

 [![@luc-blaeser](https://avatars.githubusercontent.com/u/112870813?s=40&u=8f80722f8de7e9a2473fc8ce4563ad206d4b57bf&v=4)](/luc-blaeser)
[luc-blaeser](/luc-blaeser)
requested a review
from [crusso](/crusso)
[September 9, 2024 08:19](#event-14179085905)

[![crusso](https://avatars.githubusercontent.com/u/85788?s=60&v=4)](/crusso)

**[crusso](/crusso)**
reviewed
[Sep 10, 2024](#pullrequestreview-2292068622)

 [View reviewed changes](/dfinity/motoko/pull/4677/files/a6d1305b087e5968ddba40452cacaa0ef1223a80)

[rts/Makefile](/dfinity/motoko/pull/4677/files/a6d1305b087e5968ddba40452cacaa0ef1223a80#diff-c0ea5cfe5503217b58eddf511e6f3af1b316130718745464ba7c4a110f9fce6c)
Outdated

Show resolved

Hide resolved

 [luc-blaeser](/luc-blaeser)
and others
added 4 commits
[October 8, 2024 14:44](#commits-pushed-aa445dd)

[![@luc-blaeser](https://avatars.githubusercontent.com/u/112870813?s=40&v=4)](/luc-blaeser)

`[Use Custom Rust Targets for Shared Wasm Libraries (](/dfinity/motoko/pull/4677/commits/aa445dd61eb89bcfdbdbfc85aa95f507c2f0a9b3 "Use Custom Rust Targets for Shared Wasm Libraries (#4683)

* Patch Rust for shared Wasm libraries

* Get rid of `musl`

* Further simplify Wasm linking

* Update benchmark results

* No longer need `wasm-ld` patch

* Update test result

* Add distinction for Linux Ocaml build

* Revert \"No longer need `wasm-ld` patch\"

This reverts commit 3d0f34ed63dfb0ca1955ee46c67cb91b0d85ce97.

* Revert \"Update test result\"

This reverts commit 8fc5c082a61ae033cc393c75748c7d52175f0359.

* Use patched wasm-ld during Rust build

* Table offset must be at least 1 for Rust RTS

* Adjust linker test result

* Use bulk memory operations

* Do not need `wasm-lld` patch with shared targets

* Adjust expected test result

* Adjust nix build script

* Fix nix build script")[#4683](https://github.com/dfinity/motoko/pull/4683)[)](/dfinity/motoko/pull/4677/commits/aa445dd61eb89bcfdbdbfc85aa95f507c2f0a9b3 "Use Custom Rust Targets for Shared Wasm Libraries (#4683)

* Patch Rust for shared Wasm libraries

* Get rid of `musl`

* Further simplify Wasm linking

* Update benchmark results

* No longer need `wasm-ld` patch

* Update test result

* Add distinction for Linux Ocaml build

* Revert \"No longer need `wasm-ld` patch\"

This reverts commit 3d0f34ed63dfb0ca1955ee46c67cb91b0d85ce97.

* Revert \"Update test result\"

This reverts commit 8fc5c082a61ae033cc393c75748c7d52175f0359.

* Use patched wasm-ld during Rust build

* Table offset must be at least 1 for Rust RTS

* Adjust linker test result

* Use bulk memory operations

* Do not need `wasm-lld` patch with shared targets

* Adjust expected test result

* Adjust nix build script

* Fix nix build script")`
 …

`[aa445dd](/dfinity/motoko/pull/4677/commits/aa445dd61eb89bcfdbdbfc85aa95f507c2f0a9b3)`

```
* Patch Rust for shared Wasm libraries

* Get rid of `musl`

* Further simplify Wasm linking

* Update benchmark results

* No longer need `wasm-ld` patch

* Update test result

* Add distinction for Linux Ocaml build

* Revert "No longer need `wasm-ld` patch"

This reverts commit [3d0f34e](https://github.com/dfinity/motoko/commit/3d0f34ed63dfb0ca1955ee46c67cb91b0d85ce97).

* Revert "Update test result"

This reverts commit [8fc5c08](https://github.com/dfinity/motoko/commit/8fc5c082a61ae033cc393c75748c7d52175f0359).

* Use patched wasm-ld during Rust build

* Table offset must be at least 1 for Rust RTS

* Adjust linker test result

* Use bulk memory operations

* Do not need `wasm-lld` patch with shared targets

* Adjust expected test result

* Adjust nix build script

* Fix nix build script
```

[![@luc-blaeser](https://avatars.githubusercontent.com/u/112870813?s=40&v=4)](/luc-blaeser)

`[Merge branch 'master' into luc/upgrade-rts-dependencies](/dfinity/motoko/pull/4677/commits/04e04e6813a0b86df8774c159158b465a863694c "Merge branch 'master' into luc/upgrade-rts-dependencies")`

`[04e04e6](/dfinity/motoko/pull/4677/commits/04e04e6813a0b86df8774c159158b465a863694c)`

[![@luc-blaeser](https://avatars.githubusercontent.com/u/112870813?s=40&v=4)](/luc-blaeser)

`[Adjust Motoko base dependency](/dfinity/motoko/pull/4677/commits/af74f861d763481c2c0c5206258d1cabe8377ad8 "Adjust Motoko base dependency")`

`[af74f86](/dfinity/motoko/pull/4677/commits/af74f861d763481c2c0c5206258d1cabe8377ad8)`

[![@luc-blaeser](https://avatars.githubusercontent.com/u/112870813?s=40&v=4)](/luc-blaeser)

`[Skip size optimization](/dfinity/motoko/pull/4677/commits/a10ab53a1ec3e5e48dbce36d6c7dd8547503c85c "Skip size optimization")`

`[a10ab53](/dfinity/motoko/pull/4677/commits/a10ab53a1ec3e5e48dbce36d6c7dd8547503c85c)`

[![@luc-blaeser](https://avatars.githubusercontent.com/u/112870813?s=80&u=8f80722f8de7e9a2473fc8ce4563ad206d4b57bf&v=4)](/luc-blaeser)

Copy link

Contributor

Author

### **[luc-blaeser](/luc-blaeser)** commented [Oct 9, 2024](#issuecomment-2402465457)

| Size compression is no longer needed for the specific Rust target backends. Instead, we can again optimize for speed:  This is the latest perf diff on CI (locally repeated):  ``` Comparing from b7fa63936cf708952deae0dd0b0429faa1baa119 to a10ab53a1ec3e5e48dbce36d6c7dd8547503c85c: In terms of gas, 3 tests regressed, 2 tests improved and the mean change is -0.0%. In terms of size, 5 tests improved and the mean change is -1.6%.  ``` |
| --- |

All reactions

Sorry, something went wrong.

[![@luc-blaeser](https://avatars.githubusercontent.com/u/112870813?s=80&u=8f80722f8de7e9a2473fc8ce4563ad206d4b57bf&v=4)](/luc-blaeser)

Copy link

Contributor

Author

### **[luc-blaeser](/luc-blaeser)** commented [Oct 9, 2024](#issuecomment-2402755060)

|  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| According to the GC benchmark, it seems that this upgrade/cleanup even improves performance:   | Mode | Before | Now | Improvement | | --- | --- | --- | --- | | Classical (copying GC) | 2.33e10 | 2.29e10 | 1.7% | | Classical (incremental GC) | 2.39e10 | 2.35e10 | 1.7% | | EOP | 2.54e0 | 2.50e10 | 1.6% | |

 🎉
1
 crusso reacted with hooray emoji

All reactions

* 🎉
  1 reaction

Sorry, something went wrong.

 [![@luc-blaeser](https://avatars.githubusercontent.com/u/112870813?s=40&u=8f80722f8de7e9a2473fc8ce4563ad206d4b57bf&v=4)](/luc-blaeser)
[luc-blaeser](/luc-blaeser)
requested a review
from [crusso](/crusso)
[October 9, 2024 16:17](#event-14575865034)

[![luc-blaeser](https://avatars.githubusercontent.com/u/112870813?s=60&v=4)](/luc-blaeser)

**[luc-blaeser](/luc-blaeser)**
commented
[Oct 9, 2024](#pullrequestreview-2357656066)

 [View reviewed changes](/dfinity/motoko/pull/4677/files/a10ab53a1ec3e5e48dbce36d6c7dd8547503c85c)

[nix/sources.json](/dfinity/motoko/pull/4677/files/a10ab53a1ec3e5e48dbce36d6c7dd8547503c85c#diff-b9a0014cf6c4615d1c2e8d921dc3db59b4a68b462788d667ed622331660d17cd)
Outdated

Show resolved

Hide resolved

 [luc-blaeser](/luc-blaeser)
added 5 commits
[October 9, 2024 18:36](#commits-pushed-7aa01e7)

[![@luc-blaeser](https://avatars.githubusercontent.com/u/112870813?s=40&v=4)](/luc-blaeser)

`[Cleanup config.toml](/dfinity/motoko/pull/4677/commits/7aa01e7ae67ebdbb4e9dd9dbea8ae0b4f8f05b77 "Cleanup `config.toml`")`

`[7aa01e7](/dfinity/motoko/pull/4677/commits/7aa01e7ae67ebdbb4e9dd9dbea8ae0b4f8f05b77)`

[![@luc-blaeser](https://avatars.githubusercontent.com/u/112870813?s=40&v=4)](/luc-blaeser)

`[Cleanup TODO](/dfinity/motoko/pull/4677/commits/f8a970d4beb08c88b664e0debaac9e6ddbacb41c "Cleanup TODO")`

`[f8a970d](/dfinity/motoko/pull/4677/commits/f8a970d4beb08c88b664e0debaac9e6ddbacb41c)`

[![@luc-blaeser](https://avatars.githubusercontent.com/u/112870813?s=40&v=4)](/luc-blaeser)

`[Adjust format](/dfinity/motoko/pull/4677/commits/65729743fe820296d16234bc656ca95721476ef1 "Adjust format")`

`[6572974](/dfinity/motoko/pull/4677/commits/65729743fe820296d16234bc656ca95721476ef1)`

[![@luc-blaeser](https://avatars.githubusercontent.com/u/112870813?s=40&v=4)](/luc-blaeser)

`[Format back to original](/dfinity/motoko/pull/4677/commits/323d52eca849549b93a9b47a4dd75cc14e51a605 "Format back to original")`

`[323d52e](/dfinity/motoko/pull/4677/commits/323d52eca849549b93a9b47a4dd75cc14e51a605)`

[![@luc-blaeser](https://avatars.githubusercontent.com/u/112870813?s=40&v=4)](/luc-blaeser)

`[Reformat](/dfinity/motoko/pull/4677/commits/923086bad647b052b4421c787f765124d2bd3d0a "Reformat")`

`[923086b](/dfinity/motoko/pull/4677/commits/923086bad647b052b4421c787f765124d2bd3d0a)`

[![ggreif](https://avatars.githubusercontent.com/u/1312006?s=60&v=4)](/ggreif)

**[ggreif](/ggreif)**
reviewed
[Nov 25, 2024](#pullrequestreview-2458371052)

 [View reviewed changes](/dfinity/motoko/pull/4677/files/923086bad647b052b4421c787f765124d2bd3d0a)

[nix/default.nix](/dfinity/motoko/pull/4677/files/923086bad647b052b4421c787f765124d2bd3d0a#diff-4e3bd328e4c998f53b19da7639df45b2db63601be4b4343534880adfbeaa5840)
Outdated

Show resolved

Hide resolved

[![ggreif](https://avatars.githubusercontent.com/u/1312006?s=60&v=4)](/ggreif)

**[ggreif](/ggreif)**
reviewed
[Nov 25, 2024](#pullrequestreview-2458373653)

 [View reviewed changes](/dfinity/motoko/pull/4677/files/923086bad647b052b4421c787f765124d2bd3d0a)

[nix/default.nix](/dfinity/motoko/pull/4677/files/923086bad647b052b4421c787f765124d2bd3d0a#diff-4e3bd328e4c998f53b19da7639df45b2db63601be4b4343534880adfbeaa5840)

Show resolved

Hide resolved

[![ggreif](https://avatars.githubusercontent.com/u/1312006?s=60&v=4)](/ggreif)

**[ggreif](/ggreif)**
reviewed
[Nov 25, 2024](#pullrequestreview-2458378284)

 [View reviewed changes](/dfinity/motoko/pull/4677/files/923086bad647b052b4421c787f765124d2bd3d0a)

[default.nix](/dfinity/motoko/pull/4677/files/923086bad647b052b4421c787f765124d2bd3d0a#diff-245563af9e34754739b12b294f3324c1d42c116ace7ce8735e21dfbc82d8e064)

Show resolved

Hide resolved

4 hidden items

Load more…

[![ggreif](https://avatars.githubusercontent.com/u/1312006?s=60&v=4)](/ggreif)

**[ggreif](/ggreif)**
reviewed
[Nov 25, 2024](#pullrequestreview-2458412417)

 [View reviewed changes](/dfinity/motoko/pull/4677/files/923086bad647b052b4421c787f765124d2bd3d0a)

[test/run/float-fmt.mo](/dfinity/motoko/pull/4677/files/923086bad647b052b4421c787f765124d2bd3d0a#diff-0fbaac31a6bb5c9f28b17122f28753ed6cea9dfd3b829b90a92d4dcbb29c7422)

Show resolved

Hide resolved

[![ggreif](https://avatars.githubusercontent.com/u/1312006?s=60&v=4)](/ggreif)

**[ggreif](/ggreif)**
previously approved these changes
[Nov 25, 2024](#pullrequestreview-2458418318)

 [View reviewed changes](/dfinity/motoko/pull/4677/files/923086bad647b052b4421c787f765124d2bd3d0a)

Copy link

Contributor

### @ggreif **[ggreif](/ggreif)** left a comment

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

LGTM! Heroic work on the `dylink0` stuff. Being stuck on `clang-13` gave me nightmares...

Nice to see the cycle improvements too. Getting rid of `musl` means one less wheel to maintain.

Good work! Added a few Qs...

Sorry, something went wrong.

 👍
1
 luc-blaeser reacted with thumbs up emoji

All reactions

* 👍
  1 reaction

[![crusso](https://avatars.githubusercontent.com/u/85788?s=60&v=4)](/crusso)

**[crusso](/crusso)**
previously approved these changes
[Nov 26, 2024](#pullrequestreview-2458846138)

 [View reviewed changes](/dfinity/motoko/pull/4677/files/923086bad647b052b4421c787f765124d2bd3d0a)

Copy link

Contributor

### @crusso **[crusso](/crusso)** left a comment • edited Loading

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Great work! Not sure I fully understand the intricacies so 🤞

Sorry, something went wrong.

All reactions

[nix/sources.json](/dfinity/motoko/pull/4677/files/a10ab53a1ec3e5e48dbce36d6c7dd8547503c85c#diff-b9a0014cf6c4615d1c2e8d921dc3db59b4a68b462788d667ed622331660d17cd)
Outdated

Show resolved

Hide resolved

[rts/motoko-rts/src/allocator.rs](/dfinity/motoko/pull/4677/files/923086bad647b052b4421c787f765124d2bd3d0a#diff-3273e9e288ded33de804905defecf35e9b4850d0d1d237a2c05de338987e894c)

Show resolved

Hide resolved

[src/linking/linkModule.ml](/dfinity/motoko/pull/4677/files/923086bad647b052b4421c787f765124d2bd3d0a#diff-9c1ba120155190888d690eb8c16b920cf55050eb21113c81f8c5deb4374165f6)

Show resolved

Hide resolved

[src/linking/linkModule.ml](/dfinity/motoko/pull/4677/files/923086bad647b052b4421c787f765124d2bd3d0a#diff-9c1ba120155190888d690eb8c16b920cf55050eb21113c81f8c5deb4374165f6)

Show resolved

Hide resolved

 [luc-blaeser](/luc-blaeser)
added 5 commits
[November 28, 2024 13:58](#commits-pushed-39a71de)

[![@luc-blaeser](https://avatars.githubusercontent.com/u/112870813?s=40&v=4)](/luc-blaeser)

`[barrier refinement](/dfinity/motoko/pull/4677/commits/39a71dede20cde43e1bd8cbd66352b211458d65e "barrier refinement")`

`[39a71de](/dfinity/motoko/pull/4677/commits/39a71dede20cde43e1bd8cbd66352b211458d65e)`

[![@luc-blaeser](https://avatars.githubusercontent.com/u/112870813?s=40&v=4)](/luc-blaeser)

`[More refactoring](/dfinity/motoko/pull/4677/commits/893fc1863af812489d70c2622faa13aebdbbe016 "More refactoring")`

`[893fc18](/dfinity/motoko/pull/4677/commits/893fc1863af812489d70c2622faa13aebdbbe016)`

[![@luc-blaeser](https://avatars.githubusercontent.com/u/112870813?s=40&v=4)](/luc-blaeser)

`[Merge branch 'master' into luc/upgrade-rts-dependencies](/dfinity/motoko/pull/4677/commits/2de2c843dc520c177b9717806bddfe22e10bdbb1 "Merge branch 'master' into luc/upgrade-rts-dependencies")`

`[2de2c84](/dfinity/motoko/pull/4677/commits/2de2c843dc520c177b9717806bddfe22e10bdbb1)`

[![@luc-blaeser](https://avatars.githubusercontent.com/u/112870813?s=40&v=4)](/luc-blaeser)

`[Review feedback](/dfinity/motoko/pull/4677/commits/5139b7bedb0b09233386d26b01da3d1f9c17c4e5 "Review feedback")`

`[5139b7b](/dfinity/motoko/pull/4677/commits/5139b7bedb0b09233386d26b01da3d1f9c17c4e5)`

[![@luc-blaeser](https://avatars.githubusercontent.com/u/112870813?s=40&v=4)](/luc-blaeser)

`[Barrier refinement](/dfinity/motoko/pull/4677/commits/c7422ff3d6d8c41627bf1f4012b3230aa78bed41 "Barrier refinement")`

`[c7422ff](/dfinity/motoko/pull/4677/commits/c7422ff3d6d8c41627bf1f4012b3230aa78bed41)`

 [![@luc-blaeser](https://avatars.githubusercontent.com/u/112870813?s=40&u=8f80722f8de7e9a2473fc8ce4563ad206d4b57bf&v=4)](/luc-blaeser)
[luc-blaeser](/luc-blaeser)
dismissed stale reviews from [crusso](/crusso) and [ggreif](/ggreif)
via
`[c7422ff](/dfinity/motoko/commit/c7422ff3d6d8c41627bf1f4012b3230aa78bed41)`
[November 29, 2024 07:12](#event-15471972409)

[crusso](/crusso)
added a commit
to dfinity/motoko-base
that referenced
this pull request
[Nov 29, 2024](#ref-commit-2d4135f)
[![@luc-blaeser](https://avatars.githubusercontent.com/u/112870813?s=40&u=8f80722f8de7e9a2473fc8ce4563ad206d4b57bf&v=4)](/luc-blaeser) [![@crusso](https://avatars.githubusercontent.com/u/85788?s=40&u=ccc3a2fb0841b15c755f348b07ceb8501141e0f6&v=4)](/crusso)

`[Base Library Adjustments for Latest Motoko RTS (](/dfinity/motoko-base/commit/2d4135ff07470802b39e94017ebb7e46e671c59b "Base Library Adjustments for Latest Motoko RTS (#589)

Adjusting the base library for latest Motoko RTS changes:
* Also test enhanced orthogonal persistence with Wasm Memory 64.
* Be prepared for the RTS dependency upgrade
https://github.com/dfinity/motoko/pull/4677

Changes:
The original Musl float formatter has been replaced by the Rust
implementation with some subtle format changes:
- Numbers are displayed with the actually defined precision, no longer
truncating trailing zeros and potentially revealing existing numeric
errors.
- The exponent is printed with an explicit sign and multiple digits.
- NaN is formatted differently, now `NaN`, while the NaN sign bit is
omitted.
- The hexadecimal float formatter is no longer supported
(`Float.format(#hex)`). This is probably acceptable as it is rarely
used.

Once we have https://github.com/dfinity/motoko/pull/4677 merged in
Motoko `master`, then we can remove the backwards compatibility of float
formatting in these tests. Backwards compatibility is here needed to
make `motoko-base` tests pass with the old Motoko compiler version.

---------

Co-authored-by: Claudio Russo <claudio@dfinity.org>")[#589](https://github.com/dfinity/motoko-base/pull/589)[)](/dfinity/motoko-base/commit/2d4135ff07470802b39e94017ebb7e46e671c59b "Base Library Adjustments for Latest Motoko RTS (#589)

Adjusting the base library for latest Motoko RTS changes:
* Also test enhanced orthogonal persistence with Wasm Memory 64.
* Be prepared for the RTS dependency upgrade
https://github.com/dfinity/motoko/pull/4677

Changes:
The original Musl float formatter has been replaced by the Rust
implementation with some subtle format changes:
- Numbers are displayed with the actually defined precision, no longer
truncating trailing zeros and potentially revealing existing numeric
errors.
- The exponent is printed with an explicit sign and multiple digits.
- NaN is formatted differently, now `NaN`, while the NaN sign bit is
omitted.
- The hexadecimal float formatter is no longer supported
(`Float.format(#hex)`). This is probably acceptable as it is rarely
used.

Once we have https://github.com/dfinity/motoko/pull/4677 merged in
Motoko `master`, then we can remove the backwards compatibility of float
formatting in these tests. Backwards compatibility is here needed to
make `motoko-base` tests pass with the old Motoko compiler version.

---------

Co-authored-by: Claudio Russo <claudio@dfinity.org>")`
…

`[2d4135f](/dfinity/motoko-base/commit/2d4135ff07470802b39e94017ebb7e46e671c59b)`

```
Adjusting the base library for latest Motoko RTS changes:
* Also test enhanced orthogonal persistence with Wasm Memory 64.
* Be prepared for the RTS dependency upgrade
[dfinity/motoko#4677](https://github.com/dfinity/motoko/pull/4677)

Changes:
The original Musl float formatter has been replaced by the Rust
implementation with some subtle format changes:
- Numbers are displayed with the actually defined precision, no longer
truncating trailing zeros and potentially revealing existing numeric
errors.
- The exponent is printed with an explicit sign and multiple digits.
- NaN is formatted differently, now `NaN`, while the NaN sign bit is
omitted.
- The hexadecimal float formatter is no longer supported
(`Float.format(#hex)`). This is probably acceptable as it is rarely
used.

Once we have [dfinity/motoko#4677](https://github.com/dfinity/motoko/pull/4677) merged in
Motoko `master`, then we can remove the backwards compatibility of float
formatting in these tests. Backwards compatibility is here needed to
make `motoko-base` tests pass with the old Motoko compiler version.

---------

Co-authored-by: Claudio Russo <claudio@dfinity.org>
```

[![crusso](https://avatars.githubusercontent.com/u/85788?s=60&v=4)](/crusso)

**[crusso](/crusso)**
approved these changes
[Nov 29, 2024](#pullrequestreview-2469392281)

 [View reviewed changes](/dfinity/motoko/pull/4677/files/c7422ff3d6d8c41627bf1f4012b3230aa78bed41)

[![crusso](https://avatars.githubusercontent.com/u/85788?s=60&v=4)](/crusso)

**[crusso](/crusso)**
previously approved these changes
[Nov 29, 2024](#pullrequestreview-2469393403)

 [View reviewed changes](/dfinity/motoko/pull/4677/files/c7422ff3d6d8c41627bf1f4012b3230aa78bed41)

Copy link

Contributor

### @crusso **[crusso](/crusso)** left a comment

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

LGTM

Sorry, something went wrong.

All reactions

 [luc-blaeser](/luc-blaeser)
added 2 commits
[November 29, 2024 10:03](#commits-pushed-05499a1)

[![@luc-blaeser](https://avatars.githubusercontent.com/u/112870813?s=40&v=4)](/luc-blaeser)

`[Update base library dependency](/dfinity/motoko/pull/4677/commits/05499a14c51f7fe95164a0f74491ed18fe3b1d9d "Update base library dependency")`

`[05499a1](/dfinity/motoko/pull/4677/commits/05499a14c51f7fe95164a0f74491ed18fe3b1d9d)`

[![@luc-blaeser](https://avatars.githubusercontent.com/u/112870813?s=40&v=4)](/luc-blaeser)

`[Update Changelog.md](/dfinity/motoko/pull/4677/commits/8a2f91895fabbe740598bb563ee9ef27772f9693 "Update Changelog.md")`

`[8a2f918](/dfinity/motoko/pull/4677/commits/8a2f91895fabbe740598bb563ee9ef27772f9693)`

 [![@luc-blaeser](https://avatars.githubusercontent.com/u/112870813?s=40&u=8f80722f8de7e9a2473fc8ce4563ad206d4b57bf&v=4)](/luc-blaeser)
[luc-blaeser](/luc-blaeser)
dismissed
[crusso](/crusso)’s [stale review](#pullrequestreview-2469393403)
via
`[8a2f918](/dfinity/motoko/commit/8a2f91895fabbe740598bb563ee9ef27772f9693)`
[November 29, 2024 09:06](#event-15473012937)

[![@luc-blaeser](https://avatars.githubusercontent.com/u/112870813?s=80&u=8f80722f8de7e9a2473fc8ce4563ad206d4b57bf&v=4)](/luc-blaeser)

Copy link

Contributor

Author

### **[luc-blaeser](/luc-blaeser)** commented [Nov 29, 2024](#issuecomment-2507375379)

| Thank you for reviewing, Claudio and Gabor! |
| --- |

All reactions

Sorry, something went wrong.

[![@luc-blaeser](https://avatars.githubusercontent.com/u/112870813?s=40&u=8f80722f8de7e9a2473fc8ce4563ad206d4b57bf&v=4)](/luc-blaeser)
[luc-blaeser](/luc-blaeser)
added
the
[automerge-squash](/dfinity/motoko/labels/automerge-squash)
When ready, merge (using squash)
label
[Nov 29, 2024](#event-15473032352)

 [![@crusso](https://avatars.githubusercontent.com/u/85788?s=40&u=ccc3a2fb0841b15c755f348b07ceb8501141e0f6&v=4)](/crusso)
[crusso](/crusso)
self-requested a review
[November 29, 2024 11:28](#event-15474552223)

[![crusso](https://avatars.githubusercontent.com/u/85788?s=60&v=4)](/crusso)

**[crusso](/crusso)**
previously approved these changes
[Nov 29, 2024](#pullrequestreview-2469709889)

 [View reviewed changes](/dfinity/motoko/pull/4677/files/8a2f91895fabbe740598bb563ee9ef27772f9693)

[![crusso](https://avatars.githubusercontent.com/u/85788?s=60&v=4)](/crusso)

**[crusso](/crusso)**
reviewed
[Nov 29, 2024](#pullrequestreview-2469963094)

 [View reviewed changes](/dfinity/motoko/pull/4677/files/8a2f91895fabbe740598bb563ee9ef27772f9693)

[nix/default.nix](/dfinity/motoko/pull/4677/files/8a2f91895fabbe740598bb563ee9ef27772f9693#diff-4e3bd328e4c998f53b19da7639df45b2db63601be4b4343534880adfbeaa5840)
Outdated

Show resolved

Hide resolved

[![@crusso](https://avatars.githubusercontent.com/u/85788?s=40&v=4)](/crusso)

`[Update nix/default.nix](/dfinity/motoko/pull/4677/commits/bd845da9e4a4f87b803a64e26f77476cf3662c52 "Update nix/default.nix

revert default.nix change to adtgen")`
 …

`[bd845da](/dfinity/motoko/pull/4677/commits/bd845da9e4a4f87b803a64e26f77476cf3662c52)`

```

revert default.nix change to adtgen
```

 [![@crusso](https://avatars.githubusercontent.com/u/85788?s=40&u=ccc3a2fb0841b15c755f348b07ceb8501141e0f6&v=4)](/crusso)
[crusso](/crusso)
dismissed
their [stale review](#pullrequestreview-2469709889)
via
`[bd845da](/dfinity/motoko/commit/bd845da9e4a4f87b803a64e26f77476cf3662c52)`
[November 29, 2024 13:50](#event-15475927719)

 [![@crusso](https://avatars.githubusercontent.com/u/85788?s=40&u=ccc3a2fb0841b15c755f348b07ceb8501141e0f6&v=4)](/crusso)
[crusso](/crusso)
self-requested a review
[November 29, 2024 14:21](#event-15476253227)

[![crusso](https://avatars.githubusercontent.com/u/85788?s=60&v=4)](/crusso)

**[crusso](/crusso)**
approved these changes
[Nov 29, 2024](#pullrequestreview-2470024437)

 [View reviewed changes](/dfinity/motoko/pull/4677/files/bd845da9e4a4f87b803a64e26f77476cf3662c52)

[![ggreif](https://avatars.githubusercontent.com/u/1312006?s=60&v=4)](/ggreif)

**[ggreif](/ggreif)**
approved these changes
[Nov 29, 2024](#pullrequestreview-2470240747)

 [View reviewed changes](/dfinity/motoko/pull/4677/files/bd845da9e4a4f87b803a64e26f77476cf3662c52)

Copy link

Contributor

### @ggreif **[ggreif](/ggreif)** left a comment

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

LGTM!

Sorry, something went wrong.

All reactions

 Hide details
View details

[![@mergify](https://avatars.githubusercontent.com/in/10562?s=40&v=4)](/apps/mergify)
[mergify](/apps/mergify)
bot
merged commit [`bdb1d24`](/dfinity/motoko/commit/bdb1d24d216aa335dd52cd7cac6a022b750c26db)
into
master

[Nov 29, 2024](https://github.com/dfinity/motoko/pull/4677#event-15477862230)
10 checks passed

 [![@mergify](https://avatars.githubusercontent.com/in/10562?s=40&v=4)](/apps/mergify)
[mergify](/apps/mergify)
bot
deleted the
luc/upgrade-rts-dependencies

branch
[November 29, 2024 17:14](#event-15477862625)

[![@mergify](https://avatars.githubusercontent.com/in/10562?s=40&v=4)](/apps/mergify)
[mergify](/apps/mergify)
bot
removed
the
[automerge-squash](/dfinity/motoko/labels/automerge-squash)
When ready, merge (using squash)
label
[Nov 29, 2024](#event-15477862635)

[ggreif](/ggreif)
pushed a commit
to dfinity/motoko-base
that referenced
this pull request
[Dec 4, 2024](#ref-commit-f0ebb15)
[![@luc-blaeser](https://avatars.githubusercontent.com/u/112870813?s=40&u=8f80722f8de7e9a2473fc8ce4563ad206d4b57bf&v=4)](/luc-blaeser) [![@crusso](https://avatars.githubusercontent.com/u/85788?s=40&u=ccc3a2fb0841b15c755f348b07ceb8501141e0f6&v=4)](/crusso) [![@ggreif](https://avatars.githubusercontent.com/u/1312006?s=40&v=4)](/ggreif)

`[Base Library Adjustments for Latest Motoko RTS (](/dfinity/motoko-base/commit/f0ebb1574f6b66dba5d6ec38e0805e1fd6de1714 "Base Library Adjustments for Latest Motoko RTS (#589)

Adjusting the base library for latest Motoko RTS changes:
* Also test enhanced orthogonal persistence with Wasm Memory 64.
* Be prepared for the RTS dependency upgrade
https://github.com/dfinity/motoko/pull/4677

Changes:
The original Musl float formatter has been replaced by the Rust
implementation with some subtle format changes:
- Numbers are displayed with the actually defined precision, no longer
truncating trailing zeros and potentially revealing existing numeric
errors.
- The exponent is printed with an explicit sign and multiple digits.
- NaN is formatted differently, now `NaN`, while the NaN sign bit is
omitted.
- The hexadecimal float formatter is no longer supported
(`Float.format(#hex)`). This is probably acceptable as it is rarely
used.

Once we have https://github.com/dfinity/motoko/pull/4677 merged in
Motoko `master`, then we can remove the backwards compatibility of float
formatting in these tests. Backwards compatibility is here needed to
make `motoko-base` tests pass with the old Motoko compiler version.

---------

Co-authored-by: Claudio Russo <claudio@dfinity.org>")[#589](https://github.com/dfinity/motoko-base/pull/589)[)](/dfinity/motoko-base/commit/f0ebb1574f6b66dba5d6ec38e0805e1fd6de1714 "Base Library Adjustments for Latest Motoko RTS (#589)

Adjusting the base library for latest Motoko RTS changes:
* Also test enhanced orthogonal persistence with Wasm Memory 64.
* Be prepared for the RTS dependency upgrade
https://github.com/dfinity/motoko/pull/4677

Changes:
The original Musl float formatter has been replaced by the Rust
implementation with some subtle format changes:
- Numbers are displayed with the actually defined precision, no longer
truncating trailing zeros and potentially revealing existing numeric
errors.
- The exponent is printed with an explicit sign and multiple digits.
- NaN is formatted differently, now `NaN`, while the NaN sign bit is
omitted.
- The hexadecimal float formatter is no longer supported
(`Float.format(#hex)`). This is probably acceptable as it is rarely
used.

Once we have https://github.com/dfinity/motoko/pull/4677 merged in
Motoko `master`, then we can remove the backwards compatibility of float
formatting in these tests. Backwards compatibility is here needed to
make `motoko-base` tests pass with the old Motoko compiler version.

---------

Co-authored-by: Claudio Russo <claudio@dfinity.org>")`
…

`[f0ebb15](/dfinity/motoko-base/commit/f0ebb1574f6b66dba5d6ec38e0805e1fd6de1714)`

```
Adjusting the base library for latest Motoko RTS changes:
* Also test enhanced orthogonal persistence with Wasm Memory 64.
* Be prepared for the RTS dependency upgrade
[dfinity/motoko#4677](https://github.com/dfinity/motoko/pull/4677)

Changes:
The original Musl float formatter has been replaced by the Rust
implementation with some subtle format changes:
- Numbers are displayed with the actually defined precision, no longer
truncating trailing zeros and potentially revealing existing numeric
errors.
- The exponent is printed with an explicit sign and multiple digits.
- NaN is formatted differently, now `NaN`, while the NaN sign bit is
omitted.
- The hexadecimal float formatter is no longer supported
(`Float.format(#hex)`). This is probably acceptable as it is rarely
used.

Once we have [dfinity/motoko#4677](https://github.com/dfinity/motoko/pull/4677) merged in
Motoko `master`, then we can remove the backwards compatibility of float
formatting in these tests. Backwards compatibility is here needed to
make `motoko-base` tests pass with the old Motoko compiler version.

---------

Co-authored-by: Claudio Russo <claudio@dfinity.org>
```

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Fdfinity%2Fmotoko%2Fpull%2F4677)

Reviewers

[![@ggreif](https://avatars.githubusercontent.com/u/1312006?s=40&v=4)](/ggreif) [ggreif](/ggreif)

ggreif approved these changes

[![@crusso](https://avatars.githubusercontent.com/u/85788?s=40&v=4)](/crusso) [crusso](/crusso)

crusso approved these changes

Assignees

[![@luc-blaeser](https://avatars.githubusercontent.com/u/112870813?s=40&v=4)](/luc-blaeser) [luc-blaeser](/luc-blaeser)

Labels

[dependencies](/dfinity/motoko/labels/dependencies)
Pull requests that update a dependency file

Projects

None yet

Milestone

No milestone

Development

Successfully merging this pull request may close these issues.

3 participants

[![@luc-blaeser](https://avatars.githubusercontent.com/u/112870813?s=52&v=4)](/luc-blaeser) [![@crusso](https://avatars.githubusercontent.com/u/85788?s=52&v=4)](/crusso) [![@ggreif](https://avatars.githubusercontent.com/u/1312006?s=52&v=4)](/ggreif)

Add this suggestion to a batch that can be applied as a single commit.
This suggestion is invalid because no changes were made to the code.
Suggestions cannot be applied while the pull request is closed.
Suggestions cannot be applied while viewing a subset of changes.
Only one suggestion per line can be applied in a batch.
Add this suggestion to a batch that can be applied as a single commit.
Applying suggestions on deleted lines is not supported.
You must change the existing code in this line in order to create a valid suggestion.
Outdated suggestions cannot be applied.
This suggestion has been applied or marked resolved.
Suggestions cannot be applied from pending reviews.
Suggestions cannot be applied on multi-line comments.
Suggestions cannot be applied while the pull request is queued to merge.
Suggestion cannot be applied right now. Please check back later.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_1e42e5dc_20250115_085103.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fdfinity%2Fmotoko%2Fsecurity%2Fadvisories%2FGHSA-9rhg-3qf8-hrv3)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fdfinity%2Fmotoko%2Fsecurity%2Fadvisories%2FGHSA-9rhg-3qf8-hrv3)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=dfinity%2Fmotoko)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[dfinity](/dfinity)
/
**[motoko](/dfinity/motoko)**
Public

* [Notifications](/login?return_to=%2Fdfinity%2Fmotoko) You must be signed in to change notification settings
* [Fork
  100](/login?return_to=%2Fdfinity%2Fmotoko)
* [Star
   525](/login?return_to=%2Fdfinity%2Fmotoko)

* [Code](/dfinity/motoko)
* [Issues
  353](/dfinity/motoko/issues)
* [Pull requests
  16](/dfinity/motoko/pulls)
* [Discussions](/dfinity/motoko/discussions)
* [Actions](/dfinity/motoko/actions)
* [Security](/dfinity/motoko/security)
* [Insights](/dfinity/motoko/pulse)

Additional navigation options

* [Code](/dfinity/motoko)
* [Issues](/dfinity/motoko/issues)
* [Pull requests](/dfinity/motoko/pulls)
* [Discussions](/dfinity/motoko/discussions)
* [Actions](/dfinity/motoko/actions)
* [Security](/dfinity/motoko/security)
* [Insights](/dfinity/motoko/pulse)

# Uninitialized memory access in Motoko incremental garbage collector

Moderate

[eduarddfinity](/eduarddfinity)
published
GHSA-9rhg-3qf8-hrv3
Dec 9, 2024

## Package

moc
(OCaml)

## Affected versions

>= 0.9.0, < 0.13.4

## Patched versions

0.13.4

## Description

### Impact

Motoko's incremental garbage collector is impacted by an uninitialized memory access bug, caused by incorrect use of write barriers in a few locations. This vulnerability could potentially allow unauthorized read or write access to a Canister's memory. However, exploiting this bug requires the Canister to enable the incremental garbage collector or enhanced orthogonal persistence, which are non-default features in Motoko.

### Patches

The problem has been fixed in [#4677](https://github.com/dfinity/motoko/pull/4677) and users are asked to upgrade to version 0.13.4. This can be done by updating to the latest `dfx` version ([0.24.3](https://github.com/dfinity/sdk/releases/tag/0.24.3)) which includes Motoko version 0.13.4.

`dfxvm install 0.24.3`

### Workarounds

Disable incremental garbage collector and enhanced orthogonal persistence. i.e. do **not compile** with `—incremental-gc` or `--enhanced-orthogonal-persistence` options.

### References

* [dfinity/motoko/pull/4677](https://github.com/dfinity/motoko/pull/4677)
* [Enhanced Orthogonal Persistence documentation](https://github.com/dfinity/motoko/blob/master/design/OrthogonalPersistence.md)
* [Motoko compiler reference](https://github.com/dfinity/motoko/blob/master/doc/md/reference/compiler-ref.md)

### Severity

Moderate

5.6

# CVSS overall score

 This score calculates overall vulnerability severity from 0 to 10 and is based on the Common Vulnerability Scoring System (CVSS).

 / 10

#### CVSS v3 base metrics

Attack vector
Network

Attack complexity
High

Privileges required
None

User interaction
None

Scope
Unchanged

Confidentiality
Low

Integrity
Low

Availability
Low

Learn more about base metrics

# CVSS v3 base metrics

Attack vector:
More severe the more the remote (logically and physically) an attacker can be in order to exploit the vulnerability.

Attack complexity:
More severe for the least complex attacks.

Privileges required:
More severe if no privileges are required.

User interaction:
More severe when no user interaction is required.

Scope:
More severe when a scope change occurs, e.g. one vulnerable component impacts resources in components beyond its security scope.

Confidentiality:
More severe when loss of data confidentiality is highest, measuring the level of data access available to an unauthorized user.

Integrity:
More severe when loss of data integrity is the highest, measuring the consequence of data modification possible by an unauthorized user.

Availability:
More severe when the loss of impacted component availability is highest.

CVSS:3.1/AV:N/AC:H/PR:N/UI:N/S:U/C:L/I:L/A:L

### CVE ID

CVE-2024-11991

### Weaknesses

[CWE-908](/advisories?query=cwe%3A908)

### Credits

* [![@luc-blaeser](https://avatars.githubusercontent.com/u/112870813?s=40&v=4)](/luc-blaeser)
  [luc-blaeser](/luc-blaeser)
  Reporter

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


