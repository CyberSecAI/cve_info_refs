=== Content from plugins.trac.wordpress.org_b345cddf_20250114_182907.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fbrowser%2Footb-openstreetmap%2Ftags%2F2.8.3%2Fincludes%2Fclasses%2FQuery.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* [Blame](/browser/ootb-openstreetmap/tags/2.8.3/includes/classes/Query.php?annotate=blame "Annotate each line with the last changed revision (this can be time consuming...)")
* [Revision Log](/log/ootb-openstreetmap/tags/2.8.3/includes/classes/Query.php)

---

# [source:](/browser?order=name "Go to repository root") [ootb-openstreetmap](/browser/ootb-openstreetmap?order=name "View ootb-openstreetmap")/[tags](/browser/ootb-openstreetmap/tags?order=name "View tags")/[2.8.3](/browser/ootb-openstreetmap/tags/2.8.3?order=name "View 2.8.3")/[includes](/browser/ootb-openstreetmap/tags/2.8.3/includes?order=name "View includes")/[classes](/browser/ootb-openstreetmap/tags/2.8.3/includes/classes?order=name "View classes")/[Query.php](/browser/ootb-openstreetmap/tags/2.8.3/includes/classes/Query.php?order=name "View Query.php")

View diff against:

View revision:

| [Last change](/changeset/3190811/ootb-openstreetmap/tags/2.8.3/includes/classes/Query.php "View differences") on this file was [3190811](/changeset/3190811/ "View changeset 3190811"), checked in by gsarig, [2 months ago](/timeline?from=2024-11-17T23%3A45%3A40Z&precision=second "See timeline at 11/17/2024 11:45:40 PM") |
| --- |
| Update to version 2.8.3 from GitHub |
| **File size:** 10.8 KB | |

| Line |  |
| --- | --- |
| [1](#L1) | <?php /\*\* @noinspection PhpComposerExtensionStubsInspection \*/ |
| [2](#L2) |  |
| [3](#L3) | /\*\* |
| [4](#L4) | \* Query Maps |
| [5](#L5) | \* |
| [6](#L6) | \* @since   2.6.0 |
| [7](#L7) | \* @package ootb-openstreetmap |
| [8](#L8) | \*/ |
| [9](#L9) |  |
| [10](#L10) | namespace OOTB; |
| [11](#L11) |  |
| [12](#L12) | use WP\_Query; |
| [13](#L13) |  |
| [14](#L14) | class Query { |
| [15](#L15) | public function \_\_construct() { |
| [16](#L16) | add\_action( 'wp\_ajax\_ootb\_get\_markers', [ $this, 'handle\_ajax\_call' ] ); |
| [17](#L17) | add\_shortcode( 'ootb\_query', [ $this, 'shortcode' ] ); |
| [18](#L18) | } |
| [19](#L19) |  |
| [20](#L20) | /\*\* |
| [21](#L21) | \* Checks if the post type has been overridden by the filter. |
| [22](#L22) | \* |
| [23](#L23) | \* @param string $fallback The fallback post type. |
| [24](#L24) | \* |
| [25](#L25) | \* @return mixed|null |
| [26](#L26) | \*/ |
| [27](#L27) | private static function get\_post\_type( string $fallback = 'post' ) { |
| [28](#L28) | return apply\_filters( 'ootb\_query\_post\_type', $fallback ); |
| [29](#L29) | } |
| [30](#L30) |  |
| [31](#L31) | /\*\* |
| [32](#L32) | \* Checks if the posts per page has been overridden by the filter. |
| [33](#L33) | \* |
| [34](#L34) | \* @param int $fallback The fallback posts per page. |
| [35](#L35) | \* |
| [36](#L36) | \* @return mixed|null |
| [37](#L37) | \*/ |
| [38](#L38) | private static function get\_posts\_per\_page( int $fallback = 100 ) { |
| [39](#L39) | return apply\_filters( 'ootb\_query\_posts\_per\_page', $fallback ); |
| [40](#L40) | } |
| [41](#L41) |  |
| [42](#L42) | /\*\* |
| [43](#L43) | \* Checks if there are any extra args to add to the query, but does not overwrite any existing args. |
| [44](#L44) | \* |
| [45](#L45) | \* @param array $args The query args. |
| [46](#L46) | \* |
| [47](#L47) | \* @return array|null |
| [48](#L48) | \*/ |
| [49](#L49) | private static function maybe\_extra\_args( array $args = [] ): ?array { |
| [50](#L50) | $extra\_args = apply\_filters( 'ootb\_query\_extra\_args', [] ); |
| [51](#L51) |  |
| [52](#L52) | // Get new args that don't exist in the defaults. |
| [53](#L53) | $new\_unique\_args = array\_diff\_key( $extra\_args, $args ); |
| [54](#L54) |  |
| [55](#L55) | // Combine default args with new args. |
| [56](#L56) | return array\_merge( $args, $new\_unique\_args ); |
| [57](#L57) | } |
| [58](#L58) |  |
| [59](#L59) | /\*\* |
| [60](#L60) | \* Handles the ajax call to get the markers. |
| [61](#L61) | \* @return void |
| [62](#L62) | \*/ |
| [63](#L63) | public function handle\_ajax\_call() { |
| [64](#L64) | $post\_id = $\_POST[ 'post\_id' ] ?? 0; |
| [65](#L65) | $post\_id = is\_numeric( $post\_id ) ? absint( $post\_id ) : 0; |
| [66](#L66) |  |
| [67](#L67) | $args = $\_POST[ 'query\_args' ] ?? ''; |
| [68](#L68) | $args = ! empty( $args ) ? json\_decode( stripslashes( $args ), true ) : ''; |
| [69](#L69) |  |
| [70](#L70) | $data = self::get\_markers( $post\_id, $args ); |
| [71](#L71) | echo json\_encode( $data ); |
| [72](#L72) | wp\_die(); |
| [73](#L73) | } |
| [74](#L74) |  |
| [75](#L75) | /\*\* |
| [76](#L76) | \* Gets the markers from the query. |
| [77](#L77) | \* |
| [78](#L78) | \* @param int $current\_post\_id The current post id. |
| [79](#L79) | \* @param array $query\_args The query args. |
| [80](#L80) | \* @param bool $query\_custom\_fields Whether to query custom fields or not. |
| [81](#L81) | \* |
| [82](#L82) | \* @return false|string |
| [83](#L83) | \*/ |
| [84](#L84) | public static function get\_markers( int $current\_post\_id = 0, array $query\_args = [], bool $query\_custom\_fields = false ) { |
| [85](#L85) | $default\_args = [ |
| [86](#L86) | 'post\_type'              => self::get\_post\_type(), |
| [87](#L87) | 'posts\_per\_page'         => self::get\_posts\_per\_page(), |
| [88](#L88) | 'fields'                 => 'ids', |
| [89](#L89) | 'no\_found\_rows'          => true, |
| [90](#L90) | 'update\_post\_meta\_cache' => false, |
| [91](#L91) | 'update\_post\_term\_cache' => false, |
| [92](#L92) | ]; |
| [93](#L93) | if ( $query\_custom\_fields ) { |
| [94](#L94) | $default\_args[ 'meta\_query' ] = [ |
| [95](#L95) | 'relation' => 'AND', |
| [96](#L96) | [ |
| [97](#L97) | 'key'     => 'geo\_latitude', |
| [98](#L98) | 'value'   => '', |
| [99](#L99) | 'compare' => '!=', |
| [100](#L100) | ], |
| [101](#L101) | [ |
| [102](#L102) | 'key'     => 'geo\_longitude', |
| [103](#L103) | 'value'   => '', |
| [104](#L104) | 'compare' => '!=', |
| [105](#L105) | ], |
| [106](#L106) | ]; |
| [107](#L107) | } else { |
| [108](#L108) | $default\_args[ 's' ] = '<!-- wp:ootb/openstreetmap '; |
| [109](#L109) | } |
| [110](#L110) | $args = wp\_parse\_args( $query\_args, $default\_args ); |
| [111](#L111) |  |
| [112](#L112) | $query = new WP\_Query( self::maybe\_extra\_args( $args ) ); |
| [113](#L113) |  |
| [114](#L114) | if ( empty( $query->posts ) ) { |
| [115](#L115) | return false; |
| [116](#L116) | } |
| [117](#L117) |  |
| [118](#L118) | return self::get\_marker\_data( $current\_post\_id, $query->posts, $query\_custom\_fields ); |
| [119](#L119) |  |
| [120](#L120) | } |
| [121](#L121) |  |
| [122](#L122) | /\*\* |
| [123](#L123) | \* The render callback for the block. |
| [124](#L124) | \* |
| [125](#L125) | \* @param array $attributes The block attributes. |
| [126](#L126) | \* @param string $content The block content. |
| [127](#L127) | \* |
| [128](#L128) | \* @return array|string|string[]|null |
| [129](#L129) | \*/ |
| [130](#L130) | public static function render\_callback( array $attributes, string $content ) { |
| [131](#L131) | if ( ( isset( $attributes[ 'serverSideRender' ] ) && ! $attributes[ 'serverSideRender' ] ) && ! empty( $attributes[ 'markers' ] ) ) { |
| [132](#L132) | return $content; |
| [133](#L133) | } |
| [134](#L134) |  |
| [135](#L135) | $post\_type                                = $attributes[ 'queryArgs' ][ 'post\_type' ] ?? ''; |
| [136](#L136) | $attributes[ 'queryArgs' ][ 'post\_type' ] = self::get\_post\_type( $post\_type ); |
| [137](#L137) | $post\_id                                  = is\_singular() ? get\_the\_ID() : 0; |
| [138](#L138) | $markers                                  = Query::get\_markers( |
| [139](#L139) | $post\_id, |
| [140](#L140) | $attributes[ 'queryArgs' ], |
| [141](#L141) | $attributes[ 'queryCustomFields' ] ?? false |
| [142](#L142) | ); |
| [143](#L143) | if ( empty( $markers ) ) { |
| [144](#L144) | return $content; |
| [145](#L145) | } |
| [146](#L146) |  |
| [147](#L147) | $escaped\_markers = htmlentities( $markers, ENT\_QUOTES, 'UTF-8' ); |
| [148](#L148) |  |
| [149](#L149) | return preg\_replace( |
| [150](#L150) | [ |
| [151](#L151) | '/data-markers=".\*?"/', |
| [152](#L152) | '/data-bounds=".\*?"/' |
| [153](#L153) | ], |
| [154](#L154) | [ |
| [155](#L155) | sprintf( 'data-markers="%s"', $escaped\_markers ), |
| [156](#L156) | 'data-bounds="[null,null]"', |
| [157](#L157) | ], |
| [158](#L158) | $content |
| [159](#L159) | ); |
| [160](#L160) | } |
| [161](#L161) |  |
| [162](#L162) | /\*\* |
| [163](#L163) | \* Gets the marker data from the post ids. |
| [164](#L164) | \* |
| [165](#L165) | \* @param int $current\_post\_id The current post id. |
| [166](#L166) | \* @param array $post\_ids The post ids. |
| [167](#L167) | \* @param bool $query\_custom\_fields Whether to query custom fields or not. |
| [168](#L168) | \* |
| [169](#L169) | \* @return false|string |
| [170](#L170) | \*/ |
| [171](#L171) | private static function get\_marker\_data( int $current\_post\_id, array $post\_ids, bool $query\_custom\_fields = false ) { |
| [172](#L172) | $markers = []; |
| [173](#L173) | foreach ( $post\_ids as $post\_id ) { |
| [174](#L174) | if ( $query\_custom\_fields ) { |
| [175](#L175) | $latitude  = get\_post\_meta( $post\_id, 'geo\_latitude', true ); |
| [176](#L176) | $longitude = get\_post\_meta( $post\_id, 'geo\_longitude', true ); |
| [177](#L177) | $address   = get\_post\_meta( $post\_id, 'geo\_address', true ); |
| [178](#L178) | if ( empty( $latitude ) || empty( $longitude ) ) { |
| [179](#L179) | continue; |
| [180](#L180) | } |
| [181](#L181) |  |
| [182](#L182) | $markers[][] = (object) [ |
| [183](#L183) | 'lat'  => $latitude, |
| [184](#L184) | 'lng'  => $longitude, |
| [185](#L185) | 'text' => wp\_kses\_post( apply\_filters( 'ootb\_cf\_modal\_content', $address, $post\_id ) ), |
| [186](#L186) | 'id'   => $post\_id, |
| [187](#L187) | 'icon' => self::get\_cf\_marker\_icon( $post\_id ), |
| [188](#L188) | ]; |
| [189](#L189) | } else { |
| [190](#L190) | if ( $post\_id === $current\_post\_id ) { |
| [191](#L191) | continue; |
| [192](#L192) | } |
| [193](#L193) | $content = get\_post\_field( 'post\_content', $post\_id ); |
| [194](#L194) | $blocks  = parse\_blocks( $content ); |
| [195](#L195) | foreach ( $blocks as $block ) { |
| [196](#L196) | if ( $block[ 'blockName' ] !== 'ootb/openstreetmap' || empty( $block[ 'attrs' ] ) ) { |
| [197](#L197) | continue; |
| [198](#L198) | } |
| [199](#L199) |  |
| [200](#L200) | $attrs = json\_decode( wp\_json\_encode( $block[ 'attrs' ] ) ); |
| [201](#L201) |  |
| [202](#L202) | if ( |
| [203](#L203) | empty( $attrs->markers ) || |
| [204](#L204) | ( isset( $attrs->serverSideRender ) && true === $attrs->serverSideRender ) |
| [205](#L205) | ) { |
| [206](#L206) | continue; |
| [207](#L207) | } |
| [208](#L208) | $markers[] = $attrs->markers; |
| [209](#L209) | } |
| [210](#L210) | } |
| [211](#L211) | } |
| [212](#L212) | $flattened\_markers = array\_merge( ...$markers ); |
| [213](#L213) |  |
| [214](#L214) | return wp\_json\_encode( $flattened\_markers ); |
| [215](#L215) | } |
| [216](#L216) |  |
| [217](#L217) | /\*\* |
| [218](#L218) | \* Renders a map based on the provided shortcode attributes. |
| [219](#L219) | \* |
| [220](#L220) | \* Shortcode format: |
| [221](#L221) | \* [ootb\_query post\_type="post" posts\_per\_page="10" post\_ids="1,2,3", height="400px", provider="", maptype="", touchzoom="", scrollwheelzoom="", dragging="", doubleclickzoom="", marker=""] |
| [222](#L222) | \* |
| [223](#L223) | \* Replace "post" with your desired post\_type, "10" with the number of posts you want per page, |
| [224](#L224) | \* "1,2,3" with your desired post IDs, "400px" with the desired height, and the remaining arguments with your desired settings for the map attributes. |
| [225](#L225) | \* |
| [226](#L226) | \* @param string|array $attrs The attributes for the shortcode. |
| [227](#L227) | \* |
| [228](#L228) | \* @type string $source (Optional) The source of the data. Can be either "geodata" or "block" (default). |
| [229](#L229) | \* @type string $post\_type (Optional) The post type to query. Default "post". |
| [230](#L230) | \* @type int $posts\_per\_page (Optional) The number of posts per page. Default 10. |
| [231](#L231) | \* @type string $post\_ids (Optional) Comma-separated IDs of posts to include in the query. |
| [232](#L232) | \* @type string $height (Optional) The wanted height for the map. Default '400px'. |
| [233](#L233) | \* @type string $provider (Optional) The map provider. Default empty string. |
| [234](#L234) | \* @type string $maptype (Optional) The map type. Default empty string. |
| [235](#L235) | \* @type string $touchzoom (Optional) Enable touch zoom on the map. Default empty string. |
| [236](#L236) | \* @type string $scrollwheelzoom (Optional) Enable zooming on the map with a mouse scroll wheel. Default empty string. |
| [237](#L237) | \* @type string $dragging (Optional) Enable dragging on the map. Default empty string. |
| [238](#L238) | \* @type string $doubleclickzoom (Optional) Enable zooming in on the map with a double click. Default empty string. |
| [239](#L239) | \* @type string $marker (Optional) The marker for the map. Default empty string. |
| [240](#L240) | \* |
| [241](#L241) | \* @return string Rendered HTML content for the map. |
| [242](#L242) | \*/ |
| [243](#L243) | public function shortcode( $attrs ) { |
| [244](#L244) | if ( is\_admin() ) { |
| [245](#L245) | return ''; |
| [246](#L246) | } |
| [247](#L247) | if ( ! Helper::has\_block\_in\_frontend( OOTB\_BLOCK\_NAME ) ) { |
| [248](#L248) | $assets = new Assets(); |
| [249](#L249) | $assets->shortcode\_assets(); |
| [250](#L250) | } |
| [251](#L251) | // Only allow specific attributes. |
| [252](#L252) | $attrs = shortcode\_atts( |
| [253](#L253) | array\_merge( |
| [254](#L254) | [ |
| [255](#L255) | 'source'         => '', |
| [256](#L256) | 'post\_type'      => 'post', |
| [257](#L257) | 'posts\_per\_page' => self::get\_posts\_per\_page(), |
| [258](#L258) | 'post\_ids'       => '', |
| [259](#L259) | 'height'         => '400px', |
| [260](#L260) | ], |
| [261](#L261) | self::overridable\_attrs() |
| [262](#L262) | ) |
| [263](#L263) | , $attrs, 'ootb\_query' ); |
| [264](#L264) |  |
| [265](#L265) | // Construct the queryArgs for the render\_callback method. |
| [266](#L266) | $queryArgs = [ |
| [267](#L267) | 'source'         => $attrs[ 'source' ], |
| [268](#L268) | 'post\_type'      => $attrs[ 'post\_type' ], |
| [269](#L269) | 'posts\_per\_page' => $attrs[ 'posts\_per\_page' ], |
| [270](#L270) | ]; |
| [271](#L271) |  |
| [272](#L272) | // Check if specific posts are requested |
| [273](#L273) | if ( $attrs[ 'post\_ids' ] !== '' ) { |
| [274](#L274) | $post\_ids                = array\_map( 'intval', explode( ',', $attrs[ 'post\_ids' ] ) ); |
| [275](#L275) | $queryArgs[ 'post\_\_in' ] = $post\_ids; |
| [276](#L276) | } |
| [277](#L277) |  |
| [278](#L278) | $render\_callback\_attrs = [ |
| [279](#L279) | 'serverSideRender' => true, |
| [280](#L280) | 'queryArgs'        => $queryArgs, |
| [281](#L281) | ]; |
| [282](#L282) |  |
| [283](#L283) | $content = sprintf( |
| [284](#L284) | '<div class="ootb-openstreetmap--map" %1$s style="height: %2$s;"></div>', |
| [285](#L285) | self::default\_attrs( $attrs ), |
| [286](#L286) | $attrs[ 'height' ] |
| [287](#L287) | ); |
| [288](#L288) |  |
| [289](#L289) | return $this->render\_callback( $render\_callback\_attrs, $content ); |
| [290](#L290) | } |
| [291](#L291) |  |
| [292](#L292) | /\*\* |
| [293](#L293) | \* Gets the default attributes for the map. |
| [294](#L294) | \* |
| [295](#L295) | \* @param array $overrides The attributes to override. |
| [296](#L296) | \* |
| [297](#L297) | \* @return string |
| [298](#L298) | \*/ |
| [299](#L299) | private static function default\_attrs( array $overrides = [] ): string { |
| [300](#L300) | $data\_attrs = array\_merge( |
| [301](#L301) | array\_keys( self::overridable\_attrs() ), |
| [302](#L302) | [ |
| [303](#L303) | 'showmarkers', |
| [304](#L304) | 'shapestyle', |
| [305](#L305) | 'shapetext', |
| [306](#L306) | 'markers', |
| [307](#L307) | 'bounds', |
| [308](#L308) | 'zoom', |
| [309](#L309) | 'minzoom', |
| [310](#L310) | 'maxzoom', |
| [311](#L311) | ] |
| [312](#L312) | ); |
| [313](#L313) | $attrs      = []; |
| [314](#L314) | foreach ( $data\_attrs as $attr ) { |
| [315](#L315) | $default\_attr = Helper::default\_block\_attributes( $attr ); |
| [316](#L316) | if ( isset( $default\_attr ) ) { |
| [317](#L317) | if ( ! empty( $overrides[ $attr ] ) && $overrides[ $attr ] !== $default\_attr ) { |
| [318](#L318) | if ( 'marker' === $attr ) { |
| [319](#L319) | $overrides[ $attr ] = Helper::get\_marker\_attr\_from\_url( $overrides[ $attr ] ); |
| [320](#L320) | } |
| [321](#L321) | $default\_attr = $overrides[ $attr ]; |
| [322](#L322) | } |
| [323](#L323) | $attr    = 'data-' . $attr; |
| [324](#L324) | $attrs[] = sprintf( '%s="%s"', $attr, $default\_attr ); |
| [325](#L325) | } |
| [326](#L326) | } |
| [327](#L327) |  |
| [328](#L328) | return implode( ' ', $attrs ); |
| [329](#L329) | } |
| [330](#L330) |  |
| [331](#L331) | /\*\* |
| [332](#L332) | \* Returns the attributes that can be overridden. |
| [333](#L333) | \* @return string[] |
| [334](#L334) | \*/ |
| [335](#L335) | private static function overridable\_attrs(): array { |
| [336](#L336) | return [ |
| [337](#L337) | 'provider'        => '', |
| [338](#L338) | 'maptype'         => '', |
| [339](#L339) | 'touchzoom'       => '', |
| [340](#L340) | 'scrollwheelzoom' => '', |
| [341](#L341) | 'dragging'        => '', |
| [342](#L342) | 'doubleclickzoom' => '', |
| [343](#L343) | 'marker'          => '', |
| [344](#L344) | ]; |
| [345](#L345) | } |
| [346](#L346) |  |
| [347](#L347) | /\*\* |
| [348](#L348) | \* Gets the marker icon and allows the user to override it with a hook. |
| [349](#L349) | \* |
| [350](#L350) | \* @param int $post\_id The post ID. |
| [351](#L351) | \* |
| [352](#L352) | \* @return array|null |
| [353](#L353) | \*/ |
| [354](#L354) | private static function get\_cf\_marker\_icon( int $post\_id = 0 ): ?array { |
| [355](#L355) | if ( empty( $post\_id ) ) { |
| [356](#L356) | return null; |
| [357](#L357) | } |
| [358](#L358) | $icon\_url = apply\_filters( 'ootb\_cf\_marker\_icon', '', $post\_id ); |
| [359](#L359) | $icon     = null; |
| [360](#L360) | if ( ! empty( $icon\_url ) && filter\_var( $icon\_url, FILTER\_VALIDATE\_URL ) ) { |
| [361](#L361) | $icon = [ |
| [362](#L362) | 'url' => esc\_url( $icon\_url ), |
| [363](#L363) | ]; |
| [364](#L364) | } |
| [365](#L365) |  |
| [366](#L366) | return $icon; |
| [367](#L367) | } |
| [368](#L368) | } |

**Note:** See [TracBrowser](/wiki/TracBrowser)
for help on using the repository browser.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Plain Text](/browser/ootb-openstreetmap/tags/2.8.3/includes/classes/Query.php?format=txt)
* [Original Format](/export/3222434/ootb-openstreetmap/tags/2.8.3/includes/classes/Query.php)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from www.wordfence.com_9d34914f_20250114_182909.html ===


[![](https://www.wordfence.com/img/wordfence-intelligence-logo.svg)](/threat-intel/)

Have you found a vulnerability in a WordPress plugin or theme? Report vulnerabilities in WordPress plugins and themes through our [bug bounty program](https://www.wordfence.com/threat-intel/bug-bounty-program) and earn a bounty on all in-scope submissions, while we handle the responsible disclosure process on your behalf.

As a reminder, the Wordfence Intelligence Vulnerability Database API is completely free to query and utilize, both personally and commercially, and contains all the same vulnerability data as the user interface. Please review the API documentation and Webhook documentation for more information on how to query the vulnerability API endpoints and configure webhooks utilizing all the same data present in the Wordfence Intelligence user interface.

# Out of the Block: OpenStreetMap <= 2.8.3 - Authenticated (Contributor+) Stored Cross-Site Scripting via ootb\_query Shortcode

 [Wordfence Intelligence](https://www.wordfence.com/threat-intel)   >    [Vulnerability Database](https://www.wordfence.com/threat-intel/vulnerabilities)   >   Out of the Block: OpenStreetMap <= 2.8.3 - Authenticated (Contributor+) Stored Cross-Site Scripting via ootb\_query Shortcode

6.4

**Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')**
**CVSS Vector**
[CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:C/C:L/I:L/A:N](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:C/C:L/I:L/A:N)

| CVE | [CVE-2024-11827](https://www.cve.org/CVERecord?id=CVE-2024-11827) |
| --- | --- |
| CVSS | 6.4 (Medium) |
| Publicly Published | December 12, 2024 |
| Last Updated | December 16, 2024 |
| Researcher | [Peter Thaleikis](https://www.wordfence.com/threat-intel/vulnerabilities/researchers/spek) |

### Description

The Out of the Block: OpenStreetMap plugin for WordPress is vulnerable to Stored Cross-Site Scripting via the plugin's ootb\_query shortcode in all versions up to, and including, 2.8.3 due to insufficient input sanitization and output escaping on user supplied attributes. This makes it possible for authenticated attackers, with contributor-level access and above, to inject arbitrary web scripts in pages that will execute whenever a user accesses an injected page.

#### References

* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/browser/ootb-openstreetmap/tags/2.8.3/includes/classes/Query.php#L283)
* [wordpress.org](https://wordpress.org/plugins/ootb-openstreetmap/#developers)
* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/changeset?sfp_email=&sfph_mail=&reponame=&new=3207248%40ootb-openstreetmap%2Ftrunk&old=3190811%40ootb-openstreetmap%2Ftrunk&sfp_email=&sfph_mail=#file2)

#### Share

[Facebook](https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Footb-openstreetmap%2Fout-of-the-block-openstreetmap-283-authenticated-contributor-stored-cross-site-scripting-via-ootb-query-shortcode&t=Out%20of%20the%20Block%3A%20OpenStreetMap%20%3C%3D%202.8.3%20-%20Authenticated%20%28Contributor%2B%29%20Stored%20Cross-Site%20Scripting%20via%20ootb_query%20Shortcode "Facebook")
[Twitter](https://twitter.com/share?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Footb-openstreetmap%2Fout-of-the-block-openstreetmap-283-authenticated-contributor-stored-cross-site-scripting-via-ootb-query-shortcode&text=Out%20of%20the%20Block%3A%20OpenStreetMap%20%3C%3D%202.8.3%20-%20Authenticated%20%28Contributor%2B%29%20Stored%20Cross-Site%20Scripting%20via%20ootb_query%20Shortcode "Twitter")
[LinkedIn](https://www.linkedin.com/shareArticle?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Footb-openstreetmap%2Fout-of-the-block-openstreetmap-283-authenticated-contributor-stored-cross-site-scripting-via-ootb-query-shortcode "LinkedIn")
Email

## Vulnerability Details for Out of the Block: OpenStreetMap

#### [Out of the Block: OpenStreetMap](https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/ootb-openstreetmap)

| Software Type | Plugin |
| --- | --- |
| Software Slug | ootb-openstreetmap [(view on wordpress.org)](https://wordpress.org/plugins/ootb-openstreetmap) |
| Patched? | Yes |
| Remediation | Update to version 2.8.4, or a newer patched version |
| Affected Version | * <= 2.8.3 |
| Patched Version | * 2.8.4 |

This record contains material that is subject to copyright.

**Copyright 2012-2025 Defiant Inc.**

**License:**
Defiant hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute this software vulnerability information. Any copy of the software vulnerability information you make for such purposes is authorized provided that you include a hyperlink to this vulnerability record and reproduce Defiant's copyright designation and this license in any such copy.
**[Read more.](https://www.wordfence.com/wordfence-intelligence-terms-and-conditions/)**

**Copyright 1999-2025 The MITRE Corporation**

**License:**
CVE Usage: MITRE hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute Common Vulnerabilities and Exposures (CVE®). Any copy you make for such purposes is authorized provided that you reproduce MITRE's copyright designation and this license in any such copy.
**[Read more.](https://www.cve.org/Legal/TermsOfUse)**

Have information to add, or spot any errors? Contact us at wfi-support@wordfence.com so we can make any appropriate adjustments.

Did you know Wordfence Intelligence provides free personal and commercial API access to our comprehensive WordPress vulnerability database, along with a free webhook integration to stay on top of the latest vulnerabilities added and updated in the database? Get started today!

Learn more

Want to get notified of the latest vulnerabilities that may affect your WordPress site?
 Install Wordfence on your site today to get notified immediately if your site is affected by a vulnerability that has been added to our database.

Get Wordfence

The Wordfence Intelligence WordPress vulnerability database is completely free to access and query via API. Please review the documentation on how to access and consume the vulnerability data via API.

Documentation



=== Content from wordpress.org_db70f7cc_20250114_182908.html ===


[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Showcase](https://wordpress.org/showcase/)
* [Hosting](https://wordpress.org/hosting/)
* Extend
  + [Themes](https://wordpress.org/themes/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Blocks](https://wordpress.org/blocks/)
  + [Openverse ↗︎](https://openverse.org/)
* Learn
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* Community
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [Events](https://events.wordpress.org/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* About
  + [About WordPress](https://wordpress.org/about/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
* [Get WordPress](https://wordpress.org/download/)

Search in WordPress.org

[Get WordPress](https://wordpress.org/download/)

[WordPress.org](https://wordpress.org/)

[Plugin Directory](https://wordpress.org/plugins/)

Out of the Block: OpenStreetMap

* [Submit a plugin](https://wordpress.org/plugins/developers/)
* [My favorites](https://wordpress.org/plugins/browse/favorites/)
* [Log in](https://login.wordpress.org/?redirect_to=https%3A%2F%2Fwordpress.org%2Fplugins%2Footb-openstreetmap&locale=en_US)

* [Submit a plugin](https://wordpress.org/plugins/developers/)
* [My favorites](https://wordpress.org/plugins/browse/favorites/)
* [Log in](https://login.wordpress.org/?redirect_to=https%3A%2F%2Fwordpress.org%2Fplugins%2Footb-openstreetmap&locale=en_US)

Search plugins

![](https://ps.w.org/ootb-openstreetmap/assets/banner-772x250.jpg?rev=2841248)
![](https://ps.w.org/ootb-openstreetmap/assets/icon-256x256.jpg?rev=2841248)
# Out of the Block: OpenStreetMap

By [Giorgos Sarigiannidis](https://www.gsarigiannidis.gr)

[Download](https://downloads.wordpress.org/plugin/ootb-openstreetmap.2.8.5.zip)

* [Details](https://wordpress.org/plugins/ootb-openstreetmap/#description)
* [Reviews](https://wordpress.org/plugins/ootb-openstreetmap/#reviews)
* [Installation](https://wordpress.org/plugins/ootb-openstreetmap/#installation)
* [Development](https://wordpress.org/plugins/ootb-openstreetmap/#developers)

[Support](https://wordpress.org/support/plugin/ootb-openstreetmap/)

## Description

A map block for Gutenberg which uses [OpenStreetMap](https://www.openstreetmap.org) and [Leaflet.js](https://leafletjs.com). It needs no API keys and works out of the box (or, out of the Block, if you prefer). Benefiting from Gutenberg’s potential, the plugin tries a different take on how to add your locations on the map and rethinks a few things, UX-wise.

Instead of manually adding coordinates for each one of your markers, just click-and-drop them directly on the map. You want to adjust their position? Just drag them wherever you want. And instead of filling-in custom fields to set each marker’s popup content, just open that popup and start writing in it, the Gutenberg way (it supports WYSIWYG editing, with links, images, and all). It even stores the map’s zoom level as you use it so that you don’t have to set it by hand.

* [Follow the project’s development on GitHub](https://github.com/gsarig/ootb-openstreetmap)
* [Release history](https://github.com/gsarig/ootb-openstreetmap/releases)
* [Roadmap](https://github.com/users/gsarig/projects/1)
* [Hooks🪝](https://github.com/gsarig/ootb-openstreetmap?tab=readme-ov-file#hooks)
* [Shortcodes](https://github.com/gsarig/ootb-openstreetmap?tab=readme-ov-file#shortcodes)

#### Features

* No need for API keys. Just install and use it.
* Support for multiple markers.
* Support for a different icon per marker.
* Support for polygons and polylines.
* [Dead-simple interface](https://www.gsarigiannidis.gr/wordpress-gutenberg-map-block-openstreetmap/). Don’t search for coordinates and don’t get overwhelmed by too many fields when using multiple markers. Just point and click on the map to add your marker where you want it and edit it’s popup content directly from there.
* [Place search](https://www.gsarigiannidis.gr/openstreetmap-place-search/). Find locations by typing keywords.
* Remembers the zoom that you set when adding the markers and stores it so that you don’t set it by hand (which you can do anyway if you prefer).
* OpenAI integration which allows you to add markers by using commands in natural language. Just say “please” to activate (e.g. “Please, show me where GOT was filmed”). Requires an OpenAI API key. [Read more](https://www.gsarigiannidis.gr/openstreetmap-openai-integration/).
* Query Maps: Supports creating a map out of maps added on other posts or post types. This can be quite powerful when, for example, you have a custom post type for “Places” with each place having its own map, and you want to dynamically gather-up all the places on a single map.
* Shortcode support: You can use the shortcode `[ootb_query]` as an alternative way to use the aforementioned Query Maps feature (see the FAQ for more info).
* Support for a location custom field, which can be used to store a post’s or post type’s location, following the [Geodata guidelines](https://codex.wordpress.org/Geodata). Read more in the [v.2.8.0 release notes](https://github.com/gsarig/ootb-openstreetmap/releases/tag/2.8.0).
* Adjust the map height.
* Change the default marker icon with a custom one.
* Enable or disable map dragging.
* Enable or disable touch zoom.
* Enable or disable double-click zoom.
* Enable or disable scroll wheel zoom.
* Set a minimum and maximum limit that the user can zoom on the frontend. Setting the same value to both fields will lock the zoom at that level.
* Support for other Layer Providers: MapBox (using your own API key) and Stamen.
* Option to export locations in a JSON file
* Option to import locations from a JSON file

## Screenshots

* [![](https://ps.w.org/ootb-openstreetmap/assets/screenshot-1.gif?rev=2841248)](https://ps.w.org/ootb-openstreetmap/assets/screenshot-1.gif?rev=2841248)

  Adding markers and rich content
* [![](https://ps.w.org/ootb-openstreetmap/assets/screenshot-2.gif?rev=2841248)](https://ps.w.org/ootb-openstreetmap/assets/screenshot-2.gif?rev=2841248)

  Using the place search to throw multiple markers in a row by typing keyword and double+enter (no mouse)
* [![](https://ps.w.org/ootb-openstreetmap/assets/screenshot-3.jpg?rev=2841248)](https://ps.w.org/ootb-openstreetmap/assets/screenshot-3.jpg?rev=2841248)

  The map editing screen
* [![](https://ps.w.org/ootb-openstreetmap/assets/screenshot-4.jpg?rev=2841248)](https://ps.w.org/ootb-openstreetmap/assets/screenshot-4.jpg?rev=2841248)

  Map behavior options
* [![](https://ps.w.org/ootb-openstreetmap/assets/screenshot-5.jpg?rev=2841248)](https://ps.w.org/ootb-openstreetmap/assets/screenshot-5.jpg?rev=2841248)

  Adding a marker
* [![](https://ps.w.org/ootb-openstreetmap/assets/screenshot-6.jpg?rev=2841248)](https://ps.w.org/ootb-openstreetmap/assets/screenshot-6.jpg?rev=2841248)

  Using custom markers
* [![](https://ps.w.org/ootb-openstreetmap/assets/screenshot-7.jpg?rev=2841248)](https://ps.w.org/ootb-openstreetmap/assets/screenshot-7.jpg?rev=2841248)

  Place search
* [![](https://ps.w.org/ootb-openstreetmap/assets/screenshot-8.jpg?rev=2841248)](https://ps.w.org/ootb-openstreetmap/assets/screenshot-8.jpg?rev=2841248)

  Plugin settings page
* [![](https://ps.w.org/ootb-openstreetmap/assets/screenshot-9.gif?rev=2841248)](https://ps.w.org/ootb-openstreetmap/assets/screenshot-9.gif?rev=2841248)

  Adding a polygon
* [![](https://ps.w.org/ootb-openstreetmap/assets/screenshot-10.gif?rev=2841248)](https://ps.w.org/ootb-openstreetmap/assets/screenshot-10.gif?rev=2841248)

  Adding a polyline
* [![](https://ps.w.org/ootb-openstreetmap/assets/screenshot-11.gif?rev=2848219)](https://ps.w.org/ootb-openstreetmap/assets/screenshot-11.gif?rev=2848219)

  Export and import locations
* [![](https://ps.w.org/ootb-openstreetmap/assets/screenshot-12.gif?rev=3015646)](https://ps.w.org/ootb-openstreetmap/assets/screenshot-12.gif?rev=3015646)

  Demonstrating the OpenAI integration

## Blocks

This plugin provides 1 block.

* OpenStreetMap by Out of the Block
  A map block for the Gutenberg Editor using OpenStreetMaps and Leaflet that needs no API keys and works out of the box.

## Installation

1. Upload the plugin to your WordPress plugins directory and activate it.
2. That’s it. You can go to a post/page that supports the Gutenberg editor and start using the block called “Out of the Block: OpenStreetMap”

## FAQ

### Do I need an API key, like with Google Maps?

No.

That’s the point, actually. Just install the plugin and start adding maps. Keep in mind, though, that as stated on the [OpenStreetMap Tile Usage Policy](https://operations.osmfoundation.org/policies/tiles/), OSM’s own servers are run entirely on donated resources and they have strictly limited capacity. Using them on a site with low traffic will probably be fine. Nevertheless, you are advised to create an account to [MapBox](https://www.mapbox.com/) and get a free API Key.

### How can I add a custom Mapbox style?

You can find the style URL on [Mapbox Studio](https://www.mapbox.com/studio/). There, use the “Share” button, and under “Developer resources”, copy the “Style URL”. It should look like that: `mapbox://styles/username/style-id`. You can declare a global style on the plugin’s settings, to be used as a default for all the maps, or you can set a custom style for each map, by using the block’s settings panel.

### How do I add a new location?

To add a location, left-click on the map for a while, until you see the prompt saying “Release to drop a marker here”. On browsers that support it, the cursor transforms from hand to crosshair, to make it even more apparent. As long as the prompt is visible, it means that releasing the click will drop the marker at that spot. That slight delay has been added to prevent you from accidentally adding markers all over the place with every click.

Alternatively, you can use the map’s place search functionality.

### How do I remove a location?

Click on the marker to open up its popup. There, you will see the “Remove” button.

### I can’t find some of the options like disable dragging, setting zoom levels etc

Check under the “Map behavior” section, at the blocks’ settings at the sidebar on the right. It’s toggled off by default, that’s probably why you missed it.

### How does the OpenAI integration work?

First of all, you will need to create an account to [OpenAI](https://openai.com/) and get an API key. Then, go to the plugin’s settings page and paste your key there. After that, you can start adding markers by using commands in natural language. Just say “please” to activate (e.g. “Please, show me where GOT was filmed”). Please keep in mind, though, that it’s like asking ChatGPT: the answers you get might not always be 100% reliable, and you should always double-check to confirm their accuracy. [Read more](https://www.gsarigiannidis.gr/openstreetmap-openai-integration/).

### How can I query maps from other posts or post types?

On the block’s side panel, Select the “Map data” panel and click on the “Fetch locations” button. This will automatically retrieve on the frontend all the markers from your posts (you can also select a specific post type from the dropdown). The block will be locked from editing, as the markers will be dynamically retrieved from the selected posts. If you don’t want that, there is a “Stop syncing” button that will unlock the block, drop the markers on the map and allow you to edit.

### How can I use the shortcode?

To see the available shortcodes and the parameters that you can pass, [go here](https://github.com/gsarig/ootb-openstreetmap?tab=readme-ov-file#shortcodes).

### I want more control. Are there any hooks that I could use?

Glad you asked! There are a few hooks that you can use to further customize the plugin’s behavior. [You can find them here](https://github.com/gsarig/ootb-openstreetmap?tab=readme-ov-file#hooks).

## Reviews

![](https://secure.gravatar.com/avatar/215095d0421cec18d664a51dfab011accfc6f15eeed3d9f3c7447b5492b4a510?s=60&d=retro&r=g)
### [Great and Easy](https://wordpress.org/support/topic/great-and-easy-143/)

[sebastian](https://profiles.wordpress.org/schertel/ "Posts by sebastian")
April 7, 2023

This is one hell of a nice plugin. It allows you to easily put a block on your site and add (multiple) markers. You can easily change the contents of the popup (just don’t go wild) and is GDPR friendly.
If that’s what you need this is the plugin to go to. If you need other stuff (e. g. filters and stuff) – keep looking. But for a simple map that just works and has a easy, clean interface take this one.

![](https://secure.gravatar.com/avatar/adaa5886325815dc3f6076b83f771dd0fcdebf039b02e03e742f3bd232050f9f?s=60&d=retro&r=g)
### [Very nice – but only for Gutenberg](https://wordpress.org/support/topic/very-nice-but-only-for-gutenberg/)

[Hoerli](https://profiles.wordpress.org/hoerli/ "Posts by Hoerli")
May 4, 2023

<p>The plugin is really great.<br />Too bad it only works with the Gutenberg editor.<br />I prefer to use the Classic Editor, but there I can not use the plugin so.<br />I would have to adjust the HTML source code by hand.</p>
<p>The Map is not loading, if CloudFlare Rocket Loader is active.</p>

![](https://secure.gravatar.com/avatar/dd3323a902727aca018a8d81bd98f4cc71610616f4c4b2f3b56197b5bea17edd?s=60&d=retro&r=g)
### [Simple to use](https://wordpress.org/support/topic/simple-to-use-274/)

[rol69](https://profiles.wordpress.org/rol69/ "Posts by rol69")
May 11, 2021

I have testet a lot of OSM plugins. I only needed a card with two markers. This plugin is simple. In a few minutes the card is ready.

![](https://secure.gravatar.com/avatar/93675b5dd86a0df8212f0ceb415a046a5c241b5acc1a3d470b9ffbb59f0f3a86?s=60&d=retro&r=g)
### [Who needs Google maps?](https://wordpress.org/support/topic/who-needs-google-maps/)

[AlfredG](https://profiles.wordpress.org/alfredg/ "Posts by AlfredG")
October 6, 2020

Great plugin. First one that works very easy with multiple pins. And no API en giving credentials for billing. In the info window you van make a link to the route on Google maps if you want.
Formatting the block is easy.

![](https://secure.gravatar.com/avatar/8c0ced2ad5a0c50ec3a0903b1d1946b4309a9b5e4ed01ff7f8d40bc710f49e3e?s=60&d=retro&r=g)
### [The best map block](https://wordpress.org/support/topic/the-best-map-block/)

[nick6352683](https://profiles.wordpress.org/nick6352683/ "Posts by nick6352683")
September 17, 2020

Just because we don’t need an API license key, and we can have multiple pins per map among other things, for me this is the best mapping block. And of course, the plugin works exactly as advertised.
Until now, I was using my own map block I had created with ACF Pro, but that was just simple Google Map embed, which again did not require an API key, but was restricted to one pin per map, and of course no live data like traffic and other visuals, along with no street view.
Well done, and thank you,
Nick.

[Read all 5 reviews](https://wordpress.org/support/plugin/ootb-openstreetmap/reviews/)
## Contributors & Developers

“Out of the Block: OpenStreetMap” is open source software. The following people have contributed to this plugin.

Contributors

* ![](https://secure.gravatar.com/avatar/88befd8b3fe378b751c57bc121c351d7d16e2a79ab25999f3fe813895f165422?s=32&d=mm&r=g) [Giorgos Sarigiannidis](https://profiles.wordpress.org/gsarig/)

“Out of the Block: OpenStreetMap” has been translated into 2 locales. Thank you to [the translators](https://translate.wordpress.org/projects/wp-plugins/ootb-openstreetmap/contributors) for their contributions.

[Translate “Out of the Block: OpenStreetMap” into your language.](https://translate.wordpress.org/projects/wp-plugins/ootb-openstreetmap)

### Interested in development?

[Browse the code](https://plugins.trac.wordpress.org/browser/ootb-openstreetmap/), check out the [SVN repository](https://plugins.svn.wordpress.org/ootb-openstreetmap/), or subscribe to the [development log](https://plugins.trac.wordpress.org/log/ootb-openstreetmap/) by [RSS](https://plugins.trac.wordpress.org/log/ootb-openstreetmap/?limit=100&mode=stop_on_copy&format=rss).

## Changelog

#### 2.8.5

* Various fixes to ensure that it passes the checks of the “Plugin Check” plugin.
* Drops support for legacy PHP versions. The minimum requirement is PHP 8.1.

#### 2.8.4

* Security update. Fixes a vulnerability which allows authenticated attackers with contributor permissions or above to insert JavaScript that triggers when accessing the web-page by mouse.

#### 2.8.3

* Bumps support to WordPress 6.7.
* Bumps minimum supported WordPress version to 6.5.
* Fixes a tagging issue in the wordpress.org repo.
* Partially fixes a bug where the block wouldn’t display on the Full Site Editor’s template parts. There is still a bug where dragging doesn’t work well when the block is used in a template part, and was disabled as a temporary workaround.
* Improves the way the frontend scripts are loaded (requires at least WordPress v.6.5 amd above).

#### 2.8.2

* [NEW] Adds the `ootb_cf_modal_content` and `ootb_cf_marker_icon` hooks, which allow you to change the content of the modal that appears when you query posts based on their “Location” custom fields, as well as the marker icon. For more info, check the plugin’s FAQ section.

#### 2.8.0

* [NEW] Adds an option to enable a location custom field, which can be used to store a post’s or post type’s location, following the [Geodata guidelines](https://codex.wordpress.org/Geodata).
* [NEW] Adds a new block (a Block Variation, to be precise), to display a map that retrieves markers from posts or post types including the location custom field.
* [FIX] Fixes a PHP warning ([see the report](https://wordpress.org/support/topic/automatic-conversion-of-false-to-array-is-deprecated-php-8-1-warning/)).
* [FIX] Fixes a bug which caused an editor crash ([see the report](https://wordpress.org/support/topic/js-error-editor-crash-when-swapping-a-template/)).
* [FIX] Fixes an issue where the plugin was triggering unnecessary post updates.
* [MAINTENANCE] Updates the build scripts and the plugin’s assets.

#### 2.7.0

* [NEW] Adds an option to set custom Mapbox styles using [Mapbox Studio](https://www.mapbox.com/studio/).

#### 2.6.0

* [NEW] Adds option to query maps, which allows you to create a map out of maps added on other posts or post types. This can be quite powerful when, for example, you have a custom post type for “Places” with each place having its own map, and you want to dynamically gather-up all the places on a single map.
* [NEW] Adds shortcode support. You can use the shortcode `[ootb_query]` to retrieve the aforementioned Query Maps feature (see the FAQ for more info).

#### 2.5.0

* [New] Adds OpenAI integration which allows you to add markers by using commands in natural language. Just say “please” to activate (e.g. “Please, show me where GOT was filmed”). Requires an OpenAI API key. [Read more](https://www.gsarigiannidis.gr/openstreetmap-openai-integration/).

#### 2.4.1

* Updates the build scripts.
* Updates compatibility with WordPress 6.4.
* Fixes a bug where the marker’s delete button would remove the wrong marker.

#### 2.4.0

* [New] Adds an option to prevent the default map scroll/touch behaviours.

#### 2.3.0

* [New] Adds support for different icons per marker.
* Updates the `react-leaflet` script to `v.4.2.1`.
* Updates compatibility with WordPress 6.2.

#### 2.2.0

* [New] Adds option to export locations to a JSON file
* [New] Adds option to import locations from a previously exported JSON file

#### 2.1.0

* [New] Adds support for polygon shapes
* [New] Adds support for polyline shapes
* [Fix] Improves the drag and drop of markers
* Updates the `react-leaflet` script to `v.4.2.0`
* Updates the plugin’s assets and documentation

#### 2.0.2

* Replaces `str_contains` with `strpos`, for better backwards compatibility with older versions of PHP / WordPress.

#### 2.0.1

* Fixes a bug which broke the admin on WordPress versions prior to 5.9.

#### 2.0.0

* Refactors the build scripts to use the official `@wordpress/create-block` instead of `create-guten-block`, which isn’t supported anymore.
* Updates `Leaflet` and `react-leaflet` to their latest versions (Leaflet 1.9.3 and react-leaflet 4.1.0).
* Adds a new option to set the default coordinates when you add a new block. The plugin will try to guess the default location based on the site’s timezone.

#### 1.3.5

* Fixes a PHP warning in the widgets area of the admin
* Updates translations

#### 1.3.4

* Fixes a PHP warning (more info: https://wordpress.org/support/topic/error-under-php8-2/)

#### 1.3.3

* Fixes a bug where the block’s scripts didn’t load if the block is used in a Widget

#### 1.3.2

* Fixes a bug where the block’s scripts didn’t load when used as a reusable block

#### 1.3

* Added Stamen as a Tile Provider
* Fixed a bug with map centering when there is only one location
* Fixed wrong link on attributions

#### 1.2

* Added MapBox as a Tile Provider

#### 1.1

* Place search functionality added
* Improved marker precision
* Better handling of pinning on mobile devices
* Overall improvements on dragging smoothness

#### 1.0.1

* Fixed a bug during plugin activation.

#### 1.0

* First releases

## Meta

* Version **2.8.5**
* Last updated **1 month ago**
* Active installations **600+**
* WordPress version **6.5 or higher**
* Tested up to **6.7.1**
* PHP version **8.1 or higher**
* Languages
  See all 3

  Close

  [Dutch](https://nl.wordpress.org/plugins/ootb-openstreetmap/), [English (US)](https://wordpress.org/plugins/ootb-openstreetmap/), and [French (France)](https://fr.wordpress.org/plugins/ootb-openstreetmap/).

  [Translate into your language](https://translate.wordpress.org/projects/wp-plugins/ootb-openstreetmap)
* Tags [block](https://wordpress.org/plugins/tags/block/)[Google Maps](https://wordpress.org/plugins/tags/google-maps/)[leaflet](https://wordpress.org/plugins/tags/leaflet/)[map](https://wordpress.org/plugins/tags/map/)[openstreetmap](https://wordpress.org/plugins/tags/openstreetmap/)
* [Advanced View](https://wordpress.org/plugins/ootb-openstreetmap/advanced/)

## Ratings

4.8 out of 5 stars.

* [4 5-star reviews
  5 stars

  4](https://wordpress.org/support/plugin/ootb-openstreetmap/reviews/?filter=5)
* [1 4-star review
  4 stars

  1](https://wordpress.org/support/plugin/ootb-openstreetmap/reviews/?filter=4)
* [0 3-star reviews
  3 stars

  0](https://wordpress.org/support/plugin/ootb-openstreetmap/reviews/?filter=3)
* [0 2-star reviews
  2 stars

  0](https://wordpress.org/support/plugin/ootb-openstreetmap/reviews/?filter=2)
* [0 1-star reviews
  1 star

  0](https://wordpress.org/support/plugin/ootb-openstreetmap/reviews/?filter=1)

[Add my review](https://wordpress.org/support/plugin/ootb-openstreetmap/reviews/#new-post)

[See all reviews](https://wordpress.org/support/plugin/ootb-openstreetmap/reviews/)

## Contributors

* ![](https://secure.gravatar.com/avatar/88befd8b3fe378b751c57bc121c351d7d16e2a79ab25999f3fe813895f165422?s=32&d=mm&r=g) [Giorgos Sarigiannidis](https://profiles.wordpress.org/gsarig/)
## Support

Got something to say? Need help?

[View support forum](https://wordpress.org/support/plugin/ootb-openstreetmap/)

## Donate

Would you like to support the advancement of this plugin?

[Donate to this plugin](https://www.paypal.com/cgi-bin/webscr?cmd=_s-xclick&hosted_button_id=MZR4JSRUMH5EA&source=url)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Privacy](https://wordpress.org/about/privacy/)

* [Showcase](https://wordpress.org/showcase/)
* [Themes](https://wordpress.org/themes/)
* [Plugins](https://wordpress.org/plugins/)
* [Patterns](https://wordpress.org/patterns/)

* [Learn](https://learn.wordpress.org/)
* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [WordPress.tv ↗](https://wordpress.tv/)

* [Get Involved](https://make.wordpress.org/)
* [Events](https://events.wordpress.org/)
* [Donate ↗](https://wordpressfoundation.org/donate/)
* [Five for the Future](https://wordpress.org/five-for-the-future/)

* [WordPress.com ↗](https://wordpress.com/?ref=wporg-footer)
* [Matt ↗](https://ma.tt/)
* [bbPress ↗](https://bbpress.org/)
* [BuddyPress ↗](https://buddypress.org/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our X (formerly Twitter) account](https://www.x.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)
* [Visit our YouTube channel](https://www.youtube.com/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)


