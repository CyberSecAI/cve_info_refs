=== Content from plugins.trac.wordpress.org_b0b05bf7_20250114_195600.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fchangeset%2F3210469)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Changeset](/changeset/3210468 "Changeset 3210468")
* [Next Changeset](/changeset/3210470 "Changeset 3210470") →

---

# Changeset 3210469

View differences
inline
side by side

Show
lines around each change

Show the changes in full context

Ignore:

Blank lines

Case changes

White space changes

Timestamp:
12/19/2024 12:34:09 PM
([4 weeks](/timeline?from=2024-12-19T12%3A34%3A09Z&precision=second "See timeline at 12/19/2024 12:34:09 PM") ago)

Author:
taskbuilder
Message:

version change

Location:
[taskbuilder](/browser/taskbuilder?rev=3210469)
Files:

2 added
158 edited
1 copied

* [tags/3.0.7](/browser/taskbuilder/tags/3.0.7?rev=3210469 "Show entry in browser")
  (copied)
  *(copied from [taskbuilder/trunk](/browser/taskbuilder/trunk?rev=3191970 "Show original file (revision 3210457)"))*
* [tags/3.0.7/asset/images/due\_date\_reminder\_icon.svg](/browser/taskbuilder/tags/3.0.7/asset/images/due_date_reminder_icon.svg?rev=3210469 "Show entry in browser")
  (added)
* [tags/3.0.7/includes/actions/wppm\_check\_cron\_attachment.php](/browser/taskbuilder/tags/3.0.7/includes/actions/wppm_check_cron_attachment.php?rev=3210469 "Show entry in browser")
  (modified)
  ([1 diff](#file2 "Show differences"))
* [tags/3.0.7/includes/admin/addons.php](/browser/taskbuilder/tags/3.0.7/includes/admin/addons.php?rev=3210469 "Show entry in browser")
  (modified)
  ([8 diffs](#file3 "Show differences"))
* [tags/3.0.7/includes/admin/attachment/wppm\_download\_attachment.php](/browser/taskbuilder/tags/3.0.7/includes/admin/attachment/wppm_download_attachment.php?rev=3210469 "Show entry in browser")
  (modified)
  ([1 diff](#file4 "Show differences"))
* [tags/3.0.7/includes/admin/email\_notifications/wppm\_en\_change\_project\_status.php](/browser/taskbuilder/tags/3.0.7/includes/admin/email_notifications/wppm_en_change_project_status.php?rev=3210469 "Show entry in browser")
  (modified)
  ([3 diffs](#file5 "Show differences"))
* [tags/3.0.7/includes/admin/email\_notifications/wppm\_en\_project\_created.php](/browser/taskbuilder/tags/3.0.7/includes/admin/email_notifications/wppm_en_project_created.php?rev=3210469 "Show entry in browser")
  (modified)
  ([3 diffs](#file6 "Show differences"))
* [tags/3.0.7/includes/admin/email\_notifications/wppm\_en\_set\_change\_task\_status.php](/browser/taskbuilder/tags/3.0.7/includes/admin/email_notifications/wppm_en_set_change_task_status.php?rev=3210469 "Show entry in browser")
  (modified)
  ([3 diffs](#file7 "Show differences"))
* [tags/3.0.7/includes/admin/email\_notifications/wppm\_en\_set\_project\_users.php](/browser/taskbuilder/tags/3.0.7/includes/admin/email_notifications/wppm_en_set_project_users.php?rev=3210469 "Show entry in browser")
  (modified)
  ([3 diffs](#file8 "Show differences"))
* [tags/3.0.7/includes/admin/email\_notifications/wppm\_en\_submit\_proj\_comment.php](/browser/taskbuilder/tags/3.0.7/includes/admin/email_notifications/wppm_en_submit_proj_comment.php?rev=3210469 "Show entry in browser")
  (modified)
  ([1 diff](#file9 "Show differences"))
* [tags/3.0.7/includes/admin/email\_notifications/wppm\_get\_templates.php](/browser/taskbuilder/tags/3.0.7/includes/admin/email_notifications/wppm_get_templates.php?rev=3210469 "Show entry in browser")
  (modified)
  ([1 diff](#file10 "Show differences"))
* [tags/3.0.7/includes/admin/projects/filters/wppm\_project\_search\_filter.php](/browser/taskbuilder/tags/3.0.7/includes/admin/projects/filters/wppm_project_search_filter.php?rev=3210469 "Show entry in browser")
  (modified)
  ([1 diff](#file11 "Show differences"))
* [tags/3.0.7/includes/admin/projects/get\_users.php](/browser/taskbuilder/tags/3.0.7/includes/admin/projects/get_users.php?rev=3210469 "Show entry in browser")
  (modified)
  ([2 diffs](#file12 "Show differences"))
* [tags/3.0.7/includes/admin/projects/open\_project/wppm\_change\_project\_visibility.php](/browser/taskbuilder/tags/3.0.7/includes/admin/projects/open_project/wppm_change_project_visibility.php?rev=3210469 "Show entry in browser")
  (modified)
  ([1 diff](#file13 "Show differences"))
* [tags/3.0.7/includes/admin/projects/open\_project/wppm\_edit\_project\_details.php](/browser/taskbuilder/tags/3.0.7/includes/admin/projects/open_project/wppm_edit_project_details.php?rev=3210469 "Show entry in browser")
  (modified)
  ([1 diff](#file14 "Show differences"))
* [tags/3.0.7/includes/admin/projects/open\_project/wppm\_get\_project\_tasks.php](/browser/taskbuilder/tags/3.0.7/includes/admin/projects/open_project/wppm_get_project_tasks.php?rev=3210469 "Show entry in browser")
  (modified)
  ([2 diffs](#file15 "Show differences"))
* [tags/3.0.7/includes/admin/projects/open\_project/wppm\_proj\_thread\_attachment\_remove.php](/browser/taskbuilder/tags/3.0.7/includes/admin/projects/open_project/wppm_proj_thread_attachment_remove.php?rev=3210469 "Show entry in browser")
  (modified)
  ([1 diff](#file16 "Show differences"))
* [tags/3.0.7/includes/admin/projects/open\_project/wppm\_set\_change\_project\_details.php](/browser/taskbuilder/tags/3.0.7/includes/admin/projects/open_project/wppm_set_change_project_details.php?rev=3210469 "Show entry in browser")
  (modified)
  ([1 diff](#file17 "Show differences"))
* [tags/3.0.7/includes/admin/projects/open\_project/wppm\_set\_change\_project\_raised\_by.php](/browser/taskbuilder/tags/3.0.7/includes/admin/projects/open_project/wppm_set_change_project_raised_by.php?rev=3210469 "Show entry in browser")
  (modified)
  ([1 diff](#file18 "Show differences"))
* [tags/3.0.7/includes/admin/projects/open\_project/wppm\_set\_delete\_proj\_thread.php](/browser/taskbuilder/tags/3.0.7/includes/admin/projects/open_project/wppm_set_delete_proj_thread.php?rev=3210469 "Show entry in browser")
  (modified)
  ([4 diffs](#file19 "Show differences"))
* [tags/3.0.7/includes/admin/projects/open\_project/wppm\_set\_project\_users.php](/browser/taskbuilder/tags/3.0.7/includes/admin/projects/open_project/wppm_set_project_users.php?rev=3210469 "Show entry in browser")
  (modified)
  ([8 diffs](#file20 "Show differences"))
* [tags/3.0.7/includes/admin/projects/open\_project/wppm\_submit\_project\_comment.php](/browser/taskbuilder/tags/3.0.7/includes/admin/projects/open_project/wppm_submit_project_comment.php?rev=3210469 "Show entry in browser")
  (modified)
  ([2 diffs](#file21 "Show differences"))
* [tags/3.0.7/includes/admin/projects/open\_project/wppm\_view\_project\_tasks.php](/browser/taskbuilder/tags/3.0.7/includes/admin/projects/open_project/wppm_view_project_tasks.php?rev=3210469 "Show entry in browser")
  (modified)
  ([6 diffs](#file22 "Show differences"))
* [tags/3.0.7/includes/admin/projects/projects\_list.php](/browser/taskbuilder/tags/3.0.7/includes/admin/projects/projects_list.php?rev=3210469 "Show entry in browser")
  (modified)
  ([6 diffs](#file23 "Show differences"))
* [tags/3.0.7/includes/admin/projects/wppm\_add\_new\_project.php](/browser/taskbuilder/tags/3.0.7/includes/admin/projects/wppm_add_new_project.php?rev=3210469 "Show entry in browser")
  (modified)
  ([1 diff](#file24 "Show differences"))
* [tags/3.0.7/includes/admin/projects/wppm\_filter\_autocomplete.php](/browser/taskbuilder/tags/3.0.7/includes/admin/projects/wppm_filter_autocomplete.php?rev=3210469 "Show entry in browser")
  (modified)
  ([1 diff](#file25 "Show differences"))
* [tags/3.0.7/includes/admin/projects/wppm\_get\_delete\_project.php](/browser/taskbuilder/tags/3.0.7/includes/admin/projects/wppm_get_delete_project.php?rev=3210469 "Show entry in browser")
  (modified)
  ([1 diff](#file26 "Show differences"))
* [tags/3.0.7/includes/admin/projects/wppm\_open\_project.php](/browser/taskbuilder/tags/3.0.7/includes/admin/projects/wppm_open_project.php?rev=3210469 "Show entry in browser")
  (modified)
  ([5 diffs](#file27 "Show differences"))
* [tags/3.0.7/includes/admin/projects/wppm\_set\_bulk\_change\_project\_category.php](/browser/taskbuilder/tags/3.0.7/includes/admin/projects/wppm_set_bulk_change_project_category.php?rev=3210469 "Show entry in browser")
  (modified)
  ([1 diff](#file28 "Show differences"))
* [tags/3.0.7/includes/admin/projects/wppm\_set\_bulk\_project\_users.php](/browser/taskbuilder/tags/3.0.7/includes/admin/projects/wppm_set_bulk_project_users.php?rev=3210469 "Show entry in browser")
  (modified)
  ([8 diffs](#file29 "Show differences"))
* [tags/3.0.7/includes/admin/projects/wppm\_set\_delete\_bulk\_projects.php](/browser/taskbuilder/tags/3.0.7/includes/admin/projects/wppm_set_delete_bulk_projects.php?rev=3210469 "Show entry in browser")
  (modified)
  ([5 diffs](#file30 "Show differences"))
* [tags/3.0.7/includes/admin/projects/wppm\_set\_delete\_project.php](/browser/taskbuilder/tags/3.0.7/includes/admin/projects/wppm_set_delete_project.php?rev=3210469 "Show entry in browser")
  (modified)
  ([8 diffs](#file31 "Show differences"))
* [tags/3.0.7/includes/admin/projects/wppm\_set\_project\_meta.php](/browser/taskbuilder/tags/3.0.7/includes/admin/projects/wppm_set_project_meta.php?rev=3210469 "Show entry in browser")
  (modified)
  ([2 diffs](#file32 "Show differences"))
* [tags/3.0.7/includes/admin/settings/wppm\_delete\_category.php](/browser/taskbuilder/tags/3.0.7/includes/admin/settings/wppm_delete_category.php?rev=3210469 "Show entry in browser")
  (modified)
  ([1 diff](#file33 "Show differences"))
* [tags/3.0.7/includes/admin/settings/wppm\_delete\_status.php](/browser/taskbuilder/tags/3.0.7/includes/admin/settings/wppm_delete_status.php?rev=3210469 "Show entry in browser")
  (modified)
  ([1 diff](#file34 "Show differences"))
* [tags/3.0.7/includes/admin/settings/wppm\_delete\_task\_priority.php](/browser/taskbuilder/tags/3.0.7/includes/admin/settings/wppm_delete_task_priority.php?rev=3210469 "Show entry in browser")
  (modified)
  ([1 diff](#file35 "Show differences"))
* [tags/3.0.7/includes/admin/settings/wppm\_delete\_task\_status.php](/browser/taskbuilder/tags/3.0.7/includes/admin/settings/wppm_delete_task_status.php?rev=3210469 "Show entry in browser")
  (modified)
  ([1 diff](#file36 "Show differences"))
* [tags/3.0.7/includes/admin/settings/wppm\_get\_category\_settings.php](/browser/taskbuilder/tags/3.0.7/includes/admin/settings/wppm_get_category_settings.php?rev=3210469 "Show entry in browser")
  (modified)
  ([1 diff](#file37 "Show differences"))
* [tags/3.0.7/includes/admin/settings/wppm\_get\_edit\_category.php](/browser/taskbuilder/tags/3.0.7/includes/admin/settings/wppm_get_edit_category.php?rev=3210469 "Show entry in browser")
  (modified)
  ([1 diff](#file38 "Show differences"))
* [tags/3.0.7/includes/admin/settings/wppm\_get\_edit\_priority.php](/browser/taskbuilder/tags/3.0.7/includes/admin/settings/wppm_get_edit_priority.php?rev=3210469 "Show entry in browser")
  (modified)
  ([1 diff](#file39 "Show differences"))
* [tags/3.0.7/includes/admin/settings/wppm\_get\_edit\_proj\_status.php](/browser/taskbuilder/tags/3.0.7/includes/admin/settings/wppm_get_edit_proj_status.php?rev=3210469 "Show entry in browser")
  (modified)
  ([1 diff](#file40 "Show differences"))
* [tags/3.0.7/includes/admin/settings/wppm\_get\_edit\_task\_status.php](/browser/taskbuilder/tags/3.0.7/includes/admin/settings/wppm_get_edit_task_status.php?rev=3210469 "Show entry in browser")
  (modified)
  ([1 diff](#file41 "Show differences"))
* [tags/3.0.7/includes/admin/settings/wppm\_get\_priority\_settings.php](/browser/taskbuilder/tags/3.0.7/includes/admin/settings/wppm_get_priority_settings.php?rev=3210469 "Show entry in browser")
  (modified)
  ([1 diff](#file42 "Show differences"))
* [tags/3.0.7/includes/admin/settings/wppm\_get\_proj\_status\_settings.php](/browser/taskbuilder/tags/3.0.7/includes/admin/settings/wppm_get_proj_status_settings.php?rev=3210469 "Show entry in browser")
  (modified)
  ([1 diff](#file43 "Show differences"))
* [tags/3.0.7/includes/admin/settings/wppm\_get\_task\_status\_settings.php](/browser/taskbuilder/tags/3.0.7/includes/admin/settings/wppm_get_task_status_settings.php?rev=3210469 "Show entry in browser")
  (modified)
  ([1 diff](#file44 "Show differences"))
* [tags/3.0.7/includes/admin/settings/wppm\_set\_add\_category.php](/browser/taskbuilder/tags/3.0.7/includes/admin/settings/wppm_set_add_category.php?rev=3210469 "Show entry in browser")
  (modified)
  ([1 diff](#file45 "Show differences"))
* [tags/3.0.7/includes/admin/settings/wppm\_set\_category\_order.php](/browser/taskbuilder/tags/3.0.7/includes/admin/settings/wppm_set_category_order.php?rev=3210469 "Show entry in browser")
  (modified)
  ([1 diff](#file46 "Show differences"))
* [tags/3.0.7/includes/admin/settings/wppm\_set\_edit\_category.php](/browser/taskbuilder/tags/3.0.7/includes/admin/settings/wppm_set_edit_category.php?rev=3210469 "Show entry in browser")
  (modified)
  ([2 diffs](#file47 "Show differences"))
* [tags/3.0.7/includes/admin/settings/wppm\_set\_edit\_priority.php](/browser/taskbuilder/tags/3.0.7/includes/admin/settings/wppm_set_edit_priority.php?rev=3210469 "Show entry in browser")
  (modified)
  ([1 diff](#file48 "Show differences"))
* [tags/3.0.7/includes/admin/settings/wppm\_set\_edit\_status.php](/browser/taskbuilder/tags/3.0.7/includes/admin/settings/wppm_set_edit_status.php?rev=3210469 "Show entry in browser")
  (modified)
  ([1 diff](#file49 "Show differences"))
* [tags/3.0.7/includes/admin/settings/wppm\_set\_edit\_task\_status.php](/browser/taskbuilder/tags/3.0.7/includes/admin/settings/wppm_set_edit_task_status.php?rev=3210469 "Show entry in browser")
  (modified)
  ([1 diff](#file50 "Show differences"))
* [tags/3.0.7/includes/admin/settings/wppm\_set\_priority\_order.php](/browser/taskbuilder/tags/3.0.7/includes/admin/settings/wppm_set_priority_order.php?rev=3210469 "Show entry in browser")
  (modified)
  ([1 diff](#file51 "Show differences"))
* [tags/3.0.7/includes/admin/settings/wppm\_set\_status\_order.php](/browser/taskbuilder/tags/3.0.7/includes/admin/settings/wppm_set_status_order.php?rev=3210469 "Show entry in browser")
  (modified)
  ([1 diff](#file52 "Show differences"))
* [tags/3.0.7/includes/admin/settings/wppm\_set\_task\_status\_order.php](/browser/taskbuilder/tags/3.0.7/includes/admin/settings/wppm_set_task_status_order.php?rev=3210469 "Show entry in browser")
  (modified)
  ([1 diff](#file53 "Show differences"))
* [tags/3.0.7/includes/admin/tasks/open\_task/checklist/wppm\_delete\_checklist.php](/browser/taskbuilder/tags/3.0.7/includes/admin/tasks/open_task/checklist/wppm_delete_checklist.php?rev=3210469 "Show entry in browser")
  (modified)
  ([1 diff](#file54 "Show differences"))
* [tags/3.0.7/includes/admin/tasks/open\_task/checklist/wppm\_remove\_checklist\_item.php](/browser/taskbuilder/tags/3.0.7/includes/admin/tasks/open_task/checklist/wppm_remove_checklist_item.php?rev=3210469 "Show entry in browser")
  (modified)
  ([1 diff](#file55 "Show differences"))
* [tags/3.0.7/includes/admin/tasks/open\_task/checklist/wppm\_set\_checklist\_progress.php](/browser/taskbuilder/tags/3.0.7/includes/admin/tasks/open_task/checklist/wppm_set_checklist_progress.php?rev=3210469 "Show entry in browser")
  (modified)
  ([2 diffs](#file56 "Show differences"))
* [tags/3.0.7/includes/admin/tasks/open\_task/wppm\_edit\_task\_details.php](/browser/taskbuilder/tags/3.0.7/includes/admin/tasks/open_task/wppm_edit_task_details.php?rev=3210469 "Show entry in browser")
  (modified)
  ([1 diff](#file57 "Show differences"))
* [tags/3.0.7/includes/admin/tasks/open\_task/wppm\_open\_task.php](/browser/taskbuilder/tags/3.0.7/includes/admin/tasks/open_task/wppm_open_task.php?rev=3210469 "Show entry in browser")
  (modified)
  ([6 diffs](#file58 "Show differences"))
* [tags/3.0.7/includes/admin/tasks/open\_task/wppm\_set\_change\_raised\_by.php](/browser/taskbuilder/tags/3.0.7/includes/admin/tasks/open_task/wppm_set_change_raised_by.php?rev=3210469 "Show entry in browser")
  (modified)
  ([2 diffs](#file59 "Show differences"))
* [tags/3.0.7/includes/admin/tasks/open\_task/wppm\_set\_change\_task\_details.php](/browser/taskbuilder/tags/3.0.7/includes/admin/tasks/open_task/wppm_set_change_task_details.php?rev=3210469 "Show entry in browser")
  (modified)
  ([2 diffs](#file60 "Show differences"))
* [tags/3.0.7/includes/admin/tasks/open\_task/wppm\_set\_change\_task\_status.php](/browser/taskbuilder/tags/3.0.7/includes/admin/tasks/open_task/wppm_set_change_task_status.php?rev=3210469 "Show entry in browser")
  (modified)
  ([2 diffs](#file61 "Show differences"))
* [tags/3.0.7/includes/admin/tasks/open\_task/wppm\_set\_clone\_task.php](/browser/taskbuilder/tags/3.0.7/includes/admin/tasks/open_task/wppm_set_clone_task.php?rev=3210469 "Show entry in browser")
  (modified)
  ([2 diffs](#file62 "Show differences"))
* [tags/3.0.7/includes/admin/tasks/open\_task/wppm\_set\_delete\_thread.php](/browser/taskbuilder/tags/3.0.7/includes/admin/tasks/open_task/wppm_set_delete_thread.php?rev=3210469 "Show entry in browser")
  (modified)
  ([3 diffs](#file63 "Show differences"))
* [tags/3.0.7/includes/admin/tasks/open\_task/wppm\_set\_task\_users.php](/browser/taskbuilder/tags/3.0.7/includes/admin/tasks/open_task/wppm_set_task_users.php?rev=3210469 "Show entry in browser")
  (modified)
  ([3 diffs](#file64 "Show differences"))
* [tags/3.0.7/includes/admin/tasks/open\_task/wppm\_submit\_task\_comment.php](/browser/taskbuilder/tags/3.0.7/includes/admin/tasks/open_task/wppm_submit_task_comment.php?rev=3210469 "Show entry in browser")
  (modified)
  ([1 diff](#file65 "Show differences"))
* [tags/3.0.7/includes/admin/tasks/open\_task/wppm\_thread\_attachment\_remove.php](/browser/taskbuilder/tags/3.0.7/includes/admin/tasks/open_task/wppm_thread_attachment_remove.php?rev=3210469 "Show entry in browser")
  (modified)
  ([3 diffs](#file66 "Show differences"))
* [tags/3.0.7/includes/admin/tasks/open\_task/wppm\_upload\_file.php](/browser/taskbuilder/tags/3.0.7/includes/admin/tasks/open_task/wppm_upload_file.php?rev=3210469 "Show entry in browser")
  (modified)
  ([1 diff](#file67 "Show differences"))
* [tags/3.0.7/includes/admin/tasks/wppm\_add\_new\_task.php](/browser/taskbuilder/tags/3.0.7/includes/admin/tasks/wppm_add_new_task.php?rev=3210469 "Show entry in browser")
  (modified)
  ([6 diffs](#file68 "Show differences"))
* [tags/3.0.7/includes/admin/tasks/wppm\_get\_task\_users.php](/browser/taskbuilder/tags/3.0.7/includes/admin/tasks/wppm_get_task_users.php?rev=3210469 "Show entry in browser")
  (modified)
  ([1 diff](#file69 "Show differences"))
* [tags/3.0.7/includes/admin/tasks/wppm\_set\_bulk\_change\_task\_priority.php](/browser/taskbuilder/tags/3.0.7/includes/admin/tasks/wppm_set_bulk_change_task_priority.php?rev=3210469 "Show entry in browser")
  (modified)
  ([1 diff](#file70 "Show differences"))
* [tags/3.0.7/includes/admin/tasks/wppm\_set\_bulk\_change\_task\_status.php](/browser/taskbuilder/tags/3.0.7/includes/admin/tasks/wppm_set_bulk_change_task_status.php?rev=3210469 "Show entry in browser")
  (modified)
  ([3 diffs](#file71 "Show differences"))
* [tags/3.0.7/includes/admin/tasks/wppm\_set\_delete\_bulk\_tasks.php](/browser/taskbuilder/tags/3.0.7/includes/admin/tasks/wppm_set_delete_bulk_tasks.php?rev=3210469 "Show entry in browser")
  (modified)
  ([4 diffs](#file72 "Show differences"))
* [tags/3.0.7/includes/admin/tasks/wppm\_set\_delete\_task.php](/browser/taskbuilder/tags/3.0.7/includes/admin/tasks/wppm_set_delete_task.php?rev=3210469 "Show entry in browser")
  (modified)
  ([6 diffs](#file73 "Show differences"))
* [tags/3.0.7/includes/admin/tasks/wppm\_tasks\_list.php](/browser/taskbuilder/tags/3.0.7/includes/admin/tasks/wppm_tasks_list.php?rev=3210469 "Show entry in browser")
  (modified)
  ([10 diffs](#file74 "Show differences"))
* [tags/3.0.7/includes/class-wppm-functions.php](/browser/taskbuilder/tags/3.0.7/includes/class-wppm-functions.php?rev=3210469 "Show entry in browser")
  (modified)
  ([29 diffs](#file75 "Show differences"))
* [tags/3.0.7/includes/frontend/wppm\_tasks\_shortcode.php](/browser/taskbuilder/tags/3.0.7/includes/frontend/wppm_tasks_shortcode.php?rev=3210469 "Show entry in browser")
  (modified)
  ([9 diffs](#file76 "Show differences"))
* [tags/3.0.7/includes/replace\_macro.php](/browser/taskbuilder/tags/3.0.7/includes/replace_macro.php?rev=3210469 "Show entry in browser")
  (modified)
  ([1 diff](#file77 "Show differences"))
* [tags/3.0.7/includes/replace\_task\_macro.php](/browser/taskbuilder/tags/3.0.7/includes/replace_task_macro.php?rev=3210469 "Show entry in browser")
  (modified)
  ([3 diffs](#file78 "Show differences"))
* [tags/3.0.7/readme.txt](/browser/taskbuilder/tags/3.0.7/readme.txt?rev=3210469 "Show entry in browser")
  (modified)
  ([3 diffs](#file79 "Show differences"))
* [tags/3.0.7/taskbuilder.php](/browser/taskbuilder/tags/3.0.7/taskbuilder.php?rev=3210469 "Show entry in browser")
  (modified)
  ([2 diffs](#file80 "Show differences"))
* [trunk/asset/images/due\_date\_reminder\_icon.svg](/browser/taskbuilder/trunk/asset/images/due_date_reminder_icon.svg?rev=3210469 "Show entry in browser")
  (added)
* [trunk/includes/actions/wppm\_check\_cron\_attachment.php](/browser/taskbuilder/trunk/includes/actions/wppm_check_cron_attachment.php?rev=3210469 "Show entry in browser")
  (modified)
  ([1 diff](#file82 "Show differences"))
* [trunk/includes/admin/addons.php](/browser/taskbuilder/trunk/includes/admin/addons.php?rev=3210469 "Show entry in browser")
  (modified)
  ([8 diffs](#file83 "Show differences"))
* [trunk/includes/admin/attachment/wppm\_download\_attachment.php](/browser/taskbuilder/trunk/includes/admin/attachment/wppm_download_attachment.php?rev=3210469 "Show entry in browser")
  (modified)
  ([1 diff](#file84 "Show differences"))
* [trunk/includes/admin/email\_notifications/wppm\_en\_change\_project\_status.php](/browser/taskbuilder/trunk/includes/admin/email_notifications/wppm_en_change_project_status.php?rev=3210469 "Show entry in browser")
  (modified)
  ([3 diffs](#file85 "Show differences"))
* [trunk/includes/admin/email\_notifications/wppm\_en\_project\_created.php](/browser/taskbuilder/trunk/includes/admin/email_notifications/wppm_en_project_created.php?rev=3210469 "Show entry in browser")
  (modified)
  ([3 diffs](#file86 "Show differences"))
* [trunk/includes/admin/email\_notifications/wppm\_en\_set\_change\_task\_status.php](/browser/taskbuilder/trunk/includes/admin/email_notifications/wppm_en_set_change_task_status.php?rev=3210469 "Show entry in browser")
  (modified)
  ([3 diffs](#file87 "Show differences"))
* [trunk/includes/admin/email\_notifications/wppm\_en\_set\_project\_users.php](/browser/taskbuilder/trunk/includes/admin/email_notifications/wppm_en_set_project_users.php?rev=3210469 "Show entry in browser")
  (modified)
  ([3 diffs](#file88 "Show differences"))
* [trunk/includes/admin/email\_notifications/wppm\_en\_submit\_proj\_comment.php](/browser/taskbuilder/trunk/includes/admin/email_notifications/wppm_en_submit_proj_comment.php?rev=3210469 "Show entry in browser")
  (modified)
  ([1 diff](#file89 "Show differences"))
* [trunk/includes/admin/email\_notifications/wppm\_get\_templates.php](/browser/taskbuilder/trunk/includes/admin/email_notifications/wppm_get_templates.php?rev=3210469 "Show entry in browser")
  (modified)
  ([1 diff](#file90 "Show differences"))
* [trunk/includes/admin/projects/filters/wppm\_project\_search\_filter.php](/browser/taskbuilder/trunk/includes/admin/projects/filters/wppm_project_search_filter.php?rev=3210469 "Show entry in browser")
  (modified)
  ([1 diff](#file91 "Show differences"))
* [trunk/includes/admin/projects/get\_users.php](/browser/taskbuilder/trunk/includes/admin/projects/get_users.php?rev=3210469 "Show entry in browser")
  (modified)
  ([2 diffs](#file92 "Show differences"))
* [trunk/includes/admin/projects/open\_project/wppm\_change\_project\_visibility.php](/browser/taskbuilder/trunk/includes/admin/projects/open_project/wppm_change_project_visibility.php?rev=3210469 "Show entry in browser")
  (modified)
  ([1 diff](#file93 "Show differences"))
* [trunk/includes/admin/projects/open\_project/wppm\_edit\_project\_details.php](/browser/taskbuilder/trunk/includes/admin/projects/open_project/wppm_edit_project_details.php?rev=3210469 "Show entry in browser")
  (modified)
  ([1 diff](#file94 "Show differences"))
* [trunk/includes/admin/projects/open\_project/wppm\_get\_project\_tasks.php](/browser/taskbuilder/trunk/includes/admin/projects/open_project/wppm_get_project_tasks.php?rev=3210469 "Show entry in browser")
  (modified)
  ([2 diffs](#file95 "Show differences"))
* [trunk/includes/admin/projects/open\_project/wppm\_proj\_thread\_attachment\_remove.php](/browser/taskbuilder/trunk/includes/admin/projects/open_project/wppm_proj_thread_attachment_remove.php?rev=3210469 "Show entry in browser")
  (modified)
  ([1 diff](#file96 "Show differences"))
* [trunk/includes/admin/projects/open\_project/wppm\_set\_change\_project\_details.php](/browser/taskbuilder/trunk/includes/admin/projects/open_project/wppm_set_change_project_details.php?rev=3210469 "Show entry in browser")
  (modified)
  ([1 diff](#file97 "Show differences"))
* [trunk/includes/admin/projects/open\_project/wppm\_set\_change\_project\_raised\_by.php](/browser/taskbuilder/trunk/includes/admin/projects/open_project/wppm_set_change_project_raised_by.php?rev=3210469 "Show entry in browser")
  (modified)
  ([1 diff](#file98 "Show differences"))
* [trunk/includes/admin/projects/open\_project/wppm\_set\_delete\_proj\_thread.php](/browser/taskbuilder/trunk/includes/admin/projects/open_project/wppm_set_delete_proj_thread.php?rev=3210469 "Show entry in browser")
  (modified)
  ([4 diffs](#file99 "Show differences"))
* [trunk/includes/admin/projects/open\_project/wppm\_set\_project\_users.php](/browser/taskbuilder/trunk/includes/admin/projects/open_project/wppm_set_project_users.php?rev=3210469 "Show entry in browser")
  (modified)
  ([8 diffs](#file100 "Show differences"))
* [trunk/includes/admin/projects/open\_project/wppm\_submit\_project\_comment.php](/browser/taskbuilder/trunk/includes/admin/projects/open_project/wppm_submit_project_comment.php?rev=3210469 "Show entry in browser")
  (modified)
  ([2 diffs](#file101 "Show differences"))
* [trunk/includes/admin/projects/open\_project/wppm\_view\_project\_tasks.php](/browser/taskbuilder/trunk/includes/admin/projects/open_project/wppm_view_project_tasks.php?rev=3210469 "Show entry in browser")
  (modified)
  ([6 diffs](#file102 "Show differences"))
* [trunk/includes/admin/projects/projects\_list.php](/browser/taskbuilder/trunk/includes/admin/projects/projects_list.php?rev=3210469 "Show entry in browser")
  (modified)
  ([6 diffs](#file103 "Show differences"))
* [trunk/includes/admin/projects/wppm\_add\_new\_project.php](/browser/taskbuilder/trunk/includes/admin/projects/wppm_add_new_project.php?rev=3210469 "Show entry in browser")
  (modified)
  ([1 diff](#file104 "Show differences"))
* [trunk/includes/admin/projects/wppm\_filter\_autocomplete.php](/browser/taskbuilder/trunk/includes/admin/projects/wppm_filter_autocomplete.php?rev=3210469 "Show entry in browser")
  (modified)
  ([1 diff](#file105 "Show differences"))
* [trunk/includes/admin/projects/wppm\_get\_delete\_project.php](/browser/taskbuilder/trunk/includes/admin/projects/wppm_get_delete_project.php?rev=3210469 "Show entry in browser")
  (modified)
  ([1 diff](#file106 "Show differences"))
* [trunk/includes/admin/projects/wppm\_open\_project.php](/browser/taskbuilder/trunk/includes/admin/projects/wppm_open_project.php?rev=3210469 "Show entry in browser")
  (modified)
  ([5 diffs](#file107 "Show differences"))
* [trunk/includes/admin/projects/wppm\_set\_bulk\_change\_project\_category.php](/browser/taskbuilder/trunk/includes/admin/projects/wppm_set_bulk_change_project_category.php?rev=3210469 "Show entry in browser")
  (modified)
  ([1 diff](#file108 "Show differences"))
* [trunk/includes/admin/projects/wppm\_set\_bulk\_project\_users.php](/browser/taskbuilder/trunk/includes/admin/projects/wppm_set_bulk_project_users.php?rev=3210469 "Show entry in browser")
  (modified)
  ([8 diffs](#file109 "Show differences"))
* [trunk/includes/admin/projects/wppm\_set\_delete\_bulk\_projects.php](/browser/taskbuilder/trunk/includes/admin/projects/wppm_set_delete_bulk_projects.php?rev=3210469 "Show entry in browser")
  (modified)
  ([5 diffs](#file110 "Show differences"))
* [trunk/includes/admin/projects/wppm\_set\_delete\_project.php](/browser/taskbuilder/trunk/includes/admin/projects/wppm_set_delete_project.php?rev=3210469 "Show entry in browser")
  (modified)
  ([8 diffs](#file111 "Show differences"))
* [trunk/includes/admin/projects/wppm\_set\_project\_meta.php](/browser/taskbuilder/trunk/includes/admin/projects/wppm_set_project_meta.php?rev=3210469 "Show entry in browser")
  (modified)
  ([2 diffs](#file112 "Show differences"))
* [trunk/includes/admin/settings/wppm\_delete\_category.php](/browser/taskbuilder/trunk/includes/admin/settings/wppm_delete_category.php?rev=3210469 "Show entry in browser")
  (modified)
  ([1 diff](#file113 "Show differences"))
* [trunk/includes/admin/settings/wppm\_delete\_status.php](/browser/taskbuilder/trunk/includes/admin/settings/wppm_delete_status.php?rev=3210469 "Show entry in browser")
  (modified)
  ([1 diff](#file114 "Show differences"))
* [trunk/includes/admin/settings/wppm\_delete\_task\_priority.php](/browser/taskbuilder/trunk/includes/admin/settings/wppm_delete_task_priority.php?rev=3210469 "Show entry in browser")
  (modified)
  ([1 diff](#file115 "Show differences"))
* [trunk/includes/admin/settings/wppm\_delete\_task\_status.php](/browser/taskbuilder/trunk/includes/admin/settings/wppm_delete_task_status.php?rev=3210469 "Show entry in browser")
  (modified)
  ([1 diff](#file116 "Show differences"))
* [trunk/includes/admin/settings/wppm\_get\_category\_settings.php](/browser/taskbuilder/trunk/includes/admin/settings/wppm_get_category_settings.php?rev=3210469 "Show entry in browser")
  (modified)
  ([1 diff](#file117 "Show differences"))
* [trunk/includes/admin/settings/wppm\_get\_edit\_category.php](/browser/taskbuilder/trunk/includes/admin/settings/wppm_get_edit_category.php?rev=3210469 "Show entry in browser")
  (modified)
  ([1 diff](#file118 "Show differences"))
* [trunk/includes/admin/settings/wppm\_get\_edit\_priority.php](/browser/taskbuilder/trunk/includes/admin/settings/wppm_get_edit_priority.php?rev=3210469 "Show entry in browser")
  (modified)
  ([1 diff](#file119 "Show differences"))
* [trunk/includes/admin/settings/wppm\_get\_edit\_proj\_status.php](/browser/taskbuilder/trunk/includes/admin/settings/wppm_get_edit_proj_status.php?rev=3210469 "Show entry in browser")
  (modified)
  ([1 diff](#file120 "Show differences"))
* [trunk/includes/admin/settings/wppm\_get\_edit\_task\_status.php](/browser/taskbuilder/trunk/includes/admin/settings/wppm_get_edit_task_status.php?rev=3210469 "Show entry in browser")
  (modified)
  ([1 diff](#file121 "Show differences"))
* [trunk/includes/admin/settings/wppm\_get\_priority\_settings.php](/browser/taskbuilder/trunk/includes/admin/settings/wppm_get_priority_settings.php?rev=3210469 "Show entry in browser")
  (modified)
  ([1 diff](#file122 "Show differences"))
* [trunk/includes/admin/settings/wppm\_get\_proj\_status\_settings.php](/browser/taskbuilder/trunk/includes/admin/settings/wppm_get_proj_status_settings.php?rev=3210469 "Show entry in browser")
  (modified)
  ([1 diff](#file123 "Show differences"))
* [trunk/includes/admin/settings/wppm\_get\_task\_status\_settings.php](/browser/taskbuilder/trunk/includes/admin/settings/wppm_get_task_status_settings.php?rev=3210469 "Show entry in browser")
  (modified)
  ([1 diff](#file124 "Show differences"))
* [trunk/includes/admin/settings/wppm\_set\_add\_category.php](/browser/taskbuilder/trunk/includes/admin/settings/wppm_set_add_category.php?rev=3210469 "Show entry in browser")
  (modified)
  ([1 diff](#file125 "Show differences"))
* [trunk/includes/admin/settings/wppm\_set\_category\_order.php](/browser/taskbuilder/trunk/includes/admin/settings/wppm_set_category_order.php?rev=3210469 "Show entry in browser")
  (modified)
  ([1 diff](#file126 "Show differences"))
* [trunk/includes/admin/settings/wppm\_set\_edit\_category.php](/browser/taskbuilder/trunk/includes/admin/settings/wppm_set_edit_category.php?rev=3210469 "Show entry in browser")
  (modified)
  ([2 diffs](#file127 "Show differences"))
* [trunk/includes/admin/settings/wppm\_set\_edit\_priority.php](/browser/taskbuilder/trunk/includes/admin/settings/wppm_set_edit_priority.php?rev=3210469 "Show entry in browser")
  (modified)
  ([1 diff](#file128 "Show differences"))
* [trunk/includes/admin/settings/wppm\_set\_edit\_status.php](/browser/taskbuilder/trunk/includes/admin/settings/wppm_set_edit_status.php?rev=3210469 "Show entry in browser")
  (modified)
  ([1 diff](#file129 "Show differences"))
* [trunk/includes/admin/settings/wppm\_set\_edit\_task\_status.php](/browser/taskbuilder/trunk/includes/admin/settings/wppm_set_edit_task_status.php?rev=3210469 "Show entry in browser")
  (modified)
  ([1 diff](#file130 "Show differences"))
* [trunk/includes/admin/settings/wppm\_set\_priority\_order.php](/browser/taskbuilder/trunk/includes/admin/settings/wppm_set_priority_order.php?rev=3210469 "Show entry in browser")
  (modified)
  ([1 diff](#file131 "Show differences"))
* [trunk/includes/admin/settings/wppm\_set\_status\_order.php](/browser/taskbuilder/trunk/includes/admin/settings/wppm_set_status_order.php?rev=3210469 "Show entry in browser")
  (modified)
  ([1 diff](#file132 "Show differences"))
* [trunk/includes/admin/settings/wppm\_set\_task\_status\_order.php](/browser/taskbuilder/trunk/includes/admin/settings/wppm_set_task_status_order.php?rev=3210469 "Show entry in browser")
  (modified)
  ([1 diff](#file133 "Show differences"))
* [trunk/includes/admin/tasks/open\_task/checklist/wppm\_delete\_checklist.php](/browser/taskbuilder/trunk/includes/admin/tasks/open_task/checklist/wppm_delete_checklist.php?rev=3210469 "Show entry in browser")
  (modified)
  ([1 diff](#file134 "Show differences"))
* [trunk/includes/admin/tasks/open\_task/checklist/wppm\_remove\_checklist\_item.php](/browser/taskbuilder/trunk/includes/admin/tasks/open_task/checklist/wppm_remove_checklist_item.php?rev=3210469 "Show entry in browser")
  (modified)
  ([1 diff](#file135 "Show differences"))
* [trunk/includes/admin/tasks/open\_task/checklist/wppm\_set\_checklist\_progress.php](/browser/taskbuilder/trunk/includes/admin/tasks/open_task/checklist/wppm_set_checklist_progress.php?rev=3210469 "Show entry in browser")
  (modified)
  ([2 diffs](#file136 "Show differences"))
* [trunk/includes/admin/tasks/open\_task/wppm\_edit\_task\_details.php](/browser/taskbuilder/trunk/includes/admin/tasks/open_task/wppm_edit_task_details.php?rev=3210469 "Show entry in browser")
  (modified)
  ([1 diff](#file137 "Show differences"))
* [trunk/includes/admin/tasks/open\_task/wppm\_open\_task.php](/browser/taskbuilder/trunk/includes/admin/tasks/open_task/wppm_open_task.php?rev=3210469 "Show entry in browser")
  (modified)
  ([6 diffs](#file138 "Show differences"))
* [trunk/includes/admin/tasks/open\_task/wppm\_set\_change\_raised\_by.php](/browser/taskbuilder/trunk/includes/admin/tasks/open_task/wppm_set_change_raised_by.php?rev=3210469 "Show entry in browser")
  (modified)
  ([2 diffs](#file139 "Show differences"))
* [trunk/includes/admin/tasks/open\_task/wppm\_set\_change\_task\_details.php](/browser/taskbuilder/trunk/includes/admin/tasks/open_task/wppm_set_change_task_details.php?rev=3210469 "Show entry in browser")
  (modified)
  ([2 diffs](#file140 "Show differences"))
* [trunk/includes/admin/tasks/open\_task/wppm\_set\_change\_task\_status.php](/browser/taskbuilder/trunk/includes/admin/tasks/open_task/wppm_set_change_task_status.php?rev=3210469 "Show entry in browser")
  (modified)
  ([2 diffs](#file141 "Show differences"))
* [trunk/includes/admin/tasks/open\_task/wppm\_set\_clone\_task.php](/browser/taskbuilder/trunk/includes/admin/tasks/open_task/wppm_set_clone_task.php?rev=3210469 "Show entry in browser")
  (modified)
  ([2 diffs](#file142 "Show differences"))
* [trunk/includes/admin/tasks/open\_task/wppm\_set\_delete\_thread.php](/browser/taskbuilder/trunk/includes/admin/tasks/open_task/wppm_set_delete_thread.php?rev=3210469 "Show entry in browser")
  (modified)
  ([3 diffs](#file143 "Show differences"))
* [trunk/includes/admin/tasks/open\_task/wppm\_set\_task\_users.php](/browser/taskbuilder/trunk/includes/admin/tasks/open_task/wppm_set_task_users.php?rev=3210469 "Show entry in browser")
  (modified)
  ([3 diffs](#file144 "Show differences"))
* [trunk/includes/admin/tasks/open\_task/wppm\_submit\_task\_comment.php](/browser/taskbuilder/trunk/includes/admin/tasks/open_task/wppm_submit_task_comment.php?rev=3210469 "Show entry in browser")
  (modified)
  ([1 diff](#file145 "Show differences"))
* [trunk/includes/admin/tasks/open\_task/wppm\_thread\_attachment\_remove.php](/browser/taskbuilder/trunk/includes/admin/tasks/open_task/wppm_thread_attachment_remove.php?rev=3210469 "Show entry in browser")
  (modified)
  ([3 diffs](#file146 "Show differences"))
* [trunk/includes/admin/tasks/open\_task/wppm\_upload\_file.php](/browser/taskbuilder/trunk/includes/admin/tasks/open_task/wppm_upload_file.php?rev=3210469 "Show entry in browser")
  (modified)
  ([1 diff](#file147 "Show differences"))
* [trunk/includes/admin/tasks/wppm\_add\_new\_task.php](/browser/taskbuilder/trunk/includes/admin/tasks/wppm_add_new_task.php?rev=3210469 "Show entry in browser")
  (modified)
  ([6 diffs](#file148 "Show differences"))
* [trunk/includes/admin/tasks/wppm\_get\_task\_users.php](/browser/taskbuilder/trunk/includes/admin/tasks/wppm_get_task_users.php?rev=3210469 "Show entry in browser")
  (modified)
  ([1 diff](#file149 "Show differences"))
* [trunk/includes/admin/tasks/wppm\_set\_bulk\_change\_task\_priority.php](/browser/taskbuilder/trunk/includes/admin/tasks/wppm_set_bulk_change_task_priority.php?rev=3210469 "Show entry in browser")
  (modified)
  ([1 diff](#file150 "Show differences"))
* [trunk/includes/admin/tasks/wppm\_set\_bulk\_change\_task\_status.php](/browser/taskbuilder/trunk/includes/admin/tasks/wppm_set_bulk_change_task_status.php?rev=3210469 "Show entry in browser")
  (modified)
  ([3 diffs](#file151 "Show differences"))
* [trunk/includes/admin/tasks/wppm\_set\_delete\_bulk\_tasks.php](/browser/taskbuilder/trunk/includes/admin/tasks/wppm_set_delete_bulk_tasks.php?rev=3210469 "Show entry in browser")
  (modified)
  ([4 diffs](#file152 "Show differences"))
* [trunk/includes/admin/tasks/wppm\_set\_delete\_task.php](/browser/taskbuilder/trunk/includes/admin/tasks/wppm_set_delete_task.php?rev=3210469 "Show entry in browser")
  (modified)
  ([6 diffs](#file153 "Show differences"))
* [trunk/includes/admin/tasks/wppm\_tasks\_list.php](/browser/taskbuilder/trunk/includes/admin/tasks/wppm_tasks_list.php?rev=3210469 "Show entry in browser")
  (modified)
  ([10 diffs](#file154 "Show differences"))
* [trunk/includes/class-wppm-functions.php](/browser/taskbuilder/trunk/includes/class-wppm-functions.php?rev=3210469 "Show entry in browser")
  (modified)
  ([29 diffs](#file155 "Show differences"))
* [trunk/includes/frontend/wppm\_tasks\_shortcode.php](/browser/taskbuilder/trunk/includes/frontend/wppm_tasks_shortcode.php?rev=3210469 "Show entry in browser")
  (modified)
  ([9 diffs](#file156 "Show differences"))
* [trunk/includes/replace\_macro.php](/browser/taskbuilder/trunk/includes/replace_macro.php?rev=3210469 "Show entry in browser")
  (modified)
  ([1 diff](#file157 "Show differences"))
* [trunk/includes/replace\_task\_macro.php](/browser/taskbuilder/trunk/includes/replace_task_macro.php?rev=3210469 "Show entry in browser")
  (modified)
  ([3 diffs](#file158 "Show differences"))
* [trunk/readme.txt](/browser/taskbuilder/trunk/readme.txt?rev=3210469 "Show entry in browser")
  (modified)
  ([3 diffs](#file159 "Show differences"))
* [trunk/taskbuilder.php](/browser/taskbuilder/trunk/taskbuilder.php?rev=3210469 "Show entry in browser")
  (modified)
  ([2 diffs](#file160 "Show differences"))

### Legend:

Unmodified
Added
Removed

* ## [taskbuilder/tags/3.0.7/includes/actions/wppm\_check\_cron\_attachment.php](/changeset/3210469/taskbuilder/tags/3.0.7/includes/actions/wppm_check_cron_attachment.php "Show the changeset 3210469 restricted to taskbuilder/tags/3.0.7/includes/actions/wppm_check_cron_attachment.php")

  | [r3174963](/browser/taskbuilder/trunk/includes/actions/wppm_check_cron_attachment.php?rev=3174963#L29 "Show revision 3174963 of this file in browser") | [r3210469](/browser/taskbuilder/tags/3.0.7/includes/actions/wppm_check_cron_attachment.php?rev=3210469#L29 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 29 | 29 | $aid   = esc\_sql( $attachment->id ); |
  | 30 | 30 | if($diff > 86400){ |
  | 31 |  | $wpdb->delete($wpdb->prefix.'wppm\_attachments', array( 'id' => ~~$aid~~)); |
  |  | 31 | $wpdb->delete($wpdb->prefix.'wppm\_attachments', array( 'id' => "$aid")); |
  | 32 | 32 | if(file\_exists($filepath)){ |
  | 33 | 33 | unlink($filepath); |
* ## [taskbuilder/tags/3.0.7/includes/admin/addons.php](/changeset/3210469/taskbuilder/tags/3.0.7/includes/admin/addons.php "Show the changeset 3210469 restricted to taskbuilder/tags/3.0.7/includes/admin/addons.php")

  | [r3174963](/browser/taskbuilder/trunk/includes/admin/addons.php?rev=3174963#L40 "Show revision 3174963 of this file in browser") | [r3210469](/browser/taskbuilder/tags/3.0.7/includes/admin/addons.php?rev=3210469#L40 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 40 | 40 | <div class="pfooter"> |
  | 41 | 41 | <div class="purchase\_addon"> |
  | 42 |  | <a href="https://taskbuilder.net/~~add-ons~~/" target="\_\_blank" type="button" class="btn btn-success"><?php echo esc\_html\_e('Purchase','taskbuilder');?></a> |
  |  | 42 | <a href="https://taskbuilder.net/pricing/" target="\_\_blank" type="button" class="btn btn-success"><?php echo esc\_html\_e('Purchase','taskbuilder');?></a> |
  | 43 | 43 | </div> |
  | 44 | 44 | <div> |
  | […](/browser/taskbuilder/trunk/includes/admin/addons.php?rev=3174963#L68) | […](/browser/taskbuilder/tags/3.0.7/includes/admin/addons.php?rev=3210469#L68) |  |
  | 68 | 68 | <div class="pfooter"> |
  | 69 | 69 | <div class="purchase\_addon"> |
  | 70 |  | <a href="https://taskbuilder.net/~~add-ons~~/" target="\_\_blank" type="button" class="btn btn-success"><?php echo esc\_html\_e('Purchase','taskbuilder');?></a> |
  |  | 70 | <a href="https://taskbuilder.net/pricing/" target="\_\_blank" type="button" class="btn btn-success"><?php echo esc\_html\_e('Purchase','taskbuilder');?></a> |
  | 71 | 71 | </div> |
  | 72 | 72 | <div> |
  | […](/browser/taskbuilder/trunk/includes/admin/addons.php?rev=3174963#L96) | […](/browser/taskbuilder/tags/3.0.7/includes/admin/addons.php?rev=3210469#L96) |  |
  | 96 | 96 | <div class="pfooter"> |
  | 97 | 97 | <div class="purchase\_addon"> |
  | 98 |  | <a href="https://taskbuilder.net/~~add-ons~~/" target="\_\_blank" type="button" class="btn btn-success"><?php echo esc\_html\_e('Purchase','taskbuilder');?></a> |
  |  | 98 | <a href="https://taskbuilder.net/pricing/" target="\_\_blank" type="button" class="btn btn-success"><?php echo esc\_html\_e('Purchase','taskbuilder');?></a> |
  | 99 | 99 | </div> |
  | 100 | 100 | <div> |
  | […](/browser/taskbuilder/trunk/includes/admin/addons.php?rev=3174963#L124) | […](/browser/taskbuilder/tags/3.0.7/includes/admin/addons.php?rev=3210469#L124) |  |
  | 124 | 124 | <div class="pfooter"> |
  | 125 | 125 | <div class="purchase\_addon"> |
  | 126 |  | <a href="https://taskbuilder.net/~~add-ons~~/" target="\_\_blank" type="button" class="btn btn-success"><?php echo esc\_html\_e('Purchase','taskbuilder');?></a> |
  |  | 126 | <a href="https://taskbuilder.net/pricing/" target="\_\_blank" type="button" class="btn btn-success"><?php echo esc\_html\_e('Purchase','taskbuilder');?></a> |
  | 127 | 127 | </div> |
  | 128 | 128 | <div> |
  | […](/browser/taskbuilder/trunk/includes/admin/addons.php?rev=3174963#L151) | […](/browser/taskbuilder/tags/3.0.7/includes/admin/addons.php?rev=3210469#L151) |  |
  | 151 | 151 | <div class="pfooter"> |
  | 152 | 152 | <div class="purchase\_addon"> |
  | 153 |  | <a href="https://taskbuilder.net/~~add-ons~~/" target="\_\_blank" type="button" class="btn btn-success"><?php echo esc\_html\_e('Purchase','taskbuilder');?></a> |
  |  | 153 | <a href="https://taskbuilder.net/pricing/" target="\_\_blank" type="button" class="btn btn-success"><?php echo esc\_html\_e('Purchase','taskbuilder');?></a> |
  | 154 | 154 | </div> |
  | 155 | 155 | <div> |
  | […](/browser/taskbuilder/trunk/includes/admin/addons.php?rev=3174963#L178) | […](/browser/taskbuilder/tags/3.0.7/includes/admin/addons.php?rev=3210469#L178) |  |
  | 178 | 178 | <div class="pfooter"> |
  | 179 | 179 | <div class="purchase\_addon"> |
  | 180 |  | <a href="https://taskbuilder.net/~~add-ons~~/" target="\_\_blank" type="button" class="btn btn-success"><?php echo esc\_html\_e('Purchase','taskbuilder');?></a> |
  |  | 180 | <a href="https://taskbuilder.net/pricing/" target="\_\_blank" type="button" class="btn btn-success"><?php echo esc\_html\_e('Purchase','taskbuilder');?></a> |
  | 181 | 181 | </div> |
  | 182 | 182 | <div> |
  | […](/browser/taskbuilder/trunk/includes/admin/addons.php?rev=3174963#L205) | […](/browser/taskbuilder/tags/3.0.7/includes/admin/addons.php?rev=3210469#L205) |  |
  | 205 | 205 | <div class="pfooter"> |
  | 206 | 206 | <div class="purchase\_addon"> |
  | 207 |  | <a href="https://taskbuilder.net/~~add-ons~~/" target="\_\_blank" type="button" class="btn btn-success"><?php echo esc\_html\_e('Purchase','taskbuilder');?></a> |
  |  | 207 | <a href="https://taskbuilder.net/pricing/" target="\_\_blank" type="button" class="btn btn-success"><?php echo esc\_html\_e('Purchase','taskbuilder');?></a> |
  | 208 | 208 | </div> |
  | 209 | 209 | <div> |
  | […](/browser/taskbuilder/trunk/includes/admin/addons.php?rev=3174963#L232) | […](/browser/taskbuilder/tags/3.0.7/includes/admin/addons.php?rev=3210469#L232) |  |
  | 232 | 232 | <div class="pfooter"> |
  | 233 | 233 | <div class="purchase\_addon"> |
  | 234 |  | <a href="https://taskbuilder.net/~~add-ons~~/" target="\_\_blank" type="button" class="btn btn-success"><?php echo esc\_html\_e('Purchase','taskbuilder');?></a> |
  |  | 234 | <a href="https://taskbuilder.net/pricing/" target="\_\_blank" type="button" class="btn btn-success"><?php echo esc\_html\_e('Purchase','taskbuilder');?></a> |
  | 235 | 235 | </div> |
  | 236 | 236 | <div> |
  | 237 | 237 | <a href="https://taskbuilder.net/woocommerce/" target="\_\_blank" type="button" class="btn btn-success"><?php echo esc\_html\_e('View Details','taskbuilder');?></a> |
  |  | 238 | </div> |
  |  | 239 | </div> |
  |  | 240 | </div> |
  |  | 241 | </div> |
  |  | 242 | <div class="col-md-3 col-sm-6 col-xs-12 pricing-widget"> |
  |  | 243 | <div class="row"> |
  |  | 244 | <div class="pheader"> |
  |  | 245 | <h3 class="title"><img src="<?php echo esc\_url( WPPM\_PLUGIN\_URL . 'asset/images/due\_date\_reminder\_icon.svg'); ?>"> <?php echo esc\_html\_e('Due Date Reminder','taskbuilder');?></h3> |
  |  | 246 | <h4 class="subtitle">$29.99</h4> |
  |  | 247 | <div style="text-align:center"> |
  |  | 248 | <small class="payment\_freq"><?php echo esc\_html\_e('Per year','taskbuilder');?></small> |
  |  | 249 | <small class="payment\_freq"><?php echo esc\_html\_e('(Add-ons subject to yearly license for support and updates.)','taskbuilder');?></small> |
  |  | 250 | </div> |
  |  | 251 | </div> |
  |  | 252 | <div class="pbody"> |
  |  | 253 | <div class="addon-container"> |
  |  | 254 | <i class="fas fa-arrow-right"></i> |
  |  | 255 | <div class="addon-details"> |
  |  | 256 | <?php echo esc\_html\_e('Due date reminder are super helpful for keeping your team on track to hit deadlines. Email notification will send to customer before due date of task.','taskbuilder');?></div> |
  |  | 257 | </div> |
  |  | 258 | </div> |
  |  | 259 | <div class="pfooter"> |
  |  | 260 | <div class="purchase\_addon"> |
  |  | 261 | <a href="https://taskbuilder.net/pricing/" target="\_\_blank" type="button" class="btn btn-success"><?php echo esc\_html\_e('Purchase','taskbuilder');?></a> |
  |  | 262 | </div> |
  |  | 263 | <div> |
  |  | 264 | <a href="https://taskbuilder.net/due-date-reminder/" target="\_\_blank" type="button" class="btn btn-success"><?php echo esc\_html\_e('View Details','taskbuilder');?></a> |
  | 238 | 265 | </div> |
  | 239 | 266 | </div> |
* ## [taskbuilder/tags/3.0.7/includes/admin/attachment/wppm\_download\_attachment.php](/changeset/3210469/taskbuilder/tags/3.0.7/includes/admin/attachment/wppm_download_attachment.php "Show the changeset 3210469 restricted to taskbuilder/tags/3.0.7/includes/admin/attachment/wppm_download_attachment.php")

  | [r2692017](/browser/taskbuilder/trunk/includes/admin/attachment/wppm_download_attachment.php?rev=2692017#L5 "Show revision 2692017 of this file in browser") | [r3210469](/browser/taskbuilder/tags/3.0.7/includes/admin/attachment/wppm_download_attachment.php?rev=3210469#L5 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 5 | 5 | global $wpdb; |
  | 6 | 6 | $upload\_dir   = wp\_upload\_dir(); |
  | 7 |  | $attach\_id = ~~intval(sanitize\_text\_field($attach\_id~~)); |
  |  | 7 | $attach\_id = esc\_sql(intval(sanitize\_text\_field($attach\_id))); |
  | 8 | 8 | $attachment=$wpdb->get\_row("select \* from {$wpdb->prefix}wppm\_attachments where id='".$attach\_id."'"); |
  | 9 | 9 | $date\_created = $attachment->date\_created; |
* ## [taskbuilder/tags/3.0.7/includes/admin/email\_notifications/wppm\_en\_change\_project\_status.php](/changeset/3210469/taskbuilder/tags/3.0.7/includes/admin/email_notifications/wppm_en_change_project_status.php "Show the changeset 3210469 restricted to taskbuilder/tags/3.0.7/includes/admin/email_notifications/wppm_en_change_project_status.php")

  | [r3174963](/browser/taskbuilder/trunk/includes/admin/email_notifications/wppm_en_change_project_status.php?rev=3174963#L10 "Show revision 3174963 of this file in browser") | [r3210469](/browser/taskbuilder/tags/3.0.7/includes/admin/email_notifications/wppm_en_change_project_status.php?rev=3210469#L10 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 10 | 10 | $wppm\_default\_email\_notification\_to\_current\_user = get\_option('wppm\_default\_email\_notification\_to\_current\_user'); |
  | 11 | 11 | $project\_id = intval(sanitize\_text\_field($project\_id)); |
  |  | 12 | $project\_id = esc\_sql($project\_id); |
  | 12 | 13 | $project\_data = $wppmfunction->get\_project($project\_id); |
  | 13 | 14 | $proj\_users = $project\_data['users']; |
  | […](/browser/taskbuilder/trunk/includes/admin/email_notifications/wppm_en_change_project_status.php?rev=3174963#L30) | […](/browser/taskbuilder/tags/3.0.7/includes/admin/email_notifications/wppm_en_change_project_status.php?rev=3210469#L31) |  |
  | 30 | 31 | foreach($proj\_users as $user){ |
  | 31 | 32 | if(!empty($user)){ |
  | 32 |  | $project\_user\_data = $wpdb->get\_row("SELECT \* FROM {$wpdb->prefix}wppm\_project\_users WHERE proj\_id = $project\_id AND user\_id = $user"); |
  |  | 33 | $user = esc\_sql($user); |
  |  | 34 | $project\_user\_data = $wpdb->get\_row("SELECT \* FROM {$wpdb->prefix}wppm\_project\_users WHERE proj\_id = '$project\_id' AND user\_id = '$user'"); |
  | 33 | 35 | $userdata = get\_userdata($user); |
  | 34 | 36 | if((!empty($project\_user\_data)) && $project\_user\_data->role\_id == 1){ |
  | […](/browser/taskbuilder/trunk/includes/admin/email_notifications/wppm_en_change_project_status.php?rev=3174963#L41) | […](/browser/taskbuilder/tags/3.0.7/includes/admin/email_notifications/wppm_en_change_project_status.php?rev=3210469#L43) |  |
  | 41 | 43 | foreach($proj\_users as $user){ |
  | 42 | 44 | if(!empty($user)){ |
  | 43 |  | $project\_user\_data = $wpdb->get\_row("SELECT \* FROM {$wpdb->prefix}wppm\_project\_users WHERE proj\_id = $project\_id AND user\_id = $user"); |
  |  | 45 | $user = esc\_sql($user); |
  |  | 46 | $project\_user\_data = $wpdb->get\_row("SELECT \* FROM {$wpdb->prefix}wppm\_project\_users WHERE proj\_id = '$project\_id' AND user\_id = '$user'"); |
  | 44 | 47 | $userdata = get\_userdata($user); |
  | 45 | 48 | if((!empty($project\_user\_data)) && $project\_user\_data->role\_id == 2){ |
* ## [taskbuilder/tags/3.0.7/includes/admin/email\_notifications/wppm\_en\_project\_created.php](/changeset/3210469/taskbuilder/tags/3.0.7/includes/admin/email_notifications/wppm_en_project_created.php "Show the changeset 3210469 restricted to taskbuilder/tags/3.0.7/includes/admin/email_notifications/wppm_en_project_created.php")

  | [r3174963](/browser/taskbuilder/trunk/includes/admin/email_notifications/wppm_en_project_created.php?rev=3174963#L9 "Show revision 3174963 of this file in browser") | [r3210469](/browser/taskbuilder/tags/3.0.7/includes/admin/email_notifications/wppm_en_project_created.php?rev=3210469#L9 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 9 | 9 | $ignore\_emails = get\_option('wppm\_en\_ignore\_emails'); |
  | 10 | 10 | $project\_id = intval(sanitize\_text\_field(($project\_id))); |
  |  | 11 | $project\_id = esc\_sql($project\_id); |
  | 11 | 12 | $project\_data = $wppmfunction->get\_project($project\_id); |
  | 12 | 13 | $proj\_users = $project\_data['users']; |
  | […](/browser/taskbuilder/trunk/includes/admin/email_notifications/wppm_en_project_created.php?rev=3174963#L29) | […](/browser/taskbuilder/tags/3.0.7/includes/admin/email_notifications/wppm_en_project_created.php?rev=3210469#L30) |  |
  | 29 | 30 | foreach($proj\_users as $user){ |
  | 30 | 31 | if(!empty($user)){ |
  | 31 |  | $project\_user\_data = $wpdb->get\_row("SELECT \* FROM {$wpdb->prefix}wppm\_project\_users WHERE proj\_id = $project\_id AND user\_id = $user"); |
  |  | 32 | $user = esc\_sql($user); |
  |  | 33 | $project\_user\_data = $wpdb->get\_row("SELECT \* FROM {$wpdb->prefix}wppm\_project\_users WHERE proj\_id = '$project\_id' AND user\_id = '$user'"); |
  | 32 | 34 | $userdata = get\_userdata($user); |
  | 33 | 35 | if((!empty($project\_user\_data)) && $project\_user\_data->role\_id == 1){ |
  | […](/browser/taskbuilder/trunk/includes/admin/email_notifications/wppm_en_project_created.php?rev=3174963#L40) | […](/browser/taskbuilder/tags/3.0.7/includes/admin/email_notifications/wppm_en_project_created.php?rev=3210469#L42) |  |
  | 40 | 42 | foreach($proj\_users as $user){ |
  | 41 | 43 | if(!empty($user)){ |
  | 42 |  | $project\_user\_data = $wpdb->get\_row("SELECT \* FROM {$wpdb->prefix}wppm\_project\_users WHERE proj\_id = $project\_id AND user\_id = $user"); |
  |  | 44 | $user = esc\_sql($user); |
  |  | 45 | $project\_user\_data = $wpdb->get\_row("SELECT \* FROM {$wpdb->prefix}wppm\_project\_users WHERE proj\_id = '$project\_id' AND user\_id = '$user'"); |
  | 43 | 46 | $userdata = get\_userdata($user); |
  | 44 | 47 | if((!empty($project\_user\_data)) && $project\_user\_data->role\_id == 2){ |
* ## [taskbuilder/tags/3.0.7/includes/admin/email\_notifications/wppm\_en\_set\_change\_task\_status.php](/changeset/3210469/taskbuilder/tags/3.0.7/includes/admin/email_notifications/wppm_en_set_change_task_status.php "Show the changeset 3210469 restricted to taskbuilder/tags/3.0.7/includes/admin/email_notifications/wppm_en_set_change_task_status.php")

  | [r3174963](/browser/taskbuilder/trunk/includes/admin/email_notifications/wppm_en_set_change_task_status.php?rev=3174963#L10 "Show revision 3174963 of this file in browser") | [r3210469](/browser/taskbuilder/tags/3.0.7/includes/admin/email_notifications/wppm_en_set_change_task_status.php?rev=3210469#L10 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 10 | 10 | $task\_id = sanitize\_text\_field($task\_id); |
  | 11 | 11 | $task\_data = $wppmfunction->get\_task($task\_id); |
  | 12 |  | $project\_id = $task\_data['project']; |
  | 13 |  | $project\_users = $wpdb->get\_results("SELECT user\_id FROM {$wpdb->prefix}wppm\_project\_users WHERE proj\_id = $project\_id AND role\_id = 1"); |
  | 14 |  | $p\_users = $wpdb->get\_var("SELECT users FROM {$wpdb->prefix}wppm\_project WHERE id = $project\_id"); |
  | 15 |  | $p\_users\_array = explode(',',$p\_users ); |
  |  | 12 | $project\_id = esc\_sql($task\_data['project']); |
  |  | 13 | $project\_users = $wpdb->get\_results("SELECT user\_id FROM {$wpdb->prefix}wppm\_project\_users WHERE proj\_id = '$project\_id' AND role\_id = 1"); |
  |  | 14 | $p\_users = $wpdb->get\_var("SELECT users FROM {$wpdb->prefix}wppm\_project WHERE id = '$project\_id'"); |
  |  | 15 | $p\_users\_array = array(); |
  |  | 16 | if(!empty($p\_users)){ |
  |  | 17 | $p\_users\_array = explode(',',$p\_users ); |
  |  | 18 | } |
  | 16 | 19 | $task\_users = $task\_data['users']; |
  | 17 | 20 | $task\_users = explode(',',$task\_users); |
  | […](/browser/taskbuilder/trunk/includes/admin/email_notifications/wppm_en_set_change_task_status.php?rev=3174963#L43) | […](/browser/taskbuilder/tags/3.0.7/includes/admin/email_notifications/wppm_en_set_change_task_status.php?rev=3210469#L46) |  |
  | 43 | 46 | if(!empty($user)){ |
  | 44 | 47 | $userdata = get\_userdata($user); |
  | 45 |  | $project\_user\_data = $wpdb->get\_row("SELECT \* FROM {$wpdb->prefix}wppm\_project\_users WHERE proj\_id = $project\_id  AND user\_id = $user"); |
  |  | 48 | $user = esc\_sql($user); |
  |  | 49 | $project\_user\_data = $wpdb->get\_row("SELECT \* FROM {$wpdb->prefix}wppm\_project\_users WHERE proj\_id = '$project\_id'  AND user\_id = '$user'"); |
  | 46 | 50 | if((!empty($project\_user\_data)) && $project\_user\_data->role\_id == 1){ |
  | 47 | 51 | $email\_addresses[] = $userdata->user\_email; |
  | […](/browser/taskbuilder/trunk/includes/admin/email_notifications/wppm_en_set_change_task_status.php?rev=3174963#L54) | […](/browser/taskbuilder/tags/3.0.7/includes/admin/email_notifications/wppm_en_set_change_task_status.php?rev=3210469#L58) |  |
  | 54 | 58 | if(!empty($user)){ |
  | 55 | 59 | $userdata = get\_userdata($user); |
  | 56 |  | $project\_user\_data = $wpdb->get\_row("SELECT \* FROM {$wpdb->prefix}wppm\_project\_users WHERE proj\_id = $project\_id  AND user\_id = $user"); |
  |  | 60 | $user = esc\_sql($user); |
  |  | 61 | $project\_user\_data = $wpdb->get\_row("SELECT \* FROM {$wpdb->prefix}wppm\_project\_users WHERE proj\_id = '$project\_id'  AND user\_id = '$user'"); |
  | 57 | 62 | if((!empty($project\_user\_data)) && $project\_user\_data->role\_id == 2){ |
  | 58 | 63 | $email\_addresses[] = $userdata->user\_email; |
* ## [taskbuilder/tags/3.0.7/includes/admin/email\_notifications/wppm\_en\_set\_project\_users.php](/changeset/3210469/taskbuilder/tags/3.0.7/includes/admin/email_notifications/wppm_en_set_project_users.php "Show the changeset 3210469 restricted to taskbuilder/tags/3.0.7/includes/admin/email_notifications/wppm_en_set_project_users.php")

  | [r3174963](/browser/taskbuilder/trunk/includes/admin/email_notifications/wppm_en_set_project_users.php?rev=3174963#L7 "Show revision 3174963 of this file in browser") | [r3210469](/browser/taskbuilder/tags/3.0.7/includes/admin/email_notifications/wppm_en_set_project_users.php?rev=3210469#L7 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 7 | 7 | $from\_email    = get\_option('wppm\_en\_from\_email'); |
  | 8 | 8 | $ignore\_emails = get\_option('wppm\_en\_ignore\_emails'); |
  | 9 |  | $project\_id = ~~intval(sanitize\_text\_field($project\_id~~)); |
  |  | 9 | $project\_id = esc\_sql(intval(sanitize\_text\_field($project\_id))); |
  | 10 | 10 | $project\_data = $wppmfunction->get\_project($project\_id); |
  | 11 | 11 | $proj\_users = $project\_data['users']; |
  | […](/browser/taskbuilder/trunk/includes/admin/email_notifications/wppm_en_set_project_users.php?rev=3174963#L30) | […](/browser/taskbuilder/tags/3.0.7/includes/admin/email_notifications/wppm_en_set_project_users.php?rev=3210469#L30) |  |
  | 30 | 30 | foreach($proj\_users as $user){ |
  | 31 | 31 | if(!empty($user)){ |
  | 32 |  | $project\_user\_data = $wpdb->get\_row("SELECT \* FROM {$wpdb->prefix}wppm\_project\_users WHERE proj\_id = $project\_id  AND user\_id = $user"); |
  |  | 32 | $user = esc\_sql($user); |
  |  | 33 | $project\_user\_data = $wpdb->get\_row("SELECT \* FROM {$wpdb->prefix}wppm\_project\_users WHERE proj\_id = '$project\_id'  AND user\_id = '$user'"); |
  | 33 | 34 | $userdata = get\_userdata($user); |
  | 34 | 35 | if((!empty($project\_user\_data)) && $project\_user\_data->role\_id == 1){ |
  | […](/browser/taskbuilder/trunk/includes/admin/email_notifications/wppm_en_set_project_users.php?rev=3174963#L41) | […](/browser/taskbuilder/tags/3.0.7/includes/admin/email_notifications/wppm_en_set_project_users.php?rev=3210469#L42) |  |
  | 41 | 42 | foreach($proj\_users as $user){ |
  | 42 | 43 | if(!empty($user)){ |
  | 43 |  | $project\_user\_data = $wpdb->get\_row("SELECT \* FROM {$wpdb->prefix}wppm\_project\_users WHERE proj\_id = $project\_id  AND user\_id = $user"); |
  |  | 44 | $user = esc\_sql($user); |
  |  | 45 | $project\_user\_data = $wpdb->get\_row("SELECT \* FROM {$wpdb->prefix}wppm\_project\_users WHERE proj\_id = '$project\_id'  AND user\_id = '$user'"); |
  | 44 | 46 | $userdata = get\_userdata($user); |
  | 45 | 47 | if((!empty($project\_user\_data)) && $project\_user\_data->role\_id == 2){ |
* ## [taskbuilder/tags/3.0.7/includes/admin/email\_notifications/wppm\_en\_submit\_proj\_comment.php](/changeset/3210469/taskbuilder/tags/3.0.7/includes/admin/email_notifications/wppm_en_submit_proj_comment.php "Show the changeset 3210469 restricted to taskbuilder/tags/3.0.7/includes/admin/email_notifications/wppm_en_submit_proj_comment.php")

  | [r3174963](/browser/taskbuilder/trunk/includes/admin/email_notifications/wppm_en_submit_proj_comment.php?rev=3174963#L8 "Show revision 3174963 of this file in browser") | [r3210469](/browser/taskbuilder/tags/3.0.7/includes/admin/email_notifications/wppm_en_submit_proj_comment.php?rev=3210469#L8 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 8 | 8 | $from\_email    = get\_option('wppm\_en\_from\_email'); |
  | 9 | 9 | $ignore\_emails = get\_option('wppm\_en\_ignore\_emails'); |
  | 10 |  | $proj\_id = ~~intval(sanitize\_text\_field($proj\_id~~)); |
  |  | 10 | $proj\_id = esc\_sql(intval(sanitize\_text\_field($proj\_id))); |
  | 11 | 11 | $proj\_data = $wppmfunction->get\_project($proj\_id); |
  | 12 | 12 | $proj\_users = $proj\_data['users']; |
* ## [taskbuilder/tags/3.0.7/includes/admin/email\_notifications/wppm\_get\_templates.php](/changeset/3210469/taskbuilder/tags/3.0.7/includes/admin/email_notifications/wppm_get_templates.php "Show the changeset 3210469 restricted to taskbuilder/tags/3.0.7/includes/admin/email_notifications/wppm_get_templates.php")

  | [r3142140](/browser/taskbuilder/trunk/includes/admin/email_notifications/wppm_get_templates.php?rev=3142140#L60 "Show revision 3142140 of this file in browser") | [r3210469](/browser/taskbuilder/tags/3.0.7/includes/admin/email_notifications/wppm_get_templates.php?rev=3210469#L60 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 60 | 60 | </tr> |
  | 61 | 61 | <tr> |
  |  | 62 | <td id="wppm\_tag\_task\_creator\_name" class="wppm\_tag\_task\_creator\_name" onclick="wppm\_insert\_editor\_text('{task\_creator\_name}')">{<?php echo esc\_attr('task\_creator\_name') ?>}</td> |
  |  | 63 | <td><?php echo esc\_html\_e('Task Creator Name','taskbuilder'); ?></td> |
  |  | 64 | </tr> |
  |  | 65 | <tr> |
  | 62 | 66 | <td id="wppm\_tag\_task\_description" class="wppm\_tag\_task\_description" onclick="wppm\_insert\_editor\_text('{task\_description}')">{<?php echo esc\_attr('task\_description') ?>}</td> |
  | 63 | 67 | <td><?php echo esc\_html\_e('Task Description','taskbuilder'); ?></td> |
* ## [taskbuilder/tags/3.0.7/includes/admin/projects/filters/wppm\_project\_search\_filter.php](/changeset/3210469/taskbuilder/tags/3.0.7/includes/admin/projects/filters/wppm_project_search_filter.php "Show the changeset 3210469 restricted to taskbuilder/tags/3.0.7/includes/admin/projects/filters/wppm_project_search_filter.php")

  | [r3174963](/browser/taskbuilder/trunk/includes/admin/projects/filters/wppm_project_search_filter.php?rev=3174963#L14 "Show revision 3174963 of this file in browser") | [r3210469](/browser/taskbuilder/tags/3.0.7/includes/admin/projects/filters/wppm_project_search_filter.php?rev=3210469#L14 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 14 | 14 | foreach( $search\_tag as $key=>$val){ |
  | 15 | 15 | if($key == 'search\_tag'){ |
  |  | 16 | $val = esc\_sql($val); |
  | 16 | 17 | $query = "SELECT \* FROM {$wpdb->prefix}wppm\_project where project\_name LIKE $wpdb->esc\_like( '$val' )"; |
  | 17 | 18 | } |
* ## [taskbuilder/tags/3.0.7/includes/admin/projects/get\_users.php](/changeset/3210469/taskbuilder/tags/3.0.7/includes/admin/projects/get_users.php "Show the changeset 3210469 restricted to taskbuilder/tags/3.0.7/includes/admin/projects/get_users.php")

  | [r3142140](/browser/taskbuilder/trunk/includes/admin/projects/get_users.php?rev=3142140#L6 "Show revision 3142140 of this file in browser") | [r3210469](/browser/taskbuilder/tags/3.0.7/includes/admin/projects/get_users.php?rev=3210469#L6 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 6 | 6 | $wppm\_users\_role = get\_option('wppm\_user\_role'); |
  | 7 | 7 | $proj\_id  = isset($\_POST['proj\_id']) ? sanitize\_text\_field($\_POST['proj\_id']) : '' ; |
  |  | 8 | $proj\_id = esc\_sql($proj\_id); |
  | 8 | 9 | $wppm\_current\_user\_capability = get\_user\_meta( $current\_user->ID, 'wppm\_capability', true ); |
  | 9 | 10 | $project = $wpdb->get\_row( "SELECT \* FROM {$wpdb->prefix}wppm\_project where id = $proj\_id" ); |
  | […](/browser/taskbuilder/trunk/includes/admin/projects/get_users.php?rev=3142140#L24) | […](/browser/taskbuilder/tags/3.0.7/includes/admin/projects/get_users.php?rev=3210469#L25) |  |
  | 24 | 25 | <?php |
  | 25 | 26 | $userdata = get\_userdata( $user ); |
  |  | 27 | $user = esc\_sql($user); |
  | 26 | 28 | $project\_user = $wpdb->get\_row("SELECT \* FROM {$wpdb->prefix}wppm\_project\_users WHERE proj\_id = '$proj\_id' AND user\_id = '$user'"); |
  | 27 | 29 | ?> |
* ## [taskbuilder/tags/3.0.7/includes/admin/projects/open\_project/wppm\_change\_project\_visibility.php](/changeset/3210469/taskbuilder/tags/3.0.7/includes/admin/projects/open_project/wppm_change_project_visibility.php "Show the changeset 3210469 restricted to taskbuilder/tags/3.0.7/includes/admin/projects/open_project/wppm_change_project_visibility.php")

  | [r3174963](/browser/taskbuilder/trunk/includes/admin/projects/open_project/wppm_change_project_visibility.php?rev=3174963#L13 "Show revision 3174963 of this file in browser") | [r3210469](/browser/taskbuilder/tags/3.0.7/includes/admin/projects/open_project/wppm_change_project_visibility.php?rev=3210469#L13 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 13 | 13 | if (!(($current\_user->ID && $current\_user->has\_cap('manage\_options')) || ($current\_user->ID && $current\_user->has\_cap('wppm\_admin')) || ($project['created\_by']==$current\_user->ID && $wppm\_current\_user\_capability == 'wppm\_manager'))) {exit;} |
  | 14 | 14 | $wppm\_project\_visibility = isset($\_POST['project\_visibility']) ? sanitize\_text\_field($\_POST['project\_visibility']):"0"; |
  |  | 15 | $wppm\_project\_visibility  = esc\_sql($wppm\_project\_visibility ); |
  | 15 | 16 | $id = $wpdb->get\_var("SELECT id FROM {$wpdb->prefix}wppm\_project\_meta WHERE project\_id = '$project\_id' AND meta\_key ='public\_project'"); |
  |  | 17 | $id = esc\_sql($id); |
  | 16 | 18 | if(empty($id )){ |
  | 17 | 19 | $wppmfunction->add\_project\_meta($project\_id,'public\_project',$wppm\_project\_visibility); |
* ## [taskbuilder/tags/3.0.7/includes/admin/projects/open\_project/wppm\_edit\_project\_details.php](/changeset/3210469/taskbuilder/tags/3.0.7/includes/admin/projects/open_project/wppm_edit_project_details.php "Show the changeset 3210469 restricted to taskbuilder/tags/3.0.7/includes/admin/projects/open_project/wppm_edit_project_details.php")

  | [r3142140](/browser/taskbuilder/trunk/includes/admin/projects/open_project/wppm_edit_project_details.php?rev=3142140#L6 "Show revision 3142140 of this file in browser") | [r3210469](/browser/taskbuilder/tags/3.0.7/includes/admin/projects/open_project/wppm_edit_project_details.php?rev=3210469#L6 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 6 | 6 | global $wpdb,$wppmfunction,$current\_user; |
  | 7 | 7 | $id  = isset($\_POST['id']) ? sanitize\_text\_field($\_POST['id']) : '' ; |
  | 8 |  | $project = $wpdb->get\_results( "SELECT \* FROM {$wpdb->prefix}wppm\_project where id = $id" ); |
  |  | 8 | $id = esc\_sql($id); |
  |  | 9 | $project = $wpdb->get\_results( "SELECT \* FROM {$wpdb->prefix}wppm\_project where id = '$id'" ); |
  | 9 | 10 | $project\_data = $wppmfunction->get\_project($id); |
  | 10 | 11 | $wppm\_current\_user\_capability = get\_user\_meta( $current\_user->ID, 'wppm\_capability', true ); |
* ## [taskbuilder/tags/3.0.7/includes/admin/projects/open\_project/wppm\_get\_project\_tasks.php](/changeset/3210469/taskbuilder/tags/3.0.7/includes/admin/projects/open_project/wppm_get_project_tasks.php "Show the changeset 3210469 restricted to taskbuilder/tags/3.0.7/includes/admin/projects/open_project/wppm_get_project_tasks.php")

  | [r3174963](/browser/taskbuilder/trunk/includes/admin/projects/open_project/wppm_get_project_tasks.php?rev=3174963#L5 "Show revision 3174963 of this file in browser") | [r3210469](/browser/taskbuilder/tags/3.0.7/includes/admin/projects/open_project/wppm_get_project_tasks.php?rev=3210469#L5 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 5 | 5 | global $current\_user,$wpdb,$wppmfunction; |
  | 6 | 6 | $project\_id = isset($\_POST['id']) ? intval(sanitize\_text\_field($\_POST['id'])) : 0 ; |
  |  | 7 | $project\_id = esc\_sql($project\_id); |
  |  | 8 | $cu\_id = esc\_sql($current\_user->ID); |
  | 7 | 9 | $appearance\_settings = get\_option("wppm-ap-task-list"); |
  | 8 | 10 | $wppm\_task\_time = get\_option('wppm\_task\_time'); |
  | […](/browser/taskbuilder/trunk/includes/admin/projects/open_project/wppm_get_project_tasks.php?rev=3174963#L16) | […](/browser/taskbuilder/tags/3.0.7/includes/admin/projects/open_project/wppm_get_project_tasks.php?rev=3210469#L18) |  |
  | 16 | 18 | Left join {$wpdb->prefix}wppm\_project\_users proj\_users ON Task.project = proj\_users.proj\_id |
  | 17 | 19 | Left join {$wpdb->prefix}wppm\_project\_meta proj\_meta ON Task.project = proj\_meta.project\_id |
  | 18 |  | where Task.project = '$project\_id' AND ((FIND\_IN\_SET('$cu~~rrent\_user->ID',Task.users)>0) OR (Task.created\_by= '$current\_user->ID') OR (proj\_users.user\_id = '$current\_user->ID' AND proj\_users.role\_id = 1 AND (FIND\_IN\_SET('$current\_user->ID',proj.users)>0)) OR (Task.project = proj\_meta.project\_id AND proj\_meta.meta\_key='public\_project' AND proj\_meta.meta\_value=1) OR (Task.project = proj.id AND proj.created\_by='$current\_user->ID~~')) Group by Task.id"); |
  |  | 20 | where Task.project = '$project\_id' AND ((FIND\_IN\_SET('$cu\_id',Task.users)>0) OR (Task.created\_by= '$cu\_id') OR (proj\_users.user\_id = '$cu\_id' AND proj\_users.role\_id = 1 AND (FIND\_IN\_SET('$cu\_id',proj.users)>0)) OR (Task.project = proj\_meta.project\_id AND proj\_meta.meta\_key='public\_project' AND proj\_meta.meta\_value=1) OR (Task.project = proj.id AND proj.created\_by='$cu\_id')) Group by Task.id"); |
  | 19 | 21 | } |
  | 20 | 22 | $query = apply\_filters('wppm\_get\_project\_tasks\_query',$query,$project\_id); |
* ## [taskbuilder/tags/3.0.7/includes/admin/projects/open\_project/wppm\_proj\_thread\_attachment\_remove.php](/changeset/3210469/taskbuilder/tags/3.0.7/includes/admin/projects/open_project/wppm_proj_thread_attachment_remove.php "Show the changeset 3210469 restricted to taskbuilder/tags/3.0.7/includes/admin/projects/open_project/wppm_proj_thread_attachment_remove.php")

  | [r3174963](/browser/taskbuilder/trunk/includes/admin/projects/open_project/wppm_proj_thread_attachment_remove.php?rev=3174963#L9 "Show revision 3174963 of this file in browser") | [r3210469](/browser/taskbuilder/tags/3.0.7/includes/admin/projects/open_project/wppm_proj_thread_attachment_remove.php?rev=3210469#L9 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 9 | 9 | } |
  | 10 | 10 | $attachment     = isset($\_POST['attachment']) ? intval(sanitize\_text\_field($\_POST['attachment'])) : '0' ; |
  |  | 11 | $attachment = esc\_sql($attachment); |
  | 11 | 12 | $comment\_id = isset($\_POST['comment\_id']) ? intval(sanitize\_text\_field($\_POST['comment\_id'])) : '0' ; |
  |  | 13 | $comment\_id  = esc\_sql($comment\_id ); |
  | 12 | 14 | $proj\_id = isset($\_POST['proj\_id']) ? intval(sanitize\_text\_field($\_POST['proj\_id'])) : '0' ; |
  |  | 15 | $proj\_id  = esc\_sql($proj\_id ); |
  | 13 | 16 | $proj\_comment = $wpdb->get\_row( "SELECT \* FROM {$wpdb->prefix}wppm\_project\_comment where id = '$comment\_id' AND proj\_id='$proj\_id'"); |
  | 14 | 17 | if(!(((!empty($proj\_comment)) && ($proj\_comment->created\_by == $current\_user->ID)) || ($current\_user->has\_cap('manage\_options')) || ($wppmfunction->has\_proj\_comment\_permission('edit\_proj\_comment',$proj\_id,$comment\_id)))){ |
* ## [taskbuilder/tags/3.0.7/includes/admin/projects/open\_project/wppm\_set\_change\_project\_details.php](/changeset/3210469/taskbuilder/tags/3.0.7/includes/admin/projects/open_project/wppm_set_change_project_details.php "Show the changeset 3210469 restricted to taskbuilder/tags/3.0.7/includes/admin/projects/open_project/wppm_set_change_project_details.php")

  | [r3174963](/browser/taskbuilder/trunk/includes/admin/projects/open_project/wppm_set_change_project_details.php?rev=3174963#L29 "Show revision 3174963 of this file in browser") | [r3210469](/browser/taskbuilder/tags/3.0.7/includes/admin/projects/open_project/wppm_set_change_project_details.php?rev=3210469#L29 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 29 | 29 | $wppmfunction->change\_project\_end\_date( $project\_id, $project\_end\_date); |
  | 30 | 30 | } |
  | 31 |  | ~~$pcid = esc\_sql($project\_data['cat\_id']);~~ |
  | 32 |  | ~~$project\_category = esc\_sql($project\_category);~~ |
  | 33 | 31 | if( $project\_category && $project\_category != $project\_data['cat\_id']){ |
  | 34 | 32 | $wppmfunction->change\_category( $project\_id, $project\_category); |
  | 35 |  | $change\_category\_value = array('prev\_cat'=>~~"$pcid",'new\_cat'=>"$project\_category"~~); |
  |  | 33 | $change\_category\_value = array('prev\_cat'=>$project\_data['cat\_id'],'new\_cat'=>$project\_category); |
  | 36 | 34 | $change\_category\_obj = serialize($change\_category\_value); |
  | 37 |  | $log\_values = array('proj\_id'=>$project\_id,'body'=>$change\_category\_obj,'attachment\_ids'=>"",'create\_time'=>date("Y-m-d h:i:sa"),'created\_by'=>$current\_user->ID ); |
  |  | 35 | $project\_id = esc\_sql($project\_id); |
  |  | 36 | $log\_values = array('proj\_id'=>"$project\_id",'body'=>$change\_category\_obj,'attachment\_ids'=>"",'create\_time'=>date("Y-m-d h:i:sa"),'created\_by'=>esc\_sql($current\_user->ID) ); |
  | 38 | 37 | $wpdb->insert($wpdb->prefix . 'wppm\_project\_comment',$log\_values); |
  | 39 | 38 | $log\_id = esc\_sql($wpdb->insert\_id); |
* ## [taskbuilder/tags/3.0.7/includes/admin/projects/open\_project/wppm\_set\_change\_project\_raised\_by.php](/changeset/3210469/taskbuilder/tags/3.0.7/includes/admin/projects/open_project/wppm_set_change_project_raised_by.php "Show the changeset 3210469 restricted to taskbuilder/tags/3.0.7/includes/admin/projects/open_project/wppm_set_change_project_raised_by.php")

  | [r3174963](/browser/taskbuilder/trunk/includes/admin/projects/open_project/wppm_set_change_project_raised_by.php?rev=3174963#L18 "Show revision 3174963 of this file in browser") | [r3210469](/browser/taskbuilder/tags/3.0.7/includes/admin/projects/open_project/wppm_set_change_project_raised_by.php?rev=3210469#L18 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 18 | 18 | if ( $user\_id != $old\_user\_id ){ |
  | 19 | 19 | $wppmfunction->change\_project\_raised\_by($project\_id, $user\_id); |
  |  | 20 | $user\_id = esc\_sql($user\_id); |
  | 20 | 21 | $change\_creator\_value = array('prev\_user'=>"$old\_user\_id",'new\_user'=>"$user\_id"); |
  | 21 | 22 | $change\_creator\_obj = serialize($change\_creator\_value); |
  | 22 |  | $log\_values = array('proj\_id'=>$project\_id,'body'=>$change\_creator\_obj,'attachment\_ids'=>"",'create\_time'=>date("Y-m-d h:i:sa"),'created\_by'=>$current\_user->ID ); |
  |  | 23 | $project\_id = esc\_sql($project\_id); |
  |  | 24 | $log\_values = array('proj\_id'=>"$project\_id",'body'=>$change\_creator\_obj,'attachment\_ids'=>"",'create\_time'=>date("Y-m-d h:i:sa"),'created\_by'=>esc\_sql($current\_user->ID) ); |
  | 23 | 25 | $wpdb->insert($wpdb->prefix . 'wppm\_project\_comment',$log\_values); |
  | 24 | 26 | $log\_id = esc\_sql($wpdb->insert\_id); |
  | 25 |  | $proj\_log\_values = array('proj\_id'=>~~$project\_id,'comment\_id'=>$log\_id~~,'comment\_type'=>'change\_proj\_creator'); |
  |  | 27 | $proj\_log\_values = array('proj\_id'=>"$project\_id",'comment\_id'=>"$log\_id",'comment\_type'=>'change\_proj\_creator'); |
  | 26 | 28 | $wpdb->insert($wpdb->prefix . 'wppm\_project\_comment\_meta',$proj\_log\_values); |
  | 27 | 29 | } |
* ## [taskbuilder/tags/3.0.7/includes/admin/projects/open\_project/wppm\_set\_delete\_proj\_thread.php](/changeset/3210469/taskbuilder/tags/3.0.7/includes/admin/projects/open_project/wppm_set_delete_proj_thread.php "Show the changeset 3210469 restricted to taskbuilder/tags/3.0.7/includes/admin/projects/open_project/wppm_set_delete_proj_thread.php")

  | [r3174963](/browser/taskbuilder/trunk/includes/admin/projects/open_project/wppm_set_delete_proj_thread.php?rev=3174963#L9 "Show revision 3174963 of this file in browser") | [r3210469](/browser/taskbuilder/tags/3.0.7/includes/admin/projects/open_project/wppm_set_delete_proj_thread.php?rev=3210469#L9 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 9 | 9 | } |
  | 10 | 10 | $proj\_id  = isset($\_POST['proj\_id']) ? intval(sanitize\_text\_field($\_POST['proj\_id'])) : 0 ; |
  |  | 11 | $proj\_id  = esc\_sql($proj\_id); |
  | 11 | 12 | $thread\_id  = isset($\_POST['comment\_id']) ? intval(sanitize\_text\_field($\_POST['comment\_id'])) : 0 ; |
  | 12 | 13 | $project\_comment = $wppmfunction->get\_proj\_comment($thread\_id); |
  | 13 | 14 | if (!(($current\_user->ID && $current\_user->has\_cap('manage\_options')) || $wppmfunction->has\_proj\_comment\_permission('delete\_proj\_thread',$proj\_id,$thread\_id))) {exit;} |
  | 14 |  | $sql="SELECT attachment\_ids FROM {$wpdb->prefix}wppm\_project\_comment WHERE id = '~~$thread\_id~~'"; |
  |  | 15 | $sql="SELECT attachment\_ids FROM {$wpdb->prefix}wppm\_project\_comment WHERE id = '".esc\_sql($thread\_id)."'"; |
  | 15 | 16 | $thread\_attachment\_ids = $wpdb->get\_results( $sql ); |
  | 16 | 17 | if(!empty($thread\_attachment\_ids) ){ |
  | […](/browser/taskbuilder/trunk/includes/admin/projects/open_project/wppm_set_delete_proj_thread.php?rev=3174963#L23) | […](/browser/taskbuilder/tags/3.0.7/includes/admin/projects/open_project/wppm_set_delete_proj_thread.php?rev=3210469#L24) |  |
  | 23 | 24 | if(!empty($attachment\_ids\_temp)){ |
  | 24 | 25 | foreach ($attachment\_ids\_temp as $attachment\_id){ |
  | 25 |  | $attachment\_id = esc\_sql($attachment\_id); |
  | 26 |  | $sql="SELECT \* FROM {$wpdb->prefix}wppm\_attachments WHERE id = '$attachment\_id'"; |
  |  | 26 | $sql="SELECT \* FROM {$wpdb->prefix}wppm\_attachments WHERE id = '".esc\_sql($attachment\_id)."'"; |
  | 27 | 27 | $result=$wpdb->get\_row($sql); |
  | 28 | 28 | if(!empty($result)){ |
  | […](/browser/taskbuilder/trunk/includes/admin/projects/open_project/wppm_set_delete_proj_thread.php?rev=3174963#L35) | […](/browser/taskbuilder/tags/3.0.7/includes/admin/projects/open_project/wppm_set_delete_proj_thread.php?rev=3210469#L35) |  |
  | 35 | 35 | unlink($result->file\_path); |
  | 36 | 36 | } |
  |  | 37 | $attachment\_id = esc\_sql($attachment\_id); |
  | 37 | 38 | $wpdb->delete($wpdb->prefix.'wppm\_attachments', array( 'id' => "$attachment\_id")); |
  | 38 | 39 | } |
  | […](/browser/taskbuilder/trunk/includes/admin/projects/open_project/wppm_set_delete_proj_thread.php?rev=3174963#L43) | […](/browser/taskbuilder/tags/3.0.7/includes/admin/projects/open_project/wppm_set_delete_proj_thread.php?rev=3210469#L44) |  |
  | 43 | 44 |  |
  | 44 | 45 | $cur\_user = get\_userdata($current\_user->ID); |
  | 45 |  | $log\_values = array('proj\_id'=>$proj\_id,'body'=>'This comment was deleted by '.$cur\_user->display\_name,'attachment\_ids'=>""); |
  | 46 |  | $wpdb->update($wpdb->prefix.'wppm\_project\_comment', $log\_values, array('id'=>$thread\_id)); |
  | 47 |  | $comment\_meta = $wpdb->get\_row("SELECT \* FROM {$wpdb->prefix}wppm\_project\_comment\_meta WHERE comment\_id='$thread\_id' "); |
  | 48 |  | $proj\_log\_values = array('proj\_id'=>$proj\_id,'comment\_id'=>$thread\_id,'comment\_type'=>'delete\_proj\_comment'); |
  |  | 46 | $log\_values = array('proj\_id'=>"$proj\_id",'body'=>'This comment was deleted by '.$cur\_user->display\_name,'attachment\_ids'=>""); |
  |  | 47 | $thread\_id = esc\_sql($thread\_id); |
  |  | 48 | $wpdb->update($wpdb->prefix.'wppm\_project\_comment', $log\_values, array('id'=>"$thread\_id")); |
  |  | 49 | $comment\_meta = $wpdb->get\_row("SELECT \* FROM {$wpdb->prefix}wppm\_project\_comment\_meta WHERE comment\_id='".$thread\_id."' "); |
  |  | 50 | $proj\_log\_values = array('proj\_id'=>"$proj\_id",'comment\_id'=>"$thread\_id",'comment\_type'=>'delete\_proj\_comment'); |
  | 49 | 51 | if(!empty($comment\_meta)){ |
  | 50 |  | $wpdb->update($wpdb->prefix . 'wppm\_project\_comment\_meta',$proj\_log\_values,array('id'=>~~$comment\_meta->id~~)); |
  |  | 52 | $wpdb->update($wpdb->prefix . 'wppm\_project\_comment\_meta',$proj\_log\_values,array('id'=>esc\_sql($comment\_meta->id))); |
  | 51 | 53 | } else{ |
  | 52 | 54 | $wpdb->insert($wpdb->prefix . 'wppm\_project\_comment\_meta',$proj\_log\_values); |
* ## [taskbuilder/tags/3.0.7/includes/admin/projects/open\_project/wppm\_set\_project\_users.php](/changeset/3210469/taskbuilder/tags/3.0.7/includes/admin/projects/open_project/wppm_set_project_users.php "Show the changeset 3210469 restricted to taskbuilder/tags/3.0.7/includes/admin/projects/open_project/wppm_set_project_users.php")

  | [r3174963](/browser/taskbuilder/trunk/includes/admin/projects/open_project/wppm_set_project_users.php?rev=3174963#L9 "Show revision 3174963 of this file in browser") | [r3210469](/browser/taskbuilder/tags/3.0.7/includes/admin/projects/open_project/wppm_set_project_users.php?rev=3210469#L9 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 9 | 9 | $proj\_id  = isset($\_POST['proj\_id']) ? intval(sanitize\_text\_field($\_POST['proj\_id'])) : '' ; |
  | 10 | 10 | $project\_data = $wppmfunction->get\_project($proj\_id); |
  |  | 11 | $cu\_id =  esc\_sql($current\_user->ID); |
  | 11 | 12 | $wppm\_current\_user\_capability = get\_user\_meta( $current\_user->ID, 'wppm\_capability', true ); |
  | 12 | 13 | if (!(($current\_user->ID && $current\_user->has\_cap('manage\_options')) || $wppmfunction->has\_project\_permission('assign\_project\_users',$proj\_id) || ($project\_data['created\_by']==$current\_user->ID && $wppm\_current\_user\_capability == 'wppm\_manager') || ($current\_user->ID && $current\_user->has\_cap('wppm\_admin')))) {exit;} |
  | […](/browser/taskbuilder/trunk/includes/admin/projects/open_project/wppm_set_project_users.php?rev=3174963#L19) | […](/browser/taskbuilder/tags/3.0.7/includes/admin/projects/open_project/wppm_set_project_users.php?rev=3210469#L20) |  |
  | 19 | 20 | $prev\_assgn\_user\_meta = $wppmfunction->get\_project\_meta($proj\_id,'prev\_assigned\_users'); |
  | 20 | 21 | $wppmfunction->delete\_project\_meta($proj\_id,'prev\_assigned\_users'); |
  | 21 |  | $task\_users = $wpdb->get\_results("SELECT id,users FROM {$wpdb->prefix}wppm\_task WHERE project = '~~$proj\_id~~'"); |
  |  | 22 | $task\_users = $wpdb->get\_results("SELECT id,users FROM {$wpdb->prefix}wppm\_task WHERE project = '".esc\_sql($proj\_id)."'"); |
  | 22 | 23 | if(!empty($prev\_assign\_users)) { |
  | 23 | 24 | foreach($prev\_assign\_users as $puser){ |
  | […](/browser/taskbuilder/trunk/includes/admin/projects/open_project/wppm_set_project_users.php?rev=3174963#L33) | […](/browser/taskbuilder/tags/3.0.7/includes/admin/projects/open_project/wppm_set_project_users.php?rev=3210469#L34) |  |
  | 33 | 34 | if(!empty($wppm\_tuser)){ |
  | 34 | 35 | $wppmtuser = implode(',',$wppm\_tuser); |
  | 35 |  | ~~$wppmtuser = esc\_sql($wppmtuser);~~ |
  | 36 | 36 | $value=array( |
  | 37 |  | 'users'=>  ~~$wppmtuser~~ |
  |  | 37 | 'users'=>  esc\_sql($wppmtuser) |
  | 38 | 38 | ); |
  | 39 | 39 | } elseif(empty($wppm\_tuser)){ |
  | […](/browser/taskbuilder/trunk/includes/admin/projects/open_project/wppm_set_project_users.php?rev=3174963#L57) | […](/browser/taskbuilder/tags/3.0.7/includes/admin/projects/open_project/wppm_set_project_users.php?rev=3210469#L57) |  |
  | 57 | 57 | if(!empty($wppm\_tuser)){ |
  | 58 | 58 | $wppmtuser = implode(',',$wppm\_tuser); |
  | 59 |  | ~~$wppmtuser = esc\_sql($wppmtuser);~~ |
  | 60 | 59 | $value=array( |
  | 61 |  | 'users'=>  ~~$wppmtuser~~ |
  |  | 60 | 'users'=>  esc\_sql($wppmtuser) |
  | 62 | 61 | ); |
  | 63 | 62 | } elseif(empty($wppm\_tuser)){ |
  | […](/browser/taskbuilder/trunk/includes/admin/projects/open_project/wppm_set_project_users.php?rev=3174963#L66) | […](/browser/taskbuilder/tags/3.0.7/includes/admin/projects/open_project/wppm_set_project_users.php?rev=3210469#L65) |  |
  | 66 | 65 | ); |
  | 67 | 66 | } |
  | 68 |  | $wpdb->update($wpdb->prefix.'wppm\_task', $value, array('id'=>~~$tuser\_id~~)); |
  |  | 67 | $wpdb->update($wpdb->prefix.'wppm\_task', $value, array('id'=>"$tuser\_id")); |
  | 69 | 68 | } |
  | 70 | 69 | } |
  | […](/browser/taskbuilder/trunk/includes/admin/projects/open_project/wppm_set_project_users.php?rev=3174963#L77) | […](/browser/taskbuilder/tags/3.0.7/includes/admin/projects/open_project/wppm_set_project_users.php?rev=3210469#L76) |  |
  | 77 | 76 | foreach($users as $user){ |
  | 78 | 77 | $user\_role = sanitize\_text\_field($\_POST['wppm\_select\_user\_role\_'.$user]); |
  | 79 |  | $user = esc\_sql($user); |
  | 80 |  | $project\_user = $wpdb->get\_row("SELECT \* FROM {$wpdb->prefix}wppm\_project\_users WHERE proj\_id = '$proj\_id' AND user\_id = '$user'"); |
  |  | 78 | $project\_user = $wpdb->get\_row("SELECT \* FROM {$wpdb->prefix}wppm\_project\_users WHERE proj\_id = '".esc\_sql($proj\_id)."' AND user\_id = '".esc\_sql($user)."'"); |
  | 81 | 79 | if(!empty($project\_user)){ |
  | 82 | 80 | $values=array( |
  | 83 |  | 'role\_id'=> ~~$user\_role~~, |
  | 84 |  | 'assigned\_by'=> $cu~~rrent\_user->ID~~ |
  |  | 81 | 'role\_id'=> esc\_sql($user\_role), |
  |  | 82 | 'assigned\_by'=> $cu\_id |
  | 85 | 83 | ); |
  | 86 | 84 | $proj\_user\_id = esc\_sql($project\_user->id); |
  | […](/browser/taskbuilder/trunk/includes/admin/projects/open_project/wppm_set_project_users.php?rev=3174963#L90) | […](/browser/taskbuilder/tags/3.0.7/includes/admin/projects/open_project/wppm_set_project_users.php?rev=3210469#L88) |  |
  | 90 | 88 | $wpdb->prefix . 'wppm\_project\_users', |
  | 91 | 89 | array( |
  | 92 |  | 'proj\_id' => ~~$proj\_id~~, |
  | 93 |  | 'user\_id' => ~~$user~~, |
  | 94 |  | 'role\_id' =>~~$user\_role~~, |
  | 95 |  | 'assigned\_by' => $cu~~rrent\_user->ID~~ |
  |  | 90 | 'proj\_id' => esc\_sql($proj\_id), |
  |  | 91 | 'user\_id' => esc\_sql($user), |
  |  | 92 | 'role\_id' =>esc\_sql($user\_role), |
  |  | 93 | 'assigned\_by' => $cu\_id |
  | 96 | 94 | ) ); |
  | 97 | 95 | } |
  | […](/browser/taskbuilder/trunk/includes/admin/projects/open_project/wppm_set_project_users.php?rev=3174963#L112) | […](/browser/taskbuilder/tags/3.0.7/includes/admin/projects/open_project/wppm_set_project_users.php?rev=3210469#L110) |  |
  | 112 | 110 | $change\_assign\_user\_value = array('prev\_assign\_user'=>"$project\_data[users]",'new\_assign\_user'=>"$pusers"); |
  | 113 | 111 | $change\_assign\_user\_obj = serialize($change\_assign\_user\_value); |
  | 114 |  | $log\_values = array('proj\_id'=>~~$proj\_id,'body'=>$change\_assign\_user\_obj,'attachment\_ids'=>"",'create\_time'=>date("Y-m-d h:i:sa"),'created\_by'=>$current\_user->ID~~ ); |
  |  | 112 | $log\_values = array('proj\_id'=>esc\_sql($proj\_id),'body'=>$change\_assign\_user\_obj,'attachment\_ids'=>"",'create\_time'=>date("Y-m-d h:i:sa"),'created\_by'=>"$cu\_id" ); |
  | 115 | 113 | $wpdb->insert($wpdb->prefix . 'wppm\_project\_comment',$log\_values); |
  | 116 | 114 | $log\_id = $wpdb->insert\_id; |
  | 117 |  | $proj\_log\_values = array('proj\_id'=>~~$proj\_id,'comment\_id'=>$log\_id~~,'comment\_type'=>'change\_assign\_user'); |
  |  | 115 | $proj\_log\_values = array('proj\_id'=>esc\_sql($proj\_id),'comment\_id'=>esc\_sql($log\_id),'comment\_type'=>'change\_assign\_user'); |
  | 118 | 116 | $wpdb->insert($wpdb->prefix . 'wppm\_project\_comment\_meta',$proj\_log\_values); |
  | 119 | 117 | do\_action('wppm\_set\_project\_users', $proj\_id); |
* ## [taskbuilder/tags/3.0.7/includes/admin/projects/open\_project/wppm\_submit\_project\_comment.php](/changeset/3210469/taskbuilder/tags/3.0.7/includes/admin/projects/open_project/wppm_submit_project_comment.php "Show the changeset 3210469 restricted to taskbuilder/tags/3.0.7/includes/admin/projects/open_project/wppm_submit_project_comment.php")

  | [r3174963](/browser/taskbuilder/trunk/includes/admin/projects/open_project/wppm_submit_project_comment.php?rev=3174963#L8 "Show revision 3174963 of this file in browser") | [r3210469](/browser/taskbuilder/tags/3.0.7/includes/admin/projects/open_project/wppm_submit_project_comment.php?rev=3210469#L8 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 8 | 8 | } |
  | 9 | 9 | $proj\_id  = isset($\_POST['proj\_id']) ? intval(sanitize\_text\_field($\_POST['proj\_id'])) : '' ; |
  |  | 10 | $cu\_id = $current\_user->ID; |
  | 10 | 11 | $comment  = isset($\_POST['comment\_body']) ? ($\_POST['comment\_body']) : '' ; |
  | 11 | 12 | $allowed\_tags = array( 'br' => array(), 'abbr' => array('title' => array(),), 'p' => array(), 'strong' => array(), 'a' => array('href' => array(), 'title' => array(), 'rel'=> array(), 'target'=> array()),'em' =>array(),'span' =>array(), 'blockquote'=>array('cite'  => array(),),'div' => array('class' => array(),'title' => array(),'style' => array(),),'ul'=>array(),'li'=>array(),'ol'=>array(),'img' => array( 'alt'=> array(),'class' => array(),'height' => array(),'src'=> array(),'width'=> array(),)); |
  | […](/browser/taskbuilder/trunk/includes/admin/projects/open_project/wppm_submit_project_comment.php?rev=3174963#L31) | […](/browser/taskbuilder/tags/3.0.7/includes/admin/projects/open_project/wppm_submit_project_comment.php?rev=3210469#L32) |  |
  | 31 | 32 | 'attachment\_ids'=>$attachment\_ids, |
  | 32 | 33 | 'create\_time'=>current\_time('mysql', 1), |
  | 33 |  | 'created\_by'=>$cu~~rrent\_user->ID~~ |
  |  | 34 | 'created\_by'=>$cu\_id |
  | 34 | 35 | ); |
  | 35 | 36 | $args = apply\_filters( 'wppm\_submit\_proj\_comment\_args', $args ); |
  | 36 | 37 | $comment\_id = $wppmfunction->wppm\_submit\_proj\_comment($args); |
  | 37 |  | $proj\_log\_values = array('proj\_id'=>~~$proj\_id,'comment\_id'=>$comment\_id~~,'comment\_type'=>'comment'); |
  |  | 38 | $proj\_log\_values = array('proj\_id'=>esc\_sql($proj\_id),'comment\_id'=>esc\_sql($comment\_id),'comment\_type'=>'comment'); |
  | 38 | 39 | $wpdb->insert($wpdb->prefix . 'wppm\_project\_comment\_meta',$proj\_log\_values); |
  | 39 | 40 |  |
* ## [taskbuilder/tags/3.0.7/includes/admin/projects/open\_project/wppm\_view\_project\_tasks.php](/changeset/3210469/taskbuilder/tags/3.0.7/includes/admin/projects/open_project/wppm_view_project_tasks.php "Show the changeset 3210469 restricted to taskbuilder/tags/3.0.7/includes/admin/projects/open_project/wppm_view_project_tasks.php")

  | [r3191970](/browser/taskbuilder/trunk/includes/admin/projects/open_project/wppm_view_project_tasks.php?rev=3191970#L8 "Show revision 3191970 of this file in browser") | [r3210469](/browser/taskbuilder/tags/3.0.7/includes/admin/projects/open_project/wppm_view_project_tasks.php?rev=3210469#L8 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 8 | 8 | $totalrows\_tasks = 0; |
  | 9 | 9 | $appearance\_settings = get\_option("wppm-ap-grid-view"); |
  |  | 10 | $cu\_id = esc\_sql($current\_user->ID); |
  | 10 | 11 | $page\_no = isset($\_POST['page\_no']) ? intval(sanitize\_text\_field($\_POST['page\_no'])) : '0'; |
  | 11 | 12 | $orderby\_sql = esc\_sql(sanitize\_sql\_orderby( "load\_order ASC" )); |
  | 12 |  | $task\_status = $wpdb->get\_results( "SELECT \* FROM {$wpdb->prefix}wppm\_task\_statuses ORDER BY ~~'$orderby\_sql'~~ " ); |
  |  | 13 | $task\_status = $wpdb->get\_results( "SELECT \* FROM {$wpdb->prefix}wppm\_task\_statuses ORDER BY $orderby\_sql " ); |
  | 13 | 14 | $wppm\_task\_time = get\_option('wppm\_task\_time'); |
  | 14 | 15 | $search\_tag = isset($\_POST['task\_search']) ? sanitize\_text\_field($\_POST['task\_search']) : ''; |
  | […](/browser/taskbuilder/trunk/includes/admin/projects/open_project/wppm_view_project_tasks.php?rev=3191970#L43) | […](/browser/taskbuilder/tags/3.0.7/includes/admin/projects/open_project/wppm_view_project_tasks.php?rev=3210469#L44) |  |
  | 43 | 44 | } |
  | 44 | 45 | }else{ |
  | 45 |  | $where =  " where ((FIND\_IN\_SET($current\_user->ID,proj.users)) OR (proj.id = proj\_meta.project\_id AND proj\_meta.meta\_key='public\_project' AND proj\_meta.meta\_value=1) OR ( proj.created\_by='$cu~~rrent\_user->ID~~')) $wppm\_proj\_attr Group by proj.id ORDER BY '$santitize\_order\_by'"; |
  |  | 46 | $where =  " where ((FIND\_IN\_SET($current\_user->ID,proj.users)) OR (proj.id = proj\_meta.project\_id AND proj\_meta.meta\_key='public\_project' AND proj\_meta.meta\_value=1) OR ( proj.created\_by='$cu\_id')) $wppm\_proj\_attr Group by proj.id ORDER BY '$santitize\_order\_by'"; |
  | 46 | 47 | } |
  | 47 | 48 | $where = apply\_filters('wppm\_project\_filter\_in\_task\_list\_grid\_view\_where',$where); |
  | […](/browser/taskbuilder/trunk/includes/admin/projects/open_project/wppm_view_project_tasks.php?rev=3191970#L81) | […](/browser/taskbuilder/tags/3.0.7/includes/admin/projects/open_project/wppm_view_project_tasks.php?rev=3210469#L82) |  |
  | 81 | 82 | } |
  | 82 | 83 | if($proj\_filter!=0){ |
  | 83 |  | $wppm\_task\_by\_proj\_filter = "Task.project = ~~$proj\_filter~~"; |
  |  | 84 | $wppm\_task\_by\_proj\_filter = "Task.project = ".esc\_sql($proj\_filter).""; |
  | 84 | 85 | }else{ |
  | 85 | 86 | $wppm\_task\_by\_proj\_filter ="1=1"; |
  | […](/browser/taskbuilder/trunk/includes/admin/projects/open_project/wppm_view_project_tasks.php?rev=3191970#L112) | […](/browser/taskbuilder/tags/3.0.7/includes/admin/projects/open_project/wppm_view_project_tasks.php?rev=3210469#L113) |  |
  | 112 | 113 | "); |
  | 113 | 114 | $no\_of\_rows = ( "SELECT count(\*) FROM ($query"); |
  | 114 |  | $where = " where $wppm\_tl\_filter AND $wppm\_task\_by\_proj\_filter AND (((FIND\_IN\_SET('$current\_user->ID',Task.users)>0) OR (Task.created\_by= '$cu~~rrent\_user->ID') OR (proj\_users.user\_id = '$current\_user->ID' AND proj\_users.role\_id = 1 AND (FIND\_IN\_SET('$current\_user->ID',proj.users)>0)) OR (Task.project = proj\_meta.project\_id AND proj\_meta.meta\_key='public\_project' AND proj\_meta.meta\_value=1) OR proj.created\_by='$current\_user->ID~~') AND (Task.task\_name LIKE '$search\_tag\_text' OR proj.project\_name LIKE '$search\_tag\_text' OR task\_statuses.name LIKE '$search\_tag\_text' OR task\_priorities.name LIKE '$search\_tag\_text' OR user.display\_name LIKE '$search\_tag\_text')) AND Task.status= '$status\_id'"; |
  |  | 115 | $where = " where $wppm\_tl\_filter AND $wppm\_task\_by\_proj\_filter AND (((FIND\_IN\_SET('$current\_user->ID',Task.users)>0) OR (Task.created\_by= '$cu\_id') OR (proj\_users.user\_id = '$cu\_id' AND proj\_users.role\_id = 1 AND (FIND\_IN\_SET('$current\_user->ID',proj.users)>0)) OR (Task.project = proj\_meta.project\_id AND proj\_meta.meta\_key='public\_project' AND proj\_meta.meta\_value=1) OR proj.created\_by='$cu\_id') AND (Task.task\_name LIKE '$search\_tag\_text' OR proj.project\_name LIKE '$search\_tag\_text' OR task\_statuses.name LIKE '$search\_tag\_text' OR task\_priorities.name LIKE '$search\_tag\_text' OR user.display\_name LIKE '$search\_tag\_text')) AND Task.status= '$status\_id'"; |
  | 115 | 116 | } |
  | 116 | 117 | }else{ |
  | […](/browser/taskbuilder/trunk/includes/admin/projects/open_project/wppm_view_project_tasks.php?rev=3191970#L130) | […](/browser/taskbuilder/tags/3.0.7/includes/admin/projects/open_project/wppm_view_project_tasks.php?rev=3210469#L131) |  |
  | 130 | 131 | "); |
  | 131 | 132 | $no\_of\_rows = ( "SELECT count(\*) FROM ($query"); |
  | 132 |  | $where = " where $wppm\_tl\_filter AND $wppm\_task\_by\_proj\_filter AND ((FIND\_IN\_SET('$current\_user->ID',Task.users)>0) OR (Task.created\_by= '$cu~~rrent\_user->ID') OR (proj\_users.user\_id = '$current\_user->ID' AND proj\_users.role\_id = 1 AND (FIND\_IN\_SET('$current\_user->ID',proj.users)>0)) OR (Task.project = proj\_meta.project\_id AND proj\_meta.meta\_key='public\_project' AND proj\_meta.meta\_value=1) OR proj.created\_by='$current\_user->ID~~') AND Task.status= '$status\_id'"; |
  |  | 133 | $where = " where $wppm\_tl\_filter AND $wppm\_task\_by\_proj\_filter AND ((FIND\_IN\_SET('$current\_user->ID',Task.users)>0) OR (Task.created\_by= '$cu\_id') OR (proj\_users.user\_id = '$cu\_id' AND proj\_users.role\_id = 1 AND (FIND\_IN\_SET('$current\_user->ID',proj.users)>0)) OR (Task.project = proj\_meta.project\_id AND proj\_meta.meta\_key='public\_project' AND proj\_meta.meta\_value=1) OR proj.created\_by='$cu\_id') AND Task.status= '$status\_id'"; |
  | 133 | 134 | } |
  | 134 | 135 | } |
  | […](/browser/taskbuilder/trunk/includes/admin/projects/open_project/wppm_view_project_tasks.php?rev=3191970#L169) | […](/browser/taskbuilder/tags/3.0.7/includes/admin/projects/open_project/wppm_view_project_tasks.php?rev=3210469#L170) |  |
  | 169 | 170 | $tusers =  $val\_array['users']; |
  | 170 | 171 | $tusers\_arr = explode(',',$tusers); |
  | 171 |  | $tproject\_id = ~~$val\_array['project']~~; |
  |  | 172 | $tproject\_id = esc\_sql($val\_array['project']); |
  | 172 | 173 | if(!empty($tusers) && in\_array($current\_user->ID,$tusers\_arr)){ |
  | 173 |  | $project\_user\_role = $wpdb->get\_var("SELECT role\_id FROM {$wpdb->prefix}wppm\_project\_users WHERE proj\_id = '$tproject\_id' AND user\_id = '$cu~~rrent\_user->ID~~'"); |
  |  | 174 | $project\_user\_role = $wpdb->get\_var("SELECT role\_id FROM {$wpdb->prefix}wppm\_project\_users WHERE proj\_id = '$tproject\_id' AND user\_id = '$cu\_id'"); |
  | 174 | 175 | $project\_users = $wpdb->get\_var("SELECT users FROM {$wpdb->prefix}wppm\_project WHERE id = '$tproject\_id'"); |
  | 175 | 176 | $project\_users\_arr = explode(',',(string)$project\_users); |
* ## [taskbuilder/tags/3.0.7/includes/admin/projects/projects\_list.php](/changeset/3210469/taskbuilder/tags/3.0.7/includes/admin/projects/projects_list.php "Show the changeset 3210469 restricted to taskbuilder/tags/3.0.7/includes/admin/projects/projects_list.php")

  | [r3174963](/browser/taskbuilder/trunk/includes/admin/projects/projects_list.php?rev=3174963#L16 "Show revision 3174963 of this file in browser") | [r3210469](/browser/taskbuilder/tags/3.0.7/includes/admin/projects/projects_list.php?rev=3210469#L16 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 16 | 16 | $current\_date = date('Y-m-d'); |
  | 17 | 17 | $wppm\_pl\_filter = "1=1"; |
  |  | 18 | $cu\_id = esc\_sql($current\_user->ID); |
  | 18 | 19 | $filters = array( |
  | 19 | 20 | 'sort\_by' => $sort\_by, |
  | […](/browser/taskbuilder/trunk/includes/admin/projects/projects_list.php?rev=3174963#L90) | […](/browser/taskbuilder/tags/3.0.7/includes/admin/projects/projects_list.php?rev=3210469#L91) |  |
  | 90 | 91 | $where = " where $wppm\_pl\_filter AND (Project.project\_name LIKE '$search\_tag\_text' OR proj\_statuses.name LIKE '$search\_tag\_text' OR proj\_categories.name LIKE '$search\_tag\_text' OR ( user.display\_name LIKE '$search\_tag\_text'))"; |
  | 91 | 92 | }else{ |
  | 92 |  | $where = " where $wppm\_pl\_filter AND (Project.project\_name LIKE '$search\_tag\_text' OR proj\_statuses.name LIKE '$search\_tag\_text' OR proj\_categories.name LIKE '$search\_tag\_text' OR ( user.display\_name LIKE '$search\_tag\_text')) AND ((FIND\_IN\_SET('$current\_user->ID',Project.users)>0) OR (Project.id = proj\_meta.project\_id AND proj\_meta.meta\_key='public\_project' AND proj\_meta.meta\_value=1) OR Project.created\_by='$cu~~rrent\_user->ID~~')"; |
  |  | 93 | $where = " where $wppm\_pl\_filter AND (Project.project\_name LIKE '$search\_tag\_text' OR proj\_statuses.name LIKE '$search\_tag\_text' OR proj\_categories.name LIKE '$search\_tag\_text' OR ( user.display\_name LIKE '$search\_tag\_text')) AND ((FIND\_IN\_SET('$current\_user->ID',Project.users)>0) OR (Project.id = proj\_meta.project\_id AND proj\_meta.meta\_key='public\_project' AND proj\_meta.meta\_value=1) OR Project.created\_by='$cu\_id')"; |
  | 93 | 94 | } |
  | 94 | 95 | }else{ |
  | […](/browser/taskbuilder/trunk/includes/admin/projects/projects_list.php?rev=3174963#L107) | […](/browser/taskbuilder/tags/3.0.7/includes/admin/projects/projects_list.php?rev=3210469#L108) |  |
  | 107 | 108 | $where =  " where $wppm\_pl\_filter"; |
  | 108 | 109 | }else{ |
  | 109 |  | $where = " where ($wppm\_pl\_filter AND (FIND\_IN\_SET('$current\_user->ID',Project.users)>0 OR (Project.id = proj\_meta.project\_id AND proj\_meta.meta\_key='public\_project' AND proj\_meta.meta\_value=1)) OR Project.created\_by='$cu~~rrent\_user->ID~~')"; |
  |  | 110 | $where = " where ($wppm\_pl\_filter AND (FIND\_IN\_SET('$current\_user->ID',Project.users)>0 OR (Project.id = proj\_meta.project\_id AND proj\_meta.meta\_key='public\_project' AND proj\_meta.meta\_value=1)) OR Project.created\_by='$cu\_id')"; |
  | 110 | 111 | } |
  | 111 | 112 | } |
  | […](/browser/taskbuilder/trunk/includes/admin/projects/projects_list.php?rev=3174963#L113) | […](/browser/taskbuilder/tags/3.0.7/includes/admin/projects/projects_list.php?rev=3210469#L114) |  |
  | 113 | 114 | $no\_of\_rows = apply\_filters('wppm\_project\_list\_no\_of\_rows',$no\_of\_rows,$wppm\_pl\_filter,$search\_tag); |
  | 114 | 115 | $where = apply\_filters('wppm\_project\_list\_query\_where',$where, $wppm\_pl\_filter,$search\_tag); |
  |  | 116 | $sort\_by = esc\_sql($sort\_by); |
  |  | 117 | $order = esc\_sql($order); |
  | 115 | 118 | $query .= $where." Group by Project.id ORDER BY $sort\_by $order"; |
  | 116 | 119 | $no\_of\_rows .= $where." Group by Project.id) AS Project"; |
  | […](/browser/taskbuilder/trunk/includes/admin/projects/projects_list.php?rev=3174963#L195) | […](/browser/taskbuilder/tags/3.0.7/includes/admin/projects/projects_list.php?rev=3210469#L198) |  |
  | 195 | 198 | <table id="wppm\_project\_table" class="wppm\_table table"> |
  | 196 | 199 | <tr> |
  | 197 |  | <th ~~style="width: 45px;"~~  onchange="wppm\_bulk\_select\_change()"> |
  |  | 200 | <th class="wppm\_table\_header" style="background-color:<?php echo esc\_attr($appearance\_settings['list-header-background-color'])?>" onchange="wppm\_bulk\_select\_change()"> |
  | 198 | 201 | <div class="checkbox-container"> |
  | 199 | 202 | <input id="wppm\_bulk\_select\_option" class="wppm-bulk-selector" type="checkbox" onchange="wppm\_bulk\_select\_change();"/> |
  | […](/browser/taskbuilder/trunk/includes/admin/projects/projects_list.php?rev=3174963#L259) | […](/browser/taskbuilder/tags/3.0.7/includes/admin/projects/projects_list.php?rev=3210469#L262) |  |
  | 259 | 262 | Left join {$wpdb->prefix}wppm\_project\_users proj\_users ON Task.project = proj\_users.proj\_id |
  | 260 | 263 | Left join {$wpdb->prefix}wppm\_project\_meta proj\_meta ON proj.id = proj\_meta.project\_id |
  | 261 |  | where Task.project = '$pid' AND ((FIND\_IN\_SET('$current\_user->ID',Task.users)>0) OR (Task.created\_by= '$cu~~rrent\_user->ID') OR (proj\_users.user\_id = '$current\_user->ID' AND proj\_users.role\_id = 1 ) OR (proj.id = proj\_meta.project\_id AND proj\_meta.meta\_key='public\_project' AND proj\_meta.meta\_value=1) OR ( Task.project = proj.id AND proj.created\_by='$current\_user->ID~~')) Group by Task.id ) AS Task"); |
  |  | 264 | where Task.project = '$pid' AND ((FIND\_IN\_SET('$current\_user->ID',Task.users)>0) OR (Task.created\_by= '$cu\_id') OR (proj\_users.user\_id = '$cu\_id' AND proj\_users.role\_id = 1 ) OR (proj.id = proj\_meta.project\_id AND proj\_meta.meta\_key='public\_project' AND proj\_meta.meta\_value=1) OR ( Task.project = proj.id AND proj.created\_by='$cu\_id')) Group by Task.id ) AS Task"); |
  | 262 | 265 | $no\_of\_tasks = $wpdb->get\_var($query); |
  | 263 | 266 | } |
* ## [taskbuilder/tags/3.0.7/includes/admin/projects/wppm\_add\_new\_project.php](/changeset/3210469/taskbuilder/tags/3.0.7/includes/admin/projects/wppm_add_new_project.php "Show the changeset 3210469 restricted to taskbuilder/tags/3.0.7/includes/admin/projects/wppm_add_new_project.php")

  | [r3174963](/browser/taskbuilder/trunk/includes/admin/projects/wppm_add_new_project.php?rev=3174963#L9 "Show revision 3174963 of this file in browser") | [r3210469](/browser/taskbuilder/tags/3.0.7/includes/admin/projects/wppm_add_new_project.php?rev=3210469#L9 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 9 | 9 | $wppm\_public\_projects\_permission = get\_option('wppm\_public\_projects\_permission'); |
  | 10 | 10 | $orderby\_sql       = sanitize\_sql\_orderby("name"); |
  | 11 |  | $categories = $wpdb->get\_results( "SELECT \* FROM {$wpdb->prefix}wppm\_project\_categories ORDER BY ~~".$orderby\_sql~~ ); |
  |  | 11 | $categories = $wpdb->get\_results( "SELECT \* FROM {$wpdb->prefix}wppm\_project\_categories ORDER BY $orderby\_sql" ); |
  | 12 | 12 | $wppm\_current\_user\_capability = get\_user\_meta( $current\_user->ID, 'wppm\_capability', true ); |
  | 13 | 13 | ?> |
* ## [taskbuilder/tags/3.0.7/includes/admin/projects/wppm\_filter\_autocomplete.php](/changeset/3210469/taskbuilder/tags/3.0.7/includes/admin/projects/wppm_filter_autocomplete.php "Show the changeset 3210469 restricted to taskbuilder/tags/3.0.7/includes/admin/projects/wppm_filter_autocomplete.php")

  | [r3191970](/browser/taskbuilder/trunk/includes/admin/projects/wppm_filter_autocomplete.php?rev=3191970#L56 "Show revision 3191970 of this file in browser") | [r3210469](/browser/taskbuilder/tags/3.0.7/includes/admin/projects/wppm_filter_autocomplete.php?rev=3210469#L56 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 56 | 56 | if($field\_slug == 'task\_users\_by\_project\_name'){ |
  | 57 | 57 | $project\_id = esc\_sql($project\_id); |
  |  | 58 | $cu\_id = esc\_sql($current\_user->ID); |
  | 58 | 59 | $wppm\_fillter = $wpdb->get\_var( "SELECT users FROM {$wpdb->prefix}wppm\_project where id = '$project\_id'" ); |
  | 59 | 60 | $project\_creator = $wpdb->get\_var( "SELECT created\_by FROM {$wpdb->prefix}wppm\_project where id = '$project\_id'" ); |
  | 60 | 61 | $users = get\_users(array('search'=>'\*'.$term.'\*','number' => 5)); |
  | 61 | 62 | $users = apply\_filters("wppm\_filter\_autocomplete\_task\_users\_by\_project\_name",$users,$field\_slug,$term,$task\_id,$project\_id); |
  | 62 |  | $project\_user\_role = $wpdb->get\_var("SELECT role\_id FROM {$wpdb->prefix}wppm\_project\_users WHERE proj\_id = '$project\_id' AND user\_id = '$cu~~rrent\_user->ID~~'"); |
  |  | 63 | $project\_user\_role = $wpdb->get\_var("SELECT role\_id FROM {$wpdb->prefix}wppm\_project\_users WHERE proj\_id = '$project\_id' AND user\_id = '$cu\_id'"); |
  | 63 | 64 | $users\_array = explode(",",(string)$wppm\_fillter); |
  | 64 | 65 | $wppm\_current\_user\_capability = get\_user\_meta( $current\_user->ID, 'wppm\_capability', true ); |
* ## [taskbuilder/tags/3.0.7/includes/admin/projects/wppm\_get\_delete\_project.php](/changeset/3210469/taskbuilder/tags/3.0.7/includes/admin/projects/wppm_get_delete_project.php "Show the changeset 3210469 restricted to taskbuilder/tags/3.0.7/includes/admin/projects/wppm_get_delete_project.php")

  | [r3174963](/browser/taskbuilder/trunk/includes/admin/projects/wppm_get_delete_project.php?rev=3174963#L5 "Show revision 3174963 of this file in browser") | [r3210469](/browser/taskbuilder/tags/3.0.7/includes/admin/projects/wppm_get_delete_project.php?rev=3210469#L5 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 5 | 5 | global $current\_user,$wppmfunction,$wpdb; |
  | 6 | 6 | $id = isset($\_POST['id']) ? intval(sanitize\_text\_field($\_POST['id'])) : '0'; |
  | 7 |  | $project = $wpdb->get\_row( "SELECT \* FROM {$wpdb->prefix}wppm\_project where id = '~~$id'"~~ ); |
  |  | 7 | $project = $wpdb->get\_row( "SELECT \* FROM {$wpdb->prefix}wppm\_project where id = '".esc\_sql($id)."'"); |
  | 8 | 8 | $wppm\_current\_user\_capability = get\_user\_meta( $current\_user->ID, 'wppm\_capability', true ); |
  | 9 | 9 | if (!(($current\_user->ID && $current\_user->has\_cap('manage\_options')) || $wppmfunction->has\_project\_permission('delete\_project',$id) || ($project->created\_by==$current\_user->ID && $wppm\_current\_user\_capability == 'wppm\_manager') || ($current\_user->ID && $current\_user->has\_cap('wppm\_admin')))) {exit;} |
* ## [taskbuilder/tags/3.0.7/includes/admin/projects/wppm\_open\_project.php](/changeset/3210469/taskbuilder/tags/3.0.7/includes/admin/projects/wppm_open_project.php "Show the changeset 3210469 restricted to taskbuilder/tags/3.0.7/includes/admin/projects/wppm_open_project.php")

  | [r3174963](/browser/taskbuilder/trunk/includes/admin/projects/wppm_open_project.php?rev=3174963#L16 "Show revision 3174963 of this file in browser") | [r3210469](/browser/taskbuilder/tags/3.0.7/includes/admin/projects/wppm_open_project.php?rev=3210469#L16 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 16 | 16 | $auth\_id = $wppmfunction->get\_project\_meta($id,'project\_auth\_code',true); |
  | 17 | 17 | $auth\_id = sanitize\_text\_field($auth\_id); |
  | 18 |  | $project = $wpdb->get\_row( "SELECT \* FROM {$wpdb->prefix}wppm\_project where id = ~~$id~~" ); |
  | 19 |  | $orderby\_sql = ~~sanitize\_sql\_orderby("create\_time DESC"~~); |
  | 20 |  | $project\_comment = $wpdb->get\_results( "SELECT \* FROM {$wpdb->prefix}wppm\_project\_comment where proj\_id=~~"."$id"." ORDER BY ".$orderby\_sql~~); |
  |  | 18 | $project = $wpdb->get\_row( "SELECT \* FROM {$wpdb->prefix}wppm\_project where id = '".esc\_sql($id)."'" ); |
  |  | 19 | $orderby\_sql = esc\_sql(sanitize\_sql\_orderby("create\_time DESC")); |
  |  | 20 | $project\_comment = $wpdb->get\_results( "SELECT \* FROM {$wpdb->prefix}wppm\_project\_comment where proj\_id='".esc\_sql($id)."' ORDER BY $orderby\_sql"); |
  | 21 | 21 | if(isset($project->users)){ |
  | 22 | 22 | $users = explode(",",$project->users); |
  | […](/browser/taskbuilder/trunk/includes/admin/projects/wppm_open_project.php?rev=3174963#L27) | […](/browser/taskbuilder/tags/3.0.7/includes/admin/projects/wppm_open_project.php?rev=3210469#L27) |  |
  | 27 | 27 | if(isset($project->status)){ |
  | 28 | 28 | $projstatus = esc\_sql($project->status); |
  | 29 |  | $project\_status = $wpdb->get\_row("SELECT \* FROM {$wpdb->prefix}wppm\_project\_statuses where id = ~~$projstatus~~"); |
  |  | 29 | $project\_status = $wpdb->get\_row("SELECT \* FROM {$wpdb->prefix}wppm\_project\_statuses where id = '$projstatus'"); |
  | 30 | 30 | } |
  | 31 | 31 | if(isset($project->cat\_id)){ |
  | 32 | 32 | $projcat = esc\_sql($project->cat\_id); |
  | 33 |  | $project\_category = $wpdb->get\_row("SELECT \* FROM {$wpdb->prefix}wppm\_project\_categories where id = ~~$projcat~~"); |
  |  | 33 | $project\_category = $wpdb->get\_row("SELECT \* FROM {$wpdb->prefix}wppm\_project\_categories where id = '$projcat'"); |
  | 34 | 34 | } |
  | 35 | 35 | if(!empty($project->description)){ |
  | […](/browser/taskbuilder/trunk/includes/admin/projects/wppm_open_project.php?rev=3174963#L162) | […](/browser/taskbuilder/tags/3.0.7/includes/admin/projects/wppm_open_project.php?rev=3210469#L162) |  |
  | 162 | 162 | if(!empty($project\_comment)){ |
  | 163 | 163 | foreach($project\_comment as $comment){ |
  | 164 |  | $proj\_comment\_meta = $wpdb->get\_row( "SELECT \* FROM {$wpdb->prefix}wppm\_project\_comment\_meta where proj\_id=~~".$id." AND comment\_id=".esc\_sql($comment->id)."~~"); |
  |  | 164 | $proj\_comment\_meta = $wpdb->get\_row( "SELECT \* FROM {$wpdb->prefix}wppm\_project\_comment\_meta where proj\_id='".esc\_sql($id)."' AND comment\_id='".esc\_sql($comment->id)."'"); |
  | 165 | 165 | $user = get\_userdata( $comment->created\_by ); |
  | 166 | 166 | $comment\_body = stripslashes((htmlspecialchars\_decode($comment->body, ENT\_QUOTES))); |
  | […](/browser/taskbuilder/trunk/includes/admin/projects/wppm_open_project.php?rev=3174963#L284) | […](/browser/taskbuilder/tags/3.0.7/includes/admin/projects/wppm_open_project.php?rev=3210469#L284) |  |
  | 284 | 284 | if(!empty($attachments)){ |
  | 285 | 285 | foreach( $attachments as $attachment ): |
  |  | 286 | $download\_url = site\_url('/').'?wppm\_attachment='.$attachment.'&pid='.$id.'&pac='.$auth\_id; |
  | 286 | 287 | $attachment = esc\_sql($attachment); |
  | 287 | 288 | $attach = $wpdb->get\_row( "SELECT \* FROM {$wpdb->prefix}wppm\_attachments where id='$attachment'"); |
  | 288 |  | ~~$download\_url = site\_url('/').'?wppm\_attachment='.$attachment.'&pid='.$id.'&pac='.$auth\_id;~~ |
  | 289 | 289 | $findStr = ".txt"; |
  | 290 | 290 | if(!empty( $attach)){ |
  | […](/browser/taskbuilder/trunk/includes/admin/projects/wppm_open_project.php?rev=3174963#L367) | […](/browser/taskbuilder/tags/3.0.7/includes/admin/projects/wppm_open_project.php?rev=3210469#L367) |  |
  | 367 | 367 | $user\_data = get\_userdata($user); |
  | 368 | 368 | $user = esc\_sql($user); |
  | 369 |  | $project\_user = $wpdb->get\_row("SELECT \* FROM {$wpdb->prefix}wppm\_project\_users WHERE proj\_id = '~~$id~~' AND user\_id = '$user'"); |
  |  | 369 | $project\_user = $wpdb->get\_row("SELECT \* FROM {$wpdb->prefix}wppm\_project\_users WHERE proj\_id = '".esc\_sql($id)."' AND user\_id = '$user'"); |
  | 370 | 370 | ?> |
  | 371 | 371 | <div style="padding:2px 0;"> |
* ## [taskbuilder/tags/3.0.7/includes/admin/projects/wppm\_set\_bulk\_change\_project\_category.php](/changeset/3210469/taskbuilder/tags/3.0.7/includes/admin/projects/wppm_set_bulk_change_project_category.php "Show the changeset 3210469 restricted to taskbuilder/tags/3.0.7/includes/admin/projects/wppm_set_bulk_change_project_category.php")

  | [r3174963](/browser/taskbuilder/trunk/includes/admin/projects/wppm_set_bulk_change_project_category.php?rev=3174963#L27 "Show revision 3174963 of this file in browser") | [r3210469](/browser/taskbuilder/tags/3.0.7/includes/admin/projects/wppm_set_bulk_change_project_category.php?rev=3210469#L27 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 27 | 27 | $change\_category\_value = array('prev\_cat'=>"$project\_data[cat\_id]",'new\_cat'=>"$proj\_category"); |
  | 28 | 28 | $change\_category\_obj = serialize($change\_category\_value); |
  | 29 |  | $log\_values = array('proj\_id'=>$proj\_id,'body'=>$change\_category\_obj,'attachment\_ids'=>"",'create\_time'=>date("Y-m-d h:i:sa"),'created\_by'=>$current\_user->ID ); |
  |  | 29 | $proj\_id = esc\_sql($proj\_id); |
  |  | 30 | $log\_values = array('proj\_id'=>"$proj\_id",'body'=>$change\_category\_obj,'attachment\_ids'=>"",'create\_time'=>date("Y-m-d h:i:sa"),'created\_by'=>esc\_sql($current\_user->ID) ); |
  | 30 | 31 | $wpdb->insert($wpdb->prefix . 'wppm\_project\_comment',$log\_values); |
  | 31 |  | $log\_id = ~~$wpdb->insert\_id~~; |
  | 32 |  | $proj\_log\_values = array('proj\_id'=>~~$proj\_id,'comment\_id'=>$log\_id~~,'comment\_type'=>'change\_proj\_cat'); |
  |  | 32 | $log\_id = esc\_sql($wpdb->insert\_id); |
  |  | 33 | $proj\_log\_values = array('proj\_id'=>"$proj\_id",'comment\_id'=>"$log\_id",'comment\_type'=>'change\_proj\_cat'); |
  | 33 | 34 | $wpdb->insert($wpdb->prefix . 'wppm\_project\_comment\_meta',$proj\_log\_values); |
  | 34 | 35 | } |
* ## [taskbuilder/tags/3.0.7/includes/admin/projects/wppm\_set\_bulk\_project\_users.php](/changeset/3210469/taskbuilder/tags/3.0.7/includes/admin/projects/wppm_set_bulk_project_users.php "Show the changeset 3210469 restricted to taskbuilder/tags/3.0.7/includes/admin/projects/wppm_set_bulk_project_users.php")

  | [r3174963](/browser/taskbuilder/trunk/includes/admin/projects/wppm_set_bulk_project_users.php?rev=3174963#L25 "Show revision 3174963 of this file in browser") | [r3210469](/browser/taskbuilder/tags/3.0.7/includes/admin/projects/wppm_set_bulk_project_users.php?rev=3210469#L25 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 25 | 25 | $prev\_assgn\_user\_meta = $wppmfunction->get\_project\_meta($proj\_id,'prev\_assigned\_users'); |
  | 26 | 26 | $wppmfunction->delete\_project\_meta($proj\_id,'prev\_assigned\_users'); |
  | 27 |  | $task\_users = $wpdb->get\_results("SELECT id,users FROM {$wpdb->prefix}wppm\_task WHERE project = ~~$proj\_id~~"); |
  |  | 27 | $task\_users = $wpdb->get\_results("SELECT id,users FROM {$wpdb->prefix}wppm\_task WHERE project = '".esc\_sql($proj\_id)."';"); |
  | 28 | 28 | if(!empty($prev\_assign\_users)) { |
  | 29 | 29 | foreach($prev\_assign\_users as $puser){ |
  | […](/browser/taskbuilder/trunk/includes/admin/projects/wppm_set_bulk_project_users.php?rev=3174963#L39) | […](/browser/taskbuilder/tags/3.0.7/includes/admin/projects/wppm_set_bulk_project_users.php?rev=3210469#L39) |  |
  | 39 | 39 | $wppmtuser = implode(',',$wppm\_tuser); |
  | 40 | 40 | $value=array( |
  | 41 |  | 'users'=>  ~~$wppmtuser~~ |
  |  | 41 | 'users'=>  esc\_sql($wppmtuser) |
  | 42 | 42 | ); |
  | 43 | 43 | } elseif(empty($wppm\_tuser)){ |
  | […](/browser/taskbuilder/trunk/includes/admin/projects/wppm_set_bulk_project_users.php?rev=3174963#L46) | […](/browser/taskbuilder/tags/3.0.7/includes/admin/projects/wppm_set_bulk_project_users.php?rev=3210469#L46) |  |
  | 46 | 46 | ); |
  | 47 | 47 | } |
  | 48 |  | $wpdb->update($wpdb->prefix.'wppm\_task', $value, array('id'=>~~$tuser->id~~)); |
  |  | 48 | $wpdb->update($wpdb->prefix.'wppm\_task', $value, array('id'=>esc\_sql($tuser->id))); |
  | 49 | 49 | } |
  | 50 | 50 | } |
  | […](/browser/taskbuilder/trunk/includes/admin/projects/wppm_set_bulk_project_users.php?rev=3174963#L61) | […](/browser/taskbuilder/tags/3.0.7/includes/admin/projects/wppm_set_bulk_project_users.php?rev=3210469#L61) |  |
  | 61 | 61 | $wppmtuser = implode(',',$wppm\_tuser); |
  | 62 | 62 | $value=array( |
  | 63 |  | 'users'=> ~~$wppmtuser~~ |
  |  | 63 | 'users'=> esc\_sql($wppmtuser) |
  | 64 | 64 | ); |
  | 65 | 65 | } elseif(empty($wppm\_tuser)){ |
  | […](/browser/taskbuilder/trunk/includes/admin/projects/wppm_set_bulk_project_users.php?rev=3174963#L68) | […](/browser/taskbuilder/tags/3.0.7/includes/admin/projects/wppm_set_bulk_project_users.php?rev=3210469#L68) |  |
  | 68 | 68 | ); |
  | 69 | 69 | } |
  | 70 |  | $wpdb->update($wpdb->prefix.'wppm\_task', $value, array('id'=>~~$tuser->id~~)); |
  |  | 70 | $wpdb->update($wpdb->prefix.'wppm\_task', $value, array('id'=>esc\_sql($tuser->id))); |
  | 71 | 71 | } |
  | 72 | 72 | } |
  | […](/browser/taskbuilder/trunk/includes/admin/projects/wppm_set_bulk_project_users.php?rev=3174963#L79) | […](/browser/taskbuilder/tags/3.0.7/includes/admin/projects/wppm_set_bulk_project_users.php?rev=3210469#L79) |  |
  | 79 | 79 | foreach($users as $user){ |
  | 80 | 80 | $user\_role = sanitize\_text\_field($\_POST['wppm\_select\_user\_role\_'.$user]); |
  | 81 |  | $project\_user = $wpdb->get\_row("SELECT \* FROM {$wpdb->prefix}wppm\_project\_users WHERE proj\_id = '~~$proj\_id' AND user\_id = '$user~~'"); |
  |  | 81 | $project\_user = $wpdb->get\_row("SELECT \* FROM {$wpdb->prefix}wppm\_project\_users WHERE proj\_id = '".esc\_sql($proj\_id)."' AND user\_id = '". esc\_sql( $user)."'"); |
  | 82 | 82 | if(!empty($project\_user)){ |
  | 83 | 83 | $values=array( |
  | 84 |  | 'role\_id'=> ~~$user\_role~~, |
  | 85 |  | 'assigned\_by'=> ~~$current\_user->ID~~ |
  |  | 84 | 'role\_id'=> esc\_sql($user\_role), |
  |  | 85 | 'assigned\_by'=> esc\_sql($current\_user->ID) |
  | 86 | 86 | ); |
  | 87 |  | $wpdb->update($wpdb->prefix.'wppm\_project\_users', $values, array('id'=>~~$project\_user->id~~)); |
  |  | 87 | $wpdb->update($wpdb->prefix.'wppm\_project\_users', $values, array('id'=>esc\_sql($project\_user->id))); |
  | 88 | 88 | }else{ |
  | 89 | 89 | $wpdb->insert( |
  | 90 | 90 | $wpdb->prefix . 'wppm\_project\_users', |
  | 91 | 91 | array( |
  | 92 |  | 'proj\_id' => ~~$proj\_id~~, |
  | 93 |  | 'user\_id' => ~~$user~~, |
  | 94 |  | 'role\_id' => ~~$user\_role~~, |
  | 95 |  | 'assigned\_by' => ~~$current\_user->ID~~ |
  |  | 92 | 'proj\_id' => esc\_sql($proj\_id), |
  |  | 93 | 'user\_id' => esc\_sql($user), |
  |  | 94 | 'role\_id' => esc\_sql($user\_role), |
  |  | 95 | 'assigned\_by' => esc\_sql($current\_user->ID) |
  | 96 | 96 | ) ); |
  | 97 | 97 | } |
  | […](/browser/taskbuilder/trunk/includes/admin/projects/wppm_set_bulk_project_users.php?rev=3174963#L100) | […](/browser/taskbuilder/tags/3.0.7/includes/admin/projects/wppm_set_bulk_project_users.php?rev=3210469#L100) |  |
  | 100 | 100 | if($project\_data['users'] != $pusers){ |
  | 101 | 101 | $pvalues=array( |
  | 102 |  | 'users'=> ~~$pusers~~ |
  |  | 102 | 'users'=> esc\_sql($pusers) |
  | 103 | 103 | ); |
  | 104 |  | $wpdb->update($wpdb->prefix.'wppm\_project', $pvalues, array('id'=>~~$proj\_id~~)); |
  |  | 104 | $wpdb->update($wpdb->prefix.'wppm\_project', $pvalues, array('id'=>esc\_sql($proj\_id))); |
  | 105 | 105 | } |
  | 106 | 106 | } |
  | […](/browser/taskbuilder/trunk/includes/admin/projects/wppm_set_bulk_project_users.php?rev=3174963#L109) | […](/browser/taskbuilder/tags/3.0.7/includes/admin/projects/wppm_set_bulk_project_users.php?rev=3210469#L109) |  |
  | 109 | 109 | 'users'=>'' |
  | 110 | 110 | ); |
  | 111 |  | $wpdb->update($wpdb->prefix.'wppm\_project', $pvalues, array('id'=>~~$proj\_id~~)); |
  |  | 111 | $wpdb->update($wpdb->prefix.'wppm\_project', $pvalues, array('id'=>esc\_sql($proj\_id))); |
  | 112 | 112 | } |
  | 113 | 113 | $change\_assign\_user\_value = array('prev\_assign\_user'=>"$project\_data[users]",'new\_assign\_user'=>"$pusers"); |
  | 114 | 114 | $change\_assign\_user\_obj = serialize($change\_assign\_user\_value); |
  | 115 |  | $log\_values = array('proj\_id'=>~~$proj\_id,'body'=>$change\_assign\_user\_obj,'attachment\_ids'=>"",'create\_time'=>date("Y-m-d h:i:sa"),'created\_by'=>$current\_user->ID~~ ); |
  |  | 115 | $log\_values = array('proj\_id'=>esc\_sql($proj\_id),'body'=>$change\_assign\_user\_obj,'attachment\_ids'=>"",'create\_time'=>date("Y-m-d h:i:sa"),'created\_by'=>esc\_sql($current\_user->ID)); |
  | 116 | 116 | $wpdb->insert($wpdb->prefix . 'wppm\_project\_comment',$log\_values); |
  | 117 |  | $log\_id = ~~$wpdb->insert\_id~~; |
  | 118 |  | $proj\_log\_values = array('proj\_id'=>~~$proj\_id~~,'comment\_id'=>$log\_id,'comment\_type'=>'change\_assign\_user'); |
  |  | 117 | $log\_id = esc\_sql($wpdb->insert\_id); |
  |  | 118 | $proj\_log\_values = array('proj\_id'=>esc\_sql($proj\_id),'comment\_id'=>$log\_id,'comment\_type'=>'change\_assign\_user'); |
  | 119 | 119 | $wpdb->insert($wpdb->prefix . 'wppm\_project\_comment\_meta',$proj\_log\_values); |
  | 120 | 120 | do\_action('wppm\_set\_bulk\_project\_users', $proj\_id); |
* ## [taskbuilder/tags/3.0.7/includes/admin/projects/wppm\_set\_delete\_bulk\_projects.php](/changeset/3210469/taskbuilder/tags/3.0.7/includes/admin/projects/wppm_set_delete_bulk_projects.php "Show the changeset 3210469 restricted to taskbuilder/tags/3.0.7/includes/admin/projects/wppm_set_delete_bulk_projects.php")

  | [r3174963](/browser/taskbuilder/trunk/includes/admin/projects/wppm_set_delete_bulk_projects.php?rev=3174963#L16 "Show revision 3174963 of this file in browser") | [r3210469](/browser/taskbuilder/tags/3.0.7/includes/admin/projects/wppm_set_delete_bulk_projects.php?rev=3210469#L16 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 16 | 16 | $project\_data = $wppmfunction->get\_project($proj\_id); |
  | 17 | 17 | if ((($current\_user->ID && $current\_user->has\_cap('manage\_options')) || $wppmfunction->has\_project\_permission('delete\_project',$proj\_id) || ($project\_data['created\_by']==$current\_user->ID && $wppm\_current\_user\_capability == 'wppm\_manager') || ($current\_user->ID && $current\_user->has\_cap('wppm\_admin')))) { |
  | 18 |  | $tasks = $wpdb->get\_results("SELECT \* FROM {$wpdb->prefix}wppm\_task where project = ~~$proj\_id~~"); |
  |  | 18 | $tasks = $wpdb->get\_results("SELECT \* FROM {$wpdb->prefix}wppm\_task where project = '".esc\_sql($proj\_id)."'"); |
  | 19 | 19 | /\*\*\*\*\*\*\*\*\*\*\*\*\*delete project\*\*\*\*\*\*\*\*/ |
  | 20 | 20 | $wpdb->delete($wpdb->prefix.'wppm\_project',array('id'=>$proj\_id)); |
  | 21 | 21 | /\*\*\*\*\*\*\*\*\*\*\*\*\*delete project comment\*\*\*\*\*\*\*\*/ |
  | 22 |  | $sql="SELECT attachment\_ids FROM {$wpdb->prefix}wppm\_project\_comment WHERE proj\_id =~~".$proj\_id~~; |
  |  | 22 | $sql="SELECT attachment\_ids FROM {$wpdb->prefix}wppm\_project\_comment WHERE proj\_id ='".esc\_sql($proj\_id)."'"; |
  | 23 | 23 | $proj\_comm\_attachment\_ids= $wpdb->get\_results( $sql ); |
  | 24 | 24 | if(!empty($proj\_comm\_attachment\_ids)){ |
  | […](/browser/taskbuilder/trunk/includes/admin/projects/wppm_set_delete_bulk_projects.php?rev=3174963#L29) | […](/browser/taskbuilder/tags/3.0.7/includes/admin/projects/wppm_set_delete_bulk_projects.php?rev=3210469#L29) |  |
  | 29 | 29 | } |
  | 30 | 30 | foreach ($proj\_attachment\_ids\_temp as $proj\_attachment\_id){ |
  | 31 |  | $sql="SELECT \* FROM {$wpdb->prefix}wppm\_attachments WHERE id =~~".$proj\_attachment\_id~~; |
  |  | 31 | $sql="SELECT \* FROM {$wpdb->prefix}wppm\_attachments WHERE id ='".esc\_sql($proj\_attachment\_id)."'"; |
  | 32 | 32 | $att\_result=$wpdb->get\_row($sql); |
  | 33 | 33 | if(!empty($att\_result)){ |
  | 34 |  | $sql\_query="SELECT file\_path FROM {$wpdb->prefix}wppm\_attachments WHERE file\_path ='".~~$att\_result->file\_path~~."'"; |
  |  | 34 | $sql\_query="SELECT file\_path FROM {$wpdb->prefix}wppm\_attachments WHERE file\_path ='".esc\_sql($att\_result->file\_path)."'"; |
  | 35 | 35 | $proj\_attach\_result=$wpdb->get\_results($sql\_query); |
  | 36 | 36 | $proj\_result\_count = count($proj\_attach\_result); |
  | […](/browser/taskbuilder/trunk/includes/admin/projects/wppm_set_delete_bulk_projects.php?rev=3174963#L39) | […](/browser/taskbuilder/tags/3.0.7/includes/admin/projects/wppm_set_delete_bulk_projects.php?rev=3210469#L39) |  |
  | 39 | 39 | unlink($att\_result->file\_path); |
  | 40 | 40 | } |
  | 41 |  | $wpdb->delete($wpdb->prefix.'wppm\_attachments', array( 'id' => $proj\_attachment\_id)); |
  |  | 41 | $proj\_attachment\_id = esc\_sql($proj\_attachment\_id); |
  |  | 42 | $wpdb->delete($wpdb->prefix.'wppm\_attachments', array( 'id' => "$proj\_attachment\_id")); |
  | 42 | 43 | } |
  | 43 | 44 | } |
  | 44 | 45 | } |
  | 45 | 46 | } |
  | 46 |  | $wpdb->delete($wpdb->prefix.'wppm\_project\_comment',array('proj\_id'=>~~$proj\_id~~)); |
  | 47 |  | $wpdb->delete($wpdb->prefix.'wppm\_project\_meta',array('project\_id'=>~~$proj\_id~~)); |
  | 48 |  | $wpdb->delete($wpdb->prefix.'wppm\_project\_comment\_meta',array('proj\_id'=>~~$proj\_id~~)); |
  |  | 47 | $wpdb->delete($wpdb->prefix.'wppm\_project\_comment',array('proj\_id'=>esc\_sql($proj\_id))); |
  |  | 48 | $wpdb->delete($wpdb->prefix.'wppm\_project\_meta',array('project\_id'=>esc\_sql($proj\_id))); |
  |  | 49 | $wpdb->delete($wpdb->prefix.'wppm\_project\_comment\_meta',array('proj\_id'=>esc\_sql($proj\_id))); |
  | 49 | 50 |  |
  | 50 | 51 | /\*\*\*\*\*\*\*\*\*\*\*\*\*delete project's tasks and comments\*\*\*\*\*\*\*\*/ |
  | 51 | 52 | foreach($tasks as $task){ |
  | 52 |  | $sql="SELECT attachment\_ids FROM {$wpdb->prefix}wppm\_task\_comment WHERE task\_id =~~".$task->id~~; |
  |  | 53 | $sql="SELECT attachment\_ids FROM {$wpdb->prefix}wppm\_task\_comment WHERE task\_id ='".esc\_sql($task->id)."'"; |
  | 53 | 54 | $thread\_attachment\_ids= $wpdb->get\_results( $sql ); |
  | 54 | 55 |  |
  | […](/browser/taskbuilder/trunk/includes/admin/projects/wppm_set_delete_bulk_projects.php?rev=3174963#L62) | […](/browser/taskbuilder/tags/3.0.7/includes/admin/projects/wppm_set_delete_bulk_projects.php?rev=3210469#L63) |  |
  | 62 | 63 | //$attachment\_ids=$attachment\_ids\_temp; |
  | 63 | 64 | foreach ($attachment\_ids\_temp as $attachment\_id){ |
  | 64 |  | $sql="SELECT \* FROM {$wpdb->prefix}wppm\_attachments WHERE id =~~".$attachment\_id~~; |
  |  | 65 | $sql="SELECT \* FROM {$wpdb->prefix}wppm\_attachments WHERE id = '".esc\_sql($attachment\_id)."'"; |
  | 65 | 66 | $result=$wpdb->get\_row($sql); |
  | 66 | 67 | if(!empty($result)){ |
  | 67 |  | $sql\_query="SELECT file\_path FROM {$wpdb->prefix}wppm\_attachments WHERE file\_path ='".~~$result->file\_path~~."'"; |
  |  | 68 | $sql\_query="SELECT file\_path FROM {$wpdb->prefix}wppm\_attachments WHERE file\_path ='".esc\_sql($result->file\_path)."'"; |
  | 68 | 69 | $attach\_result=$wpdb->get\_results($sql\_query); |
  | 69 | 70 | $result\_count = count($attach\_result); |
  | […](/browser/taskbuilder/trunk/includes/admin/projects/wppm_set_delete_bulk_projects.php?rev=3174963#L78) | […](/browser/taskbuilder/tags/3.0.7/includes/admin/projects/wppm_set_delete_bulk_projects.php?rev=3210469#L79) |  |
  | 78 | 79 | } |
  | 79 | 80 | /\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*Code for deleting checklists\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*/ |
  | 80 |  | $sql="SELECT id FROM {$wpdb->prefix}wppm\_checklist WHERE task\_id =~~".$task->id~~; |
  |  | 81 | $sql="SELECT id FROM {$wpdb->prefix}wppm\_checklist WHERE task\_id ='".esc\_sql($task->id)."'"; |
  | 81 | 82 | $checklists = $wpdb->get\_results( $sql ); |
  | 82 | 83 | if(!empty($checklists)){ |
  | 83 | 84 | foreach($checklists as $checklist){ |
  | 84 | 85 | $chk\_array = (array) $checklist; |
  | 85 |  | $sql="SELECT id FROM {$wpdb->prefix}wppm\_checklist\_items WHERE checklist\_id =~~".$chk\_array['id']~~; |
  |  | 86 | $sql="SELECT id FROM {$wpdb->prefix}wppm\_checklist\_items WHERE checklist\_id ='".esc\_sql($chk\_array['id'])."'"; |
  | 86 | 87 | $checklist\_items = $wpdb->get\_results( $sql ); |
  | 87 | 88 | if(!empty($checklist\_items)){ |
  | 88 | 89 | foreach($checklist\_items as $ch\_item){ |
  | 89 | 90 | $chk\_items\_array = (array) $ch\_item; |
  | 90 |  | $wpdb->delete($wpdb->prefix.'wppm\_checklist\_items',array('id'=>~~$chk\_items\_array['id']~~)); |
  |  | 91 | $wpdb->delete($wpdb->prefix.'wppm\_checklist\_items',array('id'=>esc\_sql($chk\_items\_array['id']))); |
  | 91 | 92 | } |
  | 92 | 93 | } |
  | 93 |  | $wpdb->delete($wpdb->prefix.'wppm\_checklist',array('id'=>~~$chk\_array['id']~~)); |
  |  | 94 | $wpdb->delete($wpdb->prefix.'wppm\_checklist',array('id'=>esc\_sql($chk\_array['id']))); |
  | 94 | 95 | } |
  | 95 | 96 | } |
  | 96 |  | $wpdb->delete($wpdb->prefix.'wppm\_task',array('project'=>~~$proj\_id~~)); |
  | 97 |  | $wpdb->delete($wpdb->prefix.'wppm\_task\_meta',array('task\_id'=>~~$task->id~~)); |
  | 98 |  | $wpdb->delete($wpdb->prefix.'wppm\_task\_comment',array('task\_id'=>~~$task->id~~)); |
  | 99 |  | $wpdb->delete($wpdb->prefix.'wppm\_task\_comment\_meta',array('task\_id'=>~~$task->id~~)); |
  |  | 97 | $wpdb->delete($wpdb->prefix.'wppm\_task',array('project'=>esc\_sql($proj\_id))); |
  |  | 98 | $wpdb->delete($wpdb->prefix.'wppm\_task\_meta',array('task\_id'=>esc\_sql($task->id))); |
  |  | 99 | $wpdb->delete($wpdb->prefix.'wppm\_task\_comment',array('task\_id'=>esc\_sql($task->id))); |
  |  | 100 | $wpdb->delete($wpdb->prefix.'wppm\_task\_comment\_meta',array('task\_id'=>esc\_sql($task->id))); |
  | 100 | 101 | } |
  | 101 | 102 | } |
* ## [taskbuilder/tags/3.0.7/includes/admin/projects/wppm\_set\_delete\_project.php](/changeset/3210469/taskbuilder/tags/3.0.7/includes/admin/projects/wppm_set_delete_project.php "Show the changeset 3210469 restricted to taskbuilder/tags/3.0.7/includes/admin/projects/wppm_set_delete_project.php")

  | [r3174963](/browser/taskbuilder/trunk/includes/admin/projects/wppm_set_delete_project.php?rev=3174963#L6 "Show revision 3174963 of this file in browser") | [r3210469](/browser/taskbuilder/tags/3.0.7/includes/admin/projects/wppm_set_delete_project.php?rev=3210469#L6 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 6 | 6 | global $current\_user, $wppmfunction ,$wpdb; |
  | 7 | 7 | $project\_id  = isset($\_POST['project\_id']) ? intval(sanitize\_text\_field($\_POST['project\_id'])) : 0 ; |
  | 8 |  | $project = $wpdb->get\_row( "SELECT \* FROM {$wpdb->prefix}wppm\_project where id = '~~$project\_id~~'" ); |
  |  | 8 | $project = $wpdb->get\_row( "SELECT \* FROM {$wpdb->prefix}wppm\_project where id = '".esc\_sql($project\_id)."'" ); |
  | 9 | 9 | $wppm\_current\_user\_capability = get\_user\_meta( $current\_user->ID, 'wppm\_capability', true ); |
  | 10 | 10 | if (!(($current\_user->ID && $current\_user->has\_cap('manage\_options')) || $wppmfunction->has\_project\_permission('delete\_project',$project\_id) || ($project->created\_by==$current\_user->ID && $wppm\_current\_user\_capability == 'wppm\_manager') || ($current\_user->ID && $current\_user->has\_cap('wppm\_admin')))) {exit;} |
  | […](/browser/taskbuilder/trunk/includes/admin/projects/wppm_set_delete_project.php?rev=3174963#L14) | […](/browser/taskbuilder/tags/3.0.7/includes/admin/projects/wppm_set_delete_project.php?rev=3210469#L14) |  |
  | 14 | 14 | } |
  | 15 | 15 |  |
  | 16 |  | $tasks = $wpdb->get\_results("SELECT \* FROM {$wpdb->prefix}wppm\_task where project = '~~$project\_id'"~~); |
  |  | 16 | $tasks = $wpdb->get\_results("SELECT \* FROM {$wpdb->prefix}wppm\_task where project = '".esc\_sql($project\_id)."'" ); |
  | 17 | 17 | /\*\*\*\*\*\*\*\*\*\*\*\*\*delete project\*\*\*\*\*\*\*\*/ |
  | 18 | 18 | $wpdb->delete($wpdb->prefix.'wppm\_project',array('id'=>"$project\_id")); |
  | 19 | 19 |  |
  | 20 | 20 | /\*\*\*\*\*\*\*\*\*\*\*\*\*delete project comment\*\*\*\*\*\*\*\*/ |
  | 21 |  | $sql="SELECT attachment\_ids FROM {$wpdb->prefix}wppm\_project\_comment WHERE proj\_id =~~".$project\_id~~; |
  |  | 21 | $sql="SELECT attachment\_ids FROM {$wpdb->prefix}wppm\_project\_comment WHERE proj\_id ='".esc\_sql($project\_id)."'" ; |
  | 22 | 22 | $proj\_comm\_attachment\_ids= $wpdb->get\_results( $sql ); |
  | 23 | 23 | if(!empty($proj\_comm\_attachment\_ids)){ |
  | […](/browser/taskbuilder/trunk/includes/admin/projects/wppm_set_delete_project.php?rev=3174963#L28) | […](/browser/taskbuilder/tags/3.0.7/includes/admin/projects/wppm_set_delete_project.php?rev=3210469#L28) |  |
  | 28 | 28 | } |
  | 29 | 29 | foreach ($proj\_attachment\_ids\_temp as $proj\_attachment\_id){ |
  | 30 |  | $sql="SELECT \* FROM {$wpdb->prefix}wppm\_attachments WHERE id =".$proj\_attachment\_id; |
  |  | 30 | $proj\_attachment\_id = esc\_sql($proj\_attachment\_id); |
  |  | 31 | $sql="SELECT \* FROM {$wpdb->prefix}wppm\_attachments WHERE id ='$proj\_attachment\_id'"; |
  | 31 | 32 | $att\_result=$wpdb->get\_row($sql); |
  | 32 | 33 | if(!empty($att\_result)){ |
  | 33 |  | $sql\_query="SELECT file\_path FROM {$wpdb->prefix}wppm\_attachments WHERE file\_path ='".~~$att\_result->file\_path~~."'"; |
  |  | 34 | $sql\_query="SELECT file\_path FROM {$wpdb->prefix}wppm\_attachments WHERE file\_path ='".esc\_sql($att\_result->file\_path)."'"; |
  | 34 | 35 | $proj\_attach\_result=$wpdb->get\_results($sql\_query); |
  | 35 | 36 | $proj\_result\_count = count($proj\_attach\_result); |
  | […](/browser/taskbuilder/trunk/includes/admin/projects/wppm_set_delete_project.php?rev=3174963#L38) | […](/browser/taskbuilder/tags/3.0.7/includes/admin/projects/wppm_set_delete_project.php?rev=3210469#L39) |  |
  | 38 | 39 | unlink($att\_result->file\_path); |
  | 39 | 40 | } |
  | 40 |  | $wpdb->delete($wpdb->prefix.'wppm\_attachments', array( 'id' => ~~$proj\_attachment\_id~~)); |
  |  | 41 | $wpdb->delete($wpdb->prefix.'wppm\_attachments', array( 'id' => "$proj\_attachment\_id")); |
  | 41 | 42 | } |
  | 42 | 43 | } |
  | 43 | 44 | } |
  | 44 | 45 | } |
  | 45 |  | $wpdb->delete($wpdb->prefix.'wppm\_project\_comment',array('proj\_id'=>~~$project\_id~~)); |
  | 46 |  | $wpdb->delete($wpdb->prefix.'wppm\_project\_meta',array('project\_id'=>~~$project\_id~~)); |
  | 47 |  | $wpdb->delete($wpdb->prefix.'wppm\_project\_comment\_meta',array('proj\_id'=>~~$project\_id~~)); |
  |  | 46 | $wpdb->delete($wpdb->prefix.'wppm\_project\_comment',array('proj\_id'=>esc\_sql($project\_id))); |
  |  | 47 | $wpdb->delete($wpdb->prefix.'wppm\_project\_meta',array('project\_id'=>esc\_sql($project\_id))); |
  |  | 48 | $wpdb->delete($wpdb->prefix.'wppm\_project\_comment\_meta',array('proj\_id'=>esc\_sql($project\_id))); |
  | 48 | 49 |  |
  | 49 | 50 | /\*\*\*\*\*\*\*\*\*\*\*\*\*delete project's tasks and comments\*\*\*\*\*\*\*\*/ |
  | 50 | 51 | foreach($tasks as $task){ |
  | 51 |  | $sql="SELECT attachment\_ids FROM {$wpdb->prefix}wppm\_task\_comment WHERE task\_id =~~".esc\_sql($task->id)~~; |
  |  | 52 | $sql="SELECT attachment\_ids FROM {$wpdb->prefix}wppm\_task\_comment WHERE task\_id ='".esc\_sql($task->id)."'"; |
  | 52 | 53 | $thread\_attachment\_ids= $wpdb->get\_results( $sql ); |
  | 53 | 54 | $tid = esc\_sql($task->id); |
  | […](/browser/taskbuilder/trunk/includes/admin/projects/wppm_set_delete_project.php?rev=3174963#L61) | […](/browser/taskbuilder/tags/3.0.7/includes/admin/projects/wppm_set_delete_project.php?rev=3210469#L62) |  |
  | 61 | 62 | //$attachment\_ids=$attachment\_ids\_temp; |
  | 62 | 63 | foreach ($attachment\_ids\_temp as $attachment\_id){ |
  | 63 |  | $attachment\_id = esc\_sql($attachment\_id); |
  | 64 |  | $sql="SELECT \* FROM {$wpdb->prefix}wppm\_attachments WHERE id = '$attachment\_id'"; |
  |  | 64 | $sql="SELECT \* FROM {$wpdb->prefix}wppm\_attachments WHERE id = '".esc\_sql($attachment\_id)."'"; |
  | 65 | 65 | $result=$wpdb->get\_row($sql); |
  | 66 | 66 | if(!empty($result)){ |
  | […](/browser/taskbuilder/trunk/includes/admin/projects/wppm_set_delete_project.php?rev=3174963#L72) | […](/browser/taskbuilder/tags/3.0.7/includes/admin/projects/wppm_set_delete_project.php?rev=3210469#L72) |  |
  | 72 | 72 | unlink($result->file\_path); |
  | 73 | 73 | } |
  | 74 |  | $wpdb->delete($wpdb->prefix.'wppm\_attachments', array( 'id' => ~~$attachment\_id~~)); |
  |  | 74 | $wpdb->delete($wpdb->prefix.'wppm\_attachments', array( 'id' => esc\_sql($attachment\_id))); |
  | 75 | 75 | } |
  | 76 | 76 | } |
  | […](/browser/taskbuilder/trunk/includes/admin/projects/wppm_set_delete_project.php?rev=3174963#L78) | […](/browser/taskbuilder/tags/3.0.7/includes/admin/projects/wppm_set_delete_project.php?rev=3210469#L78) |  |
  | 78 | 78 | } |
  | 79 | 79 | /\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*Code for deleting checklists\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*/ |
  | 80 |  | $sql="SELECT id FROM {$wpdb->prefix}wppm\_checklist WHERE task\_id = '~~$tid~~'"; |
  |  | 80 | $sql="SELECT id FROM {$wpdb->prefix}wppm\_checklist WHERE task\_id = '".($tid)."'"; |
  | 81 | 81 | $checklists = $wpdb->get\_results( $sql ); |
  | 82 | 82 | if(!empty($checklists)){ |
  | […](/browser/taskbuilder/trunk/includes/admin/projects/wppm_set_delete_project.php?rev=3174963#L96) | […](/browser/taskbuilder/tags/3.0.7/includes/admin/projects/wppm_set_delete_project.php?rev=3210469#L96) |  |
  | 96 | 96 | } |
  | 97 | 97 | } |
  | 98 |  | $wpdb->delete($wpdb->prefix.'wppm\_task',array('project'=>~~$project\_id~~)); |
  |  | 98 | $wpdb->delete($wpdb->prefix.'wppm\_task',array('project'=>esc\_sql($project\_id))); |
  | 99 | 99 | $wpdb->delete($wpdb->prefix.'wppm\_task\_meta',array('task\_id'=>$tid)); |
  | 100 | 100 | $wpdb->delete($wpdb->prefix.'wppm\_task\_comment',array('task\_id'=>$tid)); |
* ## [taskbuilder/tags/3.0.7/includes/admin/projects/wppm\_set\_project\_meta.php](/changeset/3210469/taskbuilder/tags/3.0.7/includes/admin/projects/wppm_set_project_meta.php "Show the changeset 3210469 restricted to taskbuilder/tags/3.0.7/includes/admin/projects/wppm_set_project_meta.php")

  | [r3174963](/browser/taskbuilder/trunk/includes/admin/projects/wppm_set_project_meta.php?rev=3174963#L12 "Show revision 3174963 of this file in browser") | [r3210469](/browser/taskbuilder/tags/3.0.7/includes/admin/projects/wppm_set_project_meta.php?rev=3210469#L12 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 12 | 12 | if(!empty($user)){ |
  | 13 | 13 | $user\_role = sanitize\_text\_field($\_POST['wppm\_select\_user\_role\_'.$user]); |
  | 14 |  | $user = esc\_sql($user); |
  | 15 |  | $project\_user = $wpdb->get\_row("SELECT \* FROM {$wpdb->prefix}wppm\_project\_users WHERE proj\_id = '$project\_id' AND user\_id = '$user'"); |
  |  | 14 | $project\_user = $wpdb->get\_row("SELECT \* FROM {$wpdb->prefix}wppm\_project\_users WHERE proj\_id = '".esc\_sql($project\_id)."' AND user\_id = '".esc\_sql($user)."'"); |
  | 16 | 15 | if(!empty($project\_user)){ |
  | 17 | 16 | $project\_user\_id = esc\_sql($project\_user->id); |
  | 18 |  | ~~$user\_role = esc\_sql($user\_role);~~ |
  | 19 | 17 | $values=array( |
  | 20 |  | 'role\_id'=> ~~$user\_role~~, |
  | 21 |  | 'assigned\_by'=>esc\_sql($current\_user->ID) |
  |  | 18 | 'role\_id'=> esc\_sql($user\_role), |
  |  | 19 | 'assigned\_by'=>esc\_sql($current\_user->ID) |
  | 22 | 20 | ); |
  | 23 | 21 | $wpdb->update($wpdb->prefix.'wppm\_project\_users', $values, array('id'=>$project\_user\_id)); |
  | […](/browser/taskbuilder/trunk/includes/admin/projects/wppm_set_project_meta.php?rev=3174963#L26) | […](/browser/taskbuilder/tags/3.0.7/includes/admin/projects/wppm_set_project_meta.php?rev=3210469#L24) |  |
  | 26 | 24 | $wpdb->prefix . 'wppm\_project\_users', |
  | 27 | 25 | array( |
  | 28 |  | 'proj\_id' => ~~$project\_id~~, |
  | 29 |  | 'user\_id' => ~~$user~~, |
  | 30 |  | 'role\_id' => ~~$user\_role~~, |
  | 31 |  | 'assigned\_by' =>esc\_sql($current\_user->ID) |
  |  | 26 | 'proj\_id' => esc\_sql($project\_id), |
  |  | 27 | 'user\_id' => esc\_sql($user), |
  |  | 28 | 'role\_id' => esc\_sql($user\_role), |
  |  | 29 | 'assigned\_by' =>esc\_sql($current\_user->ID) |
  | 32 | 30 | ) ); |
  | 33 | 31 | } |
* ## [taskbuilder/tags/3.0.7/includes/admin/settings/wppm\_delete\_category.php](/changeset/3210469/taskbuilder/tags/3.0.7/includes/admin/settings/wppm_delete_category.php "Show the changeset 3210469 restricted to taskbuilder/tags/3.0.7/includes/admin/settings/wppm_delete_category.php")

  | [r3174963](/browser/taskbuilder/trunk/includes/admin/settings/wppm_delete_category.php?rev=3174963#L10 "Show revision 3174963 of this file in browser") | [r3210469](/browser/taskbuilder/tags/3.0.7/includes/admin/settings/wppm_delete_category.php?rev=3210469#L10 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 10 | 10 | } |
  | 11 | 11 | $cat\_id = isset($\_POST) && isset($\_POST['cat\_id']) ? intval(sanitize\_text\_field($\_POST['cat\_id'])) : 0; |
  |  | 12 | $cat\_id = esc\_sql($cat\_id); |
  | 12 | 13 | if (!$cat\_id) {exit;} |
  | 13 | 14 |  |
* ## [taskbuilder/tags/3.0.7/includes/admin/settings/wppm\_delete\_status.php](/changeset/3210469/taskbuilder/tags/3.0.7/includes/admin/settings/wppm_delete_status.php "Show the changeset 3210469 restricted to taskbuilder/tags/3.0.7/includes/admin/settings/wppm_delete_status.php")

  | [r3174963](/browser/taskbuilder/trunk/includes/admin/settings/wppm_delete_status.php?rev=3174963#L11 "Show revision 3174963 of this file in browser") | [r3210469](/browser/taskbuilder/tags/3.0.7/includes/admin/settings/wppm_delete_status.php?rev=3210469#L11 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 11 | 11 | $status\_id = isset($\_POST) && isset($\_POST['status\_id']) ? intval(sanitize\_text\_field($\_POST['status\_id'])) : 0; |
  | 12 | 12 | if (!$status\_id) {exit;} |
  | 13 |  |  |
  |  | 13 | $status\_id = esc\_sql($status\_id); |
  | 14 | 14 | $wpdb->delete($wpdb->prefix.'wppm\_project\_statuses', array( 'id' => "$status\_id")); |
* ## [taskbuilder/tags/3.0.7/includes/admin/settings/wppm\_delete\_task\_priority.php](/changeset/3210469/taskbuilder/tags/3.0.7/includes/admin/settings/wppm_delete_task_priority.php "Show the changeset 3210469 restricted to taskbuilder/tags/3.0.7/includes/admin/settings/wppm_delete_task_priority.php")

  | [r3174963](/browser/taskbuilder/trunk/includes/admin/settings/wppm_delete_task_priority.php?rev=3174963#L12 "Show revision 3174963 of this file in browser") | [r3210469](/browser/taskbuilder/tags/3.0.7/includes/admin/settings/wppm_delete_task_priority.php?rev=3210469#L12 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 12 | 12 | $priority\_id = isset($\_POST) && isset($\_POST['priority\_id']) ? intval(sanitize\_text\_field($\_POST['priority\_id'])) : 0; |
  | 13 | 13 | if (!$priority\_id) {exit;} |
  |  | 14 | $priority\_id = esc\_sql($priority\_id); |
  | 14 | 15 |  |
  | 15 | 16 | $wpdb->delete($wpdb->prefix.'wppm\_task\_priorities', array( 'id' => "$priority\_id")); |
* ## [taskbuilder/tags/3.0.7/includes/admin/settings/wppm\_delete\_task\_status.php](/changeset/3210469/taskbuilder/tags/3.0.7/includes/admin/settings/wppm_delete_task_status.php "Show the changeset 3210469 restricted to taskbuilder/tags/3.0.7/includes/admin/settings/wppm_delete_task_status.php")

  | [r3174963](/browser/taskbuilder/trunk/includes/admin/settings/wppm_delete_task_status.php?rev=3174963#L12 "Show revision 3174963 of this file in browser") | [r3210469](/browser/taskbuilder/tags/3.0.7/includes/admin/settings/wppm_delete_task_status.php?rev=3210469#L12 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 12 | 12 | $status\_id = isset($\_POST) && isset($\_POST['status\_id']) ? intval(sanitize\_text\_field($\_POST['status\_id'])) : 0; |
  | 13 | 13 | if (!$status\_id) {exit;} |
  |  | 14 | $status\_id = esc\_sql($status\_id); |
  | 14 | 15 |  |
  | 15 | 16 | $wpdb->delete($wpdb->prefix.'wppm\_task\_statuses', array( 'id' => "$status\_id")); |
* ## [taskbuilder/tags/3.0.7/includes/admin/settings/wppm\_get\_category\_settings.php](/changeset/3210469/taskbuilder/tags/3.0.7/includes/admin/settings/wppm_get_category_settings.php "Show the changeset 3210469 restricted to taskbuilder/tags/3.0.7/includes/admin/settings/wppm_get_category_settings.php")

  | [r3174963](/browser/taskbuilder/trunk/includes/admin/settings/wppm_get_category_settings.php?rev=3174963#L9 "Show revision 3174963 of this file in browser") | [r3210469](/browser/taskbuilder/tags/3.0.7/includes/admin/settings/wppm_get_category_settings.php?rev=3210469#L9 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 9 | 9 | } |
  | 10 | 10 | $wppm\_ap\_settings = get\_option("wppm-ap-settings"); |
  | 11 |  | $orderby\_sql = ~~esc\_sql(sanitize\_sql\_orderby( "load\_order ASC" )~~); |
  | 12 |  | $categories = $wpdb->get\_results( "SELECT \* FROM {$wpdb->prefix}wppm\_project\_categories ORDER BY ~~".$orderby\_sql~~ ); |
  |  | 11 | $orderby\_sql = sanitize\_sql\_orderby( "load\_order ASC"); |
  |  | 12 | $categories = $wpdb->get\_results( "SELECT \* FROM {$wpdb->prefix}wppm\_project\_categories ORDER BY $orderby\_sql" ); |
  | 13 | 13 | $cat\_arr = array(); |
  | 14 | 14 | $cat\_arr = $wpdb->get\_results( "SELECT id FROM {$wpdb->prefix}wppm\_project\_categories" ); |
* ## [taskbuilder/tags/3.0.7/includes/admin/settings/wppm\_get\_edit\_category.php](/changeset/3210469/taskbuilder/tags/3.0.7/includes/admin/settings/wppm_get_edit_category.php "Show the changeset 3210469 restricted to taskbuilder/tags/3.0.7/includes/admin/settings/wppm_get_edit_category.php")

  | [r3174963](/browser/taskbuilder/trunk/includes/admin/settings/wppm_get_edit_category.php?rev=3174963#L9 "Show revision 3174963 of this file in browser") | [r3210469](/browser/taskbuilder/tags/3.0.7/includes/admin/settings/wppm_get_edit_category.php?rev=3210469#L9 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 9 | 9 | $cat\_id = isset($\_POST) && isset($\_POST['cat\_id']) ? intval(sanitize\_text\_field($\_POST['cat\_id'])) : 0; |
  | 10 | 10 | if (!$cat\_id) {exit;} |
  | 11 |  |  |
  | 12 |  | $category = $wpdb->get\_row("SELECT \* FROM {$wpdb->prefix}wppm\_project\_categories WHERE id = '$cat\_id' "); |
  |  | 11 | $category = $wpdb->get\_row("SELECT \* FROM {$wpdb->prefix}wppm\_project\_categories WHERE id = '".esc\_sql($cat\_id)."' "); |
  | 13 | 12 | ob\_start(); |
  | 14 | 13 | ?> |
* ## [taskbuilder/tags/3.0.7/includes/admin/settings/wppm\_get\_edit\_priority.php](/changeset/3210469/taskbuilder/tags/3.0.7/includes/admin/settings/wppm_get_edit_priority.php "Show the changeset 3210469 restricted to taskbuilder/tags/3.0.7/includes/admin/settings/wppm_get_edit_priority.php")

  | [r3174963](/browser/taskbuilder/trunk/includes/admin/settings/wppm_get_edit_priority.php?rev=3174963#L10 "Show revision 3174963 of this file in browser") | [r3210469](/browser/taskbuilder/tags/3.0.7/includes/admin/settings/wppm_get_edit_priority.php?rev=3210469#L10 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 10 | 10 | $priority\_id = isset($\_POST) && isset($\_POST['priority\_id']) ? intval(sanitize\_text\_field($\_POST['priority\_id'])) : 0; |
  | 11 | 11 | if (!$priority\_id) {exit;} |
  | 12 |  |  |
  | 13 |  | $priority = $wpdb->get\_row("SELECT \* FROM {$wpdb->prefix}wppm\_task\_priorities WHERE id = '$priority\_id' "); |
  |  | 12 | $priority = $wpdb->get\_row("SELECT \* FROM {$wpdb->prefix}wppm\_task\_priorities WHERE id = '".esc\_sql($priority\_id)."' "); |
  | 14 | 13 | ob\_start(); |
  | 15 | 14 | ?> |
* ## [taskbuilder/tags/3.0.7/includes/admin/settings/wppm\_get\_edit\_proj\_status.php](/changeset/3210469/taskbuilder/tags/3.0.7/includes/admin/settings/wppm_get_edit_proj_status.php "Show the changeset 3210469 restricted to taskbuilder/tags/3.0.7/includes/admin/settings/wppm_get_edit_proj_status.php")

  | [r3174963](/browser/taskbuilder/trunk/includes/admin/settings/wppm_get_edit_proj_status.php?rev=3174963#L9 "Show revision 3174963 of this file in browser") | [r3210469](/browser/taskbuilder/tags/3.0.7/includes/admin/settings/wppm_get_edit_proj_status.php?rev=3210469#L9 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 9 | 9 | $status\_id = isset($\_POST) && isset($\_POST['status\_id']) ? intval(sanitize\_text\_field($\_POST['status\_id'])) : 0; |
  | 10 | 10 | if (!$status\_id) {exit;} |
  | 11 |  |  |
  | 12 |  | $status = $wpdb->get\_row("SELECT \* FROM {$wpdb->prefix}wppm\_project\_statuses WHERE id = '$status\_id' "); |
  |  | 11 | $status = $wpdb->get\_row("SELECT \* FROM {$wpdb->prefix}wppm\_project\_statuses WHERE id = '".esc\_sql($status\_id)."' "); |
  | 13 | 12 | ob\_start(); |
  | 14 | 13 | ?> |
* ## [taskbuilder/tags/3.0.7/includes/admin/settings/wppm\_get\_edit\_task\_status.php](/changeset/3210469/taskbuilder/tags/3.0.7/includes/admin/settings/wppm_get_edit_task_status.php "Show the changeset 3210469 restricted to taskbuilder/tags/3.0.7/includes/admin/settings/wppm_get_edit_task_status.php")

  | [r3174963](/browser/taskbuilder/trunk/includes/admin/settings/wppm_get_edit_task_status.php?rev=3174963#L10 "Show revision 3174963 of this file in browser") | [r3210469](/browser/taskbuilder/tags/3.0.7/includes/admin/settings/wppm_get_edit_task_status.php?rev=3210469#L10 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 10 | 10 | $status\_id = isset($\_POST) && isset($\_POST['status\_id']) ? intval(sanitize\_text\_field($\_POST['status\_id'])) : 0; |
  | 11 | 11 | if (!$status\_id) {exit;} |
  | 12 |  |  |
  | 13 |  | $status = $wpdb->get\_row("SELECT \* FROM {$wpdb->prefix}wppm\_task\_statuses WHERE id = '$status\_id' "); |
  |  | 12 | $status = $wpdb->get\_row("SELECT \* FROM {$wpdb->prefix}wppm\_task\_statuses WHERE id =  '".esc\_sql($status\_id)."' "); |
  | 14 | 13 | ob\_start(); |
  | 15 | 14 | ?> |
* ## [taskbuilder/tags/3.0.7/includes/admin/settings/wppm\_get\_priority\_settings.php](/changeset/3210469/taskbuilder/tags/3.0.7/includes/admin/settings/wppm_get_priority_settings.php "Show the changeset 3210469 restricted to taskbuilder/tags/3.0.7/includes/admin/settings/wppm_get_priority_settings.php")

  | [r3174963](/browser/taskbuilder/trunk/includes/admin/settings/wppm_get_priority_settings.php?rev=3174963#L8 "Show revision 3174963 of this file in browser") | [r3210469](/browser/taskbuilder/tags/3.0.7/includes/admin/settings/wppm_get_priority_settings.php?rev=3210469#L8 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 8 | 8 | exit; |
  | 9 | 9 | } |
  | 10 |  | $orderby\_sql = esc\_sql(sanitize\_sql\_orderby( "load\_order ASC")); |
  | 11 |  | $priorities = $wpdb->get\_results( "SELECT \* FROM {$wpdb->prefix}wppm\_task\_priorities ORDER BY ~~".$orderby\_sql~~ ); |
  |  | 10 | $orderby\_sql = esc\_sql(sanitize\_sql\_orderby( "load\_order ASC")); |
  |  | 11 | $priorities = $wpdb->get\_results( "SELECT \* FROM {$wpdb->prefix}wppm\_task\_priorities ORDER BY $orderby\_sql" ); |
  | 12 | 12 | $priority\_arr = $wpdb->get\_results( "SELECT id FROM {$wpdb->prefix}wppm\_task\_priorities" ); |
  | 13 | 13 | $priority\_ids = array(); |
* ## [taskbuilder/tags/3.0.7/includes/admin/settings/wppm\_get\_proj\_status\_settings.php](/changeset/3210469/taskbuilder/tags/3.0.7/includes/admin/settings/wppm_get_proj_status_settings.php "Show the changeset 3210469 restricted to taskbuilder/tags/3.0.7/includes/admin/settings/wppm_get_proj_status_settings.php")

  | [r3174963](/browser/taskbuilder/trunk/includes/admin/settings/wppm_get_proj_status_settings.php?rev=3174963#L14 "Show revision 3174963 of this file in browser") | [r3210469](/browser/taskbuilder/tags/3.0.7/includes/admin/settings/wppm_get_proj_status_settings.php?rev=3210469#L14 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 14 | 14 | } |
  | 15 | 15 | $wppm\_ap\_settings = get\_option("wppm-ap-settings"); |
  | 16 |  | $orderby\_sql = esc\_sql(sanitize\_sql\_orderby( "load\_order ASC")); |
  | 17 |  | $statuses = $wpdb->get\_results( "SELECT \* FROM {$wpdb->prefix}wppm\_project\_statuses ORDER BY ~~".$orderby\_sql~~ ); |
  |  | 16 | $orderby\_sql = esc\_sql(sanitize\_sql\_orderby( "load\_order ASC")); |
  |  | 17 | $statuses = $wpdb->get\_results( "SELECT \* FROM {$wpdb->prefix}wppm\_project\_statuses ORDER BY $orderby\_sql" ); |
  | 18 | 18 | $status\_arr = $wpdb->get\_results( "SELECT id FROM {$wpdb->prefix}wppm\_project\_statuses" ); |
  | 19 | 19 | $status\_ids =array(); |
* ## [taskbuilder/tags/3.0.7/includes/admin/settings/wppm\_get\_task\_status\_settings.php](/changeset/3210469/taskbuilder/tags/3.0.7/includes/admin/settings/wppm_get_task_status_settings.php "Show the changeset 3210469 restricted to taskbuilder/tags/3.0.7/includes/admin/settings/wppm_get_task_status_settings.php")

  | [r3174963](/browser/taskbuilder/trunk/includes/admin/settings/wppm_get_task_status_settings.php?rev=3174963#L13 "Show revision 3174963 of this file in browser") | [r3210469](/browser/taskbuilder/tags/3.0.7/includes/admin/settings/wppm_get_task_status_settings.php?rev=3210469#L13 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 13 | 13 | exit; |
  | 14 | 14 | } |
  | 15 |  | $orderby\_sql = esc\_sql(sanitize\_sql\_orderby( "load\_order ASC")); |
  | 16 |  | $statuses = $wpdb->get\_results( "SELECT \* FROM {$wpdb->prefix}wppm\_task\_statuses ORDER BY ~~".$orderby\_sql~~ ); |
  |  | 15 | $orderby\_sql = esc\_sql(sanitize\_sql\_orderby( "load\_order ASC")); |
  |  | 16 | $statuses = $wpdb->get\_results( "SELECT \* FROM {$wpdb->prefix}wppm\_task\_statuses ORDER BY $orderby\_sql" ); |
  | 17 | 17 | $status\_arr = $wpdb->get\_results( "SELECT id FROM {$wpdb->prefix}wppm\_task\_statuses" ); |
  | 18 | 18 | $status\_ids=array(); |
* ## [taskbuilder/tags/3.0.7/includes/admin/settings/wppm\_set\_add\_category.php](/changeset/3210469/taskbuilder/tags/3.0.7/includes/admin/settings/wppm_set_add_category.php "Show the changeset 3210469 restricted to taskbuilder/tags/3.0.7/includes/admin/settings/wppm_set_add_category.php")

  | [r3174963](/browser/taskbuilder/trunk/includes/admin/settings/wppm_set_add_category.php?rev=3174963#L13 "Show revision 3174963 of this file in browser") | [r3210469](/browser/taskbuilder/tags/3.0.7/includes/admin/settings/wppm_set_add_category.php?rev=3210469#L13 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 13 | 13 | if (!$cat\_name) {exit;} |
  | 14 | 14 | $load\_order = $wpdb->get\_var("select max(load\_order) from {$wpdb->prefix}wppm\_project\_categories"); |
  | 15 |  | $load\_order = isset($load\_order) ? ~~esc\_sql($load\_order)~~: ""; |
  |  | 15 | $load\_order = isset($load\_order) ? $load\_order: ""; |
  | 16 | 16 | $values=array( |
  | 17 |  | 'name'=>~~sanitize\_text\_field($\_POST['cat\_name']~~), |
  | 18 |  | 'load\_order'=> ~~++$load\_order~~ |
  |  | 17 | 'name'=>esc\_sql($cat\_name), |
  |  | 18 | 'load\_order'=> esc\_sql(++$load\_order) |
  | 19 | 19 | ); |
  | 20 | 20 | $wpdb->insert($wpdb->prefix.'wppm\_project\_categories',$values); |
* ## [taskbuilder/tags/3.0.7/includes/admin/settings/wppm\_set\_category\_order.php](/changeset/3210469/taskbuilder/tags/3.0.7/includes/admin/settings/wppm_set_category_order.php "Show the changeset 3210469 restricted to taskbuilder/tags/3.0.7/includes/admin/settings/wppm_set_category_order.php")

  | [r3174963](/browser/taskbuilder/trunk/includes/admin/settings/wppm_set_category_order.php?rev=3174963#L12 "Show revision 3174963 of this file in browser") | [r3210469](/browser/taskbuilder/tags/3.0.7/includes/admin/settings/wppm_set_category_order.php?rev=3210469#L12 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 12 | 12 | $load\_orders = $wppmfunction->sanitize\_array($load\_orders); |
  | 13 | 13 | } |
  | 14 |  | ~~$categories = $wpdb->get\_results( "SELECT id FROM {$wpdb->prefix}wppm\_project\_categories");~~ |
  | 15 |  |  |
  | 16 | 14 | if (is\_array($load\_orders)) { |
  | 17 | 15 | foreach($load\_orders as $key=>$val){ |
  | 18 |  | $result = $wpdb->query("UPDATE ".$wpdb->prefix."wppm\_project\_categories SET load\_order=". esc\_sql($val)." WHERE id=~~".esc\_sql($key)~~ ); |
  |  | 16 | $result = $wpdb->query("UPDATE ".$wpdb->prefix."wppm\_project\_categories SET load\_order=". esc\_sql($val)." WHERE id='".esc\_sql($key)."'" ); |
  | 19 | 17 | } |
  | 20 | 18 | } |
* ## [taskbuilder/tags/3.0.7/includes/admin/settings/wppm\_set\_edit\_category.php](/changeset/3210469/taskbuilder/tags/3.0.7/includes/admin/settings/wppm_set_edit_category.php "Show the changeset 3210469 restricted to taskbuilder/tags/3.0.7/includes/admin/settings/wppm_set_edit_category.php")

  | [r3174963](/browser/taskbuilder/trunk/includes/admin/settings/wppm_set_edit_category.php?rev=3174963#L11 "Show revision 3174963 of this file in browser") | [r3210469](/browser/taskbuilder/tags/3.0.7/includes/admin/settings/wppm_set_edit_category.php?rev=3210469#L11 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 11 | 11 |  |
  | 12 | 12 | $cat\_id = isset($\_POST) && isset($\_POST['cat\_id']) ? intval(sanitize\_text\_field($\_POST['cat\_id'])) : 0; |
  |  | 13 | $cat\_id = esc\_sql($cat\_id); |
  | 13 | 14 | if (!$cat\_id) {exit;} |
  | 14 | 15 |  |
  | […](/browser/taskbuilder/trunk/includes/admin/settings/wppm_set_edit_category.php?rev=3174963#L17) | […](/browser/taskbuilder/tags/3.0.7/includes/admin/settings/wppm_set_edit_category.php?rev=3210469#L18) |  |
  | 17 | 18 |  |
  | 18 | 19 | $values= array( |
  | 19 |  | 'name'=>~~$cat\_name~~ |
  |  | 20 | 'name'=>esc\_sql($cat\_name) |
  | 20 | 21 | ); |
  | 21 | 22 | $wpdb->update($wpdb->prefix.'wppm\_project\_categories',$values,array('id'=>("$cat\_id"))); |
* ## [taskbuilder/tags/3.0.7/includes/admin/settings/wppm\_set\_edit\_priority.php](/changeset/3210469/taskbuilder/tags/3.0.7/includes/admin/settings/wppm_set_edit_priority.php "Show the changeset 3210469 restricted to taskbuilder/tags/3.0.7/includes/admin/settings/wppm_set_edit_priority.php")

  | [r3174963](/browser/taskbuilder/trunk/includes/admin/settings/wppm_set_edit_priority.php?rev=3174963#L15 "Show revision 3174963 of this file in browser") | [r3210469](/browser/taskbuilder/tags/3.0.7/includes/admin/settings/wppm_set_edit_priority.php?rev=3210469#L15 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 15 | 15 | $priority\_id = isset($\_POST) && isset($\_POST['priority\_id']) ? intval(sanitize\_text\_field($\_POST['priority\_id'])) : ''; |
  | 16 | 16 | if (!$priority\_id) {exit;} |
  |  | 17 | $priority\_id = esc\_sql($priority\_id); |
  | 17 | 18 |  |
  | 18 | 19 | $priority\_name = isset($\_POST) && isset($\_POST['priority\_name']) ? sanitize\_text\_field($\_POST['priority\_name']) : ''; |
* ## [taskbuilder/tags/3.0.7/includes/admin/settings/wppm\_set\_edit\_status.php](/changeset/3210469/taskbuilder/tags/3.0.7/includes/admin/settings/wppm_set_edit_status.php "Show the changeset 3210469 restricted to taskbuilder/tags/3.0.7/includes/admin/settings/wppm_set_edit_status.php")

  | [r3174963](/browser/taskbuilder/trunk/includes/admin/settings/wppm_set_edit_status.php?rev=3174963#L13 "Show revision 3174963 of this file in browser") | [r3210469](/browser/taskbuilder/tags/3.0.7/includes/admin/settings/wppm_set_edit_status.php?rev=3210469#L13 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 13 | 13 | $status\_id = isset($\_POST) && isset($\_POST['status\_id']) ? intval(sanitize\_text\_field($\_POST['status\_id'])) : ''; |
  | 14 | 14 | if (!$status\_id) {exit;} |
  |  | 15 | $status\_id = esc\_sql($status\_id); |
  | 15 | 16 | $status\_name = isset($\_POST) && isset($\_POST['status\_name']) ? sanitize\_text\_field($\_POST['status\_name']) : ''; |
  | 16 | 17 | if (!$status\_name) {exit;} |
* ## [taskbuilder/tags/3.0.7/includes/admin/settings/wppm\_set\_edit\_task\_status.php](/changeset/3210469/taskbuilder/tags/3.0.7/includes/admin/settings/wppm_set_edit_task_status.php "Show the changeset 3210469 restricted to taskbuilder/tags/3.0.7/includes/admin/settings/wppm_set_edit_task_status.php")

  | [r3174963](/browser/taskbuilder/trunk/includes/admin/settings/wppm_set_edit_task_status.php?rev=3174963#L13 "Show revision 3174963 of this file in browser") | [r3210469](/browser/taskbuilder/tags/3.0.7/includes/admin/settings/wppm_set_edit_task_status.php?rev=3210469#L13 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 13 | 13 | $status\_id = isset($\_POST) && isset($\_POST['status\_id']) ? intval(sanitize\_text\_field($\_POST['status\_id'])) : ''; |
  | 14 | 14 | if (!$status\_id) {exit;} |
  |  | 15 | $status\_id = esc\_sql($status\_id); |
  | 15 | 16 |  |
  | 16 | 17 | $status\_name = isset($\_POST) && isset($\_POST['status\_name']) ? sanitize\_text\_field($\_POST['status\_name']) : ''; |
* ## [taskbuilder/tags/3.0.7/includes/admin/settings/wppm\_set\_priority\_order.php](/changeset/3210469/taskbuilder/tags/3.0.7/includes/admin/settings/wppm_set_priority_order.php "Show the changeset 3210469 restricted to taskbuilder/tags/3.0.7/includes/admin/settings/wppm_set_priority_order.php")

  | [r3174963](/browser/taskbuilder/trunk/includes/admin/settings/wppm_set_priority_order.php?rev=3174963#L14 "Show revision 3174963 of this file in browser") | [r3210469](/browser/taskbuilder/tags/3.0.7/includes/admin/settings/wppm_set_priority_order.php?rev=3210469#L14 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 14 | 14 | if (is\_array($load\_orders)) { |
  | 15 | 15 | foreach($load\_orders as $key=>$val){ |
  | 16 |  | $result = $wpdb->query("UPDATE ".$wpdb->prefix."wppm\_task\_priorities SET load\_order=~~". esc\_sql($val)." WHERE id=".esc\_sql($key)~~ ); |
  |  | 16 | $result = $wpdb->query("UPDATE ".$wpdb->prefix."wppm\_task\_priorities SET load\_order='". esc\_sql($val)."' WHERE id='".esc\_sql($key)."'" ); |
  | 17 | 17 | } |
  | 18 | 18 | } |
* ## [taskbuilder/tags/3.0.7/includes/admin/settings/wppm\_set\_status\_order.php](/changeset/3210469/taskbuilder/tags/3.0.7/includes/admin/settings/wppm_set_status_order.php "Show the changeset 3210469 restricted to taskbuilder/tags/3.0.7/includes/admin/settings/wppm_set_status_order.php")

  | [r3174963](/browser/taskbuilder/trunk/includes/admin/settings/wppm_set_status_order.php?rev=3174963#L13 "Show revision 3174963 of this file in browser") | [r3210469](/browser/taskbuilder/tags/3.0.7/includes/admin/settings/wppm_set_status_order.php?rev=3210469#L13 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 13 | 13 | if (is\_array($load\_orders)) { |
  | 14 | 14 | foreach($load\_orders as $key=>$val){ |
  | 15 |  | $result = $wpdb->query("UPDATE ".$wpdb->prefix."wppm\_project\_statuses SET load\_order=~~". esc\_sql($val)." WHERE id=".esc\_sql($key)~~ ); |
  |  | 15 | $result = $wpdb->query("UPDATE ".$wpdb->prefix."wppm\_project\_statuses SET load\_order='".esc\_sql($val)."' WHERE id='".esc\_sql($key)."'" ); |
  | 16 | 16 | } |
  | 17 | 17 | } |
* ## [taskbuilder/tags/3.0.7/includes/admin/settings/wppm\_set\_task\_status\_order.php](/changeset/3210469/taskbuilder/tags/3.0.7/includes/admin/settings/wppm_set_task_status_order.php "Show the changeset 3210469 restricted to taskbuilder/tags/3.0.7/includes/admin/settings/wppm_set_task_status_order.php")

  | [r3174963](/browser/taskbuilder/trunk/includes/admin/settings/wppm_set_task_status_order.php?rev=3174963#L13 "Show revision 3174963 of this file in browser") | [r3210469](/browser/taskbuilder/tags/3.0.7/includes/admin/settings/wppm_set_task_status_order.php?rev=3210469#L13 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 13 | 13 | if (is\_array($load\_orders)) { |
  | 14 | 14 | foreach($load\_orders as $key=>$val){ |
  | 15 |  | $result = $wpdb->query("UPDATE ".$wpdb->prefix."wppm\_task\_statuses SET load\_order=~~". esc\_sql($val)." WHERE id=".esc\_sql($key)~~ ); |
  |  | 15 | $result = $wpdb->query("UPDATE ".$wpdb->prefix."wppm\_task\_statuses SET load\_order='".esc\_sql($val)."' WHERE id='".esc\_sql($key)."'"); |
  | 16 | 16 | } |
  | 17 | 17 | } |
* ## [taskbuilder/tags/3.0.7/includes/admin/tasks/open\_task/checklist/wppm\_delete\_checklist.php](/changeset/3210469/taskbuilder/tags/3.0.7/includes/admin/tasks/open_task/checklist/wppm_delete_checklist.php "Show the changeset 3210469 restricted to taskbuilder/tags/3.0.7/includes/admin/tasks/open_task/checklist/wppm_delete_checklist.php")

  | [r3174963](/browser/taskbuilder/trunk/includes/admin/tasks/open_task/checklist/wppm_delete_checklist.php?rev=3174963#L11 "Show revision 3174963 of this file in browser") | [r3210469](/browser/taskbuilder/tags/3.0.7/includes/admin/tasks/open_task/checklist/wppm_delete_checklist.php?rev=3210469#L11 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 11 | 11 | if (!$checklist\_id) {exit;} |
  | 12 | 12 | $checklist\_id = esc\_sql($checklist\_id); |
  | 13 |  | $wpdb->delete($wpdb->prefix.'wppm\_checklist\_items', array( 'checklist\_id' => ~~$checklist\_id~~)); |
  | 14 |  | $wpdb->delete($wpdb->prefix.'wppm\_checklist', array( 'id' => ~~$checklist\_id~~)); |
  |  | 13 | $wpdb->delete($wpdb->prefix.'wppm\_checklist\_items', array( 'checklist\_id' => "$checklist\_id")); |
  |  | 14 | $wpdb->delete($wpdb->prefix.'wppm\_checklist', array( 'id' => "$checklist\_id")); |
  | 15 | 15 |  |
* ## [taskbuilder/tags/3.0.7/includes/admin/tasks/open\_task/checklist/wppm\_remove\_checklist\_item.php](/changeset/3210469/taskbuilder/tags/3.0.7/includes/admin/tasks/open_task/checklist/wppm_remove_checklist_item.php "Show the changeset 3210469 restricted to taskbuilder/tags/3.0.7/includes/admin/tasks/open_task/checklist/wppm_remove_checklist_item.php")

  | [r3174963](/browser/taskbuilder/trunk/includes/admin/tasks/open_task/checklist/wppm_remove_checklist_item.php?rev=3174963#L11 "Show revision 3174963 of this file in browser") | [r3210469](/browser/taskbuilder/tags/3.0.7/includes/admin/tasks/open_task/checklist/wppm_remove_checklist_item.php?rev=3210469#L11 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 11 | 11 | if (!$item\_id) {exit;} |
  | 12 | 12 | $item\_id = esc\_sql($item\_id); |
  | 13 |  | $wpdb->delete($wpdb->prefix.'wppm\_checklist\_items', array( 'id' => ~~$item\_id~~)); |
  |  | 13 | $wpdb->delete($wpdb->prefix.'wppm\_checklist\_items', array( 'id' => "$item\_id")); |
* ## [taskbuilder/tags/3.0.7/includes/admin/tasks/open\_task/checklist/wppm\_set\_checklist\_progress.php](/changeset/3210469/taskbuilder/tags/3.0.7/includes/admin/tasks/open_task/checklist/wppm_set_checklist_progress.php "Show the changeset 3210469 restricted to taskbuilder/tags/3.0.7/includes/admin/tasks/open_task/checklist/wppm_set_checklist_progress.php")

  | [r3174963](/browser/taskbuilder/trunk/includes/admin/tasks/open_task/checklist/wppm_set_checklist_progress.php?rev=3174963#L10 "Show revision 3174963 of this file in browser") | [r3210469](/browser/taskbuilder/tags/3.0.7/includes/admin/tasks/open_task/checklist/wppm_set_checklist_progress.php?rev=3210469#L10 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 10 | 10 | if (!$checklist\_id) {exit;} |
  | 11 | 11 | $item\_id = isset($\_POST) && isset($\_POST['item\_id']) ? intval(sanitize\_text\_field($\_POST['item\_id'])) : ''; |
  |  | 12 | $item\_id = esc\_sql($item\_id); |
  | 12 | 13 | if (!$item\_id) {exit;} |
  | 13 | 14 | $checked\_item = isset($\_POST) && isset($\_POST['checked\_item']) ? intval(sanitize\_text\_field($\_POST['checked\_item'])) : ''; |
  | […](/browser/taskbuilder/trunk/includes/admin/tasks/open_task/checklist/wppm_set_checklist_progress.php?rev=3174963#L15) | […](/browser/taskbuilder/tags/3.0.7/includes/admin/tasks/open_task/checklist/wppm_set_checklist_progress.php?rev=3210469#L16) |  |
  | 15 | 16 | 'checked'=>esc\_sql($checked\_item) |
  | 16 | 17 | ); |
  | 17 |  | $wpdb->update($wpdb->prefix.'wppm\_checklist\_items',$values,array('id'=>intval(~~$item\_id~~))); |
  |  | 18 | $wpdb->update($wpdb->prefix.'wppm\_checklist\_items',$values,array('id'=>intval("$item\_id"))); |
  | 18 | 19 | echo '{ "sucess\_status":"1","messege":"Success" }'; |
* ## [taskbuilder/tags/3.0.7/includes/admin/tasks/open\_task/wppm\_edit\_task\_details.php](/changeset/3210469/taskbuilder/tags/3.0.7/includes/admin/tasks/open_task/wppm_edit_task_details.php "Show the changeset 3210469 restricted to taskbuilder/tags/3.0.7/includes/admin/tasks/open_task/wppm_edit_task_details.php")

  | [r3174963](/browser/taskbuilder/trunk/includes/admin/tasks/open_task/wppm_edit_task_details.php?rev=3174963#L13 "Show revision 3174963 of this file in browser") | [r3210469](/browser/taskbuilder/tags/3.0.7/includes/admin/tasks/open_task/wppm_edit_task_details.php?rev=3210469#L13 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 13 | 13 | $project\_data = $wppmfunction->get\_project(intval(sanitize\_text\_field($task\_data['project']))); |
  | 14 | 14 | if($current\_user->has\_cap('manage\_options')){ |
  | 15 |  | $projects = $wpdb->get\_results( "SELECT \* FROM {$wpdb->prefix}wppm\_project ORDER BY ~~".$orderby\_proj\_sql~~ ); |
  |  | 15 | $projects = $wpdb->get\_results( "SELECT \* FROM {$wpdb->prefix}wppm\_project ORDER BY $orderby\_proj\_sql" ); |
  | 16 | 16 | }else{ |
  | 17 | 17 | $query = ("SELECT Proj.\* |
  | 18 | 18 | FROM {$wpdb->prefix}wppm\_project AS Proj |
  | 19 | 19 | Left join {$wpdb->prefix}wppm\_project\_meta proj\_meta ON Proj.id = proj\_meta.project\_id |
  | 20 |  | where (FIND\_IN\_SET($current\_user->ID,Proj.users)) OR (Proj.id = proj\_meta.project\_id AND proj\_meta.meta\_key='public\_project' AND proj\_meta.meta\_value=1) Group by Proj.id ORDER BY ~~".$orderby\_proj\_sql~~); |
  |  | 20 | where (FIND\_IN\_SET($current\_user->ID,Proj.users)) OR (Proj.id = proj\_meta.project\_id AND proj\_meta.meta\_key='public\_project' AND proj\_meta.meta\_value=1) Group by Proj.id ORDER BY $orderby\_proj\_sql"); |
  | 21 | 21 | $projects = $wpdb->get\_results($query); |
  | 22 | 22 | } |
* ## [taskbuilder/tags/3.0.7/includes/admin/tasks/open\_task/wppm\_open\_task.php](/changeset/3210469/taskbuilder/tags/3.0.7/includes/admin/tasks/open_task/wppm_open_task.php "Show the changeset 3210469 restricted to taskbuilder/tags/3.0.7/includes/admin/tasks/open_task/wppm_open_task.php")

  | [r3191970](/browser/taskbuilder/trunk/includes/admin/tasks/open_task/wppm_open_task.php?rev=3191970#L18 "Show revision 3191970 of this file in browser") | [r3210469](/browser/taskbuilder/tags/3.0.7/includes/admin/tasks/open_task/wppm_open_task.php?rev=3210469#L18 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 18 | 18 | $current\_date = date('Y-m-d'); |
  | 19 | 19 | $wppm\_current\_user\_capability = get\_user\_meta( $current\_user->ID, 'wppm\_capability', true ); |
  |  | 20 | $cu\_id = $current\_user->ID; |
  | 20 | 21 | if(!empty($id)){ |
  | 21 |  | $task = $wpdb->get\_row( "SELECT \* FROM {$wpdb->prefix}wppm\_task where id='~~$id~~'"); |
  |  | 22 | $task = $wpdb->get\_row( "SELECT \* FROM {$wpdb->prefix}wppm\_task where id='".esc\_sql($id)."'"); |
  | 22 | 23 | $project\_data = $wppmfunction->get\_project($task->project); |
  |  | 24 | $task\_comment = $wpdb->get\_results( "SELECT \* FROM {$wpdb->prefix}wppm\_task\_comment where task\_id='".esc\_sql($id)."' ORDER BY create\_time DESC"); |
  | 23 | 25 | $orderby\_proj\_sql = esc\_sql(sanitize\_sql\_orderby( "create\_time DESC" )); |
  | 24 |  | $task\_comment = $wpdb->get\_results( "SELECT \* FROM {$wpdb->prefix}wppm\_task\_comment where task\_id=~~".$id." ORDER BY ".~~$orderby\_proj\_sql); |
  |  | 26 | $task\_comment = $wpdb->get\_results( "SELECT \* FROM {$wpdb->prefix}wppm\_task\_comment where task\_id='".esc\_sql($id)."' ORDER BY ". $orderby\_proj\_sql); |
  | 25 | 27 | $task\_proj = isset($task->project) ? esc\_sql($task->project) :""; |
  | 26 | 28 | $task\_id = isset($task->id) ? esc\_sql($task->id):""; |
  | 27 | 29 | } |
  | 28 |  | $user\_role = $wpdb->get\_var( "SELECT role\_id FROM {$wpdb->prefix}wppm\_project\_users where proj\_id = '$task\_proj' AND user\_id = '$cu~~rrent\_user->ID~~'"); |
  |  | 30 | $user\_role = $wpdb->get\_var( "SELECT role\_id FROM {$wpdb->prefix}wppm\_project\_users where proj\_id = '$task\_proj' AND user\_id = '$cu\_id'"); |
  | 29 | 31 | if(!empty($task\_proj)){ |
  | 30 | 32 | $project\_name = $wpdb->get\_var( "SELECT project\_name FROM {$wpdb->prefix}wppm\_project where id= '$task\_proj'"); |
  | […](/browser/taskbuilder/trunk/includes/admin/tasks/open_task/wppm_open_task.php?rev=3191970#L37) | […](/browser/taskbuilder/tags/3.0.7/includes/admin/tasks/open_task/wppm_open_task.php?rev=3210469#L39) |  |
  | 37 | 39 | if(!empty($task->priority)){ |
  | 38 | 40 | $task\_priority\_var = esc\_sql($task->priority); |
  | 39 |  | $task\_priority = $wpdb->get\_row( "SELECT \* FROM {$wpdb->prefix}wppm\_task\_priorities where id=~~".$task\_priority\_var~~); |
  |  | 41 | $task\_priority = $wpdb->get\_row( "SELECT \* FROM {$wpdb->prefix}wppm\_task\_priorities where id='$task\_priority\_var'"); |
  | 40 | 42 | } |
  | 41 | 43 | if(!empty($task->users)){ |
  | […](/browser/taskbuilder/trunk/includes/admin/tasks/open_task/wppm_open_task.php?rev=3191970#L64) | […](/browser/taskbuilder/tags/3.0.7/includes/admin/tasks/open_task/wppm_open_task.php?rev=3210469#L66) |  |
  | 64 | 66 | $tusers\_arr = explode(',',$tusers); |
  | 65 | 67 | $tproject\_id = $val\_array['project']; |
  |  | 68 | $tproject\_id = esc\_sql($tproject\_id); |
  | 66 | 69 | if(!empty($tusers) && in\_array($current\_user->ID,$tusers\_arr)){ |
  | 67 |  | $project\_user\_role = $wpdb->get\_var("SELECT role\_id FROM {$wpdb->prefix}wppm\_project\_users WHERE proj\_id = '$tproject\_id' AND user\_id = '$cu~~rrent\_user->ID~~'"); |
  |  | 70 | $project\_user\_role = $wpdb->get\_var("SELECT role\_id FROM {$wpdb->prefix}wppm\_project\_users WHERE proj\_id = '$tproject\_id' AND user\_id = '$cu\_id'"); |
  | 68 | 71 | $project\_users = $wpdb->get\_var("SELECT users FROM {$wpdb->prefix}wppm\_project WHERE id = '$tproject\_id'"); |
  | 69 | 72 | $project\_users\_arr = explode(',',(string)$project\_users); |
  | […](/browser/taskbuilder/trunk/includes/admin/tasks/open_task/wppm_open_task.php?rev=3191970#L75) | […](/browser/taskbuilder/tags/3.0.7/includes/admin/tasks/open_task/wppm_open_task.php?rev=3210469#L78) |  |
  | 75 | 78 | } |
  | 76 | 79 | } |
  | 77 |  | $project\_creator = $wpdb->get\_var("SELECT created\_by FROM {$wpdb->prefix}wppm\_project WHERE created\_by = '$cu~~rrent\_user->ID~~'"); |
  |  | 80 | $project\_creator = $wpdb->get\_var("SELECT created\_by FROM {$wpdb->prefix}wppm\_project WHERE created\_by = '$cu\_id'"); |
  | 78 | 81 | ?> |
  | 79 | 82 | <form id="wppm\_open\_task" method="post"> |
  | […](/browser/taskbuilder/trunk/includes/admin/tasks/open_task/wppm_open_task.php?rev=3191970#L310) | […](/browser/taskbuilder/tags/3.0.7/includes/admin/tasks/open_task/wppm_open_task.php?rev=3210469#L313) |  |
  | 310 | 313 | if(!empty($task\_comment)){ |
  | 311 | 314 | foreach($task\_comment as $comment){ |
  | 312 |  | $task\_comment\_meta = $wpdb->get\_row( "SELECT \* FROM {$wpdb->prefix}wppm\_task\_comment\_meta where task\_id=~~".$id." AND comment\_id=".$comment->id."~~"); |
  |  | 315 | $task\_comment\_meta = $wpdb->get\_row( "SELECT \* FROM {$wpdb->prefix}wppm\_task\_comment\_meta where task\_id='".esc\_sql($id)."' AND comment\_id='".esc\_sql($comment->id)."'"); |
  | 313 | 316 | $user = get\_userdata( $comment->created\_by ); |
  | 314 | 317 | $comment\_body = stripslashes((htmlspecialchars\_decode($comment->body, ENT\_QUOTES))); |
  | […](/browser/taskbuilder/trunk/includes/admin/tasks/open_task/wppm_open_task.php?rev=3191970#L433) | […](/browser/taskbuilder/tags/3.0.7/includes/admin/tasks/open_task/wppm_open_task.php?rev=3210469#L436) |  |
  | 433 | 436 | if(!empty($attachments)){ |
  | 434 | 437 | foreach( $attachments as $attachment ): |
  |  | 438 | $download\_url = site\_url('/').'?wppm\_attachment='.$attachment.'&tid="'.$comment->id.'"&tac='.$auth\_id; |
  | 435 | 439 | $attachment = esc\_sql($attachment); |
  | 436 | 440 | $attach = $wpdb->get\_row( "SELECT \* FROM {$wpdb->prefix}wppm\_attachments where id='$attachment'"); |
  | 437 |  | ~~$download\_url = site\_url('/').'?wppm\_attachment='.$attachment.'&tid='.$id.'&tac='.$auth\_id;~~ |
  | 438 | 441 | $findStr = ".txt"; |
  | 439 | 442 | if(!empty( $attach)){ |
* ## [taskbuilder/tags/3.0.7/includes/admin/tasks/open\_task/wppm\_set\_change\_raised\_by.php](/changeset/3210469/taskbuilder/tags/3.0.7/includes/admin/tasks/open_task/wppm_set_change_raised_by.php "Show the changeset 3210469 restricted to taskbuilder/tags/3.0.7/includes/admin/tasks/open_task/wppm_set_change_raised_by.php")

  | [r3174963](/browser/taskbuilder/trunk/includes/admin/tasks/open_task/wppm_set_change_raised_by.php?rev=3174963#L5 "Show revision 3174963 of this file in browser") | [r3210469](/browser/taskbuilder/tags/3.0.7/includes/admin/tasks/open_task/wppm_set_change_raised_by.php?rev=3210469#L5 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 5 | 5 | global $current\_user,$wppmfunction,$wpdb; |
  | 6 | 6 | $task\_id = isset($\_POST['task\_id'])  ? intval(sanitize\_text\_field($\_POST['task\_id'])) : ''; |
  | 7 |  |  |
  | 8 | 7 | if (!(($current\_user->ID && $current\_user->has\_cap('manage\_options')) || $wppmfunction->has\_permission('change\_raised\_by',$task\_id))) {exit;} |
  | 9 | 8 | if ( check\_ajax\_referer( 'wppm\_set\_change\_raised\_by', '\_ajax\_nonce', false ) != 1 ) { |
  | […](/browser/taskbuilder/trunk/includes/admin/tasks/open_task/wppm_set_change_raised_by.php?rev=3174963#L13) | […](/browser/taskbuilder/tags/3.0.7/includes/admin/tasks/open_task/wppm_set_change_raised_by.php?rev=3210469#L12) |  |
  | 13 | 12 | $task\_data = $wppmfunction->get\_task($task\_id); |
  | 14 | 13 | $old\_user\_id  = $task\_data['created\_by']; |
  | 15 |  |  |
  |  | 14 | $cu\_id = esc\_sql($current\_user->ID); |
  | 16 | 15 | if ( $user\_id != $old\_user\_id ){ |
  | 17 | 16 | $wppmfunction->change\_raised\_by($task\_id, $user\_id); |
  | 18 | 17 | $change\_creator\_value = array('prev\_user'=>"$old\_user\_id",'new\_user'=>"$user\_id"); |
  | 19 | 18 | $change\_creator\_obj = serialize($change\_creator\_value); |
  | 20 |  | $log\_values = array('task\_id'=>$task\_id,'body'=>$change\_creator\_obj,'attachment\_ids'=>"",'create\_time'=>date("Y-m-d h:i:sa"),'created\_by'=>$current\_user->ID, ); |
  |  | 19 | $task\_id = esc\_sql($task\_id); |
  |  | 20 | $log\_values = array('task\_id'=>"$task\_id",'body'=>$change\_creator\_obj,'attachment\_ids'=>"",'create\_time'=>date("Y-m-d h:i:sa"),'created\_by'=>"$cu\_id", ); |
  | 21 | 21 | $wpdb->insert($wpdb->prefix . 'wppm\_task\_comment',$log\_values); |
  | 22 |  | $log\_id = ~~$wpdb->insert\_id~~; |
  | 23 |  | $task\_log\_values = array('task\_id'=>~~$task\_id,'comment\_id'=>$log\_id~~,'comment\_type'=>'change\_task\_creator'); |
  |  | 22 | $log\_id = esc\_sql($wpdb->insert\_id); |
  |  | 23 | $task\_log\_values = array('task\_id'=>"$task\_id",'comment\_id'=>"$log\_id",'comment\_type'=>'change\_task\_creator'); |
  | 24 | 24 | $wpdb->insert($wpdb->prefix . 'wppm\_task\_comment\_meta',$task\_log\_values); |
  | 25 | 25 | } |
* ## [taskbuilder/tags/3.0.7/includes/admin/tasks/open\_task/wppm\_set\_change\_task\_details.php](/changeset/3210469/taskbuilder/tags/3.0.7/includes/admin/tasks/open_task/wppm_set_change_task_details.php "Show the changeset 3210469 restricted to taskbuilder/tags/3.0.7/includes/admin/tasks/open_task/wppm_set_change_task_details.php")

  | [r3158191](/browser/taskbuilder/trunk/includes/admin/tasks/open_task/wppm_set_change_task_details.php?rev=3158191#L5 "Show revision 3158191 of this file in browser") | [r3210469](/browser/taskbuilder/tags/3.0.7/includes/admin/tasks/open_task/wppm_set_change_task_details.php?rev=3210469#L5 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 5 | 5 | global $wpdb,$wppmfunction,$current\_user; |
  | 6 | 6 | $task\_id  = isset($\_POST['task\_id']) ? intval(sanitize\_text\_field($\_POST['task\_id'])) : '' ; |
  |  | 7 | $task\_id = esc\_sql($task\_id); |
  | 7 | 8 | $proj\_id =  isset($\_POST['proj\_id']) ? intval(sanitize\_text\_field($\_POST['proj\_id'])) : '' ; |
  | 8 | 9 | if (!(($current\_user->ID && $current\_user->has\_cap('manage\_options')) || $wppmfunction->has\_permission('change\_task\_details',$task\_id))) {exit;} |
  | […](/browser/taskbuilder/trunk/includes/admin/tasks/open_task/wppm_set_change_task_details.php?rev=3158191#L38) | […](/browser/taskbuilder/tags/3.0.7/includes/admin/tasks/open_task/wppm_set_change_task_details.php?rev=3210469#L39) |  |
  | 38 | 39 | $change\_priority\_value = array('prev\_prio'=>"$task\_data[priority]",'new\_prio'=>"$task\_priority"); |
  | 39 | 40 | $change\_priority\_obj = serialize($change\_priority\_value); |
  | 40 |  | $log\_values = array('task\_id'=>~~$task\_id,'body'=>$change\_priority\_obj,'attachment\_ids'=>"",'create\_time'=>date("Y-m-d h:i:sa"),'created\_by'=>$current\_user->ID~~ ); |
  |  | 41 | $log\_values = array('task\_id'=>esc\_sql($task\_id),'body'=>$change\_priority\_obj,'attachment\_ids'=>"",'create\_time'=>date("Y-m-d h:i:sa"),'created\_by'=>esc\_sql($current\_user->ID) ); |
  | 41 | 42 | $wpdb->insert($wpdb->prefix . 'wppm\_task\_comment',$log\_values); |
  | 42 |  | $log\_id = ~~$wpdb->insert\_id~~; |
  | 43 |  | $task\_log\_values = array('task\_id'=>~~$task\_id,'comment\_id'=>$log\_id~~,'comment\_type'=>'change\_task\_priority'); |
  |  | 43 | $log\_id = esc\_sql($wpdb->insert\_id); |
  |  | 44 | $task\_log\_values = array('task\_id'=>esc\_sql($task\_id),'comment\_id'=>"$log\_id",'comment\_type'=>'change\_task\_priority'); |
  | 44 | 45 | $wpdb->insert($wpdb->prefix . 'wppm\_task\_comment\_meta',$task\_log\_values); |
  | 45 | 46 | } |
* ## [taskbuilder/tags/3.0.7/includes/admin/tasks/open\_task/wppm\_set\_change\_task\_status.php](/changeset/3210469/taskbuilder/tags/3.0.7/includes/admin/tasks/open_task/wppm_set_change_task_status.php "Show the changeset 3210469 restricted to taskbuilder/tags/3.0.7/includes/admin/tasks/open_task/wppm_set_change_task_status.php")

  | [r3158191](/browser/taskbuilder/trunk/includes/admin/tasks/open_task/wppm_set_change_task_status.php?rev=3158191#L5 "Show revision 3158191 of this file in browser") | [r3210469](/browser/taskbuilder/tags/3.0.7/includes/admin/tasks/open_task/wppm_set_change_task_status.php?rev=3210469#L5 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 5 | 5 | global $current\_user,$wppmfunction,$wpdb; |
  | 6 | 6 |  |
  | 7 |  | $task\_id    = isset($\_POST['task\_id'])  ? sanitize\_text\_field($\_POST['task\_id']) : ''; |
  |  | 7 | $task\_id    = isset($\_POST['task\_id'])  ? intval(sanitize\_text\_field($\_POST['task\_id'])) : ''; |
  |  | 8 | $cu\_id =  esc\_sql($current\_user->ID); |
  | 8 | 9 | if (!(($current\_user->ID && $current\_user->has\_cap('manage\_options')) || $wppmfunction->has\_permission('change\_status',$task\_id))) {exit;} |
  | 9 | 10 | if ( check\_ajax\_referer( 'wppm\_set\_change\_task\_status', '\_ajax\_nonce', false ) != 1 ) { |
  | […](/browser/taskbuilder/trunk/includes/admin/tasks/open_task/wppm_set_change_task_status.php?rev=3158191#L18) | […](/browser/taskbuilder/tags/3.0.7/includes/admin/tasks/open_task/wppm_set_change_task_status.php?rev=3210469#L19) |  |
  | 18 | 19 | if($status\_id && $status\_id!=$old\_status\_id){ |
  | 19 | 20 | $wppmfunction->change\_status( $task\_id, $status\_id); |
  | 20 |  | $change\_task\_value = array('prev\_status'=>"$task\_data[status]",'new\_status'=>"$status\_id"); |
  |  | 21 | $task\_id = esc\_sql($task\_id); |
  |  | 22 | $old\_status\_id  = esc\_sql($old\_status\_id); |
  |  | 23 | $status\_id = esc\_sql($status\_id); |
  |  | 24 | $change\_task\_value = array('prev\_status'=>"$old\_status\_id",'new\_status'=>"$status\_id"); |
  | 21 | 25 | $change\_task\_obj = serialize($change\_task\_value); |
  | 22 |  | $log\_values = array('task\_id'=>~~$task\_id,'body'=>$change\_task\_obj,'attachment\_ids'=>"",'create\_time'=>date("Y-m-d h:i:sa"),'created\_by'=>$current\_user->ID~~ ); |
  |  | 26 | $log\_values = array('task\_id'=>"$task\_id",'body'=>$change\_task\_obj,'attachment\_ids'=>"",'create\_time'=>date("Y-m-d h:i:sa"),'created\_by'=>"$cu\_id" ); |
  | 23 | 27 | $wpdb->insert($wpdb->prefix . 'wppm\_task\_comment',$log\_values); |
  | 24 |  | $log\_id = ~~$wpdb->insert\_id~~; |
  | 25 |  | $task\_log\_values = array('task\_id'=>~~$task\_id,'comment\_id'=>$log\_id~~,'comment\_type'=>'change\_task\_status'); |
  |  | 28 | $log\_id = esc\_sql($wpdb->insert\_id); |
  |  | 29 | $task\_log\_values = array('task\_id'=>"$task\_id",'comment\_id'=>"$log\_id",'comment\_type'=>'change\_task\_status'); |
  | 26 | 30 | $wpdb->insert($wpdb->prefix . 'wppm\_task\_comment\_meta',$task\_log\_values); |
  | 27 | 31 | } |
* ## [taskbuilder/tags/3.0.7/includes/admin/tasks/open\_task/wppm\_set\_clone\_task.php](/changeset/3210469/taskbuilder/tags/3.0.7/includes/admin/tasks/open_task/wppm_set_clone_task.php "Show the changeset 3210469 restricted to taskbuilder/tags/3.0.7/includes/admin/tasks/open_task/wppm_set_clone_task.php")

  | [r3174963](/browser/taskbuilder/trunk/includes/admin/tasks/open_task/wppm_set_clone_task.php?rev=3174963#L20 "Show revision 3174963 of this file in browser") | [r3210469](/browser/taskbuilder/tags/3.0.7/includes/admin/tasks/open_task/wppm_set_clone_task.php?rev=3210469#L20 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 20 | 20 | $checklists = $wppmfunction->get\_checklist($prev\_task\_id); |
  | 21 | 21 | $task\_project = isset($project\_id) ? $project\_id : $task['project']; |
  |  | 22 | $prev\_task\_id = esc\_sql($prev\_task\_id); |
  | 22 | 23 | $task\_comments = $wpdb->get\_results("SELECT \* FROM {$wpdb->prefix}wppm\_task\_comment WHERE task\_id='$prev\_task\_id' "); |
  | 23 | 24 | $task\_name    = isset($\_POST['task\_name']) ? stripslashes(sanitize\_text\_field($\_POST['task\_name'])) : $task['task\_name'] ; |
  | […](/browser/taskbuilder/trunk/includes/admin/tasks/open_task/wppm_set_clone_task.php?rev=3174963#L105) | […](/browser/taskbuilder/tags/3.0.7/includes/admin/tasks/open_task/wppm_set_clone_task.php?rev=3210469#L106) |  |
  | 105 | 106 | $comment\_id = $wppmfunction->wppm\_submit\_task\_comment($args); |
  | 106 | 107 | $task\_comm\_id = esc\_sql($task\_comment->id); |
  | 107 |  | $task\_comment\_type = $wpdb->get\_var( "SELECT comment\_type FROM {$wpdb->prefix}wppm\_task\_comment\_meta where task\_id=~~".$prev\_task\_id."~~ AND comment\_id='$task\_comm\_id'"); |
  |  | 108 | $task\_comment\_type = $wpdb->get\_var( "SELECT comment\_type FROM {$wpdb->prefix}wppm\_task\_comment\_meta where task\_id='$prev\_task\_id' AND comment\_id='$task\_comm\_id'"); |
  | 108 | 109 | if(!empty($task\_comment\_type)){ |
  | 109 | 110 | $meta\_values = array( |
* ## [taskbuilder/tags/3.0.7/includes/admin/tasks/open\_task/wppm\_set\_delete\_thread.php](/changeset/3210469/taskbuilder/tags/3.0.7/includes/admin/tasks/open_task/wppm_set_delete_thread.php "Show the changeset 3210469 restricted to taskbuilder/tags/3.0.7/includes/admin/tasks/open_task/wppm_set_delete_thread.php")

  | [r3174963](/browser/taskbuilder/trunk/includes/admin/tasks/open_task/wppm_set_delete_thread.php?rev=3174963#L12 "Show revision 3174963 of this file in browser") | [r3210469](/browser/taskbuilder/tags/3.0.7/includes/admin/tasks/open_task/wppm_set_delete_thread.php?rev=3210469#L12 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 12 | 12 | wp\_send\_json\_error( 'Unauthorised request!', 401 ); |
  | 13 | 13 | } |
  |  | 14 | $thread\_id = esc\_sql($thread\_id); |
  |  | 15 | $task\_id = esc\_sql($task\_id); |
  | 14 | 16 | $sql="SELECT attachment\_ids FROM {$wpdb->prefix}wppm\_task\_comment WHERE id ='$thread\_id'"; |
  | 15 | 17 | $thread\_attachment\_ids = $wpdb->get\_results( $sql ); |
  | […](/browser/taskbuilder/trunk/includes/admin/tasks/open_task/wppm_set_delete_thread.php?rev=3174963#L23) | […](/browser/taskbuilder/tags/3.0.7/includes/admin/tasks/open_task/wppm_set_delete_thread.php?rev=3210469#L25) |  |
  | 23 | 25 | if(!empty($attachment\_ids\_temp)){ |
  | 24 | 26 | foreach ($attachment\_ids\_temp as $attachment\_id){ |
  |  | 27 | $attachment\_id = esc\_sql($attachment\_id); |
  | 25 | 28 | $sql="SELECT \* FROM {$wpdb->prefix}wppm\_attachments WHERE id = '$attachment\_id'"; |
  | 26 | 29 | $result=$wpdb->get\_row($sql); |
  | 27 | 30 | if(!empty($result)){ |
  | 28 |  | $sql\_query="SELECT file\_path FROM {$wpdb->prefix}wppm\_attachments WHERE file\_path ='".~~$result->file\_path~~."'"; |
  |  | 31 | $sql\_query="SELECT file\_path FROM {$wpdb->prefix}wppm\_attachments WHERE file\_path ='".esc\_sql($result->file\_path)."'"; |
  | 29 | 32 | $attach\_result=$wpdb->get\_results($sql\_query); |
  | 30 | 33 | $result\_count = count($attach\_result); |
  | […](/browser/taskbuilder/trunk/includes/admin/tasks/open_task/wppm_set_delete_thread.php?rev=3174963#L40) | […](/browser/taskbuilder/tags/3.0.7/includes/admin/tasks/open_task/wppm_set_delete_thread.php?rev=3210469#L43) |  |
  | 40 | 43 | } |
  | 41 | 44 | $cur\_user = get\_userdata($current\_user->ID); |
  | 42 |  | $~~thread\_id = esc\_sql($thread\_id)~~; |
  | 43 |  | $log\_values = array('task\_id'=>~~$task\_id,'body'=>'This comment was deleted by '.$cur\_user->~~display\_name,'attachment\_ids'=>"" ); |
  | 44 |  | $wpdb->update($wpdb->prefix.'wppm\_task\_comment', $log\_values, array('id'=>~~$thread\_id~~)); |
  | 45 |  | $task\_log\_values = array('task\_id'=>~~$task\_id,'comment\_id'=>$thread\_id~~,'comment\_type'=>'delete\_task\_comment'); |
  |  | 45 | $cur\_user\_display\_name = $cur\_user->display\_name; |
  |  | 46 | $log\_values = array('task\_id'=>"$task\_id",'body'=>'This comment was deleted by '.$cur\_user\_display\_name,'attachment\_ids'=>"" ); |
  |  | 47 | $wpdb->update($wpdb->prefix.'wppm\_task\_comment', $log\_values, array('id'=>"$thread\_id")); |
  |  | 48 | $task\_log\_values = array('task\_id'=>"$task\_id",'comment\_id'=>"$thread\_id",'comment\_type'=>'delete\_task\_comment'); |
  | 46 | 49 | $comment\_meta = $wpdb->get\_row("SELECT \* FROM {$wpdb->prefix}wppm\_task\_comment\_meta WHERE comment\_id='$thread\_id' "); |
  | 47 | 50 | if(!empty($comment\_meta)){ |
  | 48 |  | $wpdb->update($wpdb->prefix . 'wppm\_task\_comment\_meta',$task\_log\_values,array('id'=>$comment\_meta->id)); |
  |  | 51 | $comment\_meta\_id = esc\_sql($comment\_meta->id); |
  |  | 52 | $wpdb->update($wpdb->prefix . 'wppm\_task\_comment\_meta',$task\_log\_values,array('id'=>"$comment\_meta\_id")); |
  | 49 | 53 | }else{ |
  | 50 | 54 | $wpdb->insert($wpdb->prefix . 'wppm\_task\_comment\_meta',$task\_log\_values); |
* ## [taskbuilder/tags/3.0.7/includes/admin/tasks/open\_task/wppm\_set\_task\_users.php](/changeset/3210469/taskbuilder/tags/3.0.7/includes/admin/tasks/open_task/wppm_set_task_users.php "Show the changeset 3210469 restricted to taskbuilder/tags/3.0.7/includes/admin/tasks/open_task/wppm_set_task_users.php")

  | [r3158191](/browser/taskbuilder/trunk/includes/admin/tasks/open_task/wppm_set_task_users.php?rev=3158191#L5 "Show revision 3158191 of this file in browser") | [r3210469](/browser/taskbuilder/tags/3.0.7/includes/admin/tasks/open_task/wppm_set_task_users.php?rev=3210469#L5 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 5 | 5 | global $wpdb,$wppmfunction,$current\_user; |
  | 6 | 6 | $task\_id  = isset($\_POST['task\_id']) ? intval(sanitize\_text\_field($\_POST['task\_id'])) : '' ; |
  |  | 7 | $cu\_id = esc\_sql($current\_user->ID); |
  | 7 | 8 | if (!(($current\_user->ID && $current\_user->has\_cap('manage\_options')) || $wppmfunction->has\_permission('assign\_task\_users',$task\_id))) {exit;} |
  | 8 | 9 | if ( check\_ajax\_referer( 'wppm\_set\_task\_users', '\_ajax\_nonce', false ) != 1 ) { |
  | […](/browser/taskbuilder/trunk/includes/admin/tasks/open_task/wppm_set_task_users.php?rev=3158191#L30) | […](/browser/taskbuilder/tags/3.0.7/includes/admin/tasks/open_task/wppm_set_task_users.php?rev=3210469#L31) |  |
  | 30 | 31 | if(isset($users)){ |
  | 31 | 32 | $values=array( |
  | 32 |  | 'users'=> ~~$users~~ |
  |  | 33 | 'users'=> esc\_sql($users) |
  | 33 | 34 | ); |
  | 34 | 35 | }else{ |
  | […](/browser/taskbuilder/trunk/includes/admin/tasks/open_task/wppm_set_task_users.php?rev=3158191#L38) | […](/browser/taskbuilder/tags/3.0.7/includes/admin/tasks/open_task/wppm_set_task_users.php?rev=3210469#L39) |  |
  | 38 | 39 | } |
  | 39 | 40 | if(($users != $task\_data['users'])){ |
  | 40 |  | $wpdb->update($wpdb->prefix.'wppm\_task', $values, array('id'=>$task\_id)); |
  |  | 41 | $task\_id = esc\_sql($task\_id); |
  |  | 42 | $wpdb->update($wpdb->prefix.'wppm\_task', $values, array('id'=>"$task\_id")); |
  | 41 | 43 | $change\_assign\_user\_value = array('prev\_assign\_user'=>"$task\_data[users]",'new\_assign\_user'=>"$users"); |
  | 42 | 44 | $change\_assign\_user\_obj = serialize($change\_assign\_user\_value); |
  | 43 |  | $log\_values = array('task\_id'=>~~$task\_id,'body'=>$change\_assign\_user\_obj,'attachment\_ids'=>"",'create\_time'=>date("Y-m-d h:i:sa"),'created\_by'=>$current\_user->ID~~ ); |
  |  | 45 | $log\_values = array('task\_id'=>"$task\_id",'body'=>$change\_assign\_user\_obj,'attachment\_ids'=>"",'create\_time'=>date("Y-m-d h:i:sa"),'created\_by'=>"$cu\_id" ); |
  | 44 | 46 | $wpdb->insert($wpdb->prefix . 'wppm\_task\_comment',$log\_values); |
  | 45 |  | $log\_id = ~~$wpdb->insert\_id~~; |
  | 46 |  | $task\_log\_values = array('task\_id'=>~~$task\_id,'comment\_id'=>$log\_id~~,'comment\_type'=>'change\_assign\_user'); |
  |  | 47 | $log\_id = esc\_sql($wpdb->insert\_id); |
  |  | 48 | $task\_log\_values = array('task\_id'=>"$task\_id",'comment\_id'=>"$log\_id",'comment\_type'=>'change\_assign\_user'); |
  | 47 | 49 | $wpdb->insert($wpdb->prefix . 'wppm\_task\_comment\_meta',$task\_log\_values); |
  | 48 | 50 | do\_action('wppm\_set\_task\_users', $task\_id); |
* ## [taskbuilder/tags/3.0.7/includes/admin/tasks/open\_task/wppm\_submit\_task\_comment.php](/changeset/3210469/taskbuilder/tags/3.0.7/includes/admin/tasks/open_task/wppm_submit_task_comment.php "Show the changeset 3210469 restricted to taskbuilder/tags/3.0.7/includes/admin/tasks/open_task/wppm_submit_task_comment.php")

  | [r3174963](/browser/taskbuilder/trunk/includes/admin/tasks/open_task/wppm_submit_task_comment.php?rev=3174963#L22 "Show revision 3174963 of this file in browser") | [r3210469](/browser/taskbuilder/tags/3.0.7/includes/admin/tasks/open_task/wppm_submit_task_comment.php?rev=3210469#L22 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 22 | 22 | 'body'=>$comment\_body, |
  | 23 | 23 | 'attachment\_ids'=>$attachment\_ids, |
  | 24 |  | 'create\_time'=>~~current\_time('mysql', 1~~), |
  |  | 24 | 'create\_time'=>date("Y-m-d h:i:sa"), |
  | 25 | 25 | 'created\_by'=>$current\_user->ID |
  | 26 | 26 | ); |
  | 27 | 27 | $args = apply\_filters( 'wppm\_submit\_comment\_args', $args ); |
  | 28 | 28 | $comment\_id = $wppmfunction->wppm\_submit\_task\_comment($args); |
  | 29 |  | $task\_log\_values = array('task\_id'=>~~$task\_id,'comment\_id'=>$comment\_id~~,'comment\_type'=>'comment'); |
  |  | 29 | $task\_log\_values = array('task\_id'=>esc\_sql($task\_id),'comment\_id'=>esc\_sql($comment\_id),'comment\_type'=>'comment'); |
  | 30 | 30 | $wpdb->insert($wpdb->prefix . 'wppm\_task\_comment\_meta',$task\_log\_values); |
  | 31 | 31 | do\_action('wppm\_after\_submit\_task\_comment', $task\_id,$comment\_id); |
* ## [taskbuilder/tags/3.0.7/includes/admin/tasks/open\_task/wppm\_thread\_attachment\_remove.php](/changeset/3210469/taskbuilder/tags/3.0.7/includes/admin/tasks/open_task/wppm_thread_attachment_remove.php "Show the changeset 3210469 restricted to taskbuilder/tags/3.0.7/includes/admin/tasks/open_task/wppm_thread_attachment_remove.php")

  | [r3174963](/browser/taskbuilder/trunk/includes/admin/tasks/open_task/wppm_thread_attachment_remove.php?rev=3174963#L9 "Show revision 3174963 of this file in browser") | [r3210469](/browser/taskbuilder/tags/3.0.7/includes/admin/tasks/open_task/wppm_thread_attachment_remove.php?rev=3210469#L9 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 9 | 9 | } |
  | 10 | 10 | $attachment     = isset($\_POST['attachment']) ? intval(sanitize\_text\_field($\_POST['attachment'])) : '0' ; |
  | 11 |  | $comment\_id = isset($\_POST['comment\_id']) ? intval(sanitize\_text\_field($\_POST['comment\_id'])) : '0' ; |
  | 12 |  | $task\_id = isset($\_POST['task\_id']) ? intval(sanitize\_text\_field($\_POST['task\_id'])) : '0' ; |
  |  | 11 | $attachment     = esc\_sql($attachment); |
  |  | 12 | $comment\_id     = isset($\_POST['comment\_id']) ? intval(sanitize\_text\_field($\_POST['comment\_id'])) : '0' ; |
  |  | 13 | $task\_id        = isset($\_POST['task\_id']) ? intval(sanitize\_text\_field($\_POST['task\_id'])) : '0' ; |
  |  | 14 | $comment\_id     = esc\_sql($comment\_id); |
  |  | 15 | $task\_id        = esc\_sql($task\_id); |
  | 13 | 16 | $task\_comment = $wpdb->get\_row( "SELECT \* FROM {$wpdb->prefix}wppm\_task\_comment where id = '$comment\_id' AND task\_id='$task\_id'"); |
  | 14 | 17 | if(!(((!empty($task\_comment)) && ($task\_comment->created\_by == $current\_user->ID)) || ($current\_user->has\_cap('manage\_options')) || ($wppmfunction->has\_comment\_permission('edit\_task\_comment',$task\_id,$comment\_id)))){ |
  | 15 | 18 | exit; |
  | 16 | 19 | } |
  | 17 |  | $sql="SELECT \* FROM {$wpdb->prefix}wppm\_attachments WHERE id = ~~$attachment~~"; |
  |  | 20 | $sql="SELECT \* FROM {$wpdb->prefix}wppm\_attachments WHERE id = '$attachment'"; |
  | 18 | 21 | $result=$wpdb->get\_row($sql); |
  | 19 |  | $sql\_query="SELECT file\_path FROM {$wpdb->prefix}wppm\_attachments WHERE file\_path ='".~~$result->file\_path~~."'"; |
  |  | 22 | $sql\_query="SELECT file\_path FROM {$wpdb->prefix}wppm\_attachments WHERE file\_path ='".esc\_sql($result->file\_path)."'"; |
  | 20 | 23 | $attach\_result=$wpdb->get\_results($sql\_query); |
  | 21 | 24 | $result\_count = count($attach\_result); |
  | […](/browser/taskbuilder/trunk/includes/admin/tasks/open_task/wppm_thread_attachment_remove.php?rev=3174963#L26) | […](/browser/taskbuilder/tags/3.0.7/includes/admin/tasks/open_task/wppm_thread_attachment_remove.php?rev=3210469#L29) |  |
  | 26 | 29 | $success = $wpdb->delete( |
  | 27 | 30 | $wpdb->prefix . 'wppm\_attachments', |
  | 28 |  | array( 'id' => ~~$attachment~~ ) |
  |  | 31 | array( 'id' => "$attachment" ) |
  | 29 | 32 | ); |
  | 30 | 33 | if( !$success ) return false; |
  | […](/browser/taskbuilder/trunk/includes/admin/tasks/open_task/wppm_thread_attachment_remove.php?rev=3174963#L40) | […](/browser/taskbuilder/tags/3.0.7/includes/admin/tasks/open_task/wppm_thread_attachment_remove.php?rev=3210469#L43) |  |
  | 40 | 43 | $tattachment = implode(',',$task\_attachment); |
  | 41 | 44 | $values=array( |
  | 42 |  | 'attachment\_ids'=>~~$tattachment~~ |
  |  | 45 | 'attachment\_ids'=>esc\_sql($tattachment) |
  | 43 | 46 | ); |
  | 44 |  | $wpdb->update($wpdb->prefix.'wppm\_task\_comment', $values, array('id'=>~~$comment\_id~~)); |
  |  | 47 | $wpdb->update($wpdb->prefix.'wppm\_task\_comment', $values, array('id'=>"$comment\_id")); |
  | 45 | 48 | $attachment = apply\_filters('wppm\_after\_delete\_comment\_attachment',$attachment,$comment\_id,$task\_id); |
* ## [taskbuilder/tags/3.0.7/includes/admin/tasks/open\_task/wppm\_upload\_file.php](/changeset/3210469/taskbuilder/tags/3.0.7/includes/admin/tasks/open_task/wppm_upload_file.php "Show the changeset 3210469 restricted to taskbuilder/tags/3.0.7/includes/admin/tasks/open_task/wppm_upload_file.php")

  | [r3123269](/browser/taskbuilder/trunk/includes/admin/tasks/open_task/wppm_upload_file.php?rev=3123269#L74 "Show revision 3123269 of this file in browser") | [r3210469](/browser/taskbuilder/tags/3.0.7/includes/admin/tasks/open_task/wppm_upload_file.php?rev=3210469#L74 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 74 | 74 | move\_uploaded\_file( $\_FILES['file']['tmp\_name'], $save\_directory ); |
  | 75 | 75 | } |
  | 76 |  |  |
  |  | 76 | $save\_file\_name = esc\_sql($save\_file\_name); |
  |  | 77 | $file\_name = esc\_sql($file\_name); |
  |  | 78 | $save\_directory = esc\_sql($save\_directory); |
  |  | 79 | $is\_image = esc\_sql($is\_image); |
  |  | 80 | $now = esc\_sql($now); |
  | 77 | 81 | $values=array( |
  | 78 | 82 | 'name'=>$save\_file\_name, |
* ## [taskbuilder/tags/3.0.7/includes/admin/tasks/wppm\_add\_new\_task.php](/changeset/3210469/taskbuilder/tags/3.0.7/includes/admin/tasks/wppm_add_new_task.php "Show the changeset 3210469 restricted to taskbuilder/tags/3.0.7/includes/admin/tasks/wppm_add_new_task.php")

  | [r3191970](/browser/taskbuilder/trunk/includes/admin/tasks/wppm_add_new_task.php?rev=3191970#L6 "Show revision 3191970 of this file in browser") | [r3210469](/browser/taskbuilder/tags/3.0.7/includes/admin/tasks/wppm_add_new_task.php?rev=3210469#L6 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 6 | 6 | $proj\_id = isset($\_POST['proj\_id']) ? intval(sanitize\_text\_field($\_POST['proj\_id'])) : 0 ; |
  | 7 | 7 | $orderby\_prio\_sql = esc\_sql(sanitize\_sql\_orderby( "name" )); |
  | 8 |  | $priorities = $wpdb->get\_results( "SELECT \* FROM {$wpdb->prefix}wppm\_task\_priorities ORDER BY ".$orderby\_prio\_sql ); |
  |  | 8 | $cu\_id = esc\_sql($current\_user->ID); |
  |  | 9 | $priorities = $wpdb->get\_results( "SELECT \* FROM {$wpdb->prefix}wppm\_task\_priorities ORDER BY '$orderby\_prio\_sql'" ); |
  | 9 | 10 | $wppm\_current\_user\_capability = get\_user\_meta( $current\_user->ID, 'wppm\_capability', true ); |
  | 10 | 11 | $wppm\_create\_tasks\_coworkers\_permission = get\_option('wppm\_allow\_coworkers\_create\_task'); |
  | 11 | 12 | if($current\_user->has\_cap('manage\_options') || $wppm\_current\_user\_capability=='wppm\_admin'){ |
  | 12 | 13 | $orderby\_proj\_sql = esc\_sql(sanitize\_sql\_orderby( "project\_name" )); |
  | 13 |  | $query = ( "SELECT \* FROM {$wpdb->prefix}wppm\_project ORDER BY ~~".$orderby\_proj\_sql~~ ); |
  |  | 14 | $query = ( "SELECT \* FROM {$wpdb->prefix}wppm\_project ORDER BY '$orderby\_proj\_sql'" ); |
  | 14 | 15 | $where = ""; |
  | 15 | 16 | }else{ |
  | […](/browser/taskbuilder/trunk/includes/admin/tasks/wppm_add_new_task.php?rev=3191970#L21) | […](/browser/taskbuilder/tags/3.0.7/includes/admin/tasks/wppm_add_new_task.php?rev=3210469#L22) |  |
  | 21 | 22 | "); |
  | 22 | 23 | if($wppm\_create\_tasks\_coworkers\_permission!=1){ |
  | 23 |  | $where =  " where ((FIND\_IN\_SET(~~$current\_user->ID,Proj.users) AND proj\_users.role\_id=1) OR (Proj.id = proj\_meta.project\_id AND proj\_meta.meta\_key='public\_project' AND proj\_meta.meta\_value=1) OR (Proj.created\_by='$current\_user->ID')) Group by Proj.id ORDER BY ".$orderby\_proj\_sql~~; |
  |  | 24 | $where =  " where ((FIND\_IN\_SET('$current\_user->ID',Proj.users) AND proj\_users.role\_id=1) OR (Proj.id = proj\_meta.project\_id AND proj\_meta.meta\_key='public\_project' AND proj\_meta.meta\_value=1) OR (Proj.created\_by='$cu\_id')) Group by Proj.id ORDER BY '$orderby\_proj\_sql'"; |
  | 24 | 25 | }else{ |
  | 25 |  | $where =  " where ((FIND\_IN\_SET(~~$current\_user->ID,Proj.users)) OR (Proj.id = proj\_meta.project\_id AND proj\_meta.meta\_key='public\_project' AND proj\_meta.meta\_value=1) OR (Proj.created\_by='$current\_user->ID')) Group by Proj.id ORDER BY ".$orderby\_proj\_sql~~; |
  |  | 26 | $where =  " where ((FIND\_IN\_SET('$current\_user->ID',Proj.users)) OR (Proj.id = proj\_meta.project\_id AND proj\_meta.meta\_key='public\_project' AND proj\_meta.meta\_value=1) OR (Proj.created\_by='$cu\_id')) Group by Proj.id ORDER BY '$orderby\_proj\_sql'"; |
  | 26 | 27 | } |
  | 27 | 28 | } |
  | […](/browser/taskbuilder/trunk/includes/admin/tasks/wppm_add_new_task.php?rev=3191970#L42) | […](/browser/taskbuilder/tags/3.0.7/includes/admin/tasks/wppm_add_new_task.php?rev=3210469#L43) |  |
  | 42 | 43 | $tusers\_arr = explode(',',$tusers); |
  | 43 | 44 | $tproject\_id = $val\_array['project']; |
  |  | 45 | $tproject\_id = esc\_sql($tproject\_id); |
  | 44 | 46 | if(!empty($tusers) && in\_array($current\_user->ID,$tusers\_arr)){ |
  | 45 |  | $project\_user\_role = $wpdb->get\_var("SELECT role\_id FROM {$wpdb->prefix}wppm\_project\_users WHERE proj\_id = '$tproject\_id' AND user\_id = '$cu~~rrent\_user->ID~~'"); |
  |  | 47 | $project\_user\_role = $wpdb->get\_var("SELECT role\_id FROM {$wpdb->prefix}wppm\_project\_users WHERE proj\_id = '$tproject\_id' AND user\_id = '$cu\_id'"); |
  | 46 | 48 | $project\_users = $wpdb->get\_var("SELECT users FROM {$wpdb->prefix}wppm\_project WHERE id = '$tproject\_id'"); |
  | 47 | 49 | $project\_users\_arr = explode(',',(string)$project\_users); |
  | […](/browser/taskbuilder/trunk/includes/admin/tasks/wppm_add_new_task.php?rev=3191970#L53) | […](/browser/taskbuilder/tags/3.0.7/includes/admin/tasks/wppm_add_new_task.php?rev=3210469#L55) |  |
  | 53 | 55 | } |
  | 54 | 56 | } |
  | 55 |  | $project\_creator = $wpdb->get\_var("SELECT created\_by FROM {$wpdb->prefix}wppm\_project WHERE created\_by = '$cu~~rrent\_user->ID~~'"); |
  |  | 57 | $project\_creator = $wpdb->get\_var("SELECT created\_by FROM {$wpdb->prefix}wppm\_project WHERE created\_by = '$cu\_id'"); |
  | 56 | 58 | ?> |
  | 57 | 59 | <form class='wppm\_add\_new\_task wppm\_bootstrap' onsubmit="return wppm\_create\_task();" id="wppm\_add\_new\_task" method="post"> |
  | […](/browser/taskbuilder/trunk/includes/admin/tasks/wppm_add_new_task.php?rev=3191970#L100) | […](/browser/taskbuilder/tags/3.0.7/includes/admin/tasks/wppm_add_new_task.php?rev=3210469#L102) |  |
  | 100 | 102 | if(!empty($projects)){ |
  | 101 | 103 | foreach($projects as $proj) { |
  |  | 104 | $project\_id = esc\_sql($proj->id); |
  | 102 | 105 | if($current\_user->has\_cap('manage\_options') || $wppmfunction->has\_permission('add\_new\_task',0) || $wppm\_current\_user\_capability=='wppm\_admin'){ |
  | 103 | 106 | ?> |
  | […](/browser/taskbuilder/trunk/includes/admin/tasks/wppm_add_new_task.php?rev=3191970#L105) | […](/browser/taskbuilder/tags/3.0.7/includes/admin/tasks/wppm_add_new_task.php?rev=3210469#L108) |  |
  | 105 | 108 | } |
  | 106 | 109 | else{ |
  | 107 |  | $project\_user\_role = $wpdb->get\_var("SELECT role\_id FROM {$wpdb->prefix}wppm\_project\_users WHERE proj\_id = '$proj~~->id' AND user\_id = '$current\_user->ID~~'"); |
  |  | 110 | $project\_user\_role = $wpdb->get\_var("SELECT role\_id FROM {$wpdb->prefix}wppm\_project\_users WHERE proj\_id = '$project\_id' AND user\_id = '$cu\_id'"); |
  | 108 | 111 | $project\_users = $proj->users; |
  | 109 | 112 | $project\_users\_arr = explode(',',(string)$project\_users); |
  | 110 |  | $project\_creator\_id = $wpdb->get\_var("SELECT created\_by FROM {$wpdb->prefix}wppm\_project WHERE created\_by = '$cu~~rrent\_user->ID' AND id='$proj->~~id'"); |
  |  | 113 | $project\_creator\_id = $wpdb->get\_var("SELECT created\_by FROM {$wpdb->prefix}wppm\_project WHERE created\_by = '$cu\_id' AND id='$project\_id'"); |
  | 111 | 114 | if(((!empty($project\_user\_role)) && ($project\_user\_role == 1) && in\_array($current\_user->ID,$project\_users\_arr)) || ($project\_creator\_id!="")){ |
  | 112 | 115 | ?> |
* ## [taskbuilder/tags/3.0.7/includes/admin/tasks/wppm\_get\_task\_users.php](/changeset/3210469/taskbuilder/tags/3.0.7/includes/admin/tasks/wppm_get_task_users.php "Show the changeset 3210469 restricted to taskbuilder/tags/3.0.7/includes/admin/tasks/wppm_get_task_users.php")

  | [r3174963](/browser/taskbuilder/trunk/includes/admin/tasks/wppm_get_task_users.php?rev=3174963#L9 "Show revision 3174963 of this file in browser") | [r3210469](/browser/taskbuilder/tags/3.0.7/includes/admin/tasks/wppm_get_task_users.php?rev=3210469#L9 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 9 | 9 | $proj\_id = isset($\_POST['proj\_id']) ? intval(sanitize\_text\_field($\_POST['proj\_id'])) : '' ; |
  | 10 | 10 | if (!(($current\_user->ID && $current\_user->has\_cap('manage\_options')) || $wppmfunction->has\_permission('assign\_task\_users',$task\_id))) {exit;} |
  | 11 |  | $task = $wpdb->get\_row( "SELECT \* FROM {$wpdb->prefix}wppm\_task where id = '~~$task\_id~~'" ); |
  |  | 11 | $task = $wpdb->get\_row( "SELECT \* FROM {$wpdb->prefix}wppm\_task where id = '".esc\_sql($task\_id)."'" ); |
  | 12 | 12 | $project\_data = $wppmfunction->get\_project($task->project); |
  | 13 | 13 | if(!empty($project\_data['users'])){ |
* ## [taskbuilder/tags/3.0.7/includes/admin/tasks/wppm\_set\_bulk\_change\_task\_priority.php](/changeset/3210469/taskbuilder/tags/3.0.7/includes/admin/tasks/wppm_set_bulk_change_task_priority.php "Show the changeset 3210469 restricted to taskbuilder/tags/3.0.7/includes/admin/tasks/wppm_set_bulk_change_task_priority.php")

  | [r3174963](/browser/taskbuilder/trunk/includes/admin/tasks/wppm_set_bulk_change_task_priority.php?rev=3174963#L27 "Show revision 3174963 of this file in browser") | [r3210469](/browser/taskbuilder/tags/3.0.7/includes/admin/tasks/wppm_set_bulk_change_task_priority.php?rev=3210469#L27 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 27 | 27 | $change\_priority\_value = array('prev\_prio'=>"$task\_data[priority]",'new\_prio'=>"$task\_priority"); |
  | 28 | 28 | $change\_priority\_obj = serialize($change\_priority\_value); |
  | 29 |  | $log\_values = array('task\_id'=>~~$task\_id,'body'=>$change\_priority\_obj,'attachment\_ids'=>"",'create\_time'=>date("Y-m-d h:i:sa"),'created\_by'=>$current\_user->ID~~ ); |
  |  | 29 | $log\_values = array('task\_id'=>esc\_sql($task\_id),'body'=>$change\_priority\_obj,'attachment\_ids'=>"",'create\_time'=>date("Y-m-d h:i:sa"),'created\_by'=>esc\_sql($current\_user->ID)); |
  | 30 | 30 | $wpdb->insert($wpdb->prefix . 'wppm\_task\_comment',$log\_values); |
  | 31 | 31 | $log\_id = $wpdb->insert\_id; |
  | 32 |  | $task\_log\_values = array('task\_id'=>~~$task\_id,'comment\_id'=>$log\_id~~,'comment\_type'=>'change\_task\_priority'); |
  |  | 32 | $task\_log\_values = array('task\_id'=>esc\_sql($task\_id),'comment\_id'=>esc\_sql($log\_id),'comment\_type'=>'change\_task\_priority'); |
  | 33 | 33 | $wpdb->insert($wpdb->prefix . 'wppm\_task\_comment\_meta',$task\_log\_values); |
  | 34 | 34 | } |
* ## [taskbuilder/tags/3.0.7/includes/admin/tasks/wppm\_set\_bulk\_change\_task\_status.php](/changeset/3210469/taskbuilder/tags/3.0.7/includes/admin/tasks/wppm_set_bulk_change_task_status.php "Show the changeset 3210469 restricted to taskbuilder/tags/3.0.7/includes/admin/tasks/wppm_set_bulk_change_task_status.php")

  | [r3191970](/browser/taskbuilder/trunk/includes/admin/tasks/wppm_set_bulk_change_task_status.php?rev=3191970#L13 "Show revision 3191970 of this file in browser") | [r3210469](/browser/taskbuilder/tags/3.0.7/includes/admin/tasks/wppm_set_bulk_change_task_status.php?rev=3210469#L13 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 13 | 13 | } |
  | 14 | 14 | $flag= false; |
  |  | 15 | $cu\_id = esc\_sql($current\_user->ID); |
  | 15 | 16 | $task\_status = isset( $\_POST['wppm\_task\_status']) ? intval(sanitize\_text\_field($\_POST['wppm\_task\_status'])) : ''; |
  | 16 | 17 | $wppm\_current\_user\_capability = get\_user\_meta( $current\_user->ID, 'wppm\_capability', true ); |
  | 17 |  |  |
  | 18 | 18 | if(!empty($task\_ids)){ |
  | 19 | 19 | foreach($task\_ids as $task\_id){ |
  | […](/browser/taskbuilder/trunk/includes/admin/tasks/wppm_set_bulk_change_task_status.php?rev=3191970#L21) | […](/browser/taskbuilder/tags/3.0.7/includes/admin/tasks/wppm_set_bulk_change_task_status.php?rev=3210469#L21) |  |
  | 21 | 21 | $tusers =  $task\_data['users']; |
  | 22 | 22 | $tusers\_arr = explode(',',$tusers); |
  | 23 |  | $tproject\_id = ~~$task\_data['project']~~; |
  |  | 23 | $tproject\_id = esc\_sql($task\_data['project']); |
  | 24 | 24 | if(!empty($tusers) && in\_array($current\_user->ID,$tusers\_arr)){ |
  | 25 |  | $project\_user\_role = $wpdb->get\_var("SELECT role\_id FROM {$wpdb->prefix}wppm\_project\_users WHERE proj\_id = '$tproject\_id' AND user\_id = '$cu~~rrent\_user->ID~~'"); |
  |  | 25 | $project\_user\_role = $wpdb->get\_var("SELECT role\_id FROM {$wpdb->prefix}wppm\_project\_users WHERE proj\_id = '$tproject\_id' AND user\_id = '$cu\_id'"); |
  | 26 | 26 | $project\_users = $wpdb->get\_var("SELECT users FROM {$wpdb->prefix}wppm\_project WHERE id = '$tproject\_id'"); |
  | 27 | 27 | $project\_users\_arr = explode(',',(string)$project\_users); |
  | 28 | 28 | if(((!empty($project\_user\_role)) && ($project\_user\_role == 1) && in\_array($current\_user->ID,$project\_users\_arr))){ |
  | 29 |  | $flag= true; |
  | 30 |  | break; |
  |  | 29 | $flag = true; |
  | 31 | 30 | } |
  | 32 | 31 | } |
  | […](/browser/taskbuilder/trunk/includes/admin/tasks/wppm_set_bulk_change_task_status.php?rev=3191970#L36) | […](/browser/taskbuilder/tags/3.0.7/includes/admin/tasks/wppm_set_bulk_change_task_status.php?rev=3210469#L35) |  |
  | 36 | 35 | die(); |
  | 37 | 36 | } |
  | 38 |  | $old\_status\_id      = $task\_data['status']; |
  | 39 |  |  |
  |  | 37 | $old\_status\_id = $task\_data['status']; |
  | 40 | 38 | if($status\_id && $status\_id!=$old\_status\_id){ |
  | 41 | 39 | $wppmfunction->change\_status( $task\_id, $status\_id); |
  | 42 |  | $change\_task\_value = array('prev\_status'=>"$task\_data[status]",'new\_status'=>"$status\_id"); |
  |  | 40 | $task\_id = esc\_sql($task\_id); |
  |  | 41 | $change\_task\_value = array('prev\_status'=>$task\_data['status'],'new\_status'=>$status\_id); |
  | 43 | 42 | $change\_task\_obj = serialize($change\_task\_value); |
  | 44 |  | $log\_values = array('task\_id'=>~~$task\_id,'body'=>$change\_task\_obj,'attachment\_ids'=>"",'create\_time'=>date("Y-m-d h:i:sa"),'created\_by'=>$current\_user->ID~~ ); |
  |  | 43 | $log\_values = array('task\_id'=>"$task\_id",'body'=>$change\_task\_obj,'attachment\_ids'=>"",'create\_time'=>date("Y-m-d h:i:sa"),'created\_by'=>esc\_sql($current\_user->ID) ); |
  | 45 | 44 | $wpdb->insert($wpdb->prefix . 'wppm\_task\_comment',$log\_values); |
  | 46 |  | $log\_id = ~~$wpdb->insert\_id~~; |
  | 47 |  | $task\_log\_values = array('task\_id'=>~~$task\_id,'comment\_id'=>$log\_id~~,'comment\_type'=>'change\_task\_status'); |
  |  | 45 | $log\_id = esc\_sql($wpdb->insert\_id); |
  |  | 46 | $task\_log\_values = array('task\_id'=>"$task\_id",'comment\_id'=>"$log\_id",'comment\_type'=>'change\_task\_status'); |
  | 48 | 47 | $wpdb->insert($wpdb->prefix . 'wppm\_task\_comment\_meta',$task\_log\_values); |
  | 49 | 48 | } |
* ## [taskbuilder/tags/3.0.7/includes/admin/tasks/wppm\_set\_delete\_bulk\_tasks.php](/changeset/3210469/taskbuilder/tags/3.0.7/includes/admin/tasks/wppm_set_delete_bulk_tasks.php "Show the changeset 3210469 restricted to taskbuilder/tags/3.0.7/includes/admin/tasks/wppm_set_delete_bulk_tasks.php")

  | [r3174963](/browser/taskbuilder/trunk/includes/admin/tasks/wppm_set_delete_bulk_tasks.php?rev=3174963#L20 "Show revision 3174963 of this file in browser") | [r3210469](/browser/taskbuilder/tags/3.0.7/includes/admin/tasks/wppm_set_delete_bulk_tasks.php?rev=3210469#L20 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 20 | 20 | $project\_data = $wppmfunction->get\_project($task\_data['project']); |
  | 21 | 21 | if ((($current\_user->ID && $current\_user->has\_cap('manage\_options')) || ($wppmfunction->has\_permission('delete\_task',$task\_id)) || $wppm\_current\_user\_capability == 'wppm\_admin'|| $project\_data['created\_by']==$current\_user->ID)) { |
  | 22 |  | $sql="SELECT attachment\_ids FROM {$wpdb->prefix}wppm\_task\_comment WHERE task\_id =".~~$task\_id~~; |
  |  | 22 | $sql="SELECT attachment\_ids FROM {$wpdb->prefix}wppm\_task\_comment WHERE task\_id =". esc\_sql($task\_id); |
  | 23 | 23 | $thread\_attachment\_ids= $wpdb->get\_results( $sql ); |
  | 24 | 24 | /\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*Code for deleting attachment files\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*/ |
  | […](/browser/taskbuilder/trunk/includes/admin/tasks/wppm_set_delete_bulk_tasks.php?rev=3174963#L31) | […](/browser/taskbuilder/tags/3.0.7/includes/admin/tasks/wppm_set_delete_bulk_tasks.php?rev=3210469#L31) |  |
  | 31 | 31 | if(!empty($attachment\_ids\_temp)){ |
  | 32 | 32 | foreach ($attachment\_ids\_temp as $attachment\_id){ |
  | 33 |  | $sql="SELECT \* FROM {$wpdb->prefix}wppm\_attachments WHERE id =".~~$attachment\_id~~; |
  |  | 33 | $sql="SELECT \* FROM {$wpdb->prefix}wppm\_attachments WHERE id =".esc\_sql($attachment\_id); |
  | 34 | 34 | $result=$wpdb->get\_row($sql); |
  | 35 | 35 | if(!empty($result)){ |
  | 36 |  | $sql\_query="SELECT file\_path FROM {$wpdb->prefix}wppm\_attachments WHERE file\_path ='".~~$result->file\_path~~."'"; |
  |  | 36 | $sql\_query="SELECT file\_path FROM {$wpdb->prefix}wppm\_attachments WHERE file\_path ='".esc\_sql($result->file\_path)."'"; |
  | 37 | 37 | $attach\_result=$wpdb->get\_results($sql\_query); |
  | 38 | 38 | $result\_count = count($attach\_result); |
  | […](/browser/taskbuilder/trunk/includes/admin/tasks/wppm_set_delete_bulk_tasks.php?rev=3174963#L41) | […](/browser/taskbuilder/tags/3.0.7/includes/admin/tasks/wppm_set_delete_bulk_tasks.php?rev=3210469#L41) |  |
  | 41 | 41 | unlink($result->file\_path); |
  | 42 | 42 | } |
  | 43 |  | $wpdb->delete($wpdb->prefix.'wppm\_attachments', array( 'id' => ~~$attachment\_id~~)); |
  |  | 43 | $wpdb->delete($wpdb->prefix.'wppm\_attachments', array( 'id' => esc\_sql($attachment\_id))); |
  | 44 | 44 | } |
  | 45 | 45 | } |
  | […](/browser/taskbuilder/trunk/includes/admin/tasks/wppm_set_delete_bulk_tasks.php?rev=3174963#L48) | […](/browser/taskbuilder/tags/3.0.7/includes/admin/tasks/wppm_set_delete_bulk_tasks.php?rev=3210469#L48) |  |
  | 48 | 48 | } |
  | 49 | 49 | /\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*Code for deleting checklists\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*/ |
  | 50 |  | $sql="SELECT id FROM {$wpdb->prefix}wppm\_checklist WHERE task\_id =".~~$task\_id~~; |
  |  | 50 | $sql="SELECT id FROM {$wpdb->prefix}wppm\_checklist WHERE task\_id =".esc\_sql($task\_id); |
  | 51 | 51 | $checklists = $wpdb->get\_results( $sql ); |
  | 52 | 52 | if(!empty($checklists)){ |
  | 53 | 53 | foreach($checklists as $checklist){ |
  | 54 | 54 | $chk\_array = (array) $checklist; |
  | 55 |  | $sql="SELECT id FROM {$wpdb->prefix}wppm\_checklist\_items WHERE checklist\_id =~~".$chk\_array['id']~~; |
  |  | 55 | $sql="SELECT id FROM {$wpdb->prefix}wppm\_checklist\_items WHERE checklist\_id ='".esc\_sql($chk\_array['id']."'"); |
  | 56 | 56 | $checklist\_items = $wpdb->get\_results( $sql ); |
  | 57 | 57 | if(!empty($checklist\_items)){ |
  | 58 | 58 | foreach($checklist\_items as $ch\_item){ |
  | 59 | 59 | $chk\_items\_array = (array) $ch\_item; |
  | 60 |  | $wpdb->delete($wpdb->prefix.'wppm\_checklist\_items',array('id'=>~~$chk\_items\_array['id']~~)); |
  |  | 60 | $wpdb->delete($wpdb->prefix.'wppm\_checklist\_items',array('id'=>esc\_sql($chk\_items\_array['id']))); |
  | 61 | 61 | } |
  | 62 | 62 | } |
  | 63 |  | $wpdb->delete($wpdb->prefix.'wppm\_checklist',array('id'=>~~$chk\_array['id']~~)); |
  |  | 63 | $wpdb->delete($wpdb->prefix.'wppm\_checklist',array('id'=>esc\_sql($chk\_array['id']))); |
  | 64 | 64 | } |
  | 65 | 65 | } |
  | 66 |  | $wpdb->delete($wpdb->prefix.'wppm\_task',array('id'=>~~$task\_id~~)); |
  | 67 |  | $wpdb->delete($wpdb->prefix.'wppm\_task\_meta',array('task\_id'=>~~$task\_id~~)); |
  | 68 |  | $wpdb->delete($wpdb->prefix.'wppm\_task\_comment',array('task\_id'=>~~$task\_id~~)); |
  | 69 |  | $wpdb->delete($wpdb->prefix.'wppm\_task\_comment\_meta',array('task\_id'=>~~$task\_id~~)); |
  |  | 66 | $wpdb->delete($wpdb->prefix.'wppm\_task',array('id'=>esc\_sql($task\_id))); |
  |  | 67 | $wpdb->delete($wpdb->prefix.'wppm\_task\_meta',array('task\_id'=>esc\_sql($task\_id))); |
  |  | 68 | $wpdb->delete($wpdb->prefix.'wppm\_task\_comment',array('task\_id'=>esc\_sql($task\_id))); |
  |  | 69 | $wpdb->delete($wpdb->prefix.'wppm\_task\_comment\_meta',array('task\_id'=>esc\_sql($task\_id))); |
  | 70 | 70 | do\_action('wppm\_after\_delete\_task',$task\_id); |
  | 71 | 71 | } |
* ## [taskbuilder/tags/3.0.7/includes/admin/tasks/wppm\_set\_delete\_task.php](/changeset/3210469/taskbuilder/tags/3.0.7/includes/admin/tasks/wppm_set_delete_task.php "Show the changeset 3210469 restricted to taskbuilder/tags/3.0.7/includes/admin/tasks/wppm_set_delete_task.php")

  | [r3174963](/browser/taskbuilder/trunk/includes/admin/tasks/wppm_set_delete_task.php?rev=3174963#L9 "Show revision 3174963 of this file in browser") | [r3210469](/browser/taskbuilder/tags/3.0.7/includes/admin/tasks/wppm_set_delete_task.php?rev=3210469#L9 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 9 | 9 | wp\_send\_json\_error( 'Unauthorised request!', 401 ); |
  | 10 | 10 | } |
  | 11 |  | $sql="SELECT attachment\_ids FROM {$wpdb->prefix}wppm\_task\_comment WHERE task\_id =~~'$task\_id~~'"; |
  |  | 11 | $sql="SELECT attachment\_ids FROM {$wpdb->prefix}wppm\_task\_comment WHERE task\_id ='" .esc\_sql($task\_id)."'"; |
  | 12 | 12 | $thread\_attachment\_ids= $wpdb->get\_results( $sql ); |
  | 13 | 13 | /\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*Code for deleting attachment files\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*/ |
  | […](/browser/taskbuilder/trunk/includes/admin/tasks/wppm_set_delete_task.php?rev=3174963#L20) | […](/browser/taskbuilder/tags/3.0.7/includes/admin/tasks/wppm_set_delete_task.php?rev=3210469#L20) |  |
  | 20 | 20 | if(!empty($attachment\_ids\_temp)){ |
  | 21 | 21 | foreach ($attachment\_ids\_temp as $attachment\_id){ |
  | 22 |  | $attachment\_id = esc\_sql($attachment\_id); |
  | 23 |  | $sql="SELECT \* FROM {$wpdb->prefix}wppm\_attachments WHERE id ='$attachment\_id'"; |
  |  | 22 | $sql="SELECT \* FROM {$wpdb->prefix}wppm\_attachments WHERE id  ='" .esc\_sql($attachment\_id)."'"; |
  | 24 | 23 | $result=$wpdb->get\_row($sql); |
  | 25 | 24 | if(!empty($result)){ |
  | 26 |  | $sql\_query="SELECT file\_path FROM {$wpdb->prefix}wppm\_attachments WHERE file\_path ='".~~$result->file\_path~~."'"; |
  |  | 25 | $sql\_query="SELECT file\_path FROM {$wpdb->prefix}wppm\_attachments WHERE file\_path ='".esc\_sql($result->file\_path)."'"; |
  | 27 | 26 | $attach\_result=$wpdb->get\_results($sql\_query); |
  | 28 | 27 | $result\_count = count($attach\_result); |
  | […](/browser/taskbuilder/trunk/includes/admin/tasks/wppm_set_delete_task.php?rev=3174963#L31) | […](/browser/taskbuilder/tags/3.0.7/includes/admin/tasks/wppm_set_delete_task.php?rev=3210469#L30) |  |
  | 31 | 30 | unlink($result->file\_path); |
  | 32 | 31 | } |
  | 33 |  | $wpdb->delete($wpdb->prefix.'wppm\_attachments', array( 'id' => ~~$attachment\_id~~)); |
  |  | 32 | $wpdb->delete($wpdb->prefix.'wppm\_attachments', array( 'id' => esc\_sql($attachment\_id))); |
  | 34 | 33 | } |
  | 35 | 34 | } |
  | […](/browser/taskbuilder/trunk/includes/admin/tasks/wppm_set_delete_task.php?rev=3174963#L38) | […](/browser/taskbuilder/tags/3.0.7/includes/admin/tasks/wppm_set_delete_task.php?rev=3210469#L37) |  |
  | 38 | 37 | } |
  | 39 | 38 | /\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*Code for deleting checklists\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*/ |
  | 40 |  | $sql="SELECT id FROM {$wpdb->prefix}wppm\_checklist WHERE task\_id =~~'$task\_id~~'"; |
  |  | 39 | $sql="SELECT id FROM {$wpdb->prefix}wppm\_checklist WHERE task\_id ='" .esc\_sql($task\_id)."'"; |
  | 41 | 40 | $checklists = $wpdb->get\_results( $sql ); |
  | 42 | 41 | if(!empty($checklists)){ |
  | […](/browser/taskbuilder/trunk/includes/admin/tasks/wppm_set_delete_task.php?rev=3174963#L44) | […](/browser/taskbuilder/tags/3.0.7/includes/admin/tasks/wppm_set_delete_task.php?rev=3210469#L43) |  |
  | 44 | 43 | $chk\_array = (array) $checklist; |
  | 45 | 44 | $chk\_array\_id = esc\_sql($chk\_array['id']); |
  | 46 |  | $sql="SELECT id FROM {$wpdb->prefix}wppm\_checklist\_items WHERE checklist\_id = '~~$chk\_array\_id~~'"; |
  |  | 45 | $sql="SELECT id FROM {$wpdb->prefix}wppm\_checklist\_items WHERE checklist\_id = '".esc\_sql($chk\_array\_id)."'"; |
  | 47 | 46 | $checklist\_items = $wpdb->get\_results( $sql ); |
  | 48 | 47 | if(!empty($checklist\_items)){ |
  | […](/browser/taskbuilder/trunk/includes/admin/tasks/wppm_set_delete_task.php?rev=3174963#L53) | […](/browser/taskbuilder/tags/3.0.7/includes/admin/tasks/wppm_set_delete_task.php?rev=3210469#L52) |  |
  | 53 | 52 | } |
  | 54 | 53 | } |
  | 55 |  | $wpdb->delete($wpdb->prefix.'wppm\_checklist',array('id'=>~~$chk\_array['id']~~)); |
  |  | 54 | $wpdb->delete($wpdb->prefix.'wppm\_checklist',array('id'=>"$chk\_array\_id")); |
  | 56 | 55 | } |
  | 57 | 56 | } |
  | 58 |  | $wpdb->delete($wpdb->prefix.'wppm\_task',array('id'=>~~$task\_id~~)); |
  | 59 |  | $wpdb->delete($wpdb->prefix.'wppm\_task\_meta',array('task\_id'=>~~$task\_id~~)); |
  | 60 |  | $wpdb->delete($wpdb->prefix.'wppm\_task\_comment',array('task\_id'=>~~$task\_id~~)); |
  | 61 |  | $wpdb->delete($wpdb->prefix.'wppm\_task\_comment\_meta',array('task\_id'=>~~$task\_id~~)); |
  |  | 57 | $wpdb->delete($wpdb->prefix.'wppm\_task',array('id'=>esc\_sql($task\_id))); |
  |  | 58 | $wpdb->delete($wpdb->prefix.'wppm\_task\_meta',array('task\_id'=>esc\_sql($task\_id))); |
  |  | 59 | $wpdb->delete($wpdb->prefix.'wppm\_task\_comment',array('task\_id'=>esc\_sql($task\_id))); |
  |  | 60 | $wpdb->delete($wpdb->prefix.'wppm\_task\_comment\_meta',array('task\_id'=>esc\_sql($task\_id))); |
  | 62 | 61 | do\_action('wppm\_after\_delete\_task',$task\_id); |
* ## [taskbuilder/tags/3.0.7/includes/admin/tasks/wppm\_tasks\_list.php](/changeset/3210469/taskbuilder/tags/3.0.7/includes/admin/tasks/wppm_tasks_list.php "Show the changeset 3210469 restricted to taskbuilder/tags/3.0.7/includes/admin/tasks/wppm_tasks_list.php")

  | [r3191970](/browser/taskbuilder/trunk/includes/admin/tasks/wppm_tasks_list.php?rev=3191970#L15 "Show revision 3191970 of this file in browser") | [r3210469](/browser/taskbuilder/tags/3.0.7/includes/admin/tasks/wppm_tasks_list.php?rev=3210469#L15 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 15 | 15 | $wppm\_create\_tasks\_coworkers\_permission = get\_option('wppm\_allow\_coworkers\_create\_task'); |
  | 16 | 16 | $orderby\_proj\_sql = esc\_sql(sanitize\_sql\_orderby( "project\_name" )); |
  |  | 17 | $proj\_attr = esc\_sql($proj\_attr); |
  | 17 | 18 | if(!empty($proj\_attr )){ |
  | 18 | 19 | $wppm\_proj\_attr = ' AND (proj.project\_name = "'.$proj\_attr.'")'; |
  | […](/browser/taskbuilder/trunk/includes/admin/tasks/wppm_tasks_list.php?rev=3191970#L21) | […](/browser/taskbuilder/tags/3.0.7/includes/admin/tasks/wppm_tasks_list.php?rev=3210469#L22) |  |
  | 21 | 22 | } |
  | 22 | 23 | $current\_date = date('Y-m-d'); |
  |  | 24 | $current\_date = esc\_sql($current\_date ); |
  |  | 25 | $cu\_id = esc\_sql($current\_user->ID); |
  | 23 | 26 | $wppm\_task\_time = get\_option('wppm\_task\_time'); |
  | 24 | 27 | $query = ("SELECT proj.\* |
  | […](/browser/taskbuilder/trunk/includes/admin/tasks/wppm_tasks_list.php?rev=3191970#L32) | […](/browser/taskbuilder/tags/3.0.7/includes/admin/tasks/wppm_tasks_list.php?rev=3210469#L35) |  |
  | 32 | 35 | } |
  | 33 | 36 | }else{ |
  | 34 |  | $where =  " where ((FIND\_IN\_SET(~~$current\_user->ID,proj.users)) OR (proj.id = proj\_meta.project\_id AND proj\_meta.meta\_key='public\_project' AND proj\_meta.meta\_value=1) OR ( proj.created\_by='$current\_user->ID')) $wppm\_proj\_attr Group by proj.id ORDER BY ".$orderby\_proj\_sql~~; |
  |  | 37 | $where =  " where ((FIND\_IN\_SET('$current\_user->ID',proj.users)) OR (proj.id = proj\_meta.project\_id AND proj\_meta.meta\_key='public\_project' AND proj\_meta.meta\_value=1) OR ( proj.created\_by='$cu\_id')) $wppm\_proj\_attr Group by proj.id ORDER BY $orderby\_proj\_sql"; |
  | 35 | 38 | } |
  | 36 | 39 | $where = apply\_filters('wppm\_project\_filter\_in\_task\_list\_where',$where); |
  | […](/browser/taskbuilder/trunk/includes/admin/tasks/wppm_tasks_list.php?rev=3191970#L58) | […](/browser/taskbuilder/tags/3.0.7/includes/admin/tasks/wppm_tasks_list.php?rev=3210469#L61) |  |
  | 58 | 61 | $filter\_by = isset($\_POST['wppm\_task\_filter']) ? sanitize\_text\_field($\_POST['wppm\_task\_filter']) : $tl\_filters\_arr['filter']; |
  | 59 | 62 | $proj\_filter = isset($\_POST['wppm\_proj\_filter']) ? sanitize\_text\_field($\_POST['wppm\_proj\_filter']) : $tl\_filters\_arr['proj\_filter']; |
  |  | 63 | $proj\_filter = esc\_sql($proj\_filter); |
  | 60 | 64 | if($sort\_by == ""){ |
  | 61 | 65 | $sort\_by = 'task\_name'; |
  | […](/browser/taskbuilder/trunk/includes/admin/tasks/wppm_tasks_list.php?rev=3191970#L149) | […](/browser/taskbuilder/tags/3.0.7/includes/admin/tasks/wppm_tasks_list.php?rev=3210469#L153) |  |
  | 149 | 153 | $where = " where $wppm\_tl\_filter AND $wppm\_task\_by\_proj\_filter AND (Task.task\_name LIKE '$search\_tag\_text' OR proj.project\_name LIKE '$search\_tag\_text' OR task\_statuses.name LIKE '$search\_tag\_text' OR task\_priorities.name LIKE '$search\_tag\_text' OR user.display\_name LIKE '$search\_tag\_text') $wppm\_proj\_attr "; |
  | 150 | 154 | } else{ |
  | 151 |  | $where = " where $wppm\_tl\_filter AND $wppm\_task\_by\_proj\_filter AND (((FIND\_IN\_SET('$current\_user->ID',Task.users)>0) OR (Task.created\_by= '$cu~~rrent\_user->ID') OR (proj\_users.user\_id = '$current\_user->ID' AND proj\_users.role\_id = 1 AND (FIND\_IN\_SET('$current\_user->ID',proj.users)>0)) OR (Task.project = proj\_meta.project\_id AND proj\_meta.meta\_key='public\_project' AND proj\_meta.meta\_value=1) OR (proj.created\_by='$current\_user->ID~~' AND (FIND\_IN\_SET('$current\_user->ID',proj.users)>0))) AND (Task.task\_name LIKE '$search\_tag\_text' OR proj.project\_name LIKE '$search\_tag\_text' OR task\_statuses.name LIKE '$search\_tag\_text' OR task\_priorities.name LIKE '$search\_tag\_text' OR user.display\_name LIKE '$search\_tag\_text')) $wppm\_proj\_attr"; |
  |  | 155 | $where = " where $wppm\_tl\_filter AND $wppm\_task\_by\_proj\_filter AND (((FIND\_IN\_SET('$current\_user->ID',Task.users)>0) OR (Task.created\_by= '$cu\_id') OR (proj\_users.user\_id = '$cu\_id' AND proj\_users.role\_id = 1 AND (FIND\_IN\_SET('$current\_user->ID',proj.users)>0)) OR (Task.project = proj\_meta.project\_id AND proj\_meta.meta\_key='public\_project' AND proj\_meta.meta\_value=1) OR (proj.created\_by='$cu\_id' AND (FIND\_IN\_SET('$current\_user->ID',proj.users)>0))) AND (Task.task\_name LIKE '$search\_tag\_text' OR proj.project\_name LIKE '$search\_tag\_text' OR task\_statuses.name LIKE '$search\_tag\_text' OR task\_priorities.name LIKE '$search\_tag\_text' OR user.display\_name LIKE '$search\_tag\_text')) $wppm\_proj\_attr"; |
  | 152 | 156 | } |
  | 153 | 157 | }else{ |
  | […](/browser/taskbuilder/trunk/includes/admin/tasks/wppm_tasks_list.php?rev=3191970#L155) | […](/browser/taskbuilder/tags/3.0.7/includes/admin/tasks/wppm_tasks_list.php?rev=3210469#L159) |  |
  | 155 | 159 | $where = " where $wppm\_tl\_filter AND $wppm\_task\_by\_proj\_filter $wppm\_proj\_attr"; |
  | 156 | 160 | } else{ |
  | 157 |  | $where = " where $wppm\_tl\_filter AND $wppm\_task\_by\_proj\_filter AND ((FIND\_IN\_SET('$current\_user->ID',Task.users)>0) OR (Task.created\_by= '$cu~~rrent\_user->ID') OR (proj\_users.user\_id = '$current\_user->ID' AND proj\_users.role\_id = 1 AND (FIND\_IN\_SET('$current\_user->ID',proj.users)>0)) OR (Task.project = proj\_meta.project\_id AND proj\_meta.meta\_key='public\_project' AND proj\_meta.meta\_value=1) OR (proj.created\_by='$current\_user->ID~~' AND (FIND\_IN\_SET('$current\_user->ID',proj.users)>0))) $wppm\_proj\_attr"; |
  |  | 161 | $where = " where $wppm\_tl\_filter AND $wppm\_task\_by\_proj\_filter AND ((FIND\_IN\_SET('$current\_user->ID',Task.users)>0) OR (Task.created\_by= '$cu\_id') OR (proj\_users.user\_id = '$cu\_id' AND proj\_users.role\_id = 1 AND (FIND\_IN\_SET('$current\_user->ID',proj.users)>0)) OR (Task.project = proj\_meta.project\_id AND proj\_meta.meta\_key='public\_project' AND proj\_meta.meta\_value=1) OR (proj.created\_by='$cu\_id' AND (FIND\_IN\_SET('$current\_user->ID',proj.users)>0))) $wppm\_proj\_attr"; |
  | 158 | 162 | } |
  | 159 | 163 | } |
  | […](/browser/taskbuilder/trunk/includes/admin/tasks/wppm_tasks_list.php?rev=3191970#L165) | […](/browser/taskbuilder/tags/3.0.7/includes/admin/tasks/wppm_tasks_list.php?rev=3210469#L169) |  |
  | 165 | 169 | $no\_of\_rows = apply\_filters('wppm\_task\_list\_no\_of\_rows',$no\_of\_rows,$wppm\_tl\_filter,$search\_tag\_text); |
  | 166 | 170 | $totalrows = $wpdb->get\_var($no\_of\_rows); |
  | 167 |  | $query .= $where." Group by Task.id ORDER BY $sort\_by $order"; |
  |  | 171 | $sort\_by = esc\_sql($sort\_by); |
  |  | 172 | $order = esc\_sql($order); |
  |  | 173 | $query .= $where." Group by Task.id ORDER BY ".$sort\_by." ".$order.""; |
  | 168 | 174 | $query = apply\_filters('wppm\_task\_list\_query',$query); |
  | 169 | 175 | $limit\_start=$page\_no\*$task\_per\_page; |
  | […](/browser/taskbuilder/trunk/includes/admin/tasks/wppm_tasks_list.php?rev=3191970#L173) | […](/browser/taskbuilder/tags/3.0.7/includes/admin/tasks/wppm_tasks_list.php?rev=3210469#L179) |  |
  | 173 | 179 | $wppm\_task\_fillter = $wpdb->get\_results($query); |
  | 174 | 180 | $flag = false; |
  | 175 |  | $project\_creator = $wpdb->get\_var("SELECT created\_by FROM {$wpdb->prefix}wppm\_project WHERE created\_by = '$cu~~rrent\_user->ID~~'"); |
  |  | 181 | $project\_creator = $wpdb->get\_var("SELECT created\_by FROM {$wpdb->prefix}wppm\_project WHERE created\_by = '$cu\_id'"); |
  | 176 | 182 | if(!empty($wppm\_task\_fillter)){ |
  | 177 | 183 | foreach($wppm\_task\_fillter as $key\_filter=>$val\_filter){ |
  | […](/browser/taskbuilder/trunk/includes/admin/tasks/wppm_tasks_list.php?rev=3191970#L179) | […](/browser/taskbuilder/tags/3.0.7/includes/admin/tasks/wppm_tasks_list.php?rev=3210469#L185) |  |
  | 179 | 185 | $tusers =  $val\_array['users']; |
  | 180 | 186 | $tusers\_arr = explode(',',$tusers); |
  | 181 |  | $tproject\_id = ~~$val\_array['project']~~; |
  |  | 187 | $tproject\_id = esc\_sql($val\_array['project']); |
  | 182 | 188 | if(!empty($tusers) && in\_array($current\_user->ID,$tusers\_arr)){ |
  | 183 |  | $project\_user\_role = $wpdb->get\_var("SELECT role\_id FROM {$wpdb->prefix}wppm\_project\_users WHERE proj\_id = '$tproject\_id' AND user\_id = '$cu~~rrent\_user->ID~~'"); |
  |  | 189 | $project\_user\_role = $wpdb->get\_var("SELECT role\_id FROM {$wpdb->prefix}wppm\_project\_users WHERE proj\_id = '$tproject\_id' AND user\_id = '$cu\_id'"); |
  | 184 | 190 | $project\_users = $wpdb->get\_var("SELECT users FROM {$wpdb->prefix}wppm\_project WHERE id = '$tproject\_id'"); |
  | 185 | 191 | $project\_users\_arr = explode(',',(string)$project\_users); |
  | […](/browser/taskbuilder/trunk/includes/admin/tasks/wppm_tasks_list.php?rev=3191970#L285) | […](/browser/taskbuilder/tags/3.0.7/includes/admin/tasks/wppm_tasks_list.php?rev=3210469#L291) |  |
  | 285 | 291 | <thead> |
  | 286 | 292 | <tr> |
  | 287 |  | <th style="~~width: 45px;"~~  onchange="wppm\_bulk\_select\_change()"> |
  |  | 293 | <th style="background-color:<?php echo esc\_attr($appearance\_settings['list-header-background-color'])?>" onchange="wppm\_bulk\_select\_change()"> |
  | 288 | 294 | <div class="checkbox-container"> |
  | 289 | 295 | <input id="wppm\_bulk\_select\_option" class="wppm-bulk-selector" type="checkbox" onchange="wppm\_bulk\_select\_change();"/> |
* ## [taskbuilder/tags/3.0.7/includes/class-wppm-functions.php](/changeset/3210469/taskbuilder/tags/3.0.7/includes/class-wppm-functions.php "Show the changeset 3210469 restricted to taskbuilder/tags/3.0.7/includes/class-wppm-functions.php")

  | [r3191970](/browser/taskbuilder/trunk/includes/class-wppm-functions.php?rev=3191970#L128 "Show revision 3191970 of this file in browser") | [r3210469](/browser/taskbuilder/tags/3.0.7/includes/class-wppm-functions.php?rev=3210469#L128 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 128 | 128 | global $wpdb; |
  | 129 | 129 | $id = esc\_sql($id); |
  | 130 |  | $auth\_code = $wpdb->get\_var( "SELECT task\_auth\_code FROM {$wpdb->prefix}wppm\_task where id=~~$id~~" ); |
  |  | 130 | $auth\_code = $wpdb->get\_var( "SELECT task\_auth\_code FROM {$wpdb->prefix}wppm\_task where id='$id'" ); |
  | 131 | 131 | $auth\_code = isset($auth\_code) ? $auth\_code : ""; |
  | 132 | 132 | return $auth\_code; |
  | […](/browser/taskbuilder/trunk/includes/class-wppm-functions.php?rev=3191970#L158) | […](/browser/taskbuilder/tags/3.0.7/includes/class-wppm-functions.php?rev=3210469#L158) |  |
  | 158 | 158 | global $wpdb; |
  | 159 | 159 | $task\_data = array(); |
  |  | 160 | $task\_id = esc\_sql($task\_id); |
  | 160 | 161 | $task = $wpdb->get\_row("SELECT \* FROM {$wpdb->prefix}wppm\_task WHERE id='$task\_id' "); |
  | 161 | 162 | if( $task ){ |
  | […](/browser/taskbuilder/trunk/includes/class-wppm-functions.php?rev=3191970#L221) | […](/browser/taskbuilder/tags/3.0.7/includes/class-wppm-functions.php?rev=3210469#L222) |  |
  | 221 | 222 | $comment\_id = 0; |
  | 222 | 223 | } |
  |  | 224 | $comment\_id = esc\_sql($comment\_id); |
  | 223 | 225 | $task\_data = $wppmfunction->get\_task($task\_id); |
  | 224 | 226 | $task\_comment = $wpdb->get\_row("SELECT \* FROM {$wpdb->prefix}wppm\_task\_comment WHERE task\_id = '$task\_id' AND id = '$comment\_id'"); |
  | […](/browser/taskbuilder/trunk/includes/class-wppm-functions.php?rev=3191970#L228) | […](/browser/taskbuilder/tags/3.0.7/includes/class-wppm-functions.php?rev=3210469#L230) |  |
  | 228 | 230 | $project\_id = esc\_sql($project\_id); |
  | 229 | 231 | $project\_data = $wppmfunction->get\_project($project\_id); |
  | 230 |  | $project\_user\_role = $wpdb->get\_var("SELECT role\_id FROM {$wpdb->prefix}wppm\_project\_users WHERE proj\_id = '$project\_id' AND user\_id = '$current\_user->ID'"); |
  |  | 232 | $cu\_user\_id = esc\_sql($current\_user->ID); |
  |  | 233 | $project\_user\_role = $wpdb->get\_var("SELECT role\_id FROM {$wpdb->prefix}wppm\_project\_users WHERE proj\_id = '$project\_id' AND user\_id = ' $cu\_user\_id'"); |
  | 231 | 234 | $project\_users = $wpdb->get\_var("SELECT users FROM {$wpdb->prefix}wppm\_project WHERE id = '$project\_id'"); |
  | 232 | 235 | $project\_users\_arr = explode(',',(string)$project\_users); |
  | […](/browser/taskbuilder/trunk/includes/class-wppm-functions.php?rev=3191970#L301) | […](/browser/taskbuilder/tags/3.0.7/includes/class-wppm-functions.php?rev=3210469#L304) |  |
  | 301 | 304 | $project\_id = $task\_data['project']; |
  | 302 | 305 | $project\_id = esc\_sql($project\_id); |
  |  | 306 | $cu\_id = esc\_sql($current\_user->ID); |
  | 303 | 307 | $project\_data = $wppmfunction->get\_project($project\_id); |
  | 304 |  | $project\_user = $wpdb->get\_row("SELECT \* FROM {$wpdb->prefix}wppm\_project\_users WHERE proj\_id = '$project\_id' AND user\_id = '$cu~~rrent\_user->ID~~'"); |
  |  | 308 | $project\_user = $wpdb->get\_row("SELECT \* FROM {$wpdb->prefix}wppm\_project\_users WHERE proj\_id = '$project\_id' AND user\_id = '$cu\_id'"); |
  | 305 | 309 | $project\_users = $wpdb->get\_var("SELECT users FROM {$wpdb->prefix}wppm\_project WHERE id = '$project\_id'"); |
  | 306 | 310 | $project\_users\_arr = explode(',',(string)$project\_users); |
  | […](/browser/taskbuilder/trunk/includes/class-wppm-functions.php?rev=3191970#L337) | […](/browser/taskbuilder/tags/3.0.7/includes/class-wppm-functions.php?rev=3210469#L341) |  |
  | 337 | 341 | $proj\_id = esc\_sql($proj\_id); |
  | 338 | 342 | $comment\_id = esc\_sql($comment\_id); |
  |  | 343 | $cu\_id = esc\_sql($current\_user->ID); |
  | 339 | 344 | if(empty($comment\_id)){ |
  | 340 | 345 | $comment\_id = 0; |
  | 341 | 346 | } |
  | 342 |  | $project\_user = $wpdb->get\_row("SELECT \* FROM {$wpdb->prefix}wppm\_project\_users WHERE proj\_id = '$proj\_id' AND user\_id = '~~$current\_user->ID~~'"); |
  |  | 347 | $project\_user = $wpdb->get\_row("SELECT \* FROM {$wpdb->prefix}wppm\_project\_users WHERE proj\_id = '$proj\_id' AND user\_id = ' $cu\_id '"); |
  | 343 | 348 | $project\_users = $wpdb->get\_var("SELECT users FROM {$wpdb->prefix}wppm\_project WHERE id = '$proj\_id'"); |
  | 344 | 349 | $project\_users\_arr = explode(',',(string)$project\_users); |
  | […](/browser/taskbuilder/trunk/includes/class-wppm-functions.php?rev=3191970#L369) | […](/browser/taskbuilder/tags/3.0.7/includes/class-wppm-functions.php?rev=3210469#L374) |  |
  | 369 | 374 | $project\_data = $wppmfunction->get\_project($project\_id); |
  | 370 | 375 | $project\_id = esc\_sql($project\_id); |
  | 371 |  | $project\_user = $wpdb->get\_row("SELECT \* FROM {$wpdb->prefix}wppm\_project\_users WHERE proj\_id = '$project\_id' AND user\_id = '$current\_user->ID'"); |
  |  | 376 | $cu\_id = esc\_sql($current\_user->ID); |
  |  | 377 | $project\_user = $wpdb->get\_row("SELECT \* FROM {$wpdb->prefix}wppm\_project\_users WHERE proj\_id = ".esc\_sql($project\_id)." AND user\_id = ".esc\_sql($cu\_id).""); |
  | 372 | 378 | $project\_users = $wpdb->get\_var("SELECT users FROM {$wpdb->prefix}wppm\_project WHERE id = '$project\_id'"); |
  | 373 | 379 | $project\_users\_arr = explode(',',(string)$project\_users); |
  | […](/browser/taskbuilder/trunk/includes/class-wppm-functions.php?rev=3191970#L403) | […](/browser/taskbuilder/tags/3.0.7/includes/class-wppm-functions.php?rev=3210469#L409) |  |
  | 403 | 409 | $prev\_status = $task\_data['status']; |
  | 404 | 410 | $values=array( |
  | 405 |  | 'status'=>~~$status\_id~~ |
  | 406 |  | ); |
  | 407 |  | $wpdb->update($wpdb->prefix.'wppm\_task', $values, array('id'=>~~$task\_id~~)); |
  |  | 411 | 'status'=>esc\_sql($status\_id) |
  |  | 412 | ); |
  |  | 413 | $wpdb->update($wpdb->prefix.'wppm\_task', $values, array('id'=>esc\_sql($task\_id))); |
  | 408 | 414 | $old\_task\_status\_meta = $wppmfunction->get\_task\_meta($task\_id,'old\_task\_status',true); |
  | 409 | 415 | if(!empty($old\_task\_status\_meta)){ |
  | […](/browser/taskbuilder/trunk/includes/class-wppm-functions.php?rev=3191970#L418) | […](/browser/taskbuilder/tags/3.0.7/includes/class-wppm-functions.php?rev=3210469#L424) |  |
  | 418 | 424 | global $wpdb; |
  | 419 | 425 | $values=array( |
  | 420 |  | 'created\_by'=>~~$user\_id~~ |
  | 421 |  | ); |
  | 422 |  | $wpdb->update($wpdb->prefix.'wppm\_task', $values, array('id'=>~~$task\_id~~)); |
  |  | 426 | 'created\_by'=>esc\_sql($user\_id) |
  |  | 427 | ); |
  |  | 428 | $wpdb->update($wpdb->prefix.'wppm\_task', $values, array('id'=>esc\_sql($task\_id))); |
  | 423 | 429 | } |
  | 424 | 430 |  |
  | […](/browser/taskbuilder/trunk/includes/class-wppm-functions.php?rev=3191970#L428) | […](/browser/taskbuilder/tags/3.0.7/includes/class-wppm-functions.php?rev=3210469#L434) |  |
  | 428 | 434 | 'task\_name'=>stripslashes($task\_label) |
  | 429 | 435 | ); |
  | 430 |  | $wpdb->update($wpdb->prefix.'wppm\_task', $values, array('id'=>~~$task\_id~~)); |
  |  | 436 | $wpdb->update($wpdb->prefix.'wppm\_task', $values, array('id'=>esc\_sql($task\_id))); |
  | 431 | 437 | } |
  | 432 | 438 |  |
  | […](/browser/taskbuilder/trunk/includes/class-wppm-functions.php?rev=3191970#L434) | […](/browser/taskbuilder/tags/3.0.7/includes/class-wppm-functions.php?rev=3210469#L440) |  |
  | 434 | 440 | global $wpdb; |
  | 435 | 441 | $values=array( |
  | 436 |  | 'project'=>~~$project\_label~~ |
  | 437 |  | ); |
  | 438 |  | $wpdb->update($wpdb->prefix.'wppm\_task', $values, array('id'=>~~$task\_id~~)); |
  |  | 442 | 'project'=>esc\_sql($project\_label) |
  |  | 443 | ); |
  |  | 444 | $wpdb->update($wpdb->prefix.'wppm\_task', $values, array('id'=>esc\_sql($task\_id))); |
  | 439 | 445 | } |
  | 440 | 446 |  |
  | […](/browser/taskbuilder/trunk/includes/class-wppm-functions.php?rev=3191970#L442) | […](/browser/taskbuilder/tags/3.0.7/includes/class-wppm-functions.php?rev=3210469#L448) |  |
  | 442 | 448 | global $wpdb; |
  | 443 | 449 | $values=array( |
  | 444 |  | 'start\_date'=>~~$task\_start\_date~~ |
  | 445 |  | ); |
  | 446 |  | $wpdb->update($wpdb->prefix.'wppm\_task', $values, array('id'=>~~$task\_id~~)); |
  |  | 450 | 'start\_date'=>esc\_sql($task\_start\_date) |
  |  | 451 | ); |
  |  | 452 | $wpdb->update($wpdb->prefix.'wppm\_task', $values, array('id'=>esc\_sql($task\_id))); |
  | 447 | 453 | } |
  | 448 | 454 |  |
  | […](/browser/taskbuilder/trunk/includes/class-wppm-functions.php?rev=3191970#L450) | […](/browser/taskbuilder/tags/3.0.7/includes/class-wppm-functions.php?rev=3210469#L456) |  |
  | 450 | 456 | global $wpdb; |
  | 451 | 457 | $values=array( |
  | 452 |  | 'end\_date'=>~~$task\_end\_date~~ |
  | 453 |  | ); |
  | 454 |  | $wpdb->update($wpdb->prefix.'wppm\_task', $values, array('id'=>~~$task\_id~~)); |
  |  | 458 | 'end\_date'=>esc\_sql($task\_end\_date) |
  |  | 459 | ); |
  |  | 460 | $wpdb->update($wpdb->prefix.'wppm\_task', $values, array('id'=>esc\_sql($task\_id))); |
  | 455 | 461 | } |
  | 456 | 462 |  |
  | […](/browser/taskbuilder/trunk/includes/class-wppm-functions.php?rev=3191970#L458) | […](/browser/taskbuilder/tags/3.0.7/includes/class-wppm-functions.php?rev=3210469#L464) |  |
  | 458 | 464 | global $wpdb; |
  | 459 | 465 | $values=array( |
  | 460 |  | 'priority'=>~~$task\_priority~~ |
  | 461 |  | ); |
  | 462 |  | $wpdb->update($wpdb->prefix.'wppm\_task', $values, array('id'=>~~$task\_id~~)); |
  |  | 466 | 'priority'=>esc\_sql($task\_priority) |
  |  | 467 | ); |
  |  | 468 | $wpdb->update($wpdb->prefix.'wppm\_task', $values, array('id'=>esc\_sql($task\_id))); |
  | 463 | 469 | } |
  | 464 | 470 |  |
  | 465 | 471 | public function change\_description($task\_id, $task\_description){ |
  | 466 | 472 | global $wpdb; |
  |  | 473 | $task\_description = wp\_kses\_post($task\_description); |
  | 467 | 474 | $values=array( |
  | 468 | 475 | 'description'=>$task\_description |
  | 469 | 476 | ); |
  | 470 |  | $wpdb->update($wpdb->prefix.'wppm\_task', $values, array('id'=>~~$task\_id~~)); |
  |  | 477 | $wpdb->update($wpdb->prefix.'wppm\_task', $values, array('id'=>esc\_sql($task\_id))); |
  | 471 | 478 | } |
  | 472 | 479 |  |
  | […](/browser/taskbuilder/trunk/includes/class-wppm-functions.php?rev=3191970#L490) | […](/browser/taskbuilder/tags/3.0.7/includes/class-wppm-functions.php?rev=3210469#L497) |  |
  | 490 | 497 | foreach($task\_users\_array as $tuser){ |
  | 491 | 498 | if(!in\_array($tuser,$project\_users)){ |
  | 492 |  | $wpdb->delete( $wpdb->prefix.'wppm\_project\_users', array( 'proj\_id' => ~~$proj\_id,'user\_id'=>$tuser~~) ); |
  |  | 499 | $wpdb->delete( $wpdb->prefix.'wppm\_project\_users', array( 'proj\_id' => "$proj\_id",'user\_id'=>"$tuser") ); |
  | 493 | 500 | } |
  | 494 | 501 | elseif(in\_array($tuser,$project\_users)){ |
  | 495 | 502 | $tusers\_array[] = $tuser; |
  | 496 |  | $sql = 'SELECT role\_id FROM ' . $wpdb->prefix . 'wppm\_project\_users WHERE proj\_id = ' . $old\_proj .' AND user\_id = '.$tuser; |
  |  | 503 | $tuser = esc\_sql($tuser); |
  |  | 504 | $sql = 'SELECT role\_id FROM ' . $wpdb->prefix . 'wppm\_project\_users WHERE proj\_id = ' . $old\_proj .' AND user\_id = '."$tuser"; |
  | 497 | 505 | $old\_proj\_user\_role =  $wpdb->get\_var( $sql ); |
  | 498 |  | $sql = 'SELECT role\_id FROM ' . $wpdb->prefix . 'wppm\_project\_users WHERE proj\_id = ' . $proj\_id .' AND user\_id = '.~~$tuser~~; |
  |  | 506 | $sql = 'SELECT role\_id FROM ' . $wpdb->prefix . 'wppm\_project\_users WHERE proj\_id = ' . $proj\_id .' AND user\_id = '."$tuser"; |
  | 499 | 507 | $proj\_users\_role =  $wpdb->get\_var( $sql ); |
  | 500 | 508 | if(!empty( $old\_proj\_user\_role) && $old\_proj\_user\_role!=$proj\_users\_role){ |
  | 501 | 509 | $value=array( |
  | 502 |  | 'role\_id'=>~~$proj\_users\_role~~ |
  |  | 510 | 'role\_id'=>esc\_sql($proj\_users\_role) |
  | 503 | 511 | ); |
  | 504 |  | $wpdb->update($wpdb->prefix.'wppm\_project\_users', $value, array('proj\_id'=>~~$proj\_id, 'user\_id'=>$tuser~~)); |
  |  | 512 | $wpdb->update($wpdb->prefix.'wppm\_project\_users', $value, array('proj\_id'=>"$proj\_id", 'user\_id'=>"$tuser")); |
  | 505 | 513 | } |
  | 506 | 514 | } |
  | […](/browser/taskbuilder/trunk/includes/class-wppm-functions.php?rev=3191970#L510) | […](/browser/taskbuilder/tags/3.0.7/includes/class-wppm-functions.php?rev=3210469#L518) |  |
  | 510 | 518 | $tusers = implode(",",$tusers\_array); |
  | 511 | 519 | $values=array( |
  | 512 |  | 'project'=>~~$proj\_id~~, |
  | 513 |  | 'users'=>~~$tusers~~ |
  | 514 |  | ); |
  | 515 |  | $wpdb->update($wpdb->prefix.'wppm\_task', $values, array('id'=>~~$task\_id~~)); |
  |  | 520 | 'project'=>esc\_sql($proj\_id), |
  |  | 521 | 'users'=>esc\_sql($tusers) |
  |  | 522 | ); |
  |  | 523 | $wpdb->update($wpdb->prefix.'wppm\_task', $values, array('id'=>esc\_sql($task\_id))); |
  | 516 | 524 | } |
  | 517 | 525 |  |
  | […](/browser/taskbuilder/trunk/includes/class-wppm-functions.php?rev=3191970#L541) | […](/browser/taskbuilder/tags/3.0.7/includes/class-wppm-functions.php?rev=3210469#L549) |  |
  | 541 | 549 | global $wpdb; |
  | 542 | 550 | $comment\_id = esc\_sql($comment\_id); |
  | 543 |  | $comment\_body = ~~esc\_sql~~($comment\_body); |
  |  | 551 | $comment\_body = wp\_kses\_post($comment\_body); |
  | 544 | 552 | $values=array( |
  | 545 | 553 | 'body'=>$comment\_body |
  | 546 | 554 | ); |
  | 547 |  | $wpdb->update($wpdb->prefix.'wppm\_task\_comment', $values, array('id'=>~~$comment\_id~~)); |
  |  | 555 | $wpdb->update($wpdb->prefix.'wppm\_task\_comment', $values, array('id'=>"$comment\_id")); |
  | 548 | 556 | } |
  | 549 | 557 |  |
  | […](/browser/taskbuilder/trunk/includes/class-wppm-functions.php?rev=3191970#L551) | […](/browser/taskbuilder/tags/3.0.7/includes/class-wppm-functions.php?rev=3210469#L559) |  |
  | 551 | 559 | global $wpdb; |
  | 552 | 560 | $comment\_id = esc\_sql($comment\_id); |
  | 553 |  | $comment\_body = ~~esc\_sql~~($comment\_body); |
  |  | 561 | $comment\_body = wp\_kses\_post($comment\_body); |
  | 554 | 562 | $values=array( |
  | 555 | 563 | 'body'=>$comment\_body |
  | 556 | 564 | ); |
  | 557 |  | $wpdb->update($wpdb->prefix.'wppm\_project\_comment', $values, array('id'=>~~$comment\_id~~)); |
  |  | 565 | $wpdb->update($wpdb->prefix.'wppm\_project\_comment', $values, array('id'=>"$comment\_id")); |
  | 558 | 566 | } |
  | 559 | 567 |  |
  | […](/browser/taskbuilder/trunk/includes/class-wppm-functions.php?rev=3191970#L561) | […](/browser/taskbuilder/tags/3.0.7/includes/class-wppm-functions.php?rev=3210469#L569) |  |
  | 561 | 569 | global $wpdb; |
  | 562 | 570 | $project\_id = esc\_sql($project\_id); |
  | 563 |  | $project\_label = esc\_sql($project\_label); |
  | 564 |  | $values=array( |
  | 565 |  | 'project\_name'=>$project\_label |
  |  | 571 | $values=array( |
  |  | 572 | 'project\_name'=>esc\_sql($project\_label) |
  |  | 573 | ); |
  |  | 574 | $wpdb->update($wpdb->prefix.'wppm\_project', $values, array('id'=>"$project\_id")); |
  |  | 575 | } |
  |  | 576 |  |
  |  | 577 | public function change\_project\_start\_date($project\_id, $project\_start\_date){ |
  |  | 578 | global $wpdb; |
  |  | 579 | $project\_id = esc\_sql($project\_id); |
  |  | 580 | $project\_start\_date = esc\_sql($project\_start\_date); |
  |  | 581 | $values=array( |
  |  | 582 | 'start\_date'=>$project\_start\_date |
  |  | 583 | ); |
  |  | 584 | $wpdb->update($wpdb->prefix.'wppm\_project', $values, array('id'=>"$project\_id")); |
  |  | 585 | } |
  |  | 586 |  |
  |  | 587 | public function change\_project\_end\_date($project\_id, $project\_end\_date){ |
  |  | 588 | global $wpdb; |
  |  | 589 | $project\_id = esc\_sql($project\_id); |
  |  | 590 | $project\_end\_date = esc\_sql($project\_end\_date); |
  |  | 591 | $values=array( |
  |  | 592 | 'end\_date'=>$project\_end\_date |
  | 566 | 593 | ); |
  | 567 | 594 | $wpdb->update($wpdb->prefix.'wppm\_project', $values, array('id'=>$project\_id)); |
  | 568 | 595 | } |
  | 569 | 596 |  |
  | 570 |  | ~~public function change\_project\_start\_date($project\_id, $project\_start\_date){~~ |
  | 571 |  | ~~global $wpdb;~~ |
  | 572 |  | ~~$project\_id = esc\_sql($project\_id);~~ |
  | 573 |  | ~~$project\_start\_date = esc\_sql($project\_start\_date);~~ |
  | 574 |  | ~~$values=array(~~ |
  | 575 |  | ~~'start\_date'=>$project\_start\_date~~ |
  | 576 |  | ~~);~~ |
  | 577 |  | ~~$wpdb->update($wpdb->prefix.'wppm\_project', $values, array('id'=>$project\_id));~~ |
  | 578 |  | ~~}~~ |
  | 579 |  |  |
  | 580 |  | ~~public function change\_project\_end\_date($project\_id, $project\_end\_date){~~ |
  | 581 |  | ~~global $wpdb;~~ |
  | 582 |  | ~~$project\_id = esc\_sql($project\_id);~~ |
  | 583 |  | ~~$project\_end\_date = esc\_sql($project\_end\_date);~~ |
  | 584 |  | ~~$values=array(~~ |
  | 585 |  | ~~'end\_date'=>$project\_end\_date~~ |
  | 586 |  | ~~);~~ |
  | 587 |  | ~~$wpdb->update($wpdb->prefix.'wppm\_project', $values, array('id'=>$project\_id));~~ |
  | 588 |  | ~~}~~ |
  | 589 |  |  |
  | 590 | 597 | public function change\_category($project\_id, $project\_category){ |
  | 591 | 598 | global $wpdb; |
  | […](/browser/taskbuilder/trunk/includes/class-wppm-functions.php?rev=3191970#L595) | […](/browser/taskbuilder/tags/3.0.7/includes/class-wppm-functions.php?rev=3210469#L602) |  |
  | 595 | 602 | 'cat\_id'=>$project\_category |
  | 596 | 603 | ); |
  | 597 |  | $wpdb->update($wpdb->prefix.'wppm\_project', $values, array('id'=>~~$project\_id~~)); |
  |  | 604 | $wpdb->update($wpdb->prefix.'wppm\_project', $values, array('id'=>"$project\_id")); |
  | 598 | 605 | } |
  | 599 | 606 |  |
  | […](/browser/taskbuilder/trunk/includes/class-wppm-functions.php?rev=3191970#L601) | […](/browser/taskbuilder/tags/3.0.7/includes/class-wppm-functions.php?rev=3210469#L608) |  |
  | 601 | 608 | global $wpdb; |
  | 602 | 609 | $project\_id = esc\_sql($project\_id); |
  | 603 |  | $project\_description = esc\_sql($project\_description); |
  | 604 |  | $values=array( |
  | 605 |  | 'description'=>$project\_description |
  | 606 |  | ); |
  | 607 |  | $wpdb->update($wpdb->prefix.'wppm\_project', $values, array('id'=>$project\_id)); |
  |  | 610 | $values=array( |
  |  | 611 | 'description'=>wp\_kses\_post($project\_description) |
  |  | 612 | ); |
  |  | 613 | $wpdb->update($wpdb->prefix.'wppm\_project', $values, array('id'=>"$project\_id")); |
  | 608 | 614 | } |
  | 609 | 615 |  |
  | […](/browser/taskbuilder/trunk/includes/class-wppm-functions.php?rev=3191970#L612) | […](/browser/taskbuilder/tags/3.0.7/includes/class-wppm-functions.php?rev=3210469#L618) |  |
  | 612 | 618 | $change\_status\_value= array(); |
  | 613 | 619 | $proj\_data = $wppmfunction->get\_project($project\_id); |
  | 614 |  | $prev\_status = ~~esc\_sql($proj\_data['status'])~~; |
  | 615 |  | $~~project\_id = esc\_sql($project\_id~~); |
  | 616 |  | $~~status\_id = esc\_sql($status\_id);~~ |
  | 617 |  | ~~$values=array(~~ |
  | 618 |  | ~~'status'=>$status\_id~~ |
  | 619 |  | ); |
  | 620 |  | $wpdb->update($wpdb->prefix.'wppm\_project', $values, array('id'=>~~$project\_id~~)); |
  |  | 620 | $prev\_status = $proj\_data['status']; |
  |  | 621 | $cu\_id = esc\_sql($current\_user->ID); |
  |  | 622 | $values=array( |
  |  | 623 | 'status'=>esc\_sql($status\_id) |
  |  | 624 | ); |
  |  | 625 | $project\_id = esc\_sql($project\_id); |
  |  | 626 | $wpdb->update($wpdb->prefix.'wppm\_project', $values, array('id'=>"$project\_id")); |
  | 621 | 627 | $old\_project\_status\_meta = $wppmfunction->get\_project\_meta($project\_id,'old\_project\_status',true); |
  | 622 | 628 | if(!empty($old\_project\_status\_meta)){ |
  | […](/browser/taskbuilder/trunk/includes/class-wppm-functions.php?rev=3191970#L625) | […](/browser/taskbuilder/tags/3.0.7/includes/class-wppm-functions.php?rev=3210469#L631) |  |
  | 625 | 631 | $change\_status\_value = array('prev\_status'=>"$prev\_status",'new\_status'=>"$status\_id"); |
  | 626 | 632 | $change\_status\_obj = serialize($change\_status\_value); |
  | 627 |  | $log\_values = array('proj\_id'=>~~$project\_id,'body'=>$change\_status\_obj,'attachment\_ids'=>"",'create\_time'=>date("Y-m-d h:i:sa"),'created\_by'=>$current\_user->ID~~ ); |
  |  | 633 | $log\_values = array('proj\_id'=>"$project\_id",'body'=>$change\_status\_obj,'attachment\_ids'=>"",'create\_time'=>date("Y-m-d h:i:sa"),'created\_by'=>"$cu\_id" ); |
  | 628 | 634 | $wpdb->insert($wpdb->prefix . 'wppm\_project\_comment',$log\_values); |
  | 629 | 635 | $log\_id = esc\_sql($wpdb->insert\_id); |
  | 630 |  | $proj\_log\_values = array('proj\_id'=>~~$project\_id,'comment\_id'=>$log\_id~~,'comment\_type'=>'change\_proj\_status'); |
  |  | 636 | $proj\_log\_values = array('proj\_id'=>"$project\_id",'comment\_id'=>"$log\_id",'comment\_type'=>'change\_proj\_status'); |
  | 631 | 637 | $wpdb->insert($wpdb->prefix . 'wppm\_project\_comment\_meta',$proj\_log\_values); |
  | 632 | 638 | $wppmfunction->add\_project\_meta($project\_id,'old\_project\_status',$prev\_status); |
  | […](/browser/taskbuilder/trunk/includes/class-wppm-functions.php?rev=3191970#L636) | […](/browser/taskbuilder/tags/3.0.7/includes/class-wppm-functions.php?rev=3210469#L642) |  |
  | 636 | 642 | public function change\_project\_raised\_by($project\_id, $user\_id){ |
  | 637 | 643 | global $wpdb; |
  | 638 |  | $project\_id = esc\_sql($project\_id); |
  | 639 |  | $user\_id = esc\_sql($user\_id); |
  | 640 |  | $values=array( |
  | 641 |  | 'created\_by'=>$user\_id |
  | 642 |  | ); |
  | 643 |  | $wpdb->update($wpdb->prefix.'wppm\_project', $values, array('id'=>$project\_id)); |
  |  | 644 | $values=array( |
  |  | 645 | 'created\_by'=>esc\_sql($user\_id) |
  |  | 646 | ); |
  |  | 647 | $wpdb->update($wpdb->prefix.'wppm\_project', $values, array('id'=>"$project\_id")); |
  | 644 | 648 | } |
  | 645 | 649 |  |
  | […](/browser/taskbuilder/trunk/includes/class-wppm-functions.php?rev=3191970#L673) | […](/browser/taskbuilder/tags/3.0.7/includes/class-wppm-functions.php?rev=3210469#L677) |  |
  | 673 | 677 | $wpdb->prefix . 'wppm\_project\_meta', |
  | 674 | 678 | array( |
  | 675 |  | 'project\_id' =>$proj\_id, |
  |  | 679 | 'project\_id' =>$proj\_id, |
  | 676 | 680 | 'meta\_key' => $meta\_key, |
  | 677 | 681 | 'meta\_value' =>$meta\_value |
  | […](/browser/taskbuilder/trunk/includes/class-wppm-functions.php?rev=3191970#L681) | […](/browser/taskbuilder/tags/3.0.7/includes/class-wppm-functions.php?rev=3210469#L685) |  |
  | 681 | 685 | public function add\_task\_meta($task\_id,$meta\_key,$meta\_value){ |
  | 682 | 686 | global $wpdb; |
  | 683 |  | ~~$task\_id = esc\_sql($task\_id);~~ |
  | 684 |  | ~~$meta\_key = esc\_sql($meta\_key);~~ |
  | 685 |  | ~~$meta\_value = esc\_sql($meta\_value);~~ |
  | 686 | 687 | $wpdb->insert( |
  | 687 | 688 | $wpdb->prefix . 'wppm\_task\_meta', |
  | […](/browser/taskbuilder/trunk/includes/class-wppm-functions.php?rev=3191970#L792) | […](/browser/taskbuilder/tags/3.0.7/includes/class-wppm-functions.php?rev=3210469#L793) |  |
  | 792 | 793 | $project\_id = esc\_sql($project\_id); |
  | 793 | 794 | $meta\_key = esc\_sql($meta\_key); |
  | 794 |  | $results = $wpdb->get\_results("SELECT \* FROM {$wpdb->prefix}wppm\_project\_meta WHERE project\_id = '$project\_id' AND meta\_key = ~~$meta\_key~~"); |
  | 795 |  | $wpdb->update($wpdb->prefix.'wppm\_project\_meta', $meta\_value, array('project\_id'=>$project\_id,'meta\_key' => ~~$meta\_key~~)); |
  |  | 795 | $results = $wpdb->get\_results("SELECT \* FROM {$wpdb->prefix}wppm\_project\_meta WHERE project\_id = '$project\_id' AND meta\_key = '$meta\_key'"); |
  |  | 796 | $wpdb->update($wpdb->prefix.'wppm\_project\_meta', $meta\_value, array('project\_id'=>$project\_id,'meta\_key' => "$meta\_key")); |
  | 796 | 797 | } |
  | 797 | 798 |  |
  | […](/browser/taskbuilder/trunk/includes/class-wppm-functions.php?rev=3191970#L811) | […](/browser/taskbuilder/tags/3.0.7/includes/class-wppm-functions.php?rev=3210469#L812) |  |
  | 811 | 812 | $project\_id = esc\_sql($project\_id); |
  | 812 | 813 | $meta\_key = esc\_sql($meta\_key); |
  | 813 |  | $wpdb->delete( $wpdb->prefix.'wppm\_project\_meta', array( 'project\_id' => ~~$project\_id,'meta\_key'=>$meta\_key~~) ); |
  |  | 814 | $wpdb->delete( $wpdb->prefix.'wppm\_project\_meta', array( 'project\_id' => "$project\_id",'meta\_key'=>"$meta\_key") ); |
  | 814 | 815 | } |
  | 815 | 816 |  |
  | […](/browser/taskbuilder/trunk/includes/class-wppm-functions.php?rev=3191970#L818) | […](/browser/taskbuilder/tags/3.0.7/includes/class-wppm-functions.php?rev=3210469#L819) |  |
  | 818 | 819 | $task\_id = esc\_sql($task\_id); |
  | 819 | 820 | $meta\_key = esc\_sql($meta\_key); |
  | 820 |  | $wpdb->delete( $wpdb->prefix.'wppm\_task\_meta', array( 'task\_id' => ~~$task\_id,'meta\_key'=>$meta\_key~~) ); |
  |  | 821 | $wpdb->delete( $wpdb->prefix.'wppm\_task\_meta', array( 'task\_id' => "$task\_id",'meta\_key'=>"$meta\_key") ); |
  | 821 | 822 | } |
  | 822 | 823 |  |
* ## [taskbuilder/tags/3.0.7/includes/frontend/wppm\_tasks\_shortcode.php](/changeset/3210469/taskbuilder/tags/3.0.7/includes/frontend/wppm_tasks_shortcode.php "Show the changeset 3210469 restricted to taskbuilder/tags/3.0.7/includes/frontend/wppm_tasks_shortcode.php")

  | [r3123269](/browser/taskbuilder/trunk/includes/frontend/wppm_tasks_shortcode.php?rev=3123269#L121 "Show revision 3123269 of this file in browser") | [r3210469](/browser/taskbuilder/tags/3.0.7/includes/frontend/wppm_tasks_shortcode.php?rev=3210469#L121 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 121 | 121 | if(!empty($this->shortcode\_attr['project'])){ |
  | 122 | 122 | ?> |
  | 123 |  | dataform.append("wppm\_project\_attr","<?php echo ~~$this->shortcode\_attr['project']~~; ?>"); |
  |  | 123 | dataform.append("wppm\_project\_attr","<?php echo esc\_attr($this->shortcode\_attr['project']); ?>"); |
  | 124 | 124 | <?php } ?> |
  | 125 | 125 | jQuery.ajax( { |
  | […](/browser/taskbuilder/trunk/includes/frontend/wppm_tasks_shortcode.php?rev=3123269#L162) | […](/browser/taskbuilder/tags/3.0.7/includes/frontend/wppm_tasks_shortcode.php?rev=3210469#L162) |  |
  | 162 | 162 | dataform.append("action", 'wppm\_get\_task\_list'); |
  | 163 | 163 | <?php if(!empty($this->shortcode\_attr['project'])){ ?> |
  | 164 |  | dataform.append("wppm\_project\_attr","<?php echo ~~$this->shortcode\_attr['project']~~ ?>"); |
  |  | 164 | dataform.append("wppm\_project\_attr","<?php echo esc\_attr($this->shortcode\_attr['project']); ?>"); |
  | 165 | 165 | <?php } ?> |
  | 166 | 166 | jQuery.ajax( { |
  | […](/browser/taskbuilder/trunk/includes/frontend/wppm_tasks_shortcode.php?rev=3123269#L185) | […](/browser/taskbuilder/tags/3.0.7/includes/frontend/wppm_tasks_shortcode.php?rev=3210469#L185) |  |
  | 185 | 185 | dataform.append("wppm\_proj\_filter",0); |
  | 186 | 186 | <?php if(!empty($this->shortcode\_attr['project'])){ ?> |
  | 187 |  | dataform.append("wppm\_project\_attr","<?php echo ~~$this->shortcode\_attr['project']~~ ?>"); |
  |  | 187 | dataform.append("wppm\_project\_attr","<?php echo esc\_attr($this->shortcode\_attr['project']); ?>"); |
  | 188 | 188 | <?php } ?> |
  | 189 | 189 | <?php echo do\_action('wppm\_tl\_reset\_filter\_dataform');?> |
  | […](/browser/taskbuilder/trunk/includes/frontend/wppm_tasks_shortcode.php?rev=3123269#L208) | […](/browser/taskbuilder/tags/3.0.7/includes/frontend/wppm_tasks_shortcode.php?rev=3210469#L208) |  |
  | 208 | 208 | dataform.append("action", 'wppm\_get\_task\_list'); |
  | 209 | 209 | <?php if(!empty($this->shortcode\_attr['project'])){ ?> |
  | 210 |  | dataform.append("wppm\_project\_attr","<?php echo ~~$this->shortcode\_attr['project']~~ ?>"); |
  |  | 210 | dataform.append("wppm\_project\_attr","<?php echo esc\_attr($this->shortcode\_attr['project']); ?>"); |
  | 211 | 211 | <?php } ?> |
  | 212 | 212 | dataform.append("task\_search", task\_search); |
  | […](/browser/taskbuilder/trunk/includes/frontend/wppm_tasks_shortcode.php?rev=3123269#L232) | […](/browser/taskbuilder/tags/3.0.7/includes/frontend/wppm_tasks_shortcode.php?rev=3210469#L232) |  |
  | 232 | 232 | dataform.append("task\_search", task\_search); |
  | 233 | 233 | <?php if(!empty($this->shortcode\_attr['project'])){ ?> |
  | 234 |  | dataform.append("wppm\_project\_attr","<?php echo ~~$this->shortcode\_attr['project']~~ ?>"); |
  |  | 234 | dataform.append("wppm\_project\_attr","<?php echo esc\_attr($this->shortcode\_attr['project']); ?>"); |
  | 235 | 235 | <?php } ?> |
  | 236 | 236 | jQuery.ajax( { |
  | […](/browser/taskbuilder/trunk/includes/frontend/wppm_tasks_shortcode.php?rev=3123269#L255) | […](/browser/taskbuilder/tags/3.0.7/includes/frontend/wppm_tasks_shortcode.php?rev=3210469#L255) |  |
  | 255 | 255 | dataform.append("order", order); |
  | 256 | 256 | <?php if(!empty($this->shortcode\_attr['project'])){ ?> |
  | 257 |  | dataform.append("wppm\_project\_attr","<?php echo ~~$this->shortcode\_attr['project']~~ ?>"); |
  |  | 257 | dataform.append("wppm\_project\_attr","<?php echo esc\_attr($this->shortcode\_attr['project']); ?>"); |
  | 258 | 258 | <?php } ?> |
  | 259 | 259 | jQuery.ajax( { |
  | […](/browser/taskbuilder/trunk/includes/frontend/wppm_tasks_shortcode.php?rev=3123269#L284) | […](/browser/taskbuilder/tags/3.0.7/includes/frontend/wppm_tasks_shortcode.php?rev=3210469#L284) |  |
  | 284 | 284 | dataform.append("page\_no",page\_no); |
  | 285 | 285 | <?php if(!empty($this->shortcode\_attr['project'])){ ?> |
  | 286 |  | dataform.append("wppm\_project\_attr","<?php echo ~~$this->shortcode\_attr['project']~~ ?>"); |
  |  | 286 | dataform.append("wppm\_project\_attr","<?php echo esc\_attr($this->shortcode\_attr['project']); ?>"); |
  | 287 | 287 | <?php } ?> |
  | 288 | 288 | jQuery.ajax( { |
  | […](/browser/taskbuilder/trunk/includes/frontend/wppm_tasks_shortcode.php?rev=3123269#L306) | […](/browser/taskbuilder/tags/3.0.7/includes/frontend/wppm_tasks_shortcode.php?rev=3210469#L306) |  |
  | 306 | 306 | dataform.append("wppm\_task\_filter", wppm\_task\_filter); |
  | 307 | 307 | <?php if(!empty($this->shortcode\_attr['project'])){ ?> |
  | 308 |  | dataform.append("wppm\_project\_attr","<?php echo ~~$this->shortcode\_attr['project']~~ ?>"); |
  |  | 308 | dataform.append("wppm\_project\_attr","<?php echo esc\_attr($this->shortcode\_attr['project']); ?>"); |
  | 309 | 309 | <?php } ?> |
  | 310 | 310 | jQuery.ajax( { |
  | […](/browser/taskbuilder/trunk/includes/frontend/wppm_tasks_shortcode.php?rev=3123269#L331) | […](/browser/taskbuilder/tags/3.0.7/includes/frontend/wppm_tasks_shortcode.php?rev=3210469#L331) |  |
  | 331 | 331 | dataform.append("wppm\_proj\_filter","0"); |
  | 332 | 332 | <?php if(!empty($this->shortcode\_attr['project'])){ ?> |
  | 333 |  | dataform.append("wppm\_project\_attr","<?php echo ~~$this->shortcode\_attr['project']~~ ?>"); |
  |  | 333 | dataform.append("wppm\_project\_attr","<?php echo esc\_attr($this->shortcode\_attr['project']); ?>"); |
  | 334 | 334 | <?php } ?> |
  | 335 | 335 | jQuery.ajax( { |
* ## [taskbuilder/tags/3.0.7/includes/replace\_macro.php](/changeset/3210469/taskbuilder/tags/3.0.7/includes/replace_macro.php "Show the changeset 3210469 restricted to taskbuilder/tags/3.0.7/includes/replace_macro.php")

  | [r3174963](/browser/taskbuilder/trunk/includes/replace_macro.php?rev=3174963#L8 "Show revision 3174963 of this file in browser") | [r3210469](/browser/taskbuilder/tags/3.0.7/includes/replace_macro.php?rev=3210469#L8 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 8 | 8 | $project\_id = intval(sanitize\_text\_field($project\_id)); |
  | 9 | 9 | $wppm\_project\_data = $wppmfunction->get\_project($project\_id); |
  | 10 |  | $orderby\_sql       = ~~sanitize\_sql\_orderby( "id DESC"~~ ); |
  | 11 |  | $wppm\_proj\_comment = $wpdb->get\_row("SELECT \* FROM {$wpdb->prefix}wppm\_project\_comment where proj\_id='".~~$project\_id~~."' ORDER BY $orderby\_sql LIMIT 1;"); |
  |  | 10 | $orderby\_sql       = esc\_sql(sanitize\_sql\_orderby( "id DESC" )); |
  |  | 11 | $wppm\_proj\_comment = $wpdb->get\_row("SELECT \* FROM {$wpdb->prefix}wppm\_project\_comment where proj\_id='".esc\_sql($project\_id)."' ORDER BY $orderby\_sql LIMIT 1;"); |
  | 12 | 12 | $attachments = array(); |
  | 13 | 13 | $auth\_id  = $wppmfunction->get\_project\_meta($project\_id,'project\_auth\_code',true); |
* ## [taskbuilder/tags/3.0.7/includes/replace\_task\_macro.php](/changeset/3210469/taskbuilder/tags/3.0.7/includes/replace_task_macro.php "Show the changeset 3210469 restricted to taskbuilder/tags/3.0.7/includes/replace_task_macro.php")

  | [r3174963](/browser/taskbuilder/trunk/includes/replace_task_macro.php?rev=3174963#L8 "Show revision 3174963 of this file in browser") | [r3210469](/browser/taskbuilder/tags/3.0.7/includes/replace_task_macro.php?rev=3210469#L8 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 8 | 8 | $task\_id = intval(sanitize\_text\_field($task\_id)); |
  | 9 | 9 | $wppm\_task\_data = $wppmfunction->get\_task($task\_id); |
  | 10 |  | $orderby\_sql       = sanitize\_sql\_orderby( "id DESC" ); |
  | 11 |  | $wppm\_task\_comment = $wpdb->get\_row("SELECT \* FROM {$wpdb->prefix}wppm\_task\_comment where task\_id='".$task\_id."' ORDER BY $orderby\_sql LIMIT 1;"); |
  |  | 10 | $task\_creator = $wppm\_task\_data['created\_by']; |
  |  | 11 | $task\_creator\_data = get\_userdata($task\_creator); |
  |  | 12 | $task\_creator\_name = $task\_creator\_data->display\_name; |
  |  | 13 | $orderby\_sql       = esc\_sql(sanitize\_sql\_orderby( "id DESC" )); |
  |  | 14 | $wppm\_task\_comment = $wpdb->get\_row("SELECT \* FROM {$wpdb->prefix}wppm\_task\_comment where task\_id='".esc\_sql($task\_id)."' ORDER BY $orderby\_sql LIMIT 1;"); |
  | 12 | 15 | $wppm\_project\_data = $wppmfunction->get\_project($wppm\_task\_data['project']); |
  | 13 | 16 | $auth\_id           = sanitize\_text\_field($wppm\_task\_data['task\_auth\_code']); |
  | […](/browser/taskbuilder/trunk/includes/replace_task_macro.php?rev=3174963#L24) | […](/browser/taskbuilder/tags/3.0.7/includes/replace_task_macro.php?rev=3210469#L27) |  |
  | 24 | 27 | case '{task\_id}': |
  | 25 | 28 | $str = preg\_replace('/{task\_id}/', $task\_id, $str); |
  |  | 29 | break; |
  |  | 30 | // Task Creator Name |
  |  | 31 | case '{task\_creator\_name}': |
  |  | 32 | $str = preg\_replace('/{task\_creator\_name}/', $task\_creator\_name, $str); |
  | 26 | 33 | break; |
  | 27 | 34 | //Current User Name |
  | […](/browser/taskbuilder/trunk/includes/replace_task_macro.php?rev=3174963#L89) | […](/browser/taskbuilder/tags/3.0.7/includes/replace_task_macro.php?rev=3210469#L96) |  |
  | 89 | 96 | // Project Category |
  | 90 | 97 | case '{project\_category}'; |
  | 91 |  | $str = preg\_replace('/{project\_category}/', $this->get\_project\_category\_name((sanitize\_text\_field($wppm\_project\_data['cat\_id'])), $str)); |
  |  | 98 | if(!empty($wppm\_project\_data['cat\_id'])){ |
  |  | 99 | $str = preg\_replace('/{project\_category}/', $this->get\_project\_category\_name(sanitize\_text\_field($wppm\_project\_data['cat\_id'])), $str); |
  |  | 100 | }else{ |
  |  | 101 | $str = ""; |
  |  | 102 | } |
  | 92 | 103 | break; |
  | 93 | 104 | // Project Name |
* ## [taskbuilder/tags/3.0.7/readme.txt](/changeset/3210469/taskbuilder/tags/3.0.7/readme.txt "Show the changeset 3210469 restricted to taskbuilder/tags/3.0.7/readme.txt")

  | [r3191970](/browser/taskbuilder/trunk/readme.txt?rev=3191970#L4 "Show revision 3191970 of this file in browser") | [r3210469](/browser/taskbuilder/tags/3.0.7/readme.txt?rev=3210469#L4 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 4 | 4 | Tags: project,project management,task management,task manager,Kanban |
  | 5 | 5 | Requires at least: 4.4 |
  | 6 |  | Tested up to: 6.7 |
  | 7 |  | Stable tag: 3.0.~~6~~ |
  |  | 6 | Tested up to: 6.7.1 |
  |  | 7 | Stable tag: 3.0.7 |
  | 8 | 8 | License: GPL v3 |
  | 9 | 9 |  |
  | […](/browser/taskbuilder/trunk/readme.txt?rev=3191970#L55) | […](/browser/taskbuilder/tags/3.0.7/readme.txt?rev=3210469#L55) |  |
  | 55 | 55 | \* [Buddypress](https://taskbuilder.net/buddypress/) - Buddypress Integration add-on allows you to create and manage projects,tasks in buddypress group on your own WordPress site. |
  | 56 | 56 | \* [WooCommerce](https://taskbuilder.net/woocommerce/) - WooCommerce Integration add-on automatically create task after order received. You can set order details in task description. |
  |  | 57 | \* [Due Date Reminder](https://taskbuilder.net/due-date-reminder/) - Due date reminder are super helpful for keeping your team on track to hit deadlines. Email notification will send to customer before due date of task. |
  | 57 | 58 |  |
  | 58 | 59 | ## 👨‍💻 DOCUMENTATION AND SUPPORT ## |
  | […](/browser/taskbuilder/trunk/readme.txt?rev=3191970#L111) | […](/browser/taskbuilder/tags/3.0.7/readme.txt?rev=3210469#L112) |  |
  | 111 | 112 |  |
  | 112 | 113 | == Changelog == |
  |  | 114 | = V 3.0.7(Dec 19,2024) = |
  |  | 115 | \* Fix: When edit task comment and save it, rn added insatead of space. |
  |  | 116 | \* Fix: SQL Injection (SQLi) vulnerability. |
  |  | 117 | \* Fix: XSS vulnerability. |
  |  | 118 | \* New(Pro feature): Due Date reminder add-on. |
  |  | 119 |  |
  | 113 | 120 | = V 3.0.6(Nov 19,2024) = |
  | 114 | 121 | \* New: Compatible with WordPress v6.7. |
* ## [taskbuilder/tags/3.0.7/taskbuilder.php](/changeset/3210469/taskbuilder/tags/3.0.7/taskbuilder.php "Show the changeset 3210469 restricted to taskbuilder/tags/3.0.7/taskbuilder.php")

  | [r3191970](/browser/taskbuilder/trunk/taskbuilder.php?rev=3191970#L4 "Show revision 3191970 of this file in browser") | [r3210469](/browser/taskbuilder/tags/3.0.7/taskbuilder.php?rev=3210469#L4 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 4 | 4 | \* Plugin URI: https://wordpress.org/plugins/taskbuilder/ |
  | 5 | 5 | \* Description: Wordpress Project & Task Management plugin. Easy to keep track of projects & tasks! |
  | 6 |  | \* Version: 3.0.~~6~~ |
  |  | 6 | \* Version: 3.0.7 |
  | 7 | 7 | \* Author: Taskbuilder Team |
  | 8 | 8 | \* Author URI: https://taskbuilder.net/ |
  | 9 | 9 | \* Requires at least: 4.4 |
  | 10 |  | \* Tested up to: 6.7 |
  |  | 10 | \* Tested up to: 6.7.1 |
  | 11 | 11 | \* Text Domain: taskbuilder |
  | 12 | 12 | \* Domain Path: /lang |
  | […](/browser/taskbuilder/trunk/taskbuilder.php?rev=3191970#L20) | […](/browser/taskbuilder/tags/3.0.7/taskbuilder.php?rev=3210469#L20) |  |
  | 20 | 20 |  |
  | 21 | 21 | final class WP\_Taskbuilder { |
  | 22 |  | public $version    = '3.0.~~6~~'; |
  |  | 22 | public $version    = '3.0.7'; |
  | 23 | 23 | public function \_\_construct() { |
  | 24 | 24 | // define global constants |
* ## [taskbuilder/trunk/includes/actions/wppm\_check\_cron\_attachment.php](/changeset/3210469/taskbuilder/trunk/includes/actions/wppm_check_cron_attachment.php "Show the changeset 3210469 restricted to taskbuilder/trunk/includes/actions/wppm_check_cron_attachment.php")

  | [r3174963](/browser/taskbuilder/trunk/includes/actions/wppm_check_cron_attachment.php?rev=3174963#L29 "Show revision 3174963 of this file in browser") | [r3210469](/browser/taskbuilder/trunk/includes/actions/wppm_check_cron_attachment.php?rev=3210469#L29 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 29 | 29 | $aid   = esc\_sql( $attachment->id ); |
  | 30 | 30 | if($diff > 86400){ |
  | 31 |  | $wpdb->delete($wpdb->prefix.'wppm\_attachments', array( 'id' => ~~$aid~~)); |
  |  | 31 | $wpdb->delete($wpdb->prefix.'wppm\_attachments', array( 'id' => "$aid")); |
  | 32 | 32 | if(file\_exists($filepath)){ |
  | 33 | 33 | unlink($filepath); |
* ## [taskbuilder/trunk/includes/admin/addons.php](/changeset/3210469/taskbuilder/trunk/includes/admin/addons.php "Show the changeset 3210469 restricted to taskbuilder/trunk/includes/admin/addons.php")

  | [r3174963](/browser/taskbuilder/trunk/includes/admin/addons.php?rev=3174963#L40 "Show revision 3174963 of this file in browser") | [r3210469](/browser/taskbuilder/trunk/includes/admin/addons.php?rev=3210469#L40 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 40 | 40 | <div class="pfooter"> |
  | 41 | 41 | <div class="purchase\_addon"> |
  | 42 |  | <a href="https://taskbuilder.net/~~add-ons~~/" target="\_\_blank" type="button" class="btn btn-success"><?php echo esc\_html\_e('Purchase','taskbuilder');?></a> |
  |  | 42 | <a href="https://taskbuilder.net/pricing/" target="\_\_blank" type="button" class="btn btn-success"><?php echo esc\_html\_e('Purchase','taskbuilder');?></a> |
  | 43 | 43 | </div> |
  | 44 | 44 | <div> |
  | […](/browser/taskbuilder/trunk/includes/admin/addons.php?rev=3174963#L68) | […](/browser/taskbuilder/trunk/includes/admin/addons.php?rev=3210469#L68) |  |
  | 68 | 68 | <div class="pfooter"> |
  | 69 | 69 | <div class="purchase\_addon"> |
  | 70 |  | <a href="https://taskbuilder.net/~~add-ons~~/" target="\_\_blank" type="button" class="btn btn-success"><?php echo esc\_html\_e('Purchase','taskbuilder');?></a> |
  |  | 70 | <a href="https://taskbuilder.net/pricing/" target="\_\_blank" type="button" class="btn btn-success"><?php echo esc\_html\_e('Purchase','taskbuilder');?></a> |
  | 71 | 71 | </div> |
  | 72 | 72 | <div> |
  | […](/browser/taskbuilder/trunk/includes/admin/addons.php?rev=3174963#L96) | […](/browser/taskbuilder/trunk/includes/admin/addons.php?rev=3210469#L96) |  |
  | 96 | 96 | <div class="pfooter"> |
  | 97 | 97 | <div class="purchase\_addon"> |
  | 98 |  | <a href="https://taskbuilder.net/~~add-ons~~/" target="\_\_blank" type="button" class="btn btn-success"><?php echo esc\_html\_e('Purchase','taskbuilder');?></a> |
  |  | 98 | <a href="https://taskbuilder.net/pricing/" target="\_\_blank" type="button" class="btn btn-success"><?php echo esc\_html\_e('Purchase','taskbuilder');?></a> |
  | 99 | 99 | </div> |
  | 100 | 100 | <div> |
  | […](/browser/taskbuilder/trunk/includes/admin/addons.php?rev=3174963#L124) | […](/browser/taskbuilder/trunk/includes/admin/addons.php?rev=3210469#L124) |  |
  | 124 | 124 | <div class="pfooter"> |
  | 125 | 125 | <div class="purchase\_addon"> |
  | 126 |  | <a href="https://taskbuilder.net/~~add-ons~~/" target="\_\_blank" type="button" class="btn btn-success"><?php echo esc\_html\_e('Purchase','taskbuilder');?></a> |
  |  | 126 | <a href="https://taskbuilder.net/pricing/" target="\_\_blank" type="button" class="btn btn-success"><?php echo esc\_html\_e('Purchase','taskbuilder');?></a> |
  | 127 | 127 | </div> |
  | 128 | 128 | <div> |
  | […](/browser/taskbuilder/trunk/includes/admin/addons.php?rev=3174963#L151) | […](/browser/taskbuilder/trunk/includes/admin/addons.php?rev=3210469#L151) |  |
  | 151 | 151 | <div class="pfooter"> |
  | 152 | 152 | <div class="purchase\_addon"> |
  | 153 |  | <a href="https://taskbuilder.net/~~add-ons~~/" target="\_\_blank" type="button" class="btn btn-success"><?php echo esc\_html\_e('Purchase','taskbuilder');?></a> |
  |  | 153 | <a href="https://taskbuilder.net/pricing/" target="\_\_blank" type="button" class="btn btn-success"><?php echo esc\_html\_e('Purchase','taskbuilder');?></a> |
  | 154 | 154 | </div> |
  | 155 | 155 | <div> |
  | […](/browser/taskbuilder/trunk/includes/admin/addons.php?rev=3174963#L178) | […](/browser/taskbuilder/trunk/includes/admin/addons.php?rev=3210469#L178) |  |
  | 178 | 178 | <div class="pfooter"> |
  | 179 | 179 | <div class="purchase\_addon"> |
  | 180 |  | <a href="https://taskbuilder.net/~~add-ons~~/" target="\_\_blank" type="button" class="btn btn-success"><?php echo esc\_html\_e('Purchase','taskbuilder');?></a> |
  |  | 180 | <a href="https://taskbuilder.net/pricing/" target="\_\_blank" type="button" class="btn btn-success"><?php echo esc\_html\_e('Purchase','taskbuilder');?></a> |
  | 181 | 181 | </div> |
  | 182 | 182 | <div> |
  | […](/browser/taskbuilder/trunk/includes/admin/addons.php?rev=3174963#L205) | […](/browser/taskbuilder/trunk/includes/admin/addons.php?rev=3210469#L205) |  |
  | 205 | 205 | <div class="pfooter"> |
  | 206 | 206 | <div class="purchase\_addon"> |
  | 207 |  | <a href="https://taskbuilder.net/~~add-ons~~/" target="\_\_blank" type="button" class="btn btn-success"><?php echo esc\_html\_e('Purchase','taskbuilder');?></a> |
  |  | 207 | <a href="https://taskbuilder.net/pricing/" target="\_\_blank" type="button" class="btn btn-success"><?php echo esc\_html\_e('Purchase','taskbuilder');?></a> |
  | 208 | 208 | </div> |
  | 209 | 209 | <div> |
  | […](/browser/taskbuilder/trunk/includes/admin/addons.php?rev=3174963#L232) | […](/browser/taskbuilder/trunk/includes/admin/addons.php?rev=3210469#L232) |  |
  | 232 | 232 | <div class="pfooter"> |
  | 233 | 233 | <div class="purchase\_addon"> |
  | 234 |  | <a href="https://taskbuilder.net/~~add-ons~~/" target="\_\_blank" type="button" class="btn btn-success"><?php echo esc\_html\_e('Purchase','taskbuilder');?></a> |
  |  | 234 | <a href="https://taskbuilder.net/pricing/" target="\_\_blank" type="button" class="btn btn-success"><?php echo esc\_html\_e('Purchase','taskbuilder');?></a> |
  | 235 | 235 | </div> |
  | 236 | 236 | <div> |
  | 237 | 237 | <a href="https://taskbuilder.net/woocommerce/" target="\_\_blank" type="button" class="btn btn-success"><?php echo esc\_html\_e('View Details','taskbuilder');?></a> |
  |  | 238 | </div> |
  |  | 239 | </div> |
  |  | 240 | </div> |
  |  | 241 | </div> |
  |  | 242 | <div class="col-md-3 col-sm-6 col-xs-12 pricing-widget"> |
  |  | 243 | <div class="row"> |
  |  | 244 | <div class="pheader"> |
  |  | 245 | <h3 class="title"><img src="<?php echo esc\_url( WPPM\_PLUGIN\_URL . 'asset/images/due\_date\_reminder\_icon.svg'); ?>"> <?php echo esc\_html\_e('Due Date Reminder','taskbuilder');?></h3> |
  |  | 246 | <h4 class="subtitle">$29.99</h4> |
  |  | 247 | <div style="text-align:center"> |
  |  | 248 | <small class="payment\_freq"><?php echo esc\_html\_e('Per year','taskbuilder');?></small> |
  |  | 249 | <small class="payment\_freq"><?php echo esc\_html\_e('(Add-ons subject to yearly license for support and updates.)','taskbuilder');?></small> |
  |  | 250 | </div> |
  |  | 251 | </div> |
  |  | 252 | <div class="pbody"> |
  |  | 253 | <div class="addon-container"> |
  |  | 254 | <i class="fas fa-arrow-right"></i> |
  |  | 255 | <div class="addon-details"> |
  |  | 256 | <?php echo esc\_html\_e('Due date reminder are super helpful for keeping your team on track to hit deadlines. Email notification will send to customer before due date of task.','taskbuilder');?></div> |
  |  | 257 | </div> |
  |  | 258 | </div> |
  |  | 259 | <div class="pfooter"> |
  |  | 260 | <div class="purchase\_addon"> |
  |  | 261 | <a href="https://taskbuilder.net/pricing/" target="\_\_blank" type="button" class="btn btn-success"><?php echo esc\_html\_e('Purchase','taskbuilder');?></a> |
  |  | 262 | </div> |
  |  | 263 | <div> |
  |  | 264 | <a href="https://taskbuilder.net/due-date-reminder/" target="\_\_blank" type="button" class="btn btn-success"><?php echo esc\_html\_e('View Details','taskbuilder');?></a> |
  | 238 | 265 | </div> |
  | 239 | 266 | </div> |
* ## [taskbuilder/trunk/includes/admin/attachment/wppm\_download\_attachment.php](/changeset/3210469/taskbuilder/trunk/includes/admin/attachment/wppm_download_attachment.php "Show the changeset 3210469 restricted to taskbuilder/trunk/includes/admin/attachment/wppm_download_attachment.php")

  | [r2692017](/browser/taskbuilder/trunk/includes/admin/attachment/wppm_download_attachment.php?rev=2692017#L5 "Show revision 2692017 of this file in browser") | [r3210469](/browser/taskbuilder/trunk/includes/admin/attachment/wppm_download_attachment.php?rev=3210469#L5 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 5 | 5 | global $wpdb; |
  | 6 | 6 | $upload\_dir   = wp\_upload\_dir(); |
  | 7 |  | $attach\_id = ~~intval(sanitize\_text\_field($attach\_id~~)); |
  |  | 7 | $attach\_id = esc\_sql(intval(sanitize\_text\_field($attach\_id))); |
  | 8 | 8 | $attachment=$wpdb->get\_row("select \* from {$wpdb->prefix}wppm\_attachments where id='".$attach\_id."'"); |
  | 9 | 9 | $date\_created = $attachment->date\_created; |
* ## [taskbuilder/trunk/includes/admin/email\_notifications/wppm\_en\_change\_project\_status.php](/changeset/3210469/taskbuilder/trunk/includes/admin/email_notifications/wppm_en_change_project_status.php "Show the changeset 3210469 restricted to taskbuilder/trunk/includes/admin/email_notifications/wppm_en_change_project_status.php")

  | [r3174963](/browser/taskbuilder/trunk/includes/admin/email_notifications/wppm_en_change_project_status.php?rev=3174963#L10 "Show revision 3174963 of this file in browser") | [r3210469](/browser/taskbuilder/trunk/includes/admin/email_notifications/wppm_en_change_project_status.php?rev=3210469#L10 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 10 | 10 | $wppm\_default\_email\_notification\_to\_current\_user = get\_option('wppm\_default\_email\_notification\_to\_current\_user'); |
  | 11 | 11 | $project\_id = intval(sanitize\_text\_field($project\_id)); |
  |  | 12 | $project\_id = esc\_sql($project\_id); |
  | 12 | 13 | $project\_data = $wppmfunction->get\_project($project\_id); |
  | 13 | 14 | $proj\_users = $project\_data['users']; |
  | […](/browser/taskbuilder/trunk/includes/admin/email_notifications/wppm_en_change_project_status.php?rev=3174963#L30) | […](/browser/taskbuilder/trunk/includes/admin/email_notifications/wppm_en_change_project_status.php?rev=3210469#L31) |  |
  | 30 | 31 | foreach($proj\_users as $user){ |
  | 31 | 32 | if(!empty($user)){ |
  | 32 |  | $project\_user\_data = $wpdb->get\_row("SELECT \* FROM {$wpdb->prefix}wppm\_project\_users WHERE proj\_id = $project\_id AND user\_id = $user"); |
  |  | 33 | $user = esc\_sql($user); |
  |  | 34 | $project\_user\_data = $wpdb->get\_row("SELECT \* FROM {$wpdb->prefix}wppm\_project\_users WHERE proj\_id = '$project\_id' AND user\_id = '$user'"); |
  | 33 | 35 | $userdata = get\_userdata($user); |
  | 34 | 36 | if((!empty($project\_user\_data)) && $project\_user\_data->role\_id == 1){ |
  | […](/browser/taskbuilder/trunk/includes/admin/email_notifications/wppm_en_change_project_status.php?rev=3174963#L41) | […](/browser/taskbuilder/trunk/includes/admin/email_notifications/wppm_en_change_project_status.php?rev=3210469#L43) |  |
  | 41 | 43 | foreach($proj\_users as $user){ |
  | 42 | 44 | if(!empty($user)){ |
  | 43 |  | $project\_user\_data = $wpdb->get\_row("SELECT \* FROM {$wpdb->prefix}wppm\_project\_users WHERE proj\_id = $project\_id AND user\_id = $user"); |
  |  | 45 | $user = esc\_sql($user); |
  |  | 46 | $project\_user\_data = $wpdb->get\_row("SELECT \* FROM {$wpdb->prefix}wppm\_project\_users WHERE proj\_id = '$project\_id' AND user\_id = '$user'"); |
  | 44 | 47 | $userdata = get\_userdata($user); |
  | 45 | 48 | if((!empty($project\_user\_data)) && $project\_user\_data->role\_id == 2){ |
* ## [taskbuilder/trunk/includes/admin/email\_notifications/wppm\_en\_project\_created.php](/changeset/3210469/taskbuilder/trunk/includes/admin/email_notifications/wppm_en_project_created.php "Show the changeset 3210469 restricted to taskbuilder/trunk/includes/admin/email_notifications/wppm_en_project_created.php")

  | [r3174963](/browser/taskbuilder/trunk/includes/admin/email_notifications/wppm_en_project_created.php?rev=3174963#L9 "Show revision 3174963 of this file in browser") | [r3210469](/browser/taskbuilder/trunk/includes/admin/email_notifications/wppm_en_project_created.php?rev=3210469#L9 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 9 | 9 | $ignore\_emails = get\_option('wppm\_en\_ignore\_emails'); |
  | 10 | 10 | $project\_id = intval(sanitize\_text\_field(($project\_id))); |
  |  | 11 | $project\_id = esc\_sql($project\_id); |
  | 11 | 12 | $project\_data = $wppmfunction->get\_project($project\_id); |
  | 12 | 13 | $proj\_users = $project\_data['users']; |
  | […](/browser/taskbuilder/trunk/includes/admin/email_notifications/wppm_en_project_created.php?rev=3174963#L29) | […](/browser/taskbuilder/trunk/includes/admin/email_notifications/wppm_en_project_created.php?rev=3210469#L30) |  |
  | 29 | 30 | foreach($proj\_users as $user){ |
  | 30 | 31 | if(!empty($user)){ |
  | 31 |  | $project\_user\_data = $wpdb->get\_row("SELECT \* FROM {$wpdb->prefix}wppm\_project\_users WHERE proj\_id = $project\_id AND user\_id = $user"); |
  |  | 32 | $user = esc\_sql($user); |
  |  | 33 | $project\_user\_data = $wpdb->get\_row("SELECT \* FROM {$wpdb->prefix}wppm\_project\_users WHERE proj\_id = '$project\_id' AND user\_id = '$user'"); |
  | 32 | 34 | $userdata = get\_userdata($user); |
  | 33 | 35 | if((!empty($project\_user\_data)) && $project\_user\_data->role\_id == 1){ |
  | […](/browser/taskbuilder/trunk/includes/admin/email_notifications/wppm_en_project_created.php?rev=3174963#L40) | […](/browser/taskbuilder/trunk/includes/admin/email_notifications/wppm_en_project_created.php?rev=3210469#L42) |  |
  | 40 | 42 | foreach($proj\_users as $user){ |
  | 41 | 43 | if(!empty($user)){ |
  | 42 |  | $project\_user\_data = $wpdb->get\_row("SELECT \* FROM {$wpdb->prefix}wppm\_project\_users WHERE proj\_id = $project\_id AND user\_id = $user"); |
  |  | 44 | $user = esc\_sql($user); |
  |  | 45 | $project\_user\_data = $wpdb->get\_row("SELECT \* FROM {$wpdb->prefix}wppm\_project\_users WHERE proj\_id = '$project\_id' AND user\_id = '$user'"); |
  | 43 | 46 | $userdata = get\_userdata($user); |
  | 44 | 47 | if((!empty($project\_user\_data)) && $project\_user\_data->role\_id == 2){ |
* ## [taskbuilder/trunk/includes/admin/email\_notifications/wppm\_en\_set\_change\_task\_status.php](/changeset/3210469/taskbuilder/trunk/includes/admin/email_notifications/wppm_en_set_change_task_status.php "Show the changeset 3210469 restricted to taskbuilder/trunk/includes/admin/email_notifications/wppm_en_set_change_task_status.php")

  | [r3174963](/browser/taskbuilder/trunk/includes/admin/email_notifications/wppm_en_set_change_task_status.php?rev=3174963#L10 "Show revision 3174963 of this file in browser") | [r3210469](/browser/taskbuilder/trunk/includes/admin/email_notifications/wppm_en_set_change_task_status.php?rev=3210469#L10 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 10 | 10 | $task\_id = sanitize\_text\_field($task\_id); |
  | 11 | 11 | $task\_data = $wppmfunction->get\_task($task\_id); |
  | 12 |  | $project\_id = $task\_data['project']; |
  | 13 |  | $project\_users = $wpdb->get\_results("SELECT user\_id FROM {$wpdb->prefix}wppm\_project\_users WHERE proj\_id = $project\_id AND role\_id = 1"); |
  | 14 |  | $p\_users = $wpdb->get\_var("SELECT users FROM {$wpdb->prefix}wppm\_project WHERE id = $project\_id"); |
  | 15 |  | $p\_users\_array = explode(',',$p\_users ); |
  |  | 12 | $project\_id = esc\_sql($task\_data['project']); |
  |  | 13 | $project\_users = $wpdb->get\_results("SELECT user\_id FROM {$wpdb->prefix}wppm\_project\_users WHERE proj\_id = '$project\_id' AND role\_id = 1"); |
  |  | 14 | $p\_users = $wpdb->get\_var("SELECT users FROM {$wpdb->prefix}wppm\_project WHERE id = '$project\_id'"); |
  |  | 15 | $p\_users\_array = array(); |
  |  | 16 | if(!empty($p\_users)){ |
  |  | 17 | $p\_users\_array = explode(',',$p\_users ); |
  |  | 18 | } |
  | 16 | 19 | $task\_users = $task\_data['users']; |
  | 17 | 20 | $task\_users = explode(',',$task\_users); |
  | […](/browser/taskbuilder/trunk/includes/admin/email_notifications/wppm_en_set_change_task_status.php?rev=3174963#L43) | […](/browser/taskbuilder/trunk/includes/admin/email_notifications/wppm_en_set_change_task_status.php?rev=3210469#L46) |  |
  | 43 | 46 | if(!empty($user)){ |
  | 44 | 47 | $userdata = get\_userdata($user); |
  | 45 |  | $project\_user\_data = $wpdb->get\_row("SELECT \* FROM {$wpdb->prefix}wppm\_project\_users WHERE proj\_id = $project\_id  AND user\_id = $user"); |
  |  | 48 | $user = esc\_sql($user); |
  |  | 49 | $project\_user\_data = $wpdb->get\_row("SELECT \* FROM {$wpdb->prefix}wppm\_project\_users WHERE proj\_id = '$project\_id'  AND user\_id = '$user'"); |
  | 46 | 50 | if((!empty($project\_user\_data)) && $project\_user\_data->role\_id == 1){ |
  | 47 | 51 | $email\_addresses[] = $userdata->user\_email; |
  | […](/browser/taskbuilder/trunk/includes/admin/email_notifications/wppm_en_set_change_task_status.php?rev=3174963#L54) | […](/browser/taskbuilder/trunk/includes/admin/email_notifications/wppm_en_set_change_task_status.php?rev=3210469#L58) |  |
  | 54 | 58 | if(!empty($user)){ |
  | 55 | 59 | $userdata = get\_userdata($user); |
  | 56 |  | $project\_user\_data = $wpdb->get\_row("SELECT \* FROM {$wpdb->prefix}wppm\_project\_users WHERE proj\_id = $project\_id  AND user\_id = $user"); |
  |  | 60 | $user = esc\_sql($user); |
  |  | 61 | $project\_user\_data = $wpdb->get\_row("SELECT \* FROM {$wpdb->prefix}wppm\_project\_users WHERE proj\_id = '$project\_id'  AND user\_id = '$user'"); |
  | 57 | 62 | if((!empty($project\_user\_data)) && $project\_user\_data->role\_id == 2){ |
  | 58 | 63 | $email\_addresses[] = $userdata->user\_email; |
* ## [taskbuilder/trunk/includes/admin/email\_notifications/wppm\_en\_set\_project\_users.php](/changeset/3210469/taskbuilder/trunk/includes/admin/email_notifications/wppm_en_set_project_users.php "Show the changeset 3210469 restricted to taskbuilder/trunk/includes/admin/email_notifications/wppm_en_set_project_users.php")

  | [r3174963](/browser/taskbuilder/trunk/includes/admin/email_notifications/wppm_en_set_project_users.php?rev=3174963#L7 "Show revision 3174963 of this file in browser") | [r3210469](/browser/taskbuilder/trunk/includes/admin/email_notifications/wppm_en_set_project_users.php?rev=3210469#L7 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 7 | 7 | $from\_email    = get\_option('wppm\_en\_from\_email'); |
  | 8 | 8 | $ignore\_emails = get\_option('wppm\_en\_ignore\_emails'); |
  | 9 |  | $project\_id = ~~intval(sanitize\_text\_field($project\_id~~)); |
  |  | 9 | $project\_id = esc\_sql(intval(sanitize\_text\_field($project\_id))); |
  | 10 | 10 | $project\_data = $wppmfunction->get\_project($project\_id); |
  | 11 | 11 | $proj\_users = $project\_data['users']; |
  | […](/browser/taskbuilder/trunk/includes/admin/email_notifications/wppm_en_set_project_users.php?rev=3174963#L30) | […](/browser/taskbuilder/trunk/includes/admin/email_notifications/wppm_en_set_project_users.php?rev=3210469#L30) |  |
  | 30 | 30 | foreach($proj\_users as $user){ |
  | 31 | 31 | if(!empty($user)){ |
  | 32 |  | $project\_user\_data = $wpdb->get\_row("SELECT \* FROM {$wpdb->prefix}wppm\_project\_users WHERE proj\_id = $project\_id  AND user\_id = $user"); |
  |  | 32 | $user = esc\_sql($user); |
  |  | 33 | $project\_user\_data = $wpdb->get\_row("SELECT \* FROM {$wpdb->prefix}wppm\_project\_users WHERE proj\_id = '$project\_id'  AND user\_id = '$user'"); |
  | 33 | 34 | $userdata = get\_userdata($user); |
  | 34 | 35 | if((!empty($project\_user\_data)) && $project\_user\_data->role\_id == 1){ |
  | […](/browser/taskbuilder/trunk/includes/admin/email_notifications/wppm_en_set_project_users.php?rev=3174963#L41) | […](/browser/taskbuilder/trunk/includes/admin/email_notifications/wppm_en_set_project_users.php?rev=3210469#L42) |  |
  | 41 | 42 | foreach($proj\_users as $user){ |
  | 42 | 43 | if(!empty($user)){ |
  | 43 |  | $project\_user\_data = $wpdb->get\_row("SELECT \* FROM {$wpdb->prefix}wppm\_project\_users WHERE proj\_id = $project\_id  AND user\_id = $user"); |
  |  | 44 | $user = esc\_sql($user); |
  |  | 45 | $project\_user\_data = $wpdb->get\_row("SELECT \* FROM {$wpdb->prefix}wppm\_project\_users WHERE proj\_id = '$project\_id'  AND user\_id = '$user'"); |
  | 44 | 46 | $userdata = get\_userdata($user); |
  | 45 | 47 | if((!empty($project\_user\_data)) && $project\_user\_data->role\_id == 2){ |
* ## [taskbuilder/trunk/includes/admin/email\_notifications/wppm\_en\_submit\_proj\_comment.php](/changeset/3210469/taskbuilder/trunk/includes/admin/email_notifications/wppm_en_submit_proj_comment.php "Show the changeset 3210469 restricted to taskbuilder/trunk/includes/admin/email_notifications/wppm_en_submit_proj_comment.php")

  | [r3174963](/browser/taskbuilder/trunk/includes/admin/email_notifications/wppm_en_submit_proj_comment.php?rev=3174963#L8 "Show revision 3174963 of this file in browser") | [r3210469](/browser/taskbuilder/trunk/includes/admin/email_notifications/wppm_en_submit_proj_comment.php?rev=3210469#L8 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 8 | 8 | $from\_email    = get\_option('wppm\_en\_from\_email'); |
  | 9 | 9 | $ignore\_emails = get\_option('wppm\_en\_ignore\_emails'); |
  | 10 |  | $proj\_id = ~~intval(sanitize\_text\_field($proj\_id~~)); |
  |  | 10 | $proj\_id = esc\_sql(intval(sanitize\_text\_field($proj\_id))); |
  | 11 | 11 | $proj\_data = $wppmfunction->get\_project($proj\_id); |
  | 12 | 12 | $proj\_users = $proj\_data['users']; |
* ## [taskbuilder/trunk/includes/admin/email\_notifications/wppm\_get\_templates.php](/changeset/3210469/taskbuilder/trunk/includes/admin/email_notifications/wppm_get_templates.php "Show the changeset 3210469 restricted to taskbuilder/trunk/includes/admin/email_notifications/wppm_get_templates.php")

  | [r3142140](/browser/taskbuilder/trunk/includes/admin/email_notifications/wppm_get_templates.php?rev=3142140#L60 "Show revision 3142140 of this file in browser") | [r3210469](/browser/taskbuilder/trunk/includes/admin/email_notifications/wppm_get_templates.php?rev=3210469#L60 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 60 | 60 | </tr> |
  | 61 | 61 | <tr> |
  |  | 62 | <td id="wppm\_tag\_task\_creator\_name" class="wppm\_tag\_task\_creator\_name" onclick="wppm\_insert\_editor\_text('{task\_creator\_name}')">{<?php echo esc\_attr('task\_creator\_name') ?>}</td> |
  |  | 63 | <td><?php echo esc\_html\_e('Task Creator Name','taskbuilder'); ?></td> |
  |  | 64 | </tr> |
  |  | 65 | <tr> |
  | 62 | 66 | <td id="wppm\_tag\_task\_description" class="wppm\_tag\_task\_description" onclick="wppm\_insert\_editor\_text('{task\_description}')">{<?php echo esc\_attr('task\_description') ?>}</td> |
  | 63 | 67 | <td><?php echo esc\_html\_e('Task Description','taskbuilder'); ?></td> |
* ## [taskbuilder/trunk/includes/admin/projects/filters/wppm\_project\_search\_filter.php](/changeset/3210469/taskbuilder/trunk/includes/admin/projects/filters/wppm_project_search_filter.php "Show the changeset 3210469 restricted to taskbuilder/trunk/includes/admin/projects/filters/wppm_project_search_filter.php")

  | [r3174963](/browser/taskbuilder/trunk/includes/admin/projects/filters/wppm_project_search_filter.php?rev=3174963#L14 "Show revision 3174963 of this file in browser") | [r3210469](/browser/taskbuilder/trunk/includes/admin/projects/filters/wppm_project_search_filter.php?rev=3210469#L14 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 14 | 14 | foreach( $search\_tag as $key=>$val){ |
  | 15 | 15 | if($key == 'search\_tag'){ |
  |  | 16 | $val = esc\_sql($val); |
  | 16 | 17 | $query = "SELECT \* FROM {$wpdb->prefix}wppm\_project where project\_name LIKE $wpdb->esc\_like( '$val' )"; |
  | 17 | 18 | } |
* ## [taskbuilder/trunk/includes/admin/projects/get\_users.php](/changeset/3210469/taskbuilder/trunk/includes/admin/projects/get_users.php "Show the changeset 3210469 restricted to taskbuilder/trunk/includes/admin/projects/get_users.php")

  | [r3142140](/browser/taskbuilder/trunk/includes/admin/projects/get_users.php?rev=3142140#L6 "Show revision 3142140 of this file in browser") | [r3210469](/browser/taskbuilder/trunk/includes/admin/projects/get_users.php?rev=3210469#L6 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 6 | 6 | $wppm\_users\_role = get\_option('wppm\_user\_role'); |
  | 7 | 7 | $proj\_id  = isset($\_POST['proj\_id']) ? sanitize\_text\_field($\_POST['proj\_id']) : '' ; |
  |  | 8 | $proj\_id = esc\_sql($proj\_id); |
  | 8 | 9 | $wppm\_current\_user\_capability = get\_user\_meta( $current\_user->ID, 'wppm\_capability', true ); |
  | 9 | 10 | $project = $wpdb->get\_row( "SELECT \* FROM {$wpdb->prefix}wppm\_project where id = $proj\_id" ); |
  | […](/browser/taskbuilder/trunk/includes/admin/projects/get_users.php?rev=3142140#L24) | […](/browser/taskbuilder/trunk/includes/admin/projects/get_users.php?rev=3210469#L25) |  |
  | 24 | 25 | <?php |
  | 25 | 26 | $userdata = get\_userdata( $user ); |
  |  | 27 | $user = esc\_sql($user); |
  | 26 | 28 | $project\_user = $wpdb->get\_row("SELECT \* FROM {$wpdb->prefix}wppm\_project\_users WHERE proj\_id = '$proj\_id' AND user\_id = '$user'"); |
  | 27 | 29 | ?> |
* ## [taskbuilder/trunk/includes/admin/projects/open\_project/wppm\_change\_project\_visibility.php](/changeset/3210469/taskbuilder/trunk/includes/admin/projects/open_project/wppm_change_project_visibility.php "Show the changeset 3210469 restricted to taskbuilder/trunk/includes/admin/projects/open_project/wppm_change_project_visibility.php")

  | [r3174963](/browser/taskbuilder/trunk/includes/admin/projects/open_project/wppm_change_project_visibility.php?rev=3174963#L13 "Show revision 3174963 of this file in browser") | [r3210469](/browser/taskbuilder/trunk/includes/admin/projects/open_project/wppm_change_project_visibility.php?rev=3210469#L13 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 13 | 13 | if (!(($current\_user->ID && $current\_user->has\_cap('manage\_options')) || ($current\_user->ID && $current\_user->has\_cap('wppm\_admin')) || ($project['created\_by']==$current\_user->ID && $wppm\_current\_user\_capability == 'wppm\_manager'))) {exit;} |
  | 14 | 14 | $wppm\_project\_visibility = isset($\_POST['project\_visibility']) ? sanitize\_text\_field($\_POST['project\_visibility']):"0"; |
  |  | 15 | $wppm\_project\_visibility  = esc\_sql($wppm\_project\_visibility ); |
  | 15 | 16 | $id = $wpdb->get\_var("SELECT id FROM {$wpdb->prefix}wppm\_project\_meta WHERE project\_id = '$project\_id' AND meta\_key ='public\_project'"); |
  |  | 17 | $id = esc\_sql($id); |
  | 16 | 18 | if(empty($id )){ |
  | 17 | 19 | $wppmfunction->add\_project\_meta($project\_id,'public\_project',$wppm\_project\_visibility); |
* ## [taskbuilder/trunk/includes/admin/projects/open\_project/wppm\_edit\_project\_details.php](/changeset/3210469/taskbuilder/trunk/includes/admin/projects/open_project/wppm_edit_project_details.php "Show the changeset 3210469 restricted to taskbuilder/trunk/includes/admin/projects/open_project/wppm_edit_project_details.php")

  | [r3142140](/browser/taskbuilder/trunk/includes/admin/projects/open_project/wppm_edit_project_details.php?rev=3142140#L6 "Show revision 3142140 of this file in browser") | [r3210469](/browser/taskbuilder/trunk/includes/admin/projects/open_project/wppm_edit_project_details.php?rev=3210469#L6 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 6 | 6 | global $wpdb,$wppmfunction,$current\_user; |
  | 7 | 7 | $id  = isset($\_POST['id']) ? sanitize\_text\_field($\_POST['id']) : '' ; |
  | 8 |  | $project = $wpdb->get\_results( "SELECT \* FROM {$wpdb->prefix}wppm\_project where id = $id" ); |
  |  | 8 | $id = esc\_sql($id); |
  |  | 9 | $project = $wpdb->get\_results( "SELECT \* FROM {$wpdb->prefix}wppm\_project where id = '$id'" ); |
  | 9 | 10 | $project\_data = $wppmfunction->get\_project($id); |
  | 10 | 11 | $wppm\_current\_user\_capability = get\_user\_meta( $current\_user->ID, 'wppm\_capability', true ); |
* ## [taskbuilder/trunk/includes/admin/projects/open\_project/wppm\_get\_project\_tasks.php](/changeset/3210469/taskbuilder/trunk/includes/admin/projects/open_project/wppm_get_project_tasks.php "Show the changeset 3210469 restricted to taskbuilder/trunk/includes/admin/projects/open_project/wppm_get_project_tasks.php")

  | [r3174963](/browser/taskbuilder/trunk/includes/admin/projects/open_project/wppm_get_project_tasks.php?rev=3174963#L5 "Show revision 3174963 of this file in browser") | [r3210469](/browser/taskbuilder/trunk/includes/admin/projects/open_project/wppm_get_project_tasks.php?rev=3210469#L5 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 5 | 5 | global $current\_user,$wpdb,$wppmfunction; |
  | 6 | 6 | $project\_id = isset($\_POST['id']) ? intval(sanitize\_text\_field($\_POST['id'])) : 0 ; |
  |  | 7 | $project\_id = esc\_sql($project\_id); |
  |  | 8 | $cu\_id = esc\_sql($current\_user->ID); |
  | 7 | 9 | $appearance\_settings = get\_option("wppm-ap-task-list"); |
  | 8 | 10 | $wppm\_task\_time = get\_option('wppm\_task\_time'); |
  | […](/browser/taskbuilder/trunk/includes/admin/projects/open_project/wppm_get_project_tasks.php?rev=3174963#L16) | […](/browser/taskbuilder/trunk/includes/admin/projects/open_project/wppm_get_project_tasks.php?rev=3210469#L18) |  |
  | 16 | 18 | Left join {$wpdb->prefix}wppm\_project\_users proj\_users ON Task.project = proj\_users.proj\_id |
  | 17 | 19 | Left join {$wpdb->prefix}wppm\_project\_meta proj\_meta ON Task.project = proj\_meta.project\_id |
  | 18 |  | where Task.project = '$project\_id' AND ((FIND\_IN\_SET('$cu~~rrent\_user->ID',Task.users)>0) OR (Task.created\_by= '$current\_user->ID') OR (proj\_users.user\_id = '$current\_user->ID' AND proj\_users.role\_id = 1 AND (FIND\_IN\_SET('$current\_user->ID',proj.users)>0)) OR (Task.project = proj\_meta.project\_id AND proj\_meta.meta\_key='public\_project' AND proj\_meta.meta\_value=1) OR (Task.project = proj.id AND proj.created\_by='$current\_user->ID~~')) Group by Task.id"); |
  |  | 20 | where Task.project = '$project\_id' AND ((FIND\_IN\_SET('$cu\_id',Task.users)>0) OR (Task.created\_by= '$cu\_id') OR (proj\_users.user\_id = '$cu\_id' AND proj\_users.role\_id = 1 AND (FIND\_IN\_SET('$cu\_id',proj.users)>0)) OR (Task.project = proj\_meta.project\_id AND proj\_meta.meta\_key='public\_project' AND proj\_meta.meta\_value=1) OR (Task.project = proj.id AND proj.created\_by='$cu\_id')) Group by Task.id"); |
  | 19 | 21 | } |
  | 20 | 22 | $query = apply\_filters('wppm\_get\_project\_tasks\_query',$query,$project\_id); |
* ## [taskbuilder/trunk/includes/admin/projects/open\_project/wppm\_proj\_thread\_attachment\_remove.php](/changeset/3210469/taskbuilder/trunk/includes/admin/projects/open_project/wppm_proj_thread_attachment_remove.php "Show the changeset 3210469 restricted to taskbuilder/trunk/includes/admin/projects/open_project/wppm_proj_thread_attachment_remove.php")

  | [r3174963](/browser/taskbuilder/trunk/includes/admin/projects/open_project/wppm_proj_thread_attachment_remove.php?rev=3174963#L9 "Show revision 3174963 of this file in browser") | [r3210469](/browser/taskbuilder/trunk/includes/admin/projects/open_project/wppm_proj_thread_attachment_remove.php?rev=3210469#L9 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 9 | 9 | } |
  | 10 | 10 | $attachment     = isset($\_POST['attachment']) ? intval(sanitize\_text\_field($\_POST['attachment'])) : '0' ; |
  |  | 11 | $attachment = esc\_sql($attachment); |
  | 11 | 12 | $comment\_id = isset($\_POST['comment\_id']) ? intval(sanitize\_text\_field($\_POST['comment\_id'])) : '0' ; |
  |  | 13 | $comment\_id  = esc\_sql($comment\_id ); |
  | 12 | 14 | $proj\_id = isset($\_POST['proj\_id']) ? intval(sanitize\_text\_field($\_POST['proj\_id'])) : '0' ; |
  |  | 15 | $proj\_id  = esc\_sql($proj\_id ); |
  | 13 | 16 | $proj\_comment = $wpdb->get\_row( "SELECT \* FROM {$wpdb->prefix}wppm\_project\_comment where id = '$comment\_id' AND proj\_id='$proj\_id'"); |
  | 14 | 17 | if(!(((!empty($proj\_comment)) && ($proj\_comment->created\_by == $current\_user->ID)) || ($current\_user->has\_cap('manage\_options')) || ($wppmfunction->has\_proj\_comment\_permission('edit\_proj\_comment',$proj\_id,$comment\_id)))){ |
* ## [taskbuilder/trunk/includes/admin/projects/open\_project/wppm\_set\_change\_project\_details.php](/changeset/3210469/taskbuilder/trunk/includes/admin/projects/open_project/wppm_set_change_project_details.php "Show the changeset 3210469 restricted to taskbuilder/trunk/includes/admin/projects/open_project/wppm_set_change_project_details.php")

  | [r3174963](/browser/taskbuilder/trunk/includes/admin/projects/open_project/wppm_set_change_project_details.php?rev=3174963#L29 "Show revision 3174963 of this file in browser") | [r3210469](/browser/taskbuilder/trunk/includes/admin/projects/open_project/wppm_set_change_project_details.php?rev=3210469#L29 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 29 | 29 | $wppmfunction->change\_project\_end\_date( $project\_id, $project\_end\_date); |
  | 30 | 30 | } |
  | 31 |  | ~~$pcid = esc\_sql($project\_data['cat\_id']);~~ |
  | 32 |  | ~~$project\_category = esc\_sql($project\_category);~~ |
  | 33 | 31 | if( $project\_category && $project\_category != $project\_data['cat\_id']){ |
  | 34 | 32 | $wppmfunction->change\_category( $project\_id, $project\_category); |
  | 35 |  | $change\_category\_value = array('prev\_cat'=>~~"$pcid",'new\_cat'=>"$project\_category"~~); |
  |  | 33 | $change\_category\_value = array('prev\_cat'=>$project\_data['cat\_id'],'new\_cat'=>$project\_category); |
  | 36 | 34 | $change\_category\_obj = serialize($change\_category\_value); |
  | 37 |  | $log\_values = array('proj\_id'=>$project\_id,'body'=>$change\_category\_obj,'attachment\_ids'=>"",'create\_time'=>date("Y-m-d h:i:sa"),'created\_by'=>$current\_user->ID ); |
  |  | 35 | $project\_id = esc\_sql($project\_id); |
  |  | 36 | $log\_values = array('proj\_id'=>"$project\_id",'body'=>$change\_category\_obj,'attachment\_ids'=>"",'create\_time'=>date("Y-m-d h:i:sa"),'created\_by'=>esc\_sql($current\_user->ID) ); |
  | 38 | 37 | $wpdb->insert($wpdb->prefix . 'wppm\_project\_comment',$log\_values); |
  | 39 | 38 | $log\_id = esc\_sql($wpdb->insert\_id); |
* ## [taskbuilder/trunk/includes/admin/projects/open\_project/wppm\_set\_change\_project\_raised\_by.php](/changeset/3210469/taskbuilder/trunk/includes/admin/projects/open_project/wppm_set_change_project_raised_by.php "Show the changeset 3210469 restricted to taskbuilder/trunk/includes/admin/projects/open_project/wppm_set_change_project_raised_by.php")

  | [r3174963](/browser/taskbuilder/trunk/includes/admin/projects/open_project/wppm_set_change_project_raised_by.php?rev=3174963#L18 "Show revision 3174963 of this file in browser") | [r3210469](/browser/taskbuilder/trunk/includes/admin/projects/open_project/wppm_set_change_project_raised_by.php?rev=3210469#L18 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 18 | 18 | if ( $user\_id != $old\_user\_id ){ |
  | 19 | 19 | $wppmfunction->change\_project\_raised\_by($project\_id, $user\_id); |
  |  | 20 | $user\_id = esc\_sql($user\_id); |
  | 20 | 21 | $change\_creator\_value = array('prev\_user'=>"$old\_user\_id",'new\_user'=>"$user\_id"); |
  | 21 | 22 | $change\_creator\_obj = serialize($change\_creator\_value); |
  | 22 |  | $log\_values = array('proj\_id'=>$project\_id,'body'=>$change\_creator\_obj,'attachment\_ids'=>"",'create\_time'=>date("Y-m-d h:i:sa"),'created\_by'=>$current\_user->ID ); |
  |  | 23 | $project\_id = esc\_sql($project\_id); |
  |  | 24 | $log\_values = array('proj\_id'=>"$project\_id",'body'=>$change\_creator\_obj,'attachment\_ids'=>"",'create\_time'=>date("Y-m-d h:i:sa"),'created\_by'=>esc\_sql($current\_user->ID) ); |
  | 23 | 25 | $wpdb->insert($wpdb->prefix . 'wppm\_project\_comment',$log\_values); |
  | 24 | 26 | $log\_id = esc\_sql($wpdb->insert\_id); |
  | 25 |  | $proj\_log\_values = array('proj\_id'=>~~$project\_id,'comment\_id'=>$log\_id~~,'comment\_type'=>'change\_proj\_creator'); |
  |  | 27 | $proj\_log\_values = array('proj\_id'=>"$project\_id",'comment\_id'=>"$log\_id",'comment\_type'=>'change\_proj\_creator'); |
  | 26 | 28 | $wpdb->insert($wpdb->prefix . 'wppm\_project\_comment\_meta',$proj\_log\_values); |
  | 27 | 29 | } |
* ## [taskbuilder/trunk/includes/admin/projects/open\_project/wppm\_set\_delete\_proj\_thread.php](/changeset/3210469/taskbuilder/trunk/includes/admin/projects/open_project/wppm_set_delete_proj_thread.php "Show the changeset 3210469 restricted to taskbuilder/trunk/includes/admin/projects/open_project/wppm_set_delete_proj_thread.php")

  | [r3174963](/browser/taskbuilder/trunk/includes/admin/projects/open_project/wppm_set_delete_proj_thread.php?rev=3174963#L9 "Show revision 3174963 of this file in browser") | [r3210469](/browser/taskbuilder/trunk/includes/admin/projects/open_project/wppm_set_delete_proj_thread.php?rev=3210469#L9 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 9 | 9 | } |
  | 10 | 10 | $proj\_id  = isset($\_POST['proj\_id']) ? intval(sanitize\_text\_field($\_POST['proj\_id'])) : 0 ; |
  |  | 11 | $proj\_id  = esc\_sql($proj\_id); |
  | 11 | 12 | $thread\_id  = isset($\_POST['comment\_id']) ? intval(sanitize\_text\_field($\_POST['comment\_id'])) : 0 ; |
  | 12 | 13 | $project\_comment = $wppmfunction->get\_proj\_comment($thread\_id); |
  | 13 | 14 | if (!(($current\_user->ID && $current\_user->has\_cap('manage\_options')) || $wppmfunction->has\_proj\_comment\_permission('delete\_proj\_thread',$proj\_id,$thread\_id))) {exit;} |
  | 14 |  | $sql="SELECT attachment\_ids FROM {$wpdb->prefix}wppm\_project\_comment WHERE id = '~~$thread\_id~~'"; |
  |  | 15 | $sql="SELECT attachment\_ids FROM {$wpdb->prefix}wppm\_project\_comment WHERE id = '".esc\_sql($thread\_id)."'"; |
  | 15 | 16 | $thread\_attachment\_ids = $wpdb->get\_results( $sql ); |
  | 16 | 17 | if(!empty($thread\_attachment\_ids) ){ |
  | […](/browser/taskbuilder/trunk/includes/admin/projects/open_project/wppm_set_delete_proj_thread.php?rev=3174963#L23) | […](/browser/taskbuilder/trunk/includes/admin/projects/open_project/wppm_set_delete_proj_thread.php?rev=3210469#L24) |  |
  | 23 | 24 | if(!empty($attachment\_ids\_temp)){ |
  | 24 | 25 | foreach ($attachment\_ids\_temp as $attachment\_id){ |
  | 25 |  | $attachment\_id = esc\_sql($attachment\_id); |
  | 26 |  | $sql="SELECT \* FROM {$wpdb->prefix}wppm\_attachments WHERE id = '$attachment\_id'"; |
  |  | 26 | $sql="SELECT \* FROM {$wpdb->prefix}wppm\_attachments WHERE id = '".esc\_sql($attachment\_id)."'"; |
  | 27 | 27 | $result=$wpdb->get\_row($sql); |
  | 28 | 28 | if(!empty($result)){ |
  | […](/browser/taskbuilder/trunk/includes/admin/projects/open_project/wppm_set_delete_proj_thread.php?rev=3174963#L35) | […](/browser/taskbuilder/trunk/includes/admin/projects/open_project/wppm_set_delete_proj_thread.php?rev=3210469#L35) |  |
  | 35 | 35 | unlink($result->file\_path); |
  | 36 | 36 | } |
  |  | 37 | $attachment\_id = esc\_sql($attachment\_id); |
  | 37 | 38 | $wpdb->delete($wpdb->prefix.'wppm\_attachments', array( 'id' => "$attachment\_id")); |
  | 38 | 39 | } |
  | […](/browser/taskbuilder/trunk/includes/admin/projects/open_project/wppm_set_delete_proj_thread.php?rev=3174963#L43) | […](/browser/taskbuilder/trunk/includes/admin/projects/open_project/wppm_set_delete_proj_thread.php?rev=3210469#L44) |  |
  | 43 | 44 |  |
  | 44 | 45 | $cur\_user = get\_userdata($current\_user->ID); |
  | 45 |  | $log\_values = array('proj\_id'=>$proj\_id,'body'=>'This comment was deleted by '.$cur\_user->display\_name,'attachment\_ids'=>""); |
  | 46 |  | $wpdb->update($wpdb->prefix.'wppm\_project\_comment', $log\_values, array('id'=>$thread\_id)); |
  | 47 |  | $comment\_meta = $wpdb->get\_row("SELECT \* FROM {$wpdb->prefix}wppm\_project\_comment\_meta WHERE comment\_id='$thread\_id' "); |
  | 48 |  | $proj\_log\_values = array('proj\_id'=>$proj\_id,'comment\_id'=>$thread\_id,'comment\_type'=>'delete\_proj\_comment'); |
  |  | 46 | $log\_values = array('proj\_id'=>"$proj\_id",'body'=>'This comment was deleted by '.$cur\_user->display\_name,'attachment\_ids'=>""); |
  |  | 47 | $thread\_id = esc\_sql($thread\_id); |
  |  | 48 | $wpdb->update($wpdb->prefix.'wppm\_project\_comment', $log\_values, array('id'=>"$thread\_id")); |
  |  | 49 | $comment\_meta = $wpdb->get\_row("SELECT \* FROM {$wpdb->prefix}wppm\_project\_comment\_meta WHERE comment\_id='".$thread\_id."' "); |
  |  | 50 | $proj\_log\_values = array('proj\_id'=>"$proj\_id",'comment\_id'=>"$thread\_id",'comment\_type'=>'delete\_proj\_comment'); |
  | 49 | 51 | if(!empty($comment\_meta)){ |
  | 50 |  | $wpdb->update($wpdb->prefix . 'wppm\_project\_comment\_meta',$proj\_log\_values,array('id'=>~~$comment\_meta->id~~)); |
  |  | 52 | $wpdb->update($wpdb->prefix . 'wppm\_project\_comment\_meta',$proj\_log\_values,array('id'=>esc\_sql($comment\_meta->id))); |
  | 51 | 53 | } else{ |
  | 52 | 54 | $wpdb->insert($wpdb->prefix . 'wppm\_project\_comment\_meta',$proj\_log\_values); |
* ## [taskbuilder/trunk/includes/admin/projects/open\_project/wppm\_set\_project\_users.php](/changeset/3210469/taskbuilder/trunk/includes/admin/projects/open_project/wppm_set_project_users.php "Show the changeset 3210469 restricted to taskbuilder/trunk/includes/admin/projects/open_project/wppm_set_project_users.php")

  | [r3174963](/browser/taskbuilder/trunk/includes/admin/projects/open_project/wppm_set_project_users.php?rev=3174963#L9 "Show revision 3174963 of this file in browser") | [r3210469](/browser/taskbuilder/trunk/includes/admin/projects/open_project/wppm_set_project_users.php?rev=3210469#L9 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 9 | 9 | $proj\_id  = isset($\_POST['proj\_id']) ? intval(sanitize\_text\_field($\_POST['proj\_id'])) : '' ; |
  | 10 | 10 | $project\_data = $wppmfunction->get\_project($proj\_id); |
  |  | 11 | $cu\_id =  esc\_sql($current\_user->ID); |
  | 11 | 12 | $wppm\_current\_user\_capability = get\_user\_meta( $current\_user->ID, 'wppm\_capability', true ); |
  | 12 | 13 | if (!(($current\_user->ID && $current\_user->has\_cap('manage\_options')) || $wppmfunction->has\_project\_permission('assign\_project\_users',$proj\_id) || ($project\_data['created\_by']==$current\_user->ID && $wppm\_current\_user\_capability == 'wppm\_manager') || ($current\_user->ID && $current\_user->has\_cap('wppm\_admin')))) {exit;} |
  | […](/browser/taskbuilder/trunk/includes/admin/projects/open_project/wppm_set_project_users.php?rev=3174963#L19) | […](/browser/taskbuilder/trunk/includes/admin/projects/open_project/wppm_set_project_users.php?rev=3210469#L20) |  |
  | 19 | 20 | $prev\_assgn\_user\_meta = $wppmfunction->get\_project\_meta($proj\_id,'prev\_assigned\_users'); |
  | 20 | 21 | $wppmfunction->delete\_project\_meta($proj\_id,'prev\_assigned\_users'); |
  | 21 |  | $task\_users = $wpdb->get\_results("SELECT id,users FROM {$wpdb->prefix}wppm\_task WHERE project = '~~$proj\_id~~'"); |
  |  | 22 | $task\_users = $wpdb->get\_results("SELECT id,users FROM {$wpdb->prefix}wppm\_task WHERE project = '".esc\_sql($proj\_id)."'"); |
  | 22 | 23 | if(!empty($prev\_assign\_users)) { |
  | 23 | 24 | foreach($prev\_assign\_users as $puser){ |
  | […](/browser/taskbuilder/trunk/includes/admin/projects/open_project/wppm_set_project_users.php?rev=3174963#L33) | […](/browser/taskbuilder/trunk/includes/admin/projects/open_project/wppm_set_project_users.php?rev=3210469#L34) |  |
  | 33 | 34 | if(!empty($wppm\_tuser)){ |
  | 34 | 35 | $wppmtuser = implode(',',$wppm\_tuser); |
  | 35 |  | ~~$wppmtuser = esc\_sql($wppmtuser);~~ |
  | 36 | 36 | $value=array( |
  | 37 |  | 'users'=>  ~~$wppmtuser~~ |
  |  | 37 | 'users'=>  esc\_sql($wppmtuser) |
  | 38 | 38 | ); |
  | 39 | 39 | } elseif(empty($wppm\_tuser)){ |
  | […](/browser/taskbuilder/trunk/includes/admin/projects/open_project/wppm_set_project_users.php?rev=3174963#L57) | […](/browser/taskbuilder/trunk/includes/admin/projects/open_project/wppm_set_project_users.php?rev=3210469#L57) |  |
  | 57 | 57 | if(!empty($wppm\_tuser)){ |
  | 58 | 58 | $wppmtuser = implode(',',$wppm\_tuser); |
  | 59 |  | ~~$wppmtuser = esc\_sql($wppmtuser);~~ |
  | 60 | 59 | $value=array( |
  | 61 |  | 'users'=>  ~~$wppmtuser~~ |
  |  | 60 | 'users'=>  esc\_sql($wppmtuser) |
  | 62 | 61 | ); |
  | 63 | 62 | } elseif(empty($wppm\_tuser)){ |
  | […](/browser/taskbuilder/trunk/includes/admin/projects/open_project/wppm_set_project_users.php?rev=3174963#L66) | […](/browser/taskbuilder/trunk/includes/admin/projects/open_project/wppm_set_project_users.php?rev=3210469#L65) |  |
  | 66 | 65 | ); |
  | 67 | 66 | } |
  | 68 |  | $wpdb->update($wpdb->prefix.'wppm\_task', $value, array('id'=>~~$tuser\_id~~)); |
  |  | 67 | $wpdb->update($wpdb->prefix.'wppm\_task', $value, array('id'=>"$tuser\_id")); |
  | 69 | 68 | } |
  | 70 | 69 | } |
  | […](/browser/taskbuilder/trunk/includes/admin/projects/open_project/wppm_set_project_users.php?rev=3174963#L77) | […](/browser/taskbuilder/trunk/includes/admin/projects/open_project/wppm_set_project_users.php?rev=3210469#L76) |  |
  | 77 | 76 | foreach($users as $user){ |
  | 78 | 77 | $user\_role = sanitize\_text\_field($\_POST['wppm\_select\_user\_role\_'.$user]); |
  | 79 |  | $user = esc\_sql($user); |
  | 80 |  | $project\_user = $wpdb->get\_row("SELECT \* FROM {$wpdb->prefix}wppm\_project\_users WHERE proj\_id = '$proj\_id' AND user\_id = '$user'"); |
  |  | 78 | $project\_user = $wpdb->get\_row("SELECT \* FROM {$wpdb->prefix}wppm\_project\_users WHERE proj\_id = '".esc\_sql($proj\_id)."' AND user\_id = '".esc\_sql($user)."'"); |
  | 81 | 79 | if(!empty($project\_user)){ |
  | 82 | 80 | $values=array( |
  | 83 |  | 'role\_id'=> ~~$user\_role~~, |
  | 84 |  | 'assigned\_by'=> $cu~~rrent\_user->ID~~ |
  |  | 81 | 'role\_id'=> esc\_sql($user\_role), |
  |  | 82 | 'assigned\_by'=> $cu\_id |
  | 85 | 83 | ); |
  | 86 | 84 | $proj\_user\_id = esc\_sql($project\_user->id); |
  | […](/browser/taskbuilder/trunk/includes/admin/projects/open_project/wppm_set_project_users.php?rev=3174963#L90) | […](/browser/taskbuilder/trunk/includes/admin/projects/open_project/wppm_set_project_users.php?rev=3210469#L88) |  |
  | 90 | 88 | $wpdb->prefix . 'wppm\_project\_users', |
  | 91 | 89 | array( |
  | 92 |  | 'proj\_id' => ~~$proj\_id~~, |
  | 93 |  | 'user\_id' => ~~$user~~, |
  | 94 |  | 'role\_id' =>~~$user\_role~~, |
  | 95 |  | 'assigned\_by' => $cu~~rrent\_user->ID~~ |
  |  | 90 | 'proj\_id' => esc\_sql($proj\_id), |
  |  | 91 | 'user\_id' => esc\_sql($user), |
  |  | 92 | 'role\_id' =>esc\_sql($user\_role), |
  |  | 93 | 'assigned\_by' => $cu\_id |
  | 96 | 94 | ) ); |
  | 97 | 95 | } |
  | […](/browser/taskbuilder/trunk/includes/admin/projects/open_project/wppm_set_project_users.php?rev=3174963#L112) | […](/browser/taskbuilder/trunk/includes/admin/projects/open_project/wppm_set_project_users.php?rev=3210469#L110) |  |
  | 112 | 110 | $change\_assign\_user\_value = array('prev\_assign\_user'=>"$project\_data[users]",'new\_assign\_user'=>"$pusers"); |
  | 113 | 111 | $change\_assign\_user\_obj = serialize($change\_assign\_user\_value); |
  | 114 |  | $log\_values = array('proj\_id'=>~~$proj\_id,'body'=>$change\_assign\_user\_obj,'attachment\_ids'=>"",'create\_time'=>date("Y-m-d h:i:sa"),'created\_by'=>$current\_user->ID~~ ); |
  |  | 112 | $log\_values = array('proj\_id'=>esc\_sql($proj\_id),'body'=>$change\_assign\_user\_obj,'attachment\_ids'=>"",'create\_time'=>date("Y-m-d h:i:sa"),'created\_by'=>"$cu\_id" ); |
  | 115 | 113 | $wpdb->insert($wpdb->prefix . 'wppm\_project\_comment',$log\_values); |
  | 116 | 114 | $log\_id = $wpdb->insert\_id; |
  | 117 |  | $proj\_log\_values = array('proj\_id'=>~~$proj\_id,'comment\_id'=>$log\_id~~,'comment\_type'=>'change\_assign\_user'); |
  |  | 115 | $proj\_log\_values = array('proj\_id'=>esc\_sql($proj\_id),'comment\_id'=>esc\_sql($log\_id),'comment\_type'=>'change\_assign\_user'); |
  | 118 | 116 | $wpdb->insert($wpdb->prefix . 'wppm\_project\_comment\_meta',$proj\_log\_values); |
  | 119 | 117 | do\_action('wppm\_set\_project\_users', $proj\_id); |
* ## [taskbuilder/trunk/includes/admin/projects/open\_project/wppm\_submit\_project\_comment.php](/changeset/3210469/taskbuilder/trunk/includes/admin/projects/open_project/wppm_submit_project_comment.php "Show the changeset 3210469 restricted to taskbuilder/trunk/includes/admin/projects/open_project/wppm_submit_project_comment.php")

  | [r3174963](/browser/taskbuilder/trunk/includes/admin/projects/open_project/wppm_submit_project_comment.php?rev=3174963#L8 "Show revision 3174963 of this file in browser") | [r3210469](/browser/taskbuilder/trunk/includes/admin/projects/open_project/wppm_submit_project_comment.php?rev=3210469#L8 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 8 | 8 | } |
  | 9 | 9 | $proj\_id  = isset($\_POST['proj\_id']) ? intval(sanitize\_text\_field($\_POST['proj\_id'])) : '' ; |
  |  | 10 | $cu\_id = $current\_user->ID; |
  | 10 | 11 | $comment  = isset($\_POST['comment\_body']) ? ($\_POST['comment\_body']) : '' ; |
  | 11 | 12 | $allowed\_tags = array( 'br' => array(), 'abbr' => array('title' => array(),), 'p' => array(), 'strong' => array(), 'a' => array('href' => array(), 'title' => array(), 'rel'=> array(), 'target'=> array()),'em' =>array(),'span' =>array(), 'blockquote'=>array('cite'  => array(),),'div' => array('class' => array(),'title' => array(),'style' => array(),),'ul'=>array(),'li'=>array(),'ol'=>array(),'img' => array( 'alt'=> array(),'class' => array(),'height' => array(),'src'=> array(),'width'=> array(),)); |
  | […](/browser/taskbuilder/trunk/includes/admin/projects/open_project/wppm_submit_project_comment.php?rev=3174963#L31) | […](/browser/taskbuilder/trunk/includes/admin/projects/open_project/wppm_submit_project_comment.php?rev=3210469#L32) |  |
  | 31 | 32 | 'attachment\_ids'=>$attachment\_ids, |
  | 32 | 33 | 'create\_time'=>current\_time('mysql', 1), |
  | 33 |  | 'created\_by'=>$cu~~rrent\_user->ID~~ |
  |  | 34 | 'created\_by'=>$cu\_id |
  | 34 | 35 | ); |
  | 35 | 36 | $args = apply\_filters( 'wppm\_submit\_proj\_comment\_args', $args ); |
  | 36 | 37 | $comment\_id = $wppmfunction->wppm\_submit\_proj\_comment($args); |
  | 37 |  | $proj\_log\_values = array('proj\_id'=>~~$proj\_id,'comment\_id'=>$comment\_id~~,'comment\_type'=>'comment'); |
  |  | 38 | $proj\_log\_values = array('proj\_id'=>esc\_sql($proj\_id),'comment\_id'=>esc\_sql($comment\_id),'comment\_type'=>'comment'); |
  | 38 | 39 | $wpdb->insert($wpdb->prefix . 'wppm\_project\_comment\_meta',$proj\_log\_values); |
  | 39 | 40 |  |
* ## [taskbuilder/trunk/includes/admin/projects/open\_project/wppm\_view\_project\_tasks.php](/changeset/3210469/taskbuilder/trunk/includes/admin/projects/open_project/wppm_view_project_tasks.php "Show the changeset 3210469 restricted to taskbuilder/trunk/includes/admin/projects/open_project/wppm_view_project_tasks.php")

  | [r3191970](/browser/taskbuilder/trunk/includes/admin/projects/open_project/wppm_view_project_tasks.php?rev=3191970#L8 "Show revision 3191970 of this file in browser") | [r3210469](/browser/taskbuilder/trunk/includes/admin/projects/open_project/wppm_view_project_tasks.php?rev=3210469#L8 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 8 | 8 | $totalrows\_tasks = 0; |
  | 9 | 9 | $appearance\_settings = get\_option("wppm-ap-grid-view"); |
  |  | 10 | $cu\_id = esc\_sql($current\_user->ID); |
  | 10 | 11 | $page\_no = isset($\_POST['page\_no']) ? intval(sanitize\_text\_field($\_POST['page\_no'])) : '0'; |
  | 11 | 12 | $orderby\_sql = esc\_sql(sanitize\_sql\_orderby( "load\_order ASC" )); |
  | 12 |  | $task\_status = $wpdb->get\_results( "SELECT \* FROM {$wpdb->prefix}wppm\_task\_statuses ORDER BY ~~'$orderby\_sql'~~ " ); |
  |  | 13 | $task\_status = $wpdb->get\_results( "SELECT \* FROM {$wpdb->prefix}wppm\_task\_statuses ORDER BY $orderby\_sql " ); |
  | 13 | 14 | $wppm\_task\_time = get\_option('wppm\_task\_time'); |
  | 14 | 15 | $search\_tag = isset($\_POST['task\_search']) ? sanitize\_text\_field($\_POST['task\_search']) : ''; |
  | […](/browser/taskbuilder/trunk/includes/admin/projects/open_project/wppm_view_project_tasks.php?rev=3191970#L43) | […](/browser/taskbuilder/trunk/includes/admin/projects/open_project/wppm_view_project_tasks.php?rev=3210469#L44) |  |
  | 43 | 44 | } |
  | 44 | 45 | }else{ |
  | 45 |  | $where =  " where ((FIND\_IN\_SET($current\_user->ID,proj.users)) OR (proj.id = proj\_meta.project\_id AND proj\_meta.meta\_key='public\_project' AND proj\_meta.meta\_value=1) OR ( proj.created\_by='$cu~~rrent\_user->ID~~')) $wppm\_proj\_attr Group by proj.id ORDER BY '$santitize\_order\_by'"; |
  |  | 46 | $where =  " where ((FIND\_IN\_SET($current\_user->ID,proj.users)) OR (proj.id = proj\_meta.project\_id AND proj\_meta.meta\_key='public\_project' AND proj\_meta.meta\_value=1) OR ( proj.created\_by='$cu\_id')) $wppm\_proj\_attr Group by proj.id ORDER BY '$santitize\_order\_by'"; |
  | 46 | 47 | } |
  | 47 | 48 | $where = apply\_filters('wppm\_project\_filter\_in\_task\_list\_grid\_view\_where',$where); |
  | […](/browser/taskbuilder/trunk/includes/admin/projects/open_project/wppm_view_project_tasks.php?rev=3191970#L81) | […](/browser/taskbuilder/trunk/includes/admin/projects/open_project/wppm_view_project_tasks.php?rev=3210469#L82) |  |
  | 81 | 82 | } |
  | 82 | 83 | if($proj\_filter!=0){ |
  | 83 |  | $wppm\_task\_by\_proj\_filter = "Task.project = ~~$proj\_filter~~"; |
  |  | 84 | $wppm\_task\_by\_proj\_filter = "Task.project = ".esc\_sql($proj\_filter).""; |
  | 84 | 85 | }else{ |
  | 85 | 86 | $wppm\_task\_by\_proj\_filter ="1=1"; |
  | […](/browser/taskbuilder/trunk/includes/admin/projects/open_project/wppm_view_project_tasks.php?rev=3191970#L112) | […](/browser/taskbuilder/trunk/includes/admin/projects/open_project/wppm_view_project_tasks.php?rev=3210469#L113) |  |
  | 112 | 113 | "); |
  | 113 | 114 | $no\_of\_rows = ( "SELECT count(\*) FROM ($query"); |
  | 114 |  | $where = " where $wppm\_tl\_filter AND $wppm\_task\_by\_proj\_filter AND (((FIND\_IN\_SET('$current\_user->ID',Task.users)>0) OR (Task.created\_by= '$cu~~rrent\_user->ID') OR (proj\_users.user\_id = '$current\_user->ID' AND proj\_users.role\_id = 1 AND (FIND\_IN\_SET('$current\_user->ID',proj.users)>0)) OR (Task.project = proj\_meta.project\_id AND proj\_meta.meta\_key='public\_project' AND proj\_meta.meta\_value=1) OR proj.created\_by='$current\_user->ID~~') AND (Task.task\_name LIKE '$search\_tag\_text' OR proj.project\_name LIKE '$search\_tag\_text' OR task\_statuses.name LIKE '$search\_tag\_text' OR task\_priorities.name LIKE '$search\_tag\_text' OR user.display\_name LIKE '$search\_tag\_text')) AND Task.status= '$status\_id'"; |
  |  | 115 | $where = " where $wppm\_tl\_filter AND $wppm\_task\_by\_proj\_filter AND (((FIND\_IN\_SET('$current\_user->ID',Task.users)>0) OR (Task.created\_by= '$cu\_id') OR (proj\_users.user\_id = '$cu\_id' AND proj\_users.role\_id = 1 AND (FIND\_IN\_SET('$current\_user->ID',proj.users)>0)) OR (Task.project = proj\_meta.project\_id AND proj\_meta.meta\_key='public\_project' AND proj\_meta.meta\_value=1) OR proj.created\_by='$cu\_id') AND (Task.task\_name LIKE '$search\_tag\_text' OR proj.project\_name LIKE '$search\_tag\_text' OR task\_statuses.name LIKE '$search\_tag\_text' OR task\_priorities.name LIKE '$search\_tag\_text' OR user.display\_name LIKE '$search\_tag\_text')) AND Task.status= '$status\_id'"; |
  | 115 | 116 | } |
  | 116 | 117 | }else{ |
  | […](/browser/taskbuilder/trunk/includes/admin/projects/open_project/wppm_view_project_tasks.php?rev=3191970#L130) | […](/browser/taskbuilder/trunk/includes/admin/projects/open_project/wppm_view_project_tasks.php?rev=3210469#L131) |  |
  | 130 | 131 | "); |
  | 131 | 132 | $no\_of\_rows = ( "SELECT count(\*) FROM ($query"); |
  | 132 |  | $where = " where $wppm\_tl\_filter AND $wppm\_task\_by\_proj\_filter AND ((FIND\_IN\_SET('$current\_user->ID',Task.users)>0) OR (Task.created\_by= '$cu~~rrent\_user->ID') OR (proj\_users.user\_id = '$current\_user->ID' AND proj\_users.role\_id = 1 AND (FIND\_IN\_SET('$current\_user->ID',proj.users)>0)) OR (Task.project = proj\_meta.project\_id AND proj\_meta.meta\_key='public\_project' AND proj\_meta.meta\_value=1) OR proj.created\_by='$current\_user->ID~~') AND Task.status= '$status\_id'"; |
  |  | 133 | $where = " where $wppm\_tl\_filter AND $wppm\_task\_by\_proj\_filter AND ((FIND\_IN\_SET('$current\_user->ID',Task.users)>0) OR (Task.created\_by= '$cu\_id') OR (proj\_users.user\_id = '$cu\_id' AND proj\_users.role\_id = 1 AND (FIND\_IN\_SET('$current\_user->ID',proj.users)>0)) OR (Task.project = proj\_meta.project\_id AND proj\_meta.meta\_key='public\_project' AND proj\_meta.meta\_value=1) OR proj.created\_by='$cu\_id') AND Task.status= '$status\_id'"; |
  | 133 | 134 | } |
  | 134 | 135 | } |
  | […](/browser/taskbuilder/trunk/includes/admin/projects/open_project/wppm_view_project_tasks.php?rev=3191970#L169) | […](/browser/taskbuilder/trunk/includes/admin/projects/open_project/wppm_view_project_tasks.php?rev=3210469#L170) |  |
  | 169 | 170 | $tusers =  $val\_array['users']; |
  | 170 | 171 | $tusers\_arr = explode(',',$tusers); |
  | 171 |  | $tproject\_id = ~~$val\_array['project']~~; |
  |  | 172 | $tproject\_id = esc\_sql($val\_array['project']); |
  | 172 | 173 | if(!empty($tusers) && in\_array($current\_user->ID,$tusers\_arr)){ |
  | 173 |  | $project\_user\_role = $wpdb->get\_var("SELECT role\_id FROM {$wpdb->prefix}wppm\_project\_users WHERE proj\_id = '$tproject\_id' AND user\_id = '$cu~~rrent\_user->ID~~'"); |
  |  | 174 | $project\_user\_role = $wpdb->get\_var("SELECT role\_id FROM {$wpdb->prefix}wppm\_project\_users WHERE proj\_id = '$tproject\_id' AND user\_id = '$cu\_id'"); |
  | 174 | 175 | $project\_users = $wpdb->get\_var("SELECT users FROM {$wpdb->prefix}wppm\_project WHERE id = '$tproject\_id'"); |
  | 175 | 176 | $project\_users\_arr = explode(',',(string)$project\_users); |
* ## [taskbuilder/trunk/includes/admin/projects/projects\_list.php](/changeset/3210469/taskbuilder/trunk/includes/admin/projects/projects_list.php "Show the changeset 3210469 restricted to taskbuilder/trunk/includes/admin/projects/projects_list.php")

  | [r3174963](/browser/taskbuilder/trunk/includes/admin/projects/projects_list.php?rev=3174963#L16 "Show revision 3174963 of this file in browser") | [r3210469](/browser/taskbuilder/trunk/includes/admin/projects/projects_list.php?rev=3210469#L16 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 16 | 16 | $current\_date = date('Y-m-d'); |
  | 17 | 17 | $wppm\_pl\_filter = "1=1"; |
  |  | 18 | $cu\_id = esc\_sql($current\_user->ID); |
  | 18 | 19 | $filters = array( |
  | 19 | 20 | 'sort\_by' => $sort\_by, |
  | […](/browser/taskbuilder/trunk/includes/admin/projects/projects_list.php?rev=3174963#L90) | […](/browser/taskbuilder/trunk/includes/admin/projects/projects_list.php?rev=3210469#L91) |  |
  | 90 | 91 | $where = " where $wppm\_pl\_filter AND (Project.project\_name LIKE '$search\_tag\_text' OR proj\_statuses.name LIKE '$search\_tag\_text' OR proj\_categories.name LIKE '$search\_tag\_text' OR ( user.display\_name LIKE '$search\_tag\_text'))"; |
  | 91 | 92 | }else{ |
  | 92 |  | $where = " where $wppm\_pl\_filter AND (Project.project\_name LIKE '$search\_tag\_text' OR proj\_statuses.name LIKE '$search\_tag\_text' OR proj\_categories.name LIKE '$search\_tag\_text' OR ( user.display\_name LIKE '$search\_tag\_text')) AND ((FIND\_IN\_SET('$current\_user->ID',Project.users)>0) OR (Project.id = proj\_meta.project\_id AND proj\_meta.meta\_key='public\_project' AND proj\_meta.meta\_value=1) OR Project.created\_by='$cu~~rrent\_user->ID~~')"; |
  |  | 93 | $where = " where $wppm\_pl\_filter AND (Project.project\_name LIKE '$search\_tag\_text' OR proj\_statuses.name LIKE '$search\_tag\_text' OR proj\_categories.name LIKE '$search\_tag\_text' OR ( user.display\_name LIKE '$search\_tag\_text')) AND ((FIND\_IN\_SET('$current\_user->ID',Project.users)>0) OR (Project.id = proj\_meta.project\_id AND proj\_meta.meta\_key='public\_project' AND proj\_meta.meta\_value=1) OR Project.created\_by='$cu\_id')"; |
  | 93 | 94 | } |
  | 94 | 95 | }else{ |
  | […](/browser/taskbuilder/trunk/includes/admin/projects/projects_list.php?rev=3174963#L107) | […](/browser/taskbuilder/trunk/includes/admin/projects/projects_list.php?rev=3210469#L108) |  |
  | 107 | 108 | $where =  " where $wppm\_pl\_filter"; |
  | 108 | 109 | }else{ |
  | 109 |  | $where = " where ($wppm\_pl\_filter AND (FIND\_IN\_SET('$current\_user->ID',Project.users)>0 OR (Project.id = proj\_meta.project\_id AND proj\_meta.meta\_key='public\_project' AND proj\_meta.meta\_value=1)) OR Project.created\_by='$cu~~rrent\_user->ID~~')"; |
  |  | 110 | $where = " where ($wppm\_pl\_filter AND (FIND\_IN\_SET('$current\_user->ID',Project.users)>0 OR (Project.id = proj\_meta.project\_id AND proj\_meta.meta\_key='public\_project' AND proj\_meta.meta\_value=1)) OR Project.created\_by='$cu\_id')"; |
  | 110 | 111 | } |
  | 111 | 112 | } |
  | […](/browser/taskbuilder/trunk/includes/admin/projects/projects_list.php?rev=3174963#L113) | […](/browser/taskbuilder/trunk/includes/admin/projects/projects_list.php?rev=3210469#L114) |  |
  | 113 | 114 | $no\_of\_rows = apply\_filters('wppm\_project\_list\_no\_of\_rows',$no\_of\_rows,$wppm\_pl\_filter,$search\_tag); |
  | 114 | 115 | $where = apply\_filters('wppm\_project\_list\_query\_where',$where, $wppm\_pl\_filter,$search\_tag); |
  |  | 116 | $sort\_by = esc\_sql($sort\_by); |
  |  | 117 | $order = esc\_sql($order); |
  | 115 | 118 | $query .= $where." Group by Project.id ORDER BY $sort\_by $order"; |
  | 116 | 119 | $no\_of\_rows .= $where." Group by Project.id) AS Project"; |
  | […](/browser/taskbuilder/trunk/includes/admin/projects/projects_list.php?rev=3174963#L195) | […](/browser/taskbuilder/trunk/includes/admin/projects/projects_list.php?rev=3210469#L198) |  |
  | 195 | 198 | <table id="wppm\_project\_table" class="wppm\_table table"> |
  | 196 | 199 | <tr> |
  | 197 |  | <th ~~style="width: 45px;"~~  onchange="wppm\_bulk\_select\_change()"> |
  |  | 200 | <th class="wppm\_table\_header" style="background-color:<?php echo esc\_attr($appearance\_settings['list-header-background-color'])?>" onchange="wppm\_bulk\_select\_change()"> |
  | 198 | 201 | <div class="checkbox-container"> |
  | 199 | 202 | <input id="wppm\_bulk\_select\_option" class="wppm-bulk-selector" type="checkbox" onchange="wppm\_bulk\_select\_change();"/> |
  | […](/browser/taskbuilder/trunk/includes/admin/projects/projects_list.php?rev=3174963#L259) | […](/browser/taskbuilder/trunk/includes/admin/projects/projects_list.php?rev=3210469#L262) |  |
  | 259 | 262 | Left join {$wpdb->prefix}wppm\_project\_users proj\_users ON Task.project = proj\_users.proj\_id |
  | 260 | 263 | Left join {$wpdb->prefix}wppm\_project\_meta proj\_meta ON proj.id = proj\_meta.project\_id |
  | 261 |  | where Task.project = '$pid' AND ((FIND\_IN\_SET('$current\_user->ID',Task.users)>0) OR (Task.created\_by= '$cu~~rrent\_user->ID') OR (proj\_users.user\_id = '$current\_user->ID' AND proj\_users.role\_id = 1 ) OR (proj.id = proj\_meta.project\_id AND proj\_meta.meta\_key='public\_project' AND proj\_meta.meta\_value=1) OR ( Task.project = proj.id AND proj.created\_by='$current\_user->ID~~')) Group by Task.id ) AS Task"); |
  |  | 264 | where Task.project = '$pid' AND ((FIND\_IN\_SET('$current\_user->ID',Task.users)>0) OR (Task.created\_by= '$cu\_id') OR (proj\_users.user\_id = '$cu\_id' AND proj\_users.role\_id = 1 ) OR (proj.id = proj\_meta.project\_id AND proj\_meta.meta\_key='public\_project' AND proj\_meta.meta\_value=1) OR ( Task.project = proj.id AND proj.created\_by='$cu\_id')) Group by Task.id ) AS Task"); |
  | 262 | 265 | $no\_of\_tasks = $wpdb->get\_var($query); |
  | 263 | 266 | } |
* ## [taskbuilder/trunk/includes/admin/projects/wppm\_add\_new\_project.php](/changeset/3210469/taskbuilder/trunk/includes/admin/projects/wppm_add_new_project.php "Show the changeset 3210469 restricted to taskbuilder/trunk/includes/admin/projects/wppm_add_new_project.php")

  | [r3174963](/browser/taskbuilder/trunk/includes/admin/projects/wppm_add_new_project.php?rev=3174963#L9 "Show revision 3174963 of this file in browser") | [r3210469](/browser/taskbuilder/trunk/includes/admin/projects/wppm_add_new_project.php?rev=3210469#L9 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 9 | 9 | $wppm\_public\_projects\_permission = get\_option('wppm\_public\_projects\_permission'); |
  | 10 | 10 | $orderby\_sql       = sanitize\_sql\_orderby("name"); |
  | 11 |  | $categories = $wpdb->get\_results( "SELECT \* FROM {$wpdb->prefix}wppm\_project\_categories ORDER BY ~~".$orderby\_sql~~ ); |
  |  | 11 | $categories = $wpdb->get\_results( "SELECT \* FROM {$wpdb->prefix}wppm\_project\_categories ORDER BY $orderby\_sql" ); |
  | 12 | 12 | $wppm\_current\_user\_capability = get\_user\_meta( $current\_user->ID, 'wppm\_capability', true ); |
  | 13 | 13 | ?> |
* ## [taskbuilder/trunk/includes/admin/projects/wppm\_filter\_autocomplete.php](/changeset/3210469/taskbuilder/trunk/includes/admin/projects/wppm_filter_autocomplete.php "Show the changeset 3210469 restricted to taskbuilder/trunk/includes/admin/projects/wppm_filter_autocomplete.php")

  | [r3191970](/browser/taskbuilder/trunk/includes/admin/projects/wppm_filter_autocomplete.php?rev=3191970#L56 "Show revision 3191970 of this file in browser") | [r3210469](/browser/taskbuilder/trunk/includes/admin/projects/wppm_filter_autocomplete.php?rev=3210469#L56 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 56 | 56 | if($field\_slug == 'task\_users\_by\_project\_name'){ |
  | 57 | 57 | $project\_id = esc\_sql($project\_id); |
  |  | 58 | $cu\_id = esc\_sql($current\_user->ID); |
  | 58 | 59 | $wppm\_fillter = $wpdb->get\_var( "SELECT users FROM {$wpdb->prefix}wppm\_project where id = '$project\_id'" ); |
  | 59 | 60 | $project\_creator = $wpdb->get\_var( "SELECT created\_by FROM {$wpdb->prefix}wppm\_project where id = '$project\_id'" ); |
  | 60 | 61 | $users = get\_users(array('search'=>'\*'.$term.'\*','number' => 5)); |
  | 61 | 62 | $users = apply\_filters("wppm\_filter\_autocomplete\_task\_users\_by\_project\_name",$users,$field\_slug,$term,$task\_id,$project\_id); |
  | 62 |  | $project\_user\_role = $wpdb->get\_var("SELECT role\_id FROM {$wpdb->prefix}wppm\_project\_users WHERE proj\_id = '$project\_id' AND user\_id = '$cu~~rrent\_user->ID~~'"); |
  |  | 63 | $project\_user\_role = $wpdb->get\_var("SELECT role\_id FROM {$wpdb->prefix}wppm\_project\_users WHERE proj\_id = '$project\_id' AND user\_id = '$cu\_id'"); |
  | 63 | 64 | $users\_array = explode(",",(string)$wppm\_fillter); |
  | 64 | 65 | $wppm\_current\_user\_capability = get\_user\_meta( $current\_user->ID, 'wppm\_capability', true ); |
* ## [taskbuilder/trunk/includes/admin/projects/wppm\_get\_delete\_project.php](/changeset/3210469/taskbuilder/trunk/includes/admin/projects/wppm_get_delete_project.php "Show the changeset 3210469 restricted to taskbuilder/trunk/includes/admin/projects/wppm_get_delete_project.php")

  | [r3174963](/browser/taskbuilder/trunk/includes/admin/projects/wppm_get_delete_project.php?rev=3174963#L5 "Show revision 3174963 of this file in browser") | [r3210469](/browser/taskbuilder/trunk/includes/admin/projects/wppm_get_delete_project.php?rev=3210469#L5 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 5 | 5 | global $current\_user,$wppmfunction,$wpdb; |
  | 6 | 6 | $id = isset($\_POST['id']) ? intval(sanitize\_text\_field($\_POST['id'])) : '0'; |
  | 7 |  | $project = $wpdb->get\_row( "SELECT \* FROM {$wpdb->prefix}wppm\_project where id = '~~$id'"~~ ); |
  |  | 7 | $project = $wpdb->get\_row( "SELECT \* FROM {$wpdb->prefix}wppm\_project where id = '".esc\_sql($id)."'"); |
  | 8 | 8 | $wppm\_current\_user\_capability = get\_user\_meta( $current\_user->ID, 'wppm\_capability', true ); |
  | 9 | 9 | if (!(($current\_user->ID && $current\_user->has\_cap('manage\_options')) || $wppmfunction->has\_project\_permission('delete\_project',$id) || ($project->created\_by==$current\_user->ID && $wppm\_current\_user\_capability == 'wppm\_manager') || ($current\_user->ID && $current\_user->has\_cap('wppm\_admin')))) {exit;} |
* ## [taskbuilder/trunk/includes/admin/projects/wppm\_open\_project.php](/changeset/3210469/taskbuilder/trunk/includes/admin/projects/wppm_open_project.php "Show the changeset 3210469 restricted to taskbuilder/trunk/includes/admin/projects/wppm_open_project.php")

  | [r3174963](/browser/taskbuilder/trunk/includes/admin/projects/wppm_open_project.php?rev=3174963#L16 "Show revision 3174963 of this file in browser") | [r3210469](/browser/taskbuilder/trunk/includes/admin/projects/wppm_open_project.php?rev=3210469#L16 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 16 | 16 | $auth\_id = $wppmfunction->get\_project\_meta($id,'project\_auth\_code',true); |
  | 17 | 17 | $auth\_id = sanitize\_text\_field($auth\_id); |
  | 18 |  | $project = $wpdb->get\_row( "SELECT \* FROM {$wpdb->prefix}wppm\_project where id = ~~$id~~" ); |
  | 19 |  | $orderby\_sql = ~~sanitize\_sql\_orderby("create\_time DESC"~~); |
  | 20 |  | $project\_comment = $wpdb->get\_results( "SELECT \* FROM {$wpdb->prefix}wppm\_project\_comment where proj\_id=~~"."$id"." ORDER BY ".$orderby\_sql~~); |
  |  | 18 | $project = $wpdb->get\_row( "SELECT \* FROM {$wpdb->prefix}wppm\_project where id = '".esc\_sql($id)."'" ); |
  |  | 19 | $orderby\_sql = esc\_sql(sanitize\_sql\_orderby("create\_time DESC")); |
  |  | 20 | $project\_comment = $wpdb->get\_results( "SELECT \* FROM {$wpdb->prefix}wppm\_project\_comment where proj\_id='".esc\_sql($id)."' ORDER BY $orderby\_sql"); |
  | 21 | 21 | if(isset($project->users)){ |
  | 22 | 22 | $users = explode(",",$project->users); |
  | […](/browser/taskbuilder/trunk/includes/admin/projects/wppm_open_project.php?rev=3174963#L27) | […](/browser/taskbuilder/trunk/includes/admin/projects/wppm_open_project.php?rev=3210469#L27) |  |
  | 27 | 27 | if(isset($project->status)){ |
  | 28 | 28 | $projstatus = esc\_sql($project->status); |
  | 29 |  | $project\_status = $wpdb->get\_row("SELECT \* FROM {$wpdb->prefix}wppm\_project\_statuses where id = ~~$projstatus~~"); |
  |  | 29 | $project\_status = $wpdb->get\_row("SELECT \* FROM {$wpdb->prefix}wppm\_project\_statuses where id = '$projstatus'"); |
  | 30 | 30 | } |
  | 31 | 31 | if(isset($project->cat\_id)){ |
  | 32 | 32 | $projcat = esc\_sql($project->cat\_id); |
  | 33 |  | $project\_category = $wpdb->get\_row("SELECT \* FROM {$wpdb->prefix}wppm\_project\_categories where id = ~~$projcat~~"); |
  |  | 33 | $project\_category = $wpdb->get\_row("SELECT \* FROM {$wpdb->prefix}wppm\_project\_categories where id = '$projcat'"); |
  | 34 | 34 | } |
  | 35 | 35 | if(!empty($project->description)){ |
  | […](/browser/taskbuilder/trunk/includes/admin/projects/wppm_open_project.php?rev=3174963#L162) | […](/browser/taskbuilder/trunk/includes/admin/projects/wppm_open_project.php?rev=3210469#L162) |  |
  | 162 | 162 | if(!empty($project\_comment)){ |
  | 163 | 163 | foreach($project\_comment as $comment){ |
  | 164 |  | $proj\_comment\_meta = $wpdb->get\_row( "SELECT \* FROM {$wpdb->prefix}wppm\_project\_comment\_meta where proj\_id=~~".$id." AND comment\_id=".esc\_sql($comment->id)."~~"); |
  |  | 164 | $proj\_comment\_meta = $wpdb->get\_row( "SELECT \* FROM {$wpdb->prefix}wppm\_project\_comment\_meta where proj\_id='".esc\_sql($id)."' AND comment\_id='".esc\_sql($comment->id)."'"); |
  | 165 | 165 | $user = get\_userdata( $comment->created\_by ); |
  | 166 | 166 | $comment\_body = stripslashes((htmlspecialchars\_decode($comment->body, ENT\_QUOTES))); |
  | […](/browser/taskbuilder/trunk/includes/admin/projects/wppm_open_project.php?rev=3174963#L284) | […](/browser/taskbuilder/trunk/includes/admin/projects/wppm_open_project.php?rev=3210469#L284) |  |
  | 284 | 284 | if(!empty($attachments)){ |
  | 285 | 285 | foreach( $attachments as $attachment ): |
  |  | 286 | $download\_url = site\_url('/').'?wppm\_attachment='.$attachment.'&pid='.$id.'&pac='.$auth\_id; |
  | 286 | 287 | $attachment = esc\_sql($attachment); |
  | 287 | 288 | $attach = $wpdb->get\_row( "SELECT \* FROM {$wpdb->prefix}wppm\_attachments where id='$attachment'"); |
  | 288 |  | ~~$download\_url = site\_url('/').'?wppm\_attachment='.$attachment.'&pid='.$id.'&pac='.$auth\_id;~~ |
  | 289 | 289 | $findStr = ".txt"; |
  | 290 | 290 | if(!empty( $attach)){ |
  | […](/browser/taskbuilder/trunk/includes/admin/projects/wppm_open_project.php?rev=3174963#L367) | […](/browser/taskbuilder/trunk/includes/admin/projects/wppm_open_project.php?rev=3210469#L367) |  |
  | 367 | 367 | $user\_data = get\_userdata($user); |
  | 368 | 368 | $user = esc\_sql($user); |
  | 369 |  | $project\_user = $wpdb->get\_row("SELECT \* FROM {$wpdb->prefix}wppm\_project\_users WHERE proj\_id = '~~$id~~' AND user\_id = '$user'"); |
  |  | 369 | $project\_user = $wpdb->get\_row("SELECT \* FROM {$wpdb->prefix}wppm\_project\_users WHERE proj\_id = '".esc\_sql($id)."' AND user\_id = '$user'"); |
  | 370 | 370 | ?> |
  | 371 | 371 | <div style="padding:2px 0;"> |
* ## [taskbuilder/trunk/includes/admin/projects/wppm\_set\_bulk\_change\_project\_category.php](/changeset/3210469/taskbuilder/trunk/includes/admin/projects/wppm_set_bulk_change_project_category.php "Show the changeset 3210469 restricted to taskbuilder/trunk/includes/admin/projects/wppm_set_bulk_change_project_category.php")

  | [r3174963](/browser/taskbuilder/trunk/includes/admin/projects/wppm_set_bulk_change_project_category.php?rev=3174963#L27 "Show revision 3174963 of this file in browser") | [r3210469](/browser/taskbuilder/trunk/includes/admin/projects/wppm_set_bulk_change_project_category.php?rev=3210469#L27 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 27 | 27 | $change\_category\_value = array('prev\_cat'=>"$project\_data[cat\_id]",'new\_cat'=>"$proj\_category"); |
  | 28 | 28 | $change\_category\_obj = serialize($change\_category\_value); |
  | 29 |  | $log\_values = array('proj\_id'=>$proj\_id,'body'=>$change\_category\_obj,'attachment\_ids'=>"",'create\_time'=>date("Y-m-d h:i:sa"),'created\_by'=>$current\_user->ID ); |
  |  | 29 | $proj\_id = esc\_sql($proj\_id); |
  |  | 30 | $log\_values = array('proj\_id'=>"$proj\_id",'body'=>$change\_category\_obj,'attachment\_ids'=>"",'create\_time'=>date("Y-m-d h:i:sa"),'created\_by'=>esc\_sql($current\_user->ID) ); |
  | 30 | 31 | $wpdb->insert($wpdb->prefix . 'wppm\_project\_comment',$log\_values); |
  | 31 |  | $log\_id = ~~$wpdb->insert\_id~~; |
  | 32 |  | $proj\_log\_values = array('proj\_id'=>~~$proj\_id,'comment\_id'=>$log\_id~~,'comment\_type'=>'change\_proj\_cat'); |
  |  | 32 | $log\_id = esc\_sql($wpdb->insert\_id); |
  |  | 33 | $proj\_log\_values = array('proj\_id'=>"$proj\_id",'comment\_id'=>"$log\_id",'comment\_type'=>'change\_proj\_cat'); |
  | 33 | 34 | $wpdb->insert($wpdb->prefix . 'wppm\_project\_comment\_meta',$proj\_log\_values); |
  | 34 | 35 | } |
* ## [taskbuilder/trunk/includes/admin/projects/wppm\_set\_bulk\_project\_users.php](/changeset/3210469/taskbuilder/trunk/includes/admin/projects/wppm_set_bulk_project_users.php "Show the changeset 3210469 restricted to taskbuilder/trunk/includes/admin/projects/wppm_set_bulk_project_users.php")

  | [r3174963](/browser/taskbuilder/trunk/includes/admin/projects/wppm_set_bulk_project_users.php?rev=3174963#L25 "Show revision 3174963 of this file in browser") | [r3210469](/browser/taskbuilder/trunk/includes/admin/projects/wppm_set_bulk_project_users.php?rev=3210469#L25 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 25 | 25 | $prev\_assgn\_user\_meta = $wppmfunction->get\_project\_meta($proj\_id,'prev\_assigned\_users'); |
  | 26 | 26 | $wppmfunction->delete\_project\_meta($proj\_id,'prev\_assigned\_users'); |
  | 27 |  | $task\_users = $wpdb->get\_results("SELECT id,users FROM {$wpdb->prefix}wppm\_task WHERE project = ~~$proj\_id~~"); |
  |  | 27 | $task\_users = $wpdb->get\_results("SELECT id,users FROM {$wpdb->prefix}wppm\_task WHERE project = '".esc\_sql($proj\_id)."';"); |
  | 28 | 28 | if(!empty($prev\_assign\_users)) { |
  | 29 | 29 | foreach($prev\_assign\_users as $puser){ |
  | […](/browser/taskbuilder/trunk/includes/admin/projects/wppm_set_bulk_project_users.php?rev=3174963#L39) | […](/browser/taskbuilder/trunk/includes/admin/projects/wppm_set_bulk_project_users.php?rev=3210469#L39) |  |
  | 39 | 39 | $wppmtuser = implode(',',$wppm\_tuser); |
  | 40 | 40 | $value=array( |
  | 41 |  | 'users'=>  ~~$wppmtuser~~ |
  |  | 41 | 'users'=>  esc\_sql($wppmtuser) |
  | 42 | 42 | ); |
  | 43 | 43 | } elseif(empty($wppm\_tuser)){ |
  | […](/browser/taskbuilder/trunk/includes/admin/projects/wppm_set_bulk_project_users.php?rev=3174963#L46) | […](/browser/taskbuilder/trunk/includes/admin/projects/wppm_set_bulk_project_users.php?rev=3210469#L46) |  |
  | 46 | 46 | ); |
  | 47 | 47 | } |
  | 48 |  | $wpdb->update($wpdb->prefix.'wppm\_task', $value, array('id'=>~~$tuser->id~~)); |
  |  | 48 | $wpdb->update($wpdb->prefix.'wppm\_task', $value, array('id'=>esc\_sql($tuser->id))); |
  | 49 | 49 | } |
  | 50 | 50 | } |
  | […](/browser/taskbuilder/trunk/includes/admin/projects/wppm_set_bulk_project_users.php?rev=3174963#L61) | […](/browser/taskbuilder/trunk/includes/admin/projects/wppm_set_bulk_project_users.php?rev=3210469#L61) |  |
  | 61 | 61 | $wppmtuser = implode(',',$wppm\_tuser); |
  | 62 | 62 | $value=array( |
  | 63 |  | 'users'=> ~~$wppmtuser~~ |
  |  | 63 | 'users'=> esc\_sql($wppmtuser) |
  | 64 | 64 | ); |
  | 65 | 65 | } elseif(empty($wppm\_tuser)){ |
  | […](/browser/taskbuilder/trunk/includes/admin/projects/wppm_set_bulk_project_users.php?rev=3174963#L68) | […](/browser/taskbuilder/trunk/includes/admin/projects/wppm_set_bulk_project_users.php?rev=3210469#L68) |  |
  | 68 | 68 | ); |
  | 69 | 69 | } |
  | 70 |  | $wpdb->update($wpdb->prefix.'wppm\_task', $value, array('id'=>~~$tuser->id~~)); |
  |  | 70 | $wpdb->update($wpdb->prefix.'wppm\_task', $value, array('id'=>esc\_sql($tuser->id))); |
  | 71 | 71 | } |
  | 72 | 72 | } |
  | […](/browser/taskbuilder/trunk/includes/admin/projects/wppm_set_bulk_project_users.php?rev=3174963#L79) | […](/browser/taskbuilder/trunk/includes/admin/projects/wppm_set_bulk_project_users.php?rev=3210469#L79) |  |
  | 79 | 79 | foreach($users as $user){ |
  | 80 | 80 | $user\_role = sanitize\_text\_field($\_POST['wppm\_select\_user\_role\_'.$user]); |
  | 81 |  | $project\_user = $wpdb->get\_row("SELECT \* FROM {$wpdb->prefix}wppm\_project\_users WHERE proj\_id = '~~$proj\_id' AND user\_id = '$user~~'"); |
  |  | 81 | $project\_user = $wpdb->get\_row("SELECT \* FROM {$wpdb->prefix}wppm\_project\_users WHERE proj\_id = '".esc\_sql($proj\_id)."' AND user\_id = '". esc\_sql( $user)."'"); |
  | 82 | 82 | if(!empty($project\_user)){ |
  | 83 | 83 | $values=array( |
  | 84 |  | 'role\_id'=> ~~$user\_role~~, |
  | 85 |  | 'assigned\_by'=> ~~$current\_user->ID~~ |
  |  | 84 | 'role\_id'=> esc\_sql($user\_role), |
  |  | 85 | 'assigned\_by'=> esc\_sql($current\_user->ID) |
  | 86 | 86 | ); |
  | 87 |  | $wpdb->update($wpdb->prefix.'wppm\_project\_users', $values, array('id'=>~~$project\_user->id~~)); |
  |  | 87 | $wpdb->update($wpdb->prefix.'wppm\_project\_users', $values, array('id'=>esc\_sql($project\_user->id))); |
  | 88 | 88 | }else{ |
  | 89 | 89 | $wpdb->insert( |
  | 90 | 90 | $wpdb->prefix . 'wppm\_project\_users', |
  | 91 | 91 | array( |
  | 92 |  | 'proj\_id' => ~~$proj\_id~~, |
  | 93 |  | 'user\_id' => ~~$user~~, |
  | 94 |  | 'role\_id' => ~~$user\_role~~, |
  | 95 |  | 'assigned\_by' => ~~$current\_user->ID~~ |
  |  | 92 | 'proj\_id' => esc\_sql($proj\_id), |
  |  | 93 | 'user\_id' => esc\_sql($user), |
  |  | 94 | 'role\_id' => esc\_sql($user\_role), |
  |  | 95 | 'assigned\_by' => esc\_sql($current\_user->ID) |
  | 96 | 96 | ) ); |
  | 97 | 97 | } |
  | […](/browser/taskbuilder/trunk/includes/admin/projects/wppm_set_bulk_project_users.php?rev=3174963#L100) | […](/browser/taskbuilder/trunk/includes/admin/projects/wppm_set_bulk_project_users.php?rev=3210469#L100) |  |
  | 100 | 100 | if($project\_data['users'] != $pusers){ |
  | 101 | 101 | $pvalues=array( |
  | 102 |  | 'users'=> ~~$pusers~~ |
  |  | 102 | 'users'=> esc\_sql($pusers) |
  | 103 | 103 | ); |
  | 104 |  | $wpdb->update($wpdb->prefix.'wppm\_project', $pvalues, array('id'=>~~$proj\_id~~)); |
  |  | 104 | $wpdb->update($wpdb->prefix.'wppm\_project', $pvalues, array('id'=>esc\_sql($proj\_id))); |
  | 105 | 105 | } |
  | 106 | 106 | } |
  | […](/browser/taskbuilder/trunk/includes/admin/projects/wppm_set_bulk_project_users.php?rev=3174963#L109) | […](/browser/taskbuilder/trunk/includes/admin/projects/wppm_set_bulk_project_users.php?rev=3210469#L109) |  |
  | 109 | 109 | 'users'=>'' |
  | 110 | 110 | ); |
  | 111 |  | $wpdb->update($wpdb->prefix.'wppm\_project', $pvalues, array('id'=>~~$proj\_id~~)); |
  |  | 111 | $wpdb->update($wpdb->prefix.'wppm\_project', $pvalues, array('id'=>esc\_sql($proj\_id))); |
  | 112 | 112 | } |
  | 113 | 113 | $change\_assign\_user\_value = array('prev\_assign\_user'=>"$project\_data[users]",'new\_assign\_user'=>"$pusers"); |
  | 114 | 114 | $change\_assign\_user\_obj = serialize($change\_assign\_user\_value); |
  | 115 |  | $log\_values = array('proj\_id'=>~~$proj\_id,'body'=>$change\_assign\_user\_obj,'attachment\_ids'=>"",'create\_time'=>date("Y-m-d h:i:sa"),'created\_by'=>$current\_user->ID~~ ); |
  |  | 115 | $log\_values = array('proj\_id'=>esc\_sql($proj\_id),'body'=>$change\_assign\_user\_obj,'attachment\_ids'=>"",'create\_time'=>date("Y-m-d h:i:sa"),'created\_by'=>esc\_sql($current\_user->ID)); |
  | 116 | 116 | $wpdb->insert($wpdb->prefix . 'wppm\_project\_comment',$log\_values); |
  | 117 |  | $log\_id = ~~$wpdb->insert\_id~~; |
  | 118 |  | $proj\_log\_values = array('proj\_id'=>~~$proj\_id~~,'comment\_id'=>$log\_id,'comment\_type'=>'change\_assign\_user'); |
  |  | 117 | $log\_id = esc\_sql($wpdb->insert\_id); |
  |  | 118 | $proj\_log\_values = array('proj\_id'=>esc\_sql($proj\_id),'comment\_id'=>$log\_id,'comment\_type'=>'change\_assign\_user'); |
  | 119 | 119 | $wpdb->insert($wpdb->prefix . 'wppm\_project\_comment\_meta',$proj\_log\_values); |
  | 120 | 120 | do\_action('wppm\_set\_bulk\_project\_users', $proj\_id); |
* ## [taskbuilder/trunk/includes/admin/projects/wppm\_set\_delete\_bulk\_projects.php](/changeset/3210469/taskbuilder/trunk/includes/admin/projects/wppm_set_delete_bulk_projects.php "Show the changeset 3210469 restricted to taskbuilder/trunk/includes/admin/projects/wppm_set_delete_bulk_projects.php")

  | [r3174963](/browser/taskbuilder/trunk/includes/admin/projects/wppm_set_delete_bulk_projects.php?rev=3174963#L16 "Show revision 3174963 of this file in browser") | [r3210469](/browser/taskbuilder/trunk/includes/admin/projects/wppm_set_delete_bulk_projects.php?rev=3210469#L16 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 16 | 16 | $project\_data = $wppmfunction->get\_project($proj\_id); |
  | 17 | 17 | if ((($current\_user->ID && $current\_user->has\_cap('manage\_options')) || $wppmfunction->has\_project\_permission('delete\_project',$proj\_id) || ($project\_data['created\_by']==$current\_user->ID && $wppm\_current\_user\_capability == 'wppm\_manager') || ($current\_user->ID && $current\_user->has\_cap('wppm\_admin')))) { |
  | 18 |  | $tasks = $wpdb->get\_results("SELECT \* FROM {$wpdb->prefix}wppm\_task where project = ~~$proj\_id~~"); |
  |  | 18 | $tasks = $wpdb->get\_results("SELECT \* FROM {$wpdb->prefix}wppm\_task where project = '".esc\_sql($proj\_id)."'"); |
  | 19 | 19 | /\*\*\*\*\*\*\*\*\*\*\*\*\*delete project\*\*\*\*\*\*\*\*/ |
  | 20 | 20 | $wpdb->delete($wpdb->prefix.'wppm\_project',array('id'=>$proj\_id)); |
  | 21 | 21 | /\*\*\*\*\*\*\*\*\*\*\*\*\*delete project comment\*\*\*\*\*\*\*\*/ |
  | 22 |  | $sql="SELECT attachment\_ids FROM {$wpdb->prefix}wppm\_project\_comment WHERE proj\_id =~~".$proj\_id~~; |
  |  | 22 | $sql="SELECT attachment\_ids FROM {$wpdb->prefix}wppm\_project\_comment WHERE proj\_id ='".esc\_sql($proj\_id)."'"; |
  | 23 | 23 | $proj\_comm\_attachment\_ids= $wpdb->get\_results( $sql ); |
  | 24 | 24 | if(!empty($proj\_comm\_attachment\_ids)){ |
  | […](/browser/taskbuilder/trunk/includes/admin/projects/wppm_set_delete_bulk_projects.php?rev=3174963#L29) | […](/browser/taskbuilder/trunk/includes/admin/projects/wppm_set_delete_bulk_projects.php?rev=3210469#L29) |  |
  | 29 | 29 | } |
  | 30 | 30 | foreach ($proj\_attachment\_ids\_temp as $proj\_attachment\_id){ |
  | 31 |  | $sql="SELECT \* FROM {$wpdb->prefix}wppm\_attachments WHERE id =~~".$proj\_attachment\_id~~; |
  |  | 31 | $sql="SELECT \* FROM {$wpdb->prefix}wppm\_attachments WHERE id ='".esc\_sql($proj\_attachment\_id)."'"; |
  | 32 | 32 | $att\_result=$wpdb->get\_row($sql); |
  | 33 | 33 | if(!empty($att\_result)){ |
  | 34 |  | $sql\_query="SELECT file\_path FROM {$wpdb->prefix}wppm\_attachments WHERE file\_path ='".~~$att\_result->file\_path~~."'"; |
  |  | 34 | $sql\_query="SELECT file\_path FROM {$wpdb->prefix}wppm\_attachments WHERE file\_path ='".esc\_sql($att\_result->file\_path)."'"; |
  | 35 | 35 | $proj\_attach\_result=$wpdb->get\_results($sql\_query); |
  | 36 | 36 | $proj\_result\_count = count($proj\_attach\_result); |
  | […](/browser/taskbuilder/trunk/includes/admin/projects/wppm_set_delete_bulk_projects.php?rev=3174963#L39) | […](/browser/taskbuilder/trunk/includes/admin/projects/wppm_set_delete_bulk_projects.php?rev=3210469#L39) |  |
  | 39 | 39 | unlink($att\_result->file\_path); |
  | 40 | 40 | } |
  | 41 |  | $wpdb->delete($wpdb->prefix.'wppm\_attachments', array( 'id' => $proj\_attachment\_id)); |
  |  | 41 | $proj\_attachment\_id = esc\_sql($proj\_attachment\_id); |
  |  | 42 | $wpdb->delete($wpdb->prefix.'wppm\_attachments', array( 'id' => "$proj\_attachment\_id")); |
  | 42 | 43 | } |
  | 43 | 44 | } |
  | 44 | 45 | } |
  | 45 | 46 | } |
  | 46 |  | $wpdb->delete($wpdb->prefix.'wppm\_project\_comment',array('proj\_id'=>~~$proj\_id~~)); |
  | 47 |  | $wpdb->delete($wpdb->prefix.'wppm\_project\_meta',array('project\_id'=>~~$proj\_id~~)); |
  | 48 |  | $wpdb->delete($wpdb->prefix.'wppm\_project\_comment\_meta',array('proj\_id'=>~~$proj\_id~~)); |
  |  | 47 | $wpdb->delete($wpdb->prefix.'wppm\_project\_comment',array('proj\_id'=>esc\_sql($proj\_id))); |
  |  | 48 | $wpdb->delete($wpdb->prefix.'wppm\_project\_meta',array('project\_id'=>esc\_sql($proj\_id))); |
  |  | 49 | $wpdb->delete($wpdb->prefix.'wppm\_project\_comment\_meta',array('proj\_id'=>esc\_sql($proj\_id))); |
  | 49 | 50 |  |
  | 50 | 51 | /\*\*\*\*\*\*\*\*\*\*\*\*\*delete project's tasks and comments\*\*\*\*\*\*\*\*/ |
  | 51 | 52 | foreach($tasks as $task){ |
  | 52 |  | $sql="SELECT attachment\_ids FROM {$wpdb->prefix}wppm\_task\_comment WHERE task\_id =~~".$task->id~~; |
  |  | 53 | $sql="SELECT attachment\_ids FROM {$wpdb->prefix}wppm\_task\_comment WHERE task\_id ='".esc\_sql($task->id)."'"; |
  | 53 | 54 | $thread\_attachment\_ids= $wpdb->get\_results( $sql ); |
  | 54 | 55 |  |
  | […](/browser/taskbuilder/trunk/includes/admin/projects/wppm_set_delete_bulk_projects.php?rev=3174963#L62) | […](/browser/taskbuilder/trunk/includes/admin/projects/wppm_set_delete_bulk_projects.php?rev=3210469#L63) |  |
  | 62 | 63 | //$attachment\_ids=$attachment\_ids\_temp; |
  | 63 | 64 | foreach ($attachment\_ids\_temp as $attachment\_id){ |
  | 64 |  | $sql="SELECT \* FROM {$wpdb->prefix}wppm\_attachments WHERE id =~~".$attachment\_id~~; |
  |  | 65 | $sql="SELECT \* FROM {$wpdb->prefix}wppm\_attachments WHERE id = '".esc\_sql($attachment\_id)."'"; |
  | 65 | 66 | $result=$wpdb->get\_row($sql); |
  | 66 | 67 | if(!empty($result)){ |
  | 67 |  | $sql\_query="SELECT file\_path FROM {$wpdb->prefix}wppm\_attachments WHERE file\_path ='".~~$result->file\_path~~."'"; |
  |  | 68 | $sql\_query="SELECT file\_path FROM {$wpdb->prefix}wppm\_attachments WHERE file\_path ='".esc\_sql($result->file\_path)."'"; |
  | 68 | 69 | $attach\_result=$wpdb->get\_results($sql\_query); |
  | 69 | 70 | $result\_count = count($attach\_result); |
  | […](/browser/taskbuilder/trunk/includes/admin/projects/wppm_set_delete_bulk_projects.php?rev=3174963#L78) | […](/browser/taskbuilder/trunk/includes/admin/projects/wppm_set_delete_bulk_projects.php?rev=3210469#L79) |  |
  | 78 | 79 | } |
  | 79 | 80 | /\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*Code for deleting checklists\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*/ |
  | 80 |  | $sql="SELECT id FROM {$wpdb->prefix}wppm\_checklist WHERE task\_id =~~".$task->id~~; |
  |  | 81 | $sql="SELECT id FROM {$wpdb->prefix}wppm\_checklist WHERE task\_id ='".esc\_sql($task->id)."'"; |
  | 81 | 82 | $checklists = $wpdb->get\_results( $sql ); |
  | 82 | 83 | if(!empty($checklists)){ |
  | 83 | 84 | foreach($checklists as $checklist){ |
  | 84 | 85 | $chk\_array = (array) $checklist; |
  | 85 |  | $sql="SELECT id FROM {$wpdb->prefix}wppm\_checklist\_items WHERE checklist\_id =~~".$chk\_array['id']~~; |
  |  | 86 | $sql="SELECT id FROM {$wpdb->prefix}wppm\_checklist\_items WHERE checklist\_id ='".esc\_sql($chk\_array['id'])."'"; |
  | 86 | 87 | $checklist\_items = $wpdb->get\_results( $sql ); |
  | 87 | 88 | if(!empty($checklist\_items)){ |
  | 88 | 89 | foreach($checklist\_items as $ch\_item){ |
  | 89 | 90 | $chk\_items\_array = (array) $ch\_item; |
  | 90 |  | $wpdb->delete($wpdb->prefix.'wppm\_checklist\_items',array('id'=>~~$chk\_items\_array['id']~~)); |
  |  | 91 | $wpdb->delete($wpdb->prefix.'wppm\_checklist\_items',array('id'=>esc\_sql($chk\_items\_array['id']))); |
  | 91 | 92 | } |
  | 92 | 93 | } |
  | 93 |  | $wpdb->delete($wpdb->prefix.'wppm\_checklist',array('id'=>~~$chk\_array['id']~~)); |
  |  | 94 | $wpdb->delete($wpdb->prefix.'wppm\_checklist',array('id'=>esc\_sql($chk\_array['id']))); |
  | 94 | 95 | } |
  | 95 | 96 | } |
  | 96 |  | $wpdb->delete($wpdb->prefix.'wppm\_task',array('project'=>~~$proj\_id~~)); |
  | 97 |  | $wpdb->delete($wpdb->prefix.'wppm\_task\_meta',array('task\_id'=>~~$task->id~~)); |
  | 98 |  | $wpdb->delete($wpdb->prefix.'wppm\_task\_comment',array('task\_id'=>~~$task->id~~)); |
  | 99 |  | $wpdb->delete($wpdb->prefix.'wppm\_task\_comment\_meta',array('task\_id'=>~~$task->id~~)); |
  |  | 97 | $wpdb->delete($wpdb->prefix.'wppm\_task',array('project'=>esc\_sql($proj\_id))); |
  |  | 98 | $wpdb->delete($wpdb->prefix.'wppm\_task\_meta',array('task\_id'=>esc\_sql($task->id))); |
  |  | 99 | $wpdb->delete($wpdb->prefix.'wppm\_task\_comment',array('task\_id'=>esc\_sql($task->id))); |
  |  | 100 | $wpdb->delete($wpdb->prefix.'wppm\_task\_comment\_meta',array('task\_id'=>esc\_sql($task->id))); |
  | 100 | 101 | } |
  | 101 | 102 | } |
* ## [taskbuilder/trunk/includes/admin/projects/wppm\_set\_delete\_project.php](/changeset/3210469/taskbuilder/trunk/includes/admin/projects/wppm_set_delete_project.php "Show the changeset 3210469 restricted to taskbuilder/trunk/includes/admin/projects/wppm_set_delete_project.php")

  | [r3174963](/browser/taskbuilder/trunk/includes/admin/projects/wppm_set_delete_project.php?rev=3174963#L6 "Show revision 3174963 of this file in browser") | [r3210469](/browser/taskbuilder/trunk/includes/admin/projects/wppm_set_delete_project.php?rev=3210469#L6 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 6 | 6 | global $current\_user, $wppmfunction ,$wpdb; |
  | 7 | 7 | $project\_id  = isset($\_POST['project\_id']) ? intval(sanitize\_text\_field($\_POST['project\_id'])) : 0 ; |
  | 8 |  | $project = $wpdb->get\_row( "SELECT \* FROM {$wpdb->prefix}wppm\_project where id = '~~$project\_id~~'" ); |
  |  | 8 | $project = $wpdb->get\_row( "SELECT \* FROM {$wpdb->prefix}wppm\_project where id = '".esc\_sql($project\_id)."'" ); |
  | 9 | 9 | $wppm\_current\_user\_capability = get\_user\_meta( $current\_user->ID, 'wppm\_capability', true ); |
  | 10 | 10 | if (!(($current\_user->ID && $current\_user->has\_cap('manage\_options')) || $wppmfunction->has\_project\_permission('delete\_project',$project\_id) || ($project->created\_by==$current\_user->ID && $wppm\_current\_user\_capability == 'wppm\_manager') || ($current\_user->ID && $current\_user->has\_cap('wppm\_admin')))) {exit;} |
  | […](/browser/taskbuilder/trunk/includes/admin/projects/wppm_set_delete_project.php?rev=3174963#L14) | […](/browser/taskbuilder/trunk/includes/admin/projects/wppm_set_delete_project.php?rev=3210469#L14) |  |
  | 14 | 14 | } |
  | 15 | 15 |  |
  | 16 |  | $tasks = $wpdb->get\_results("SELECT \* FROM {$wpdb->prefix}wppm\_task where project = '~~$project\_id'"~~); |
  |  | 16 | $tasks = $wpdb->get\_results("SELECT \* FROM {$wpdb->prefix}wppm\_task where project = '".esc\_sql($project\_id)."'" ); |
  | 17 | 17 | /\*\*\*\*\*\*\*\*\*\*\*\*\*delete project\*\*\*\*\*\*\*\*/ |
  | 18 | 18 | $wpdb->delete($wpdb->prefix.'wppm\_project',array('id'=>"$project\_id")); |
  | 19 | 19 |  |
  | 20 | 20 | /\*\*\*\*\*\*\*\*\*\*\*\*\*delete project comment\*\*\*\*\*\*\*\*/ |
  | 21 |  | $sql="SELECT attachment\_ids FROM {$wpdb->prefix}wppm\_project\_comment WHERE proj\_id =~~".$project\_id~~; |
  |  | 21 | $sql="SELECT attachment\_ids FROM {$wpdb->prefix}wppm\_project\_comment WHERE proj\_id ='".esc\_sql($project\_id)."'" ; |
  | 22 | 22 | $proj\_comm\_attachment\_ids= $wpdb->get\_results( $sql ); |
  | 23 | 23 | if(!empty($proj\_comm\_attachment\_ids)){ |
  | […](/browser/taskbuilder/trunk/includes/admin/projects/wppm_set_delete_project.php?rev=3174963#L28) | […](/browser/taskbuilder/trunk/includes/admin/projects/wppm_set_delete_project.php?rev=3210469#L28) |  |
  | 28 | 28 | } |
  | 29 | 29 | foreach ($proj\_attachment\_ids\_temp as $proj\_attachment\_id){ |
  | 30 |  | $sql="SELECT \* FROM {$wpdb->prefix}wppm\_attachments WHERE id =".$proj\_attachment\_id; |
  |  | 30 | $proj\_attachment\_id = esc\_sql($proj\_attachment\_id); |
  |  | 31 | $sql="SELECT \* FROM {$wpdb->prefix}wppm\_attachments WHERE id ='$proj\_attachment\_id'"; |
  | 31 | 32 | $att\_result=$wpdb->get\_row($sql); |
  | 32 | 33 | if(!empty($att\_result)){ |
  | 33 |  | $sql\_query="SELECT file\_path FROM {$wpdb->prefix}wppm\_attachments WHERE file\_path ='".~~$att\_result->file\_path~~."'"; |
  |  | 34 | $sql\_query="SELECT file\_path FROM {$wpdb->prefix}wppm\_attachments WHERE file\_path ='".esc\_sql($att\_result->file\_path)."'"; |
  | 34 | 35 | $proj\_attach\_result=$wpdb->get\_results($sql\_query); |
  | 35 | 36 | $proj\_result\_count = count($proj\_attach\_result); |
  | […](/browser/taskbuilder/trunk/includes/admin/projects/wppm_set_delete_project.php?rev=3174963#L38) | […](/browser/taskbuilder/trunk/includes/admin/projects/wppm_set_delete_project.php?rev=3210469#L39) |  |
  | 38 | 39 | unlink($att\_result->file\_path); |
  | 39 | 40 | } |
  | 40 |  | $wpdb->delete($wpdb->prefix.'wppm\_attachments', array( 'id' => ~~$proj\_attachment\_id~~)); |
  |  | 41 | $wpdb->delete($wpdb->prefix.'wppm\_attachments', array( 'id' => "$proj\_attachment\_id")); |
  | 41 | 42 | } |
  | 42 | 43 | } |
  | 43 | 44 | } |
  | 44 | 45 | } |
  | 45 |  | $wpdb->delete($wpdb->prefix.'wppm\_project\_comment',array('proj\_id'=>~~$project\_id~~)); |
  | 46 |  | $wpdb->delete($wpdb->prefix.'wppm\_project\_meta',array('project\_id'=>~~$project\_id~~)); |
  | 47 |  | $wpdb->delete($wpdb->prefix.'wppm\_project\_comment\_meta',array('proj\_id'=>~~$project\_id~~)); |
  |  | 46 | $wpdb->delete($wpdb->prefix.'wppm\_project\_comment',array('proj\_id'=>esc\_sql($project\_id))); |
  |  | 47 | $wpdb->delete($wpdb->prefix.'wppm\_project\_meta',array('project\_id'=>esc\_sql($project\_id))); |
  |  | 48 | $wpdb->delete($wpdb->prefix.'wppm\_project\_comment\_meta',array('proj\_id'=>esc\_sql($project\_id))); |
  | 48 | 49 |  |
  | 49 | 50 | /\*\*\*\*\*\*\*\*\*\*\*\*\*delete project's tasks and comments\*\*\*\*\*\*\*\*/ |
  | 50 | 51 | foreach($tasks as $task){ |
  | 51 |  | $sql="SELECT attachment\_ids FROM {$wpdb->prefix}wppm\_task\_comment WHERE task\_id =~~".esc\_sql($task->id)~~; |
  |  | 52 | $sql="SELECT attachment\_ids FROM {$wpdb->prefix}wppm\_task\_comment WHERE task\_id ='".esc\_sql($task->id)."'"; |
  | 52 | 53 | $thread\_attachment\_ids= $wpdb->get\_results( $sql ); |
  | 53 | 54 | $tid = esc\_sql($task->id); |
  | […](/browser/taskbuilder/trunk/includes/admin/projects/wppm_set_delete_project.php?rev=3174963#L61) | […](/browser/taskbuilder/trunk/includes/admin/projects/wppm_set_delete_project.php?rev=3210469#L62) |  |
  | 61 | 62 | //$attachment\_ids=$attachment\_ids\_temp; |
  | 62 | 63 | foreach ($attachment\_ids\_temp as $attachment\_id){ |
  | 63 |  | $attachment\_id = esc\_sql($attachment\_id); |
  | 64 |  | $sql="SELECT \* FROM {$wpdb->prefix}wppm\_attachments WHERE id = '$attachment\_id'"; |
  |  | 64 | $sql="SELECT \* FROM {$wpdb->prefix}wppm\_attachments WHERE id = '".esc\_sql($attachment\_id)."'"; |
  | 65 | 65 | $result=$wpdb->get\_row($sql); |
  | 66 | 66 | if(!empty($result)){ |
  | […](/browser/taskbuilder/trunk/includes/admin/projects/wppm_set_delete_project.php?rev=3174963#L72) | […](/browser/taskbuilder/trunk/includes/admin/projects/wppm_set_delete_project.php?rev=3210469#L72) |  |
  | 72 | 72 | unlink($result->file\_path); |
  | 73 | 73 | } |
  | 74 |  | $wpdb->delete($wpdb->prefix.'wppm\_attachments', array( 'id' => ~~$attachment\_id~~)); |
  |  | 74 | $wpdb->delete($wpdb->prefix.'wppm\_attachments', array( 'id' => esc\_sql($attachment\_id))); |
  | 75 | 75 | } |
  | 76 | 76 | } |
  | […](/browser/taskbuilder/trunk/includes/admin/projects/wppm_set_delete_project.php?rev=3174963#L78) | […](/browser/taskbuilder/trunk/includes/admin/projects/wppm_set_delete_project.php?rev=3210469#L78) |  |
  | 78 | 78 | } |
  | 79 | 79 | /\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*Code for deleting checklists\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*/ |
  | 80 |  | $sql="SELECT id FROM {$wpdb->prefix}wppm\_checklist WHERE task\_id = '~~$tid~~'"; |
  |  | 80 | $sql="SELECT id FROM {$wpdb->prefix}wppm\_checklist WHERE task\_id = '".($tid)."'"; |
  | 81 | 81 | $checklists = $wpdb->get\_results( $sql ); |
  | 82 | 82 | if(!empty($checklists)){ |
  | […](/browser/taskbuilder/trunk/includes/admin/projects/wppm_set_delete_project.php?rev=3174963#L96) | […](/browser/taskbuilder/trunk/includes/admin/projects/wppm_set_delete_project.php?rev=3210469#L96) |  |
  | 96 | 96 | } |
  | 97 | 97 | } |
  | 98 |  | $wpdb->delete($wpdb->prefix.'wppm\_task',array('project'=>~~$project\_id~~)); |
  |  | 98 | $wpdb->delete($wpdb->prefix.'wppm\_task',array('project'=>esc\_sql($project\_id))); |
  | 99 | 99 | $wpdb->delete($wpdb->prefix.'wppm\_task\_meta',array('task\_id'=>$tid)); |
  | 100 | 100 | $wpdb->delete($wpdb->prefix.'wppm\_task\_comment',array('task\_id'=>$tid)); |
* ## [taskbuilder/trunk/includes/admin/projects/wppm\_set\_project\_meta.php](/changeset/3210469/taskbuilder/trunk/includes/admin/projects/wppm_set_project_meta.php "Show the changeset 3210469 restricted to taskbuilder/trunk/includes/admin/projects/wppm_set_project_meta.php")

  | [r3174963](/browser/taskbuilder/trunk/includes/admin/projects/wppm_set_project_meta.php?rev=3174963#L12 "Show revision 3174963 of this file in browser") | [r3210469](/browser/taskbuilder/trunk/includes/admin/projects/wppm_set_project_meta.php?rev=3210469#L12 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 12 | 12 | if(!empty($user)){ |
  | 13 | 13 | $user\_role = sanitize\_text\_field($\_POST['wppm\_select\_user\_role\_'.$user]); |
  | 14 |  | $user = esc\_sql($user); |
  | 15 |  | $project\_user = $wpdb->get\_row("SELECT \* FROM {$wpdb->prefix}wppm\_project\_users WHERE proj\_id = '$project\_id' AND user\_id = '$user'"); |
  |  | 14 | $project\_user = $wpdb->get\_row("SELECT \* FROM {$wpdb->prefix}wppm\_project\_users WHERE proj\_id = '".esc\_sql($project\_id)."' AND user\_id = '".esc\_sql($user)."'"); |
  | 16 | 15 | if(!empty($project\_user)){ |
  | 17 | 16 | $project\_user\_id = esc\_sql($project\_user->id); |
  | 18 |  | ~~$user\_role = esc\_sql($user\_role);~~ |
  | 19 | 17 | $values=array( |
  | 20 |  | 'role\_id'=> ~~$user\_role~~, |
  | 21 |  | 'assigned\_by'=>esc\_sql($current\_user->ID) |
  |  | 18 | 'role\_id'=> esc\_sql($user\_role), |
  |  | 19 | 'assigned\_by'=>esc\_sql($current\_user->ID) |
  | 22 | 20 | ); |
  | 23 | 21 | $wpdb->update($wpdb->prefix.'wppm\_project\_users', $values, array('id'=>$project\_user\_id)); |
  | […](/browser/taskbuilder/trunk/includes/admin/projects/wppm_set_project_meta.php?rev=3174963#L26) | […](/browser/taskbuilder/trunk/includes/admin/projects/wppm_set_project_meta.php?rev=3210469#L24) |  |
  | 26 | 24 | $wpdb->prefix . 'wppm\_project\_users', |
  | 27 | 25 | array( |
  | 28 |  | 'proj\_id' => ~~$project\_id~~, |
  | 29 |  | 'user\_id' => ~~$user~~, |
  | 30 |  | 'role\_id' => ~~$user\_role~~, |
  | 31 |  | 'assigned\_by' =>esc\_sql($current\_user->ID) |
  |  | 26 | 'proj\_id' => esc\_sql($project\_id), |
  |  | 27 | 'user\_id' => esc\_sql($user), |
  |  | 28 | 'role\_id' => esc\_sql($user\_role), |
  |  | 29 | 'assigned\_by' =>esc\_sql($current\_user->ID) |
  | 32 | 30 | ) ); |
  | 33 | 31 | } |
* ## [taskbuilder/trunk/includes/admin/settings/wppm\_delete\_category.php](/changeset/3210469/taskbuilder/trunk/includes/admin/settings/wppm_delete_category.php "Show the changeset 3210469 restricted to taskbuilder/trunk/includes/admin/settings/wppm_delete_category.php")

  | [r3174963](/browser/taskbuilder/trunk/includes/admin/settings/wppm_delete_category.php?rev=3174963#L10 "Show revision 3174963 of this file in browser") | [r3210469](/browser/taskbuilder/trunk/includes/admin/settings/wppm_delete_category.php?rev=3210469#L10 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 10 | 10 | } |
  | 11 | 11 | $cat\_id = isset($\_POST) && isset($\_POST['cat\_id']) ? intval(sanitize\_text\_field($\_POST['cat\_id'])) : 0; |
  |  | 12 | $cat\_id = esc\_sql($cat\_id); |
  | 12 | 13 | if (!$cat\_id) {exit;} |
  | 13 | 14 |  |
* ## [taskbuilder/trunk/includes/admin/settings/wppm\_delete\_status.php](/changeset/3210469/taskbuilder/trunk/includes/admin/settings/wppm_delete_status.php "Show the changeset 3210469 restricted to taskbuilder/trunk/includes/admin/settings/wppm_delete_status.php")

  | [r3174963](/browser/taskbuilder/trunk/includes/admin/settings/wppm_delete_status.php?rev=3174963#L11 "Show revision 3174963 of this file in browser") | [r3210469](/browser/taskbuilder/trunk/includes/admin/settings/wppm_delete_status.php?rev=3210469#L11 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 11 | 11 | $status\_id = isset($\_POST) && isset($\_POST['status\_id']) ? intval(sanitize\_text\_field($\_POST['status\_id'])) : 0; |
  | 12 | 12 | if (!$status\_id) {exit;} |
  | 13 |  |  |
  |  | 13 | $status\_id = esc\_sql($status\_id); |
  | 14 | 14 | $wpdb->delete($wpdb->prefix.'wppm\_project\_statuses', array( 'id' => "$status\_id")); |
* ## [taskbuilder/trunk/includes/admin/settings/wppm\_delete\_task\_priority.php](/changeset/3210469/taskbuilder/trunk/includes/admin/settings/wppm_delete_task_priority.php "Show the changeset 3210469 restricted to taskbuilder/trunk/includes/admin/settings/wppm_delete_task_priority.php")

  | [r3174963](/browser/taskbuilder/trunk/includes/admin/settings/wppm_delete_task_priority.php?rev=3174963#L12 "Show revision 3174963 of this file in browser") | [r3210469](/browser/taskbuilder/trunk/includes/admin/settings/wppm_delete_task_priority.php?rev=3210469#L12 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 12 | 12 | $priority\_id = isset($\_POST) && isset($\_POST['priority\_id']) ? intval(sanitize\_text\_field($\_POST['priority\_id'])) : 0; |
  | 13 | 13 | if (!$priority\_id) {exit;} |
  |  | 14 | $priority\_id = esc\_sql($priority\_id); |
  | 14 | 15 |  |
  | 15 | 16 | $wpdb->delete($wpdb->prefix.'wppm\_task\_priorities', array( 'id' => "$priority\_id")); |
* ## [taskbuilder/trunk/includes/admin/settings/wppm\_delete\_task\_status.php](/changeset/3210469/taskbuilder/trunk/includes/admin/settings/wppm_delete_task_status.php "Show the changeset 3210469 restricted to taskbuilder/trunk/includes/admin/settings/wppm_delete_task_status.php")

  | [r3174963](/browser/taskbuilder/trunk/includes/admin/settings/wppm_delete_task_status.php?rev=3174963#L12 "Show revision 3174963 of this file in browser") | [r3210469](/browser/taskbuilder/trunk/includes/admin/settings/wppm_delete_task_status.php?rev=3210469#L12 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 12 | 12 | $status\_id = isset($\_POST) && isset($\_POST['status\_id']) ? intval(sanitize\_text\_field($\_POST['status\_id'])) : 0; |
  | 13 | 13 | if (!$status\_id) {exit;} |
  |  | 14 | $status\_id = esc\_sql($status\_id); |
  | 14 | 15 |  |
  | 15 | 16 | $wpdb->delete($wpdb->prefix.'wppm\_task\_statuses', array( 'id' => "$status\_id")); |
* ## [taskbuilder/trunk/includes/admin/settings/wppm\_get\_category\_settings.php](/changeset/3210469/taskbuilder/trunk/includes/admin/settings/wppm_get_category_settings.php "Show the changeset 3210469 restricted to taskbuilder/trunk/includes/admin/settings/wppm_get_category_settings.php")

  | [r3174963](/browser/taskbuilder/trunk/includes/admin/settings/wppm_get_category_settings.php?rev=3174963#L9 "Show revision 3174963 of this file in browser") | [r3210469](/browser/taskbuilder/trunk/includes/admin/settings/wppm_get_category_settings.php?rev=3210469#L9 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 9 | 9 | } |
  | 10 | 10 | $wppm\_ap\_settings = get\_option("wppm-ap-settings"); |
  | 11 |  | $orderby\_sql = ~~esc\_sql(sanitize\_sql\_orderby( "load\_order ASC" )~~); |
  | 12 |  | $categories = $wpdb->get\_results( "SELECT \* FROM {$wpdb->prefix}wppm\_project\_categories ORDER BY ~~".$orderby\_sql~~ ); |
  |  | 11 | $orderby\_sql = sanitize\_sql\_orderby( "load\_order ASC"); |
  |  | 12 | $categories = $wpdb->get\_results( "SELECT \* FROM {$wpdb->prefix}wppm\_project\_categories ORDER BY $orderby\_sql" ); |
  | 13 | 13 | $cat\_arr = array(); |
  | 14 | 14 | $cat\_arr = $wpdb->get\_results( "SELECT id FROM {$wpdb->prefix}wppm\_project\_categories" ); |
* ## [taskbuilder/trunk/includes/admin/settings/wppm\_get\_edit\_category.php](/changeset/3210469/taskbuilder/trunk/includes/admin/settings/wppm_get_edit_category.php "Show the changeset 3210469 restricted to taskbuilder/trunk/includes/admin/settings/wppm_get_edit_category.php")

  | [r3174963](/browser/taskbuilder/trunk/includes/admin/settings/wppm_get_edit_category.php?rev=3174963#L9 "Show revision 3174963 of this file in browser") | [r3210469](/browser/taskbuilder/trunk/includes/admin/settings/wppm_get_edit_category.php?rev=3210469#L9 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 9 | 9 | $cat\_id = isset($\_POST) && isset($\_POST['cat\_id']) ? intval(sanitize\_text\_field($\_POST['cat\_id'])) : 0; |
  | 10 | 10 | if (!$cat\_id) {exit;} |
  | 11 |  |  |
  | 12 |  | $category = $wpdb->get\_row("SELECT \* FROM {$wpdb->prefix}wppm\_project\_categories WHERE id = '$cat\_id' "); |
  |  | 11 | $category = $wpdb->get\_row("SELECT \* FROM {$wpdb->prefix}wppm\_project\_categories WHERE id = '".esc\_sql($cat\_id)."' "); |
  | 13 | 12 | ob\_start(); |
  | 14 | 13 | ?> |
* ## [taskbuilder/trunk/includes/admin/settings/wppm\_get\_edit\_priority.php](/changeset/3210469/taskbuilder/trunk/includes/admin/settings/wppm_get_edit_priority.php "Show the changeset 3210469 restricted to taskbuilder/trunk/includes/admin/settings/wppm_get_edit_priority.php")

  | [r3174963](/browser/taskbuilder/trunk/includes/admin/settings/wppm_get_edit_priority.php?rev=3174963#L10 "Show revision 3174963 of this file in browser") | [r3210469](/browser/taskbuilder/trunk/includes/admin/settings/wppm_get_edit_priority.php?rev=3210469#L10 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 10 | 10 | $priority\_id = isset($\_POST) && isset($\_POST['priority\_id']) ? intval(sanitize\_text\_field($\_POST['priority\_id'])) : 0; |
  | 11 | 11 | if (!$priority\_id) {exit;} |
  | 12 |  |  |
  | 13 |  | $priority = $wpdb->get\_row("SELECT \* FROM {$wpdb->prefix}wppm\_task\_priorities WHERE id = '$priority\_id' "); |
  |  | 12 | $priority = $wpdb->get\_row("SELECT \* FROM {$wpdb->prefix}wppm\_task\_priorities WHERE id = '".esc\_sql($priority\_id)."' "); |
  | 14 | 13 | ob\_start(); |
  | 15 | 14 | ?> |
* ## [taskbuilder/trunk/includes/admin/settings/wppm\_get\_edit\_proj\_status.php](/changeset/3210469/taskbuilder/trunk/includes/admin/settings/wppm_get_edit_proj_status.php "Show the changeset 3210469 restricted to taskbuilder/trunk/includes/admin/settings/wppm_get_edit_proj_status.php")

  | [r3174963](/browser/taskbuilder/trunk/includes/admin/settings/wppm_get_edit_proj_status.php?rev=3174963#L9 "Show revision 3174963 of this file in browser") | [r3210469](/browser/taskbuilder/trunk/includes/admin/settings/wppm_get_edit_proj_status.php?rev=3210469#L9 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 9 | 9 | $status\_id = isset($\_POST) && isset($\_POST['status\_id']) ? intval(sanitize\_text\_field($\_POST['status\_id'])) : 0; |
  | 10 | 10 | if (!$status\_id) {exit;} |
  | 11 |  |  |
  | 12 |  | $status = $wpdb->get\_row("SELECT \* FROM {$wpdb->prefix}wppm\_project\_statuses WHERE id = '$status\_id' "); |
  |  | 11 | $status = $wpdb->get\_row("SELECT \* FROM {$wpdb->prefix}wppm\_project\_statuses WHERE id = '".esc\_sql($status\_id)."' "); |
  | 13 | 12 | ob\_start(); |
  | 14 | 13 | ?> |
* ## [taskbuilder/trunk/includes/admin/settings/wppm\_get\_edit\_task\_status.php](/changeset/3210469/taskbuilder/trunk/includes/admin/settings/wppm_get_edit_task_status.php "Show the changeset 3210469 restricted to taskbuilder/trunk/includes/admin/settings/wppm_get_edit_task_status.php")

  | [r3174963](/browser/taskbuilder/trunk/includes/admin/settings/wppm_get_edit_task_status.php?rev=3174963#L10 "Show revision 3174963 of this file in browser") | [r3210469](/browser/taskbuilder/trunk/includes/admin/settings/wppm_get_edit_task_status.php?rev=3210469#L10 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 10 | 10 | $status\_id = isset($\_POST) && isset($\_POST['status\_id']) ? intval(sanitize\_text\_field($\_POST['status\_id'])) : 0; |
  | 11 | 11 | if (!$status\_id) {exit;} |
  | 12 |  |  |
  | 13 |  | $status = $wpdb->get\_row("SELECT \* FROM {$wpdb->prefix}wppm\_task\_statuses WHERE id = '$status\_id' "); |
  |  | 12 | $status = $wpdb->get\_row("SELECT \* FROM {$wpdb->prefix}wppm\_task\_statuses WHERE id =  '".esc\_sql($status\_id)."' "); |
  | 14 | 13 | ob\_start(); |
  | 15 | 14 | ?> |
* ## [taskbuilder/trunk/includes/admin/settings/wppm\_get\_priority\_settings.php](/changeset/3210469/taskbuilder/trunk/includes/admin/settings/wppm_get_priority_settings.php "Show the changeset 3210469 restricted to taskbuilder/trunk/includes/admin/settings/wppm_get_priority_settings.php")

  | [r3174963](/browser/taskbuilder/trunk/includes/admin/settings/wppm_get_priority_settings.php?rev=3174963#L8 "Show revision 3174963 of this file in browser") | [r3210469](/browser/taskbuilder/trunk/includes/admin/settings/wppm_get_priority_settings.php?rev=3210469#L8 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 8 | 8 | exit; |
  | 9 | 9 | } |
  | 10 |  | $orderby\_sql = esc\_sql(sanitize\_sql\_orderby( "load\_order ASC")); |
  | 11 |  | $priorities = $wpdb->get\_results( "SELECT \* FROM {$wpdb->prefix}wppm\_task\_priorities ORDER BY ~~".$orderby\_sql~~ ); |
  |  | 10 | $orderby\_sql = esc\_sql(sanitize\_sql\_orderby( "load\_order ASC")); |
  |  | 11 | $priorities = $wpdb->get\_results( "SELECT \* FROM {$wpdb->prefix}wppm\_task\_priorities ORDER BY $orderby\_sql" ); |
  | 12 | 12 | $priority\_arr = $wpdb->get\_results( "SELECT id FROM {$wpdb->prefix}wppm\_task\_priorities" ); |
  | 13 | 13 | $priority\_ids = array(); |
* ## [taskbuilder/trunk/includes/admin/settings/wppm\_get\_proj\_status\_settings.php](/changeset/3210469/taskbuilder/trunk/includes/admin/settings/wppm_get_proj_status_settings.php "Show the changeset 3210469 restricted to taskbuilder/trunk/includes/admin/settings/wppm_get_proj_status_settings.php")

  | [r3174963](/browser/taskbuilder/trunk/includes/admin/settings/wppm_get_proj_status_settings.php?rev=3174963#L14 "Show revision 3174963 of this file in browser") | [r3210469](/browser/taskbuilder/trunk/includes/admin/settings/wppm_get_proj_status_settings.php?rev=3210469#L14 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 14 | 14 | } |
  | 15 | 15 | $wppm\_ap\_settings = get\_option("wppm-ap-settings"); |
  | 16 |  | $orderby\_sql = esc\_sql(sanitize\_sql\_orderby( "load\_order ASC")); |
  | 17 |  | $statuses = $wpdb->get\_results( "SELECT \* FROM {$wpdb->prefix}wppm\_project\_statuses ORDER BY ~~".$orderby\_sql~~ ); |
  |  | 16 | $orderby\_sql = esc\_sql(sanitize\_sql\_orderby( "load\_order ASC")); |
  |  | 17 | $statuses = $wpdb->get\_results( "SELECT \* FROM {$wpdb->prefix}wppm\_project\_statuses ORDER BY $orderby\_sql" ); |
  | 18 | 18 | $status\_arr = $wpdb->get\_results( "SELECT id FROM {$wpdb->prefix}wppm\_project\_statuses" ); |
  | 19 | 19 | $status\_ids =array(); |
* ## [taskbuilder/trunk/includes/admin/settings/wppm\_get\_task\_status\_settings.php](/changeset/3210469/taskbuilder/trunk/includes/admin/settings/wppm_get_task_status_settings.php "Show the changeset 3210469 restricted to taskbuilder/trunk/includes/admin/settings/wppm_get_task_status_settings.php")

  | [r3174963](/browser/taskbuilder/trunk/includes/admin/settings/wppm_get_task_status_settings.php?rev=3174963#L13 "Show revision 3174963 of this file in browser") | [r3210469](/browser/taskbuilder/trunk/includes/admin/settings/wppm_get_task_status_settings.php?rev=3210469#L13 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 13 | 13 | exit; |
  | 14 | 14 | } |
  | 15 |  | $orderby\_sql = esc\_sql(sanitize\_sql\_orderby( "load\_order ASC")); |
  | 16 |  | $statuses = $wpdb->get\_results( "SELECT \* FROM {$wpdb->prefix}wppm\_task\_statuses ORDER BY ~~".$orderby\_sql~~ ); |
  |  | 15 | $orderby\_sql = esc\_sql(sanitize\_sql\_orderby( "load\_order ASC")); |
  |  | 16 | $statuses = $wpdb->get\_results( "SELECT \* FROM {$wpdb->prefix}wppm\_task\_statuses ORDER BY $orderby\_sql" ); |
  | 17 | 17 | $status\_arr = $wpdb->get\_results( "SELECT id FROM {$wpdb->prefix}wppm\_task\_statuses" ); |
  | 18 | 18 | $status\_ids=array(); |
* ## [taskbuilder/trunk/includes/admin/settings/wppm\_set\_add\_category.php](/changeset/3210469/taskbuilder/trunk/includes/admin/settings/wppm_set_add_category.php "Show the changeset 3210469 restricted to taskbuilder/trunk/includes/admin/settings/wppm_set_add_category.php")

  | [r3174963](/browser/taskbuilder/trunk/includes/admin/settings/wppm_set_add_category.php?rev=3174963#L13 "Show revision 3174963 of this file in browser") | [r3210469](/browser/taskbuilder/trunk/includes/admin/settings/wppm_set_add_category.php?rev=3210469#L13 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 13 | 13 | if (!$cat\_name) {exit;} |
  | 14 | 14 | $load\_order = $wpdb->get\_var("select max(load\_order) from {$wpdb->prefix}wppm\_project\_categories"); |
  | 15 |  | $load\_order = isset($load\_order) ? ~~esc\_sql($load\_order)~~: ""; |
  |  | 15 | $load\_order = isset($load\_order) ? $load\_order: ""; |
  | 16 | 16 | $values=array( |
  | 17 |  | 'name'=>~~sanitize\_text\_field($\_POST['cat\_name']~~), |
  | 18 |  | 'load\_order'=> ~~++$load\_order~~ |
  |  | 17 | 'name'=>esc\_sql($cat\_name), |
  |  | 18 | 'load\_order'=> esc\_sql(++$load\_order) |
  | 19 | 19 | ); |
  | 20 | 20 | $wpdb->insert($wpdb->prefix.'wppm\_project\_categories',$values); |
* ## [taskbuilder/trunk/includes/admin/settings/wppm\_set\_category\_order.php](/changeset/3210469/taskbuilder/trunk/includes/admin/settings/wppm_set_category_order.php "Show the changeset 3210469 restricted to taskbuilder/trunk/includes/admin/settings/wppm_set_category_order.php")

  | [r3174963](/browser/taskbuilder/trunk/includes/admin/settings/wppm_set_category_order.php?rev=3174963#L12 "Show revision 3174963 of this file in browser") | [r3210469](/browser/taskbuilder/trunk/includes/admin/settings/wppm_set_category_order.php?rev=3210469#L12 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 12 | 12 | $load\_orders = $wppmfunction->sanitize\_array($load\_orders); |
  | 13 | 13 | } |
  | 14 |  | ~~$categories = $wpdb->get\_results( "SELECT id FROM {$wpdb->prefix}wppm\_project\_categories");~~ |
  | 15 |  |  |
  | 16 | 14 | if (is\_array($load\_orders)) { |
  | 17 | 15 | foreach($load\_orders as $key=>$val){ |
  | 18 |  | $result = $wpdb->query("UPDATE ".$wpdb->prefix."wppm\_project\_categories SET load\_order=". esc\_sql($val)." WHERE id=~~".esc\_sql($key)~~ ); |
  |  | 16 | $result = $wpdb->query("UPDATE ".$wpdb->prefix."wppm\_project\_categories SET load\_order=". esc\_sql($val)." WHERE id='".esc\_sql($key)."'" ); |
  | 19 | 17 | } |
  | 20 | 18 | } |
* ## [taskbuilder/trunk/includes/admin/settings/wppm\_set\_edit\_category.php](/changeset/3210469/taskbuilder/trunk/includes/admin/settings/wppm_set_edit_category.php "Show the changeset 3210469 restricted to taskbuilder/trunk/includes/admin/settings/wppm_set_edit_category.php")

  | [r3174963](/browser/taskbuilder/trunk/includes/admin/settings/wppm_set_edit_category.php?rev=3174963#L11 "Show revision 3174963 of this file in browser") | [r3210469](/browser/taskbuilder/trunk/includes/admin/settings/wppm_set_edit_category.php?rev=3210469#L11 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 11 | 11 |  |
  | 12 | 12 | $cat\_id = isset($\_POST) && isset($\_POST['cat\_id']) ? intval(sanitize\_text\_field($\_POST['cat\_id'])) : 0; |
  |  | 13 | $cat\_id = esc\_sql($cat\_id); |
  | 13 | 14 | if (!$cat\_id) {exit;} |
  | 14 | 15 |  |
  | […](/browser/taskbuilder/trunk/includes/admin/settings/wppm_set_edit_category.php?rev=3174963#L17) | […](/browser/taskbuilder/trunk/includes/admin/settings/wppm_set_edit_category.php?rev=3210469#L18) |  |
  | 17 | 18 |  |
  | 18 | 19 | $values= array( |
  | 19 |  | 'name'=>~~$cat\_name~~ |
  |  | 20 | 'name'=>esc\_sql($cat\_name) |
  | 20 | 21 | ); |
  | 21 | 22 | $wpdb->update($wpdb->prefix.'wppm\_project\_categories',$values,array('id'=>("$cat\_id"))); |
* ## [taskbuilder/trunk/includes/admin/settings/wppm\_set\_edit\_priority.php](/changeset/3210469/taskbuilder/trunk/includes/admin/settings/wppm_set_edit_priority.php "Show the changeset 3210469 restricted to taskbuilder/trunk/includes/admin/settings/wppm_set_edit_priority.php")

  | [r3174963](/browser/taskbuilder/trunk/includes/admin/settings/wppm_set_edit_priority.php?rev=3174963#L15 "Show revision 3174963 of this file in browser") | [r3210469](/browser/taskbuilder/trunk/includes/admin/settings/wppm_set_edit_priority.php?rev=3210469#L15 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 15 | 15 | $priority\_id = isset($\_POST) && isset($\_POST['priority\_id']) ? intval(sanitize\_text\_field($\_POST['priority\_id'])) : ''; |
  | 16 | 16 | if (!$priority\_id) {exit;} |
  |  | 17 | $priority\_id = esc\_sql($priority\_id); |
  | 17 | 18 |  |
  | 18 | 19 | $priority\_name = isset($\_POST) && isset($\_POST['priority\_name']) ? sanitize\_text\_field($\_POST['priority\_name']) : ''; |
* ## [taskbuilder/trunk/includes/admin/settings/wppm\_set\_edit\_status.php](/changeset/3210469/taskbuilder/trunk/includes/admin/settings/wppm_set_edit_status.php "Show the changeset 3210469 restricted to taskbuilder/trunk/includes/admin/settings/wppm_set_edit_status.php")

  | [r3174963](/browser/taskbuilder/trunk/includes/admin/settings/wppm_set_edit_status.php?rev=3174963#L13 "Show revision 3174963 of this file in browser") | [r3210469](/browser/taskbuilder/trunk/includes/admin/settings/wppm_set_edit_status.php?rev=3210469#L13 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 13 | 13 | $status\_id = isset($\_POST) && isset($\_POST['status\_id']) ? intval(sanitize\_text\_field($\_POST['status\_id'])) : ''; |
  | 14 | 14 | if (!$status\_id) {exit;} |
  |  | 15 | $status\_id = esc\_sql($status\_id); |
  | 15 | 16 | $status\_name = isset($\_POST) && isset($\_POST['status\_name']) ? sanitize\_text\_field($\_POST['status\_name']) : ''; |
  | 16 | 17 | if (!$status\_name) {exit;} |
* ## [taskbuilder/trunk/includes/admin/settings/wppm\_set\_edit\_task\_status.php](/changeset/3210469/taskbuilder/trunk/includes/admin/settings/wppm_set_edit_task_status.php "Show the changeset 3210469 restricted to taskbuilder/trunk/includes/admin/settings/wppm_set_edit_task_status.php")

  | [r3174963](/browser/taskbuilder/trunk/includes/admin/settings/wppm_set_edit_task_status.php?rev=3174963#L13 "Show revision 3174963 of this file in browser") | [r3210469](/browser/taskbuilder/trunk/includes/admin/settings/wppm_set_edit_task_status.php?rev=3210469#L13 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 13 | 13 | $status\_id = isset($\_POST) && isset($\_POST['status\_id']) ? intval(sanitize\_text\_field($\_POST['status\_id'])) : ''; |
  | 14 | 14 | if (!$status\_id) {exit;} |
  |  | 15 | $status\_id = esc\_sql($status\_id); |
  | 15 | 16 |  |
  | 16 | 17 | $status\_name = isset($\_POST) && isset($\_POST['status\_name']) ? sanitize\_text\_field($\_POST['status\_name']) : ''; |
* ## [taskbuilder/trunk/includes/admin/settings/wppm\_set\_priority\_order.php](/changeset/3210469/taskbuilder/trunk/includes/admin/settings/wppm_set_priority_order.php "Show the changeset 3210469 restricted to taskbuilder/trunk/includes/admin/settings/wppm_set_priority_order.php")

  | [r3174963](/browser/taskbuilder/trunk/includes/admin/settings/wppm_set_priority_order.php?rev=3174963#L14 "Show revision 3174963 of this file in browser") | [r3210469](/browser/taskbuilder/trunk/includes/admin/settings/wppm_set_priority_order.php?rev=3210469#L14 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 14 | 14 | if (is\_array($load\_orders)) { |
  | 15 | 15 | foreach($load\_orders as $key=>$val){ |
  | 16 |  | $result = $wpdb->query("UPDATE ".$wpdb->prefix."wppm\_task\_priorities SET load\_order=~~". esc\_sql($val)." WHERE id=".esc\_sql($key)~~ ); |
  |  | 16 | $result = $wpdb->query("UPDATE ".$wpdb->prefix."wppm\_task\_priorities SET load\_order='". esc\_sql($val)."' WHERE id='".esc\_sql($key)."'" ); |
  | 17 | 17 | } |
  | 18 | 18 | } |
* ## [taskbuilder/trunk/includes/admin/settings/wppm\_set\_status\_order.php](/changeset/3210469/taskbuilder/trunk/includes/admin/settings/wppm_set_status_order.php "Show the changeset 3210469 restricted to taskbuilder/trunk/includes/admin/settings/wppm_set_status_order.php")

  | [r3174963](/browser/taskbuilder/trunk/includes/admin/settings/wppm_set_status_order.php?rev=3174963#L13 "Show revision 3174963 of this file in browser") | [r3210469](/browser/taskbuilder/trunk/includes/admin/settings/wppm_set_status_order.php?rev=3210469#L13 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 13 | 13 | if (is\_array($load\_orders)) { |
  | 14 | 14 | foreach($load\_orders as $key=>$val){ |
  | 15 |  | $result = $wpdb->query("UPDATE ".$wpdb->prefix."wppm\_project\_statuses SET load\_order=~~". esc\_sql($val)." WHERE id=".esc\_sql($key)~~ ); |
  |  | 15 | $result = $wpdb->query("UPDATE ".$wpdb->prefix."wppm\_project\_statuses SET load\_order='".esc\_sql($val)."' WHERE id='".esc\_sql($key)."'" ); |
  | 16 | 16 | } |
  | 17 | 17 | } |
* ## [taskbuilder/trunk/includes/admin/settings/wppm\_set\_task\_status\_order.php](/changeset/3210469/taskbuilder/trunk/includes/admin/settings/wppm_set_task_status_order.php "Show the changeset 3210469 restricted to taskbuilder/trunk/includes/admin/settings/wppm_set_task_status_order.php")

  | [r3174963](/browser/taskbuilder/trunk/includes/admin/settings/wppm_set_task_status_order.php?rev=3174963#L13 "Show revision 3174963 of this file in browser") | [r3210469](/browser/taskbuilder/trunk/includes/admin/settings/wppm_set_task_status_order.php?rev=3210469#L13 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 13 | 13 | if (is\_array($load\_orders)) { |
  | 14 | 14 | foreach($load\_orders as $key=>$val){ |
  | 15 |  | $result = $wpdb->query("UPDATE ".$wpdb->prefix."wppm\_task\_statuses SET load\_order=~~". esc\_sql($val)." WHERE id=".esc\_sql($key)~~ ); |
  |  | 15 | $result = $wpdb->query("UPDATE ".$wpdb->prefix."wppm\_task\_statuses SET load\_order='".esc\_sql($val)."' WHERE id='".esc\_sql($key)."'"); |
  | 16 | 16 | } |
  | 17 | 17 | } |
* ## [taskbuilder/trunk/includes/admin/tasks/open\_task/checklist/wppm\_delete\_checklist.php](/changeset/3210469/taskbuilder/trunk/includes/admin/tasks/open_task/checklist/wppm_delete_checklist.php "Show the changeset 3210469 restricted to taskbuilder/trunk/includes/admin/tasks/open_task/checklist/wppm_delete_checklist.php")

  | [r3174963](/browser/taskbuilder/trunk/includes/admin/tasks/open_task/checklist/wppm_delete_checklist.php?rev=3174963#L11 "Show revision 3174963 of this file in browser") | [r3210469](/browser/taskbuilder/trunk/includes/admin/tasks/open_task/checklist/wppm_delete_checklist.php?rev=3210469#L11 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 11 | 11 | if (!$checklist\_id) {exit;} |
  | 12 | 12 | $checklist\_id = esc\_sql($checklist\_id); |
  | 13 |  | $wpdb->delete($wpdb->prefix.'wppm\_checklist\_items', array( 'checklist\_id' => ~~$checklist\_id~~)); |
  | 14 |  | $wpdb->delete($wpdb->prefix.'wppm\_checklist', array( 'id' => ~~$checklist\_id~~)); |
  |  | 13 | $wpdb->delete($wpdb->prefix.'wppm\_checklist\_items', array( 'checklist\_id' => "$checklist\_id")); |
  |  | 14 | $wpdb->delete($wpdb->prefix.'wppm\_checklist', array( 'id' => "$checklist\_id")); |
  | 15 | 15 |  |
* ## [taskbuilder/trunk/includes/admin/tasks/open\_task/checklist/wppm\_remove\_checklist\_item.php](/changeset/3210469/taskbuilder/trunk/includes/admin/tasks/open_task/checklist/wppm_remove_checklist_item.php "Show the changeset 3210469 restricted to taskbuilder/trunk/includes/admin/tasks/open_task/checklist/wppm_remove_checklist_item.php")

  | [r3174963](/browser/taskbuilder/trunk/includes/admin/tasks/open_task/checklist/wppm_remove_checklist_item.php?rev=3174963#L11 "Show revision 3174963 of this file in browser") | [r3210469](/browser/taskbuilder/trunk/includes/admin/tasks/open_task/checklist/wppm_remove_checklist_item.php?rev=3210469#L11 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 11 | 11 | if (!$item\_id) {exit;} |
  | 12 | 12 | $item\_id = esc\_sql($item\_id); |
  | 13 |  | $wpdb->delete($wpdb->prefix.'wppm\_checklist\_items', array( 'id' => ~~$item\_id~~)); |
  |  | 13 | $wpdb->delete($wpdb->prefix.'wppm\_checklist\_items', array( 'id' => "$item\_id")); |
* ## [taskbuilder/trunk/includes/admin/tasks/open\_task/checklist/wppm\_set\_checklist\_progress.php](/changeset/3210469/taskbuilder/trunk/includes/admin/tasks/open_task/checklist/wppm_set_checklist_progress.php "Show the changeset 3210469 restricted to taskbuilder/trunk/includes/admin/tasks/open_task/checklist/wppm_set_checklist_progress.php")

  | [r3174963](/browser/taskbuilder/trunk/includes/admin/tasks/open_task/checklist/wppm_set_checklist_progress.php?rev=3174963#L10 "Show revision 3174963 of this file in browser") | [r3210469](/browser/taskbuilder/trunk/includes/admin/tasks/open_task/checklist/wppm_set_checklist_progress.php?rev=3210469#L10 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 10 | 10 | if (!$checklist\_id) {exit;} |
  | 11 | 11 | $item\_id = isset($\_POST) && isset($\_POST['item\_id']) ? intval(sanitize\_text\_field($\_POST['item\_id'])) : ''; |
  |  | 12 | $item\_id = esc\_sql($item\_id); |
  | 12 | 13 | if (!$item\_id) {exit;} |
  | 13 | 14 | $checked\_item = isset($\_POST) && isset($\_POST['checked\_item']) ? intval(sanitize\_text\_field($\_POST['checked\_item'])) : ''; |
  | […](/browser/taskbuilder/trunk/includes/admin/tasks/open_task/checklist/wppm_set_checklist_progress.php?rev=3174963#L15) | […](/browser/taskbuilder/trunk/includes/admin/tasks/open_task/checklist/wppm_set_checklist_progress.php?rev=3210469#L16) |  |
  | 15 | 16 | 'checked'=>esc\_sql($checked\_item) |
  | 16 | 17 | ); |
  | 17 |  | $wpdb->update($wpdb->prefix.'wppm\_checklist\_items',$values,array('id'=>intval(~~$item\_id~~))); |
  |  | 18 | $wpdb->update($wpdb->prefix.'wppm\_checklist\_items',$values,array('id'=>intval("$item\_id"))); |
  | 18 | 19 | echo '{ "sucess\_status":"1","messege":"Success" }'; |
* ## [taskbuilder/trunk/includes/admin/tasks/open\_task/wppm\_edit\_task\_details.php](/changeset/3210469/taskbuilder/trunk/includes/admin/tasks/open_task/wppm_edit_task_details.php "Show the changeset 3210469 restricted to taskbuilder/trunk/includes/admin/tasks/open_task/wppm_edit_task_details.php")

  | [r3174963](/browser/taskbuilder/trunk/includes/admin/tasks/open_task/wppm_edit_task_details.php?rev=3174963#L13 "Show revision 3174963 of this file in browser") | [r3210469](/browser/taskbuilder/trunk/includes/admin/tasks/open_task/wppm_edit_task_details.php?rev=3210469#L13 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 13 | 13 | $project\_data = $wppmfunction->get\_project(intval(sanitize\_text\_field($task\_data['project']))); |
  | 14 | 14 | if($current\_user->has\_cap('manage\_options')){ |
  | 15 |  | $projects = $wpdb->get\_results( "SELECT \* FROM {$wpdb->prefix}wppm\_project ORDER BY ~~".$orderby\_proj\_sql~~ ); |
  |  | 15 | $projects = $wpdb->get\_results( "SELECT \* FROM {$wpdb->prefix}wppm\_project ORDER BY $orderby\_proj\_sql" ); |
  | 16 | 16 | }else{ |
  | 17 | 17 | $query = ("SELECT Proj.\* |
  | 18 | 18 | FROM {$wpdb->prefix}wppm\_project AS Proj |
  | 19 | 19 | Left join {$wpdb->prefix}wppm\_project\_meta proj\_meta ON Proj.id = proj\_meta.project\_id |
  | 20 |  | where (FIND\_IN\_SET($current\_user->ID,Proj.users)) OR (Proj.id = proj\_meta.project\_id AND proj\_meta.meta\_key='public\_project' AND proj\_meta.meta\_value=1) Group by Proj.id ORDER BY ~~".$orderby\_proj\_sql~~); |
  |  | 20 | where (FIND\_IN\_SET($current\_user->ID,Proj.users)) OR (Proj.id = proj\_meta.project\_id AND proj\_meta.meta\_key='public\_project' AND proj\_meta.meta\_value=1) Group by Proj.id ORDER BY $orderby\_proj\_sql"); |
  | 21 | 21 | $projects = $wpdb->get\_results($query); |
  | 22 | 22 | } |
* ## [taskbuilder/trunk/includes/admin/tasks/open\_task/wppm\_open\_task.php](/changeset/3210469/taskbuilder/trunk/includes/admin/tasks/open_task/wppm_open_task.php "Show the changeset 3210469 restricted to taskbuilder/trunk/includes/admin/tasks/open_task/wppm_open_task.php")

  | [r3191970](/browser/taskbuilder/trunk/includes/admin/tasks/open_task/wppm_open_task.php?rev=3191970#L18 "Show revision 3191970 of this file in browser") | [r3210469](/browser/taskbuilder/trunk/includes/admin/tasks/open_task/wppm_open_task.php?rev=3210469#L18 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 18 | 18 | $current\_date = date('Y-m-d'); |
  | 19 | 19 | $wppm\_current\_user\_capability = get\_user\_meta( $current\_user->ID, 'wppm\_capability', true ); |
  |  | 20 | $cu\_id = $current\_user->ID; |
  | 20 | 21 | if(!empty($id)){ |
  | 21 |  | $task = $wpdb->get\_row( "SELECT \* FROM {$wpdb->prefix}wppm\_task where id='~~$id~~'"); |
  |  | 22 | $task = $wpdb->get\_row( "SELECT \* FROM {$wpdb->prefix}wppm\_task where id='".esc\_sql($id)."'"); |
  | 22 | 23 | $project\_data = $wppmfunction->get\_project($task->project); |
  |  | 24 | $task\_comment = $wpdb->get\_results( "SELECT \* FROM {$wpdb->prefix}wppm\_task\_comment where task\_id='".esc\_sql($id)."' ORDER BY create\_time DESC"); |
  | 23 | 25 | $orderby\_proj\_sql = esc\_sql(sanitize\_sql\_orderby( "create\_time DESC" )); |
  | 24 |  | $task\_comment = $wpdb->get\_results( "SELECT \* FROM {$wpdb->prefix}wppm\_task\_comment where task\_id=~~".$id." ORDER BY ".~~$orderby\_proj\_sql); |
  |  | 26 | $task\_comment = $wpdb->get\_results( "SELECT \* FROM {$wpdb->prefix}wppm\_task\_comment where task\_id='".esc\_sql($id)."' ORDER BY ". $orderby\_proj\_sql); |
  | 25 | 27 | $task\_proj = isset($task->project) ? esc\_sql($task->project) :""; |
  | 26 | 28 | $task\_id = isset($task->id) ? esc\_sql($task->id):""; |
  | 27 | 29 | } |
  | 28 |  | $user\_role = $wpdb->get\_var( "SELECT role\_id FROM {$wpdb->prefix}wppm\_project\_users where proj\_id = '$task\_proj' AND user\_id = '$cu~~rrent\_user->ID~~'"); |
  |  | 30 | $user\_role = $wpdb->get\_var( "SELECT role\_id FROM {$wpdb->prefix}wppm\_project\_users where proj\_id = '$task\_proj' AND user\_id = '$cu\_id'"); |
  | 29 | 31 | if(!empty($task\_proj)){ |
  | 30 | 32 | $project\_name = $wpdb->get\_var( "SELECT project\_name FROM {$wpdb->prefix}wppm\_project where id= '$task\_proj'"); |
  | […](/browser/taskbuilder/trunk/includes/admin/tasks/open_task/wppm_open_task.php?rev=3191970#L37) | […](/browser/taskbuilder/trunk/includes/admin/tasks/open_task/wppm_open_task.php?rev=3210469#L39) |  |
  | 37 | 39 | if(!empty($task->priority)){ |
  | 38 | 40 | $task\_priority\_var = esc\_sql($task->priority); |
  | 39 |  | $task\_priority = $wpdb->get\_row( "SELECT \* FROM {$wpdb->prefix}wppm\_task\_priorities where id=~~".$task\_priority\_var~~); |
  |  | 41 | $task\_priority = $wpdb->get\_row( "SELECT \* FROM {$wpdb->prefix}wppm\_task\_priorities where id='$task\_priority\_var'"); |
  | 40 | 42 | } |
  | 41 | 43 | if(!empty($task->users)){ |
  | […](/browser/taskbuilder/trunk/includes/admin/tasks/open_task/wppm_open_task.php?rev=3191970#L64) | […](/browser/taskbuilder/trunk/includes/admin/tasks/open_task/wppm_open_task.php?rev=3210469#L66) |  |
  | 64 | 66 | $tusers\_arr = explode(',',$tusers); |
  | 65 | 67 | $tproject\_id = $val\_array['project']; |
  |  | 68 | $tproject\_id = esc\_sql($tproject\_id); |
  | 66 | 69 | if(!empty($tusers) && in\_array($current\_user->ID,$tusers\_arr)){ |
  | 67 |  | $project\_user\_role = $wpdb->get\_var("SELECT role\_id FROM {$wpdb->prefix}wppm\_project\_users WHERE proj\_id = '$tproject\_id' AND user\_id = '$cu~~rrent\_user->ID~~'"); |
  |  | 70 | $project\_user\_role = $wpdb->get\_var("SELECT role\_id FROM {$wpdb->prefix}wppm\_project\_users WHERE proj\_id = '$tproject\_id' AND user\_id = '$cu\_id'"); |
  | 68 | 71 | $project\_users = $wpdb->get\_var("SELECT users FROM {$wpdb->prefix}wppm\_project WHERE id = '$tproject\_id'"); |
  | 69 | 72 | $project\_users\_arr = explode(',',(string)$project\_users); |
  | […](/browser/taskbuilder/trunk/includes/admin/tasks/open_task/wppm_open_task.php?rev=3191970#L75) | […](/browser/taskbuilder/trunk/includes/admin/tasks/open_task/wppm_open_task.php?rev=3210469#L78) |  |
  | 75 | 78 | } |
  | 76 | 79 | } |
  | 77 |  | $project\_creator = $wpdb->get\_var("SELECT created\_by FROM {$wpdb->prefix}wppm\_project WHERE created\_by = '$cu~~rrent\_user->ID~~'"); |
  |  | 80 | $project\_creator = $wpdb->get\_var("SELECT created\_by FROM {$wpdb->prefix}wppm\_project WHERE created\_by = '$cu\_id'"); |
  | 78 | 81 | ?> |
  | 79 | 82 | <form id="wppm\_open\_task" method="post"> |
  | […](/browser/taskbuilder/trunk/includes/admin/tasks/open_task/wppm_open_task.php?rev=3191970#L310) | […](/browser/taskbuilder/trunk/includes/admin/tasks/open_task/wppm_open_task.php?rev=3210469#L313) |  |
  | 310 | 313 | if(!empty($task\_comment)){ |
  | 311 | 314 | foreach($task\_comment as $comment){ |
  | 312 |  | $task\_comment\_meta = $wpdb->get\_row( "SELECT \* FROM {$wpdb->prefix}wppm\_task\_comment\_meta where task\_id=~~".$id." AND comment\_id=".$comment->id."~~"); |
  |  | 315 | $task\_comment\_meta = $wpdb->get\_row( "SELECT \* FROM {$wpdb->prefix}wppm\_task\_comment\_meta where task\_id='".esc\_sql($id)."' AND comment\_id='".esc\_sql($comment->id)."'"); |
  | 313 | 316 | $user = get\_userdata( $comment->created\_by ); |
  | 314 | 317 | $comment\_body = stripslashes((htmlspecialchars\_decode($comment->body, ENT\_QUOTES))); |
  | […](/browser/taskbuilder/trunk/includes/admin/tasks/open_task/wppm_open_task.php?rev=3191970#L433) | […](/browser/taskbuilder/trunk/includes/admin/tasks/open_task/wppm_open_task.php?rev=3210469#L436) |  |
  | 433 | 436 | if(!empty($attachments)){ |
  | 434 | 437 | foreach( $attachments as $attachment ): |
  |  | 438 | $download\_url = site\_url('/').'?wppm\_attachment='.$attachment.'&tid="'.$comment->id.'"&tac='.$auth\_id; |
  | 435 | 439 | $attachment = esc\_sql($attachment); |
  | 436 | 440 | $attach = $wpdb->get\_row( "SELECT \* FROM {$wpdb->prefix}wppm\_attachments where id='$attachment'"); |
  | 437 |  | ~~$download\_url = site\_url('/').'?wppm\_attachment='.$attachment.'&tid='.$id.'&tac='.$auth\_id;~~ |
  | 438 | 441 | $findStr = ".txt"; |
  | 439 | 442 | if(!empty( $attach)){ |
* ## [taskbuilder/trunk/includes/admin/tasks/open\_task/wppm\_set\_change\_raised\_by.php](/changeset/3210469/taskbuilder/trunk/includes/admin/tasks/open_task/wppm_set_change_raised_by.php "Show the changeset 3210469 restricted to taskbuilder/trunk/includes/admin/tasks/open_task/wppm_set_change_raised_by.php")

  | [r3174963](/browser/taskbuilder/trunk/includes/admin/tasks/open_task/wppm_set_change_raised_by.php?rev=3174963#L5 "Show revision 3174963 of this file in browser") | [r3210469](/browser/taskbuilder/trunk/includes/admin/tasks/open_task/wppm_set_change_raised_by.php?rev=3210469#L5 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 5 | 5 | global $current\_user,$wppmfunction,$wpdb; |
  | 6 | 6 | $task\_id = isset($\_POST['task\_id'])  ? intval(sanitize\_text\_field($\_POST['task\_id'])) : ''; |
  | 7 |  |  |
  | 8 | 7 | if (!(($current\_user->ID && $current\_user->has\_cap('manage\_options')) || $wppmfunction->has\_permission('change\_raised\_by',$task\_id))) {exit;} |
  | 9 | 8 | if ( check\_ajax\_referer( 'wppm\_set\_change\_raised\_by', '\_ajax\_nonce', false ) != 1 ) { |
  | […](/browser/taskbuilder/trunk/includes/admin/tasks/open_task/wppm_set_change_raised_by.php?rev=3174963#L13) | […](/browser/taskbuilder/trunk/includes/admin/tasks/open_task/wppm_set_change_raised_by.php?rev=3210469#L12) |  |
  | 13 | 12 | $task\_data = $wppmfunction->get\_task($task\_id); |
  | 14 | 13 | $old\_user\_id  = $task\_data['created\_by']; |
  | 15 |  |  |
  |  | 14 | $cu\_id = esc\_sql($current\_user->ID); |
  | 16 | 15 | if ( $user\_id != $old\_user\_id ){ |
  | 17 | 16 | $wppmfunction->change\_raised\_by($task\_id, $user\_id); |
  | 18 | 17 | $change\_creator\_value = array('prev\_user'=>"$old\_user\_id",'new\_user'=>"$user\_id"); |
  | 19 | 18 | $change\_creator\_obj = serialize($change\_creator\_value); |
  | 20 |  | $log\_values = array('task\_id'=>$task\_id,'body'=>$change\_creator\_obj,'attachment\_ids'=>"",'create\_time'=>date("Y-m-d h:i:sa"),'created\_by'=>$current\_user->ID, ); |
  |  | 19 | $task\_id = esc\_sql($task\_id); |
  |  | 20 | $log\_values = array('task\_id'=>"$task\_id",'body'=>$change\_creator\_obj,'attachment\_ids'=>"",'create\_time'=>date("Y-m-d h:i:sa"),'created\_by'=>"$cu\_id", ); |
  | 21 | 21 | $wpdb->insert($wpdb->prefix . 'wppm\_task\_comment',$log\_values); |
  | 22 |  | $log\_id = ~~$wpdb->insert\_id~~; |
  | 23 |  | $task\_log\_values = array('task\_id'=>~~$task\_id,'comment\_id'=>$log\_id~~,'comment\_type'=>'change\_task\_creator'); |
  |  | 22 | $log\_id = esc\_sql($wpdb->insert\_id); |
  |  | 23 | $task\_log\_values = array('task\_id'=>"$task\_id",'comment\_id'=>"$log\_id",'comment\_type'=>'change\_task\_creator'); |
  | 24 | 24 | $wpdb->insert($wpdb->prefix . 'wppm\_task\_comment\_meta',$task\_log\_values); |
  | 25 | 25 | } |
* ## [taskbuilder/trunk/includes/admin/tasks/open\_task/wppm\_set\_change\_task\_details.php](/changeset/3210469/taskbuilder/trunk/includes/admin/tasks/open_task/wppm_set_change_task_details.php "Show the changeset 3210469 restricted to taskbuilder/trunk/includes/admin/tasks/open_task/wppm_set_change_task_details.php")

  | [r3158191](/browser/taskbuilder/trunk/includes/admin/tasks/open_task/wppm_set_change_task_details.php?rev=3158191#L5 "Show revision 3158191 of this file in browser") | [r3210469](/browser/taskbuilder/trunk/includes/admin/tasks/open_task/wppm_set_change_task_details.php?rev=3210469#L5 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 5 | 5 | global $wpdb,$wppmfunction,$current\_user; |
  | 6 | 6 | $task\_id  = isset($\_POST['task\_id']) ? intval(sanitize\_text\_field($\_POST['task\_id'])) : '' ; |
  |  | 7 | $task\_id = esc\_sql($task\_id); |
  | 7 | 8 | $proj\_id =  isset($\_POST['proj\_id']) ? intval(sanitize\_text\_field($\_POST['proj\_id'])) : '' ; |
  | 8 | 9 | if (!(($current\_user->ID && $current\_user->has\_cap('manage\_options')) || $wppmfunction->has\_permission('change\_task\_details',$task\_id))) {exit;} |
  | […](/browser/taskbuilder/trunk/includes/admin/tasks/open_task/wppm_set_change_task_details.php?rev=3158191#L38) | […](/browser/taskbuilder/trunk/includes/admin/tasks/open_task/wppm_set_change_task_details.php?rev=3210469#L39) |  |
  | 38 | 39 | $change\_priority\_value = array('prev\_prio'=>"$task\_data[priority]",'new\_prio'=>"$task\_priority"); |
  | 39 | 40 | $change\_priority\_obj = serialize($change\_priority\_value); |
  | 40 |  | $log\_values = array('task\_id'=>~~$task\_id,'body'=>$change\_priority\_obj,'attachment\_ids'=>"",'create\_time'=>date("Y-m-d h:i:sa"),'created\_by'=>$current\_user->ID~~ ); |
  |  | 41 | $log\_values = array('task\_id'=>esc\_sql($task\_id),'body'=>$change\_priority\_obj,'attachment\_ids'=>"",'create\_time'=>date("Y-m-d h:i:sa"),'created\_by'=>esc\_sql($current\_user->ID) ); |
  | 41 | 42 | $wpdb->insert($wpdb->prefix . 'wppm\_task\_comment',$log\_values); |
  | 42 |  | $log\_id = ~~$wpdb->insert\_id~~; |
  | 43 |  | $task\_log\_values = array('task\_id'=>~~$task\_id,'comment\_id'=>$log\_id~~,'comment\_type'=>'change\_task\_priority'); |
  |  | 43 | $log\_id = esc\_sql($wpdb->insert\_id); |
  |  | 44 | $task\_log\_values = array('task\_id'=>esc\_sql($task\_id),'comment\_id'=>"$log\_id",'comment\_type'=>'change\_task\_priority'); |
  | 44 | 45 | $wpdb->insert($wpdb->prefix . 'wppm\_task\_comment\_meta',$task\_log\_values); |
  | 45 | 46 | } |
* ## [taskbuilder/trunk/includes/admin/tasks/open\_task/wppm\_set\_change\_task\_status.php](/changeset/3210469/taskbuilder/trunk/includes/admin/tasks/open_task/wppm_set_change_task_status.php "Show the changeset 3210469 restricted to taskbuilder/trunk/includes/admin/tasks/open_task/wppm_set_change_task_status.php")

  | [r3158191](/browser/taskbuilder/trunk/includes/admin/tasks/open_task/wppm_set_change_task_status.php?rev=3158191#L5 "Show revision 3158191 of this file in browser") | [r3210469](/browser/taskbuilder/trunk/includes/admin/tasks/open_task/wppm_set_change_task_status.php?rev=3210469#L5 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 5 | 5 | global $current\_user,$wppmfunction,$wpdb; |
  | 6 | 6 |  |
  | 7 |  | $task\_id    = isset($\_POST['task\_id'])  ? sanitize\_text\_field($\_POST['task\_id']) : ''; |
  |  | 7 | $task\_id    = isset($\_POST['task\_id'])  ? intval(sanitize\_text\_field($\_POST['task\_id'])) : ''; |
  |  | 8 | $cu\_id =  esc\_sql($current\_user->ID); |
  | 8 | 9 | if (!(($current\_user->ID && $current\_user->has\_cap('manage\_options')) || $wppmfunction->has\_permission('change\_status',$task\_id))) {exit;} |
  | 9 | 10 | if ( check\_ajax\_referer( 'wppm\_set\_change\_task\_status', '\_ajax\_nonce', false ) != 1 ) { |
  | […](/browser/taskbuilder/trunk/includes/admin/tasks/open_task/wppm_set_change_task_status.php?rev=3158191#L18) | […](/browser/taskbuilder/trunk/includes/admin/tasks/open_task/wppm_set_change_task_status.php?rev=3210469#L19) |  |
  | 18 | 19 | if($status\_id && $status\_id!=$old\_status\_id){ |
  | 19 | 20 | $wppmfunction->change\_status( $task\_id, $status\_id); |
  | 20 |  | $change\_task\_value = array('prev\_status'=>"$task\_data[status]",'new\_status'=>"$status\_id"); |
  |  | 21 | $task\_id = esc\_sql($task\_id); |
  |  | 22 | $old\_status\_id  = esc\_sql($old\_status\_id); |
  |  | 23 | $status\_id = esc\_sql($status\_id); |
  |  | 24 | $change\_task\_value = array('prev\_status'=>"$old\_status\_id",'new\_status'=>"$status\_id"); |
  | 21 | 25 | $change\_task\_obj = serialize($change\_task\_value); |
  | 22 |  | $log\_values = array('task\_id'=>~~$task\_id,'body'=>$change\_task\_obj,'attachment\_ids'=>"",'create\_time'=>date("Y-m-d h:i:sa"),'created\_by'=>$current\_user->ID~~ ); |
  |  | 26 | $log\_values = array('task\_id'=>"$task\_id",'body'=>$change\_task\_obj,'attachment\_ids'=>"",'create\_time'=>date("Y-m-d h:i:sa"),'created\_by'=>"$cu\_id" ); |
  | 23 | 27 | $wpdb->insert($wpdb->prefix . 'wppm\_task\_comment',$log\_values); |
  | 24 |  | $log\_id = ~~$wpdb->insert\_id~~; |
  | 25 |  | $task\_log\_values = array('task\_id'=>~~$task\_id,'comment\_id'=>$log\_id~~,'comment\_type'=>'change\_task\_status'); |
  |  | 28 | $log\_id = esc\_sql($wpdb->insert\_id); |
  |  | 29 | $task\_log\_values = array('task\_id'=>"$task\_id",'comment\_id'=>"$log\_id",'comment\_type'=>'change\_task\_status'); |
  | 26 | 30 | $wpdb->insert($wpdb->prefix . 'wppm\_task\_comment\_meta',$task\_log\_values); |
  | 27 | 31 | } |
* ## [taskbuilder/trunk/includes/admin/tasks/open\_task/wppm\_set\_clone\_task.php](/changeset/3210469/taskbuilder/trunk/includes/admin/tasks/open_task/wppm_set_clone_task.php "Show the changeset 3210469 restricted to taskbuilder/trunk/includes/admin/tasks/open_task/wppm_set_clone_task.php")

  | [r3174963](/browser/taskbuilder/trunk/includes/admin/tasks/open_task/wppm_set_clone_task.php?rev=3174963#L20 "Show revision 3174963 of this file in browser") | [r3210469](/browser/taskbuilder/trunk/includes/admin/tasks/open_task/wppm_set_clone_task.php?rev=3210469#L20 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 20 | 20 | $checklists = $wppmfunction->get\_checklist($prev\_task\_id); |
  | 21 | 21 | $task\_project = isset($project\_id) ? $project\_id : $task['project']; |
  |  | 22 | $prev\_task\_id = esc\_sql($prev\_task\_id); |
  | 22 | 23 | $task\_comments = $wpdb->get\_results("SELECT \* FROM {$wpdb->prefix}wppm\_task\_comment WHERE task\_id='$prev\_task\_id' "); |
  | 23 | 24 | $task\_name    = isset($\_POST['task\_name']) ? stripslashes(sanitize\_text\_field($\_POST['task\_name'])) : $task['task\_name'] ; |
  | […](/browser/taskbuilder/trunk/includes/admin/tasks/open_task/wppm_set_clone_task.php?rev=3174963#L105) | […](/browser/taskbuilder/trunk/includes/admin/tasks/open_task/wppm_set_clone_task.php?rev=3210469#L106) |  |
  | 105 | 106 | $comment\_id = $wppmfunction->wppm\_submit\_task\_comment($args); |
  | 106 | 107 | $task\_comm\_id = esc\_sql($task\_comment->id); |
  | 107 |  | $task\_comment\_type = $wpdb->get\_var( "SELECT comment\_type FROM {$wpdb->prefix}wppm\_task\_comment\_meta where task\_id=~~".$prev\_task\_id."~~ AND comment\_id='$task\_comm\_id'"); |
  |  | 108 | $task\_comment\_type = $wpdb->get\_var( "SELECT comment\_type FROM {$wpdb->prefix}wppm\_task\_comment\_meta where task\_id='$prev\_task\_id' AND comment\_id='$task\_comm\_id'"); |
  | 108 | 109 | if(!empty($task\_comment\_type)){ |
  | 109 | 110 | $meta\_values = array( |
* ## [taskbuilder/trunk/includes/admin/tasks/open\_task/wppm\_set\_delete\_thread.php](/changeset/3210469/taskbuilder/trunk/includes/admin/tasks/open_task/wppm_set_delete_thread.php "Show the changeset 3210469 restricted to taskbuilder/trunk/includes/admin/tasks/open_task/wppm_set_delete_thread.php")

  | [r3174963](/browser/taskbuilder/trunk/includes/admin/tasks/open_task/wppm_set_delete_thread.php?rev=3174963#L12 "Show revision 3174963 of this file in browser") | [r3210469](/browser/taskbuilder/trunk/includes/admin/tasks/open_task/wppm_set_delete_thread.php?rev=3210469#L12 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 12 | 12 | wp\_send\_json\_error( 'Unauthorised request!', 401 ); |
  | 13 | 13 | } |
  |  | 14 | $thread\_id = esc\_sql($thread\_id); |
  |  | 15 | $task\_id = esc\_sql($task\_id); |
  | 14 | 16 | $sql="SELECT attachment\_ids FROM {$wpdb->prefix}wppm\_task\_comment WHERE id ='$thread\_id'"; |
  | 15 | 17 | $thread\_attachment\_ids = $wpdb->get\_results( $sql ); |
  | […](/browser/taskbuilder/trunk/includes/admin/tasks/open_task/wppm_set_delete_thread.php?rev=3174963#L23) | […](/browser/taskbuilder/trunk/includes/admin/tasks/open_task/wppm_set_delete_thread.php?rev=3210469#L25) |  |
  | 23 | 25 | if(!empty($attachment\_ids\_temp)){ |
  | 24 | 26 | foreach ($attachment\_ids\_temp as $attachment\_id){ |
  |  | 27 | $attachment\_id = esc\_sql($attachment\_id); |
  | 25 | 28 | $sql="SELECT \* FROM {$wpdb->prefix}wppm\_attachments WHERE id = '$attachment\_id'"; |
  | 26 | 29 | $result=$wpdb->get\_row($sql); |
  | 27 | 30 | if(!empty($result)){ |
  | 28 |  | $sql\_query="SELECT file\_path FROM {$wpdb->prefix}wppm\_attachments WHERE file\_path ='".~~$result->file\_path~~."'"; |
  |  | 31 | $sql\_query="SELECT file\_path FROM {$wpdb->prefix}wppm\_attachments WHERE file\_path ='".esc\_sql($result->file\_path)."'"; |
  | 29 | 32 | $attach\_result=$wpdb->get\_results($sql\_query); |
  | 30 | 33 | $result\_count = count($attach\_result); |
  | […](/browser/taskbuilder/trunk/includes/admin/tasks/open_task/wppm_set_delete_thread.php?rev=3174963#L40) | […](/browser/taskbuilder/trunk/includes/admin/tasks/open_task/wppm_set_delete_thread.php?rev=3210469#L43) |  |
  | 40 | 43 | } |
  | 41 | 44 | $cur\_user = get\_userdata($current\_user->ID); |
  | 42 |  | $~~thread\_id = esc\_sql($thread\_id)~~; |
  | 43 |  | $log\_values = array('task\_id'=>~~$task\_id,'body'=>'This comment was deleted by '.$cur\_user->~~display\_name,'attachment\_ids'=>"" ); |
  | 44 |  | $wpdb->update($wpdb->prefix.'wppm\_task\_comment', $log\_values, array('id'=>~~$thread\_id~~)); |
  | 45 |  | $task\_log\_values = array('task\_id'=>~~$task\_id,'comment\_id'=>$thread\_id~~,'comment\_type'=>'delete\_task\_comment'); |
  |  | 45 | $cur\_user\_display\_name = $cur\_user->display\_name; |
  |  | 46 | $log\_values = array('task\_id'=>"$task\_id",'body'=>'This comment was deleted by '.$cur\_user\_display\_name,'attachment\_ids'=>"" ); |
  |  | 47 | $wpdb->update($wpdb->prefix.'wppm\_task\_comment', $log\_values, array('id'=>"$thread\_id")); |
  |  | 48 | $task\_log\_values = array('task\_id'=>"$task\_id",'comment\_id'=>"$thread\_id",'comment\_type'=>'delete\_task\_comment'); |
  | 46 | 49 | $comment\_meta = $wpdb->get\_row("SELECT \* FROM {$wpdb->prefix}wppm\_task\_comment\_meta WHERE comment\_id='$thread\_id' "); |
  | 47 | 50 | if(!empty($comment\_meta)){ |
  | 48 |  | $wpdb->update($wpdb->prefix . 'wppm\_task\_comment\_meta',$task\_log\_values,array('id'=>$comment\_meta->id)); |
  |  | 51 | $comment\_meta\_id = esc\_sql($comment\_meta->id); |
  |  | 52 | $wpdb->update($wpdb->prefix . 'wppm\_task\_comment\_meta',$task\_log\_values,array('id'=>"$comment\_meta\_id")); |
  | 49 | 53 | }else{ |
  | 50 | 54 | $wpdb->insert($wpdb->prefix . 'wppm\_task\_comment\_meta',$task\_log\_values); |
* ## [taskbuilder/trunk/includes/admin/tasks/open\_task/wppm\_set\_task\_users.php](/changeset/3210469/taskbuilder/trunk/includes/admin/tasks/open_task/wppm_set_task_users.php "Show the changeset 3210469 restricted to taskbuilder/trunk/includes/admin/tasks/open_task/wppm_set_task_users.php")

  | [r3158191](/browser/taskbuilder/trunk/includes/admin/tasks/open_task/wppm_set_task_users.php?rev=3158191#L5 "Show revision 3158191 of this file in browser") | [r3210469](/browser/taskbuilder/trunk/includes/admin/tasks/open_task/wppm_set_task_users.php?rev=3210469#L5 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 5 | 5 | global $wpdb,$wppmfunction,$current\_user; |
  | 6 | 6 | $task\_id  = isset($\_POST['task\_id']) ? intval(sanitize\_text\_field($\_POST['task\_id'])) : '' ; |
  |  | 7 | $cu\_id = esc\_sql($current\_user->ID); |
  | 7 | 8 | if (!(($current\_user->ID && $current\_user->has\_cap('manage\_options')) || $wppmfunction->has\_permission('assign\_task\_users',$task\_id))) {exit;} |
  | 8 | 9 | if ( check\_ajax\_referer( 'wppm\_set\_task\_users', '\_ajax\_nonce', false ) != 1 ) { |
  | […](/browser/taskbuilder/trunk/includes/admin/tasks/open_task/wppm_set_task_users.php?rev=3158191#L30) | […](/browser/taskbuilder/trunk/includes/admin/tasks/open_task/wppm_set_task_users.php?rev=3210469#L31) |  |
  | 30 | 31 | if(isset($users)){ |
  | 31 | 32 | $values=array( |
  | 32 |  | 'users'=> ~~$users~~ |
  |  | 33 | 'users'=> esc\_sql($users) |
  | 33 | 34 | ); |
  | 34 | 35 | }else{ |
  | […](/browser/taskbuilder/trunk/includes/admin/tasks/open_task/wppm_set_task_users.php?rev=3158191#L38) | […](/browser/taskbuilder/trunk/includes/admin/tasks/open_task/wppm_set_task_users.php?rev=3210469#L39) |  |
  | 38 | 39 | } |
  | 39 | 40 | if(($users != $task\_data['users'])){ |
  | 40 |  | $wpdb->update($wpdb->prefix.'wppm\_task', $values, array('id'=>$task\_id)); |
  |  | 41 | $task\_id = esc\_sql($task\_id); |
  |  | 42 | $wpdb->update($wpdb->prefix.'wppm\_task', $values, array('id'=>"$task\_id")); |
  | 41 | 43 | $change\_assign\_user\_value = array('prev\_assign\_user'=>"$task\_data[users]",'new\_assign\_user'=>"$users"); |
  | 42 | 44 | $change\_assign\_user\_obj = serialize($change\_assign\_user\_value); |
  | 43 |  | $log\_values = array('task\_id'=>~~$task\_id,'body'=>$change\_assign\_user\_obj,'attachment\_ids'=>"",'create\_time'=>date("Y-m-d h:i:sa"),'created\_by'=>$current\_user->ID~~ ); |
  |  | 45 | $log\_values = array('task\_id'=>"$task\_id",'body'=>$change\_assign\_user\_obj,'attachment\_ids'=>"",'create\_time'=>date("Y-m-d h:i:sa"),'created\_by'=>"$cu\_id" ); |
  | 44 | 46 | $wpdb->insert($wpdb->prefix . 'wppm\_task\_comment',$log\_values); |
  | 45 |  | $log\_id = ~~$wpdb->insert\_id~~; |
  | 46 |  | $task\_log\_values = array('task\_id'=>~~$task\_id,'comment\_id'=>$log\_id~~,'comment\_type'=>'change\_assign\_user'); |
  |  | 47 | $log\_id = esc\_sql($wpdb->insert\_id); |
  |  | 48 | $task\_log\_values = array('task\_id'=>"$task\_id",'comment\_id'=>"$log\_id",'comment\_type'=>'change\_assign\_user'); |
  | 47 | 49 | $wpdb->insert($wpdb->prefix . 'wppm\_task\_comment\_meta',$task\_log\_values); |
  | 48 | 50 | do\_action('wppm\_set\_task\_users', $task\_id); |
* ## [taskbuilder/trunk/includes/admin/tasks/open\_task/wppm\_submit\_task\_comment.php](/changeset/3210469/taskbuilder/trunk/includes/admin/tasks/open_task/wppm_submit_task_comment.php "Show the changeset 3210469 restricted to taskbuilder/trunk/includes/admin/tasks/open_task/wppm_submit_task_comment.php")

  | [r3174963](/browser/taskbuilder/trunk/includes/admin/tasks/open_task/wppm_submit_task_comment.php?rev=3174963#L22 "Show revision 3174963 of this file in browser") | [r3210469](/browser/taskbuilder/trunk/includes/admin/tasks/open_task/wppm_submit_task_comment.php?rev=3210469#L22 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 22 | 22 | 'body'=>$comment\_body, |
  | 23 | 23 | 'attachment\_ids'=>$attachment\_ids, |
  | 24 |  | 'create\_time'=>~~current\_time('mysql', 1~~), |
  |  | 24 | 'create\_time'=>date("Y-m-d h:i:sa"), |
  | 25 | 25 | 'created\_by'=>$current\_user->ID |
  | 26 | 26 | ); |
  | 27 | 27 | $args = apply\_filters( 'wppm\_submit\_comment\_args', $args ); |
  | 28 | 28 | $comment\_id = $wppmfunction->wppm\_submit\_task\_comment($args); |
  | 29 |  | $task\_log\_values = array('task\_id'=>~~$task\_id,'comment\_id'=>$comment\_id~~,'comment\_type'=>'comment'); |
  |  | 29 | $task\_log\_values = array('task\_id'=>esc\_sql($task\_id),'comment\_id'=>esc\_sql($comment\_id),'comment\_type'=>'comment'); |
  | 30 | 30 | $wpdb->insert($wpdb->prefix . 'wppm\_task\_comment\_meta',$task\_log\_values); |
  | 31 | 31 | do\_action('wppm\_after\_submit\_task\_comment', $task\_id,$comment\_id); |
* ## [taskbuilder/trunk/includes/admin/tasks/open\_task/wppm\_thread\_attachment\_remove.php](/changeset/3210469/taskbuilder/trunk/includes/admin/tasks/open_task/wppm_thread_attachment_remove.php "Show the changeset 3210469 restricted to taskbuilder/trunk/includes/admin/tasks/open_task/wppm_thread_attachment_remove.php")

  | [r3174963](/browser/taskbuilder/trunk/includes/admin/tasks/open_task/wppm_thread_attachment_remove.php?rev=3174963#L9 "Show revision 3174963 of this file in browser") | [r3210469](/browser/taskbuilder/trunk/includes/admin/tasks/open_task/wppm_thread_attachment_remove.php?rev=3210469#L9 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 9 | 9 | } |
  | 10 | 10 | $attachment     = isset($\_POST['attachment']) ? intval(sanitize\_text\_field($\_POST['attachment'])) : '0' ; |
  | 11 |  | $comment\_id = isset($\_POST['comment\_id']) ? intval(sanitize\_text\_field($\_POST['comment\_id'])) : '0' ; |
  | 12 |  | $task\_id = isset($\_POST['task\_id']) ? intval(sanitize\_text\_field($\_POST['task\_id'])) : '0' ; |
  |  | 11 | $attachment     = esc\_sql($attachment); |
  |  | 12 | $comment\_id     = isset($\_POST['comment\_id']) ? intval(sanitize\_text\_field($\_POST['comment\_id'])) : '0' ; |
  |  | 13 | $task\_id        = isset($\_POST['task\_id']) ? intval(sanitize\_text\_field($\_POST['task\_id'])) : '0' ; |
  |  | 14 | $comment\_id     = esc\_sql($comment\_id); |
  |  | 15 | $task\_id        = esc\_sql($task\_id); |
  | 13 | 16 | $task\_comment = $wpdb->get\_row( "SELECT \* FROM {$wpdb->prefix}wppm\_task\_comment where id = '$comment\_id' AND task\_id='$task\_id'"); |
  | 14 | 17 | if(!(((!empty($task\_comment)) && ($task\_comment->created\_by == $current\_user->ID)) || ($current\_user->has\_cap('manage\_options')) || ($wppmfunction->has\_comment\_permission('edit\_task\_comment',$task\_id,$comment\_id)))){ |
  | 15 | 18 | exit; |
  | 16 | 19 | } |
  | 17 |  | $sql="SELECT \* FROM {$wpdb->prefix}wppm\_attachments WHERE id = ~~$attachment~~"; |
  |  | 20 | $sql="SELECT \* FROM {$wpdb->prefix}wppm\_attachments WHERE id = '$attachment'"; |
  | 18 | 21 | $result=$wpdb->get\_row($sql); |
  | 19 |  | $sql\_query="SELECT file\_path FROM {$wpdb->prefix}wppm\_attachments WHERE file\_path ='".~~$result->file\_path~~."'"; |
  |  | 22 | $sql\_query="SELECT file\_path FROM {$wpdb->prefix}wppm\_attachments WHERE file\_path ='".esc\_sql($result->file\_path)."'"; |
  | 20 | 23 | $attach\_result=$wpdb->get\_results($sql\_query); |
  | 21 | 24 | $result\_count = count($attach\_result); |
  | […](/browser/taskbuilder/trunk/includes/admin/tasks/open_task/wppm_thread_attachment_remove.php?rev=3174963#L26) | […](/browser/taskbuilder/trunk/includes/admin/tasks/open_task/wppm_thread_attachment_remove.php?rev=3210469#L29) |  |
  | 26 | 29 | $success = $wpdb->delete( |
  | 27 | 30 | $wpdb->prefix . 'wppm\_attachments', |
  | 28 |  | array( 'id' => ~~$attachment~~ ) |
  |  | 31 | array( 'id' => "$attachment" ) |
  | 29 | 32 | ); |
  | 30 | 33 | if( !$success ) return false; |
  | […](/browser/taskbuilder/trunk/includes/admin/tasks/open_task/wppm_thread_attachment_remove.php?rev=3174963#L40) | […](/browser/taskbuilder/trunk/includes/admin/tasks/open_task/wppm_thread_attachment_remove.php?rev=3210469#L43) |  |
  | 40 | 43 | $tattachment = implode(',',$task\_attachment); |
  | 41 | 44 | $values=array( |
  | 42 |  | 'attachment\_ids'=>~~$tattachment~~ |
  |  | 45 | 'attachment\_ids'=>esc\_sql($tattachment) |
  | 43 | 46 | ); |
  | 44 |  | $wpdb->update($wpdb->prefix.'wppm\_task\_comment', $values, array('id'=>~~$comment\_id~~)); |
  |  | 47 | $wpdb->update($wpdb->prefix.'wppm\_task\_comment', $values, array('id'=>"$comment\_id")); |
  | 45 | 48 | $attachment = apply\_filters('wppm\_after\_delete\_comment\_attachment',$attachment,$comment\_id,$task\_id); |
* ## [taskbuilder/trunk/includes/admin/tasks/open\_task/wppm\_upload\_file.php](/changeset/3210469/taskbuilder/trunk/includes/admin/tasks/open_task/wppm_upload_file.php "Show the changeset 3210469 restricted to taskbuilder/trunk/includes/admin/tasks/open_task/wppm_upload_file.php")

  | [r3123269](/browser/taskbuilder/trunk/includes/admin/tasks/open_task/wppm_upload_file.php?rev=3123269#L74 "Show revision 3123269 of this file in browser") | [r3210469](/browser/taskbuilder/trunk/includes/admin/tasks/open_task/wppm_upload_file.php?rev=3210469#L74 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 74 | 74 | move\_uploaded\_file( $\_FILES['file']['tmp\_name'], $save\_directory ); |
  | 75 | 75 | } |
  | 76 |  |  |
  |  | 76 | $save\_file\_name = esc\_sql($save\_file\_name); |
  |  | 77 | $file\_name = esc\_sql($file\_name); |
  |  | 78 | $save\_directory = esc\_sql($save\_directory); |
  |  | 79 | $is\_image = esc\_sql($is\_image); |
  |  | 80 | $now = esc\_sql($now); |
  | 77 | 81 | $values=array( |
  | 78 | 82 | 'name'=>$save\_file\_name, |
* ## [taskbuilder/trunk/includes/admin/tasks/wppm\_add\_new\_task.php](/changeset/3210469/taskbuilder/trunk/includes/admin/tasks/wppm_add_new_task.php "Show the changeset 3210469 restricted to taskbuilder/trunk/includes/admin/tasks/wppm_add_new_task.php")

  | [r3191970](/browser/taskbuilder/trunk/includes/admin/tasks/wppm_add_new_task.php?rev=3191970#L6 "Show revision 3191970 of this file in browser") | [r3210469](/browser/taskbuilder/trunk/includes/admin/tasks/wppm_add_new_task.php?rev=3210469#L6 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 6 | 6 | $proj\_id = isset($\_POST['proj\_id']) ? intval(sanitize\_text\_field($\_POST['proj\_id'])) : 0 ; |
  | 7 | 7 | $orderby\_prio\_sql = esc\_sql(sanitize\_sql\_orderby( "name" )); |
  | 8 |  | $priorities = $wpdb->get\_results( "SELECT \* FROM {$wpdb->prefix}wppm\_task\_priorities ORDER BY ".$orderby\_prio\_sql ); |
  |  | 8 | $cu\_id = esc\_sql($current\_user->ID); |
  |  | 9 | $priorities = $wpdb->get\_results( "SELECT \* FROM {$wpdb->prefix}wppm\_task\_priorities ORDER BY '$orderby\_prio\_sql'" ); |
  | 9 | 10 | $wppm\_current\_user\_capability = get\_user\_meta( $current\_user->ID, 'wppm\_capability', true ); |
  | 10 | 11 | $wppm\_create\_tasks\_coworkers\_permission = get\_option('wppm\_allow\_coworkers\_create\_task'); |
  | 11 | 12 | if($current\_user->has\_cap('manage\_options') || $wppm\_current\_user\_capability=='wppm\_admin'){ |
  | 12 | 13 | $orderby\_proj\_sql = esc\_sql(sanitize\_sql\_orderby( "project\_name" )); |
  | 13 |  | $query = ( "SELECT \* FROM {$wpdb->prefix}wppm\_project ORDER BY ~~".$orderby\_proj\_sql~~ ); |
  |  | 14 | $query = ( "SELECT \* FROM {$wpdb->prefix}wppm\_project ORDER BY '$orderby\_proj\_sql'" ); |
  | 14 | 15 | $where = ""; |
  | 15 | 16 | }else{ |
  | […](/browser/taskbuilder/trunk/includes/admin/tasks/wppm_add_new_task.php?rev=3191970#L21) | […](/browser/taskbuilder/trunk/includes/admin/tasks/wppm_add_new_task.php?rev=3210469#L22) |  |
  | 21 | 22 | "); |
  | 22 | 23 | if($wppm\_create\_tasks\_coworkers\_permission!=1){ |
  | 23 |  | $where =  " where ((FIND\_IN\_SET(~~$current\_user->ID,Proj.users) AND proj\_users.role\_id=1) OR (Proj.id = proj\_meta.project\_id AND proj\_meta.meta\_key='public\_project' AND proj\_meta.meta\_value=1) OR (Proj.created\_by='$current\_user->ID')) Group by Proj.id ORDER BY ".$orderby\_proj\_sql~~; |
  |  | 24 | $where =  " where ((FIND\_IN\_SET('$current\_user->ID',Proj.users) AND proj\_users.role\_id=1) OR (Proj.id = proj\_meta.project\_id AND proj\_meta.meta\_key='public\_project' AND proj\_meta.meta\_value=1) OR (Proj.created\_by='$cu\_id')) Group by Proj.id ORDER BY '$orderby\_proj\_sql'"; |
  | 24 | 25 | }else{ |
  | 25 |  | $where =  " where ((FIND\_IN\_SET(~~$current\_user->ID,Proj.users)) OR (Proj.id = proj\_meta.project\_id AND proj\_meta.meta\_key='public\_project' AND proj\_meta.meta\_value=1) OR (Proj.created\_by='$current\_user->ID')) Group by Proj.id ORDER BY ".$orderby\_proj\_sql~~; |
  |  | 26 | $where =  " where ((FIND\_IN\_SET('$current\_user->ID',Proj.users)) OR (Proj.id = proj\_meta.project\_id AND proj\_meta.meta\_key='public\_project' AND proj\_meta.meta\_value=1) OR (Proj.created\_by='$cu\_id')) Group by Proj.id ORDER BY '$orderby\_proj\_sql'"; |
  | 26 | 27 | } |
  | 27 | 28 | } |
  | […](/browser/taskbuilder/trunk/includes/admin/tasks/wppm_add_new_task.php?rev=3191970#L42) | […](/browser/taskbuilder/trunk/includes/admin/tasks/wppm_add_new_task.php?rev=3210469#L43) |  |
  | 42 | 43 | $tusers\_arr = explode(',',$tusers); |
  | 43 | 44 | $tproject\_id = $val\_array['project']; |
  |  | 45 | $tproject\_id = esc\_sql($tproject\_id); |
  | 44 | 46 | if(!empty($tusers) && in\_array($current\_user->ID,$tusers\_arr)){ |
  | 45 |  | $project\_user\_role = $wpdb->get\_var("SELECT role\_id FROM {$wpdb->prefix}wppm\_project\_users WHERE proj\_id = '$tproject\_id' AND user\_id = '$cu~~rrent\_user->ID~~'"); |
  |  | 47 | $project\_user\_role = $wpdb->get\_var("SELECT role\_id FROM {$wpdb->prefix}wppm\_project\_users WHERE proj\_id = '$tproject\_id' AND user\_id = '$cu\_id'"); |
  | 46 | 48 | $project\_users = $wpdb->get\_var("SELECT users FROM {$wpdb->prefix}wppm\_project WHERE id = '$tproject\_id'"); |
  | 47 | 49 | $project\_users\_arr = explode(',',(string)$project\_users); |
  | […](/browser/taskbuilder/trunk/includes/admin/tasks/wppm_add_new_task.php?rev=3191970#L53) | […](/browser/taskbuilder/trunk/includes/admin/tasks/wppm_add_new_task.php?rev=3210469#L55) |  |
  | 53 | 55 | } |
  | 54 | 56 | } |
  | 55 |  | $project\_creator = $wpdb->get\_var("SELECT created\_by FROM {$wpdb->prefix}wppm\_project WHERE created\_by = '$cu~~rrent\_user->ID~~'"); |
  |  | 57 | $project\_creator = $wpdb->get\_var("SELECT created\_by FROM {$wpdb->prefix}wppm\_project WHERE created\_by = '$cu\_id'"); |
  | 56 | 58 | ?> |
  | 57 | 59 | <form class='wppm\_add\_new\_task wppm\_bootstrap' onsubmit="return wppm\_create\_task();" id="wppm\_add\_new\_task" method="post"> |
  | […](/browser/taskbuilder/trunk/includes/admin/tasks/wppm_add_new_task.php?rev=3191970#L100) | […](/browser/taskbuilder/trunk/includes/admin/tasks/wppm_add_new_task.php?rev=3210469#L102) |  |
  | 100 | 102 | if(!empty($projects)){ |
  | 101 | 103 | foreach($projects as $proj) { |
  |  | 104 | $project\_id = esc\_sql($proj->id); |
  | 102 | 105 | if($current\_user->has\_cap('manage\_options') || $wppmfunction->has\_permission('add\_new\_task',0) || $wppm\_current\_user\_capability=='wppm\_admin'){ |
  | 103 | 106 | ?> |
  | […](/browser/taskbuilder/trunk/includes/admin/tasks/wppm_add_new_task.php?rev=3191970#L105) | […](/browser/taskbuilder/trunk/includes/admin/tasks/wppm_add_new_task.php?rev=3210469#L108) |  |
  | 105 | 108 | } |
  | 106 | 109 | else{ |
  | 107 |  | $project\_user\_role = $wpdb->get\_var("SELECT role\_id FROM {$wpdb->prefix}wppm\_project\_users WHERE proj\_id = '$proj~~->id' AND user\_id = '$current\_user->ID~~'"); |
  |  | 110 | $project\_user\_role = $wpdb->get\_var("SELECT role\_id FROM {$wpdb->prefix}wppm\_project\_users WHERE proj\_id = '$project\_id' AND user\_id = '$cu\_id'"); |
  | 108 | 111 | $project\_users = $proj->users; |
  | 109 | 112 | $project\_users\_arr = explode(',',(string)$project\_users); |
  | 110 |  | $project\_creator\_id = $wpdb->get\_var("SELECT created\_by FROM {$wpdb->prefix}wppm\_project WHERE created\_by = '$cu~~rrent\_user->ID' AND id='$proj->~~id'"); |
  |  | 113 | $project\_creator\_id = $wpdb->get\_var("SELECT created\_by FROM {$wpdb->prefix}wppm\_project WHERE created\_by = '$cu\_id' AND id='$project\_id'"); |
  | 111 | 114 | if(((!empty($project\_user\_role)) && ($project\_user\_role == 1) && in\_array($current\_user->ID,$project\_users\_arr)) || ($project\_creator\_id!="")){ |
  | 112 | 115 | ?> |
* ## [taskbuilder/trunk/includes/admin/tasks/wppm\_get\_task\_users.php](/changeset/3210469/taskbuilder/trunk/includes/admin/tasks/wppm_get_task_users.php "Show the changeset 3210469 restricted to taskbuilder/trunk/includes/admin/tasks/wppm_get_task_users.php")

  | [r3174963](/browser/taskbuilder/trunk/includes/admin/tasks/wppm_get_task_users.php?rev=3174963#L9 "Show revision 3174963 of this file in browser") | [r3210469](/browser/taskbuilder/trunk/includes/admin/tasks/wppm_get_task_users.php?rev=3210469#L9 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 9 | 9 | $proj\_id = isset($\_POST['proj\_id']) ? intval(sanitize\_text\_field($\_POST['proj\_id'])) : '' ; |
  | 10 | 10 | if (!(($current\_user->ID && $current\_user->has\_cap('manage\_options')) || $wppmfunction->has\_permission('assign\_task\_users',$task\_id))) {exit;} |
  | 11 |  | $task = $wpdb->get\_row( "SELECT \* FROM {$wpdb->prefix}wppm\_task where id = '~~$task\_id~~'" ); |
  |  | 11 | $task = $wpdb->get\_row( "SELECT \* FROM {$wpdb->prefix}wppm\_task where id = '".esc\_sql($task\_id)."'" ); |
  | 12 | 12 | $project\_data = $wppmfunction->get\_project($task->project); |
  | 13 | 13 | if(!empty($project\_data['users'])){ |
* ## [taskbuilder/trunk/includes/admin/tasks/wppm\_set\_bulk\_change\_task\_priority.php](/changeset/3210469/taskbuilder/trunk/includes/admin/tasks/wppm_set_bulk_change_task_priority.php "Show the changeset 3210469 restricted to taskbuilder/trunk/includes/admin/tasks/wppm_set_bulk_change_task_priority.php")

  | [r3174963](/browser/taskbuilder/trunk/includes/admin/tasks/wppm_set_bulk_change_task_priority.php?rev=3174963#L27 "Show revision 3174963 of this file in browser") | [r3210469](/browser/taskbuilder/trunk/includes/admin/tasks/wppm_set_bulk_change_task_priority.php?rev=3210469#L27 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 27 | 27 | $change\_priority\_value = array('prev\_prio'=>"$task\_data[priority]",'new\_prio'=>"$task\_priority"); |
  | 28 | 28 | $change\_priority\_obj = serialize($change\_priority\_value); |
  | 29 |  | $log\_values = array('task\_id'=>~~$task\_id,'body'=>$change\_priority\_obj,'attachment\_ids'=>"",'create\_time'=>date("Y-m-d h:i:sa"),'created\_by'=>$current\_user->ID~~ ); |
  |  | 29 | $log\_values = array('task\_id'=>esc\_sql($task\_id),'body'=>$change\_priority\_obj,'attachment\_ids'=>"",'create\_time'=>date("Y-m-d h:i:sa"),'created\_by'=>esc\_sql($current\_user->ID)); |
  | 30 | 30 | $wpdb->insert($wpdb->prefix . 'wppm\_task\_comment',$log\_values); |
  | 31 | 31 | $log\_id = $wpdb->insert\_id; |
  | 32 |  | $task\_log\_values = array('task\_id'=>~~$task\_id,'comment\_id'=>$log\_id~~,'comment\_type'=>'change\_task\_priority'); |
  |  | 32 | $task\_log\_values = array('task\_id'=>esc\_sql($task\_id),'comment\_id'=>esc\_sql($log\_id),'comment\_type'=>'change\_task\_priority'); |
  | 33 | 33 | $wpdb->insert($wpdb->prefix . 'wppm\_task\_comment\_meta',$task\_log\_values); |
  | 34 | 34 | } |
* ## [taskbuilder/trunk/includes/admin/tasks/wppm\_set\_bulk\_change\_task\_status.php](/changeset/3210469/taskbuilder/trunk/includes/admin/tasks/wppm_set_bulk_change_task_status.php "Show the changeset 3210469 restricted to taskbuilder/trunk/includes/admin/tasks/wppm_set_bulk_change_task_status.php")

  | [r3191970](/browser/taskbuilder/trunk/includes/admin/tasks/wppm_set_bulk_change_task_status.php?rev=3191970#L13 "Show revision 3191970 of this file in browser") | [r3210469](/browser/taskbuilder/trunk/includes/admin/tasks/wppm_set_bulk_change_task_status.php?rev=3210469#L13 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 13 | 13 | } |
  | 14 | 14 | $flag= false; |
  |  | 15 | $cu\_id = esc\_sql($current\_user->ID); |
  | 15 | 16 | $task\_status = isset( $\_POST['wppm\_task\_status']) ? intval(sanitize\_text\_field($\_POST['wppm\_task\_status'])) : ''; |
  | 16 | 17 | $wppm\_current\_user\_capability = get\_user\_meta( $current\_user->ID, 'wppm\_capability', true ); |
  | 17 |  |  |
  | 18 | 18 | if(!empty($task\_ids)){ |
  | 19 | 19 | foreach($task\_ids as $task\_id){ |
  | […](/browser/taskbuilder/trunk/includes/admin/tasks/wppm_set_bulk_change_task_status.php?rev=3191970#L21) | […](/browser/taskbuilder/trunk/includes/admin/tasks/wppm_set_bulk_change_task_status.php?rev=3210469#L21) |  |
  | 21 | 21 | $tusers =  $task\_data['users']; |
  | 22 | 22 | $tusers\_arr = explode(',',$tusers); |
  | 23 |  | $tproject\_id = ~~$task\_data['project']~~; |
  |  | 23 | $tproject\_id = esc\_sql($task\_data['project']); |
  | 24 | 24 | if(!empty($tusers) && in\_array($current\_user->ID,$tusers\_arr)){ |
  | 25 |  | $project\_user\_role = $wpdb->get\_var("SELECT role\_id FROM {$wpdb->prefix}wppm\_project\_users WHERE proj\_id = '$tproject\_id' AND user\_id = '$cu~~rrent\_user->ID~~'"); |
  |  | 25 | $project\_user\_role = $wpdb->get\_var("SELECT role\_id FROM {$wpdb->prefix}wppm\_project\_users WHERE proj\_id = '$tproject\_id' AND user\_id = '$cu\_id'"); |
  | 26 | 26 | $project\_users = $wpdb->get\_var("SELECT users FROM {$wpdb->prefix}wppm\_project WHERE id = '$tproject\_id'"); |
  | 27 | 27 | $project\_users\_arr = explode(',',(string)$project\_users); |
  | 28 | 28 | if(((!empty($project\_user\_role)) && ($project\_user\_role == 1) && in\_array($current\_user->ID,$project\_users\_arr))){ |
  | 29 |  | $flag= true; |
  | 30 |  | break; |
  |  | 29 | $flag = true; |
  | 31 | 30 | } |
  | 32 | 31 | } |
  | […](/browser/taskbuilder/trunk/includes/admin/tasks/wppm_set_bulk_change_task_status.php?rev=3191970#L36) | […](/browser/taskbuilder/trunk/includes/admin/tasks/wppm_set_bulk_change_task_status.php?rev=3210469#L35) |  |
  | 36 | 35 | die(); |
  | 37 | 36 | } |
  | 38 |  | $old\_status\_id      = $task\_data['status']; |
  | 39 |  |  |
  |  | 37 | $old\_status\_id = $task\_data['status']; |
  | 40 | 38 | if($status\_id && $status\_id!=$old\_status\_id){ |
  | 41 | 39 | $wppmfunction->change\_status( $task\_id, $status\_id); |
  | 42 |  | $change\_task\_value = array('prev\_status'=>"$task\_data[status]",'new\_status'=>"$status\_id"); |
  |  | 40 | $task\_id = esc\_sql($task\_id); |
  |  | 41 | $change\_task\_value = array('prev\_status'=>$task\_data['status'],'new\_status'=>$status\_id); |
  | 43 | 42 | $change\_task\_obj = serialize($change\_task\_value); |
  | 44 |  | $log\_values = array('task\_id'=>~~$task\_id,'body'=>$change\_task\_obj,'attachment\_ids'=>"",'create\_time'=>date("Y-m-d h:i:sa"),'created\_by'=>$current\_user->ID~~ ); |
  |  | 43 | $log\_values = array('task\_id'=>"$task\_id",'body'=>$change\_task\_obj,'attachment\_ids'=>"",'create\_time'=>date("Y-m-d h:i:sa"),'created\_by'=>esc\_sql($current\_user->ID) ); |
  | 45 | 44 | $wpdb->insert($wpdb->prefix . 'wppm\_task\_comment',$log\_values); |
  | 46 |  | $log\_id = ~~$wpdb->insert\_id~~; |
  | 47 |  | $task\_log\_values = array('task\_id'=>~~$task\_id,'comment\_id'=>$log\_id~~,'comment\_type'=>'change\_task\_status'); |
  |  | 45 | $log\_id = esc\_sql($wpdb->insert\_id); |
  |  | 46 | $task\_log\_values = array('task\_id'=>"$task\_id",'comment\_id'=>"$log\_id",'comment\_type'=>'change\_task\_status'); |
  | 48 | 47 | $wpdb->insert($wpdb->prefix . 'wppm\_task\_comment\_meta',$task\_log\_values); |
  | 49 | 48 | } |
* ## [taskbuilder/trunk/includes/admin/tasks/wppm\_set\_delete\_bulk\_tasks.php](/changeset/3210469/taskbuilder/trunk/includes/admin/tasks/wppm_set_delete_bulk_tasks.php "Show the changeset 3210469 restricted to taskbuilder/trunk/includes/admin/tasks/wppm_set_delete_bulk_tasks.php")

  | [r3174963](/browser/taskbuilder/trunk/includes/admin/tasks/wppm_set_delete_bulk_tasks.php?rev=3174963#L20 "Show revision 3174963 of this file in browser") | [r3210469](/browser/taskbuilder/trunk/includes/admin/tasks/wppm_set_delete_bulk_tasks.php?rev=3210469#L20 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 20 | 20 | $project\_data = $wppmfunction->get\_project($task\_data['project']); |
  | 21 | 21 | if ((($current\_user->ID && $current\_user->has\_cap('manage\_options')) || ($wppmfunction->has\_permission('delete\_task',$task\_id)) || $wppm\_current\_user\_capability == 'wppm\_admin'|| $project\_data['created\_by']==$current\_user->ID)) { |
  | 22 |  | $sql="SELECT attachment\_ids FROM {$wpdb->prefix}wppm\_task\_comment WHERE task\_id =".~~$task\_id~~; |
  |  | 22 | $sql="SELECT attachment\_ids FROM {$wpdb->prefix}wppm\_task\_comment WHERE task\_id =". esc\_sql($task\_id); |
  | 23 | 23 | $thread\_attachment\_ids= $wpdb->get\_results( $sql ); |
  | 24 | 24 | /\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*Code for deleting attachment files\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*/ |
  | […](/browser/taskbuilder/trunk/includes/admin/tasks/wppm_set_delete_bulk_tasks.php?rev=3174963#L31) | […](/browser/taskbuilder/trunk/includes/admin/tasks/wppm_set_delete_bulk_tasks.php?rev=3210469#L31) |  |
  | 31 | 31 | if(!empty($attachment\_ids\_temp)){ |
  | 32 | 32 | foreach ($attachment\_ids\_temp as $attachment\_id){ |
  | 33 |  | $sql="SELECT \* FROM {$wpdb->prefix}wppm\_attachments WHERE id =".~~$attachment\_id~~; |
  |  | 33 | $sql="SELECT \* FROM {$wpdb->prefix}wppm\_attachments WHERE id =".esc\_sql($attachment\_id); |
  | 34 | 34 | $result=$wpdb->get\_row($sql); |
  | 35 | 35 | if(!empty($result)){ |
  | 36 |  | $sql\_query="SELECT file\_path FROM {$wpdb->prefix}wppm\_attachments WHERE file\_path ='".~~$result->file\_path~~."'"; |
  |  | 36 | $sql\_query="SELECT file\_path FROM {$wpdb->prefix}wppm\_attachments WHERE file\_path ='".esc\_sql($result->file\_path)."'"; |
  | 37 | 37 | $attach\_result=$wpdb->get\_results($sql\_query); |
  | 38 | 38 | $result\_count = count($attach\_result); |
  | […](/browser/taskbuilder/trunk/includes/admin/tasks/wppm_set_delete_bulk_tasks.php?rev=3174963#L41) | […](/browser/taskbuilder/trunk/includes/admin/tasks/wppm_set_delete_bulk_tasks.php?rev=3210469#L41) |  |
  | 41 | 41 | unlink($result->file\_path); |
  | 42 | 42 | } |
  | 43 |  | $wpdb->delete($wpdb->prefix.'wppm\_attachments', array( 'id' => ~~$attachment\_id~~)); |
  |  | 43 | $wpdb->delete($wpdb->prefix.'wppm\_attachments', array( 'id' => esc\_sql($attachment\_id))); |
  | 44 | 44 | } |
  | 45 | 45 | } |
  | […](/browser/taskbuilder/trunk/includes/admin/tasks/wppm_set_delete_bulk_tasks.php?rev=3174963#L48) | […](/browser/taskbuilder/trunk/includes/admin/tasks/wppm_set_delete_bulk_tasks.php?rev=3210469#L48) |  |
  | 48 | 48 | } |
  | 49 | 49 | /\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*Code for deleting checklists\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*/ |
  | 50 |  | $sql="SELECT id FROM {$wpdb->prefix}wppm\_checklist WHERE task\_id =".~~$task\_id~~; |
  |  | 50 | $sql="SELECT id FROM {$wpdb->prefix}wppm\_checklist WHERE task\_id =".esc\_sql($task\_id); |
  | 51 | 51 | $checklists = $wpdb->get\_results( $sql ); |
  | 52 | 52 | if(!empty($checklists)){ |
  | 53 | 53 | foreach($checklists as $checklist){ |
  | 54 | 54 | $chk\_array = (array) $checklist; |
  | 55 |  | $sql="SELECT id FROM {$wpdb->prefix}wppm\_checklist\_items WHERE checklist\_id =~~".$chk\_array['id']~~; |
  |  | 55 | $sql="SELECT id FROM {$wpdb->prefix}wppm\_checklist\_items WHERE checklist\_id ='".esc\_sql($chk\_array['id']."'"); |
  | 56 | 56 | $checklist\_items = $wpdb->get\_results( $sql ); |
  | 57 | 57 | if(!empty($checklist\_items)){ |
  | 58 | 58 | foreach($checklist\_items as $ch\_item){ |
  | 59 | 59 | $chk\_items\_array = (array) $ch\_item; |
  | 60 |  | $wpdb->delete($wpdb->prefix.'wppm\_checklist\_items',array('id'=>~~$chk\_items\_array['id']~~)); |
  |  | 60 | $wpdb->delete($wpdb->prefix.'wppm\_checklist\_items',array('id'=>esc\_sql($chk\_items\_array['id']))); |
  | 61 | 61 | } |
  | 62 | 62 | } |
  | 63 |  | $wpdb->delete($wpdb->prefix.'wppm\_checklist',array('id'=>~~$chk\_array['id']~~)); |
  |  | 63 | $wpdb->delete($wpdb->prefix.'wppm\_checklist',array('id'=>esc\_sql($chk\_array['id']))); |
  | 64 | 64 | } |
  | 65 | 65 | } |
  | 66 |  | $wpdb->delete($wpdb->prefix.'wppm\_task',array('id'=>~~$task\_id~~)); |
  | 67 |  | $wpdb->delete($wpdb->prefix.'wppm\_task\_meta',array('task\_id'=>~~$task\_id~~)); |
  | 68 |  | $wpdb->delete($wpdb->prefix.'wppm\_task\_comment',array('task\_id'=>~~$task\_id~~)); |
  | 69 |  | $wpdb->delete($wpdb->prefix.'wppm\_task\_comment\_meta',array('task\_id'=>~~$task\_id~~)); |
  |  | 66 | $wpdb->delete($wpdb->prefix.'wppm\_task',array('id'=>esc\_sql($task\_id))); |
  |  | 67 | $wpdb->delete($wpdb->prefix.'wppm\_task\_meta',array('task\_id'=>esc\_sql($task\_id))); |
  |  | 68 | $wpdb->delete($wpdb->prefix.'wppm\_task\_comment',array('task\_id'=>esc\_sql($task\_id))); |
  |  | 69 | $wpdb->delete($wpdb->prefix.'wppm\_task\_comment\_meta',array('task\_id'=>esc\_sql($task\_id))); |
  | 70 | 70 | do\_action('wppm\_after\_delete\_task',$task\_id); |
  | 71 | 71 | } |
* ## [taskbuilder/trunk/includes/admin/tasks/wppm\_set\_delete\_task.php](/changeset/3210469/taskbuilder/trunk/includes/admin/tasks/wppm_set_delete_task.php "Show the changeset 3210469 restricted to taskbuilder/trunk/includes/admin/tasks/wppm_set_delete_task.php")

  | [r3174963](/browser/taskbuilder/trunk/includes/admin/tasks/wppm_set_delete_task.php?rev=3174963#L9 "Show revision 3174963 of this file in browser") | [r3210469](/browser/taskbuilder/trunk/includes/admin/tasks/wppm_set_delete_task.php?rev=3210469#L9 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 9 | 9 | wp\_send\_json\_error( 'Unauthorised request!', 401 ); |
  | 10 | 10 | } |
  | 11 |  | $sql="SELECT attachment\_ids FROM {$wpdb->prefix}wppm\_task\_comment WHERE task\_id =~~'$task\_id~~'"; |
  |  | 11 | $sql="SELECT attachment\_ids FROM {$wpdb->prefix}wppm\_task\_comment WHERE task\_id ='" .esc\_sql($task\_id)."'"; |
  | 12 | 12 | $thread\_attachment\_ids= $wpdb->get\_results( $sql ); |
  | 13 | 13 | /\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*Code for deleting attachment files\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*/ |
  | […](/browser/taskbuilder/trunk/includes/admin/tasks/wppm_set_delete_task.php?rev=3174963#L20) | […](/browser/taskbuilder/trunk/includes/admin/tasks/wppm_set_delete_task.php?rev=3210469#L20) |  |
  | 20 | 20 | if(!empty($attachment\_ids\_temp)){ |
  | 21 | 21 | foreach ($attachment\_ids\_temp as $attachment\_id){ |
  | 22 |  | $attachment\_id = esc\_sql($attachment\_id); |
  | 23 |  | $sql="SELECT \* FROM {$wpdb->prefix}wppm\_attachments WHERE id ='$attachment\_id'"; |
  |  | 22 | $sql="SELECT \* FROM {$wpdb->prefix}wppm\_attachments WHERE id  ='" .esc\_sql($attachment\_id)."'"; |
  | 24 | 23 | $result=$wpdb->get\_row($sql); |
  | 25 | 24 | if(!empty($result)){ |
  | 26 |  | $sql\_query="SELECT file\_path FROM {$wpdb->prefix}wppm\_attachments WHERE file\_path ='".~~$result->file\_path~~."'"; |
  |  | 25 | $sql\_query="SELECT file\_path FROM {$wpdb->prefix}wppm\_attachments WHERE file\_path ='".esc\_sql($result->file\_path)."'"; |
  | 27 | 26 | $attach\_result=$wpdb->get\_results($sql\_query); |
  | 28 | 27 | $result\_count = count($attach\_result); |
  | […](/browser/taskbuilder/trunk/includes/admin/tasks/wppm_set_delete_task.php?rev=3174963#L31) | […](/browser/taskbuilder/trunk/includes/admin/tasks/wppm_set_delete_task.php?rev=3210469#L30) |  |
  | 31 | 30 | unlink($result->file\_path); |
  | 32 | 31 | } |
  | 33 |  | $wpdb->delete($wpdb->prefix.'wppm\_attachments', array( 'id' => ~~$attachment\_id~~)); |
  |  | 32 | $wpdb->delete($wpdb->prefix.'wppm\_attachments', array( 'id' => esc\_sql($attachment\_id))); |
  | 34 | 33 | } |
  | 35 | 34 | } |
  | […](/browser/taskbuilder/trunk/includes/admin/tasks/wppm_set_delete_task.php?rev=3174963#L38) | […](/browser/taskbuilder/trunk/includes/admin/tasks/wppm_set_delete_task.php?rev=3210469#L37) |  |
  | 38 | 37 | } |
  | 39 | 38 | /\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*Code for deleting checklists\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*/ |
  | 40 |  | $sql="SELECT id FROM {$wpdb->prefix}wppm\_checklist WHERE task\_id =~~'$task\_id~~'"; |
  |  | 39 | $sql="SELECT id FROM {$wpdb->prefix}wppm\_checklist WHERE task\_id ='" .esc\_sql($task\_id)."'"; |
  | 41 | 40 | $checklists = $wpdb->get\_results( $sql ); |
  | 42 | 41 | if(!empty($checklists)){ |
  | […](/browser/taskbuilder/trunk/includes/admin/tasks/wppm_set_delete_task.php?rev=3174963#L44) | […](/browser/taskbuilder/trunk/includes/admin/tasks/wppm_set_delete_task.php?rev=3210469#L43) |  |
  | 44 | 43 | $chk\_array = (array) $checklist; |
  | 45 | 44 | $chk\_array\_id = esc\_sql($chk\_array['id']); |
  | 46 |  | $sql="SELECT id FROM {$wpdb->prefix}wppm\_checklist\_items WHERE checklist\_id = '~~$chk\_array\_id~~'"; |
  |  | 45 | $sql="SELECT id FROM {$wpdb->prefix}wppm\_checklist\_items WHERE checklist\_id = '".esc\_sql($chk\_array\_id)."'"; |
  | 47 | 46 | $checklist\_items = $wpdb->get\_results( $sql ); |
  | 48 | 47 | if(!empty($checklist\_items)){ |
  | […](/browser/taskbuilder/trunk/includes/admin/tasks/wppm_set_delete_task.php?rev=3174963#L53) | […](/browser/taskbuilder/trunk/includes/admin/tasks/wppm_set_delete_task.php?rev=3210469#L52) |  |
  | 53 | 52 | } |
  | 54 | 53 | } |
  | 55 |  | $wpdb->delete($wpdb->prefix.'wppm\_checklist',array('id'=>~~$chk\_array['id']~~)); |
  |  | 54 | $wpdb->delete($wpdb->prefix.'wppm\_checklist',array('id'=>"$chk\_array\_id")); |
  | 56 | 55 | } |
  | 57 | 56 | } |
  | 58 |  | $wpdb->delete($wpdb->prefix.'wppm\_task',array('id'=>~~$task\_id~~)); |
  | 59 |  | $wpdb->delete($wpdb->prefix.'wppm\_task\_meta',array('task\_id'=>~~$task\_id~~)); |
  | 60 |  | $wpdb->delete($wpdb->prefix.'wppm\_task\_comment',array('task\_id'=>~~$task\_id~~)); |
  | 61 |  | $wpdb->delete($wpdb->prefix.'wppm\_task\_comment\_meta',array('task\_id'=>~~$task\_id~~)); |
  |  | 57 | $wpdb->delete($wpdb->prefix.'wppm\_task',array('id'=>esc\_sql($task\_id))); |
  |  | 58 | $wpdb->delete($wpdb->prefix.'wppm\_task\_meta',array('task\_id'=>esc\_sql($task\_id))); |
  |  | 59 | $wpdb->delete($wpdb->prefix.'wppm\_task\_comment',array('task\_id'=>esc\_sql($task\_id))); |
  |  | 60 | $wpdb->delete($wpdb->prefix.'wppm\_task\_comment\_meta',array('task\_id'=>esc\_sql($task\_id))); |
  | 62 | 61 | do\_action('wppm\_after\_delete\_task',$task\_id); |
* ## [taskbuilder/trunk/includes/admin/tasks/wppm\_tasks\_list.php](/changeset/3210469/taskbuilder/trunk/includes/admin/tasks/wppm_tasks_list.php "Show the changeset 3210469 restricted to taskbuilder/trunk/includes/admin/tasks/wppm_tasks_list.php")

  | [r3191970](/browser/taskbuilder/trunk/includes/admin/tasks/wppm_tasks_list.php?rev=3191970#L15 "Show revision 3191970 of this file in browser") | [r3210469](/browser/taskbuilder/trunk/includes/admin/tasks/wppm_tasks_list.php?rev=3210469#L15 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 15 | 15 | $wppm\_create\_tasks\_coworkers\_permission = get\_option('wppm\_allow\_coworkers\_create\_task'); |
  | 16 | 16 | $orderby\_proj\_sql = esc\_sql(sanitize\_sql\_orderby( "project\_name" )); |
  |  | 17 | $proj\_attr = esc\_sql($proj\_attr); |
  | 17 | 18 | if(!empty($proj\_attr )){ |
  | 18 | 19 | $wppm\_proj\_attr = ' AND (proj.project\_name = "'.$proj\_attr.'")'; |
  | […](/browser/taskbuilder/trunk/includes/admin/tasks/wppm_tasks_list.php?rev=3191970#L21) | […](/browser/taskbuilder/trunk/includes/admin/tasks/wppm_tasks_list.php?rev=3210469#L22) |  |
  | 21 | 22 | } |
  | 22 | 23 | $current\_date = date('Y-m-d'); |
  |  | 24 | $current\_date = esc\_sql($current\_date ); |
  |  | 25 | $cu\_id = esc\_sql($current\_user->ID); |
  | 23 | 26 | $wppm\_task\_time = get\_option('wppm\_task\_time'); |
  | 24 | 27 | $query = ("SELECT proj.\* |
  | […](/browser/taskbuilder/trunk/includes/admin/tasks/wppm_tasks_list.php?rev=3191970#L32) | […](/browser/taskbuilder/trunk/includes/admin/tasks/wppm_tasks_list.php?rev=3210469#L35) |  |
  | 32 | 35 | } |
  | 33 | 36 | }else{ |
  | 34 |  | $where =  " where ((FIND\_IN\_SET(~~$current\_user->ID,proj.users)) OR (proj.id = proj\_meta.project\_id AND proj\_meta.meta\_key='public\_project' AND proj\_meta.meta\_value=1) OR ( proj.created\_by='$current\_user->ID')) $wppm\_proj\_attr Group by proj.id ORDER BY ".$orderby\_proj\_sql~~; |
  |  | 37 | $where =  " where ((FIND\_IN\_SET('$current\_user->ID',proj.users)) OR (proj.id = proj\_meta.project\_id AND proj\_meta.meta\_key='public\_project' AND proj\_meta.meta\_value=1) OR ( proj.created\_by='$cu\_id')) $wppm\_proj\_attr Group by proj.id ORDER BY $orderby\_proj\_sql"; |
  | 35 | 38 | } |
  | 36 | 39 | $where = apply\_filters('wppm\_project\_filter\_in\_task\_list\_where',$where); |
  | […](/browser/taskbuilder/trunk/includes/admin/tasks/wppm_tasks_list.php?rev=3191970#L58) | […](/browser/taskbuilder/trunk/includes/admin/tasks/wppm_tasks_list.php?rev=3210469#L61) |  |
  | 58 | 61 | $filter\_by = isset($\_POST['wppm\_task\_filter']) ? sanitize\_text\_field($\_POST['wppm\_task\_filter']) : $tl\_filters\_arr['filter']; |
  | 59 | 62 | $proj\_filter = isset($\_POST['wppm\_proj\_filter']) ? sanitize\_text\_field($\_POST['wppm\_proj\_filter']) : $tl\_filters\_arr['proj\_filter']; |
  |  | 63 | $proj\_filter = esc\_sql($proj\_filter); |
  | 60 | 64 | if($sort\_by == ""){ |
  | 61 | 65 | $sort\_by = 'task\_name'; |
  | […](/browser/taskbuilder/trunk/includes/admin/tasks/wppm_tasks_list.php?rev=3191970#L149) | […](/browser/taskbuilder/trunk/includes/admin/tasks/wppm_tasks_list.php?rev=3210469#L153) |  |
  | 149 | 153 | $where = " where $wppm\_tl\_filter AND $wppm\_task\_by\_proj\_filter AND (Task.task\_name LIKE '$search\_tag\_text' OR proj.project\_name LIKE '$search\_tag\_text' OR task\_statuses.name LIKE '$search\_tag\_text' OR task\_priorities.name LIKE '$search\_tag\_text' OR user.display\_name LIKE '$search\_tag\_text') $wppm\_proj\_attr "; |
  | 150 | 154 | } else{ |
  | 151 |  | $where = " where $wppm\_tl\_filter AND $wppm\_task\_by\_proj\_filter AND (((FIND\_IN\_SET('$current\_user->ID',Task.users)>0) OR (Task.created\_by= '$cu~~rrent\_user->ID') OR (proj\_users.user\_id = '$current\_user->ID' AND proj\_users.role\_id = 1 AND (FIND\_IN\_SET('$current\_user->ID',proj.users)>0)) OR (Task.project = proj\_meta.project\_id AND proj\_meta.meta\_key='public\_project' AND proj\_meta.meta\_value=1) OR (proj.created\_by='$current\_user->ID~~' AND (FIND\_IN\_SET('$current\_user->ID',proj.users)>0))) AND (Task.task\_name LIKE '$search\_tag\_text' OR proj.project\_name LIKE '$search\_tag\_text' OR task\_statuses.name LIKE '$search\_tag\_text' OR task\_priorities.name LIKE '$search\_tag\_text' OR user.display\_name LIKE '$search\_tag\_text')) $wppm\_proj\_attr"; |
  |  | 155 | $where = " where $wppm\_tl\_filter AND $wppm\_task\_by\_proj\_filter AND (((FIND\_IN\_SET('$current\_user->ID',Task.users)>0) OR (Task.created\_by= '$cu\_id') OR (proj\_users.user\_id = '$cu\_id' AND proj\_users.role\_id = 1 AND (FIND\_IN\_SET('$current\_user->ID',proj.users)>0)) OR (Task.project = proj\_meta.project\_id AND proj\_meta.meta\_key='public\_project' AND proj\_meta.meta\_value=1) OR (proj.created\_by='$cu\_id' AND (FIND\_IN\_SET('$current\_user->ID',proj.users)>0))) AND (Task.task\_name LIKE '$search\_tag\_text' OR proj.project\_name LIKE '$search\_tag\_text' OR task\_statuses.name LIKE '$search\_tag\_text' OR task\_priorities.name LIKE '$search\_tag\_text' OR user.display\_name LIKE '$search\_tag\_text')) $wppm\_proj\_attr"; |
  | 152 | 156 | } |
  | 153 | 157 | }else{ |
  | […](/browser/taskbuilder/trunk/includes/admin/tasks/wppm_tasks_list.php?rev=3191970#L155) | […](/browser/taskbuilder/trunk/includes/admin/tasks/wppm_tasks_list.php?rev=3210469#L159) |  |
  | 155 | 159 | $where = " where $wppm\_tl\_filter AND $wppm\_task\_by\_proj\_filter $wppm\_proj\_attr"; |
  | 156 | 160 | } else{ |
  | 157 |  | $where = " where $wppm\_tl\_filter AND $wppm\_task\_by\_proj\_filter AND ((FIND\_IN\_SET('$current\_user->ID',Task.users)>0) OR (Task.created\_by= '$cu~~rrent\_user->ID') OR (proj\_users.user\_id = '$current\_user->ID' AND proj\_users.role\_id = 1 AND (FIND\_IN\_SET('$current\_user->ID',proj.users)>0)) OR (Task.project = proj\_meta.project\_id AND proj\_meta.meta\_key='public\_project' AND proj\_meta.meta\_value=1) OR (proj.created\_by='$current\_user->ID~~' AND (FIND\_IN\_SET('$current\_user->ID',proj.users)>0))) $wppm\_proj\_attr"; |
  |  | 161 | $where = " where $wppm\_tl\_filter AND $wppm\_task\_by\_proj\_filter AND ((FIND\_IN\_SET('$current\_user->ID',Task.users)>0) OR (Task.created\_by= '$cu\_id') OR (proj\_users.user\_id = '$cu\_id' AND proj\_users.role\_id = 1 AND (FIND\_IN\_SET('$current\_user->ID',proj.users)>0)) OR (Task.project = proj\_meta.project\_id AND proj\_meta.meta\_key='public\_project' AND proj\_meta.meta\_value=1) OR (proj.created\_by='$cu\_id' AND (FIND\_IN\_SET('$current\_user->ID',proj.users)>0))) $wppm\_proj\_attr"; |
  | 158 | 162 | } |
  | 159 | 163 | } |
  | […](/browser/taskbuilder/trunk/includes/admin/tasks/wppm_tasks_list.php?rev=3191970#L165) | […](/browser/taskbuilder/trunk/includes/admin/tasks/wppm_tasks_list.php?rev=3210469#L169) |  |
  | 165 | 169 | $no\_of\_rows = apply\_filters('wppm\_task\_list\_no\_of\_rows',$no\_of\_rows,$wppm\_tl\_filter,$search\_tag\_text); |
  | 166 | 170 | $totalrows = $wpdb->get\_var($no\_of\_rows); |
  | 167 |  | $query .= $where." Group by Task.id ORDER BY $sort\_by $order"; |
  |  | 171 | $sort\_by = esc\_sql($sort\_by); |
  |  | 172 | $order = esc\_sql($order); |
  |  | 173 | $query .= $where." Group by Task.id ORDER BY ".$sort\_by." ".$order.""; |
  | 168 | 174 | $query = apply\_filters('wppm\_task\_list\_query',$query); |
  | 169 | 175 | $limit\_start=$page\_no\*$task\_per\_page; |
  | […](/browser/taskbuilder/trunk/includes/admin/tasks/wppm_tasks_list.php?rev=3191970#L173) | […](/browser/taskbuilder/trunk/includes/admin/tasks/wppm_tasks_list.php?rev=3210469#L179) |  |
  | 173 | 179 | $wppm\_task\_fillter = $wpdb->get\_results($query); |
  | 174 | 180 | $flag = false; |
  | 175 |  | $project\_creator = $wpdb->get\_var("SELECT created\_by FROM {$wpdb->prefix}wppm\_project WHERE created\_by = '$cu~~rrent\_user->ID~~'"); |
  |  | 181 | $project\_creator = $wpdb->get\_var("SELECT created\_by FROM {$wpdb->prefix}wppm\_project WHERE created\_by = '$cu\_id'"); |
  | 176 | 182 | if(!empty($wppm\_task\_fillter)){ |
  | 177 | 183 | foreach($wppm\_task\_fillter as $key\_filter=>$val\_filter){ |
  | […](/browser/taskbuilder/trunk/includes/admin/tasks/wppm_tasks_list.php?rev=3191970#L179) | […](/browser/taskbuilder/trunk/includes/admin/tasks/wppm_tasks_list.php?rev=3210469#L185) |  |
  | 179 | 185 | $tusers =  $val\_array['users']; |
  | 180 | 186 | $tusers\_arr = explode(',',$tusers); |
  | 181 |  | $tproject\_id = ~~$val\_array['project']~~; |
  |  | 187 | $tproject\_id = esc\_sql($val\_array['project']); |
  | 182 | 188 | if(!empty($tusers) && in\_array($current\_user->ID,$tusers\_arr)){ |
  | 183 |  | $project\_user\_role = $wpdb->get\_var("SELECT role\_id FROM {$wpdb->prefix}wppm\_project\_users WHERE proj\_id = '$tproject\_id' AND user\_id = '$cu~~rrent\_user->ID~~'"); |
  |  | 189 | $project\_user\_role = $wpdb->get\_var("SELECT role\_id FROM {$wpdb->prefix}wppm\_project\_users WHERE proj\_id = '$tproject\_id' AND user\_id = '$cu\_id'"); |
  | 184 | 190 | $project\_users = $wpdb->get\_var("SELECT users FROM {$wpdb->prefix}wppm\_project WHERE id = '$tproject\_id'"); |
  | 185 | 191 | $project\_users\_arr = explode(',',(string)$project\_users); |
  | […](/browser/taskbuilder/trunk/includes/admin/tasks/wppm_tasks_list.php?rev=3191970#L285) | […](/browser/taskbuilder/trunk/includes/admin/tasks/wppm_tasks_list.php?rev=3210469#L291) |  |
  | 285 | 291 | <thead> |
  | 286 | 292 | <tr> |
  | 287 |  | <th style="~~width: 45px;"~~  onchange="wppm\_bulk\_select\_change()"> |
  |  | 293 | <th style="background-color:<?php echo esc\_attr($appearance\_settings['list-header-background-color'])?>" onchange="wppm\_bulk\_select\_change()"> |
  | 288 | 294 | <div class="checkbox-container"> |
  | 289 | 295 | <input id="wppm\_bulk\_select\_option" class="wppm-bulk-selector" type="checkbox" onchange="wppm\_bulk\_select\_change();"/> |
* ## [taskbuilder/trunk/includes/class-wppm-functions.php](/changeset/3210469/taskbuilder/trunk/includes/class-wppm-functions.php "Show the changeset 3210469 restricted to taskbuilder/trunk/includes/class-wppm-functions.php")

  | [r3191970](/browser/taskbuilder/trunk/includes/class-wppm-functions.php?rev=3191970#L128 "Show revision 3191970 of this file in browser") | [r3210469](/browser/taskbuilder/trunk/includes/class-wppm-functions.php?rev=3210469#L128 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 128 | 128 | global $wpdb; |
  | 129 | 129 | $id = esc\_sql($id); |
  | 130 |  | $auth\_code = $wpdb->get\_var( "SELECT task\_auth\_code FROM {$wpdb->prefix}wppm\_task where id=~~$id~~" ); |
  |  | 130 | $auth\_code = $wpdb->get\_var( "SELECT task\_auth\_code FROM {$wpdb->prefix}wppm\_task where id='$id'" ); |
  | 131 | 131 | $auth\_code = isset($auth\_code) ? $auth\_code : ""; |
  | 132 | 132 | return $auth\_code; |
  | […](/browser/taskbuilder/trunk/includes/class-wppm-functions.php?rev=3191970#L158) | […](/browser/taskbuilder/trunk/includes/class-wppm-functions.php?rev=3210469#L158) |  |
  | 158 | 158 | global $wpdb; |
  | 159 | 159 | $task\_data = array(); |
  |  | 160 | $task\_id = esc\_sql($task\_id); |
  | 160 | 161 | $task = $wpdb->get\_row("SELECT \* FROM {$wpdb->prefix}wppm\_task WHERE id='$task\_id' "); |
  | 161 | 162 | if( $task ){ |
  | […](/browser/taskbuilder/trunk/includes/class-wppm-functions.php?rev=3191970#L221) | […](/browser/taskbuilder/trunk/includes/class-wppm-functions.php?rev=3210469#L222) |  |
  | 221 | 222 | $comment\_id = 0; |
  | 222 | 223 | } |
  |  | 224 | $comment\_id = esc\_sql($comment\_id); |
  | 223 | 225 | $task\_data = $wppmfunction->get\_task($task\_id); |
  | 224 | 226 | $task\_comment = $wpdb->get\_row("SELECT \* FROM {$wpdb->prefix}wppm\_task\_comment WHERE task\_id = '$task\_id' AND id = '$comment\_id'"); |
  | […](/browser/taskbuilder/trunk/includes/class-wppm-functions.php?rev=3191970#L228) | […](/browser/taskbuilder/trunk/includes/class-wppm-functions.php?rev=3210469#L230) |  |
  | 228 | 230 | $project\_id = esc\_sql($project\_id); |
  | 229 | 231 | $project\_data = $wppmfunction->get\_project($project\_id); |
  | 230 |  | $project\_user\_role = $wpdb->get\_var("SELECT role\_id FROM {$wpdb->prefix}wppm\_project\_users WHERE proj\_id = '$project\_id' AND user\_id = '$current\_user->ID'"); |
  |  | 232 | $cu\_user\_id = esc\_sql($current\_user->ID); |
  |  | 233 | $project\_user\_role = $wpdb->get\_var("SELECT role\_id FROM {$wpdb->prefix}wppm\_project\_users WHERE proj\_id = '$project\_id' AND user\_id = ' $cu\_user\_id'"); |
  | 231 | 234 | $project\_users = $wpdb->get\_var("SELECT users FROM {$wpdb->prefix}wppm\_project WHERE id = '$project\_id'"); |
  | 232 | 235 | $project\_users\_arr = explode(',',(string)$project\_users); |
  | […](/browser/taskbuilder/trunk/includes/class-wppm-functions.php?rev=3191970#L301) | […](/browser/taskbuilder/trunk/includes/class-wppm-functions.php?rev=3210469#L304) |  |
  | 301 | 304 | $project\_id = $task\_data['project']; |
  | 302 | 305 | $project\_id = esc\_sql($project\_id); |
  |  | 306 | $cu\_id = esc\_sql($current\_user->ID); |
  | 303 | 307 | $project\_data = $wppmfunction->get\_project($project\_id); |
  | 304 |  | $project\_user = $wpdb->get\_row("SELECT \* FROM {$wpdb->prefix}wppm\_project\_users WHERE proj\_id = '$project\_id' AND user\_id = '$cu~~rrent\_user->ID~~'"); |
  |  | 308 | $project\_user = $wpdb->get\_row("SELECT \* FROM {$wpdb->prefix}wppm\_project\_users WHERE proj\_id = '$project\_id' AND user\_id = '$cu\_id'"); |
  | 305 | 309 | $project\_users = $wpdb->get\_var("SELECT users FROM {$wpdb->prefix}wppm\_project WHERE id = '$project\_id'"); |
  | 306 | 310 | $project\_users\_arr = explode(',',(string)$project\_users); |
  | […](/browser/taskbuilder/trunk/includes/class-wppm-functions.php?rev=3191970#L337) | […](/browser/taskbuilder/trunk/includes/class-wppm-functions.php?rev=3210469#L341) |  |
  | 337 | 341 | $proj\_id = esc\_sql($proj\_id); |
  | 338 | 342 | $comment\_id = esc\_sql($comment\_id); |
  |  | 343 | $cu\_id = esc\_sql($current\_user->ID); |
  | 339 | 344 | if(empty($comment\_id)){ |
  | 340 | 345 | $comment\_id = 0; |
  | 341 | 346 | } |
  | 342 |  | $project\_user = $wpdb->get\_row("SELECT \* FROM {$wpdb->prefix}wppm\_project\_users WHERE proj\_id = '$proj\_id' AND user\_id = '~~$current\_user->ID~~'"); |
  |  | 347 | $project\_user = $wpdb->get\_row("SELECT \* FROM {$wpdb->prefix}wppm\_project\_users WHERE proj\_id = '$proj\_id' AND user\_id = ' $cu\_id '"); |
  | 343 | 348 | $project\_users = $wpdb->get\_var("SELECT users FROM {$wpdb->prefix}wppm\_project WHERE id = '$proj\_id'"); |
  | 344 | 349 | $project\_users\_arr = explode(',',(string)$project\_users); |
  | […](/browser/taskbuilder/trunk/includes/class-wppm-functions.php?rev=3191970#L369) | […](/browser/taskbuilder/trunk/includes/class-wppm-functions.php?rev=3210469#L374) |  |
  | 369 | 374 | $project\_data = $wppmfunction->get\_project($project\_id); |
  | 370 | 375 | $project\_id = esc\_sql($project\_id); |
  | 371 |  | $project\_user = $wpdb->get\_row("SELECT \* FROM {$wpdb->prefix}wppm\_project\_users WHERE proj\_id = '$project\_id' AND user\_id = '$current\_user->ID'"); |
  |  | 376 | $cu\_id = esc\_sql($current\_user->ID); |
  |  | 377 | $project\_user = $wpdb->get\_row("SELECT \* FROM {$wpdb->prefix}wppm\_project\_users WHERE proj\_id = ".esc\_sql($project\_id)." AND user\_id = ".esc\_sql($cu\_id).""); |
  | 372 | 378 | $project\_users = $wpdb->get\_var("SELECT users FROM {$wpdb->prefix}wppm\_project WHERE id = '$project\_id'"); |
  | 373 | 379 | $project\_users\_arr = explode(',',(string)$project\_users); |
  | […](/browser/taskbuilder/trunk/includes/class-wppm-functions.php?rev=3191970#L403) | […](/browser/taskbuilder/trunk/includes/class-wppm-functions.php?rev=3210469#L409) |  |
  | 403 | 409 | $prev\_status = $task\_data['status']; |
  | 404 | 410 | $values=array( |
  | 405 |  | 'status'=>~~$status\_id~~ |
  | 406 |  | ); |
  | 407 |  | $wpdb->update($wpdb->prefix.'wppm\_task', $values, array('id'=>~~$task\_id~~)); |
  |  | 411 | 'status'=>esc\_sql($status\_id) |
  |  | 412 | ); |
  |  | 413 | $wpdb->update($wpdb->prefix.'wppm\_task', $values, array('id'=>esc\_sql($task\_id))); |
  | 408 | 414 | $old\_task\_status\_meta = $wppmfunction->get\_task\_meta($task\_id,'old\_task\_status',true); |
  | 409 | 415 | if(!empty($old\_task\_status\_meta)){ |
  | […](/browser/taskbuilder/trunk/includes/class-wppm-functions.php?rev=3191970#L418) | […](/browser/taskbuilder/trunk/includes/class-wppm-functions.php?rev=3210469#L424) |  |
  | 418 | 424 | global $wpdb; |
  | 419 | 425 | $values=array( |
  | 420 |  | 'created\_by'=>~~$user\_id~~ |
  | 421 |  | ); |
  | 422 |  | $wpdb->update($wpdb->prefix.'wppm\_task', $values, array('id'=>~~$task\_id~~)); |
  |  | 426 | 'created\_by'=>esc\_sql($user\_id) |
  |  | 427 | ); |
  |  | 428 | $wpdb->update($wpdb->prefix.'wppm\_task', $values, array('id'=>esc\_sql($task\_id))); |
  | 423 | 429 | } |
  | 424 | 430 |  |
  | […](/browser/taskbuilder/trunk/includes/class-wppm-functions.php?rev=3191970#L428) | […](/browser/taskbuilder/trunk/includes/class-wppm-functions.php?rev=3210469#L434) |  |
  | 428 | 434 | 'task\_name'=>stripslashes($task\_label) |
  | 429 | 435 | ); |
  | 430 |  | $wpdb->update($wpdb->prefix.'wppm\_task', $values, array('id'=>~~$task\_id~~)); |
  |  | 436 | $wpdb->update($wpdb->prefix.'wppm\_task', $values, array('id'=>esc\_sql($task\_id))); |
  | 431 | 437 | } |
  | 432 | 438 |  |
  | […](/browser/taskbuilder/trunk/includes/class-wppm-functions.php?rev=3191970#L434) | […](/browser/taskbuilder/trunk/includes/class-wppm-functions.php?rev=3210469#L440) |  |
  | 434 | 440 | global $wpdb; |
  | 435 | 441 | $values=array( |
  | 436 |  | 'project'=>~~$project\_label~~ |
  | 437 |  | ); |
  | 438 |  | $wpdb->update($wpdb->prefix.'wppm\_task', $values, array('id'=>~~$task\_id~~)); |
  |  | 442 | 'project'=>esc\_sql($project\_label) |
  |  | 443 | ); |
  |  | 444 | $wpdb->update($wpdb->prefix.'wppm\_task', $values, array('id'=>esc\_sql($task\_id))); |
  | 439 | 445 | } |
  | 440 | 446 |  |
  | […](/browser/taskbuilder/trunk/includes/class-wppm-functions.php?rev=3191970#L442) | […](/browser/taskbuilder/trunk/includes/class-wppm-functions.php?rev=3210469#L448) |  |
  | 442 | 448 | global $wpdb; |
  | 443 | 449 | $values=array( |
  | 444 |  | 'start\_date'=>~~$task\_start\_date~~ |
  | 445 |  | ); |
  | 446 |  | $wpdb->update($wpdb->prefix.'wppm\_task', $values, array('id'=>~~$task\_id~~)); |
  |  | 450 | 'start\_date'=>esc\_sql($task\_start\_date) |
  |  | 451 | ); |
  |  | 452 | $wpdb->update($wpdb->prefix.'wppm\_task', $values, array('id'=>esc\_sql($task\_id))); |
  | 447 | 453 | } |
  | 448 | 454 |  |
  | […](/browser/taskbuilder/trunk/includes/class-wppm-functions.php?rev=3191970#L450) | […](/browser/taskbuilder/trunk/includes/class-wppm-functions.php?rev=3210469#L456) |  |
  | 450 | 456 | global $wpdb; |
  | 451 | 457 | $values=array( |
  | 452 |  | 'end\_date'=>~~$task\_end\_date~~ |
  | 453 |  | ); |
  | 454 |  | $wpdb->update($wpdb->prefix.'wppm\_task', $values, array('id'=>~~$task\_id~~)); |
  |  | 458 | 'end\_date'=>esc\_sql($task\_end\_date) |
  |  | 459 | ); |
  |  | 460 | $wpdb->update($wpdb->prefix.'wppm\_task', $values, array('id'=>esc\_sql($task\_id))); |
  | 455 | 461 | } |
  | 456 | 462 |  |
  | […](/browser/taskbuilder/trunk/includes/class-wppm-functions.php?rev=3191970#L458) | […](/browser/taskbuilder/trunk/includes/class-wppm-functions.php?rev=3210469#L464) |  |
  | 458 | 464 | global $wpdb; |
  | 459 | 465 | $values=array( |
  | 460 |  | 'priority'=>~~$task\_priority~~ |
  | 461 |  | ); |
  | 462 |  | $wpdb->update($wpdb->prefix.'wppm\_task', $values, array('id'=>~~$task\_id~~)); |
  |  | 466 | 'priority'=>esc\_sql($task\_priority) |
  |  | 467 | ); |
  |  | 468 | $wpdb->update($wpdb->prefix.'wppm\_task', $values, array('id'=>esc\_sql($task\_id))); |
  | 463 | 469 | } |
  | 464 | 470 |  |
  | 465 | 471 | public function change\_description($task\_id, $task\_description){ |
  | 466 | 472 | global $wpdb; |
  |  | 473 | $task\_description = wp\_kses\_post($task\_description); |
  | 467 | 474 | $values=array( |
  | 468 | 475 | 'description'=>$task\_description |
  | 469 | 476 | ); |
  | 470 |  | $wpdb->update($wpdb->prefix.'wppm\_task', $values, array('id'=>~~$task\_id~~)); |
  |  | 477 | $wpdb->update($wpdb->prefix.'wppm\_task', $values, array('id'=>esc\_sql($task\_id))); |
  | 471 | 478 | } |
  | 472 | 479 |  |
  | […](/browser/taskbuilder/trunk/includes/class-wppm-functions.php?rev=3191970#L490) | […](/browser/taskbuilder/trunk/includes/class-wppm-functions.php?rev=3210469#L497) |  |
  | 490 | 497 | foreach($task\_users\_array as $tuser){ |
  | 491 | 498 | if(!in\_array($tuser,$project\_users)){ |
  | 492 |  | $wpdb->delete( $wpdb->prefix.'wppm\_project\_users', array( 'proj\_id' => ~~$proj\_id,'user\_id'=>$tuser~~) ); |
  |  | 499 | $wpdb->delete( $wpdb->prefix.'wppm\_project\_users', array( 'proj\_id' => "$proj\_id",'user\_id'=>"$tuser") ); |
  | 493 | 500 | } |
  | 494 | 501 | elseif(in\_array($tuser,$project\_users)){ |
  | 495 | 502 | $tusers\_array[] = $tuser; |
  | 496 |  | $sql = 'SELECT role\_id FROM ' . $wpdb->prefix . 'wppm\_project\_users WHERE proj\_id = ' . $old\_proj .' AND user\_id = '.$tuser; |
  |  | 503 | $tuser = esc\_sql($tuser); |
  |  | 504 | $sql = 'SELECT role\_id FROM ' . $wpdb->prefix . 'wppm\_project\_users WHERE proj\_id = ' . $old\_proj .' AND user\_id = '."$tuser"; |
  | 497 | 505 | $old\_proj\_user\_role =  $wpdb->get\_var( $sql ); |
  | 498 |  | $sql = 'SELECT role\_id FROM ' . $wpdb->prefix . 'wppm\_project\_users WHERE proj\_id = ' . $proj\_id .' AND user\_id = '.~~$tuser~~; |
  |  | 506 | $sql = 'SELECT role\_id FROM ' . $wpdb->prefix . 'wppm\_project\_users WHERE proj\_id = ' . $proj\_id .' AND user\_id = '."$tuser"; |
  | 499 | 507 | $proj\_users\_role =  $wpdb->get\_var( $sql ); |
  | 500 | 508 | if(!empty( $old\_proj\_user\_role) && $old\_proj\_user\_role!=$proj\_users\_role){ |
  | 501 | 509 | $value=array( |
  | 502 |  | 'role\_id'=>~~$proj\_users\_role~~ |
  |  | 510 | 'role\_id'=>esc\_sql($proj\_users\_role) |
  | 503 | 511 | ); |
  | 504 |  | $wpdb->update($wpdb->prefix.'wppm\_project\_users', $value, array('proj\_id'=>~~$proj\_id, 'user\_id'=>$tuser~~)); |
  |  | 512 | $wpdb->update($wpdb->prefix.'wppm\_project\_users', $value, array('proj\_id'=>"$proj\_id", 'user\_id'=>"$tuser")); |
  | 505 | 513 | } |
  | 506 | 514 | } |
  | […](/browser/taskbuilder/trunk/includes/class-wppm-functions.php?rev=3191970#L510) | […](/browser/taskbuilder/trunk/includes/class-wppm-functions.php?rev=3210469#L518) |  |
  | 510 | 518 | $tusers = implode(",",$tusers\_array); |
  | 511 | 519 | $values=array( |
  | 512 |  | 'project'=>~~$proj\_id~~, |
  | 513 |  | 'users'=>~~$tusers~~ |
  | 514 |  | ); |
  | 515 |  | $wpdb->update($wpdb->prefix.'wppm\_task', $values, array('id'=>~~$task\_id~~)); |
  |  | 520 | 'project'=>esc\_sql($proj\_id), |
  |  | 521 | 'users'=>esc\_sql($tusers) |
  |  | 522 | ); |
  |  | 523 | $wpdb->update($wpdb->prefix.'wppm\_task', $values, array('id'=>esc\_sql($task\_id))); |
  | 516 | 524 | } |
  | 517 | 525 |  |
  | […](/browser/taskbuilder/trunk/includes/class-wppm-functions.php?rev=3191970#L541) | […](/browser/taskbuilder/trunk/includes/class-wppm-functions.php?rev=3210469#L549) |  |
  | 541 | 549 | global $wpdb; |
  | 542 | 550 | $comment\_id = esc\_sql($comment\_id); |
  | 543 |  | $comment\_body = ~~esc\_sql~~($comment\_body); |
  |  | 551 | $comment\_body = wp\_kses\_post($comment\_body); |
  | 544 | 552 | $values=array( |
  | 545 | 553 | 'body'=>$comment\_body |
  | 546 | 554 | ); |
  | 547 |  | $wpdb->update($wpdb->prefix.'wppm\_task\_comment', $values, array('id'=>~~$comment\_id~~)); |
  |  | 555 | $wpdb->update($wpdb->prefix.'wppm\_task\_comment', $values, array('id'=>"$comment\_id")); |
  | 548 | 556 | } |
  | 549 | 557 |  |
  | […](/browser/taskbuilder/trunk/includes/class-wppm-functions.php?rev=3191970#L551) | […](/browser/taskbuilder/trunk/includes/class-wppm-functions.php?rev=3210469#L559) |  |
  | 551 | 559 | global $wpdb; |
  | 552 | 560 | $comment\_id = esc\_sql($comment\_id); |
  | 553 |  | $comment\_body = ~~esc\_sql~~($comment\_body); |
  |  | 561 | $comment\_body = wp\_kses\_post($comment\_body); |
  | 554 | 562 | $values=array( |
  | 555 | 563 | 'body'=>$comment\_body |
  | 556 | 564 | ); |
  | 557 |  | $wpdb->update($wpdb->prefix.'wppm\_project\_comment', $values, array('id'=>~~$comment\_id~~)); |
  |  | 565 | $wpdb->update($wpdb->prefix.'wppm\_project\_comment', $values, array('id'=>"$comment\_id")); |
  | 558 | 566 | } |
  | 559 | 567 |  |
  | […](/browser/taskbuilder/trunk/includes/class-wppm-functions.php?rev=3191970#L561) | […](/browser/taskbuilder/trunk/includes/class-wppm-functions.php?rev=3210469#L569) |  |
  | 561 | 569 | global $wpdb; |
  | 562 | 570 | $project\_id = esc\_sql($project\_id); |
  | 563 |  | $project\_label = esc\_sql($project\_label); |
  | 564 |  | $values=array( |
  | 565 |  | 'project\_name'=>$project\_label |
  |  | 571 | $values=array( |
  |  | 572 | 'project\_name'=>esc\_sql($project\_label) |
  |  | 573 | ); |
  |  | 574 | $wpdb->update($wpdb->prefix.'wppm\_project', $values, array('id'=>"$project\_id")); |
  |  | 575 | } |
  |  | 576 |  |
  |  | 577 | public function change\_project\_start\_date($project\_id, $project\_start\_date){ |
  |  | 578 | global $wpdb; |
  |  | 579 | $project\_id = esc\_sql($project\_id); |
  |  | 580 | $project\_start\_date = esc\_sql($project\_start\_date); |
  |  | 581 | $values=array( |
  |  | 582 | 'start\_date'=>$project\_start\_date |
  |  | 583 | ); |
  |  | 584 | $wpdb->update($wpdb->prefix.'wppm\_project', $values, array('id'=>"$project\_id")); |
  |  | 585 | } |
  |  | 586 |  |
  |  | 587 | public function change\_project\_end\_date($project\_id, $project\_end\_date){ |
  |  | 588 | global $wpdb; |
  |  | 589 | $project\_id = esc\_sql($project\_id); |
  |  | 590 | $project\_end\_date = esc\_sql($project\_end\_date); |
  |  | 591 | $values=array( |
  |  | 592 | 'end\_date'=>$project\_end\_date |
  | 566 | 593 | ); |
  | 567 | 594 | $wpdb->update($wpdb->prefix.'wppm\_project', $values, array('id'=>$project\_id)); |
  | 568 | 595 | } |
  | 569 | 596 |  |
  | 570 |  | ~~public function change\_project\_start\_date($project\_id, $project\_start\_date){~~ |
  | 571 |  | ~~global $wpdb;~~ |
  | 572 |  | ~~$project\_id = esc\_sql($project\_id);~~ |
  | 573 |  | ~~$project\_start\_date = esc\_sql($project\_start\_date);~~ |
  | 574 |  | ~~$values=array(~~ |
  | 575 |  | ~~'start\_date'=>$project\_start\_date~~ |
  | 576 |  | ~~);~~ |
  | 577 |  | ~~$wpdb->update($wpdb->prefix.'wppm\_project', $values, array('id'=>$project\_id));~~ |
  | 578 |  | ~~}~~ |
  | 579 |  |  |
  | 580 |  | ~~public function change\_project\_end\_date($project\_id, $project\_end\_date){~~ |
  | 581 |  | ~~global $wpdb;~~ |
  | 582 |  | ~~$project\_id = esc\_sql($project\_id);~~ |
  | 583 |  | ~~$project\_end\_date = esc\_sql($project\_end\_date);~~ |
  | 584 |  | ~~$values=array(~~ |
  | 585 |  | ~~'end\_date'=>$project\_end\_date~~ |
  | 586 |  | ~~);~~ |
  | 587 |  | ~~$wpdb->update($wpdb->prefix.'wppm\_project', $values, array('id'=>$project\_id));~~ |
  | 588 |  | ~~}~~ |
  | 589 |  |  |
  | 590 | 597 | public function change\_category($project\_id, $project\_category){ |
  | 591 | 598 | global $wpdb; |
  | […](/browser/taskbuilder/trunk/includes/class-wppm-functions.php?rev=3191970#L595) | […](/browser/taskbuilder/trunk/includes/class-wppm-functions.php?rev=3210469#L602) |  |
  | 595 | 602 | 'cat\_id'=>$project\_category |
  | 596 | 603 | ); |
  | 597 |  | $wpdb->update($wpdb->prefix.'wppm\_project', $values, array('id'=>~~$project\_id~~)); |
  |  | 604 | $wpdb->update($wpdb->prefix.'wppm\_project', $values, array('id'=>"$project\_id")); |
  | 598 | 605 | } |
  | 599 | 606 |  |
  | […](/browser/taskbuilder/trunk/includes/class-wppm-functions.php?rev=3191970#L601) | […](/browser/taskbuilder/trunk/includes/class-wppm-functions.php?rev=3210469#L608) |  |
  | 601 | 608 | global $wpdb; |
  | 602 | 609 | $project\_id = esc\_sql($project\_id); |
  | 603 |  | $project\_description = esc\_sql($project\_description); |
  | 604 |  | $values=array( |
  | 605 |  | 'description'=>$project\_description |
  | 606 |  | ); |
  | 607 |  | $wpdb->update($wpdb->prefix.'wppm\_project', $values, array('id'=>$project\_id)); |
  |  | 610 | $values=array( |
  |  | 611 | 'description'=>wp\_kses\_post($project\_description) |
  |  | 612 | ); |
  |  | 613 | $wpdb->update($wpdb->prefix.'wppm\_project', $values, array('id'=>"$project\_id")); |
  | 608 | 614 | } |
  | 609 | 615 |  |
  | […](/browser/taskbuilder/trunk/includes/class-wppm-functions.php?rev=3191970#L612) | […](/browser/taskbuilder/trunk/includes/class-wppm-functions.php?rev=3210469#L618) |  |
  | 612 | 618 | $change\_status\_value= array(); |
  | 613 | 619 | $proj\_data = $wppmfunction->get\_project($project\_id); |
  | 614 |  | $prev\_status = ~~esc\_sql($proj\_data['status'])~~; |
  | 615 |  | $~~project\_id = esc\_sql($project\_id~~); |
  | 616 |  | $~~status\_id = esc\_sql($status\_id);~~ |
  | 617 |  | ~~$values=array(~~ |
  | 618 |  | ~~'status'=>$status\_id~~ |
  | 619 |  | ); |
  | 620 |  | $wpdb->update($wpdb->prefix.'wppm\_project', $values, array('id'=>~~$project\_id~~)); |
  |  | 620 | $prev\_status = $proj\_data['status']; |
  |  | 621 | $cu\_id = esc\_sql($current\_user->ID); |
  |  | 622 | $values=array( |
  |  | 623 | 'status'=>esc\_sql($status\_id) |
  |  | 624 | ); |
  |  | 625 | $project\_id = esc\_sql($project\_id); |
  |  | 626 | $wpdb->update($wpdb->prefix.'wppm\_project', $values, array('id'=>"$project\_id")); |
  | 621 | 627 | $old\_project\_status\_meta = $wppmfunction->get\_project\_meta($project\_id,'old\_project\_status',true); |
  | 622 | 628 | if(!empty($old\_project\_status\_meta)){ |
  | […](/browser/taskbuilder/trunk/includes/class-wppm-functions.php?rev=3191970#L625) | […](/browser/taskbuilder/trunk/includes/class-wppm-functions.php?rev=3210469#L631) |  |
  | 625 | 631 | $change\_status\_value = array('prev\_status'=>"$prev\_status",'new\_status'=>"$status\_id"); |
  | 626 | 632 | $change\_status\_obj = serialize($change\_status\_value); |
  | 627 |  | $log\_values = array('proj\_id'=>~~$project\_id,'body'=>$change\_status\_obj,'attachment\_ids'=>"",'create\_time'=>date("Y-m-d h:i:sa"),'created\_by'=>$current\_user->ID~~ ); |
  |  | 633 | $log\_values = array('proj\_id'=>"$project\_id",'body'=>$change\_status\_obj,'attachment\_ids'=>"",'create\_time'=>date("Y-m-d h:i:sa"),'created\_by'=>"$cu\_id" ); |
  | 628 | 634 | $wpdb->insert($wpdb->prefix . 'wppm\_project\_comment',$log\_values); |
  | 629 | 635 | $log\_id = esc\_sql($wpdb->insert\_id); |
  | 630 |  | $proj\_log\_values = array('proj\_id'=>~~$project\_id,'comment\_id'=>$log\_id~~,'comment\_type'=>'change\_proj\_status'); |
  |  | 636 | $proj\_log\_values = array('proj\_id'=>"$project\_id",'comment\_id'=>"$log\_id",'comment\_type'=>'change\_proj\_status'); |
  | 631 | 637 | $wpdb->insert($wpdb->prefix . 'wppm\_project\_comment\_meta',$proj\_log\_values); |
  | 632 | 638 | $wppmfunction->add\_project\_meta($project\_id,'old\_project\_status',$prev\_status); |
  | […](/browser/taskbuilder/trunk/includes/class-wppm-functions.php?rev=3191970#L636) | […](/browser/taskbuilder/trunk/includes/class-wppm-functions.php?rev=3210469#L642) |  |
  | 636 | 642 | public function change\_project\_raised\_by($project\_id, $user\_id){ |
  | 637 | 643 | global $wpdb; |
  | 638 |  | $project\_id = esc\_sql($project\_id); |
  | 639 |  | $user\_id = esc\_sql($user\_id); |
  | 640 |  | $values=array( |
  | 641 |  | 'created\_by'=>$user\_id |
  | 642 |  | ); |
  | 643 |  | $wpdb->update($wpdb->prefix.'wppm\_project', $values, array('id'=>$project\_id)); |
  |  | 644 | $values=array( |
  |  | 645 | 'created\_by'=>esc\_sql($user\_id) |
  |  | 646 | ); |
  |  | 647 | $wpdb->update($wpdb->prefix.'wppm\_project', $values, array('id'=>"$project\_id")); |
  | 644 | 648 | } |
  | 645 | 649 |  |
  | […](/browser/taskbuilder/trunk/includes/class-wppm-functions.php?rev=3191970#L673) | […](/browser/taskbuilder/trunk/includes/class-wppm-functions.php?rev=3210469#L677) |  |
  | 673 | 677 | $wpdb->prefix . 'wppm\_project\_meta', |
  | 674 | 678 | array( |
  | 675 |  | 'project\_id' =>$proj\_id, |
  |  | 679 | 'project\_id' =>$proj\_id, |
  | 676 | 680 | 'meta\_key' => $meta\_key, |
  | 677 | 681 | 'meta\_value' =>$meta\_value |
  | […](/browser/taskbuilder/trunk/includes/class-wppm-functions.php?rev=3191970#L681) | […](/browser/taskbuilder/trunk/includes/class-wppm-functions.php?rev=3210469#L685) |  |
  | 681 | 685 | public function add\_task\_meta($task\_id,$meta\_key,$meta\_value){ |
  | 682 | 686 | global $wpdb; |
  | 683 |  | ~~$task\_id = esc\_sql($task\_id);~~ |
  | 684 |  | ~~$meta\_key = esc\_sql($meta\_key);~~ |
  | 685 |  | ~~$meta\_value = esc\_sql($meta\_value);~~ |
  | 686 | 687 | $wpdb->insert( |
  | 687 | 688 | $wpdb->prefix . 'wppm\_task\_meta', |
  | […](/browser/taskbuilder/trunk/includes/class-wppm-functions.php?rev=3191970#L792) | […](/browser/taskbuilder/trunk/includes/class-wppm-functions.php?rev=3210469#L793) |  |
  | 792 | 793 | $project\_id = esc\_sql($project\_id); |
  | 793 | 794 | $meta\_key = esc\_sql($meta\_key); |
  | 794 |  | $results = $wpdb->get\_results("SELECT \* FROM {$wpdb->prefix}wppm\_project\_meta WHERE project\_id = '$project\_id' AND meta\_key = ~~$meta\_key~~"); |
  | 795 |  | $wpdb->update($wpdb->prefix.'wppm\_project\_meta', $meta\_value, array('project\_id'=>$project\_id,'meta\_key' => ~~$meta\_key~~)); |
  |  | 795 | $results = $wpdb->get\_results("SELECT \* FROM {$wpdb->prefix}wppm\_project\_meta WHERE project\_id = '$project\_id' AND meta\_key = '$meta\_key'"); |
  |  | 796 | $wpdb->update($wpdb->prefix.'wppm\_project\_meta', $meta\_value, array('project\_id'=>$project\_id,'meta\_key' => "$meta\_key")); |
  | 796 | 797 | } |
  | 797 | 798 |  |
  | […](/browser/taskbuilder/trunk/includes/class-wppm-functions.php?rev=3191970#L811) | […](/browser/taskbuilder/trunk/includes/class-wppm-functions.php?rev=3210469#L812) |  |
  | 811 | 812 | $project\_id = esc\_sql($project\_id); |
  | 812 | 813 | $meta\_key = esc\_sql($meta\_key); |
  | 813 |  | $wpdb->delete( $wpdb->prefix.'wppm\_project\_meta', array( 'project\_id' => ~~$project\_id,'meta\_key'=>$meta\_key~~) ); |
  |  | 814 | $wpdb->delete( $wpdb->prefix.'wppm\_project\_meta', array( 'project\_id' => "$project\_id",'meta\_key'=>"$meta\_key") ); |
  | 814 | 815 | } |
  | 815 | 816 |  |
  | […](/browser/taskbuilder/trunk/includes/class-wppm-functions.php?rev=3191970#L818) | […](/browser/taskbuilder/trunk/includes/class-wppm-functions.php?rev=3210469#L819) |  |
  | 818 | 819 | $task\_id = esc\_sql($task\_id); |
  | 819 | 820 | $meta\_key = esc\_sql($meta\_key); |
  | 820 |  | $wpdb->delete( $wpdb->prefix.'wppm\_task\_meta', array( 'task\_id' => ~~$task\_id,'meta\_key'=>$meta\_key~~) ); |
  |  | 821 | $wpdb->delete( $wpdb->prefix.'wppm\_task\_meta', array( 'task\_id' => "$task\_id",'meta\_key'=>"$meta\_key") ); |
  | 821 | 822 | } |
  | 822 | 823 |  |
* ## [taskbuilder/trunk/includes/frontend/wppm\_tasks\_shortcode.php](/changeset/3210469/taskbuilder/trunk/includes/frontend/wppm_tasks_shortcode.php "Show the changeset 3210469 restricted to taskbuilder/trunk/includes/frontend/wppm_tasks_shortcode.php")

  | [r3123269](/browser/taskbuilder/trunk/includes/frontend/wppm_tasks_shortcode.php?rev=3123269#L121 "Show revision 3123269 of this file in browser") | [r3210469](/browser/taskbuilder/trunk/includes/frontend/wppm_tasks_shortcode.php?rev=3210469#L121 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 121 | 121 | if(!empty($this->shortcode\_attr['project'])){ |
  | 122 | 122 | ?> |
  | 123 |  | dataform.append("wppm\_project\_attr","<?php echo ~~$this->shortcode\_attr['project']~~; ?>"); |
  |  | 123 | dataform.append("wppm\_project\_attr","<?php echo esc\_attr($this->shortcode\_attr['project']); ?>"); |
  | 124 | 124 | <?php } ?> |
  | 125 | 125 | jQuery.ajax( { |
  | […](/browser/taskbuilder/trunk/includes/frontend/wppm_tasks_shortcode.php?rev=3123269#L162) | […](/browser/taskbuilder/trunk/includes/frontend/wppm_tasks_shortcode.php?rev=3210469#L162) |  |
  | 162 | 162 | dataform.append("action", 'wppm\_get\_task\_list'); |
  | 163 | 163 | <?php if(!empty($this->shortcode\_attr['project'])){ ?> |
  | 164 |  | dataform.append("wppm\_project\_attr","<?php echo ~~$this->shortcode\_attr['project']~~ ?>"); |
  |  | 164 | dataform.append("wppm\_project\_attr","<?php echo esc\_attr($this->shortcode\_attr['project']); ?>"); |
  | 165 | 165 | <?php } ?> |
  | 166 | 166 | jQuery.ajax( { |
  | […](/browser/taskbuilder/trunk/includes/frontend/wppm_tasks_shortcode.php?rev=3123269#L185) | […](/browser/taskbuilder/trunk/includes/frontend/wppm_tasks_shortcode.php?rev=3210469#L185) |  |
  | 185 | 185 | dataform.append("wppm\_proj\_filter",0); |
  | 186 | 186 | <?php if(!empty($this->shortcode\_attr['project'])){ ?> |
  | 187 |  | dataform.append("wppm\_project\_attr","<?php echo ~~$this->shortcode\_attr['project']~~ ?>"); |
  |  | 187 | dataform.append("wppm\_project\_attr","<?php echo esc\_attr($this->shortcode\_attr['project']); ?>"); |
  | 188 | 188 | <?php } ?> |
  | 189 | 189 | <?php echo do\_action('wppm\_tl\_reset\_filter\_dataform');?> |
  | […](/browser/taskbuilder/trunk/includes/frontend/wppm_tasks_shortcode.php?rev=3123269#L208) | […](/browser/taskbuilder/trunk/includes/frontend/wppm_tasks_shortcode.php?rev=3210469#L208) |  |
  | 208 | 208 | dataform.append("action", 'wppm\_get\_task\_list'); |
  | 209 | 209 | <?php if(!empty($this->shortcode\_attr['project'])){ ?> |
  | 210 |  | dataform.append("wppm\_project\_attr","<?php echo ~~$this->shortcode\_attr['project']~~ ?>"); |
  |  | 210 | dataform.append("wppm\_project\_attr","<?php echo esc\_attr($this->shortcode\_attr['project']); ?>"); |
  | 211 | 211 | <?php } ?> |
  | 212 | 212 | dataform.append("task\_search", task\_search); |
  | […](/browser/taskbuilder/trunk/includes/frontend/wppm_tasks_shortcode.php?rev=3123269#L232) | […](/browser/taskbuilder/trunk/includes/frontend/wppm_tasks_shortcode.php?rev=3210469#L232) |  |
  | 232 | 232 | dataform.append("task\_search", task\_search); |
  | 233 | 233 | <?php if(!empty($this->shortcode\_attr['project'])){ ?> |
  | 234 |  | dataform.append("wppm\_project\_attr","<?php echo ~~$this->shortcode\_attr['project']~~ ?>"); |
  |  | 234 | dataform.append("wppm\_project\_attr","<?php echo esc\_attr($this->shortcode\_attr['project']); ?>"); |
  | 235 | 235 | <?php } ?> |
  | 236 | 236 | jQuery.ajax( { |
  | […](/browser/taskbuilder/trunk/includes/frontend/wppm_tasks_shortcode.php?rev=3123269#L255) | […](/browser/taskbuilder/trunk/includes/frontend/wppm_tasks_shortcode.php?rev=3210469#L255) |  |
  | 255 | 255 | dataform.append("order", order); |
  | 256 | 256 | <?php if(!empty($this->shortcode\_attr['project'])){ ?> |
  | 257 |  | dataform.append("wppm\_project\_attr","<?php echo ~~$this->shortcode\_attr['project']~~ ?>"); |
  |  | 257 | dataform.append("wppm\_project\_attr","<?php echo esc\_attr($this->shortcode\_attr['project']); ?>"); |
  | 258 | 258 | <?php } ?> |
  | 259 | 259 | jQuery.ajax( { |
  | […](/browser/taskbuilder/trunk/includes/frontend/wppm_tasks_shortcode.php?rev=3123269#L284) | […](/browser/taskbuilder/trunk/includes/frontend/wppm_tasks_shortcode.php?rev=3210469#L284) |  |
  | 284 | 284 | dataform.append("page\_no",page\_no); |
  | 285 | 285 | <?php if(!empty($this->shortcode\_attr['project'])){ ?> |
  | 286 |  | dataform.append("wppm\_project\_attr","<?php echo ~~$this->shortcode\_attr['project']~~ ?>"); |
  |  | 286 | dataform.append("wppm\_project\_attr","<?php echo esc\_attr($this->shortcode\_attr['project']); ?>"); |
  | 287 | 287 | <?php } ?> |
  | 288 | 288 | jQuery.ajax( { |
  | […](/browser/taskbuilder/trunk/includes/frontend/wppm_tasks_shortcode.php?rev=3123269#L306) | […](/browser/taskbuilder/trunk/includes/frontend/wppm_tasks_shortcode.php?rev=3210469#L306) |  |
  | 306 | 306 | dataform.append("wppm\_task\_filter", wppm\_task\_filter); |
  | 307 | 307 | <?php if(!empty($this->shortcode\_attr['project'])){ ?> |
  | 308 |  | dataform.append("wppm\_project\_attr","<?php echo ~~$this->shortcode\_attr['project']~~ ?>"); |
  |  | 308 | dataform.append("wppm\_project\_attr","<?php echo esc\_attr($this->shortcode\_attr['project']); ?>"); |
  | 309 | 309 | <?php } ?> |
  | 310 | 310 | jQuery.ajax( { |
  | […](/browser/taskbuilder/trunk/includes/frontend/wppm_tasks_shortcode.php?rev=3123269#L331) | […](/browser/taskbuilder/trunk/includes/frontend/wppm_tasks_shortcode.php?rev=3210469#L331) |  |
  | 331 | 331 | dataform.append("wppm\_proj\_filter","0"); |
  | 332 | 332 | <?php if(!empty($this->shortcode\_attr['project'])){ ?> |
  | 333 |  | dataform.append("wppm\_project\_attr","<?php echo ~~$this->shortcode\_attr['project']~~ ?>"); |
  |  | 333 | dataform.append("wppm\_project\_attr","<?php echo esc\_attr($this->shortcode\_attr['project']); ?>"); |
  | 334 | 334 | <?php } ?> |
  | 335 | 335 | jQuery.ajax( { |
* ## [taskbuilder/trunk/includes/replace\_macro.php](/changeset/3210469/taskbuilder/trunk/includes/replace_macro.php "Show the changeset 3210469 restricted to taskbuilder/trunk/includes/replace_macro.php")

  | [r3174963](/browser/taskbuilder/trunk/includes/replace_macro.php?rev=3174963#L8 "Show revision 3174963 of this file in browser") | [r3210469](/browser/taskbuilder/trunk/includes/replace_macro.php?rev=3210469#L8 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 8 | 8 | $project\_id = intval(sanitize\_text\_field($project\_id)); |
  | 9 | 9 | $wppm\_project\_data = $wppmfunction->get\_project($project\_id); |
  | 10 |  | $orderby\_sql       = ~~sanitize\_sql\_orderby( "id DESC"~~ ); |
  | 11 |  | $wppm\_proj\_comment = $wpdb->get\_row("SELECT \* FROM {$wpdb->prefix}wppm\_project\_comment where proj\_id='".~~$project\_id~~."' ORDER BY $orderby\_sql LIMIT 1;"); |
  |  | 10 | $orderby\_sql       = esc\_sql(sanitize\_sql\_orderby( "id DESC" )); |
  |  | 11 | $wppm\_proj\_comment = $wpdb->get\_row("SELECT \* FROM {$wpdb->prefix}wppm\_project\_comment where proj\_id='".esc\_sql($project\_id)."' ORDER BY $orderby\_sql LIMIT 1;"); |
  | 12 | 12 | $attachments = array(); |
  | 13 | 13 | $auth\_id  = $wppmfunction->get\_project\_meta($project\_id,'project\_auth\_code',true); |
* ## [taskbuilder/trunk/includes/replace\_task\_macro.php](/changeset/3210469/taskbuilder/trunk/includes/replace_task_macro.php "Show the changeset 3210469 restricted to taskbuilder/trunk/includes/replace_task_macro.php")

  | [r3174963](/browser/taskbuilder/trunk/includes/replace_task_macro.php?rev=3174963#L8 "Show revision 3174963 of this file in browser") | [r3210469](/browser/taskbuilder/trunk/includes/replace_task_macro.php?rev=3210469#L8 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 8 | 8 | $task\_id = intval(sanitize\_text\_field($task\_id)); |
  | 9 | 9 | $wppm\_task\_data = $wppmfunction->get\_task($task\_id); |
  | 10 |  | $orderby\_sql       = sanitize\_sql\_orderby( "id DESC" ); |
  | 11 |  | $wppm\_task\_comment = $wpdb->get\_row("SELECT \* FROM {$wpdb->prefix}wppm\_task\_comment where task\_id='".$task\_id."' ORDER BY $orderby\_sql LIMIT 1;"); |
  |  | 10 | $task\_creator = $wppm\_task\_data['created\_by']; |
  |  | 11 | $task\_creator\_data = get\_userdata($task\_creator); |
  |  | 12 | $task\_creator\_name = $task\_creator\_data->display\_name; |
  |  | 13 | $orderby\_sql       = esc\_sql(sanitize\_sql\_orderby( "id DESC" )); |
  |  | 14 | $wppm\_task\_comment = $wpdb->get\_row("SELECT \* FROM {$wpdb->prefix}wppm\_task\_comment where task\_id='".esc\_sql($task\_id)."' ORDER BY $orderby\_sql LIMIT 1;"); |
  | 12 | 15 | $wppm\_project\_data = $wppmfunction->get\_project($wppm\_task\_data['project']); |
  | 13 | 16 | $auth\_id           = sanitize\_text\_field($wppm\_task\_data['task\_auth\_code']); |
  | […](/browser/taskbuilder/trunk/includes/replace_task_macro.php?rev=3174963#L24) | […](/browser/taskbuilder/trunk/includes/replace_task_macro.php?rev=3210469#L27) |  |
  | 24 | 27 | case '{task\_id}': |
  | 25 | 28 | $str = preg\_replace('/{task\_id}/', $task\_id, $str); |
  |  | 29 | break; |
  |  | 30 | // Task Creator Name |
  |  | 31 | case '{task\_creator\_name}': |
  |  | 32 | $str = preg\_replace('/{task\_creator\_name}/', $task\_creator\_name, $str); |
  | 26 | 33 | break; |
  | 27 | 34 | //Current User Name |
  | […](/browser/taskbuilder/trunk/includes/replace_task_macro.php?rev=3174963#L89) | […](/browser/taskbuilder/trunk/includes/replace_task_macro.php?rev=3210469#L96) |  |
  | 89 | 96 | // Project Category |
  | 90 | 97 | case '{project\_category}'; |
  | 91 |  | $str = preg\_replace('/{project\_category}/', $this->get\_project\_category\_name((sanitize\_text\_field($wppm\_project\_data['cat\_id'])), $str)); |
  |  | 98 | if(!empty($wppm\_project\_data['cat\_id'])){ |
  |  | 99 | $str = preg\_replace('/{project\_category}/', $this->get\_project\_category\_name(sanitize\_text\_field($wppm\_project\_data['cat\_id'])), $str); |
  |  | 100 | }else{ |
  |  | 101 | $str = ""; |
  |  | 102 | } |
  | 92 | 103 | break; |
  | 93 | 104 | // Project Name |
* ## [taskbuilder/trunk/readme.txt](/changeset/3210469/taskbuilder/trunk/readme.txt "Show the changeset 3210469 restricted to taskbuilder/trunk/readme.txt")

  | [r3191970](/browser/taskbuilder/trunk/readme.txt?rev=3191970#L4 "Show revision 3191970 of this file in browser") | [r3210469](/browser/taskbuilder/trunk/readme.txt?rev=3210469#L4 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 4 | 4 | Tags: project,project management,task management,task manager,Kanban |
  | 5 | 5 | Requires at least: 4.4 |
  | 6 |  | Tested up to: 6.7 |
  | 7 |  | Stable tag: 3.0.~~6~~ |
  |  | 6 | Tested up to: 6.7.1 |
  |  | 7 | Stable tag: 3.0.7 |
  | 8 | 8 | License: GPL v3 |
  | 9 | 9 |  |
  | […](/browser/taskbuilder/trunk/readme.txt?rev=3191970#L55) | […](/browser/taskbuilder/trunk/readme.txt?rev=3210469#L55) |  |
  | 55 | 55 | \* [Buddypress](https://taskbuilder.net/buddypress/) - Buddypress Integration add-on allows you to create and manage projects,tasks in buddypress group on your own WordPress site. |
  | 56 | 56 | \* [WooCommerce](https://taskbuilder.net/woocommerce/) - WooCommerce Integration add-on automatically create task after order received. You can set order details in task description. |
  |  | 57 | \* [Due Date Reminder](https://taskbuilder.net/due-date-reminder/) - Due date reminder are super helpful for keeping your team on track to hit deadlines. Email notification will send to customer before due date of task. |
  | 57 | 58 |  |
  | 58 | 59 | ## 👨‍💻 DOCUMENTATION AND SUPPORT ## |
  | […](/browser/taskbuilder/trunk/readme.txt?rev=3191970#L111) | […](/browser/taskbuilder/trunk/readme.txt?rev=3210469#L112) |  |
  | 111 | 112 |  |
  | 112 | 113 | == Changelog == |
  |  | 114 | = V 3.0.7(Dec 19,2024) = |
  |  | 115 | \* Fix: When edit task comment and save it, rn added insatead of space. |
  |  | 116 | \* Fix: SQL Injection (SQLi) vulnerability. |
  |  | 117 | \* Fix: XSS vulnerability. |
  |  | 118 | \* New(Pro feature): Due Date reminder add-on. |
  |  | 119 |  |
  | 113 | 120 | = V 3.0.6(Nov 19,2024) = |
  | 114 | 121 | \* New: Compatible with WordPress v6.7. |
* ## [taskbuilder/trunk/taskbuilder.php](/changeset/3210469/taskbuilder/trunk/taskbuilder.php "Show the changeset 3210469 restricted to taskbuilder/trunk/taskbuilder.php")

  | [r3191970](/browser/taskbuilder/trunk/taskbuilder.php?rev=3191970#L4 "Show revision 3191970 of this file in browser") | [r3210469](/browser/taskbuilder/trunk/taskbuilder.php?rev=3210469#L4 "Show revision 3210469 of this file in browser") |  |
  | --- | --- | --- |
  | 4 | 4 | \* Plugin URI: https://wordpress.org/plugins/taskbuilder/ |
  | 5 | 5 | \* Description: Wordpress Project & Task Management plugin. Easy to keep track of projects & tasks! |
  | 6 |  | \* Version: 3.0.~~6~~ |
  |  | 6 | \* Version: 3.0.7 |
  | 7 | 7 | \* Author: Taskbuilder Team |
  | 8 | 8 | \* Author URI: https://taskbuilder.net/ |
  | 9 | 9 | \* Requires at least: 4.4 |
  | 10 |  | \* Tested up to: 6.7 |
  |  | 10 | \* Tested up to: 6.7.1 |
  | 11 | 11 | \* Text Domain: taskbuilder |
  | 12 | 12 | \* Domain Path: /lang |
  | […](/browser/taskbuilder/trunk/taskbuilder.php?rev=3191970#L20) | […](/browser/taskbuilder/trunk/taskbuilder.php?rev=3210469#L20) |  |
  | 20 | 20 |  |
  | 21 | 21 | final class WP\_Taskbuilder { |
  | 22 |  | public $version    = '3.0.~~6~~'; |
  |  | 22 | public $version    = '3.0.7'; |
  | 23 | 23 | public function \_\_construct() { |
  | 24 | 24 | // define global constants |

**Note:** See [TracChangeset](/wiki/TracChangeset)
for help on using the changeset viewer.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Unified Diff](?format=diff&new=3210469)
* [Zip Archive](?format=zip&new=3210469)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from wordpress.org_acacb5e3_20250114_195603.html ===


[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Showcase](https://wordpress.org/showcase/)
* [Hosting](https://wordpress.org/hosting/)
* Extend
  + [Themes](https://wordpress.org/themes/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Blocks](https://wordpress.org/blocks/)
  + [Openverse ↗︎](https://openverse.org/)
* Learn
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* Community
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [Events](https://events.wordpress.org/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* About
  + [About WordPress](https://wordpress.org/about/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
* [Get WordPress](https://wordpress.org/download/)

Search in WordPress.org

[Get WordPress](https://wordpress.org/download/)

[WordPress.org](https://wordpress.org/)

[Plugin Directory](https://wordpress.org/plugins/)

Taskbuilder – WordPress Project & Task Management plugin

* [Submit a plugin](https://wordpress.org/plugins/developers/)
* [My favorites](https://wordpress.org/plugins/browse/favorites/)
* [Log in](https://login.wordpress.org/?redirect_to=https%3A%2F%2Fwordpress.org%2Fplugins%2Ftaskbuilder&locale=en_US)

* [Submit a plugin](https://wordpress.org/plugins/developers/)
* [My favorites](https://wordpress.org/plugins/browse/favorites/)
* [Log in](https://login.wordpress.org/?redirect_to=https%3A%2F%2Fwordpress.org%2Fplugins%2Ftaskbuilder&locale=en_US)

Search plugins

![](https://ps.w.org/taskbuilder/assets/banner-772x250.png?rev=2611339)
![](https://ps.w.org/taskbuilder/assets/icon-256x256.png?rev=2611339)
# Taskbuilder – WordPress Project & Task Management plugin

By [Taskbuilder Team](https://taskbuilder.net/)

[Download](https://downloads.wordpress.org/plugin/taskbuilder.3.0.8.zip)

* [Details](https://wordpress.org/plugins/taskbuilder/#description)
* [Reviews](https://wordpress.org/plugins/taskbuilder/#reviews)
* [Installation](https://wordpress.org/plugins/taskbuilder/#installation)
* [Development](https://wordpress.org/plugins/taskbuilder/#developers)

[Support](https://wordpress.org/support/plugin/taskbuilder/)

## Description

Taskbuilder is the easy, flexible and free way to organize tasks, projects & more. This plugin adds to WordPress the features of a complete project and task management system. It is the only project & task management plugin that can match the feature set of Trello or Bitrix24. Create Task and manage them in a beautiful modern drag and drop UI (Kanban view). Move Task cards between Boards. This feature designed to help visualize work and make management of tasks easier!

Taskbuilder is built with simplicity, flexibility, and power in mind, so that you can focus on the work that matters most. Taskbuilder is integrated with Top wordpress plugins like Buddypress as well as WooCommerce. We aim to keep the plugin simple, secure, and feature-rich through continuous improvement and innovation.

#### Shortcodes :

```
[wppm_projects] - Manage projects from front-end.
[wppm_tasks] - Manage tasks from front-end.
[wppm_tasks_calendar] - Use Calendar on front-end(pro feature).
[wppm_tasks project ="insert project name here"]- If you want to display only selected project's task on page, you can add attribute as project name to tasks shortcode. It will only display tasks of selected project.

```
### 🌟 Top Features

* **Unlimited Projects**: There is no limit of projects can be created in free version.
* **Unlimited Tasks**: There is no limit of tasks can be created in free version.
* **Unlimited co-workers**: There is no limit to add co-workers. You can create any number of co-workers so that you can divide your workload. You can use wordpress’s registered users as co-workers(manager, co-workers).
* **Ajax functionality**: Almost every functionality is Ajax based so that its operational speed is at its best.
* **Manage Projects & Tasks From Front-end**: There is no need to pay anything for manage projects and tasks from front-end.
* **Checklist**: Break big tasks into small ones, check things off the list, and watch that status bar go to 100% complete.
* **File Attachments**: Files can attached in comments.
* **Responsive Design**: It is designed to work on any possbile screen size so that you can operate anytime, anywhere. It is recommended to use full-width template for Project and Task page so that it will work smoothly.
* **Kanban Board**: Cards represent your tasks and have everything you need to get the job done. As you make progress, drag cards from list to list so that everyone knows the status of the task at hand.
* **List View**: You can manage tasks and project on list view.
* **Filter**: You can filter task and projects by Title,Project name, Status, Category, Priority,User Names.
* **Email Notifications**: Customizable email notification templates available for you to customize as per your requirement. You can make use of macro tags for task & projects specific information which gets replaced dynamically.
* **Custom Statuses**: You can create unlimited custom statuses for projects and tasks.
* **Custom Priorities**: You can create unlimited custom priorities for tasks.
* **Custom Categories**: You can create unlimited custom categories for projects.
* **Appearance Setting**: Customizable Appearance to match up with your theme.
* **Shortcode Attribute**: Display selected project’s task on frontend. If you want to display only selected project’s task on page, you can add attribute as project name to tasks shortcode. It will only display tasks of selected project.For ex- add shortcode [wppm\_tasks project =”insert project name here”] on page. It will only shows tasks of project which you added as a project parameter in task’s shortcode.

🙌 After reading this feature list, you can probably imagine Taskbuilder is the most advanced and powerful task & project management plugin in the market. Give Taskbuilder a try.

#### Premium Add-Ons :

* [Calender](https://taskbuilder.net/task-calendar/) – Get daily, weekly, or monthly view of task timelines with drag and drop feature. Filter them by Title,Project name, Status, Category, Priority,User Names if necessary.
* [Custom Fields](https://taskbuilder.net/custom-fields/) – You can add Custom Field to the tasks. There are 5 types of custom fields you can create. i.e. Text, Number, Date, Dropdown, File Upload.
* [Time Tracker](https://taskbuilder.net/time-tracker/) – Time tracker tracks the exact time you spent on your tasks. Timer with start, stop feature for every task.
* [Gantt Chart](https://taskbuilder.net/gantt-chart/) – Gantt Chart add-on effectively time manage your tasks and visualize upcoming deadlines for any project. Projects planners also use Gantt charts to maintain a bird’s eye view of projects.
* [Duplicate Project](https://taskbuilder.net/duplicate-project/) – Duplicate Project add-on allows you to clone existing project and you will get same project with(tasks+checklists).
* [Report](https://taskbuilder.net/report/) – Report add-on allows you to create detail project progress reports for any project and customize which data should be shown in the report. You can then download report in PDF or CSV format.
* [Buddypress](https://taskbuilder.net/buddypress/) – Buddypress Integration add-on allows you to create and manage projects,tasks in buddypress group on your own WordPress site.
* [WooCommerce](https://taskbuilder.net/woocommerce/) – WooCommerce Integration add-on automatically create task after order received. You can set order details in task description.
* [Due Date Reminder](https://taskbuilder.net/due-date-reminder/) – Due date reminder are super helpful for keeping your team on track to hit deadlines. Email notification will send to customer before due date of task.

### 👨‍💻 DOCUMENTATION AND SUPPORT

* For documentation and tutorials go to our [Help](https://taskbuilder.net/help/)
* If you have any more questions, visit our [Support](https://taskbuilder.net/support/)

#### Available Translations :

Available in below languages.

\* Romanian

\* French (France)

\* German (Germany)

\* German(formal)

If you are a translator, you can get free access to all premium add-ons for a year in exchange for translating them into your language if it is not available already. We will renew the Premium subscription next year if you continue contributing to the translation. If interested, don’t hesitate to contact us via our [support page](https://taskbuilder.net/support/).

## Screenshots

* [![](https://ps.w.org/taskbuilder/assets/screenshot-1.png?rev=2611339)](https://ps.w.org/taskbuilder/assets/screenshot-1.png?rev=2611339)

  Project list view
* [![](https://ps.w.org/taskbuilder/assets/screenshot-2.png?rev=2611339)](https://ps.w.org/taskbuilder/assets/screenshot-2.png?rev=2611339)

  Task list view
* [![](https://ps.w.org/taskbuilder/assets/screenshot-3.png?rev=2611339)](https://ps.w.org/taskbuilder/assets/screenshot-3.png?rev=2611339)

  Task list (Kanban view)
* [![](https://ps.w.org/taskbuilder/assets/screenshot-4.png?rev=2611339)](https://ps.w.org/taskbuilder/assets/screenshot-4.png?rev=2611339)

  Create project
* [![](https://ps.w.org/taskbuilder/assets/screenshot-5.png?rev=2611339)](https://ps.w.org/taskbuilder/assets/screenshot-5.png?rev=2611339)

  Create task
* [![](https://ps.w.org/taskbuilder/assets/screenshot-6.png?rev=2611339)](https://ps.w.org/taskbuilder/assets/screenshot-6.png?rev=2611339)

  Open project view
* [![](https://ps.w.org/taskbuilder/assets/screenshot-7.png?rev=2611339)](https://ps.w.org/taskbuilder/assets/screenshot-7.png?rev=2611339)

  Open task view
* [![](https://ps.w.org/taskbuilder/assets/screenshot-8.png?rev=2611339)](https://ps.w.org/taskbuilder/assets/screenshot-8.png?rev=2611339)

  Comment

## Installation

This plugin is almost plug and play!

#### Modern Way:

1. Go to the WordPress Dashboard “Add New Plugin” section.
2. Search For “Taskbuilder”.
3. Install, then Activate it.

#### Old Way:

1. Upload `Taskbuilder` to the `/wp-content/plugins/` directory
2. Activate the plugin through the ‘Plugins’ menu in WordPress.

## FAQ

### Q. Who can create projects?

A. Only Admin’s can create projects and edit them.

### Q. Who can create tasks, checklist, comments?

A. Admins and every co-workers from a project can create these.

### Q. Can every member see every project?

A. Only admins (administrator) can see all of them. Other user roles can only see their assigned projects.

### Q. Can the plugin be extended?

A. Sure, lots of actions and filters are added by default and will add more of them.

## Reviews

![](https://secure.gravatar.com/avatar/543e57513d45cfb952fc23310b7cc1cdc8f22312642eb7fa61ec4d566452f9e6?s=60&d=retro&r=g)
### [Simple and yet powerful frontend PM plugin with time tracking](https://wordpress.org/support/topic/simple-and-yet-powerful-frontend-pm-plugin-with-time-tracking/)

[Roland](https://profiles.wordpress.org/rolandkingo/ "Posts by Roland")
September 30, 2024

I am so impressed by the simplicity and the abundance of useful tools in this plugin. Taskbuilder is exactly what I was looking for for my project, an easy to use project management tool, with time tracking function, with frontend widgets.The communication is also excellent, I look forward to the development of this market-changing product. Great job guys, thank you.

![](https://secure.gravatar.com/avatar/7d0d339da5835c717ec417857373d0f1cbf48650a7bf15f542a8ea8da6316c76?s=60&d=retro&r=g)
### [Simple and Powerfull](https://wordpress.org/support/topic/simple-and-powerfull-40/)

[figoudoji](https://profiles.wordpress.org/figoudoji/ "Posts by figoudoji")
January 25, 2024

Simple and powerful. Easily integrates into both WordPress Pages and BuddyPress groups. The best part is the support. The plugin owner responds within 24 hours or less and fixed a bug immediately. I recommend buying the plugin for full functionality.

![](https://secure.gravatar.com/avatar/94264e9f9c50431bfb891d4d7b94f7970665280ab85144a66680e9a49b616b60?s=60&d=retro&r=g)
### [Pretty good, but very specific](https://wordpress.org/support/topic/pretty-good-but-very-specific/)

[ebonweaver](https://profiles.wordpress.org/ebonweaver/ "Posts by ebonweaver")
April 8, 2023
1 reply

All around no bugs which is a first in looking for a project management plugin. It works pretty well and makes sense, which is also a first. It’s not pretty compared to others, but it works, so that’s better, but it’s really not pretty. However, it’s VERY limited. The permissions are implicit which makes it easy to manage as you don’t have roles to deal with. But you have no ability to allow someone to see a whole project and all tasks in it. You can only assign a user to a project so they can see or edit the project itself (manager and co-worker, so that’s good), and then ALSO assign them to a task so they can see AND EDIT the task. In other words, you can’t have a project with open visibility to the team of all tasks and only have people edit assigned tasks. If tasks had a simple “viewable” checkbox, my hunt would be over. Unfortunately without that visibility this will not work for our needs.

![](https://secure.gravatar.com/avatar/63ca922d0853d835aac88d3090d296f6df6ef4ff468aca2a7d4dbb7d6abb02e7?s=60&d=retro&r=g)
### [Very Good](https://wordpress.org/support/topic/very-good-6853/)

[jonswift53](https://profiles.wordpress.org/jonswift53/ "Posts by jonswift53")
April 2, 2023
1 reply

I have started using this product and find it quite useful especially as it is affordable. It does have limitations in charting and reporting but as a tool for a project manager it is good.

![](https://secure.gravatar.com/avatar/2a3d9162b14d70a9f8690f54a1a90509343645dcdb7ac20aacba02bcb26e67fc?s=60&d=retro&r=g)
### [Perfect for my basic task tracking needs](https://wordpress.org/support/topic/perfect-for-my-basic-task-tracking-needs/)

[vingogly](https://profiles.wordpress.org/vingogly/ "Posts by vingogly")
August 18, 2022

I wanted a simple to use plugin for creating and tracking development and design tasks on my site projects, and this add-on perfectly fits my needs.

![](https://secure.gravatar.com/avatar/7e7e6f399ab13d591143f59fae7810eca3bb63b0e8e62febc5711be2b311a37e?s=60&d=retro&r=g)
### [simple but powerful](https://wordpress.org/support/topic/simple-but-powerful-71/)

[James](https://profiles.wordpress.org/growtogive/ "Posts by James")
November 11, 2021

Of all the project managers this one is by far the simplest yet very powerful and effective.

[Read all 6 reviews](https://wordpress.org/support/plugin/taskbuilder/reviews/)
## Contributors & Developers

“Taskbuilder – WordPress Project & Task Management plugin” is open source software. The following people have contributed to this plugin.

Contributors

* ![](https://secure.gravatar.com/avatar/53c9524a651ae18c130bc3d4155fa7b0dcc8086fa3d87732cc953772466a6ac2?s=32&d=mm&r=g) [taskbuilder](https://profiles.wordpress.org/taskbuilder/)

“Taskbuilder – WordPress Project & Task Management plugin” has been translated into 2 locales. Thank you to [the translators](https://translate.wordpress.org/projects/wp-plugins/taskbuilder/contributors) for their contributions.

[Translate “Taskbuilder – WordPress Project & Task Management plugin” into your language.](https://translate.wordpress.org/projects/wp-plugins/taskbuilder)

### Interested in development?

[Browse the code](https://plugins.trac.wordpress.org/browser/taskbuilder/), check out the [SVN repository](https://plugins.svn.wordpress.org/taskbuilder/), or subscribe to the [development log](https://plugins.trac.wordpress.org/log/taskbuilder/) by [RSS](https://plugins.trac.wordpress.org/log/taskbuilder/?limit=100&mode=stop_on_copy&format=rss).

## Changelog

#### V 3.0.8(Dec 25,2024)

* Fix: Attachments not opening in task comment.

#### V 3.0.7(Dec 19,2024)

* Fix: When edit task comment and save it, rn added insatead of space.
* Fix: SQL Injection (SQLi) vulnerability.
* Fix: XSS vulnerability.
* New(Pro feature): Due Date reminder add-on.

#### V 3.0.6(Nov 19,2024)

* New: Compatible with WordPress v6.7.
* New: Setting added for allow co-workers to create tasks. You can set default enable/disable permission for co-workers in setting (Dashboard > Projects > Settings > Co-workers permission).
* New: Setting added for allow co-workers to add checklists. You can set default enable/disable permission for co-workers in setting (Dashboard > Projects > Settings > Co-workers permission).
* New: Setting added for allow co-workers to change task status. You can set default enable/disable permission for co-workers in setting (Dashboard > Projects > Settings > Co-workers permission).
* New: Setting added for allow co-workers to assign task users. You can set default enable/disable permission for co-workers in setting (Dashboard > Projects > Settings > Co-workers permission).

#### V 3.0.5(Oct 24,2024)

* Fix: SQL Injection (SQLi) vulnerability.
* New: Bulk action on project list & task list to change status, change category, Assign co-workers, Delete Task/Project etc.
* New: Setting to show/hide default TinyMCE editor in open project.
* New: Setting to show/hide default TinyMCE editor in open task.
* Fix: If comment is empty and only attachment uploaded in open project & in open task, comment is not added in project/task.
* Fix: If previous assign user not set in email notification setting still email notification goes to them.
* New: Email notification to project creator/task creator. You can set project creator/ task creator in email notification setting as recipients.
* New: Setting to send email notification to current user. If user is present in project and setting is enable for email notification send to current user then current user will get email notification.
* Fix: If project delete, project comment not deleted from database.
* Fix: If task delete, task comment not deleted from database.

#### V 3.0.4(Sep 26,2024)

* New: Log added in projects. If any action perform in project then log will get added in project(e.g change status, comment delete, change creator, assign user etc.)
* New: Log added in tasks. If any action perform in task then log will get added in task(e.g change status, comment delete, change creator, assign user etc.)
* New(pro): When project will get duplicated, custom fields will get duplicate in project. Also, custom fields value in task will get duplicate.
* New: German Translation available.
* New: Romanian Translation available.
* New: German(formal) Translation available.
* Fix: php warning in Custom field add-on.
* Fix: php warning in Duplicate project add-on.
* New: When project will get duplicated, logs also get added in project.
* New: When task will get duplicated, logs also get added in task.

#### V 3.0.3(Aug 27,2024)

* New: User role and capability. You can edit wordpress registered user and set capability as WPPM Administrator or WPPM Manager. User having manager role can create project and manage its tasks as well rather only admin had capability to create project. User having WPPM Administrator role can manage all features of Taskbuilder.

#### V 3.0.2(July 22,2024)

* New: You can display only selected project’s task on frontend page. If you want to display only selected project’s task on page, you can add attribute as project name to tasks shortcode. It will only display tasks of selected project. For ex- add shortcode [wppm\_tasks project =”insert project name here”] on page. It will only shows tasks of project which you added as a project parameter in task’s shortcode.
* New: Compatible with WordPress v6.6.

#### V 3.0.1(June 18,2024)

* New (Pro feature): WooCommerce Integration add-on.
* New: Default project status setting. You can set defalut status for project in setting which will apply to project after create it.
* New: Default task status setting. You can set defalut status for task in setting which will apply to task after create it.

#### V 3.0.0(May 1,2024)

* Compatible with WordPress v6.5.2.
* New: Appearance Setting(Customizable Appearance to match up with your theme). You can set setting in (Projects > Settings > Appearance).
* New: Project Comment. You can add comment in project like task.
* New: Project filter in task list(Task by project).
* New: Project start & end date clickable in open project.
* New: Task start & end date clickable in open Task.
* New: Project name added on kanban board.
* Fix: Php warning & notices.
* Fix: Some security fixes.
* Fix(Pro feature): Warning in Gantt Chart add-on.
* Fix(Pro feature): Public project’s task not showing on calendar for co-worker.

#### V 2.0.9(Feb 28,2024)

* New: Hooks added.
* Fix: If Setting hide/show time in start date and end date of task is disable, still time diaplay in open project’s tasks in popup window.

#### V 2.0.8(Feb 14,2024)

* New: Highlight due dates of projects and tasks in task list, project list.
* New: Setting given to hide/show time in start date and end date of task.
* Fix: Pagination issue fixed in grid view.

#### V 2.0.7(Jan 10,2024)

* New (Pro feature): Buddypress Integration add-on.
* New: Hooks added.
* Fix: Code Optimization for task list and project list.

#### V 2.0.6(Oct 19,2023)

* New: Filter added in Projects/Tasks list.

#### V 2.0.5(Sep 15,2023)

* New: Hooks added in all add-ons(pro-feature).
* Fix: Sort by category not working on project list.
* Fix: Sort by status not working on project list.
* Fix: PHP warning.

#### V 2.0.4(August 11, 2023)

* New: Public project feature ( You can enable/disable this feature from miscellaneous setting (Projects > Settings > Miscellaneous)).
* New: User can change project while editing task.
* New: Compatible with WordPress v6.3.
* New: Documentation links added in setting.
* Fix: PHP notices and warnings.
* Fix: If user(manager) remove from project, this user still access tasks.

#### V 2.0.3(June 29, 2023)

* New: Sorting Project list by project, status, category, start date and end date.
* New: Improvement in task list search.
* New: Improvement in task list search(Grid view).

#### V 2.0.2(May 11, 2023)

* New: Setting for co-worker’s to edit task.
* Compatible with WordPress v6.2.
* New (Pro feature): Report add-on.

#### V 2.0.1(March 3, 2023)

* New: Sorting task list by name, project, status, priority, start date and end date.

#### V 2.0.0 (January 5,2023)

* New: Setting for Default show/hide start date and end date of project.
* New: Setting for Default show/hide start date and end date of task.
* Fix: Clone task’s custom fields after task cloned.
* Fix: Delete custom fields after deleting task.

#### V 1.0.9 (October 21, 2022)

* New: Kanban board display by statuses order which are set in setting(Projects > Settings >Task Statuses).
* New (Pro feature): Tasks Calendar shortcode added [wppm\_tasks\_calendar] in Task Calendar add-on.

#### V 1.0.8 (September 8, 2022)

* Fix: Cross-Site scripting Vulnerability.

#### V 1.0.7 (August 18, 2022)

* New: Duplicate Project add-on.
* Fix: If clone task delete then attachment of original task also get delete.
* Fix: Checklists not get delete when we delete task and project.
* Fix: Thread attachment get deleted from comment but it is not deleted from upload folder and database.

#### V 1.0.6 (July 14, 2022)

* New: Filter hooks added.
* Fix: If single user is assigned to task, we can’t remove that user from task.
* Fix: Task related email notification(create task, change status, assign user, new comment) does not sending to project manager.
* Fix: In clone task feature task’s creator set to current user instead of original task’s task creator.
* Fix: Clone task’s date creation set to current time instead of original task’s create time.
* Fix: Clone task’s attachment upload time set to current time instead of original task’s attachment upload time.
* Fix: Clone tasks’s comment attachment uploading twice.

#### V 1.0.5 (May 31, 2022)

* New Feature: Clone task.
* Fix : Strings are available for translation(Time in project start date and end date,

  Default show/hide time in start and end date of project, Show).
* New: French translation is available.

#### V 1.0.4 (April 21, 2022)

* Fix : Project status order does not save in setting.
* New : Addon’s menu added.

#### V 1.0.3 (March 10, 2022)

* Fix : After task creation does get not redirected to defaut view set in setting. i.e grid or list view.
* Fix : mime\_content\_type() function not worked in some php versions so changed this function with wordpress’s function wp\_check\_filetype().
* Fix : Can’t download attachments added in last months.

#### V 1.0.2 (January 24, 2022)

* New Feature : Setting given to hide/show time in start date and end date of project.
* Fix : Changed discussion text to comment.
* Fix : If default view for task is set to kanban view in setting then after clicking on task list button it gets redirected to list view.
* Fix : The link option in TinyMCE editor does not open in new window.

#### V 1.0.1 (December 28, 2021)

* Hooks added.

#### V 1.0.0 (October 8, 2021)

* Initial release.

## Meta

* Version **3.0.8**
* Last updated **3 weeks ago**
* Active installations **800+**
* WordPress version **4.4 or higher**
* Tested up to **6.7.1**
* Languages
  See all 3

  Close

  [English (US)](https://wordpress.org/plugins/taskbuilder/), [German](https://de.wordpress.org/plugins/taskbuilder/), and [Romanian](https://ro.wordpress.org/plugins/taskbuilder/).

  [Translate into your language](https://translate.wordpress.org/projects/wp-plugins/taskbuilder)
* Tags [kanban](https://wordpress.org/plugins/tags/kanban/)[project](https://wordpress.org/plugins/tags/project/)[project management](https://wordpress.org/plugins/tags/project-management/)[task management](https://wordpress.org/plugins/tags/task-management/)[task manager](https://wordpress.org/plugins/tags/task-manager/)
* [Advanced View](https://wordpress.org/plugins/taskbuilder/advanced/)

## Ratings

4.7 out of 5 stars.

* [4 5-star reviews
  5 stars

  4](https://wordpress.org/support/plugin/taskbuilder/reviews/?filter=5)
* [2 4-star reviews
  4 stars

  2](https://wordpress.org/support/plugin/taskbuilder/reviews/?filter=4)
* [0 3-star reviews
  3 stars

  0](https://wordpress.org/support/plugin/taskbuilder/reviews/?filter=3)
* [0 2-star reviews
  2 stars

  0](https://wordpress.org/support/plugin/taskbuilder/reviews/?filter=2)
* [0 1-star reviews
  1 star

  0](https://wordpress.org/support/plugin/taskbuilder/reviews/?filter=1)

[Add my review](https://wordpress.org/support/plugin/taskbuilder/reviews/#new-post)

[See all reviews](https://wordpress.org/support/plugin/taskbuilder/reviews/)

## Contributors

* ![](https://secure.gravatar.com/avatar/53c9524a651ae18c130bc3d4155fa7b0dcc8086fa3d87732cc953772466a6ac2?s=32&d=mm&r=g) [taskbuilder](https://profiles.wordpress.org/taskbuilder/)
## Support

Issues resolved in last two months:

0 out of 3

[View support forum](https://wordpress.org/support/plugin/taskbuilder/)

## Donate

Would you like to support the advancement of this plugin?

[Donate to this plugin](https://taskbuilder.net)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Privacy](https://wordpress.org/about/privacy/)

* [Showcase](https://wordpress.org/showcase/)
* [Themes](https://wordpress.org/themes/)
* [Plugins](https://wordpress.org/plugins/)
* [Patterns](https://wordpress.org/patterns/)

* [Learn](https://learn.wordpress.org/)
* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [WordPress.tv ↗](https://wordpress.tv/)

* [Get Involved](https://make.wordpress.org/)
* [Events](https://events.wordpress.org/)
* [Donate ↗](https://wordpressfoundation.org/donate/)
* [Five for the Future](https://wordpress.org/five-for-the-future/)

* [WordPress.com ↗](https://wordpress.com/?ref=wporg-footer)
* [Matt ↗](https://ma.tt/)
* [bbPress ↗](https://bbpress.org/)
* [BuddyPress ↗](https://buddypress.org/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our X (formerly Twitter) account](https://www.x.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)
* [Visit our YouTube channel](https://www.youtube.com/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from plugins.trac.wordpress.org_39cd27ca_20250114_195541.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fbrowser%2Ftaskbuilder%2Ftrunk%2Fincludes%2Ffrontend%2Fwppm_tasks_shortcode.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Revision](/browser/taskbuilder/trunk/includes/frontend/wppm_tasks_shortcode.php?rev=3123269 "Revision 3123269")
* Next Revision →
* [Blame](/browser/taskbuilder/trunk/includes/frontend/wppm_tasks_shortcode.php?annotate=blame "Annotate each line with the last changed revision (this can be time consuming...)")
* [Revision Log](/log/taskbuilder/trunk/includes/frontend/wppm_tasks_shortcode.php)

---

# [source:](/browser?order=name "Go to repository root") [taskbuilder](/browser/taskbuilder?order=name "View taskbuilder")/[trunk](/browser/taskbuilder/trunk?order=name "View trunk")/[includes](/browser/taskbuilder/trunk/includes?order=name "View includes")/[frontend](/browser/taskbuilder/trunk/includes/frontend?order=name "View frontend")/[wppm\_tasks\_shortcode.php](/browser/taskbuilder/trunk/includes/frontend/wppm_tasks_shortcode.php?order=name "View wppm_tasks_shortcode.php")

View diff against:

View revision:

| [Last change](/changeset/3210469/taskbuilder/trunk/includes/frontend/wppm_tasks_shortcode.php "View differences") on this file was [3210469](/changeset/3210469/ "View changeset 3210469"), checked in by taskbuilder, [4 weeks ago](/timeline?from=2024-12-19T12%3A34%3A09Z&precision=second "See timeline at 12/19/2024 12:34:09 PM") |
| --- |
| version change |
| * Property **svn:executable** set to   *`*`* | |
| **File size:** 16.3 KB | |

| Line |  |
| --- | --- |
| [1](#L1) | <?php |
| [2](#L2) | if ( ! defined( 'ABSPATH' ) ) { |
| [3](#L3) | exit; // Exit if accessed directly |
| [4](#L4) | } |
| [5](#L5) |  |
| [6](#L6) | if ( ! class\_exists( 'WPPM\_Tasks\_Shortcode' ) ) : |
| [7](#L7) | final class WPPM\_Tasks\_Shortcode { |
| [8](#L8) | public $shortcode\_attr ; |
| [9](#L9) | // constructor |
| [10](#L10) | public function \_\_construct($attr) { |
| [11](#L11) | global $wppmfunction; |
| [12](#L12) | $this->shortcode\_attr = !empty($attr)? $wppmfunction->sanitize\_array($attr):array(); |
| [13](#L13) | $shortcode\_attr =  $this->shortcode\_attr; |
| [14](#L14) | $this->wppm\_display\_tasks(); |
| [15](#L15) | add\_action('wp\_footer', array($this,'wppm\_page\_inline\_script' ),999999999999999999); |
| [16](#L16) | } |
| [17](#L17) |  |
| [18](#L18) | public function wppm\_display\_tasks(){ |
| [19](#L19) | global $wpdb, $wppmfunction; |
| [20](#L20) | wp\_enqueue\_script('jquery'); |
| [21](#L21) | wp\_enqueue\_script('jquery-ui-core'); |
| [22](#L22) | wp\_enqueue\_script('jquery-ui-sortable'); |
| [23](#L23) | wp\_enqueue\_script('jquery-ui-datepicker' ); |
| [24](#L24) | wp\_enqueue\_editor(); |
| [25](#L25) | wp\_enqueue\_style('wppm-bootstrap-css'); |
| [26](#L26) | wp\_enqueue\_style('wppm-jquery-ui'); |
| [27](#L27) | wp\_enqueue\_style('wppm-public-css'); |
| [28](#L28) | wp\_enqueue\_style('wppm-admin-css'); |
| [29](#L29) | wp\_enqueue\_style('wppm-modal-css'); |
| [30](#L30) | wp\_enqueue\_style('wppm-flatpickr-css'); |
| [31](#L31) | wp\_enqueue\_style('wppm-select2-css'); |
| [32](#L32) | wp\_enqueue\_style('wppm-gpopover-css'); |
| [33](#L33) | wp\_enqueue\_style('wppm-dragula-css'); |
| [34](#L34) | wp\_enqueue\_script('wppm-admin'); |
| [35](#L35) | wp\_enqueue\_script('wppm-public'); |
| [36](#L36) | wp\_enqueue\_script('wppm-modal'); |
| [37](#L37) | wp\_enqueue\_script('wppm-flatpickr-js'); |
| [38](#L38) | wp\_enqueue\_script('wppm-select2-js'); |
| [39](#L39) | wp\_enqueue\_script('wppm-gpopover-js'); |
| [40](#L40) | wp\_enqueue\_script('wppm-dragula-js'); |
| [41](#L41) | $settings = get\_option("wppm-ap-modal"); |
| [42](#L42) | ?> |
| [43](#L43) | <div class="wppm\_bootstrap"> |
| [44](#L44) | <div id="wppm\_task\_container"></div> |
| [45](#L45) | <div id="wppm\_alert\_success" class="alert alert-success wppm\_alert" style="display:none;" role="alert"> |
| [46](#L46) | <img src="<?php echo esc\_url( WPPM\_PLUGIN\_URL . 'asset/images/success.svg'); ?>" alt="success"> <span class="wppm\_alert\_text"></span> |
| [47](#L47) | </div> |
| [48](#L48) | <div id="wppm\_alert\_error" class="alert alert-danger wppm\_alert" style="display:none;" role="alert"> |
| [49](#L49) | <img src="<?php echo esc\_url( WPPM\_PLUGIN\_URL . 'asset/images/warning-triangle.svg'); ?>" alt="warning-triangle"> <span class="wppm\_alert\_text"></span> |
| [50](#L50) | </div> |
| [51](#L51) | </div> |
| [52](#L52) | <!-- Pop-up snippet start --> |
| [53](#L53) | <div id="wppm\_popup\_background" style="display:none;"></div> |
| [54](#L54) | <div id="wppm\_popup\_container" style="display:none;"> |
| [55](#L55) | <div class="wppm\_bootstrap"> |
| [56](#L56) | <div class="row"> |
| [57](#L57) | <div id="wppm\_popup" class="col-xs-10 col-xs-offset-1 col-sm-10 col-sm-offset-1 col-md-8 col-md-offset-2 col-lg-6 col-lg-offset-3"> |
| [58](#L58) | <div id="wppm\_popup\_title" class="row" ><h3><?php echo esc\_html\_e('Modal Title','taskbuilder');?></h3></div> |
| [59](#L59) | <div id="wppm\_popup\_body" class="row"><?php echo esc\_html\_e('I am body!','taskbuilder');?></div> |
| [60](#L60) | <div id="wppm\_popup\_footer" class="row"> |
| [61](#L61) | <button type="button" class="btn wppm\_popup\_close"><?php echo esc\_html\_e('Close','taskbuilder');?></button> |
| [62](#L62) | <button type="button" class="btn wppm\_popup\_action"><?php echo esc\_html\_e('Save Changes','taskbuilder');?></button> |
| [63](#L63) | </div> |
| [64](#L64) | </div> |
| [65](#L65) | </div> |
| [66](#L66) | </div> |
| [67](#L67) | </div> |
| [68](#L68) | <style> |
| [69](#L69) | #wppm\_popup\_title{ |
| [70](#L70) | background-color: <?php echo esc\_attr($settings['header-bg-color'])?>; |
| [71](#L71) | } |
| [72](#L72) | #wppm\_popup\_title h3{ |
| [73](#L73) | color:<?php echo esc\_attr( $settings['header-text-color'])?>; |
| [74](#L74) | } |
| [75](#L75) | #wppm\_popup\_body{ |
| [76](#L76) | background-color: <?php echo esc\_attr($settings['body-bg-color'])?>!important; |
| [77](#L77) | } |
| [78](#L78) | #wppm\_popup\_body label{ |
| [79](#L79) | color:<?php echo esc\_attr( $settings['body-label-color'])?>; |
| [80](#L80) | } |
| [81](#L81) | #wppm\_popup\_body input{ |
| [82](#L82) | color:<?php echo esc\_attr( $settings['body-text-color'])?>; |
| [83](#L83) | } |
| [84](#L84) | #wppm\_popup\_body select{ |
| [85](#L85) | color:<?php echo esc\_attr( $settings['body-text-color'])?>; |
| [86](#L86) | } |
| [87](#L87) | #wppm\_popup\_body span { |
| [88](#L88) | color:<?php echo esc\_attr( $settings['body-text-color'])?>; |
| [89](#L89) | } |
| [90](#L90) | #wppm\_popup\_body .select2-results\_\_options { |
| [91](#L91) | color:<?php echo esc\_attr( $settings['body-text-color'])?>; |
| [92](#L92) | } |
| [93](#L93) | </style> |
| [94](#L94) | <!-- Pop-up snippet end --> |
| [95](#L95) | <?php |
| [96](#L96) | do\_action('wppm\_after\_task\_shortcode\_loaded'); |
| [97](#L97) | } |
| [98](#L98) |  |
| [99](#L99) | public function wppm\_page\_inline\_script() { ?> |
| [100](#L100) | <script type="text/javascript"> |
| [101](#L101) | jQuery( document ).ready( function( jQuery ) { |
| [102](#L102) | <?php if(is\_user\_logged\_in()){ |
| [103](#L103) | if(get\_option('wppm\_default\_task\_list\_view')==1){ ?> |
| [104](#L104) | wppm\_get\_task\_list(); |
| [105](#L105) | <?php } else{ ?> |
| [106](#L106) | wppm\_view\_task\_search\_filter(); |
| [107](#L107) | <?php } |
| [108](#L108) | } else{ ?> |
| [109](#L109) | wppm\_task\_sign\_in(); |
| [110](#L110) | <?php }?> |
| [111](#L111) | }); |
| [112](#L112) |  |
| [113](#L113) | function wppm\_get\_task\_list(page\_no){ |
| [114](#L114) | jQuery('#wppm\_task\_container').show(); |
| [115](#L115) | jQuery('#wppm\_task\_container').html(wppm\_admin.loading\_html); |
| [116](#L116) | var dataform=new FormData(jQuery('#wppm\_task\_list\_frm')[0]); |
| [117](#L117) | <?php echo do\_action('wppm\_task\_list\_dataform');?> |
| [118](#L118) | dataform.append("page\_no", page\_no); |
| [119](#L119) | dataform.append("action", 'wppm\_get\_task\_list'); |
| [120](#L120) | <?php |
| [121](#L121) | if(!empty($this->shortcode\_attr['project'])){ |
| [122](#L122) | ?> |
| [123](#L123) | dataform.append("wppm\_project\_attr","<?php echo esc\_attr($this->shortcode\_attr['project']); ?>"); |
| [124](#L124) | <?php } ?> |
| [125](#L125) | jQuery.ajax( { |
| [126](#L126) | url: wppm\_admin.ajax\_url, |
| [127](#L127) | type: 'POST', |
| [128](#L128) | data: dataform, |
| [129](#L129) | processData: false, |
| [130](#L130) | contentType: false |
| [131](#L131) | }) |
| [132](#L132) | .done(function( response ) { |
| [133](#L133) | jQuery('#wppm\_task\_container').html(response); |
| [134](#L134) | }); |
| [135](#L135) | } |
| [136](#L136) |  |
| [137](#L137) | function wppm\_add\_new\_task(proj\_id){ |
| [138](#L138) | jQuery('#wppm\_task\_container').show(); |
| [139](#L139) | jQuery('#wppm\_task\_container').html(wppm\_admin.loading\_html); |
| [140](#L140) | var dataform=new FormData(jQuery('#wppm\_task\_list\_frm')[0]); |
| [141](#L141) | <?php echo do\_action('wppm\_add\_new\_task\_dataform');?> |
| [142](#L142) | dataform.append("proj\_id", proj\_id); |
| [143](#L143) | dataform.append("action", 'wppm\_add\_new\_task'); |
| [144](#L144) | jQuery.ajax( { |
| [145](#L145) | url: wppm\_admin.ajax\_url, |
| [146](#L146) | type: 'POST', |
| [147](#L147) | data: dataform, |
| [148](#L148) | processData: false, |
| [149](#L149) | contentType: false |
| [150](#L150) | }) |
| [151](#L151) | .done(function( response ) { |
| [152](#L152) | jQuery('#wppm\_task\_container').html(response); |
| [153](#L153) | }); |
| [154](#L154) | } |
| [155](#L155) |  |
| [156](#L156) | function wppm\_apply\_task\_filter(){ |
| [157](#L157) | wppm\_task\_filter = jQuery('#wppm\_task\_filter').find(":selected").val(); |
| [158](#L158) | jQuery('#wppm\_task\_container').html(wppm\_admin.loading\_html); |
| [159](#L159) | var dataform=new FormData(jQuery('#wppm\_task\_list\_frm')[0]); |
| [160](#L160) | <?php echo do\_action('wppm\_apply\_task\_filter\_dataform');?> |
| [161](#L161) | dataform.append("wppm\_task\_filter", wppm\_task\_filter); |
| [162](#L162) | dataform.append("action", 'wppm\_get\_task\_list'); |
| [163](#L163) | <?php if(!empty($this->shortcode\_attr['project'])){ ?> |
| [164](#L164) | dataform.append("wppm\_project\_attr","<?php echo esc\_attr($this->shortcode\_attr['project']); ?>"); |
| [165](#L165) | <?php } ?> |
| [166](#L166) | jQuery.ajax( { |
| [167](#L167) | url: wppm\_admin.ajax\_url, |
| [168](#L168) | type: 'POST', |
| [169](#L169) | data: dataform, |
| [170](#L170) | processData: false, |
| [171](#L171) | contentType: false |
| [172](#L172) | }) |
| [173](#L173) | .done(function( response ) { |
| [174](#L174) | jQuery('#wppm\_task\_container').html(response); |
| [175](#L175) | }); |
| [176](#L176) | } |
| [177](#L177) | function wppm\_tl\_reset\_filter(){ |
| [178](#L178) | jQuery('#wppm\_task\_container').html(wppm\_admin.loading\_html); |
| [179](#L179) | var dataform=new FormData(jQuery('#wppm\_task\_list\_frm')[0]); |
| [180](#L180) | dataform.append("action", 'wppm\_get\_task\_list'); |
| [181](#L181) | dataform.append("wppm\_task\_filter", 'all'); |
| [182](#L182) | dataform.append("task\_search", ''); |
| [183](#L183) | dataform.append("sort\_by", 'task\_name'); |
| [184](#L184) | dataform.append("order", 'ASC'); |
| [185](#L185) | dataform.append("wppm\_proj\_filter",0); |
| [186](#L186) | <?php if(!empty($this->shortcode\_attr['project'])){ ?> |
| [187](#L187) | dataform.append("wppm\_project\_attr","<?php echo esc\_attr($this->shortcode\_attr['project']); ?>"); |
| [188](#L188) | <?php } ?> |
| [189](#L189) | <?php echo do\_action('wppm\_tl\_reset\_filter\_dataform');?> |
| [190](#L190) | jQuery.ajax( { |
| [191](#L191) | url: wppm\_admin.ajax\_url, |
| [192](#L192) | type: 'POST', |
| [193](#L193) | data: dataform, |
| [194](#L194) | processData: false, |
| [195](#L195) | contentType: false |
| [196](#L196) | }) |
| [197](#L197) | .done(function( response ) { |
| [198](#L198) | jQuery('#wppm\_task\_container').html(response); |
| [199](#L199) | }); |
| [200](#L200) | } |
| [201](#L201) |  |
| [202](#L202) | function wppm\_task\_search\_filter(){ |
| [203](#L203) | var task\_search = jQuery("#wppm\_task\_search\_filter").val(); |
| [204](#L204) | jQuery('#wppm\_task\_container').show(); |
| [205](#L205) | jQuery('#wppm\_task\_container').html(wppm\_admin.loading\_html); |
| [206](#L206) | var dataform=new FormData(jQuery('#wppm\_task\_list\_frm')[0]); |
| [207](#L207) | <?php echo do\_action('wppm\_task\_search\_filter\_dataform');?> |
| [208](#L208) | dataform.append("action", 'wppm\_get\_task\_list'); |
| [209](#L209) | <?php if(!empty($this->shortcode\_attr['project'])){ ?> |
| [210](#L210) | dataform.append("wppm\_project\_attr","<?php echo esc\_attr($this->shortcode\_attr['project']); ?>"); |
| [211](#L211) | <?php } ?> |
| [212](#L212) | dataform.append("task\_search", task\_search); |
| [213](#L213) | jQuery.ajax( { |
| [214](#L214) | url: wppm\_admin.ajax\_url, |
| [215](#L215) | type: 'POST', |
| [216](#L216) | data: dataform, |
| [217](#L217) | processData: false, |
| [218](#L218) | contentType: false |
| [219](#L219) | }) |
| [220](#L220) | .done(function( response ) { |
| [221](#L221) | jQuery('#wppm\_task\_container').html(response); |
| [222](#L222) | }); |
| [223](#L223) | } |
| [224](#L224) |  |
| [225](#L225) | function wppm\_display\_grid\_view(){ |
| [226](#L226) | var task\_search = jQuery("#wppm\_view\_task\_search\_filter").val(); |
| [227](#L227) | jQuery('#wppm\_task\_container').show(); |
| [228](#L228) | jQuery('#wppm\_task\_container').html(wppm\_admin.loading\_html); |
| [229](#L229) | var dataform=new FormData(jQuery('#wppm\_view\_project\_task')[0]); |
| [230](#L230) | <?php echo do\_action('wppm\_display\_grid\_view\_dataform');?> |
| [231](#L231) | dataform.append("action", 'wppm\_get\_task\_list\_card\_view'); |
| [232](#L232) | dataform.append("task\_search", task\_search); |
| [233](#L233) | <?php if(!empty($this->shortcode\_attr['project'])){ ?> |
| [234](#L234) | dataform.append("wppm\_project\_attr","<?php echo esc\_attr($this->shortcode\_attr['project']); ?>"); |
| [235](#L235) | <?php } ?> |
| [236](#L236) | jQuery.ajax( { |
| [237](#L237) | url: wppm\_admin.ajax\_url, |
| [238](#L238) | type: 'POST', |
| [239](#L239) | data: dataform, |
| [240](#L240) | processData: false, |
| [241](#L241) | contentType: false |
| [242](#L242) | }) |
| [243](#L243) | .done(function( response ) { |
| [244](#L244) | jQuery('#wppm\_task\_container').html(response); |
| [245](#L245) | }); |
| [246](#L246) | } |
| [247](#L247) |  |
| [248](#L248) | function wppm\_sort\_up\_task\_list(sort\_by,order){ |
| [249](#L249) | jQuery('#wppm\_task\_container').show(); |
| [250](#L250) | jQuery('#wppm\_task\_container').html(wppm\_admin.loading\_html); |
| [251](#L251) | var dataform=new FormData(jQuery('#wppm\_task\_list\_frm')[0]); |
| [252](#L252) | <?php echo do\_action('wppm\_sort\_up\_task\_list\_dataform');?> |
| [253](#L253) | dataform.append("action", 'wppm\_get\_task\_list'); |
| [254](#L254) | dataform.append("sort\_by", sort\_by); |
| [255](#L255) | dataform.append("order", order); |
| [256](#L256) | <?php if(!empty($this->shortcode\_attr['project'])){ ?> |
| [257](#L257) | dataform.append("wppm\_project\_attr","<?php echo esc\_attr($this->shortcode\_attr['project']); ?>"); |
| [258](#L258) | <?php } ?> |
| [259](#L259) | jQuery.ajax( { |
| [260](#L260) | url: wppm\_admin.ajax\_url, |
| [261](#L261) | type: 'POST', |
| [262](#L262) | data: dataform, |
| [263](#L263) | processData: false, |
| [264](#L264) | contentType: false |
| [265](#L265) | }) |
| [266](#L266) | .done(function( response ) { |
| [267](#L267) | jQuery('#wppm\_task\_container').html(response); |
| [268](#L268) | }); |
| [269](#L269) | } |
| [270](#L270) |  |
| [271](#L271) | function wppm\_view\_task\_search\_filter(page\_no){ |
| [272](#L272) | var task\_search = jQuery("#wppm\_view\_task\_search\_filter").val(); |
| [273](#L273) | if(typeof task\_search == "undefined"){ |
| [274](#L274) | var task\_search =""; |
| [275](#L275) | }else{ |
| [276](#L276) | var task\_search =jQuery("#wppm\_view\_task\_search\_filter").val(); |
| [277](#L277) | } |
| [278](#L278) | jQuery('#wppm\_task\_container').show(); |
| [279](#L279) | jQuery('#wppm\_task\_container').html(wppm\_admin.loading\_html); |
| [280](#L280) | var dataform=new FormData(jQuery('#wppm\_view\_project\_task')[0]); |
| [281](#L281) | <?php echo do\_action('wppm\_view\_task\_search\_filter\_dataform');?> |
| [282](#L282) | dataform.append("action", 'wppm\_get\_task\_list\_card\_view'); |
| [283](#L283) | dataform.append("task\_search", task\_search); |
| [284](#L284) | dataform.append("page\_no",page\_no); |
| [285](#L285) | <?php if(!empty($this->shortcode\_attr['project'])){ ?> |
| [286](#L286) | dataform.append("wppm\_project\_attr","<?php echo esc\_attr($this->shortcode\_attr['project']); ?>"); |
| [287](#L287) | <?php } ?> |
| [288](#L288) | jQuery.ajax( { |
| [289](#L289) | url: wppm\_admin.ajax\_url, |
| [290](#L290) | type: 'POST', |
| [291](#L291) | data: dataform, |
| [292](#L292) | processData: false, |
| [293](#L293) | contentType: false |
| [294](#L294) | }) |
| [295](#L295) | .done(function( response ) { |
| [296](#L296) | jQuery('#wppm\_task\_container').html(response); |
| [297](#L297) | }); |
| [298](#L298) | } |
| [299](#L299) |  |
| [300](#L300) | function wppm\_apply\_task\_filter\_grid\_view(){ |
| [301](#L301) | wppm\_task\_filter = jQuery('#wppm\_task\_filter').find(":selected").val(); |
| [302](#L302) | jQuery('#wppm\_task\_container').html(wppm\_admin.loading\_html); |
| [303](#L303) | var dataform=new FormData(jQuery('#wppm\_view\_project\_task')[0]); |
| [304](#L304) | <?php echo do\_action('wppm\_apply\_task\_filter\_grid\_view\_dataform');?> |
| [305](#L305) | dataform.append("action", 'wppm\_view\_project\_tasks'); |
| [306](#L306) | dataform.append("wppm\_task\_filter", wppm\_task\_filter); |
| [307](#L307) | <?php if(!empty($this->shortcode\_attr['project'])){ ?> |
| [308](#L308) | dataform.append("wppm\_project\_attr","<?php echo esc\_attr($this->shortcode\_attr['project']); ?>"); |
| [309](#L309) | <?php } ?> |
| [310](#L310) | jQuery.ajax( { |
| [311](#L311) | url: wppm\_admin.ajax\_url, |
| [312](#L312) | type: 'POST', |
| [313](#L313) | data: dataform, |
| [314](#L314) | processData: false, |
| [315](#L315) | contentType: false |
| [316](#L316) | }) |
| [317](#L317) | .done(function( response ) { |
| [318](#L318) | jQuery('#wppm\_task\_container').html(response); |
| [319](#L319) | }); |
| [320](#L320) | } |
| [321](#L321) |  |
| [322](#L322) | function wppm\_tl\_reset\_grid\_view\_filter(){ |
| [323](#L323) | jQuery('#wppm\_task\_container').html(wppm\_admin.loading\_html); |
| [324](#L324) | var dataform=new FormData(jQuery('#wppm\_view\_project\_task')[0]); |
| [325](#L325) | <?php echo do\_action('wppm\_tl\_reset\_grid\_view\_filter\_dataform');?> |
| [326](#L326) | dataform.append("action", 'wppm\_view\_project\_tasks'); |
| [327](#L327) | dataform.append("task\_search", ""); |
| [328](#L328) | dataform.append("wppm\_task\_filter", "all"); |
| [329](#L329) | dataform.append("sort\_by", "task\_name"); |
| [330](#L330) | dataform.append("order", "ASC"); |
| [331](#L331) | dataform.append("wppm\_proj\_filter","0"); |
| [332](#L332) | <?php if(!empty($this->shortcode\_attr['project'])){ ?> |
| [333](#L333) | dataform.append("wppm\_project\_attr","<?php echo esc\_attr($this->shortcode\_attr['project']); ?>"); |
| [334](#L334) | <?php } ?> |
| [335](#L335) | jQuery.ajax( { |
| [336](#L336) | url: wppm\_admin.ajax\_url, |
| [337](#L337) | type: 'POST', |
| [338](#L338) | data: dataform, |
| [339](#L339) | processData: false, |
| [340](#L340) | contentType: false |
| [341](#L341) | }) |
| [342](#L342) | .done(function( response ) { |
| [343](#L343) | jQuery('#wppm\_task\_container').html(response); |
| [344](#L344) | }); |
| [345](#L345) | } |
| [346](#L346) | function wppm\_tasks\_by\_select\_project(){ |
| [347](#L347) | wppm\_proj\_filter = jQuery('#wppm\_task\_list\_proj\_filter').find(":selected").val(); |
| [348](#L348) | jQuery('#wppm\_task\_container').html(wppm\_admin.loading\_html); |
| [349](#L349) | var dataform=new FormData(jQuery('#wppm\_task\_list\_frm')[0]); |
| [350](#L350) | <?php echo do\_action('wppm\_change\_proj\_tl\_filter\_dataform');?> |
| [351](#L351) | dataform.append("action", 'wppm\_get\_task\_list'); |
| [352](#L352) | dataform.append("wppm\_proj\_filter",wppm\_proj\_filter); |
| [353](#L353) | jQuery.ajax( { |
| [354](#L354) | url: wppm\_admin.ajax\_url, |
| [355](#L355) | type: 'POST', |
| [356](#L356) | data: dataform, |
| [357](#L357) | processData: false, |
| [358](#L358) | contentType: false |
| [359](#L359) | }) |
| [360](#L360) | .done(function( response ) { |
| [361](#L361) | jQuery('#wppm\_task\_container').html(response); |
| [362](#L362) | }); |
| [363](#L363) | } |
| [364](#L364) |  |
| [365](#L365) | function wppm\_tasks\_by\_select\_project\_grid\_view(){ |
| [366](#L366) | wppm\_proj\_filter = jQuery('#wppm\_task\_list\_proj\_filter').find(":selected").val(); |
| [367](#L367) | jQuery('#wppm\_task\_container').html(wppm\_admin.loading\_html); |
| [368](#L368) | var dataform=new FormData(jQuery('#wppm\_view\_project\_task')[0]); |
| [369](#L369) | <?php echo do\_action('wppm\_change\_proj\_grid\_view\_filter\_dataform');?> |
| [370](#L370) | dataform.append("action", 'wppm\_view\_project\_tasks'); |
| [371](#L371) | dataform.append("wppm\_proj\_filter",wppm\_proj\_filter); |
| [372](#L372) | jQuery.ajax( { |
| [373](#L373) | url: wppm\_admin.ajax\_url, |
| [374](#L374) | type: 'POST', |
| [375](#L375) | data: dataform, |
| [376](#L376) | processData: false, |
| [377](#L377) | contentType: false |
| [378](#L378) | }) |
| [379](#L379) | .done(function( response ) { |
| [380](#L380) | jQuery('#wppm\_task\_container').html(response); |
| [381](#L381) | }); |
| [382](#L382) | } |
| [383](#L383) | </script> |
| [384](#L384) | <?php } |
| [385](#L385) | } |
| [386](#L386) | endif; |
| [387](#L387) | $GLOBALS['wppmtaskshortcode'] =  new WPPM\_Tasks\_Shortcode($attr); |

**Note:** See [TracBrowser](/wiki/TracBrowser)
for help on using the repository browser.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Plain Text](/browser/taskbuilder/trunk/includes/frontend/wppm_tasks_shortcode.php?format=txt)
* [Original Format](/export/3222464/taskbuilder/trunk/includes/frontend/wppm_tasks_shortcode.php)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from www.wordfence.com_a0344290_20250114_195606.html ===


[![](https://www.wordfence.com/img/wordfence-intelligence-logo.svg)](/threat-intel/)

Have you found a vulnerability in a WordPress plugin or theme? Report vulnerabilities in WordPress plugins and themes through our [bug bounty program](https://www.wordfence.com/threat-intel/bug-bounty-program) and earn a bounty on all in-scope submissions, while we handle the responsible disclosure process on your behalf.

As a reminder, the Wordfence Intelligence Vulnerability Database API is completely free to query and utilize, both personally and commercially, and contains all the same vulnerability data as the user interface. Please review the API documentation and Webhook documentation for more information on how to query the vulnerability API endpoints and configure webhooks utilizing all the same data present in the Wordfence Intelligence user interface.

# Taskbuilder – WordPress Project & Task Management plugin <= 3.0.6 - Authenticated (Contributor+) Stored Cross-Site Scripting via wppm\_tasks Shortcode

 [Wordfence Intelligence](https://www.wordfence.com/threat-intel)   >    [Vulnerability Database](https://www.wordfence.com/threat-intel/vulnerabilities)   >   Taskbuilder – WordPress Project & Task Management plugin <= 3.0.6 - Authenticated (Contributor+) Stored Cross-Site Scripting via wppm\_tasks Shortcode

6.4

**Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')**
**CVSS Vector**
[CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:C/C:L/I:L/A:N](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:C/C:L/I:L/A:N)

| CVE | [CVE-2024-11930](https://www.cve.org/CVERecord?id=CVE-2024-11930) |
| --- | --- |
| CVSS | 6.4 (Medium) |
| Publicly Published | January 3, 2025 |
| Last Updated | January 4, 2025 |
| Researcher | [Peter Thaleikis](https://www.wordfence.com/threat-intel/vulnerabilities/researchers/spek) |

### Description

The Taskbuilder – WordPress Project & Task Management plugin plugin for WordPress is vulnerable to Stored Cross-Site Scripting via the plugin's wppm\_tasks shortcode in all versions up to, and including, 3.0.6 due to insufficient input sanitization and output escaping on user supplied attributes. This makes it possible for authenticated attackers, with contributor-level access and above, to inject arbitrary web scripts in pages that will execute whenever a user accesses an injected page.

#### References

* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/browser/taskbuilder/trunk/includes/frontend/wppm_tasks_shortcode.php#L123)
* [wordpress.org](https://wordpress.org/plugins/taskbuilder/#developers)
* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/changeset/3210469/)

#### Share

[Facebook](https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Ftaskbuilder%2Ftaskbuilder-wordpress-project-task-management-plugin-306-authenticated-contributor-stored-cross-site-scripting-via-wppm-tasks-shortcode&t=Taskbuilder%20%E2%80%93%20WordPress%20Project%20%26%20Task%20Management%20plugin%20%3C%3D%203.0.6%20-%20Authenticated%20%28Contributor%2B%29%20Stored%20Cross-Site%20Scripting%20via%20wppm_tasks%20Shortcode "Facebook")
[Twitter](https://twitter.com/share?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Ftaskbuilder%2Ftaskbuilder-wordpress-project-task-management-plugin-306-authenticated-contributor-stored-cross-site-scripting-via-wppm-tasks-shortcode&text=Taskbuilder%20%E2%80%93%20WordPress%20Project%20%26%20Task%20Management%20plugin%20%3C%3D%203.0.6%20-%20Authenticated%20%28Contributor%2B%29%20Stored%20Cross-Site%20Scripting%20via%20wppm_tasks%20Shortcode "Twitter")
[LinkedIn](https://www.linkedin.com/shareArticle?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Ftaskbuilder%2Ftaskbuilder-wordpress-project-task-management-plugin-306-authenticated-contributor-stored-cross-site-scripting-via-wppm-tasks-shortcode "LinkedIn")
Email

## Vulnerability Details for Taskbuilder – WordPress Project & Task Management plugin

#### [Taskbuilder – WordPress Project & Task Management plugin](https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/taskbuilder)

| Software Type | Plugin |
| --- | --- |
| Software Slug | taskbuilder [(view on wordpress.org)](https://wordpress.org/plugins/taskbuilder) |
| Patched? | Yes |
| Remediation | Update to version 3.0.7, or a newer patched version |
| Affected Version | * <= 3.0.6 |
| Patched Version | * 3.0.7 |

This record contains material that is subject to copyright.

**Copyright 2012-2025 Defiant Inc.**

**License:**
Defiant hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute this software vulnerability information. Any copy of the software vulnerability information you make for such purposes is authorized provided that you include a hyperlink to this vulnerability record and reproduce Defiant's copyright designation and this license in any such copy.
**[Read more.](https://www.wordfence.com/wordfence-intelligence-terms-and-conditions/)**

**Copyright 1999-2025 The MITRE Corporation**

**License:**
CVE Usage: MITRE hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute Common Vulnerabilities and Exposures (CVE®). Any copy you make for such purposes is authorized provided that you reproduce MITRE's copyright designation and this license in any such copy.
**[Read more.](https://www.cve.org/Legal/TermsOfUse)**

Have information to add, or spot any errors? Contact us at wfi-support@wordfence.com so we can make any appropriate adjustments.

Did you know Wordfence Intelligence provides free personal and commercial API access to our comprehensive WordPress vulnerability database, along with a free webhook integration to stay on top of the latest vulnerabilities added and updated in the database? Get started today!

Learn more

Want to get notified of the latest vulnerabilities that may affect your WordPress site?
 Install Wordfence on your site today to get notified immediately if your site is affected by a vulnerability that has been added to our database.

Get Wordfence

The Wordfence Intelligence WordPress vulnerability database is completely free to access and query via API. Please review the documentation on how to access and consume the vulnerability data via API.

Documentation


