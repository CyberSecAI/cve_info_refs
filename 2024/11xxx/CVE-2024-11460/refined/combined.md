=== Content from www.wordfence.com_7f78c560_20250115_091124.html ===


[![](https://www.wordfence.com/img/wordfence-intelligence-logo.svg)](/threat-intel/)

Have you found a vulnerability in a WordPress plugin or theme? Report vulnerabilities in WordPress plugins and themes through our [bug bounty program](https://www.wordfence.com/threat-intel/bug-bounty-program) and earn a bounty on all in-scope submissions, while we handle the responsible disclosure process on your behalf.

As a reminder, the Wordfence Intelligence Vulnerability Database API is completely free to query and utilize, both personally and commercially, and contains all the same vulnerability data as the user interface. Please review the API documentation and Webhook documentation for more information on how to query the vulnerability API endpoints and configure webhooks utilizing all the same data present in the Wordfence Intelligence user interface.

# Verowa Connect <= 3.0.1 - Unauthenticated SQL Injection

 [Wordfence Intelligence](https://www.wordfence.com/threat-intel)   >    [Vulnerability Database](https://www.wordfence.com/threat-intel/vulnerabilities)   >   Verowa Connect <= 3.0.1 - Unauthenticated SQL Injection

7.5

**Improper Neutralization of Special Elements used in an SQL Command ('SQL Injection')**
**CVSS Vector**
[CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:N/A:N](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:N/A:N)

| CVE | [CVE-2024-11460](https://www.cve.org/CVERecord?id=CVE-2024-11460) |
| --- | --- |
| CVSS | 7.5 (High) |
| Publicly Published | December 5, 2024 |
| Last Updated | December 6, 2024 |
| Researcher | [Colin Xu](https://www.wordfence.com/threat-intel/vulnerabilities/researchers/colin-xu) |

### Description

The Verowa Connect plugin for WordPress is vulnerable to SQL Injection via the 'search\_string' parameter in all versions up to, and including, 3.0.1 due to insufficient escaping on the user supplied parameter and lack of sufficient preparation on the existing SQL query. This makes it possible for unauthenticated attackers to append additional SQL queries into already existing queries that can be used to extract sensitive information from the database.

#### References

* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/browser/verowa-connect/trunk/general/rest-routes.php#L92)
* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/changeset?sfp_email=&sfph_mail=&reponame=&old=3201030%40verowa-connect&new=3201030%40verowa-connect&sfp_email=&sfph_mail=)

#### Share

[Facebook](https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fverowa-connect%2Fverowa-connect-301-unauthenticated-sql-injection&t=Verowa%20Connect%20%3C%3D%203.0.1%20-%20Unauthenticated%20SQL%20Injection "Facebook")
[Twitter](https://twitter.com/share?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fverowa-connect%2Fverowa-connect-301-unauthenticated-sql-injection&text=Verowa%20Connect%20%3C%3D%203.0.1%20-%20Unauthenticated%20SQL%20Injection "Twitter")
[LinkedIn](https://www.linkedin.com/shareArticle?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fverowa-connect%2Fverowa-connect-301-unauthenticated-sql-injection "LinkedIn")
Email

## Vulnerability Details for Verowa Connect

#### [Verowa Connect](https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/verowa-connect)

| Software Type | Plugin |
| --- | --- |
| Software Slug | verowa-connect [(view on wordpress.org)](https://wordpress.org/plugins/verowa-connect) |
| Patched? | Yes |
| Remediation | Update to version 3.0.2, or a newer patched version |
| Affected Version | * <= 3.0.1 |
| Patched Version | * 3.0.2 |

This record contains material that is subject to copyright.

**Copyright 2012-2025 Defiant Inc.**

**License:**
Defiant hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute this software vulnerability information. Any copy of the software vulnerability information you make for such purposes is authorized provided that you include a hyperlink to this vulnerability record and reproduce Defiant's copyright designation and this license in any such copy.
**[Read more.](https://www.wordfence.com/wordfence-intelligence-terms-and-conditions/)**

**Copyright 1999-2025 The MITRE Corporation**

**License:**
CVE Usage: MITRE hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute Common Vulnerabilities and Exposures (CVE®). Any copy you make for such purposes is authorized provided that you reproduce MITRE's copyright designation and this license in any such copy.
**[Read more.](https://www.cve.org/Legal/TermsOfUse)**

Have information to add, or spot any errors? Contact us at wfi-support@wordfence.com so we can make any appropriate adjustments.

Did you know Wordfence Intelligence provides free personal and commercial API access to our comprehensive WordPress vulnerability database, along with a free webhook integration to stay on top of the latest vulnerabilities added and updated in the database? Get started today!

Learn more

Want to get notified of the latest vulnerabilities that may affect your WordPress site?
 Install Wordfence on your site today to get notified immediately if your site is affected by a vulnerability that has been added to our database.

Get Wordfence

The Wordfence Intelligence WordPress vulnerability database is completely free to access and query via API. Please review the documentation on how to access and consume the vulnerability data via API.

Documentation



=== Content from plugins.trac.wordpress.org_091a198a_20250115_091111.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fbrowser%2Fverowa-connect%2Ftrunk%2Fgeneral%2Frest-routes.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Revision](/browser/verowa-connect/trunk/general/rest-routes.php?rev=3159837 "Revision 3159837")
* Next Revision →
* [Blame](/browser/verowa-connect/trunk/general/rest-routes.php?annotate=blame "Annotate each line with the last changed revision (this can be time consuming...)")
* [Revision Log](/log/verowa-connect/trunk/general/rest-routes.php)

---

# [source:](/browser?order=name "Go to repository root") [verowa-connect](/browser/verowa-connect?order=name "View verowa-connect")/[trunk](/browser/verowa-connect/trunk?order=name "View trunk")/[general](/browser/verowa-connect/trunk/general?order=name "View general")/[rest-routes.php](/browser/verowa-connect/trunk/general/rest-routes.php?order=name "View rest-routes.php")

View diff against:

View revision:

| [Last change](/changeset/3201030/verowa-connect/trunk/general/rest-routes.php "View differences") on this file was [3201030](/changeset/3201030/ "View changeset 3201030"), checked in by michaelpfister, [6 weeks ago](/timeline?from=2024-12-02T15%3A38%3A14Z&precision=second "See timeline at 12/02/2024 03:38:14 PM") |
| --- |
| Update trunk to 3.0.2 |
| * Property **svn:executable** set to   *`*`* | |
| **File size:** 13.7 KB | |

| Line |  |
| --- | --- |
| [1](#L1) | <?php |
| [2](#L2) | /\*\* |
| [3](#L3) | \* Implements all wp-json extensions for "Verowa Connect". |
| [4](#L4) | \* |
| [5](#L5) | \* Encoding: UTF-8 (ẅ) |
| [6](#L6) | \* |
| [7](#L7) | \* @author © Picture-Planet GmbH |
| [8](#L8) | \* @package Verowa Connect |
| [9](#L9) | \* @subpackage General |
| [10](#L10) | \*/ |
| [11](#L11) |  |
| [12](#L12) | /\*\* |
| [13](#L13) | \* This rest wrapper provides us with the content for the event details in the event list. |
| [14](#L14) | \* For the list display, the rough list is first retrieved via REST query; only then, when the |
| [15](#L15) | \* page is displayed, we use JS to retrieve the details from Verowa for each individual event. |
| [16](#L16) | \* We do not make the request directly to the Verowa API via jQuery because this would reveal the API key. |
| [17](#L17) | \*/ |
| [18](#L18) |  |
| [19](#L19) | add\_action( |
| [20](#L20) | 'rest\_api\_init', |
| [21](#L21) | function () { |
| [22](#L22) | register\_rest\_route( |
| [23](#L23) | 'verowa/v1', |
| [24](#L24) | '/event/(?P<id>\d+)', |
| [25](#L25) | array( |
| [26](#L26) | 'methods'             => 'GET', |
| [27](#L27) | 'callback'            => 'verowa\_event\_id\_rest\_wrapper', |
| [28](#L28) | 'permission\_callback' => 'verowa\_api\_permission\_callback', |
| [29](#L29) | ) |
| [30](#L30) | ); |
| [31](#L31) | } |
| [32](#L32) | ); |
| [33](#L33) |  |
| [34](#L34) |  |
| [35](#L35) |  |
| [36](#L36) |  |
| [37](#L37) | /\*\* |
| [38](#L38) | \* Callback function for the REST wrapper |
| [39](#L39) | \* |
| [40](#L40) | \* @param array $data [id => event\_id ]. |
| [41](#L41) | \* @return mixed |
| [42](#L42) | \*/ |
| [43](#L43) | function verowa\_event\_id\_rest\_wrapper( $data ) { |
| [44](#L44) | $event\_id       = intval( $data['id'] ?? 0 ); |
| [45](#L45) | $arr\_event\_data = verowa\_event\_db\_get\_content( $event\_id ); |
| [46](#L46) |  |
| [47](#L47) | return $arr\_event\_data; |
| [48](#L48) | } |
| [49](#L49) |  |
| [50](#L50) |  |
| [51](#L51) |  |
| [52](#L52) |  |
| [53](#L53) | add\_action( |
| [54](#L54) | 'rest\_api\_init', |
| [55](#L55) | function () { |
| [56](#L56) | register\_rest\_route( |
| [57](#L57) | 'verowa/v1', |
| [58](#L58) | '/agenda\_event/(?P<current\_batch>[-a-zA-Z0-9\_]+)/', |
| [59](#L59) | array( |
| [60](#L60) | 'methods'             => 'GET', |
| [61](#L61) | 'callback'            => 'verowa\_get\_agenda\_events', |
| [62](#L62) | 'permission\_callback' => 'verowa\_api\_permission\_callback', |
| [63](#L63) | ) |
| [64](#L64) | ); |
| [65](#L65) | } |
| [66](#L66) | ); |
| [67](#L67) |  |
| [68](#L68) |  |
| [69](#L69) |  |
| [70](#L70) |  |
| [71](#L71) | /\*\* |
| [72](#L72) | \* Get agenda events based on the provided filter data. |
| [73](#L73) | \* |
| [74](#L74) | \* @param array $data An array containing filter data for the agenda events. |
| [75](#L75) | \*                   The array may contain the following keys: |
| [76](#L76) | \*                   - 'current\_batch': The current batch number of events to retrieve. |
| [77](#L77) | \* |
| [78](#L78) | \* @return stdClass A stdClass object containing the results of the query. |
| [79](#L79) | \*                 The object may contain the following properties: |
| [80](#L80) | \*                 - 'has\_further\_results': A boolean indicating whether there are further results. |
| [81](#L81) | \*                 - 'content': A string containing the HTML content of the retrieved events. |
| [82](#L82) | \*/ |
| [83](#L83) | function verowa\_get\_agenda\_events( $data ) { |
| [84](#L84) | global $post; |
| [85](#L85) |  |
| [86](#L86) | $str\_content       = ''; |
| [87](#L87) | $result            = new stdClass(); |
| [88](#L88) | $str\_session\_key   = verowa\_get\_key\_from\_cookie(); |
| [89](#L89) | $str\_date8         = sanitize\_text\_field( trim( wp\_unslash( $\_GET['date'] ?? '' ) ) ); |
| [90](#L90) | $arr\_list\_ids      = $\_GET['arr\_list\_ids'] ?? array(); |
| [91](#L91) | $arr\_list\_ids      = array\_map( 'sanitize\_text\_field', $arr\_list\_ids ); |
| [92](#L92) | $str\_search\_string = sanitize\_text\_field( wp\_unslash( $\_GET['search\_string'] ?? '' ) ); |
| [93](#L93) | $str\_language\_code = sanitize\_text\_field( wp\_unslash( $\_GET['wpml\_language\_code'] ?? '' ) ); |
| [94](#L94) | $format\_in         = 'Y-m-d H:i:s'; |
| [95](#L95) | $obj\_date\_filter   = 'now'; |
| [96](#L96) | $arr\_user\_data     = verowa\_get\_user\_data( $str\_session\_key ); |
| [97](#L97) |  |
| [98](#L98) | $arr\_user\_data['verowa\_agenda\_current\_batch']           = intval( $data['current\_batch'] ); |
| [99](#L99) | $arr\_user\_data['verowa\_agenda\_filter']                  = array(); |
| [100](#L100) | $arr\_user\_data['verowa\_agenda\_filter']['search\_string'] = esc\_sql( $str\_search\_string ); |
| [101](#L101) | $arr\_user\_data['verowa\_agenda\_filter']['arr\_list\_ids']  = esc\_sql( $arr\_list\_ids ); |
| [102](#L102) |  |
| [103](#L103) | if ( strlen( $str\_date8 ) > 0 ) { |
| [104](#L104) | $arr\_user\_data['verowa\_agenda\_filter']['date8\_displays\_from'] = esc\_sql( $str\_date8 ); |
| [105](#L105) |  |
| [106](#L106) | $str\_date\_filter = substr( $str\_date8, 0, 4 ) . '-' . substr( $str\_date8, 4, 2 ) . '-' . |
| [107](#L107) | substr( $str\_date8, 6, 2 ) . ' 00:00:00'; |
| [108](#L108) | $obj\_date\_filter = DateTime::createFromFormat( $format\_in, $str\_date\_filter, wp\_timezone() ); |
| [109](#L109) | } |
| [110](#L110) |  |
| [111](#L111) | verowa\_update\_user\_data( $str\_session\_key, $arr\_user\_data ); |
| [112](#L112) |  |
| [113](#L113) | // check if the date is proper set. |
| [114](#L114) | $obj\_date\_filter = false === $obj\_date\_filter ? 'now' : $obj\_date\_filter; |
| [115](#L115) |  |
| [116](#L116) | $batch\_size = intval (get\_option( 'verowa\_agenda\_batch\_size', 50 )); |
| [117](#L117) | $int\_offset = ( intval( $data['current\_batch'] ) \* $batch\_size ) - $batch\_size; |
| [118](#L118) |  |
| [119](#L119) | $arr\_events = verowa\_events\_db\_get\_agenda( |
| [120](#L120) | '', |
| [121](#L121) | implode( ',', $arr\_list\_ids ), |
| [122](#L122) | $str\_search\_string, |
| [123](#L123) | $batch\_size, |
| [124](#L124) | $int\_offset, |
| [125](#L125) | $obj\_date\_filter |
| [126](#L126) | ); |
| [127](#L127) |  |
| [128](#L128) | $result->has\_further\_results = count( $arr\_events ?? [] ) === $batch\_size ? true : false; |
| [129](#L129) |  |
| [130](#L130) | $template\_id = 0; |
| [131](#L131) | if ( null !== $post ) { |
| [132](#L132) | $template\_id = intval( get\_post\_meta( $post->ID, 'verowa\_eventlist\_template', true ) ); |
| [133](#L133) | } |
| [134](#L134) |  |
| [135](#L135) | // If there is no template id in the post meta either we get the default from the options. |
| [136](#L136) | if ( 0 === $template\_id ) { |
| [137](#L137) | $template\_id = intval( get\_option( 'verowa\_default\_eventlist\_template' ) ); |
| [138](#L138) | } |
| [139](#L139) | $arr\_templates = verowa\_get\_single\_template( $template\_id ); |
| [140](#L140) |  |
| [141](#L141) | foreach ( $arr\_events as $arr\_single\_event ) { |
| [142](#L142) | $str\_content .= do\_shortcode( |
| [143](#L143) | verowa\_event\_show\_single( |
| [144](#L144) | $arr\_single\_event, |
| [145](#L145) | $arr\_templates, |
| [146](#L146) | $str\_language\_code |
| [147](#L147) | ) |
| [148](#L148) | ); |
| [149](#L149) | } |
| [150](#L150) |  |
| [151](#L151) | $result->content = $str\_content; |
| [152](#L152) | return $result; |
| [153](#L153) | } |
| [154](#L154) |  |
| [155](#L155) |  |
| [156](#L156) | add\_action( |
| [157](#L157) | 'rest\_api\_init', |
| [158](#L158) | function () { |
| [159](#L159) | register\_rest\_route( |
| [160](#L160) | 'verowa/v1', |
| [161](#L161) | '/plugin\_info', |
| [162](#L162) | array( |
| [163](#L163) | 'methods'             => 'GET', |
| [164](#L164) | 'callback'            => 'verowa\_return\_plugin\_info', |
| [165](#L165) | 'permission\_callback' => 'verowa\_api\_permission\_callback', |
| [166](#L166) | ) |
| [167](#L167) | ); |
| [168](#L168) | } |
| [169](#L169) | ); |
| [170](#L170) |  |
| [171](#L171) |  |
| [172](#L172) |  |
| [173](#L173) |  |
| [174](#L174) | /\*\* |
| [175](#L175) | \* Return an array containing information about the Verowa Connect plugin. |
| [176](#L176) | \* |
| [177](#L177) | \* @return array |
| [178](#L178) | \*/ |
| [179](#L179) | function verowa\_return\_plugin\_info() { |
| [180](#L180) | global $wpdb; |
| [181](#L181) |  |
| [182](#L182) | $plugin\_data = verowa\_connect\_get\_plugin\_data(); |
| [183](#L183) | $arr\_counts  = verowa\_get\_custom\_posts\_count(); |
| [184](#L184) |  |
| [185](#L185) | // -1 indicates that an error has occurred |
| [186](#L186) | $count\_deprecated\_person\_groups = $wpdb->get\_var( |
| [187](#L187) | 'SELECT count(\*) as `count` ' . |
| [188](#L188) | 'FROM `' . $wpdb->prefix . 'verowa\_person\_groups` WHERE `deprecated` = 1;' |
| [189](#L189) | ) ?? -1; |
| [190](#L190) |  |
| [191](#L191) | return array( |
| [192](#L192) | 'version'                   => $plugin\_data['Version'], |
| [193](#L193) | 'member'                    => get\_option( 'verowa\_instance', true ), |
| [194](#L194) | 'culture'                   => get\_locale(), |
| [195](#L195) | 'verowa\_connect\_db\_version' => get\_option( 'verowa\_connect\_db\_version', -1 ), |
| [196](#L196) | 'verowa\_list\_ids'           => get\_option( 'verowa\_list\_ids', 'leer' ), |
| [197](#L197) | 'verowa\_roster\_ids'         => get\_option( 'verowa\_roster\_ids', 'leer' ), |
| [198](#L198) | 'last\_update\_checks'        => gmdate( DateTime::RFC1036, get\_option( 'verowa\_connect\_last\_update\_checks', 'leer' ) ), |
| [199](#L199) | 'count\_event\_posts'         => $arr\_counts['int\_count\_event\_posts'], |
| [200](#L200) | 'verowa\_events'             => $arr\_counts['int\_verowa\_events'], |
| [201](#L201) | 'count\_person\_posts'        => $arr\_counts['int\_count\_person\_posts'], |
| [202](#L202) | 'verowa\_persons'            => $arr\_counts['int\_verowa\_persons'], |
| [203](#L203) | 'deprecated\_person\_groups'  => $count\_deprecated\_person\_groups, |
| [204](#L204) | ); |
| [205](#L205) | } |
| [206](#L206) |  |
| [207](#L207) |  |
| [208](#L208) |  |
| [209](#L209) |  |
| [210](#L210) | add\_action( |
| [211](#L211) | 'rest\_api\_init', |
| [212](#L212) | function () { |
| [213](#L213) | register\_rest\_route( |
| [214](#L214) | 'verowa/v1', |
| [215](#L215) | '/update\_event', |
| [216](#L216) | array( |
| [217](#L217) | 'methods'             => 'GET', |
| [218](#L218) | 'callback'            => 'force\_update\_single\_event', |
| [219](#L219) | 'permission\_callback' => 'verowa\_api\_permission\_callback', |
| [220](#L220) | ) |
| [221](#L221) | ); |
| [222](#L222) | } |
| [223](#L223) | ); |
| [224](#L224) |  |
| [225](#L225) |  |
| [226](#L226) |  |
| [227](#L227) |  |
| [228](#L228) | /\*\* |
| [229](#L229) | \* Force the update of a single event. |
| [230](#L230) | \* |
| [231](#L231) | \* @return int |
| [232](#L232) | \*/ |
| [233](#L233) | function force\_update\_single\_event() { |
| [234](#L234) | $obj\_update = new Verowa\_Update\_Controller(); |
| [235](#L235) | $i\_event\_id = intval( $\_GET['id'] ?? 0 ); |
| [236](#L236) | $obj\_update->init( 'single\_event', $i\_event\_id ); |
| [237](#L237) | $obj\_update->update\_verowa\_events\_in\_db( $i\_event\_id ); |
| [238](#L238) |  |
| [239](#L239) | return 0; // 0 = OK. |
| [240](#L240) | } |
| [241](#L241) |  |
| [242](#L242) |  |
| [243](#L243) |  |
| [244](#L244) | add\_action( |
| [245](#L245) | 'rest\_api\_init', |
| [246](#L246) | function () { |
| [247](#L247) | register\_rest\_route( |
| [248](#L248) | 'verowa/v1', |
| [249](#L249) | '/update\_person', |
| [250](#L250) | array( |
| [251](#L251) | 'methods'             => 'GET', |
| [252](#L252) | 'callback'            => 'force\_update\_single\_person', |
| [253](#L253) | 'permission\_callback' => 'verowa\_api\_permission\_callback', |
| [254](#L254) | ) |
| [255](#L255) | ); |
| [256](#L256) | } |
| [257](#L257) | ); |
| [258](#L258) |  |
| [259](#L259) |  |
| [260](#L260) | /\*\* |
| [261](#L261) | \* Force the update of a single person. |
| [262](#L262) | \* |
| [263](#L263) | \* @return int |
| [264](#L264) | \*/ |
| [265](#L265) | function force\_update\_single\_person() { |
| [266](#L266) | $obj\_update = new Verowa\_Update\_Controller(); |
| [267](#L267) | $i\_person\_id = intval( $\_GET['id'] ?? 0 ); |
| [268](#L268) | $obj\_update->init( 'single\_person', $i\_person\_id ); |
| [269](#L269) | $obj\_update->update\_verowa\_persons\_in\_db( $i\_person\_id ); |
| [270](#L270) |  |
| [271](#L271) | return 0; // 0 = OK |
| [272](#L272) | } |
| [273](#L273) |  |
| [274](#L274) |  |
| [275](#L275) |  |
| [276](#L276) |  |
| [277](#L277) | add\_action( |
| [278](#L278) | 'rest\_api\_init', |
| [279](#L279) | function () { |
| [280](#L280) | register\_rest\_route( |
| [281](#L281) | 'verowa/v1', |
| [282](#L282) | '/save\_renting\_request', |
| [283](#L283) | array( |
| [284](#L284) | 'methods'             => 'POST', |
| [285](#L285) | 'callback'            => 'verowa\_save\_renting\_request', |
| [286](#L286) | 'permission\_callback' => 'verowa\_api\_permission\_callback', |
| [287](#L287) | ) |
| [288](#L288) | ); |
| [289](#L289) | } |
| [290](#L290) | ); |
| [291](#L291) |  |
| [292](#L292) |  |
| [293](#L293) | /\*\* |
| [294](#L294) | \* Send request to the VEROWA API and return the response to the JavaScript |
| [295](#L295) | \* |
| [296](#L296) | \* @param WP\_REST\_Request $obj\_request |
| [297](#L297) | \* |
| [298](#L298) | \* @return array |
| [299](#L299) | \*/ |
| [300](#L300) | function verowa\_save\_renting\_request( $obj\_request ) { |
| [301](#L301) | $verowa\_api\_key = get\_option( 'verowa\_api\_key', false ); |
| [302](#L302) | $verowa\_member  = get\_option( 'verowa\_instance', false ); |
| [303](#L303) |  |
| [304](#L304) | // Prepare API-URLs. |
| [305](#L305) | $str\_send\_url                       = 'https://api.verowa.ch/save\_renting\_request'; |
| [306](#L306) | $arr\_renting\_data                   = json\_decode( $obj\_request->get\_body(), true ); |
| [307](#L307) | $plugin\_data                        = verowa\_connect\_get\_plugin\_data(); |
| [308](#L308) | $arr\_renting\_data['plugin\_version'] = $plugin\_data['Version']; |
| [309](#L309) |  |
| [310](#L310) | $response = wp\_remote\_post( |
| [311](#L311) | $str\_send\_url, |
| [312](#L312) | array( |
| [313](#L313) | 'method'      => 'POST', |
| [314](#L314) | 'timeout'     => 45, |
| [315](#L315) | 'redirection' => 5, |
| [316](#L316) | 'httpversion' => '1.0', |
| [317](#L317) | 'blocking'    => true, |
| [318](#L318) | 'headers'     => array( |
| [319](#L319) | 'member' => $verowa\_member, |
| [320](#L320) | 'apikey' => $verowa\_api\_key, |
| [321](#L321) | ), |
| [322](#L322) | 'body'        => json\_encode( $arr\_renting\_data, true ), |
| [323](#L323) | 'cookies'     => array(), |
| [324](#L324) | ) |
| [325](#L325) | ); |
| [326](#L326) |  |
| [327](#L327) | if ( is\_wp\_error( $response ) ) { |
| [328](#L328) | $error\_message = $response->get\_error\_message(); |
| [329](#L329) | verowa\_save\_log( 'save\_renting\_request', $error\_message ); |
| [330](#L330) | throw new Exception( $response->get\_error\_message() ); |
| [331](#L331) | } else { |
| [332](#L332) | $arr\_body                          = json\_decode( $response['body'], true ); |
| [333](#L333) | $str\_key                           = verowa\_save\_user\_data( $arr\_body ); |
| [334](#L334) | $arr\_body['response\_url'] = ( true === isset( $arr\_body['response\_url'] ) && |
| [335](#L335) | '' != trim( $arr\_body['response\_url'] ) ) ? |
| [336](#L336) | $arr\_body['response\_url'] . '?key=' . $str\_key : '/reservationsanfrage-response?key=' . $str\_key; |
| [337](#L337) | } |
| [338](#L338) | return $arr\_body; |
| [339](#L339) | } |
| [340](#L340) |  |
| [341](#L341) |  |
| [342](#L342) |  |
| [343](#L343) |  |
| [344](#L344) | add\_action( |
| [345](#L345) | 'rest\_api\_init', |
| [346](#L346) | function () { |
| [347](#L347) | register\_rest\_route( |
| [348](#L348) | 'verowa/v1', |
| [349](#L349) | '/save\_subs\_request', |
| [350](#L350) | array( |
| [351](#L351) | 'methods'             => 'POST', |
| [352](#L352) | 'callback'            => 'verowa\_save\_sub\_request', |
| [353](#L353) | 'permission\_callback' => 'verowa\_api\_permission\_callback', |
| [354](#L354) | ) |
| [355](#L355) | ); |
| [356](#L356) | } |
| [357](#L357) | ); |
| [358](#L358) |  |
| [359](#L359) |  |
| [360](#L360) |  |
| [361](#L361) |  |
| [362](#L362) | /\*\* |
| [363](#L363) | \* Send request to the VEROWA API and return the response to the JavaScript |
| [364](#L364) | \* |
| [365](#L365) | \* @param WP\_REST\_Request $obj\_request |
| [366](#L366) | \* |
| [367](#L367) | \* @return array |
| [368](#L368) | \*/ |
| [369](#L369) | function verowa\_save\_sub\_request( $obj\_request ) { |
| [370](#L370) | $verowa\_api\_key = get\_option( 'verowa\_api\_key', false ); |
| [371](#L371) | $verowa\_member  = get\_option( 'verowa\_instance', false ); |
| [372](#L372) |  |
| [373](#L373) | // Prepare API-URLs. |
| [374](#L374) | $str\_send\_url  = 'https://api.verowa.ch/subscribetoevent'; |
| [375](#L375) | $arr\_subs\_data = json\_decode( $obj\_request->get\_body(), true ); |
| [376](#L376) | if ( $arr\_subs\_data ) { |
| [377](#L377) | $plugin\_data                     = verowa\_connect\_get\_plugin\_data(); |
| [378](#L378) | $arr\_subs\_data['plugin\_version'] = $plugin\_data['Version']; |
| [379](#L379) |  |
| [380](#L380) | $response = wp\_remote\_post( |
| [381](#L381) | $str\_send\_url, |
| [382](#L382) | array( |
| [383](#L383) | 'method'      => 'POST', |
| [384](#L384) | 'timeout'     => 45, |
| [385](#L385) | 'redirection' => 5, |
| [386](#L386) | 'httpversion' => '1.0', |
| [387](#L387) | 'blocking'    => true, |
| [388](#L388) | 'headers'     => array( |
| [389](#L389) | 'member' => $verowa\_member, |
| [390](#L390) | 'apikey' => $verowa\_api\_key, |
| [391](#L391) | ), |
| [392](#L392) | 'body'        => json\_encode( $arr\_subs\_data, true ), |
| [393](#L393) | 'cookies'     => array(), |
| [394](#L394) | ) |
| [395](#L395) | ); |
| [396](#L396) |  |
| [397](#L397) | if ( is\_wp\_error( $response ) ) { |
| [398](#L398) | $error\_message = $response->get\_error\_message(); |
| [399](#L399) | verowa\_save\_log( 'save\_subs\_request', $error\_message ); |
| [400](#L400) | throw new Exception( $response->get\_error\_message() ); |
| [401](#L401) | } else { |
| [402](#L402) | $arr\_body = json\_decode( $response['body'], true ); |
| [403](#L403) | if ( isset( $arr\_body['redirect\_url'] ) ) { |
| [404](#L404) | $str\_key                   = verowa\_save\_user\_data( $arr\_body ); |
| [405](#L405) | $arr\_body['redirect\_url'] .= '?key=' . $str\_key; |
| [406](#L406) | } |
| [407](#L407) | } |
| [408](#L408) | } |
| [409](#L409) |  |
| [410](#L410) | return $arr\_body ?? array(); |
| [411](#L411) | } |
| [412](#L412) |  |
| [413](#L413) |  |
| [414](#L414) |  |
| [415](#L415) |  |
| [416](#L416) | add\_action( |
| [417](#L417) | 'rest\_api\_init', |
| [418](#L418) | function () { |
| [419](#L419) | register\_rest\_route( |
| [420](#L420) | 'verowa/v1', |
| [421](#L421) | '/resend\_subscription\_mail', |
| [422](#L422) | array( |
| [423](#L423) | 'methods'             => 'POST', |
| [424](#L424) | 'callback'            => 'verowa\_resend\_subscription\_mail', |
| [425](#L425) | 'permission\_callback' => 'verowa\_api\_permission\_callback', |
| [426](#L426) | ) |
| [427](#L427) | ); |
| [428](#L428) | } |
| [429](#L429) | ); |
| [430](#L430) |  |
| [431](#L431) |  |
| [432](#L432) | /\*\* |
| [433](#L433) | \* Send request to the VEROWA API and return the response to the JavaScript |
| [434](#L434) | \* |
| [435](#L435) | \* @param WP\_REST\_Request $obj\_request |
| [436](#L436) | \* |
| [437](#L437) | \* @return array |
| [438](#L438) | \*/ |
| [439](#L439) | function verowa\_resend\_subscription\_mail( $obj\_request ) { |
| [440](#L440) | $verowa\_api\_key = get\_option( 'verowa\_api\_key', false ); |
| [441](#L441) | $verowa\_member  = get\_option( 'verowa\_instance', false ); |
| [442](#L442) |  |
| [443](#L443) | // Prepare API-URLs. |
| [444](#L444) | $str\_send\_url  = 'https://api.verowa.ch/resend\_subscription\_mail'; |
| [445](#L445) | $arr\_subs\_data = json\_decode( $obj\_request->get\_body(), true ); |
| [446](#L446) | if ( $arr\_subs\_data ) { |
| [447](#L447) | $plugin\_data                     = verowa\_connect\_get\_plugin\_data(); |
| [448](#L448) | $arr\_subs\_data['plugin\_version'] = $plugin\_data['Version']; |
| [449](#L449) |  |
| [450](#L450) | $response = wp\_remote\_post( |
| [451](#L451) | $str\_send\_url, |
| [452](#L452) | array( |
| [453](#L453) | 'method'      => 'POST', |
| [454](#L454) | 'timeout'     => 45, |
| [455](#L455) | 'redirection' => 5, |
| [456](#L456) | 'httpversion' => '2.0', |
| [457](#L457) | 'blocking'    => true, |
| [458](#L458) | 'headers'     => array( |
| [459](#L459) | 'member' => $verowa\_member, |
| [460](#L460) | 'apikey' => $verowa\_api\_key, |
| [461](#L461) | ), |
| [462](#L462) | 'body'        => wp\_json\_encode( $arr\_subs\_data, true ), |
| [463](#L463) | 'cookies'     => array(), |
| [464](#L464) | ) |
| [465](#L465) | ); |
| [466](#L466) |  |
| [467](#L467) | $arr\_body = json\_decode( $response['body'], true ); |
| [468](#L468) | } |
| [469](#L469) |  |
| [470](#L470) | return $arr\_body ?? array(); |
| [471](#L471) | } |
| [472](#L472) |  |
| [473](#L473) |  |
| [474](#L474) |  |
| [475](#L475) |  |
| [476](#L476) | /\* |
| [477](#L477) | \* Callback function is located in general/update\_cron.php. |
| [478](#L478) | \*/ |
| [479](#L479) | add\_action( |
| [480](#L480) | 'rest\_api\_init', |
| [481](#L481) | function () { |
| [482](#L482) | register\_rest\_route( |
| [483](#L483) | 'verowa/v1', |
| [484](#L484) | '/update/(?P<slug>[a-zA-Z0-9-]+)', |
| [485](#L485) | array( |
| [486](#L486) | 'methods'             => 'GET', |
| [487](#L487) | 'callback'            => 'verowa\_connect\_importer\_handler', |
| [488](#L488) | 'permission\_callback' => 'verowa\_api\_permission\_callback', |
| [489](#L489) | ) |
| [490](#L490) | ); |
| [491](#L491) | } |
| [492](#L492) | ); |
| [493](#L493) |  |
| [494](#L494) |  |
| [495](#L495) | $obj\_backend = new Verowa\_Backend\_Settings (''); |
| [496](#L496) | $obj\_backend->register\_rest\_routes(); |
| [497](#L497) |  |
| [498](#L498) |  |
| [499](#L499) | /\*\* |
| [500](#L500) | \*  WP 5.5.0, the permission\_callback must be specified in register\_rest\_route. |
| [501](#L501) | \* |
| [502](#L502) | \* @param array $atts |
| [503](#L503) | \* |
| [504](#L504) | \* @return  bool |
| [505](#L505) | \*/ |
| [506](#L506) | function verowa\_api\_permission\_callback( $atts ) { |
| [507](#L507) | return true; |
| [508](#L508) | } |

**Note:** See [TracBrowser](/wiki/TracBrowser)
for help on using the repository browser.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Plain Text](/browser/verowa-connect/trunk/general/rest-routes.php?format=txt)
* [Original Format](/export/3222700/verowa-connect/trunk/general/rest-routes.php)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from plugins.trac.wordpress.org_66ef295c_20250115_091123.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fchangeset%3Fnew%3D3201030%2540verowa-connect%26old%3D3201030%2540verowa-connect)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Change](/changeset/3160301/verowa-connect "Changeset 3160301 for verowa-connect")
* [Next Change](/changeset/3201034/verowa-connect "Changeset 3201034 for verowa-connect") →

---

# Changeset [3201030](/changeset/3201030 "Show full changeset") for [verowa-connect](/browser/verowa-connect?rev=3201030 "Show entry in browser")

View differences
inline
side by side

Show
lines around each change

Show the changes in full context

Ignore:

Blank lines

Case changes

White space changes

Timestamp:
12/02/2024 03:38:14 PM
([6 weeks](/timeline?from=2024-12-02T15%3A38%3A14Z&precision=second "See timeline at 12/02/2024 03:38:14 PM") ago)

Author:
michaelpfister
Message:

Update trunk to 3.0.2

Location:
[verowa-connect/trunk](/browser/verowa-connect/trunk?rev=3201030)
Files:

1 deleted
25 edited

* [admin/class-verowa-backend-settings.php](/browser/verowa-connect/trunk/admin/class-verowa-backend-settings.php?rev=3201030 "Show entry in browser")
  (modified)
  ([14 diffs](#file0 "Show differences"))
* [admin/templates-edit.php](/browser/verowa-connect/trunk/admin/templates-edit.php?rev=3201030 "Show entry in browser")
  (modified)
  ([1 diff](#file1 "Show differences"))
* [css/backend-style.css](/browser/verowa-connect/trunk/css/backend-style.css?rev=3201030 "Show entry in browser")
  (modified)
  ([1 diff](#file2 "Show differences"))
* [events/shortcode/verowa-agenda.php](/browser/verowa-connect/trunk/events/shortcode/verowa-agenda.php?rev=3201030 "Show entry in browser")
  (modified)
  ([3 diffs](#file3 "Show differences"))
* [events/shortcode/verowa-event-list.php](/browser/verowa-connect/trunk/events/shortcode/verowa-event-list.php?rev=3201030 "Show entry in browser")
  (modified)
  ([1 diff](#file4 "Show differences"))
* [functions/api-calls.php](/browser/verowa-connect/trunk/functions/api-calls.php?rev=3201030 "Show entry in browser")
  (modified)
  ([3 diffs](#file5 "Show differences"))
* [functions/event.php](/browser/verowa-connect/trunk/functions/event.php?rev=3201030 "Show entry in browser")
  (modified)
  ([24 diffs](#file6 "Show differences"))
* [functions/general.php](/browser/verowa-connect/trunk/functions/general.php?rev=3201030 "Show entry in browser")
  (modified)
  ([4 diffs](#file7 "Show differences"))
* [functions/person.php](/browser/verowa-connect/trunk/functions/person.php?rev=3201030 "Show entry in browser")
  (modified)
  ([21 diffs](#file8 "Show differences"))
* [functions/roster.php](/browser/verowa-connect/trunk/functions/roster.php?rev=3201030 "Show entry in browser")
  (modified)
  ([3 diffs](#file9 "Show differences"))
* [functions/subscription.php](/browser/verowa-connect/trunk/functions/subscription.php?rev=3201030 "Show entry in browser")
  (modified)
  ([1 diff](#file10 "Show differences"))
* [functions/verowa-log.php](/browser/verowa-connect/trunk/functions/verowa-log.php?rev=3201030 "Show entry in browser")
  (modified)
  ([2 diffs](#file11 "Show differences"))
* [functions/verowa-template.php](/browser/verowa-connect/trunk/functions/verowa-template.php?rev=3201030 "Show entry in browser")
  (modified)
  ([11 diffs](#file12 "Show differences"))
* [functions/wpml.php](/browser/verowa-connect/trunk/functions/wpml.php?rev=3201030 "Show entry in browser")
  (modified)
  ([15 diffs](#file13 "Show differences"))
* [general/class-verowa-postings.php](/browser/verowa-connect/trunk/general/class-verowa-postings.php?rev=3201030 "Show entry in browser")
  (modified)
  ([3 diffs](#file14 "Show differences"))
* [general/class-verowa-update-controller.php](/browser/verowa-connect/trunk/general/class-verowa-update-controller.php?rev=3201030 "Show entry in browser")
  (modified)
  ([23 diffs](#file15 "Show differences"))
* [general/custom-post-action-filters.php](/browser/verowa-connect/trunk/general/custom-post-action-filters.php?rev=3201030 "Show entry in browser")
  (modified)
  ([8 diffs](#file16 "Show differences"))
* [general/rest-routes.php](/browser/verowa-connect/trunk/general/rest-routes.php?rev=3201030 "Show entry in browser")
  (modified)
  ([4 diffs](#file17 "Show differences"))
* [js/verowa-agenda.js](/browser/verowa-connect/trunk/js/verowa-agenda.js?rev=3201030 "Show entry in browser")
  (modified)
  ([1 diff](#file18 "Show differences"))
* [js/verowa-agenda.min.js](/browser/verowa-connect/trunk/js/verowa-agenda.min.js?rev=3201030 "Show entry in browser")
  (modified)
  ([1 diff](#file19 "Show differences"))
* [models/class-verowa-template.php](/browser/verowa-connect/trunk/models/class-verowa-template.php?rev=3201030 "Show entry in browser")
  (modified)
  ([1 diff](#file20 "Show differences"))
* [persons/show-persons-shortcode.php](/browser/verowa-connect/trunk/persons/show-persons-shortcode.php?rev=3201030 "Show entry in browser")
  (modified)
  ([8 diffs](#file21 "Show differences"))
* [persons/single-person-page.php](/browser/verowa-connect/trunk/persons/single-person-page.php?rev=3123647 "Show what was removed (content at revision 3201029)")
  (deleted)
* [readme.txt](/browser/verowa-connect/trunk/readme.txt?rev=3201030 "Show entry in browser")
  (modified)
  ([2 diffs](#file23 "Show differences"))
* [rosters/verowa-roster-entries.php](/browser/verowa-connect/trunk/rosters/verowa-roster-entries.php?rev=3201030 "Show entry in browser")
  (modified)
  ([1 diff](#file24 "Show differences"))
* [verowa-connect.php](/browser/verowa-connect/trunk/verowa-connect.php?rev=3201030 "Show entry in browser")
  (modified)
  ([3 diffs](#file25 "Show differences"))

### Legend:

Unmodified
Added
Removed

* ## [verowa-connect/trunk/admin/class-verowa-backend-settings.php](/changeset/3201030/verowa-connect/trunk/admin/class-verowa-backend-settings.php "Show the changeset 3201030 restricted to verowa-connect/trunk/admin/class-verowa-backend-settings.php")

  | [r3159862](/browser/verowa-connect/trunk/admin/class-verowa-backend-settings.php?rev=3159862#L71 "Show revision 3159862 of this file in browser") | [r3201030](/browser/verowa-connect/trunk/admin/class-verowa-backend-settings.php?rev=3201030#L71 "Show revision 3201030 of this file in browser") |  |
  | --- | --- | --- |
  | 71 | 71 | ); |
  | 72 | 72 |  |
  | 73 |  | if ( true === $this->arr\_module\_infos['postings']['enabled'] ) { |
  |  | 73 | if ( isset( $this->arr\_module\_infos['postings']['enabled'] ) && |
  |  | 74 | true === $this->arr\_module\_infos['postings']['enabled'] ?? false ) { |
  | 74 | 75 | $arr\_nav[] = array( |
  | 75 | 76 | 'text'      => 'News', |
  | […](/browser/verowa-connect/trunk/admin/class-verowa-backend-settings.php?rev=3159862#L87) | […](/browser/verowa-connect/trunk/admin/class-verowa-backend-settings.php?rev=3201030#L88) |  |
  | 87 | 88 | } |
  | 88 | 89 |  |
  | 89 |  | if ( ~~true === $this->arr\_module\_infos['subscriptions']['enabled']~~ ) { |
  |  | 90 | if ( isset( $this->arr\_module\_infos['subscriptions'] ) && true === $this->arr\_module\_infos['subscriptions']['enabled'] ?? false ) { |
  | 90 | 91 | $arr\_nav[] = array( |
  | 91 | 92 | 'text'      => 'Anmeldungen', |
  | […](/browser/verowa-connect/trunk/admin/class-verowa-backend-settings.php?rev=3159862#L246) | […](/browser/verowa-connect/trunk/admin/class-verowa-backend-settings.php?rev=3201030#L247) |  |
  | 246 | 247 | $how\_many\_verowa\_dropdowns = get\_option( 'how\_many\_verowa\_dropdowns', true ); |
  | 247 | 248 | $wp\_verowa\_listengruppe    = get\_option( 'verowa\_wordpress\_listengruppe', true ); |
  | 248 |  | $show\_full\_text\_search     = get\_option( 'verowa\_show\_full\_text\_search', true ); |
  |  | 249 | $show\_full\_text\_search     = boolval( get\_option( 'verowa\_show\_full\_text\_search', true ) ); |
  |  | 250 | $b\_show\_agenda\_date\_filter = boolval( get\_option( 'verowa\_show\_agenda\_date\_filter', true ) ); |
  | 249 | 251 |  |
  | 250 | 252 | // Agenda filters in the corresponding languages. |
  | […](/browser/verowa-connect/trunk/admin/class-verowa-backend-settings.php?rev=3159862#L254) | […](/browser/verowa-connect/trunk/admin/class-verowa-backend-settings.php?rev=3201030#L256) |  |
  | 254 | 256 | '</div><div>' . |
  | 255 | 257 | '<label>' . esc\_html( \_\_( 'ID of group with WordPress lists', 'verowa-connect' ) ) . ':</label> ' . |
  | 256 |  | '<input type="number" name="verowa\_wp\_listengruppen\_id" value="' . esc\_attr( $wp\_verowa\_listengruppe ) . '" /></div>' . |
  | 257 |  | '<input type="hidden" name="verowa\_show\_full\_text\_search" value="off" />'; |
  | 258 |  |  |
  | 259 |  | $arr\_cb = verowa\_checkbox\_html( |
  |  | 258 | '<input type="number" name="verowa\_wp\_listengruppen\_id" value="' . esc\_attr( $wp\_verowa\_listengruppe ) . '" /></div>'; |
  |  | 259 |  |
  |  | 260 | $arr\_cbs   = []; |
  |  | 261 | $arr\_cbs[] = verowa\_checkbox\_html( |
  |  | 262 | array( |
  |  | 263 | 'name' => 'show\_agenda\_date\_filter', |
  |  | 264 | 'text' => \_\_( 'Agenda: enable date filter', 'verowa-connect' ), |
  |  | 265 | 'value' => ( $b\_show\_agenda\_date\_filter ? 'on' : '' ), |
  |  | 266 | ) |
  |  | 267 | ); |
  |  | 268 |  |
  |  | 269 | $arr\_cbs[] = verowa\_checkbox\_html( |
  | 260 | 270 | array( |
  | 261 | 271 | 'name' => 'verowa\_show\_full\_text\_search', |
  | […](/browser/verowa-connect/trunk/admin/class-verowa-backend-settings.php?rev=3159862#L265) | […](/browser/verowa-connect/trunk/admin/class-verowa-backend-settings.php?rev=3201030#L275) |  |
  | 265 | 275 | ); |
  | 266 | 276 |  |
  | 267 |  | $str\_content .= wp\_kses( $arr\_cb['content'], $arr\_cb['kses\_allowed'] ) . |
  | 268 |  | '<input type="submit" value="' . esc\_attr( \_\_( 'Save Options', 'verowa-connect' ) ) . '" class="button-primary" style="margin-top: 15px; margin-bottom: 15px;" >' . |
  |  | 277 | foreach ($arr\_cbs as $arr\_sg\_cb) { |
  |  | 278 | $str\_content .= '<input type="hidden" name="' . $arr\_sg\_cb['name'] . '" value="off" />' . |
  |  | 279 | wp\_kses( $arr\_sg\_cb['content'], $arr\_sg\_cb['kses\_allowed'] ); |
  |  | 280 | } |
  |  | 281 |  |
  |  | 282 | $str\_content .= '<input type="submit" value="' . esc\_attr( \_\_( 'Save Options', 'verowa-connect' ) ) . |
  |  | 283 | '" class="button-primary" style="margin-top: 15px; margin-bottom: 15px;" >' . |
  | 269 | 284 | '</div><div class="verowa-filter-group">'; |
  | 270 | 285 |  |
  | […](/browser/verowa-connect/trunk/admin/class-verowa-backend-settings.php?rev=3159862#L272) | […](/browser/verowa-connect/trunk/admin/class-verowa-backend-settings.php?rev=3201030#L287) |  |
  | 272 | 287 | $int\_anzahl\_zaehler   = 1; |
  | 273 | 288 | $float\_max\_width = 100 / $how\_many\_verowa\_dropdowns; |
  | 274 |  | $str\_ml\_dropdowns\_titel = get\_option~~('verowa\_agenda\_ml\_dropdowns\_titel', ''~~); |
  | 275 |  | $arr\_ml\_dropdowns\_titel = $str\_ml\_dropdowns\_titel != '' ? json\_decode~~($str\_ml\_dropdowns\_titel, true~~) : array(); |
  |  | 289 | $str\_ml\_dropdowns\_titel = get\_option( 'verowa\_agenda\_ml\_dropdowns\_titel', '' ); |
  |  | 290 | $arr\_ml\_dropdowns\_titel = $str\_ml\_dropdowns\_titel != '' ? json\_decode( $str\_ml\_dropdowns\_titel, true ) : array(); |
  | 276 | 291 |  |
  | 277 | 292 | while ( $int\_anzahl\_zaehler <= $how\_many\_verowa\_dropdowns ) { |
  | 278 | 293 | $str\_content .= '<div class="verowa-single-filter" style="display:inline-block; max-width:' . $float\_max\_width . '%;">' . |
  | 279 |  | '<b>' . esc\_html~~(\_\_ ('Dropdown menu', 'verowa-connect')) . ' ' . esc\_attr ($int\_anzahl\_zaehler~~) . '</b> <br />'; |
  |  | 294 | '<b>' . esc\_html( \_\_( 'Dropdown menu', 'verowa-connect' ) ) . ' ' . esc\_attr( $int\_anzahl\_zaehler ) . '</b> <br />'; |
  | 280 | 295 |  |
  | 281 | 296 | if( true === verowa\_wpml\_is\_configured() ) { |
  | 282 | 297 | $arr\_languages = verowa\_wpml\_get\_active\_languages(); |
  | 283 | 298 |  |
  | 284 |  | foreach (~~$arr\_languages as $arr\_single\_language~~) { |
  | 285 |  | $str\_content .= '<div style="margin-bottom:15px;"><span style="width:75px;display: inline-block;">' . esc\_html~~(\_\_ ('Title', 'verowa-connect')) . ' ' . strtoupper($arr\_single\_language['code']~~) . ': </span><input type="text" name="dropdown\_menu\_' . |
  | 286 |  | esc\_attr~~($int\_anzahl\_zaehler~~) . |
  |  | 299 | foreach ( $arr\_languages as $arr\_single\_language ) { |
  |  | 300 | $str\_content .= '<div style="margin-bottom:15px;"><span style="width:75px;display: inline-block;">' . esc\_html( \_\_( 'Title', 'verowa-connect' ) ) . ' ' . strtoupper( $arr\_single\_language['code'] ) . ': </span><input type="text" name="dropdown\_menu\_' . |
  |  | 301 | esc\_attr( $int\_anzahl\_zaehler ) . |
  | 287 | 302 | '\_title\_' . $arr\_single\_language['code'] . '" ' . |
  | 288 |  | 'value="' . esc\_attr($arr\_ml\_dropdowns\_titel[ $int\_anzahl\_zaehler ][ $arr\_single\_language['code'] ] ?? $int\_anzahl\_zaehler) . '" />' . |
  |  | 303 | 'value="' . esc\_attr($arr\_ml\_dropdowns\_titel[ $int\_anzahl\_zaehler ][ $arr\_single\_language['code'] ] ?? $int\_anzahl\_zaehler) . '" />' . |
  | 289 | 304 | '</div>'; |
  | 290 | 305 | } |
  | 291 | 306 |  |
  | 292 | 307 | } else { |
  | 293 |  | $str\_content .= esc\_html~~(\_\_ ('Title', 'verowa-connect')~~) . ': <input type="text" name="dropdown\_menu\_' . |
  |  | 308 | $str\_content .= esc\_html( \_\_( 'Title', 'verowa-connect' ) ) . ': <input type="text" name="dropdown\_menu\_' . |
  | 294 | 309 | esc\_attr ($int\_anzahl\_zaehler) . |
  | 295 |  | '\_title" value="' . esc\_attr~~(get\_option ('verowa\_dropdown\_' . $int\_anzahl\_zaehler . '\_title', true)~~) . '" />' . |
  |  | 310 | '\_title" value="' . esc\_attr( get\_option( 'verowa\_dropdown\_' . $int\_anzahl\_zaehler . '\_title', true ) ) . '" />' . |
  | 296 | 311 | '<br />'; |
  | 297 | 312 | } |
  | […](/browser/verowa-connect/trunk/admin/class-verowa-backend-settings.php?rev=3159862#L424) | […](/browser/verowa-connect/trunk/admin/class-verowa-backend-settings.php?rev=3201030#L439) |  |
  | 424 | 439 | 'file', // e.g. "PDF file" |
  | 425 | 440 | 'MB', // abbrev. Megabytes |
  |  | 441 | 'o’clock', |
  | 426 | 442 | ), |
  | 427 | 443 | ), |
  | […](/browser/verowa-connect/trunk/admin/class-verowa-backend-settings.php?rev=3159862#L935) | […](/browser/verowa-connect/trunk/admin/class-verowa-backend-settings.php?rev=3201030#L951) |  |
  | 935 | 951 | } |
  | 936 | 952 |  |
  |  | 953 | $i\_list\_group\_id = intval( $\_POST['verowa\_wp\_listengruppen\_id'] ?? 0 ); |
  |  | 954 |  |
  | 937 | 955 | if ( isset( $\_POST['verowa\_wp\_listengruppen\_id'] ) ) { |
  |  | 956 | $prev\_id = intval (get\_option( 'verowa\_wordpress\_listengruppe', 0 )); |
  | 938 | 957 | update\_option( 'verowa\_wordpress\_listengruppe', $\_POST['verowa\_wp\_listengruppen\_id'], true ); |
  |  | 958 |  |
  |  | 959 | if ( $i\_list\_group\_id > 0 ) { |
  |  | 960 | if ( $prev\_id !== $i\_list\_group\_id ) { |
  |  | 961 | $obj\_update\_controller = new Verowa\_Update\_Controller(); |
  |  | 962 | $obj\_update\_controller->init( 'all' ); |
  |  | 963 | $obj\_update\_controller->update\_agenda\_filters(); |
  |  | 964 | //$obj\_update\_controller->update\_targetgroups(); |
  |  | 965 | //$obj\_update\_controller->update\_verowa\_persons\_in\_db(); |
  |  | 966 | //$obj\_update\_controller->update\_verowa\_events\_in\_db(); |
  |  | 967 | } |
  |  | 968 | update\_option( 'verowa\_wordpress\_listengruppe', $i\_list\_group\_id, true ); |
  |  | 969 | } |
  | 939 | 970 | } |
  | 940 | 971 |  |
  | […](/browser/verowa-connect/trunk/admin/class-verowa-backend-settings.php?rev=3159862#L957) | […](/browser/verowa-connect/trunk/admin/class-verowa-backend-settings.php?rev=3201030#L988) |  |
  | 957 | 988 | $str\_ddl\_title = trim( $\_POST[ 'dropdown\_menu\_' . |
  | 958 | 989 | $int\_anzahl\_zaehler . '\_title\_' . $arr\_single\_language['code'] ] ); |
  | 959 |  | $arr\_dropdowns\_ml\_titel[ $int\_anzahl\_zaehler ][ $arr\_single\_language['code'] ] = $str\_ddl\_title; |
  |  | 990 | $arr\_dropdowns\_ml\_titel[ $int\_anzahl\_zaehler ][ $arr\_single\_language['code'] ] = |
  |  | 991 | esc\_sql( $str\_ddl\_title ); |
  | 960 | 992 | } |
  | 961 | 993 | } else { |
  | […](/browser/verowa-connect/trunk/admin/class-verowa-backend-settings.php?rev=3159862#L980) | […](/browser/verowa-connect/trunk/admin/class-verowa-backend-settings.php?rev=3201030#L1012) |  |
  | 980 | 1012 |  |
  | 981 | 1013 | if ( isset( $\_POST['verowa\_show\_full\_text\_search'] ) ) { |
  | 982 |  | $show\_full\_text\_search = 'on' === htmlspecialchars( $\_POST['verowa\_show\_full\_text\_search'] ) ? ~~true : false~~; |
  |  | 1014 | $show\_full\_text\_search = 'on' === htmlspecialchars( $\_POST['verowa\_show\_full\_text\_search'] ) ? 1 : 0; |
  | 983 | 1015 | update\_option( 'verowa\_show\_full\_text\_search', $show\_full\_text\_search ); |
  |  | 1016 | } |
  |  | 1017 |  |
  |  | 1018 | if ( isset( $\_POST['show\_agenda\_date\_filter'] ) ) { |
  |  | 1019 | $b\_show\_agenda\_date\_filter = 'on' === htmlspecialchars( $\_POST['show\_agenda\_date\_filter'] ) ? 1 : 0; |
  |  | 1020 | update\_option( 'verowa\_show\_agenda\_date\_filter', $b\_show\_agenda\_date\_filter ); |
  | 984 | 1021 | } |
  | 985 | 1022 | break; |
  | […](/browser/verowa-connect/trunk/admin/class-verowa-backend-settings.php?rev=3159862#L1013) | […](/browser/verowa-connect/trunk/admin/class-verowa-backend-settings.php?rev=3201030#L1050) |  |
  | 1013 | 1050 | } else { |
  | 1014 | 1051 | $arr\_persons = verowa\_persons\_get\_multiple( null, 'FULL' ); |
  |  | 1052 |  |
  | 1015 | 1053 | if ( is\_array( $arr\_persons ) ) { |
  |  | 1054 | $i\_template\_id = get\_option( 'verowa\_default\_persondetails\_template', 0 ); |
  |  | 1055 | $arr\_templates = verowa\_get\_single\_template( $i\_template\_id ); |
  | 1016 | 1056 | foreach ( $arr\_persons as $arr\_single\_person ) { |
  | 1017 |  | verowa\_person\_add\_wp\_post( $arr\_single\_person['person\_id'], $arr\_single\_person ); |
  |  | 1057 | verowa\_person\_add\_wp\_post( $arr\_single\_person['person\_id'], $arr\_single\_person, |
  |  | 1058 | $arr\_templates ); |
  | 1018 | 1059 | } |
  | 1019 | 1060 | } |
  | […](/browser/verowa-connect/trunk/admin/class-verowa-backend-settings.php?rev=3159862#L1068) | […](/browser/verowa-connect/trunk/admin/class-verowa-backend-settings.php?rev=3201030#L1109) |  |
  | 1068 | 1109 |  |
  | 1069 | 1110 | case 'subs': |
  | 1070 |  | $ret\_add     = add\_option( 'verowa\_subscriptions\_settings', wp\_json\_encode( $\_POST ) ); |
  |  | 1111 |  |
  |  | 1112 | $arr\_post = array\_map( 'esc\_sql', $\_POST ); |
  |  | 1113 | $ret\_add     = add\_option( 'verowa\_subscriptions\_settings', wp\_json\_encode( $arr\_post ) ); |
  | 1071 | 1114 |  |
  | 1072 | 1115 | if ( ! $ret\_add ) { |
  | 1073 |  | update\_option( 'verowa\_subscriptions\_settings', wp\_json\_encode( $~~\_POST~~ ) ); |
  |  | 1116 | update\_option( 'verowa\_subscriptions\_settings', wp\_json\_encode( $arr\_post ) ); |
  | 1074 | 1117 | } |
  | 1075 | 1118 | break; |
  | […](/browser/verowa-connect/trunk/admin/class-verowa-backend-settings.php?rev=3159862#L1151) | […](/browser/verowa-connect/trunk/admin/class-verowa-backend-settings.php?rev=3201030#L1194) |  |
  | 1151 | 1194 |  |
  | 1152 | 1195 |  |
  |  | 1196 | /\*\* |
  |  | 1197 | \* |
  |  | 1198 | \* @param WP\_REST\_Request $request |
  |  | 1199 | \* @return WP\_Error|WP\_REST\_Response |
  |  | 1200 | \*/ |
  | 1153 | 1201 | public function update\_translation\_callback( \WP\_REST\_Request $request ) { |
  |  | 1202 | global $wpdb; |
  |  | 1203 |  |
  | 1154 | 1204 | $original\_string = $request->get\_param( 'original\_string' ); |
  | 1155 | 1205 | $translated\_string = $request->get\_param( 'translated\_string' ); |
  | […](/browser/verowa-connect/trunk/admin/class-verowa-backend-settings.php?rev=3159862#L1157) | […](/browser/verowa-connect/trunk/admin/class-verowa-backend-settings.php?rev=3201030#L1207) |  |
  | 1157 | 1207 |  |
  | 1158 | 1208 | $arr\_av\_translations = json\_decode( get\_option ('verowa\_translations\_' . $str\_lang\_code, '[]'), true ); |
  | 1159 |  | $translated\_string = ~~trim( $translated\_string~~ ); |
  |  | 1209 | $translated\_string = esc\_sql ( trim( $translated\_string ) ); |
  | 1160 | 1210 | if ( empty( $translated\_string ) ) { |
  | 1161 | 1211 | unset( $arr\_av\_translations[ $original\_string ] ); |
* ## [verowa-connect/trunk/admin/templates-edit.php](/changeset/3201030/verowa-connect/trunk/admin/templates-edit.php "Show the changeset 3201030 restricted to verowa-connect/trunk/admin/templates-edit.php")

  | [r3133047](/browser/verowa-connect/trunk/admin/templates-edit.php?rev=3133047#L15 "Show revision 3133047 of this file in browser") | [r3201030](/browser/verowa-connect/trunk/admin/templates-edit.php?rev=3201030#L15 "Show revision 3201030 of this file in browser") |  |
  | --- | --- | --- |
  | 15 | 15 | // UNDONE: Default Lang. Template kann nicht mehr gelöscht werden, wenn es Übersetzungen hat. |
  | 16 | 16 | /\*\* |
  | 17 |  | \* Render the |
  |  | 17 | \* Render the Template configuration page. |
  | 18 | 18 | \* |
  | 19 | 19 | \* @return void |
* ## [verowa-connect/trunk/css/backend-style.css](/changeset/3201030/verowa-connect/trunk/css/backend-style.css "Show the changeset 3201030 restricted to verowa-connect/trunk/css/backend-style.css")

  | [r3159837](/browser/verowa-connect/trunk/css/backend-style.css?rev=3159837#L275 "Show revision 3159837 of this file in browser") | [r3201030](/browser/verowa-connect/trunk/css/backend-style.css?rev=3201030#L275 "Show revision 3201030 of this file in browser") |  |
  | --- | --- | --- |
  | 275 | 275 | } |
  | 276 | 276 |  |
  |  | 277 | .verowa-filter-group .ui-sortable-handle { |
  |  | 278 | cursor: grab; |
  |  | 279 | } |
  |  | 280 |  |
  |  | 281 | .verowa-filter-group .ui-sortable-helper { |
  |  | 282 | cursor: grabbing; |
  |  | 283 | } |
  |  | 284 |  |
  | 277 | 285 | .verowa-wpml-string-en { |
  | 278 | 286 | max-width: 300px; |
* ## [verowa-connect/trunk/events/shortcode/verowa-agenda.php](/changeset/3201030/verowa-connect/trunk/events/shortcode/verowa-agenda.php "Show the changeset 3201030 restricted to verowa-connect/trunk/events/shortcode/verowa-agenda.php")

  | [r3104541](/browser/verowa-connect/trunk/events/shortcode/verowa-agenda.php?rev=3104541#L64 "Show revision 3104541 of this file in browser") | [r3201030](/browser/verowa-connect/trunk/events/shortcode/verowa-agenda.php?rev=3201030#L64 "Show revision 3201030 of this file in browser") |  |
  | --- | --- | --- |
  | 64 | 64 | $str\_ret                 .= '<input type="hidden" id="wpml-language-code" value="' . $curr\_language\_code . '"/>'; |
  | 65 | 65 | $str\_ret                 .= '<section id="verowa\_event\_filters" class="verowa-filter">'; |
  | 66 |  | if ( ~~get\_option( 'verowa\_show\_full\_text\_search', true~~ ) ) { |
  | 67 |  | $str\_search\_pcl = verowa\_tf( |
  |  | 66 | if ( boolval( get\_option( 'verowa\_show\_full\_text\_search', true ) ) ) { |
  |  | 67 | $str\_search\_pcl = verowa\_tf( |
  | 68 | 68 | 'Enter a search term', |
  | 69 | 69 | \_x( 'Enter a search term', 'Placeholder in search textbox.', 'verowa-connect' ), |
  | […](/browser/verowa-connect/trunk/events/shortcode/verowa-agenda.php?rev=3104541#L88) | […](/browser/verowa-connect/trunk/events/shortcode/verowa-agenda.php?rev=3201030#L88) |  |
  | 88 | 88 | $curr\_language\_code = verowa\_wpml\_get\_current\_language(); |
  | 89 | 89 | } |
  |  | 90 |  |
  | 90 | 91 | while ( $dropdown\_count <= $nb\_dropdowns ) { |
  | 91 | 92 | $str\_html             = '<div class="row">'; |
  | […](/browser/verowa-connect/trunk/events/shortcode/verowa-agenda.php?rev=3104541#L139) | […](/browser/verowa-connect/trunk/events/shortcode/verowa-agenda.php?rev=3201030#L140) |  |
  | 139 | 140 | ); |
  | 140 | 141 |  |
  | 141 |  | $str\_ret .= '<div class="row date-row">' . |
  | 142 |  | '<div class="date\_filter column">' . |
  | 143 |  | '<label for="verowa\_datum">' . $str\_tf . '</label>' . |
  | 144 |  | '</div>' . |
  | 145 |  | '<div class="date\_filter\_picker column">' . |
  | 146 |  | '<input type="text" name="verowa\_datum" value="' . $date10\_displays\_from . '"' . |
  | 147 |  | ' id="verowa\_connect\_datepicker" />' . |
  | 148 |  | '</div>' . |
  | 149 |  | '<div class="verowa\_agenda\_filter\_reset\_wrapper" >' . |
  |  | 142 | $str\_ret .= '<div class="row date-row">'; |
  |  | 143 | if ( boolval( get\_option( 'verowa\_show\_agenda\_date\_filter', true ) ) ) |
  |  | 144 | { |
  |  | 145 | $str\_ret .= '<div class="date\_filter column">' . |
  |  | 146 | '<label for="verowa\_datum">' . $str\_tf . '</label>' . |
  |  | 147 | '</div>' . |
  |  | 148 | '<div class="date\_filter\_picker column">' . |
  |  | 149 | '<input type="text" name="verowa\_datum" value="' . $date10\_displays\_from . '"' . |
  |  | 150 | ' id="verowa\_connect\_datepicker" />' . |
  |  | 151 | '</div>'; |
  |  | 152 | } |
  |  | 153 | $str\_ret .= '<div class="verowa\_agenda\_filter\_reset\_wrapper" >' . |
  | 150 | 154 | '<a href="javascript:verowa\_agenda\_filter\_reset();" id="verowa-agenda-filter-reset" >' . |
  | 151 | 155 | $str\_tf\_filter . '</a>' . |
* ## [verowa-connect/trunk/events/shortcode/verowa-event-list.php](/changeset/3201030/verowa-connect/trunk/events/shortcode/verowa-event-list.php "Show the changeset 3201030 restricted to verowa-connect/trunk/events/shortcode/verowa-event-list.php")

  | [r3159837](/browser/verowa-connect/trunk/events/shortcode/verowa-event-list.php?rev=3159837#L43 "Show revision 3159837 of this file in browser") | [r3201030](/browser/verowa-connect/trunk/events/shortcode/verowa-event-list.php?rev=3201030#L43 "Show revision 3201030 of this file in browser") |  |
  | --- | --- | --- |
  | 43 | 43 | 'max'          => 10, |
  | 44 | 44 | 'max\_events'   => 10, |
  |  | 45 | 'show\_past'    => 0, |
  | 45 | 46 | 'max\_days'     => 365, |
  | 46 | 47 | 'template\_id'  => 0, |
* ## [verowa-connect/trunk/functions/api-calls.php](/changeset/3201030/verowa-connect/trunk/functions/api-calls.php "Show the changeset 3201030 restricted to verowa-connect/trunk/functions/api-calls.php")

  | [r3159837](/browser/verowa-connect/trunk/functions/api-calls.php?rev=3159837#L55 "Show revision 3159837 of this file in browser") | [r3201030](/browser/verowa-connect/trunk/functions/api-calls.php?rev=3201030#L55 "Show revision 3201030 of this file in browser") |  |
  | --- | --- | --- |
  | 55 | 55 | ); |
  | 56 | 56 | $data        = ''; |
  | 57 |  | ~~// TODO: reduzieren der Mails bei einem API Ausfall auf 1 pro Stunde~~ |
  | 58 |  | verowa\_send\_mail( |
  | 59 |  | ~~VEROWA\_REPORTING\_MAIL,~~ |
  | 60 |  | 'Error verowa\_api\_call', |
  | 61 |  | ~~$the\_verowa\_api\_query . '<br />' .~~ |
  | 62 |  | ~~// phpcs:ignore~~ |
  | 63 |  | ~~print\_r( $obj\_response, true )~~, |
  | 64 |  | ~~true~~ |
  | 65 |  | ); |
  |  | 57 | $str\_siteurl = verowa\_get\_base\_url(); |
  |  | 58 |  |
  |  | 59 | $arr\_description = array( |
  |  | 60 | 'title' => 'Error verowa\_api\_call', |
  |  | 61 | 'Website' => $str\_siteurl, |
  |  | 62 | 'api-url' => $the\_verowa\_api\_query, |
  |  | 63 | 'error' => $obj\_response, |
  |  | 64 | ); |
  |  | 65 | verowa\_report\_error( 'error', $arr\_description ); |
  | 66 | 66 | } |
  | 67 | 67 |  |
  | […](/browser/verowa-connect/trunk/functions/api-calls.php?rev=3159837#L121) | […](/browser/verowa-connect/trunk/functions/api-calls.php?rev=3201030#L121) |  |
  | 121 | 121 | 'verowa-connect' |
  | 122 | 122 | ); |
  |  | 123 |  |
  |  | 124 | $arr\_description = array( |
  |  | 125 | 'title' => 'Error verowa\_get\_eventdetails', |
  |  | 126 | 'error' => $arr\_api\_event\_infos, |
  |  | 127 | ); |
  | 123 | 128 | // phpcs:ignore |
  | 124 |  | verowa\_~~send\_mail( VEROWA\_REPORTING\_MAIL, 'Error verowa\_get\_eventdetails', print\_r( $arr\_api\_event\_infos, true ), true~~ ); |
  |  | 129 | verowa\_report\_error( 'error', $arr\_description ); |
  | 125 | 130 | } |
  | 126 | 131 |  |
  | […](/browser/verowa-connect/trunk/functions/api-calls.php?rev=3159837#L180) | […](/browser/verowa-connect/trunk/functions/api-calls.php?rev=3201030#L185) |  |
  | 180 | 185 | 'verowa-connect' |
  | 181 | 186 | ); |
  |  | 187 |  |
  |  | 188 | $arr\_description = array( |
  |  | 189 | 'title' => 'Error verowa\_get\_persondetails', |
  |  | 190 | 'error' => $arr\_api\_person\_infos, |
  |  | 191 | ); |
  | 182 | 192 | // phpcs:ignore |
  | 183 |  | verowa\_~~send\_mail( VEROWA\_REPORTING\_MAIL, 'Error verowa\_get\_persondetails', print\_r( $arr\_api\_person\_infos, true ), true~~ ); |
  |  | 193 | verowa\_report\_error( 'error', $arr\_description ); |
  | 184 | 194 | } |
  | 185 | 195 |  |
* ## [verowa-connect/trunk/functions/event.php](/changeset/3201030/verowa-connect/trunk/functions/event.php "Show the changeset 3201030 restricted to verowa-connect/trunk/functions/event.php")

  | [r3159837](/browser/verowa-connect/trunk/functions/event.php?rev=3159837#L118 "Show revision 3159837 of this file in browser") | [r3201030](/browser/verowa-connect/trunk/functions/event.php?rev=3201030#L118 "Show revision 3201030 of this file in browser") |  |
  | --- | --- | --- |
  | 118 | 118 | \*/ |
  | 119 | 119 | $arr\_placeholders['EVENT\_DATETIME'] = date\_i18n( 'l, j. F Y, G.i', $technical\_date\_from->format( 'U' ) ) . |
  | 120 |  | '&nbsp;' . ~~\_\_( 'o’clock', 'verowa-connect'~~ ); |
  |  | 120 | '&nbsp;' . verowa\_tf( 'o’clock', \_\_( 'o’clock', 'verowa-connect' ) ); |
  | 121 | 121 |  |
  | 122 | 122 | $arr\_placeholders['DATETIME\_FROM\_LONG\_WITH\_TO\_TIME'] = $arr\_event\_data['date\_text']; |
  | 123 |  | ~~$arr\_placeholders['DATETIME\_FROM\_LONG']              = date\_i18n( 'l, j. F Y, G.i', $technical\_date\_from->format( 'U' ) ) .~~ |
  | 124 |  | ~~'&nbsp;' . \_\_( 'o’clock', 'verowa-connect' );~~ |
  | 125 | 123 | $arr\_placeholders['DATE\_FROM\_LONG']                  = date\_i18n( 'l, j. F Y', $technical\_date\_from->format( 'U' ) ); |
  | 126 | 124 |  |
  | […](/browser/verowa-connect/trunk/functions/event.php?rev=3159837#L168) | […](/browser/verowa-connect/trunk/functions/event.php?rev=3201030#L166) |  |
  | 168 | 166 | } |
  | 169 | 167 |  |
  | 170 |  | ~~$arr\_placeholders['LONG\_DESC']  = $arr\_lang['long\_desc'];~~ |
  | 171 |  |  |
  | 172 | 168 | if ( ! empty( $arr\_event\_data['further\_coorganizer'] ) || ! empty( $arr\_event\_data['coorganizers'] ) |
  | 173 | 169 | || ! empty( $arr\_event\_data['organizer'] ) ) { |
  | […](/browser/verowa-connect/trunk/functions/event.php?rev=3159837#L216) | […](/browser/verowa-connect/trunk/functions/event.php?rev=3201030#L212) |  |
  | 216 | 212 | if ( ! empty( $arr\_event\_data['subs\_date'] ) && ! empty( $arr\_event\_data['subs\_time'] ) ) { |
  | 217 | 213 | $str\_date\_i18n\_format = 'l, j. F Y, G.i'; |
  | 218 |  | $str\_clock            = '&nbsp;' . ~~\_\_( 'o’clock', 'verowa-connect'~~ ); |
  |  | 214 | $str\_clock            = '&nbsp;' . verowa\_tf( 'o’clock', \_\_( 'o’clock', 'verowa-connect' ) ); |
  | 219 | 215 | $str\_subs\_date        = new DateTime( |
  | 220 | 216 | substr( $arr\_event\_data['subs\_date'], 0, 4 ) . '-' . |
  | […](/browser/verowa-connect/trunk/functions/event.php?rev=3159837#L498) | […](/browser/verowa-connect/trunk/functions/event.php?rev=3201030#L494) |  |
  | 498 | 494 | add\_action( 'genesis\_before\_loop', 'verowa\_fake\_breadcrumbs' ); |
  | 499 | 495 |  |
  | 500 |  | $arr\_shared\_placeholder = verowa\_event\_shared\_placeholders( $arr\_event\_data, $str\_wp\_language\_code ); |
  |  | 496 | $arr\_shared\_placeholder = verowa\_event\_shared\_placeholders( $arr\_event\_data, $str\_wp\_language\_code, $arr\_lang ); |
  | 501 | 497 | $arr\_placeholders       = array\_merge( $arr\_placeholders, $arr\_shared\_placeholder ); |
  | 502 | 498 |  |
  | […](/browser/verowa-connect/trunk/functions/event.php?rev=3159837#L557) | […](/browser/verowa-connect/trunk/functions/event.php?rev=3201030#L553) |  |
  | 557 | 553 |  |
  | 558 | 554 | $arr\_coorganizer\_names = array(); |
  | 559 |  | if ( ~~count( $arr\_content['coorganizers'] ) > 0~~ ) { |
  |  | 555 | if ( empty( $arr\_content['coorganizers'] ) == false ) { |
  | 560 | 556 | foreach ( $arr\_content['coorganizers'] as $arr\_single\_coorg ) { |
  | 561 | 557 | $arr\_coorganizer\_names[] = $arr\_single\_coorg['name']; |
  | […](/browser/verowa-connect/trunk/functions/event.php?rev=3159837#L565) | […](/browser/verowa-connect/trunk/functions/event.php?rev=3201030#L561) |  |
  | 565 | 561 | // Coorganizers: Names as a string in an array. |
  | 566 | 562 | $arr\_coorganizer\_names = array(); |
  | 567 |  | if ( ~~count( $arr\_content['coorganizers'] ) > 0~~ ) { |
  |  | 563 | if ( empty( $arr\_content['coorganizers'] ) == false ) { |
  | 568 | 564 | foreach ( $arr\_content['coorganizers'] as $arr\_single\_coorg ) { |
  | 569 | 565 | $arr\_coorganizer\_names[] = $arr\_single\_coorg['name']; |
  | […](/browser/verowa-connect/trunk/functions/event.php?rev=3159837#L589) | […](/browser/verowa-connect/trunk/functions/event.php?rev=3201030#L585) |  |
  | 589 | 585 | $arr\_placeholders['ORGANIZER\_NAME'] = $str\_organizer; |
  | 590 | 586 |  |
  | 591 |  | $str\_coorganizers                   = implode( ', ', $arr\_coorganizer\_names ); |
  |  | 587 | $str\_coorganizers                   = implode( ', ', $arr\_coorganizer\_names ); |
  | 592 | 588 |  |
  | 593 | 589 | // coorganizer inkl. organizer |
  | […](/browser/verowa-connect/trunk/functions/event.php?rev=3159837#L620) | […](/browser/verowa-connect/trunk/functions/event.php?rev=3201030#L616) |  |
  | 620 | 616 | date\_i18n( 'F Y', $verowa\_date\_from->format( 'U' ) ) . ', ' . |
  | 621 | 617 | date\_i18n( 'G.i', $verowa\_date\_from->format( 'U' ) ) . '&nbsp;' . |
  | 622 |  | ~~\_\_( 'o’clock', 'verowa-connect'~~ ); |
  |  | 618 | verowa\_tf( 'o’clock', \_\_( 'o’clock', 'verowa-connect' ) ); |
  | 623 | 619 | } |
  | 624 | 620 |  |
  | […](/browser/verowa-connect/trunk/functions/event.php?rev=3159837#L717) | […](/browser/verowa-connect/trunk/functions/event.php?rev=3201030#L713) |  |
  | 717 | 713 | } |
  | 718 | 714 |  |
  | 719 |  | $arr\_shared\_placeholder = verowa\_event\_shared\_placeholders( $arr\_content ); |
  |  | 715 | $arr\_shared\_placeholder = verowa\_event\_shared\_placeholders( $arr\_content, $str\_language\_code, $arr\_lang ); |
  | 720 | 716 | $arr\_placeholders       = array\_merge( $arr\_placeholders, $arr\_shared\_placeholder ); |
  | 721 | 717 | $str\_output             = verowa\_parse\_template( $obj\_template->entry, $arr\_placeholders ) . |
  | […](/browser/verowa-connect/trunk/functions/event.php?rev=3159837#L734) | […](/browser/verowa-connect/trunk/functions/event.php?rev=3201030#L730) |  |
  | 734 | 730 | \* @return array Placeholders |
  | 735 | 731 | \*/ |
  | 736 |  | function verowa\_event\_shared\_placeholders( $arr\_event\_data, $str\_language\_code = 'de') { |
  |  | 732 | function verowa\_event\_shared\_placeholders( $arr\_event\_data, $str\_language\_code = 'de', $arr\_lang = '') { |
  | 737 | 733 | $arr\_placeholders = array(); |
  | 738 | 734 |  |
  | […](/browser/verowa-connect/trunk/functions/event.php?rev=3159837#L793) | […](/browser/verowa-connect/trunk/functions/event.php?rev=3201030#L789) |  |
  | 793 | 789 |  |
  | 794 | 790 | $arr\_placeholders['LIST\_IDS'] = $arr\_event\_data['list\_ids'] ?? ''; |
  | 795 |  | $arr\_placeholders['SHORT\_DESC'] = $arr\_event\_data['short\_desc']; |
  |  | 791 | $arr\_placeholders['SHORT\_DESC'] = $arr\_lang['short\_desc'] ?? $arr\_event\_data['short\_desc']; |
  |  | 792 | $arr\_placeholders['LONG\_DESC']  = $arr\_lang['long\_desc']; |
  |  | 793 |  |
  |  | 794 | $arr\_placeholders['DATETIME\_FROM\_LONG'] = date\_i18n( 'l, j. F Y, G.i', $technical\_date\_from->format( 'U' ) ) . |
  |  | 795 | '&nbsp;' . verowa\_tf( 'o’clock', \_\_( 'o’clock', 'verowa-connect' ) ); |
  | 796 | 796 |  |
  | 797 | 797 | // Di, 03. September 2023, 16:00 Uhr |
  | 798 | 798 | $arr\_placeholders['DATETIME\_FROM\_LONGMONTH'] = date\_i18n( 'D, d. F Y, H:i', $technical\_date\_from->format( 'U' ) ) . |
  | 799 |  | '&nbsp;' . ~~\_\_( 'o’clock', 'verowa-connect'~~ ); |
  |  | 799 | '&nbsp;' . verowa\_tf( 'o’clock', \_\_( 'o’clock', 'verowa-connect' ) ); |
  | 800 | 800 |  |
  | 801 | 801 | $str\_datetie\_from\_ect = date\_i18n( 'Y-m-d H:i:s', $technical\_date\_from->format( 'U' ) ); |
  | […](/browser/verowa-connect/trunk/functions/event.php?rev=3159837#L911) | […](/browser/verowa-connect/trunk/functions/event.php?rev=3201030#L911) |  |
  | 911 | 911 | } |
  | 912 | 912 |  |
  | 913 |  | $time\_string .= '&nbsp;' . ~~\_\_( 'o’clock', 'verowa-connect'~~ ); |
  |  | 913 | $time\_string .= '&nbsp;' . verowa\_tf( 'o’clock', \_\_( 'o’clock', 'verowa-connect' ) ); |
  | 914 | 914 | } else { |
  | 915 | 915 | // For events lasting several days, we use a different format (3 variants): |
  | […](/browser/verowa-connect/trunk/functions/event.php?rev=3159837#L1011) | […](/browser/verowa-connect/trunk/functions/event.php?rev=3201030#L1011) |  |
  | 1011 | 1011 | $arr\_event\_contents          = verowa\_event\_get\_single\_content( 0, $arr\_templates, $arr\_event ); |
  | 1012 | 1012 | $str\_default\_language\_code   = verowa\_wpml\_get\_default\_language\_code(); |
  | 1013 |  | // Die ID muss pro Sprache eindeutig sein. |
  | 1014 |  | $trid = null; |
  |  | 1013 |  |
  |  | 1014 | // The ID must be unique for each language. |
  |  | 1015 | // If false, a new ID is generated. |
  |  | 1016 | $trid = false; |
  | 1015 | 1017 |  |
  | 1016 | 1018 | foreach ( $arr\_event\_contents as $str\_language\_code => $arr\_single\_event\_content ) { |
  | […](/browser/verowa-connect/trunk/functions/event.php?rev=3159837#L1051) | […](/browser/verowa-connect/trunk/functions/event.php?rev=3201030#L1053) |  |
  | 1051 | 1053 | $str\_default\_language\_code : null; |
  | 1052 | 1054 |  |
  | 1053 |  | if (null == $trid) { |
  |  | 1055 | $set\_language\_args = array( |
  |  | 1056 | 'element\_id' => $int\_post\_id, |
  |  | 1057 | 'element\_type' => 'post\_verowa\_event', |
  |  | 1058 | 'trid' => $trid, |
  |  | 1059 | 'language\_code' => $str\_language\_code, |
  |  | 1060 | 'source\_language\_code' => $str\_source\_language\_code, |
  |  | 1061 | ); |
  |  | 1062 | do\_action( 'wpml\_set\_element\_language\_details', $set\_language\_args ); |
  |  | 1063 |  |
  |  | 1064 | // get new trid if not set |
  |  | 1065 | if (false === $trid) |
  |  | 1066 | { |
  | 1054 | 1067 | $get\_language\_args = array('element\_id' => $int\_post\_id, 'element\_type' => 'post\_verowa\_event' ); |
  | 1055 | 1068 | $original\_post\_language\_info = apply\_filters( 'wpml\_element\_language\_details', null, $get\_language\_args ); |
  | 1056 | 1069 | $trid = $original\_post\_language\_info->trid; |
  | 1057 |  | ~~} else {~~ |
  | 1058 |  | ~~$set\_language\_args = array(~~ |
  | 1059 |  | ~~'element\_id' => $int\_post\_id,~~ |
  | 1060 |  | ~~'element\_type' => 'post\_verowa\_event',~~ |
  | 1061 |  | ~~'trid' => $trid,~~ |
  | 1062 |  | ~~'language\_code' => $str\_language\_code,~~ |
  | 1063 |  | ~~'source\_language\_code' => $str\_source\_language\_code,~~ |
  | 1064 |  | ~~);~~ |
  | 1065 |  | ~~do\_action( 'wpml\_set\_element\_language\_details', $set\_language\_args );~~ |
  | 1066 | 1070 | } |
  | 1067 | 1071 | } |
  | […](/browser/verowa-connect/trunk/functions/event.php?rev=3159837#L1082) | […](/browser/verowa-connect/trunk/functions/event.php?rev=3201030#L1086) |  |
  | 1082 | 1086 | 'target\_groups'      => $arr\_ids['target\_group\_ids'] ?? '', |
  | 1083 | 1087 | 'with\_subscription'  => $bool\_has\_subscription, |
  | 1084 |  | 'content'            => ~~$str\_content~~, |
  | 1085 |  | 'search\_content'     => ~~$str\_search\_content~~, |
  |  | 1088 | 'content'            => esc\_sql( $str\_content ), |
  |  | 1089 | 'search\_content'     => esc\_sql( $str\_search\_content ), |
  | 1086 | 1090 | 'hash'               => strval( $str\_hash ), |
  | 1087 | 1091 | 'deprecated\_content' => 0, |
  | […](/browser/verowa-connect/trunk/functions/event.php?rev=3159837#L1201) | […](/browser/verowa-connect/trunk/functions/event.php?rev=3201030#L1205) |  |
  | 1201 | 1205 | 'with\_subscription'  => $bool\_has\_subscription, |
  | 1202 | 1206 | 'content'            => wp\_json\_encode( $arr\_event, JSON\_UNESCAPED\_UNICODE ), |
  | 1203 |  | 'search\_content'     => ~~$str\_search\_content~~, |
  |  | 1207 | 'search\_content'     => esc\_sql( $str\_search\_content ), |
  | 1204 | 1208 | 'hash'               => $str\_hash, |
  | 1205 | 1209 | 'deprecated\_content' => 0, |
  | […](/browser/verowa-connect/trunk/functions/event.php?rev=3159837#L1251) | […](/browser/verowa-connect/trunk/functions/event.php?rev=3201030#L1255) |  |
  | 1251 | 1255 | $str\_events\_tablename = $wpdb->prefix . 'verowa\_events'; |
  | 1252 | 1256 | $query                = 'SELECT `post\_id` FROM `' . $str\_events\_tablename . '` ' . |
  | 1253 |  | 'WHERE event\_id = ~~' . $event\_id . '~~;'; |
  | 1254 |  | $int\_post\_id          = $wpdb->get\_var( $~~query~~ ); |
  | 1255 |  |  |
  | 1256 |  | $arr\_translations = verowa\_wpml\_get\_translations( $int\_post\_id ); |
  |  | 1257 | 'WHERE event\_id = %d;'; |
  |  | 1258 | $int\_post\_id          = $wpdb->get\_var( $wpdb->prepare( $query, $event\_id ) ); |
  |  | 1259 |  |
  |  | 1260 | $arr\_translations = verowa\_wpml\_get\_translations( $int\_post\_id, 'post\_verowa\_event' ); |
  | 1257 | 1261 |  |
  | 1258 | 1262 | foreach ( $arr\_translations as $obj\_element\_translation ) { |
  | […](/browser/verowa-connect/trunk/functions/event.php?rev=3159837#L1333) | […](/browser/verowa-connect/trunk/functions/event.php?rev=3201030#L1337) |  |
  | 1333 | 1337 | 'post\_title'   => wp\_strip\_all\_tags( $arr\_lang['title'] ), |
  | 1334 | 1338 | 'post\_name'    => $str\_post\_name, |
  | 1335 |  | 'post\_content' => ~~$str\_content\_html~~, |
  |  | 1339 | 'post\_content' => esc\_sql($str\_content\_html), |
  | 1336 | 1340 | 'post\_excerpt' => $arr\_lang['post\_excerpt'], |
  | 1337 | 1341 | 'post\_type'    => 'verowa\_event', |
  | […](/browser/verowa-connect/trunk/functions/event.php?rev=3159837#L1442) | […](/browser/verowa-connect/trunk/functions/event.php?rev=3201030#L1446) |  |
  | 1442 | 1446 |  |
  | 1443 | 1447 | /\*\* |
  | 1444 |  | ~~\* Retrieves events from the database based on the provided parameters.~~ |
  | 1445 |  | ~~\*~~ |
  | 1446 |  | ~~\* @param array    $arr\_list\_id List IDs to filter the events by.~~ |
  | 1447 |  | ~~\* @param int      $layer\_id Layer ID to filter the events by.~~ |
  | 1448 |  | ~~\* @param DateTime $obj\_date\_from Optional. Starting date to filter the events from.~~ |
  | 1449 |  | ~~\* @param DateTime $obj\_date\_to Optional. Ending date to filter the events to.~~ |
  | 1450 |  | ~~\* @param string   $order\_by Optional. Specifies the sorting order of the events. Default is 'datetime\_from ASC'.~~ |
  | 1451 |  | ~~\* @param int      $int\_limit Optional. Specifies the sorting order of the events. Default is 'datetime\_from ASC'.~~ |
  | 1452 |  | ~~\* @param int      $int\_offset Optional. Number of events to skip. Default is 0 (no offset).~~ |
  | 1453 |  | ~~\*~~ |
  | 1454 |  | ~~\* @return array[]  An array of event data retrieved from the database.~~ |
  | 1455 |  | ~~\*/~~ |
  | 1456 |  | ~~function verowa\_event\_get\_from\_db( $arr\_list\_id, $layer\_id, $obj\_date\_from = '', $obj\_date\_to = '',~~ |
  | 1457 |  | ~~$order\_by = 'datetime\_from ASC', $int\_limit = 0, $int\_offset = 0 ) {~~ |
  | 1458 |  | ~~global $wpdb;~~ |
  | 1459 |  |  |
  | 1460 |  | ~~$arr\_ret              = array();~~ |
  | 1461 |  | ~~$str\_events\_tablename = $wpdb->prefix . 'verowa\_events';~~ |
  | 1462 |  | ~~$query                = 'SELECT \* FROM `' . $str\_events\_tablename . '`';~~ |
  | 1463 |  |  |
  | 1464 |  | ~~// Setup filter.~~ |
  | 1465 |  | ~~$arr\_filter = array();~~ |
  | 1466 |  | ~~if ( $obj\_date\_from ) {~~ |
  | 1467 |  | ~~$arr\_filter [] = '`datetime\_from` >= "' . $obj\_date\_from->format( 'Y-m-d' ) . ' 00:00:00"';~~ |
  | 1468 |  | ~~}~~ |
  | 1469 |  |  |
  | 1470 |  | ~~if ( '' !== $obj\_date\_to ) {~~ |
  | 1471 |  | ~~$arr\_filter [] = '`datetime\_to` <= "' . $obj\_date\_to->format( 'Y-m-d' ) . ' 23:59:59"';~~ |
  | 1472 |  | ~~}~~ |
  | 1473 |  |  |
  | 1474 |  | ~~foreach ( $arr\_list\_id as $single\_list\_id ) {~~ |
  | 1475 |  | ~~$arr\_filter [] = '`list\_ids` like "%;' . $single\_list\_id . ';%"';~~ |
  | 1476 |  | ~~}~~ |
  | 1477 |  |  |
  | 1478 |  | ~~if ( 0 !== count( $arr\_filter ) ) {~~ |
  | 1479 |  | ~~$query .= ' WHERE ';~~ |
  | 1480 |  | ~~$query .= implode( ' AND ', $arr\_filter );~~ |
  | 1481 |  | ~~}~~ |
  | 1482 |  |  |
  | 1483 |  | ~~$query .= ' ORDER BY ' . $order\_by;~~ |
  | 1484 |  |  |
  | 1485 |  | ~~if ( $int\_limit > 0 ) {~~ |
  | 1486 |  | ~~$query .= ' LIMIT ' . $int\_limit . ' OFFSET ' . $int\_offset;~~ |
  | 1487 |  | ~~}~~ |
  | 1488 |  |  |
  | 1489 |  | ~~$query .= ';';~~ |
  | 1490 |  |  |
  | 1491 |  | ~~$result = $wpdb->get\_results( $query );~~ |
  | 1492 |  |  |
  | 1493 |  | ~~foreach ( $result as $obj\_event ) {~~ |
  | 1494 |  | ~~$arr\_event = array(~~ |
  | 1495 |  | ~~'event\_id'          => $obj\_event->event\_id,~~ |
  | 1496 |  | ~~'datetime\_from'     => $obj\_event->datetime\_from,~~ |
  | 1497 |  | ~~'datetime\_to'       => $obj\_event->datetime\_to,~~ |
  | 1498 |  | ~~'list\_ids'          => $obj\_event->list\_ids,~~ |
  | 1499 |  | ~~'layer\_ids'         => $obj\_event->layer\_ids,~~ |
  | 1500 |  | ~~'target\_groups'     => $obj\_event->target\_groups,~~ |
  | 1501 |  | ~~'with\_subscription' => $obj\_event->with\_subscription,~~ |
  | 1502 |  | ~~);~~ |
  | 1503 |  |  |
  | 1504 |  | ~~$arr\_content = json\_decode( $obj\_event->content, JSON\_OBJECT\_AS\_ARRAY );~~ |
  | 1505 |  |  |
  | 1506 |  | ~~if ( count( $arr\_content['rooms'] ) > 0 ) {~~ |
  | 1507 |  | ~~$arr\_content['room'] = $arr\_content['rooms'][0];~~ |
  | 1508 |  | ~~}~~ |
  | 1509 |  |  |
  | 1510 |  | ~~$arr\_ret[] = array\_merge( $arr\_event, $arr\_content );~~ |
  | 1511 |  | ~~}~~ |
  | 1512 |  |  |
  | 1513 |  | ~~return $arr\_ret;~~ |
  | 1514 |  | ~~}~~ |
  | 1515 |  |  |
  | 1516 |  |  |
  | 1517 |  |  |
  | 1518 |  |  |
  | 1519 |  | ~~/\*\*~~ |
  | 1520 | 1448 | \* Generates the MD5 hash for an event based on the event information. |
  | 1521 | 1449 | \* |
  | […](/browser/verowa-connect/trunk/functions/event.php?rev=3159837#L1619) | […](/browser/verowa-connect/trunk/functions/event.php?rev=3201030#L1547) |  |
  | 1619 | 1547 | $arr\_event\_data   = array(); |
  | 1620 | 1548 | $arr\_restrictions = array(); |
  | 1621 |  |  |
  |  | 1549 | $arr\_values = []; |
  |  | 1550 | $i\_val\_count = 0; |
  | 1622 | 1551 | // CWe,MPf: Prevent display event in the past. |
  | 1623 | 1552 | $obj\_date\_now       = new DateTime( 'now', wp\_timezone() ); |
  | 1624 |  | ~~$arr\_restrictions[] = '`datetime\_to` >= "' . $obj\_date\_now->format( 'Y-m-d H:i:s' ) . '"';~~ |
  | 1625 | 1553 |  |
  | 1626 | 1554 | if ( 'now' === $obj\_date ) { |
  | […](/browser/verowa-connect/trunk/functions/event.php?rev=3159837#L1628) | […](/browser/verowa-connect/trunk/functions/event.php?rev=3201030#L1556) |  |
  | 1628 | 1556 | } |
  | 1629 | 1557 |  |
  | 1630 |  | $arr\_restrictions[] = '`datetime\_to` >= "' . $obj\_date->format( 'Y-m-d H:i:s' ) . '"'; |
  |  | 1558 | $arr\_restrictions[] = '`datetime\_to` >= "%' . (++$i\_val\_count) . '$s"'; |
  |  | 1559 | $arr\_values[] = $obj\_date->format( 'Y-m-d H:i:s' ); |
  | 1631 | 1560 |  |
  | 1632 | 1561 | if ( strlen( $event\_ids ) > 0 ) { |
  | 1633 |  | $arr\_restrictions[] = '`event\_id` IN (' . $event\_ids . ')'; |
  |  | 1562 | $arr\_restrictions[] = '`event\_id` IN (%' . (++$i\_val\_count) . '$s)'; |
  |  | 1563 | $arr\_values[] = $event\_ids; |
  | 1634 | 1564 | } |
  | 1635 | 1565 |  |
  | 1636 | 1566 | if ( strlen( $list\_ids ) > 0 ) { |
  | 1637 |  | $arr\_restrictions[] = verowa\_helper\_combine\_query\_for\_ids( 'list\_ids', $list\_ids, 'AND' ); |
  |  | 1567 | $arr\_restrictions[] =  verowa\_helper\_combine\_query\_for\_ids( 'list\_ids', $list\_ids, 'AND' ); |
  | 1638 | 1568 | } |
  | 1639 | 1569 |  |
  | 1640 | 1570 | if ( '' !== $str\_search\_string ) { |
  | 1641 |  | $arr\_restrictions[] = '`search\_content` like "%' . $str\_search\_string . '%"'; |
  |  | 1571 | $arr\_restrictions[] = '`search\_content` like "%' . (++$i\_val\_count) . '$s"'; |
  |  | 1572 | $arr\_values[] = '%' . $str\_search\_string . '%'; |
  | 1642 | 1573 | } |
  | 1643 | 1574 |  |
  | 1644 | 1575 | $str\_restrictions = count( $arr\_restrictions ) === 0 ? '1' : implode( ' AND ', $arr\_restrictions ); |
  | 1645 |  | $str\_limit        = $max\_events > 0 ? ' LIMIT ' . ~~$max\_events~~ : ''; |
  | 1646 |  | $str\_limit       .= $int\_offset > 0 ? ' OFFSET ' . ~~$int\_offset~~ : ''; |
  | 1647 |  |  |
  |  | 1576 | $str\_limit        = $max\_events > 0 ? ' LIMIT ' . intval ($max\_events) : ''; |
  |  | 1577 | $str\_limit       .= $int\_offset > 0 ? ' OFFSET ' . intval ($int\_offset) : ''; |
  |  | 1578 |  |
  | 1648 | 1579 | $str\_get\_event\_query = 'SELECT \* FROM `' . $wpdb->prefix . 'verowa\_events` ' . |
  | 1649 | 1580 | 'WHERE ' . $str\_restrictions . ' ORDER BY `datetime\_from` ASC' . $str\_limit; |
  | 1650 | 1581 |  |
  | 1651 |  | $arr\_event\_data   = $wpdb->get\_results( $str\_get\_event\_query, ARRAY\_A ); |
  | 1652 |  | $int\_count\_events = count( $arr\_event\_data ?? array() ); |
  |  | 1582 | $str\_query = $wpdb->prepare($str\_get\_event\_query, $arr\_values); |
  |  | 1583 | $arr\_event\_data   = $wpdb->get\_results($str\_query , ARRAY\_A ); |
  |  | 1584 | $int\_count\_events = count( $arr\_event\_data ?? array() ); |
  |  | 1585 |  |
  | 1653 | 1586 | if ( $int\_count\_events > 0 ) { |
  | 1654 | 1587 | for ( $i = 0; $i < $int\_count\_events; $i++ ) { |
  | […](/browser/verowa-connect/trunk/functions/event.php?rev=3159837#L1689) | […](/browser/verowa-connect/trunk/functions/event.php?rev=3201030#L1622) |  |
  | 1689 | 1622 | $arr\_event\_data   = array(); |
  | 1690 | 1623 | $arr\_restrictions = array(); |
  |  | 1624 | $arr\_values = []; |
  |  | 1625 | $i\_val\_count = 0; |
  | 1691 | 1626 |  |
  | 1692 | 1627 | if ( 'now' === $obj\_date ) { |
  | […](/browser/verowa-connect/trunk/functions/event.php?rev=3159837#L1694) | […](/browser/verowa-connect/trunk/functions/event.php?rev=3201030#L1629) |  |
  | 1694 | 1629 | } |
  | 1695 | 1630 |  |
  | 1696 |  | $arr\_restrictions[] = '`datetime\_to` >= "' . $obj\_date->format( $date\_from\_format ) . '"'; |
  |  | 1631 | $arr\_restrictions[] = '`datetime\_to` >= "%' . (++$i\_val\_count) . '$s"'; |
  |  | 1632 | $arr\_values[] = $obj\_date->format( $date\_from\_format ); |
  | 1697 | 1633 |  |
  | 1698 | 1634 | if ( strlen( $event\_ids ) > 0 ) { |
  | 1699 |  | $arr\_restrictions[] = '`event\_id` IN (' . $event\_ids . ')'; |
  |  | 1635 | $arr\_restrictions[] = '`event\_id` IN (%' . (++$i\_val\_count) . '$s)'; |
  |  | 1636 | $arr\_values[] = $event\_ids; |
  | 1700 | 1637 | } |
  | 1701 | 1638 |  |
  | […](/browser/verowa-connect/trunk/functions/event.php?rev=3159837#L1717) | […](/browser/verowa-connect/trunk/functions/event.php?rev=3201030#L1654) |  |
  | 1717 | 1654 |  |
  | 1718 | 1655 | $str\_restrictions = 0 == count( $arr\_restrictions ) ? '1' : implode( ' AND ', $arr\_restrictions ); |
  | 1719 |  | $str\_limit        = $max\_events > 0 ? ' LIMIT ' . ~~$max\_events~~ : ''; |
  | 1720 |  | $str\_limit       .= $int\_offset > 0 ? ' OFFSET ' . ~~$int\_offset~~ : ''; |
  |  | 1656 | $str\_limit        = $max\_events > 0 ? ' LIMIT ' . intval ($max\_events) : ''; |
  |  | 1657 | $str\_limit       .= $int\_offset > 0 ? ' OFFSET ' . intval ($int\_offset) : ''; |
  | 1721 | 1658 |  |
  | 1722 | 1659 | $str\_get\_event\_query = 'SELECT \* FROM `' . $wpdb->prefix . 'verowa\_events` ' . |
  | 1723 | 1660 | 'WHERE ' . $str\_restrictions . ' ORDER BY `datetime\_from` ASC' . $str\_limit; |
  | 1724 | 1661 |  |
  | 1725 |  | $arr\_event\_data  = $wpdb->get\_results( $str\_get\_event\_query, ARRAY\_A ); |
  |  | 1662 | $str\_query = $wpdb->prepare( $str\_get\_event\_query, $arr\_values ); |
  |  | 1663 | $arr\_event\_data  = $wpdb->get\_results( $str\_query, ARRAY\_A ); |
  | 1726 | 1664 | $int\_count\_event = count( $arr\_event\_data ?? array() ); |
  | 1727 | 1665 | if ( $int\_count\_event > 0 ) { |
* ## [verowa-connect/trunk/functions/general.php](/changeset/3201030/verowa-connect/trunk/functions/general.php "Show the changeset 3201030 restricted to verowa-connect/trunk/functions/general.php")

  | [r3159837](/browser/verowa-connect/trunk/functions/general.php?rev=3159837#L133 "Show revision 3159837 of this file in browser") | [r3201030](/browser/verowa-connect/trunk/functions/general.php?rev=3201030#L133 "Show revision 3201030 of this file in browser") |  |
  | --- | --- | --- |
  | 133 | 133 | } |
  | 134 | 134 | } |
  | 135 |  |  |
  | 136 | 135 |  |
  | 137 | 136 |  |
  | […](/browser/verowa-connect/trunk/functions/general.php?rev=3159837#L267) | […](/browser/verowa-connect/trunk/functions/general.php?rev=3201030#L266) |  |
  | 267 | 266 | $arr\_restrictions = array(); |
  | 268 | 267 | foreach ( explode( ',', $str\_ids ) as $single\_id ) { |
  | 269 |  | $arr\_restrictions[] = '`' . $field\_name . '` LIKE "%;' . trim( ~~$single\_id~~ ) . ';%"'; |
  |  | 268 | $arr\_restrictions[] = '`' . $field\_name . '` LIKE "%;' . trim( intval( $single\_id ) ) . ';%"'; |
  | 270 | 269 | } |
  | 271 | 270 |  |
  | […](/browser/verowa-connect/trunk/functions/general.php?rev=3159837#L613) | […](/browser/verowa-connect/trunk/functions/general.php?rev=3201030#L612) |  |
  | 613 | 612 |  |
  | 614 | 613 | /\*\* |
  | 615 |  | \* Wrap for the PHP function mail |
  | 616 |  | \* |
  | 617 |  | \* @param string $str\_to Receiver, or receivers of the mail. |
  | 618 |  | \* @param string $str\_subject Subject of the email to be sent. |
  | 619 |  | \* @param string $str\_message Message to be sent. |
  | 620 |  | \* @param bool   $bool\_send\_always If true, the mail will be sent even if VEROWA\_DEBUG is set to false. |
  | 621 |  | \* |
  | 622 |  | \* @return bool |
  | 623 |  | \*/ |
  | 624 |  | function verowa\_send\_mail( $str\_to, $str\_subject, $str\_message, $bool\_send\_always = false ) { |
  | 625 |  | $ret = false; |
  | 626 |  |  |
  | 627 |  | if ( VEROWA\_DEBUG || $bool\_send\_always ) { |
  | 628 |  | $ret = mail( $str\_to, $str\_subject, $str\_message ); |
  | 629 |  | } |
  | 630 |  | return $ret; |
  |  | 614 | \* Report a given error to Verowa for debugging purposes. |
  |  | 615 | \* |
  |  | 616 | \* @param string $str\_type notice, warning or error |
  |  | 617 | \* @param array $arr\_description |
  |  | 618 | \* |
  |  | 619 | \* @return array|WP\_Error |
  |  | 620 | \*/ |
  |  | 621 | function verowa\_report\_error( $str\_type, $arr\_description ) { |
  |  | 622 | $verowa\_api\_key = get\_option( 'verowa\_api\_key', false ); |
  |  | 623 | $verowa\_member  = get\_option( 'verowa\_instance', false ); |
  |  | 624 |  |
  |  | 625 | $arr\_data = array( |
  |  | 626 | 'type' => $str\_type, |
  |  | 627 | 'description' => wp\_json\_encode( $arr\_description ) |
  |  | 628 | ); |
  |  | 629 |  |
  |  | 630 | return wp\_remote\_post( |
  |  | 631 | 'https://api.verowa.ch/log\_vc\_error', |
  |  | 632 | array( |
  |  | 633 | 'method'      => 'POST', |
  |  | 634 | 'timeout'     => 7, |
  |  | 635 | 'redirection' => 5, |
  |  | 636 | 'httpversion' => '1.0', |
  |  | 637 | 'blocking'    => true, |
  |  | 638 | 'headers'     => array( |
  |  | 639 | 'member' => $verowa\_member, |
  |  | 640 | 'apikey' => $verowa\_api\_key, |
  |  | 641 | ), |
  |  | 642 | 'body'        => wp\_json\_encode( $arr\_data , true ), |
  |  | 643 | 'cookies'     => array(), |
  |  | 644 | ) |
  |  | 645 | ); |
  | 631 | 646 | } |
  | 632 | 647 |  |
  | […](/browser/verowa-connect/trunk/functions/general.php?rev=3159837#L688) | […](/browser/verowa-connect/trunk/functions/general.php?rev=3201030#L703) |  |
  | 688 | 703 | $str\_checkbox\_disabled . ' />' . $arr\_args['text'] . '</label> ' . |
  | 689 | 704 | verowa\_get\_info\_rollover( $arr\_args['helptext'] ?? '' ) . '<br />', |
  |  | 705 | 'name'         => $arr\_args['name'], |
  | 690 | 706 | 'kses\_allowed' => array( |
  | 691 | 707 | 'label' => array( |
* ## [verowa-connect/trunk/functions/person.php](/changeset/3201030/verowa-connect/trunk/functions/person.php "Show the changeset 3201030 restricted to verowa-connect/trunk/functions/person.php")

  | [r3130013](/browser/verowa-connect/trunk/functions/person.php?rev=3130013#L27 "Show revision 3130013 of this file in browser") | [r3201030](/browser/verowa-connect/trunk/functions/person.php?rev=3201030#L27 "Show revision 3201030 of this file in browser") |  |
  | --- | --- | --- |
  | 27 | 27 | true : false; |
  | 28 | 28 |  |
  | 29 |  | ~~// $wpdb->query( 'START TRANSACTION' );~~ |
  | 30 | 29 | $str\_tablename = $wpdb->prefix . 'verowa\_person'; |
  | 31 | 30 |  |
  | […](/browser/verowa-connect/trunk/functions/person.php?rev=3130013#L33) | […](/browser/verowa-connect/trunk/functions/person.php?rev=3201030#L32) |  |
  | 33 | 32 | $int\_post\_id = 0; |
  | 34 | 33 | $str\_title   = verowa\_person\_get\_title( $arr\_person ); |
  | 35 |  |  |
  | 36 | 34 | $str\_exception = 'Insert not possible ' . $str\_title . '(' . $arr\_person['person\_id'] . ')'; |
  | 37 | 35 |  |
  | 38 |  | ~~$arr\_person\_ml\_html        = show\_a\_person\_from\_verowa\_detail( $arr\_person );~~ |
  | 39 | 36 | $str\_default\_language\_code = verowa\_wpml\_get\_default\_language\_code(); |
  | 40 | 37 |  |
  | 41 | 38 | if ( false === $bool\_persons\_without\_detail\_page ) { |
  | 42 |  | $trid = null; |
  |  | 39 | $i\_template\_id = get\_option( 'verowa\_default\_persondetails\_template', 0 ); |
  |  | 40 | $arr\_templates = verowa\_get\_single\_template( $i\_template\_id ); |
  |  | 41 |  |
  |  | 42 | $arr\_options = array( |
  |  | 43 | 'b\_is\_detail\_page' => true, |
  |  | 44 | 'b\_is\_wpml\_configured' => verowa\_wpml\_is\_configured(), |
  |  | 45 | ); |
  |  | 46 | $arr\_person\_ml\_html = verowa\_person\_assembling\_html( $arr\_person, $arr\_templates, 'all', 'pr', $arr\_options ); |
  |  | 47 |  |
  |  | 48 | $trid = false; |
  | 43 | 49 |  |
  | 44 | 50 | foreach ( $arr\_person\_ml\_html as $str\_language\_code => $arr\_person\_html ) { |
  | […](/browser/verowa-connect/trunk/functions/person.php?rev=3130013#L52) | […](/browser/verowa-connect/trunk/functions/person.php?rev=3201030#L58) |  |
  | 52 | 58 | 'post\_title'   => wp\_strip\_all\_tags( $str\_title ), |
  | 53 | 59 | 'post\_name'    => $str\_post\_name, |
  | 54 |  | 'post\_content' => ~~$arr\_person\_html['html']~~, |
  | 55 |  | 'post\_excerpt' => ~~$arr\_person['short\_desc']~~, |
  |  | 60 | 'post\_content' => esc\_sql( $arr\_person\_html['html'] ), |
  |  | 61 | 'post\_excerpt' => esc\_sql( $arr\_person['short\_desc'] ), |
  | 56 | 62 | 'post\_type'    => 'verowa\_person', |
  | 57 | 63 | 'post\_status'  => 'publish', |
  | […](/browser/verowa-connect/trunk/functions/person.php?rev=3130013#L67) | […](/browser/verowa-connect/trunk/functions/person.php?rev=3201030#L73) |  |
  | 67 | 73 | ); |
  | 68 | 74 |  |
  | 69 |  | if ( ! is\_wp\_error( $int\_post\_id ) ) { |
  |  | 75 | if ( ! is\_wp\_error( $int\_post\_id ) && verowa\_wpml\_is\_configured() ) { |
  | 70 | 76 |  |
  | 71 | 77 | $str\_source\_language\_code = $str\_language\_code !== $str\_default\_language\_code ? |
  | 72 | 78 | $str\_default\_language\_code : null; |
  | 73 |  |  |
  | 74 |  | if (null == $trid) { |
  |  | 79 |  |
  |  | 80 | $set\_language\_args = array( |
  |  | 81 | 'element\_id' => $int\_post\_id, |
  |  | 82 | 'element\_type' => 'post\_verowa\_person', |
  |  | 83 | 'trid' => $trid, |
  |  | 84 | 'language\_code' => $str\_language\_code, |
  |  | 85 | 'source\_language\_code' => $str\_source\_language\_code, |
  |  | 86 | ); |
  |  | 87 | do\_action( 'wpml\_set\_element\_language\_details', $set\_language\_args ); |
  |  | 88 |  |
  |  | 89 | if (false === $trid) |
  |  | 90 | { |
  | 75 | 91 | $get\_language\_args = array( 'element\_id' => $int\_post\_id, 'element\_type' => 'post\_verowa\_person' ); |
  | 76 | 92 | $original\_post\_language\_info = apply\_filters( 'wpml\_element\_language\_details', null, $get\_language\_args ); |
  | 77 | 93 | $trid = $original\_post\_language\_info->trid; |
  | 78 |  | ~~} else {~~ |
  | 79 |  | ~~$set\_language\_args = array(~~ |
  | 80 |  | ~~'element\_id' => $int\_post\_id,~~ |
  | 81 |  | ~~'element\_type' => 'post\_verowa\_person',~~ |
  | 82 |  | ~~'trid' => $trid,~~ |
  | 83 |  | ~~'language\_code' => $str\_language\_code,~~ |
  | 84 |  | ~~'source\_language\_code' => $str\_source\_language\_code,~~ |
  | 85 |  | ~~);~~ |
  | 86 |  | ~~do\_action( 'wpml\_set\_element\_language\_details', $set\_language\_args );~~ |
  | 87 | 94 | } |
  | 88 | 95 | } |
  | […](/browser/verowa-connect/trunk/functions/person.php?rev=3130013#L110) | […](/browser/verowa-connect/trunk/functions/person.php?rev=3201030#L117) |  |
  | 110 | 117 | ); |
  | 111 | 118 |  |
  | 112 |  | ~~// $wpdb->query( 'COMMIT' );~~ |
  | 113 | 119 | } catch ( Exception $exception ) { |
  | 114 | 120 | $obj\_debug = new Verowa\_Connect\_Debugger(); |
  | […](/browser/verowa-connect/trunk/functions/person.php?rev=3130013#L125) | […](/browser/verowa-connect/trunk/functions/person.php?rev=3201030#L131) |  |
  | 125 | 131 | \* Insert a person into the database without creating a corresponding WordPress post. |
  | 126 | 132 | \* |
  | 127 |  | \* @param array  $arr\_person Array containing person data. |
  | 128 |  | \* @param string $str\_web\_visibility Web visibility of the person. |
  | 129 |  | \* @param string $str\_hash Hash value associated with the person. |
  |  | 133 | \* @param array  $arr\_person Array containing person data. |
  |  | 134 | \* @param string $str\_web\_visibility Web visibility of the person. |
  |  | 135 | \* @param string $str\_hash Hash value associated with the person. |
  | 130 | 136 | \* |
  | 131 | 137 | \* @return void |
  | […](/browser/verowa-connect/trunk/functions/person.php?rev=3130013#L162) | […](/browser/verowa-connect/trunk/functions/person.php?rev=3201030#L168) |  |
  | 162 | 168 | \* Update a person in the database without a corresponding WordPress post. |
  | 163 | 169 | \* |
  | 164 |  | \* @param array  $arr\_person Array containing person data. |
  | 165 |  | \* @param string $str\_web\_visibility Web visibility of the person. |
  | 166 |  | \* @param string $str\_hash Hash value associated with the person. |
  |  | 170 | \* @param array  $arr\_person Array containing person data. |
  |  | 171 | \* @param string $str\_web\_visibility Web visibility of the person. |
  |  | 172 | \* @param string $str\_hash Hash value associated with the person. |
  | 167 | 173 | \* |
  | 168 | 174 | \* @return void |
  | […](/browser/verowa-connect/trunk/functions/person.php?rev=3130013#L177) | […](/browser/verowa-connect/trunk/functions/person.php?rev=3201030#L183) |  |
  | 177 | 183 | array( |
  | 178 | 184 | 'post\_id'            => 0, |
  | 179 |  | 'content'            => ~~$str\_content~~, |
  |  | 185 | 'content'            => esc\_sql ($str\_content), |
  | 180 | 186 | 'hash'               => $str\_hash, |
  | 181 | 187 | 'deprecated'         => 0, |
  | […](/browser/verowa-connect/trunk/functions/person.php?rev=3130013#L216) | […](/browser/verowa-connect/trunk/functions/person.php?rev=3201030#L222) |  |
  | 216 | 222 | 'public\_target' => $arr\_person\_group['public\_target'] ?? '', |
  | 217 | 223 | 'short\_name'    => $arr\_person\_group['short\_name'] ?? '', |
  |  | 224 | 'multilang'     => $arr\_person\_group['multilang'] ?? [], |
  | 218 | 225 | ); |
  | 219 | 226 | $str\_content = json\_encode( $arr\_content ); |
  | […](/browser/verowa-connect/trunk/functions/person.php?rev=3130013#L266) | […](/browser/verowa-connect/trunk/functions/person.php?rev=3201030#L273) |  |
  | 266 | 273 |  |
  | 267 | 274 | $str\_update\_exception = 'Update not possible ' . $str\_title . '(' . $arr\_person['person\_id'] . ')'; |
  | 268 |  | $arr\_person\_ml\_html   = show\_a\_person\_from\_verowa\_detail( $arr\_person ); |
  | 269 |  |  |
  |  | 275 |  |
  | 270 | 276 | $query           = 'SELECT `post\_id` FROM `' . $str\_person\_tablename . '` ' . |
  | 271 | 277 | 'WHERE person\_id = ' . $arr\_person['person\_id'] . ';'; |
  | […](/browser/verowa-connect/trunk/functions/person.php?rev=3130013#L277) | […](/browser/verowa-connect/trunk/functions/person.php?rev=3201030#L283) |  |
  | 277 | 283 |  |
  | 278 | 284 | $current\_post\_id = intval( $current\_post\_id ); |
  | 279 |  |  |
  | 280 | 285 | // Create post only if the detail page is needed. |
  | 281 | 286 | if ( false === $bool\_persons\_without\_detail\_page ) { |
  | 282 |  | $trid = null; |
  |  | 287 | $i\_template\_id = get\_option( 'verowa\_default\_persondetails\_template', 0 ); |
  |  | 288 | $arr\_templates = verowa\_get\_single\_template( $i\_template\_id ); |
  |  | 289 |  |
  |  | 290 | $arr\_options   = array( |
  |  | 291 | 'b\_is\_detail\_page' => true, |
  |  | 292 | 'b\_is\_wpml\_configured' => verowa\_wpml\_is\_configured(), |
  |  | 293 | ); |
  |  | 294 | $arr\_person\_ml\_html = verowa\_person\_assembling\_html( $arr\_person, $arr\_templates, 'all', 'pr', $arr\_options ); |
  | 283 | 295 | if ( 0 === $current\_post\_id ) { |
  | 284 | 296 | // New posts object. |
  | […](/browser/verowa-connect/trunk/functions/person.php?rev=3130013#L445) | […](/browser/verowa-connect/trunk/functions/person.php?rev=3201030#L457) |  |
  | 445 | 457 | 'public\_target' => $arr\_person\_group['public\_target'] ?? '', |
  | 446 | 458 | 'short\_name'    => $arr\_person\_group['short\_name'] ?? '', |
  |  | 459 | 'multilang'     => $arr\_person\_group['multilang'] ?? [], |
  | 447 | 460 | ); |
  | 448 | 461 | $str\_content = json\_encode( $arr\_content ); |
  | […](/browser/verowa-connect/trunk/functions/person.php?rev=3130013#L464) | […](/browser/verowa-connect/trunk/functions/person.php?rev=3201030#L477) |  |
  | 464 | 477 | array( '%d' ) |
  | 465 | 478 | ); |
  | 466 |  | ~~}~~ |
  | 467 |  |  |
  | 468 |  |  |
  | 469 |  |  |
  | 470 |  |  |
  | 471 |  | ~~/\*\*~~ |
  | 472 |  | ~~\* Update all posts which related witch a verowa person~~ |
  | 473 |  | ~~\*/~~ |
  | 474 |  | ~~function verowa\_person\_db\_update\_posts\_content() {~~ |
  | 475 |  | ~~$arr\_persons = verowa\_persons\_get\_multiple( null, 'FULL' );~~ |
  | 476 |  | ~~foreach ( $arr\_persons as $arr\_single\_person ) {~~ |
  | 477 |  | ~~$arr\_html = show\_a\_person\_from\_verowa\_detail( $arr\_single\_person );~~ |
  | 478 |  |  |
  | 479 |  | ~~if ( intval( $arr\_single\_person['post\_id'] ?? 0 ) > 0 ) {~~ |
  | 480 |  | ~~$arr\_post = array(~~ |
  | 481 |  | ~~'ID'           => intval( $arr\_single\_person['post\_id'] ),~~ |
  | 482 |  | ~~'post\_content' => $arr\_html['de']['html'],~~ |
  | 483 |  | ~~);~~ |
  | 484 |  |  |
  | 485 |  | ~~try {~~ |
  | 486 |  | ~~// This function call must be nested in a try catch block.~~ |
  | 487 |  | ~~verowa\_general\_update\_custom\_post( $arr\_post, '', $arr\_html['de']['head']);~~ |
  | 488 |  | ~~} catch ( Exception $exception ) {~~ |
  | 489 |  | ~~$obj\_debug = new Verowa\_Connect\_Debugger();~~ |
  | 490 |  | ~~$obj\_debug->write\_to\_file( 'Fehler event update: ' . $exception->getMessage() );~~ |
  | 491 |  | ~~}~~ |
  | 492 |  | ~~}~~ |
  | 493 |  | ~~}~~ |
  | 494 | 479 | } |
  | 495 | 480 |  |
  | […](/browser/verowa-connect/trunk/functions/person.php?rev=3130013#L692) | […](/browser/verowa-connect/trunk/functions/person.php?rev=3201030#L677) |  |
  | 692 | 677 | $arr\_person\_data = array(); |
  | 693 | 678 | if ( intval( $int\_person\_id ?? 0 ) > 0 ) { |
  | 694 |  | $str\_get\_person\_query = 'SELECT `content` FROM `' . $wpdb->prefix . 'verowa\_person` WHERE `person\_id` = ' . |
  | 695 |  | $int\_person\_id . ';'; |
  | 696 |  |  |
  | 697 |  | $arr\_person\_data = $wpdb->get\_results( $str\_get\_person\_query, ARRAY\_A ); |
  |  | 679 | $str\_get\_person\_query = 'SELECT `content` FROM `' . $wpdb->prefix . 'verowa\_person` WHERE `person\_id` = %d;'; |
  |  | 680 |  |
  |  | 681 | $arr\_person\_data = $wpdb->get\_results( |
  |  | 682 | $wpdb->prepare( $str\_get\_person\_query, $int\_person\_id ), |
  |  | 683 | ARRAY\_A |
  |  | 684 | ); |
  | 698 | 685 | } |
  | 699 | 686 | return key\_exists( 0, $arr\_person\_data ) ? $arr\_person\_data[0] : array(); |
  | […](/browser/verowa-connect/trunk/functions/person.php?rev=3130013#L720) | […](/browser/verowa-connect/trunk/functions/person.php?rev=3201030#L707) |  |
  | 720 | 707 | is\_array( $arr\_person\_ids ) && |
  | 721 | 708 | 0 !== count( $arr\_person\_ids ) ) { |
  |  | 709 | $arr\_person\_ids = array\_map( 'intval', $arr\_person\_ids ); |
  | 722 | 710 | $arr\_where[] = '`person\_id` IN (' . |
  | 723 | 711 | implode( ', ', $arr\_person\_ids ) . ')'; |
  | […](/browser/verowa-connect/trunk/functions/person.php?rev=3130013#L725) | […](/browser/verowa-connect/trunk/functions/person.php?rev=3201030#L713) |  |
  | 725 | 713 |  |
  | 726 | 714 | if ( '' != $str\_web\_visibility ) { |
  | 727 |  | $arr\_where[] = '`web\_visibility` = "' . ~~$str\_web\_visibility~~ . '"'; |
  |  | 715 | $arr\_where[] = '`web\_visibility` = "' . esc\_sql( $str\_web\_visibility ) . '"'; |
  | 728 | 716 | } |
  | 729 | 717 |  |
  | […](/browser/verowa-connect/trunk/functions/person.php?rev=3130013#L758) | […](/browser/verowa-connect/trunk/functions/person.php?rev=3201030#L746) |  |
  | 758 | 746 |  |
  | 759 | 747 | $query = 'SELECT `person\_ids`, `functions\_in\_group` FROM ' . |
  | 760 |  | '`' . $wpdb->prefix . 'verowa\_person\_groups` WHERE `pgroup\_id` = ' . ~~$int\_group\_id~~ . ' AND `deprecated` = 0;'; |
  |  | 748 | '`' . $wpdb->prefix . 'verowa\_person\_groups` WHERE `pgroup\_id` = ' . intval( $int\_group\_id ) . ' AND `deprecated` = 0;'; |
  | 761 | 749 |  |
  | 762 | 750 | $arr\_persongroup\_infos = $wpdb->get\_results( $query, ARRAY\_A ); |
  | […](/browser/verowa-connect/trunk/functions/person.php?rev=3130013#L806) | […](/browser/verowa-connect/trunk/functions/person.php?rev=3201030#L794) |  |
  | 806 | 794 | \* @param int   $person\_id  The ID of the person. |
  | 807 | 795 | \* @param array $arr\_person An associative array containing person information. |
  | 808 |  | \*/ |
  | 809 |  | function verowa\_person\_add\_wp\_post( $person\_id, $arr\_person ) { |
  | 810 |  | global $wpdb; |
  | 811 |  | // TODO: Erweitern für WPML |
  |  | 796 | \* @param array $arr\_templates |
  |  | 797 | \*/ |
  |  | 798 | function verowa\_person\_add\_wp\_post( $person\_id, $arr\_person, $arr\_templates ) { |
  |  | 799 | global $wpdb; |
  |  | 800 |  |
  | 812 | 801 | $str\_table\_name  = $wpdb->prefix . 'verowa\_person'; |
  | 813 | 802 | $query           = 'SELECT `post\_id` FROM `' . $str\_table\_name . '` ' . |
  | 814 |  | 'WHERE person\_id = ' . ~~$person\_id~~ . ';'; |
  |  | 803 | 'WHERE person\_id = ' . intval ($person\_id) . ';'; |
  | 815 | 804 | $current\_post\_id = $wpdb->get\_var( $query ); |
  | 816 | 805 |  |
  | 817 | 806 | if ( $current\_post\_id != null && intval( $current\_post\_id ) == 0 ) { |
  | 818 |  |  |
  | 819 |  | $arr\_content\_html = show\_a\_person\_from\_verowa\_detail( $arr\_person ); |
  |  | 807 | $arr\_options = array( |
  |  | 808 | 'b\_is\_detail\_page' => true, |
  |  | 809 | 'b\_is\_wpml\_configured' => verowa\_wpml\_is\_configured(), |
  |  | 810 | ); |
  |  | 811 | $arr\_content\_html = verowa\_person\_assembling\_html( $arr\_person, $arr\_templates, 'all', 'pr', $arr\_options ); |
  | 820 | 812 | $str\_title        = verowa\_person\_get\_title( $arr\_person ); |
  | 821 | 813 |  |
  | […](/browser/verowa-connect/trunk/functions/person.php?rev=3130013#L862) | […](/browser/verowa-connect/trunk/functions/person.php?rev=3201030#L854) |  |
  | 862 | 854 | $arr\_restrictions   = array(); |
  | 863 | 855 | $arr\_restrictions[] = '`deprecated` = 0'; |
  |  | 856 | $curr\_language\_code = verowa\_wpml\_get\_current\_language(); |
  | 864 | 857 |  |
  | 865 | 858 | $query       = 'SELECT \* FROM ' . |
  | […](/browser/verowa-connect/trunk/functions/person.php?rev=3130013#L869) | […](/browser/verowa-connect/trunk/functions/person.php?rev=3201030#L862) |  |
  | 869 | 862 |  |
  | 870 | 863 | for ( $i = 0; $i < count( $arr\_pgroups ); $i++ ) { |
  | 871 |  | $arr\_pgroups[ $i ] = array\_merge( json\_decode( $arr\_pgroups[ $i ]['content'], true ), $arr\_pgroups[ $i ] ); |
  |  | 864 | $arr\_content = json\_decode( $arr\_pgroups[ $i ]['content'], true ); |
  |  | 865 | $arr\_lang = verowa\_wpml\_get\_language\_strings\_for\_person\_group( $arr\_content, $curr\_language\_code ); |
  |  | 866 | $arr\_content['name'] = $arr\_lang['name'] ?? $arr\_content['name'] ?? ''; |
  |  | 867 | $arr\_pgroups[ $i ] = array\_merge( $arr\_content , $arr\_pgroups[ $i ] ); |
  | 872 | 868 | unset( $arr\_pgroups[ $i ]['content'] ); |
  | 873 | 869 | $arr\_pgroups[ $i ]['children'] = array(); |
  | […](/browser/verowa-connect/trunk/functions/person.php?rev=3130013#L902) | […](/browser/verowa-connect/trunk/functions/person.php?rev=3201030#L898) |  |
  | 902 | 898 | return implode( ' ', $arr\_title ); |
  | 903 | 899 | } |
  |  | 900 |  |
  |  | 901 |  |
  |  | 902 |  |
  |  | 903 |  |
  |  | 904 | /\*\* |
  |  | 905 | \* Compile the content of the person page for display. |
  |  | 906 | \* This function compiles and generates content for the person page based on the provided person data. |
  |  | 907 | \* |
  |  | 908 | \* @param array  $arr\_person\_data An array containing person data. |
  |  | 909 | \* @param array  $arr\_template    An associative array containing the template content. |
  |  | 910 | \* @param array  $arr\_lang        Translated language content. |
  |  | 911 | \* @param string $str\_comp\_tag    Optional. A tag to identify the specific person data entry to use for images. |
  |  | 912 | \* @param array  $arr\_options     Optional. [b\_is\_detail\_page, b\_is\_wpml\_configured] |
  |  | 913 | \* |
  |  | 914 | \* @return array An associative array of compiled content for each language. The keys represent language codes, |
  |  | 915 | \*               and the values contain the compiled content. |
  |  | 916 | \*/ |
  |  | 917 | function verowa\_person\_assembling\_html( & $arr\_person\_data, & $arr\_template, $str\_curr\_language\_code = 'all', |
  |  | 918 | $str\_comp\_tag = 'pr', $arr\_options = []) { |
  |  | 919 | global $post; |
  |  | 920 |  |
  |  | 921 | $arr\_person\_content    = array(); |
  |  | 922 | $arr\_placeholders      = array(); |
  |  | 923 | $b\_is\_detail\_page      = $arr\_options['b\_is\_detail\_page'] ?? false; |
  |  | 924 | $b\_is\_wpml\_configured  = $arr\_options['b\_is\_wpml\_configured'] ?? verowa\_wpml\_is\_configured(); |
  |  | 925 | $str\_siteurl           = verowa\_get\_base\_url(); |
  |  | 926 | $str\_default\_language  = verowa\_wpml\_get\_default\_language\_code(); |
  |  | 927 |  |
  |  | 928 | if ( null !== $arr\_person\_data && count( $arr\_person\_data ) > 0 && ! empty ($arr\_template) ) { |
  |  | 929 | $arr\_lang\_codes = []; |
  |  | 930 | if ($str\_curr\_language\_code == 'all') { |
  |  | 931 | $verowa\_wpml\_mapping = verowa\_wpml\_get\_mapping(); |
  |  | 932 | foreach ($verowa\_wpml\_mapping as $arr\_wp\_language\_codes) { |
  |  | 933 | foreach ($arr\_wp\_language\_codes as $str\_wp\_language\_code) { |
  |  | 934 | $arr\_lang\_codes[] = $str\_wp\_language\_code; |
  |  | 935 | } |
  |  | 936 | } |
  |  | 937 | } else { |
  |  | 938 | $arr\_lang\_codes[] = $str\_curr\_language\_code; |
  |  | 939 | } |
  |  | 940 |  |
  |  | 941 | // Certain special entries override the defaults from the plug-in settings. |
  |  | 942 | if ( ! $b\_is\_detail\_page && null !== $post && $post->ID > 0 && |
  |  | 943 | get\_post\_meta( $post->ID, 'verowa\_has\_person\_options\_on\_post\_level', false ) ) { |
  |  | 944 |  |
  |  | 945 | // Only with detail pages, the setting of the post has effect. |
  |  | 946 | $persons\_without\_detail\_page = get\_option( 'verowa\_persons\_without\_detail\_page', false ); |
  |  | 947 | if ( 'on' !== $persons\_without\_detail\_page ) { |
  |  | 948 | $persons\_have\_detail\_link = get\_post\_meta( $post->ID, 'verowa\_persons\_have\_detail\_link', true ); |
  |  | 949 | } else { |
  |  | 950 | $persons\_have\_detail\_link = false; |
  |  | 951 | } |
  |  | 952 |  |
  |  | 953 | $person\_group\_function = get\_post\_meta( $post->ID, 'verowa\_person\_show\_group\_function', true ); |
  |  | 954 | $person\_profession     = get\_post\_meta( $post->ID, 'verowa\_person\_show\_profession', true ); |
  |  | 955 | $person\_address        = get\_post\_meta( $post->ID, 'verowa\_person\_show\_address', true ); |
  |  | 956 | $person\_email          = get\_post\_meta( $post->ID, 'verowa\_person\_show\_person\_email', true ); |
  |  | 957 | $person\_phone          = get\_post\_meta( $post->ID, 'verowa\_person\_show\_person\_phone', true ); |
  |  | 958 | $person\_short\_desc     = get\_post\_meta( $post->ID, 'verowa\_person\_short\_desc', true ); |
  |  | 959 | } else { |
  |  | 960 | // Otherwise we simply adopt the ones from the plugin. |
  |  | 961 | $persons\_without\_detail\_page = get\_option( 'verowa\_persons\_without\_detail\_page', false ); |
  |  | 962 | $persons\_have\_detail\_link    = 'on' != $persons\_without\_detail\_page ? 'on' : false; |
  |  | 963 |  |
  |  | 964 | // If the person is displayed via the shortcode in an event detail it has no post meta data. |
  |  | 965 | // The options are set to on so that the display depends on the placeholders of the templates. |
  |  | 966 | $person\_group\_function = 'on'; |
  |  | 967 | $person\_profession     = 'on'; |
  |  | 968 | $person\_address        = 'on'; |
  |  | 969 | $person\_email          = 'on'; |
  |  | 970 | $person\_phone          = 'on'; |
  |  | 971 | $person\_short\_desc     = 'on'; |
  |  | 972 | } |
  |  | 973 |  |
  |  | 974 | $arr\_person\_name = array(); |
  |  | 975 | if ( '' !== $arr\_person\_data['firstname'] ) { |
  |  | 976 | $arr\_person\_name [] = $arr\_person\_data['firstname']; |
  |  | 977 | } |
  |  | 978 |  |
  |  | 979 | // if there is the first name AND the surname, separate with a space. |
  |  | 980 | if ( '' != $arr\_person\_data['lastname'] ) { |
  |  | 981 | $arr\_person\_name [] = $arr\_person\_data['lastname']; |
  |  | 982 | } |
  |  | 983 |  |
  |  | 984 | $str\_person\_name = implode( ' ', $arr\_person\_name ); |
  |  | 985 |  |
  |  | 986 | foreach ($arr\_lang\_codes as $str\_language\_code) |
  |  | 987 | { |
  |  | 988 |  |
  |  | 989 | $arr\_lang = verowa\_wpml\_get\_language\_strings\_for\_person( $arr\_person\_data, $str\_language\_code ); |
  |  | 990 |  |
  |  | 991 | if ( ! $b\_is\_detail\_page) |
  |  | 992 | { |
  |  | 993 | if (true === $b\_is\_wpml\_configured) |
  |  | 994 | { |
  |  | 995 | $str\_person\_details\_url = verowa\_wpml\_get\_custom\_post\_url($arr\_person\_data['person\_id'], |
  |  | 996 | $str\_language\_code, 'person', 'verowa\_person'); |
  |  | 997 | } |
  |  | 998 | else |
  |  | 999 | { |
  |  | 1000 | $str\_person\_details\_url = $str\_siteurl . '/person/' . $arr\_person\_data['person\_id'] . '/'; |
  |  | 1001 | } |
  |  | 1002 |  |
  |  | 1003 | $arr\_placeholders['PERSON\_DETAILS\_URL'] = $str\_person\_details\_url; |
  |  | 1004 |  |
  |  | 1005 | if ('on' === $persons\_have\_detail\_link) |
  |  | 1006 | { |
  |  | 1007 | $str\_link\_pre = '<a href="' . $str\_person\_details\_url . '/">'; |
  |  | 1008 | $str\_link\_post = '</a>'; |
  |  | 1009 | } |
  |  | 1010 | else |
  |  | 1011 | { |
  |  | 1012 | $str\_link\_pre = ''; |
  |  | 1013 | $str\_link\_post = ''; |
  |  | 1014 | } |
  |  | 1015 |  |
  |  | 1016 | $arr\_placeholders['PERSON\_NAME'] = $str\_link\_pre . $str\_person\_name . $str\_link\_post; |
  |  | 1017 | $arr\_placeholders['PERSON\_NAME\_NOT\_LINKED'] = $str\_person\_name; |
  |  | 1018 |  |
  |  | 1019 | if ('' !== ($arr\_person\_data['images'][$str\_comp\_tag]['url'] ?? '')) |
  |  | 1020 | { |
  |  | 1021 | $arr\_placeholders['IMAGE\_URL'] = $str\_link\_pre . |
  |  | 1022 | '<img src="' . $arr\_person\_data['images'][$str\_comp\_tag]['url'] . '" />' . $str\_link\_post; |
  |  | 1023 | } |
  |  | 1024 | } |
  |  | 1025 | else |
  |  | 1026 | { |
  |  | 1027 | // Placeholder for the person details only. |
  |  | 1028 | $arr\_placeholders['PERSON\_DETAILS\_URL'] = ''; |
  |  | 1029 | $arr\_placeholders['PERSON\_NAME'] = $str\_person\_name; |
  |  | 1030 | $arr\_placeholders['IMAGE\_URL'] = $arr\_person\_data['images'][$str\_comp\_tag]['url'] ?? ''; |
  |  | 1031 | } |
  |  | 1032 |  |
  |  | 1033 |  |
  |  | 1034 | $arr\_placeholders['IMAGE\_SOURCE\_TEXT'] = $arr\_person\_data['image\_source\_text'] ?? ''; |
  |  | 1035 | $arr\_placeholders['IMAGE\_SOURCE\_URL'] = $arr\_person\_data['image\_source\_url'] ?? ''; |
  |  | 1036 |  |
  |  | 1037 | $arr\_placeholders['PERSON\_ID'] = $arr\_person\_data['person\_id'] ?? ''; |
  |  | 1038 |  |
  |  | 1039 | $arr\_placeholders['FUNCTION\_IN\_GROUP'] = ''; |
  |  | 1040 | if ('on' === $person\_group\_function) |
  |  | 1041 | { |
  |  | 1042 | $arr\_placeholders['FUNCTION\_IN\_GROUP'] = $arr\_person\_data['function\_in\_group'] ?? ''; |
  |  | 1043 | } |
  |  | 1044 |  |
  |  | 1045 | $arr\_placeholders['PROFESSION'] = ''; |
  |  | 1046 | if ('on' === $person\_profession) |
  |  | 1047 | { |
  |  | 1048 | $arr\_placeholders['PROFESSION'] = $arr\_lang['profession'] ?? $arr\_person\_data['profession'] ?? ''; |
  |  | 1049 | } |
  |  | 1050 |  |
  |  | 1051 | $arr\_placeholders['SHORT\_DESC'] = ''; |
  |  | 1052 | if ('on' === $person\_short\_desc) |
  |  | 1053 | { |
  |  | 1054 | $arr\_placeholders['SHORT\_DESC'] = $arr\_person\_data['short\_desc'] ?? ''; |
  |  | 1055 | } |
  |  | 1056 |  |
  |  | 1057 | if ('on' === $person\_address) |
  |  | 1058 | { |
  |  | 1059 | $arr\_placeholders['ADDRESS'] = $arr\_person\_data['address'] ?? ''; |
  |  | 1060 | $arr\_placeholders['ZIP\_CITY'] = trim(($arr\_person\_data['postcode'] ?? '') . ' ' . |
  |  | 1061 | ($arr\_person\_data['city'] ?? '')); |
  |  | 1062 | } |
  |  | 1063 |  |
  |  | 1064 | $arr\_placeholders['DESC\_TASKS'] = $arr\_person\_data['desc\_tasks'] ?? ''; |
  |  | 1065 | $arr\_placeholders['DESC\_PERSONAL'] = $arr\_person\_data['desc\_personal'] ?? ''; |
  |  | 1066 |  |
  |  | 1067 | $arr\_placeholders['HAS\_PRIVATE\_ADDRESS'] = false; |
  |  | 1068 | if ('' !== ($arr\_person\_data['private\_street'] ?? '') || |
  |  | 1069 | '' !== ($arr\_person\_data['private\_postcode'] ?? '') || |
  |  | 1070 | '' !== ($arr\_person\_data['private\_city'] ?? '')) |
  |  | 1071 | { |
  |  | 1072 |  |
  |  | 1073 | $arr\_placeholders['HAS\_PRIVATE\_ADDRESS'] = true; |
  |  | 1074 |  |
  |  | 1075 | if ('' !== $arr\_person\_data['private\_street']) |
  |  | 1076 | { |
  |  | 1077 | $arr\_placeholders['PRIVATE\_STREET'] = $arr\_person\_data['private\_street']; |
  |  | 1078 | } |
  |  | 1079 |  |
  |  | 1080 | if ('' !== $arr\_person\_data['private\_postcode'] || '' !== $arr\_person\_data['private\_city']) |
  |  | 1081 | { |
  |  | 1082 | $str\_private\_zipcode = ''; |
  |  | 1083 |  |
  |  | 1084 | if ('' !== $arr\_person\_data['private\_postcode']) |
  |  | 1085 | { |
  |  | 1086 | $str\_private\_zipcode = $arr\_person\_data['private\_postcode'] . ' '; |
  |  | 1087 | } |
  |  | 1088 |  |
  |  | 1089 | $arr\_placeholders['PRIVATE\_ZIP\_CITY'] = $str\_private\_zipcode . $arr\_person\_data['private\_city']; |
  |  | 1090 | } |
  |  | 1091 | } |
  |  | 1092 |  |
  |  | 1093 | $arr\_placeholders['HAS\_BUSINESS\_ADDRESS'] = false; |
  |  | 1094 |  |
  |  | 1095 | if ('' !== ($arr\_person\_data['business\_street'] ?? '') || '' !== ($arr\_person\_data['business\_postcode'] ?? '') || |
  |  | 1096 | '' !== ($arr\_person\_data['business\_city'] ?? '')) |
  |  | 1097 | { |
  |  | 1098 |  |
  |  | 1099 | $arr\_placeholders['HAS\_BUSINESS\_ADDRESS'] = true; |
  |  | 1100 |  |
  |  | 1101 | if ('' !== ($arr\_person\_data['business\_street'] ?? '')) |
  |  | 1102 | { |
  |  | 1103 | $arr\_placeholders['BUSINESS\_STREET'] = $arr\_person\_data['business\_street']; |
  |  | 1104 | } |
  |  | 1105 |  |
  |  | 1106 | if ('' !== ($arr\_person\_data['business\_postcode'] ?? '') || '' !== ($arr\_person\_data['business\_city'] ?? '')) |
  |  | 1107 | { |
  |  | 1108 | $str\_business\_zipcode = ''; |
  |  | 1109 |  |
  |  | 1110 | if ('' !== ($arr\_person\_data['business\_postcode'] ?? '')) |
  |  | 1111 | { |
  |  | 1112 | $str\_business\_zipcode = $arr\_person\_data['business\_postcode'] . ' '; |
  |  | 1113 | } |
  |  | 1114 |  |
  |  | 1115 | $arr\_placeholders['BUSINESS\_ZIP\_CITY'] = $str\_business\_zipcode . ($arr\_person\_data['business\_city'] ?? ''); |
  |  | 1116 | } |
  |  | 1117 | } |
  |  | 1118 |  |
  |  | 1119 | if ('on' === $person\_email) |
  |  | 1120 | { |
  |  | 1121 | $arr\_placeholders['EMAIL'] = $arr\_person\_data['email'] ?? ''; |
  |  | 1122 | } |
  |  | 1123 |  |
  |  | 1124 | $arr\_placeholders['PERSONAL\_URL'] = ''; |
  |  | 1125 | if (key\_exists('pers\_website', $arr\_person\_data) && '' !== $arr\_person\_data['pers\_website']) |
  |  | 1126 | { |
  |  | 1127 | if (false === strpos($arr\_person\_data['pers\_website'], 'http')) |
  |  | 1128 | { |
  |  | 1129 | $arr\_person\_data['pers\_website'] = 'https://' . $arr\_person\_data['pers\_website']; |
  |  | 1130 | } |
  |  | 1131 | $arr\_placeholders['PERSONAL\_URL'] = $arr\_person\_data['pers\_website']; |
  |  | 1132 | } |
  |  | 1133 |  |
  |  | 1134 | if ('on' === $person\_phone) |
  |  | 1135 | { |
  |  | 1136 | $arr\_placeholders['PHONE'] = $arr\_person\_data['phone'] ?? ''; |
  |  | 1137 | } |
  |  | 1138 |  |
  |  | 1139 | $arr\_placeholders['BUSINESS\_PHONE'] = verowa\_add\_tel\_link($arr\_person\_data['business\_phone'] ?? ''); |
  |  | 1140 | $arr\_placeholders['BUSINESS\_MOBILE'] = verowa\_add\_tel\_link($arr\_person\_data['business\_mobile'] ?? ''); |
  |  | 1141 | $arr\_placeholders['PRIVATE\_PHONE'] = verowa\_add\_tel\_link($arr\_person\_data['private\_phone'] ?? ''); |
  |  | 1142 | $arr\_placeholders['PRIVATE\_MOBILE'] = verowa\_add\_tel\_link($arr\_person\_data['private\_mobile'] ?? ''); |
  |  | 1143 |  |
  |  | 1144 | $arr\_placeholders['BUSINESS\_PHONE\_NUMBER'] = $arr\_person\_data['business\_phone'] ?? ''; |
  |  | 1145 | $arr\_placeholders['BUSINESS\_MOBILE\_NUMBER'] = $arr\_person\_data['business\_mobile'] ?? ''; |
  |  | 1146 | $arr\_placeholders['PRIVATE\_PHONE\_NUMBER'] = $arr\_person\_data['private\_phone'] ?? ''; |
  |  | 1147 | $arr\_placeholders['PRIVATE\_MOBILE\_NUMBER'] = $arr\_person\_data['private\_mobile'] ?? ''; |
  |  | 1148 | $obj\_template = $arr\_template[ $str\_language\_code ] ?? $arr\_template[ $str\_default\_language ]; |
  |  | 1149 | $str\_parsed\_template = verowa\_parse\_template($obj\_template->entry, $arr\_placeholders); |
  |  | 1150 |  |
  |  | 1151 | $str\_head = ''; |
  |  | 1152 | if ($b\_is\_detail\_page) |
  |  | 1153 | { |
  |  | 1154 | $str\_head = verowa\_parse\_template($obj\_template->head, $arr\_placeholders); |
  |  | 1155 | } |
  |  | 1156 |  |
  |  | 1157 | $arr\_person\_content[ $str\_language\_code ] = array( |
  |  | 1158 | 'head' => $str\_head, |
  |  | 1159 | 'html' => $str\_parsed\_template, |
  |  | 1160 | ); |
  |  | 1161 | } |
  |  | 1162 | } |
  |  | 1163 |  |
  |  | 1164 | return 'all' === $str\_curr\_language\_code ? $arr\_person\_content : $arr\_person\_content[ $str\_curr\_language\_code ]; |
  |  | 1165 | } |
* ## [verowa-connect/trunk/functions/roster.php](/changeset/3201030/verowa-connect/trunk/functions/roster.php "Show the changeset 3201030 restricted to verowa-connect/trunk/functions/roster.php")

  | [r2958219](/browser/verowa-connect/trunk/functions/roster.php?rev=2958219#L29 "Show revision 2958219 of this file in browser") | [r3201030](/browser/verowa-connect/trunk/functions/roster.php?rev=3201030#L29 "Show revision 3201030 of this file in browser") |  |
  | --- | --- | --- |
  | 29 | 29 | $str\_query = 'SELECT \* FROM `' . $wpdb->prefix . 'verowa\_roster\_duties`'; |
  | 30 | 30 | $arr\_where = array(); |
  |  | 31 | $arr\_values = []; |
  |  | 32 | $i\_val\_count = 0; |
  | 31 | 33 |  |
  | 32 | 34 | if ( $roster\_id ) { |
  | 33 |  | $arr\_where[] = '`roster\_id` = ' . $roster\_id; |
  |  | 35 | $arr\_where[]  = '`roster\_id` = %' . ( ++$i\_val\_count ) . '$d'; |
  |  | 36 | $arr\_values[] = intval( $roster\_id ); |
  | 34 | 37 | } |
  | 35 | 38 |  |
  | […](/browser/verowa-connect/trunk/functions/roster.php?rev=2958219#L37) | […](/browser/verowa-connect/trunk/functions/roster.php?rev=3201030#L40) |  |
  | 37 | 40 | $obj\_max\_days = new DateTime( current\_time( 'Y-m-d 23:59:59' ) ); |
  | 38 | 41 | $obj\_max\_days->modify( '+' . $int\_max\_days . ' days' ); |
  | 39 |  | $arr\_where[] = 'datetime\_from < "' . $obj\_max\_days->format( 'Y-m-d H:i:s' ) . '"'; |
  | 40 |  | } |
  | 41 |  |  |
  | 42 |  | $arr\_where[] = '`datetime\_to` > "' . current\_time( 'Y-m-d 00:00:00' ) . '"'; |
  |  | 42 | $arr\_where[]  = 'datetime\_from < "%' . ( ++$i\_val\_count ) . '$s"'; |
  |  | 43 | $arr\_values[] = $obj\_max\_days->format( 'Y-m-d H:i:s' ); |
  |  | 44 | } |
  |  | 45 |  |
  |  | 46 | $arr\_where[] = '`datetime\_to` > "%' . ( ++$i\_val\_count ) . '$s"'; |
  |  | 47 | $arr\_values[] = current\_time( 'Y-m-d 00:00:00' ); |
  | 43 | 48 |  |
  | 44 | 49 | $str\_query .= ' WHERE ' . implode( ' AND ', $arr\_where ) . ' '; |
  | 45 |  | $str\_limit  = $int\_max > 0 ? ' LIMIT ' . $int\_max : ''; |
  | 46 |  | $str\_limit .= $int\_offset > 0 ? ' OFFSET ' . $int\_offset : ''; |
  | 47 |  |  |
  | 48 |  | $arr\_roster\_duty = $wpdb->get\_results( $str\_query . $str\_limit, ARRAY\_A ); |
  |  | 50 | $str\_limit  = $int\_max > 0 ? ' LIMIT ' . intval( $int\_max ) : ''; |
  |  | 51 | $str\_limit .= $int\_offset > 0 ? ' OFFSET ' . intval( $int\_offset ) : ''; |
  |  | 52 |  |
  |  | 53 | $str\_query = $wpdb->prepare( $str\_query . $str\_limit, $arr\_values) ; |
  |  | 54 | $arr\_roster\_duty = $wpdb->get\_results($str\_query , ARRAY\_A ); |
  | 49 | 55 | return $arr\_roster\_duty; |
  | 50 | 56 | } |
  | […](/browser/verowa-connect/trunk/functions/roster.php?rev=2958219#L164) | […](/browser/verowa-connect/trunk/functions/roster.php?rev=3201030#L170) |  |
  | 164 | 170 | $wpdb->prefix . 'verowa\_roster\_duties', |
  | 165 | 171 | array( |
  | 166 |  | 'roster\_id'     => ~~$roster\_id~~, |
  |  | 172 | 'roster\_id'     => intval ($roster\_id), |
  | 167 | 173 | 'datetime\_from' => $datetime\_from, |
  | 168 | 174 | 'datetime\_to'   => $datetime\_to, |
* ## [verowa-connect/trunk/functions/subscription.php](/changeset/3201030/verowa-connect/trunk/functions/subscription.php "Show the changeset 3201030 restricted to verowa-connect/trunk/functions/subscription.php")

  | [r3104541](/browser/verowa-connect/trunk/functions/subscription.php?rev=3104541#L113 "Show revision 3104541 of this file in browser") | [r3201030](/browser/verowa-connect/trunk/functions/subscription.php?rev=3201030#L113 "Show revision 3201030 of this file in browser") |  |
  | --- | --- | --- |
  | 113 | 113 | if ( '' != $single\_event['subscribe\_time'] ) { |
  | 114 | 114 | $str\_subs\_time = intval( substr( $single\_event['subscribe\_time'], 0, 2 ) ) . '.' . |
  | 115 |  | substr( $single\_event['subscribe\_time'], 2, 2 ) . ' ' . ~~\_\_( 'o’clock', 'verowa-connect'~~ ); |
  |  | 115 | substr( $single\_event['subscribe\_time'], 2, 2 ) . ' ' . verowa\_tf( 'o’clock', \_\_( 'o’clock', 'verowa-connect' ) ); |
  | 116 | 116 |  |
  | 117 | 117 | if ( $single\_event['subscribe\_date'] == $str\_date\_today8 ) { |
* ## [verowa-connect/trunk/functions/verowa-log.php](/changeset/3201030/verowa-connect/trunk/functions/verowa-log.php "Show the changeset 3201030 restricted to verowa-connect/trunk/functions/verowa-log.php")

  | [r2958219](/browser/verowa-connect/trunk/functions/verowa-log.php?rev=2958219#L32 "Show revision 2958219 of this file in browser") | [r3201030](/browser/verowa-connect/trunk/functions/verowa-log.php?rev=3201030#L32 "Show revision 3201030 of this file in browser") |  |
  | --- | --- | --- |
  | 32 | 32 | 'modifed\_by\_user\_id' => $user\_id, |
  | 33 | 33 | 'user\_display\_name'  => $str\_user\_name, |
  | 34 |  | 'change\_type'        => ~~$str\_change\_type~~, |
  | 35 |  | 'content'            => ~~$json\_log\_content~~, |
  |  | 34 | 'change\_type'        => esc\_sql( $str\_change\_type ), |
  |  | 35 | 'content'            => esc\_sql( $json\_log\_content ), |
  | 36 | 36 | ), |
  | 37 | 37 | array( '%d', '%s', '%s', '%s' ) |
  | […](/browser/verowa-connect/trunk/functions/verowa-log.php?rev=2958219#L72) | […](/browser/verowa-connect/trunk/functions/verowa-log.php?rev=3201030#L72) |  |
  | 72 | 72 | $wpdb->prefix . 'verowa\_log', |
  | 73 | 73 | array( |
  | 74 |  | 'content' => ~~$json\_log\_content~~, |
  |  | 74 | 'content' => esc\_sql( $json\_log\_content ), |
  | 75 | 75 | ), |
  | 76 | 76 | array( |
* ## [verowa-connect/trunk/functions/verowa-template.php](/changeset/3201030/verowa-connect/trunk/functions/verowa-template.php "Show the changeset 3201030 restricted to verowa-connect/trunk/functions/verowa-template.php")

  | [r3160300](/browser/verowa-connect/trunk/functions/verowa-template.php?rev=3160300#L229 "Show revision 3160300 of this file in browser") | [r3201030](/browser/verowa-connect/trunk/functions/verowa-template.php?rev=3201030#L229 "Show revision 3201030 of this file in browser") |  |
  | --- | --- | --- |
  | 229 | 229 | $str\_cond\_ending = ']]'; |
  | 230 | 230 | $str\_else\_separator = '||'; |
  |  | 231 | $str\_or\_separator = '|'; |
  | 231 | 232 | $str\_cond\_separator = ':'; |
  | 232 | 233 |  |
  | […](/browser/verowa-connect/trunk/functions/verowa-template.php?rev=3160300#L290) | […](/browser/verowa-connect/trunk/functions/verowa-template.php?rev=3201030#L291) |  |
  | 290 | 291 | // if so, we try to find the value as part of the correspondig placeholder value |
  | 291 | 292 | // (this can be an array or a string). |
  |  | 293 |  |
  | 292 | 294 | $arr\_key\_parts = explode( '%', $str\_key ); |
  | 293 | 295 | $arr\_key\_parts[0] = trim( $arr\_key\_parts[0] ); |
  | […](/browser/verowa-connect/trunk/functions/verowa-template.php?rev=3160300#L299) | […](/browser/verowa-connect/trunk/functions/verowa-template.php?rev=3201030#L301) |  |
  | 299 | 301 | $arr\_or\_vals = explode ('||', $arr\_key\_parts[1]); |
  | 300 | 302 | foreach ( $arr\_or\_vals as $str\_single\_val) { |
  | 301 |  | $condition\_is\_true = (true === in\_array(trim( $str\_single\_val ), $arr\_placeholders[$arr\_key\_parts[0]], true)); |
  |  | 303 | $condition\_is\_true = ( true === in\_array( trim( $str\_single\_val ), |
  |  | 304 | $arr\_placeholders[ $arr\_key\_parts[0] ], true ) ); |
  | 302 | 305 | if (true === $condition\_is\_true) { |
  | 303 | 306 | break; |
  | […](/browser/verowa-connect/trunk/functions/verowa-template.php?rev=3160300#L309) | […](/browser/verowa-connect/trunk/functions/verowa-template.php?rev=3201030#L312) |  |
  | 309 | 312 | } else { |
  | 310 | 313 | // for e.g. PROFESSION % Pfr.||Pfrin. |
  | 311 |  | if ( false !== strpos( $arr\_key\_parts[1], '||' ) ) { |
  |  | 314 | if ( false !== strpos( $arr\_key\_parts[1], '||' ) || false !== strpos( $arr\_key\_parts[1], '|' ) ) { |
  | 312 | 315 | $arr\_or\_vals = explode ( '||', $arr\_key\_parts[1] ); |
  | 313 | 316 | foreach ( $arr\_or\_vals as $str\_single\_val ) { |
  | 314 |  | $condition\_is\_true = (false !== strpos ($arr\_placeholders[$arr\_key\_parts[0]], $str\_single\_val)); |
  | 315 |  | if ( true === $condition\_is\_true ) { |
  | 316 |  | break; |
  |  | 317 | $aar\_or\_vals2 = explode ( $str\_or\_separator, $str\_single\_val ); |
  |  | 318 | foreach ($aar\_or\_vals2 as $str\_single\_val) { |
  |  | 319 | $condition\_is\_true = (false !== strpos($arr\_placeholders[$arr\_key\_parts[0]], $str\_single\_val)); |
  |  | 320 | if (true === $condition\_is\_true) |
  |  | 321 | { |
  |  | 322 | break; |
  |  | 323 | } |
  | 317 | 324 | } |
  | 318 | 325 | } |
  | […](/browser/verowa-connect/trunk/functions/verowa-template.php?rev=3160300#L325) | […](/browser/verowa-connect/trunk/functions/verowa-template.php?rev=3201030#L332) |  |
  | 325 | 332 | elseif ( strlen( $arr\_placeholders[ $str\_key ] ?? '' ) > 0 ) { |
  | 326 | 333 | $condition\_is\_true = true; |
  |  | 334 | } elseif ( false !== strpos( $str\_key, $str\_or\_separator ) ) { |
  |  | 335 | $arr\_keys = explode( $str\_or\_separator, $str\_key ); |
  |  | 336 | foreach ($arr\_keys as $str\_single\_key) { |
  |  | 337 | if ( ! empty( $arr\_placeholders[ $str\_single\_key ] ?? '' ) ) { |
  |  | 338 | $condition\_is\_true = true; |
  |  | 339 | break; |
  |  | 340 | } |
  |  | 341 | } |
  |  | 342 |  |
  | 327 | 343 | } |
  | 328 | 344 |  |
  | […](/browser/verowa-connect/trunk/functions/verowa-template.php?rev=3160300#L433) | […](/browser/verowa-connect/trunk/functions/verowa-template.php?rev=3201030#L449) |  |
  | 433 | 449 | $arr\_old\_template = verowa\_get\_single\_template( $obj\_template->template\_id, $language\_code ); |
  | 434 | 450 |  |
  | 435 |  | ~~// TODO: P2 Cache freigeben beim löschen des Templates.~~ |
  | 436 | 451 | wp\_cache\_delete( 'verowa\_single\_template\_2130' . $obj\_template->template\_id ); |
  | 437 | 452 | verowa\_save\_log( 'update\_template', wp\_json\_encode( $arr\_old\_template ) ); |
  | […](/browser/verowa-connect/trunk/functions/verowa-template.php?rev=3160300#L635) | […](/browser/verowa-connect/trunk/functions/verowa-template.php?rev=3201030#L650) |  |
  | 635 | 650 | 'title' => \_\_( 'Text', 'verowa-connect' ), |
  | 636 | 651 | 'pcl' => array( |
  |  | 652 | 'TITLE', |
  |  | 653 | 'TOPIC', |
  |  | 654 | 'LONG\_DESC', |
  |  | 655 | 'SHORT\_DESC', |
  |  | 656 | ), |
  |  | 657 | ), |
  |  | 658 | 'city' => array( |
  |  | 659 | 'title' => \_\_( 'Location', 'verowa-connect' ), |
  |  | 660 | 'pcl' => array( |
  |  | 661 | 'LOCATION', |
  |  | 662 | 'LOCATION\_WITH\_ROOM', |
  |  | 663 | ), |
  |  | 664 | ), |
  |  | 665 | 'persons' => array( |
  |  | 666 | 'title' => \_\_( 'Persons', 'verowa-connect' ), |
  |  | 667 | 'pcl' => array( |
  |  | 668 | 'ORGANIZER\_NAME', |
  |  | 669 | 'COORGANIZER\_NAMES', |
  |  | 670 | 'COORGANIZERS\_WITH\_ORGANIZER', |
  |  | 671 | ), |
  |  | 672 | ), |
  |  | 673 | 'images' => array( |
  |  | 674 | 'title' => \_\_( 'Image', 'verowa-connect' ), |
  |  | 675 | 'pcl' => array( |
  | 637 | 676 | 'IMAGE\_CAPTION', |
  | 638 | 677 | 'IMAGE\_SOURCE\_TEXT', |
  | 639 | 678 | 'IMAGE\_SOURCE\_URL', |
  | 640 |  | 'TITLE', |
  | 641 |  | 'TOPIC', |
  | 642 |  | 'SHORT\_DESC', |
  | 643 |  | ), |
  | 644 |  | ), |
  | 645 |  | 'city' => array( |
  | 646 |  | 'title' => \_\_( 'Location', 'verowa-connect' ), |
  | 647 |  | 'pcl' => array( |
  | 648 |  | 'LOCATION', |
  | 649 |  | 'LOCATION\_WITH\_ROOM', |
  | 650 |  | ), |
  | 651 |  | ), |
  | 652 |  | 'persons' => array( |
  | 653 |  | 'title' => \_\_( 'Persons', 'verowa-connect' ), |
  | 654 |  | 'pcl' => array( |
  | 655 |  | 'ORGANIZER\_NAME', |
  | 656 |  | 'COORGANIZER\_NAMES', |
  | 657 |  | 'COORGANIZERS\_WITH\_ORGANIZER', |
  |  | 679 | 'IMAGE\_URL', |
  | 658 | 680 | ), |
  | 659 | 681 | ), |
  | […](/browser/verowa-connect/trunk/functions/verowa-template.php?rev=3160300#L678) | […](/browser/verowa-connect/trunk/functions/verowa-template.php?rev=3201030#L700) |  |
  | 678 | 700 | 'DETAILS\_BUTTON\_TEXT', |
  | 679 | 701 | 'ICAL\_EXPORT\_URL', |
  | 680 |  | ~~'IMAGE\_URL',~~ |
  | 681 | 702 | 'FILE\_LIST', |
  | 682 | 703 | 'SUBS\_BUTTON', |
  | […](/browser/verowa-connect/trunk/functions/verowa-template.php?rev=3160300#L781) | […](/browser/verowa-connect/trunk/functions/verowa-template.php?rev=3201030#L802) |  |
  | 781 | 802 | 'ADD\_TEXT\_3', |
  | 782 | 803 | 'ADD\_TEXT\_4', |
  | 783 |  | ~~'IMAGE\_CAPTION',~~ |
  | 784 |  | ~~'IMAGE\_SOURCE\_TEXT',~~ |
  | 785 |  | ~~'IMAGE\_SOURCE\_URL',~~ |
  | 786 | 804 | 'LONG\_DESC', |
  | 787 | 805 | 'SHORT\_DESC', |
  | […](/browser/verowa-connect/trunk/functions/verowa-template.php?rev=3160300#L807) | […](/browser/verowa-connect/trunk/functions/verowa-template.php?rev=3201030#L825) |  |
  | 807 | 825 | 'COORGANIZERS', |
  | 808 | 826 | 'COORGANIZERS\_WITH\_ORGANIZER', |
  |  | 827 | ), |
  |  | 828 | ), |
  |  | 829 | 'images' => array( |
  |  | 830 | 'title' => \_\_( 'Image', 'verowa-connect' ), |
  |  | 831 | 'pcl' => array( |
  |  | 832 | 'IMAGE\_CAPTION', |
  |  | 833 | 'IMAGE\_SOURCE\_TEXT', |
  |  | 834 | 'IMAGE\_SOURCE\_URL', |
  |  | 835 | 'IMAGE\_URL', |
  | 809 | 836 | ), |
  | 810 | 837 | ), |
  | […](/browser/verowa-connect/trunk/functions/verowa-template.php?rev=3160300#L827) | […](/browser/verowa-connect/trunk/functions/verowa-template.php?rev=3201030#L854) |  |
  | 827 | 854 | 'FILE\_LIST', |
  | 828 | 855 | 'ICAL\_EXPORT\_URL', |
  | 829 |  | ~~'IMAGE\_URL',~~ |
  | 830 | 856 | 'LAYER\_IDS', |
  | 831 | 857 | 'WITH\_SACRAMENT', |
* ## [verowa-connect/trunk/functions/wpml.php](/changeset/3201030/verowa-connect/trunk/functions/wpml.php "Show the changeset 3201030 restricted to verowa-connect/trunk/functions/wpml.php")

  | [r3123647](/browser/verowa-connect/trunk/functions/wpml.php?rev=3123647#L33 "Show revision 3123647 of this file in browser") | [r3201030](/browser/verowa-connect/trunk/functions/wpml.php?rev=3201030#L33 "Show revision 3201030 of this file in browser") |  |
  | --- | --- | --- |
  | 33 | 33 | $query         = 'SELECT `template\_id` FROM `' . $wpdb->prefix . 'verowa\_templates` '; |
  | 34 | 34 |  |
  | 35 |  | $arr\_restrictions = array( |
  |  | 35 | $arr\_restrictions = array   ( |
  | 36 | 36 | '`deprecated` = 0', |
  | 37 | 37 | ); |
  | […](/browser/verowa-connect/trunk/functions/wpml.php?rev=3123647#L74) | […](/browser/verowa-connect/trunk/functions/wpml.php?rev=3201030#L74) |  |
  | 74 | 74 | if ( true === verowa\_wpml\_is\_configured() ) { |
  | 75 | 75 | $query              = 'SELECT \* FROM `' . $wpdb->prefix . 'verowa\_translations` ' . |
  | 76 |  | 'WHERE `element\_id` = ' . ~~$args['element\_id']~~ . |
  | 77 |  | ' AND `element\_type` = "' . ~~$args['element\_type']~~ . '"'; |
  |  | 76 | 'WHERE `element\_id` = ' . esc\_sql( $args['element\_id'] ) . |
  |  | 77 | ' AND `element\_type` = "' . esc\_sql( $args['element\_type'] ) . '"'; |
  | 78 | 78 | $int\_translation\_id = intval( $wpdb->get\_var( $query ) ?? 0 ); |
  | 79 | 79 |  |
  | […](/browser/verowa-connect/trunk/functions/wpml.php?rev=3123647#L95) | […](/browser/verowa-connect/trunk/functions/wpml.php?rev=3201030#L95) |  |
  | 95 | 95 | if ( true === verowa\_wpml\_is\_configured() ) { |
  | 96 | 96 | $query = 'DELETE FROM `' . $wpdb->prefix . 'verowa\_translations` ' . |
  | 97 |  | 'WHERE `element\_id` = ' . $args['element\_id'] . |
  | 98 |  | ' AND `element\_type` = "' . $args['element\_type'] . '"'; |
  | 99 |  | $wpdb->query( $query ); |
  |  | 97 | 'WHERE `element\_id` = %1$i' . |
  |  | 98 | ' AND `element\_type` = "%2$s"'; |
  |  | 99 |  |
  |  | 100 | $wpdb->query( $wpdb->prepare( $query, $args['element\_id'], $args['element\_type'] ) ); |
  | 100 | 101 | } |
  | 101 | 102 | } |
  | […](/browser/verowa-connect/trunk/functions/wpml.php?rev=3123647#L116) | […](/browser/verowa-connect/trunk/functions/wpml.php?rev=3201030#L117) |  |
  | 116 | 117 | $arr\_restrictions = array(); |
  | 117 | 118 | if ( '' !== ( $arrg['str\_element\_type'] ?? '' ) ) { |
  | 118 |  | $arr\_restrictions[] = '`element\_type` = "' . ~~$arrg['str\_element\_type']~~ . '"'; |
  |  | 119 | $arr\_restrictions[] = '`element\_type` = "' . esc\_sql( $arrg['str\_element\_type'] ) . '"'; |
  | 119 | 120 | } |
  | 120 | 121 |  |
  | 121 | 122 | $trid = intval( $arrg['trid'] ?? 0 ); |
  | 122 | 123 | if ( 0 !== $trid ) { |
  | 123 |  | $arr\_restrictions[] = '`trid` = "' . ~~$trid~~ . '"'; |
  |  | 124 | $arr\_restrictions[] = '`trid` = "' . intval ($trid) . '"'; |
  | 124 | 125 | } |
  | 125 | 126 |  |
  | […](/browser/verowa-connect/trunk/functions/wpml.php?rev=3123647#L138) | […](/browser/verowa-connect/trunk/functions/wpml.php?rev=3201030#L139) |  |
  | 138 | 139 |  |
  | 139 | 140 | /\*\* |
  | 140 |  | ~~\* TODO: Erweitern für Personen~~ |
  | 141 | 141 | \* Get all translation of the given post. |
  | 142 |  | \* Works allso without WPML. |
  | 143 |  | \* |
  | 144 |  | \* @param  mixed $int\_post\_id |
  |  | 142 | \* Works allso without WPML. In this case it return as default language 'de' to avoid conflicts. |
  |  | 143 | \* |
  |  | 144 | \* @param int $int\_post\_id |
  |  | 145 | \* @param string $str\_element\_type The type of an element. Can be a post type: post\_post, post\_page, post\_attachment, |
  |  | 146 | \*               post\_nav\_menu\_item, post\_{custom post key} or taxonomy: tax\_category, tax\_post\_tag, tax\_nav\_menu, tax\_{custom taxonomy key}. |
  | 145 | 147 | \* |
  | 146 | 148 | \* @return array |
  | 147 | 149 | \*/ |
  | 148 |  | function verowa\_wpml\_get\_translations( $int\_post\_id ) { |
  |  | 150 | function verowa\_wpml\_get\_translations( $int\_post\_id, $str\_element\_type ) { |
  | 149 | 151 | $arr\_translations = array(); |
  | 150 | 152 | if ( true === verowa\_wpml\_is\_configured() ) { |
  | 151 |  | $trid             = apply\_filters( 'wpml\_element\_trid', null, $int\_post\_id, ~~'post\_verowa\_event'~~ ); |
  | 152 |  | $arr\_translations = apply\_filters( 'wpml\_get\_element\_translations', null, $trid, ~~'post\_verowa\_event'~~ ); |
  |  | 153 | $trid             = apply\_filters( 'wpml\_element\_trid', null, $int\_post\_id, $str\_element\_type ); |
  |  | 154 | $arr\_translations = apply\_filters( 'wpml\_get\_element\_translations', null, $trid, $str\_element\_type ); |
  | 153 | 155 | } else { |
  | 154 | 156 | $obj                    = new stdClass(); |
  | […](/browser/verowa-connect/trunk/functions/wpml.php?rev=3123647#L159) | […](/browser/verowa-connect/trunk/functions/wpml.php?rev=3201030#L161) |  |
  | 159 | 161 | } |
  | 160 | 162 |  |
  |  | 163 |  |
  |  | 164 |  |
  |  | 165 |  |
  | 161 | 166 | /\*\* |
  | 162 | 167 | \* Return the translation group ID of the given element. |
  | […](/browser/verowa-connect/trunk/functions/wpml.php?rev=3123647#L169) | […](/browser/verowa-connect/trunk/functions/wpml.php?rev=3201030#L174) |  |
  | 169 | 174 | function verowa\_wpml\_get\_translations\_trid( $element\_id, $el\_type = 'record\_verowa\_template' ) { |
  | 170 | 175 | global $wpdb; |
  | 171 |  | // TODO: P2 add WP-Cache |
  |  | 176 |  |
  | 172 | 177 | $trid = 0; |
  | 173 | 178 | if ( true === verowa\_wpml\_is\_configured() ) { |
  | […](/browser/verowa-connect/trunk/functions/wpml.php?rev=3123647#L231) | […](/browser/verowa-connect/trunk/functions/wpml.php?rev=3201030#L236) |  |
  | 231 | 236 | } |
  | 232 | 237 |  |
  |  | 238 |  |
  |  | 239 |  |
  |  | 240 |  |
  |  | 241 |  |
  |  | 242 | /\*\* |
  |  | 243 | \* Extracts the required languages from the multilingual array of Verowa |
  |  | 244 | \* |
  |  | 245 | \* @param  array  $arr\_person Reference person array to be sent from the API. |
  |  | 246 | \* @param  string $str\_language\_code Specify the language to be returned. |
  |  | 247 | \* |
  |  | 248 | \* @return array |
  |  | 249 | \*/ |
  |  | 250 | function verowa\_wpml\_get\_language\_strings\_for\_person( & $arr\_person, $str\_language\_code) |
  |  | 251 | { |
  |  | 252 | $arr\_lang = array(); |
  |  | 253 | if ( 'de' === $str\_language\_code || false === key\_exists ($str\_language\_code, $arr\_person['multilang'] ?? []) ) { |
  |  | 254 | $arr\_lang['profession'] = $arr\_person['profession']; |
  |  | 255 | } else { |
  |  | 256 | $arr\_lang['profession'] = $arr\_person['multilang'][ $str\_language\_code ]['profession'] ?? $arr\_person['profession']; |
  |  | 257 | } |
  |  | 258 | return $arr\_lang; |
  |  | 259 | } |
  |  | 260 |  |
  |  | 261 |  |
  |  | 262 |  |
  |  | 263 |  |
  |  | 264 | /\*\* |
  |  | 265 | \* Extracts the required languages from the multilingual array of Verowa |
  |  | 266 | \* |
  |  | 267 | \* @param  array  $arr\_person Reference person group array to be sent from the API. |
  |  | 268 | \* @param  string $str\_language\_code Specify the language to be returned. |
  |  | 269 | \* |
  |  | 270 | \* @return array |
  |  | 271 | \*/ |
  |  | 272 | function verowa\_wpml\_get\_language\_strings\_for\_person\_group( & $arr\_person\_group, $str\_language\_code) |
  |  | 273 | { |
  |  | 274 | $arr\_lang = array(); |
  |  | 275 | if ( 'de' === $str\_language\_code || false === key\_exists ($str\_language\_code, $arr\_person\_group['multilang'] ?? []) ) { |
  |  | 276 | $arr\_lang['name'] = $arr\_person\_group['name']; |
  |  | 277 | } else { |
  |  | 278 | $arr\_lang['name'] = $arr\_person\_group['multilang'][ $str\_language\_code ]['name'] ?? $arr\_person\_group['name']; |
  |  | 279 | } |
  |  | 280 | return $arr\_lang; |
  |  | 281 | } |
  | 233 | 282 |  |
  | 234 | 283 |  |
  | […](/browser/verowa-connect/trunk/functions/wpml.php?rev=3123647#L316) | […](/browser/verowa-connect/trunk/functions/wpml.php?rev=3201030#L365) |  |
  | 316 | 365 | } |
  | 317 | 366 |  |
  | 318 |  |  |
  | 319 |  |  |
  | 320 |  |  |
  | 321 |  |  |
  | 322 | 367 | return $arr\_ret; |
  | 323 | 368 | } |
  | […](/browser/verowa-connect/trunk/functions/wpml.php?rev=3123647#L328) | […](/browser/verowa-connect/trunk/functions/wpml.php?rev=3201030#L373) |  |
  | 328 | 373 | /\*\* |
  | 329 | 374 | \* Map the verowa languages to the WP in the multilang array from the Verowa API |
  | 330 |  | \* |
  | 331 |  | \* @param  mixed $arr\_event Reference event array to be sent from the API. |
  |  | 375 | \* The reference are altered in the function. |
  |  | 376 | \* |
  |  | 377 | \* @param  array $arr\_ver\_entity Reference event, person, persongroup or posting array to be sent from the API. |
  | 332 | 378 | \* @return void |
  | 333 | 379 | \*/ |
  | 334 |  | function verowa\_wpml\_map\_lang( &~~$arr\_event~~ ) { |
  | 335 |  | if ( verowa\_wpml\_is\_configured() && true === isset( $arr\_~~event~~['multilang'] ) ) { |
  | 336 |  | $arr\_temp\_multilang = $arr\_~~event~~['multilang']; |
  |  | 380 | function verowa\_wpml\_map\_lang( & $arr\_ver\_entity ) { |
  |  | 381 | if ( verowa\_wpml\_is\_configured() && true === isset( $arr\_ver\_entity['multilang'] ) ) { |
  |  | 382 | $arr\_temp\_multilang = $arr\_ver\_entity['multilang']; |
  | 337 | 383 | // This way we can fill the array with the correct keys. |
  | 338 |  | $arr\_~~event~~['multilang'] = array(); |
  |  | 384 | $arr\_ver\_entity['multilang'] = array(); |
  | 339 | 385 |  |
  | 340 | 386 | $arr\_mapping = verowa\_wpml\_get\_mapping(); |
  | […](/browser/verowa-connect/trunk/functions/wpml.php?rev=3123647#L342) | […](/browser/verowa-connect/trunk/functions/wpml.php?rev=3201030#L388) |  |
  | 342 | 388 | if ( true === isset( $arr\_mapping[ $str\_ver\_language\_code ] ) ) { |
  | 343 | 389 | foreach ( $arr\_mapping[ $str\_ver\_language\_code ] as $wpml\_language\_code ) { |
  | 344 |  | $arr\_~~event~~['multilang'][ $wpml\_language\_code ] = $val; |
  |  | 390 | $arr\_ver\_entity['multilang'][ $wpml\_language\_code ] = $val; |
  | 345 | 391 | } |
  | 346 | 392 | } else { |
  | 347 |  | $arr\_~~event~~['multilang'][ $str\_ver\_language\_code ] = $val; |
  |  | 393 | $arr\_ver\_entity['multilang'][ $str\_ver\_language\_code ] = $val; |
  | 348 | 394 | } |
  | 349 | 395 | } |
  | […](/browser/verowa-connect/trunk/functions/wpml.php?rev=3123647#L383) | […](/browser/verowa-connect/trunk/functions/wpml.php?rev=3201030#L429) |  |
  | 383 | 429 | } |
  | 384 | 430 |  |
  |  | 431 |  |
  |  | 432 |  |
  |  | 433 |  |
  | 385 | 434 | function verowa\_wpml\_get\_default\_language\_locale() { |
  | 386 | 435 | if ( true === verowa\_wpml\_is\_configured() ) { |
  | […](/browser/verowa-connect/trunk/functions/wpml.php?rev=3123647#L393) | […](/browser/verowa-connect/trunk/functions/wpml.php?rev=3201030#L442) |  |
  | 393 | 442 | return $str\_default\_locale; |
  | 394 | 443 | } |
  |  | 444 |  |
  |  | 445 |  |
  |  | 446 |  |
  | 395 | 447 |  |
  | 396 | 448 | /\*\* |
  | […](/browser/verowa-connect/trunk/functions/wpml.php?rev=3123647#L455) | […](/browser/verowa-connect/trunk/functions/wpml.php?rev=3201030#L507) |  |
  | 455 | 507 | if (true === verowa\_wpml\_is\_configured()) { |
  | 456 | 508 | $str\_cpt\_slug = apply\_filters( 'wpml\_get\_translated\_slug', $cpt\_slug, $str\_post\_type, $str\_language\_code ); |
  | 457 |  | $str\_custom\_post\_url = $str\_siteurl .  $str\_cpt\_slug .'/' . $ver\_id . '-' . $str\_language\_code; |
  |  | 509 | $str\_siteurl .= ( substr( $str\_siteurl, -1 ) !== '/' ) ? '/' : ''; |
  |  | 510 | $str\_custom\_post\_url = $str\_siteurl . $str\_cpt\_slug . '/' . $ver\_id . '-' . $str\_language\_code; |
  | 458 | 511 | } |
  | 459 | 512 | return $str\_custom\_post\_url; |
  | […](/browser/verowa-connect/trunk/functions/wpml.php?rev=3123647#L463) | […](/browser/verowa-connect/trunk/functions/wpml.php?rev=3201030#L516) |  |
  | 463 | 516 |  |
  | 464 | 517 |  |
  |  | 518 | /\*\* |
  |  | 519 | \* Returns the HTML code for a select element with all languages. |
  |  | 520 | \* |
  |  | 521 | \* @param array $arr\_languages Array off all languages |
  |  | 522 | \* @param string $str\_ddl\_name Name of the select element |
  |  | 523 | \* @param string $str\_value Selected value |
  |  | 524 | \* |
  |  | 525 | \* @return array<array|string> |
  |  | 526 | \*/ |
  | 465 | 527 | function verowa\_wpml\_get\_language\_ddl( $arr\_languages, $str\_ddl\_name, $str\_value = '' ) |
  | 466 | 528 | { |
* ## [verowa-connect/trunk/general/class-verowa-postings.php](/changeset/3201030/verowa-connect/trunk/general/class-verowa-postings.php "Show the changeset 3201030 restricted to verowa-connect/trunk/general/class-verowa-postings.php")

  | [r3160300](/browser/verowa-connect/trunk/general/class-verowa-postings.php?rev=3160300#L230 "Show revision 3160300 of this file in browser") | [r3201030](/browser/verowa-connect/trunk/general/class-verowa-postings.php?rev=3201030#L230 "Show revision 3201030 of this file in browser") |  |
  | --- | --- | --- |
  | 230 | 230 | $arr\_template = verowa\_get\_single\_template( $int\_template\_id ); |
  | 231 | 231 | $obj\_template = $arr\_template['de']; |
  | 232 |  |  |
  | 233 | 232 | $str\_content = $this->assembling\_html ( $arr\_ver\_posting, $obj\_template ); |
  | 234 | 233 |  |
  | […](/browser/verowa-connect/trunk/general/class-verowa-postings.php?rev=3160300#L734) | […](/browser/verowa-connect/trunk/general/class-verowa-postings.php?rev=3201030#L733) |  |
  | 734 | 733 | \*/ |
  | 735 | 734 | public function force\_update\_postings() { |
  | 736 |  | $ver\_post\_id = ~~strval( $\_GET['post\_id'] ?? ''~~ ); |
  |  | 735 | $ver\_post\_id = esc\_sql( strval( $\_GET['post\_id'] ?? '' ) ); |
  | 737 | 736 | $this->import\_postings( $ver\_post\_id ); |
  | 738 | 737 | return 0; |
  | […](/browser/verowa-connect/trunk/general/class-verowa-postings.php?rev=3160300#L801) | […](/browser/verowa-connect/trunk/general/class-verowa-postings.php?rev=3201030#L800) |  |
  | 801 | 800 | global $wpdb; |
  | 802 | 801 |  |
  | 803 |  | $str\_where = ( $post\_id > 0 ) ? '`ver\_post\_id` = ' . ~~$post\_id~~ : '`ver\_post\_id` > 0'; |
  |  | 802 | $str\_where = ( $post\_id > 0 ) ? '`ver\_post\_id` = ' . intval ($post\_id) : '`ver\_post\_id` > 0'; |
  | 804 | 803 |  |
  | 805 | 804 | $wpdb->query( |
* ## [verowa-connect/trunk/general/class-verowa-update-controller.php](/changeset/3201030/verowa-connect/trunk/general/class-verowa-update-controller.php "Show the changeset 3201030 restricted to verowa-connect/trunk/general/class-verowa-update-controller.php")

  | [r3159837](/browser/verowa-connect/trunk/general/class-verowa-update-controller.php?rev=3159837#L45 "Show revision 3159837 of this file in browser") | [r3201030](/browser/verowa-connect/trunk/general/class-verowa-update-controller.php?rev=3201030#L45 "Show revision 3201030 of this file in browser") |  |
  | --- | --- | --- |
  | 45 | 45 | private $arr\_verowa\_groups; |
  | 46 | 46 |  |
  |  | 47 | private $arr\_critical\_error; |
  |  | 48 |  |
  | 47 | 49 | /\*\* |
  | 48 | 50 | \* Table Name. |
  | […](/browser/verowa-connect/trunk/general/class-verowa-update-controller.php?rev=3159837#L57) | […](/browser/verowa-connect/trunk/general/class-verowa-update-controller.php?rev=3201030#L59) |  |
  | 57 | 59 | public function \_\_construct() { |
  | 58 | 60 | global $wpdb; |
  |  | 61 |  |
  | 59 | 62 | $this->str\_events\_tablename = $wpdb->prefix . 'verowa\_events'; |
  | 60 | 63 | verowa\_delete\_duplicate\_custom\_post(); |
  |  | 64 | $this->arr\_critical\_error = array(); |
  | 61 | 65 | set\_time\_limit( 600 ); |
  | 62 | 66 | } |
  | […](/browser/verowa-connect/trunk/general/class-verowa-update-controller.php?rev=3159837#L103) | […](/browser/verowa-connect/trunk/general/class-verowa-update-controller.php?rev=3201030#L107) |  |
  | 103 | 107 | $arr\_ret\_api\_call        = verowa\_api\_call( 'getlistsbygroup', $this->wordpress\_liste . '-e', true ); |
  | 104 | 108 | $this->arr\_verowa\_groups = $arr\_ret\_api\_call['data']; |
  | 105 |  | $this->arr\_list\_ids      = json\_decode( get\_option( 'verowa\_list\_ids' ), true ); |
  | 106 |  |  |
  | 107 |  | if ( is\_array( $this->arr\_list\_ids ) && count( $this->arr\_list\_ids ) > 0) { |
  | 108 |  | $str\_list\_ids = implode( ',', $this->arr\_list\_ids ); |
  | 109 |  | $arr\_ret\_api\_call = verowa\_api\_call( 'geteventslistmap', $str\_list\_ids . '/0', true ); |
  | 110 |  | $this->arr\_list\_ids\_for\_event = is\_array( $arr\_ret\_api\_call['data'] ) ? $arr\_ret\_api\_call['data'] : array(); |
  | 111 |  | } |
  |  | 109 | $this->get\_events\_list\_map(); |
  | 112 | 110 |  |
  | 113 | 111 | if ( true === verowa\_wpml\_is\_configured() ) { |
  | […](/browser/verowa-connect/trunk/general/class-verowa-update-controller.php?rev=3159837#L120) | […](/browser/verowa-connect/trunk/general/class-verowa-update-controller.php?rev=3201030#L118) |  |
  | 120 | 118 |  |
  | 121 | 119 | case 'single\_event': |
  | 122 |  | $this->arr\_list\_ids = json\_decode( get\_option( 'verowa\_list\_ids' ), true ); |
  | 123 |  | if ( is\_array( $this->arr\_list\_ids ) && count( $this->arr\_list\_ids ) > 0) { |
  | 124 |  | $str\_list\_ids = implode ( ',', $this->arr\_list\_ids ); |
  | 125 |  | $arr\_ret\_api\_call = verowa\_api\_call( 'geteventslistmap', $str\_list\_ids . '/' . $event\_id, true ); |
  | 126 |  | $this->arr\_list\_ids\_for\_event = is\_array( $arr\_ret\_api\_call['data'] ) ? $arr\_ret\_api\_call['data'] : array(); |
  | 127 |  | } |
  |  | 120 | $this->get\_events\_list\_map( $event\_id ); |
  | 128 | 121 | break; |
  | 129 | 122 |  |
  | 130 | 123 | case 'list\_map': |
  | 131 |  | $this->arr\_list\_ids = json\_decode( get\_option( 'verowa\_list\_ids' ), true ); |
  | 132 |  | if (is\_array( $this->arr\_list\_ids ) && count( $this->arr\_list\_ids ) > 0 ) { |
  | 133 |  | $arr\_ret\_api\_call = verowa\_api\_call ( |
  | 134 |  | 'geteventslistmap', |
  | 135 |  | implode (',', $this->arr\_list\_ids) . '/0', |
  | 136 |  | true |
  | 137 |  | ); |
  | 138 |  | $this->arr\_list\_ids\_for\_event = is\_array( $arr\_ret\_api\_call['data'] ) ? |
  | 139 |  | $arr\_ret\_api\_call['data'] : array(); |
  | 140 |  | } |
  |  | 124 | $this->get\_events\_list\_map(); |
  | 141 | 125 | break; |
  | 142 | 126 | } |
  | […](/browser/verowa-connect/trunk/general/class-verowa-update-controller.php?rev=3159837#L151) | […](/browser/verowa-connect/trunk/general/class-verowa-update-controller.php?rev=3201030#L135) |  |
  | 151 | 135 | \*/ |
  | 152 | 136 | public function update\_agenda\_filters() { |
  |  | 137 | if ( false === empty( $this->arr\_critical\_error ) ) |
  |  | 138 | return false; |
  |  | 139 |  |
  | 153 | 140 | $filter\_array = array(); |
  | 154 |  |  |
  | 155 | 141 | $dropdown\_count = 1; |
  | 156 | 142 | $nb\_dropdowns   = get\_option( 'how\_many\_verowa\_dropdowns', false ); |
  | […](/browser/verowa-connect/trunk/general/class-verowa-update-controller.php?rev=3159837#L207) | […](/browser/verowa-connect/trunk/general/class-verowa-update-controller.php?rev=3201030#L193) |  |
  | 207 | 193 | \*/ |
  | 208 | 194 | public function update\_targetgroups() { |
  |  | 195 | if ( false === empty( $this->arr\_critical\_error ) ) |
  |  | 196 | return false; |
  |  | 197 |  |
  | 209 | 198 | $arr\_ret\_api\_call = verowa\_api\_call( 'gettargetgroups', '', false ); |
  | 210 | 199 | $target\_groups    = $arr\_ret\_api\_call['data']; |
  | […](/browser/verowa-connect/trunk/general/class-verowa-update-controller.php?rev=3159837#L224) | […](/browser/verowa-connect/trunk/general/class-verowa-update-controller.php?rev=3201030#L213) |  |
  | 224 | 213 | \*/ |
  | 225 | 214 | public function update\_verowa\_events\_in\_db( $update\_event\_id = 0 ) { |
  |  | 215 | if ( false === empty( $this->arr\_critical\_error ) ) |
  |  | 216 | return false; |
  |  | 217 |  |
  | 226 | 218 | if ( $update\_event\_id > 0 ) { |
  | 227 | 219 | $this->immediate\_update\_single\_verowa\_event( $update\_event\_id ); |
  | […](/browser/verowa-connect/trunk/general/class-verowa-update-controller.php?rev=3159837#L363) | […](/browser/verowa-connect/trunk/general/class-verowa-update-controller.php?rev=3201030#L355) |  |
  | 363 | 355 | $str\_mail  = get\_site\_url(); |
  | 364 | 356 | $str\_mail .= $str\_api\_message; |
  | 365 |  | verowa\_send\_mail( VEROWA\_REPORTING\_MAIL, 'WP Update cron', $str\_mail ); |
  |  | 357 |  |
  |  | 358 | $arr\_description = array( |
  |  | 359 | 'title' => 'WP Update cron', |
  |  | 360 | 'error' => $str\_mail, |
  |  | 361 | ); |
  |  | 362 | verowa\_report\_error( 'error', $arr\_description ); |
  | 366 | 363 | } |
  | 367 | 364 | } |
  | […](/browser/verowa-connect/trunk/general/class-verowa-update-controller.php?rev=3159837#L473) | […](/browser/verowa-connect/trunk/general/class-verowa-update-controller.php?rev=3201030#L470) |  |
  | 473 | 470 | } else { |
  | 474 | 471 | // check if verowa\_event has no related post and add it if missing. |
  | 475 |  | if ( true === verowa\_wpml\_is\_configured() ){ |
  |  | 472 | if ( true === verowa\_wpml\_is\_configured() ) { |
  | 476 | 473 | verowa\_event\_wpml\_add\_wp\_post( |
  | 477 | 474 | $single\_event['event\_id'], |
  | […](/browser/verowa-connect/trunk/general/class-verowa-update-controller.php?rev=3159837#L506) | […](/browser/verowa-connect/trunk/general/class-verowa-update-controller.php?rev=3201030#L503) |  |
  | 506 | 503 | public function update\_verowa\_event\_list\_mapping() { |
  | 507 | 504 | global $wpdb; |
  |  | 505 | if ( false === empty( $this->arr\_critical\_error ) ) |
  |  | 506 | return false; |
  | 508 | 507 |  |
  | 509 | 508 | foreach ( $this->arr\_list\_ids\_for\_event as $key => $single\_mapping ) { |
  | […](/browser/verowa-connect/trunk/general/class-verowa-update-controller.php?rev=3159837#L541) | […](/browser/verowa-connect/trunk/general/class-verowa-update-controller.php?rev=3201030#L540) |  |
  | 541 | 540 | public function add\_person\_if\_related\_to\_event( $arr\_single\_event, $arr\_person\_ids, $arr\_person\_hash ) { |
  | 542 | 541 | global $wpdb; |
  |  | 542 | if ( false === empty( $this->arr\_critical\_error ) ) |
  |  | 543 | return false; |
  | 543 | 544 |  |
  | 544 | 545 | for ( $i = 1; $i <= 8; $i++ ) { |
  | […](/browser/verowa-connect/trunk/general/class-verowa-update-controller.php?rev=3159837#L568) | […](/browser/verowa-connect/trunk/general/class-verowa-update-controller.php?rev=3201030#L569) |  |
  | 568 | 569 | public function update\_verowa\_persons\_in\_db( $int\_person\_id = 0 ) |
  | 569 | 570 | { |
  |  | 571 | if ( false === empty( $this->arr\_critical\_error ) ) |
  |  | 572 | return false; |
  |  | 573 |  |
  | 570 | 574 | global $wpdb; |
  | 571 |  | $arr\_ret\_api\_call = verowa\_api\_call~~('getpersonsbyid', $int\_person\_id, true~~); |
  |  | 575 | $arr\_ret\_api\_call = verowa\_api\_call( 'getpersonsbyid', $int\_person\_id, true ); |
  | 572 | 576 | $arr\_all\_persons = $arr\_ret\_api\_call['data']; |
  | 573 | 577 |  |
  | 574 |  | $bool\_without\_detail\_page = 'on' === get\_option~~('verowa\_persons\_without\_detail\_page', false~~) ? |
  |  | 578 | $bool\_without\_detail\_page = 'on' === get\_option( 'verowa\_persons\_without\_detail\_page', false ) ? |
  | 575 | 579 | true : false; |
  | 576 | 580 |  |
  | 577 |  | if (~~is\_array ($arr\_all\_persons~~) && |
  | 578 |  | (~~200 === $arr\_ret\_api\_call['code'] || 204 === $arr\_ret\_api\_call['code'])~~) { |
  | 579 |  | if (~~count( $arr\_all\_persons ) > 0~~) { |
  | 580 |  | $arr\_data = $this->get\_person\_data~~($arr\_all\_persons~~); |
  |  | 581 | if ( is\_array( $arr\_all\_persons ) && |
  |  | 582 | ( 200 === $arr\_ret\_api\_call['code'] || 204 === $arr\_ret\_api\_call['code'] ) ) { |
  |  | 583 | if ( count( $arr\_all\_persons ) > 0 ) { |
  |  | 584 | $arr\_data = $this->get\_person\_data( $arr\_all\_persons ); |
  | 581 | 585 | $arr\_persons\_hash = $arr\_data['persons\_hash']; |
  | 582 | 586 | $arr\_persons = $arr\_data['person\_data']; |
  | 583 | 587 | $person\_ids\_in\_db = $arr\_data['person\_ids\_in\_db']; |
  | 584 |  | foreach (~~$arr\_all\_persons as $single\_person~~) |
  |  | 588 | foreach ( $arr\_all\_persons as $single\_person ) |
  | 585 | 589 | { |
  | 586 | 590 | $arr\_person\_data = key\_exists( $single\_person['person\_id'], $arr\_persons ) ? |
  | 587 | 591 | $arr\_persons[$single\_person['person\_id']] : array(); |
  | 588 |  | if (count~~($arr\_person\_data~~) > 0) |
  |  | 592 | if (count( $arr\_person\_data ) > 0) |
  | 589 | 593 | { |
  | 590 | 594 | // merge the two info-arrays together. |
  | 591 |  | $arr\_all\_person\_data = array\_merge~~($single\_person, $arr\_person\_data~~); |
  |  | 595 | $arr\_all\_person\_data = array\_merge( $single\_person, $arr\_person\_data ); |
  | 592 | 596 | } |
  | 593 | 597 | else |
  | […](/browser/verowa-connect/trunk/general/class-verowa-update-controller.php?rev=3159837#L596) | […](/browser/verowa-connect/trunk/general/class-verowa-update-controller.php?rev=3201030#L600) |  |
  | 596 | 600 | } |
  | 597 | 601 |  |
  |  | 602 | verowa\_wpml\_map\_lang( $arr\_all\_person\_data ); |
  | 598 | 603 | // Set the image displayed in the list. |
  | 599 | 604 | $arr\_all\_person\_data['images'] = $arr\_person\_data['images'] ?? array(); |
  | 600 | 605 | $arr\_all\_person\_data['web\_visibility'] = 'FULL'; |
  | 601 |  | $this->update\_or\_insert\_single\_verowa\_person~~($arr\_all\_person\_data, $person\_ids\_in\_db, $arr\_persons\_hash~~); |
  |  | 606 | $this->update\_or\_insert\_single\_verowa\_person( $arr\_all\_person\_data, $person\_ids\_in\_db, $arr\_persons\_hash ); |
  | 602 | 607 | } |
  | 603 | 608 | // All deprecated person are deleted. |
  | 604 |  | verowa\_general\_delete\_deprecated ($wpdb->prefix . 'verowa\_person'); |
  | 605 |  | $this->update\_person\_groups (); |
  | 606 |  | } |
  | 607 |  | $this->release\_persons\_after\_update ($bool\_without\_detail\_page, VEROWA\_DEBUG && 0 === count ($arr\_all\_persons)); |
  | 608 |  | } |
  | 609 |  | } |
  | 610 |  |  |
  | 611 |  |  |
  | 612 |  |  |
  | 613 |  |  |
  | 614 |  | private function get\_person\_data( & $arr\_all\_persons ) { |
  |  | 609 | verowa\_general\_delete\_deprecated( $wpdb->prefix . 'verowa\_person' ); |
  |  | 610 | $this->update\_person\_groups(); |
  |  | 611 | } |
  |  | 612 | $this->release\_persons\_after\_update( $bool\_without\_detail\_page, VEROWA\_DEBUG && 0 === count( $arr\_all\_persons ) ); |
  |  | 613 | } |
  |  | 614 | } |
  |  | 615 |  |
  |  | 616 |  |
  |  | 617 |  |
  |  | 618 |  |
  |  | 619 | /\*\* |
  |  | 620 | \* Retrieves person data from Verowa API and updates the database. |
  |  | 621 | \* |
  |  | 622 | \* @param array $arr\_all\_persons The array containing all person data. |
  |  | 623 | \* @return array An array containing the following: |
  |  | 624 | \*               - persons\_hash: An associative array with person IDs as keys and their corresponding hash values. |
  |  | 625 | \*               - person\_data: An array of all required person data. |
  |  | 626 | \*               - person\_ids\_in\_db: An array of person IDs already present in the database. |
  |  | 627 | \*/ |
  |  | 628 | private function get\_person\_data( &$arr\_all\_persons ) |
  |  | 629 | { |
  | 615 | 630 | global $wpdb; |
  | 616 | 631 | $obj\_person\_ids\_in\_db = $wpdb->get\_results( |
  | […](/browser/verowa-connect/trunk/general/class-verowa-update-controller.php?rev=3159837#L618) | […](/browser/verowa-connect/trunk/general/class-verowa-update-controller.php?rev=3201030#L633) |  |
  | 618 | 633 | ' FROM `' . $wpdb->prefix . 'verowa\_person`;' |
  | 619 | 634 | ); |
  | 620 |  | $arr\_person\_ids\_in\_db = explode( ',', $obj\_person\_ids\_in\_db[0]->person\_ids ); |
  |  | 635 |  |
  |  | 636 | $arr\_person\_ids\_in\_db = []; |
  |  | 637 | if ( isset( $obj\_person\_ids\_in\_db[0]->person\_ids ) ) |
  |  | 638 | $arr\_person\_ids\_in\_db = explode( ',', $obj\_person\_ids\_in\_db[0]->person\_ids ); |
  | 621 | 639 |  |
  | 622 | 640 | // We note down all person\_ids to compare them with those in the DB afterwards. |
  | 623 | 641 | $arr\_person\_ids\_from\_verowa = array\_column( $arr\_all\_persons, 'person\_id' ); |
  | 624 |  | $arr\_ret\_api\_call           = verowa\_get\_persondetails( $arr\_person\_ids\_from\_verowa ); |
  | 625 |  | $all\_required\_person\_data   = $arr\_ret\_api\_call['data']; |
  | 626 |  |  |
  | 627 |  | verowa\_persons\_set\_deprecated(); |
  | 628 |  |  |
  | 629 |  | $query            = 'SELECT `person\_id`, `hash`, `deprecated` FROM `' . $wpdb->prefix . 'verowa\_person`' . |
  | 630 |  | ' WHERE `person\_id` IN (' . implode( ', ', $arr\_person\_ids\_from\_verowa ) . ');'; |
  |  | 642 | $arr\_ret\_api\_call = verowa\_get\_persondetails( $arr\_person\_ids\_from\_verowa ); |
  |  | 643 | $all\_required\_person\_data = $arr\_ret\_api\_call['data']; |
  |  | 644 |  |
  |  | 645 | if ( false === in\_array( $arr\_ret\_api\_call['code'], array(200, 204) ) ) { |
  |  | 646 | $this->arr\_critical\_error[] = 'Error Error during loading of the person details'; |
  |  | 647 | } |
  |  | 648 |  |
  |  | 649 | verowa\_persons\_set\_deprecated( implode(',', $arr\_person\_ids\_from\_verowa) ); |
  |  | 650 |  |
  |  | 651 | $query = 'SELECT `person\_id`, `hash`, `deprecated` FROM `' . $wpdb->prefix . 'verowa\_person`' . |
  |  | 652 | ' WHERE `person\_id` IN (' . implode( ', ', $arr\_person\_ids\_from\_verowa ) . ');'; |
  | 631 | 653 | $arr\_persons\_hash = $wpdb->get\_results( $query, OBJECT\_K ); |
  | 632 | 654 |  |
  | […](/browser/verowa-connect/trunk/general/class-verowa-update-controller.php?rev=3159837#L645) | […](/browser/verowa-connect/trunk/general/class-verowa-update-controller.php?rev=3201030#L667) |  |
  | 645 | 667 | \* If the function is called up, the personal data has always changed. |
  | 646 | 668 | \* |
  |  | 669 | \* @param array $arr\_all\_person\_data |
  |  | 670 | \* @param array $arr\_person\_ids\_in\_db |
  |  | 671 | \* @param array $arr\_persons\_hash |
  |  | 672 | \*/ |
  |  | 673 | public function update\_or\_insert\_single\_verowa\_person( & $arr\_all\_person\_data, & $arr\_person\_ids\_in\_db, & $arr\_persons\_hash ) { |
  |  | 674 | global $wpdb; |
  |  | 675 |  |
  |  | 676 | if ( false === empty( $this->arr\_critical\_error ) ) |
  |  | 677 | return false; |
  |  | 678 |  |
  |  | 679 | $bool\_without\_detail\_page = 'on' === get\_option( 'verowa\_persons\_without\_detail\_page', false ) ? |
  |  | 680 | true : false; |
  |  | 681 |  |
  |  | 682 | $str\_person\_hash = verowa\_person\_generate\_hash( $arr\_all\_person\_data['person\_id'], $arr\_all\_person\_data ); |
  |  | 683 | // If this person already exists we update it. |
  |  | 684 | if ( in\_array( $arr\_all\_person\_data['person\_id'], $arr\_person\_ids\_in\_db ) ) { |
  |  | 685 | $is\_deprecated = filter\_var( $arr\_persons\_hash[ $arr\_all\_person\_data['person\_id'] ]->deprecated ?? false, FILTER\_VALIDATE\_BOOLEAN ); |
  |  | 686 | // deprecated entries will also be updated until the new update function is available. |
  |  | 687 | if ( $arr\_persons\_hash[ $arr\_all\_person\_data['person\_id'] ]->hash !== $str\_person\_hash |
  |  | 688 | || true === $is\_deprecated ) { |
  |  | 689 | verowa\_person\_db\_update( $arr\_all\_person\_data, 'FULL', $str\_person\_hash ); |
  |  | 690 | } elseif ( false === $bool\_without\_detail\_page ) { |
  |  | 691 | $i\_template\_id = get\_option( 'verowa\_default\_persondetails\_template', 0 ); |
  |  | 692 | $arr\_templates = verowa\_get\_single\_template( $i\_template\_id ); |
  |  | 693 | verowa\_person\_add\_wp\_post( $arr\_all\_person\_data['person\_id'], $arr\_all\_person\_data, $arr\_templates ); |
  |  | 694 | $wpdb->update( |
  |  | 695 | $wpdb->prefix . 'verowa\_person', |
  |  | 696 | array( |
  |  | 697 | 'deprecated' => 0, |
  |  | 698 | ), |
  |  | 699 | array( |
  |  | 700 | 'person\_id' => $arr\_all\_person\_data['person\_id'], |
  |  | 701 | ), |
  |  | 702 | array( '%d' ), |
  |  | 703 | array( '%d' ), |
  |  | 704 | ); |
  |  | 705 | } else { |
  |  | 706 | $i\_template\_id = get\_option( 'verowa\_default\_persondetails\_template', 0 ); |
  |  | 707 | $arr\_templates = verowa\_get\_single\_template( $i\_template\_id ); |
  |  | 708 | verowa\_person\_add\_wp\_post( $arr\_all\_person\_data['person\_id'], $arr\_all\_person\_data, $arr\_templates); |
  |  | 709 |  |
  |  | 710 | // prevent delete post. |
  |  | 711 | $wpdb->update( |
  |  | 712 | $wpdb->prefix . 'verowa\_person', |
  |  | 713 | array( |
  |  | 714 | 'deprecated' => 0, |
  |  | 715 | ), |
  |  | 716 | array( |
  |  | 717 | 'person\_id' => $arr\_all\_person\_data['person\_id'], |
  |  | 718 | ), |
  |  | 719 | array( '%d' ), |
  |  | 720 | array( '%d' ) |
  |  | 721 | ); |
  |  | 722 | } |
  |  | 723 | } else { |
  |  | 724 | verowa\_person\_db\_insert( $arr\_all\_person\_data, 'FULL', $str\_person\_hash ); |
  |  | 725 | } |
  |  | 726 | } |
  |  | 727 |  |
  |  | 728 |  |
  |  | 729 |  |
  |  | 730 |  |
  |  | 731 | /\*\* |
  |  | 732 | \* Releases the persons after the update. |
  | 647 | 733 | \* |
  | 648 |  | \*/ |
  | 649 |  | public function update\_or\_insert\_single\_verowa\_person( & $arr\_all\_person\_data, & $arr\_person\_ids\_in\_db, & $arr\_persons\_hash ) { |
  | 650 |  | global $wpdb; |
  | 651 |  | $bool\_without\_detail\_page = 'on' === get\_option( 'verowa\_persons\_without\_detail\_page', false ) ? |
  | 652 |  | true : false; |
  | 653 |  |  |
  | 654 |  | $str\_person\_hash = verowa\_person\_generate\_hash( $arr\_all\_person\_data['person\_id'], $arr\_all\_person\_data ); |
  | 655 |  | // If this person already exists we update it. |
  | 656 |  | if ( in\_array( $arr\_all\_person\_data['person\_id'], $arr\_person\_ids\_in\_db ) ) { |
  | 657 |  | $is\_deprecated = filter\_var( $arr\_persons\_hash[ $arr\_all\_person\_data['person\_id'] ]->deprecated ?? false, FILTER\_VALIDATE\_BOOLEAN ); |
  | 658 |  | // deprecated entries will also be updated until the new update function is available. |
  | 659 |  | if ( $arr\_persons\_hash[ $arr\_all\_person\_data['person\_id'] ]->hash !== $str\_person\_hash |
  | 660 |  | || true === $is\_deprecated ) { |
  | 661 |  | verowa\_person\_db\_update( $arr\_all\_person\_data, 'FULL', $str\_person\_hash ); |
  | 662 |  | } elseif ( false === $bool\_without\_detail\_page ) { |
  | 663 |  | verowa\_person\_add\_wp\_post( $arr\_all\_person\_data['person\_id'], $arr\_all\_person\_data ); |
  | 664 |  | $wpdb->update( |
  | 665 |  | $wpdb->prefix . 'verowa\_person', |
  | 666 |  | array( |
  | 667 |  | 'deprecated' => 0, |
  | 668 |  | ), |
  | 669 |  | array( |
  | 670 |  | 'person\_id' => $arr\_all\_person\_data['person\_id'], |
  | 671 |  | ), |
  | 672 |  | array( '%d' ), |
  | 673 |  | array( '%d' ), |
  | 674 |  | ); |
  | 675 |  | } else { |
  | 676 |  | // prevent delete post. |
  | 677 |  | verowa\_person\_add\_wp\_post( $arr\_all\_person\_data['person\_id'], $arr\_all\_person\_data ); |
  | 678 |  | $wpdb->update( |
  | 679 |  | $wpdb->prefix . 'verowa\_person', |
  | 680 |  | array( |
  | 681 |  | 'deprecated' => 0, |
  | 682 |  | ), |
  | 683 |  | array( |
  | 684 |  | 'person\_id' => $arr\_all\_person\_data['person\_id'], |
  | 685 |  | ), |
  | 686 |  | array( '%d' ), |
  | 687 |  | array( '%d' ) |
  | 688 |  | ); |
  | 689 |  | } |
  | 690 |  | } else { |
  | 691 |  | verowa\_person\_db\_insert( $arr\_all\_person\_data, 'FULL', $str\_person\_hash ); |
  | 692 |  | } |
  | 693 |  | } |
  | 694 |  |  |
  | 695 |  |  |
  | 696 |  |  |
  | 697 |  |  |
  | 698 |  | private function release\_persons\_after\_update( $bool\_without\_detail\_page, $bool\_send\_error\_mail ){ |
  | 699 |  | if ( $bool\_send\_error\_mail ) { |
  | 700 |  | $str\_mail  = 'Es wurden keine Personen von der API übertragen<br />'; |
  | 701 |  | $str\_mail .= get\_site\_url(); |
  | 702 |  | verowa\_send\_mail( VEROWA\_REPORTING\_MAIL, 'WP Update cron', $str\_mail ); |
  | 703 |  | } |
  | 704 |  |  |
  | 705 |  | if ( true === $bool\_without\_detail\_page ) { |
  | 706 |  | // flush persons posts in DB. |
  | 707 |  | verowa\_person\_db\_flush\_posts(); |
  | 708 |  | } |
  | 709 |  |  |
  | 710 |  | do\_action( |
  | 711 |  | 'verowa\_purge\_shortcode\_cache', |
  | 712 |  | array( |
  | 713 |  | 'verowa\_person', |
  | 714 |  | 'verowa\_personen', |
  | 715 |  | 'verowa\_event\_list', |
  | 716 |  | ) |
  |  | 734 | \* @param bool $bool\_without\_detail\_page |
  |  | 735 | \* @param bool $bool\_send\_error\_mail |
  |  | 736 | \*/ |
  |  | 737 | private function release\_persons\_after\_update( $bool\_without\_detail\_page, $bool\_send\_error\_mail ){ |
  |  | 738 | if ( $bool\_send\_error\_mail ) { |
  |  | 739 | $str\_mail  = 'Es wurden keine Personen von der API übertragen<br />'; |
  |  | 740 | $str\_mail .= get\_site\_url(); |
  |  | 741 | $arr\_description = array( |
  |  | 742 | 'title' => 'WP Update cron', |
  |  | 743 | 'error' => $str\_mail, |
  | 717 | 744 | ); |
  | 718 |  | } |
  | 719 |  |  |
  | 720 |  |  |
  | 721 |  |  |
  | 722 |  |  |
  |  | 745 | verowa\_report\_error( 'error', $arr\_description ); |
  |  | 746 | } |
  |  | 747 |  |
  |  | 748 | if ( true === $bool\_without\_detail\_page ) { |
  |  | 749 | // flush persons posts in DB. |
  |  | 750 | verowa\_person\_db\_flush\_posts(); |
  |  | 751 | } |
  |  | 752 |  |
  |  | 753 | do\_action( |
  |  | 754 | 'verowa\_purge\_shortcode\_cache', |
  |  | 755 | array( |
  |  | 756 | 'verowa\_person', |
  |  | 757 | 'verowa\_personen', |
  |  | 758 | 'verowa\_event\_list', |
  |  | 759 | ) |
  |  | 760 | ); |
  |  | 761 | } |
  |  | 762 |  |
  |  | 763 |  |
  |  | 764 |  |
  |  | 765 |  |
  |  | 766 | /\*\* |
  |  | 767 | \* Update the person groups from Verowa. |
  |  | 768 | \*/ |
  | 723 | 769 | private function update\_person\_groups() { |
  | 724 | 770 | global $wpdb; |
  | […](/browser/verowa-connect/trunk/general/class-verowa-update-controller.php?rev=3159837#L758) | […](/browser/verowa-connect/trunk/general/class-verowa-update-controller.php?rev=3201030#L804) |  |
  | 758 | 804 | } |
  | 759 | 805 | } |
  | 760 |  |  |
  |  | 806 | verowa\_wpml\_map\_lang( $single\_group ); |
  | 761 | 807 | $str\_person\_ids = ';' . implode( ';', $arr\_person\_ids ) . ';'; |
  | 762 | 808 | $arr\_content    = array( |
  | […](/browser/verowa-connect/trunk/general/class-verowa-update-controller.php?rev=3159837#L764) | […](/browser/verowa-connect/trunk/general/class-verowa-update-controller.php?rev=3201030#L810) |  |
  | 764 | 810 | 'public\_target' => $single\_group['public\_target'] ?? '', |
  | 765 | 811 | 'short\_name'    => $single\_group['short\_name'] ?? '', |
  |  | 812 | 'multilang'     => $single\_group['multilang'] ?? [], |
  | 766 | 813 | ); |
  | 767 | 814 | $str\_content    = wp\_json\_encode( $arr\_content ) . 'pid=' . ( $single\_group['parent\_id'] ?? 0 ); |
  | […](/browser/verowa-connect/trunk/general/class-verowa-update-controller.php?rev=3159837#L898) | […](/browser/verowa-connect/trunk/general/class-verowa-update-controller.php?rev=3201030#L945) |  |
  | 898 | 945 | public function checks\_after\_update() { |
  | 899 | 946 | global $wpdb; |
  |  | 947 |  |
  |  | 948 | if ( false === empty( $this->arr\_critical\_error ) ) { |
  |  | 949 | $arr\_description = array( |
  |  | 950 | 'title' => 'WP Update cron arr\_critical\_error', |
  |  | 951 | 'error' => implode( PHP\_EOL, $this->arr\_critical\_error ), |
  |  | 952 | ); |
  |  | 953 | verowa\_report\_error( 'error', $arr\_description ); |
  |  | 954 | return false; |
  |  | 955 | } |
  |  | 956 |  |
  | 900 | 957 | $str\_mail           = ''; |
  | 901 | 958 | $last\_update\_checks = get\_option( 'verowa\_connect\_last\_update\_checks', 0 ); |
  | 902 |  | // only check one a day. |
  |  | 959 | // only check once a day. |
  | 903 | 960 | $str\_check\_time = time() - ( 24 \* 60 \* 60 ); |
  | 904 | 961 | if ( $last\_update\_checks < $str\_check\_time ) { |
  | […](/browser/verowa-connect/trunk/general/class-verowa-update-controller.php?rev=3159837#L907) | […](/browser/verowa-connect/trunk/general/class-verowa-update-controller.php?rev=3201030#L964) |  |
  | 907 | 964 | // Check whether there are the same. |
  | 908 | 965 | // number of posts with the type 'verowa\_event' and records in the table "verowa\_events". |
  | 909 |  | if ( $arr\_counts['int\_count\_event\_posts'] !== $arr\_counts['int\_verowa\_events'] ) { |
  |  | 966 | if ( false == verowa\_wpml\_is\_configured() && $arr\_counts['int\_count\_event\_posts'] !== $arr\_counts['int\_verowa\_events'] ) { |
  | 910 | 967 | $str\_mail .= 'Anzahl Posts: ' . $arr\_counts['int\_count\_event\_posts'] . ' / ' . |
  | 911 | 968 | 'Anzahl Records in verowa\_events ' . $arr\_counts['int\_verowa\_events'] . PHP\_EOL; |
  | […](/browser/verowa-connect/trunk/general/class-verowa-update-controller.php?rev=3159837#L915) | […](/browser/verowa-connect/trunk/general/class-verowa-update-controller.php?rev=3201030#L972) |  |
  | 915 | 972 | // number of posts with the type 'verowa\_person' and records in the table "verowa\_persons". |
  | 916 | 973 | $persons\_without\_detail\_page = get\_option( 'verowa\_persons\_without\_detail\_page', false ); |
  | 917 |  | if ( false === $persons\_without\_detail\_page && |
  |  | 974 | if ( false == verowa\_wpml\_is\_configured() && false === $persons\_without\_detail\_page && |
  | 918 | 975 | $arr\_counts['int\_count\_person\_posts'] !== $arr\_counts['int\_verowa\_persons'] ) { |
  | 919 | 976 | $str\_mail .= 'Anzahl Posts: ' . $arr\_counts['int\_count\_person\_posts'] . ' / ' . |
  | […](/browser/verowa-connect/trunk/general/class-verowa-update-controller.php?rev=3159837#L979) | […](/browser/verowa-connect/trunk/general/class-verowa-update-controller.php?rev=3201030#L1036) |  |
  | 979 | 1036 | if ( '' !== $str\_mail ) { |
  | 980 | 1037 | $str\_mail = get\_option( 'siteurl', '' ) . PHP\_EOL . $str\_mail; |
  | 981 |  | // TODO: Umschreiben auf verowa\_send\_mail |
  | 982 |  | mail( VEROWA\_REPORTING\_MAIL, 'Test nach Update', $str\_mail ); |
  |  | 1038 | $arr\_description = array( |
  |  | 1039 | 'title' => 'Test nach Update', |
  |  | 1040 | 'error' => $str\_mail, |
  |  | 1041 | ); |
  |  | 1042 | verowa\_report\_error( 'error', $arr\_description ) ; |
  | 983 | 1043 | } |
  | 984 | 1044 |  |
  | […](/browser/verowa-connect/trunk/general/class-verowa-update-controller.php?rev=3159837#L1008) | […](/browser/verowa-connect/trunk/general/class-verowa-update-controller.php?rev=3201030#L1068) |  |
  | 1008 | 1068 |  |
  | 1009 | 1069 | update\_option( 'verowa\_connect\_last\_update\_checks', time() ); |
  |  | 1070 | } |
  |  | 1071 | } |
  |  | 1072 |  |
  |  | 1073 |  |
  |  | 1074 |  |
  |  | 1075 | public function get\_events\_list\_map( $i\_event\_id = 0 ) { |
  |  | 1076 | $arr\_list\_ids = json\_decode( get\_option( 'verowa\_list\_ids' ), true ); |
  |  | 1077 |  |
  |  | 1078 | if ( is\_array( $arr\_list\_ids ) && count( $arr\_list\_ids ) > 0) { |
  |  | 1079 | $str\_list\_ids = implode( ',', $arr\_list\_ids ); |
  |  | 1080 | $arr\_ret\_api\_call = verowa\_api\_call( 'geteventslistmap', $str\_list\_ids . '/' . $i\_event\_id, true ); |
  |  | 1081 |  |
  |  | 1082 | if ( true === in\_array( $arr\_ret\_api\_call['code'], array( 200, 204 ) ) && |
  |  | 1083 | is\_array( $arr\_ret\_api\_call['data'] ) ) { |
  |  | 1084 | $this->arr\_list\_ids\_for\_event = $arr\_ret\_api\_call['data']; |
  |  | 1085 | } else { |
  |  | 1086 | $this->arr\_critical\_error[] = 'geteventslistmap api call failed.'; |
  |  | 1087 | } |
  | 1010 | 1088 | } |
  | 1011 | 1089 | } |
  | […](/browser/verowa-connect/trunk/general/class-verowa-update-controller.php?rev=3159837#L1147) | […](/browser/verowa-connect/trunk/general/class-verowa-update-controller.php?rev=3201030#L1225) |  |
  | 1147 | 1225 | $str\_query   = 'SELECT table\_schema, table\_name, index\_name, column\_name ' . |
  | 1148 | 1226 | 'FROM information\_schema.statistics ' . |
  | 1149 |  | 'WHERE table\_schema = "' . ~~$wpdb->dbname~~ . '" ' . |
  |  | 1227 | 'WHERE table\_schema = "' . DB\_NAME . '" ' . |
  | 1150 | 1228 | 'AND table\_name = "' . $wpdb->prefix . 'verowa\_events" AND index\_name = "search\_content"'; |
  | 1151 | 1229 | $arr\_indexes = $wpdb->get\_results( $str\_query ); |
* ## [verowa-connect/trunk/general/custom-post-action-filters.php](/changeset/3201030/verowa-connect/trunk/general/custom-post-action-filters.php "Show the changeset 3201030 restricted to verowa-connect/trunk/general/custom-post-action-filters.php")

  | [r3159837](/browser/verowa-connect/trunk/general/custom-post-action-filters.php?rev=3159837#L27 "Show revision 3159837 of this file in browser") | [r3201030](/browser/verowa-connect/trunk/general/custom-post-action-filters.php?rev=3201030#L27 "Show revision 3201030 of this file in browser") |  |
  | --- | --- | --- |
  | 27 | 27 | add\_action( 'wp\_head', 'verowa\_hook\_add\_metatags' ); |
  | 28 | 28 | add\_action( 'parse\_request', 'verowa\_parse\_request\_update\_custom\_post\_if\_deprecated' ); |
  |  | 29 | // If the person is called via the GET parameter. |
  |  | 30 | // Function is actually deprecated because Pretty Permalinks are now available. |
  |  | 31 |  |
  |  | 32 | add\_action( 'init', 'retrieve\_person\_get' ); |
  | 29 | 33 | add\_action( 'template\_redirect', 'verowa\_custom\_post\_redirect' ); |
  | 30 | 34 |  |
  | […](/browser/verowa-connect/trunk/general/custom-post-action-filters.php?rev=3159837#L249) | […](/browser/verowa-connect/trunk/general/custom-post-action-filters.php?rev=3201030#L253) |  |
  | 249 | 253 | echo '<!-- VC --><meta property="og:url"       content="' . $str\_siteurl . $\_SERVER['REQUEST\_URI'] . '" />' . PHP\_EOL . |
  | 250 | 254 | '<meta property="og:type"        content="article" />' . PHP\_EOL . |
  | 251 |  | '<meta property="og:title"       content="' . ~~($arr\_event\_content['title'] ?? ''~~) . '" />' . PHP\_EOL . |
  | 252 |  | '<meta property="og:description" content="' . ~~$str\_description~~ . '" />' . PHP\_EOL . |
  | 253 |  | '<meta property="og:image"       content="' . ~~($arr\_event\_content['image\_url'] ?? ''~~) . '" />' . PHP\_EOL; |
  |  | 255 | '<meta property="og:title"       content="' . esc\_html( $arr\_event\_content['title'] ?? '' ) . '" />' . PHP\_EOL . |
  |  | 256 | '<meta property="og:description" content="' . esc\_html( $str\_description ) . '" />' . PHP\_EOL . |
  |  | 257 | '<meta property="og:image"       content="' . esc\_html( $arr\_event\_content['image\_url'] ?? '' ) . '" />' . PHP\_EOL; |
  | 254 | 258 | } |
  | 255 | 259 |  |
  | […](/browser/verowa-connect/trunk/general/custom-post-action-filters.php?rev=3159837#L295) | […](/browser/verowa-connect/trunk/general/custom-post-action-filters.php?rev=3201030#L299) |  |
  | 295 | 299 |  |
  | 296 | 300 | if ( true === $is\_deprecated && $int\_post\_id > 0 ) { |
  | 297 |  | $arr\_translations            = verowa\_wpml\_get\_translations( $int\_post\_id ); |
  |  | 301 | $arr\_translations            = verowa\_wpml\_get\_translations( $int\_post\_id, 'post\_verowa\_event' ); |
  | 298 | 302 | $arr\_event                   = json\_decode( $arr\_ret['content'], true ); |
  | 299 | 303 | $int\_eventdetail\_template\_id = get\_option( 'verowa\_default\_eventdetails\_template', 0 ); |
  | […](/browser/verowa-connect/trunk/general/custom-post-action-filters.php?rev=3159837#L329) | […](/browser/verowa-connect/trunk/general/custom-post-action-filters.php?rev=3201030#L333) |  |
  | 329 | 333 |  |
  | 330 | 334 | if ( key\_exists( 'post\_type', $query->query\_vars ?? array() ) && 'verowa\_person' === $query->query\_vars['post\_type'] ) { |
  | 331 |  | $int\_person\_id = intval( $query->query\_vars['verowa\_person'] ?? 0 ); |
  | 332 |  | if ( $int\_person\_id > 0 ) { |
  |  | 335 | // z.B. {person\_id}-{language\_code}. |
  |  | 336 | $arr\_verowa\_person = explode( '-', $query->query\_vars['verowa\_person'] ?? '' ); |
  |  | 337 | $i\_person\_id = intval( $arr\_verowa\_person[0] ?? 0 ); |
  |  | 338 | if ( $i\_person\_id > 0 ) { |
  | 333 | 339 | $str\_query = 'SELECT \* FROM `' . $wpdb->prefix . 'verowa\_person` ' . |
  | 334 |  | 'WHERE `person\_id` = ' . $i~~nt~~\_person\_id; |
  |  | 340 | 'WHERE `person\_id` = ' . $i\_person\_id; |
  | 335 | 341 | $arr\_ret = $wpdb->get\_results( $str\_query, ARRAY\_A )[0] ?? array(); |
  | 336 | 342 | $int\_post\_id = $arr\_ret['post\_id'] ?? 0; |
  | 337 | 343 | $is\_deprecated = filter\_var( $arr\_ret['deprecated\_content'] ?? false, FILTER\_VALIDATE\_BOOLEAN ); |
  | 338 | 344 | if ( true === $is\_deprecated && $int\_post\_id > 0 ) { |
  |  | 345 | $arr\_translations = verowa\_wpml\_get\_translations( $int\_post\_id, 'post\_verowa\_person' ); |
  | 339 | 346 | $arr\_person = json\_decode( $arr\_ret['content'], true ); |
  | 340 |  | $arr\_new\_content = show\_a\_person\_from\_verowa\_detail( $arr\_person ); |
  |  | 347 |  |
  |  | 348 | $arr\_options = array( |
  |  | 349 | 'b\_is\_detail\_page' => true, |
  |  | 350 | 'b\_is\_wpml\_configured' => verowa\_wpml\_is\_configured(), |
  |  | 351 | ); |
  |  | 352 | $arr\_ret\_new\_content = verowa\_person\_assembling\_html( $arr\_person, |
  |  | 353 | $obj\_template, 'all', 'pr', $arr\_options ); |
  | 341 | 354 |  |
  | 342 | 355 | $arr\_title = array(); |
  | […](/browser/verowa-connect/trunk/general/custom-post-action-filters.php?rev=3159837#L352) | […](/browser/verowa-connect/trunk/general/custom-post-action-filters.php?rev=3201030#L365) |  |
  | 352 | 365 | $str\_title = implode( ' ', $arr\_title ); |
  | 353 | 366 |  |
  | 354 |  |  |
  | 355 |  | $curr\_language\_code = verowa\_wpml\_get\_current\_language(); |
  | 356 |  | $str\_content = $arr\_new\_content[ $curr\_language\_code ]['html']; |
  | 357 |  |  |
  | 358 |  | $arr\_post = array( |
  | 359 |  | 'ID' => intval( $int\_post\_id ?? 0 ), |
  | 360 |  | 'post\_title' => $str\_title, |
  | 361 |  | 'post\_content' => $str\_content, |
  | 362 |  | ); |
  | 363 |  |  |
  | 364 |  | verowa\_general\_update\_custom\_post( $arr\_post, '', $arr\_new\_content[ $curr\_language\_code ]['head'] ); |
  |  | 367 | foreach ( $arr\_ret\_new\_content as $str\_lang\_code => $arr\_new\_content ) { |
  |  | 368 | $str\_content = $arr\_new\_content[ $str\_lang\_code ]['html']; |
  |  | 369 |  |
  |  | 370 | $arr\_post = array( |
  |  | 371 | 'ID' => intval($arr\_translations[ $str\_lang\_code ]->element\_id ?? 0), |
  |  | 372 | 'post\_title' => $str\_title, |
  |  | 373 | 'post\_content' => $str\_content, |
  |  | 374 | ); |
  |  | 375 |  |
  |  | 376 | verowa\_general\_update\_custom\_post( $arr\_post, '', $arr\_new\_content[ $str\_lang\_code ]['head'] ); |
  |  | 377 | } |
  |  | 378 |  |
  | 365 | 379 | $wpdb->update( |
  | 366 | 380 | $wpdb->prefix . 'verowa\_person', |
  | […](/browser/verowa-connect/trunk/general/custom-post-action-filters.php?rev=3159837#L369) | […](/browser/verowa-connect/trunk/general/custom-post-action-filters.php?rev=3201030#L383) |  |
  | 369 | 383 | ), |
  | 370 | 384 | array( |
  | 371 |  | 'person\_id' => $i~~nt~~\_person\_id, |
  |  | 385 | 'person\_id' => $i\_person\_id, |
  | 372 | 386 | ), |
  | 373 | 387 | array( '%d' ), |
  | […](/browser/verowa-connect/trunk/general/custom-post-action-filters.php?rev=3159837#L430) | […](/browser/verowa-connect/trunk/general/custom-post-action-filters.php?rev=3201030#L444) |  |
  | 430 | 444 |  |
  | 431 | 445 |  |
  |  | 446 |  |
  | 432 | 447 | /\*\* |
  | 433 | 448 | \* ... |
  | […](/browser/verowa-connect/trunk/general/custom-post-action-filters.php?rev=3159837#L445) | […](/browser/verowa-connect/trunk/general/custom-post-action-filters.php?rev=3201030#L460) |  |
  | 445 | 460 | } |
  | 446 | 461 | } |
  |  | 462 |  |
  |  | 463 |  |
  |  | 464 |  |
  |  | 465 |  |
  |  | 466 | /\*\* |
  |  | 467 | \* Retrieve and redirect to the person's page. |
  |  | 468 | \* |
  |  | 469 | \* This function is a REST API callback that handles GET requests to the "retrieve\_person" endpoint. |
  |  | 470 | \* It checks if the "person" parameter is set in the GET request and redirects the user to a specific URL |
  |  | 471 | \* with the "person" parameter included. |
  |  | 472 | \* |
  |  | 473 | \* @return void |
  |  | 474 | \*/ |
  |  | 475 | function retrieve\_person\_get() { |
  |  | 476 | if ( isset( $\_GET['person'] ) ) { |
  |  | 477 | $location = get\_bloginfo( 'url' ) . '/person/' . $\_GET['person'] . '/'; |
  |  | 478 | wp\_redirect( $location, 301 ); |
  |  | 479 | exit; |
  |  | 480 | } |
  |  | 481 | } |
* ## [verowa-connect/trunk/general/rest-routes.php](/changeset/3201030/verowa-connect/trunk/general/rest-routes.php "Show the changeset 3201030 restricted to verowa-connect/trunk/general/rest-routes.php")

  | [r3159837](/browser/verowa-connect/trunk/general/rest-routes.php?rev=3159837#L11 "Show revision 3159837 of this file in browser") | [r3201030](/browser/verowa-connect/trunk/general/rest-routes.php?rev=3201030#L11 "Show revision 3201030 of this file in browser") |  |
  | --- | --- | --- |
  | 11 | 11 |  |
  | 12 | 12 | /\*\* |
  | 13 |  | \* ~~Dieser Rest-Wrapper liefert uns den Inhalt für die Event-Details in der Event-Liste~~. |
  | 14 |  | \* F~~ür die Listendarstellung wird zuerst per REST-Query mal die grobe Liste abgeholt; erst danach, wenn di~~e |
  | 15 |  | \* ~~Seite dargestellt ist, holen wir per JS zu jedem einzelnen Event auch noch die Details aus Verowa~~. |
  | 16 |  | \* W~~ir stellen den Request per jQuery nicht direkt an die Verowa-API, weil das den API Key verraten würde~~. |
  |  | 13 | \* This rest wrapper provides us with the content for the event details in the event list. |
  |  | 14 | \* For the list display, the rough list is first retrieved via REST query; only then, when the |
  |  | 15 | \* page is displayed, we use JS to retrieve the details from Verowa for each individual event. |
  |  | 16 | \* We do not make the request directly to the Verowa API via jQuery because this would reveal the API key. |
  | 17 | 17 | \*/ |
  | 18 | 18 |  |
  | […](/browser/verowa-connect/trunk/general/rest-routes.php?rev=3159837#L96) | […](/browser/verowa-connect/trunk/general/rest-routes.php?rev=3201030#L96) |  |
  | 96 | 96 | $arr\_user\_data     = verowa\_get\_user\_data( $str\_session\_key ); |
  | 97 | 97 |  |
  | 98 |  | $arr\_user\_data['verowa\_agenda\_current\_batch']           = ~~$data['current\_batch']~~; |
  |  | 98 | $arr\_user\_data['verowa\_agenda\_current\_batch']           = intval( $data['current\_batch'] ); |
  | 99 | 99 | $arr\_user\_data['verowa\_agenda\_filter']                  = array(); |
  | 100 |  | $arr\_user\_data['verowa\_agenda\_filter']['search\_string'] = ~~$str\_search\_string~~; |
  | 101 |  | $arr\_user\_data['verowa\_agenda\_filter']['arr\_list\_ids']  = ~~$arr\_list\_ids~~; |
  |  | 100 | $arr\_user\_data['verowa\_agenda\_filter']['search\_string'] = esc\_sql( $str\_search\_string ); |
  |  | 101 | $arr\_user\_data['verowa\_agenda\_filter']['arr\_list\_ids']  = esc\_sql( $arr\_list\_ids ); |
  | 102 | 102 |  |
  | 103 | 103 | if ( strlen( $str\_date8 ) > 0 ) { |
  | 104 |  | $arr\_user\_data['verowa\_agenda\_filter']['date8\_displays\_from'] = ~~$str\_date8~~; |
  |  | 104 | $arr\_user\_data['verowa\_agenda\_filter']['date8\_displays\_from'] = esc\_sql( $str\_date8 ); |
  | 105 | 105 |  |
  | 106 | 106 | $str\_date\_filter = substr( $str\_date8, 0, 4 ) . '-' . substr( $str\_date8, 4, 2 ) . '-' . |
  | […](/browser/verowa-connect/trunk/general/rest-routes.php?rev=3159837#L233) | […](/browser/verowa-connect/trunk/general/rest-routes.php?rev=3201030#L233) |  |
  | 233 | 233 | function force\_update\_single\_event() { |
  | 234 | 234 | $obj\_update = new Verowa\_Update\_Controller(); |
  | 235 |  | $obj\_update->init( 'single\_event', $\_GET['id'] ?? 0 ); |
  | 236 |  | $obj\_update->update\_verowa\_events\_in\_db( $\_GET['id'] ?? 0 ); |
  |  | 235 | $i\_event\_id = intval( $\_GET['id'] ?? 0 ); |
  |  | 236 | $obj\_update->init( 'single\_event', $i\_event\_id ); |
  |  | 237 | $obj\_update->update\_verowa\_events\_in\_db( $i\_event\_id ); |
  | 237 | 238 |  |
  | 238 | 239 | return 0; // 0 = OK. |
  | […](/browser/verowa-connect/trunk/general/rest-routes.php?rev=3159837#L264) | […](/browser/verowa-connect/trunk/general/rest-routes.php?rev=3201030#L265) |  |
  | 264 | 265 | function force\_update\_single\_person() { |
  | 265 | 266 | $obj\_update = new Verowa\_Update\_Controller(); |
  | 266 |  | $obj\_update->init( 'single\_person', $\_GET['id'] ?? 0 ); |
  | 267 |  | $obj\_update->update\_verowa\_persons\_in\_db( $\_GET['id'] ?? 0 ); |
  |  | 267 | $i\_person\_id = intval( $\_GET['id'] ?? 0 ); |
  |  | 268 | $obj\_update->init( 'single\_person', $i\_person\_id ); |
  |  | 269 | $obj\_update->update\_verowa\_persons\_in\_db( $i\_person\_id ); |
  | 268 | 270 |  |
  | 269 | 271 | return 0; // 0 = OK |
* ## [verowa-connect/trunk/js/verowa-agenda.js](/changeset/3201030/verowa-connect/trunk/js/verowa-agenda.js "Show the changeset 3201030 restricted to verowa-connect/trunk/js/verowa-agenda.js")

  | [r3102738](/browser/verowa-connect/trunk/js/verowa-agenda.js?rev=3102738#L190 "Show revision 3102738 of this file in browser") | [r3201030](/browser/verowa-connect/trunk/js/verowa-agenda.js?rev=3201030#L190 "Show revision 3201030 of this file in browser") |  |
  | --- | --- | --- |
  | 190 | 190 |  |
  | 191 | 191 | // No results? |
  | 192 |  | if (jQuery(".event\_list\_dynamic\_agenda > ~~div~~").length == 0) { |
  |  | 192 | if (jQuery(".event\_list\_dynamic\_agenda > \*").length == 0) { |
  | 193 | 193 | jQuery('#no-events-box').show(); |
  | 194 | 194 | } else { |
* ## [verowa-connect/trunk/js/verowa-agenda.min.js](/changeset/3201030/verowa-connect/trunk/js/verowa-agenda.min.js "Show the changeset 3201030 restricted to verowa-connect/trunk/js/verowa-agenda.min.js")

  | [r3102738](/browser/verowa-connect/trunk/js/verowa-agenda.min.js?rev=3102738#L1 "Show revision 3102738 of this file in browser") | [r3201030](/browser/verowa-connect/trunk/js/verowa-agenda.min.js?rev=3201030#L1 "Show revision 3201030 of this file in browser") |  |
  | --- | --- | --- |
  | 1 |  | function event\_handler\_detail\_link\_clickt(n){n.stopPropagation()}function datepicker\_to\_technical\_date(){var t="",i,n;return document.getElementById("verowa\_connect\_datepicker")!=null&&(i=document.getElementById("verowa\_connect\_datepicker").value,n=i.split("."),n=n.reverse(),t=n.join("")),t}function load\_agenda\_events(n){jQuery("#infinite-scroll-loader").show();n&&(g\_current\_batch=1,jQuery(".event\_list\_dynamic\_agenda").html(""),g\_has\_further\_results=!0);var r=datepicker\_to\_technical\_date(),t={date:r,arr\_list\_ids:[],search\_string:jQuery("#vc-agenda-search-input").val()??"",wpml\_language\_code:jQuery("#wpml-language-code").val()};let i=parseInt(jQuery("#verowa-atts-list-id").val());isNaN(i)||0===i||t.arr\_list\_ids.push(i);jQuery("#verowa\_event\_filters .list\_filter a.selected").each(function(n,i){jQuery(i).attr("data-filter-value")!=""&&t.arr\_list\_ids.push(parseInt(jQuery(i).attr("data-filter-value").split("-")[1]))});jQuery.ajax({url:verowa\_L10n\_agenda.BASE\_URL+"/wp-json/verowa/v1/agenda\_event/"+g\_current\_batch+"/",type:"GET",data:t,contentType:"application/json; charset=utf-8",dataType:"JSON",success:function(n){g\_lock\_scroll\_load=!1;g\_current\_batch++;jQuery(".event\_list\_dynamic\_agenda").append(n.content);g\_agenda\_is\_loading=!1;jQuery("#infinite-scroll-loader").hide();jQuery(".event\_list\_dynamic\_agenda > ~~div~~").length==0?jQuery("#no-events-box").show():jQuery("#no-events-box").hide();g\_has\_further\_results=n.has\_further\_results;g\_has\_further\_results&&g\_filter\_has\_changed&&(g\_filter\_has\_changed=!1,load\_agenda\_events(!0))},error:function(){g\_agenda\_is\_loading=!1;g\_has\_further\_results=!0;g\_filter\_has\_changed&&(g\_filter\_has\_changed=!1,load\_agenda\_events(!0))}})}function bind\_infinite\_scroll(){window.addEventListener("scroll",()=>{const{scrollTop:t,scrollHeight:i,clientHeight:n}=document.documentElement;!g\_lock\_scroll\_load&&t+n>=i-2\*n&&g\_current\_batch<g\_max\_loadings&&g\_has\_further\_results&&!g\_agenda\_is\_loading&&g\_has\_further\_results&&(load\_agenda\_events(!1),g\_agenda\_is\_loading=!0)},{passive:!0})}function scroll\_to\_event(n){if(jQuery(".event-"+n).length>=1&&n!==0&&n!=null){var t=jQuery(".event-"+n).offset().top,i=jQuery(".inside-navigation").height()||0,r=t-i-30;jQuery("html, body").animate({scrollTop:r},0)}}function verowa\_agenda\_filter\_reset(){var n=new Date,r="0"+n.getDate(),t,i,u;n.getDate()>9&&(r=n.getDate());t=n.getMonth()+1;i="0"+t;t>9&&(i=t);u=r+"."+i+"."+n.getFullYear();jQuery("#verowa\_connect\_datepicker").val(u);jQuery("#verowa\_event\_filters .filter-button.selected").removeClass("selected");jQuery("#verowa\_event\_filters .no-filter:not(.selected)").addClass("selected");jQuery("#vc-agenda-search-input").val("");load\_agenda\_events(!0)}function supports\_session\_storage(){try{if("sessionStorage"in window&&window.sessionStorage!==null)return sessionStorage.setItem("testitem",!0),sessionStorage.removeItem("testitem"),!0}catch(n){return!1}}function verowa\_toggle\_event\_list\_handler(n){n.preventDefault();var t=jQuery(this).attr("data-id");jQuery(this).find(".toggle\_button").hasClass("open")?(jQuery(".event-"+t+" .short\_text").toggle(),jQuery(".event-"+t+" .event\_button\_list").toggle(),jQuery(".event-"+t+" .event\_content").html(""),jQuery(this).find(".toggle\_button.open").removeClass("open"),jQuery(this).find(".toggle\_button").css({transform:"rotate(0deg)"})):(jQuery(this).find(".toggle\_button").addClass("open"),jQuery(this).find(".toggle\_button").css({transform:"rotate(180deg)"}),jQuery.getJSON({url:verowa\_L10n\_agenda.BASE\_URL+"/wp-json/verowa/v1/event/"+t,data:"",success:function(n){var i,r,u;jQuery(".event-"+t+" .short\_text").toggle();jQuery(".event-"+t+" .event\_button\_list").toggle();i='<div class="first"><\/div>';n.short\_desc!="undefined"&&(i+='<p class="short\_desc">'+n.short\_desc+"<\/p>");r="";n.catering!=null&&n.catering.toString()!=""&&(r+=', <span class="catering">'+n.catering+"<\/span>");n.childcare\_text!=null&&n.childcare\_text.toString()!=""&&(r+=', <span class="childcare\_text">'+n.childcare\_text+"<\/span>");n.baptism\_offer\_text!=null&&n.baptism\_offer\_text.toString()=="ja"&&(r+=', <span class="baptism\_offer\_text">mit Taufe<\/span>');r!=""&&(i+='<p class="event\_meta">',i+=r.replace(", ",""),i+="<\/p>");u="";n.organizer!=null&&n.organizer.toString()!==""&&(u+=", "+n.organizer.name);"coorganizers"in n&&n.coorganizers.forEach(function(n){u+=", "+n.name});n.further\_coorganizer!=null&&n.further\_coorganizer.toString()!==""&&(u+=", "+n.further\_coorganizer);u!=""&&(i+='<p class="organizers">',i+=u.replace(", ",""),i+="<\/p>");jQuery(".event-"+t+" .event\_content").html(i)}}))}var g\_max\_loadings=50,g\_current\_batch=1,g\_agenda\_is\_loading=!1,g\_has\_further\_results=!0,g\_filter\_has\_changed=!1,g\_lock\_scroll\_load=!0,dateToday;jQuery(document).ready(function(){jQuery(document).on("click touch",".event\_list\_item a:not(.verowa\_excl\_stop\_propagation)",function(n){n.stopPropagation()});jQuery(document).on("click touch",".event\_list\_wrapper .event\_list\_item",verowa\_toggle\_event\_list\_handler);jQuery("#vc-agenda-search-wrapper button").click(function(n){n.preventDefault();n.stopPropagation();g\_agenda\_is\_loading?g\_filter\_has\_changed=!0:(load\_agenda\_events(!0),g\_agenda\_is\_loading=!0)});jQuery("#vc-agenda-search-input").keyup(function(n){let t=n.keyCode||n.which;t==13&&(g\_agenda\_is\_loading?g\_filter\_has\_changed=!0:(load\_agenda\_events(!0),g\_agenda\_is\_loading=!0))});jQuery(".details-button").on("click touch",function(n){n.stopPropagation()});jQuery(document).on("click","#verowa\_event\_filters .list\_filter a",function(){var n=jQuery(this),t;if(!n.hasClass("selected"))return t=n.parents(".option-set"),t.find(".selected").removeClass("selected"),n.addClass("selected"),g\_agenda\_is\_loading?g\_filter\_has\_changed=!0:(load\_agenda\_events(!0),g\_agenda\_is\_loading=!0),!1});jQuery("#verowa\_connect\_datepicker").change(function(){var n=jQuery(this);return g\_agenda\_is\_loading?g\_filter\_has\_changed=!0:(load\_agenda\_events(!0),g\_agenda\_is\_loading=!0),!1})});dateToday=new Date;jQuery(function(){jQuery("#verowa\_connect\_datepicker").datepicker({dateFormat:"dd.mm.yy",monthNames:["Januar","Februar","März","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"],minDate:dateToday,firstDay:1,dayNamesMin:["So","Mo","Di","Mi","Do","Fr","Sa"]});jQuery(".dashicons-calendar-alt").on("click",function(){jQuery("#verowa\_connect\_datepicker").focus()})}); |
  |  | 1 | function event\_handler\_detail\_link\_clickt(n){n.stopPropagation()}function datepicker\_to\_technical\_date(){var t="",i,n;return document.getElementById("verowa\_connect\_datepicker")!=null&&(i=document.getElementById("verowa\_connect\_datepicker").value,n=i.split("."),n=n.reverse(),t=n.join("")),t}function load\_agenda\_events(n){jQuery("#infinite-scroll-loader").show();n&&(g\_current\_batch=1,jQuery(".event\_list\_dynamic\_agenda").html(""),g\_has\_further\_results=!0);var r=datepicker\_to\_technical\_date(),t={date:r,arr\_list\_ids:[],search\_string:jQuery("#vc-agenda-search-input").val()??"",wpml\_language\_code:jQuery("#wpml-language-code").val()};let i=parseInt(jQuery("#verowa-atts-list-id").val());isNaN(i)||0===i||t.arr\_list\_ids.push(i);jQuery("#verowa\_event\_filters .list\_filter a.selected").each(function(n,i){jQuery(i).attr("data-filter-value")!=""&&t.arr\_list\_ids.push(parseInt(jQuery(i).attr("data-filter-value").split("-")[1]))});jQuery.ajax({url:verowa\_L10n\_agenda.BASE\_URL+"/wp-json/verowa/v1/agenda\_event/"+g\_current\_batch+"/",type:"GET",data:t,contentType:"application/json; charset=utf-8",dataType:"JSON",success:function(n){g\_lock\_scroll\_load=!1;g\_current\_batch++;jQuery(".event\_list\_dynamic\_agenda").append(n.content);g\_agenda\_is\_loading=!1;jQuery("#infinite-scroll-loader").hide();jQuery(".event\_list\_dynamic\_agenda > \*").length==0?jQuery("#no-events-box").show():jQuery("#no-events-box").hide();g\_has\_further\_results=n.has\_further\_results;g\_has\_further\_results&&g\_filter\_has\_changed&&(g\_filter\_has\_changed=!1,load\_agenda\_events(!0))},error:function(){g\_agenda\_is\_loading=!1;g\_has\_further\_results=!0;g\_filter\_has\_changed&&(g\_filter\_has\_changed=!1,load\_agenda\_events(!0))}})}function bind\_infinite\_scroll(){window.addEventListener("scroll",()=>{const{scrollTop:t,scrollHeight:i,clientHeight:n}=document.documentElement;!g\_lock\_scroll\_load&&t+n>=i-2\*n&&g\_current\_batch<g\_max\_loadings&&g\_has\_further\_results&&!g\_agenda\_is\_loading&&g\_has\_further\_results&&(load\_agenda\_events(!1),g\_agenda\_is\_loading=!0)},{passive:!0})}function scroll\_to\_event(n){if(jQuery(".event-"+n).length>=1&&n!==0&&n!=null){var t=jQuery(".event-"+n).offset().top,i=jQuery(".inside-navigation").height()||0,r=t-i-30;jQuery("html, body").animate({scrollTop:r},0)}}function verowa\_agenda\_filter\_reset(){var n=new Date,r="0"+n.getDate(),t,i,u;n.getDate()>9&&(r=n.getDate());t=n.getMonth()+1;i="0"+t;t>9&&(i=t);u=r+"."+i+"."+n.getFullYear();jQuery("#verowa\_connect\_datepicker").val(u);jQuery("#verowa\_event\_filters .filter-button.selected").removeClass("selected");jQuery("#verowa\_event\_filters .no-filter:not(.selected)").addClass("selected");jQuery("#vc-agenda-search-input").val("");load\_agenda\_events(!0)}function supports\_session\_storage(){try{if("sessionStorage"in window&&window.sessionStorage!==null)return sessionStorage.setItem("testitem",!0),sessionStorage.removeItem("testitem"),!0}catch(n){return!1}}function verowa\_toggle\_event\_list\_handler(n){n.preventDefault();var t=jQuery(this).attr("data-id");jQuery(this).find(".toggle\_button").hasClass("open")?(jQuery(".event-"+t+" .short\_text").toggle(),jQuery(".event-"+t+" .event\_button\_list").toggle(),jQuery(".event-"+t+" .event\_content").html(""),jQuery(this).find(".toggle\_button.open").removeClass("open"),jQuery(this).find(".toggle\_button").css({transform:"rotate(0deg)"})):(jQuery(this).find(".toggle\_button").addClass("open"),jQuery(this).find(".toggle\_button").css({transform:"rotate(180deg)"}),jQuery.getJSON({url:verowa\_L10n\_agenda.BASE\_URL+"/wp-json/verowa/v1/event/"+t,data:"",success:function(n){var i,r,u;jQuery(".event-"+t+" .short\_text").toggle();jQuery(".event-"+t+" .event\_button\_list").toggle();i='<div class="first"><\/div>';n.short\_desc!="undefined"&&(i+='<p class="short\_desc">'+n.short\_desc+"<\/p>");r="";n.catering!=null&&n.catering.toString()!=""&&(r+=', <span class="catering">'+n.catering+"<\/span>");n.childcare\_text!=null&&n.childcare\_text.toString()!=""&&(r+=', <span class="childcare\_text">'+n.childcare\_text+"<\/span>");n.baptism\_offer\_text!=null&&n.baptism\_offer\_text.toString()=="ja"&&(r+=', <span class="baptism\_offer\_text">mit Taufe<\/span>');r!=""&&(i+='<p class="event\_meta">',i+=r.replace(", ",""),i+="<\/p>");u="";n.organizer!=null&&n.organizer.toString()!==""&&(u+=", "+n.organizer.name);"coorganizers"in n&&n.coorganizers.forEach(function(n){u+=", "+n.name});n.further\_coorganizer!=null&&n.further\_coorganizer.toString()!==""&&(u+=", "+n.further\_coorganizer);u!=""&&(i+='<p class="organizers">',i+=u.replace(", ",""),i+="<\/p>");jQuery(".event-"+t+" .event\_content").html(i)}}))}var g\_max\_loadings=50,g\_current\_batch=1,g\_agenda\_is\_loading=!1,g\_has\_further\_results=!0,g\_filter\_has\_changed=!1,g\_lock\_scroll\_load=!0,dateToday;jQuery(document).ready(function(){jQuery(document).on("click touch",".event\_list\_item a:not(.verowa\_excl\_stop\_propagation)",function(n){n.stopPropagation()});jQuery(document).on("click touch",".event\_list\_wrapper .event\_list\_item",verowa\_toggle\_event\_list\_handler);jQuery("#vc-agenda-search-wrapper button").click(function(n){n.preventDefault();n.stopPropagation();g\_agenda\_is\_loading?g\_filter\_has\_changed=!0:(load\_agenda\_events(!0),g\_agenda\_is\_loading=!0)});jQuery("#vc-agenda-search-input").keyup(function(n){let t=n.keyCode||n.which;t==13&&(g\_agenda\_is\_loading?g\_filter\_has\_changed=!0:(load\_agenda\_events(!0),g\_agenda\_is\_loading=!0))});jQuery(".details-button").on("click touch",function(n){n.stopPropagation()});jQuery(document).on("click","#verowa\_event\_filters .list\_filter a",function(){var n=jQuery(this),t;if(!n.hasClass("selected"))return t=n.parents(".option-set"),t.find(".selected").removeClass("selected"),n.addClass("selected"),g\_agenda\_is\_loading?g\_filter\_has\_changed=!0:(load\_agenda\_events(!0),g\_agenda\_is\_loading=!0),!1});jQuery("#verowa\_connect\_datepicker").change(function(){var n=jQuery(this);return g\_agenda\_is\_loading?g\_filter\_has\_changed=!0:(load\_agenda\_events(!0),g\_agenda\_is\_loading=!0),!1})});dateToday=new Date;jQuery(function(){jQuery("#verowa\_connect\_datepicker").datepicker({dateFormat:"dd.mm.yy",monthNames:["Januar","Februar","März","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"],minDate:dateToday,firstDay:1,dayNamesMin:["So","Mo","Di","Mi","Do","Fr","Sa"]});jQuery(".dashicons-calendar-alt").on("click",function(){jQuery("#verowa\_connect\_datepicker").focus()})}); |
* ## [verowa-connect/trunk/models/class-verowa-template.php](/changeset/3201030/verowa-connect/trunk/models/class-verowa-template.php "Show the changeset 3201030 restricted to verowa-connect/trunk/models/class-verowa-template.php")

  | [r3123647](/browser/verowa-connect/trunk/models/class-verowa-template.php?rev=3123647#L140 "Show revision 3123647 of this file in browser") | [r3201030](/browser/verowa-connect/trunk/models/class-verowa-template.php?rev=3201030#L140 "Show revision 3201030 of this file in browser") |  |
  | --- | --- | --- |
  | 140 | 140 | \*/ |
  | 141 | 141 | public static function redner\_placeholder\_html( $arr\_placeholders ) { |
  |  | 142 |  |
  | 142 | 143 | $str\_placeholder\_html = ''; |
  | 143 |  | foreach ( $arr\_placeholders ?? array() as $arr\_pcl\_group ) { |
  | 144 |  | $str\_title             = isset( $arr\_pcl\_group['title'] ) ? |
  | 145 |  | '<span class="verowa-pcl-title">' . $arr\_pcl\_group['title'] . '</span>' : ''; |
  | 146 |  | $str\_placeholder\_html .= '<div class="verowa-pcl-group">' . $str\_title . '<div>'; |
  | 147 |  | foreach ( $arr\_pcl\_group['pcl'] as $single\_placeholder ) { |
  | 148 |  | if ( false === is\_array( $single\_placeholder ) ) { |
  | 149 |  | $str\_placeholder\_html .= '<span class="verowa-pcl-btn">' . $single\_placeholder . '</span>'; |
  | 150 |  | } elseif ( 0 === strlen( $single\_placeholder['helptext'] ?? '' ) ) { |
  | 151 |  | $str\_placeholder\_html .= '<span class="verowa-pcl-btn">' . $single\_placeholder['name'] . '</span>'; |
  | 152 |  | } else { |
  | 153 |  | $str\_placeholder\_html .= '<span class="verowa-pcl-btn" title="' . |
  | 154 |  | $single\_placeholder['helptext'] . '">' . $single\_placeholder['name'] . |
  | 155 |  | '<i class="dashicons dashicons-info"></i></span>'; |
  |  | 144 | if (is\_array($arr\_placeholders)) |
  |  | 145 | { |
  |  | 146 | foreach ( $arr\_placeholders ?? array() as $arr\_pcl\_group ) { |
  |  | 147 | $str\_title             = isset( $arr\_pcl\_group['title'] ) ? |
  |  | 148 | '<span class="verowa-pcl-title">' . $arr\_pcl\_group['title'] . '</span>' : ''; |
  |  | 149 | $str\_placeholder\_html .= '<div class="verowa-pcl-group">' . $str\_title . '<div>'; |
  |  | 150 | foreach ( $arr\_pcl\_group['pcl'] as $single\_placeholder ) { |
  |  | 151 | if ( false === is\_array( $single\_placeholder ) ) { |
  |  | 152 | $str\_placeholder\_html .= '<span class="verowa-pcl-btn">' . $single\_placeholder . '</span>'; |
  |  | 153 | } elseif ( 0 === strlen( $single\_placeholder['helptext'] ?? '' ) ) { |
  |  | 154 | $str\_placeholder\_html .= '<span class="verowa-pcl-btn">' . $single\_placeholder['name'] . '</span>'; |
  |  | 155 | } else { |
  |  | 156 | $str\_placeholder\_html .= '<span class="verowa-pcl-btn" title="' . |
  |  | 157 | $single\_placeholder['helptext'] . '">' . $single\_placeholder['name'] . |
  |  | 158 | '<i class="dashicons dashicons-info"></i></span>'; |
  |  | 159 | } |
  | 156 | 160 | } |
  |  | 161 | $str\_placeholder\_html .= '</div></div>'; |
  | 157 | 162 | } |
  | 158 |  | ~~$str\_placeholder\_html .= '</div></div>';~~ |
  | 159 | 163 | } |
  | 160 | 164 | return $str\_placeholder\_html; |
* ## [verowa-connect/trunk/persons/show-persons-shortcode.php](/changeset/3201030/verowa-connect/trunk/persons/show-persons-shortcode.php "Show the changeset 3201030 restricted to verowa-connect/trunk/persons/show-persons-shortcode.php")

  | [r3160300](/browser/verowa-connect/trunk/persons/show-persons-shortcode.php?rev=3160300#L39 "Show revision 3160300 of this file in browser") | [r3201030](/browser/verowa-connect/trunk/persons/show-persons-shortcode.php?rev=3201030#L39 "Show revision 3201030 of this file in browser") |  |
  | --- | --- | --- |
  | 39 | 39 |  |
  | 40 | 40 | $curr\_language\_code = verowa\_wpml\_get\_current\_language(); |
  |  | 41 |  |
  |  | 42 | /\*\* |
  |  | 43 | \* In this case the return value is an single object of the class VEROWA\_TEMPLATE. |
  |  | 44 | \* |
  |  | 45 | \* @var \Picture\_Planet\_GmbH\Verowa\_Connect\VEROWA\_TEMPLATE $obj\_template |
  |  | 46 | \*/ |
  | 41 | 47 | $obj\_template       = verowa\_get\_single\_template( $int\_selected\_template, $curr\_language\_code ); |
  | 42 | 48 | // If no template was loaded and the ID does not correspond to the default template, |
  | […](/browser/verowa-connect/trunk/persons/show-persons-shortcode.php?rev=3160300#L46) | […](/browser/verowa-connect/trunk/persons/show-persons-shortcode.php?rev=3201030#L52) |  |
  | 46 | 52 | } |
  | 47 | 53 |  |
  | 48 |  | $arr\_single\_person     = verowa\_person\_db\_get\_content( $atts['id'] ?? 0 ); |
  |  | 54 | $arr\_ret\_person = verowa\_person\_db\_get\_content( $atts['id'] ?? 0 ); |
  |  | 55 | $arr\_person = json\_decode( $arr\_ret\_person['content'] ?? '[]', true ); |
  |  | 56 | echo $obj\_template->header; |
  |  | 57 | $arr\_template = [ $curr\_language\_code => $obj\_template]; |
  |  | 58 | $arr\_person\_content = verowa\_person\_assembling\_html( $arr\_person, $arr\_template, $curr\_language\_code, |
  |  | 59 | $str\_comp\_tag ); |
  |  | 60 | echo do\_shortcode( $arr\_person\_content['html'] ); |
  | 49 | 61 |  |
  | 50 |  |  |
  | 51 |  | ~~echo $obj\_template->header;~~ |
  | 52 |  |  |
  | 53 |  | ~~// UNDONE: Template ID durch Template Array ersetzten.~~ |
  | 54 |  | ~~show\_a\_person\_from\_verowa( $arr\_single\_person, $str\_comp\_tag, $int\_selected\_template );~~ |
  | 55 | 62 | echo $obj\_template->separator; |
  | 56 | 63 |  |
  | […](/browser/verowa-connect/trunk/persons/show-persons-shortcode.php?rev=3160300#L95) | […](/browser/verowa-connect/trunk/persons/show-persons-shortcode.php?rev=3201030#L102) |  |
  | 95 | 102 | } |
  | 96 | 103 | $curr\_language\_code = verowa\_wpml\_get\_current\_language(); |
  | 97 |  |  |
  | 98 | 104 | $obj\_template       = verowa\_get\_single\_template( $template\_id, $curr\_language\_code ); |
  |  | 105 | $arr\_template       = array( $curr\_language\_code => $obj\_template ); |
  | 99 | 106 |  |
  | 100 | 107 | // If no template was loaded and the ID does not correspond to the default template, |
  | […](/browser/verowa-connect/trunk/persons/show-persons-shortcode.php?rev=3160300#L129) | […](/browser/verowa-connect/trunk/persons/show-persons-shortcode.php?rev=3201030#L136) |  |
  | 129 | 136 | foreach ( $arr\_all\_person\_ids as $single\_person ) { |
  | 130 | 137 | if ( is\_numeric( $single\_person ) ) { |
  | 131 |  | $arr\_person\_ids[] = ~~$single\_person~~; |
  |  | 138 | $arr\_person\_ids[] = intval( $single\_person ); |
  | 132 | 139 | } |
  | 133 | 140 | } |
  | […](/browser/verowa-connect/trunk/persons/show-persons-shortcode.php?rev=3160300#L144) | […](/browser/verowa-connect/trunk/persons/show-persons-shortcode.php?rev=3201030#L151) |  |
  | 144 | 151 | } |
  | 145 | 152 |  |
  | 146 |  | ~~// UNDONE: Erweitern für WPML~~ |
  | 147 | 153 | echo $obj\_template->header; |
  | 148 | 154 |  |
  | […](/browser/verowa-connect/trunk/persons/show-persons-shortcode.php?rev=3160300#L150) | […](/browser/verowa-connect/trunk/persons/show-persons-shortcode.php?rev=3201030#L156) |  |
  | 150 | 156 | // we continue with $arr\_all\_person\_ids, because here the order is correct. |
  | 151 | 157 | // ATTENTION: $single\_person can be an ID, a group ID ('group-123') or a heading ! |
  |  | 158 | $str\_output = ''; |
  | 152 | 159 | foreach ( $arr\_all\_person\_ids as $single\_person ) { |
  | 153 | 160 | // it is a person id => ^(0|[1-9][0-9]\*)$. |
  | 154 | 161 | if ( is\_numeric( $single\_person ) && key\_exists( $single\_person, $arr\_single\_members\_polished ) ) { |
  | 155 |  | echo ( false === $is\_first ) ? $obj\_template->separator : ''; |
  | 156 |  | show\_a\_person\_from\_verowa( $arr\_single\_members\_polished[ $single\_person ], $str\_comp\_tag, $template\_id ); |
  |  | 162 | $str\_output .= ( false === $is\_first ) ? $obj\_template->separator : ''; |
  |  | 163 | $arr\_person\_content = verowa\_person\_assembling\_html( $arr\_single\_members\_polished[ $single\_person ], |
  |  | 164 | $arr\_template, $curr\_language\_code, $str\_comp\_tag ); |
  |  | 165 | $str\_output .= $arr\_person\_content['html']; |
  |  | 166 | // show\_a\_person\_from\_verowa( $arr\_single\_members\_polished[ $single\_person ], $str\_comp\_tag, $template\_id ); |
  | 157 | 167 | } elseif ( false !== strpos( $single\_person, 'group-' ) ) { // it is a person group. |
  | 158 | 168 | $group\_id = str\_replace( 'group-', '', $single\_person ); |
  | […](/browser/verowa-connect/trunk/persons/show-persons-shortcode.php?rev=3160300#L161) | […](/browser/verowa-connect/trunk/persons/show-persons-shortcode.php?rev=3201030#L171) |  |
  | 161 | 171 | $is\_g\_first        = false; |
  | 162 | 172 | foreach ( $arr\_group\_members as $single\_person ) { |
  | 163 |  | show\_a\_person\_from\_verowa( $single\_person, $str\_comp\_tag, $template\_id ); |
  | 164 |  | echo ( false === $is\_g\_first ) ? $obj\_template->separator : ''; |
  |  | 173 | $arr\_person\_content = verowa\_person\_assembling\_html( $single\_person , |
  |  | 174 | $arr\_template, $curr\_language\_code, $str\_comp\_tag ); |
  |  | 175 | $str\_output .= ( false === $is\_g\_first ) ? $obj\_template->separator : ''; |
  |  | 176 | $str\_output .= $arr\_person\_content['html']; |
  | 165 | 177 | $is\_g\_first = true; |
  | 166 | 178 | } |
  | […](/browser/verowa-connect/trunk/persons/show-persons-shortcode.php?rev=3160300#L169) | […](/browser/verowa-connect/trunk/persons/show-persons-shortcode.php?rev=3201030#L181) |  |
  | 169 | 181 | // check if it is a headline. |
  | 170 | 182 | elseif ( 0 === preg\_match( '/^\\d+$/', $single\_person ) ) { |
  | 171 |  | ~~echo~~ '<div class="verowa-persons-headline persons\_headline"><h3>' . $single\_person . '</h3></div>'; |
  |  | 183 | $str\_output .= '<div class="verowa-persons-headline persons\_headline"><h3>' . $single\_person . '</h3></div>'; |
  | 172 | 184 | } |
  | 173 | 185 |  |
  | 174 | 186 | $is\_first = false; |
  | 175 | 187 | } |
  | 176 |  |  |
  | 177 |  | echo $obj\_template->footer; |
  |  | 188 | echo do\_shortcode( $str\_output ) . $obj\_template->footer; |
  | 178 | 189 | } |
  | 179 | 190 |  |
  | 180 | 191 | return ob\_get\_clean(); |
  | 181 | 192 | } |
  | 182 |  |  |
  | 183 |  |  |
  | 184 |  |  |
  | 185 |  |  |
  | 186 |  | ~~/\*\*~~ |
  | 187 |  | ~~\* Output of the individual person, as variable the associated person ID.~~ |
  | 188 |  | ~~\* Used by the widget and the shortcodes verowa\_person and verowa\_personen.~~ |
  | 189 |  | ~~\*~~ |
  | 190 |  | ~~\* @param  array  $arr\_group\_member The person data array or the content array containing the person data.~~ |
  | 191 |  | ~~\* @param  string $str\_comp\_tag The component tag to select the specific image for the person.~~ |
  | 192 |  | ~~\* @param  int    $int\_personlist\_template The template ID for the person list. (Optional).~~ |
  | 193 |  | ~~\* @return void This function echoes the parsed output of the person data template.~~ |
  | 194 |  | ~~\*/~~ |
  | 195 |  | ~~function show\_a\_person\_from\_verowa( $arr\_group\_member, $str\_comp\_tag = 'pr', $int\_personlist\_template = 0 ) {~~ |
  | 196 |  | ~~global $post;~~ |
  | 197 |  |  |
  | 198 |  | ~~// UNDONE: Umschreiben von Template-ID auf ref zu Template~~ |
  | 199 |  | ~~$arr\_placeholders = array();~~ |
  | 200 |  |  |
  | 201 |  | ~~if ( isset( $arr\_group\_member['content'] ) ) {~~ |
  | 202 |  | ~~$arr\_person = json\_decode( $arr\_group\_member['content'], true );~~ |
  | 203 |  | ~~} else {~~ |
  | 204 |  | ~~$arr\_person = $arr\_group\_member;~~ |
  | 205 |  | ~~}~~ |
  | 206 |  |  |
  | 207 |  | ~~$curr\_language\_code  = verowa\_wpml\_get\_current\_language();~~ |
  | 208 |  | ~~$default\_template\_id = intval( get\_option( 'verowa\_default\_personlist\_template' ) );~~ |
  | 209 |  |  |
  | 210 |  | ~~if ( 0 === $int\_personlist\_template ) {~~ |
  | 211 |  | ~~$int\_personlist\_template = null !== $post ?~~ |
  | 212 |  | ~~intval( get\_post\_meta( $post->ID, 'verowa\_personlist\_template', true ) ) : 0;~~ |
  | 213 |  |  |
  | 214 |  | ~~if ( 0 === $int\_personlist\_template ) {~~ |
  | 215 |  | ~~$int\_personlist\_template = $default\_template\_id;~~ |
  | 216 |  | ~~}~~ |
  | 217 |  | ~~}~~ |
  | 218 |  |  |
  | 219 |  | ~~$obj\_template = verowa\_get\_single\_template( $int\_personlist\_template, $curr\_language\_code );~~ |
  | 220 |  |  |
  | 221 |  | ~~// If no template was loaded and the ID does not correspond to the default template,~~ |
  | 222 |  | ~~// then the default template is loaded.~~ |
  | 223 |  | ~~if ( empty( $obj\_template ) && $int\_personlist\_template !== $default\_template\_id ) {~~ |
  | 224 |  | ~~$obj\_template = verowa\_get\_single\_template( $default\_template\_id );~~ |
  | 225 |  | ~~}~~ |
  | 226 |  |  |
  | 227 |  | ~~// Certain special entries override the defaults from the plug-in settings.~~ |
  | 228 |  | ~~if ( null !== $post && $post->ID > 0 &&~~ |
  | 229 |  | ~~get\_post\_meta( $post->ID, 'verowa\_has\_person\_options\_on\_post\_level', false ) ) {~~ |
  | 230 |  |  |
  | 231 |  | ~~// Only with detail pages, the setting of the post has effect.~~ |
  | 232 |  | ~~$persons\_without\_detail\_page = get\_option( 'verowa\_persons\_without\_detail\_page', false );~~ |
  | 233 |  | ~~if ( 'on' !== $persons\_without\_detail\_page ) {~~ |
  | 234 |  | ~~$persons\_have\_detail\_link = get\_post\_meta( $post->ID, 'verowa\_persons\_have\_detail\_link', true );~~ |
  | 235 |  | ~~} else {~~ |
  | 236 |  | ~~$persons\_have\_detail\_link = false;~~ |
  | 237 |  | ~~}~~ |
  | 238 |  |  |
  | 239 |  | ~~$person\_group\_function = get\_post\_meta( $post->ID, 'verowa\_person\_show\_group\_function', true );~~ |
  | 240 |  | ~~$person\_profession     = get\_post\_meta( $post->ID, 'verowa\_person\_show\_profession', true );~~ |
  | 241 |  | ~~$person\_address        = get\_post\_meta( $post->ID, 'verowa\_person\_show\_address', true );~~ |
  | 242 |  | ~~$person\_email          = get\_post\_meta( $post->ID, 'verowa\_person\_show\_person\_email', true );~~ |
  | 243 |  | ~~$person\_phone          = get\_post\_meta( $post->ID, 'verowa\_person\_show\_person\_phone', true );~~ |
  | 244 |  | ~~$person\_short\_desc     = get\_post\_meta( $post->ID, 'verowa\_person\_short\_desc', true );~~ |
  | 245 |  | ~~} else {~~ |
  | 246 |  | ~~// Otherwise we simply adopt the ones from the plugin.~~ |
  | 247 |  | ~~$persons\_without\_detail\_page = get\_option( 'verowa\_persons\_without\_detail\_page', false );~~ |
  | 248 |  | ~~$persons\_have\_detail\_link    = 'on' != $persons\_without\_detail\_page ? 'on' : false;~~ |
  | 249 |  |  |
  | 250 |  | ~~// If the person is displayed via the shortcode in an event detail it has no post meta data.~~ |
  | 251 |  | ~~// The options are set to on so that the display depends on the placeholders of the templates.~~ |
  | 252 |  | ~~$person\_group\_function = 'on';~~ |
  | 253 |  | ~~$person\_profession     = 'on';~~ |
  | 254 |  | ~~$person\_address        = 'on';~~ |
  | 255 |  | ~~$person\_email          = 'on';~~ |
  | 256 |  | ~~$person\_phone          = 'on';~~ |
  | 257 |  | ~~$person\_short\_desc     = 'on';~~ |
  | 258 |  | ~~}~~ |
  | 259 |  |  |
  | 260 |  | ~~$arr\_single\_person = $arr\_person;~~ |
  | 261 |  | ~~$str\_language\_code = verowa\_wpml\_get\_current\_language();~~ |
  | 262 |  |  |
  | 263 |  | ~~if ( is\_array( $arr\_single\_person ) && count( $arr\_single\_person ) > 0 ) {~~ |
  | 264 |  | ~~$str\_siteurl        = verowa\_get\_base\_url();~~ |
  | 265 |  | ~~$wpml\_is\_configured = verowa\_wpml\_is\_configured();~~ |
  | 266 |  | ~~if ( true === $wpml\_is\_configured ) {~~ |
  | 267 |  | ~~$str\_person\_details\_url = verowa\_wpml\_get\_custom\_post\_url ($arr\_single\_person['person\_id'],~~ |
  | 268 |  | ~~$str\_language\_code, 'person', 'verowa\_person');~~ |
  | 269 |  | ~~} else {~~ |
  | 270 |  | ~~$str\_person\_details\_url = $str\_siteurl . '/person/' . $arr\_single\_person['person\_id'] . '/';~~ |
  | 271 |  | ~~}~~ |
  | 272 |  |  |
  | 273 |  | ~~$arr\_placeholders['PERSON\_DETAILS\_URL'] = $str\_person\_details\_url;~~ |
  | 274 |  |  |
  | 275 |  | ~~if ( 'on' === $persons\_have\_detail\_link ) {~~ |
  | 276 |  | ~~// UNDONE: URL auf WPML anpassen.~~ |
  | 277 |  |  |
  | 278 |  | ~~$str\_link\_pre  = '<a href="' . $str\_person\_details\_url . '/">';~~ |
  | 279 |  | ~~$str\_link\_post = '</a>';~~ |
  | 280 |  | ~~} else {~~ |
  | 281 |  | ~~$str\_link\_pre  = '';~~ |
  | 282 |  | ~~$str\_link\_post = '';~~ |
  | 283 |  | ~~}~~ |
  | 284 |  |  |
  | 285 |  | ~~$arr\_placeholders['PERSON\_ID'] = $arr\_single\_person['person\_id'] ?? '';~~ |
  | 286 |  |  |
  | 287 |  | ~~if ( count( $arr\_single\_person['images'] ?? array() ) > 0 &&~~ |
  | 288 |  | ~~key\_exists( $str\_comp\_tag, $arr\_single\_person['images'] ) ) {~~ |
  | 289 |  | ~~$arr\_placeholders['IMAGE\_URL'] = $str\_link\_pre .~~ |
  | 290 |  | ~~'<img src="' . $arr\_single\_person['images'][ $str\_comp\_tag ]['url'] . '" />' . $str\_link\_post;~~ |
  | 291 |  | ~~}~~ |
  | 292 |  |  |
  | 293 |  | ~~$str\_person\_name = trim( $arr\_single\_person['firstname'] . ' ' . $arr\_single\_person['lastname'] );~~ |
  | 294 |  |  |
  | 295 |  | ~~$arr\_placeholders['PERSON\_NAME']            = $str\_link\_pre . $str\_person\_name . $str\_link\_post;~~ |
  | 296 |  | ~~$arr\_placeholders['PERSON\_NAME\_NOT\_LINKED'] = $str\_person\_name;~~ |
  | 297 |  |  |
  | 298 |  | ~~if ( key\_exists( 'function\_in\_group', $arr\_single\_person ) &&~~ |
  | 299 |  | ~~strlen( $arr\_single\_person['function\_in\_group'] ) > 0 &&~~ |
  | 300 |  | ~~'on' === $person\_group\_function ) {~~ |
  | 301 |  | ~~$arr\_placeholders['FUNCTION\_IN\_GROUP'] = $arr\_single\_person['function\_in\_group'];~~ |
  | 302 |  | ~~}~~ |
  | 303 |  |  |
  | 304 |  | ~~if ( key\_exists( 'short\_desc', $arr\_single\_person ) &&~~ |
  | 305 |  | ~~strlen( $arr\_single\_person['short\_desc'] ) > 0 &&~~ |
  | 306 |  | ~~'on' === $person\_short\_desc ) {~~ |
  | 307 |  | ~~$arr\_placeholders['SHORT\_DESC'] = $arr\_single\_person['short\_desc'];~~ |
  | 308 |  | ~~}~~ |
  | 309 |  |  |
  | 310 |  | ~~$arr\_placeholders['DESC\_TASKS'] = $arr\_single\_person['desc\_tasks'] ?? '';~~ |
  | 311 |  | ~~$arr\_placeholders['DESC\_PERSONAL'] = $arr\_single\_person['desc\_personal'] ?? '';~~ |
  | 312 |  |  |
  | 313 |  | ~~if ( strlen( $arr\_single\_person['profession'] ) > 0 && 'on' === $person\_profession ) {~~ |
  | 314 |  | ~~$arr\_placeholders['PROFESSION'] = $arr\_single\_person['profession'];~~ |
  | 315 |  | ~~}~~ |
  | 316 |  |  |
  | 317 |  | ~~if ( ( $arr\_single\_person['postcode'] ?? 0 ) > 0 && 'on' === $person\_address ) {~~ |
  | 318 |  | ~~$arr\_placeholders['ADDRESS']  = $arr\_single\_person['address'];~~ |
  | 319 |  | ~~$arr\_placeholders['ZIP\_CITY'] = $arr\_single\_person['postcode'] . ' ' . $arr\_single\_person['city'];~~ |
  | 320 |  | ~~}~~ |
  | 321 |  |  |
  | 322 |  | ~~if ( strlen( $arr\_single\_person['email'] ) > 0 && 'on' === $person\_email ) {~~ |
  | 323 |  | ~~$arr\_placeholders['EMAIL'] = $arr\_single\_person['email'];~~ |
  | 324 |  | ~~}~~ |
  | 325 |  |  |
  | 326 |  | ~~$arr\_placeholders['PERSONAL\_URL'] = '';~~ |
  | 327 |  | ~~if ( key\_exists( 'pers\_website', $arr\_single\_person ) && '' !== $arr\_single\_person['pers\_website'] ) {~~ |
  | 328 |  | ~~if ( false === strpos( $arr\_single\_person['pers\_website'], 'http' )  ) {~~ |
  | 329 |  | ~~$arr\_single\_person['pers\_website'] = 'https://' . $arr\_single\_person['pers\_website'];~~ |
  | 330 |  | ~~}~~ |
  | 331 |  |  |
  | 332 |  | ~~$arr\_placeholders['PERSONAL\_URL'] = $arr\_single\_person['pers\_website'];~~ |
  | 333 |  | ~~}~~ |
  | 334 |  |  |
  | 335 |  | ~~if ( strlen( $arr\_single\_person['phone'] ) > 0 && 'on' === $person\_phone ) {~~ |
  | 336 |  | ~~$arr\_placeholders['PHONE'] = $arr\_single\_person['phone'];~~ |
  | 337 |  | ~~}~~ |
  | 338 |  |  |
  | 339 |  | ~~$arr\_placeholders['BUSINESS\_PHONE']  = verowa\_add\_tel\_link ($arr\_single\_person['business\_phone'] ?? '');~~ |
  | 340 |  | ~~$arr\_placeholders['BUSINESS\_MOBILE'] = verowa\_add\_tel\_link ($arr\_single\_person['business\_mobile'] ?? '');~~ |
  | 341 |  | ~~$arr\_placeholders['PRIVATE\_PHONE']   = verowa\_add\_tel\_link ($arr\_single\_person['private\_phone'] ?? '');~~ |
  | 342 |  | ~~$arr\_placeholders['PRIVATE\_MOBILE']  = verowa\_add\_tel\_link ($arr\_single\_person['private\_mobile'] ?? '');~~ |
  | 343 |  |  |
  | 344 |  | ~~$arr\_placeholders['BUSINESS\_PHONE\_NUMBER']  = $arr\_single\_person['business\_phone'] ?? '';~~ |
  | 345 |  | ~~$arr\_placeholders['BUSINESS\_MOBILE\_NUMBER'] = $arr\_single\_person['business\_mobile'] ?? '';~~ |
  | 346 |  | ~~$arr\_placeholders['PRIVATE\_PHONE\_NUMBER']   = $arr\_single\_person['private\_phone'] ?? '';~~ |
  | 347 |  | ~~$arr\_placeholders['PRIVATE\_MOBILE\_NUMBER']  = $arr\_single\_person['private\_mobile'] ?? '';~~ |
  | 348 |  |  |
  | 349 |  | ~~$arr\_placeholders['IMAGE\_SOURCE\_TEXT'] = $arr\_single\_person['image\_source\_text'] ?? '';~~ |
  | 350 |  | ~~$arr\_placeholders['IMAGE\_SOURCE\_URL']  = $arr\_single\_person['image\_source\_url'] ?? '';~~ |
  | 351 |  |  |
  | 352 |  | ~~// UNDONE: Erweitern für WPML~~ |
  | 353 |  | ~~if ( is\_array( $obj\_template ) && isset( $obj\_template['de'] ) ) {~~ |
  | 354 |  | ~~$obj\_template = $obj\_template['de'];~~ |
  | 355 |  | ~~}~~ |
  | 356 |  |  |
  | 357 |  | ~~if ( is\_array( $obj\_template ) ) {~~ |
  | 358 |  | ~~$obj\_template = (object)$obj\_template;~~ |
  | 359 |  | ~~}~~ |
  | 360 |  |  |
  | 361 |  | ~~$str\_output = verowa\_parse\_template( $obj\_template->entry, $arr\_placeholders );~~ |
  | 362 |  |  |
  | 363 |  | ~~echo do\_shortcode( $str\_output );~~ |
  | 364 |  | ~~}~~ |
  | 365 |  | ~~}~~ |
* ## [verowa-connect/trunk/readme.txt](/changeset/3201030/verowa-connect/trunk/readme.txt "Show the changeset 3201030 restricted to verowa-connect/trunk/readme.txt")

  | [r3159862](/browser/verowa-connect/trunk/readme.txt?rev=3159862#L2 "Show revision 3159862 of this file in browser") | [r3201030](/browser/verowa-connect/trunk/readme.txt?rev=3201030#L2 "Show revision 3201030 of this file in browser") |  |
  | --- | --- | --- |
  | 2 | 2 | Contributors: pictureplanet, michaelpfister |
  | 3 | 3 | Tags: Verowa, church, events, swiss, Switzerland |
  | 4 |  | Requires at least: ~~5.8~~ |
  | 5 |  | Tested up to: 6.~~6~~.2 |
  | 6 |  | Stable tag: 3.0.~~1~~ |
  |  | 4 | Requires at least: 6.0 |
  |  | 5 | Tested up to: 6.7.2 |
  |  | 6 | Stable tag: 3.0.2 |
  | 7 | 7 | Requires PHP: 7.4 |
  | 8 | 8 | License: GPLv2 or later |
  | […](/browser/verowa-connect/trunk/readme.txt?rev=3159862#L64) | […](/browser/verowa-connect/trunk/readme.txt?rev=3201030#L64) |  |
  | 64 | 64 |  |
  | 65 | 65 | == Changelog == |
  |  | 66 |  |
  |  | 67 | = 3.0.2 = |
  |  | 68 | \* Improved: The update cronjob now terminates upon encountering a critical error, preventing further issues and ensuring smoother updates. |
  |  | 69 | \* Bugfix: Addressed a SQL injection vulnerability in the agenda's search parameter search\_content, enhancing security and protecting against potential attacks. |
  |  | 70 | \* Refactoring: Improved database queries to protect against SQL injection vulnerabilities, ensuring robust security and preventing malicious code execution. |
  | 66 | 71 |  |
  | 67 | 72 | = 3.0.1 = |
* ## [verowa-connect/trunk/rosters/verowa-roster-entries.php](/changeset/3201030/verowa-connect/trunk/rosters/verowa-roster-entries.php "Show the changeset 3201030 restricted to verowa-connect/trunk/rosters/verowa-roster-entries.php")

  | [r3159837](/browser/verowa-connect/trunk/rosters/verowa-roster-entries.php?rev=3159837#L137 "Show revision 3159837 of this file in browser") | [r3201030](/browser/verowa-connect/trunk/rosters/verowa-roster-entries.php?rev=3201030#L137 "Show revision 3201030 of this file in browser") |  |
  | --- | --- | --- |
  | 137 | 137 | function verowa\_show\_single\_roster( $single\_roster, &$obj\_template ) { |
  | 138 | 138 | $arr\_content = json\_decode( $single\_roster['content'], true ); |
  | 139 |  | if ( ~~count( $arr\_content ) > 0~~ ) { |
  |  | 139 | if ( empty( $arr\_content ) == false ) { |
  | 140 | 140 | $arr\_placeholder = array(); |
  | 141 | 141 | $time\_from       = strtotime( $single\_roster['datetime\_from'] ); |
* ## [verowa-connect/trunk/verowa-connect.php](/changeset/3201030/verowa-connect/trunk/verowa-connect.php "Show the changeset 3201030 restricted to verowa-connect/trunk/verowa-connect.php")

  | [r3159837](/browser/verowa-connect/trunk/verowa-connect.php?rev=3159837#L5 "Show revision 3159837 of this file in browser") | [r3201030](/browser/verowa-connect/trunk/verowa-connect.php?rev=3201030#L5 "Show revision 3201030 of this file in browser") |  |
  | --- | --- | --- |
  | 5 | 5 | \* Description: Include your Verowa data seamlessly into your WordPress project! |
  | 6 | 6 | \* Author: Picture-Planet GmbH |
  | 7 |  | \* Version: 3.0.~~1~~ |
  | 8 |  | \* Requires at least: ~~5.2~~ |
  |  | 7 | \* Version: 3.0.2 |
  |  | 8 | \* Requires at least: 6.0 |
  | 9 | 9 | \* Requires PHP: 7.4 |
  | 10 | 10 | \* License: GPLv2 or later |
  | […](/browser/verowa-connect/trunk/verowa-connect.php?rev=3159837#L79) | […](/browser/verowa-connect/trunk/verowa-connect.php?rev=3201030#L79) |  |
  | 79 | 79 | require 'persons/show-persons-shortcode.php'; |
  | 80 | 80 | require 'persons/show-persons-widget.php'; |
  | 81 |  | ~~require 'persons/single-person-page.php';~~ |
  | 82 | 81 |  |
  | 83 | 82 | require 'forms/class-verowa-formfields-rendering.php'; |
  | […](/browser/verowa-connect/trunk/verowa-connect.php?rev=3159837#L207) | […](/browser/verowa-connect/trunk/verowa-connect.php?rev=3201030#L206) |  |
  | 207 | 206 | wp\_enqueue\_style( 'verowa-admin-styles', plugins\_url( 'css/backend-style.css', \_\_FILE\_\_ ), array(), true ); |
  | 208 | 207 |  |
  | 209 |  | wp\_enqueue\_script( 'verowa\_admin\_script', plugins\_url( 'js/verowa-admin-script.js', \_\_FILE\_\_ ), array(), true ); |
  |  | 208 | wp\_enqueue\_script( |
  |  | 209 | 'verowa\_admin\_script', |
  |  | 210 | plugins\_url( 'js/verowa-admin-script.js', \_\_FILE\_\_ ), |
  |  | 211 | array( 'jquery-ui-sortable' ), |
  |  | 212 | true |
  |  | 213 | ); |
  |  | 214 |  |
  | 210 | 215 | wp\_localize\_script( 'verowa\_admin\_script', 'wpApiSettings', array( |
  | 211 | 216 | 'root' => esc\_url\_raw( rest\_url() ), |

**Note:** See [TracChangeset](/wiki/TracChangeset)
for help on using the changeset viewer.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Unified Diff](?format=diff&new=3201030)
* [Zip Archive](?format=zip&new=3201030)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)


