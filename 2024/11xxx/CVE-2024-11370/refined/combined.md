=== Content from plugins.trac.wordpress.org_fdd416c1_20250115_095021.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fbrowser%2Fsubaccounts-for-woocommerce%2Ftags%2F1.5.6%2Fadmin%2Fadmin.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* [Blame](/browser/subaccounts-for-woocommerce/tags/1.5.6/admin/admin.php?annotate=blame "Annotate each line with the last changed revision (this can be time consuming...)")
* [Revision Log](/log/subaccounts-for-woocommerce/tags/1.5.6/admin/admin.php)

---

# [source:](/browser?order=name "Go to repository root") [subaccounts-for-woocommerce](/browser/subaccounts-for-woocommerce?order=name "View subaccounts-for-woocommerce")/[tags](/browser/subaccounts-for-woocommerce/tags?order=name "View tags")/[1.5.6](/browser/subaccounts-for-woocommerce/tags/1.5.6?order=name "View 1.5.6")/[admin](/browser/subaccounts-for-woocommerce/tags/1.5.6/admin?order=name "View admin")/[admin.php](/browser/subaccounts-for-woocommerce/tags/1.5.6/admin/admin.php?order=name "View admin.php")

View diff against:

View revision:

| [Last change](/changeset/3127919/subaccounts-for-woocommerce/tags/1.5.6/admin/admin.php "View differences") on this file was [3127919](/changeset/3127919/ "View changeset 3127919"), checked in by mediaticus, [6 months ago](/timeline?from=2024-07-30T07%3A54%3A40Z&precision=second "See timeline at 07/30/2024 07:54:40 AM") |
| --- |
| Deploy version 1.5.6 |
| **File size:** 70.5 KB | |

| Line |  |
| --- | --- |
| [1](#L1) | <?php |
| [2](#L2) | // Exit if accessed directly |
| [3](#L3) | if ( ! defined( 'ABSPATH' ) ) { |
| [4](#L4) | exit; |
| [5](#L5) | } |
| [6](#L6) |  |
| [7](#L7) |  |
| [8](#L8) |  |
| [9](#L9) |  |
| [10](#L10) | /\*\* |
| [11](#L11) | \* Show notice: Cart/Checkout Blocks incompatibility. |
| [12](#L12) | \* |
| [13](#L13) | \* Since 1.5.6 |
| [14](#L14) | \*/ |
| [15](#L15) | function sfwc\_add\_notice\_cart\_checkout\_blocks\_incompatibility() { |
| [16](#L16) |  |
| [17](#L17) | $show\_notice = get\_transient( 'sfwc\_show\_cart\_checkout\_blocks\_incompatibility\_notice' ); |
| [18](#L18) |  |
| [19](#L19) | if ( ( WC\_Blocks\_Utils::has\_block\_in\_page( wc\_get\_page\_id( 'checkout' ), 'woocommerce/checkout' ) || WC\_Blocks\_Utils::has\_block\_in\_page( wc\_get\_page\_id( 'cart' ), 'woocommerce/cart' ) ) && $show\_notice !== 'notice\_dismissed' )  { |
| [20](#L20) |  |
| [21](#L21) | set\_transient( 'sfwc\_show\_cart\_checkout\_blocks\_incompatibility\_notice', 'show\_notice' ); |
| [22](#L22) |  |
| [23](#L23) | $query\_arg = add\_query\_arg( |
| [24](#L24) | array( |
| [25](#L25) | 'sfwc\_ignore\_cart\_checkout\_blocks\_incompatibility\_notice' => '1', |
| [26](#L26) | 'sfwc\_nonce' => wp\_create\_nonce( 'sfwc\_ignore\_cart\_checkout\_blocks\_notice' ) |
| [27](#L27) | ) |
| [28](#L28) | ); |
| [29](#L29) |  |
| [30](#L30) | if ( ! wp\_doing\_ajax() && is\_user\_logged\_in() && ( current\_user\_can( 'update\_plugins' ) ) ) { |
| [31](#L31) | ?> |
| [32](#L32) | <div class="notice notice-warning"> |
| [33](#L33) | <h3>Subaccounts for WooCommerce</h3> |
| [34](#L34) | <p> |
| [35](#L35) | <?php echo esc\_html\_\_( 'Subaccounts for WooCommerce does not yet support block-based Cart and Checkout pages. Switch to classic shortcode-based Cart and Checkout pages to ensure proper plugin functionality and a good shopping experience.', 'subaccounts-for-woocommerce' ); ?> |
| [36](#L36) | </p> |
| [37](#L37) | <a class="button button-secondary" style="display:inline-block; max-width:100px; margin:10px 0 10px 0; text-align:center;" href="<?php echo $query\_arg; ?>"> |
| [38](#L38) | <?php echo esc\_html\_\_( 'Dismiss notice', 'subaccounts-for-woocommerce' ); ?> |
| [39](#L39) | </a> |
| [40](#L40) | </div> |
| [41](#L41) | <?php |
| [42](#L42) | } |
| [43](#L43) | } |
| [44](#L44) | } |
| [45](#L45) | add\_action('admin\_notices', 'sfwc\_add\_notice\_cart\_checkout\_blocks\_incompatibility'); |
| [46](#L46) |  |
| [47](#L47) |  |
| [48](#L48) |  |
| [49](#L49) |  |
| [50](#L50) | /\*\* |
| [51](#L51) | \* Dismiss notice: Cart/Checkout Blocks incompatibility. |
| [52](#L52) | \* |
| [53](#L53) | \* Since 1.5.6 |
| [54](#L54) | \*/ |
| [55](#L55) | function sfwc\_ignore\_notice\_cart\_checkout\_blocks\_incompatibility() { |
| [56](#L56) |  |
| [57](#L57) | if ( isset( $\_GET['sfwc\_ignore\_cart\_checkout\_blocks\_incompatibility\_notice'] ) ) { |
| [58](#L58) | $sfwc\_ignore\_cart\_checkout\_blocks\_incompatibility\_notice = sanitize\_text\_field( $\_GET['sfwc\_ignore\_cart\_checkout\_blocks\_incompatibility\_notice'] ); |
| [59](#L59) | } |
| [60](#L60) |  |
| [61](#L61) | if ( isset( $\_GET['sfwc\_nonce'] ) ) { |
| [62](#L62) | $sfwc\_nonce\_sanitized = sanitize\_text\_field( $\_GET['sfwc\_nonce'] ); |
| [63](#L63) | } |
| [64](#L64) |  |
| [65](#L65) | $show\_notice = get\_transient( 'sfwc\_show\_cart\_checkout\_blocks\_incompatibility\_notice' ); |
| [66](#L66) |  |
| [67](#L67) | if ( ! wp\_doing\_ajax() && is\_user\_logged\_in() && ( current\_user\_can( 'update\_plugins' ) ) ) { |
| [68](#L68) |  |
| [69](#L69) | if ( ( isset( $sfwc\_ignore\_cart\_checkout\_blocks\_incompatibility\_notice ) && $sfwc\_ignore\_cart\_checkout\_blocks\_incompatibility\_notice == '1' ) && $show\_notice  !== 'notice\_dismissed' ) { |
| [70](#L70) |  |
| [71](#L71) | // Verify nonce. |
| [72](#L72) | if ( isset( $sfwc\_nonce\_sanitized ) && wp\_verify\_nonce( $sfwc\_nonce\_sanitized, 'sfwc\_ignore\_cart\_checkout\_blocks\_notice' ) ) { |
| [73](#L73) | set\_transient( 'sfwc\_show\_cart\_checkout\_blocks\_incompatibility\_notice', 'notice\_dismissed' ); |
| [74](#L74) | } |
| [75](#L75) | else { |
| [76](#L76) | add\_action( 'admin\_notices', function() { |
| [77](#L77) | ?> |
| [78](#L78) | <div class="notice notice-error"> |
| [79](#L79) | <h3>Subaccounts for WooCommerce</h3> |
| [80](#L80) | <p> |
| [81](#L81) | <?php echo esc\_html\_\_( 'Notice could not be dismissed due to nonce verification failure.', 'subaccounts-for-woocommerce' ); ?> |
| [82](#L82) | </p> |
| [83](#L83) | </div> |
| [84](#L84) | <?php |
| [85](#L85) | } ); |
| [86](#L86) | } |
| [87](#L87) | } |
| [88](#L88) | } |
| [89](#L89) | } |
| [90](#L90) | add\_action('admin\_init', 'sfwc\_ignore\_notice\_cart\_checkout\_blocks\_incompatibility', 10); |
| [91](#L91) |  |
| [92](#L92) |  |
| [93](#L93) |  |
| [94](#L94) |  |
| [95](#L95) | /\*\* |
| [96](#L96) | \* After plugin update, store updated plugin information in sfwc\_plugin\_info option |
| [97](#L97) | \* and perform after update required tasks (e.g. set transient for notices to show up). |
| [98](#L98) | \* |
| [99](#L99) | \* Since 1.1.0 |
| [100](#L100) | \*/ |
| [101](#L101) | function sfwc\_set\_plugin\_info\_option() { |
| [102](#L102) |  |
| [103](#L103) | if ( ! wp\_doing\_ajax() ) { |
| [104](#L104) |  |
| [105](#L105) | $existing\_values = get\_option('sfwc\_plugin\_info'); |
| [106](#L106) |  |
| [107](#L107) | // Avoid undefined $existing\_values\_version |
| [108](#L108) | $existing\_values\_version = ( isset( $existing\_values['version'] ) ) ? $existing\_values['version'] : '0.0.0'; // On clean installs $existing\_values\_version is not set, |
| [109](#L109) | // so providing '0.0.0' as value will allow below code |
| [110](#L110) | // within version\_compare conditional to run. |
| [111](#L111) |  |
| [112](#L112) |  |
| [113](#L113) |  |
| [114](#L114) | // Check current version of the plugin against version which was stored in database from previously installed release. |
| [115](#L115) | if ( version\_compare( SFWC\_CURRENT\_VERSION, $existing\_values\_version, '>' ) ) { |
| [116](#L116) |  |
| [117](#L117) | /\*\* |
| [118](#L118) | \* If curently installed version of the plugin is greater than previous one, perform following tasks. |
| [119](#L119) | \* |
| [120](#L120) | \*/ |
| [121](#L121) |  |
| [122](#L122) |  |
| [123](#L123) | // Current Release Values. |
| [124](#L124) | // Pay attention: in case a key-value pair is removed from below array, |
| [125](#L125) | // it will be removed from database as well after option is updated. |
| [126](#L126) | $current\_values = array( |
| [127](#L127) | 'version' => SFWC\_CURRENT\_VERSION, |
| [128](#L128) | // Maybe add more. |
| [129](#L129) | ); |
| [130](#L130) |  |
| [131](#L131) |  |
| [132](#L132) | /\*\* |
| [133](#L133) | \* Insert data in database. |
| [134](#L134) | \*/ |
| [135](#L135) |  |
| [136](#L136) | // If option doesn't exist yet (introduced since 1.1.0). |
| [137](#L137) | if ( empty( $existing\_values ) ){ |
| [138](#L138) | add\_option( 'sfwc\_plugin\_info', $current\_values ); |
| [139](#L139) | } |
| [140](#L140) | // If option already exists. |
| [141](#L141) | else { |
| [142](#L142) | // Add to current values. |
| [143](#L143) | $new\_values = array\_merge( $existing\_values, $current\_values ); |
| [144](#L144) |  |
| [145](#L145) | // Update Option. |
| [146](#L146) | update\_option( 'sfwc\_plugin\_info', $new\_values ); |
| [147](#L147) | } |
| [148](#L148) |  |
| [149](#L149) | // Flush permalinks to avoid possible 'Error 404' on front-end 'subaccounts' endpoint. |
| [150](#L150) | // Especially useful for first time installs. |
| [151](#L151) | flush\_rewrite\_rules(); |
| [152](#L152) | } |
| [153](#L153) |  |
| [154](#L154) | /\*\*\* |
| [155](#L155) | // For debug |
| [156](#L156) | if ( ! empty( $existing\_values ) ) { |
| [157](#L157) | echo '<div style="margin-left:200px;"><pre>'; |
| [158](#L158) | print\_r( $existing\_values ); |
| [159](#L159) | echo '</pre></div>'; |
| [160](#L160) | } |
| [161](#L161) | \*\*\*/ |
| [162](#L162) | } |
| [163](#L163) | } |
| [164](#L164) | add\_action('admin\_init', 'sfwc\_set\_plugin\_info\_option', 20); // Priority must be lower than before sfwc\_ignore\_permalink\_update\_required\_notice() |
| [165](#L165) | // otherwise changes visible after page refresh. |
| [166](#L166) |  |
| [167](#L167) |  |
| [168](#L168) |  |
| [169](#L169) | /\*\* |
| [170](#L170) | \* Set WooCommerce screen IDs. |
| [171](#L171) | \* |
| [172](#L172) | \* This will enqueue WooCommerce CSS/JS and allow to show tooltips text on hover on: |
| [173](#L173) | \* |
| [174](#L174) | \*      - Plugin settings page |
| [175](#L175) | \*      - Admin users list |
| [176](#L176) | \*/ |
| [177](#L177) | function sfwc\_set\_wc\_screen\_ids( $screen ){ |
| [178](#L178) | $screen[] = 'woocommerce\_page\_subaccounts'; |
| [179](#L179) | $screen[] = 'users'; |
| [180](#L180) | return $screen; |
| [181](#L181) | } |
| [182](#L182) | add\_filter('woocommerce\_screen\_ids', 'sfwc\_set\_wc\_screen\_ids' ); |
| [183](#L183) |  |
| [184](#L184) | /\*\* |
| [185](#L185) | \* For debug. Keep commented. |
| [186](#L186) | \* For each admin page show current screen ID. |
| [187](#L187) | \*/ |
| [188](#L188) | /\* |
| [189](#L189) | function sfwc\_dump\_screen\_ids() { |
| [190](#L190) | var\_dump( get\_current\_screen()->id ); |
| [191](#L191) | } |
| [192](#L192) | add\_action('admin\_notices', 'sfwc\_dump\_screen\_ids'); |
| [193](#L193) | \*/ |
| [194](#L194) |  |
| [195](#L195) |  |
| [196](#L196) |  |
| [197](#L197) |  |
| [198](#L198) | /\*\* |
| [199](#L199) | \* Add Custom Links. |
| [200](#L200) | \* |
| [201](#L201) | \* Add following links next to 'Deactivate Plugin' option on plugins list page: |
| [202](#L202) | \* |
| [203](#L203) | \*      - Settings |
| [204](#L204) | \*      - Premium version of Subaccounts |
| [205](#L205) | \*/ |
| [206](#L206) | function sfwc\_settings\_plugin\_link( $links, $file ) { |
| [207](#L207) |  |
| [208](#L208) | if ( $file == 'subaccounts-for-woocommerce/subaccounts-for-woocommerce.php' ) { |
| [209](#L209) |  |
| [210](#L210) | // Insert "Settings" link at the beginning. |
| [211](#L211) | $sfwc\_settings\_link = '<a href="admin.php?page=subaccounts">' . esc\_html\_\_( 'Settings', 'subaccounts-for-woocommerce' ) . '</a>'; |
| [212](#L212) | array\_unshift( $links, $sfwc\_settings\_link ); |
| [213](#L213) |  |
| [214](#L214) | $links['get\_subaccounts\_pro'] = '<nobr style="padding-top:2px; display:block;"> |
| [215](#L215) | <a href="' . admin\_url( '/admin.php?checkout=true&page=subaccounts-pricing&plugin\_id=10457&plan\_id=17669&pricing\_id=19941&billing\_cycle=annual' ) . '" style="font-weight:bold;">' |
| [216](#L216) | . esc\_html\_\_( 'Get Subaccounts Pro', 'subaccounts-for-woocommerce' ) . ' ★ |
| [217](#L217) | </a> |
| [218](#L218) | </nobr>'; |
| [219](#L219) | } |
| [220](#L220) | return $links; |
| [221](#L221) | } |
| [222](#L222) | add\_filter('plugin\_action\_links', 'sfwc\_settings\_plugin\_link', 10, 2); |
| [223](#L223) |  |
| [224](#L224) |  |
| [225](#L225) |  |
| [226](#L226) |  |
| [227](#L227) | /\*\* |
| [228](#L228) | \* Backend style |
| [229](#L229) | \*/ |
| [230](#L230) | function sfwc\_enqueue\_backend\_style() { |
| [231](#L231) |  |
| [232](#L232) | global $pagenow; |
| [233](#L233) |  |
| [234](#L234) | $plugin\_settings\_page = isset( $\_GET['page'] ) ? sanitize\_text\_field( $\_GET['page'] ) : ''; |
| [235](#L235) |  |
| [236](#L236) | $active\_settings\_tab = isset( $\_GET['tab'] ) ? sanitize\_text\_field( $\_GET['tab'] ) : ''; |
| [237](#L237) |  |
| [238](#L238) | /\*\* |
| [239](#L239) | \* Enqueue main backend style. |
| [240](#L240) | \*/ |
| [241](#L241) | wp\_enqueue\_style( 'sfwc\_backend\_style', WP\_PLUGIN\_URL . '/subaccounts-for-woocommerce/assets/css/admin.css' ); |
| [242](#L242) |  |
| [243](#L243) |  |
| [244](#L244) | /\*\* |
| [245](#L245) | \* Enqueue Selectize JS and CSS on plugin Options page. |
| [246](#L246) | \*/ |
| [247](#L247) | if ( ! wp\_doing\_ajax() && current\_user\_can( 'administrator' ) && $pagenow == 'admin.php' && $plugin\_settings\_page == 'subaccounts' && ( $active\_settings\_tab == 'options' || $active\_settings\_tab == '' ) ) { |
| [248](#L248) |  |
| [249](#L249) | // Load Selectize JS and CSS, necessary in: Dashboard -> Users -> Edit. |
| [250](#L250) | wp\_enqueue\_style( 'sfwc\_selectize\_style', WP\_PLUGIN\_URL . '/subaccounts-for-woocommerce/assets/css/selectize/selectize.css' ); |
| [251](#L251) | wp\_enqueue\_script( 'sfwc\_selectize\_js', WP\_PLUGIN\_URL . '/subaccounts-for-woocommerce/assets/js/selectize/selectize.min.js', array( 'jquery' ), '0.13.6', false ); |
| [252](#L252) | } |
| [253](#L253) |  |
| [254](#L254) | } |
| [255](#L255) | add\_action('admin\_enqueue\_scripts', 'sfwc\_enqueue\_backend\_style'); |
| [256](#L256) |  |
| [257](#L257) |  |
| [258](#L258) |  |
| [259](#L259) |  |
| [260](#L260) | /\*\* |
| [261](#L261) | \* Display Subaccounts information on Order page. |
| [262](#L262) | \* |
| [263](#L263) | \* Add a meta box showing information about 'Manager' (and 'Supervisor' if 'Supervisor Add-on' installed) for the customer who made the order. |
| [264](#L264) | \*/ |
| [265](#L265) | // Required for the add\_meta\_box to show the meta box in case HPOS is enabled. |
| [266](#L266) | use Automattic\WooCommerce\Internal\DataStores\Orders\CustomOrdersTableController; |
| [267](#L267) | // Adding Meta container admin shop\_order pages |
| [268](#L268) | function sfwc\_add\_meta\_box() { |
| [269](#L269) |  |
| [270](#L270) | if ( ! wp\_doing\_ajax() ) { |
| [271](#L271) |  |
| [272](#L272) | // Detect if HPOS is enabled or not and assign value to the $screen variable accordingly. |
| [273](#L273) | $screen = wc\_get\_container()->get( CustomOrdersTableController::class )->custom\_orders\_table\_usage\_is\_enabled() |
| [274](#L274) | ? wc\_get\_page\_screen\_id( 'shop-order' ) |
| [275](#L275) | : 'shop\_order'; |
| [276](#L276) |  |
| [277](#L277) | $sfwc\_options = (array) get\_option('sfwc\_options'); |
| [278](#L278) |  |
| [279](#L279) | // Avoid undefined $sfwc\_options\_show\_order\_meta\_box in case related setting has not been saved yet. |
| [280](#L280) | $sfwc\_options\_show\_order\_meta\_box = ( isset( $sfwc\_options['sfwc\_options\_show\_order\_meta\_box'] ) ) ? $sfwc\_options['sfwc\_options\_show\_order\_meta\_box'] : '0'; |
| [281](#L281) |  |
| [282](#L282) | // Check if option enabled in Subaccounts > Settings > Options |
| [283](#L283) | if ( $sfwc\_options\_show\_order\_meta\_box == '1' ) { |
| [284](#L284) | add\_meta\_box('woocommerce-order-subaccounts', esc\_html\_\_( 'Subaccounts Info', 'subaccounts-for-woocommerce' ), 'sfwc\_add\_meta\_box\_content', $screen, 'side', 'core'); |
| [285](#L285) | } |
| [286](#L286) | } |
| [287](#L287) | } |
| [288](#L288) | add\_action('add\_meta\_boxes', 'sfwc\_add\_meta\_box'); // sfwc\_add\_meta\_box\_content in: includes > functions.php |
| [289](#L289) |  |
| [290](#L290) |  |
| [291](#L291) |  |
| [292](#L292) |  |
| [293](#L293) | /\*\* |
| [294](#L294) | \* Save Manager info in Order's post meta when order is created from backend. |
| [295](#L295) | \* |
| [296](#L296) | \* In case of order created from backend by admin, save Manager information in Order's post meta. |
| [297](#L297) | \* |
| [298](#L298) | \* See also: sfwc\_order\_placed\_by\_update\_order\_meta\_after\_payment function from my-account.php, |
| [299](#L299) | \* for updating Order's post meta with "order placed by" information (after the customer completes the order). |
| [300](#L300) | \*/ |
| [301](#L301) | function sfwc\_store\_subaccounts\_meta\_data\_on\_order\_creation\_admin\_side( $order\_id ) { |
| [302](#L302) |  |
| [303](#L303) | // Get Options settings. |
| [304](#L304) | $sfwc\_options = (array) get\_option('sfwc\_options'); |
| [305](#L305) |  |
| [306](#L306) | // Get Selected Roles option value from Options settings. |
| [307](#L307) | $sfwc\_option\_selected\_roles = ( isset( $sfwc\_options['sfwc\_option\_selected\_roles'] ) ) ? $sfwc\_options['sfwc\_option\_selected\_roles'] : array('customer', 'subscriber'); |
| [308](#L308) |  |
| [309](#L309) | // Get 'Subaccount Mode' from Options settings. |
| [310](#L310) | $sfwc\_option\_subaccount\_mode = ( isset( $sfwc\_options['sfwc\_option\_subaccount\_mode'] ) ) ? $sfwc\_options['sfwc\_option\_subaccount\_mode'] : 'sub\_user'; |
| [311](#L311) |  |
| [312](#L312) | if ( ! wp\_doing\_ajax() ) { |
| [313](#L313) |  |
| [314](#L314) | // Get an instance of the WC\_Order Object from the Order ID |
| [315](#L315) | $order = wc\_get\_order( $order\_id ); |
| [316](#L316) |  |
| [317](#L317) | // Get the Customer ID (User ID) |
| [318](#L318) | $customer\_id = $order->get\_user\_id(); |
| [319](#L319) |  |
| [320](#L320) | // Get Account Level Type |
| [321](#L321) | $customer\_account\_level\_type = get\_user\_meta( $customer\_id, 'sfwc\_account\_level\_type', true ); |
| [322](#L322) |  |
| [323](#L323) |  |
| [324](#L324) | $user\_query\_manager = []; // Prevent undefined variable when doing action below. |
| [325](#L325) |  |
| [326](#L326) | if ( $customer\_account\_level\_type == 'manager' || $customer\_account\_level\_type == 'supervisor' ) { |
| [327](#L327) |  |
| [328](#L328) | $manager\_id = 'none'; |
| [329](#L329) |  |
| [330](#L330) | } else { |
| [331](#L331) |  |
| [332](#L332) |  |
| [333](#L333) | /\*\* |
| [334](#L334) | \* Retrieve the ID of the manager related to Customer. |
| [335](#L335) | \*/ |
| [336](#L336) |  |
| [337](#L337) | // Get all users with user meta 'sfwc\_account\_level\_type' == 'manager' and filter only the one which has 'sfwc\_children' user\_meta containing the child ID who made the order |
| [338](#L338) | $args\_manager = array( |
| [339](#L339) | //'role'    => 'customer', |
| [340](#L340) | //'role\_\_in' => ['customer', 'subscriber'], |
| [341](#L341) | 'role\_\_in' => $sfwc\_option\_selected\_roles, |
| [342](#L342) | 'exclude' => $customer\_id, // Exclude ID of customer who made currently displayed order |
| [343](#L343) | 'orderby' => 'ID', |
| [344](#L344) | 'order' => 'ASC', |
| [345](#L345) | 'meta\_key' => 'sfwc\_account\_level\_type', |
| [346](#L346) | 'meta\_value' => 'manager', |
| [347](#L347) | 'meta\_query' => array( |
| [348](#L348) | array( |
| [349](#L349) | 'key' => 'sfwc\_children', |
| [350](#L350) | 'value' => '"'.$customer\_id.'"', |
| [351](#L351) | 'compare' => 'LIKE', |
| [352](#L352) | ), |
| [353](#L353) | ), |
| [354](#L354) | ); |
| [355](#L355) |  |
| [356](#L356) |  |
| [357](#L357) | // The User Query |
| [358](#L358) | $user\_query\_manager = new WP\_User\_Query( $args\_manager ); |
| [359](#L359) |  |
| [360](#L360) |  |
| [361](#L361) | // User Loop |
| [362](#L362) | if ( ! empty( $user\_query\_manager->get\_results() ) ) { |
| [363](#L363) |  |
| [364](#L364) | foreach ( $user\_query\_manager->get\_results() as $user ) { |
| [365](#L365) |  |
| [366](#L366) | $manager\_id = $user->ID; |
| [367](#L367) | } |
| [368](#L368) |  |
| [369](#L369) | } else { |
| [370](#L370) |  |
| [371](#L371) | $manager\_id = 'not\_set'; |
| [372](#L372) | } |
| [373](#L373) |  |
| [374](#L374) | } |
| [375](#L375) |  |
| [376](#L376) |  |
| [377](#L377) | do\_action('sfwc\_store\_additional\_subaccounts\_meta\_on\_order\_creation\_admin\_side', $order\_id, $customer\_account\_level\_type, $customer\_id, $user\_query\_manager, $manager\_id ); |
| [378](#L378) |  |
| [379](#L379) |  |
| [380](#L380) | /\*\* |
| [381](#L381) | \* Check if $manager\_id (numeric string) is a positive number. |
| [382](#L382) | \* |
| [383](#L383) | \* 3                    true |
| [384](#L384) | \* 03                   false |
| [385](#L385) | \* 3.5                  false |
| [386](#L386) | \* 3,5                  false |
| [387](#L387) | \* +3                   false |
| [388](#L388) | \* -3                   false |
| [389](#L389) | \* 1337e0               false |
| [390](#L390) | \*/ |
| [391](#L391) | if ( ( $manager\_id && is\_numeric( $manager\_id ) && $manager\_id >= 1 && preg\_match( '/^[1-9][0-9]\*$/', $manager\_id ) ) || ( $manager\_id && $manager\_id == 'not\_set' )  || ( $manager\_id && $manager\_id == 'none' ) ) { |
| [392](#L392) |  |
| [393](#L393) | $valid\_manager\_id = sanitize\_text\_field( $manager\_id ); |
| [394](#L394) |  |
| [395](#L395) | // Store the ID of the Manager related to the Customer. |
| [396](#L396) | $order->update\_meta\_data( '\_sfwc\_customer\_related\_manager', $valid\_manager\_id ); |
| [397](#L397) | } |
| [398](#L398) |  |
| [399](#L399) |  |
| [400](#L400) |  |
| [401](#L401) |  |
| [402](#L402) | /\*\* |
| [403](#L403) | \* Validate the value of 'account level type' for 'manager' and 'default' account types. |
| [404](#L404) | \* |
| [405](#L405) | \* For the validation of 'supervisor' see function: sfwc\_store\_subaccounts\_meta\_data\_on\_order\_creation\_admin\_side\_supervisor in Supervisor add-on |
| [406](#L406) | \*/ |
| [407](#L407) | $valid\_customer\_account\_level\_type = array( 'manager', 'default', '' ); |
| [408](#L408) |  |
| [409](#L409) | if ( in\_array( $customer\_account\_level\_type, $valid\_customer\_account\_level\_type ) ) { |
| [410](#L410) |  |
| [411](#L411) | // Store the customer's account level type. |
| [412](#L412) | $order->update\_meta\_data( '\_sfwc\_customer\_account\_level\_type', $customer\_account\_level\_type ); |
| [413](#L413) | } |
| [414](#L414) |  |
| [415](#L415) |  |
| [416](#L416) | /\*\* |
| [417](#L417) | \* Stores the active subaccount mode at the time the order is placed. |
| [418](#L418) | \* |
| [419](#L419) | \* Useful to determine if one or more orders have been placed in a mode other than the one currently active |
| [420](#L420) | \* and in this case perform some actions. |
| [421](#L421) | \*/ |
| [422](#L422) | $order->update\_meta\_data( '\_sfwc\_order\_placed\_during\_subaccount\_mode', sanitize\_text\_field( $sfwc\_option\_subaccount\_mode ) ); |
| [423](#L423) |  |
| [424](#L424) | $order->save(); |
| [425](#L425) |  |
| [426](#L426) | } |
| [427](#L427) | } |
| [428](#L428) | add\_action('woocommerce\_new\_order', 'sfwc\_store\_subaccounts\_meta\_data\_on\_order\_creation\_admin\_side', 10, 1);    // woocommerce\_new\_order triggered both for frontend |
| [429](#L429) | // and backend order creation; for backend only check with is\_admin. |
| [430](#L430) |  |
| [431](#L431) | // Also, woocommerce\_new\_order triggered only on order creation, |
| [432](#L432) | // but not on order update. |
| [433](#L433) |  |
| [434](#L434) | /\*\* |
| [435](#L435) | \* woocommerce\_process\_shop\_order\_meta |
| [436](#L436) | \* |
| [437](#L437) | \* Triggered only for backend order creation. |
| [438](#L438) | \* Triggered for both order creation and order update; to trigger it only in one of the two cases, |
| [439](#L439) | \* check if order already exists. |
| [440](#L440) | \*/ |
| [441](#L441) |  |
| [442](#L442) | /\* |
| [443](#L443) | function save\_order\_custom\_field\_meta( $order\_id ) { |
| [444](#L444) |  |
| [445](#L445) | // Do something... |
| [446](#L446) | } |
| [447](#L447) | add\_action( 'woocommerce\_process\_shop\_order\_meta', 'save\_order\_custom\_field\_meta' ); |
| [448](#L448) | \*/ |
| [449](#L449) |  |
| [450](#L450) |  |
| [451](#L451) |  |
| [452](#L452) |  |
| [453](#L453) | /\*\* |
| [454](#L454) | \* Create admin plugin pages/subpages: |
| [455](#L455) | \* |
| [456](#L456) | \*      - Subaccounts |
| [457](#L457) | \*              -- Settings |
| [458](#L458) | \*/ |
| [459](#L459) | function sfwc\_admin\_menu() { |
| [460](#L460) |  |
| [461](#L461) | // Add WooCommerce menu sub-page. |
| [462](#L462) | add\_submenu\_page( |
| [463](#L463) | 'woocommerce',                                                                                                                  // $parent\_slug |
| [464](#L464) | esc\_html\_\_( 'Subaccounts Options Page', 'subaccounts-for-woocommerce' ),        // $page\_title |
| [465](#L465) | esc\_html\_\_( 'Subaccounts', 'subaccounts-for-woocommerce' ),                                     // $menu\_title |
| [466](#L466) | 'manage\_woocommerce',                                                                                                   // $capability |
| [467](#L467) | 'subaccounts',                                                                                                                  // $menu\_slug |
| [468](#L468) | 'sfwc\_admin\_page\_contents',                                                                                             // $function |
| [469](#L469) | //9999                                                                                                                                  // $position |
| [470](#L470) | ); |
| [471](#L471) |  |
| [472](#L472) | } |
| [473](#L473) | add\_action('admin\_menu', 'sfwc\_admin\_menu', 60); |
| [474](#L474) |  |
| [475](#L475) |  |
| [476](#L476) |  |
| [477](#L477) |  |
| [478](#L478) |  |
| [479](#L479) | /\*\* |
| [480](#L480) | \* Create plugin's settings. |
| [481](#L481) | \* |
| [482](#L482) | \* |
| [483](#L483) | \*/ |
| [484](#L484) | function sfwc\_settings\_init() { |
| [485](#L485) |  |
| [486](#L486) | // Create Appearance Settings |
| [487](#L487) |  |
| [488](#L488) | $args\_sfwc\_switcher\_appearance = array( |
| [489](#L489) | 'type' => 'array', |
| [490](#L490) | 'sanitize\_callback' => 'sfwc\_switcher\_appearance\_validate' // validation callback |
| [491](#L491) | ); |
| [492](#L492) |  |
| [493](#L493) |  |
| [494](#L494) | register\_setting( |
| [495](#L495) | 'sfwc\_switcher\_appearance\_group',       // group, used for settings\_fields() |
| [496](#L496) | 'sfwc\_switcher\_appearance',                     // option name, used as key in database |
| [497](#L497) | $args\_sfwc\_switcher\_appearance          // $args |
| [498](#L498) | ); |
| [499](#L499) |  |
| [500](#L500) |  |
| [501](#L501) |  |
| [502](#L502) | add\_settings\_section( |
| [503](#L503) | 'sfwc\_switcher\_appearance\_section',                                                                                                             // HTML ID tag for the section |
| [504](#L504) | esc\_html\_\_( 'Frontend User Switcher Pane Appearance', 'subaccounts-for-woocommerce' ),  // Title for the section |
| [505](#L505) | '',                                                                                                                                                                     //'sfwc\_setting\_section\_callback\_function' |
| [506](#L506) | 'subaccounts'                                                                                                                                   // Menu slug, same as 4th parameter of add\_menu\_page or 5th parameter of add\_submenu\_page |
| [507](#L507) | ); |
| [508](#L508) |  |
| [509](#L509) |  |
| [510](#L510) | add\_settings\_field( |
| [511](#L511) | 'sfwc\_switcher\_pane\_bg\_color',                                                                          // HTML ID of the input element |
| [512](#L512) | esc\_html\_\_( 'Background Color:', 'subaccounts-for-woocommerce' ),       // Title displayed at the left of input element |
| [513](#L513) | 'sfwc\_switcher\_pane\_bg\_color\_html',                                                                     // Callback function for HTML input markup |
| [514](#L514) | 'subaccounts', |
| [515](#L515) | 'sfwc\_switcher\_appearance\_section' |
| [516](#L516) | ); |
| [517](#L517) |  |
| [518](#L518) | add\_settings\_field( |
| [519](#L519) | 'sfwc\_switcher\_pane\_headline\_color', |
| [520](#L520) | esc\_html\_\_( 'Headline Color:', 'subaccounts-for-woocommerce' ), |
| [521](#L521) | 'sfwc\_switcher\_pane\_headline\_color\_html', |
| [522](#L522) | 'subaccounts', |
| [523](#L523) | 'sfwc\_switcher\_appearance\_section' |
| [524](#L524) | ); |
| [525](#L525) |  |
| [526](#L526) | add\_settings\_field( |
| [527](#L527) | 'sfwc\_switcher\_pane\_text\_color', |
| [528](#L528) | esc\_html\_\_( 'Text Color:', 'subaccounts-for-woocommerce' ), |
| [529](#L529) | 'sfwc\_switcher\_pane\_text\_color\_html', |
| [530](#L530) | 'subaccounts', |
| [531](#L531) | 'sfwc\_switcher\_appearance\_section' |
| [532](#L532) | ); |
| [533](#L533) |  |
| [534](#L534) | add\_settings\_field( |
| [535](#L535) | 'sfwc\_switcher\_pane\_select\_bg\_color', |
| [536](#L536) | esc\_html\_\_( 'Button Background Color:', 'subaccounts-for-woocommerce' ), |
| [537](#L537) | 'sfwc\_switcher\_pane\_select\_bg\_color\_html', |
| [538](#L538) | 'subaccounts', |
| [539](#L539) | 'sfwc\_switcher\_appearance\_section' |
| [540](#L540) | ); |
| [541](#L541) |  |
| [542](#L542) | add\_settings\_field( |
| [543](#L543) | 'sfwc\_switcher\_pane\_select\_text\_color', |
| [544](#L544) | esc\_html\_\_( 'Button Text Color:', 'subaccounts-for-woocommerce' ), |
| [545](#L545) | 'sfwc\_switcher\_pane\_select\_text\_color\_html', |
| [546](#L546) | 'subaccounts', |
| [547](#L547) | 'sfwc\_switcher\_appearance\_section' |
| [548](#L548) | ); |
| [549](#L549) |  |
| [550](#L550) |  |
| [551](#L551) |  |
| [552](#L552) |  |
| [553](#L553) | // Create Options Settings |
| [554](#L554) |  |
| [555](#L555) | $args\_sfwc\_options = array( |
| [556](#L556) | 'type' => 'array', |
| [557](#L557) | 'sanitize\_callback' => 'sfwc\_options\_validate' // validation callback |
| [558](#L558) | ); |
| [559](#L559) |  |
| [560](#L560) | register\_setting( |
| [561](#L561) | 'sfwc\_options\_group',   // group, used for settings\_fields() |
| [562](#L562) | 'sfwc\_options',                 // option name, used as key in database |
| [563](#L563) | $args\_sfwc\_options              // $args |
| [564](#L564) | ); |
| [565](#L565) |  |
| [566](#L566) |  |
| [567](#L567) | add\_settings\_section( |
| [568](#L568) | 'sfwc\_options\_section',                                                         // HTML ID tag for the section |
| [569](#L569) | '',                                                                                                     // Title for the section |
| [570](#L570) | '',                                                                                                     //'sfwc\_setting\_section\_callback\_function' Callback for section description |
| [571](#L571) | 'subaccounts&tab=options'                                                       // Menu slug, same as 4th parameter of add\_menu\_page or 5th parameter of add\_submenu\_page |
| [572](#L572) | ); |
| [573](#L573) |  |
| [574](#L574) | // Check if function exists from PRO plugin |
| [575](#L575) | if ( ! function\_exists( 'sfwc\_pro\_settings\_init' ) ) { |
| [576](#L576) |  |
| [577](#L577) | add\_settings\_field( |
| [578](#L578) | 'sfwc\_option\_subaccount\_mode', |
| [579](#L579) | esc\_html\_\_('Subaccount Mode', 'subaccounts-for-woocommerce') |
| [580](#L580) | . '<span class="tips woocommerce-help-tip" data-tip="' . esc\_attr\_\_( 'The way the whole subaccount system should work.', 'subaccounts-for-woocommerce' ) . '"></span>', |
| [581](#L581) | 'sfwc\_option\_subaccount\_mode\_html', |
| [582](#L582) | 'subaccounts&tab=options', |
| [583](#L583) | 'sfwc\_options\_section' |
| [584](#L584) | ); |
| [585](#L585) |  |
| [586](#L586) | // Dummy: only available in Pro. |
| [587](#L587) | add\_settings\_field( |
| [588](#L588) | 'sfwc\_option\_subaccount\_creation\_dummy', |
| [589](#L589) | esc\_html\_\_('Choose who can create and add new subaccounts', 'subaccounts-for-woocommerce') |
| [590](#L590) | . '<br><a style="color:#148ff3;" href="' |
| [591](#L591) | . admin\_url( '/admin.php?checkout=true&page=subaccounts-pricing&plugin\_id=10457&plan\_id=17669&pricing\_id=19941&billing\_cycle=annual' ) . '">' |
| [592](#L592) | . esc\_html\_\_( 'Get Subaccounts Pro', 'subaccounts-for-woocommerce' ) . '</a> <span style="font-weight:400;">' |
| [593](#L593) | . esc\_html\_\_( 'and unlock this feature!', 'subaccounts-for-woocommerce' ) . '</span>', |
| [594](#L594) | 'sfwc\_option\_subaccount\_creation\_html\_dummy', |
| [595](#L595) | 'subaccounts&tab=options', |
| [596](#L596) | 'sfwc\_options\_section' |
| [597](#L597) | ); |
| [598](#L598) |  |
| [599](#L599) |  |
| [600](#L600) | add\_settings\_field( |
| [601](#L601) | 'sfwc\_option\_selected\_roles', |
| [602](#L602) | esc\_html\_\_('Select the buyer role(s) to enable the subaccount system for', 'subaccounts-for-woocommerce') |
| [603](#L603) | . '<span class="tips woocommerce-help-tip" data-tip="' . esc\_attr\_\_( 'If the parent account has a different role than the subaccount, select both the parent account and subaccount roles.', 'subaccounts-for-woocommerce' ) . '"></span>', |
| [604](#L604) | 'sfwc\_option\_selected\_roles\_html', |
| [605](#L605) | 'subaccounts&tab=options', |
| [606](#L606) | 'sfwc\_options\_section' |
| [607](#L607) | ); |
| [608](#L608) |  |
| [609](#L609) | add\_settings\_field( |
| [610](#L610) | 'sfwc\_option\_subaccounts\_number\_limit', |
| [611](#L611) | esc\_html\_\_('Maximum number of subaccounts allowed', 'subaccounts-for-woocommerce') |
| [612](#L612) | . '<span class="tips woocommerce-help-tip" data-tip="' . esc\_attr\_\_( 'Limit the number of subaccounts that a parent account can create/add.', 'subaccounts-for-woocommerce' ) . '"></span>', |
| [613](#L613) | 'sfwc\_option\_subaccounts\_number\_limit\_html', |
| [614](#L614) | 'subaccounts&tab=options', |
| [615](#L615) | 'sfwc\_options\_section' |
| [616](#L616) | ); |
| [617](#L617) |  |
| [618](#L618) | add\_settings\_field( |
| [619](#L619) | 'sfwc\_option\_display\_name', |
| [620](#L620) | esc\_html\_\_('Customer Display Name', 'subaccounts-for-woocommerce') |
| [621](#L621) | . '<span class="tips woocommerce-help-tip" data-tip="' . esc\_attr\_\_( 'Set Customer\'s Display Name across the Subaccounts Plugin.', 'subaccounts-for-woocommerce' ) . '"></span>', |
| [622](#L622) | 'sfwc\_option\_display\_name\_html', |
| [623](#L623) | 'subaccounts&tab=options', |
| [624](#L624) | 'sfwc\_options\_section' |
| [625](#L625) | ); |
| [626](#L626) |  |
| [627](#L627) | add\_settings\_field( |
| [628](#L628) | 'sfwc\_options\_enable\_user\_switcher', |
| [629](#L629) | esc\_html\_\_('Enable User Switcher', 'subaccounts-for-woocommerce') |
| [630](#L630) | . '<span class="tips woocommerce-help-tip" data-tip="' . esc\_attr\_\_( 'Allow a parent account to log-in as a subaccount.', 'subaccounts-for-woocommerce' ) . '"></span>', |
| [631](#L631) | 'sfwc\_options\_enable\_user\_switcher\_html', |
| [632](#L632) | 'subaccounts&tab=options', |
| [633](#L633) | 'sfwc\_options\_section' |
| [634](#L634) | ); |
| [635](#L635) |  |
| [636](#L636) | add\_settings\_field( |
| [637](#L637) | 'sfwc\_options\_show\_order\_meta\_box', |
| [638](#L638) | esc\_html\_\_('Show subaccounts information on WooCommerce order page', 'subaccounts-for-woocommerce') |
| [639](#L639) | . '<span class="tips woocommerce-help-tip" data-tip="' . esc\_attr\_\_( 'Add the \'Subaccount Info\' box on WooCommerce Order pages in WordPress admin area.', 'subaccounts-for-woocommerce' ) . '"></span>', |
| [640](#L640) | 'sfwc\_options\_show\_order\_meta\_box\_html', |
| [641](#L641) | 'subaccounts&tab=options', |
| [642](#L642) | 'sfwc\_options\_section' |
| [643](#L643) | ); |
| [644](#L644) | } |
| [645](#L645) | } |
| [646](#L646) | add\_action('admin\_init', 'sfwc\_settings\_init'); |
| [647](#L647) |  |
| [648](#L648) |  |
| [649](#L649) |  |
| [650](#L650) |  |
| [651](#L651) | /\* |
| [652](#L652) | function sfwc\_setting\_section\_callback\_function() { |
| [653](#L653) | echo '<p>Intro text for our settings section</p>'; |
| [654](#L654) | } |
| [655](#L655) | \*/ |
| [656](#L656) |  |
| [657](#L657) |  |
| [658](#L658) |  |
| [659](#L659) |  |
| [660](#L660) | /\*\* |
| [661](#L661) | \* Appearance Tab markup |
| [662](#L662) | \*/ |
| [663](#L663) | function sfwc\_switcher\_pane\_bg\_color\_html() { |
| [664](#L664) |  |
| [665](#L665) | // Get 'Appearance' settings |
| [666](#L666) | $sfwc\_switcher\_appearance = (array) get\_option('sfwc\_switcher\_appearance'); |
| [667](#L667) |  |
| [668](#L668) | // Get Pane Background Color. |
| [669](#L669) | $sfwc\_switcher\_pane\_bg\_color = ( isset( $sfwc\_switcher\_appearance['sfwc\_switcher\_pane\_bg\_color'] ) ) ? $sfwc\_switcher\_appearance['sfwc\_switcher\_pane\_bg\_color'] : '#def6ff'; |
| [670](#L670) | ?> |
| [671](#L671) |  |
| [672](#L672) | <!-- <label for="my-input"><?php esc\_html\_e('My Input'); ?></label> --> |
| [673](#L673) | <input type="text" id="sfwc\_switcher\_pane\_bg\_color" name="sfwc\_switcher\_appearance[sfwc\_switcher\_pane\_bg\_color]" value="<?php echo esc\_attr( $sfwc\_switcher\_pane\_bg\_color ); ?>" class="sfwc-color-field" data-default-color="#def6ff" /> |
| [674](#L674) |  |
| [675](#L675) | <?php |
| [676](#L676) | } |
| [677](#L677) |  |
| [678](#L678) | function sfwc\_switcher\_pane\_headline\_color\_html() { |
| [679](#L679) |  |
| [680](#L680) | // Get 'Appearance' settings |
| [681](#L681) | $sfwc\_switcher\_appearance = (array) get\_option('sfwc\_switcher\_appearance'); |
| [682](#L682) |  |
| [683](#L683) | // Get Pane Headline Color |
| [684](#L684) | $sfwc\_switcher\_pane\_headline\_color = ( isset( $sfwc\_switcher\_appearance['sfwc\_switcher\_pane\_headline\_color'] ) ) ? $sfwc\_switcher\_appearance['sfwc\_switcher\_pane\_headline\_color'] : '#0088cc'; |
| [685](#L685) | ?> |
| [686](#L686) |  |
| [687](#L687) | <input type="text" id="sfwc\_switcher\_pane\_headline\_color" name="sfwc\_switcher\_appearance[sfwc\_switcher\_pane\_headline\_color]" value="<?php echo esc\_attr( $sfwc\_switcher\_pane\_headline\_color ); ?>" class="sfwc-color-field" data-default-color="#0088cc" /> |
| [688](#L688) |  |
| [689](#L689) | <?php |
| [690](#L690) | } |
| [691](#L691) |  |
| [692](#L692) | function sfwc\_switcher\_pane\_text\_color\_html() { |
| [693](#L693) |  |
| [694](#L694) | // Get 'Appearance' settings |
| [695](#L695) | $sfwc\_switcher\_appearance = (array) get\_option('sfwc\_switcher\_appearance'); |
| [696](#L696) |  |
| [697](#L697) | // Get Pane Text Color. |
| [698](#L698) | $sfwc\_switcher\_pane\_text\_color = ( isset( $sfwc\_switcher\_appearance['sfwc\_switcher\_pane\_text\_color'] ) ) ? $sfwc\_switcher\_appearance['sfwc\_switcher\_pane\_text\_color'] : '#3b3b3b'; |
| [699](#L699) | ?> |
| [700](#L700) |  |
| [701](#L701) | <input type="text" id="sfwc\_switcher\_pane\_text\_color" name="sfwc\_switcher\_appearance[sfwc\_switcher\_pane\_text\_color]" value="<?php echo esc\_attr( $sfwc\_switcher\_pane\_text\_color ); ?>" class="sfwc-color-field" data-default-color="#3b3b3b" /> |
| [702](#L702) |  |
| [703](#L703) | <?php |
| [704](#L704) | } |
| [705](#L705) |  |
| [706](#L706) | function sfwc\_switcher\_pane\_select\_bg\_color\_html() { |
| [707](#L707) |  |
| [708](#L708) | // Get 'Appearance' settings |
| [709](#L709) | $sfwc\_switcher\_appearance = (array) get\_option('sfwc\_switcher\_appearance'); |
| [710](#L710) |  |
| [711](#L711) | // Get Pane Select Button Background Color. |
| [712](#L712) | $sfwc\_switcher\_pane\_select\_bg\_color = ( isset( $sfwc\_switcher\_appearance['sfwc\_switcher\_pane\_select\_bg\_color'] ) ) ? $sfwc\_switcher\_appearance['sfwc\_switcher\_pane\_select\_bg\_color'] : '#0088cc'; |
| [713](#L713) | ?> |
| [714](#L714) |  |
| [715](#L715) | <input type="text" id="sfwc\_switcher\_pane\_select\_bg\_color" name="sfwc\_switcher\_appearance[sfwc\_switcher\_pane\_select\_bg\_color]" value="<?php echo esc\_attr( $sfwc\_switcher\_pane\_select\_bg\_color ); ?>" class="sfwc-color-field" data-default-color="#0088cc" /> |
| [716](#L716) |  |
| [717](#L717) | <?php |
| [718](#L718) | } |
| [719](#L719) |  |
| [720](#L720) | function sfwc\_switcher\_pane\_select\_text\_color\_html() { |
| [721](#L721) |  |
| [722](#L722) | // Get 'Appearance' settings. |
| [723](#L723) | $sfwc\_switcher\_appearance = (array) get\_option('sfwc\_switcher\_appearance'); |
| [724](#L724) |  |
| [725](#L725) | // Get Pane Select Button Text Color. |
| [726](#L726) | $sfwc\_switcher\_pane\_select\_text\_color = ( isset( $sfwc\_switcher\_appearance['sfwc\_switcher\_pane\_select\_text\_color'] ) ) ? $sfwc\_switcher\_appearance['sfwc\_switcher\_pane\_select\_text\_color'] : '#ffffff'; |
| [727](#L727) | ?> |
| [728](#L728) |  |
| [729](#L729) | <input type="text" id="sfwc\_switcher\_pane\_select\_text\_color" name="sfwc\_switcher\_appearance[sfwc\_switcher\_pane\_select\_text\_color]" value="<?php echo esc\_attr( $sfwc\_switcher\_pane\_select\_text\_color ); ?>" class="sfwc-color-field" data-default-color="#ffffff" /> |
| [730](#L730) |  |
| [731](#L731) | <?php |
| [732](#L732) | } |
| [733](#L733) |  |
| [734](#L734) | /\*\* |
| [735](#L735) | \* Options Tab markup |
| [736](#L736) | \*/ |
| [737](#L737) | function sfwc\_option\_subaccount\_mode\_html() { |
| [738](#L738) |  |
| [739](#L739) | // Get 'Options' settings. |
| [740](#L740) | $sfwc\_options = (array) get\_option( 'sfwc\_options' ); |
| [741](#L741) |  |
| [742](#L742) | // Get Subaccount mode. |
| [743](#L743) | $sfwc\_option\_subaccount\_mode = ( isset( $sfwc\_options['sfwc\_option\_subaccount\_mode'] ) ) ? $sfwc\_options['sfwc\_option\_subaccount\_mode'] : 'sub\_user'; |
| [744](#L744) | ?> |
| [745](#L745) |  |
| [746](#L746) | <input style="float:left;clear:left;position:relative;top:5px;" type="radio" name="sfwc\_options[sfwc\_option\_subaccount\_mode]" value="sub\_user" id="sub\_user" <?php checked('sub\_user', $sfwc\_option\_subaccount\_mode, true); ?> > |
| [747](#L747) | <label style="float:left;clear:right;margin-bottom:15px;" for="sub\_user"><?php esc\_html\_e( 'Sub-User', 'subaccounts-for-woocommerce' ); ?> |
| [748](#L748) | <br> |
| [749](#L749) | <span style="color:#74808c;"><?php echo esc\_html\_\_( "Multiple separate accounts grouped together under one parent account (e.g. Holding Company).", 'subaccounts-for-woocommerce' ); ?></span><br> |
| [750](#L750) | </label> |
| [751](#L751) |  |
| [752](#L752) |  |
| [753](#L753) | <input style="float:left;clear:left;position:relative;top:5px;" type="radio" name="sfwc\_options[sfwc\_option\_subaccount\_mode]" value="multi\_user" id="multi\_user" <?php checked('multi\_user', $sfwc\_option\_subaccount\_mode, true); ?> > |
| [754](#L754) | <label style="float:left;clear:right;margin-bottom:15px;" for="multi\_user"><?php esc\_html\_e( 'Multi-User', 'subaccounts-for-woocommerce' ); ?> |
| [755](#L755) | <br> |
| [756](#L756) | <span style="color:#74808c;"><?php echo esc\_html\_\_( "Multiple users have access to a same master account (useful in case of Corporate Accounts).", 'subaccounts-for-woocommerce' ); ?></span><br> |
| [757](#L757) | </label> |
| [758](#L758) |  |
| [759](#L759) | <?php |
| [760](#L760) | } |
| [761](#L761) |  |
| [762](#L762) |  |
| [763](#L763) |  |
| [764](#L764) |  |
| [765](#L765) | function sfwc\_option\_subaccount\_creation\_html\_dummy() { // Dummy: only available in Pro. |
| [766](#L766) | ?> |
| [767](#L767) | <input title="<?php esc\_attr\_e( 'This feature is only available on Subaccounts Pro', 'subaccounts-for-woocommerce'); ?>" type="radio" name="sfwc\_set\_subaccounts\_option" value="" disabled> |
| [768](#L768) | <label for=""><?php esc\_html\_e('Admin Only', 'subaccounts-for-woocommerce'); ?></label><br> |
| [769](#L769) |  |
| [770](#L770) | <input title="<?php esc\_attr\_e( 'This feature is only available on Subaccounts Pro', 'subaccounts-for-woocommerce'); ?>" type="radio" name="sfwc\_set\_subaccounts\_option" value="" disabled checked> |
| [771](#L771) | <label for=""><?php esc\_html\_e('Customers Only', 'subaccounts-for-woocommerce'); ?></label><br> |
| [772](#L772) |  |
| [773](#L773) | <input title="<?php esc\_attr\_e( 'This feature is only available on Subaccounts Pro', 'subaccounts-for-woocommerce'); ?>" type="radio" name="sfwc\_set\_subaccounts\_option" value="" disabled> |
| [774](#L774) | <label for=""><?php esc\_html\_e('Both Admin and Customers', 'subaccounts-for-woocommerce'); ?></label> |
| [775](#L775) |  |
| [776](#L776) | <p style="margin-top:8px;"> |
| [777](#L777) |  |
| [778](#L778) | <?php |
| [779](#L779) | $important\_strong = '<strong>' . esc\_html\_\_( 'Important:', 'subaccounts-for-woocommerce' ) . '</strong>'; |
| [780](#L780) | $subaccounts\_menu\_item = '<em>' . esc\_html\_\_( 'Subaccounts', 'subaccounts-for-woocommerce' ) . '</em>'; |
| [781](#L781) | $my\_account\_translation = '<em>' . esc\_html\_\_( 'My Account', 'subaccounts-for-woocommerce' ) . '</em>'; |
| [782](#L782) | $permalink\_path = '<em>' . esc\_html\_\_( 'Settings', 'subaccounts-for-woocommerce' ) . '</em> ➝ <em>' . esc\_html\_\_( 'Permalinks', 'subaccounts-for-woocommerce' ) . '</em>'; |
| [783](#L783) | $save\_changes = '<em>' . esc\_html\_\_( 'Save Changes', 'subaccounts-for-woocommerce' ) . '</em>'; |
| [784](#L784) |  |
| [785](#L785) |  |
| [786](#L786) | printf( |
| [787](#L787) | esc\_html\_\_( '%1$s in case the %2$s menu item is not shown on the %3$s page, please update the WordPress permalinks structure by going to: %4$s and clicking %5$s.', 'subaccounts-for-woocommerce' ), |
| [788](#L788) | $important\_strong, |
| [789](#L789) | $subaccounts\_menu\_item, |
| [790](#L790) | $my\_account\_translation, |
| [791](#L791) | $permalink\_path, |
| [792](#L792) | $save\_changes |
| [793](#L793) | ); |
| [794](#L794) | ?> |
| [795](#L795) |  |
| [796](#L796) | </p> |
| [797](#L797) | <?php |
| [798](#L798) | } |
| [799](#L799) |  |
| [800](#L800) | function sfwc\_option\_selected\_roles\_html() { |
| [801](#L801) |  |
| [802](#L802) | global $wp\_roles; |
| [803](#L803) |  |
| [804](#L804) | if ( ! isset( $wp\_roles ) ) { |
| [805](#L805) | $wp\_roles = new WP\_Roles(); |
| [806](#L806) | } |
| [807](#L807) |  |
| [808](#L808) | $roles = $wp\_roles->get\_names(); |
| [809](#L809) |  |
| [810](#L810) | // Get 'Options' settings |
| [811](#L811) | $sfwc\_options = (array) get\_option('sfwc\_options'); |
| [812](#L812) |  |
| [813](#L813) | // Get Selected Roles option value. |
| [814](#L814) | $sfwc\_option\_selected\_roles = ( isset( $sfwc\_options['sfwc\_option\_selected\_roles'] ) ) ? $sfwc\_options['sfwc\_option\_selected\_roles'] : array('customer', 'subscriber'); |
| [815](#L815) |  |
| [816](#L816) | // All potential WordPress user capabilities (excluding Super Admin ones), including those added by WooCommerce. |
| [817](#L817) | // Following capabilities, if all present, represent capabilities granted for Admin users. |
| [818](#L818) | $all\_potential\_wp\_capabilities = array( 'switch\_themes'=>1, 'edit\_themes'=>1, 'activate\_plugins'=>1, 'edit\_plugins'=>1, 'edit\_users'=>1, |
| [819](#L819) | 'edit\_files'=>1, 'manage\_options'=>1, 'moderate\_comments'=>1, 'manage\_categories'=>1, 'manage\_links'=>1, 'upload\_files'=>1, 'import'=>1, |
| [820](#L820) | 'unfiltered\_html'=>1, 'edit\_posts'=>1, 'edit\_others\_posts'=>1, 'edit\_published\_posts'=>1, 'publish\_posts'=>1, 'edit\_pages'=>1, |
| [821](#L821) | 'read'=>1, 'edit\_others\_pages'=>1, 'edit\_published\_pages'=>1, 'publish\_pages'=>1, 'delete\_pages'=>1, 'delete\_others\_pages'=>1, |
| [822](#L822) | 'delete\_published\_pages'=>1, 'delete\_posts'=>1, 'delete\_others\_posts'=>1, 'delete\_published\_posts'=>1, 'delete\_private\_posts'=>1, |
| [823](#L823) | 'edit\_private\_posts'=>1, 'read\_private\_posts'=>1, 'delete\_private\_pages'=>1, 'edit\_private\_pages'=>1, 'read\_private\_pages'=>1, |
| [824](#L824) | 'delete\_users'=>1, 'create\_users'=>1, 'unfiltered\_upload'=>1, 'edit\_dashboard'=>1, 'update\_plugins'=>1, 'delete\_plugins'=>1, |
| [825](#L825) | 'install\_plugins'=>1, 'update\_themes'=>1, 'install\_themes'=>1, 'update\_core'=>1, 'list\_users'=>1, 'remove\_users'=>1, 'promote\_users'=>1, |
| [826](#L826) | 'edit\_theme\_options'=>1, 'delete\_themes'=>1, 'export'=>1, 'manage\_woocommerce'=>1, 'view\_woocommerce\_reports'=>1, 'edit\_product'=>1, |
| [827](#L827) | 'read\_product'=>1, 'delete\_product'=>1, 'edit\_products'=>1, 'edit\_others\_products'=>1, 'publish\_products'=>1, 'read\_private\_products'=>1, |
| [828](#L828) | 'delete\_products'=>1, 'delete\_private\_products'=>1, 'delete\_published\_products'=>1, 'delete\_others\_products'=>1, 'edit\_private\_products'=>1, |
| [829](#L829) | 'edit\_published\_products'=>1, 'manage\_product\_terms'=>1, 'edit\_product\_terms'=>1, 'delete\_product\_terms'=>1, 'assign\_product\_terms'=>1, |
| [830](#L830) | 'edit\_shop\_order'=>1, 'read\_shop\_order'=>1, 'delete\_shop\_order'=>1, 'edit\_shop\_orders'=>1, 'edit\_others\_shop\_orders'=>1, 'publish\_shop\_orders'=>1, |
| [831](#L831) | 'read\_private\_shop\_orders'=>1, 'delete\_shop\_orders'=>1, 'delete\_private\_shop\_orders'=>1, 'delete\_published\_shop\_orders'=>1, |
| [832](#L832) | 'delete\_others\_shop\_orders'=>1, 'edit\_private\_shop\_orders'=>1, 'edit\_published\_shop\_orders'=>1, 'manage\_shop\_order\_terms'=>1, |
| [833](#L833) | 'edit\_shop\_order\_terms'=>1, 'delete\_shop\_order\_terms'=>1, 'assign\_shop\_order\_terms'=>1, 'edit\_shop\_coupon'=>1, 'read\_shop\_coupon'=>1, |
| [834](#L834) | 'delete\_shop\_coupon'=>1, 'edit\_shop\_coupons'=>1, 'edit\_others\_shop\_coupons'=>1, 'publish\_shop\_coupons'=>1, 'read\_private\_shop\_coupons'=>1, |
| [835](#L835) | 'delete\_shop\_coupons'=>1, 'delete\_private\_shop\_coupons'=>1, 'delete\_published\_shop\_coupons'=>1, 'delete\_others\_shop\_coupons'=>1, |
| [836](#L836) | 'edit\_private\_shop\_coupons'=>1, 'edit\_published\_shop\_coupons'=>1, 'manage\_shop\_coupon\_terms'=>1, 'edit\_shop\_coupon\_terms'=>1, |
| [837](#L837) | 'delete\_shop\_coupon\_terms'=>1, 'assign\_shop\_coupon\_terms'=>1, 'ure\_edit\_roles'=>1, 'ure\_create\_roles'=>1, 'ure\_delete\_roles'=>1, |
| [838](#L838) | 'ure\_create\_capabilities'=>1, 'ure\_delete\_capabilities'=>1, 'ure\_manage\_options'=>1, 'ure\_reset\_roles'=>1, 'create\_posts'=>1, |
| [839](#L839) | 'install\_languages'=>1, 'resume\_plugins'=>1, 'resume\_themes'=>1, 'view\_site\_health\_checks'=>1 ); |
| [840](#L840) |  |
| [841](#L841) | echo '<div style="max-width:28rem;">'; |
| [842](#L842) | echo '<select id="sfwc\_option\_selected\_roles" name="sfwc\_options[sfwc\_option\_selected\_roles][]" multiple>'; |
| [843](#L843) |  |
| [844](#L844) | if ( ! empty( $roles ) ) { |
| [845](#L845) |  |
| [846](#L846) | foreach ( $roles as $role => $value ) { |
| [847](#L847) |  |
| [848](#L848) | $selected = in\_array( $role, $sfwc\_option\_selected\_roles ) ? ' selected="selected" ' : ''; |
| [849](#L849) |  |
| [850](#L850) | $role\_capabilities = get\_role( $role )->capabilities; |
| [851](#L851) |  |
| [852](#L852) |  |
| [853](#L853) | if ( defined( 'SFWC\_VALID\_ROLE\_LOOSE\_MODE' ) && SFWC\_VALID\_ROLE\_LOOSE\_MODE == true ) { |
| [854](#L854) |  |
| [855](#L855) | /\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\* |
| [856](#L856) | \* Loose Method  \* |
| [857](#L857) | \*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*/ |
| [858](#L858) |  |
| [859](#L859) | if ( ! empty( $role\_capabilities ) ) { |
| [860](#L860) |  |
| [861](#L861) | if ( array\_key\_exists( 'read', $role\_capabilities ) && ! array\_key\_exists( 'edit\_posts', $role\_capabilities ) ) { |
| [862](#L862) |  |
| [863](#L863) | printf( |
| [864](#L864) | '<option value="%1$s"' . $selected . '>%2$s</option>', |
| [865](#L865) | esc\_attr( $role ), |
| [866](#L866) | esc\_html( translate\_user\_role( $value ) ) |
| [867](#L867) | ); |
| [868](#L868) | } |
| [869](#L869) | } |
| [870](#L870) | } |
| [871](#L871) | else { |
| [872](#L872) |  |
| [873](#L873) | /\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\* |
| [874](#L874) | \* Strict Method \* |
| [875](#L875) | \*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*/ |
| [876](#L876) |  |
| [877](#L877) | $result = array\_intersect\_key( $role\_capabilities, $all\_potential\_wp\_capabilities ); |
| [878](#L878) |  |
| [879](#L879) | #print\_r( $result ); |
| [880](#L880) |  |
| [881](#L881) | if ( ! empty( $result ) && count( $result ) === 1 && key( $result ) == 'read' ) { |
| [882](#L882) |  |
| [883](#L883) | printf( |
| [884](#L884) | '<option value="%1$s"' . $selected . '>%2$s</option>', |
| [885](#L885) | esc\_attr( $role ), |
| [886](#L886) | esc\_html( translate\_user\_role( $value ) ) |
| [887](#L887) | ); |
| [888](#L888) | } |
| [889](#L889) | } |
| [890](#L890) | } |
| [891](#L891) | } |
| [892](#L892) |  |
| [893](#L893) | echo '</select>'; |
| [894](#L894) | echo '<p>' . esc\_html\_\_( "Only roles eligible for the subaccount system are available for selection.", 'subaccounts-for-woocommerce' ) .'<p>'; |
| [895](#L895) | echo '</div>'; |
| [896](#L896) | ?> |
| [897](#L897) |  |
| [898](#L898) | <script> |
| [899](#L899) | jQuery(document).ready(function ($) { |
| [900](#L900) | // Initialize Selectize. |
| [901](#L901) | $("#sfwc\_option\_selected\_roles").selectize({ |
| [902](#L902) | placeholder: 'Select role...', |
| [903](#L903) | plugins: |
| [904](#L904) | [ |
| [905](#L905) | "remove\_button", |
| [906](#L906) | ] |
| [907](#L907) | }); |
| [908](#L908) | }); |
| [909](#L909) | </script> |
| [910](#L910) |  |
| [911](#L911) | <?php |
| [912](#L912) | } |
| [913](#L913) |  |
| [914](#L914) | function sfwc\_option\_subaccounts\_number\_limit\_html() { |
| [915](#L915) |  |
| [916](#L916) | // Get 'Options' settings |
| [917](#L917) | $sfwc\_options = (array) get\_option('sfwc\_options'); |
| [918](#L918) |  |
| [919](#L919) | // Get Subaccounts Number Limit option value. |
| [920](#L920) | $sfwc\_option\_subaccounts\_number\_limit = ( isset( $sfwc\_options['sfwc\_option\_subaccounts\_number\_limit'] ) ) ? $sfwc\_options['sfwc\_option\_subaccounts\_number\_limit'] : 10; |
| [921](#L921) | ?> |
| [922](#L922) |  |
| [923](#L923) | <input type="number" id="sfwc\_option\_subaccounts\_number\_limit" name="sfwc\_options[sfwc\_option\_subaccounts\_number\_limit]" value="<?php echo esc\_attr( $sfwc\_option\_subaccounts\_number\_limit ); ?>" style="max-width:65px;" <?php echo ( ! is\_plugin\_active( 'subaccounts-for-woocommerce-pro/subaccounts-for-woocommerce-pro.php' ) ? 'min="1" max="10"' : 'min="0"' ); ?> /> |
| [924](#L924) | <?php |
| [925](#L925) | esc\_html\_e( "Set 0 for unlimited", 'subaccounts-for-woocommerce' ); |
| [926](#L926) |  |
| [927](#L927) | if ( ! is\_plugin\_active( 'subaccounts-for-woocommerce-pro/subaccounts-for-woocommerce-pro.php' ) ) { |
| [928](#L928) |  |
| [929](#L929) | /\* |
| [930](#L930) | $subaccounts\_pro = '<a style="color: #148ff3; font-weight: 600;" href="' . |
| [931](#L931) | admin\_url( '/admin.php?checkout=true&page=subaccounts-pricing&plugin\_id=10457&plan\_id=17669&pricing\_id=19941&billing\_cycle=annual' ) . |
| [932](#L932) | '">Subaccounts Pro</a>'; |
| [933](#L933) | \*/ |
| [934](#L934) |  |
| [935](#L935) | $subaccounts\_pro = 'Subaccounts Pro'; |
| [936](#L936) |  |
| [937](#L937) | printf( |
| [938](#L938) | ' (' . esc\_html\_\_( '%1$s required', 'subaccounts-for-woocommerce' ) . ')', |
| [939](#L939) | $subaccounts\_pro |
| [940](#L940) | ); |
| [941](#L941) | } |
| [942](#L942) | echo '.'; |
| [943](#L943) | } |
| [944](#L944) |  |
| [945](#L945) | function sfwc\_option\_display\_name\_html() { |
| [946](#L946) |  |
| [947](#L947) | // Get 'Options' settings. |
| [948](#L948) | $sfwc\_options = (array) get\_option( 'sfwc\_options' ); |
| [949](#L949) |  |
| [950](#L950) | // Get Display Name mode. |
| [951](#L951) | $sfwc\_option\_display\_name = ( isset( $sfwc\_options['sfwc\_option\_display\_name'] ) ) ? $sfwc\_options['sfwc\_option\_display\_name'] : 'username'; |
| [952](#L952) | ?> |
| [953](#L953) |  |
| [954](#L954) |  |
| [955](#L955) | <input style="float:left;clear:left;position:relative;top:5px;" type="radio" name="sfwc\_options[sfwc\_option\_display\_name]" value="username" id="username" <?php checked('username', $sfwc\_option\_display\_name, true); ?> > |
| [956](#L956) | <label style="float:left;clear:right;margin-bottom:15px;" for="username"><?php esc\_html\_e( 'Username + Email', 'subaccounts-for-woocommerce' ); ?><br> |
| [957](#L957) | <span style="color:#74808c;"><strong><?php esc\_html\_e( 'Example:', 'subaccounts-for-woocommerce' ); ?></strong> John.doe - [ johndoe@email.com ]</span></label><br><br> |
| [958](#L958) |  |
| [959](#L959) |  |
| [960](#L960) | <input style="float:left;clear:left;position:relative;top:5px;" type="radio" name="sfwc\_options[sfwc\_option\_display\_name]" value="full\_name" id="full\_name" <?php checked('full\_name', $sfwc\_option\_display\_name, true); ?> > |
| [961](#L961) | <label style="float:left;clear:right;margin-bottom:15px;" for="full\_name"><?php esc\_html\_e( 'Full Name + Email', 'subaccounts-for-woocommerce' ); ?><br> |
| [962](#L962) | <span style="color:#74808c;"><strong><?php esc\_html\_e( 'Example:', 'subaccounts-for-woocommerce' ); ?></strong> John Doe - [ johndoe@email.com ]</span><br> |
| [963](#L963) | <em><?php esc\_html\_e( "If neither the First Name nor Last Name have been set, the customer's Username will be shown as a fallback.", "subaccounts-for-woocommerce" ); ?></em> |
| [964](#L964) | </label><br><br> |
| [965](#L965) |  |
| [966](#L966) |  |
| [967](#L967) | <input style="float:left;clear:left;position:relative;top:5px;" type="radio" name="sfwc\_options[sfwc\_option\_display\_name]" value="company\_name" id="company\_name" <?php checked('company\_name', $sfwc\_option\_display\_name, true); ?> > |
| [968](#L968) | <label style="float:left;clear:right;margin-bottom:15px;" for="company\_name"><?php esc\_html\_e( 'Company + Email', 'subaccounts-for-woocommerce' ); ?><br> |
| [969](#L969) | <span style="color:#74808c;"><strong><?php esc\_html\_e( 'Example:', 'subaccounts-for-woocommerce' ); ?></strong> Enterprise Inc - [ johndoe@email.com ]</span><br> |
| [970](#L970) | <em><?php esc\_html\_e( "If no Company Name has been set, the customer's Username will be shown as a fallback.", "subaccounts-for-woocommerce" ); ?></em> |
| [971](#L971) | </label> |
| [972](#L972) |  |
| [973](#L973) | <?php |
| [974](#L974) | } |
| [975](#L975) |  |
| [976](#L976) | function sfwc\_options\_enable\_user\_switcher\_html() { |
| [977](#L977) |  |
| [978](#L978) | // Get 'Options' settings |
| [979](#L979) | $sfwc\_options = (array) get\_option('sfwc\_options'); |
| [980](#L980) |  |
| [981](#L981) | // Get Show Meta Box value |
| [982](#L982) | $sfwc\_options\_enable\_user\_switcher = ( isset( $sfwc\_options['sfwc\_options\_enable\_user\_switcher'] ) ) ? $sfwc\_options['sfwc\_options\_enable\_user\_switcher'] : 1; |
| [983](#L983) | ?> |
| [984](#L984) |  |
| [985](#L985) | <input type="checkbox" id="sfwc\_options\_enable\_user\_switcher" name="sfwc\_options[sfwc\_options\_enable\_user\_switcher]" value="1" <?php checked(1, $sfwc\_options\_enable\_user\_switcher, true) ?> /> |
| [986](#L986) | <?php |
| [987](#L987) | esc\_html\_e( "Useful in case you want to allow a parent account to place orders on behalf of subaccounts.", 'subaccounts-for-woocommerce' ); |
| [988](#L988) | } |
| [989](#L989) |  |
| [990](#L990) |  |
| [991](#L991) |  |
| [992](#L992) |  |
| [993](#L993) | function sfwc\_options\_show\_order\_meta\_box\_html() { |
| [994](#L994) |  |
| [995](#L995) | // Get 'Options' settings |
| [996](#L996) | $sfwc\_options = (array) get\_option('sfwc\_options'); |
| [997](#L997) |  |
| [998](#L998) | // Get Show Meta Box value |
| [999](#L999) | $sfwc\_options\_show\_order\_meta\_box = ( isset( $sfwc\_options['sfwc\_options\_show\_order\_meta\_box'] ) ) ? $sfwc\_options['sfwc\_options\_show\_order\_meta\_box'] : 0; |
| [1000](#L1000) | ?> |
| [1001](#L1001) |  |
| [1002](#L1002) | <input type="checkbox" id="sfwc\_options\_show\_order\_meta\_box" name="sfwc\_options[sfwc\_options\_show\_order\_meta\_box]" value="1" <?php checked(1, $sfwc\_options\_show\_order\_meta\_box, true) ?> /> |
| [1003](#L1003) | <?php |
| [1004](#L1004) | esc\_html\_e( "You may need to enable this under 'Screen Options' too.", 'subaccounts-for-woocommerce' ); |
| [1005](#L1005) | } |
| [1006](#L1006) |  |
| [1007](#L1007) |  |
| [1008](#L1008) |  |
| [1009](#L1009) |  |
| [1010](#L1010) | /\*\* |
| [1011](#L1011) | \* Appearance Options Validation. |
| [1012](#L1012) | \*/ |
| [1013](#L1013) | function sfwc\_switcher\_appearance\_validate( $input ) { |
| [1014](#L1014) |  |
| [1015](#L1015) | // Create our array for storing the validated options. |
| [1016](#L1016) | $output = array(); |
| [1017](#L1017) |  |
| [1018](#L1018) | // Loop through each of the incoming options. |
| [1019](#L1019) | foreach ( $input as $key => $value ) { |
| [1020](#L1020) |  |
| [1021](#L1021) | // Check if the current option has a value. |
| [1022](#L1022) | if ( isset( $input[$key] ) ) { |
| [1023](#L1023) |  |
| [1024](#L1024) | // if user insert a HEX color with #. |
| [1025](#L1025) | if ( preg\_match( '/^#[0-9a-fA-F]{6}$/i', $input[$key] ) ) { |
| [1026](#L1026) |  |
| [1027](#L1027) | // Sanitization should not be required here due to strict preg\_match comparison, anyway... |
| [1028](#L1028) | $output[$key] = sanitize\_text\_field( $input[$key] ); |
| [1029](#L1029) | } else { |
| [1030](#L1030) |  |
| [1031](#L1031) | if ( $input[$key] == $input['sfwc\_switcher\_pane\_bg\_color'] ) { |
| [1032](#L1032) |  |
| [1033](#L1033) | add\_settings\_error( 'sfwc\_settings\_messages', 'sfwc\_wrong\_hex\_color', esc\_html\_\_( 'Incorrect value entered for: Background Color.', 'subaccounts-for-woocommerce' ), 'warning' ); |
| [1034](#L1034) | } |
| [1035](#L1035) | if ( $input[$key] == $input['sfwc\_switcher\_pane\_headline\_color'] ) { |
| [1036](#L1036) |  |
| [1037](#L1037) | add\_settings\_error( 'sfwc\_settings\_messages', 'sfwc\_wrong\_hex\_color', esc\_html\_\_( 'Incorrect value entered for: Headline Color.', 'subaccounts-for-woocommerce' ), 'warning' ); |
| [1038](#L1038) | } |
| [1039](#L1039) | if ( $input[$key] == $input['sfwc\_switcher\_pane\_text\_color'] ) { |
| [1040](#L1040) |  |
| [1041](#L1041) | add\_settings\_error( 'sfwc\_settings\_messages', 'sfwc\_wrong\_hex\_color', esc\_html\_\_( 'Incorrect value entered for: Text Color.', 'subaccounts-for-woocommerce' ), 'warning' ); |
| [1042](#L1042) | } |
| [1043](#L1043) | if ( $input[$key] == $input['sfwc\_switcher\_pane\_select\_bg\_color'] ) { |
| [1044](#L1044) |  |
| [1045](#L1045) | add\_settings\_error( 'sfwc\_settings\_messages', 'sfwc\_wrong\_hex\_color', esc\_html\_\_( 'Incorrect value entered for: Button Background Color.', 'subaccounts-for-woocommerce' ), 'warning' ); |
| [1046](#L1046) | } |
| [1047](#L1047) | if ( $input[$key] == $input['sfwc\_switcher\_pane\_select\_text\_color'] ) { |
| [1048](#L1048) |  |
| [1049](#L1049) | add\_settings\_error( 'sfwc\_settings\_messages', 'sfwc\_wrong\_hex\_color', esc\_html\_\_( 'Incorrect value entered for: Button Text Color.', 'subaccounts-for-woocommerce' ), 'warning' ); |
| [1050](#L1050) | } |
| [1051](#L1051) | } |
| [1052](#L1052) | } |
| [1053](#L1053) | } |
| [1054](#L1054) |  |
| [1055](#L1055) | // Return the array processing any additional functions filtered by this action. |
| [1056](#L1056) | return apply\_filters('sfwc\_switcher\_appearance\_validate', $output, $input); |
| [1057](#L1057) | } |
| [1058](#L1058) |  |
| [1059](#L1059) |  |
| [1060](#L1060) |  |
| [1061](#L1061) |  |
| [1062](#L1062) | /\*\* |
| [1063](#L1063) | \* Settings Options Validation. |
| [1064](#L1064) | \*/ |
| [1065](#L1065) | function sfwc\_options\_validate( $input ) { |
| [1066](#L1066) |  |
| [1067](#L1067) | // Create our array for storing the validated options. |
| [1068](#L1068) | $output = array(); |
| [1069](#L1069) |  |
| [1070](#L1070) |  |
| [1071](#L1071) |  |
| [1072](#L1072) | if ( ! is\_plugin\_active( 'subaccounts-for-woocommerce-pro/subaccounts-for-woocommerce-pro.php' ) ) { |
| [1073](#L1073) | // Check if the current option has a value. |
| [1074](#L1074) | if ( isset( $input['sfwc\_option\_subaccounts\_number\_limit'] ) ) { |
| [1075](#L1075) |  |
| [1076](#L1076) | // Sanitize sfwc\_option\_subaccounts\_number\_limit. |
| [1077](#L1077) | $sanitized\_subaccounts\_number\_limit = preg\_replace( '/[^0-9]/', '', $input['sfwc\_option\_subaccounts\_number\_limit'] ); |
| [1078](#L1078) |  |
| [1079](#L1079) |  |
| [1080](#L1080) | // Validate sfwc\_option\_subaccounts\_number\_limit. |
| [1081](#L1081) | if ( is\_numeric( $sanitized\_subaccounts\_number\_limit ) ) { |
| [1082](#L1082) |  |
| [1083](#L1083) | if ( $sanitized\_subaccounts\_number\_limit >= 1 && $sanitized\_subaccounts\_number\_limit <= 10 ) { |
| [1084](#L1084) |  |
| [1085](#L1085) | $output['sfwc\_option\_subaccounts\_number\_limit'] = $sanitized\_subaccounts\_number\_limit; |
| [1086](#L1086) | } |
| [1087](#L1087) | else { |
| [1088](#L1088) |  |
| [1089](#L1089) | add\_settings\_error( |
| [1090](#L1090) | 'sfwc\_settings\_messages', |
| [1091](#L1091) | 'sfwc\_wrong\_subaccounts\_number\_limit', |
| [1092](#L1092) | esc\_html\_\_( 'Incorrect value entered for: Maximum number of subaccounts allowed. Please enter a value between 1 and 10.', 'subaccounts-for-woocommerce' ), |
| [1093](#L1093) | 'error' |
| [1094](#L1094) | ); |
| [1095](#L1095) | } |
| [1096](#L1096) | } |
| [1097](#L1097) | else { |
| [1098](#L1098) |  |
| [1099](#L1099) | add\_settings\_error( |
| [1100](#L1100) | 'sfwc\_settings\_messages', |
| [1101](#L1101) | 'sfwc\_wrong\_subaccounts\_number\_limit', |
| [1102](#L1102) | esc\_html\_\_( 'Incorrect value entered for: Maximum number of subaccounts allowed.', 'subaccounts-for-woocommerce' ), |
| [1103](#L1103) | 'error' |
| [1104](#L1104) | ); |
| [1105](#L1105) | } |
| [1106](#L1106) | } |
| [1107](#L1107) | } |
| [1108](#L1108) |  |
| [1109](#L1109) |  |
| [1110](#L1110) |  |
| [1111](#L1111) |  |
| [1112](#L1112) | // Check if the current option has a value. |
| [1113](#L1113) | if ( isset( $input['sfwc\_option\_selected\_roles'] ) ) { |
| [1114](#L1114) |  |
| [1115](#L1115) | $sanitized\_roles = array(); |
| [1116](#L1116) | $valid\_roles = array(); |
| [1117](#L1117) |  |
| [1118](#L1118) | // Sanitize posted values. |
| [1119](#L1119) | foreach ( $input['sfwc\_option\_selected\_roles'] as $single\_role ) { |
| [1120](#L1120) |  |
| [1121](#L1121) | $sanitized\_roles[] = sanitize\_text\_field( $single\_role ); |
| [1122](#L1122) | } |
| [1123](#L1123) |  |
| [1124](#L1124) | // All potential WordPress user capabilities (excluding Super Admin ones), including those added by WooCommerce. |
| [1125](#L1125) | // Following capabilities, if all present, represent capabilities granted for Admin users. |
| [1126](#L1126) | $all\_potential\_wp\_capabilities = array( 'switch\_themes'=>1, 'edit\_themes'=>1, 'activate\_plugins'=>1, 'edit\_plugins'=>1, 'edit\_users'=>1, |
| [1127](#L1127) | 'edit\_files'=>1, 'manage\_options'=>1, 'moderate\_comments'=>1, 'manage\_categories'=>1, 'manage\_links'=>1, 'upload\_files'=>1, 'import'=>1, |
| [1128](#L1128) | 'unfiltered\_html'=>1, 'edit\_posts'=>1, 'edit\_others\_posts'=>1, 'edit\_published\_posts'=>1, 'publish\_posts'=>1, 'edit\_pages'=>1, |
| [1129](#L1129) | 'read'=>1, 'edit\_others\_pages'=>1, 'edit\_published\_pages'=>1, 'publish\_pages'=>1, 'delete\_pages'=>1, 'delete\_others\_pages'=>1, |
| [1130](#L1130) | 'delete\_published\_pages'=>1, 'delete\_posts'=>1, 'delete\_others\_posts'=>1, 'delete\_published\_posts'=>1, 'delete\_private\_posts'=>1, |
| [1131](#L1131) | 'edit\_private\_posts'=>1, 'read\_private\_posts'=>1, 'delete\_private\_pages'=>1, 'edit\_private\_pages'=>1, 'read\_private\_pages'=>1, |
| [1132](#L1132) | 'delete\_users'=>1, 'create\_users'=>1, 'unfiltered\_upload'=>1, 'edit\_dashboard'=>1, 'update\_plugins'=>1, 'delete\_plugins'=>1, |
| [1133](#L1133) | 'install\_plugins'=>1, 'update\_themes'=>1, 'install\_themes'=>1, 'update\_core'=>1, 'list\_users'=>1, 'remove\_users'=>1, 'promote\_users'=>1, |
| [1134](#L1134) | 'edit\_theme\_options'=>1, 'delete\_themes'=>1, 'export'=>1, 'manage\_woocommerce'=>1, 'view\_woocommerce\_reports'=>1, 'edit\_product'=>1, |
| [1135](#L1135) | 'read\_product'=>1, 'delete\_product'=>1, 'edit\_products'=>1, 'edit\_others\_products'=>1, 'publish\_products'=>1, 'read\_private\_products'=>1, |
| [1136](#L1136) | 'delete\_products'=>1, 'delete\_private\_products'=>1, 'delete\_published\_products'=>1, 'delete\_others\_products'=>1, 'edit\_private\_products'=>1, |
| [1137](#L1137) | 'edit\_published\_products'=>1, 'manage\_product\_terms'=>1, 'edit\_product\_terms'=>1, 'delete\_product\_terms'=>1, 'assign\_product\_terms'=>1, |
| [1138](#L1138) | 'edit\_shop\_order'=>1, 'read\_shop\_order'=>1, 'delete\_shop\_order'=>1, 'edit\_shop\_orders'=>1, 'edit\_others\_shop\_orders'=>1, 'publish\_shop\_orders'=>1, |
| [1139](#L1139) | 'read\_private\_shop\_orders'=>1, 'delete\_shop\_orders'=>1, 'delete\_private\_shop\_orders'=>1, 'delete\_published\_shop\_orders'=>1, |
| [1140](#L1140) | 'delete\_others\_shop\_orders'=>1, 'edit\_private\_shop\_orders'=>1, 'edit\_published\_shop\_orders'=>1, 'manage\_shop\_order\_terms'=>1, |
| [1141](#L1141) | 'edit\_shop\_order\_terms'=>1, 'delete\_shop\_order\_terms'=>1, 'assign\_shop\_order\_terms'=>1, 'edit\_shop\_coupon'=>1, 'read\_shop\_coupon'=>1, |
| [1142](#L1142) | 'delete\_shop\_coupon'=>1, 'edit\_shop\_coupons'=>1, 'edit\_others\_shop\_coupons'=>1, 'publish\_shop\_coupons'=>1, 'read\_private\_shop\_coupons'=>1, |
| [1143](#L1143) | 'delete\_shop\_coupons'=>1, 'delete\_private\_shop\_coupons'=>1, 'delete\_published\_shop\_coupons'=>1, 'delete\_others\_shop\_coupons'=>1, |
| [1144](#L1144) | 'edit\_private\_shop\_coupons'=>1, 'edit\_published\_shop\_coupons'=>1, 'manage\_shop\_coupon\_terms'=>1, 'edit\_shop\_coupon\_terms'=>1, |
| [1145](#L1145) | 'delete\_shop\_coupon\_terms'=>1, 'assign\_shop\_coupon\_terms'=>1, 'ure\_edit\_roles'=>1, 'ure\_create\_roles'=>1, 'ure\_delete\_roles'=>1, |
| [1146](#L1146) | 'ure\_create\_capabilities'=>1, 'ure\_delete\_capabilities'=>1, 'ure\_manage\_options'=>1, 'ure\_reset\_roles'=>1, 'create\_posts'=>1, |
| [1147](#L1147) | 'install\_languages'=>1, 'resume\_plugins'=>1, 'resume\_themes'=>1, 'view\_site\_health\_checks'=>1 ); |
| [1148](#L1148) |  |
| [1149](#L1149) | // Validate posted values. |
| [1150](#L1150) | if ( ! empty( $sanitized\_roles ) ) { |
| [1151](#L1151) |  |
| [1152](#L1152) | foreach ( $sanitized\_roles as $sanitized\_role ) { |
| [1153](#L1153) |  |
| [1154](#L1154) | $role\_capabilities = get\_role( $sanitized\_role )->capabilities; |
| [1155](#L1155) |  |
| [1156](#L1156) | if ( defined( 'SFWC\_VALID\_ROLE\_LOOSE\_MODE' ) && SFWC\_VALID\_ROLE\_LOOSE\_MODE == true ) { |
| [1157](#L1157) |  |
| [1158](#L1158) | /\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\* |
| [1159](#L1159) | \* Loose Method  \* |
| [1160](#L1160) | \*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*/ |
| [1161](#L1161) |  |
| [1162](#L1162) | if ( ! empty( $role\_capabilities ) ) { |
| [1163](#L1163) |  |
| [1164](#L1164) | if ( array\_key\_exists( 'read', $role\_capabilities ) && ! array\_key\_exists( 'edit\_posts', $role\_capabilities ) ) { |
| [1165](#L1165) |  |
| [1166](#L1166) | $valid\_roles[] = $sanitized\_role; |
| [1167](#L1167) | } |
| [1168](#L1168) | } |
| [1169](#L1169) | } |
| [1170](#L1170) | else { |
| [1171](#L1171) |  |
| [1172](#L1172) | /\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\* |
| [1173](#L1173) | \* Strict Method \* |
| [1174](#L1174) | \*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*/ |
| [1175](#L1175) |  |
| [1176](#L1176) | $result = array\_intersect\_key( $role\_capabilities, $all\_potential\_wp\_capabilities ); |
| [1177](#L1177) |  |
| [1178](#L1178) | #print\_r( $result ); |
| [1179](#L1179) |  |
| [1180](#L1180) | if ( ! empty( $result ) && count( $result ) === 1 && key( $result ) == 'read' ) { |
| [1181](#L1181) |  |
| [1182](#L1182) | $valid\_roles[] = $sanitized\_role; |
| [1183](#L1183) | } |
| [1184](#L1184) | } |
| [1185](#L1185) | } |
| [1186](#L1186) | } |
| [1187](#L1187) |  |
| [1188](#L1188) | if ( ! empty( $valid\_roles ) ) { |
| [1189](#L1189) |  |
| [1190](#L1190) | $output['sfwc\_option\_selected\_roles'] = $valid\_roles; |
| [1191](#L1191) | } |
| [1192](#L1192) | else { |
| [1193](#L1193) |  |
| [1194](#L1194) | add\_settings\_error( |
| [1195](#L1195) | 'sfwc\_settings\_messages', |
| [1196](#L1196) | 'sfwc\_wrong\_display\_name', |
| [1197](#L1197) | esc\_html\_\_( 'Incorrect value entered for: Select the buyer role(s) to enable the subaccount system for', 'subaccounts-for-woocommerce' ), |
| [1198](#L1198) | 'error' |
| [1199](#L1199) | ); |
| [1200](#L1200) | } |
| [1201](#L1201) | } |
| [1202](#L1202) |  |
| [1203](#L1203) |  |
| [1204](#L1204) |  |
| [1205](#L1205) |  |
| [1206](#L1206) | // Check if the current option has a value. |
| [1207](#L1207) | if ( isset( $input['sfwc\_option\_subaccount\_mode'] ) ) { |
| [1208](#L1208) |  |
| [1209](#L1209) | $valid\_radio\_subaccount\_mode = array( 'sub\_user', 'multi\_user' ); |
| [1210](#L1210) |  |
| [1211](#L1211) | if ( in\_array( $input['sfwc\_option\_subaccount\_mode'], $valid\_radio\_subaccount\_mode ) ) { |
| [1212](#L1212) |  |
| [1213](#L1213) | // When "Sub-User" mode is enabled, flush permalinks to prevent My Account > Subaccounts > Subaccount Orders from returning Error 404. |
| [1214](#L1214) | if ( $input['sfwc\_option\_subaccount\_mode'] == 'sub\_user' ) { |
| [1215](#L1215) | if ( get\_transient( 'sfwc\_flush\_rewrite\_rules\_required' ) === false ) { |
| [1216](#L1216) | set\_transient('sfwc\_flush\_rewrite\_rules\_required', true); |
| [1217](#L1217) | } |
| [1218](#L1218) | } |
| [1219](#L1219) |  |
| [1220](#L1220) | $output['sfwc\_option\_subaccount\_mode'] = sanitize\_text\_field( $input['sfwc\_option\_subaccount\_mode'] ); |
| [1221](#L1221) |  |
| [1222](#L1222) | } else { |
| [1223](#L1223) |  |
| [1224](#L1224) | add\_settings\_error( |
| [1225](#L1225) | 'sfwc\_settings\_messages', |
| [1226](#L1226) | 'sfwc\_wrong\_subaccount\_mode', |
| [1227](#L1227) | esc\_html\_\_( 'Incorrect value entered for: Subaccount Mode.', 'subaccounts-for-woocommerce' ), |
| [1228](#L1228) | 'error' |
| [1229](#L1229) | ); |
| [1230](#L1230) | } |
| [1231](#L1231) | } |
| [1232](#L1232) |  |
| [1233](#L1233) |  |
| [1234](#L1234) |  |
| [1235](#L1235) |  |
| [1236](#L1236) | // Check if the current option has a value. |
| [1237](#L1237) | if ( isset( $input['sfwc\_option\_display\_name'] ) ) { |
| [1238](#L1238) |  |
| [1239](#L1239) | $valid\_radio\_display\_name = array( 'username', 'full\_name', 'company\_name' ); |
| [1240](#L1240) |  |
| [1241](#L1241) | if ( in\_array( $input['sfwc\_option\_display\_name'], $valid\_radio\_display\_name ) ) { |
| [1242](#L1242) |  |
| [1243](#L1243) | $output['sfwc\_option\_display\_name'] = sanitize\_text\_field( $input['sfwc\_option\_display\_name'] ); |
| [1244](#L1244) |  |
| [1245](#L1245) | } else { |
| [1246](#L1246) |  |
| [1247](#L1247) | add\_settings\_error( |
| [1248](#L1248) | 'sfwc\_settings\_messages', |
| [1249](#L1249) | 'sfwc\_wrong\_display\_name', |
| [1250](#L1250) | esc\_html\_\_( 'Incorrect value entered for: Customer Display Name.', 'subaccounts-for-woocommerce' ), |
| [1251](#L1251) | 'error' |
| [1252](#L1252) | ); |
| [1253](#L1253) | } |
| [1254](#L1254) | } |
| [1255](#L1255) |  |
| [1256](#L1256) |  |
| [1257](#L1257) |  |
| [1258](#L1258) |  |
| [1259](#L1259) | // Default value if not set. |
| [1260](#L1260) | $output['sfwc\_options\_enable\_user\_switcher'] = '0'; |
| [1261](#L1261) |  |
| [1262](#L1262) | // Check if the current option has a value. |
| [1263](#L1263) | if ( isset( $input['sfwc\_options\_enable\_user\_switcher'] ) ) { |
| [1264](#L1264) |  |
| [1265](#L1265) | $output['sfwc\_options\_enable\_user\_switcher'] = '1'; |
| [1266](#L1266) | } |
| [1267](#L1267) |  |
| [1268](#L1268) |  |
| [1269](#L1269) |  |
| [1270](#L1270) |  |
| [1271](#L1271) | // Default value if not set. |
| [1272](#L1272) | $output['sfwc\_options\_show\_order\_meta\_box'] = '0'; |
| [1273](#L1273) |  |
| [1274](#L1274) | // Check if the current option has a value. |
| [1275](#L1275) | if ( isset( $input['sfwc\_options\_show\_order\_meta\_box'] ) ) { |
| [1276](#L1276) |  |
| [1277](#L1277) | $output['sfwc\_options\_show\_order\_meta\_box'] = '1'; |
| [1278](#L1278) | } |
| [1279](#L1279) |  |
| [1280](#L1280) |  |
| [1281](#L1281) | // Validate PRO settings. |
| [1282](#L1282) | do\_action\_ref\_array('sfwc\_options\_validate', array(&$output, &$input)); |
| [1283](#L1283) |  |
| [1284](#L1284) | return $output; |
| [1285](#L1285) | } |
| [1286](#L1286) |  |
| [1287](#L1287) |  |
| [1288](#L1288) |  |
| [1289](#L1289) |  |
| [1290](#L1290) | /\*\* |
| [1291](#L1291) | \* Flush rewrite rules after updating certain plugin settings. |
| [1292](#L1292) | \* |
| [1293](#L1293) | \* Update permalink structure after updating below settings: |
| [1294](#L1294) | \* |
| [1295](#L1295) | \*      - Subaccount Mode |
| [1296](#L1296) | \*      - Choose who can create and add new subaccounts |
| [1297](#L1297) | \*/ |
| [1298](#L1298) | function sfwc\_flush\_rewrite\_rules\_after\_settings\_update() { |
| [1299](#L1299) |  |
| [1300](#L1300) | if ( delete\_transient( 'sfwc\_flush\_rewrite\_rules\_required' ) ) { |
| [1301](#L1301) | flush\_rewrite\_rules(); |
| [1302](#L1302) | } |
| [1303](#L1303) | } |
| [1304](#L1304) | add\_action('admin\_init', 'sfwc\_flush\_rewrite\_rules\_after\_settings\_update'); |
| [1305](#L1305) |  |
| [1306](#L1306) |  |
| [1307](#L1307) |  |
| [1308](#L1308) |  |
| [1309](#L1309) | /\*\* |
| [1310](#L1310) | \* Create Tabbed content for settings page |
| [1311](#L1311) | \*/ |
| [1312](#L1312) | function sfwc\_admin\_page\_contents() { |
| [1313](#L1313) |  |
| [1314](#L1314) | // check user capabilities |
| [1315](#L1315) | if ( ! current\_user\_can( 'manage\_options' ) ) { |
| [1316](#L1316) | return; |
| [1317](#L1317) | } |
| [1318](#L1318) |  |
| [1319](#L1319) | // add error/update messages |
| [1320](#L1320) | // check if the user have submitted the settings |
| [1321](#L1321) | // WordPress will add the "settings-updated" $\_GET parameter to the url |
| [1322](#L1322) | if ( isset( $\_GET['settings-updated'] ) ) { |
| [1323](#L1323) |  |
| [1324](#L1324) | // add settings saved message with the class of "updated" |
| [1325](#L1325) | add\_settings\_error( 'sfwc\_settings\_messages', 'sfwc\_settings\_message', esc\_html\_\_( 'Settings Saved.', 'subaccounts-for-woocommerce' ), 'updated' ); |
| [1326](#L1326) | } |
| [1327](#L1327) |  |
| [1328](#L1328) | // show error/update messages |
| [1329](#L1329) | settings\_errors('sfwc\_settings\_messages'); |
| [1330](#L1330) |  |
| [1331](#L1331) |  |
| [1332](#L1332) | global $sfwc\_active\_tab; |
| [1333](#L1333) | $sfwc\_active\_tab = isset( $\_GET['tab'] ) ? sanitize\_text\_field( $\_GET['tab'] ) : 'options'; |
| [1334](#L1334) | ?> |
| [1335](#L1335) |  |
| [1336](#L1336) |  |
| [1337](#L1337) | <h1 style="margin-top:40px;"> |
| [1338](#L1338) | <?php |
| [1339](#L1339) | echo '<img style="height:50px; width:auto; vertical-align:middle; padding-right:5px;" src="' . esc\_url( WP\_PLUGIN\_URL ) . '/subaccounts-for-woocommerce/assets/images/sfwc\_icon.png">'; |
| [1340](#L1340) | echo 'Subaccounts for WooCommerce'; // Not translatable for branding purpose. |
| [1341](#L1341) | echo sfwc\_is\_plugin\_active( 'subaccounts-for-woocommerce-pro.php' ) ? ' Pro' : ''; |
| [1342](#L1342) | ?> |
| [1343](#L1343) | </h1> |
| [1344](#L1344) |  |
| [1345](#L1345) | <h2> |
| [1346](#L1346) | <?php esc\_html\_e('Settings Page', 'subaccounts-for-woocommerce'); ?> |
| [1347](#L1347) | </h2> |
| [1348](#L1348) |  |
| [1349](#L1349) | <p> |
| [1350](#L1350) | <?php esc\_html\_e( 'On this page you can configure the Subaccounts plugin settings.', 'subaccounts-for-woocommerce' ); ?> |
| [1351](#L1351) | </p> |
| [1352](#L1352) |  |
| [1353](#L1353) |  |
| [1354](#L1354) |  |
| [1355](#L1355) | <h2 class="nav-tab-wrapper"> |
| [1356](#L1356) | <?php |
| [1357](#L1357) | do\_action('sfwc\_settings\_tab'); |
| [1358](#L1358) | ?> |
| [1359](#L1359) | </h2> |
| [1360](#L1360) | <?php |
| [1361](#L1361) | do\_action('sfwc\_settings\_content'); |
| [1362](#L1362) | } |
| [1363](#L1363) |  |
| [1364](#L1364) | /\*\* |
| [1365](#L1365) | \* Tab: 1 |
| [1366](#L1366) | \*/ |
| [1367](#L1367) | function sfwc\_options\_tab() { |
| [1368](#L1368) | global $sfwc\_active\_tab; |
| [1369](#L1369) | ?> |
| [1370](#L1370) | <a class="nav-tab <?php echo $sfwc\_active\_tab == 'options' || '' ? 'nav-tab-active' : ''; ?>" href="<?php echo admin\_url( 'admin.php?page=subaccounts&tab=options' ); ?>"><?php esc\_html\_e( 'Options', 'subaccounts-for-woocommerce' ); ?> </a> |
| [1371](#L1371) | <?php |
| [1372](#L1372) | } |
| [1373](#L1373) | add\_action('sfwc\_settings\_tab', 'sfwc\_options\_tab', 1); |
| [1374](#L1374) |  |
| [1375](#L1375) |  |
| [1376](#L1376) |  |
| [1377](#L1377) | function sfwc\_options\_tab\_content() { |
| [1378](#L1378) |  |
| [1379](#L1379) | global $sfwc\_active\_tab; |
| [1380](#L1380) |  |
| [1381](#L1381) | if ( 'options' != $sfwc\_active\_tab ) |
| [1382](#L1382) | return; |
| [1383](#L1383) | ?> |
| [1384](#L1384) |  |
| [1385](#L1385) | <div id="sub\_accounts\_settings\_options\_tab"> |
| [1386](#L1386) |  |
| [1387](#L1387) | <h3><?php esc\_html\_e( 'Options', 'subaccounts-for-woocommerce' ); ?></h3> |
| [1388](#L1388) |  |
| [1389](#L1389) |  |
| [1390](#L1390) | <!-- Appearance content here --> |
| [1391](#L1391) | <form method="POST" action="options.php"> |
| [1392](#L1392) |  |
| [1393](#L1393) | <?php |
| [1394](#L1394) | // Real options |
| [1395](#L1395) | settings\_fields('sfwc\_options\_group'); |
| [1396](#L1396) | do\_settings\_sections('subaccounts&tab=options'); |
| [1397](#L1397) |  |
| [1398](#L1398) | // Fake options (only available in Pro version) |
| [1399](#L1399) | do\_action('sfwc\_dummy\_html\_markup\_after\_enabled\_options'); |
| [1400](#L1400) |  |
| [1401](#L1401) | submit\_button(); |
| [1402](#L1402) | ?> |
| [1403](#L1403) |  |
| [1404](#L1404) | </form> |
| [1405](#L1405) | </div> |
| [1406](#L1406) | <?php |
| [1407](#L1407) | } |
| [1408](#L1408) | add\_action('sfwc\_settings\_content', 'sfwc\_options\_tab\_content'); |
| [1409](#L1409) |  |
| [1410](#L1410) |  |
| [1411](#L1411) |  |
| [1412](#L1412) |  |
| [1413](#L1413) | /\*\* |
| [1414](#L1414) | \* Tab: 2 |
| [1415](#L1415) | \*/ |
| [1416](#L1416) | function sfwc\_appearance\_tab() { |
| [1417](#L1417) | global $sfwc\_active\_tab; |
| [1418](#L1418) | ?> |
| [1419](#L1419) | <a class="nav-tab <?php echo $sfwc\_active\_tab == 'appearance' ? 'nav-tab-active' : ''; ?>" href="<?php echo admin\_url('admin.php?page=subaccounts&tab=appearance'); ?>"><?php esc\_html\_e('Appearance', 'subaccounts-for-woocommerce'); ?> </a> |
| [1420](#L1420) | <?php |
| [1421](#L1421) | } |
| [1422](#L1422) | add\_action('sfwc\_settings\_tab', 'sfwc\_appearance\_tab', 2); |
| [1423](#L1423) |  |
| [1424](#L1424) |  |
| [1425](#L1425) |  |
| [1426](#L1426) |  |
| [1427](#L1427) | function sfwc\_appearance\_tab\_content() { |
| [1428](#L1428) | global $sfwc\_active\_tab; |
| [1429](#L1429) | if ( '' || 'appearance' != $sfwc\_active\_tab ) |
| [1430](#L1430) | return; |
| [1431](#L1431) | ?> |
| [1432](#L1432) |  |
| [1433](#L1433) | <div id="sub\_accounts\_settings\_appearance\_tab"> |
| [1434](#L1434) | <div id="sub\_accounts\_settings\_appearance\_tab\_left"> |
| [1435](#L1435) | <!-- <h3><?php esc\_html\_e( 'Frontend User Switcher Pane Appearance', 'subaccounts-for-woocommerce' ); ?></h3> --> |
| [1436](#L1436) |  |
| [1437](#L1437) | <!-- Appearance content here --> |
| [1438](#L1438) | <form method="POST" action="options.php"> |
| [1439](#L1439) | <?php |
| [1440](#L1440) | settings\_fields('sfwc\_switcher\_appearance\_group'); |
| [1441](#L1441) | do\_settings\_sections('subaccounts'); |
| [1442](#L1442) | submit\_button(); |
| [1443](#L1443) | ?> |
| [1444](#L1444) | </form> |
| [1445](#L1445) |  |
| [1446](#L1446) | </div> |
| [1447](#L1447) |  |
| [1448](#L1448) |  |
| [1449](#L1449) | <div id="sub\_accounts\_settings\_appearance\_tab\_right"> |
| [1450](#L1450) |  |
| [1451](#L1451) | <h3><?php esc\_html\_e( 'User Switcher Pane Preview', 'subaccounts-for-woocommerce' ); ?></h3> |
| [1452](#L1452) |  |
| [1453](#L1453) | <p> |
| [1454](#L1454) | <?php |
| [1455](#L1455) | $user\_switcher\_pane\_translation = '<em>' . esc\_html\_\_( 'User Switcher Pane', 'subaccounts-for-woocommerce' ) . '</em>'; |
| [1456](#L1456) | $my\_account\_translation = '<strong>' . esc\_html\_\_( 'My Account', 'subaccounts-for-woocommerce' ) . '</strong>'; |
| [1457](#L1457) | $supervisor\_add\_on\_translation = '<em>' . esc\_html\_\_( 'Supervisor Add-on', 'subaccounts-for-woocommerce' ) . '</em>'; |
| [1458](#L1458) |  |
| [1459](#L1459) | printf( |
| [1460](#L1460) | esc\_html\_\_( 'This is the preview of the %1$s, which is visible in the %2$s area only for Manager account types. In case the %3$s is installed, the User Switcher Pane is also visible for Supervisor account types.', 'subaccounts-for-woocommerce' ), |
| [1461](#L1461) | $user\_switcher\_pane\_translation, |
| [1462](#L1462) | $my\_account\_translation, |
| [1463](#L1463) | $supervisor\_add\_on\_translation |
| [1464](#L1464) | ); |
| [1465](#L1465) | ?> |
| [1466](#L1466) | </p> |
| [1467](#L1467) |  |
| [1468](#L1468) | <div id="sfwc-user-switcher-pane"> |
| [1469](#L1469) |  |
| [1470](#L1470) | <h3><?php esc\_html\_e( 'You are currently logged in as:', 'subaccounts-for-woocommerce' ); ?></h3> |
| [1471](#L1471) | <p style="color:' . $sfwc\_switcher\_pane\_text\_color . ';"><strong><?php esc\_html\_e( 'User:', 'subaccounts-for-woocommerce' ); ?></strong> John Doe - [ johndoe@email.com ]</p> |
| [1472](#L1472) |  |
| [1473](#L1473) | <form method="post"> |
| [1474](#L1474) | <select> |
| [1475](#L1475) |  |
| [1476](#L1476) | <option selected="selected" disabled><?php esc\_html\_e( 'Select Account', 'subaccounts-for-woocommerce' ); ?>&nbsp; &#8644;</option> |
| [1477](#L1477) | <option>James Miller - [ jamesmiller@email.com ]</option> |
| [1478](#L1478) | <option>Robert Williams - [ robertwilliams@email.com ]</option> |
| [1479](#L1479) | <option>Rebecca Smith - [ rebeccasmith@email.com ]</option> |
| [1480](#L1480) |  |
| [1481](#L1481) | </select> |
| [1482](#L1482) | </form> |
| [1483](#L1483) | </div> |
| [1484](#L1484) |  |
| [1485](#L1485) | <p id="sfwc-user-switcher-pane-default-values"><?php esc\_html\_e( '[Restore default color scheme]', 'subaccounts-for-woocommerce' ); ?></p> |
| [1486](#L1486) | </div> |
| [1487](#L1487) | </div> |
| [1488](#L1488) |  |
| [1489](#L1489) | <script> |
| [1490](#L1490) | jQuery(document).ready(function ($) { |
| [1491](#L1491) |  |
| [1492](#L1492) | $('#sfwc-user-switcher-pane').css('background-color', ($('#sfwc\_switcher\_pane\_bg\_color').val())); |
| [1493](#L1493) | $('#sfwc\_switcher\_pane\_bg\_color').wpColorPicker({ |
| [1494](#L1494) | change: function (event, ui) { |
| [1495](#L1495) | var theColor = ui.color.toString(); |
| [1496](#L1496) | $('#sfwc-user-switcher-pane').css('background-color', theColor); |
| [1497](#L1497) | } |
| [1498](#L1498) | }); |
| [1499](#L1499) |  |
| [1500](#L1500) |  |
| [1501](#L1501) |  |
| [1502](#L1502) | $('#sfwc-user-switcher-pane h3').css('color', ($('#sfwc\_switcher\_pane\_headline\_color').val())); |
| [1503](#L1503) | $('#sfwc\_switcher\_pane\_headline\_color').wpColorPicker({ |
| [1504](#L1504) | change: function (event, ui) { |
| [1505](#L1505) | var theColor = ui.color.toString(); |
| [1506](#L1506) | $('#sfwc-user-switcher-pane h3').css('color', theColor); |
| [1507](#L1507) | } |
| [1508](#L1508) | }); |
| [1509](#L1509) |  |
| [1510](#L1510) |  |
| [1511](#L1511) |  |
| [1512](#L1512) | $('#sfwc-user-switcher-pane p').css('color', ($('#sfwc\_switcher\_pane\_text\_color').val())); |
| [1513](#L1513) | $('#sfwc\_switcher\_pane\_text\_color').wpColorPicker({ |
| [1514](#L1514) | change: function (event, ui) { |
| [1515](#L1515) | var theColor = ui.color.toString(); |
| [1516](#L1516) | $('#sfwc-user-switcher-pane p').css('color', theColor); |
| [1517](#L1517) | } |
| [1518](#L1518) | }); |
| [1519](#L1519) |  |
| [1520](#L1520) |  |
| [1521](#L1521) |  |
| [1522](#L1522) | $('#sfwc-user-switcher-pane select').css('background-color', ($('#sfwc\_switcher\_pane\_select\_bg\_color').val())); |
| [1523](#L1523) | $('#sfwc\_switcher\_pane\_select\_bg\_color').wpColorPicker({ |
| [1524](#L1524) | change: function (event, ui) { |
| [1525](#L1525) | var theColor = ui.color.toString(); |
| [1526](#L1526) | $('#sfwc-user-switcher-pane select').css('background-color', theColor); |
| [1527](#L1527) | } |
| [1528](#L1528) | }); |
| [1529](#L1529) |  |
| [1530](#L1530) |  |
| [1531](#L1531) |  |
| [1532](#L1532) | $('#sfwc-user-switcher-pane select').css('color', ($('#sfwc\_switcher\_pane\_select\_text\_color').val())); |
| [1533](#L1533) | $('#sfwc\_switcher\_pane\_select\_text\_color').wpColorPicker({ |
| [1534](#L1534) | change: function (event, ui) { |
| [1535](#L1535) | var theColor = ui.color.toString(); |
| [1536](#L1536) | $('#sfwc-user-switcher-pane select').css('color', theColor); |
| [1537](#L1537) | } |
| [1538](#L1538) | }); |
| [1539](#L1539) |  |
| [1540](#L1540) |  |
| [1541](#L1541) | /\* Restore default color scheme \*/ |
| [1542](#L1542) | jQuery('#sfwc-user-switcher-pane-default-values').on('click', function () { |
| [1543](#L1543) |  |
| [1544](#L1544) | $('#sfwc\_switcher\_pane\_bg\_color').val('#def6ff'); // Reset input value |
| [1545](#L1545) | $('#sfwc\_switcher\_pane\_bg\_color').closest('.wp-picker-container').children('.wp-color-result').css('background-color', '#def6ff'); // Reset wp color picker box |
| [1546](#L1546) | $('#sfwc-user-switcher-pane').css('background-color', '#def6ff'); // Reset User Switcher preview |
| [1547](#L1547) |  |
| [1548](#L1548) | $('#sfwc\_switcher\_pane\_headline\_color').val('#0088cc'); |
| [1549](#L1549) | $('#sfwc\_switcher\_pane\_headline\_color').closest('.wp-picker-container').children('.wp-color-result').css('background-color', '#0088cc'); |
| [1550](#L1550) | $('#sfwc-user-switcher-pane h3').css('color', '#0088cc'); |
| [1551](#L1551) |  |
| [1552](#L1552) | $('#sfwc\_switcher\_pane\_text\_color').val('#3b3b3b'); |
| [1553](#L1553) | $('#sfwc\_switcher\_pane\_text\_color').closest('.wp-picker-container').children('.wp-color-result').css('background-color', '#3b3b3b'); |
| [1554](#L1554) | $('#sfwc-user-switcher-pane p').css('color', '#3b3b3b'); |
| [1555](#L1555) |  |
| [1556](#L1556) | $('#sfwc\_switcher\_pane\_select\_bg\_color').val('#0088cc'); |
| [1557](#L1557) | $('#sfwc\_switcher\_pane\_select\_bg\_color').closest('.wp-picker-container').children('.wp-color-result').css('background-color', '#0088cc'); |
| [1558](#L1558) | $('#sfwc-user-switcher-pane select').css('background-color', '#0088cc'); |
| [1559](#L1559) |  |
| [1560](#L1560) | $('#sfwc\_switcher\_pane\_select\_text\_color').val('#ffffff'); |
| [1561](#L1561) | $('#sfwc\_switcher\_pane\_select\_text\_color').closest('.wp-picker-container').children('.wp-color-result').css('background-color', '#ffffff'); |
| [1562](#L1562) | $('#sfwc-user-switcher-pane select').css('color', '#ffffff'); |
| [1563](#L1563) | }); |
| [1564](#L1564) |  |
| [1565](#L1565) | }); |
| [1566](#L1566) | </script> |
| [1567](#L1567) |  |
| [1568](#L1568) | <?php |
| [1569](#L1569) | } |
| [1570](#L1570) | add\_action('sfwc\_settings\_content', 'sfwc\_appearance\_tab\_content'); |
| [1571](#L1571) |  |
| [1572](#L1572) |  |
| [1573](#L1573) |  |
| [1574](#L1574) |  |
| [1575](#L1575) | /\*\* |
| [1576](#L1576) | \* Dummy content for Option tab in plugin's Settings admin page. |
| [1577](#L1577) | \* |
| [1578](#L1578) | \* Add dummy content for Option tab in case Subaccounts Pro is not installed. |
| [1579](#L1579) | \*/ |
| [1580](#L1580) | function sfwc\_add\_dummy\_html\_markup\_after\_enabled\_options() { |
| [1581](#L1581) | ?> |
| [1582](#L1582) |  |
| [1583](#L1583) | <table class="form-table" role="presentation"> |
| [1584](#L1584) | <tbody> |
| [1585](#L1585) | <tr> |
| [1586](#L1586) | <th scope="row" style="padding: 15px 10px 20px 0;"> |
| [1587](#L1587) | <?php echo esc\_html\_\_('Show subaccounts information on WooCommerce orders list page', 'subaccounts-for-woocommerce') . '<span class="tips woocommerce-help-tip" data-tip="' . esc\_attr\_\_("Add the 'Order placed by' column to the WooCommerce orders list page in WordPress admin area. In case Sub-User mode is active, 'Account Type' and 'Parent Accounts' columns will also show up.", 'subaccounts-for-woocommerce') . '"></span>'; ?> |
| [1588](#L1588) | <br> |
| [1589](#L1589) | <a style="color:#148ff3;" href="<?php echo admin\_url( '/admin.php?checkout=true&page=subaccounts-pricing&plugin\_id=10457&plan\_id=17669&pricing\_id=19941&billing\_cycle=annual' ); ?>"> |
| [1590](#L1590) | <?php echo esc\_html\_\_( 'Get Subaccounts Pro', 'subaccounts-for-woocommerce' ); ?></a> |
| [1591](#L1591) |  |
| [1592](#L1592) | <span style="font-weight:400;"> |
| [1593](#L1593) | <?php echo esc\_html\_\_( 'and unlock this feature!', 'subaccounts-for-woocommerce' ); ?> |
| [1594](#L1594) | </span> |
| [1595](#L1595) | </th> |
| [1596](#L1596) | <td> |
| [1597](#L1597) | <input title="<?php esc\_attr\_e( 'This feature is only available on Subaccounts Pro', 'subaccounts-for-woocommerce'); ?>" type="checkbox" name="sfwc\_columns\_order" value="" disabled> |
| [1598](#L1598) | <span style="vertical-align: middle;"><?php esc\_html\_e( "You may need to enable this under 'Screen Options' too.", "subaccounts-for-woocommerce" ); ?></span> |
| [1599](#L1599) | </td> |
| [1600](#L1600) | </tr> |
| [1601](#L1601) | <tr> |
| [1602](#L1602) | <th scope="row" style="padding: 15px 10px 20px 0;"> |
| [1603](#L1603) | <?php echo esc\_html\_\_( 'Show subaccounts information on WordPress users list page', 'subaccounts-for-woocommerce' ) . '<span class="tips woocommerce-help-tip" data-tip="' . esc\_attr\_\_( "Add 'Account Type', 'Subaccounts' and 'Parent Accounts' columns to the users list page in WordPress admin area.", "subaccounts-for-woocommerce" ) . '"></span>'; ?> |
| [1604](#L1604) | <br> |
| [1605](#L1605) | <a style="color:#148ff3;" href="<?php echo admin\_url( '/admin.php?checkout=true&page=subaccounts-pricing&plugin\_id=10457&plan\_id=17669&pricing\_id=19941&billing\_cycle=annual' ); ?>"> |
| [1606](#L1606) | <?php echo esc\_html\_\_( 'Get Subaccounts Pro', 'subaccounts-for-woocommerce' ); ?></a> |
| [1607](#L1607) |  |
| [1608](#L1608) | <span style="font-weight:400;"> |
| [1609](#L1609) | <?php echo esc\_html\_\_( 'and unlock this feature!', 'subaccounts-for-woocommerce' ); ?> |
| [1610](#L1610) | </span> |
| [1611](#L1611) | </th> |
| [1612](#L1612) | <td> |
| [1613](#L1613) | <input title="<?php esc\_attr\_e( 'This feature is only available on Subaccounts Pro', 'subaccounts-for-woocommerce'); ?>" type="checkbox" name="sfwc\_columns\_users" value="" disabled> |
| [1614](#L1614) | <span style="vertical-align: middle;"><?php esc\_html\_e( "You may need to enable this under 'Screen Options' too.", "subaccounts-for-woocommerce" ); ?></span> |
| [1615](#L1615) | </td> |
| [1616](#L1616) | </tr> |
| [1617](#L1617) | <tr> |
| [1618](#L1618) | <th scope="row" style="padding: 15px 10px 20px 0;"> |
| [1619](#L1619) | <?php echo esc\_html\_\_('Add subaccounts information to new order emails', 'subaccounts-for-woocommerce') . '<span class="tips woocommerce-help-tip" data-tip="' . esc\_attr\_\_( 'Show customer\'s Manager and Supervisor information in new order emails.', "subaccounts-for-woocommerce" ) . '"></span>'; ?> |
| [1620](#L1620) | <br> |
| [1621](#L1621) | <a style="color:#148ff3;" href="<?php echo admin\_url( '/admin.php?checkout=true&page=subaccounts-pricing&plugin\_id=10457&plan\_id=17669&pricing\_id=19941&billing\_cycle=annual' ); ?>"> |
| [1622](#L1622) | <?php echo esc\_html\_\_( 'Get Subaccounts Pro', 'subaccounts-for-woocommerce' ); ?></a> |
| [1623](#L1623) |  |
| [1624](#L1624) | <span style="font-weight:400;"> |
| [1625](#L1625) | <?php echo esc\_html\_\_( 'and unlock this feature!', 'subaccounts-for-woocommerce' ); ?> |
| [1626](#L1626) | </span> |
| [1627](#L1627) | </th> |
| [1628](#L1628) | <td> |
| [1629](#L1629) | <input title="<?php esc\_attr\_e( 'This feature is only available on Subaccounts Pro', 'subaccounts-for-woocommerce'); ?>" type="radio" name="sfwc\_email\_option" value="" disabled checked> |
| [1630](#L1630) | <label for=""><?php esc\_html\_e('No', 'subaccounts-for-woocommerce'); ?></label><br> |
| [1631](#L1631) |  |
| [1632](#L1632) | <input title="<?php esc\_attr\_e( 'This feature is only available on Subaccounts Pro', 'subaccounts-for-woocommerce'); ?>" type="radio" name="sfwc\_email\_option" value="" disabled> |
| [1633](#L1633) | <label for=""><?php esc\_html\_e('For Admin Only', 'subaccounts-for-woocommerce'); ?></label><br> |
| [1634](#L1634) |  |
| [1635](#L1635) | <input title="<?php esc\_attr\_e( 'This feature is only available on Subaccounts Pro', 'subaccounts-for-woocommerce'); ?>" type="radio" name="sfwc\_email\_option" value="" disabled> |
| [1636](#L1636) | <label for=""><?php esc\_html\_e('For Customer Only', 'subaccounts-for-woocommerce'); ?></label><br> |
| [1637](#L1637) |  |
| [1638](#L1638) | <input title="<?php esc\_attr\_e( 'This feature is only available on Subaccounts Pro', 'subaccounts-for-woocommerce'); ?>" type="radio" name="sfwc\_email\_option" value="" disabled> |
| [1639](#L1639) | <label for=""><?php esc\_html\_e('For both Admin and Customer', 'subaccounts-for-woocommerce'); ?></label> |
| [1640](#L1640) |  |
| [1641](#L1641) | <p style="margin-top:8px;"> |
| [1642](#L1642) |  |
| [1643](#L1643) | <?php |
| [1644](#L1644) | $important\_strong = '<strong>' . esc\_html\_\_( 'Important:', 'subaccounts-for-woocommerce' ) . '</strong>'; |
| [1645](#L1645) | $email\_settings\_path =  '<em>' . esc\_html\_\_( 'WooCommerce', 'subaccounts-for-woocommerce' ) . '</em> ➝ ' . |
| [1646](#L1646) | '<em>' . esc\_html\_\_( 'Settings', 'subaccounts-for-woocommerce' ) . '</em> ➝ ' . |
| [1647](#L1647) | '<em>' . esc\_html\_\_( 'Emails', 'subaccounts-for-woocommerce' ) . '</em>'; |
| [1648](#L1648) |  |
| [1649](#L1649) |  |
| [1650](#L1650) | printf( |
| [1651](#L1651) | esc\_html\_\_( '%1$s make sure email notifications are properly set and enabled in: %2$s.', 'subaccounts-for-woocommerce' ), |
| [1652](#L1652) | $important\_strong, |
| [1653](#L1653) | $email\_settings\_path |
| [1654](#L1654) | ); |
| [1655](#L1655) | ?> |
| [1656](#L1656) |  |
| [1657](#L1657) | </p> |
| [1658](#L1658) | </td> |
| [1659](#L1659) | </tr> |
| [1660](#L1660) | <tr> |
| [1661](#L1661) | <th scope="row" style="padding: 15px 10px 20px 0;"> |
| [1662](#L1662) | <?php echo esc\_html\_\_( 'Subaccount billing address', 'subaccounts-for-woocommerce' ) . '<span class="tips woocommerce-help-tip" data-tip="' . esc\_attr\_\_( "With this option enabled whenever a Manager billing address is updated, the changes are reflected to subaccounts as well.", "subaccounts-for-woocommerce" ) . '"></span>'; ?> |
| [1663](#L1663) | <br> |
| [1664](#L1664) | <a style="color:#148ff3;" href="<?php echo admin\_url( '/admin.php?checkout=true&page=subaccounts-pricing&plugin\_id=10457&plan\_id=17669&pricing\_id=19941&billing\_cycle=annual' ); ?>"> |
| [1665](#L1665) | <?php echo esc\_html\_\_( 'Get Subaccounts Pro', 'subaccounts-for-woocommerce' ); ?></a> |
| [1666](#L1666) |  |
| [1667](#L1667) | <span style="font-weight:400;"> |
| [1668](#L1668) | <?php echo esc\_html\_\_( 'and unlock this feature!', 'subaccounts-for-woocommerce' ); ?> |
| [1669](#L1669) | </span> |
| [1670](#L1670) | </th> |
| [1671](#L1671) | <td> |
| [1672](#L1672) | <input title="<?php esc\_attr\_e( 'This feature is only available on Subaccounts Pro', 'subaccounts-for-woocommerce'); ?>" type="checkbox" name="sfwc\_columns\_users" value="" disabled> |
| [1673](#L1673) | <span style="vertical-align: middle;"><?php esc\_html\_e( "Force subaccounts to inherit the billing address from their Manager.", "subaccounts-for-woocommerce" ); ?></span> |
| [1674](#L1674) |  |
| [1675](#L1675) | <p style="margin-top:8px;"> |
| [1676](#L1676) |  |
| [1677](#L1677) | <?php |
| [1678](#L1678) | $important\_strong = '<strong>' . esc\_html\_\_( 'Important:', 'subaccounts-for-woocommerce' ) . '</strong>'; |
| [1679](#L1679) | $my\_account\_edit\_address\_path = '<em>' . esc\_html\_\_( 'My Account', 'subaccounts-for-woocommerce' ) . '</em> ➝ ' . |
| [1680](#L1680) | '<em>' . esc\_html\_\_( 'Addresses', 'subaccounts-for-woocommerce' ) . '</em>'; |
| [1681](#L1681) |  |
| [1682](#L1682) |  |
| [1683](#L1683) | printf( |
| [1684](#L1684) | esc\_html\_\_( '%1$s with this option enabled, subaccount billing address fields in: %2$s will become uneditable.', 'subaccounts-for-woocommerce' ), |
| [1685](#L1685) | $important\_strong, |
| [1686](#L1686) | $my\_account\_edit\_address\_path |
| [1687](#L1687) | ); |
| [1688](#L1688) | ?> |
| [1689](#L1689) |  |
| [1690](#L1690) | </p> |
| [1691](#L1691) | </td> |
| [1692](#L1692) | </tr> |
| [1693](#L1693) | <tr> |
| [1694](#L1694) | <th scope="row" style="padding: 15px 10px 20px 0;"> |
| [1695](#L1695) | <?php echo esc\_html\_\_( 'Subaccount shipping address', 'subaccounts-for-woocommerce' ) . '<span class="tips woocommerce-help-tip" data-tip="' . esc\_attr\_\_( "With this option enabled whenever a Manager's shipping address is updated, the changes are reflected to subaccounts as well.", "subaccounts-for-woocommerce" ) . '"></span>'; ?> |
| [1696](#L1696) | <br> |
| [1697](#L1697) | <a style="color:#148ff3;" href="<?php echo admin\_url( '/admin.php?checkout=true&page=subaccounts-pricing&plugin\_id=10457&plan\_id=17669&pricing\_id=19941&billing\_cycle=annual' ); ?>"> |
| [1698](#L1698) | <?php echo esc\_html\_\_( 'Get Subaccounts Pro', 'subaccounts-for-woocommerce' ); ?></a> |
| [1699](#L1699) |  |
| [1700](#L1700) | <span style="font-weight:400;"> |
| [1701](#L1701) | <?php echo esc\_html\_\_( 'and unlock this feature!', 'subaccounts-for-woocommerce' ); ?> |
| [1702](#L1702) | </span> |
| [1703](#L1703) | </th> |
| [1704](#L1704) | <td> |
| [1705](#L1705) | <input title="<?php esc\_attr\_e( 'This feature is only available on Subaccounts Pro', 'subaccounts-for-woocommerce'); ?>" type="checkbox" name="sfwc\_columns\_users" value="" disabled> |
| [1706](#L1706) | <span style="vertical-align: middle;"><?php esc\_html\_e( "Force subaccounts to inherit the shipping address from their Manager.", "subaccounts-for-woocommerce" ); ?></span> |
| [1707](#L1707) |  |
| [1708](#L1708) | <p style="margin-top:8px;"> |
| [1709](#L1709) |  |
| [1710](#L1710) | <?php |
| [1711](#L1711) | $important\_strong = '<strong>' . esc\_html\_\_( 'Important:', 'subaccounts-for-woocommerce' ) . '</strong>'; |
| [1712](#L1712) | $my\_account\_edit\_address\_path = '<em>' . esc\_html\_\_( 'My Account', 'subaccounts-for-woocommerce' ) . '</em> ➝ ' . |
| [1713](#L1713) | '<em>' . esc\_html\_\_( 'Addresses', 'subaccounts-for-woocommerce' ) . '</em>'; |
| [1714](#L1714) |  |
| [1715](#L1715) |  |
| [1716](#L1716) | printf( |
| [1717](#L1717) | esc\_html\_\_( '%1$s with this option enabled, subaccount shipping address fields in: %2$s will become uneditable.', 'subaccounts-for-woocommerce' ), |
| [1718](#L1718) | $important\_strong, |
| [1719](#L1719) | $my\_account\_edit\_address\_path |
| [1720](#L1720) | ); |
| [1721](#L1721) | ?> |
| [1722](#L1722) |  |
| [1723](#L1723) | </p> |
| [1724](#L1724) | </td> |
| [1725](#L1725) | </tr> |
| [1726](#L1726) | <tbody> |
| [1727](#L1727) | </table> |
| [1728](#L1728) | <?php |
| [1729](#L1729) | } |
| [1730](#L1730) | add\_action('sfwc\_dummy\_html\_markup\_after\_enabled\_options', 'sfwc\_add\_dummy\_html\_markup\_after\_enabled\_options'); |
| [1731](#L1731) |  |
| [1732](#L1732) |  |
| [1733](#L1733) |  |
| [1734](#L1734) |  |
| [1735](#L1735) | /\*\* |
| [1736](#L1736) | \* Color picker scripts. |
| [1737](#L1737) | \* |
| [1738](#L1738) | \* Required for Appearance tab in plugin's Settings admin page. |
| [1739](#L1739) | \*/ |
| [1740](#L1740) | function sfwc\_enqueue\_color\_picker() { |
| [1741](#L1741) | wp\_enqueue\_style( 'wp-color-picker' ); |
| [1742](#L1742) | wp\_enqueue\_script( 'wp-color-picker' ); |
| [1743](#L1743) | } |
| [1744](#L1744) | add\_action('admin\_enqueue\_scripts', 'sfwc\_enqueue\_color\_picker'); |
| [1745](#L1745) |  |
| [1746](#L1746) | function sfwc\_admin\_inline\_js\_color\_picker() { |
| [1747](#L1747) | echo "<script> |
| [1748](#L1748) | jQuery(document).ready(function($){ |
| [1749](#L1749) | $('.sfwc-color-field').wpColorPicker(); |
| [1750](#L1750) | }); |
| [1751](#L1751) | </script>"; |
| [1752](#L1752) | } |
| [1753](#L1753) | add\_action('admin\_print\_footer\_scripts', 'sfwc\_admin\_inline\_js\_color\_picker'); |
| [1754](#L1754) |  |
| [1755](#L1755) |  |
| [1756](#L1756) |  |
| [1757](#L1757) |  |
| [1758](#L1758) | /\*\* |
| [1759](#L1759) | \* Register new endpoint "Add Subaccount" to use for My Account page. |
| [1760](#L1760) | \* |
| [1761](#L1761) | \*              ------------------------------------------------- |
| [1762](#L1762) | \*              Remember to update Permalinks to avoid 404 error. |
| [1763](#L1763) | \*              ------------------------------------------------- |
| [1764](#L1764) | \* |
| [1765](#L1765) | \* Do NOT move this piece of code to: subaccounts-for-woocommerce > public > my-account.php |
| [1766](#L1766) | \* Other code in: subaccounts-for-woocommerce > public > my-account.php |
| [1767](#L1767) | \* See: "Add Subaccount" menu item to My Acount page. |
| [1768](#L1768) | \* |
| [1769](#L1769) | \* DO NOT REMOVE! |
| [1770](#L1770) | \* Removed on version 1.1.3 and restored on version 1.1.4 to prevent endpoint returning 'Not Found Error'. |
| [1771](#L1771) | \* |
| [1772](#L1772) | \* Keep this function here, in addition to function: sfwc\_subaccounts\_endpoint\_query\_vars |
| [1773](#L1773) | \* in: subaccounts-for-woocommerce > public > my-account.php |
| [1774](#L1774) | \*/ |
| [1775](#L1775) | function sfwc\_register\_subaccounts\_endpoint() { |
| [1776](#L1776) | add\_rewrite\_endpoint( 'subaccounts', EP\_ROOT | EP\_PAGES ); |
| [1777](#L1777) | } |
| [1778](#L1778) | add\_action( 'init', 'sfwc\_register\_subaccounts\_endpoint' ); |

**Note:** See [TracBrowser](/wiki/TracBrowser)
for help on using the repository browser.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Plain Text](/browser/subaccounts-for-woocommerce/tags/1.5.6/admin/admin.php?format=txt)
* [Original Format](/export/3222734/subaccounts-for-woocommerce/tags/1.5.6/admin/admin.php)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from www.wordfence.com_15584de6_20250115_095022.html ===


[![](https://www.wordfence.com/img/wordfence-intelligence-logo.svg)](/threat-intel/)

Have you found a vulnerability in a WordPress plugin or theme? Report vulnerabilities in WordPress plugins and themes through our [bug bounty program](https://www.wordfence.com/threat-intel/bug-bounty-program) and earn a bounty on all in-scope submissions, while we handle the responsible disclosure process on your behalf.

As a reminder, the Wordfence Intelligence Vulnerability Database API is completely free to query and utilize, both personally and commercially, and contains all the same vulnerability data as the user interface. Please review the API documentation and Webhook documentation for more information on how to query the vulnerability API endpoints and configure webhooks utilizing all the same data present in the Wordfence Intelligence user interface.

# Subaccounts for WooCommerce <= 1.6.0 - Reflected Cross-Site Scripting

 [Wordfence Intelligence](https://www.wordfence.com/threat-intel)   >    [Vulnerability Database](https://www.wordfence.com/threat-intel/vulnerabilities)   >   Subaccounts for WooCommerce <= 1.6.0 - Reflected Cross-Site Scripting

6.1

**Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')**
**CVSS Vector**
[CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N)

| CVE | [CVE-2024-11370](https://www.cve.org/CVERecord?id=CVE-2024-11370) |
| --- | --- |
| CVSS | 6.1 (Medium) |
| Publicly Published | November 20, 2024 |
| Last Updated | November 22, 2024 |
| Researcher | [vgo0](https://www.wordfence.com/threat-intel/vulnerabilities/researchers/dale-mavers) |

### Description

The Subaccounts for WooCommerce plugin for WordPress is vulnerable to Reflected Cross-Site Scripting due to the use of add\_query\_arg without appropriate escaping on the URL in all versions up to, and including, 1.6.0. This makes it possible for unauthenticated attackers to inject arbitrary web scripts in pages that execute if they can successfully trick a user into performing an action such as clicking on a link.

#### References

* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/browser/subaccounts-for-woocommerce/tags/1.5.6/admin/admin.php#L37)
* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/changeset/3193376/subaccounts-for-woocommerce/trunk/admin/admin.php)

#### Share

[Facebook](https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fsubaccounts-for-woocommerce%2Fsubaccounts-for-woocommerce-160-reflected-cross-site-scripting&t=Subaccounts%20for%20WooCommerce%20%3C%3D%201.6.0%20-%20Reflected%20Cross-Site%20Scripting "Facebook")
[Twitter](https://twitter.com/share?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fsubaccounts-for-woocommerce%2Fsubaccounts-for-woocommerce-160-reflected-cross-site-scripting&text=Subaccounts%20for%20WooCommerce%20%3C%3D%201.6.0%20-%20Reflected%20Cross-Site%20Scripting "Twitter")
[LinkedIn](https://www.linkedin.com/shareArticle?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fsubaccounts-for-woocommerce%2Fsubaccounts-for-woocommerce-160-reflected-cross-site-scripting "LinkedIn")
Email

## Vulnerability Details for Subaccounts for WooCommerce

#### [Subaccounts for WooCommerce](https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/subaccounts-for-woocommerce)

| Software Type | Plugin |
| --- | --- |
| Software Slug | subaccounts-for-woocommerce [(view on wordpress.org)](https://wordpress.org/plugins/subaccounts-for-woocommerce) |
| Patched? | Yes |
| Remediation | Update to version 1.6.1, or a newer patched version |
| Affected Version | * <= 1.6.0 |
| Patched Version | * 1.6.1 |

This record contains material that is subject to copyright.

**Copyright 2012-2025 Defiant Inc.**

**License:**
Defiant hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute this software vulnerability information. Any copy of the software vulnerability information you make for such purposes is authorized provided that you include a hyperlink to this vulnerability record and reproduce Defiant's copyright designation and this license in any such copy.
**[Read more.](https://www.wordfence.com/wordfence-intelligence-terms-and-conditions/)**

**Copyright 1999-2025 The MITRE Corporation**

**License:**
CVE Usage: MITRE hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute Common Vulnerabilities and Exposures (CVE®). Any copy you make for such purposes is authorized provided that you reproduce MITRE's copyright designation and this license in any such copy.
**[Read more.](https://www.cve.org/Legal/TermsOfUse)**

Have information to add, or spot any errors? Contact us at wfi-support@wordfence.com so we can make any appropriate adjustments.

Did you know Wordfence Intelligence provides free personal and commercial API access to our comprehensive WordPress vulnerability database, along with a free webhook integration to stay on top of the latest vulnerabilities added and updated in the database? Get started today!

Learn more

Want to get notified of the latest vulnerabilities that may affect your WordPress site?
 Install Wordfence on your site today to get notified immediately if your site is affected by a vulnerability that has been added to our database.

Get Wordfence

The Wordfence Intelligence WordPress vulnerability database is completely free to access and query via API. Please review the documentation on how to access and consume the vulnerability data via API.

Documentation


