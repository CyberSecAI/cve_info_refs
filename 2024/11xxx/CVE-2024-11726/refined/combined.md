=== Content from www.wordfence.com_8abc9ed3_20250114_205447.html ===


[![](https://www.wordfence.com/img/wordfence-intelligence-logo.svg)](/threat-intel/)

Have you found a vulnerability in a WordPress plugin or theme? Report vulnerabilities in WordPress plugins and themes through our [bug bounty program](https://www.wordfence.com/threat-intel/bug-bounty-program) and earn a bounty on all in-scope submissions, while we handle the responsible disclosure process on your behalf.

As a reminder, the Wordfence Intelligence Vulnerability Database API is completely free to query and utilize, both personally and commercially, and contains all the same vulnerability data as the user interface. Please review the API documentation and Webhook documentation for more information on how to query the vulnerability API endpoints and configure webhooks utilizing all the same data present in the Wordfence Intelligence user interface.

# Appointment Booking Calendar Plugin and Scheduling Plugin – BookingPress <= 1.1.21 - Authenticated (Contributor+) SQL Injection

 [Wordfence Intelligence](https://www.wordfence.com/threat-intel)   >    [Vulnerability Database](https://www.wordfence.com/threat-intel/vulnerabilities)   >   Appointment Booking Calendar Plugin and Scheduling Plugin – BookingPress <= 1.1.21 - Authenticated (Contributor+) SQL Injection

6.5

**Improper Neutralization of Special Elements used in an SQL Command ('SQL Injection')**
**CVSS Vector**
[CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:N/A:N](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:N/A:N)

| CVE | [CVE-2024-11726](https://www.cve.org/CVERecord?id=CVE-2024-11726) |
| --- | --- |
| CVSS | 6.5 (Medium) |
| Publicly Published | December 23, 2024 |
| Last Updated | December 24, 2024 |
| Researcher | [shaman0x01 - Shaman Red Team](https://www.wordfence.com/threat-intel/vulnerabilities/researchers/khayal-farzaliyev) |

### Description

The Appointment Booking Calendar Plugin and Scheduling Plugin – BookingPress plugin for WordPress is vulnerable to SQL Injection via the 'category' parameter of the 'bookingpress\_form' shortcode in all versions up to, and including, 1.1.21 due to insufficient escaping on the user supplied parameter and lack of sufficient preparation on the existing SQL query. This makes it possible for authenticated attackers, with Contributor-level access and above, to append additional SQL queries into already existing queries that can be used to extract sensitive information from the database.

#### References

* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/changeset/3206780/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php)

#### Share

[Facebook](https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fbookingpress-appointment-booking%2Fappointment-booking-calendar-plugin-and-scheduling-plugin-bookingpress-1121-authenticated-contributor-sql-injection&t=Appointment%20Booking%20Calendar%20Plugin%20and%20Scheduling%20Plugin%20%E2%80%93%20BookingPress%20%3C%3D%201.1.21%20-%20Authenticated%20%28Contributor%2B%29%20SQL%20Injection "Facebook")
[Twitter](https://twitter.com/share?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fbookingpress-appointment-booking%2Fappointment-booking-calendar-plugin-and-scheduling-plugin-bookingpress-1121-authenticated-contributor-sql-injection&text=Appointment%20Booking%20Calendar%20Plugin%20and%20Scheduling%20Plugin%20%E2%80%93%20BookingPress%20%3C%3D%201.1.21%20-%20Authenticated%20%28Contributor%2B%29%20SQL%20Injection "Twitter")
[LinkedIn](https://www.linkedin.com/shareArticle?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fbookingpress-appointment-booking%2Fappointment-booking-calendar-plugin-and-scheduling-plugin-bookingpress-1121-authenticated-contributor-sql-injection "LinkedIn")
Email

## Vulnerability Details for Appointment Booking Calendar Plugin and Scheduling Plugin – BookingPress

#### [Appointment Booking Calendar Plugin and Scheduling Plugin – BookingPress](https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/bookingpress-appointment-booking)

| Software Type | Plugin |
| --- | --- |
| Software Slug | bookingpress-appointment-booking [(view on wordpress.org)](https://wordpress.org/plugins/bookingpress-appointment-booking) |
| Patched? | Yes |
| Remediation | Update to version 1.1.22, or a newer patched version |
| Affected Version | * <= 1.1.21 |
| Patched Version | * 1.1.22 |

This record contains material that is subject to copyright.

**Copyright 2012-2025 Defiant Inc.**

**License:**
Defiant hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute this software vulnerability information. Any copy of the software vulnerability information you make for such purposes is authorized provided that you include a hyperlink to this vulnerability record and reproduce Defiant's copyright designation and this license in any such copy.
**[Read more.](https://www.wordfence.com/wordfence-intelligence-terms-and-conditions/)**

**Copyright 1999-2025 The MITRE Corporation**

**License:**
CVE Usage: MITRE hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute Common Vulnerabilities and Exposures (CVE®). Any copy you make for such purposes is authorized provided that you reproduce MITRE's copyright designation and this license in any such copy.
**[Read more.](https://www.cve.org/Legal/TermsOfUse)**

Have information to add, or spot any errors? Contact us at wfi-support@wordfence.com so we can make any appropriate adjustments.

Did you know Wordfence Intelligence provides free personal and commercial API access to our comprehensive WordPress vulnerability database, along with a free webhook integration to stay on top of the latest vulnerabilities added and updated in the database? Get started today!

Learn more

Want to get notified of the latest vulnerabilities that may affect your WordPress site?
 Install Wordfence on your site today to get notified immediately if your site is affected by a vulnerability that has been added to our database.

Get Wordfence

The Wordfence Intelligence WordPress vulnerability database is completely free to access and query via API. Please review the documentation on how to access and consume the vulnerability data via API.

Documentation



=== Content from plugins.trac.wordpress.org_d6d407b1_20250114_205445.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fchangeset%2F3206780%2Fbookingpress-appointment-booking%2Ftrunk%2Fcore%2Fclasses%2Ffrontend%2Fclass.bookingpress_appointment_bookings.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Change](/changeset/3194710/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php "Changeset 3194710 for bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php")
* [Next Change](/changeset/3210916/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php "Changeset 3210916 for bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php") →

---

# Changeset [3206780](/changeset/3206780 "Show full changeset") for [bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress\_appointment\_bookings.php](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3206780 "Show entry in browser")

View differences
inline
side by side

Show
lines around each change

Show the changes in full context

Ignore:

Blank lines

Case changes

White space changes

Timestamp:
12/12/2024 08:07:09 AM
([5 weeks](/timeline?from=2024-12-12T08%3A07%3A09Z&precision=second "See timeline at 12/12/2024 08:07:09 AM") ago)

Author:
reputeinfosystems
Message:
# 1.1.22

* Improved disable dates background color in the booking form calendar
* Other Minor bug fixes

File:

1 edited

* [bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress\_appointment\_bookings.php](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3206780 "Show entry in browser")
  (modified)
  ([44 diffs](#file0 "Show differences"))

### Legend:

Unmodified
Added
Removed

* ## [bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress\_appointment\_bookings.php](/changeset/3206780/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php "Show the changeset 3206780 restricted to bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php")

  | [r3194710](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3194710#L1592 "Show revision 3194710 of this file in browser") | [r3206780](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3206780#L1592 "Show revision 3206780 of this file in browser") |  |
  | --- | --- | --- |
  | 1592 | 1592 | $response['working\_hour\_timing\_token'] = $entire\_month\_details['working\_hour\_timing\_token']; |
  | 1593 | 1593 | $response['bpa\_disabled\_dates'] = $entire\_month\_details['bpa\_disabled\_dates']; |
  |  | 1594 | $response['overnight\_booking\_dates'] = $entire\_month\_details['overnight\_booking\_dates']; |
  | 1594 | 1595 |  |
  | 1595 | 1596 | $end\_ms = microtime( true ); |
  | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3194710#L1802) | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3206780#L1803) |  |
  | 1802 | 1803 |  |
  | 1803 | 1804 | $first\_available\_date = ''; |
  | 1804 |  |  |
  |  | 1805 | $overnight\_booking\_dates = []; |
  | 1805 | 1806 | foreach( $period as $dt ){ |
  | 1806 | 1807 | $bpa\_check\_date = $dt->format('Y-m-d'); |
  | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3194710#L1835) | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3206780#L1836) |  |
  | 1835 | 1836 | } |
  | 1836 | 1837 |  |
  | 1837 |  | if( $total\_booked == $total\_available\_slots ){ |
  |  | 1838 | $bookingpress\_allow\_to\_disable\_booked\_date = apply\_filters('bookingpress\_allow\_to\_disable\_booked\_date',true,$bookingpress\_selected\_service); |
  |  | 1839 |  |
  |  | 1840 | if( $total\_booked == $total\_available\_slots && $bookingpress\_allow\_to\_disable\_booked\_date == true ){ |
  | 1838 | 1841 | $front\_timings\_data\_combined = []; |
  | 1839 | 1842 | } |
  | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3194710#L1844) | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3206780#L1847) |  |
  | 1844 | 1847 | } |
  | 1845 | 1848 |  |
  |  | 1849 |  |
  |  | 1850 |  |
  | 1846 | 1851 | if( !empty( $front\_timings\_data\_combined ) ){ |
  | 1847 | 1852 | foreach( $front\_timings\_data\_combined as $timeslot\_data ){ |
  | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3194710#L1850) | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3206780#L1855) |  |
  | 1850 | 1855 | $first\_available\_date = $timeslot\_data['store\_service\_date']; |
  | 1851 | 1856 | } |
  |  | 1857 |  |
  |  | 1858 | $is\_next\_date = !empty( $timeslot\_data['is\_next\_day'] ) ? $timeslot\_data['is\_next\_day'] : false; |
  | 1852 | 1859 |  |
  | 1853 | 1860 | $startDateTime = new DateTime( $timeslot\_data['store\_service\_date'] . ' ' . $timeslot\_data['store\_start\_time'], new DateTimeZone( $wp\_timezone\_offset ) ); |
  | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3194710#L1859) | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3206780#L1866) |  |
  | 1859 | 1866 | $start\_time = date('Y-m-d H:i:s', strtotime( $timeslot\_data['store\_service\_date'] . ' ' . $timeslot\_data['store\_start\_time'] ) ); |
  | 1860 | 1867 |  |
  | 1861 |  | $start\_datetime = apply\_filters( 'bookingpress\_modify\_start\_date\_time', $startDateTime->format('Y-m-d'), $start\_time ); |
  |  | 1868 | if( true == $is\_next\_date && $timeslot\_data['store\_service\_date'] != $timeslot\_data['selected\_date']){ |
  |  | 1869 | $tmpStartDateTime = clone $startDateTime; |
  |  | 1870 | $tmpStartDateTime->modify( '-1 day'); |
  |  | 1871 | $start\_datetime = apply\_filters( 'bookingpress\_modify\_start\_date\_time', $tmpStartDateTime->format('Y-m-d'), $start\_time ); |
  |  | 1872 | } else { |
  |  | 1873 | $start\_datetime = apply\_filters( 'bookingpress\_modify\_start\_date\_time', $startDateTime->format('Y-m-d'), $start\_time ); |
  |  | 1874 | } |
  | 1862 | 1875 |  |
  | 1863 | 1876 | $working\_hour\_details[ $start\_datetime ][] = $timeslot\_data; |
  | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3194710#L1868) | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3206780#L1881) |  |
  | 1868 | 1881 | if( !in\_array( $front\_timings\_data['timing\_token\_data'], $working\_hour\_timing\_token[ $start\_datetime ] ) ){ |
  | 1869 | 1882 | $working\_hour\_timing\_token[ $start\_datetime ][] = $front\_timings\_data['timing\_token\_data']; |
  |  | 1883 | } |
  |  | 1884 | if( !empty( $timeslot\_data['is\_next\_day'] ) && !in\_array( $start\_datetime, $overnight\_booking\_dates ) ){ |
  |  | 1885 | $overnight\_booking\_dates[] = $start\_datetime; |
  | 1870 | 1886 | } |
  | 1871 | 1887 | } |
  | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3194710#L1895) | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3206780#L1911) |  |
  | 1895 | 1911 | $stop\_check = $working\_hour\_updated\_data['stop\_check']; |
  | 1896 | 1912 | $selected\_date = $working\_hour\_updated\_data['selected\_date']; |
  |  | 1913 | $overnight\_booking\_dates = $working\_hour\_updated\_data['overnight\_booking\_dates']; |
  | 1897 | 1914 | } |
  | 1898 | 1915 |  |
  | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3194710#L1909) | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3206780#L1926) |  |
  | 1909 | 1926 | $response['next\_month\_date'] = $max\_end\_date; |
  | 1910 | 1927 | $response['pre\_selected\_date'] = $preselected\_date; |
  |  | 1928 | $response['overnight\_booking\_dates'] = $overnight\_booking\_dates; |
  | 1911 | 1929 | $response['bpa\_disabled\_dates'] = $bpa\_retrieves\_default\_disabled\_dates; |
  | 1912 | 1930 | $response['stop\_check'] = ( false == $stop\_check && ( $bookingpress\_max\_date <= $max\_end\_date ) ) ? true : $stop\_check; |
  | 1913 | 1931 | $response['variant'] = 'success'; |
  | 1914 | 1932 | $response['selected\_date']  = $selected\_date; |
  |  | 1933 |  |
  | 1915 | 1934 |  |
  | 1916 | 1935 | if( true == $return ){ |
  | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3194710#L1922) | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3206780#L1941) |  |
  | 1922 | 1941 | $end\_ms = microtime( true ); |
  | 1923 | 1942 | $response['time\_taken'] = ( $end\_ms - $start\_ms ) . ' seconds'; |
  |  | 1943 |  |
  |  | 1944 | $response = apply\_filters( 'bookingpress\_modify\_disable\_timeslot\_external', $response ); |
  | 1924 | 1945 |  |
  | 1925 | 1946 | echo wp\_json\_encode( $response ); |
  | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3194710#L3400) | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3206780#L3421) |  |
  | 3400 | 3421 | if(!empty($appointments\_data) && is\_array($appointments\_data) ){ |
  | 3401 | 3422 | foreach($appointments\_data as $k => $v){ |
  | 3402 |  | if( !empty( $v['bookingpress\_selected\_appointment\_date'] ) && $BookingPress->bpa\_is\_pro\_active() ){ |
  |  | 3423 | if( !empty( $v['bookingpress\_selected\_appointment\_date'] ) && '0000-00-00' != $v['bookingpress\_selected\_appointment\_date'] && $BookingPress->bpa\_is\_pro\_active() ){ |
  | 3403 | 3424 | $bookingpress\_appointment\_date = date\_i18n($bookingpress\_date\_format, strtotime($v['bookingpress\_selected\_appointment\_date'])); |
  | 3404 | 3425 | } else { |
  | 3405 | 3426 | $bookingpress\_appointment\_date = date\_i18n($bookingpress\_date\_format, strtotime($v['bookingpress\_appointment\_date'])); |
  | 3406 | 3427 | } |
  |  | 3428 |  |
  | 3407 | 3429 | $appointments\_data[$k]['bookingpress\_appointment\_formatted\_date'] = $bookingpress\_appointment\_date; |
  | 3408 | 3430 |  |
  | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3194710#L3741) | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3206780#L3763) |  |
  | 3741 | 3763 | $booked\_appointment\_datetime = apply\_filters( 'bookingpress\_appointment\_change\_to\_client\_timezone', $booked\_appointment\_datetime, $bookingpress\_entry\_details['bookingpress\_customer\_timezone'], $bookingpress\_entry\_details ); |
  | 3742 | 3764 | } |
  |  | 3765 |  |
  |  | 3766 | $bookingpress\_default\_date\_time\_format = apply\_filters( 'bookingpress\_modify\_default\_date\_time\_format', $bookingpress\_default\_date\_time\_format, $appointment\_data\_val ); |
  | 3743 | 3767 |  |
  | 3744 | 3768 | $booked\_appointment\_date = date($bookingpress\_default\_date\_time\_format, strtotime($booked\_appointment\_datetime)); |
  | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3194710#L3749) | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3206780#L3773) |  |
  | 3749 | 3773 | }else{ |
  | 3750 | 3774 | $check\_timezone = false; |
  | 3751 |  | if( !empty( $appointment\_data['bookingpress\_selected\_appointment\_date'] ) && !empty( $appointment\_data['bookingpress\_selected\_appointment\_time'] ) && '0000-00-00' != $appointment\_data['bookingpress\_selected\_appointment\_date'] && '00:00:00' != $appointment\_data['bookingpress\_selected\_appointment\_time'] ){ |
  |  | 3775 |  |
  |  | 3776 | if( ( !empty( $appointment\_data['bookingpress\_selected\_appointment\_date'] ) && !empty( $appointment\_data['bookingpress\_selected\_appointment\_time'] ) && '0000-00-00' != $appointment\_data['bookingpress\_selected\_appointment\_date'] && '00:00:00' != $appointment\_data['bookingpress\_selected\_appointment\_time'] ) || 'd' == $appointment\_data['bookingpress\_service\_duration\_unit']  ){ |
  | 3752 | 3777 | $booked\_appointment\_datetime = esc\_html($appointment\_data['bookingpress\_selected\_appointment\_date']) . ' ' . esc\_html($appointment\_data['bookingpress\_selected\_appointment\_time']); |
  | 3753 | 3778 | } else { |
  | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3194710#L3770) | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3206780#L3795) |  |
  | 3770 | 3795 | } |
  | 3771 | 3796 |  |
  |  | 3797 | $bookingpress\_default\_date\_time\_format = apply\_filters( 'bookingpress\_modify\_default\_date\_time\_format', $bookingpress\_default\_date\_time\_format, $appointment\_data ); |
  | 3772 | 3798 |  |
  | 3773 | 3799 | $booked\_appointment\_date = date\_i18n($bookingpress\_default\_date\_time\_format, strtotime($booked\_appointment\_datetime)); |
  | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3194710#L4375) | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3206780#L4401) |  |
  | 4375 | 4401 | } |
  | 4376 | 4402 |  |
  | 4377 |  | $selected\_service\_id = ! empty($\_POST['service\_id']) ? intval($\_POST['service\_id']) : 0; |
  |  | 4403 | $selected\_service\_id =  ! empty($\_POST['service\_id']) ? intval($\_POST['service\_id']) : 0; |
  | 4378 | 4404 | if( empty( $selected\_service\_id ) ){ |
  | 4379 |  | $selected\_service\_id = !empty( $\_POST['appointment\_data\_obj']['selected\_service'] ) ? intval( $\_POST['appointment\_data\_obj']['selected\_service'] ) : ~~0~~; |
  |  | 4405 | $selected\_service\_id = !empty( $\_POST['appointment\_data\_obj']['selected\_service'] ) ? intval( $\_POST['appointment\_data\_obj']['selected\_service'] ) : ( !empty( $\_POST['selected\_service'] ) ? intval( $\_POST['selected\_service'] ) : 0 ); |
  | 4380 | 4406 | } |
  | 4381 | 4407 |  |
  | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3194710#L4432) | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3206780#L4458) |  |
  | 4432 | 4458 |  |
  | 4433 | 4459 | if( empty( $total\_booked\_appiontments ) && !empty( $\_POST['action'] ) && in\_array( $\_POST['action'], ['bookingpress\_front\_get\_timings' ,'bookingpress\_get\_disable\_date','bookingpress\_get\_whole\_day\_appointments', 'bookingpress\_get\_recurring\_appointments' ] ) ){ |
  | 4434 |  | $total\_booked\_appiontments = $wpdb->get\_results( $wpdb->prepare( "SELECT \* FROM {$tbl\_bookingpress\_appointment\_bookings} WHERE bookingpress\_appointment\_date = %s $where\_clause", $selected\_date), ARRAY\_A ); // phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared --Reason: $tbl\_bookingpress\_appointment\_bookings is a table name. false alarm |
  |  | 4460 |  |
  |  | 4461 | $where\_clause\_overnight\_booking = apply\_filters( 'bookingpress\_modify\_where\_clause\_for\_overnight\_booking', '', $selected\_date ); |
  |  | 4462 | $total\_booked\_appiontments = $wpdb->get\_results( $wpdb->prepare( "SELECT \* FROM {$tbl\_bookingpress\_appointment\_bookings} WHERE (bookingpress\_appointment\_date = %s $where\_clause\_overnight\_booking) $where\_clause", $selected\_date), ARRAY\_A ); // phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared --Reason: $tbl\_bookingpress\_appointment\_bookings is a table name. false alarm |
  | 4435 | 4463 | } |
  | 4436 | 4464 |  |
  | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3194710#L4462) | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3206780#L4490) |  |
  | 4462 | 4490 |  |
  | 4463 | 4491 | $total\_booked\_appiontments = apply\_filters( 'bookingpress\_modify\_booked\_appointment\_data', $total\_booked\_appiontments, $selected\_date, $service\_timings, $selected\_service\_id ); |
  | 4464 |  |  |
  |  | 4492 |  |
  | 4465 | 4493 | /\*\* Remove Booked Time Slots from the final service timings - start \*/ |
  | 4466 | 4494 |  |
  | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3194710#L4489) | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3206780#L4517) |  |
  | 4489 | 4517 | $service\_temp\_timings = $service\_timings; |
  | 4490 | 4518 |  |
  | 4491 |  |  |
  | 4492 |  |  |
  | 4493 | 4519 | if( !empty( $total\_booked\_appiontments ) && !empty( $service\_timings ) ){ |
  | 4494 | 4520 | foreach( $total\_booked\_appiontments as $booked\_appointment\_data ){ |
  | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3194710#L4498) | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3206780#L4524) |  |
  | 4498 | 4524 | $booked\_appointment\_end\_time = $booked\_appointment\_data['bookingpress\_appointment\_end\_time']; |
  | 4499 | 4525 |  |
  |  | 4526 | $booked\_appointment\_start\_date = ( !empty( $booked\_appointment\_data['bookingpress\_appointment\_date'] ) && '0000-00-00' != $booked\_appointment\_data['bookingpress\_appointment\_date'] ) ? $booked\_appointment\_data['bookingpress\_appointment\_date'] : $selected\_date; |
  |  | 4527 | $booked\_appointment\_end\_date = ( !empty( $booked\_appointment\_data['bookingpress\_appointment\_end\_date'] ) && '0000-00-00' != $booked\_appointment\_data['bookingpress\_appointment\_end\_date'] ) ? $booked\_appointment\_data['bookingpress\_appointment\_end\_date'] : $booked\_appointment\_start\_date; |
  |  | 4528 |  |
  | 4500 | 4529 | if( '00:00:00' == $booked\_appointment\_end\_time ){ |
  | 4501 | 4530 | $booked\_appointment\_end\_time = '24:00:00'; |
  | 4502 | 4531 | } |
  |  | 4532 |  |
  |  | 4533 | $booked\_appointment\_start\_datetime = $booked\_appointment\_start\_date.' ' . $booked\_appointment\_start\_time; |
  |  | 4534 | $booked\_appointment\_end\_datetime = $booked\_appointment\_end\_date.' ' . $booked\_appointment\_end\_time; |
  |  | 4535 |  |
  | 4503 | 4536 |  |
  | 4504 | 4537 | foreach( $service\_timings as $sk => $time\_slot\_data ){ |
  | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3194710#L4506) | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3206780#L4539) |  |
  | 4506 | 4539 | $current\_time\_end = $time\_slot\_data['store\_end\_time'].':00'; |
  | 4507 | 4540 |  |
  | 4508 |  | if( $booked\_appointment\_data['bookingpress\_appointment\_date'] != $time\_slot\_data['store\_service\_date'] ){ |
  | 4509 |  | continue; |
  | 4510 |  | } |
  | 4511 |  |  |
  | 4512 |  | if( ( $booked\_appointment\_start\_time >= $current\_time\_start && $booked\_appointment\_end\_time <= $current\_time\_end ) || ( $booked\_appointment\_start\_time < $current\_time\_end && $booked\_appointment\_end\_time > $current\_time\_start) ){ |
  |  | 4541 | $current\_time\_start\_datetime = $time\_slot\_data['store\_service\_date'] . ' ' . $current\_time\_start; |
  |  | 4542 | $current\_time\_end\_datetime = ( !empty( $time\_slot\_data['selected\_end\_date'] ) && '0000-00-00' != $time\_slot\_data['selected\_end\_date'] ) ? ( $time\_slot\_data['selected\_end\_date'] . ' '. $current\_time\_end ) : ( $time\_slot\_data['store\_service\_date'] . ' ' . $current\_time\_end ); |
  |  | 4543 |  |
  |  | 4544 |  |
  |  | 4545 | if( ( $booked\_appointment\_start\_datetime >= $current\_time\_start\_datetime && $booked\_appointment\_end\_datetime <= $current\_time\_end\_datetime ) || ( $booked\_appointment\_start\_datetime < $current\_time\_end\_datetime && $booked\_appointment\_end\_datetime > $current\_time\_start\_datetime ) ){ |
  |  | 4546 |  |
  |  | 4547 | //echo $booked\_appointment\_start\_datetime. ' -- ' . $booked\_appointment\_end\_datetime. ' -- ' . $current\_time\_start\_datetime . ' --- ' . $current\_time\_end\_datetime.' ----<br/><br/>'; |
  | 4513 | 4548 |  |
  | 4514 | 4549 | $bookingpress\_single\_time\_slot\_data = $time\_slot\_data; |
  | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3194710#L4530) | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3206780#L4565) |  |
  | 4530 | 4565 | $total\_guests = $extra\_members; |
  | 4531 | 4566 | $service\_timings[ $sk ]['guest\_members'] = $total\_guests; |
  | 4532 |  | } else { |
  |  | 4567 | } else { |
  | 4533 | 4568 | $service\_timings[ $sk ]['guest\_members'] = $total\_guests; |
  | 4534 |  | } |
  | 4535 |  |  |
  |  | 4569 | } |
  | 4536 | 4570 |  |
  | 4537 | 4571 | /\* Share capacity betweenslot issue fixed start \*/ |
  | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3194710#L4591) | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3206780#L4625) |  |
  | 4591 | 4625 | $service\_timings[ $sk ]['is\_reduced\_capacity'] = true; |
  | 4592 | 4626 | } else { |
  | 4593 |  | if( $booked\_appointment\_start\_~~time == $current\_time\_start && $booked\_appointment\_end\_time == $current\_time\_end~~ ){ |
  |  | 4627 | if( $booked\_appointment\_start\_datetime == $current\_time\_start\_datetime && $booked\_appointment\_end\_datetime == $current\_time\_end\_datetime ){ |
  | 4594 | 4628 |  |
  | 4595 | 4629 | $service\_timings[ $sk ]['max\_capacity'] -= $capacity\_count; // reduce capacity for exact time slot |
  | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3194710#L4857) | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3206780#L4891) |  |
  | 4857 | 4891 | } |
  | 4858 | 4892 |  |
  |  | 4893 | $next\_day\_times = []; |
  |  | 4894 | foreach( $morning\_time as $mkey => $mvalue ){ |
  |  | 4895 | if( !empty( $mvalue['is\_next\_day'] ) && ( true === $mvalue['is\_next\_day'] || 'true' == $mvalue['is\_next\_day'] ) ){ |
  |  | 4896 | $next\_day\_times[] = $mvalue; |
  |  | 4897 | unset( $morning\_time[ $mkey ] ); |
  |  | 4898 | } |
  |  | 4899 | } |
  |  | 4900 |  |
  |  | 4901 | $morning\_time = array\_values( $morning\_time ); |
  |  | 4902 |  |
  | 4859 | 4903 | $return\_data = array( |
  | 4860 | 4904 | 'morning\_time'   => $morning\_time, |
  | 4861 | 4905 | 'afternoon\_time' => $afternoon\_time, |
  | 4862 | 4906 | 'evening\_time'   => $evening\_time, |
  | 4863 |  | 'night\_time'     => ~~$night\_time,~~ |
  |  | 4907 | 'night\_time'     => array\_merge( $night\_time, $next\_day\_times ) |
  | 4864 | 4908 | ); |
  | 4865 | 4909 |  |
  | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3194710#L5005) | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3206780#L5049) |  |
  | 5005 | 5049 |  |
  | 5006 | 5050 |  |
  |  | 5051 | $category = explode( ',', $category ); |
  |  | 5052 | $category = array\_map( 'intval', $category ); |
  |  | 5053 | $category = implode( ',', $category ); |
  |  | 5054 |  |
  | 5007 | 5055 | $Bookingpress\_service  = 0; |
  | 5008 | 5056 | $Bookingpress\_category = 0; |
  | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3194710#L6421) | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3206780#L6469) |  |
  | 6421 | 6469 | $bookingpress\_front\_vue\_data\_fields['v\_calendar\_disable\_dates'] = array(); |
  | 6422 | 6470 | $bookingpress\_front\_vue\_data\_fields['v\_calendar\_available\_dates'] = array(); |
  |  | 6471 | $bookingpress\_front\_vue\_data\_fields['v\_calendar\_blocked\_dates'] = array(); |
  | 6423 | 6472 | $bookingpress\_front\_vue\_data\_fields['v\_calendar\_available\_only\_date'] = array(); |
  | 6424 | 6473 | $bookingpress\_front\_vue\_data\_fields['v\_calendar\_timeslots\_data'] = array(); |
  | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3194710#L7227) | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3206780#L7276) |  |
  | 7227 | 7276 | $bookigpress\_time\_format\_for\_booking\_form = $BookingPress->bookingpress\_get\_customize\_settings('bookigpress\_time\_format\_for\_booking\_form','booking\_form'); |
  | 7228 | 7277 | $bookigpress\_time\_format\_for\_booking\_form = !empty($bookigpress\_time\_format\_for\_booking\_form) ? $bookigpress\_time\_format\_for\_booking\_form : '2'; |
  |  | 7278 |  |
  |  | 7279 | $convert\_timeslot\_to\_client\_timezone = false; |
  |  | 7280 | if( $BookingPress->bpa\_is\_pro\_active() ){ |
  |  | 7281 | $convert\_timeslot\_to\_client\_timezone = $BookingPress->bookingpress\_get\_settings( 'show\_bookingslots\_in\_client\_timezone', 'general\_setting' ); |
  |  | 7282 | } |
  | 7229 | 7283 |  |
  | 7230 | 7284 | $bookingpress\_global\_details     = $bookingpress\_global\_options->bookingpress\_global\_options(); |
  | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3194710#L7249) | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3206780#L7303) |  |
  | 7249 | 7303 | $bookingpress\_step\_navigation\_token\_postdata = ''; |
  | 7250 | 7304 | $bookingpress\_step\_navigation\_token\_postdata = apply\_filters( 'bookingpress\_modify\_step\_navigation\_token\_postdata', $bookingpress\_step\_navigation\_token\_postdata ); |
  |  | 7305 |  |
  |  | 7306 | $bookingpress\_step\_navigation\_token\_selection\_data = ''; |
  |  | 7307 | $bookingpress\_step\_navigation\_token\_selection\_data = apply\_filters( 'bookingpress\_modify\_step\_navigation\_token\_date\_selection', $bookingpress\_step\_navigation\_token\_selection\_data ); |
  | 7251 | 7308 |  |
  | 7252 | 7309 | $bookingpress\_use\_legacy\_functions = 'false'; |
  | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3194710#L7620) | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3206780#L7677) |  |
  | 7620 | 7677 |  |
  | 7621 | 7678 | vm.appointment\_step\_form\_data.selected\_service = selected\_service\_id; |
  |  | 7679 | vm.v\_calendar\_blocked\_dates = []; |
  |  | 7680 | vm.v\_calendar\_attributes\_current = []; |
  | 7622 | 7681 |  |
  | 7623 | 7682 | vm.appointment\_step\_form\_data.selected\_service\_name = service\_name; |
  | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3194710#L7672) | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3206780#L7731) |  |
  | 7672 | 7731 | let dayId = day.id; |
  | 7673 | 7732 | let dayString = dayId + " 00:00:00"; |
  | 7674 |  | if( "undefined" == typeof dayString || "undefined" == typeof available\_dates || 0 > available\_dates.indexOf( dayString ) || vm.bpa\_current\_selected\_date == dayId){ |
  |  | 7733 | if( "undefined" == typeof dayString || "undefined" == typeof available\_dates || 0 > available\_dates.indexOf( dayString ) || vm.bpa\_current\_selected\_date == dayId || ("undefined" != typeof vm.v\_calendar\_blocked\_dates && vm.v\_calendar\_blocked\_dates.includes( day.id ) ) ){ |
  | 7675 | 7734 | return false; |
  | 7676 | 7735 | } |
  | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3194710#L7815) | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3206780#L7874) |  |
  | 7815 | 7874 | } |
  | 7816 | 7875 |  |
  | 7817 |  | if(~~/\* "undefined" != typeof vm.bookingpress\_timezone\_offset && \*/~~ "" != store\_start\_time && "" != store\_end\_time && "" != store\_selected\_date ){ |
  |  | 7876 | if("" != store\_start\_time && "" != store\_end\_time && "" != store\_selected\_date ){ |
  | 7818 | 7877 | vm.appointment\_step\_form\_data.store\_start\_time = store\_start\_time; |
  | 7819 | 7878 | vm.appointment\_step\_form\_data.store\_end\_time = store\_end\_time; |
  | 7820 | 7879 | vm.appointment\_step\_form\_data.client\_offset = vm.bookingpress\_timezone\_offset; |
  | 7821 | 7880 | vm.appointment\_step\_form\_data.store\_selected\_date = store\_selected\_date; |
  |  | 7881 | vm.appointment\_step\_form\_data.store\_selected\_end\_date = time\_details.selected\_end\_date || store\_selected\_date; |
  | 7822 | 7882 | } |
  | 7823 | 7883 |  |
  | 7824 | 7884 | vm.appointment\_step\_form\_data.customer\_selected\_date = time\_details.client\_date || vm.appointment\_step\_form\_data.selected\_date; |
  | 7825 |  | vm.appointment\_step\_form\_data.customer\_selected\_end\_date = time\_details.client\_date || vm.appointment\_step\_form\_data.selected\_date; |
  |  | 7885 | vm.appointment\_step\_form\_data.customer\_selected\_end\_date = time\_details.client\_end\_date || time\_details.client\_date || vm.appointment\_step\_form\_data.selected\_date; |
  | 7826 | 7886 | vm.appointment\_step\_form\_data.customer\_selected\_time = time\_details.client\_start\_time || selected\_start\_time; |
  | 7827 | 7887 | vm.appointment\_step\_form\_data.customer\_selected\_end\_time = time\_details.client\_end\_time || selected\_end\_time; |
  | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3194710#L8086) | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3206780#L8146) |  |
  | 8086 | 8146 | let current\_tab = vm.bookingpress\_sidebar\_step\_data[vm.bookingpress\_current\_tab].next\_tab\_name; |
  | 8087 | 8147 |  |
  | 8088 |  | if( ~~true == force\_update~~ || ( "datetime" == vm.bookingpress\_sidebar\_step\_data[ vm.bookingpress\_current\_tab ].previous\_tab\_name && "d" != vm.appointment\_step\_form\_data.selected\_service\_duration\_unit && "datetime" != vm.bookingpress\_current\_tab && "false" == use\_legacy ) ){ |
  | 8089 |  | console.log( vm.is\_bookingpress\_updating\_token ); |
  |  | 8148 | if( (true == force\_update && typeof vm.v\_calendar\_time\_token\_data != "undefined") || ( "datetime" == vm.bookingpress\_sidebar\_step\_data[ vm.bookingpress\_current\_tab ].previous\_tab\_name && "d" != vm.appointment\_step\_form\_data.selected\_service\_duration\_unit && "datetime" != vm.bookingpress\_current\_tab && "false" == use\_legacy ) ){ |
  |  | 8149 |  |
  | 8090 | 8150 | let appointment\_selected\_date = vm.appointment\_step\_form\_data.store\_selected\_date || vm.appointment\_step\_form\_data.selected\_date; |
  |  | 8151 | '.$bookingpress\_step\_navigation\_token\_selection\_data.' |
  | 8091 | 8152 | let selected\_token\_data = vm.v\_calendar\_time\_token\_data[ appointment\_selected\_date ][0]; |
  | 8092 | 8153 |  |
  | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3194710#L8119) | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3206780#L8180) |  |
  | 8119 | 8180 | }, |
  | 8120 | 8181 | bookingpress\_working\_dates\_data( working\_hour\_details, response\_data ){ |
  |  | 8182 | const vm = this; |
  |  | 8183 |  |
  |  | 8184 | let timeformat = "'.$bookigpress\_time\_format\_for\_booking\_form.'"; |
  |  | 8185 | let is\_client\_timezone = "'.$convert\_timeslot\_to\_client\_timezone.'"; |
  |  | 8186 | let updated\_working\_hour\_details = {}; |
  |  | 8187 | let available\_dates = []; |
  |  | 8188 | let response = {}; |
  |  | 8189 | let firstAvailableDate = ""; |
  |  | 8190 |  |
  |  | 8191 | let overnight\_booking = ("undefined" != typeof response\_data.overnight\_booking\_dates ) ? response\_data.overnight\_booking\_dates : []; |
  |  | 8192 |  |
  |  | 8193 | let sorted\_working\_hours = []; |
  |  | 8194 |  |
  |  | 8195 |  |
  |  | 8196 | for( let wdate in working\_hour\_details ){ |
  |  | 8197 | let x = 0; |
  |  | 8198 | let n = 0; |
  |  | 8199 |  |
  |  | 8200 | let is\_overnight\_booking = overnight\_booking.includes( wdate ) || false; |
  |  | 8201 |  |
  |  | 8202 | let overnight\_booking\_date = ""; |
  |  | 8203 |  |
  |  | 8204 | sorted\_working\_hours[wdate] = working\_hour\_details[ wdate ]; |
  |  | 8205 |  |
  |  | 8206 | sorted\_working\_hours[wdate].sort( (a,b) => { |
  |  | 8207 | return ( parseInt( a.counter\_pos ) < parseInt( b.counter\_pos ) ) ? -1 : 1; |
  |  | 8208 | } ); |
  |  | 8209 |  |
  |  | 8210 | for( let wh\_data of sorted\_working\_hours[wdate] ){ |
  |  | 8211 | let start\_datetime = wh\_data.store\_service\_date + " " + wh\_data.store\_start\_time; |
  |  | 8212 | let end\_datetime = wh\_data.selected\_end\_date + " " + wh\_data.store\_end\_time; |
  |  | 8213 | let timezone = wh\_data.store\_offset; |
  |  | 8214 |  |
  |  | 8215 | let stTime = wp.hooks.applyFilters( "bookingpress\_modify\_time\_with\_timezone", wh\_data.store\_start\_time, wh\_data, "start" ); |
  |  | 8216 | wh\_data.client\_start\_time = stTime; |
  |  | 8217 | let etTime = wp.hooks.applyFilters( "bookingpress\_modify\_time\_with\_timezone", wh\_data.store\_end\_time, wh\_data, "end" ); |
  |  | 8218 | wh\_data.client\_end\_time = etTime; |
  |  | 8219 |  |
  |  | 8220 | let stTimeNew = wp.hooks.applyFilters( "bookingpress\_modify\_datetime\_with\_timezone", start\_datetime, wh\_data, "start", true ); |
  |  | 8221 | let etTimeNew = wp.hooks.applyFilters( "bookingpress\_modify\_datetime\_with\_timezone", end\_datetime, wh\_data, "end", true ); |
  |  | 8222 |  |
  |  | 8223 | let updated\_wdate; |
  |  | 8224 | if( "string" == typeof stTimeNew ){ |
  |  | 8225 | updated\_wdate = wdate; |
  |  | 8226 | } else { |
  |  | 8227 | updated\_wdate = stTimeNew.toISOString().split("T")[0]; |
  |  | 8228 | } |
  |  | 8229 | let updated\_edate; |
  |  | 8230 | if( "string" == typeof etTimeNew ){ |
  |  | 8231 | updated\_edate = wh\_data.selected\_end\_date; |
  |  | 8232 | } else { |
  |  | 8233 | updated\_edate = etTimeNew.toISOString().split("T")[0]; |
  |  | 8234 | } |
  |  | 8235 |  |
  |  | 8236 | if( "undefined" != typeof wh\_data.is\_day\_service && true == wh\_data.is\_day\_service ){ |
  |  | 8237 | if( "undefined" == typeof updated\_working\_hour\_details[ updated\_wdate ] && updated\_wdate >= vm.jsCurrentDate.toISOString().split("T")[0] ){ |
  |  | 8238 | updated\_working\_hour\_details[ updated\_wdate ] = []; |
  |  | 8239 | if( false == is\_overnight\_booking && !available\_dates.includes( updated\_wdate + " 00:00:00" ) ){ |
  |  | 8240 | available\_dates.push( updated\_wdate + " 00:00:00" ); |
  |  | 8241 | } |
  |  | 8242 | n++; |
  |  | 8243 | } else { |
  |  | 8244 | continue; |
  |  | 8245 | } |
  |  | 8246 | } else { |
  |  | 8247 | if( "undefined" == typeof updated\_working\_hour\_details[ updated\_wdate ] ){ |
  |  | 8248 | updated\_working\_hour\_details[ updated\_wdate ] = []; |
  |  | 8249 | if( false == is\_overnight\_booking && !available\_dates.includes( updated\_wdate + " 00:00:00" ) ){ |
  |  | 8250 | available\_dates.push( updated\_wdate + " 00:00:00" ); |
  |  | 8251 | } |
  |  | 8252 | n++; |
  |  | 8253 | } |
  |  | 8254 | } |
  |  | 8255 |  |
  |  | 8256 | if( "" == firstAvailableDate ){ |
  |  | 8257 | firstAvailableDate = ( "undefined" != typeof response\_data.pre\_selected\_date && true == response\_data.pre\_selected\_date && "undefined" != typeof vm.open\_customer\_reschedule\_appointment\_modal && true == vm.open\_customer\_reschedule\_appointment\_modal ) ? response\_data.selected\_date : updated\_wdate; |
  |  | 8258 | } |
  |  | 8259 |  |
  |  | 8260 | wh\_data.client\_date = updated\_wdate; |
  |  | 8261 | wh\_data.client\_end\_date = updated\_edate; |
  |  | 8262 |  |
  |  | 8263 | if( true == is\_overnight\_booking && "" == overnight\_booking\_date ){ |
  |  | 8264 | overnight\_booking\_date = updated\_wdate; |
  |  | 8265 | if( "undefined" == typeof updated\_working\_hour\_details[ overnight\_booking\_date ] ){ |
  |  | 8266 | updated\_working\_hour\_details[ overnight\_booking\_date ] = []; |
  |  | 8267 | } |
  |  | 8268 | } |
  |  | 8269 | wh\_data.is\_both\_next\_day\_time\_v2 = false; |
  |  | 8270 |  |
  |  | 8271 | if( true == is\_overnight\_booking ){ |
  |  | 8272 |  |
  |  | 8273 | if( "true" == is\_client\_timezone ){ |
  |  | 8274 | wh\_data.is\_next\_day = false; |
  |  | 8275 | } |
  |  | 8276 |  |
  |  | 8277 | if( updated\_edate > updated\_wdate ){ |
  |  | 8278 | wh\_data.is\_next\_day = true; |
  |  | 8279 | } |
  |  | 8280 |  |
  |  | 8281 | if( updated\_edate == updated\_wdate && updated\_wdate > overnight\_booking\_date ){ |
  |  | 8282 | wh\_data.is\_both\_next\_day\_time\_v2 = true; |
  |  | 8283 | wh\_data.is\_next\_day = true; |
  |  | 8284 | wh\_data.client\_date = wh\_data.client\_end\_date; |
  |  | 8285 | } |
  |  | 8286 | } |
  |  | 8287 |  |
  |  | 8288 | if( true == wh\_data.is\_both\_next\_day\_time && wh\_data.client\_end\_date > wh\_data.client\_date ){ |
  |  | 8289 | wh\_data.client\_date = wh\_data.client\_end\_date; |
  |  | 8290 | } |
  |  | 8291 |  |
  |  | 8292 | let startTimeHour = stTime.split(":")[0]; |
  |  | 8293 |  |
  |  | 8294 | let formatted\_startTime = vm.bookingpress\_format\_time( stTime ); |
  |  | 8295 | let formatted\_endTime = vm.bookingpress\_format\_time( etTime ); |
  |  | 8296 |  |
  |  | 8297 | let formatted\_datetime = formatted\_startTime + " - " + formatted\_endTime; |
  |  | 8298 | if( "1" == timeformat || "2" == timeformat ){ |
  |  | 8299 | formatted\_datetime = formatted\_startTime + " to " + formatted\_endTime; |
  |  | 8300 | } else if ( "5" == timeformat || "6" == timeformat ){ |
  |  | 8301 | formatted\_datetime = formatted\_startTime + " - " + formatted\_endTime; |
  |  | 8302 | } else if( "3" == timeformat || "4" == timeformat ){ |
  |  | 8303 | formatted\_datetime = formatted\_startTime; |
  |  | 8304 | } |
  |  | 8305 |  |
  |  | 8306 | wh\_data.formatted\_start\_time = formatted\_startTime; |
  |  | 8307 | wh\_data.formatted\_end\_time = formatted\_endTime; |
  |  | 8308 | wh\_data.formatted\_start\_end\_time = formatted\_datetime; |
  |  | 8309 | wh\_data.start\_hour = startTimeHour; |
  |  | 8310 |  |
  |  | 8311 | if( true == is\_overnight\_booking ){ |
  |  | 8312 | updated\_working\_hour\_details[ overnight\_booking\_date ][x] = wh\_data; |
  |  | 8313 | if( !available\_dates.includes( overnight\_booking\_date + " 00:00:00" ) ){ |
  |  | 8314 | available\_dates.push( overnight\_booking\_date + " 00:00:00" ); |
  |  | 8315 | } |
  |  | 8316 | } else { |
  |  | 8317 | updated\_working\_hour\_details[ updated\_wdate ][x] = wh\_data; |
  |  | 8318 | } |
  |  | 8319 |  |
  |  | 8320 | x++; |
  |  | 8321 | } |
  |  | 8322 | } |
  |  | 8323 |  |
  |  | 8324 | available\_dates = wp.hooks.applyFilters( "bookingpress\_modify\_available\_dates\_with\_day\_service", available\_dates, working\_hour\_details, response\_data, vm ); |
  |  | 8325 | firstAvailableDate = wp.hooks.applyFilters( "bookingpress\_modify\_first\_available\_date\_with\_day\_service", firstAvailableDate, available\_dates, vm ); |
  |  | 8326 |  |
  |  | 8327 | response.available\_dates = available\_dates; |
  |  | 8328 | response.updated\_working\_hour\_details = updated\_working\_hour\_details; |
  |  | 8329 | response.selected\_date = firstAvailableDate; |
  |  | 8330 |  |
  |  | 8331 | return response; |
  |  | 8332 | }, |
  |  | 8333 | bookingpress\_working\_dates\_data\_legacy( working\_hour\_details, response\_data ){ |
  | 8121 | 8334 | const vm = this; |
  | 8122 | 8335 | let timeformat = "'.$bookigpress\_time\_format\_for\_booking\_form.'"; |
  | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3194710#L8140) | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3206780#L8353) |  |
  | 8140 | 8353 |  |
  | 8141 | 8354 | let updated\_wdate = wp.hooks.applyFilters( "bookingpress\_modify\_date\_with\_timezone", wdate, wh\_data ); |
  |  | 8355 | let updated\_edate = wp.hooks.applyFilters( "bookingpress\_modify\_date\_with\_timezone", wh\_data.selected\_end\_date, wh\_data ); |
  | 8142 | 8356 |  |
  | 8143 | 8357 | if( "undefined" != typeof wh\_data.is\_day\_service && true == wh\_data.is\_day\_service ){ |
  | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3194710#L8165) | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3206780#L8379) |  |
  | 8165 | 8379 |  |
  | 8166 | 8380 | wh\_data.client\_date = updated\_wdate; |
  |  | 8381 | wh\_data.client\_end\_date = updated\_edate; |
  | 8167 | 8382 |  |
  | 8168 | 8383 | let startTimeHour = stTime.split(":")[0]; |
  | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3194710#L8269) | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3206780#L8484) |  |
  | 8269 | 8484 | vm.appointment\_step\_form\_data.selected\_date = ""; |
  | 8270 | 8485 | selectedDate = ( "" != preselected\_date ) ? preselected\_date : ( wh\_details.selected\_date || selectedDate ); |
  |  | 8486 |  |
  |  | 8487 | vm.v\_calendar\_available\_dates = wh\_details.available\_dates; |
  |  | 8488 | vm.v\_calendar\_timeslots\_data = wh\_details.updated\_working\_hour\_details; |
  |  | 8489 | vm.no\_timeslot\_available = false; |
  |  | 8490 | let v\_available\_dates\_only = []; |
  |  | 8491 | vm.v\_calendar\_available\_dates.forEach( function( i,e ){ |
  |  | 8492 | v\_available\_dates\_only.push( i.split(" ")[0] ); |
  |  | 8493 | }); |
  |  | 8494 | if( !v\_available\_dates\_only.includes( selectedDate ) && wh\_details.selected\_date != selectedDate ){ |
  |  | 8495 | selectedDate = wh\_details.selected\_date; |
  |  | 8496 | } |
  |  | 8497 | vm.v\_calendar\_available\_only\_date = v\_available\_dates\_only; |
  |  | 8498 |  |
  | 8271 | 8499 | if( "undefined" != typeof selectedDate ){ |
  | 8272 | 8500 | (function( $ref\_ ){ |
  | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3194710#L8293) | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3206780#L8521) |  |
  | 8293 | 8521 | })( this.$refs ); |
  | 8294 | 8522 | } |
  | 8295 |  |  |
  | 8296 |  | ~~vm.v\_calendar\_available\_dates = wh\_details.available\_dates;~~ |
  | 8297 |  | ~~vm.v\_calendar\_timeslots\_data = wh\_details.updated\_working\_hour\_details;~~ |
  | 8298 |  | ~~vm.no\_timeslot\_available = false;~~ |
  | 8299 |  | ~~let v\_available\_dates\_only = [];~~ |
  | 8300 |  | ~~vm.v\_calendar\_available\_dates.forEach( function( i,e ){~~ |
  | 8301 |  | ~~v\_available\_dates\_only.push( i.split(" ")[0] );~~ |
  | 8302 |  | ~~});~~ |
  | 8303 |  | ~~vm.v\_calendar\_available\_only\_date = v\_available\_dates\_only;~~ |
  | 8304 | 8523 |  |
  | 8305 | 8524 | /\* V-date-picker attributes \*/ |
  | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3194710#L8332) | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3206780#L8551) |  |
  | 8332 | 8551 |  |
  | 8333 | 8552 | vm.v\_calendar\_default\_label = response.data.max\_capacity\_capacity; |
  |  | 8553 |  |
  |  | 8554 | let vcal\_capacity\_attrs = response.data.vcal\_capacity\_attrs; |
  |  | 8555 | if( "undefined" != typeof vcal\_capacity\_attrs && vcal\_capacity\_attrs.length != "" ){ |
  |  | 8556 | for( let vcal\_date\_v2 in vcal\_capacity\_attrs ){ |
  |  | 8557 | let vcal\_data\_v2 = vcal\_capacity\_attrs[ vcal\_date\_v2 ]; |
  |  | 8558 |  |
  |  | 8559 | vcal\_date\_v2 = wp.hooks.applyFilters( "bookingpress\_modify\_date\_with\_timezone", vcal\_date\_v2, {"store\_service\_date":vcal\_date\_v2,"store\_start\_time":"00:00:00","store\_offset":"'.$wp\_timezone\_offset.'"} ); |
  |  | 8560 |  |
  |  | 8561 | if( "0" == vcal\_data\_v2 ){ |
  |  | 8562 | vm.v\_calendar\_blocked\_dates.push( vcal\_date\_v2 ); |
  |  | 8563 | } |
  |  | 8564 | } |
  |  | 8565 | } |
  |  | 8566 |  |
  | 8334 | 8567 | /\* V-date-picker attributes \*/ |
  | 8335 | 8568 |  |
  | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3194710#L8433) | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3206780#L8666) |  |
  | 8433 | 8666 | vm.v\_calendar\_attributes = vcal\_attr\_data; |
  | 8434 | 8667 | vm.v\_calendar\_attributes\_current = Object.assign( {}, vm.v\_calendar\_attributes\_current, vcal\_attr\_data\_current ); |
  |  | 8668 | } |
  |  | 8669 |  |
  |  | 8670 | let vcal\_capacity\_attrs = response.data.vcal\_capacity\_attrs; |
  |  | 8671 | if( "undefined" != typeof vcal\_capacity\_attrs && vcal\_capacity\_attrs.length != "" ){ |
  |  | 8672 | for( let vcal\_date\_v2 in vcal\_capacity\_attrs ){ |
  |  | 8673 | let vcal\_data\_v2 = vcal\_capacity\_attrs[ vcal\_date\_v2 ]; |
  |  | 8674 |  |
  |  | 8675 | vcal\_date\_v2 = wp.hooks.applyFilters( "bookingpress\_modify\_date\_with\_timezone", vcal\_date\_v2, {"store\_service\_date":vcal\_date\_v2,"store\_start\_time":"00:00:00","store\_offset":"'.$wp\_timezone\_offset.'"} ); |
  |  | 8676 |  |
  |  | 8677 | if( "0" == vcal\_data\_v2 ){ |
  |  | 8678 | vm.v\_calendar\_blocked\_dates.push( vcal\_date\_v2 ); |
  |  | 8679 | } |
  |  | 8680 | } |
  | 8435 | 8681 | } |
  | 8436 | 8682 |  |
  | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3194710#L8545) | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3206780#L8791) |  |
  | 8545 | 8791 | "night\_time":[] |
  | 8546 | 8792 | }; |
  | 8547 |  | let x = ~~1~~; |
  |  | 8793 | let x = 0; |
  | 8548 | 8794 | for( let timeslot\_data of timeslot\_details ){ |
  | 8549 |  | if( "undefined" != typeof timeslot\_data ){ |
  |  | 8795 | if( "undefined" != typeof timeslot\_data && ( "undefined" == typeof timeslot\_data.is\_next\_day || timeslot\_data.is\_next\_day == false) ){ |
  | 8550 | 8796 | let startHour = parseInt( timeslot\_data.start\_hour ); |
  | 8551 | 8797 | if( startHour >= 0 && startHour < afternoon\_slot\_timings ){ |
  | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3194710#L8561) | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3206780#L8807) |  |
  | 8561 | 8807 | } |
  | 8562 | 8808 | } |
  |  | 8809 | if( timeslot\_details.length > x ){ |
  |  | 8810 | for( let timeslot\_data of timeslot\_details ){ |
  |  | 8811 | if( "undefined" != typeof timeslot\_data && "undefined" != typeof timeslot\_data.is\_next\_day && timeslot\_data.is\_next\_day == true ){ |
  |  | 8812 | let startHour = parseInt( timeslot\_data.start\_hour ); |
  |  | 8813 | service\_timings\_data.night\_time.push( timeslot\_data ); |
  |  | 8814 | } |
  |  | 8815 | } |
  |  | 8816 | } |
  |  | 8817 | let night\_time = service\_timings\_data.night\_time; |
  |  | 8818 | let night\_time\_sorted = []; |
  |  | 8819 | for( let x in night\_time ){ |
  |  | 8820 | night\_time\_sorted.push( night\_time[x] ); |
  |  | 8821 | } |
  |  | 8822 |  |
  |  | 8823 | night\_time\_sorted.sort( (a,b) => { |
  |  | 8824 | return ( parseInt( a.counter\_pos ) < parseInt( b.counter\_pos ) ) ? -1 : 1; |
  |  | 8825 | } ); |
  |  | 8826 | service\_timings\_data.night\_time = night\_time\_sorted; |
  |  | 8827 |  |
  | 8563 | 8828 | return service\_timings\_data; |
  | 8564 | 8829 | }, |
  | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3194710#L9350) | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3206780#L9615) |  |
  | 9350 | 9615 | $bookingpress\_formatted\_timeslot = $bookingpress\_global\_details['bpa\_time\_format\_for\_timeslot']; |
  | 9351 | 9616 |  |
  |  | 9617 | $convert\_timeslot\_to\_client\_timezone = false; |
  |  | 9618 | if( $BookingPress->bpa\_is\_pro\_active() ){ |
  |  | 9619 | $convert\_timeslot\_to\_client\_timezone = $BookingPress->bookingpress\_get\_settings( 'show\_bookingslots\_in\_client\_timezone', 'general\_setting' ); |
  |  | 9620 | } |
  |  | 9621 |  |
  | 9352 | 9622 | $bookingpress\_site\_current\_lang\_moment\_locale = get\_locale(); |
  | 9353 | 9623 | ?> |
  | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3194710#L9389) | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3206780#L9659) |  |
  | 9389 | 9659 | }, |
  | 9390 | 9660 | bookingpress\_working\_dates\_data( working\_hour\_details, response\_data ){ |
  |  | 9661 | const vm = this; |
  |  | 9662 |  |
  |  | 9663 | let timeformat = "<?php echo esc\_html( $bookigpress\_time\_format\_for\_booking\_form ); ?>"; |
  |  | 9664 | let is\_client\_timezone = "<?php echo $convert\_timeslot\_to\_client\_timezone; ?>"; |
  |  | 9665 | let updated\_working\_hour\_details = {}; |
  |  | 9666 | let available\_dates = []; |
  |  | 9667 | let response = {}; |
  |  | 9668 | let firstAvailableDate = ""; |
  |  | 9669 |  |
  |  | 9670 | let overnight\_booking = ("undefined" != typeof response\_data.overnight\_booking\_dates ) ? response\_data.overnight\_booking\_dates : []; |
  |  | 9671 |  |
  |  | 9672 | let sorted\_working\_hours = []; |
  |  | 9673 |  |
  |  | 9674 | for( let wdate in working\_hour\_details ){ |
  |  | 9675 | let x = 0; |
  |  | 9676 | let n = 0; |
  |  | 9677 |  |
  |  | 9678 | let is\_overnight\_booking = overnight\_booking.includes( wdate ) || false; |
  |  | 9679 |  |
  |  | 9680 | let overnight\_booking\_date = ""; |
  |  | 9681 |  |
  |  | 9682 | sorted\_working\_hours[wdate] = working\_hour\_details[ wdate ]; |
  |  | 9683 |  |
  |  | 9684 | sorted\_working\_hours[wdate].sort( (a,b) => { |
  |  | 9685 | return ( parseInt( a.counter\_pos ) < parseInt( b.counter\_pos ) ) ? -1 : 1; |
  |  | 9686 | } ); |
  |  | 9687 |  |
  |  | 9688 | for( let wh\_data of sorted\_working\_hours[wdate] ){ |
  |  | 9689 | let start\_datetime = wh\_data.store\_service\_date + " " + wh\_data.store\_start\_time; |
  |  | 9690 | let end\_datetime = wh\_data.selected\_end\_date + " " + wh\_data.store\_end\_time; |
  |  | 9691 | let timezone = wh\_data.store\_offset; |
  |  | 9692 |  |
  |  | 9693 | let stTime = wp.hooks.applyFilters( "bookingpress\_modify\_time\_with\_timezone", wh\_data.store\_start\_time, wh\_data, "start" ); |
  |  | 9694 | wh\_data.client\_start\_time = stTime; |
  |  | 9695 | let etTime = wp.hooks.applyFilters( "bookingpress\_modify\_time\_with\_timezone", wh\_data.store\_end\_time, wh\_data, "end" ); |
  |  | 9696 | wh\_data.client\_end\_time = etTime; |
  |  | 9697 |  |
  |  | 9698 | let stTimeNew = wp.hooks.applyFilters( "bookingpress\_modify\_datetime\_with\_timezone", start\_datetime, wh\_data, "start", true ); |
  |  | 9699 | let etTimeNew = wp.hooks.applyFilters( "bookingpress\_modify\_datetime\_with\_timezone", end\_datetime, wh\_data, "end", true ); |
  |  | 9700 |  |
  |  | 9701 | let updated\_wdate; |
  |  | 9702 | if( "string" == typeof stTimeNew ){ |
  |  | 9703 | updated\_wdate = wdate; |
  |  | 9704 | } else { |
  |  | 9705 | updated\_wdate = stTimeNew.toISOString().split("T")[0]; |
  |  | 9706 | } |
  |  | 9707 | let updated\_edate; |
  |  | 9708 | if( "string" == typeof etTimeNew ){ |
  |  | 9709 | updated\_edate = wh\_data.selected\_end\_date; |
  |  | 9710 | } else { |
  |  | 9711 | updated\_edate = etTimeNew.toISOString().split("T")[0]; |
  |  | 9712 | } |
  |  | 9713 |  |
  |  | 9714 | if( "undefined" != typeof wh\_data.is\_day\_service && true == wh\_data.is\_day\_service ){ |
  |  | 9715 | if( "undefined" == typeof updated\_working\_hour\_details[ updated\_wdate ] && updated\_wdate >= vm.jsCurrentDate.toISOString().split("T")[0] ){ |
  |  | 9716 | updated\_working\_hour\_details[ updated\_wdate ] = []; |
  |  | 9717 | if( false == is\_overnight\_booking && !available\_dates.includes( updated\_wdate + " 00:00:00" ) ){ |
  |  | 9718 | available\_dates.push( updated\_wdate + " 00:00:00" ); |
  |  | 9719 | } |
  |  | 9720 | n++; |
  |  | 9721 | } else { |
  |  | 9722 | continue; |
  |  | 9723 | } |
  |  | 9724 | } else { |
  |  | 9725 | if( "undefined" == typeof updated\_working\_hour\_details[ updated\_wdate ] ){ |
  |  | 9726 | updated\_working\_hour\_details[ updated\_wdate ] = []; |
  |  | 9727 | if( false == is\_overnight\_booking && !available\_dates.includes( updated\_wdate + " 00:00:00" ) ){ |
  |  | 9728 | available\_dates.push( updated\_wdate + " 00:00:00" ); |
  |  | 9729 | } |
  |  | 9730 | n++; |
  |  | 9731 | } |
  |  | 9732 | } |
  |  | 9733 |  |
  |  | 9734 | if( "" == firstAvailableDate ){ |
  |  | 9735 | firstAvailableDate = ( "undefined" != typeof response\_data.pre\_selected\_date && true == response\_data.pre\_selected\_date && "undefined" != typeof vm.open\_customer\_reschedule\_appointment\_modal && true == vm.open\_customer\_reschedule\_appointment\_modal ) ? response\_data.selected\_date : updated\_wdate; |
  |  | 9736 | } |
  |  | 9737 |  |
  |  | 9738 | wh\_data.client\_date = updated\_wdate; |
  |  | 9739 | wh\_data.client\_end\_date = updated\_edate; |
  |  | 9740 |  |
  |  | 9741 | if( true == is\_overnight\_booking && "" == overnight\_booking\_date ){ |
  |  | 9742 | overnight\_booking\_date = updated\_wdate; |
  |  | 9743 | if( "undefined" == typeof updated\_working\_hour\_details[ overnight\_booking\_date ] ){ |
  |  | 9744 | updated\_working\_hour\_details[ overnight\_booking\_date ] = []; |
  |  | 9745 | } |
  |  | 9746 | } |
  |  | 9747 | wh\_data.is\_both\_next\_day\_time\_v2 = false; |
  |  | 9748 |  |
  |  | 9749 | if( true == is\_overnight\_booking ){ |
  |  | 9750 |  |
  |  | 9751 | if( "true" == is\_client\_timezone ){ |
  |  | 9752 | wh\_data.is\_next\_day = false; |
  |  | 9753 | } |
  |  | 9754 |  |
  |  | 9755 | if( updated\_edate > updated\_wdate ){ |
  |  | 9756 | wh\_data.is\_next\_day = true; |
  |  | 9757 | } |
  |  | 9758 |  |
  |  | 9759 | if( updated\_edate == updated\_wdate && updated\_wdate > overnight\_booking\_date ){ |
  |  | 9760 | wh\_data.is\_both\_next\_day\_time\_v2 = true; |
  |  | 9761 | wh\_data.is\_next\_day = true; |
  |  | 9762 | wh\_data.client\_date = wh\_data.client\_end\_date; |
  |  | 9763 | } |
  |  | 9764 | } |
  |  | 9765 |  |
  |  | 9766 | if( true == wh\_data.is\_both\_next\_day\_time && wh\_data.client\_end\_date > wh\_data.client\_date ){ |
  |  | 9767 | wh\_data.client\_date = wh\_data.client\_end\_date; |
  |  | 9768 | } |
  |  | 9769 |  |
  |  | 9770 | let startTimeHour = stTime.split(":")[0]; |
  |  | 9771 |  |
  |  | 9772 | let formatted\_startTime = vm.bookingpress\_format\_time( stTime ); |
  |  | 9773 | let formatted\_endTime = vm.bookingpress\_format\_time( etTime ); |
  |  | 9774 |  |
  |  | 9775 | let formatted\_datetime = formatted\_startTime + " - " + formatted\_endTime; |
  |  | 9776 | if( "1" == timeformat || "2" == timeformat ){ |
  |  | 9777 | formatted\_datetime = formatted\_startTime + " to " + formatted\_endTime; |
  |  | 9778 | } else if ( "5" == timeformat || "6" == timeformat ){ |
  |  | 9779 | formatted\_datetime = formatted\_startTime + " - " + formatted\_endTime; |
  |  | 9780 | } else if( "3" == timeformat || "4" == timeformat ){ |
  |  | 9781 | formatted\_datetime = formatted\_startTime; |
  |  | 9782 | } |
  |  | 9783 |  |
  |  | 9784 | wh\_data.formatted\_start\_time = formatted\_startTime; |
  |  | 9785 | wh\_data.formatted\_end\_time = formatted\_endTime; |
  |  | 9786 | wh\_data.formatted\_start\_end\_time = formatted\_datetime; |
  |  | 9787 | wh\_data.start\_hour = startTimeHour; |
  |  | 9788 |  |
  |  | 9789 | if( true == is\_overnight\_booking ){ |
  |  | 9790 | updated\_working\_hour\_details[ overnight\_booking\_date ][x] = wh\_data; |
  |  | 9791 | if( !available\_dates.includes( overnight\_booking\_date + " 00:00:00" ) ){ |
  |  | 9792 | available\_dates.push( overnight\_booking\_date + " 00:00:00" ); |
  |  | 9793 | } |
  |  | 9794 | } else { |
  |  | 9795 | updated\_working\_hour\_details[ updated\_wdate ][x] = wh\_data; |
  |  | 9796 | } |
  |  | 9797 |  |
  |  | 9798 | x++; |
  |  | 9799 | } |
  |  | 9800 | } |
  |  | 9801 |  |
  |  | 9802 | available\_dates = wp.hooks.applyFilters( "bookingpress\_modify\_available\_dates\_with\_day\_service", available\_dates, working\_hour\_details, response\_data, vm ); |
  |  | 9803 | firstAvailableDate = wp.hooks.applyFilters( "bookingpress\_modify\_first\_available\_date\_with\_day\_service", firstAvailableDate, available\_dates, vm ); |
  |  | 9804 |  |
  |  | 9805 | response.available\_dates = available\_dates; |
  |  | 9806 | response.updated\_working\_hour\_details = updated\_working\_hour\_details; |
  |  | 9807 | response.selected\_date = firstAvailableDate; |
  |  | 9808 |  |
  |  | 9809 | return response; |
  |  | 9810 | }, |
  |  | 9811 | bookingpress\_working\_dates\_data\_legacy( working\_hour\_details, response\_data ){ |
  | 9391 | 9812 | const vm = this; |
  | 9392 | 9813 | let timeformat = "<?php echo esc\_html( $bookigpress\_time\_format\_for\_booking\_form ); ?>"; |
  | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3194710#L9477) | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3206780#L9898) |  |
  | 9477 | 9898 | let x = 1; |
  | 9478 | 9899 | for( let timeslot\_data of timeslot\_details ){ |
  | 9479 |  | if( "undefined" != typeof timeslot\_data ){ |
  |  | 9900 | if( "undefined" != typeof timeslot\_data && ( "undefined" == typeof timeslot\_data.is\_next\_day || timeslot\_data.is\_next\_day == false) ){ |
  | 9480 | 9901 | let startHour = parseInt( timeslot\_data.start\_hour ); |
  | 9481 | 9902 | if( startHour >= 0 && startHour < afternoon\_slot\_timings ){ |
  | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3194710#L9489) | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3206780#L9910) |  |
  | 9489 | 9910 | } |
  | 9490 | 9911 | x++; |
  |  | 9912 | } |
  |  | 9913 | } |
  |  | 9914 | if( timeslot\_details.length > x ){ |
  |  | 9915 | for( let timeslot\_data of timeslot\_details ){ |
  |  | 9916 | if( "undefined" != typeof timeslot\_data && "undefined" != typeof timeslot\_data.is\_next\_day && timeslot\_data.is\_next\_day == true ){ |
  |  | 9917 | let startHour = parseInt( timeslot\_data.start\_hour ); |
  |  | 9918 | service\_timings\_data.night\_time.push( timeslot\_data ); |
  |  | 9919 | } |
  | 9491 | 9920 | } |
  | 9492 | 9921 | } |

**Note:** See [TracChangeset](/wiki/TracChangeset)
for help on using the changeset viewer.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Unified Diff](?format=diff&new=3206780)
* [Zip Archive](?format=zip&new=3206780)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)


