=== Content from www.wordfence.com_82eb896e_20250114_213610.html ===


[![](https://www.wordfence.com/img/wordfence-intelligence-logo.svg)](/threat-intel/)

Have you found a vulnerability in a WordPress plugin or theme? Report vulnerabilities in WordPress plugins and themes through our [bug bounty program](https://www.wordfence.com/threat-intel/bug-bounty-program) and earn a bounty on all in-scope submissions, while we handle the responsible disclosure process on your behalf.

As a reminder, the Wordfence Intelligence Vulnerability Database API is completely free to query and utilize, both personally and commercially, and contains all the same vulnerability data as the user interface. Please review the API documentation and Webhook documentation for more information on how to query the vulnerability API endpoints and configure webhooks utilizing all the same data present in the Wordfence Intelligence user interface.

# Crypto and DeFi Widgets – Web3 Cryptocurrency Shortcodes <= 1.1.6 - Reflected Cross-Site Scripting

 [Wordfence Intelligence](https://www.wordfence.com/threat-intel)   >    [Vulnerability Database](https://www.wordfence.com/threat-intel/vulnerabilities)   >   Crypto and DeFi Widgets – Web3 Cryptocurrency Shortcodes <= 1.1.6 - Reflected Cross-Site Scripting

6.1

**Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')**
**CVSS Vector**
[CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N)

| CVE | [CVE-2024-11365](https://www.cve.org/CVERecord?id=CVE-2024-11365) |
| --- | --- |
| CVSS | 6.1 (Medium) |
| Publicly Published | November 20, 2024 |
| Last Updated | November 21, 2024 |
| Researcher | [vgo0](https://www.wordfence.com/threat-intel/vulnerabilities/researchers/dale-mavers) |

### Description

The Crypto and DeFi Widgets – Web3 Cryptocurrency Shortcodes plugin for WordPress is vulnerable to Reflected Cross-Site Scripting due to the use of add\_query\_arg without appropriate escaping on the URL in all versions up to, and including, 1.1.6. This makes it possible for unauthenticated attackers to inject arbitrary web scripts in pages that execute if they can successfully trick a user into performing an action such as clicking on a link.

#### References

* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/browser/security-force/trunk/lib/class.settings-api.php#L2460)
* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/browser/security-force/trunk/lib/class.settings-api.php#L2497)

#### Share

[Facebook](https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fsecurity-force%2Fcrypto-and-defi-widgets-web3-cryptocurrency-shortcodes-116-reflected-cross-site-scripting&t=Crypto%20and%20DeFi%20Widgets%20%E2%80%93%20Web3%20Cryptocurrency%20Shortcodes%20%3C%3D%201.1.6%20-%20Reflected%20Cross-Site%20Scripting "Facebook")
[Twitter](https://twitter.com/share?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fsecurity-force%2Fcrypto-and-defi-widgets-web3-cryptocurrency-shortcodes-116-reflected-cross-site-scripting&text=Crypto%20and%20DeFi%20Widgets%20%E2%80%93%20Web3%20Cryptocurrency%20Shortcodes%20%3C%3D%201.1.6%20-%20Reflected%20Cross-Site%20Scripting "Twitter")
[LinkedIn](https://www.linkedin.com/shareArticle?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fsecurity-force%2Fcrypto-and-defi-widgets-web3-cryptocurrency-shortcodes-116-reflected-cross-site-scripting "LinkedIn")
Email

## Vulnerability Details for Crypto and DeFi Widgets – Web3 Cryptocurrency Shortcodes

#### [Crypto and DeFi Widgets – Web3 Cryptocurrency Shortcodes](https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/security-force)

| Software Type | Plugin |
| --- | --- |
| Software Slug | security-force [(view on wordpress.org)](https://wordpress.org/plugins/security-force) |
| Patched? | No |
| Remediation | No known patch available. Please review the vulnerability's details in depth and employ mitigations based on your organization's risk tolerance. It may be best to uninstall the affected software and find a replacement. |
| Affected Version | * <= 1.1.6 |

This record contains material that is subject to copyright.

**Copyright 2012-2025 Defiant Inc.**

**License:**
Defiant hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute this software vulnerability information. Any copy of the software vulnerability information you make for such purposes is authorized provided that you include a hyperlink to this vulnerability record and reproduce Defiant's copyright designation and this license in any such copy.
**[Read more.](https://www.wordfence.com/wordfence-intelligence-terms-and-conditions/)**

**Copyright 1999-2025 The MITRE Corporation**

**License:**
CVE Usage: MITRE hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute Common Vulnerabilities and Exposures (CVE®). Any copy you make for such purposes is authorized provided that you reproduce MITRE's copyright designation and this license in any such copy.
**[Read more.](https://www.cve.org/Legal/TermsOfUse)**

Have information to add, or spot any errors? Contact us at wfi-support@wordfence.com so we can make any appropriate adjustments.

Did you know Wordfence Intelligence provides free personal and commercial API access to our comprehensive WordPress vulnerability database, along with a free webhook integration to stay on top of the latest vulnerabilities added and updated in the database? Get started today!

Learn more

Want to get notified of the latest vulnerabilities that may affect your WordPress site?
 Install Wordfence on your site today to get notified immediately if your site is affected by a vulnerability that has been added to our database.

Get Wordfence

The Wordfence Intelligence WordPress vulnerability database is completely free to access and query via API. Please review the documentation on how to access and consume the vulnerability data via API.

Documentation



=== Content from plugins.trac.wordpress.org_baf7635c_20250114_213558.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fbrowser%2Fsecurity-force%2Ftrunk%2Flib%2Fclass.settings-api.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Revision](/browser/security-force/trunk/lib/class.settings-api.php?rev=3034005 "Revision 3034005")
* Next Revision →
* [Blame](/browser/security-force/trunk/lib/class.settings-api.php?annotate=blame "Annotate each line with the last changed revision (this can be time consuming...)")
* [Revision Log](/log/security-force/trunk/lib/class.settings-api.php)

---

# [source:](/browser?order=name "Go to repository root") [security-force](/browser/security-force?order=name "View security-force")/[trunk](/browser/security-force/trunk?order=name "View trunk")/[lib](/browser/security-force/trunk/lib?order=name "View lib")/[class.settings-api.php](/browser/security-force/trunk/lib/class.settings-api.php?order=name "View class.settings-api.php")

View diff against:

View revision:

| [Last change](/changeset/3051882/security-force/trunk/lib/class.settings-api.php "View differences") on this file was [3051882](/changeset/3051882/ "View changeset 3051882"), checked in by securityforce, [10 months ago](/timeline?from=2024-03-15T18%3A43%3A25Z&precision=second "See timeline at 03/15/2024 06:43:25 PM") |
| --- |
| Cryptocurrency data points set as default.  Minor bug fixes.  Updated Getting Started video. |
| **File size:** 154.7 KB | |

| Line |  |
| --- | --- |
| [1](#L1) | <?php |
| [2](#L2) |  |
| [3](#L3) |  |
| [4](#L4) |  |
| [5](#L5) | /\*\* |
| [6](#L6) | \* Forked from Settings API wrapper class by Tareq Hasan <tareq@weDevs.com> (http://tareq.weDevs.com) |
| [7](#L7) | \*/ |
| [8](#L8) | class SecurityForce\_Settings\_API { |
| [9](#L9) |  |
| [10](#L10) | /\*\* |
| [11](#L11) | \* settings sections array |
| [12](#L12) | \* |
| [13](#L13) | \* @var array |
| [14](#L14) | \*/ |
| [15](#L15) | private $settings\_sections = array(); |
| [16](#L16) |  |
| [17](#L17) | /\*\* |
| [18](#L18) | \* Settings fields array |
| [19](#L19) | \* |
| [20](#L20) | \* @var array |
| [21](#L21) | \*/ |
| [22](#L22) | private $settings\_fields = array(); |
| [23](#L23) |  |
| [24](#L24) | /\*\* |
| [25](#L25) | \* Settings fields array |
| [26](#L26) | \* |
| [27](#L27) | \* @var array |
| [28](#L28) | \*/ |
| [29](#L29) | private $settings\_menu = array(); |
| [30](#L30) |  |
| [31](#L31) | /\*\* |
| [32](#L32) | \* Singleton instance |
| [33](#L33) | \* |
| [34](#L34) | \* @var object |
| [35](#L35) | \*/ |
| [36](#L36) | private static $\_instance; |
| [37](#L37) |  |
| [38](#L38) |  |
| [39](#L39) | private static $instance = null; |
| [40](#L40) |  |
| [41](#L41) | public function \_\_construct($fields = [], $sections = [], $menu = '') { |
| [42](#L42) | //set sections and fields |
| [43](#L43) | //if (!is\_admin()) |
| [44](#L44) | //    return; |
| [45](#L45) |  |
| [46](#L46) | $this->set\_sections($sections); |
| [47](#L47) | $this->set\_fields($fields); |
| [48](#L48) |  |
| [49](#L49) | if ($menu) { |
| [50](#L50) | $this->set\_menu($menu); |
| [51](#L51) |  |
| [52](#L52) | if ($menu['multisite\_only']) |
| [53](#L53) | add\_action('network\_admin\_menu', array(&$this, 'register\_menu')); |
| [54](#L54) | else |
| [55](#L55) | add\_action('admin\_menu', array(&$this, 'register\_menu')); |
| [56](#L56) | add\_action('admin\_post\_edit\_widget', array($this, 'handle\_widget\_save')); |
| [57](#L57) | add\_action('admin\_post\_delete\_widget', array($this, 'handle\_delete\_widget')); |
| [58](#L58) | add\_action('admin\_post\_clear\_widgets', array($this, 'clear\_all\_widgets')); //delete this |
| [59](#L59) |  |
| [60](#L60) |  |
| [61](#L61) |  |
| [62](#L62) | //need to be deleted |
| [63](#L63) | add\_action('admin\_post\_clear\_all\_widgets', array($this, 'clear\_all\_widgets')); |
| [64](#L64) | add\_action('admin\_post\_nopriv\_clear\_all\_widgets', array($this, 'clear\_all\_widgets')); |
| [65](#L65) |  |
| [66](#L66) |  |
| [67](#L67) |  |
| [68](#L68) |  |
| [69](#L69) | add\_action('wp\_ajax\_edit\_widget', 'your\_edit\_widget\_function'); |
| [70](#L70) | add\_action('wp\_ajax\_nopriv\_edit\_widget', 'your\_edit\_widget\_function'); // if you want it available for non-logged in users |
| [71](#L71) |  |
| [72](#L72) |  |
| [73](#L73) |  |
| [74](#L74) | // add\_shortcode('hedge3\_widgets', array($this, 'hedge3\_widgets\_shortcode')); |
| [75](#L75) |  |
| [76](#L76) | } |
| [77](#L77) | //add\_action('init', array($this, 'register\_shortcodes'), 100); |
| [78](#L78) |  |
| [79](#L79) | add\_action('init', array($this, 'filter\_settings'), 10); |
| [80](#L80) |  |
| [81](#L81) | //$this->admin\_init(); |
| [82](#L82) | //$this->register\_menu(); |
| [83](#L83) |  |
| [84](#L84) | if (isset($this->settings\_menu['action\_link']) && $this->settings\_menu['action\_link']) { |
| [85](#L85) | add\_filter('plugin\_action\_links\_' . $this->settings\_menu['plugin\_file'], array(&$this, 'plugin\_actions\_links'), -10); |
| [86](#L86) | } |
| [87](#L87) | add\_action('admin\_init', array(&$this, 'admin\_init')); |
| [88](#L88) |  |
| [89](#L89) | add\_action('wp\_ajax\_nopriv\_securityforce\_get\_firewall\_phpidsdata', array($this,'securityforce\_get\_firewall\_phpidsdata')); |
| [90](#L90) | add\_action('wp\_ajax\_securityforce\_get\_firewall\_phpidsdata', array($this,'securityforce\_get\_firewall\_phpidsdata')); |
| [91](#L91) |  |
| [92](#L92) | add\_action('wp\_ajax\_securityforce\_remove\_dashboard\_notice', array($this,'securityforce\_remove\_dashboard\_notice')); |
| [93](#L93) | //add\_action('wp\_enqueue\_scripts', array($this, 'enqueue\_and\_localize\_my\_scripts')); |
| [94](#L94) | // add\_action('admin\_post\_add\_new\_widget', array($this, 'handle\_add\_new\_widget')); |
| [95](#L95) | } |
| [96](#L96) |  |
| [97](#L97) |  |
| [98](#L98) |  |
| [99](#L99) |  |
| [100](#L100) |  |
| [101](#L101) | public static function get\_instance() { |
| [102](#L102) | if (null === self::$instance) { |
| [103](#L103) | self::$instance = new self(); |
| [104](#L104) | } |
| [105](#L105) | return self::$instance; |
| [106](#L106) | } |
| [107](#L107) |  |
| [108](#L108) |  |
| [109](#L109) | // public function enqueue\_and\_localize\_my\_scripts() { |
| [110](#L110) | //     wp\_enqueue\_script('my-react-app','http://localhost:3000/widget.lib.bundle.latest.js', array('wp-element'), time(), true); |
| [111](#L111) |  |
| [112](#L112) | //     wp\_localize\_script('my-react-app', 'wordpressData', array( |
| [113](#L113) | //         'ajaxUrl' => admin\_url('admin-ajax.php'), |
| [114](#L114) | //         'nonce' => wp\_create\_nonce('edit\_widget\_action'), |
| [115](#L115) | //     )); |
| [116](#L116) | // } |
| [117](#L117) |  |
| [118](#L118) |  |
| [119](#L119) |  |
| [120](#L120) |  |
| [121](#L121) |  |
| [122](#L122) | // function register\_shortcodes() { |
| [123](#L123) | //     echo "Register Shortcodes Function Call................................"; |
| [124](#L124) | //     add\_shortcode('hedge3\_widgets', array($this, 'hedge3\_widgets\_shortcode')); |
| [125](#L125) | // } |
| [126](#L126) | // function hedge3\_widgets\_shortcode($atts) { |
| [127](#L127) | //     error\_log('Shortcode called with attributes: ' . print\_r($atts, true)); |
| [128](#L128) | //     return 'Hello World!'; |
| [129](#L129) | // } |
| [130](#L130) |  |
| [131](#L131) | // function hedge3\_widgets\_shortcode($atts) { |
| [132](#L132) | //         $atts = shortcode\_atts(array('id' => ''), $atts, 'hedge3\_widgets'); |
| [133](#L133) |  |
| [134](#L134) | //         $widgets = get\_option('hedge3\_widgets\_config', array()); |
| [135](#L135) | //         if (isset($widgets[$atts['id']])) { |
| [136](#L136) | //             $widgetConfig = $widgets[$atts['id']]; |
| [137](#L137) | //             $widgetConfig['enableEdit'] = false; // Set enableEdit to false for the frontend display |
| [138](#L138) |  |
| [139](#L139) | //             // Prepare the container ID from the 'containerSelector' value |
| [140](#L140) | //             $containerID = ltrim($widgetConfig['containerSelector'], '#'); |
| [141](#L141) |  |
| [142](#L142) | //             $output = "<div class='widget\_page\_wrap' style='background-image: url(\"" . SECURITYFORCE\_URL . "/img/h3.annimate.gif\");'>"; |
| [143](#L143) | //             $output .= "<script> |
| [144](#L144) | //                         document.addEventListener('DOMContentLoaded', () => { |
| [145](#L145) | //                             const script = document.createElement('script'); |
| [146](#L146) | //                             script.src = 'http://localhost:3000/widget.lib.bundle.latest.js'; |
| [147](#L147) | //                             script.onload = () => { |
| [148](#L148) | //                                 window.initializeActiveWidget(" . json\_encode($widgetConfig, JSON\_PRETTY\_PRINT) . "); |
| [149](#L149) | //                             }; |
| [150](#L150) | //                             document.head.appendChild(script); |
| [151](#L151) | //                         }); |
| [152](#L152) | //                         </script>"; |
| [153](#L153) | //             $output .= "<div id='" . esc\_attr($containerID) . "' class='hedge3-widgets'></div>"; |
| [154](#L154) | //             $output .= "</div>"; |
| [155](#L155) |  |
| [156](#L156) | //             return $output; // Return the output instead of echoing |
| [157](#L157) | //         } else { |
| [158](#L158) | //             return 'Widget not found.'; |
| [159](#L159) | //         } |
| [160](#L160) | //     } |
| [161](#L161) |  |
| [162](#L162) |  |
| [163](#L163) |  |
| [164](#L164) |  |
| [165](#L165) |  |
| [166](#L166) |  |
| [167](#L167) |  |
| [168](#L168) |  |
| [169](#L169) |  |
| [170](#L170) | public function securityforce\_remove\_dashboard\_notice(){ |
| [171](#L171) | update\_option('securityforce\_remove\_dashboard\_notice\_'.(isset($\_REQUEST['type']) ? sanitize\_text\_field($\_REQUEST['type']) : ''),1); |
| [172](#L172) | echo 'success'; |
| [173](#L173) | exit; |
| [174](#L174) | } |
| [175](#L175) |  |
| [176](#L176) | public function securityforce\_get\_firewall\_phpidsdata(){ |
| [177](#L177) | $call = sanitize\_text\_field($\_POST['call\_type']); |
| [178](#L178) | $attack\_type = sanitize\_text\_field($\_POST['attack\_type']); |
| [179](#L179) | $sale\_data = array(); |
| [180](#L180) | global $wpdb; |
| [181](#L181) | $table\_name = $wpdb->prefix . 'securityforce\_ab\_attacks'; |
| [182](#L182) | if($attack\_type == 'IPS'){ |
| [183](#L183) | $table\_name = $wpdb->prefix . 'securityforce\_blocked\_ips'; |
| [184](#L184) | } |
| [185](#L185) | if($call == 'this month'){ |
| [186](#L186) | $current\_date = date('d'); |
| [187](#L187) | $all\_date = date('t'); |
| [188](#L188) | $current\_my = date(' m d'); |
| [189](#L189) | for($i=01; $i <= $current\_date; $i++){ |
| [190](#L190) | $key = date('Y-m-' . $i); |
| [191](#L191) | $key\_1 = date( str\_pad($i, 2, '0', STR\_PAD\_LEFT) . ' M Y'); |
| [192](#L192) | $data\_r = $wpdb->get\_row("SELECT COUNT(\*) cnt FROM " . $table\_name . " WHERE date(created) = '". $key ."'"); |
| [193](#L193) | $sale\_data[ $key\_1 ] = $data\_r->cnt; |
| [194](#L194) | } |
| [195](#L195) | $main\_arr = array(); |
| [196](#L196) | if($sale\_data){ |
| [197](#L197) | foreach ($sale\_data as $key => $value) { |
| [198](#L198) | $main\_arr[] = array( |
| [199](#L199) | 'x' => str\_replace("-", ", ", $key), |
| [200](#L200) | 'y' => $value |
| [201](#L201) | ); |
| [202](#L202) | } |
| [203](#L203) | } |
| [204](#L204) | echo json\_encode($main\_arr); |
| [205](#L205) | } else if($call == 'last month'){ |
| [206](#L206) | $first = date("j", strtotime("first day of previous month")); |
| [207](#L207) | $last = date("j", strtotime("last day of previous month")); |
| [208](#L208) | $last\_month = date("n", strtotime("last day of previous month")); |
| [209](#L209) | $last\_month\_name = date('F', strtotime('last month')); |
| [210](#L210) | $this\_year = date('Y'); |
| [211](#L211) | for($i=$first; $i <= $last; $i++){ |
| [212](#L212) | $key = date('Y-'. $last\_month .'-' . $i); |
| [213](#L213) | $key\_1 = str\_pad($i, 2, '0', STR\_PAD\_LEFT) . ' '. $last\_month\_name . ' ' . $this\_year; |
| [214](#L214) | $data\_r = $wpdb->get\_row("SELECT COUNT(\*) cnt FROM " . $table\_name . " WHERE date(created) = '". $key ."'"); |
| [215](#L215) | $sale\_data[ $key\_1 ] = $data\_r->cnt; |
| [216](#L216) | } |
| [217](#L217) | $main\_arr = array(); |
| [218](#L218) | if($sale\_data){ |
| [219](#L219) | foreach ($sale\_data as $key => $value) { |
| [220](#L220) | $main\_arr[] = array( |
| [221](#L221) | 'x' => str\_replace("-", ", ", $key), |
| [222](#L222) | 'y' => $value |
| [223](#L223) | ); |
| [224](#L224) | } |
| [225](#L225) | } |
| [226](#L226) | echo json\_encode($main\_arr); |
| [227](#L227) | } else if($call == 'this year'){ |
| [228](#L228) | $this\_year = date('Y'); |
| [229](#L229) | for($i=01; $i <= 12; $i++){ |
| [230](#L230) | $dateObj   = DateTime::createFromFormat('!m', $i); |
| [231](#L231) | $monthName = $dateObj->format('F'); |
| [232](#L232) | $key = $this\_year . '-' . str\_pad($i, 2, '0', STR\_PAD\_LEFT); |
| [233](#L233) | $key\_1 = $monthName . ' ' . $this\_year; |
| [234](#L234) | $data\_r = $wpdb->get\_row("SELECT COUNT(\*) cnt FROM " . $table\_name . " WHERE created LIKE '%" . $key . "%'" ); |
| [235](#L235) | $sale\_data[ $key\_1 ] = $data\_r->cnt; |
| [236](#L236) | } |
| [237](#L237) | $main\_arr = array(); |
| [238](#L238) | if($sale\_data){ |
| [239](#L239) | foreach ($sale\_data as $key => $value) { |
| [240](#L240) | $main\_arr[] = array( |
| [241](#L241) | 'x' => str\_replace("-", ", ", $key), |
| [242](#L242) | 'y' => $value |
| [243](#L243) | ); |
| [244](#L244) | } |
| [245](#L245) | } |
| [246](#L246) | echo json\_encode($main\_arr); |
| [247](#L247) | } else{ |
| [248](#L248) | $now = new DateTime( "6 days ago", new DateTimeZone('America/New\_York')); |
| [249](#L249) | $interval = new DateInterval( 'P1D'); // 1 Day interval |
| [250](#L250) | $period = new DatePeriod( $now, $interval, 6); // 7 Days |
| [251](#L251) | $sale\_data = array(); |
| [252](#L252) | foreach( $period as $day) { |
| [253](#L253) | $key = $day->format( 'd M Y'); |
| [254](#L254) | $key\_1 = $day->format( 'Y-m-d'); |
| [255](#L255) | $data\_r = $wpdb->get\_row("SELECT COUNT(\*) cnt FROM " . $table\_name . " WHERE date(created) = '". $key\_1 ."'"); |
| [256](#L256) | $sale\_data[ $key ] = $data\_r->cnt; |
| [257](#L257) | } |
| [258](#L258) | $main\_arr = array(); |
| [259](#L259) | if($sale\_data){ |
| [260](#L260) | foreach ($sale\_data as $key => $value) { |
| [261](#L261) | $main\_arr[] = array( |
| [262](#L262) | 'x' => str\_replace("-", ", ", $key), |
| [263](#L263) | 'y' => $value |
| [264](#L264) | ); |
| [265](#L265) | } |
| [266](#L266) | } |
| [267](#L267) | echo json\_encode($main\_arr); |
| [268](#L268) | } |
| [269](#L269) | exit; |
| [270](#L270) | } |
| [271](#L271) |  |
| [272](#L272) | public function register\_menu() { |
| [273](#L273) | $role = ($this->settings\_menu['role']) ? $this->settings\_menu['role'] : 'manage\_options'; |
| [274](#L274) | if ($this->settings\_menu['multisite\_only']) { |
| [275](#L275) | add\_submenu\_page('settings.php', $this->settings\_menu['title'], $this->settings\_menu['title'], $role, $this->settings\_menu['name'], array(&$this, 'render\_option\_page')); |
| [276](#L276) | } else { |
| [277](#L277) |  |
| [278](#L278) | $securityforce\_options = get\_option('security\_force'); |
| [279](#L279) | include\_once(SECURITYFORCE\_PATH. DIRECTORY\_SEPARATOR.'firewall'.DIRECTORY\_SEPARATOR.'firewall.php'); |
| [280](#L280) | $attack\_count = (int) SECURITYFORCE\_FIREWALL\_PHPIDS::instance()->opt( 'new\_attacks\_count' ); |
| [281](#L281) | $attacks\_menu\_title = sprintf( \_\_( 'Attacks %s', 'mute-screamer' ), "<span class='update-plugins count-$attack\_count' title='$attack\_count'><span class='update-count'>" . number\_format\_i18n( $attack\_count ) . '</span></span>' ); |
| [282](#L282) |  |
| [283](#L283) |  |
| [284](#L284) | add\_menu\_page( |
| [285](#L285) | \_\_('Widgets', 'security\_force'), |
| [286](#L286) | \_\_('DeFi Widgets', 'security\_force'), |
| [287](#L287) | $role, |
| [288](#L288) | 'security\_force\_dashboard', |
| [289](#L289) | array($this, 'dashboard\_page'), |
| [290](#L290) | SECURITYFORCE\_URL . '/img/hedge3.21.white.png', |
| [291](#L291) | 40 |
| [292](#L292) | ); |
| [293](#L293) | add\_submenu\_page( |
| [294](#L294) | 'security\_force\_dashboard', |
| [295](#L295) | \_\_('Dashboard', 'security\_forc'), |
| [296](#L296) | \_\_('Dashboard', 'security\_force'), |
| [297](#L297) | $role, |
| [298](#L298) | 'security\_force\_dashboard', |
| [299](#L299) | array($this, 'dashboard\_page') |
| [300](#L300) | ); |
| [301](#L301) | // Register the 'builder' page |
| [302](#L302) |  |
| [303](#L303) |  |
| [304](#L304) |  |
| [305](#L305) |  |
| [306](#L306) |  |
| [307](#L307) | // add\_submenu\_page('security\_force\_dashboard', \_\_( 'Firewall', 'mute-screamer' ), $attacks\_menu\_title, 'activate\_plugins', 'securityforce\_ab\_attacks', array($this,'render\_firewall\_phpidspage')); |
| [308](#L308) | $securityforce\_widget\_builder = \_\_('Pro Options', 'securityforce'); |
| [309](#L309) | add\_submenu\_page('security\_force\_dashboard', \_\_('Widget Builder', 'edit-widget'), \_\_('Widget Builder', 'activate\_plugins'), $role, 'builder', array(&$this, 'render\_builder\_page')); |
| [310](#L310) |  |
| [311](#L311) |  |
| [312](#L312) | add\_submenu\_page('security\_force\_dashboard', \_\_( 'Trust Nwtwork', 'mute-screamer' ), "Pro Options", 'activate\_plugins', 'pro-options', array($this,'securityforce\_render\_secure\_network\_page')); |
| [313](#L313) |  |
| [314](#L314) | add\_submenu\_page('security\_force\_dashboard', \_\_('Security Settings', 'security\_force'), \_\_('Security Settings', 'security\_force'), $role, $this->settings\_menu['name'], array(&$this, 'render\_option\_page')); |
| [315](#L315) | add\_submenu\_page(NULL, \_\_('Setup Wizard', 'security\_force'), \_\_('Setup Wizard', 'security\_force'), 'activate\_plugins', 'hedge3\_setup\_wizard', array(&$this, 'securityforce\_render\_secure\_network\_page')); |
| [316](#L316) | //add\_options\_page($this->settings\_menu['title'],  $this->settings\_menu['title'], $role, $this->settings\_menu['name'], array(&$this, 'render\_option\_page')); |
| [317](#L317) |  |
| [318](#L318) | } |
| [319](#L319) | } |
| [320](#L320) |  |
| [321](#L321) | public function render\_settings\_page(){ |
| [322](#L322) | require SECURITYFORCE\_PATH.DIRECTORY\_SEPARATOR.'settings-page.php'; |
| [323](#L323) | } |
| [324](#L324) |  |
| [325](#L325) |  |
| [326](#L326) |  |
| [327](#L327) |  |
| [328](#L328) |  |
| [329](#L329) |  |
| [330](#L330) |  |
| [331](#L331) |  |
| [332](#L332) |  |
| [333](#L333) |  |
| [334](#L334) |  |
| [335](#L335) |  |
| [336](#L336) |  |
| [337](#L337) |  |
| [338](#L338) |  |
| [339](#L339) |  |
| [340](#L340) |  |
| [341](#L341) |  |
| [342](#L342) |  |
| [343](#L343) |  |
| [344](#L344) |  |
| [345](#L345) |  |
| [346](#L346) |  |
| [347](#L347) |  |
| [348](#L348) |  |
| [349](#L349) |  |
| [350](#L350) |  |
| [351](#L351) | public function hedge3\_setup\_wizard(){ |
| [352](#L352) |  |
| [353](#L353) | ?> |
| [354](#L354) | <div class="wrap"> |
| [355](#L355) | <h1><?php \_e('Setup Wizard','security\_force'); ?></h1> |
| [356](#L356) | <script type="text/javascript"> |
| [357](#L357) | jQuery(document).ready(function(){ |
| [358](#L358) | jQuery('.setup-element-wrap').click(function(e){ |
| [359](#L359) | e.preventDefault(); |
| [360](#L360) | jQuery('.setup-element-wrap').removeClass('setup-selected'); |
| [361](#L361) | jQuery('.setup-element-wrap').find('input[type="radio"]').prop("checked", false); |
| [362](#L362) | jQuery(this).addClass('setup-selected'); |
| [363](#L363) | jQuery(this).find('input[type="radio"]').prop("checked", true); |
| [364](#L364) | jQuery(this).closest('form').submit(); |
| [365](#L365) | }); |
| [366](#L366) | }); |
| [367](#L367) | </script> |
| [368](#L368) | <style type="text/css"> |
| [369](#L369) | .setup-main-wrapper { |
| [370](#L370) | display: flex; |
| [371](#L371) | justify-content: space-between; |
| [372](#L372) | align-items: flex-start; |
| [373](#L373) | margin-top: 20px; |
| [374](#L374) | } |
| [375](#L375) | .setup-element-wrap{ |
| [376](#L376) | background: white; |
| [377](#L377) | border-radius: 5px; |
| [378](#L378) | padding: 0; |
| [379](#L379) | display: inline-block; |
| [380](#L380) | width: 30%; |
| [381](#L381) | position: relative; |
| [382](#L382) | transition: 0.2s all; |
| [383](#L383) | -o-transition: 0.2s all; |
| [384](#L384) | -webkit-transition: 0.2s all; |
| [385](#L385) | -ms-transition: 0.2s all; |
| [386](#L386) | cursor: pointer; |
| [387](#L387) | } |
| [388](#L388) | .setup-element-wrap:hover { |
| [389](#L389) | transform: scale(1.02); |
| [390](#L390) | } |
| [391](#L391) |  |
| [392](#L392) | .setup-purchase-code{ |
| [393](#L393) | border: 2px solid #fff; |
| [394](#L394) | border-radius: 5px; |
| [395](#L395) | padding: 0 20px 20px 20px; |
| [396](#L396) | margin-top: 50px; |
| [397](#L397) | } |
| [398](#L398) | .setup-purchase-code input[type="text"] { |
| [399](#L399) | width: 500px; |
| [400](#L400) | max-width: 100%; |
| [401](#L401) | } |
| [402](#L402) | .setup-element-wrap .setup-settings-wrap .enable-ele{ |
| [403](#L403) | padding: 5px 10px 5px 5px; |
| [404](#L404) | font-size: 12px; |
| [405](#L405) | display: block; |
| [406](#L406) | margin: 0 5px 7px 0; |
| [407](#L407) | } |
| [408](#L408) |  |
| [409](#L409) | .setup-element-wrap .setup-settings-wrap{ |
| [410](#L410) | box-sizing: border-box; |
| [411](#L411) | padding: 0 20px; |
| [412](#L412) | } |
| [413](#L413) | .skip-button-div-wrap { |
| [414](#L414) | margin-top: 20px; |
| [415](#L415) | } |
| [416](#L416) | .setup-select-button { |
| [417](#L417) | background: #00669b; |
| [418](#L418) | color: white !important; |
| [419](#L419) | width: 100%; |
| [420](#L420) | display: block; |
| [421](#L421) | height: 60px; |
| [422](#L422) | line-height: 60px; |
| [423](#L423) | text-align: center; |
| [424](#L424) | font-size: 16px; |
| [425](#L425) | text-decoration: none; |
| [426](#L426) | } |
| [427](#L427) | </style> |
| [428](#L428) | <?php |
| [429](#L429) | //Get old setting |
| [430](#L430) | $securityforce\_settings = get\_option($this->settings\_menu['name']); |
| [431](#L431) | $admin\_email = get\_option('admin\_email'); |
| [432](#L432) |  |
| [433](#L433) | if ( isset($\_POST['securityforce\_setup\_nonce']) && wp\_verify\_nonce($\_POST['securityforce\_setup\_nonce'], 'securityforce\_setup\_setting') ){ |
| [434](#L434) | $options\_file = (is\_multisite()) ? 'network/settings.php' : 'admin.php'; |
| [435](#L435) | $page\_url = admin\_url(add\_query\_arg('page', $this->settings\_menu['name'], $options\_file)); |
| [436](#L436) |  |
| [437](#L437) |  |
| [438](#L438) | $new\_settings = sanitize\_text\_field(stripslashes($\_POST['setup-eb-setting'])); |
| [439](#L439) | $new\_settings = json\_decode($new\_settings, true); |
| [440](#L440) | $new\_settings = str\_replace('[new\_line]', "\r\n", $new\_settings); |
| [441](#L441) | $new\_settings = str\_replace('[double\_slashes]', "\/", $new\_settings); |
| [442](#L442) | $new\_settings = str\_replace('[quotation]', '"', $new\_settings); |
| [443](#L443) | $new\_settings = str\_replace('[o\_cb]', '{', $new\_settings); |
| [444](#L444) | $new\_settings = str\_replace('[c\_cb]', '}', $new\_settings); |
| [445](#L445) |  |
| [446](#L446) | update\_option($this->settings\_menu['name'], $new\_settings); |
| [447](#L447) | update\_option('securityforce\_setup\_run', 'yes'); |
| [448](#L448) | $goback = add\_query\_arg(array('settings-imported' => 'true'), $page\_url); |
| [449](#L449) | wp\_redirect($goback); |
| [450](#L450) | exit; |
| [451](#L451) | } |
| [452](#L452) | ?> |
| [453](#L453) | <form method="POST"> |
| [454](#L454) | <?php wp\_nonce\_field( 'securityforce\_setup\_setting', 'securityforce\_setup\_nonce' ); ?> |
| [455](#L455) | <div class="skip-button-div-wrap"> |
| [456](#L456) | <a class="button" href="<?php echo home\_url() . '/wp-admin/admin.php?page=security\_force'; ?>">Skip & Go to Settings</a> |
| [457](#L457) | </div> |
| [458](#L458) | <div class="setup-main-wrapper"> |
| [459](#L459) | <div class="setup-element-wrap"> |
| [460](#L460) | <div class="setup-settings-wrap"> |
| [461](#L461) | <h2>Basic</h2> |
| [462](#L462) | <p>Enough for simple sites with minimal changes to the site</p> |
| [463](#L463) | <span class="enable-ele"><span class="dashicons dashicons-yes"></span> Basic Firewall Rules </span> |
| [464](#L464) | <span class="enable-ele"><span class="dashicons dashicons-yes"></span> Basic Cleanup </span> |
| [465](#L465) | <span class="enable-ele"><span class="dashicons dashicons-yes"></span> Hide wp-login.php </span> |
| [466](#L466) | <span class="enable-ele"><span class="dashicons dashicons-yes"></span> Anti Spam </span> |
| [467](#L467) | <span class="enable-ele"><span class="dashicons dashicons-yes"></span> Hides Themes </span> |
| [468](#L468) | </div> |
| [469](#L469) | <input style="display: none;" type="radio" name="setup-eb-setting" value='{"replace\_javascript\_path":"0","disable\_directory\_listing":"on","exclude\_plugins\_access":"","exclude\_theme\_access":"","replace\_wpnonce":"","replace\_mode":"safe","custom\_404":"0","custom\_404\_page":"","login\_query":"security\_force","admin\_key":"1234","remove\_feed\_meta":"on","hide\_admin\_bar":"","remove\_other\_meta":"on","clean\_post\_class":"","remove\_menu\_class":"","remove\_default\_description":"on","remove\_ver\_scripts":"","direct\_access\_except":"index.php, wp-content/repair.php, wp-comments-post.php, wp-includes/js/tinymce/wp-tinymce.php, xmlrpc.php, wp-cron.php","disable\_canonical\_redirect":"","email\_from\_name":"<?php echo get\_bloginfo('blogname'); ?>","email\_from\_address":"<?php echo $admin\_email; ?>","replace\_in\_html":"","new\_theme\_path":"/static","new\_style\_name":"","style\_expiry\_days":"","new\_include\_path":"/static/lib","new\_plugin\_path":"/static/ext","new\_upload\_path":"/file","replace\_comments\_post":"","replace\_admin\_ajax":"ajax","new\_content\_path":"","author\_enable":"1","author\_base":"","author\_query":"","feed\_enable":"1","feed\_base":"","feed\_query":"","post\_enable":"1","post\_base":"/blog/%year%/%monthnum%/%day%/%postname%/","post\_query":"p","page\_enable":"1","page\_base":"","page\_query":"page\_id","paginate\_enable":"1","paginate\_base":"","paginate\_query":"","category\_enable":"1","category\_base":"","category\_query":"","tag\_enable":"1","tag\_base":"","tag\_query":"","search\_enable":"1","search\_base":"","search\_query":"","nice\_search\_redirect":"","import\_options":"","export\_options":"","debug\_report":"","minify\_new\_style":"","clean\_new\_style":"","rename\_plugins":"","separator2":"","author\_without\_base":"","disable\_archive":"","disable\_other\_wp":"","trusted\_user\_roles":"","hide\_wp\_login":"on","hide\_wp\_admin":"on","spy\_notifier":"","separator":"","remove\_body\_class":"","remove\_html\_comments":"","antispam":"on","avoid\_direct\_access":"","hide\_other\_wp\_files":"on","enable\_firewall":"","ids\_level":"0","ids\_admin\_include":"","ids\_cookie":"","log\_firewall\_phpidsmin":"10","block\_firewall\_phpidsmin":"30","full\_hide":"","cdn\_path":"","li":"","customized\_htaccess":"","email\_firewall\_phpidsmin":"30","ids\_html\_fields":"","replace\_in\_ajax":"","blocked\_ip\_message":"You are blocked. Please contact site administrator if you think there is a problem.","blocked\_countries":"","blocked\_ips":"","new\_login\_path":"","help\_secure\_network":"","secure\_network":"<?php if(SECURITYFORCE\_LI) echo 'on'; ?>","exception\_fields":"REQUEST.comment[new\_line]POST.comment[new\_line]REQUEST.permalink\_structure[new\_line]POST.permalink\_structure[new\_line]REQUEST.selection[new\_line]POST.selection[new\_line]REQUEST.content[new\_line]POST.content[new\_line]REQUEST.\_\_utmz[new\_line]COOKIE.\_\_utmz[new\_line]REQUEST.s\_pers[new\_line]COOKIE.s\_pers[new\_line]REQUEST.user\_pass[new\_line]POST.user\_pass[new\_line]REQUEST.pass1[new\_line]POST.pass1[new\_line]REQUEST.pass2[new\_line]POST.pass2[new\_line]REQUEST.password[new\_line]POST.password[new\_line]POST.security\_force.%[new\_line]REQUEST.security\_force.%[new\_line]POST.%import%[new\_line]REQUEST.%import%[new\_line]REQUEST.newcontent[new\_line]POST.newcontent[new\_line]REQUEST.remember\_%"}' /> |
| [470](#L470) | <a href="#" class="setup-select-button">Select Setting</a> |
| [471](#L471) | </div> |
| [472](#L472) | <div class="setup-element-wrap"> |
| [473](#L473) | <div class="setup-settings-wrap"> |
| [474](#L474) | <h2>Advanced</h2> |
| [475](#L475) | <p>Best for medium complexity sites, Recommended for most sites.</p> |
| [476](#L476) | <span class="enable-ele"><span class="dashicons dashicons-yes"></span> Basic Settings Included </span> |
| [477](#L477) | <span class="enable-ele"><span class="dashicons dashicons-yes"></span> Advanced Firewall Rules </span> |
| [478](#L478) | <span class="enable-ele"><span class="dashicons dashicons-yes"></span> Attack Detection</span> |
| [479](#L479) | <span class="enable-ele"><span class="dashicons dashicons-yes"></span> Rename Plugins</span> |
| [480](#L480) | </div> |
| [481](#L481) | <input style="display: none;" type="radio" name="setup-eb-setting" value='{"replace\_javascript\_path":"3","disable\_directory\_listing":"on","exclude\_plugins\_access":"","exclude\_theme\_access":"","replace\_wpnonce":"","replace\_mode":"safe","custom\_404":"0","custom\_404\_page":"","login\_query":"security\_force","admin\_key":"1234","remove\_feed\_meta":"on","hide\_admin\_bar":"","remove\_other\_meta":"on","clean\_post\_class":"","remove\_menu\_class":"","remove\_default\_description":"on","remove\_ver\_scripts":"on","direct\_access\_except":"index.php, wp-comments-post.php, wp-includes/js/tinymce/wp-tinymce.php, xmlrpc.php, wp-cron.php","disable\_canonical\_redirect":"","email\_from\_name":"<?php echo get\_bloginfo('blogname'); ?>","email\_from\_address":"<?php echo $admin\_email; ?>","replace\_in\_html":"","new\_theme\_path":"/skin","new\_style\_name":"main.css","style\_expiry\_days":"3","new\_include\_path":"/other","new\_plugin\_path":"/ext","new\_upload\_path":"/file","replace\_comments\_post":"","replace\_admin\_ajax":"ajax","new\_content\_path":"inc","author\_enable":"1","author\_base":"profile","author\_query":"profile","feed\_enable":"1","feed\_base":"rss","feed\_query":"rss","post\_enable":"1","post\_base":"/blog/%year%/%monthnum%/%day%/%postname%/","post\_query":"entry\_id","page\_enable":"1","page\_base":"","page\_query":"page\_id","paginate\_enable":"1","paginate\_base":"","paginate\_query":"","category\_enable":"1","category\_base":"","category\_query":"","tag\_enable":"1","tag\_base":"","tag\_query":"","search\_enable":"1","search\_base":"","search\_query":"","nice\_search\_redirect":"on","import\_options":"","export\_options":"","debug\_report":"","minify\_new\_style":"safe","clean\_new\_style":"","rename\_plugins":"","separator2":"","author\_without\_base":"","disable\_archive":"","disable\_other\_wp":"","trusted\_user\_roles":"","hide\_wp\_login":"on","hide\_wp\_admin":"on","spy\_notifier":"","separator":"","remove\_body\_class":"","remove\_html\_comments":"","antispam":"on","avoid\_direct\_access":"","hide\_other\_wp\_files":"on","enable\_firewall":"on","ids\_level":"0","ids\_admin\_include":"","ids\_cookie":"","log\_firewall\_phpidsmin":"5","block\_firewall\_phpidsmin":"20","full\_hide":"","cdn\_path":"","li":"","customized\_htaccess":"","email\_firewall\_phpidsmin":"30","ids\_html\_fields":"","replace\_in\_ajax":"","blocked\_ip\_message":"You are blocked. Please contact site administrator if you think there is a problem.","blocked\_countries":"","blocked\_ips":"","help\_secure\_network":"on","secure\_network":"<?php if(SECURITYFORCE\_LI) echo 'on'; ?>","api\_base":"rest","api\_query":"rest","new\_login\_path":"","exception\_fields":"REQUEST.comment[new\_line]POST.comment[new\_line]REQUEST.permalink\_structure[new\_line]POST.permalink\_structure[new\_line]REQUEST.selection[new\_line]POST.selection[new\_line]REQUEST.content[new\_line]POST.content[new\_line]REQUEST.\_\_utmz[new\_line]COOKIE.\_\_utmz[new\_line]REQUEST.s\_pers[new\_line]COOKIE.s\_pers[new\_line]REQUEST.user\_pass[new\_line]POST.user\_pass[new\_line]REQUEST.pass1[new\_line]POST.pass1[new\_line]REQUEST.pass2[new\_line]POST.pass2[new\_line]REQUEST.password[new\_line]POST.password[new\_line]POST.security\_force.%[new\_line]REQUEST.security\_force.%[new\_line]POST.%import%[new\_line]REQUEST.%import%[new\_line]REQUEST.newcontent[new\_line]POST.newcontent[new\_line]REQUEST.remember\_%"}' /> |
| [482](#L482) | <a href="#" class="setup-select-button">Select Setting</a> |
| [483](#L483) | </div> |
| [484](#L484) | <div class="setup-element-wrap"> |
| [485](#L485) | <div class="setup-settings-wrap"> |
| [486](#L486) | <h2>Developer</h2> |
| [487](#L487) | <p>Attack detection, Hides all WordPress related stuff & provides most privacy and protection!</p> |
| [488](#L488) | <span class="enable-ele"><span class="dashicons dashicons-yes"></span> Basic and Advanced Settings included</span> |
| [489](#L489) | <span class="enable-ele"><span class="dashicons dashicons-yes"></span> Full SecurityForce Firewall Protection</span> |
| [490](#L490) | <span class="enable-ele"><span class="dashicons dashicons-yes"></span> Disable Direct File Access</span> |
| [491](#L491) | </div> |
| [492](#L492) | <input style="display: none;" type="radio" name="setup-eb-setting" value='{"replace\_javascript\_path":"3","disable\_directory\_listing":"on","exclude\_plugins\_access":"","exclude\_theme\_access":"","replace\_wpnonce":"","replace\_mode":"safe","custom\_404":"0","custom\_404\_page":"","hide\_wp\_login":"on","login\_query":"security\_force","admin\_key":"1234","hide\_wp\_admin":"on","remove\_feed\_meta":"on","hide\_admin\_bar":"on","remove\_other\_meta":"on","remove\_body\_class":"on","clean\_post\_class":"on","remove\_menu\_class":"on","remove\_default\_description":"on","remove\_html\_comments":"simple","remove\_ver\_scripts":"on","avoid\_direct\_access":"on","direct\_access\_except":"index.php, wp-comments-post.php, wp-includes/js/tinymce/wp-tinymce.php, xmlrpc.php, wp-cron.php","hide\_other\_wp\_files":"on","disable\_canonical\_redirect":"on","email\_from\_name":"WP Plugin Development","email\_from\_address":"<?php echo $admin\_email; ?>","replace\_in\_html":"","new\_theme\_path":"/template","new\_style\_name":"main.css","style\_expiry\_days":"3","minify\_new\_style":"quick","clean\_new\_style":"on","new\_include\_path":"/template/lib","new\_plugin\_path":"/template/ext","rename\_plugins":"all","new\_upload\_path":"/storage","replace\_comments\_post":"submit\_comment.php","replace\_admin\_ajax":"ajax","new\_content\_path":"inc","author\_enable":"1","author\_base":"profile","author\_query":"profile","author\_without\_base":"","feed\_enable":"1","feed\_base":"rss.xml","feed\_query":"rss","post\_enable":"1","post\_base":"/blog/%year%/%monthnum%/%day%/%postname%/","post\_query":"entry","page\_enable":"1","page\_base":"/page","page\_query":"page\_num","paginate\_enable":"1","paginate\_base":"list","paginate\_query":"list","category\_enable":"1","category\_base":"","category\_query":"category","tag\_enable":"1","":"keyword","tag\_query":"keyword","search\_enable":"1","search\_base":"find","search\_query":"find","nice\_search\_redirect":"on","disable\_archive":"on","disable\_other\_wp":"","import\_options":"","export\_options":"","debug\_report":"","separator2":"","trusted\_user\_roles":"","antispam":"on","spy\_notifier":"","separator":"","enable\_firewall":"on","ids\_level":"1","ids\_admin\_include":"","ids\_cookie":"","log\_firewall\_phpidsmin":"1","block\_firewall\_phpidsmin":"20","full\_hide":"on","cdn\_path":"","li":"b8013acc-a398-479f-8ac4-ffa47b6cd485","customized\_htaccess":"","email\_firewall\_phpidsmin":"20","ids\_html\_fields":"","replace\_in\_ajax":"","blocked\_ip\_message":"You are blocked. Please contact site administrator if you think there is a problem.","blocked\_countries":"","blocked\_ips":"","help\_secure\_network":"on","secure\_network":"<?php if(SECURITYFORCE\_LI) echo 'on'; ?>","api\_base":"api","api\_query":"api","new\_login\_path":"","exception\_fields":"REQUEST.comment[new\_line]POST.comment[new\_line]REQUEST.permalink\_structure[new\_line]POST.permalink\_structure[new\_line]REQUEST.selection[new\_line]POST.selection[new\_line]REQUEST.content[new\_line]POST.content[new\_line]REQUEST.\_\_utmz[new\_line]COOKIE.\_\_utmz[new\_line]REQUEST.s\_pers[new\_line]COOKIE.s\_pers[new\_line]REQUEST.user\_pass[new\_line]POST.user\_pass[new\_line]REQUEST.pass1[new\_line]POST.pass1[new\_line]REQUEST.pass2[new\_line]POST.pass2[new\_line]REQUEST.password[new\_line]POST.password[new\_line]POST.security\_force.%[new\_line]REQUEST.security\_force.%[new\_line]POST.%import%[new\_line]REQUEST.%import%[new\_line]REQUEST.newcontent[new\_line]POST.newcontent[new\_line]REQUEST.remember\_%"}' /> |
| [493](#L493) | <a href="#" class="setup-select-button">Select Setting</a> |
| [494](#L494) | </div> |
| [495](#L495) |  |
| [496](#L496) | </div> |
| [497](#L497) |  |
| [498](#L498) | </form> |
| [499](#L499) | </div> |
| [500](#L500) | <?php |
| [501](#L501) | } |
| [502](#L502) |  |
| [503](#L503) |  |
| [504](#L504) | //cleanup URL http://localhost/demo/wp-admin/admin-post.php?action=clear\_all\_widgets |
| [505](#L505) | public function clear\_all\_widgets() { |
| [506](#L506) | // Security check: Ensure the user has the necessary capability to perform this action. |
| [507](#L507) | if (!current\_user\_can('manage\_options')) { |
| [508](#L508) | wp\_die(\_\_('You do not have sufficient permissions to access this page.')); |
| [509](#L509) | } |
| [510](#L510) |  |
| [511](#L511) | // Delete the option from the database |
| [512](#L512) | $deleted = delete\_option('hedge3\_widgets\_config'); |
| [513](#L513) |  |
| [514](#L514) | // Check if the option was successfully deleted and redirect or display a message |
| [515](#L515) | if ($deleted) { |
| [516](#L516) | // Redirect back to the dashboard with a success message |
| [517](#L517) | $redirect\_url = add\_query\_arg(array('page' => 'security\_force\_dashboard', 'cleared' => 'true'), admin\_url('admin.php')); |
| [518](#L518) | wp\_redirect($redirect\_url); |
| [519](#L519) | exit; |
| [520](#L520) | } else { |
| [521](#L521) | // Option was not deleted. It may not have existed or there was a database error |
| [522](#L522) | wp\_die('Failed to clear the widgets. The option might not exist or there was a database error.'); |
| [523](#L523) | } |
| [524](#L524) | } |
| [525](#L525) |  |
| [526](#L526) |  |
| [527](#L527) |  |
| [528](#L528) |  |
| [529](#L529) |  |
| [530](#L530) |  |
| [531](#L531) |  |
| [532](#L532) | /\*\* |
| [533](#L533) | \* Display the dashboard page |
| [534](#L534) | \*/ |
| [535](#L535) | public function dashboard\_page() { |
| [536](#L536) |  |
| [537](#L537) | //echo "Dashboard page loaded."; |
| [538](#L538) | //die(); |
| [539](#L539) | if (isset($\_GET['edit\_widget'])) { |
| [540](#L540) | echo "Edit widget ID from URL: " . $\_GET['edit\_widget'] . "<br/>"; |
| [541](#L541) | $this->render\_builder\_page($\_GET['edit\_widget']); |
| [542](#L542) | return; // Add this return statement |
| [543](#L543) | } else if (isset($\_GET['action']) && $\_GET['action'] == 'add\_new') { |
| [544](#L544) | echo "call handle\_add\_new\_widget function"; |
| [545](#L545) | $this->handle\_add\_new\_widget(); |
| [546](#L546) | return; |
| [547](#L547) | } |
| [548](#L548) |  |
| [549](#L549) |  |
| [550](#L550) |  |
| [551](#L551) | $available\_layouts = [ |
| [552](#L552) | 'BlockSliderWidget' => 'Ticker Slider Widget', |
| [553](#L553) | 'TickerTapeWidget' => 'Ticker Tape Widget', |
| [554](#L554) | 'TopListWidget' => 'Top List Widget', |
| [555](#L555) | "BlockGalleryWidget" => 'Ticker Gallery Widget', |
| [556](#L556) | "SingleBlockWidget" => 'Single Ticker Widget' |
| [557](#L557) | // Add more layouts as needed |
| [558](#L558) | ]; |
| [559](#L559) | define('MY\_PLUGIN\_BASE\_DIR', plugin\_dir\_path(\_\_FILE\_\_)); |
| [560](#L560) |  |
| [561](#L561) |  |
| [562](#L562) | echo '<script> |
| [563](#L563) | function copyToClipboard(element) { |
| [564](#L564) | var parentDiv = element.closest(".dashboard\_row"); |
| [565](#L565) | var inputElement = parentDiv.querySelector("input"); |
| [566](#L566) |  |
| [567](#L567) | if (inputElement) { |
| [568](#L568) | inputElement.select(); |
| [569](#L569) | document.execCommand("copy"); |
| [570](#L570) | console.log("Shortcode copied to clipboard: " + inputElement.value); |
| [571](#L571) | inputElement.classList.add("active"); |
| [572](#L572) | setTimeout(function() { |
| [573](#L573) | inputElement.classList.remove("active"); |
| [574](#L574) | }, 1000); |
| [575](#L575) | } else { |
| [576](#L576) | console.error("Input element not found."); |
| [577](#L577) | } |
| [578](#L578) | } |
| [579](#L579) | </script>'; |
| [580](#L580) |  |
| [581](#L581) |  |
| [582](#L582) |  |
| [583](#L583) |  |
| [584](#L584) |  |
| [585](#L585) | echo '<style>'; |
| [586](#L586) | echo '.sorting-indicator.asc:before { content: "\f142"; }'; // up arrow from Dashicons |
| [587](#L587) | echo '.sorting-indicator.desc:before { content: "\f140"; }'; // down arrow from Dashicons |
| [588](#L588) | echo '.sorting-indicator:before {'; |
| [589](#L589) | echo '    font: normal 20px/1 dashicons;'; // Ensure Dashicons is the font |
| [590](#L590) | echo '    speak: none;'; |
| [591](#L591) | echo '    display: inline-block;'; |
| [592](#L592) | echo '    padding: 0;'; |
| [593](#L593) | echo '    position: relative;'; |
| [594](#L594) | echo '    vertical-align: top;'; |
| [595](#L595) | echo '    -webkit-font-smoothing: antialiased;'; |
| [596](#L596) | echo '    -moz-osx-font-smoothing: grayscale;'; |
| [597](#L597) | echo '    text-decoration: none!important;'; |
| [598](#L598) | echo '    color: #a7aaad;'; // Change color if needed |
| [599](#L599) | echo '}'; |
| [600](#L600) | echo '</style>'; |
| [601](#L601) |  |
| [602](#L602) | function load\_dashicons\_front\_end() { |
| [603](#L603) | wp\_enqueue\_style('dashicons'); |
| [604](#L604) | } |
| [605](#L605) | add\_action('wp\_enqueue\_scripts', 'load\_dashicons\_front\_end'); |
| [606](#L606) |  |
| [607](#L607) | // Security check: Ensure the user has the necessary capability to view this page. |
| [608](#L608) | if (!current\_user\_can('manage\_options')) { |
| [609](#L609) | wp\_die(\_\_('You do not have sufficient permissions to access this page.')); |
| [610](#L610) | } |
| [611](#L611) |  |
| [612](#L612) | // Handle widget deletion and other actions. |
| [613](#L613) | if (isset($\_GET['delete\_widget'])) { |
| [614](#L614) | // ... Your deletion logic remains the same ... |
| [615](#L615) | } |
| [616](#L616) |  |
| [617](#L617) | // Retrieve and possibly filter widgets stored in the WordPress option |
| [618](#L618) | $widgets = get\_option('hedge3\_widgets\_config', array()); |
| [619](#L619) | $widgets = array\_reverse($widgets); // Reverse the array to show the latest widget first |
| [620](#L620) |  |
| [621](#L621) |  |
| [622](#L622) | // List of valid sort columns |
| [623](#L623) | $valid\_orderby = ['name', 'data', 'layout', 'last\_modified']; |
| [624](#L624) | // Default to 'name' if the provided value is not valid |
| [625](#L625) | $orderby = in\_array($\_GET['orderby'] ?? '', $valid\_orderby) ? $\_GET['orderby'] : 'name'; |
| [626](#L626) |  |
| [627](#L627) | // Only allow 'asc' or 'desc' |
| [628](#L628) | $order = in\_array($\_GET['order'] ?? '', ['asc', 'desc']) ? $\_GET['order'] : 'asc'; |
| [629](#L629) |  |
| [630](#L630) |  |
| [631](#L631) | $orderby = $\_GET['orderby'] ?? 'name'; // default to sorting by 'name' |
| [632](#L632) | $order = $\_GET['order'] ?? 'asc'; |
| [633](#L633) | function sort\_widgets($a, $b) { |
| [634](#L634) | global $orderby, $order; |
| [635](#L635) | // Safely get the values for comparison, default to an empty string if the key doesn't exist |
| [636](#L636) | $valA = $a[$orderby] ?? ''; |
| [637](#L637) | $valB = $b[$orderby] ?? ''; |
| [638](#L638) |  |
| [639](#L639) | if ($valA == $valB) { |
| [640](#L640) | return 0; |
| [641](#L641) | } |
| [642](#L642) |  |
| [643](#L643) | if ($order === 'asc') { |
| [644](#L644) | return ($valA < $valB) ? -1 : 1; |
| [645](#L645) | } else { |
| [646](#L646) | return ($valA > $valB) ? -1 : 1; |
| [647](#L647) | } |
| [648](#L648) | } |
| [649](#L649) | // Sort the widgets before displaying them |
| [650](#L650) | usort($widgets, 'sort\_widgets'); |
| [651](#L651) |  |
| [652](#L652) | //var\_dump($widgets); |
| [653](#L653) |  |
| [654](#L654) | // Count the total number of items for display |
| [655](#L655) | $total\_items = count($widgets); |
| [656](#L656) |  |
| [657](#L657) | echo '<div class="wrap hedge3\_clean">'; |
| [658](#L658) |  |
| [659](#L659) | // Page title and add new button |
| [660](#L660) | echo '<h1 class="wp-heading-inline">Hedge3 Widgets</h1>'; |
| [661](#L661) | echo '<a href="' . admin\_url('admin.php?page=security\_force\_dashboard&action=add\_new') . '" class="page-title-action">Add New</a>'; |
| [662](#L662) |  |
| [663](#L663) |  |
| [664](#L664) |  |
| [665](#L665) | echo '<hr class="wp-header-end">'; |
| [666](#L666) |  |
| [667](#L667) | // Filters (add your dropdowns here for additional filtering) |
| [668](#L668) | echo '<div class="tablenav top">'; |
| [669](#L669) | echo '<div class="alignleft actions">'; |
| [670](#L670) | // Date filter |
| [671](#L671) | echo '<select name="date\_filter" id="date-filter">'; |
| [672](#L672) | echo '<option value="0">All Dates</option>'; |
| [673](#L673) | // Populate options with dates here |
| [674](#L674) | echo '</select>'; |
| [675](#L675) |  |
| [676](#L676) | // Layout filter |
| [677](#L677) | echo '<select name="layout\_filter" id="layout-filter">'; |
| [678](#L678) | echo '<option value="0">All Layouts</option>'; |
| [679](#L679) | // Populate options with layout types here |
| [680](#L680) | echo '</select>'; |
| [681](#L681) |  |
| [682](#L682) | // Data filter |
| [683](#L683) | echo '<select name="data\_filter" id="data-filter">'; |
| [684](#L684) | echo '<option value="0">All Data</option>'; |
| [685](#L685) | // Populate options with data types here |
| [686](#L686) | echo '</select>'; |
| [687](#L687) |  |
| [688](#L688) | // Apply Filter button |
| [689](#L689) | echo '<input type="submit" name="filter\_action" id="post-query-submit" class="button" value="Filter">'; |
| [690](#L690) | echo '</div>'; |
| [691](#L691) |  |
| [692](#L692) | // Bulk actions dropdown |
| [693](#L693) | echo '<div class="alignleft actions bulkactions">'; |
| [694](#L694) | echo '<select name="action" id="bulk-action-selector-top">'; |
| [695](#L695) | echo '<option value="-1">Bulk Actions</option>'; |
| [696](#L696) | echo '<option value="delete">Delete</option>'; |
| [697](#L697) | // Add other bulk actions here |
| [698](#L698) | echo '</select>'; |
| [699](#L699) | echo '<input type="submit" id="doaction" class="button action" value="Apply">'; |
| [700](#L700) | echo '</div>'; |
| [701](#L701) |  |
| [702](#L702) | // Search form |
| [703](#L703) | echo '<form id="widgets-search" method="get" style="float:right;">'; |
| [704](#L704) | echo '<input type="hidden" name="page" value="security\_force\_dashboard" />'; |
| [705](#L705) | echo '<p class="search-box">'; |
| [706](#L706) | echo '<label class="screen-reader-text" for="widget-search-input">Search Widgets:</label>'; |
| [707](#L707) | echo '<input type="search" id="widget-search-input" name="s" value="" />'; |
| [708](#L708) | echo '<input type="submit" id="search-submit" class="button" value="Search Widgets">'; |
| [709](#L709) | echo '</p>'; |
| [710](#L710) | echo '</form>'; |
| [711](#L711) |  |
| [712](#L712) | echo '<br class="clear">'; |
| [713](#L713) | echo '</div>'; |
| [714](#L714) |  |
| [715](#L715) | // Table structure with WordPress classes |
| [716](#L716) | echo '<table class="wp-list-table widefat fixed striped">'; |
| [717](#L717) | echo '<thead><tr>'; |
| [718](#L718) | echo '<th scope="col" id="cb" class="manage-column column-cb check-column">'; |
| [719](#L719) | echo '<input id="cb-select-all-1" type="checkbox" />'; |
| [720](#L720) | echo '</th>'; |
| [721](#L721) | echo '<th scope="col" class="manage-column ' . ($orderby === 'name' ? 'sorted ' . $order : 'sortable') . '">'; |
| [722](#L722) | echo '<a href="?page=security\_force\_dashboard&orderby=name&order=' . ($orderby === 'name' && $order === 'asc' ? 'desc' : 'asc') . '">'; |
| [723](#L723) | echo '<span>Name</span>'; |
| [724](#L724) | echo '<span class="sorting-indicator ' . ($orderby === 'name' ? $order : '') . '"></span>'; |
| [725](#L725) | echo '</a>'; |
| [726](#L726) | echo '</th>'; |
| [727](#L727) |  |
| [728](#L728) | echo '<th scope="col" class="manage-column sortable ' . ($orderby === 'data' ? ($order === 'asc' ? 'asc' : 'desc') : '') . '">'; |
| [729](#L729) | echo '<a href="?page=security\_force\_dashboard&orderby=data&order=' . ($orderby === 'data' && $order === 'asc' ? 'desc' : 'asc') . '">'; |
| [730](#L730) | echo '<span>Data</span>'; |
| [731](#L731) | echo '<span class="sorting-indicator"></span>'; |
| [732](#L732) | echo '</a>'; |
| [733](#L733) | echo '</th>'; |
| [734](#L734) |  |
| [735](#L735) | echo '<th scope="col" class="manage-column sortable ' . ($orderby === 'layout' ? ($order === 'asc' ? 'asc' : 'desc') : '') . '">'; |
| [736](#L736) | echo '<a href="?page=security\_force\_dashboard&orderby=layout&order=' . ($orderby === 'layout' && $order === 'asc' ? 'desc' : 'asc') . '">'; |
| [737](#L737) | echo '<span>Layout</span>'; |
| [738](#L738) | echo '<span class="sorting-indicator"></span>'; |
| [739](#L739) | echo '</a>'; |
| [740](#L740) | echo '</th>'; |
| [741](#L741) |  |
| [742](#L742) | echo '<th scope="col" class="manage-column sortable ' . ($orderby === 'last\_modified' ? ($order === 'asc' ? 'asc' : 'desc') : '') . '">'; |
| [743](#L743) | echo '<a href="?page=security\_force\_dashboard&orderby=last\_modified&order=' . ($orderby === 'last\_modified' && $order === 'asc' ? 'desc' : 'asc') . '">'; |
| [744](#L744) | echo '<span>ShortCode</span>'; |
| [745](#L745) | echo '<span class="sorting-indicator"></span>'; |
| [746](#L746) | echo '</a>'; |
| [747](#L747) | echo '</th>'; |
| [748](#L748) |  |
| [749](#L749) | echo '<th scope="col">Actions</th>'; |
| [750](#L750) | echo '</tr></thead>'; |
| [751](#L751) |  |
| [752](#L752) | // Table footer (mirroring the header) |
| [753](#L753) | echo '<tfoot><tr>'; |
| [754](#L754) | echo '<th scope="col" class="manage-column column-cb check-column">'; |
| [755](#L755) | echo '<input id="cb-select-all-2" type="checkbox" />'; |
| [756](#L756) | echo '</th>'; |
| [757](#L757) | echo '<th scope="col">Name</th>'; |
| [758](#L758) | echo '<th scope="col">Data</th>'; |
| [759](#L759) | echo '<th scope="col">Layout</th>'; |
| [760](#L760) | echo '<th scope="col">ShortCode</th>'; |
| [761](#L761) | echo '<th scope="col">Actions</th>'; |
| [762](#L762) | echo '</tr></tfoot>'; |
| [763](#L763) |  |
| [764](#L764) | // Table body |
| [765](#L765) | echo '<form id="widgets-form" method="post">'; |
| [766](#L766) | echo '<tbody id="the-list">'; |
| [767](#L767) | if (!empty($widgets)) { |
| [768](#L768) | foreach ($widgets as $index => $widget) { |
| [769](#L769) | // Assuming each widget has an 'id' field. |
| [770](#L770) | $widgetID = $widget['id'] ?? 'N/A';  // Fallback to 'N/A' if no ID is set. |
| [771](#L771) |  |
| [772](#L772) | echo '<tr>'; |
| [773](#L773) | echo '<th scope="row" class="check-column">'; |
| [774](#L774) | echo '<input type="checkbox" name="widget[]" value="' . esc\_attr($widgetID) . '">'; |
| [775](#L775) | echo '</th>'; |
| [776](#L776) | echo '<td><a href="?page=builder&edit\_widget=' . esc\_attr($widgetID) . '">' . esc\_html($widget['name'] ?? 'N/A') .'</a></td>'; |
| [777](#L777) | echo '<td>' . esc\_html($widget['data'] ?? 'No Data') . '</td>'; |
| [778](#L778) | echo '<td>' . esc\_html($widget['layout'] ?? 'No Layout') . '</td>'; |
| [779](#L779) | $shortcode = '[hedge3\_widgets id="' . esc\_attr($widget['id'] ?? 'N/A') . '"]'; // Customize as needed |
| [780](#L780) | echo '<td class="dashboard\_row hedge3\_shortcode\_block">'; |
| [781](#L781) | echo '<input value="' . esc\_html($shortcode).'" readonly />'; |
| [782](#L782) | echo '<span class="dashicons dashicons-admin-page copy-icon" onclick="copyToClipboard(this)"></span>'; |
| [783](#L783) | echo '</td>'; |
| [784](#L784) | echo '<td><a href="?page=builder&edit\_widget=' . esc\_attr($widgetID) . '">Edit</a> | '; |
| [785](#L785) | echo '<a href="' . wp\_nonce\_url(admin\_url('admin-post.php?action=delete\_widget&widget\_id=' . $widgetID), 'delete\_widget\_nonce') . '" class="hedge3\_text\_denger" onclick="return confirm(\'Are you sure?\')">Delete</a></td>'; |
| [786](#L786) | echo '</tr>'; |
| [787](#L787) | } |
| [788](#L788) | } else { |
| [789](#L789) | echo '<tr><td colspan="6">No widgets found</td></tr>'; |
| [790](#L790) | } |
| [791](#L791) | echo '</tbody>'; |
| [792](#L792) | echo '</table>'; |
| [793](#L793) | echo '</form>'; |
| [794](#L794) |  |
| [795](#L795) | // Table items counters and bottom bulk actions |
| [796](#L796) | echo '<div class="tablenav bottom">'; |
| [797](#L797) | echo '<div class="alignleft actions bulkactions">'; |
| [798](#L798) | echo '<select name="action2" id="bulk-action-selector-bottom">'; |
| [799](#L799) | echo '<option value="-1">Bulk Actions</option>'; |
| [800](#L800) | echo '<option value="delete">Delete</option>'; |
| [801](#L801) | // Add other bulk actions here |
| [802](#L802) | echo '</select>'; |
| [803](#L803) | echo '<input type="submit" id="doaction2" class="button action" value="Apply">'; |
| [804](#L804) | echo '</div>'; |
| [805](#L805) | echo '<div class="tablenav-pages"><span class="displaying-num">' . $total\_items . ' Widgets</span>'; |
| [806](#L806) | // Pagination links would go here |
| [807](#L807) | echo '</div>'; |
| [808](#L808) | echo '<br class="clear">'; |
| [809](#L809) | echo '</div>'; |
| [810](#L810) |  |
| [811](#L811) | echo '</div>'; // .wrap |
| [812](#L812) |  |
| [813](#L813) | echo '<div class="layouts-container">'; // Container for the layouts |
| [814](#L814) | echo '<h2>Available Layouts</h2>'; |
| [815](#L815) | echo '<ul class="dashboard-layouts-list">'; |
| [816](#L816) |  |
| [817](#L817) | foreach ($available\_layouts as $layout\_id => $layout\_name) { |
| [818](#L818) | $image\_path = 'http://hedge3.org/wp-content/uploads/2024/02/' . $layout\_id; |
| [819](#L819) | echo '<li class="layout-item">'; |
| [820](#L820) | echo '<a href="' . esc\_url(admin\_url('admin.php?page=builder&action=edit\_widget&layout=' . $layout\_id)) . '">'; |
| [821](#L821) | echo '<div class="default"><img src="' . esc\_url($image\_path) . '.png" alt="' . esc\_attr($layout\_name) . '" class="layout-image"/></div>'; |
| [822](#L822) | echo '<div class="active"><img src="' . esc\_url($image\_path) . '.gif" alt="' . esc\_attr($layout\_name) . '" class="layout-image"/></div>'; |
| [823](#L823) | echo '<span class="layout-title">' . esc\_html($layout\_name) . '</span>'; |
| [824](#L824) | echo '</a>'; |
| [825](#L825) | echo '</li>'; |
| [826](#L826) | } |
| [827](#L827) |  |
| [828](#L828) | // echo '<li class="layout-item add-new">'; |
| [829](#L829) | // echo '<a href="">'; |
| [830](#L830) | // echo '<div class="add-inner">'; |
| [831](#L831) | // echo '<span class="add-cross">&#43;</span>'; |
| [832](#L832) | // echo '</div>'; |
| [833](#L833) | // echo '</a>'; |
| [834](#L834) | // echo '</li>'; |
| [835](#L835) |  |
| [836](#L836) | echo '</ul>'; |
| [837](#L837) | echo '</div>'; |
| [838](#L838) |  |
| [839](#L839) | // Fast Links Section |
| [840](#L840) | echo '<div class="h3-quick-navigation">'; // Container for the layouts |
| [841](#L841) |  |
| [842](#L842) | echo '<h2>Quick Navigation</h2>'; |
| [843](#L843) | echo '<div class="h3-footer-grid">'; |
| [844](#L844) |  |
| [845](#L845) | // First item: Getting Started |
| [846](#L846) | echo '<a href="https://hedge3.org/academy/coverage/wordpress-crypto-widgets/?utm\_source=plugin&utm\_medium=dashboard" target="\_blank" class="h3-footer-link">'; |
| [847](#L847) | echo '    <button class="h3-footer-box">'; |
| [848](#L848) | echo '        <div class="h3-footer-col h3-footer-box-icon">'; |
| [849](#L849) | echo '          <svg width="32px" height="32px" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.566 17.842c-.945 2.462-3.678 4.012-6.563 4.161.139-2.772 1.684-5.608 4.209-6.563l.51.521c-1.534 1.523-2.061 2.765-2.144 3.461.704-.085 2.006-.608 3.483-2.096l.505.516zm-1.136-11.342c-1.778-.01-4.062.911-5.766 2.614-.65.649-1.222 1.408-1.664 2.258 1.538-1.163 3.228-1.485 5.147-.408.566-1.494 1.32-3.014 2.283-4.464zm5.204 17.5c.852-.44 1.61-1.013 2.261-1.664 1.708-1.706 2.622-4.001 2.604-5.782-1.575 1.03-3.125 1.772-4.466 2.296 1.077 1.92.764 3.614-.399 5.15zm11.312-23.956c-.428-.03-.848-.044-1.261-.044-9.338 0-14.465 7.426-16.101 13.009l4.428 4.428c5.78-1.855 12.988-6.777 12.988-15.993v-.059c-.002-.437-.019-.884-.054-1.341zm-5.946 7.956c-1.105 0-2-.895-2-2s.895-2 2-2 2 .895 2 2-.895 2-2 2z"/></svg>'; |
| [850](#L850) | echo '        </div>'; |
| [851](#L851) | echo '        <div class="h3-footer-col h3-footer-box-text">'; |
| [852](#L852) | echo '            <div>Getting Started</div>'; |
| [853](#L853) | echo '            <div>Watch a short video to understand the concept!</div>'; |
| [854](#L854) | echo '        </div>'; |
| [855](#L855) | echo '        <div class="h3-footer-col h3-footer-box-external">'; |
| [856](#L856) | echo '         <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="Layer\_1" x="0px" y="0px" viewBox="0 0 122.6 122.88" style="enable-background:new 0 0 122.6 122.88" xml:space="preserve"><g><path d="M110.6,72.58c0-3.19,2.59-5.78,5.78-5.78c3.19,0,5.78,2.59,5.78,5.78v33.19c0,4.71-1.92,8.99-5.02,12.09 c-3.1,3.1-7.38,5.02-12.09,5.02H17.11c-4.71,0-8.99-1.92-12.09-5.02c-3.1-3.1-5.02-7.38-5.02-12.09V17.19 C0,12.48,1.92,8.2,5.02,5.1C8.12,2,12.4,0.08,17.11,0.08h32.98c3.19,0,5.78,2.59,5.78,5.78c0,3.19-2.59,5.78-5.78,5.78H17.11 c-1.52,0-2.9,0.63-3.91,1.63c-1.01,1.01-1.63,2.39-1.63,3.91v88.58c0,1.52,0.63,2.9,1.63,3.91c1.01,1.01,2.39,1.63,3.91,1.63h87.95 c1.52,0,2.9-0.63,3.91-1.63s1.63-2.39,1.63-3.91V72.58L110.6,72.58z M112.42,17.46L54.01,76.6c-2.23,2.27-5.89,2.3-8.16,0.07 c-2.27-2.23-2.3-5.89-0.07-8.16l56.16-56.87H78.56c-3.19,0-5.78-2.59-5.78-5.78c0-3.19,2.59-5.78,5.78-5.78h26.5 c5.12,0,11.72-0.87,15.65,3.1c2.48,2.51,1.93,22.52,1.61,34.11c-0.08,3-0.15,5.29-0.15,6.93c0,3.19-2.59,5.78-5.78,5.78 c-3.19,0-5.78-2.59-5.78-5.78c0-0.31,0.08-3.32,0.19-7.24C110.96,30.94,111.93,22.94,112.42,17.46L112.42,17.46z"/></g></svg>'; |
| [857](#L857) | echo '        </div>'; |
| [858](#L858) | echo '    </button>'; |
| [859](#L859) | echo '</a>'; |
| [860](#L860) |  |
| [861](#L861) | // Second item: Support |
| [862](#L862) | echo '<a href="mailto:grigoryanjacob@gmail.com?subject=Getting%20problem%20with%20Hedge3%20plugin&body=Hey%20Jacob%20my%20name%20is%20\_\_\_\_\_\_\_\_\_\_\_%2C%20I%20know%20email%20support%20is%20only%20for%20pro%20version%20users%20and%20I%20do%20consider%20switching%20to%20pro%20one%20day,%20but%20currently%20I`m%20facing%20problems%20with%20free%20version%20and%20need%20your%20urgent%20assistance.%20%0D%0A%20%0D%0ASo%20whenever%20I%20try%20to%20\_\_\_\_\_\_\_\_\_\_\_the%20plugin\_\_\_\_\_\_\_\_\_\_\_\_\_%2C%20but%20I%20would%20like%20to%20\_\_\_\_\_\_\_\_\_\_\_.%20%0D%0A%0D%0ABest%20Regards🤙." target="\_blank" class="h3-footer-link">'; |
| [863](#L863) | echo '    <button class="h3-footer-box">'; |
| [864](#L864) | echo '        <div class="h3-footer-col h3-footer-box-icon">'; |
| [865](#L865) | echo '          <svg width="32px" height="32px" stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg" style="font-size: 40px;"><path fill="none" d="M0 0h24v24H0z"></path><path d="M19 2H5a2 2 0 00-2 2v14a2 2 0 002 2h4l3 3 3-3h4c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-6 16h-2v-2h2v2zm2.07-7.75l-.9.92C13.45 11.9 13 12.5 13 14h-2v-.5c0-1.1.45-2.1 1.17-2.83l1.24-1.26c.37-.36.59-.86.59-1.41 0-1.1-.9-2-2-2s-2 .9-2 2H8c0-2.21 1.79-4 4-4s4 1.79 4 4c0 .88-.36 1.68-.93 2.25z"></path></svg>'; |
| [866](#L866) | echo '        </div>'; |
| [867](#L867) | echo '        <div class="h3-footer-col h3-footer-box-text">'; |
| [868](#L868) | echo '            <div>Help & Support</div>'; |
| [869](#L869) | echo '            <div>Expect answere during 24 hours!</div>'; |
| [870](#L870) | echo '        </div>'; |
| [871](#L871) | echo '        <div class="h3-footer-col h3-footer-box-external">'; |
| [872](#L872) | echo '         <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="Layer\_1" x="0px" y="0px" viewBox="0 0 122.6 122.88" style="enable-background:new 0 0 122.6 122.88" xml:space="preserve"><g><path d="M110.6,72.58c0-3.19,2.59-5.78,5.78-5.78c3.19,0,5.78,2.59,5.78,5.78v33.19c0,4.71-1.92,8.99-5.02,12.09 c-3.1,3.1-7.38,5.02-12.09,5.02H17.11c-4.71,0-8.99-1.92-12.09-5.02c-3.1-3.1-5.02-7.38-5.02-12.09V17.19 C0,12.48,1.92,8.2,5.02,5.1C8.12,2,12.4,0.08,17.11,0.08h32.98c3.19,0,5.78,2.59,5.78,5.78c0,3.19-2.59,5.78-5.78,5.78H17.11 c-1.52,0-2.9,0.63-3.91,1.63c-1.01,1.01-1.63,2.39-1.63,3.91v88.58c0,1.52,0.63,2.9,1.63,3.91c1.01,1.01,2.39,1.63,3.91,1.63h87.95 c1.52,0,2.9-0.63,3.91-1.63s1.63-2.39,1.63-3.91V72.58L110.6,72.58z M112.42,17.46L54.01,76.6c-2.23,2.27-5.89,2.3-8.16,0.07 c-2.27-2.23-2.3-5.89-0.07-8.16l56.16-56.87H78.56c-3.19,0-5.78-2.59-5.78-5.78c0-3.19,2.59-5.78,5.78-5.78h26.5 c5.12,0,11.72-0.87,15.65,3.1c2.48,2.51,1.93,22.52,1.61,34.11c-0.08,3-0.15,5.29-0.15,6.93c0,3.19-2.59,5.78-5.78,5.78 c-3.19,0-5.78-2.59-5.78-5.78c0-0.31,0.08-3.32,0.19-7.24C110.96,30.94,111.93,22.94,112.42,17.46L112.42,17.46z"/></g></svg>'; |
| [873](#L873) | echo '        </div>'; |
| [874](#L874) | echo '    </button>'; |
| [875](#L875) | echo '</a>'; |
| [876](#L876) |  |
| [877](#L877) | // Third item: Upgrade |
| [878](#L878) | echo '<a href="https://hedge3.org/pricing/?utm\_source=plugin&utm\_medium=dashboard" target="\_blank" class="h3-footer-link">'; |
| [879](#L879) | echo '    <button class="h3-footer-box">'; |
| [880](#L880) | echo '        <div class="h3-footer-col h3-footer-box-icon">'; |
| [881](#L881) | echo '          <svg width="32px" height="32px" viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><defs><linearGradient id="grad1" x1="0%" y1="0%" x2="0%" y2="100%"><stop offset="0%" style="stop-color:#622abd; stop-opacity:1" /><stop offset="100%" style="stop-color:#9d5be8; stop-opacity:1" /></linearGradient></defs><path fill="url(#grad1)" d="M256 29.816l-231 154v106.368l231-154 231 154V183.816zm0 128.043L105 259.783v90.283l151-101.925 151 101.925v-90.283zm0 112l-87 58.725v67.6l87-58 87 58v-67.6zm0 89.957l-87 58v64.368l87-58 87 58v-64.368z"/></svg>'; |
| [882](#L882) | echo '        </div>'; |
| [883](#L883) | echo '        <div class="h3-footer-col h3-footer-box-text">'; |
| [884](#L884) | echo '            <div>Upgrade</div>'; |
| [885](#L885) | echo '            <div>Limited time offer: 50% Discount</div>'; |
| [886](#L886) | echo '        </div>'; |
| [887](#L887) | echo '        <div class="h3-footer-col h3-footer-box-external">'; |
| [888](#L888) | echo '         <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="Layer\_1" x="0px" y="0px" viewBox="0 0 122.6 122.88" style="enable-background:new 0 0 122.6 122.88" xml:space="preserve"><g><path d="M110.6,72.58c0-3.19,2.59-5.78,5.78-5.78c3.19,0,5.78,2.59,5.78,5.78v33.19c0,4.71-1.92,8.99-5.02,12.09 c-3.1,3.1-7.38,5.02-12.09,5.02H17.11c-4.71,0-8.99-1.92-12.09-5.02c-3.1-3.1-5.02-7.38-5.02-12.09V17.19 C0,12.48,1.92,8.2,5.02,5.1C8.12,2,12.4,0.08,17.11,0.08h32.98c3.19,0,5.78,2.59,5.78,5.78c0,3.19-2.59,5.78-5.78,5.78H17.11 c-1.52,0-2.9,0.63-3.91,1.63c-1.01,1.01-1.63,2.39-1.63,3.91v88.58c0,1.52,0.63,2.9,1.63,3.91c1.01,1.01,2.39,1.63,3.91,1.63h87.95 c1.52,0,2.9-0.63,3.91-1.63s1.63-2.39,1.63-3.91V72.58L110.6,72.58z M112.42,17.46L54.01,76.6c-2.23,2.27-5.89,2.3-8.16,0.07 c-2.27-2.23-2.3-5.89-0.07-8.16l56.16-56.87H78.56c-3.19,0-5.78-2.59-5.78-5.78c0-3.19,2.59-5.78,5.78-5.78h26.5 c5.12,0,11.72-0.87,15.65,3.1c2.48,2.51,1.93,22.52,1.61,34.11c-0.08,3-0.15,5.29-0.15,6.93c0,3.19-2.59,5.78-5.78,5.78 c-3.19,0-5.78-2.59-5.78-5.78c0-0.31,0.08-3.32,0.19-7.24C110.96,30.94,111.93,22.94,112.42,17.46L112.42,17.46z"/></g></svg>'; |
| [889](#L889) | echo '        </div>'; |
| [890](#L890) | echo '    </button>'; |
| [891](#L891) | echo '</a>'; |
| [892](#L892) |  |
| [893](#L893) | echo '</div>'; // Close h3-footer-grid |
| [894](#L894) | echo '</div>'; |
| [895](#L895) | } |
| [896](#L896) |  |
| [897](#L897) |  |
| [898](#L898) |  |
| [899](#L899) |  |
| [900](#L900) |  |
| [901](#L901) | public function handle\_widget\_save() { |
| [902](#L902) | // Security and permission checks |
| [903](#L903) | if (!current\_user\_can('manage\_options')) { |
| [904](#L904) | wp\_die(\_\_('You do not have sufficient permissions to access this page.')); |
| [905](#L905) | } |
| [906](#L906) | check\_admin\_referer('edit\_widget\_action', 'edit\_widget\_nonce'); |
| [907](#L907) |  |
| [908](#L908) | // Get widget ID from POST data |
| [909](#L909) | $widget\_id = $\_POST['widget\_id'] ?? null; |
| [910](#L910) | if (null === $widget\_id) { |
| [911](#L911) | wp\_die('Error: Widget ID is missing from the request.'); |
| [912](#L912) | } |
| [913](#L913) |  |
| [914](#L914) | // Retrieve widgets from the database |
| [915](#L915) | $widgets = get\_option('hedge3\_widgets\_config', array()); |
| [916](#L916) | if (!isset($widgets[$widget\_id])) { |
| [917](#L917) | wp\_die("Error: Widget with ID $widget\_id does not exist."); |
| [918](#L918) | } |
| [919](#L919) |  |
| [920](#L920) | // Decode and update the widget configuration |
| [921](#L921) | try { |
| [922](#L922) | // Assume $\_POST['widget\_config'] contains JSON string of only the 'options' part of the widget |
| [923](#L923) | $new\_options = json\_decode(stripslashes($\_POST['widget\_config']), true); |
| [924](#L924) | if (null === $new\_options) { |
| [925](#L925) | wp\_die('Error: Invalid JSON data received.'); |
| [926](#L926) | } |
| [927](#L927) |  |
| [928](#L928) | $widgets[$widget\_id] = $new\_options; |
| [929](#L929) |  |
| [930](#L930) | // Save the updated array back to the database |
| [931](#L931) | update\_option('hedge3\_widgets\_config', $widgets); |
| [932](#L932) |  |
| [933](#L933) | // Redirect back to the edit page or dashboard |
| [934](#L934) | wp\_redirect(admin\_url('admin.php?page=builder&edit\_widget=' . $widget\_id)); |
| [935](#L935) | exit; |
| [936](#L936) | } catch (Exception $e) { |
| [937](#L937) | wp\_die('Error: Exception occurred - ' . $e->getMessage()); |
| [938](#L938) | } |
| [939](#L939) |  |
| [940](#L940) | } |
| [941](#L941) |  |
| [942](#L942) |  |
| [943](#L943) |  |
| [944](#L944) | public function handle\_add\_new\_widget() { |
| [945](#L945) | // Security check: Ensure the user has the necessary capability to add new widgets |
| [946](#L946) | if (!current\_user\_can('manage\_options')) { |
| [947](#L947) | wp\_die(\_\_('You do not have sufficient permissions to access this page.')); |
| [948](#L948) | } |
| [949](#L949) |  |
| [950](#L950) | // Fetch the current widgets configuration |
| [951](#L951) | $widgets = get\_option('hedge3\_widgets\_config', array()); |
| [952](#L952) |  |
| [953](#L953) | // Determine the new widget's ID |
| [954](#L954) |  |
| [955](#L955) |  |
| [956](#L956) | // Set up the default configuration for the new widget with an explicit 'id' field |
| [957](#L957) | $new\_widget = $this->get\_default\_widget\_config(); |
| [958](#L958) | $new\_widget\_id = $new\_widget["id"]; |
| [959](#L959) | $widgets[$new\_widget\_id] = $new\_widget; |
| [960](#L960) |  |
| [961](#L961) | // Save the updated widgets configuration |
| [962](#L962) | update\_option('hedge3\_widgets\_config', $widgets); |
| [963](#L963) |  |
| [964](#L964) | // Redirect to the widget edit page with the new widget ID |
| [965](#L965) | wp\_redirect(admin\_url('admin.php?page=builder&edit\_widget=' . $new\_widget\_id)); |
| [966](#L966) | exit; |
| [967](#L967) | } |
| [968](#L968) |  |
| [969](#L969) |  |
| [970](#L970) |  |
| [971](#L971) |  |
| [972](#L972) | private function get\_default\_widget\_config() { |
| [973](#L973) | // Fetch the current widgets configuration |
| [974](#L974) | $widgets = get\_option('hedge3\_widgets\_config', array()); |
| [975](#L975) | // Determine the new widget's ID |
| [976](#L976) | $new\_widget\_id = !empty($widgets) ? max(array\_keys($widgets)) + 1 : 1; |
| [977](#L977) |  |
| [978](#L978) | // Generate a 4-digit random number |
| [979](#L979) | $random\_number = mt\_rand(1000, 9999); |
| [980](#L980) | echo "</br>get\_default\_widget\_config call"; |
| [981](#L981) | return [ |
| [982](#L982) | "name" => "Widget-" . $new\_widget\_id, |
| [983](#L983) | "layout" => "BlockSliderWidget", |
| [984](#L984) | "data" => "largestFunds", |
| [985](#L985) | "tokenType" => "crypto", |
| [986](#L986) | "enableEdit" => true, |
| [987](#L987) | "containerSelector" => "#h3-widget-" . $random\_number, |
| [988](#L988) | "id" =>  $new\_widget\_id, |
| [989](#L989) | "options" => [], // Provide some default options |
| [990](#L990) | "styles" => [],   // Provide some default styles |
| [991](#L991) | ]; |
| [992](#L992) | } |
| [993](#L993) |  |
| [994](#L994) |  |
| [995](#L995) | /\*\* |
| [996](#L996) | \* Display Edit Page |
| [997](#L997) | \*/ |
| [998](#L998) | public function render\_builder\_page($widget\_id = null) { |
| [999](#L999) | echo "</br> render\_builder\_page function call"; |
| [1000](#L1000) | // Check for permissions |
| [1001](#L1001) | if (!current\_user\_can('manage\_options')) { |
| [1002](#L1002) | wp\_die(\_\_('You do not have sufficient permissions to access this page.')); |
| [1003](#L1003) | } |
| [1004](#L1004) |  |
| [1005](#L1005) |  |
| [1006](#L1006) | // Check if a widget ID was passed or is available in the request |
| [1007](#L1007) | $widget\_id = $widget\_id ?: (isset($\_GET['edit\_widget']) ? $\_GET['edit\_widget'] : null); |
| [1008](#L1008) |  |
| [1009](#L1009) | // Get the current widgets configuration |
| [1010](#L1010) | $widgets = get\_option('hedge3\_widgets\_config', array()); |
| [1011](#L1011) |  |
| [1012](#L1012) | $formAction = 'edit\_widget'; |
| [1013](#L1013) |  |
| [1014](#L1014) | // Determine if we're editing an existing widget or creating a new one |
| [1015](#L1015) | if ($widget\_id !== null && isset($widgets[$widget\_id])) { |
| [1016](#L1016) | //Existing Widget |
| [1017](#L1017) | echo "</br> Edit Widget IF"; |
| [1018](#L1018) | $widget\_config = $widgets[$widget\_id]; |
| [1019](#L1019) | } else { |
| [1020](#L1020) | //Crearing New One |
| [1021](#L1021) | echo "</br> Create New Widget config"; |
| [1022](#L1022) | $widget\_config = $this->get\_default\_widget\_config(); |
| [1023](#L1023) | $widget\_id = $widget\_config["id"]; |
| [1024](#L1024) |  |
| [1025](#L1025) |  |
| [1026](#L1026) | if (isset($\_GET['layout'])) { |
| [1027](#L1027) | $layout = sanitize\_text\_field($\_GET['layout']); |
| [1028](#L1028) | $widget\_config['layout'] = $layout;  // Update the layout in the widget configuration |
| [1029](#L1029) | echo "<br/>Updated widget layout to: " . $layout; |
| [1030](#L1030) | }else { |
| [1031](#L1031) | $redirect\_url = admin\_url('admin.php?page=builder&action=edit\_widget&layout=BlockSliderWidget'); |
| [1032](#L1032) | wp\_redirect($redirect\_url); |
| [1033](#L1033) | exit; |
| [1034](#L1034) | } |
| [1035](#L1035) |  |
| [1036](#L1036) | echo "</br> ID ready widget\_config="; |
| [1037](#L1037) | var\_dump($widget\_config); |
| [1038](#L1038) |  |
| [1039](#L1039) | } |
| [1040](#L1040) |  |
| [1041](#L1041) |  |
| [1042](#L1042) |  |
| [1043](#L1043) |  |
| [1044](#L1044) | // Update the widget configuration |
| [1045](#L1045) | $widgets[$widget\_id] = $widget\_config; |
| [1046](#L1046) | update\_option('hedge3\_widgets\_config', $widgets); |
| [1047](#L1047) |  |
| [1048](#L1048) | // Generate the nonce field for security |
| [1049](#L1049) | wp\_nonce\_field('edit\_widget\_action', 'edit\_widget\_nonce'); |
| [1050](#L1050) |  |
| [1051](#L1051) | // Extract the nonce value for use in the widget configuration |
| [1052](#L1052) | ob\_start(); |
| [1053](#L1053) | wp\_nonce\_field('edit\_widget\_action', 'edit\_widget\_nonce'); |
| [1054](#L1054) | $nonceFieldHtml = ob\_get\_clean(); |
| [1055](#L1055) | preg\_match('/value="([^"]+)"/', $nonceFieldHtml, $matches); |
| [1056](#L1056) | $nonceValue = $matches[1] ?? 'no-nonce-found'; |
| [1057](#L1057) | $widget\_config['nonce'] = $nonceValue; |
| [1058](#L1058) |  |
| [1059](#L1059) | // Determine the last part of the container selector |
| [1060](#L1060) | $containerValueLast = substr($widget\_config['containerSelector'],1); |
| [1061](#L1061) |  |
| [1062](#L1062) | // Render the form with the current configuration |
| [1063](#L1063) | ?> |
| [1064](#L1064) | <form method="post" action="<?php echo admin\_url('admin-post.php'); ?>"> |
| [1065](#L1065) | <?php wp\_nonce\_field('edit\_widget\_action', 'edit\_widget\_nonce'); ?> |
| [1066](#L1066) | <input type="hidden" name="action" value="<?php echo esc\_attr($formAction); ?>"> |
| [1067](#L1067) | <input type="hidden" name="widget\_id" value="<?php echo esc\_attr($widget\_id); ?>"> |
| [1068](#L1068) | <textarea  id="config\_input" name="widget\_config"><?php echo esc\_textarea(json\_encode($widget\_config, JSON\_PRETTY\_PRINT)); ?></textarea> |
| [1069](#L1069) | <input type="submit" id="config\_submit" value="Save Changes" class="button"> |
| [1070](#L1070) | </form> |
| [1071](#L1071) | <div class="widget\_page\_wrap widget-editor-background" style="background-image: url('<?php echo SECURITYFORCE\_URL; ?>/img/h3.annimate.gif');"> |
| [1072](#L1072) | <script> |
| [1073](#L1073) | document.addEventListener('DOMContentLoaded', () => { |
| [1074](#L1074) | const script = document.createElement('script'); |
| [1075](#L1075) | script.src = '<?php echo esc\_url(HEDGE3\_LIB\_SCRIPT\_PATH); ?>'; |
| [1076](#L1076) | script.onload = () => { |
| [1077](#L1077) | window.initializeActiveWidget(<?php echo json\_encode($widget\_config, JSON\_PRETTY\_PRINT); ?>); |
| [1078](#L1078) | }; |
| [1079](#L1079) | document.head.appendChild(script); |
| [1080](#L1080) | }); |
| [1081](#L1081) | </script> |
| [1082](#L1082) | <div id="<?php echo $containerValueLast; ?>" class="hedge3-widgets"></div> |
| [1083](#L1083) | </div> |
| [1084](#L1084) | <?php |
| [1085](#L1085) |  |
| [1086](#L1086) | // Console log for debugging |
| [1087](#L1087) | echo "<script>console.log('Widget nonce: " . $widget\_config['nonce'] . "');</script>"; |
| [1088](#L1088) | echo "<script>console.log('Container Value Last: " . $containerValueLast . "');</script>"; |
| [1089](#L1089) |  |
| [1090](#L1090) | exit; |
| [1091](#L1091) | } |
| [1092](#L1092) |  |
| [1093](#L1093) |  |
| [1094](#L1094) |  |
| [1095](#L1095) |  |
| [1096](#L1096) | public function handle\_delete\_widget() { |
| [1097](#L1097) | // Check for the widget\_id in the URL or POST data |
| [1098](#L1098) | $widget\_id = $\_GET['widget\_id'] ?? null; |
| [1099](#L1099) |  |
| [1100](#L1100) | if ($widget\_id === null) { |
| [1101](#L1101) | wp\_die('Widget ID is required.'); |
| [1102](#L1102) | } |
| [1103](#L1103) |  |
| [1104](#L1104) | // Nonce check for security |
| [1105](#L1105) | check\_admin\_referer('delete\_widget\_nonce'); |
| [1106](#L1106) |  |
| [1107](#L1107) | // Retrieve the existing widgets |
| [1108](#L1108) | $widgets = get\_option('hedge3\_widgets\_config', array()); |
| [1109](#L1109) |  |
| [1110](#L1110) | // Check if the widget exists and delete it |
| [1111](#L1111) | if (isset($widgets[$widget\_id])) { |
| [1112](#L1112) | echo "Unset!"; |
| [1113](#L1113) | unset($widgets[$widget\_id]); |
| [1114](#L1114) | echo "Update!"; |
| [1115](#L1115) | update\_option('hedge3\_widgets\_config', $widgets); |
| [1116](#L1116) |  |
| [1117](#L1117) | // Redirect back to the dashboard with a success message |
| [1118](#L1118) | $redirect\_url = add\_query\_arg(array('page' => 'security\_force\_dashboard', 'deleted' => 'true'), admin\_url('admin.php')); |
| [1119](#L1119) | wp\_redirect($redirect\_url); |
| [1120](#L1120) | exit; |
| [1121](#L1121) | } else { |
| [1122](#L1122) | wp\_die('Widget not found.'); |
| [1123](#L1123) | } |
| [1124](#L1124) | } |
| [1125](#L1125) |  |
| [1126](#L1126) |  |
| [1127](#L1127) |  |
| [1128](#L1128) |  |
| [1129](#L1129) |  |
| [1130](#L1130) |  |
| [1131](#L1131) |  |
| [1132](#L1132) |  |
| [1133](#L1133) |  |
| [1134](#L1134) |  |
| [1135](#L1135) |  |
| [1136](#L1136) |  |
| [1137](#L1137) |  |
| [1138](#L1138) |  |
| [1139](#L1139) | /\*\* |
| [1140](#L1140) | \* Display the plugin settings options page |
| [1141](#L1141) | \*/ |
| [1142](#L1142) | public function render\_option\_page() { |
| [1143](#L1143) | wp\_enqueue\_script('masonry'); |
| [1144](#L1144) |  |
| [1145](#L1145) | if ($this->settings\_menu['template\_file']) { |
| [1146](#L1146) | include\_once($this->settings\_menu['template\_file']); |
| [1147](#L1147) | } else { |
| [1148](#L1148) | echo '<div class="wrap settings\_api\_class\_page" id="' . $this->settings\_menu['name'] . '\_settings" >'; |
| [1149](#L1149) | $icon = ''; |
| [1150](#L1150) | if (isset($this->settings\_menu['icon\_path']) && $this->settings\_menu['icon\_path']) |
| [1151](#L1151) | $icon = ' style="background: url(' . $this->settings\_menu['icon\_path'] . ') no-repeat ;" '; |
| [1152](#L1152) |  |
| [1153](#L1153) | echo '<div id="icon-options-general" class="icon32" ' . $icon . '><br /></div>'; |
| [1154](#L1154) |  |
| [1155](#L1155) | echo '<h2>' . $this->settings\_menu['title'] . '</h2>'; |
| [1156](#L1156) |  |
| [1157](#L1157) | //echo '<br />'; |
| [1158](#L1158) | //settings\_errors(); |
| [1159](#L1159) | if (isset($\_GET['settings-updated']) && $\_GET['settings-updated'] == 'true') |
| [1160](#L1160) | echo '<div class="updated fade"><p><strong>' . \_\_('Options updated successfully!', $this->settings\_menu['name']) . '</p></strong></div>'; |
| [1161](#L1161) |  |
| [1162](#L1162) | if (isset($\_GET['settings-reseted']) && $\_GET['settings-reseted']) |
| [1163](#L1163) | echo '<div class="updated fade"><p><strong>' . \_\_('Options rested successfully!', $this->settings\_menu['name']) . '</p></strong></div>'; |
| [1164](#L1164) |  |
| [1165](#L1165) | if (isset($\_GET['settings-imported']) && $\_GET['settings-imported']) |
| [1166](#L1166) | echo '<div class="updated fade"><p><strong>' . \_\_('Options saved successfully!', $this->settings\_menu['name']) . '</p></strong></div>'; |
| [1167](#L1167) |  |
| [1168](#L1168) | do\_action('securityforce\_settings\_api\_header', $this->settings\_menu); |
| [1169](#L1169) |  |
| [1170](#L1170) |  |
| [1171](#L1171) | //$this->show\_navigation(); |
| [1172](#L1172) | $this->show\_forms(); |
| [1173](#L1173) |  |
| [1174](#L1174) | do\_action('securityforce\_settings\_api\_footer', $this->settings\_menu); |
| [1175](#L1175) |  |
| [1176](#L1176) | echo '</div>'; |
| [1177](#L1177) | } |
| [1178](#L1178) | } |
| [1179](#L1179) |  |
| [1180](#L1180) |  |
| [1181](#L1181) |  |
| [1182](#L1182) |  |
| [1183](#L1183) |  |
| [1184](#L1184) |  |
| [1185](#L1185) |  |
| [1186](#L1186) |  |
| [1187](#L1187) |  |
| [1188](#L1188) |  |
| [1189](#L1189) |  |
| [1190](#L1190) | /\*\* |
| [1191](#L1191) | \* Show blocked ip list |
| [1192](#L1192) | \*/ |
| [1193](#L1193) | public function securityforce\_render\_secure\_network\_page(){ |
| [1194](#L1194) | global $wpdb; |
| [1195](#L1195) |  |
| [1196](#L1196) | // Current page number, items per page |
| [1197](#L1197) | $per\_page = SECURITYFORCE\_FIREWALL\_Utils::securityforce\_ab\_attacks\_per\_page(); |
| [1198](#L1198) | $pagenum  = isset( $\_GET['paged'] ) ? absint( $\_GET['paged'] ) : 0; |
| [1199](#L1199) | if ( empty( $pagenum ) ) |
| [1200](#L1200) | $pagenum = 1; |
| [1201](#L1201) |  |
| [1202](#L1202) | // Offset, limit |
| [1203](#L1203) | $limit  = $per\_page; |
| [1204](#L1204) | $offset = ( $pagenum \* $limit ) - $limit; |
| [1205](#L1205) | $offset = ( $offset < 0 ) ? 0 : $offset; |
| [1206](#L1206) |  |
| [1207](#L1207) | // Get results |
| [1208](#L1208) | $search = isset( $\_GET['ip\_search'] ) ? sanitize\_text\_field( $\_GET['ip\_search'] ) : ''; |
| [1209](#L1209) | $search\_title = ''; |
| [1210](#L1210) | if ( $search ) { |
| [1211](#L1211) | $search\_title = sprintf( '<span class="subtitle">' . \_\_( 'Search results for &#8220;%s&#8221;', 'mute-screamer' ) . '</span>', esc\_html( $search ) ); |
| [1212](#L1212) | $token = '%'.$search.'%'; |
| [1213](#L1213) | $sql = $wpdb->prepare( 'SELECT SQL\_CALC\_FOUND\_ROWS \* FROM ' . $wpdb->prefix . 'securityforce\_blocked\_ips WHERE (ip LIKE %s ) ORDER BY created DESC LIMIT %d, %d', $token, $offset, $limit ); |
| [1214](#L1214) | } else { |
| [1215](#L1215) | $sql = $wpdb->prepare( 'SELECT SQL\_CALC\_FOUND\_ROWS \* FROM ' . $wpdb->prefix . 'securityforce\_blocked\_ips ORDER BY created DESC LIMIT %d, %d', $offset, $limit ); |
| [1216](#L1216) | } |
| [1217](#L1217) | $blocked\_ips = $wpdb->get\_results( $sql ); |
| [1218](#L1218) | $total\_ips = $wpdb->get\_var( 'SELECT FOUND\_ROWS();' ); |
| [1219](#L1219) |  |
| [1220](#L1220) | // Construct pagination links |
| [1221](#L1221) | $num\_pages  = ceil( $total\_ips / $per\_page ); |
| [1222](#L1222) | $pagination = SECURITYFORCE\_FIREWALL\_Utils::pagination( $pagenum, $num\_pages, $per\_page, $total\_ips ); |
| [1223](#L1223) | // Columns |
| [1224](#L1224) | $columns = array( |
| [1225](#L1225) | 'ip' => \_\_( 'IP Address', 'mute-screamer' ), |
| [1226](#L1226) | 'date' => \_\_( 'Date', 'mute-screamer' ) |
| [1227](#L1227) | ); |
| [1228](#L1228) | ?> |
| [1229](#L1229) | <div class="wrap"> |
| [1230](#L1230) | <!-- <h1>SECURITYFORCE Blocked IP Addresses <?php echo $search\_title; ?></h1> --> |
| [1231](#L1231) | <!-- <form STYLES="MARGIN-TOP:" method="get" action="admin.php" class="search-form"> |
| [1232](#L1232) | <input type="hidden" value="<?php echo 'securityforce\_secure\_network';?>" name="page"/> |
| [1233](#L1233) | <p class="search-box"> |
| [1234](#L1234) | <label for="s" class="screen-reader-text"><?php \_e( 'Search IP', 'mute-screamer' ); ?></label> |
| [1235](#L1235) | <input type="text" value="<?php echo esc\_attr( $search ); ?>" name="ip\_search" id="securityforce\_ab-attacks-search-input"/> |
| [1236](#L1236) | <input type="submit" class="button" value="<?php \_e( 'Search IP Address', 'mute-screamer' ); ?>"/> |
| [1237](#L1237) | </p> |
| [1238](#L1238) | </form> --> |
| [1239](#L1239) |  |
| [1240](#L1240) | <div id="hedge3-welcome-panel" class="welcome-panel"> |
| [1241](#L1241) | <!-- <input type="hidden" id="welcomepanelnonce" name="welcomepanelnonce" value="9e042115e2">               <a class="welcome-panel-close" href="http://localhost/demo/wp-admin/?welcome=0" aria-label="Dismiss the welcome panel">Dismiss</a> |
| [1242](#L1242) | --> |
| [1243](#L1243) | <div class="welcome-panel-content"> |
| [1244](#L1244) | <div class="welcome-panel-header hedge3\_clean"> |
| [1245](#L1245) | <div class="welcome-panel-header-image"> |
| [1246](#L1246) | <svg preserveAspectRatio="xMidYMin slice" fill="none" viewBox="0 0 1232 240" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false"> |
| [1247](#L1247) | <g clip-path="url(#a)"> |
| [1248](#L1248) | <path fill="#151515" d="M0 0h1232v240H0z"></path> |
| [1249](#L1249) | <ellipse cx="616" cy="232" fill="url(#b)" opacity=".05" rx="1497" ry="249"></ellipse> |
| [1250](#L1250) | <mask id="d" width="1000" height="400" x="232" y="20" maskUnits="userSpaceOnUse" style="mask-type:alpha"> |
| [1251](#L1251) | <path fill="url(#c)" d="M0 0h1000v400H0z" transform="translate(232 20)"></path> |
| [1252](#L1252) | </mask> |
| [1253](#L1253) | <g stroke-width="2" mask="url(#d)"> |
| [1254](#L1254) | <path stroke="url(#e)" d="M387 20v1635"></path> |
| [1255](#L1255) | <path stroke="url(#f)" d="M559.5 20v1635"></path> |
| [1256](#L1256) | <path stroke="url(#g)" d="M732 20v1635"></path> |
| [1257](#L1257) | <path stroke="url(#h)" d="M904.5 20v1635"></path> |
| [1258](#L1258) | <path stroke="url(#i)" d="M1077 20v1635"></path> |
| [1259](#L1259) | </g> |
| [1260](#L1260) | </g> |
| [1261](#L1261) | <defs> |
| [1262](#L1262) | <linearGradient id="e" x1="387.5" x2="387.5" y1="20" y2="1655" gradientUnits="userSpaceOnUse"> |
| [1263](#L1263) | <stop stop-color="#3858E9" stop-opacity="0"></stop> |
| [1264](#L1264) | <stop offset=".297" stop-color="#3858E9"></stop> |
| [1265](#L1265) | <stop offset=".734" stop-color="#3858E9"></stop> |
| [1266](#L1266) | <stop offset="1" stop-color="#3858E9" stop-opacity="0"></stop> |
| [1267](#L1267) | <stop offset="1" stop-color="#3858E9" stop-opacity="0"></stop> |
| [1268](#L1268) | </linearGradient> |
| [1269](#L1269) | <linearGradient id="f" x1="560" x2="560" y1="20" y2="1655" gradientUnits="userSpaceOnUse"> |
| [1270](#L1270) | <stop stop-color="#FFFCB5" stop-opacity="0"></stop> |
| [1271](#L1271) | <stop offset="0" stop-color="#FFFCB5" stop-opacity="0"></stop> |
| [1272](#L1272) | <stop offset=".297" stop-color="#FFFCB5"></stop> |
| [1273](#L1273) | <stop offset=".734" stop-color="#FFFCB5"></stop> |
| [1274](#L1274) | <stop offset="1" stop-color="#FFFCB5" stop-opacity="0"></stop> |
| [1275](#L1275) | </linearGradient> |
| [1276](#L1276) | <linearGradient id="g" x1="732.5" x2="732.5" y1="20" y2="1655" gradientUnits="userSpaceOnUse"> |
| [1277](#L1277) | <stop stop-color="#C7FFDB" stop-opacity="0"></stop> |
| [1278](#L1278) | <stop offset=".297" stop-color="#C7FFDB"></stop> |
| [1279](#L1279) | <stop offset=".693" stop-color="#C7FFDB"></stop> |
| [1280](#L1280) | <stop offset="1" stop-color="#C7FFDB" stop-opacity="0"></stop> |
| [1281](#L1281) | </linearGradient> |
| [1282](#L1282) | <linearGradient id="h" x1="905" x2="905" y1="20" y2="1655" gradientUnits="userSpaceOnUse"> |
| [1283](#L1283) | <stop stop-color="#FFB7A7" stop-opacity="0"></stop> |
| [1284](#L1284) | <stop offset=".297" stop-color="#FFB7A7"></stop> |
| [1285](#L1285) | <stop offset=".734" stop-color="#FFB7A7"></stop> |
| [1286](#L1286) | <stop offset="1" stop-color="#3858E9" stop-opacity="0"></stop> |
| [1287](#L1287) | <stop offset="1" stop-color="#FFB7A7" stop-opacity="0"></stop> |
| [1288](#L1288) | </linearGradient> |
| [1289](#L1289) | <linearGradient id="i" x1="1077.5" x2="1077.5" y1="20" y2="1655" gradientUnits="userSpaceOnUse"> |
| [1290](#L1290) | <stop stop-color="#7B90FF" stop-opacity="0"></stop> |
| [1291](#L1291) | <stop offset=".297" stop-color="#7B90FF"></stop> |
| [1292](#L1292) | <stop offset=".734" stop-color="#7B90FF"></stop> |
| [1293](#L1293) | <stop offset="1" stop-color="#3858E9" stop-opacity="0"></stop> |
| [1294](#L1294) | <stop offset="1" stop-color="#7B90FF" stop-opacity="0"></stop> |
| [1295](#L1295) | </linearGradient> |
| [1296](#L1296) | <radialGradient id="b" cx="0" cy="0" r="1" gradientTransform="matrix(0 249 -1497 0 616 232)" gradientUnits="userSpaceOnUse"> |
| [1297](#L1297) | <stop stop-color="#3858E9"></stop> |
| [1298](#L1298) | <stop offset="1" stop-color="#151515" stop-opacity="0"></stop> |
| [1299](#L1299) | </radialGradient> |
| [1300](#L1300) | <radialGradient id="c" cx="0" cy="0" r="1" gradientTransform="matrix(0 765 -1912.5 0 500 -110)" gradientUnits="userSpaceOnUse"> |
| [1301](#L1301) | <stop offset=".161" stop-color="#151515" stop-opacity="0"></stop> |
| [1302](#L1302) | <stop offset=".682"></stop> |
| [1303](#L1303) | </radialGradient> |
| [1304](#L1304) | <clipPath id="a"> |
| [1305](#L1305) | <path fill="#fff" d="M0 0h1232v240H0z"></path> |
| [1306](#L1306) | </clipPath> |
| [1307](#L1307) | </defs> |
| [1308](#L1308) | </svg> |
| [1309](#L1309) | </div> |
| [1310](#L1310) | <h2>Web3 Ready Crypto Widgets</h2> |
| [1311](#L1311) | <p> |
| [1312](#L1312) | Join Hedge3 to stay proactive building Crypto & DeFi on WordPress! |
| [1313](#L1313) | </p> |
| [1314](#L1314) | <p> |
| [1315](#L1315) | <a class="view-more-button" target="\_blank" href="https://hedge3.org/defi-widgets/?utm\_source=plugin&utm\_medium=plugin-installation">Discover Widgets</a> |
| [1316](#L1316) | </p> |
| [1317](#L1317) | </div> |
| [1318](#L1318) | <div class="welcome-panel-column-container"> |
| [1319](#L1319) | <div class="welcome-panel-column"> |
| [1320](#L1320) | <svg width="48" height="48" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false"> |
| [1321](#L1321) | <rect width="48" height="48" rx="4" fill="#1E1E1E"></rect> |
| [1322](#L1322) | <path fill-rule="evenodd" clip-rule="evenodd" d="M32.0668 17.0854L28.8221 13.9454L18.2008 24.671L16.8983 29.0827L21.4257 27.8309L32.0668 17.0854ZM16 32.75H24V31.25H16V32.75Z" fill="white"></path> |
| [1323](#L1323) | </svg> |
| [1324](#L1324) | <div class="welcome-panel-column-content"> |
| [1325](#L1325) | <h3>Branded widgets with own watermark.</h3> |
| [1326](#L1326) | <p>Pro version allows you to customize chart style and put your own watermark instead of Hedge3.</p> |
| [1327](#L1327) | <a target="\_blank" href="https://hedge3.org/pricing/?utm\_source=plugin&utm\_medium=plugin-installation">Get Pro Now →</a> |
| [1328](#L1328) | </div> |
| [1329](#L1329) | </div> |
| [1330](#L1330) | <div class="welcome-panel-column"> |
| [1331](#L1331) | <svg width="48" height="48" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false"> |
| [1332](#L1332) | <rect width="48" height="48" rx="4" fill="#1E1E1E"></rect> |
| [1333](#L1333) | <path fill-rule="evenodd" clip-rule="evenodd" d="M18 16h12a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H18a2 2 0 0 1-2-2V18a2 2 0 0 1 2-2zm12 1.5H18a.5.5 0 0 0-.5.5v3h13v-3a.5.5 0 0 0-.5-.5zm.5 5H22v8h8a.5.5 0 0 0 .5-.5v-7.5zm-10 0h-3V30a.5.5 0 0 0 .5.5h2.5v-8z" fill="#fff"></path> |
| [1334](#L1334) | </svg> |
| [1335](#L1335) | <div class="welcome-panel-column-content"> |
| [1336](#L1336) | <h3>Advanced layouts for swap and aggregation.</h3> |
| [1337](#L1337) | <p>Follow Hedge3 on Twitter to stay tuned abour plugin lates updates and perks.</p> |
| [1338](#L1338) | <a target="\_blank" href="https://docs.google.com/forms/d/e/1FAIpQLSfWOXKUmfEvwKGCKLKSxKDTvdr-qCe9EZJh\_F96ODAluXlsJw/viewform?usp=sf\_link">Get Early Access →</a> |
| [1339](#L1339) | </div> |
| [1340](#L1340) | </div> |
| [1341](#L1341) | <div class="welcome-panel-column"> |
| [1342](#L1342) | <svg width="48" height="48" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false"> |
| [1343](#L1343) | <rect width="48" height="48" rx="4" fill="#1E1E1E"></rect> |
| [1344](#L1344) | <path fill-rule="evenodd" clip-rule="evenodd" d="M31 24a7 7 0 0 1-7 7V17a7 7 0 0 1 7 7zm-7-8a8 8 0 1 1 0 16 8 8 0 0 1 0-16z" fill="#fff"></path> |
| [1345](#L1345) | </svg> |
| [1346](#L1346) | <div class="welcome-panel-column-content"> |
| [1347](#L1347) | <h3>Custom web3 functionalities for your needs!</h3> |
| [1348](#L1348) | <p>Get personalized custom functionalities weather it's a new design component or a dApp feature.</p> |
| [1349](#L1349) | <a target="\_blank" href="https://docs.google.com/forms/d/e/1FAIpQLSdmgOvJqP\_Zq-dqGqDqWpFziRcX-\_Z7cYE9rJyLRGbwf\_rLgg/viewform?usp=sf\_link">Get In Touch →</a> |
| [1350](#L1350) | </div> |
| [1351](#L1351) | </div> |
| [1352](#L1352) | </div> |
| [1353](#L1353) |  |
| [1354](#L1354) |  |
| [1355](#L1355) |  |
| [1356](#L1356) | </div> |
| [1357](#L1357) | </div> |
| [1358](#L1358) | <div class="pro-options-content"> |
| [1359](#L1359) |  |
| [1360](#L1360) | <div class="shpwcase-section right"> |
| [1361](#L1361) | <div class="content-col"> |
| [1362](#L1362) | <h2>Getting Started With Hedge3 Widgets</h2> |
| [1363](#L1363) | <p></p> |
| [1364](#L1364) | <p>Hedge3 widget are easy to build! To get familiar with widget builder you have to understand propose of four sections!</p> |
| [1365](#L1365) | <ul> |
| [1366](#L1366) | <li><strong>Layout</strong> - construction of the widget.</li> |
| [1367](#L1367) | <li><strong>Data</strong> - what information to aggregate.</li> |
| [1368](#L1368) | <li><strong>Options</strong> - anything related to change.</li> |
| [1369](#L1369) | <li><strong>Styles</strong> - customize styles under your branding.</li> |
| [1370](#L1370) | </ul> |
| [1371](#L1371) | <p>Copy paste <strong>[shortcode]</strong> to publish the widgets!</p> |
| [1372](#L1372) | </div> |
| [1373](#L1373) | <div class="content-col"> |
| [1374](#L1374) | <iframe width="600" height="400" src="https://www.youtube.com/embed/shM6w2sRhO4?si=ER3lHgYvtL\_6F3gT" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe> |
| [1375](#L1375) | </div> |
| [1376](#L1376) | </div> |
| [1377](#L1377) |  |
| [1378](#L1378) | <div class="shpwcase-section left"> |
| [1379](#L1379) | <div class="content-col"> |
| [1380](#L1380) | <img width="100%" src="http://hedge3.org/wp-content/uploads/2024/02/screenshot-7.gif" alt="Hedge3 Demo" /> |
| [1381](#L1381) | </div> |
| [1382](#L1382) | <div class="content-col"> |
| [1383](#L1383) | <h2>Pro Version Advantages</h2> |
| [1384](#L1384) | <p>While the free version of Hedge3 Widgets is  enough, the advanced version is a gamechanger in WordPress</p> |
| [1385](#L1385) | <p>Main advantages of Pro version:</p> |
| [1386](#L1386) |  |
| [1387](#L1387) | <ul> |
| [1388](#L1388) | <li>Design Options</li> |
| [1389](#L1389) | <li>Copyright Free</li> |
| [1390](#L1390) | <li>Unlimited Widgets</li> |
| [1391](#L1391) | <li>Priority Support</li> |
| [1392](#L1392) | <li>Minor Customizations</li> |
| [1393](#L1393) | </ul> |
| [1394](#L1394) |  |
| [1395](#L1395) |  |
| [1396](#L1396) | </div> |
| [1397](#L1397) | </div> |
| [1398](#L1398) |  |
| [1399](#L1399) |  |
| [1400](#L1400) | <div class="related-review"> |
| [1401](#L1401) | <h2>Limited-Time Offer: 50% Discount!</h2> |
| [1402](#L1402) | <p>Pro version allows you to customize widgets, set your own watermark, and access pro support.</br>Do crypto business professionally with Hedge3!</p> |
| [1403](#L1403) | <a class="view-more-button" target="\_blank" href="https://hedge3.org/pricing/?utm\_source=plugin&utm\_medium=plugin-installation">See Pricing</a> |
| [1404](#L1404) | </div> |
| [1405](#L1405) | </div> |
| [1406](#L1406) | </div> |
| [1407](#L1407) | <?php |
| [1408](#L1408) | } |
| [1409](#L1409) |  |
| [1410](#L1410) |  |
| [1411](#L1411) |  |
| [1412](#L1412) |  |
| [1413](#L1413) |  |
| [1414](#L1414) |  |
| [1415](#L1415) |  |
| [1416](#L1416) |  |
| [1417](#L1417) |  |
| [1418](#L1418) |  |
| [1419](#L1419) | /\*\* |
| [1420](#L1420) | \* Display Firewall PHPIDS Menu // Pro Options |
| [1421](#L1421) | \*/ |
| [1422](#L1422) | public function render\_firewall\_phpidspage(){ |
| [1423](#L1423) | $hmadmin = new SECURITYFORCE\_FIREWALL\_Admin(); |
| [1424](#L1424) | $hmadmin->attacks(); |
| [1425](#L1425) | } |
| [1426](#L1426) |  |
| [1427](#L1427) | public function filter\_settings() { |
| [1428](#L1428) | $options\_file = (is\_multisite()) ? 'network/settings.php' : 'admin.php'; |
| [1429](#L1429) | $menuName = isset($this->settings\_menu['name']) ? $this->settings\_menu['name'] : 'default\_menu\_name'; |
| [1430](#L1430) | $page\_url = admin\_url(add\_query\_arg('page', $menuName, $options\_file)); |
| [1431](#L1431) |  |
| [1432](#L1432) | $can\_deactive = false; |
| [1433](#L1433) | if (isset($\_COOKIE['securityforce\_can\_deactivate']) && preg\_replace("/[^a-zA-Z]/", "", substr(NONCE\_SALT, 0, 8)) == preg\_replace("/[^a-zA-Z]/", "", $\_COOKIE['securityforce\_can\_deactivate'])) |
| [1434](#L1434) | $can\_deactive = true; |
| [1435](#L1435) |  |
| [1436](#L1436) | if ($can\_deactive && is\_admin() && isset($\_POST['action']) && $\_POST['action'] == 'update' && isset($\_POST['option\_page']) && $\_POST['option\_page'] == $this->settings\_menu['name']) { |
| [1437](#L1437) |  |
| [1438](#L1438) | //to fix problem with default on checkbox |
| [1439](#L1439) | $def\_keys = array\_keys($this->get\_defaults()); |
| [1440](#L1440) | if (is\_array($def\_keys)) |
| [1441](#L1441) | foreach ($def\_keys as $key) |
| [1442](#L1442) | if (!isset($\_POST[$this->settings\_menu['name']][$key])) |
| [1443](#L1443) | $\_POST[$this->settings\_menu['name']][$key] = ''; |
| [1444](#L1444) |  |
| [1445](#L1445) | $\_POST = apply\_filters('securityforce\_settings\_api\_filter', $\_POST); |
| [1446](#L1446) |  |
| [1447](#L1447) | if (isset($\_POST['import\_field']) && $\_POST['import\_field'] && check\_admin\_referer($this->settings\_menu['name'] . '-options')) { |
| [1448](#L1448) | //delete\_option( $this->settings\_menu['name'] ); |
| [1449](#L1449) | $new\_settings = sanitize\_text\_field(stripslashes($\_POST['import\_field'])); |
| [1450](#L1450) | $new\_settings = json\_decode($new\_settings, true); |
| [1451](#L1451) | $new\_settings = str\_replace('[new\_line]', "\r\n", $new\_settings); |
| [1452](#L1452) | $new\_settings = str\_replace('[double\_slashes]', "\/", $new\_settings); |
| [1453](#L1453) | $new\_settings = str\_replace('[quotation]', '"', $new\_settings); |
| [1454](#L1454) | $new\_settings = str\_replace('[o\_cb]', '{', $new\_settings); |
| [1455](#L1455) | $new\_settings = str\_replace('[c\_cb]', '}', $new\_settings); |
| [1456](#L1456) |  |
| [1457](#L1457) | update\_option($this->settings\_menu['name'], $new\_settings); |
| [1458](#L1458) |  |
| [1459](#L1459) | //      if ( !count( get\_settings\_errors() ) ) |
| [1460](#L1460) | //      add\_settings\_error('general', 'settings\_imported', \_\_('Settings Imported.'), 'updated'); |
| [1461](#L1461) | //      set\_transient('settings\_errors', get\_settings\_errors(), 30); |
| [1462](#L1462) |  |
| [1463](#L1463) | /\*\* |
| [1464](#L1464) | \* Redirect back to the settings page that was submitted |
| [1465](#L1465) | \*/ |
| [1466](#L1466) | $goback = add\_query\_arg(array('settings-imported' => 'true'), $page\_url); |
| [1467](#L1467) | wp\_redirect($goback); |
| [1468](#L1468) | exit; |
| [1469](#L1469) | } |
| [1470](#L1470) |  |
| [1471](#L1471) |  |
| [1472](#L1472) |  |
| [1473](#L1473) | //check to see if the options were reset |
| [1474](#L1474) | if (isset($\_POST['reset-defaults']) && check\_admin\_referer($this->settings\_menu['name'] . '-options')) { |
| [1475](#L1475) |  |
| [1476](#L1476) | // foreach ($this->settings\_sections as $section) |
| [1477](#L1477) | delete\_option($this->settings\_menu['name']); |
| [1478](#L1478) | $this->update\_defaults(); |
| [1479](#L1479) |  |
| [1480](#L1480) | do\_action('securityforce\_settings\_api\_reset'); |
| [1481](#L1481) |  |
| [1482](#L1482) | $goback = add\_query\_arg(array('settings-reseted' => 'true'), $page\_url); |
| [1483](#L1483) | wp\_redirect($goback); |
| [1484](#L1484) | exit; |
| [1485](#L1485) | } |
| [1486](#L1486) |  |
| [1487](#L1487) |  |
| [1488](#L1488) | $clean\_options\_page = remove\_query\_arg(array('settings-reseted', 'wrong-number', 'settings-imported'), $page\_url); |
| [1489](#L1489) |  |
| [1490](#L1490) | $\_SERVER['HTTP\_REFERER'] = $clean\_options\_page; |
| [1491](#L1491) | $\_REQUEST['\_wp\_original\_http\_referer'] = $clean\_options\_page; |
| [1492](#L1492) | $\_REQUEST['\_wp\_http\_referer'] = $clean\_options\_page; |
| [1493](#L1493) | } |
| [1494](#L1494) | } |
| [1495](#L1495) |  |
| [1496](#L1496) |  |
| [1497](#L1497) |  |
| [1498](#L1498) |  |
| [1499](#L1499) |  |
| [1500](#L1500) |  |
| [1501](#L1501) |  |
| [1502](#L1502) | public function render\_security\_dashboard\_page() { |
| [1503](#L1503) | wp\_enqueue\_script('securityforce\_charts',SECURITYFORCE\_URL.'/js/chart.min.js'); |
| [1504](#L1504) | global $wpdb; |
| [1505](#L1505) | $setting\_name = $this->settings\_menu['name']; |
| [1506](#L1506) | $settings = get\_option($setting\_name); |
| [1507](#L1507) | $count = 0; |
| [1508](#L1508) | $htaccess = $api\_msg = $tn\_msg = ''; |
| [1509](#L1509) | $hide\_api\_notice = get\_option('securityforce\_remove\_dashboard\_notice\_api'); |
| [1510](#L1510) | $hide\_htaccess\_notice = get\_option('securityforce\_remove\_dashboard\_notice\_htaccess'); |
| [1511](#L1511) | $hide\_sn\_notice = get\_option('securityforce\_remove\_dashboard\_notice\_sn'); |
| [1512](#L1512) | if(isset($settings['full\_hide']) && $settings['full\_hide'] !== 'on' && $hide\_api\_notice != 1){ |
| [1513](#L1513) | $api\_msg = 'Your full hide is disabled, Wappalyzer will detect you are using WordPress.'; |
| [1514](#L1514) | $count = $count + 1; |
| [1515](#L1515) | $show\_api\_msg = true; |
| [1516](#L1516) | } |
| [1517](#L1517) | if(isset($settings['enable\_firewall']) && $settings['enable\_firewall'] !== 'on' && $hide\_sn\_notice != 1){ |
| [1518](#L1518) | $tn\_msg = 'Firewall is disabled, we can not track dangerous IPS.'; |
| [1519](#L1519) | $count = $count + 1; |
| [1520](#L1520) | $show\_sn\_msg = true; |
| [1521](#L1521) | } |
| [1522](#L1522) |  |
| [1523](#L1523) | if(isset($settings['secure\_network']) && $settings['secure\_network'] !== 'on' && $hide\_sn\_notice != 1) { |
| [1524](#L1524) | $tn\_msg = 'Secure Network is disabled, we can not fetch dangerous IPS.'; |
| [1525](#L1525) | $count = $count + 1; |
| [1526](#L1526) | $show\_sn\_msg = true; |
| [1527](#L1527) | } |
| [1528](#L1528) |  |
| [1529](#L1529) | $filename = ABSPATH . '.htaccess'; |
| [1530](#L1530) | if(!is\_writable($filename) && $hide\_htaccess\_notice != 1){ |
| [1531](#L1531) | $htaccess = 'Plugin is not able to write .htaccess file, Please make it writable.'; |
| [1532](#L1532) | $count = $count + 1; |
| [1533](#L1533) | $show\_htaccess\_msg = true; |
| [1534](#L1534) | } |
| [1535](#L1535) | ?> |
| [1536](#L1536) | <style> |
| [1537](#L1537) | .securityforce-loader{ |
| [1538](#L1538) | background-image: url('<?php echo home\_url() . '/wp-admin/images/spinner-2x.gif'; ?>'); |
| [1539](#L1539) | } |
| [1540](#L1540) | .securityforce-loader{ |
| [1541](#L1541) | position: absolute; |
| [1542](#L1542) | background-color: rgba(255,255,255,0.5); |
| [1543](#L1543) | top: 0px; |
| [1544](#L1544) | left: 2%; |
| [1545](#L1545) | right: 0; |
| [1546](#L1546) | bottom: 0; |
| [1547](#L1547) | width: 96%; |
| [1548](#L1548) | background-repeat: no-repeat; |
| [1549](#L1549) | background-position: center center; |
| [1550](#L1550) | display: none; |
| [1551](#L1551) | } |
| [1552](#L1552) | .show-fixes-div p:empty{ |
| [1553](#L1553) | display: none; |
| [1554](#L1554) | } |
| [1555](#L1555) | .show-fixes-div p{ |
| [1556](#L1556) | padding: 0 0 20px 0; |
| [1557](#L1557) | margin: 0; |
| [1558](#L1558) | font-size: 16px; |
| [1559](#L1559) | color: red; |
| [1560](#L1560) | } |
| [1561](#L1561) | .hndle.ui-sortable-handle{ |
| [1562](#L1562) | cursor: auto !important; |
| [1563](#L1563) | } |
| [1564](#L1564) | #dashboard-widgets-wrap{ |
| [1565](#L1565) | margin: 0 !important; |
| [1566](#L1566) | } |
| [1567](#L1567) | #dashboard\_last10\_instru .table.widefat{ |
| [1568](#L1568) | table-layout: fixed; |
| [1569](#L1569) | } |
| [1570](#L1570) | .securityforce-dashboard-badge { |
| [1571](#L1571) | display: inline-block; |
| [1572](#L1572) | min-width: 10px; |
| [1573](#L1573) | padding: 3px 7px; |
| [1574](#L1574) | margin-left: 0.5rem; |
| [1575](#L1575) | font-size: 12px; |
| [1576](#L1576) | font-weight: bold; |
| [1577](#L1577) | color: #fff; |
| [1578](#L1578) | line-height: 1; |
| [1579](#L1579) | vertical-align: middle; |
| [1580](#L1580) | white-space: nowrap; |
| [1581](#L1581) | text-align: center; |
| [1582](#L1582) | background-color: #fcb214; |
| [1583](#L1583) | border-radius: 10px; |
| [1584](#L1584) | } |
| [1585](#L1585) | .securityforce-dashboard-notification { |
| [1586](#L1586) | border-left: 4px solid #fcb214; |
| [1587](#L1587) | background-color: #f9f9f9; |
| [1588](#L1588) | min-height: 44px; |
| [1589](#L1589) | padding: 0 1rem; |
| [1590](#L1590) | margin: 0; |
| [1591](#L1591) | border-top: 1px solid #eeeeee; |
| [1592](#L1592) | box-sizing: border-box; |
| [1593](#L1593) | display: flex; |
| [1594](#L1594) | align-items: center; |
| [1595](#L1595) | justify-content: space-between; |
| [1596](#L1596) | } |
| [1597](#L1597) | .securityforce-notice-dismiss { |
| [1598](#L1598) | border: none; |
| [1599](#L1599) | margin: 0; |
| [1600](#L1600) | padding: 9px; |
| [1601](#L1601) | background: 0 0; |
| [1602](#L1602) | color: #72777c; |
| [1603](#L1603) | cursor: pointer; |
| [1604](#L1604) | } |
| [1605](#L1605) | .securityforce-notice-dismiss:before { |
| [1606](#L1606) | background: 0 0; |
| [1607](#L1607) | color: #525355; |
| [1608](#L1608) | content: "\f153"; |
| [1609](#L1609) | display: block; |
| [1610](#L1610) | font: normal 16px/20px dashicons; |
| [1611](#L1611) | speak: none; |
| [1612](#L1612) | height: 20px; |
| [1613](#L1613) | text-align: center; |
| [1614](#L1614) | width: 20px; |
| [1615](#L1615) | -webkit-font-smoothing: antialiased; |
| [1616](#L1616) | } |
| [1617](#L1617) | @media (min-width: 768px){ |
| [1618](#L1618) | #dashboard-widgets .postbox-container { |
| [1619](#L1619) | width: 350px; |
| [1620](#L1620) | } |
| [1621](#L1621) | } |
| [1622](#L1622) | @media (min-width: 992px){ |
| [1623](#L1623) | #dashboard-widgets .postbox-container { |
| [1624](#L1624) | width: 450px; |
| [1625](#L1625) | } |
| [1626](#L1626) | } |
| [1627](#L1627) |  |
| [1628](#L1628) | @media (min-width: 1200px){ |
| [1629](#L1629) | #dashboard-widgets .postbox-container { |
| [1630](#L1630) | width: 550px; |
| [1631](#L1631) | } |
| [1632](#L1632) | } |
| [1633](#L1633) |  |
| [1634](#L1634) | </style> |
| [1635](#L1635) | <div class="js"> |
| [1636](#L1636) | <div class="wrap"> |
| [1637](#L1637) | <h1><?php \_e('Dashboard', 'security\_force'); ?></h1> |
| [1638](#L1638) |  |
| [1639](#L1639) | <?php |
| [1640](#L1640) | //Weekly ids data |
| [1641](#L1641) | $now = new DateTime( "6 days ago", new DateTimeZone('America/New\_York')); |
| [1642](#L1642) | $interval = new DateInterval( 'P1D'); // 1 Day interval |
| [1643](#L1643) | $period = new DatePeriod( $now, $interval, 6); // 7 Days |
| [1644](#L1644) | $sale\_data = array(); |
| [1645](#L1645) | foreach( $period as $day) { |
| [1646](#L1646) | $key = $day->format( 'd M Y'); |
| [1647](#L1647) | $key\_1 = $day->format( 'Y-m-d'); |
| [1648](#L1648) | $data\_r = $wpdb->get\_row("SELECT COUNT(\*) cnt FROM " . $wpdb->prefix . "securityforce\_ab\_attacks WHERE date(created) = '". $key\_1 ."'"); |
| [1649](#L1649) | $sale\_data[ $key ] = $data\_r->cnt; |
| [1650](#L1650) | } |
| [1651](#L1651) | $total\_firewall\_phpidsblock = 0; |
| [1652](#L1652) | foreach ($sale\_data as $key => $value) { |
| [1653](#L1653) | $total\_firewall\_phpidsblock = $total\_firewall\_phpidsblock + $value; |
| [1654](#L1654) | } |
| [1655](#L1655) | //Weekly IP data |
| [1656](#L1656) | $sale\_data\_ip = array(); |
| [1657](#L1657) | foreach( $period as $day) { |
| [1658](#L1658) | $key = $day->format( 'd M Y'); |
| [1659](#L1659) | $key\_1 = $day->format( 'Y-m-d'); |
| [1660](#L1660) | $data\_r = $wpdb->get\_row("SELECT COUNT(\*) cnt FROM " . $wpdb->prefix . "securityforce\_blocked\_ips WHERE date(created) = '". $key\_1 ."'"); |
| [1661](#L1661) | $sale\_data\_ip[ $key ] = $data\_r->cnt; |
| [1662](#L1662) | } |
| [1663](#L1663) | $total\_ips\_block = 0; |
| [1664](#L1664) | foreach ($sale\_data\_ip as $key => $value) { |
| [1665](#L1665) | $total\_ips\_block = $total\_ips\_block + $value; |
| [1666](#L1666) | } |
| [1667](#L1667) | ?> |
| [1668](#L1668) | <div id="dashboard-widgets-wrap"> |
| [1669](#L1669) | <div id="dashboard-widgets" class="metabox-holder"> |
| [1670](#L1670) | <div id="postbox-container-1" class="postbox-container"> |
| [1671](#L1671) | <div class="filter-div" style="height: 30px; width: 100%; display: inline-block;"> |
| [1672](#L1672) | </div> |
| [1673](#L1673) | <div id="normal-sortables" class="meta-box-sortables ui-sortable"> |
| [1674](#L1674) | <?php |
| [1675](#L1675) | $hide\_api\_notice = get\_option('securityforce\_remove\_dashboard\_notice\_api'); |
| [1676](#L1676) | $hide\_htaccess\_notice = get\_option('securityforce\_remove\_dashboard\_notice\_htaccess'); |
| [1677](#L1677) | $hide\_sn\_notice = get\_option('securityforce\_remove\_dashboard\_notice\_sn'); |
| [1678](#L1678) | $show\_api\_msg = ($api\_msg != '' && $hide\_api\_notice != 1); |
| [1679](#L1679) | $show\_htaccess\_msg = ($htaccess != '' && $hide\_htaccess\_notice != 1); |
| [1680](#L1680) | $show\_sn\_msg = ($tn\_msg != '' && $hide\_sn\_notice != 1); |
| [1681](#L1681) | if($show\_api\_msg || $show\_htaccess\_msg || $show\_sn\_msg){ ?> |
| [1682](#L1682) | <div id="dashboard\_notices" class="postbox"> |
| [1683](#L1683) | <button type="button" class="handlediv" aria-expanded="true"> |
| [1684](#L1684) | <span class="screen-reader-text">Toggle panel: At a Glance</span> |
| [1685](#L1685) | <span class="toggle-indicator" aria-hidden="true"></span> |
| [1686](#L1686) | </button> |
| [1687](#L1687) | <h2 class="hndle ui-sortable-handle"><strong>Notifications</strong> <span class="securityforce-dashboard-badge" id="securityforce-not-counter"><?php echo $count; ?></span></h2> |
| [1688](#L1688) | <div class="inside"> |
| [1689](#L1689) | <div class="main"> |
| [1690](#L1690) | <div class="securityforce-loader"></div> |
| [1691](#L1691) | <ul> |
| [1692](#L1692) | <?php echo $show\_api\_msg ? '<li class="securityforce-dashboard-notification">'.$api\_msg.'<button type="button" data-type="api" class="securityforce-notice-dismiss securityforce-dash-notice"><span class="screen-reader-text">Dismiss this notice.</span></button></li>' : ''; ?> |
| [1693](#L1693) | <?php echo $show\_htaccess\_msg ? '<li class="securityforce-dashboard-notification">'.$htaccess.'<button type="button" data-type="htaccess" class="securityforce-notice-dismiss securityforce-dash-notice"><span class="screen-reader-text">Dismiss this notice.</span></button></li>' : ''; ?> |
| [1694](#L1694) | <?php echo $show\_sn\_msg ? '<li class="securityforce-dashboard-notification">'.$tn\_msg.'<button type="button" data-type="tn" class="securityforce-notice-dismiss securityforce-dash-notice"><span class="screen-reader-text">Dismiss this notice.</span></button></li>' : ''; ?> |
| [1695](#L1695) | </ul> |
| [1696](#L1696) |  |
| [1697](#L1697) | </div> |
| [1698](#L1698) | </div> |
| [1699](#L1699) | </div> |
| [1700](#L1700) | <?php } ?> |
| [1701](#L1701) | <div id="dashboard\_right\_now" class="postbox"> |
| [1702](#L1702) | <button type="button" class="handlediv" aria-expanded="true"><span class="screen-reader-text">Toggle panel: At a Glance</span><span class="toggle-indicator" aria-hidden="true"></span></button><h2 class="hndle ui-sortable-handle"><span>Attacks blocked</span></h2> |
| [1703](#L1703) | <div class="inside"> |
| [1704](#L1704) | <div class="main"> |
| [1705](#L1705) | <div class="securityforce-loader"></div> |
| [1706](#L1706) | <h2><?php echo $total\_firewall\_phpidsblock; ?></h2> |
| [1707](#L1707) | <p id="wp-version-message" style="display: inline-block; width: 100%;"> |
| [1708](#L1708) | <a href="<?php echo admin\_url('admin.php?page=pro-options'); ?>" class="button" aria-describedby="wp-version">See More >></a> |
| [1709](#L1709) | </p> |
| [1710](#L1710) | </div> |
| [1711](#L1711) | </div> |
| [1712](#L1712) | </div> |
| [1713](#L1713) |  |
| [1714](#L1714) | <div id="dashboard\_top10\_intru" class="postbox" style="display: block;"> |
| [1715](#L1715) | <button type="button" class="handlediv" aria-expanded="true"> |
| [1716](#L1716) | <span class="screen-reader-text">Toggle panel: At a Glance</span> |
| [1717](#L1717) | <span class="toggle-indicator" aria-hidden="true"></span> |
| [1718](#L1718) | </button> |
| [1719](#L1719) | <h2 class="hndle ui-sortable-handle" style="font-size: 14px;padding-bottom: 9px;padding-left: 10px;"> |
| [1720](#L1720) | <span>Top 10 Attacks blocked</span> |
| [1721](#L1721) | </h2> |
| [1722](#L1722) | <div class="inside"> |
| [1723](#L1723) | <div class="main"> |
| [1724](#L1724) | <div class="securityforce-loader"></div> |
| [1725](#L1725) | <script type="text/javascript"> |
| [1726](#L1726) | var config = { |
| [1727](#L1727) | type: 'line', |
| [1728](#L1728) | data: { |
| [1729](#L1729) | labels: [ |
| [1730](#L1730) | <?php |
| [1731](#L1731) | foreach ($sale\_data as $key => $value) { |
| [1732](#L1732) | echo "'". $key ."',"; |
| [1733](#L1733) | } |
| [1734](#L1734) | ?> |
| [1735](#L1735) | ], |
| [1736](#L1736) | datasets: [{ |
| [1737](#L1737) | label: 'Firewall Attack Blocked', |
| [1738](#L1738) | backgroundColor: 'rgb(23,235,81)', |
| [1739](#L1739) | borderColor: 'rgb(23,235,81)', |
| [1740](#L1740) | data: [ |
| [1741](#L1741) | <?php |
| [1742](#L1742) | foreach ($sale\_data as $key => $value) { |
| [1743](#L1743) | echo $value . ', '; |
| [1744](#L1744) | } |
| [1745](#L1745) | ?> |
| [1746](#L1746) | ], |
| [1747](#L1747) | fill: false, |
| [1748](#L1748) | }] |
| [1749](#L1749) | }, |
| [1750](#L1750) | options: { |
| [1751](#L1751) | responsive: true, |
| [1752](#L1752) | title: { |
| [1753](#L1753) | display: true, |
| [1754](#L1754) | text: 'Blocked Attack Chart' |
| [1755](#L1755) | }, |
| [1756](#L1756) | tooltips: { |
| [1757](#L1757) | mode: 'index', |
| [1758](#L1758) | intersect: false, |
| [1759](#L1759) | }, |
| [1760](#L1760) | hover: { |
| [1761](#L1761) | mode: 'nearest', |
| [1762](#L1762) | intersect: true |
| [1763](#L1763) | }, |
| [1764](#L1764) | scales: { |
| [1765](#L1765) | xAxes: [{ |
| [1766](#L1766) | display: true, |
| [1767](#L1767) | scaleLabel: { |
| [1768](#L1768) | display: true, |
| [1769](#L1769) | labelString: 'Date' |
| [1770](#L1770) | } |
| [1771](#L1771) | }], |
| [1772](#L1772) | yAxes: [{ |
| [1773](#L1773) | display: true, |
| [1774](#L1774) | scaleLabel: { |
| [1775](#L1775) | display: true, |
| [1776](#L1776) | labelString: 'Attack Blocked' |
| [1777](#L1777) | }, |
| [1778](#L1778) | ticks: { |
| [1779](#L1779) | beginAtZero:true |
| [1780](#L1780) | } |
| [1781](#L1781) | }] |
| [1782](#L1782) | } |
| [1783](#L1783) | } |
| [1784](#L1784) | }; |
| [1785](#L1785) | </script> |
| [1786](#L1786) | <canvas id="buyers" width="600" height="400"></canvas> |
| [1787](#L1787) | </div> |
| [1788](#L1788) | </div> |
| [1789](#L1789) | </div> |
| [1790](#L1790) | <div id="dashboard\_last10\_instru" class="postbox"> |
| [1791](#L1791) | <button type="button" class="handlediv" aria-expanded="true"><span class="screen-reader-text">Toggle panel: At a Glance</span><span class="toggle-indicator" aria-hidden="true"></span></button><h2 class="hndle ui-sortable-handle" style="font-size: 14px;padding-bottom: 9px;padding-left: 10px;"><span>Last 10 Firewall blocked attack</span></h2> |
| [1792](#L1792) | <div class="inside"> |
| [1793](#L1793) | <div class="main"> |
| [1794](#L1794) | <table class="table widefat"> |
| [1795](#L1795) | <?php |
| [1796](#L1796) | $ids\_blocked\_ips = $wpdb->get\_results('SELECT \* FROM ' . $wpdb->prefix . 'securityforce\_ab\_attacks ORDER BY id DESC LIMIT 0, 10'); |
| [1797](#L1797) | ?> |
| [1798](#L1798) | <thead> |
| [1799](#L1799) | <tr> |
| [1800](#L1800) | <th>Name</th> |
| [1801](#L1801) | <th>Value</th> |
| [1802](#L1802) | <th>Impact / Total</th> |
| [1803](#L1803) | <th>IP</th> |
| [1804](#L1804) | <th>Date</th> |
| [1805](#L1805) | </tr> |
| [1806](#L1806) | </thead> |
| [1807](#L1807) | <tbody> |
| [1808](#L1808) | <?php |
| [1809](#L1809) | if(!empty($ids\_blocked\_ips)){ |
| [1810](#L1810) | foreach ($ids\_blocked\_ips as $key => $single\_arr) { |
| [1811](#L1811) | ?> |
| [1812](#L1812) | <tr> |
| [1813](#L1813) | <td><strong><?php echo sanitize\_title($single\_arr->name); ?></strong></td> |
| [1814](#L1814) | <td><?php |
| [1815](#L1815) | $allowed = array( |
| [1816](#L1816) | 'a' => array( |
| [1817](#L1817) | 'href' => array(), |
| [1818](#L1818) | 'title' => array() |
| [1819](#L1819) | ), |
| [1820](#L1820) | 'br' => array(), |
| [1821](#L1821) | 'em' => array(), |
| [1822](#L1822) | 'strong' => array() |
| [1823](#L1823) | ); |
| [1824](#L1824) | $v = wp\_kses(esc\_attr( $single\_arr->value ), $allowed); |
| [1825](#L1825) | echo $v; |
| [1826](#L1826) | ?></td> |
| [1827](#L1827) | <td><?php echo esc\_html( $single\_arr->impact )  .' / '. $single\_arr->total\_impact; ?></td> |
| [1828](#L1828) | <td><?php echo sanitize\_text\_field( $single\_arr->ip ); ?></td> |
| [1829](#L1829) | <td><?php echo date( "M d Y", strtotime( $single\_arr->created ) ); ?></td> |
| [1830](#L1830) | </tr> |
| [1831](#L1831) | <?php |
| [1832](#L1832) | } |
| [1833](#L1833) | }else{ ?> |
| [1834](#L1834) | <tr> |
| [1835](#L1835) | <td colspan="5">No result found.</td> |
| [1836](#L1836) | </tr> |
| [1837](#L1837) | <?php } |
| [1838](#L1838) | ?> |
| [1839](#L1839) | </tbody> |
| [1840](#L1840) | </table> |
| [1841](#L1841) | </div> |
| [1842](#L1842) | </div> |
| [1843](#L1843) | </div> |
| [1844](#L1844) | </div> |
| [1845](#L1845) | </div> |
| [1846](#L1846) | <div id="postbox-container-2" class="postbox-container" > |
| [1847](#L1847) | <div id="normal-sortables" class="meta-box-sortables ui-sortable"> |
| [1848](#L1848) | <div class="filter-div" style="width: 100%; display: inline-block;"> |
| [1849](#L1849) | <select id="filter\_based\_on\_time" style="float: right;"> |
| [1850](#L1850) | <option value="last-7">Last Week</option> |
| [1851](#L1851) | <option value="this month">This month</option> |
| [1852](#L1852) | <option value="last month">Last month</option> |
| [1853](#L1853) | <option value="this year">This Year</option> |
| [1854](#L1854) | </select> |
| [1855](#L1855) | </div> |
| [1856](#L1856) | <?php if(SECURITYFORCE\_LI): ?> |
| [1857](#L1857) | <div id="dashboard\_right\_now" class="postbox"> |
| [1858](#L1858) |  |
| [1859](#L1859) | <button type="button" class="handlediv" aria-expanded="true"> |
| [1860](#L1860) | <span class="screen-reader-text">Toggle panel: At a Glance</span><span class="toggle-indicator" aria-hidden="true"></span> |
| [1861](#L1861) | </button> |
| [1862](#L1862) | <h2 class="hndle ui-sortable-handle"><span>Blocked by Secure Network</span></h2> |
| [1863](#L1863) | <div class="inside"> |
| [1864](#L1864) | <div class="main"> |
| [1865](#L1865) | <div class="securityforce-loader"></div> |
| [1866](#L1866) | <h2><?php echo $total\_ips\_block; ?></h2> |
| [1867](#L1867) | <p id="wp-version-message" style="display: inline-block; width: 100%;"> |
| [1868](#L1868) | <a href="<?php echo admin\_url('admin.php?page=securityforce\_ab\_attacks') ?>" class="button" aria-describedby="wp-version">See More >></a> |
| [1869](#L1869) | </p> |
| [1870](#L1870) | </div> |
| [1871](#L1871) | </div> |
| [1872](#L1872) | </div> |
| [1873](#L1873) | <?php else: ?> |
| [1874](#L1874) | <div id="dashboard\_right\_now" class="postbox"> |
| [1875](#L1875) |  |
| [1876](#L1876) | <button type="button" class="handlediv" aria-expanded="true"> |
| [1877](#L1877) | <span class="screen-reader-text">Toggle panel: At a Glance</span><span class="toggle-indicator" aria-hidden="true"></span> |
| [1878](#L1878) | </button> |
| [1879](#L1879) | <h2 class="hndle ui-sortable-handle"><span>Premium Protection Disabled</span></h2> |
| [1880](#L1880) | <div class="inside"> |
| [1881](#L1881) | <div class="main"> |
| [1882](#L1882) | <div class="securityforce-loader"></div> |
| [1883](#L1883) | <p style="font-size: 14px;">As a free SecurityForce user, you are currently using the Community version of the Threat Defense. Premium users are protected by <u>Additional Firewall Rules</u>, <u>Malware Signatures</u>, <u>Location Based Locking</u>, <u>Reputation Checks</u> & <u>Secure Network</u>. Upgrade to Premium today to improve your protection.</p> |
| [1884](#L1884) | <div style="margin-top:20px;"> |
| [1885](#L1885) | <a href="https://securityfoce.io" target="\_blank" class="button-primary">UPGRATE TO PREMIUM</a> |
| [1886](#L1886) | &nbsp;&nbsp;<a href="https://securityfoce.io" target="\_blank" class="button-secondary">LEARN MORE</a> |
| [1887](#L1887) | </div> |
| [1888](#L1888) | </div> |
| [1889](#L1889) | </div> |
| [1890](#L1890) | </div> |
| [1891](#L1891) | <?php endif; ?> |
| [1892](#L1892) |  |
| [1893](#L1893) | <div id="dashboard\_top10\_attackers" class="postbox"> |
| [1894](#L1894) | <button type="button" class="handlediv" aria-expanded="true"> |
| [1895](#L1895) | <span class="screen-reader-text">Toggle panel: At a Glance</span> |
| [1896](#L1896) | <span class="toggle-indicator" aria-hidden="true"></span> |
| [1897](#L1897) | </button> |
| [1898](#L1898) | <h2 class="hndle ui-sortable-handle" style="font-size: 14px;padding-bottom: 9px;padding-left: 10px;"> |
| [1899](#L1899) | <span>Top 10 IP attacked blocked</span> |
| [1900](#L1900) | </h2> |
| [1901](#L1901) | <div class="inside"> |
| [1902](#L1902) | <div class="main"> |
| [1903](#L1903) | <div class="securityforce-loader"></div> |
| [1904](#L1904) | <script type="text/javascript"> |
| [1905](#L1905) | var ips\_config = { |
| [1906](#L1906) | type: 'line', |
| [1907](#L1907) | data: { |
| [1908](#L1908) | labels: [ |
| [1909](#L1909) | <?php |
| [1910](#L1910) | foreach ($sale\_data\_ip as $key => $value) { |
| [1911](#L1911) | echo "'". $key ."',"; |
| [1912](#L1912) | } |
| [1913](#L1913) | ?> |
| [1914](#L1914) | ], |
| [1915](#L1915) | datasets: [{ |
| [1916](#L1916) | label: 'IP Attack Blocked', |
| [1917](#L1917) | backgroundColor: 'rgb(23,235,81)', |
| [1918](#L1918) | borderColor: 'rgb(23,235,81)', |
| [1919](#L1919) | data: [ |
| [1920](#L1920) | <?php |
| [1921](#L1921) | foreach ($sale\_data\_ip as $key => $value) { |
| [1922](#L1922) | echo $value . ', '; |
| [1923](#L1923) | } |
| [1924](#L1924) | ?> |
| [1925](#L1925) | ], |
| [1926](#L1926) | fill: false, |
| [1927](#L1927) | }] |
| [1928](#L1928) | }, |
| [1929](#L1929) | options: { |
| [1930](#L1930) | responsive: true, |
| [1931](#L1931) | title: { |
| [1932](#L1932) | display: true, |
| [1933](#L1933) | text: 'IP Blocked Attack Chart' |
| [1934](#L1934) | }, |
| [1935](#L1935) | tooltips: { |
| [1936](#L1936) | mode: 'index', |
| [1937](#L1937) | intersect: false, |
| [1938](#L1938) | }, |
| [1939](#L1939) | hover: { |
| [1940](#L1940) | mode: 'nearest', |
| [1941](#L1941) | intersect: true |
| [1942](#L1942) | }, |
| [1943](#L1943) | scales: { |
| [1944](#L1944) | xAxes: [{ |
| [1945](#L1945) | display: true, |
| [1946](#L1946) | scaleLabel: { |
| [1947](#L1947) | display: true, |
| [1948](#L1948) | labelString: 'Date' |
| [1949](#L1949) | } |
| [1950](#L1950) | }], |
| [1951](#L1951) | yAxes: [{ |
| [1952](#L1952) | display: true, |
| [1953](#L1953) | scaleLabel: { |
| [1954](#L1954) | display: true, |
| [1955](#L1955) | labelString: 'Attack Blocked' |
| [1956](#L1956) | }, |
| [1957](#L1957) | ticks: { |
| [1958](#L1958) | beginAtZero:true |
| [1959](#L1959) | } |
| [1960](#L1960) | }] |
| [1961](#L1961) | } |
| [1962](#L1962) | } |
| [1963](#L1963) | }; |
| [1964](#L1964) |  |
| [1965](#L1965) | window.onload = function () { |
| [1966](#L1966) | //Ip chart |
| [1967](#L1967) | var ips\_ctx = document.getElementById('securityforce\_ips\_blocked').getContext('2d'); |
| [1968](#L1968) | var ips\_chart = new Chart(ips\_ctx, ips\_config); |
| [1969](#L1969) |  |
| [1970](#L1970) | //Firewall chart |
| [1971](#L1971) | var ctx = document.getElementById('buyers').getContext('2d'); |
| [1972](#L1972) | var myChart = new Chart(ctx, config); |
| [1973](#L1973) |  |
| [1974](#L1974) | jQuery('#filter\_based\_on\_time').change(function(){ |
| [1975](#L1975) | jQuery('.securityforce-loader').show(); |
| [1976](#L1976) | jQuery.ajax({ |
| [1977](#L1977) | url: ajaxurl, |
| [1978](#L1978) | data: { |
| [1979](#L1979) | "action": "securityforce\_get\_firewall\_phpidsdata", |
| [1980](#L1980) | "call\_type": jQuery(this).val(), |
| [1981](#L1981) | "attack\_type": 'IPS' |
| [1982](#L1982) | }, |
| [1983](#L1983) | type: "POST", |
| [1984](#L1984) | success: function (data) { |
| [1985](#L1985) | var obj = JSON.parse(data); |
| [1986](#L1986) | ips\_chart.data.labels = []; |
| [1987](#L1987) | ips\_chart.data.datasets[0].data = []; |
| [1988](#L1988) | var total\_ips\_cnt = 0; |
| [1989](#L1989) | jQuery.each(obj, function(key, value){ |
| [1990](#L1990) | ips\_chart.data.labels.push(value['x']); |
| [1991](#L1991) | ips\_chart.data.datasets[0].data.push(value['y']); |
| [1992](#L1992) | total\_ips\_cnt = total\_ips\_cnt + parseInt(value['y']); |
| [1993](#L1993) | }); |
| [1994](#L1994) | ips\_chart.update(); |
| [1995](#L1995) | jQuery('#postbox-container-3').find('.inside h2').text('').text(total\_ips\_cnt); |
| [1996](#L1996) | jQuery('#postbox-container-3').find('.securityforce-loader').hide(); |
| [1997](#L1997) | jQuery('#ips\_blocked\_chart').find('.securityforce-loader').hide(); |
| [1998](#L1998) | } |
| [1999](#L1999) | }); |
| [2000](#L2000) |  |
| [2001](#L2001) | jQuery.ajax({ |
| [2002](#L2002) | url: ajaxurl, |
| [2003](#L2003) | data: { |
| [2004](#L2004) | "action": "securityforce\_get\_firewall\_phpidsdata", |
| [2005](#L2005) | "call\_type": jQuery(this).val(), |
| [2006](#L2006) | }, |
| [2007](#L2007) | type: "POST", |
| [2008](#L2008) | success: function (data) { |
| [2009](#L2009) | var obj = JSON.parse(data); |
| [2010](#L2010) | myChart.data.labels = []; |
| [2011](#L2011) | myChart.data.datasets[0].data = []; |
| [2012](#L2012) | var total\_firewall\_phpidscnt = 0; |
| [2013](#L2013) | jQuery.each(obj, function(key, value){ |
| [2014](#L2014) | myChart.data.labels.push(value['x']); |
| [2015](#L2015) | myChart.data.datasets[0].data.push(value['y']); |
| [2016](#L2016) | total\_firewall\_phpidscnt = total\_firewall\_phpidscnt + parseInt(value['y']); |
| [2017](#L2017) | }); |
| [2018](#L2018) | myChart.update(); |
| [2019](#L2019) | jQuery('#postbox-container-2').find('.inside h2').text('').text(total\_firewall\_phpidscnt); |
| [2020](#L2020) | jQuery('#postbox-container-2').find('.securityforce-loader').hide(); |
| [2021](#L2021) | jQuery('#ids\_blocked\_chart').find('.securityforce-loader').hide(); |
| [2022](#L2022) | //Remove this code |
| [2023](#L2023) | jQuery('.securityforce-loader').hide(); |
| [2024](#L2024) | } |
| [2025](#L2025) | }); |
| [2026](#L2026) | }); |
| [2027](#L2027) |  |
| [2028](#L2028) | jQuery('.show-fixes-button').click(function(e){ |
| [2029](#L2029) | e.preventDefault(); |
| [2030](#L2030) | if(jQuery('.show-fixes-div').is(":visible")){ |
| [2031](#L2031) | jQuery('.show-fixes-div').slideUp(); |
| [2032](#L2032) | jQuery('.show-fixes-button').text('').text('Show Fixes'); |
| [2033](#L2033) | }else{ |
| [2034](#L2034) | jQuery('.show-fixes-button').text('').text('Hide Fixes'); |
| [2035](#L2035) | jQuery('.show-fixes-div').slideDown(); |
| [2036](#L2036) | } |
| [2037](#L2037) | }); |
| [2038](#L2038) |  |
| [2039](#L2039) | jQuery('.securityforce-dash-notice').click(function (e){ |
| [2040](#L2040) | e.preventDefault(); |
| [2041](#L2041) | var btn = jQuery(this); |
| [2042](#L2042) | jQuery.ajax({ |
| [2043](#L2043) | url: ajaxurl, |
| [2044](#L2044) | data: { |
| [2045](#L2045) | "action": "securityforce\_remove\_dashboard\_notice", |
| [2046](#L2046) | "type": btn.data('type') |
| [2047](#L2047) | }, |
| [2048](#L2048) | type: "POST", |
| [2049](#L2049) | success: function (data) { |
| [2050](#L2050) | btn.closest('li').slideUp(); |
| [2051](#L2051) | var c = +jQuery('#securityforce-not-counter').text(); |
| [2052](#L2052) | if(c == 1) { |
| [2053](#L2053) | jQuery('#dashboard\_notices').slideUp(); |
| [2054](#L2054) | } else { |
| [2055](#L2055) | jQuery('#securityforce-not-counter').text(--c) |
| [2056](#L2056) | } |
| [2057](#L2057) | } |
| [2058](#L2058) | }); |
| [2059](#L2059) | }); |
| [2060](#L2060) | } |
| [2061](#L2061) | </script> |
| [2062](#L2062) | <canvas id="securityforce\_ips\_blocked" width="600" height="400"></canvas> |
| [2063](#L2063) | </div> |
| [2064](#L2064) | </div> |
| [2065](#L2065) | </div> |
| [2066](#L2066) | <div id="dashboard\_last10\_attackers" class="postbox" > |
| [2067](#L2067) | <button type="button" class="handlediv" aria-expanded="true"><span class="screen-reader-text">Toggle panel: At a Glance</span><span class="toggle-indicator" aria-hidden="true"></span></button><h2 class="hndle ui-sortable-handle" style="font-size: 14px;padding-bottom: 9px;padding-left: 10px;"><span>Top 10 IP addresses blocked</span></h2> |
| [2068](#L2068) | <div class="inside"> |
| [2069](#L2069) | <div class="main"> |
| [2070](#L2070) | <?php |
| [2071](#L2071) | $ips\_arr = $wpdb->get\_results('SELECT \* FROM ' . $wpdb->prefix . 'securityforce\_blocked\_ips ORDER BY id DESC LIMIT 0, 10'); |
| [2072](#L2072) | ?> |
| [2073](#L2073) | <table class="table widefat"> |
| [2074](#L2074) | <thead> |
| [2075](#L2075) | <tr> |
| [2076](#L2076) | <th>IP</th> |
| [2077](#L2077) | <th>Date</th> |
| [2078](#L2078) | </tr> |
| [2079](#L2079) | </thead> |
| [2080](#L2080) | <tbody> |
| [2081](#L2081) | <?php |
| [2082](#L2082) | if(!empty($ips\_arr)){ |
| [2083](#L2083) | foreach ($ips\_arr as $key => $ips\_single\_arr) { ?> |
| [2084](#L2084) | <tr> |
| [2085](#L2085) | <td><?php echo $ips\_single\_arr->ip; ?></td> |
| [2086](#L2086) | <td><?php echo date( "M d Y", strtotime( $ips\_single\_arr->created ) ); ?></td> |
| [2087](#L2087) | </tr> |
| [2088](#L2088) | <?php |
| [2089](#L2089) | } |
| [2090](#L2090) | } else { ?> |
| [2091](#L2091) | <tr> |
| [2092](#L2092) | <td colspan="2">No result found.</td> |
| [2093](#L2093) | </tr> |
| [2094](#L2094) | <?php } |
| [2095](#L2095) | ?> |
| [2096](#L2096) | </tbody> |
| [2097](#L2097) | </table> |
| [2098](#L2098) | </div> |
| [2099](#L2099) | </div> |
| [2100](#L2100) | </div> |
| [2101](#L2101) | </div> |
| [2102](#L2102) | </div> <!-- postbox-2 --> |
| [2103](#L2103) | </div> |
| [2104](#L2104) | </div> |
| [2105](#L2105) | </div> |
| [2106](#L2106) |  |
| [2107](#L2107) | <?php |
| [2108](#L2108) | } |
| [2109](#L2109) |  |
| [2110](#L2110) | public function plugin\_actions\_links($links) { |
| [2111](#L2111) | if ($this->settings\_menu['action\_link']) |
| [2112](#L2112) | $links[] = '<a href="' . admin\_url("admin.php?page=" . $this->settings\_menu['name']) . '" >' . |
| [2113](#L2113) | $this->settings\_menu['action\_link'] . '</a>'; |
| [2114](#L2114) | return $links; |
| [2115](#L2115) | } |
| [2116](#L2116) |  |
| [2117](#L2117) | public static function getInstance() { |
| [2118](#L2118) | if (!self::$\_instance) { |
| [2119](#L2119) | self::$\_instance = new WeDevs\_Settings\_API(); |
| [2120](#L2120) | } |
| [2121](#L2121) |  |
| [2122](#L2122) | return self::$\_instance; |
| [2123](#L2123) | } |
| [2124](#L2124) |  |
| [2125](#L2125) | /\*\* |
| [2126](#L2126) | \* Set settings sections |
| [2127](#L2127) | \* |
| [2128](#L2128) | \* @param array $sections setting sections array |
| [2129](#L2129) | \*/ |
| [2130](#L2130) | function set\_sections($sections) { |
| [2131](#L2131) | $this->settings\_sections = $sections; |
| [2132](#L2132) | } |
| [2133](#L2133) |  |
| [2134](#L2134) | /\*\* |
| [2135](#L2135) | \* Set settings fields |
| [2136](#L2136) | \* |
| [2137](#L2137) | \* @param array $fields settings fields array |
| [2138](#L2138) | \*/ |
| [2139](#L2139) | function set\_fields($fields) { |
| [2140](#L2140) | $this->settings\_fields = $fields; |
| [2141](#L2141) | } |
| [2142](#L2142) |  |
| [2143](#L2143) | /\*\* |
| [2144](#L2144) | \* Set settings fields |
| [2145](#L2145) | \* |
| [2146](#L2146) | \* @param array $fields settings fields array |
| [2147](#L2147) | \*/ |
| [2148](#L2148) | function set\_menu($menu) { |
| [2149](#L2149) | $this->settings\_menu = $menu; |
| [2150](#L2150) | } |
| [2151](#L2151) |  |
| [2152](#L2152) | /\*\* |
| [2153](#L2153) | \* Initialize and registers the settings sections and fileds to WordPress |
| [2154](#L2154) | \* |
| [2155](#L2155) | \* Usually this should be called at `admin\_init` hook. |
| [2156](#L2156) | \* |
| [2157](#L2157) | \* This function gets the initiated settings sections and fields. Then |
| [2158](#L2158) | \* registers them to WordPress and ready for use. |
| [2159](#L2159) | \*/ |
| [2160](#L2160) | public function admin\_init() { |
| [2161](#L2161) | //Disable Drag |
| [2162](#L2162) | $pageName = $this->settings\_menu['name'] ?? 'default\_name'; |
| [2163](#L2163) |  |
| [2164](#L2164) | if (isset($\_GET['page']) && $\_GET['page'] == $pageName) { |
| [2165](#L2165) | // This will deregister the 'postbox' script only on the specific admin page |
| [2166](#L2166) | wp\_deregister\_script('postbox'); |
| [2167](#L2167) | } |
| [2168](#L2168) |  |
| [2169](#L2169) |  |
| [2170](#L2170) |  |
| [2171](#L2171) | // if (isset($\_GET['page']) && $\_GET['page'] == 'security\_force\_dashboard' && isset($\_GET['action']) && $\_GET['action'] == 'add\_new') { |
| [2172](#L2172) | //     $this->render\_add\_new\_widget\_page(); |
| [2173](#L2173) | //     return;  // Stop further processing since we're handling the add new widget page |
| [2174](#L2174) | // } |
| [2175](#L2175) |  |
| [2176](#L2176) | $menuName = isset($this->settings\_menu['name']) ? $this->settings\_menu['name'] : 'default\_menu\_name'; |
| [2177](#L2177) | $menuVersion = isset($this->settings\_menu['version']) ? $this->settings\_menu['version'] : 'default\_version'; |
| [2178](#L2178) |  |
| [2179](#L2179) | if (!get\_option($menuName) || !$this->get\_option('db\_ver') || $this->get\_option('db\_ver') < $menuVersion) { |
| [2180](#L2180) | $this->update\_defaults(); |
| [2181](#L2181) | } |
| [2182](#L2182) | //add\_option( $this->settings\_menu['name'] ); |
| [2183](#L2183) | //register settings sections |
| [2184](#L2184) | foreach ($this->settings\_sections as $section) { |
| [2185](#L2185) |  |
| [2186](#L2186) |  |
| [2187](#L2187) | add\_settings\_section($section['id'], $section['title'], '\_\_return\_false', $this->settings\_menu['name']); |
| [2188](#L2188) | } |
| [2189](#L2189) |  |
| [2190](#L2190) | //register settings fields |
| [2191](#L2191) | foreach ($this->settings\_fields as $section => $field) { |
| [2192](#L2192) | foreach ($field as $option) { |
| [2193](#L2193) | $args = array( |
| [2194](#L2194) | 'id' => $option['name'], |
| [2195](#L2195) | 'desc' => $option['desc'], |
| [2196](#L2196) | 'name' => $option['label'], |
| [2197](#L2197) | 'section' => $section, |
| [2198](#L2198) | 'class' => isset($option['class']) ? $option['class'] : null, |
| [2199](#L2199) | 'options' => isset($option['options']) ? $option['options'] : '', |
| [2200](#L2200) | 'std' => isset($option['default']) ? $option['default'] : '' |
| [2201](#L2201) | ); |
| [2202](#L2202) | add\_settings\_field($option['name'], $option['label'], array($this, 'callback\_' . $option['type']), $this->settings\_menu['name'], $section, $args); |
| [2203](#L2203) | } |
| [2204](#L2204) | } |
| [2205](#L2205) |  |
| [2206](#L2206) | // creates our settings in the options table |
| [2207](#L2207) | //foreach ($this->settings\_sections as $section) { |
| [2208](#L2208) | $menuName = $this->settings\_menu['name'] ?? 'default\_settings\_name'; |
| [2209](#L2209) | register\_setting($menuName, $menuName, array(&$this, 'admin\_settings\_validate')); |
| [2210](#L2210) | //} |
| [2211](#L2211) | } |
| [2212](#L2212) |  |
| [2213](#L2213) | // validate our settings |
| [2214](#L2214) |  |
| [2215](#L2215) | function admin\_settings\_validate($input) { |
| [2216](#L2216) |  |
| [2217](#L2217) | do\_action('securityforce\_settings\_api\_validate', $input); |
| [2218](#L2218) |  |
| [2219](#L2219) |  |
| [2220](#L2220) |  |
| [2221](#L2221) | //      if (empty($input['sample\_text'])) { |
| [2222](#L2222) | // |
| [2223](#L2223) | //                add\_settings\_error( |
| [2224](#L2224) | //                    'sample\_text',           // setting title |
| [2225](#L2225) | //                    'sample\_text\_error',            // error ID |
| [2226](#L2226) | //                    'Please enter some sample text',   // error message |
| [2227](#L2227) | //                    'error'                        // type of message |
| [2228](#L2228) | //                ); |
| [2229](#L2229) | // |
| [2230](#L2230) | //       } |
| [2231](#L2231) | return $input; |
| [2232](#L2232) | } |
| [2233](#L2233) |  |
| [2234](#L2234) | /\*\* |
| [2235](#L2235) | \* Displays a text field for a settings field |
| [2236](#L2236) | \* |
| [2237](#L2237) | \* @param array $args settings field args |
| [2238](#L2238) | \*/ |
| [2239](#L2239) | function callback\_text($args) { |
| [2240](#L2240) |  |
| [2241](#L2241) | $value = esc\_attr($this->get\_option($args['id'], $this->settings\_menu['name'])); |
| [2242](#L2242) | // $class = isset( $args['class'] ) && !is\_null( $args['class'] ) ? $args['class'] : 'regular'; |
| [2243](#L2243) |  |
| [2244](#L2244) | $html = sprintf('<input type="text" class="regular-text %1$s" id="%4$s" name="%2$s[%4$s]" value="%5$s"/>', $args['class'], $this->settings\_menu['name'], $args['section'], $args['id'], $value); |
| [2245](#L2245) | $html .= '<span class="securityforce-help"><span class="securityforce-help-icon"></span><span class="securityforce-help-text">'.$args['desc'].'</span></span>'; |
| [2246](#L2246) |  |
| [2247](#L2247) | echo $html; |
| [2248](#L2248) | } |
| [2249](#L2249) |  |
| [2250](#L2250) | function callback\_number($args) { |
| [2251](#L2251) |  |
| [2252](#L2252) | $value = esc\_attr($this->get\_option($args['id'], $this->settings\_menu['name'])); |
| [2253](#L2253) | // $class = isset( $args['class'] ) && !is\_null( $args['class'] ) ? $args['class'] : 'regular'; |
| [2254](#L2254) |  |
| [2255](#L2255) | $html = sprintf('<input type="text" class="regular-number %1$s" id="%4$s" name="%2$s[%4$s]" value="%5$s" style="width:50px;"/>', $args['class'], $this->settings\_menu['name'], $args['section'], $args['id'], $value); |
| [2256](#L2256) | $html .= '<span class="securityforce-help"><span class="securityforce-help-icon"></span><span class="securityforce-help-text">'.$args['desc'].'</span></span>'; |
| [2257](#L2257) |  |
| [2258](#L2258) | echo $html; |
| [2259](#L2259) | } |
| [2260](#L2260) |  |
| [2261](#L2261) | function callback\_hidden($args) { |
| [2262](#L2262) | echo '</td></tr><tr valign="top" style="display:none;"><td colspan="2"><span class="' . $args['class'] . '">' . $args['desc'] . '</span>'; |
| [2263](#L2263) | } |
| [2264](#L2264) |  |
| [2265](#L2265) | function callback\_html($args) { |
| [2266](#L2266) | echo '</td></tr><tr valign="top"><td colspan="2"><span class="' . $args['class'] . '">' . $args['desc'] . '</span>'; |
| [2267](#L2267) | } |
| [2268](#L2268) |  |
| [2269](#L2269) | function callback\_custom($args) { |
| [2270](#L2270) | echo '<div class="' . $args['class'] . '">' . $args['desc'] . '</div>'; |
| [2271](#L2271) | } |
| [2272](#L2272) |  |
| [2273](#L2273) | function callback\_wp\_editor($args) { |
| [2274](#L2274) | // $value = esc\_attr( $this->get\_option( $args['id'], $this->settings\_menu['name'], $args['std'] ) ); |
| [2275](#L2275) |  |
| [2276](#L2276) | $value = $this->get\_option($args['id'], $this->settings\_menu['name']); |
| [2277](#L2277) |  |
| [2278](#L2278) | echo wp\_editor($value, $this->settings\_menu['name'] . '\_' . $args['id'], array('textarea\_name' => $this->settings\_menu['name'] . '[' . $args['id'] . ']', 'textarea\_rows' => '5', 'wpautop' => false, 'dfw' => false, 'media\_buttons' => true, 'quicktags' => true, 'tinymce' => true, 'editor\_class' => $args['class'], 'teeny' => false)); |
| [2279](#L2279) | echo sprintf('<span class="description"> %s</span>', $args['desc']); |
| [2280](#L2280) | } |
| [2281](#L2281) |  |
| [2282](#L2282) | function callback\_file($args) { |
| [2283](#L2283) | $value = esc\_attr($this->get\_option($args['id'], $this->settings\_menu['name'])); |
| [2284](#L2284) |  |
| [2285](#L2285) | $html = sprintf('<input type="text" class="regular-text image-upload-url %1$s" id="%3$s" name="%2$s[%3$s]" value="%4$s" />', $args['class'], $this->settings\_menu['name'], $args['id'], $value); |
| [2286](#L2286) | $html .= sprintf('<input id="st\_upload\_button" class="image-upload-button" type="button" name="upload\_button" value="%s" />', \_\_('Select', $this->settings\_menu['name'])); |
| [2287](#L2287) |  |
| [2288](#L2288) | $html .= sprintf('<span class="description"> %s</span>', $args['desc']); |
| [2289](#L2289) |  |
| [2290](#L2290) | echo $html; |
| [2291](#L2291) | } |
| [2292](#L2292) |  |
| [2293](#L2293) | /\*\* |
| [2294](#L2294) | \* Displays a checkbox for a settings field |
| [2295](#L2295) | \* |
| [2296](#L2296) | \* @param array $args settings field args |
| [2297](#L2297) | \*/ |
| [2298](#L2298) | function callback\_checkbox($args) { |
| [2299](#L2299) |  |
| [2300](#L2300) | $value = esc\_attr($this->get\_option($args['id'], $this->settings\_menu['name'])); |
| [2301](#L2301) |  |
| [2302](#L2302) | $html = sprintf('<input type="checkbox" class="checkbox %1$s" id="%3$s" name="%2$s[%3$s]" value="on"%4$s/>', $args['class'], $this->settings\_menu['name'], $args['id'], checked('on', $value, false)); |
| [2303](#L2303) | $html .= '<span class="securityforce-help"><span class="securityforce-help-icon"></span><span class="securityforce-help-text">'.$args['desc'].'</span></span>'; |
| [2304](#L2304) |  |
| [2305](#L2305) | echo $html; |
| [2306](#L2306) | } |
| [2307](#L2307) |  |
| [2308](#L2308) | /\*\* |
| [2309](#L2309) | \* Displays a multicheckbox a settings field |
| [2310](#L2310) | \* |
| [2311](#L2311) | \* @param array $args settings field args |
| [2312](#L2312) | \*/ |
| [2313](#L2313) | function callback\_multicheck($args) { |
| [2314](#L2314) |  |
| [2315](#L2315) | $value = $this->get\_option($args['id'], $this->settings\_menu['name']); |
| [2316](#L2316) |  |
| [2317](#L2317) | if (!$args['options']) |
| [2318](#L2318) | return; |
| [2319](#L2319) | //option name should not be 0 to work correctly with empty option |
| [2320](#L2320) | $html = ''; |
| [2321](#L2321) | foreach ($args['options'] as $key => $label) { |
| [2322](#L2322) | $checked = isset($value[$key]) ? $value[$key] : '0'; |
| [2323](#L2323) | $html .= sprintf('<input type="checkbox" class="checkbox %1$s" id="%3$s\_%4$s" name="%2$s[%3$s][%4$s]" value="%4$s"%5$s />', $args['class'], $this->settings\_menu['name'], $args['id'], $key, checked($checked, $key, false)); |
| [2324](#L2324) | $html .= sprintf('<label for="%2$s\_%4$s"> %3$s</label><br>', $this->settings\_menu['name'], $args['id'], $label, $key); |
| [2325](#L2325) | } |
| [2326](#L2326) | $html .= sprintf('<span class="description"> %s</label>', $args['desc']); |
| [2327](#L2327) |  |
| [2328](#L2328) | echo $html; |
| [2329](#L2329) | } |
| [2330](#L2330) |  |
| [2331](#L2331) | /\*\* |
| [2332](#L2332) | \* Displays a multicheckbox a settings field |
| [2333](#L2333) | \* |
| [2334](#L2334) | \* @param array $args settings field args |
| [2335](#L2335) | \*/ |
| [2336](#L2336) | function callback\_radio($args) { |
| [2337](#L2337) |  |
| [2338](#L2338) | $value = $this->get\_option($args['id'], $this->settings\_menu['name']); |
| [2339](#L2339) |  |
| [2340](#L2340) | $html = '<div class="securityforce-radio">'; |
| [2341](#L2341) | foreach ($args['options'] as $key => $label) { |
| [2342](#L2342) | $html .= sprintf('<input type="radio" class="radio %1$s" id="%3$s\_%4$s" name="%2$s[%3$s]" value="%4$s"%5$s />', $args['class'], $this->settings\_menu['name'], $args['id'], $key, checked($value, $key, false)); |
| [2343](#L2343) | $html .= sprintf('<label for="%2$s\_%4$s"> %3$s</label><br>', $this->settings\_menu['name'], $args['id'], $label, $key); |
| [2344](#L2344) | } |
| [2345](#L2345) | $html .= '</div>'; |
| [2346](#L2346) | $html .= sprintf('<span class="description"> %s</label>', $args['desc']); |
| [2347](#L2347) |  |
| [2348](#L2348) | echo $html; |
| [2349](#L2349) | } |
| [2350](#L2350) |  |
| [2351](#L2351) | /\*\* |
| [2352](#L2352) | \* Displays a selectbox for a settings field |
| [2353](#L2353) | \* |
| [2354](#L2354) | \* @param array $args settings field args |
| [2355](#L2355) | \*/ |
| [2356](#L2356) | function callback\_select($args) { |
| [2357](#L2357) |  |
| [2358](#L2358) |  |
| [2359](#L2359) | $value = esc\_attr($this->get\_option($args['id'], $this->settings\_menu['name'])); |
| [2360](#L2360) | //$class = isset( $args['class'] ) && !is\_null( $args['class'] ) ? $args['class'] : 'regular'; |
| [2361](#L2361) |  |
| [2362](#L2362) | $html = sprintf('<select class="regular pages\_list selectbox %1$s" name="%2$s[%3$s]" id="%3$s">', $args['class'], $this->settings\_menu['name'], $args['id']); |
| [2363](#L2363) | foreach ($args['options'] as $key => $label) { |
| [2364](#L2364) | $html .= sprintf('<option value="%s"%s>%s</option>', $key, selected($value, $key, false), $label); |
| [2365](#L2365) | } |
| [2366](#L2366) | $html .= sprintf('</select>'); |
| [2367](#L2367) | $html .= sprintf('<span class="description"> %s</span>', $args['desc']); |
| [2368](#L2368) |  |
| [2369](#L2369) | echo $html; |
| [2370](#L2370) | } |
| [2371](#L2371) |  |
| [2372](#L2372) | /\*\* |
| [2373](#L2373) | \* Displays a selectbox for a settings field |
| [2374](#L2374) | \* |
| [2375](#L2375) | \* @param array $args settings field args |
| [2376](#L2376) | \*/ |
| [2377](#L2377) | function callback\_rolelist($args) { |
| [2378](#L2378) | global $wp\_roles; |
| [2379](#L2379) |  |
| [2380](#L2380) | if ($wp\_roles->roles) |
| [2381](#L2381) | foreach ($wp\_roles->roles as $key => $val) |
| [2382](#L2382) | if ($key != 'administrator') |
| [2383](#L2383) | $args['options'][$key] = $wp\_roles->roles[$key]['name']; |
| [2384](#L2384) |  |
| [2385](#L2385) | $value = $this->get\_option($args['id'], $this->settings\_menu['name']); |
| [2386](#L2386) | $html = ''; |
| [2387](#L2387) | $html .= '<div class="securityforce-checkbox">'; |
| [2388](#L2388) | foreach ($args['options'] as $key => $label) { |
| [2389](#L2389) | $checked = isset($value[$key]) ? $value[$key] : '0'; |
| [2390](#L2390) |  |
| [2391](#L2391) | $html .= sprintf('<input type="checkbox" class="checkbox user\_roles\_checkbox %1$s" id="%3$s\_%4$s" name="%2$s[%3$s][%4$s]" value="%4$s"%5$s />', $args['class'], $this->settings\_menu['name'], $args['id'], $key, checked($checked, $key, false)); |
| [2392](#L2392) | $html .= sprintf('<label for="%2$s\_%4$s"> %3$s</label><br>', $this->settings\_menu['name'], $args['id'], $label, $key); |
| [2393](#L2393) | } |
| [2394](#L2394) | $html .= '</div>'; |
| [2395](#L2395) | $html .= '<span class="securityforce-help"><span class="securityforce-help-icon"></span><span class="securityforce-help-text">'.$args['desc'].'</span></span>'; |
| [2396](#L2396) |  |
| [2397](#L2397) | echo $html; |
| [2398](#L2398) | } |
| [2399](#L2399) |  |
| [2400](#L2400) | function callback\_pagelist($args) { |
| [2401](#L2401) | $value = esc\_attr($this->get\_option($args['id'], $this->settings\_menu['name'])); |
| [2402](#L2402) | $name = sprintf('%1$s[%2$s]', $this->settings\_menu['name'], $args['id']); |
| [2403](#L2403) |  |
| [2404](#L2404) | $q = array( |
| [2405](#L2405) | 'depth' => 0, 'child\_of' => 0, |
| [2406](#L2406) | 'selected' => $value, 'echo' => 0, |
| [2407](#L2407) | 'name' => $name, 'id' => $args['id'], |
| [2408](#L2408) | 'show\_option\_none' => '', 'show\_option\_no\_change' => '', |
| [2409](#L2409) | 'option\_none\_value' => '' |
| [2410](#L2410) | ); |
| [2411](#L2411) |  |
| [2412](#L2412) | $html = wp\_dropdown\_pages($q); |
| [2413](#L2413) | $html = str\_replace('<select', '<select class="' . $args['class'] . '" ', $html); |
| [2414](#L2414) |  |
| [2415](#L2415) | $html .= sprintf('<span class="description"> %s</span>', $args['desc']); |
| [2416](#L2416) | echo $html; |
| [2417](#L2417) | } |
| [2418](#L2418) |  |
| [2419](#L2419) | /\*\* |
| [2420](#L2420) | \* Displays a textarea for a settings field |
| [2421](#L2421) | \* |
| [2422](#L2422) | \* @param array $args settings field args |
| [2423](#L2423) | \*/ |
| [2424](#L2424) | function callback\_textarea($args) { |
| [2425](#L2425) |  |
| [2426](#L2426) | $value = esc\_textarea($this->get\_option($args['id'], $this->settings\_menu['name'])); |
| [2427](#L2427) | //$class = isset( $args['class'] ) && !is\_null( $args['class'] ) ? $args['class'] : 'regular'; |
| [2428](#L2428) |  |
| [2429](#L2429) | $html = sprintf('<textarea rows="5" cols="65" class="regular-text %1$s" id="%3$s" name="%2$s[%3$s]">%4$s</textarea>', $args['class'], $this->settings\_menu['name'], $args['id'], $value); |
| [2430](#L2430) | $html .= '<span class="securityforce-help"><span class="securityforce-help-icon"></span><span class="securityforce-help-text">'.$args['desc'].'</span></span>'; |
| [2431](#L2431) |  |
| [2432](#L2432) | echo $html; |
| [2433](#L2433) | } |
| [2434](#L2434) |  |
| [2435](#L2435) | function callback\_export($args) { |
| [2436](#L2436) |  |
| [2437](#L2437) | if (isset($\_GET['export\_settings']) && $\_GET['export\_settings']) { |
| [2438](#L2438) |  |
| [2439](#L2439) | $empty\_keys = array\_keys(array\_diff\_key($this->get\_defaults(), get\_option($this->settings\_menu['name']))); |
| [2440](#L2440) | $empty\_keys = array\_fill\_keys($empty\_keys, ''); |
| [2441](#L2441) | $value = get\_option($this->settings\_menu['name']); |
| [2442](#L2442) | $value = str\_replace(array("\r\n", "\n", "\r"), '[new\_line]', $value); |
| [2443](#L2443) | $value = str\_replace("\/", '[double\_slashes]', $value); |
| [2444](#L2444) |  |
| [2445](#L2445) | $value = str\_replace('"', '[quotation]', $value); |
| [2446](#L2446) | $value = str\_replace('{', '[o\_cb]', $value); |
| [2447](#L2447) | $value = str\_replace('}', '[c\_cb]', $value); |
| [2448](#L2448) | //$value = str\_replace('[', '[o\_b]', $value); |
| [2449](#L2449) | //  $value = str\_replace(']', '[c\_b]', $value); |
| [2450](#L2450) |  |
| [2451](#L2451) | $value = esc\_textarea(stripslashes(json\_encode(array\_merge($value, $empty\_keys), JSON\_UNESCAPED\_UNICODE))); |
| [2452](#L2452) |  |
| [2453](#L2453) | //$class = isset( $args['class'] ) && !is\_null( $args['class'] ) ? $args['class'] : 'regular'; |
| [2454](#L2454) | $html = sprintf('<strong> %s </strong><br/>', $args['desc']); |
| [2455](#L2455) | $html .= sprintf('<textarea readonly="readonly" onclick="this.focus();this.select()" rows="5" cols="65" class="regular-text %1$s" id="%2$s" name="%2$s" style="%4$s">%3$s</textarea>', $args['class'], 'export\_field', $value, 'width:95% !important;height:400px !important'); |
| [2456](#L2456) |  |
| [2457](#L2457) |  |
| [2458](#L2458) | echo $html; |
| [2459](#L2459) | } else { |
| [2460](#L2460) | echo '<a href="' . add\_query\_arg(array('export\_settings' => true)) . '" class="button">' . \_\_('Export Current Settings', $this->settings\_menu['name']) . '</a>'; |
| [2461](#L2461) | echo sprintf('<br><span class="description"> %s</span>', $args['desc']); |
| [2462](#L2462) | } |
| [2463](#L2463) | } |
| [2464](#L2464) |  |
| [2465](#L2465) | function callback\_import($args) { |
| [2466](#L2466) | $html = ''; |
| [2467](#L2467) |  |
| [2468](#L2468) | if ($args['options']) { |
| [2469](#L2469) | $html .= sprintf('<select class="regular selectbox %1$s" name="import\_options" id="%3$s">', $args['class'], $this->settings\_menu['name'], $args['id']); |
| [2470](#L2470) |  |
| [2471](#L2471) | $html .= sprintf('<option value="" selected="selected">&#8212; Select Security Level &#8212;</option>'); |
| [2472](#L2472) | foreach ($args['options'] as $key => $settings\_value) |
| [2473](#L2473) | $html .= sprintf('<option value="%s">%s</option>', esc\_textarea(stripslashes($settings\_value)), ucfirst($key)); |
| [2474](#L2474) |  |
| [2475](#L2475) |  |
| [2476](#L2476) | $html .= sprintf('</select>'); |
| [2477](#L2477) | //$html .= '  <a href="'. home\_url() . '/wp-admin/admin.php?page=pro-options' .'" class="button button-primary">Open Wizard</a>'; |
| [2478](#L2478) | $html .= '<br>'; |
| [2479](#L2479) | } |
| [2480](#L2480) |  |
| [2481](#L2481) | //$html .= sprintf('<span class="description">%s</span>', $args['desc']); |
| [2482](#L2482) | $html .= '<br>'; |
| [2483](#L2483) |  |
| [2484](#L2484) | $value = ''; |
| [2485](#L2485) | //$class = isset( $args['class'] ) && !is\_null( $args['class'] ) ? $args['class'] : 'regular'; |
| [2486](#L2486) |  |
| [2487](#L2487) | $html .= sprintf('<textarea style="display: none;" rows="5" cols="65" class="regular-text %1$s" id="%2$s" name="%2$s">%3$s</textarea>', $args['class'], 'import\_field', $value); |
| [2488](#L2488) | // $html .= sprintf( '<br><span class="description"> %s</span>', $args['desc'] ); |
| [2489](#L2489) |  |
| [2490](#L2490) | echo $html; |
| [2491](#L2491) | } |
| [2492](#L2492) |  |
| [2493](#L2493) | function callback\_debug\_report($args) { |
| [2494](#L2494) | global $wp\_version; |
| [2495](#L2495) |  |
| [2496](#L2496) | if (!isset($\_GET['debug\_report'])) { |
| [2497](#L2497) | echo '<a href="' . add\_query\_arg(array('debug\_report' => true)) . '" class="button">' . \_\_('Generate Debug Report', $this->settings\_menu['name']) . '</a>'; |
| [2498](#L2498) | echo sprintf('<br><span class="description"> %s</span>', $args['desc']); |
| [2499](#L2499) | } else { |
| [2500](#L2500) |  |
| [2501](#L2501) | /\* Get from WooCommerce by WooThemes http://woothemes.com  \*/ |
| [2502](#L2502) | $active\_plugins = (array) get\_option('active\_plugins', array()); |
| [2503](#L2503) | if (is\_multisite()) |
| [2504](#L2504) | $active\_plugins = array\_merge($active\_plugins, get\_site\_option('active\_sitewide\_plugins', array())); |
| [2505](#L2505) |  |
| [2506](#L2506) | $active\_plugins = array\_map('strtolower', $active\_plugins); |
| [2507](#L2507) | $securityforce\_plugins = array(); |
| [2508](#L2508) |  |
| [2509](#L2509) | foreach ($active\_plugins as $plugin) { |
| [2510](#L2510) | $plugin\_data = @get\_plugin\_data(WP\_PLUGIN\_DIR . '/' . $plugin); |
| [2511](#L2511) | if (!empty($plugin\_data['Name'])) { |
| [2512](#L2512) | $securityforce\_plugins[] = $plugin\_data['Name'] . ' ' . $plugin\_data['Version'] . ' [' . $plugin\_data['PluginURI'] . "]"; |
| [2513](#L2513) | } |
| [2514](#L2514) | } |
| [2515](#L2515) |  |
| [2516](#L2516) | if ($securityforce\_plugins) |
| [2517](#L2517) | $plugin\_list = implode("\n", $securityforce\_plugins); |
| [2518](#L2518) |  |
| [2519](#L2519) |  |
| [2520](#L2520) | $wp\_info = ( is\_multisite() ) ? 'WPMU ' . $wp\_version : 'WP ' . $wp\_version; |
| [2521](#L2521) | $wp\_debug = ( defined('WP\_DEBUG') && WP\_DEBUG ) ? 'true' : 'false'; |
| [2522](#L2522) | $is\_ssl = ( is\_ssl() ) ? 'true' : 'false'; |
| [2523](#L2523) | $is\_rtl = ( is\_rtl() ) ? 'true' : 'false'; |
| [2524](#L2524) | $fsockopen = ( function\_exists('fsockopen') ) ? 'true' : 'false'; |
| [2525](#L2525) | $curl = ( function\_exists('curl\_init') ) ? 'true' : 'false'; |
| [2526](#L2526) | $max\_upload\_size = (function\_exists('size\_format')) ? size\_format(wp\_max\_upload\_size()) : wp\_convert\_bytes\_to\_hr(wp\_max\_upload\_size()); |
| [2527](#L2527) |  |
| [2528](#L2528) | if (function\_exists('phpversion')) { |
| [2529](#L2529) | $php\_info = phpversion(); |
| [2530](#L2530) | $max\_server\_upload = ini\_get('upload\_max\_filesize'); |
| [2531](#L2531) | $post\_max\_size = ini\_get('post\_max\_size'); |
| [2532](#L2532) | } |
| [2533](#L2533) |  |
| [2534](#L2534) | $empty\_keys = array\_keys(array\_diff\_key($this->get\_defaults(), get\_option($this->settings\_menu['name']))); |
| [2535](#L2535) | $empty\_keys = array\_fill\_keys($empty\_keys, ''); |
| [2536](#L2536) |  |
| [2537](#L2537) | $value = ' |
| [2538](#L2538) | =========================================================== |
| [2539](#L2539) | WP Settings |
| [2540](#L2540) | =========================================================== |
| [2541](#L2541) | WordPress version:      ' . $wp\_info . ' |
| [2542](#L2542) | Home URL:       ' . home\_url() . ' |
| [2543](#L2543) | Site URL:       ' . site\_url() . ' |
| [2544](#L2544) | Is SSL:         ' . $is\_ssl . ' |
| [2545](#L2545) | Is RTL:         ' . $is\_rtl . ' |
| [2546](#L2546) | Permalink:      ' . get\_option('permalink\_structure') . ' |
| [2547](#L2547) |  |
| [2548](#L2548) | ============================================================ |
| [2549](#L2549) | Server Environment |
| [2550](#L2550) | ============================================================ |
| [2551](#L2551) | PHP Version:            ' . $php\_info . ' |
| [2552](#L2552) | Server Software:        ' . $\_SERVER['SERVER\_SOFTWARE'] . ' |
| [2553](#L2553) | WP Max Upload Size: ' . $max\_upload\_size . ' |
| [2554](#L2554) | Server upload\_max\_filesize:     ' . $max\_server\_upload . ' |
| [2555](#L2555) | Server post\_max\_size:   ' . $post\_max\_size . ' |
| [2556](#L2556) | WP Memory Limit:        ' . WP\_MEMORY\_LIMIT . ' |
| [2557](#L2557) | WP Debug Mode:      ' . $wp\_debug . ' |
| [2558](#L2558) | CURL:               ' . $curl . ' |
| [2559](#L2559) | fsockopen:          ' . $fsockopen . ' |
| [2560](#L2560) |  |
| [2561](#L2561) | ============================================================ |
| [2562](#L2562) | Active plugins |
| [2563](#L2563) | ============================================================ |
| [2564](#L2564) | ' . $plugin\_list . ' |
| [2565](#L2565) |  |
| [2566](#L2566) | ============================================================ |
| [2567](#L2567) | Plugin Option |
| [2568](#L2568) | ============================================================ |
| [2569](#L2569) | ' . esc\_textarea(stripslashes(json\_encode(array\_merge(get\_option($this->settings\_menu['name']), $empty\_keys)))) . ' |
| [2570](#L2570) | '; |
| [2571](#L2571) |  |
| [2572](#L2572) |  |
| [2573](#L2573) | $html = sprintf('<textarea readonly="readonly" rows="5" cols="65" style="%4$s" class="%1$s" id="%2$s" name="%2$s">%3$s</textarea>', $args['class'], 'debug\_report', $value, 'width:95% !important;height:400px !important'); |
| [2574](#L2574) | $html .= sprintf('<br><span class="description"> %s</span>', $args['desc']); |
| [2575](#L2575) |  |
| [2576](#L2576) | echo $html; |
| [2577](#L2577) | } |
| [2578](#L2578) | } |
| [2579](#L2579) |  |
| [2580](#L2580) | /\*\* |
| [2581](#L2581) | \* Get the value of a settings field |
| [2582](#L2582) | \* |
| [2583](#L2583) | \* @param string $option settings field name |
| [2584](#L2584) | \* @param string $option\_page the $option\_page name this field belongs to |
| [2585](#L2585) | \* @param string $default default text if it's not found |
| [2586](#L2586) | \* @return string |
| [2587](#L2587) | \*/ |
| [2588](#L2588) | function get\_option($option, $option\_page = '', $\_disabled\_default = '') { |
| [2589](#L2589) | if (!$option\_page) |
| [2590](#L2590) | $option\_page = $this->settings\_menu['name']; |
| [2591](#L2591) |  |
| [2592](#L2592) | $options = $this->get\_options($option\_page); |
| [2593](#L2593) |  |
| [2594](#L2594) | if (isset($options[$option])) |
| [2595](#L2595) | return $options[$option]; |
| [2596](#L2596) |  |
| [2597](#L2597) | return false; |
| [2598](#L2598) | } |
| [2599](#L2599) |  |
| [2600](#L2600) | public function get\_defaults() { |
| [2601](#L2601) | $defaults\_val = array(); |
| [2602](#L2602) | foreach ($this->settings\_fields as $tabs => $field) { |
| [2603](#L2603) | foreach ($field as $opt) { |
| [2604](#L2604) | if (isset($opt['name'])) { |
| [2605](#L2605) | if (isset($opt['default'])) { |
| [2606](#L2606) | $temp = str\_replace('[new\_line]', "\r\n", $opt['default']); |
| [2607](#L2607) | $temp = str\_replace('[double\_slashes]', "\/", $temp); |
| [2608](#L2608) | $temp = str\_replace('[o\_cb]', '{', $temp); |
| [2609](#L2609) | $temp = str\_replace('[c\_cb]', '}', $temp); |
| [2610](#L2610) |  |
| [2611](#L2611) | $defaults\_val[$opt['name']] = str\_replace('[quotation]', '"', $temp); |
| [2612](#L2612) | } else { |
| [2613](#L2613) | $defaults\_val[$opt['name']] = ''; |
| [2614](#L2614) | } |
| [2615](#L2615) | } |
| [2616](#L2616) | } |
| [2617](#L2617) | } |
| [2618](#L2618) | return $defaults\_val; |
| [2619](#L2619) | } |
| [2620](#L2620) |  |
| [2621](#L2621) | public function update\_options($main\_key, $options) { |
| [2622](#L2622) |  |
| [2623](#L2623) | if (is\_multisite()) |
| [2624](#L2624) | update\_blog\_option(BLOG\_ID\_CURRENT\_SITE, $main\_key, $options); |
| [2625](#L2625) | else |
| [2626](#L2626) | update\_option($main\_key, $options); |
| [2627](#L2627) | } |
| [2628](#L2628) |  |
| [2629](#L2629) | public function get\_options() { |
| [2630](#L2630) | $main\_key = isset($this->settings\_menu['name']) ? $this->settings\_menu['name'] : 'default\_name'; |
| [2631](#L2631) |  |
| [2632](#L2632) | if (is\_multisite()) |
| [2633](#L2633) | $current\_options = get\_blog\_option(BLOG\_ID\_CURRENT\_SITE, $main\_key); |
| [2634](#L2634) | else |
| [2635](#L2635) | $current\_options = get\_option($main\_key); |
| [2636](#L2636) |  |
| [2637](#L2637) | return $current\_options; |
| [2638](#L2638) | } |
| [2639](#L2639) |  |
| [2640](#L2640) | public function update\_defaults() { |
| [2641](#L2641) | $defaults\_options = $this->get\_defaults(); |
| [2642](#L2642) |  |
| [2643](#L2643) | $main\_key = isset($this->settings\_menu['name']) ? $this->settings\_menu['name'] : 'default\_name'; |
| [2644](#L2644) | $prev\_options = $this->get\_options(); |
| [2645](#L2645) |  |
| [2646](#L2646) |  |
| [2647](#L2647) | // Do previous options exist? Merge them, this way we keep existing options |
| [2648](#L2648) | // and if an update adds new options they get added too. |
| [2649](#L2649) | if (is\_array($prev\_options)) { |
| [2650](#L2650) | $options = array\_merge($defaults\_options, $prev\_options); |
| [2651](#L2651) | } else { |
| [2652](#L2652) | $options = $defaults\_options; |
| [2653](#L2653) | } |
| [2654](#L2654) |  |
| [2655](#L2655) |  |
| [2656](#L2656) | $options['db\_ver'] = isset($this->settings\_menu['version']) ? $this->settings\_menu['version'] : 'default\_version'; |
| [2657](#L2657) |  |
| [2658](#L2658) | $this->update\_options($main\_key, $options); |
| [2659](#L2659) | } |
| [2660](#L2660) |  |
| [2661](#L2661) | /\*\* |
| [2662](#L2662) | \* Show navigations as tab |
| [2663](#L2663) | \* |
| [2664](#L2664) | \* Shows all the settings section labels as tab |
| [2665](#L2665) | \*/ |
| [2666](#L2666) | function show\_navigation() { |
| [2667](#L2667) | $html = '<h2 class="nav-tab-wrapper">'; |
| [2668](#L2668) |  |
| [2669](#L2669) | foreach ($this->settings\_sections as $tab) { |
| [2670](#L2670) | $html .= sprintf('<a href="#%1$s" class="nav-tab" style="font-size:18px;" id="%1$s-tab">%2$s</a>', $tab['id'], $tab['title']); |
| [2671](#L2671) | } |
| [2672](#L2672) |  |
| [2673](#L2673) | $html .= '</h2>'; |
| [2674](#L2674) |  |
| [2675](#L2675) | echo $html; |
| [2676](#L2676) | } |
| [2677](#L2677) |  |
| [2678](#L2678) | /\*\* |
| [2679](#L2679) | \* Show the section settings forms |
| [2680](#L2680) | \* |
| [2681](#L2681) | \* This function displays every sections in a different form |
| [2682](#L2682) | \*/ |
| [2683](#L2683) | function show\_forms() { |
| [2684](#L2684) |  |
| [2685](#L2685) |  |
| [2686](#L2686) | /\* if ($this->settings\_menu['display\_metabox']) |
| [2687](#L2687) | echo '<div class="" style="width:77%; background: white;padding: 7px 15px;margin-top: 5px; border: 1px solid #ddd;"><div class="">';\*/ |
| [2688](#L2688) |  |
| [2689](#L2689) | if (is\_network\_admin()) |
| [2690](#L2690) | echo '<form class="securityforce-form" method="post" action="../options.php">'; |
| [2691](#L2691) | else |
| [2692](#L2692) | echo '<form class="securityforce-form" method="post" action="options.php">'; |
| [2693](#L2693) |  |
| [2694](#L2694) | settings\_fields($this->settings\_menu['name']); |
| [2695](#L2695) | // do\_settings\_sections( $this->settings\_menu['name']); |
| [2696](#L2696) | foreach ($this->settings\_sections as $form) { |
| [2697](#L2697) | ?> |
| [2698](#L2698) | <div class="securityforce-section" id="<?php echo $form['id']; ?>"> |
| [2699](#L2699) |  |
| [2700](#L2700) |  |
| [2701](#L2701) | <?php |
| [2702](#L2702) | $page = $this->settings\_menu['name']; |
| [2703](#L2703) | $sections = $form; |
| [2704](#L2704) | //$this->do\_settings\_sections\_for\_tab($this->settings\_menu['name'], $form); |
| [2705](#L2705) | global $wp\_settings\_sections, $wp\_settings\_fields; |
| [2706](#L2706) |  |
| [2707](#L2707) | if (!isset($wp\_settings\_sections) || !isset($wp\_settings\_sections[$page])) |
| [2708](#L2708) | return; |
| [2709](#L2709) |  |
| [2710](#L2710) | foreach ((array) $wp\_settings\_sections[$page] as $section) { |
| [2711](#L2711) | if (in\_array($section['id'], $sections)) { |
| [2712](#L2712) | echo "<h3>{$section['title']}</h3>\n"; |
| [2713](#L2713) | //call\_user\_func($section['callback'], $section); |
| [2714](#L2714) | if (!isset($wp\_settings\_fields) || !isset($wp\_settings\_fields[$page]) || !isset($wp\_settings\_fields[$page][$section['id']])) |
| [2715](#L2715) | continue; |
| [2716](#L2716) |  |
| [2717](#L2717) | echo '<div>'; |
| [2718](#L2718) | //echo '<table class="form-table">'; |
| [2719](#L2719) | //do\_settings\_fields($page, $section['id']); |
| [2720](#L2720) | if ( ! isset( $wp\_settings\_fields[ $page ][ $section['id'] ] ) ) { |
| [2721](#L2721) | continue; |
| [2722](#L2722) | } |
| [2723](#L2723) | foreach ( (array) $wp\_settings\_fields[ $page ][ $section['id'] ] as $field ) { |
| [2724](#L2724) | $class = ''; |
| [2725](#L2725) |  |
| [2726](#L2726) | if ( ! empty( $field['args']['class'] ) ) { |
| [2727](#L2727) | $class = ' class="securityforce-field ' . esc\_attr( $field['args']['class'] ) . '"'; |
| [2728](#L2728) | } else { |
| [2729](#L2729) | $class = ' class="securityforce-field"'; |
| [2730](#L2730) | } |
| [2731](#L2731) |  |
| [2732](#L2732) | echo "<div{$class}>"; |
| [2733](#L2733) |  |
| [2734](#L2734) | if ( ! empty( $field['args']['label\_for'] ) ) { |
| [2735](#L2735) | echo '<div class="securityforce-label"><label for="' . esc\_attr( $field['args']['label\_for'] ) . '">' . $field['title'] . '</label></div>'; |
| [2736](#L2736) | } else { |
| [2737](#L2737) | echo '<div class="securityforce-label">' . $field['title'] . '</div>'; |
| [2738](#L2738) | } |
| [2739](#L2739) |  |
| [2740](#L2740) | //echo '<td>'; |
| [2741](#L2741) | call\_user\_func( $field['callback'], $field['args'] ); |
| [2742](#L2742) | //echo '</td>'; |
| [2743](#L2743) | echo '</div>'; |
| [2744](#L2744) | } |
| [2745](#L2745) | echo '</div>'; //.securityforce-section |
| [2746](#L2746) | //echo '</table>'; |
| [2747](#L2747) | } |
| [2748](#L2748) | } |
| [2749](#L2749) | // |
| [2750](#L2750) | ?> |
| [2751](#L2751) | <?php //do\_settings\_sections( $this->settings\_menu['name']); ?> |
| [2752](#L2752) |  |
| [2753](#L2753) |  |
| [2754](#L2754) |  |
| [2755](#L2755) |  |
| [2756](#L2756) | </div> |
| [2757](#L2757) |  |
| [2758](#L2758) |  |
| [2759](#L2759) | <?php } ?> |
| [2760](#L2760) |  |
| [2761](#L2761) |  |
| [2762](#L2762) |  |
| [2763](#L2763) | <style> |
| [2764](#L2764) | .securityforce-section { |
| [2765](#L2765) | width: calc(50% - 50px); |
| [2766](#L2766) | margin-top: 23px; |
| [2767](#L2767) | margin-right: 20px; |
| [2768](#L2768) | padding: 10px; |
| [2769](#L2769) | background: #fbfbfb; |
| [2770](#L2770) | border: 1px solid #ccd0d4; |
| [2771](#L2771) | box-shadow: 0 1px 1px rgba(0,0,0,.04); |
| [2772](#L2772) | } |
| [2773](#L2773) | .securityforce-field { |
| [2774](#L2774) | padding: 10px 0; |
| [2775](#L2775) | } |
| [2776](#L2776) | .securityforce-field:not(:last-child) { |
| [2777](#L2777) | border-bottom: 1px solid #e8ecee; |
| [2778](#L2778) | } |
| [2779](#L2779) | .securityforce-label { |
| [2780](#L2780) | display: inline-block; |
| [2781](#L2781) | width: 200px; |
| [2782](#L2782) | vertical-align: top; |
| [2783](#L2783) | } |
| [2784](#L2784) | .securityforce-help { |
| [2785](#L2785) | margin-left: 30px; |
| [2786](#L2786) | position: relative; |
| [2787](#L2787) | display: inline-block; |
| [2788](#L2788) | vertical-align: top; |
| [2789](#L2789) | } |
| [2790](#L2790) | .securityforce-help-icon { |
| [2791](#L2791) | display: inline-block; |
| [2792](#L2792) | width: 20px; |
| [2793](#L2793) | height: 20px; |
| [2794](#L2794) | background-image: url("<?php echo SECURITYFORCE\_URL.'/img/help.svg'; ?>"); |
| [2795](#L2795) | background-size: 20px 20px; |
| [2796](#L2796) | } |
| [2797](#L2797) | .securityforce-help-icon:hover ~ .securityforce-help-text, |
| [2798](#L2798) | .securityforce-help-text:hover { |
| [2799](#L2799) | display: block; |
| [2800](#L2800) | } |
| [2801](#L2801) | .securityforce-help-text { |
| [2802](#L2802) | display: none; |
| [2803](#L2803) | position: absolute; |
| [2804](#L2804) | width: 150px; |
| [2805](#L2805) | top:0; |
| [2806](#L2806) | left:100%; |
| [2807](#L2807) | background: white; |
| [2808](#L2808) | padding: 15px; |
| [2809](#L2809) | border: 1px solid #ccd0d4; |
| [2810](#L2810) | box-shadow: 0 1px 1px rgba(0,0,0,.04); |
| [2811](#L2811) | z-index: 2; |
| [2812](#L2812) | } |
| [2813](#L2813) | .securityforce-radio, |
| [2814](#L2814) | .securityforce-checkbox { |
| [2815](#L2815) | display: inline-block; |
| [2816](#L2816) | } |
| [2817](#L2817) | </style> |
| [2818](#L2818) |  |
| [2819](#L2819) |  |
| [2820](#L2820) |  |
| [2821](#L2821) |  |
| [2822](#L2822) | <div class="clear"></div> |
| [2823](#L2823) | <span style="padding:0 10px;display: block;position: absolute;top: -40px;right: 40px;" class="alignleft"> |
| [2824](#L2824) | <?php submit\_button('Save Settings'); ?> |
| [2825](#L2825) | </span> |
| [2826](#L2826) | </form> |
| [2827](#L2827) | <?php |
| [2828](#L2828) | /\*if ($this->settings\_menu['display\_metabox']) |
| [2829](#L2829) | echo '</div></div>';\*/ |
| [2830](#L2830) |  |
| [2831](#L2831) | $this->script(); |
| [2832](#L2832) | } |
| [2833](#L2833) |  |
| [2834](#L2834) | /\*\* |
| [2835](#L2835) | \* Tabbable JavaScript codes |
| [2836](#L2836) | \* |
| [2837](#L2837) | \* This code uses localstorage for displaying active tabs |
| [2838](#L2838) | \*/ |
| [2839](#L2839) | function script() { |
| [2840](#L2840) | ?> |
| [2841](#L2841) | <style type="text/css"> |
| [2842](#L2842) | <!-- |
| [2843](#L2843) | .postbox h3{cursor: auto!important;} |
| [2844](#L2844) | --> |
| [2845](#L2845) | </style> |
| [2846](#L2846) |  |
| [2847](#L2847) | <script> |
| [2848](#L2848) | jQuery(document).ready(function ($) { |
| [2849](#L2849) | window.msnry = new Masonry( '.securityforce-form', { |
| [2850](#L2850) | itemSelector: '.securityforce-section' |
| [2851](#L2851) | }); |
| [2852](#L2852) | // Switches option sections |
| [2853](#L2853) | $('.group').hide(); |
| [2854](#L2854) |  |
| [2855](#L2855) | $('#import\_options').change(function (e) { |
| [2856](#L2856) |  |
| [2857](#L2857) | if (confirm('You may lose your current settings. Is it OK?') == true) |
| [2858](#L2858) | $('#import\_field').val($(this).val()); |
| [2859](#L2859) | else |
| [2860](#L2860) | $('#import\_field').val(''); |
| [2861](#L2861) | }); |
| [2862](#L2862) |  |
| [2863](#L2863) | $('.opener').change(function (e) { |
| [2864](#L2864) |  |
| [2865](#L2865) | var this\_obj = $(this); |
| [2866](#L2866) | var id = this\_obj.attr('id'); |
| [2867](#L2867) | var name = this\_obj.attr('name'); |
| [2868](#L2868) |  |
| [2869](#L2869) | if (this\_obj.attr('type') == 'checkbox') { |
| [2870](#L2870) |  |
| [2871](#L2871) | if (this\_obj.is(':checked')) |
| [2872](#L2872) | $('.open\_by\_' + id).removeClass('securityforce\_hidden').slideDown('150'); |
| [2873](#L2873) | else |
| [2874](#L2874) | $('.open\_by\_' + id).addClass('securityforce\_hidden').slideUp('150'); |
| [2875](#L2875) |  |
| [2876](#L2876) | } else if (this\_obj.attr('type') == 'radio') { |
| [2877](#L2877) |  |
| [2878](#L2878) | $('.open\_by\_' + $('input[name="' + name + '"]:checked').attr('id')).removeClass('securityforce\_hidden').slideDown('150'); |
| [2879](#L2879) | //hide other |
| [2880](#L2880) | $('.open\_by\_' + $('input[name="' + name + '"]:not(:checked)').attr('id')).addClass('securityforce\_hidden').slideUp('150'); |
| [2881](#L2881) | } else if (this\_obj.hasClass('selectbox')) { |
| [2882](#L2882) |  |
| [2883](#L2883) | $('.open\_by\_' + id + '\_' + this\_obj.val()).removeClass('securityforce\_hidden').slideDown('150'); |
| [2884](#L2884) | //hide other |
| [2885](#L2885) | $("[class^='open\_by\_" + id + "\_'],[class\*=' open\_by\_" + id + "\_']").not('.open\_by\_' + id + '\_' + this\_obj.val()).addClass('securityforce\_hidden').slideUp(); |
| [2886](#L2886) |  |
| [2887](#L2887) | } |
| [2888](#L2888) | setTimeout(function(){ |
| [2889](#L2889) | if(window.msnry) { |
| [2890](#L2890) | window.msnry.layout(); |
| [2891](#L2891) | } |
| [2892](#L2892) | },500); |
| [2893](#L2893) | }); |
| [2894](#L2894) |  |
| [2895](#L2895) |  |
| [2896](#L2896) | //first time load should be after change |
| [2897](#L2897) | $('.opener').trigger('change'); |
| [2898](#L2898) | /\* |
| [2899](#L2899) |  |
| [2900](#L2900) | var activetab = ''; |
| [2901](#L2901) | if (typeof (localStorage) != 'undefined') { |
| [2902](#L2902) | activetab = localStorage.getItem("activetab"); |
| [2903](#L2903) | } |
| [2904](#L2904) | if (activetab != '' && $(activetab).length) { |
| [2905](#L2905) | $(activetab).fadeIn(); |
| [2906](#L2906) | } else { |
| [2907](#L2907) | $('.group:first').fadeIn(); |
| [2908](#L2908) | }\*/ |
| [2909](#L2909) | /\* $('.group .collapsed').each(function () { |
| [2910](#L2910) | $(this).find('input:checked').parent().parent().parent().nextAll().each( |
| [2911](#L2911) | function () { |
| [2912](#L2912) | if ($(this).hasClass('last')) { |
| [2913](#L2913) | $(this).removeClass('hidden'); |
| [2914](#L2914) | return false; |
| [2915](#L2915) | } |
| [2916](#L2916) | $(this).filter('.hidden').removeClass('hidden'); |
| [2917](#L2917) | }); |
| [2918](#L2918) | });\*/ |
| [2919](#L2919) |  |
| [2920](#L2920) | // if (activetab != '' && $(activetab + '-tab').length) { |
| [2921](#L2921) | //     $(activetab + '-tab').addClass('nav-tab-active'); |
| [2922](#L2922) | // } else { |
| [2923](#L2923) | //     $('.nav-tab-wrapper a:first').addClass('nav-tab-active'); |
| [2924](#L2924) | // } |
| [2925](#L2925) | /\*$('.nav-tab-wrapper a').click(function (evt) { |
| [2926](#L2926) | $('.nav-tab-wrapper a').removeClass('nav-tab-active'); |
| [2927](#L2927) | $(this).addClass('nav-tab-active').blur(); |
| [2928](#L2928) | var clicked\_group = $(this).attr('href'); |
| [2929](#L2929) | if (typeof (localStorage) != 'undefined') { |
| [2930](#L2930) | localStorage.setItem("activetab", $(this).attr('href')); |
| [2931](#L2931) | } |
| [2932](#L2932) | $('.group').hide(); |
| [2933](#L2933) | $(clicked\_group).fadeIn(); |
| [2934](#L2934) | evt.preventDefault(); |
| [2935](#L2935) | });\*/ |
| [2936](#L2936) | }); |
| [2937](#L2937) | </script> |
| [2938](#L2938) | <?php |
| [2939](#L2939) | } |
| [2940](#L2940) |  |
| [2941](#L2941) | } |
| [2942](#L2942) |  |
| [2943](#L2943) | $security\_force\_settings\_api = SecurityForce\_Settings\_API::get\_instance(); |
| [2944](#L2944) |  |
| [2945](#L2945) | //add\_action('admin\_enqueue\_scripts', array($security\_force\_settings\_api, 'enqueue\_and\_localize\_my\_scripts')); |

**Note:** See [TracBrowser](/wiki/TracBrowser)
for help on using the repository browser.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Plain Text](/browser/security-force/trunk/lib/class.settings-api.php?format=txt)
* [Original Format](/export/3222480/security-force/trunk/lib/class.settings-api.php)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from plugins.trac.wordpress.org_729ff705_20250114_213607.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fbrowser%2Fsecurity-force%2Ftrunk%2Flib%2Fclass.settings-api.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Revision](/browser/security-force/trunk/lib/class.settings-api.php?rev=3034005 "Revision 3034005")
* Next Revision →
* [Blame](/browser/security-force/trunk/lib/class.settings-api.php?annotate=blame "Annotate each line with the last changed revision (this can be time consuming...)")
* [Revision Log](/log/security-force/trunk/lib/class.settings-api.php)

---

# [source:](/browser?order=name "Go to repository root") [security-force](/browser/security-force?order=name "View security-force")/[trunk](/browser/security-force/trunk?order=name "View trunk")/[lib](/browser/security-force/trunk/lib?order=name "View lib")/[class.settings-api.php](/browser/security-force/trunk/lib/class.settings-api.php?order=name "View class.settings-api.php")

View diff against:

View revision:

| [Last change](/changeset/3051882/security-force/trunk/lib/class.settings-api.php "View differences") on this file was [3051882](/changeset/3051882/ "View changeset 3051882"), checked in by securityforce, [10 months ago](/timeline?from=2024-03-15T18%3A43%3A25Z&precision=second "See timeline at 03/15/2024 06:43:25 PM") |
| --- |
| Cryptocurrency data points set as default.  Minor bug fixes.  Updated Getting Started video. |
| **File size:** 154.7 KB | |

| Line |  |
| --- | --- |
| [1](#L1) | <?php |
| [2](#L2) |  |
| [3](#L3) |  |
| [4](#L4) |  |
| [5](#L5) | /\*\* |
| [6](#L6) | \* Forked from Settings API wrapper class by Tareq Hasan <tareq@weDevs.com> (http://tareq.weDevs.com) |
| [7](#L7) | \*/ |
| [8](#L8) | class SecurityForce\_Settings\_API { |
| [9](#L9) |  |
| [10](#L10) | /\*\* |
| [11](#L11) | \* settings sections array |
| [12](#L12) | \* |
| [13](#L13) | \* @var array |
| [14](#L14) | \*/ |
| [15](#L15) | private $settings\_sections = array(); |
| [16](#L16) |  |
| [17](#L17) | /\*\* |
| [18](#L18) | \* Settings fields array |
| [19](#L19) | \* |
| [20](#L20) | \* @var array |
| [21](#L21) | \*/ |
| [22](#L22) | private $settings\_fields = array(); |
| [23](#L23) |  |
| [24](#L24) | /\*\* |
| [25](#L25) | \* Settings fields array |
| [26](#L26) | \* |
| [27](#L27) | \* @var array |
| [28](#L28) | \*/ |
| [29](#L29) | private $settings\_menu = array(); |
| [30](#L30) |  |
| [31](#L31) | /\*\* |
| [32](#L32) | \* Singleton instance |
| [33](#L33) | \* |
| [34](#L34) | \* @var object |
| [35](#L35) | \*/ |
| [36](#L36) | private static $\_instance; |
| [37](#L37) |  |
| [38](#L38) |  |
| [39](#L39) | private static $instance = null; |
| [40](#L40) |  |
| [41](#L41) | public function \_\_construct($fields = [], $sections = [], $menu = '') { |
| [42](#L42) | //set sections and fields |
| [43](#L43) | //if (!is\_admin()) |
| [44](#L44) | //    return; |
| [45](#L45) |  |
| [46](#L46) | $this->set\_sections($sections); |
| [47](#L47) | $this->set\_fields($fields); |
| [48](#L48) |  |
| [49](#L49) | if ($menu) { |
| [50](#L50) | $this->set\_menu($menu); |
| [51](#L51) |  |
| [52](#L52) | if ($menu['multisite\_only']) |
| [53](#L53) | add\_action('network\_admin\_menu', array(&$this, 'register\_menu')); |
| [54](#L54) | else |
| [55](#L55) | add\_action('admin\_menu', array(&$this, 'register\_menu')); |
| [56](#L56) | add\_action('admin\_post\_edit\_widget', array($this, 'handle\_widget\_save')); |
| [57](#L57) | add\_action('admin\_post\_delete\_widget', array($this, 'handle\_delete\_widget')); |
| [58](#L58) | add\_action('admin\_post\_clear\_widgets', array($this, 'clear\_all\_widgets')); //delete this |
| [59](#L59) |  |
| [60](#L60) |  |
| [61](#L61) |  |
| [62](#L62) | //need to be deleted |
| [63](#L63) | add\_action('admin\_post\_clear\_all\_widgets', array($this, 'clear\_all\_widgets')); |
| [64](#L64) | add\_action('admin\_post\_nopriv\_clear\_all\_widgets', array($this, 'clear\_all\_widgets')); |
| [65](#L65) |  |
| [66](#L66) |  |
| [67](#L67) |  |
| [68](#L68) |  |
| [69](#L69) | add\_action('wp\_ajax\_edit\_widget', 'your\_edit\_widget\_function'); |
| [70](#L70) | add\_action('wp\_ajax\_nopriv\_edit\_widget', 'your\_edit\_widget\_function'); // if you want it available for non-logged in users |
| [71](#L71) |  |
| [72](#L72) |  |
| [73](#L73) |  |
| [74](#L74) | // add\_shortcode('hedge3\_widgets', array($this, 'hedge3\_widgets\_shortcode')); |
| [75](#L75) |  |
| [76](#L76) | } |
| [77](#L77) | //add\_action('init', array($this, 'register\_shortcodes'), 100); |
| [78](#L78) |  |
| [79](#L79) | add\_action('init', array($this, 'filter\_settings'), 10); |
| [80](#L80) |  |
| [81](#L81) | //$this->admin\_init(); |
| [82](#L82) | //$this->register\_menu(); |
| [83](#L83) |  |
| [84](#L84) | if (isset($this->settings\_menu['action\_link']) && $this->settings\_menu['action\_link']) { |
| [85](#L85) | add\_filter('plugin\_action\_links\_' . $this->settings\_menu['plugin\_file'], array(&$this, 'plugin\_actions\_links'), -10); |
| [86](#L86) | } |
| [87](#L87) | add\_action('admin\_init', array(&$this, 'admin\_init')); |
| [88](#L88) |  |
| [89](#L89) | add\_action('wp\_ajax\_nopriv\_securityforce\_get\_firewall\_phpidsdata', array($this,'securityforce\_get\_firewall\_phpidsdata')); |
| [90](#L90) | add\_action('wp\_ajax\_securityforce\_get\_firewall\_phpidsdata', array($this,'securityforce\_get\_firewall\_phpidsdata')); |
| [91](#L91) |  |
| [92](#L92) | add\_action('wp\_ajax\_securityforce\_remove\_dashboard\_notice', array($this,'securityforce\_remove\_dashboard\_notice')); |
| [93](#L93) | //add\_action('wp\_enqueue\_scripts', array($this, 'enqueue\_and\_localize\_my\_scripts')); |
| [94](#L94) | // add\_action('admin\_post\_add\_new\_widget', array($this, 'handle\_add\_new\_widget')); |
| [95](#L95) | } |
| [96](#L96) |  |
| [97](#L97) |  |
| [98](#L98) |  |
| [99](#L99) |  |
| [100](#L100) |  |
| [101](#L101) | public static function get\_instance() { |
| [102](#L102) | if (null === self::$instance) { |
| [103](#L103) | self::$instance = new self(); |
| [104](#L104) | } |
| [105](#L105) | return self::$instance; |
| [106](#L106) | } |
| [107](#L107) |  |
| [108](#L108) |  |
| [109](#L109) | // public function enqueue\_and\_localize\_my\_scripts() { |
| [110](#L110) | //     wp\_enqueue\_script('my-react-app','http://localhost:3000/widget.lib.bundle.latest.js', array('wp-element'), time(), true); |
| [111](#L111) |  |
| [112](#L112) | //     wp\_localize\_script('my-react-app', 'wordpressData', array( |
| [113](#L113) | //         'ajaxUrl' => admin\_url('admin-ajax.php'), |
| [114](#L114) | //         'nonce' => wp\_create\_nonce('edit\_widget\_action'), |
| [115](#L115) | //     )); |
| [116](#L116) | // } |
| [117](#L117) |  |
| [118](#L118) |  |
| [119](#L119) |  |
| [120](#L120) |  |
| [121](#L121) |  |
| [122](#L122) | // function register\_shortcodes() { |
| [123](#L123) | //     echo "Register Shortcodes Function Call................................"; |
| [124](#L124) | //     add\_shortcode('hedge3\_widgets', array($this, 'hedge3\_widgets\_shortcode')); |
| [125](#L125) | // } |
| [126](#L126) | // function hedge3\_widgets\_shortcode($atts) { |
| [127](#L127) | //     error\_log('Shortcode called with attributes: ' . print\_r($atts, true)); |
| [128](#L128) | //     return 'Hello World!'; |
| [129](#L129) | // } |
| [130](#L130) |  |
| [131](#L131) | // function hedge3\_widgets\_shortcode($atts) { |
| [132](#L132) | //         $atts = shortcode\_atts(array('id' => ''), $atts, 'hedge3\_widgets'); |
| [133](#L133) |  |
| [134](#L134) | //         $widgets = get\_option('hedge3\_widgets\_config', array()); |
| [135](#L135) | //         if (isset($widgets[$atts['id']])) { |
| [136](#L136) | //             $widgetConfig = $widgets[$atts['id']]; |
| [137](#L137) | //             $widgetConfig['enableEdit'] = false; // Set enableEdit to false for the frontend display |
| [138](#L138) |  |
| [139](#L139) | //             // Prepare the container ID from the 'containerSelector' value |
| [140](#L140) | //             $containerID = ltrim($widgetConfig['containerSelector'], '#'); |
| [141](#L141) |  |
| [142](#L142) | //             $output = "<div class='widget\_page\_wrap' style='background-image: url(\"" . SECURITYFORCE\_URL . "/img/h3.annimate.gif\");'>"; |
| [143](#L143) | //             $output .= "<script> |
| [144](#L144) | //                         document.addEventListener('DOMContentLoaded', () => { |
| [145](#L145) | //                             const script = document.createElement('script'); |
| [146](#L146) | //                             script.src = 'http://localhost:3000/widget.lib.bundle.latest.js'; |
| [147](#L147) | //                             script.onload = () => { |
| [148](#L148) | //                                 window.initializeActiveWidget(" . json\_encode($widgetConfig, JSON\_PRETTY\_PRINT) . "); |
| [149](#L149) | //                             }; |
| [150](#L150) | //                             document.head.appendChild(script); |
| [151](#L151) | //                         }); |
| [152](#L152) | //                         </script>"; |
| [153](#L153) | //             $output .= "<div id='" . esc\_attr($containerID) . "' class='hedge3-widgets'></div>"; |
| [154](#L154) | //             $output .= "</div>"; |
| [155](#L155) |  |
| [156](#L156) | //             return $output; // Return the output instead of echoing |
| [157](#L157) | //         } else { |
| [158](#L158) | //             return 'Widget not found.'; |
| [159](#L159) | //         } |
| [160](#L160) | //     } |
| [161](#L161) |  |
| [162](#L162) |  |
| [163](#L163) |  |
| [164](#L164) |  |
| [165](#L165) |  |
| [166](#L166) |  |
| [167](#L167) |  |
| [168](#L168) |  |
| [169](#L169) |  |
| [170](#L170) | public function securityforce\_remove\_dashboard\_notice(){ |
| [171](#L171) | update\_option('securityforce\_remove\_dashboard\_notice\_'.(isset($\_REQUEST['type']) ? sanitize\_text\_field($\_REQUEST['type']) : ''),1); |
| [172](#L172) | echo 'success'; |
| [173](#L173) | exit; |
| [174](#L174) | } |
| [175](#L175) |  |
| [176](#L176) | public function securityforce\_get\_firewall\_phpidsdata(){ |
| [177](#L177) | $call = sanitize\_text\_field($\_POST['call\_type']); |
| [178](#L178) | $attack\_type = sanitize\_text\_field($\_POST['attack\_type']); |
| [179](#L179) | $sale\_data = array(); |
| [180](#L180) | global $wpdb; |
| [181](#L181) | $table\_name = $wpdb->prefix . 'securityforce\_ab\_attacks'; |
| [182](#L182) | if($attack\_type == 'IPS'){ |
| [183](#L183) | $table\_name = $wpdb->prefix . 'securityforce\_blocked\_ips'; |
| [184](#L184) | } |
| [185](#L185) | if($call == 'this month'){ |
| [186](#L186) | $current\_date = date('d'); |
| [187](#L187) | $all\_date = date('t'); |
| [188](#L188) | $current\_my = date(' m d'); |
| [189](#L189) | for($i=01; $i <= $current\_date; $i++){ |
| [190](#L190) | $key = date('Y-m-' . $i); |
| [191](#L191) | $key\_1 = date( str\_pad($i, 2, '0', STR\_PAD\_LEFT) . ' M Y'); |
| [192](#L192) | $data\_r = $wpdb->get\_row("SELECT COUNT(\*) cnt FROM " . $table\_name . " WHERE date(created) = '". $key ."'"); |
| [193](#L193) | $sale\_data[ $key\_1 ] = $data\_r->cnt; |
| [194](#L194) | } |
| [195](#L195) | $main\_arr = array(); |
| [196](#L196) | if($sale\_data){ |
| [197](#L197) | foreach ($sale\_data as $key => $value) { |
| [198](#L198) | $main\_arr[] = array( |
| [199](#L199) | 'x' => str\_replace("-", ", ", $key), |
| [200](#L200) | 'y' => $value |
| [201](#L201) | ); |
| [202](#L202) | } |
| [203](#L203) | } |
| [204](#L204) | echo json\_encode($main\_arr); |
| [205](#L205) | } else if($call == 'last month'){ |
| [206](#L206) | $first = date("j", strtotime("first day of previous month")); |
| [207](#L207) | $last = date("j", strtotime("last day of previous month")); |
| [208](#L208) | $last\_month = date("n", strtotime("last day of previous month")); |
| [209](#L209) | $last\_month\_name = date('F', strtotime('last month')); |
| [210](#L210) | $this\_year = date('Y'); |
| [211](#L211) | for($i=$first; $i <= $last; $i++){ |
| [212](#L212) | $key = date('Y-'. $last\_month .'-' . $i); |
| [213](#L213) | $key\_1 = str\_pad($i, 2, '0', STR\_PAD\_LEFT) . ' '. $last\_month\_name . ' ' . $this\_year; |
| [214](#L214) | $data\_r = $wpdb->get\_row("SELECT COUNT(\*) cnt FROM " . $table\_name . " WHERE date(created) = '". $key ."'"); |
| [215](#L215) | $sale\_data[ $key\_1 ] = $data\_r->cnt; |
| [216](#L216) | } |
| [217](#L217) | $main\_arr = array(); |
| [218](#L218) | if($sale\_data){ |
| [219](#L219) | foreach ($sale\_data as $key => $value) { |
| [220](#L220) | $main\_arr[] = array( |
| [221](#L221) | 'x' => str\_replace("-", ", ", $key), |
| [222](#L222) | 'y' => $value |
| [223](#L223) | ); |
| [224](#L224) | } |
| [225](#L225) | } |
| [226](#L226) | echo json\_encode($main\_arr); |
| [227](#L227) | } else if($call == 'this year'){ |
| [228](#L228) | $this\_year = date('Y'); |
| [229](#L229) | for($i=01; $i <= 12; $i++){ |
| [230](#L230) | $dateObj   = DateTime::createFromFormat('!m', $i); |
| [231](#L231) | $monthName = $dateObj->format('F'); |
| [232](#L232) | $key = $this\_year . '-' . str\_pad($i, 2, '0', STR\_PAD\_LEFT); |
| [233](#L233) | $key\_1 = $monthName . ' ' . $this\_year; |
| [234](#L234) | $data\_r = $wpdb->get\_row("SELECT COUNT(\*) cnt FROM " . $table\_name . " WHERE created LIKE '%" . $key . "%'" ); |
| [235](#L235) | $sale\_data[ $key\_1 ] = $data\_r->cnt; |
| [236](#L236) | } |
| [237](#L237) | $main\_arr = array(); |
| [238](#L238) | if($sale\_data){ |
| [239](#L239) | foreach ($sale\_data as $key => $value) { |
| [240](#L240) | $main\_arr[] = array( |
| [241](#L241) | 'x' => str\_replace("-", ", ", $key), |
| [242](#L242) | 'y' => $value |
| [243](#L243) | ); |
| [244](#L244) | } |
| [245](#L245) | } |
| [246](#L246) | echo json\_encode($main\_arr); |
| [247](#L247) | } else{ |
| [248](#L248) | $now = new DateTime( "6 days ago", new DateTimeZone('America/New\_York')); |
| [249](#L249) | $interval = new DateInterval( 'P1D'); // 1 Day interval |
| [250](#L250) | $period = new DatePeriod( $now, $interval, 6); // 7 Days |
| [251](#L251) | $sale\_data = array(); |
| [252](#L252) | foreach( $period as $day) { |
| [253](#L253) | $key = $day->format( 'd M Y'); |
| [254](#L254) | $key\_1 = $day->format( 'Y-m-d'); |
| [255](#L255) | $data\_r = $wpdb->get\_row("SELECT COUNT(\*) cnt FROM " . $table\_name . " WHERE date(created) = '". $key\_1 ."'"); |
| [256](#L256) | $sale\_data[ $key ] = $data\_r->cnt; |
| [257](#L257) | } |
| [258](#L258) | $main\_arr = array(); |
| [259](#L259) | if($sale\_data){ |
| [260](#L260) | foreach ($sale\_data as $key => $value) { |
| [261](#L261) | $main\_arr[] = array( |
| [262](#L262) | 'x' => str\_replace("-", ", ", $key), |
| [263](#L263) | 'y' => $value |
| [264](#L264) | ); |
| [265](#L265) | } |
| [266](#L266) | } |
| [267](#L267) | echo json\_encode($main\_arr); |
| [268](#L268) | } |
| [269](#L269) | exit; |
| [270](#L270) | } |
| [271](#L271) |  |
| [272](#L272) | public function register\_menu() { |
| [273](#L273) | $role = ($this->settings\_menu['role']) ? $this->settings\_menu['role'] : 'manage\_options'; |
| [274](#L274) | if ($this->settings\_menu['multisite\_only']) { |
| [275](#L275) | add\_submenu\_page('settings.php', $this->settings\_menu['title'], $this->settings\_menu['title'], $role, $this->settings\_menu['name'], array(&$this, 'render\_option\_page')); |
| [276](#L276) | } else { |
| [277](#L277) |  |
| [278](#L278) | $securityforce\_options = get\_option('security\_force'); |
| [279](#L279) | include\_once(SECURITYFORCE\_PATH. DIRECTORY\_SEPARATOR.'firewall'.DIRECTORY\_SEPARATOR.'firewall.php'); |
| [280](#L280) | $attack\_count = (int) SECURITYFORCE\_FIREWALL\_PHPIDS::instance()->opt( 'new\_attacks\_count' ); |
| [281](#L281) | $attacks\_menu\_title = sprintf( \_\_( 'Attacks %s', 'mute-screamer' ), "<span class='update-plugins count-$attack\_count' title='$attack\_count'><span class='update-count'>" . number\_format\_i18n( $attack\_count ) . '</span></span>' ); |
| [282](#L282) |  |
| [283](#L283) |  |
| [284](#L284) | add\_menu\_page( |
| [285](#L285) | \_\_('Widgets', 'security\_force'), |
| [286](#L286) | \_\_('DeFi Widgets', 'security\_force'), |
| [287](#L287) | $role, |
| [288](#L288) | 'security\_force\_dashboard', |
| [289](#L289) | array($this, 'dashboard\_page'), |
| [290](#L290) | SECURITYFORCE\_URL . '/img/hedge3.21.white.png', |
| [291](#L291) | 40 |
| [292](#L292) | ); |
| [293](#L293) | add\_submenu\_page( |
| [294](#L294) | 'security\_force\_dashboard', |
| [295](#L295) | \_\_('Dashboard', 'security\_forc'), |
| [296](#L296) | \_\_('Dashboard', 'security\_force'), |
| [297](#L297) | $role, |
| [298](#L298) | 'security\_force\_dashboard', |
| [299](#L299) | array($this, 'dashboard\_page') |
| [300](#L300) | ); |
| [301](#L301) | // Register the 'builder' page |
| [302](#L302) |  |
| [303](#L303) |  |
| [304](#L304) |  |
| [305](#L305) |  |
| [306](#L306) |  |
| [307](#L307) | // add\_submenu\_page('security\_force\_dashboard', \_\_( 'Firewall', 'mute-screamer' ), $attacks\_menu\_title, 'activate\_plugins', 'securityforce\_ab\_attacks', array($this,'render\_firewall\_phpidspage')); |
| [308](#L308) | $securityforce\_widget\_builder = \_\_('Pro Options', 'securityforce'); |
| [309](#L309) | add\_submenu\_page('security\_force\_dashboard', \_\_('Widget Builder', 'edit-widget'), \_\_('Widget Builder', 'activate\_plugins'), $role, 'builder', array(&$this, 'render\_builder\_page')); |
| [310](#L310) |  |
| [311](#L311) |  |
| [312](#L312) | add\_submenu\_page('security\_force\_dashboard', \_\_( 'Trust Nwtwork', 'mute-screamer' ), "Pro Options", 'activate\_plugins', 'pro-options', array($this,'securityforce\_render\_secure\_network\_page')); |
| [313](#L313) |  |
| [314](#L314) | add\_submenu\_page('security\_force\_dashboard', \_\_('Security Settings', 'security\_force'), \_\_('Security Settings', 'security\_force'), $role, $this->settings\_menu['name'], array(&$this, 'render\_option\_page')); |
| [315](#L315) | add\_submenu\_page(NULL, \_\_('Setup Wizard', 'security\_force'), \_\_('Setup Wizard', 'security\_force'), 'activate\_plugins', 'hedge3\_setup\_wizard', array(&$this, 'securityforce\_render\_secure\_network\_page')); |
| [316](#L316) | //add\_options\_page($this->settings\_menu['title'],  $this->settings\_menu['title'], $role, $this->settings\_menu['name'], array(&$this, 'render\_option\_page')); |
| [317](#L317) |  |
| [318](#L318) | } |
| [319](#L319) | } |
| [320](#L320) |  |
| [321](#L321) | public function render\_settings\_page(){ |
| [322](#L322) | require SECURITYFORCE\_PATH.DIRECTORY\_SEPARATOR.'settings-page.php'; |
| [323](#L323) | } |
| [324](#L324) |  |
| [325](#L325) |  |
| [326](#L326) |  |
| [327](#L327) |  |
| [328](#L328) |  |
| [329](#L329) |  |
| [330](#L330) |  |
| [331](#L331) |  |
| [332](#L332) |  |
| [333](#L333) |  |
| [334](#L334) |  |
| [335](#L335) |  |
| [336](#L336) |  |
| [337](#L337) |  |
| [338](#L338) |  |
| [339](#L339) |  |
| [340](#L340) |  |
| [341](#L341) |  |
| [342](#L342) |  |
| [343](#L343) |  |
| [344](#L344) |  |
| [345](#L345) |  |
| [346](#L346) |  |
| [347](#L347) |  |
| [348](#L348) |  |
| [349](#L349) |  |
| [350](#L350) |  |
| [351](#L351) | public function hedge3\_setup\_wizard(){ |
| [352](#L352) |  |
| [353](#L353) | ?> |
| [354](#L354) | <div class="wrap"> |
| [355](#L355) | <h1><?php \_e('Setup Wizard','security\_force'); ?></h1> |
| [356](#L356) | <script type="text/javascript"> |
| [357](#L357) | jQuery(document).ready(function(){ |
| [358](#L358) | jQuery('.setup-element-wrap').click(function(e){ |
| [359](#L359) | e.preventDefault(); |
| [360](#L360) | jQuery('.setup-element-wrap').removeClass('setup-selected'); |
| [361](#L361) | jQuery('.setup-element-wrap').find('input[type="radio"]').prop("checked", false); |
| [362](#L362) | jQuery(this).addClass('setup-selected'); |
| [363](#L363) | jQuery(this).find('input[type="radio"]').prop("checked", true); |
| [364](#L364) | jQuery(this).closest('form').submit(); |
| [365](#L365) | }); |
| [366](#L366) | }); |
| [367](#L367) | </script> |
| [368](#L368) | <style type="text/css"> |
| [369](#L369) | .setup-main-wrapper { |
| [370](#L370) | display: flex; |
| [371](#L371) | justify-content: space-between; |
| [372](#L372) | align-items: flex-start; |
| [373](#L373) | margin-top: 20px; |
| [374](#L374) | } |
| [375](#L375) | .setup-element-wrap{ |
| [376](#L376) | background: white; |
| [377](#L377) | border-radius: 5px; |
| [378](#L378) | padding: 0; |
| [379](#L379) | display: inline-block; |
| [380](#L380) | width: 30%; |
| [381](#L381) | position: relative; |
| [382](#L382) | transition: 0.2s all; |
| [383](#L383) | -o-transition: 0.2s all; |
| [384](#L384) | -webkit-transition: 0.2s all; |
| [385](#L385) | -ms-transition: 0.2s all; |
| [386](#L386) | cursor: pointer; |
| [387](#L387) | } |
| [388](#L388) | .setup-element-wrap:hover { |
| [389](#L389) | transform: scale(1.02); |
| [390](#L390) | } |
| [391](#L391) |  |
| [392](#L392) | .setup-purchase-code{ |
| [393](#L393) | border: 2px solid #fff; |
| [394](#L394) | border-radius: 5px; |
| [395](#L395) | padding: 0 20px 20px 20px; |
| [396](#L396) | margin-top: 50px; |
| [397](#L397) | } |
| [398](#L398) | .setup-purchase-code input[type="text"] { |
| [399](#L399) | width: 500px; |
| [400](#L400) | max-width: 100%; |
| [401](#L401) | } |
| [402](#L402) | .setup-element-wrap .setup-settings-wrap .enable-ele{ |
| [403](#L403) | padding: 5px 10px 5px 5px; |
| [404](#L404) | font-size: 12px; |
| [405](#L405) | display: block; |
| [406](#L406) | margin: 0 5px 7px 0; |
| [407](#L407) | } |
| [408](#L408) |  |
| [409](#L409) | .setup-element-wrap .setup-settings-wrap{ |
| [410](#L410) | box-sizing: border-box; |
| [411](#L411) | padding: 0 20px; |
| [412](#L412) | } |
| [413](#L413) | .skip-button-div-wrap { |
| [414](#L414) | margin-top: 20px; |
| [415](#L415) | } |
| [416](#L416) | .setup-select-button { |
| [417](#L417) | background: #00669b; |
| [418](#L418) | color: white !important; |
| [419](#L419) | width: 100%; |
| [420](#L420) | display: block; |
| [421](#L421) | height: 60px; |
| [422](#L422) | line-height: 60px; |
| [423](#L423) | text-align: center; |
| [424](#L424) | font-size: 16px; |
| [425](#L425) | text-decoration: none; |
| [426](#L426) | } |
| [427](#L427) | </style> |
| [428](#L428) | <?php |
| [429](#L429) | //Get old setting |
| [430](#L430) | $securityforce\_settings = get\_option($this->settings\_menu['name']); |
| [431](#L431) | $admin\_email = get\_option('admin\_email'); |
| [432](#L432) |  |
| [433](#L433) | if ( isset($\_POST['securityforce\_setup\_nonce']) && wp\_verify\_nonce($\_POST['securityforce\_setup\_nonce'], 'securityforce\_setup\_setting') ){ |
| [434](#L434) | $options\_file = (is\_multisite()) ? 'network/settings.php' : 'admin.php'; |
| [435](#L435) | $page\_url = admin\_url(add\_query\_arg('page', $this->settings\_menu['name'], $options\_file)); |
| [436](#L436) |  |
| [437](#L437) |  |
| [438](#L438) | $new\_settings = sanitize\_text\_field(stripslashes($\_POST['setup-eb-setting'])); |
| [439](#L439) | $new\_settings = json\_decode($new\_settings, true); |
| [440](#L440) | $new\_settings = str\_replace('[new\_line]', "\r\n", $new\_settings); |
| [441](#L441) | $new\_settings = str\_replace('[double\_slashes]', "\/", $new\_settings); |
| [442](#L442) | $new\_settings = str\_replace('[quotation]', '"', $new\_settings); |
| [443](#L443) | $new\_settings = str\_replace('[o\_cb]', '{', $new\_settings); |
| [444](#L444) | $new\_settings = str\_replace('[c\_cb]', '}', $new\_settings); |
| [445](#L445) |  |
| [446](#L446) | update\_option($this->settings\_menu['name'], $new\_settings); |
| [447](#L447) | update\_option('securityforce\_setup\_run', 'yes'); |
| [448](#L448) | $goback = add\_query\_arg(array('settings-imported' => 'true'), $page\_url); |
| [449](#L449) | wp\_redirect($goback); |
| [450](#L450) | exit; |
| [451](#L451) | } |
| [452](#L452) | ?> |
| [453](#L453) | <form method="POST"> |
| [454](#L454) | <?php wp\_nonce\_field( 'securityforce\_setup\_setting', 'securityforce\_setup\_nonce' ); ?> |
| [455](#L455) | <div class="skip-button-div-wrap"> |
| [456](#L456) | <a class="button" href="<?php echo home\_url() . '/wp-admin/admin.php?page=security\_force'; ?>">Skip & Go to Settings</a> |
| [457](#L457) | </div> |
| [458](#L458) | <div class="setup-main-wrapper"> |
| [459](#L459) | <div class="setup-element-wrap"> |
| [460](#L460) | <div class="setup-settings-wrap"> |
| [461](#L461) | <h2>Basic</h2> |
| [462](#L462) | <p>Enough for simple sites with minimal changes to the site</p> |
| [463](#L463) | <span class="enable-ele"><span class="dashicons dashicons-yes"></span> Basic Firewall Rules </span> |
| [464](#L464) | <span class="enable-ele"><span class="dashicons dashicons-yes"></span> Basic Cleanup </span> |
| [465](#L465) | <span class="enable-ele"><span class="dashicons dashicons-yes"></span> Hide wp-login.php </span> |
| [466](#L466) | <span class="enable-ele"><span class="dashicons dashicons-yes"></span> Anti Spam </span> |
| [467](#L467) | <span class="enable-ele"><span class="dashicons dashicons-yes"></span> Hides Themes </span> |
| [468](#L468) | </div> |
| [469](#L469) | <input style="display: none;" type="radio" name="setup-eb-setting" value='{"replace\_javascript\_path":"0","disable\_directory\_listing":"on","exclude\_plugins\_access":"","exclude\_theme\_access":"","replace\_wpnonce":"","replace\_mode":"safe","custom\_404":"0","custom\_404\_page":"","login\_query":"security\_force","admin\_key":"1234","remove\_feed\_meta":"on","hide\_admin\_bar":"","remove\_other\_meta":"on","clean\_post\_class":"","remove\_menu\_class":"","remove\_default\_description":"on","remove\_ver\_scripts":"","direct\_access\_except":"index.php, wp-content/repair.php, wp-comments-post.php, wp-includes/js/tinymce/wp-tinymce.php, xmlrpc.php, wp-cron.php","disable\_canonical\_redirect":"","email\_from\_name":"<?php echo get\_bloginfo('blogname'); ?>","email\_from\_address":"<?php echo $admin\_email; ?>","replace\_in\_html":"","new\_theme\_path":"/static","new\_style\_name":"","style\_expiry\_days":"","new\_include\_path":"/static/lib","new\_plugin\_path":"/static/ext","new\_upload\_path":"/file","replace\_comments\_post":"","replace\_admin\_ajax":"ajax","new\_content\_path":"","author\_enable":"1","author\_base":"","author\_query":"","feed\_enable":"1","feed\_base":"","feed\_query":"","post\_enable":"1","post\_base":"/blog/%year%/%monthnum%/%day%/%postname%/","post\_query":"p","page\_enable":"1","page\_base":"","page\_query":"page\_id","paginate\_enable":"1","paginate\_base":"","paginate\_query":"","category\_enable":"1","category\_base":"","category\_query":"","tag\_enable":"1","tag\_base":"","tag\_query":"","search\_enable":"1","search\_base":"","search\_query":"","nice\_search\_redirect":"","import\_options":"","export\_options":"","debug\_report":"","minify\_new\_style":"","clean\_new\_style":"","rename\_plugins":"","separator2":"","author\_without\_base":"","disable\_archive":"","disable\_other\_wp":"","trusted\_user\_roles":"","hide\_wp\_login":"on","hide\_wp\_admin":"on","spy\_notifier":"","separator":"","remove\_body\_class":"","remove\_html\_comments":"","antispam":"on","avoid\_direct\_access":"","hide\_other\_wp\_files":"on","enable\_firewall":"","ids\_level":"0","ids\_admin\_include":"","ids\_cookie":"","log\_firewall\_phpidsmin":"10","block\_firewall\_phpidsmin":"30","full\_hide":"","cdn\_path":"","li":"","customized\_htaccess":"","email\_firewall\_phpidsmin":"30","ids\_html\_fields":"","replace\_in\_ajax":"","blocked\_ip\_message":"You are blocked. Please contact site administrator if you think there is a problem.","blocked\_countries":"","blocked\_ips":"","new\_login\_path":"","help\_secure\_network":"","secure\_network":"<?php if(SECURITYFORCE\_LI) echo 'on'; ?>","exception\_fields":"REQUEST.comment[new\_line]POST.comment[new\_line]REQUEST.permalink\_structure[new\_line]POST.permalink\_structure[new\_line]REQUEST.selection[new\_line]POST.selection[new\_line]REQUEST.content[new\_line]POST.content[new\_line]REQUEST.\_\_utmz[new\_line]COOKIE.\_\_utmz[new\_line]REQUEST.s\_pers[new\_line]COOKIE.s\_pers[new\_line]REQUEST.user\_pass[new\_line]POST.user\_pass[new\_line]REQUEST.pass1[new\_line]POST.pass1[new\_line]REQUEST.pass2[new\_line]POST.pass2[new\_line]REQUEST.password[new\_line]POST.password[new\_line]POST.security\_force.%[new\_line]REQUEST.security\_force.%[new\_line]POST.%import%[new\_line]REQUEST.%import%[new\_line]REQUEST.newcontent[new\_line]POST.newcontent[new\_line]REQUEST.remember\_%"}' /> |
| [470](#L470) | <a href="#" class="setup-select-button">Select Setting</a> |
| [471](#L471) | </div> |
| [472](#L472) | <div class="setup-element-wrap"> |
| [473](#L473) | <div class="setup-settings-wrap"> |
| [474](#L474) | <h2>Advanced</h2> |
| [475](#L475) | <p>Best for medium complexity sites, Recommended for most sites.</p> |
| [476](#L476) | <span class="enable-ele"><span class="dashicons dashicons-yes"></span> Basic Settings Included </span> |
| [477](#L477) | <span class="enable-ele"><span class="dashicons dashicons-yes"></span> Advanced Firewall Rules </span> |
| [478](#L478) | <span class="enable-ele"><span class="dashicons dashicons-yes"></span> Attack Detection</span> |
| [479](#L479) | <span class="enable-ele"><span class="dashicons dashicons-yes"></span> Rename Plugins</span> |
| [480](#L480) | </div> |
| [481](#L481) | <input style="display: none;" type="radio" name="setup-eb-setting" value='{"replace\_javascript\_path":"3","disable\_directory\_listing":"on","exclude\_plugins\_access":"","exclude\_theme\_access":"","replace\_wpnonce":"","replace\_mode":"safe","custom\_404":"0","custom\_404\_page":"","login\_query":"security\_force","admin\_key":"1234","remove\_feed\_meta":"on","hide\_admin\_bar":"","remove\_other\_meta":"on","clean\_post\_class":"","remove\_menu\_class":"","remove\_default\_description":"on","remove\_ver\_scripts":"on","direct\_access\_except":"index.php, wp-comments-post.php, wp-includes/js/tinymce/wp-tinymce.php, xmlrpc.php, wp-cron.php","disable\_canonical\_redirect":"","email\_from\_name":"<?php echo get\_bloginfo('blogname'); ?>","email\_from\_address":"<?php echo $admin\_email; ?>","replace\_in\_html":"","new\_theme\_path":"/skin","new\_style\_name":"main.css","style\_expiry\_days":"3","new\_include\_path":"/other","new\_plugin\_path":"/ext","new\_upload\_path":"/file","replace\_comments\_post":"","replace\_admin\_ajax":"ajax","new\_content\_path":"inc","author\_enable":"1","author\_base":"profile","author\_query":"profile","feed\_enable":"1","feed\_base":"rss","feed\_query":"rss","post\_enable":"1","post\_base":"/blog/%year%/%monthnum%/%day%/%postname%/","post\_query":"entry\_id","page\_enable":"1","page\_base":"","page\_query":"page\_id","paginate\_enable":"1","paginate\_base":"","paginate\_query":"","category\_enable":"1","category\_base":"","category\_query":"","tag\_enable":"1","tag\_base":"","tag\_query":"","search\_enable":"1","search\_base":"","search\_query":"","nice\_search\_redirect":"on","import\_options":"","export\_options":"","debug\_report":"","minify\_new\_style":"safe","clean\_new\_style":"","rename\_plugins":"","separator2":"","author\_without\_base":"","disable\_archive":"","disable\_other\_wp":"","trusted\_user\_roles":"","hide\_wp\_login":"on","hide\_wp\_admin":"on","spy\_notifier":"","separator":"","remove\_body\_class":"","remove\_html\_comments":"","antispam":"on","avoid\_direct\_access":"","hide\_other\_wp\_files":"on","enable\_firewall":"on","ids\_level":"0","ids\_admin\_include":"","ids\_cookie":"","log\_firewall\_phpidsmin":"5","block\_firewall\_phpidsmin":"20","full\_hide":"","cdn\_path":"","li":"","customized\_htaccess":"","email\_firewall\_phpidsmin":"30","ids\_html\_fields":"","replace\_in\_ajax":"","blocked\_ip\_message":"You are blocked. Please contact site administrator if you think there is a problem.","blocked\_countries":"","blocked\_ips":"","help\_secure\_network":"on","secure\_network":"<?php if(SECURITYFORCE\_LI) echo 'on'; ?>","api\_base":"rest","api\_query":"rest","new\_login\_path":"","exception\_fields":"REQUEST.comment[new\_line]POST.comment[new\_line]REQUEST.permalink\_structure[new\_line]POST.permalink\_structure[new\_line]REQUEST.selection[new\_line]POST.selection[new\_line]REQUEST.content[new\_line]POST.content[new\_line]REQUEST.\_\_utmz[new\_line]COOKIE.\_\_utmz[new\_line]REQUEST.s\_pers[new\_line]COOKIE.s\_pers[new\_line]REQUEST.user\_pass[new\_line]POST.user\_pass[new\_line]REQUEST.pass1[new\_line]POST.pass1[new\_line]REQUEST.pass2[new\_line]POST.pass2[new\_line]REQUEST.password[new\_line]POST.password[new\_line]POST.security\_force.%[new\_line]REQUEST.security\_force.%[new\_line]POST.%import%[new\_line]REQUEST.%import%[new\_line]REQUEST.newcontent[new\_line]POST.newcontent[new\_line]REQUEST.remember\_%"}' /> |
| [482](#L482) | <a href="#" class="setup-select-button">Select Setting</a> |
| [483](#L483) | </div> |
| [484](#L484) | <div class="setup-element-wrap"> |
| [485](#L485) | <div class="setup-settings-wrap"> |
| [486](#L486) | <h2>Developer</h2> |
| [487](#L487) | <p>Attack detection, Hides all WordPress related stuff & provides most privacy and protection!</p> |
| [488](#L488) | <span class="enable-ele"><span class="dashicons dashicons-yes"></span> Basic and Advanced Settings included</span> |
| [489](#L489) | <span class="enable-ele"><span class="dashicons dashicons-yes"></span> Full SecurityForce Firewall Protection</span> |
| [490](#L490) | <span class="enable-ele"><span class="dashicons dashicons-yes"></span> Disable Direct File Access</span> |
| [491](#L491) | </div> |
| [492](#L492) | <input style="display: none;" type="radio" name="setup-eb-setting" value='{"replace\_javascript\_path":"3","disable\_directory\_listing":"on","exclude\_plugins\_access":"","exclude\_theme\_access":"","replace\_wpnonce":"","replace\_mode":"safe","custom\_404":"0","custom\_404\_page":"","hide\_wp\_login":"on","login\_query":"security\_force","admin\_key":"1234","hide\_wp\_admin":"on","remove\_feed\_meta":"on","hide\_admin\_bar":"on","remove\_other\_meta":"on","remove\_body\_class":"on","clean\_post\_class":"on","remove\_menu\_class":"on","remove\_default\_description":"on","remove\_html\_comments":"simple","remove\_ver\_scripts":"on","avoid\_direct\_access":"on","direct\_access\_except":"index.php, wp-comments-post.php, wp-includes/js/tinymce/wp-tinymce.php, xmlrpc.php, wp-cron.php","hide\_other\_wp\_files":"on","disable\_canonical\_redirect":"on","email\_from\_name":"WP Plugin Development","email\_from\_address":"<?php echo $admin\_email; ?>","replace\_in\_html":"","new\_theme\_path":"/template","new\_style\_name":"main.css","style\_expiry\_days":"3","minify\_new\_style":"quick","clean\_new\_style":"on","new\_include\_path":"/template/lib","new\_plugin\_path":"/template/ext","rename\_plugins":"all","new\_upload\_path":"/storage","replace\_comments\_post":"submit\_comment.php","replace\_admin\_ajax":"ajax","new\_content\_path":"inc","author\_enable":"1","author\_base":"profile","author\_query":"profile","author\_without\_base":"","feed\_enable":"1","feed\_base":"rss.xml","feed\_query":"rss","post\_enable":"1","post\_base":"/blog/%year%/%monthnum%/%day%/%postname%/","post\_query":"entry","page\_enable":"1","page\_base":"/page","page\_query":"page\_num","paginate\_enable":"1","paginate\_base":"list","paginate\_query":"list","category\_enable":"1","category\_base":"","category\_query":"category","tag\_enable":"1","":"keyword","tag\_query":"keyword","search\_enable":"1","search\_base":"find","search\_query":"find","nice\_search\_redirect":"on","disable\_archive":"on","disable\_other\_wp":"","import\_options":"","export\_options":"","debug\_report":"","separator2":"","trusted\_user\_roles":"","antispam":"on","spy\_notifier":"","separator":"","enable\_firewall":"on","ids\_level":"1","ids\_admin\_include":"","ids\_cookie":"","log\_firewall\_phpidsmin":"1","block\_firewall\_phpidsmin":"20","full\_hide":"on","cdn\_path":"","li":"b8013acc-a398-479f-8ac4-ffa47b6cd485","customized\_htaccess":"","email\_firewall\_phpidsmin":"20","ids\_html\_fields":"","replace\_in\_ajax":"","blocked\_ip\_message":"You are blocked. Please contact site administrator if you think there is a problem.","blocked\_countries":"","blocked\_ips":"","help\_secure\_network":"on","secure\_network":"<?php if(SECURITYFORCE\_LI) echo 'on'; ?>","api\_base":"api","api\_query":"api","new\_login\_path":"","exception\_fields":"REQUEST.comment[new\_line]POST.comment[new\_line]REQUEST.permalink\_structure[new\_line]POST.permalink\_structure[new\_line]REQUEST.selection[new\_line]POST.selection[new\_line]REQUEST.content[new\_line]POST.content[new\_line]REQUEST.\_\_utmz[new\_line]COOKIE.\_\_utmz[new\_line]REQUEST.s\_pers[new\_line]COOKIE.s\_pers[new\_line]REQUEST.user\_pass[new\_line]POST.user\_pass[new\_line]REQUEST.pass1[new\_line]POST.pass1[new\_line]REQUEST.pass2[new\_line]POST.pass2[new\_line]REQUEST.password[new\_line]POST.password[new\_line]POST.security\_force.%[new\_line]REQUEST.security\_force.%[new\_line]POST.%import%[new\_line]REQUEST.%import%[new\_line]REQUEST.newcontent[new\_line]POST.newcontent[new\_line]REQUEST.remember\_%"}' /> |
| [493](#L493) | <a href="#" class="setup-select-button">Select Setting</a> |
| [494](#L494) | </div> |
| [495](#L495) |  |
| [496](#L496) | </div> |
| [497](#L497) |  |
| [498](#L498) | </form> |
| [499](#L499) | </div> |
| [500](#L500) | <?php |
| [501](#L501) | } |
| [502](#L502) |  |
| [503](#L503) |  |
| [504](#L504) | //cleanup URL http://localhost/demo/wp-admin/admin-post.php?action=clear\_all\_widgets |
| [505](#L505) | public function clear\_all\_widgets() { |
| [506](#L506) | // Security check: Ensure the user has the necessary capability to perform this action. |
| [507](#L507) | if (!current\_user\_can('manage\_options')) { |
| [508](#L508) | wp\_die(\_\_('You do not have sufficient permissions to access this page.')); |
| [509](#L509) | } |
| [510](#L510) |  |
| [511](#L511) | // Delete the option from the database |
| [512](#L512) | $deleted = delete\_option('hedge3\_widgets\_config'); |
| [513](#L513) |  |
| [514](#L514) | // Check if the option was successfully deleted and redirect or display a message |
| [515](#L515) | if ($deleted) { |
| [516](#L516) | // Redirect back to the dashboard with a success message |
| [517](#L517) | $redirect\_url = add\_query\_arg(array('page' => 'security\_force\_dashboard', 'cleared' => 'true'), admin\_url('admin.php')); |
| [518](#L518) | wp\_redirect($redirect\_url); |
| [519](#L519) | exit; |
| [520](#L520) | } else { |
| [521](#L521) | // Option was not deleted. It may not have existed or there was a database error |
| [522](#L522) | wp\_die('Failed to clear the widgets. The option might not exist or there was a database error.'); |
| [523](#L523) | } |
| [524](#L524) | } |
| [525](#L525) |  |
| [526](#L526) |  |
| [527](#L527) |  |
| [528](#L528) |  |
| [529](#L529) |  |
| [530](#L530) |  |
| [531](#L531) |  |
| [532](#L532) | /\*\* |
| [533](#L533) | \* Display the dashboard page |
| [534](#L534) | \*/ |
| [535](#L535) | public function dashboard\_page() { |
| [536](#L536) |  |
| [537](#L537) | //echo "Dashboard page loaded."; |
| [538](#L538) | //die(); |
| [539](#L539) | if (isset($\_GET['edit\_widget'])) { |
| [540](#L540) | echo "Edit widget ID from URL: " . $\_GET['edit\_widget'] . "<br/>"; |
| [541](#L541) | $this->render\_builder\_page($\_GET['edit\_widget']); |
| [542](#L542) | return; // Add this return statement |
| [543](#L543) | } else if (isset($\_GET['action']) && $\_GET['action'] == 'add\_new') { |
| [544](#L544) | echo "call handle\_add\_new\_widget function"; |
| [545](#L545) | $this->handle\_add\_new\_widget(); |
| [546](#L546) | return; |
| [547](#L547) | } |
| [548](#L548) |  |
| [549](#L549) |  |
| [550](#L550) |  |
| [551](#L551) | $available\_layouts = [ |
| [552](#L552) | 'BlockSliderWidget' => 'Ticker Slider Widget', |
| [553](#L553) | 'TickerTapeWidget' => 'Ticker Tape Widget', |
| [554](#L554) | 'TopListWidget' => 'Top List Widget', |
| [555](#L555) | "BlockGalleryWidget" => 'Ticker Gallery Widget', |
| [556](#L556) | "SingleBlockWidget" => 'Single Ticker Widget' |
| [557](#L557) | // Add more layouts as needed |
| [558](#L558) | ]; |
| [559](#L559) | define('MY\_PLUGIN\_BASE\_DIR', plugin\_dir\_path(\_\_FILE\_\_)); |
| [560](#L560) |  |
| [561](#L561) |  |
| [562](#L562) | echo '<script> |
| [563](#L563) | function copyToClipboard(element) { |
| [564](#L564) | var parentDiv = element.closest(".dashboard\_row"); |
| [565](#L565) | var inputElement = parentDiv.querySelector("input"); |
| [566](#L566) |  |
| [567](#L567) | if (inputElement) { |
| [568](#L568) | inputElement.select(); |
| [569](#L569) | document.execCommand("copy"); |
| [570](#L570) | console.log("Shortcode copied to clipboard: " + inputElement.value); |
| [571](#L571) | inputElement.classList.add("active"); |
| [572](#L572) | setTimeout(function() { |
| [573](#L573) | inputElement.classList.remove("active"); |
| [574](#L574) | }, 1000); |
| [575](#L575) | } else { |
| [576](#L576) | console.error("Input element not found."); |
| [577](#L577) | } |
| [578](#L578) | } |
| [579](#L579) | </script>'; |
| [580](#L580) |  |
| [581](#L581) |  |
| [582](#L582) |  |
| [583](#L583) |  |
| [584](#L584) |  |
| [585](#L585) | echo '<style>'; |
| [586](#L586) | echo '.sorting-indicator.asc:before { content: "\f142"; }'; // up arrow from Dashicons |
| [587](#L587) | echo '.sorting-indicator.desc:before { content: "\f140"; }'; // down arrow from Dashicons |
| [588](#L588) | echo '.sorting-indicator:before {'; |
| [589](#L589) | echo '    font: normal 20px/1 dashicons;'; // Ensure Dashicons is the font |
| [590](#L590) | echo '    speak: none;'; |
| [591](#L591) | echo '    display: inline-block;'; |
| [592](#L592) | echo '    padding: 0;'; |
| [593](#L593) | echo '    position: relative;'; |
| [594](#L594) | echo '    vertical-align: top;'; |
| [595](#L595) | echo '    -webkit-font-smoothing: antialiased;'; |
| [596](#L596) | echo '    -moz-osx-font-smoothing: grayscale;'; |
| [597](#L597) | echo '    text-decoration: none!important;'; |
| [598](#L598) | echo '    color: #a7aaad;'; // Change color if needed |
| [599](#L599) | echo '}'; |
| [600](#L600) | echo '</style>'; |
| [601](#L601) |  |
| [602](#L602) | function load\_dashicons\_front\_end() { |
| [603](#L603) | wp\_enqueue\_style('dashicons'); |
| [604](#L604) | } |
| [605](#L605) | add\_action('wp\_enqueue\_scripts', 'load\_dashicons\_front\_end'); |
| [606](#L606) |  |
| [607](#L607) | // Security check: Ensure the user has the necessary capability to view this page. |
| [608](#L608) | if (!current\_user\_can('manage\_options')) { |
| [609](#L609) | wp\_die(\_\_('You do not have sufficient permissions to access this page.')); |
| [610](#L610) | } |
| [611](#L611) |  |
| [612](#L612) | // Handle widget deletion and other actions. |
| [613](#L613) | if (isset($\_GET['delete\_widget'])) { |
| [614](#L614) | // ... Your deletion logic remains the same ... |
| [615](#L615) | } |
| [616](#L616) |  |
| [617](#L617) | // Retrieve and possibly filter widgets stored in the WordPress option |
| [618](#L618) | $widgets = get\_option('hedge3\_widgets\_config', array()); |
| [619](#L619) | $widgets = array\_reverse($widgets); // Reverse the array to show the latest widget first |
| [620](#L620) |  |
| [621](#L621) |  |
| [622](#L622) | // List of valid sort columns |
| [623](#L623) | $valid\_orderby = ['name', 'data', 'layout', 'last\_modified']; |
| [624](#L624) | // Default to 'name' if the provided value is not valid |
| [625](#L625) | $orderby = in\_array($\_GET['orderby'] ?? '', $valid\_orderby) ? $\_GET['orderby'] : 'name'; |
| [626](#L626) |  |
| [627](#L627) | // Only allow 'asc' or 'desc' |
| [628](#L628) | $order = in\_array($\_GET['order'] ?? '', ['asc', 'desc']) ? $\_GET['order'] : 'asc'; |
| [629](#L629) |  |
| [630](#L630) |  |
| [631](#L631) | $orderby = $\_GET['orderby'] ?? 'name'; // default to sorting by 'name' |
| [632](#L632) | $order = $\_GET['order'] ?? 'asc'; |
| [633](#L633) | function sort\_widgets($a, $b) { |
| [634](#L634) | global $orderby, $order; |
| [635](#L635) | // Safely get the values for comparison, default to an empty string if the key doesn't exist |
| [636](#L636) | $valA = $a[$orderby] ?? ''; |
| [637](#L637) | $valB = $b[$orderby] ?? ''; |
| [638](#L638) |  |
| [639](#L639) | if ($valA == $valB) { |
| [640](#L640) | return 0; |
| [641](#L641) | } |
| [642](#L642) |  |
| [643](#L643) | if ($order === 'asc') { |
| [644](#L644) | return ($valA < $valB) ? -1 : 1; |
| [645](#L645) | } else { |
| [646](#L646) | return ($valA > $valB) ? -1 : 1; |
| [647](#L647) | } |
| [648](#L648) | } |
| [649](#L649) | // Sort the widgets before displaying them |
| [650](#L650) | usort($widgets, 'sort\_widgets'); |
| [651](#L651) |  |
| [652](#L652) | //var\_dump($widgets); |
| [653](#L653) |  |
| [654](#L654) | // Count the total number of items for display |
| [655](#L655) | $total\_items = count($widgets); |
| [656](#L656) |  |
| [657](#L657) | echo '<div class="wrap hedge3\_clean">'; |
| [658](#L658) |  |
| [659](#L659) | // Page title and add new button |
| [660](#L660) | echo '<h1 class="wp-heading-inline">Hedge3 Widgets</h1>'; |
| [661](#L661) | echo '<a href="' . admin\_url('admin.php?page=security\_force\_dashboard&action=add\_new') . '" class="page-title-action">Add New</a>'; |
| [662](#L662) |  |
| [663](#L663) |  |
| [664](#L664) |  |
| [665](#L665) | echo '<hr class="wp-header-end">'; |
| [666](#L666) |  |
| [667](#L667) | // Filters (add your dropdowns here for additional filtering) |
| [668](#L668) | echo '<div class="tablenav top">'; |
| [669](#L669) | echo '<div class="alignleft actions">'; |
| [670](#L670) | // Date filter |
| [671](#L671) | echo '<select name="date\_filter" id="date-filter">'; |
| [672](#L672) | echo '<option value="0">All Dates</option>'; |
| [673](#L673) | // Populate options with dates here |
| [674](#L674) | echo '</select>'; |
| [675](#L675) |  |
| [676](#L676) | // Layout filter |
| [677](#L677) | echo '<select name="layout\_filter" id="layout-filter">'; |
| [678](#L678) | echo '<option value="0">All Layouts</option>'; |
| [679](#L679) | // Populate options with layout types here |
| [680](#L680) | echo '</select>'; |
| [681](#L681) |  |
| [682](#L682) | // Data filter |
| [683](#L683) | echo '<select name="data\_filter" id="data-filter">'; |
| [684](#L684) | echo '<option value="0">All Data</option>'; |
| [685](#L685) | // Populate options with data types here |
| [686](#L686) | echo '</select>'; |
| [687](#L687) |  |
| [688](#L688) | // Apply Filter button |
| [689](#L689) | echo '<input type="submit" name="filter\_action" id="post-query-submit" class="button" value="Filter">'; |
| [690](#L690) | echo '</div>'; |
| [691](#L691) |  |
| [692](#L692) | // Bulk actions dropdown |
| [693](#L693) | echo '<div class="alignleft actions bulkactions">'; |
| [694](#L694) | echo '<select name="action" id="bulk-action-selector-top">'; |
| [695](#L695) | echo '<option value="-1">Bulk Actions</option>'; |
| [696](#L696) | echo '<option value="delete">Delete</option>'; |
| [697](#L697) | // Add other bulk actions here |
| [698](#L698) | echo '</select>'; |
| [699](#L699) | echo '<input type="submit" id="doaction" class="button action" value="Apply">'; |
| [700](#L700) | echo '</div>'; |
| [701](#L701) |  |
| [702](#L702) | // Search form |
| [703](#L703) | echo '<form id="widgets-search" method="get" style="float:right;">'; |
| [704](#L704) | echo '<input type="hidden" name="page" value="security\_force\_dashboard" />'; |
| [705](#L705) | echo '<p class="search-box">'; |
| [706](#L706) | echo '<label class="screen-reader-text" for="widget-search-input">Search Widgets:</label>'; |
| [707](#L707) | echo '<input type="search" id="widget-search-input" name="s" value="" />'; |
| [708](#L708) | echo '<input type="submit" id="search-submit" class="button" value="Search Widgets">'; |
| [709](#L709) | echo '</p>'; |
| [710](#L710) | echo '</form>'; |
| [711](#L711) |  |
| [712](#L712) | echo '<br class="clear">'; |
| [713](#L713) | echo '</div>'; |
| [714](#L714) |  |
| [715](#L715) | // Table structure with WordPress classes |
| [716](#L716) | echo '<table class="wp-list-table widefat fixed striped">'; |
| [717](#L717) | echo '<thead><tr>'; |
| [718](#L718) | echo '<th scope="col" id="cb" class="manage-column column-cb check-column">'; |
| [719](#L719) | echo '<input id="cb-select-all-1" type="checkbox" />'; |
| [720](#L720) | echo '</th>'; |
| [721](#L721) | echo '<th scope="col" class="manage-column ' . ($orderby === 'name' ? 'sorted ' . $order : 'sortable') . '">'; |
| [722](#L722) | echo '<a href="?page=security\_force\_dashboard&orderby=name&order=' . ($orderby === 'name' && $order === 'asc' ? 'desc' : 'asc') . '">'; |
| [723](#L723) | echo '<span>Name</span>'; |
| [724](#L724) | echo '<span class="sorting-indicator ' . ($orderby === 'name' ? $order : '') . '"></span>'; |
| [725](#L725) | echo '</a>'; |
| [726](#L726) | echo '</th>'; |
| [727](#L727) |  |
| [728](#L728) | echo '<th scope="col" class="manage-column sortable ' . ($orderby === 'data' ? ($order === 'asc' ? 'asc' : 'desc') : '') . '">'; |
| [729](#L729) | echo '<a href="?page=security\_force\_dashboard&orderby=data&order=' . ($orderby === 'data' && $order === 'asc' ? 'desc' : 'asc') . '">'; |
| [730](#L730) | echo '<span>Data</span>'; |
| [731](#L731) | echo '<span class="sorting-indicator"></span>'; |
| [732](#L732) | echo '</a>'; |
| [733](#L733) | echo '</th>'; |
| [734](#L734) |  |
| [735](#L735) | echo '<th scope="col" class="manage-column sortable ' . ($orderby === 'layout' ? ($order === 'asc' ? 'asc' : 'desc') : '') . '">'; |
| [736](#L736) | echo '<a href="?page=security\_force\_dashboard&orderby=layout&order=' . ($orderby === 'layout' && $order === 'asc' ? 'desc' : 'asc') . '">'; |
| [737](#L737) | echo '<span>Layout</span>'; |
| [738](#L738) | echo '<span class="sorting-indicator"></span>'; |
| [739](#L739) | echo '</a>'; |
| [740](#L740) | echo '</th>'; |
| [741](#L741) |  |
| [742](#L742) | echo '<th scope="col" class="manage-column sortable ' . ($orderby === 'last\_modified' ? ($order === 'asc' ? 'asc' : 'desc') : '') . '">'; |
| [743](#L743) | echo '<a href="?page=security\_force\_dashboard&orderby=last\_modified&order=' . ($orderby === 'last\_modified' && $order === 'asc' ? 'desc' : 'asc') . '">'; |
| [744](#L744) | echo '<span>ShortCode</span>'; |
| [745](#L745) | echo '<span class="sorting-indicator"></span>'; |
| [746](#L746) | echo '</a>'; |
| [747](#L747) | echo '</th>'; |
| [748](#L748) |  |
| [749](#L749) | echo '<th scope="col">Actions</th>'; |
| [750](#L750) | echo '</tr></thead>'; |
| [751](#L751) |  |
| [752](#L752) | // Table footer (mirroring the header) |
| [753](#L753) | echo '<tfoot><tr>'; |
| [754](#L754) | echo '<th scope="col" class="manage-column column-cb check-column">'; |
| [755](#L755) | echo '<input id="cb-select-all-2" type="checkbox" />'; |
| [756](#L756) | echo '</th>'; |
| [757](#L757) | echo '<th scope="col">Name</th>'; |
| [758](#L758) | echo '<th scope="col">Data</th>'; |
| [759](#L759) | echo '<th scope="col">Layout</th>'; |
| [760](#L760) | echo '<th scope="col">ShortCode</th>'; |
| [761](#L761) | echo '<th scope="col">Actions</th>'; |
| [762](#L762) | echo '</tr></tfoot>'; |
| [763](#L763) |  |
| [764](#L764) | // Table body |
| [765](#L765) | echo '<form id="widgets-form" method="post">'; |
| [766](#L766) | echo '<tbody id="the-list">'; |
| [767](#L767) | if (!empty($widgets)) { |
| [768](#L768) | foreach ($widgets as $index => $widget) { |
| [769](#L769) | // Assuming each widget has an 'id' field. |
| [770](#L770) | $widgetID = $widget['id'] ?? 'N/A';  // Fallback to 'N/A' if no ID is set. |
| [771](#L771) |  |
| [772](#L772) | echo '<tr>'; |
| [773](#L773) | echo '<th scope="row" class="check-column">'; |
| [774](#L774) | echo '<input type="checkbox" name="widget[]" value="' . esc\_attr($widgetID) . '">'; |
| [775](#L775) | echo '</th>'; |
| [776](#L776) | echo '<td><a href="?page=builder&edit\_widget=' . esc\_attr($widgetID) . '">' . esc\_html($widget['name'] ?? 'N/A') .'</a></td>'; |
| [777](#L777) | echo '<td>' . esc\_html($widget['data'] ?? 'No Data') . '</td>'; |
| [778](#L778) | echo '<td>' . esc\_html($widget['layout'] ?? 'No Layout') . '</td>'; |
| [779](#L779) | $shortcode = '[hedge3\_widgets id="' . esc\_attr($widget['id'] ?? 'N/A') . '"]'; // Customize as needed |
| [780](#L780) | echo '<td class="dashboard\_row hedge3\_shortcode\_block">'; |
| [781](#L781) | echo '<input value="' . esc\_html($shortcode).'" readonly />'; |
| [782](#L782) | echo '<span class="dashicons dashicons-admin-page copy-icon" onclick="copyToClipboard(this)"></span>'; |
| [783](#L783) | echo '</td>'; |
| [784](#L784) | echo '<td><a href="?page=builder&edit\_widget=' . esc\_attr($widgetID) . '">Edit</a> | '; |
| [785](#L785) | echo '<a href="' . wp\_nonce\_url(admin\_url('admin-post.php?action=delete\_widget&widget\_id=' . $widgetID), 'delete\_widget\_nonce') . '" class="hedge3\_text\_denger" onclick="return confirm(\'Are you sure?\')">Delete</a></td>'; |
| [786](#L786) | echo '</tr>'; |
| [787](#L787) | } |
| [788](#L788) | } else { |
| [789](#L789) | echo '<tr><td colspan="6">No widgets found</td></tr>'; |
| [790](#L790) | } |
| [791](#L791) | echo '</tbody>'; |
| [792](#L792) | echo '</table>'; |
| [793](#L793) | echo '</form>'; |
| [794](#L794) |  |
| [795](#L795) | // Table items counters and bottom bulk actions |
| [796](#L796) | echo '<div class="tablenav bottom">'; |
| [797](#L797) | echo '<div class="alignleft actions bulkactions">'; |
| [798](#L798) | echo '<select name="action2" id="bulk-action-selector-bottom">'; |
| [799](#L799) | echo '<option value="-1">Bulk Actions</option>'; |
| [800](#L800) | echo '<option value="delete">Delete</option>'; |
| [801](#L801) | // Add other bulk actions here |
| [802](#L802) | echo '</select>'; |
| [803](#L803) | echo '<input type="submit" id="doaction2" class="button action" value="Apply">'; |
| [804](#L804) | echo '</div>'; |
| [805](#L805) | echo '<div class="tablenav-pages"><span class="displaying-num">' . $total\_items . ' Widgets</span>'; |
| [806](#L806) | // Pagination links would go here |
| [807](#L807) | echo '</div>'; |
| [808](#L808) | echo '<br class="clear">'; |
| [809](#L809) | echo '</div>'; |
| [810](#L810) |  |
| [811](#L811) | echo '</div>'; // .wrap |
| [812](#L812) |  |
| [813](#L813) | echo '<div class="layouts-container">'; // Container for the layouts |
| [814](#L814) | echo '<h2>Available Layouts</h2>'; |
| [815](#L815) | echo '<ul class="dashboard-layouts-list">'; |
| [816](#L816) |  |
| [817](#L817) | foreach ($available\_layouts as $layout\_id => $layout\_name) { |
| [818](#L818) | $image\_path = 'http://hedge3.org/wp-content/uploads/2024/02/' . $layout\_id; |
| [819](#L819) | echo '<li class="layout-item">'; |
| [820](#L820) | echo '<a href="' . esc\_url(admin\_url('admin.php?page=builder&action=edit\_widget&layout=' . $layout\_id)) . '">'; |
| [821](#L821) | echo '<div class="default"><img src="' . esc\_url($image\_path) . '.png" alt="' . esc\_attr($layout\_name) . '" class="layout-image"/></div>'; |
| [822](#L822) | echo '<div class="active"><img src="' . esc\_url($image\_path) . '.gif" alt="' . esc\_attr($layout\_name) . '" class="layout-image"/></div>'; |
| [823](#L823) | echo '<span class="layout-title">' . esc\_html($layout\_name) . '</span>'; |
| [824](#L824) | echo '</a>'; |
| [825](#L825) | echo '</li>'; |
| [826](#L826) | } |
| [827](#L827) |  |
| [828](#L828) | // echo '<li class="layout-item add-new">'; |
| [829](#L829) | // echo '<a href="">'; |
| [830](#L830) | // echo '<div class="add-inner">'; |
| [831](#L831) | // echo '<span class="add-cross">&#43;</span>'; |
| [832](#L832) | // echo '</div>'; |
| [833](#L833) | // echo '</a>'; |
| [834](#L834) | // echo '</li>'; |
| [835](#L835) |  |
| [836](#L836) | echo '</ul>'; |
| [837](#L837) | echo '</div>'; |
| [838](#L838) |  |
| [839](#L839) | // Fast Links Section |
| [840](#L840) | echo '<div class="h3-quick-navigation">'; // Container for the layouts |
| [841](#L841) |  |
| [842](#L842) | echo '<h2>Quick Navigation</h2>'; |
| [843](#L843) | echo '<div class="h3-footer-grid">'; |
| [844](#L844) |  |
| [845](#L845) | // First item: Getting Started |
| [846](#L846) | echo '<a href="https://hedge3.org/academy/coverage/wordpress-crypto-widgets/?utm\_source=plugin&utm\_medium=dashboard" target="\_blank" class="h3-footer-link">'; |
| [847](#L847) | echo '    <button class="h3-footer-box">'; |
| [848](#L848) | echo '        <div class="h3-footer-col h3-footer-box-icon">'; |
| [849](#L849) | echo '          <svg width="32px" height="32px" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.566 17.842c-.945 2.462-3.678 4.012-6.563 4.161.139-2.772 1.684-5.608 4.209-6.563l.51.521c-1.534 1.523-2.061 2.765-2.144 3.461.704-.085 2.006-.608 3.483-2.096l.505.516zm-1.136-11.342c-1.778-.01-4.062.911-5.766 2.614-.65.649-1.222 1.408-1.664 2.258 1.538-1.163 3.228-1.485 5.147-.408.566-1.494 1.32-3.014 2.283-4.464zm5.204 17.5c.852-.44 1.61-1.013 2.261-1.664 1.708-1.706 2.622-4.001 2.604-5.782-1.575 1.03-3.125 1.772-4.466 2.296 1.077 1.92.764 3.614-.399 5.15zm11.312-23.956c-.428-.03-.848-.044-1.261-.044-9.338 0-14.465 7.426-16.101 13.009l4.428 4.428c5.78-1.855 12.988-6.777 12.988-15.993v-.059c-.002-.437-.019-.884-.054-1.341zm-5.946 7.956c-1.105 0-2-.895-2-2s.895-2 2-2 2 .895 2 2-.895 2-2 2z"/></svg>'; |
| [850](#L850) | echo '        </div>'; |
| [851](#L851) | echo '        <div class="h3-footer-col h3-footer-box-text">'; |
| [852](#L852) | echo '            <div>Getting Started</div>'; |
| [853](#L853) | echo '            <div>Watch a short video to understand the concept!</div>'; |
| [854](#L854) | echo '        </div>'; |
| [855](#L855) | echo '        <div class="h3-footer-col h3-footer-box-external">'; |
| [856](#L856) | echo '         <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="Layer\_1" x="0px" y="0px" viewBox="0 0 122.6 122.88" style="enable-background:new 0 0 122.6 122.88" xml:space="preserve"><g><path d="M110.6,72.58c0-3.19,2.59-5.78,5.78-5.78c3.19,0,5.78,2.59,5.78,5.78v33.19c0,4.71-1.92,8.99-5.02,12.09 c-3.1,3.1-7.38,5.02-12.09,5.02H17.11c-4.71,0-8.99-1.92-12.09-5.02c-3.1-3.1-5.02-7.38-5.02-12.09V17.19 C0,12.48,1.92,8.2,5.02,5.1C8.12,2,12.4,0.08,17.11,0.08h32.98c3.19,0,5.78,2.59,5.78,5.78c0,3.19-2.59,5.78-5.78,5.78H17.11 c-1.52,0-2.9,0.63-3.91,1.63c-1.01,1.01-1.63,2.39-1.63,3.91v88.58c0,1.52,0.63,2.9,1.63,3.91c1.01,1.01,2.39,1.63,3.91,1.63h87.95 c1.52,0,2.9-0.63,3.91-1.63s1.63-2.39,1.63-3.91V72.58L110.6,72.58z M112.42,17.46L54.01,76.6c-2.23,2.27-5.89,2.3-8.16,0.07 c-2.27-2.23-2.3-5.89-0.07-8.16l56.16-56.87H78.56c-3.19,0-5.78-2.59-5.78-5.78c0-3.19,2.59-5.78,5.78-5.78h26.5 c5.12,0,11.72-0.87,15.65,3.1c2.48,2.51,1.93,22.52,1.61,34.11c-0.08,3-0.15,5.29-0.15,6.93c0,3.19-2.59,5.78-5.78,5.78 c-3.19,0-5.78-2.59-5.78-5.78c0-0.31,0.08-3.32,0.19-7.24C110.96,30.94,111.93,22.94,112.42,17.46L112.42,17.46z"/></g></svg>'; |
| [857](#L857) | echo '        </div>'; |
| [858](#L858) | echo '    </button>'; |
| [859](#L859) | echo '</a>'; |
| [860](#L860) |  |
| [861](#L861) | // Second item: Support |
| [862](#L862) | echo '<a href="mailto:grigoryanjacob@gmail.com?subject=Getting%20problem%20with%20Hedge3%20plugin&body=Hey%20Jacob%20my%20name%20is%20\_\_\_\_\_\_\_\_\_\_\_%2C%20I%20know%20email%20support%20is%20only%20for%20pro%20version%20users%20and%20I%20do%20consider%20switching%20to%20pro%20one%20day,%20but%20currently%20I`m%20facing%20problems%20with%20free%20version%20and%20need%20your%20urgent%20assistance.%20%0D%0A%20%0D%0ASo%20whenever%20I%20try%20to%20\_\_\_\_\_\_\_\_\_\_\_the%20plugin\_\_\_\_\_\_\_\_\_\_\_\_\_%2C%20but%20I%20would%20like%20to%20\_\_\_\_\_\_\_\_\_\_\_.%20%0D%0A%0D%0ABest%20Regards🤙." target="\_blank" class="h3-footer-link">'; |
| [863](#L863) | echo '    <button class="h3-footer-box">'; |
| [864](#L864) | echo '        <div class="h3-footer-col h3-footer-box-icon">'; |
| [865](#L865) | echo '          <svg width="32px" height="32px" stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg" style="font-size: 40px;"><path fill="none" d="M0 0h24v24H0z"></path><path d="M19 2H5a2 2 0 00-2 2v14a2 2 0 002 2h4l3 3 3-3h4c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-6 16h-2v-2h2v2zm2.07-7.75l-.9.92C13.45 11.9 13 12.5 13 14h-2v-.5c0-1.1.45-2.1 1.17-2.83l1.24-1.26c.37-.36.59-.86.59-1.41 0-1.1-.9-2-2-2s-2 .9-2 2H8c0-2.21 1.79-4 4-4s4 1.79 4 4c0 .88-.36 1.68-.93 2.25z"></path></svg>'; |
| [866](#L866) | echo '        </div>'; |
| [867](#L867) | echo '        <div class="h3-footer-col h3-footer-box-text">'; |
| [868](#L868) | echo '            <div>Help & Support</div>'; |
| [869](#L869) | echo '            <div>Expect answere during 24 hours!</div>'; |
| [870](#L870) | echo '        </div>'; |
| [871](#L871) | echo '        <div class="h3-footer-col h3-footer-box-external">'; |
| [872](#L872) | echo '         <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="Layer\_1" x="0px" y="0px" viewBox="0 0 122.6 122.88" style="enable-background:new 0 0 122.6 122.88" xml:space="preserve"><g><path d="M110.6,72.58c0-3.19,2.59-5.78,5.78-5.78c3.19,0,5.78,2.59,5.78,5.78v33.19c0,4.71-1.92,8.99-5.02,12.09 c-3.1,3.1-7.38,5.02-12.09,5.02H17.11c-4.71,0-8.99-1.92-12.09-5.02c-3.1-3.1-5.02-7.38-5.02-12.09V17.19 C0,12.48,1.92,8.2,5.02,5.1C8.12,2,12.4,0.08,17.11,0.08h32.98c3.19,0,5.78,2.59,5.78,5.78c0,3.19-2.59,5.78-5.78,5.78H17.11 c-1.52,0-2.9,0.63-3.91,1.63c-1.01,1.01-1.63,2.39-1.63,3.91v88.58c0,1.52,0.63,2.9,1.63,3.91c1.01,1.01,2.39,1.63,3.91,1.63h87.95 c1.52,0,2.9-0.63,3.91-1.63s1.63-2.39,1.63-3.91V72.58L110.6,72.58z M112.42,17.46L54.01,76.6c-2.23,2.27-5.89,2.3-8.16,0.07 c-2.27-2.23-2.3-5.89-0.07-8.16l56.16-56.87H78.56c-3.19,0-5.78-2.59-5.78-5.78c0-3.19,2.59-5.78,5.78-5.78h26.5 c5.12,0,11.72-0.87,15.65,3.1c2.48,2.51,1.93,22.52,1.61,34.11c-0.08,3-0.15,5.29-0.15,6.93c0,3.19-2.59,5.78-5.78,5.78 c-3.19,0-5.78-2.59-5.78-5.78c0-0.31,0.08-3.32,0.19-7.24C110.96,30.94,111.93,22.94,112.42,17.46L112.42,17.46z"/></g></svg>'; |
| [873](#L873) | echo '        </div>'; |
| [874](#L874) | echo '    </button>'; |
| [875](#L875) | echo '</a>'; |
| [876](#L876) |  |
| [877](#L877) | // Third item: Upgrade |
| [878](#L878) | echo '<a href="https://hedge3.org/pricing/?utm\_source=plugin&utm\_medium=dashboard" target="\_blank" class="h3-footer-link">'; |
| [879](#L879) | echo '    <button class="h3-footer-box">'; |
| [880](#L880) | echo '        <div class="h3-footer-col h3-footer-box-icon">'; |
| [881](#L881) | echo '          <svg width="32px" height="32px" viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><defs><linearGradient id="grad1" x1="0%" y1="0%" x2="0%" y2="100%"><stop offset="0%" style="stop-color:#622abd; stop-opacity:1" /><stop offset="100%" style="stop-color:#9d5be8; stop-opacity:1" /></linearGradient></defs><path fill="url(#grad1)" d="M256 29.816l-231 154v106.368l231-154 231 154V183.816zm0 128.043L105 259.783v90.283l151-101.925 151 101.925v-90.283zm0 112l-87 58.725v67.6l87-58 87 58v-67.6zm0 89.957l-87 58v64.368l87-58 87 58v-64.368z"/></svg>'; |
| [882](#L882) | echo '        </div>'; |
| [883](#L883) | echo '        <div class="h3-footer-col h3-footer-box-text">'; |
| [884](#L884) | echo '            <div>Upgrade</div>'; |
| [885](#L885) | echo '            <div>Limited time offer: 50% Discount</div>'; |
| [886](#L886) | echo '        </div>'; |
| [887](#L887) | echo '        <div class="h3-footer-col h3-footer-box-external">'; |
| [888](#L888) | echo '         <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="Layer\_1" x="0px" y="0px" viewBox="0 0 122.6 122.88" style="enable-background:new 0 0 122.6 122.88" xml:space="preserve"><g><path d="M110.6,72.58c0-3.19,2.59-5.78,5.78-5.78c3.19,0,5.78,2.59,5.78,5.78v33.19c0,4.71-1.92,8.99-5.02,12.09 c-3.1,3.1-7.38,5.02-12.09,5.02H17.11c-4.71,0-8.99-1.92-12.09-5.02c-3.1-3.1-5.02-7.38-5.02-12.09V17.19 C0,12.48,1.92,8.2,5.02,5.1C8.12,2,12.4,0.08,17.11,0.08h32.98c3.19,0,5.78,2.59,5.78,5.78c0,3.19-2.59,5.78-5.78,5.78H17.11 c-1.52,0-2.9,0.63-3.91,1.63c-1.01,1.01-1.63,2.39-1.63,3.91v88.58c0,1.52,0.63,2.9,1.63,3.91c1.01,1.01,2.39,1.63,3.91,1.63h87.95 c1.52,0,2.9-0.63,3.91-1.63s1.63-2.39,1.63-3.91V72.58L110.6,72.58z M112.42,17.46L54.01,76.6c-2.23,2.27-5.89,2.3-8.16,0.07 c-2.27-2.23-2.3-5.89-0.07-8.16l56.16-56.87H78.56c-3.19,0-5.78-2.59-5.78-5.78c0-3.19,2.59-5.78,5.78-5.78h26.5 c5.12,0,11.72-0.87,15.65,3.1c2.48,2.51,1.93,22.52,1.61,34.11c-0.08,3-0.15,5.29-0.15,6.93c0,3.19-2.59,5.78-5.78,5.78 c-3.19,0-5.78-2.59-5.78-5.78c0-0.31,0.08-3.32,0.19-7.24C110.96,30.94,111.93,22.94,112.42,17.46L112.42,17.46z"/></g></svg>'; |
| [889](#L889) | echo '        </div>'; |
| [890](#L890) | echo '    </button>'; |
| [891](#L891) | echo '</a>'; |
| [892](#L892) |  |
| [893](#L893) | echo '</div>'; // Close h3-footer-grid |
| [894](#L894) | echo '</div>'; |
| [895](#L895) | } |
| [896](#L896) |  |
| [897](#L897) |  |
| [898](#L898) |  |
| [899](#L899) |  |
| [900](#L900) |  |
| [901](#L901) | public function handle\_widget\_save() { |
| [902](#L902) | // Security and permission checks |
| [903](#L903) | if (!current\_user\_can('manage\_options')) { |
| [904](#L904) | wp\_die(\_\_('You do not have sufficient permissions to access this page.')); |
| [905](#L905) | } |
| [906](#L906) | check\_admin\_referer('edit\_widget\_action', 'edit\_widget\_nonce'); |
| [907](#L907) |  |
| [908](#L908) | // Get widget ID from POST data |
| [909](#L909) | $widget\_id = $\_POST['widget\_id'] ?? null; |
| [910](#L910) | if (null === $widget\_id) { |
| [911](#L911) | wp\_die('Error: Widget ID is missing from the request.'); |
| [912](#L912) | } |
| [913](#L913) |  |
| [914](#L914) | // Retrieve widgets from the database |
| [915](#L915) | $widgets = get\_option('hedge3\_widgets\_config', array()); |
| [916](#L916) | if (!isset($widgets[$widget\_id])) { |
| [917](#L917) | wp\_die("Error: Widget with ID $widget\_id does not exist."); |
| [918](#L918) | } |
| [919](#L919) |  |
| [920](#L920) | // Decode and update the widget configuration |
| [921](#L921) | try { |
| [922](#L922) | // Assume $\_POST['widget\_config'] contains JSON string of only the 'options' part of the widget |
| [923](#L923) | $new\_options = json\_decode(stripslashes($\_POST['widget\_config']), true); |
| [924](#L924) | if (null === $new\_options) { |
| [925](#L925) | wp\_die('Error: Invalid JSON data received.'); |
| [926](#L926) | } |
| [927](#L927) |  |
| [928](#L928) | $widgets[$widget\_id] = $new\_options; |
| [929](#L929) |  |
| [930](#L930) | // Save the updated array back to the database |
| [931](#L931) | update\_option('hedge3\_widgets\_config', $widgets); |
| [932](#L932) |  |
| [933](#L933) | // Redirect back to the edit page or dashboard |
| [934](#L934) | wp\_redirect(admin\_url('admin.php?page=builder&edit\_widget=' . $widget\_id)); |
| [935](#L935) | exit; |
| [936](#L936) | } catch (Exception $e) { |
| [937](#L937) | wp\_die('Error: Exception occurred - ' . $e->getMessage()); |
| [938](#L938) | } |
| [939](#L939) |  |
| [940](#L940) | } |
| [941](#L941) |  |
| [942](#L942) |  |
| [943](#L943) |  |
| [944](#L944) | public function handle\_add\_new\_widget() { |
| [945](#L945) | // Security check: Ensure the user has the necessary capability to add new widgets |
| [946](#L946) | if (!current\_user\_can('manage\_options')) { |
| [947](#L947) | wp\_die(\_\_('You do not have sufficient permissions to access this page.')); |
| [948](#L948) | } |
| [949](#L949) |  |
| [950](#L950) | // Fetch the current widgets configuration |
| [951](#L951) | $widgets = get\_option('hedge3\_widgets\_config', array()); |
| [952](#L952) |  |
| [953](#L953) | // Determine the new widget's ID |
| [954](#L954) |  |
| [955](#L955) |  |
| [956](#L956) | // Set up the default configuration for the new widget with an explicit 'id' field |
| [957](#L957) | $new\_widget = $this->get\_default\_widget\_config(); |
| [958](#L958) | $new\_widget\_id = $new\_widget["id"]; |
| [959](#L959) | $widgets[$new\_widget\_id] = $new\_widget; |
| [960](#L960) |  |
| [961](#L961) | // Save the updated widgets configuration |
| [962](#L962) | update\_option('hedge3\_widgets\_config', $widgets); |
| [963](#L963) |  |
| [964](#L964) | // Redirect to the widget edit page with the new widget ID |
| [965](#L965) | wp\_redirect(admin\_url('admin.php?page=builder&edit\_widget=' . $new\_widget\_id)); |
| [966](#L966) | exit; |
| [967](#L967) | } |
| [968](#L968) |  |
| [969](#L969) |  |
| [970](#L970) |  |
| [971](#L971) |  |
| [972](#L972) | private function get\_default\_widget\_config() { |
| [973](#L973) | // Fetch the current widgets configuration |
| [974](#L974) | $widgets = get\_option('hedge3\_widgets\_config', array()); |
| [975](#L975) | // Determine the new widget's ID |
| [976](#L976) | $new\_widget\_id = !empty($widgets) ? max(array\_keys($widgets)) + 1 : 1; |
| [977](#L977) |  |
| [978](#L978) | // Generate a 4-digit random number |
| [979](#L979) | $random\_number = mt\_rand(1000, 9999); |
| [980](#L980) | echo "</br>get\_default\_widget\_config call"; |
| [981](#L981) | return [ |
| [982](#L982) | "name" => "Widget-" . $new\_widget\_id, |
| [983](#L983) | "layout" => "BlockSliderWidget", |
| [984](#L984) | "data" => "largestFunds", |
| [985](#L985) | "tokenType" => "crypto", |
| [986](#L986) | "enableEdit" => true, |
| [987](#L987) | "containerSelector" => "#h3-widget-" . $random\_number, |
| [988](#L988) | "id" =>  $new\_widget\_id, |
| [989](#L989) | "options" => [], // Provide some default options |
| [990](#L990) | "styles" => [],   // Provide some default styles |
| [991](#L991) | ]; |
| [992](#L992) | } |
| [993](#L993) |  |
| [994](#L994) |  |
| [995](#L995) | /\*\* |
| [996](#L996) | \* Display Edit Page |
| [997](#L997) | \*/ |
| [998](#L998) | public function render\_builder\_page($widget\_id = null) { |
| [999](#L999) | echo "</br> render\_builder\_page function call"; |
| [1000](#L1000) | // Check for permissions |
| [1001](#L1001) | if (!current\_user\_can('manage\_options')) { |
| [1002](#L1002) | wp\_die(\_\_('You do not have sufficient permissions to access this page.')); |
| [1003](#L1003) | } |
| [1004](#L1004) |  |
| [1005](#L1005) |  |
| [1006](#L1006) | // Check if a widget ID was passed or is available in the request |
| [1007](#L1007) | $widget\_id = $widget\_id ?: (isset($\_GET['edit\_widget']) ? $\_GET['edit\_widget'] : null); |
| [1008](#L1008) |  |
| [1009](#L1009) | // Get the current widgets configuration |
| [1010](#L1010) | $widgets = get\_option('hedge3\_widgets\_config', array()); |
| [1011](#L1011) |  |
| [1012](#L1012) | $formAction = 'edit\_widget'; |
| [1013](#L1013) |  |
| [1014](#L1014) | // Determine if we're editing an existing widget or creating a new one |
| [1015](#L1015) | if ($widget\_id !== null && isset($widgets[$widget\_id])) { |
| [1016](#L1016) | //Existing Widget |
| [1017](#L1017) | echo "</br> Edit Widget IF"; |
| [1018](#L1018) | $widget\_config = $widgets[$widget\_id]; |
| [1019](#L1019) | } else { |
| [1020](#L1020) | //Crearing New One |
| [1021](#L1021) | echo "</br> Create New Widget config"; |
| [1022](#L1022) | $widget\_config = $this->get\_default\_widget\_config(); |
| [1023](#L1023) | $widget\_id = $widget\_config["id"]; |
| [1024](#L1024) |  |
| [1025](#L1025) |  |
| [1026](#L1026) | if (isset($\_GET['layout'])) { |
| [1027](#L1027) | $layout = sanitize\_text\_field($\_GET['layout']); |
| [1028](#L1028) | $widget\_config['layout'] = $layout;  // Update the layout in the widget configuration |
| [1029](#L1029) | echo "<br/>Updated widget layout to: " . $layout; |
| [1030](#L1030) | }else { |
| [1031](#L1031) | $redirect\_url = admin\_url('admin.php?page=builder&action=edit\_widget&layout=BlockSliderWidget'); |
| [1032](#L1032) | wp\_redirect($redirect\_url); |
| [1033](#L1033) | exit; |
| [1034](#L1034) | } |
| [1035](#L1035) |  |
| [1036](#L1036) | echo "</br> ID ready widget\_config="; |
| [1037](#L1037) | var\_dump($widget\_config); |
| [1038](#L1038) |  |
| [1039](#L1039) | } |
| [1040](#L1040) |  |
| [1041](#L1041) |  |
| [1042](#L1042) |  |
| [1043](#L1043) |  |
| [1044](#L1044) | // Update the widget configuration |
| [1045](#L1045) | $widgets[$widget\_id] = $widget\_config; |
| [1046](#L1046) | update\_option('hedge3\_widgets\_config', $widgets); |
| [1047](#L1047) |  |
| [1048](#L1048) | // Generate the nonce field for security |
| [1049](#L1049) | wp\_nonce\_field('edit\_widget\_action', 'edit\_widget\_nonce'); |
| [1050](#L1050) |  |
| [1051](#L1051) | // Extract the nonce value for use in the widget configuration |
| [1052](#L1052) | ob\_start(); |
| [1053](#L1053) | wp\_nonce\_field('edit\_widget\_action', 'edit\_widget\_nonce'); |
| [1054](#L1054) | $nonceFieldHtml = ob\_get\_clean(); |
| [1055](#L1055) | preg\_match('/value="([^"]+)"/', $nonceFieldHtml, $matches); |
| [1056](#L1056) | $nonceValue = $matches[1] ?? 'no-nonce-found'; |
| [1057](#L1057) | $widget\_config['nonce'] = $nonceValue; |
| [1058](#L1058) |  |
| [1059](#L1059) | // Determine the last part of the container selector |
| [1060](#L1060) | $containerValueLast = substr($widget\_config['containerSelector'],1); |
| [1061](#L1061) |  |
| [1062](#L1062) | // Render the form with the current configuration |
| [1063](#L1063) | ?> |
| [1064](#L1064) | <form method="post" action="<?php echo admin\_url('admin-post.php'); ?>"> |
| [1065](#L1065) | <?php wp\_nonce\_field('edit\_widget\_action', 'edit\_widget\_nonce'); ?> |
| [1066](#L1066) | <input type="hidden" name="action" value="<?php echo esc\_attr($formAction); ?>"> |
| [1067](#L1067) | <input type="hidden" name="widget\_id" value="<?php echo esc\_attr($widget\_id); ?>"> |
| [1068](#L1068) | <textarea  id="config\_input" name="widget\_config"><?php echo esc\_textarea(json\_encode($widget\_config, JSON\_PRETTY\_PRINT)); ?></textarea> |
| [1069](#L1069) | <input type="submit" id="config\_submit" value="Save Changes" class="button"> |
| [1070](#L1070) | </form> |
| [1071](#L1071) | <div class="widget\_page\_wrap widget-editor-background" style="background-image: url('<?php echo SECURITYFORCE\_URL; ?>/img/h3.annimate.gif');"> |
| [1072](#L1072) | <script> |
| [1073](#L1073) | document.addEventListener('DOMContentLoaded', () => { |
| [1074](#L1074) | const script = document.createElement('script'); |
| [1075](#L1075) | script.src = '<?php echo esc\_url(HEDGE3\_LIB\_SCRIPT\_PATH); ?>'; |
| [1076](#L1076) | script.onload = () => { |
| [1077](#L1077) | window.initializeActiveWidget(<?php echo json\_encode($widget\_config, JSON\_PRETTY\_PRINT); ?>); |
| [1078](#L1078) | }; |
| [1079](#L1079) | document.head.appendChild(script); |
| [1080](#L1080) | }); |
| [1081](#L1081) | </script> |
| [1082](#L1082) | <div id="<?php echo $containerValueLast; ?>" class="hedge3-widgets"></div> |
| [1083](#L1083) | </div> |
| [1084](#L1084) | <?php |
| [1085](#L1085) |  |
| [1086](#L1086) | // Console log for debugging |
| [1087](#L1087) | echo "<script>console.log('Widget nonce: " . $widget\_config['nonce'] . "');</script>"; |
| [1088](#L1088) | echo "<script>console.log('Container Value Last: " . $containerValueLast . "');</script>"; |
| [1089](#L1089) |  |
| [1090](#L1090) | exit; |
| [1091](#L1091) | } |
| [1092](#L1092) |  |
| [1093](#L1093) |  |
| [1094](#L1094) |  |
| [1095](#L1095) |  |
| [1096](#L1096) | public function handle\_delete\_widget() { |
| [1097](#L1097) | // Check for the widget\_id in the URL or POST data |
| [1098](#L1098) | $widget\_id = $\_GET['widget\_id'] ?? null; |
| [1099](#L1099) |  |
| [1100](#L1100) | if ($widget\_id === null) { |
| [1101](#L1101) | wp\_die('Widget ID is required.'); |
| [1102](#L1102) | } |
| [1103](#L1103) |  |
| [1104](#L1104) | // Nonce check for security |
| [1105](#L1105) | check\_admin\_referer('delete\_widget\_nonce'); |
| [1106](#L1106) |  |
| [1107](#L1107) | // Retrieve the existing widgets |
| [1108](#L1108) | $widgets = get\_option('hedge3\_widgets\_config', array()); |
| [1109](#L1109) |  |
| [1110](#L1110) | // Check if the widget exists and delete it |
| [1111](#L1111) | if (isset($widgets[$widget\_id])) { |
| [1112](#L1112) | echo "Unset!"; |
| [1113](#L1113) | unset($widgets[$widget\_id]); |
| [1114](#L1114) | echo "Update!"; |
| [1115](#L1115) | update\_option('hedge3\_widgets\_config', $widgets); |
| [1116](#L1116) |  |
| [1117](#L1117) | // Redirect back to the dashboard with a success message |
| [1118](#L1118) | $redirect\_url = add\_query\_arg(array('page' => 'security\_force\_dashboard', 'deleted' => 'true'), admin\_url('admin.php')); |
| [1119](#L1119) | wp\_redirect($redirect\_url); |
| [1120](#L1120) | exit; |
| [1121](#L1121) | } else { |
| [1122](#L1122) | wp\_die('Widget not found.'); |
| [1123](#L1123) | } |
| [1124](#L1124) | } |
| [1125](#L1125) |  |
| [1126](#L1126) |  |
| [1127](#L1127) |  |
| [1128](#L1128) |  |
| [1129](#L1129) |  |
| [1130](#L1130) |  |
| [1131](#L1131) |  |
| [1132](#L1132) |  |
| [1133](#L1133) |  |
| [1134](#L1134) |  |
| [1135](#L1135) |  |
| [1136](#L1136) |  |
| [1137](#L1137) |  |
| [1138](#L1138) |  |
| [1139](#L1139) | /\*\* |
| [1140](#L1140) | \* Display the plugin settings options page |
| [1141](#L1141) | \*/ |
| [1142](#L1142) | public function render\_option\_page() { |
| [1143](#L1143) | wp\_enqueue\_script('masonry'); |
| [1144](#L1144) |  |
| [1145](#L1145) | if ($this->settings\_menu['template\_file']) { |
| [1146](#L1146) | include\_once($this->settings\_menu['template\_file']); |
| [1147](#L1147) | } else { |
| [1148](#L1148) | echo '<div class="wrap settings\_api\_class\_page" id="' . $this->settings\_menu['name'] . '\_settings" >'; |
| [1149](#L1149) | $icon = ''; |
| [1150](#L1150) | if (isset($this->settings\_menu['icon\_path']) && $this->settings\_menu['icon\_path']) |
| [1151](#L1151) | $icon = ' style="background: url(' . $this->settings\_menu['icon\_path'] . ') no-repeat ;" '; |
| [1152](#L1152) |  |
| [1153](#L1153) | echo '<div id="icon-options-general" class="icon32" ' . $icon . '><br /></div>'; |
| [1154](#L1154) |  |
| [1155](#L1155) | echo '<h2>' . $this->settings\_menu['title'] . '</h2>'; |
| [1156](#L1156) |  |
| [1157](#L1157) | //echo '<br />'; |
| [1158](#L1158) | //settings\_errors(); |
| [1159](#L1159) | if (isset($\_GET['settings-updated']) && $\_GET['settings-updated'] == 'true') |
| [1160](#L1160) | echo '<div class="updated fade"><p><strong>' . \_\_('Options updated successfully!', $this->settings\_menu['name']) . '</p></strong></div>'; |
| [1161](#L1161) |  |
| [1162](#L1162) | if (isset($\_GET['settings-reseted']) && $\_GET['settings-reseted']) |
| [1163](#L1163) | echo '<div class="updated fade"><p><strong>' . \_\_('Options rested successfully!', $this->settings\_menu['name']) . '</p></strong></div>'; |
| [1164](#L1164) |  |
| [1165](#L1165) | if (isset($\_GET['settings-imported']) && $\_GET['settings-imported']) |
| [1166](#L1166) | echo '<div class="updated fade"><p><strong>' . \_\_('Options saved successfully!', $this->settings\_menu['name']) . '</p></strong></div>'; |
| [1167](#L1167) |  |
| [1168](#L1168) | do\_action('securityforce\_settings\_api\_header', $this->settings\_menu); |
| [1169](#L1169) |  |
| [1170](#L1170) |  |
| [1171](#L1171) | //$this->show\_navigation(); |
| [1172](#L1172) | $this->show\_forms(); |
| [1173](#L1173) |  |
| [1174](#L1174) | do\_action('securityforce\_settings\_api\_footer', $this->settings\_menu); |
| [1175](#L1175) |  |
| [1176](#L1176) | echo '</div>'; |
| [1177](#L1177) | } |
| [1178](#L1178) | } |
| [1179](#L1179) |  |
| [1180](#L1180) |  |
| [1181](#L1181) |  |
| [1182](#L1182) |  |
| [1183](#L1183) |  |
| [1184](#L1184) |  |
| [1185](#L1185) |  |
| [1186](#L1186) |  |
| [1187](#L1187) |  |
| [1188](#L1188) |  |
| [1189](#L1189) |  |
| [1190](#L1190) | /\*\* |
| [1191](#L1191) | \* Show blocked ip list |
| [1192](#L1192) | \*/ |
| [1193](#L1193) | public function securityforce\_render\_secure\_network\_page(){ |
| [1194](#L1194) | global $wpdb; |
| [1195](#L1195) |  |
| [1196](#L1196) | // Current page number, items per page |
| [1197](#L1197) | $per\_page = SECURITYFORCE\_FIREWALL\_Utils::securityforce\_ab\_attacks\_per\_page(); |
| [1198](#L1198) | $pagenum  = isset( $\_GET['paged'] ) ? absint( $\_GET['paged'] ) : 0; |
| [1199](#L1199) | if ( empty( $pagenum ) ) |
| [1200](#L1200) | $pagenum = 1; |
| [1201](#L1201) |  |
| [1202](#L1202) | // Offset, limit |
| [1203](#L1203) | $limit  = $per\_page; |
| [1204](#L1204) | $offset = ( $pagenum \* $limit ) - $limit; |
| [1205](#L1205) | $offset = ( $offset < 0 ) ? 0 : $offset; |
| [1206](#L1206) |  |
| [1207](#L1207) | // Get results |
| [1208](#L1208) | $search = isset( $\_GET['ip\_search'] ) ? sanitize\_text\_field( $\_GET['ip\_search'] ) : ''; |
| [1209](#L1209) | $search\_title = ''; |
| [1210](#L1210) | if ( $search ) { |
| [1211](#L1211) | $search\_title = sprintf( '<span class="subtitle">' . \_\_( 'Search results for &#8220;%s&#8221;', 'mute-screamer' ) . '</span>', esc\_html( $search ) ); |
| [1212](#L1212) | $token = '%'.$search.'%'; |
| [1213](#L1213) | $sql = $wpdb->prepare( 'SELECT SQL\_CALC\_FOUND\_ROWS \* FROM ' . $wpdb->prefix . 'securityforce\_blocked\_ips WHERE (ip LIKE %s ) ORDER BY created DESC LIMIT %d, %d', $token, $offset, $limit ); |
| [1214](#L1214) | } else { |
| [1215](#L1215) | $sql = $wpdb->prepare( 'SELECT SQL\_CALC\_FOUND\_ROWS \* FROM ' . $wpdb->prefix . 'securityforce\_blocked\_ips ORDER BY created DESC LIMIT %d, %d', $offset, $limit ); |
| [1216](#L1216) | } |
| [1217](#L1217) | $blocked\_ips = $wpdb->get\_results( $sql ); |
| [1218](#L1218) | $total\_ips = $wpdb->get\_var( 'SELECT FOUND\_ROWS();' ); |
| [1219](#L1219) |  |
| [1220](#L1220) | // Construct pagination links |
| [1221](#L1221) | $num\_pages  = ceil( $total\_ips / $per\_page ); |
| [1222](#L1222) | $pagination = SECURITYFORCE\_FIREWALL\_Utils::pagination( $pagenum, $num\_pages, $per\_page, $total\_ips ); |
| [1223](#L1223) | // Columns |
| [1224](#L1224) | $columns = array( |
| [1225](#L1225) | 'ip' => \_\_( 'IP Address', 'mute-screamer' ), |
| [1226](#L1226) | 'date' => \_\_( 'Date', 'mute-screamer' ) |
| [1227](#L1227) | ); |
| [1228](#L1228) | ?> |
| [1229](#L1229) | <div class="wrap"> |
| [1230](#L1230) | <!-- <h1>SECURITYFORCE Blocked IP Addresses <?php echo $search\_title; ?></h1> --> |
| [1231](#L1231) | <!-- <form STYLES="MARGIN-TOP:" method="get" action="admin.php" class="search-form"> |
| [1232](#L1232) | <input type="hidden" value="<?php echo 'securityforce\_secure\_network';?>" name="page"/> |
| [1233](#L1233) | <p class="search-box"> |
| [1234](#L1234) | <label for="s" class="screen-reader-text"><?php \_e( 'Search IP', 'mute-screamer' ); ?></label> |
| [1235](#L1235) | <input type="text" value="<?php echo esc\_attr( $search ); ?>" name="ip\_search" id="securityforce\_ab-attacks-search-input"/> |
| [1236](#L1236) | <input type="submit" class="button" value="<?php \_e( 'Search IP Address', 'mute-screamer' ); ?>"/> |
| [1237](#L1237) | </p> |
| [1238](#L1238) | </form> --> |
| [1239](#L1239) |  |
| [1240](#L1240) | <div id="hedge3-welcome-panel" class="welcome-panel"> |
| [1241](#L1241) | <!-- <input type="hidden" id="welcomepanelnonce" name="welcomepanelnonce" value="9e042115e2">               <a class="welcome-panel-close" href="http://localhost/demo/wp-admin/?welcome=0" aria-label="Dismiss the welcome panel">Dismiss</a> |
| [1242](#L1242) | --> |
| [1243](#L1243) | <div class="welcome-panel-content"> |
| [1244](#L1244) | <div class="welcome-panel-header hedge3\_clean"> |
| [1245](#L1245) | <div class="welcome-panel-header-image"> |
| [1246](#L1246) | <svg preserveAspectRatio="xMidYMin slice" fill="none" viewBox="0 0 1232 240" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false"> |
| [1247](#L1247) | <g clip-path="url(#a)"> |
| [1248](#L1248) | <path fill="#151515" d="M0 0h1232v240H0z"></path> |
| [1249](#L1249) | <ellipse cx="616" cy="232" fill="url(#b)" opacity=".05" rx="1497" ry="249"></ellipse> |
| [1250](#L1250) | <mask id="d" width="1000" height="400" x="232" y="20" maskUnits="userSpaceOnUse" style="mask-type:alpha"> |
| [1251](#L1251) | <path fill="url(#c)" d="M0 0h1000v400H0z" transform="translate(232 20)"></path> |
| [1252](#L1252) | </mask> |
| [1253](#L1253) | <g stroke-width="2" mask="url(#d)"> |
| [1254](#L1254) | <path stroke="url(#e)" d="M387 20v1635"></path> |
| [1255](#L1255) | <path stroke="url(#f)" d="M559.5 20v1635"></path> |
| [1256](#L1256) | <path stroke="url(#g)" d="M732 20v1635"></path> |
| [1257](#L1257) | <path stroke="url(#h)" d="M904.5 20v1635"></path> |
| [1258](#L1258) | <path stroke="url(#i)" d="M1077 20v1635"></path> |
| [1259](#L1259) | </g> |
| [1260](#L1260) | </g> |
| [1261](#L1261) | <defs> |
| [1262](#L1262) | <linearGradient id="e" x1="387.5" x2="387.5" y1="20" y2="1655" gradientUnits="userSpaceOnUse"> |
| [1263](#L1263) | <stop stop-color="#3858E9" stop-opacity="0"></stop> |
| [1264](#L1264) | <stop offset=".297" stop-color="#3858E9"></stop> |
| [1265](#L1265) | <stop offset=".734" stop-color="#3858E9"></stop> |
| [1266](#L1266) | <stop offset="1" stop-color="#3858E9" stop-opacity="0"></stop> |
| [1267](#L1267) | <stop offset="1" stop-color="#3858E9" stop-opacity="0"></stop> |
| [1268](#L1268) | </linearGradient> |
| [1269](#L1269) | <linearGradient id="f" x1="560" x2="560" y1="20" y2="1655" gradientUnits="userSpaceOnUse"> |
| [1270](#L1270) | <stop stop-color="#FFFCB5" stop-opacity="0"></stop> |
| [1271](#L1271) | <stop offset="0" stop-color="#FFFCB5" stop-opacity="0"></stop> |
| [1272](#L1272) | <stop offset=".297" stop-color="#FFFCB5"></stop> |
| [1273](#L1273) | <stop offset=".734" stop-color="#FFFCB5"></stop> |
| [1274](#L1274) | <stop offset="1" stop-color="#FFFCB5" stop-opacity="0"></stop> |
| [1275](#L1275) | </linearGradient> |
| [1276](#L1276) | <linearGradient id="g" x1="732.5" x2="732.5" y1="20" y2="1655" gradientUnits="userSpaceOnUse"> |
| [1277](#L1277) | <stop stop-color="#C7FFDB" stop-opacity="0"></stop> |
| [1278](#L1278) | <stop offset=".297" stop-color="#C7FFDB"></stop> |
| [1279](#L1279) | <stop offset=".693" stop-color="#C7FFDB"></stop> |
| [1280](#L1280) | <stop offset="1" stop-color="#C7FFDB" stop-opacity="0"></stop> |
| [1281](#L1281) | </linearGradient> |
| [1282](#L1282) | <linearGradient id="h" x1="905" x2="905" y1="20" y2="1655" gradientUnits="userSpaceOnUse"> |
| [1283](#L1283) | <stop stop-color="#FFB7A7" stop-opacity="0"></stop> |
| [1284](#L1284) | <stop offset=".297" stop-color="#FFB7A7"></stop> |
| [1285](#L1285) | <stop offset=".734" stop-color="#FFB7A7"></stop> |
| [1286](#L1286) | <stop offset="1" stop-color="#3858E9" stop-opacity="0"></stop> |
| [1287](#L1287) | <stop offset="1" stop-color="#FFB7A7" stop-opacity="0"></stop> |
| [1288](#L1288) | </linearGradient> |
| [1289](#L1289) | <linearGradient id="i" x1="1077.5" x2="1077.5" y1="20" y2="1655" gradientUnits="userSpaceOnUse"> |
| [1290](#L1290) | <stop stop-color="#7B90FF" stop-opacity="0"></stop> |
| [1291](#L1291) | <stop offset=".297" stop-color="#7B90FF"></stop> |
| [1292](#L1292) | <stop offset=".734" stop-color="#7B90FF"></stop> |
| [1293](#L1293) | <stop offset="1" stop-color="#3858E9" stop-opacity="0"></stop> |
| [1294](#L1294) | <stop offset="1" stop-color="#7B90FF" stop-opacity="0"></stop> |
| [1295](#L1295) | </linearGradient> |
| [1296](#L1296) | <radialGradient id="b" cx="0" cy="0" r="1" gradientTransform="matrix(0 249 -1497 0 616 232)" gradientUnits="userSpaceOnUse"> |
| [1297](#L1297) | <stop stop-color="#3858E9"></stop> |
| [1298](#L1298) | <stop offset="1" stop-color="#151515" stop-opacity="0"></stop> |
| [1299](#L1299) | </radialGradient> |
| [1300](#L1300) | <radialGradient id="c" cx="0" cy="0" r="1" gradientTransform="matrix(0 765 -1912.5 0 500 -110)" gradientUnits="userSpaceOnUse"> |
| [1301](#L1301) | <stop offset=".161" stop-color="#151515" stop-opacity="0"></stop> |
| [1302](#L1302) | <stop offset=".682"></stop> |
| [1303](#L1303) | </radialGradient> |
| [1304](#L1304) | <clipPath id="a"> |
| [1305](#L1305) | <path fill="#fff" d="M0 0h1232v240H0z"></path> |
| [1306](#L1306) | </clipPath> |
| [1307](#L1307) | </defs> |
| [1308](#L1308) | </svg> |
| [1309](#L1309) | </div> |
| [1310](#L1310) | <h2>Web3 Ready Crypto Widgets</h2> |
| [1311](#L1311) | <p> |
| [1312](#L1312) | Join Hedge3 to stay proactive building Crypto & DeFi on WordPress! |
| [1313](#L1313) | </p> |
| [1314](#L1314) | <p> |
| [1315](#L1315) | <a class="view-more-button" target="\_blank" href="https://hedge3.org/defi-widgets/?utm\_source=plugin&utm\_medium=plugin-installation">Discover Widgets</a> |
| [1316](#L1316) | </p> |
| [1317](#L1317) | </div> |
| [1318](#L1318) | <div class="welcome-panel-column-container"> |
| [1319](#L1319) | <div class="welcome-panel-column"> |
| [1320](#L1320) | <svg width="48" height="48" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false"> |
| [1321](#L1321) | <rect width="48" height="48" rx="4" fill="#1E1E1E"></rect> |
| [1322](#L1322) | <path fill-rule="evenodd" clip-rule="evenodd" d="M32.0668 17.0854L28.8221 13.9454L18.2008 24.671L16.8983 29.0827L21.4257 27.8309L32.0668 17.0854ZM16 32.75H24V31.25H16V32.75Z" fill="white"></path> |
| [1323](#L1323) | </svg> |
| [1324](#L1324) | <div class="welcome-panel-column-content"> |
| [1325](#L1325) | <h3>Branded widgets with own watermark.</h3> |
| [1326](#L1326) | <p>Pro version allows you to customize chart style and put your own watermark instead of Hedge3.</p> |
| [1327](#L1327) | <a target="\_blank" href="https://hedge3.org/pricing/?utm\_source=plugin&utm\_medium=plugin-installation">Get Pro Now →</a> |
| [1328](#L1328) | </div> |
| [1329](#L1329) | </div> |
| [1330](#L1330) | <div class="welcome-panel-column"> |
| [1331](#L1331) | <svg width="48" height="48" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false"> |
| [1332](#L1332) | <rect width="48" height="48" rx="4" fill="#1E1E1E"></rect> |
| [1333](#L1333) | <path fill-rule="evenodd" clip-rule="evenodd" d="M18 16h12a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H18a2 2 0 0 1-2-2V18a2 2 0 0 1 2-2zm12 1.5H18a.5.5 0 0 0-.5.5v3h13v-3a.5.5 0 0 0-.5-.5zm.5 5H22v8h8a.5.5 0 0 0 .5-.5v-7.5zm-10 0h-3V30a.5.5 0 0 0 .5.5h2.5v-8z" fill="#fff"></path> |
| [1334](#L1334) | </svg> |
| [1335](#L1335) | <div class="welcome-panel-column-content"> |
| [1336](#L1336) | <h3>Advanced layouts for swap and aggregation.</h3> |
| [1337](#L1337) | <p>Follow Hedge3 on Twitter to stay tuned abour plugin lates updates and perks.</p> |
| [1338](#L1338) | <a target="\_blank" href="https://docs.google.com/forms/d/e/1FAIpQLSfWOXKUmfEvwKGCKLKSxKDTvdr-qCe9EZJh\_F96ODAluXlsJw/viewform?usp=sf\_link">Get Early Access →</a> |
| [1339](#L1339) | </div> |
| [1340](#L1340) | </div> |
| [1341](#L1341) | <div class="welcome-panel-column"> |
| [1342](#L1342) | <svg width="48" height="48" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false"> |
| [1343](#L1343) | <rect width="48" height="48" rx="4" fill="#1E1E1E"></rect> |
| [1344](#L1344) | <path fill-rule="evenodd" clip-rule="evenodd" d="M31 24a7 7 0 0 1-7 7V17a7 7 0 0 1 7 7zm-7-8a8 8 0 1 1 0 16 8 8 0 0 1 0-16z" fill="#fff"></path> |
| [1345](#L1345) | </svg> |
| [1346](#L1346) | <div class="welcome-panel-column-content"> |
| [1347](#L1347) | <h3>Custom web3 functionalities for your needs!</h3> |
| [1348](#L1348) | <p>Get personalized custom functionalities weather it's a new design component or a dApp feature.</p> |
| [1349](#L1349) | <a target="\_blank" href="https://docs.google.com/forms/d/e/1FAIpQLSdmgOvJqP\_Zq-dqGqDqWpFziRcX-\_Z7cYE9rJyLRGbwf\_rLgg/viewform?usp=sf\_link">Get In Touch →</a> |
| [1350](#L1350) | </div> |
| [1351](#L1351) | </div> |
| [1352](#L1352) | </div> |
| [1353](#L1353) |  |
| [1354](#L1354) |  |
| [1355](#L1355) |  |
| [1356](#L1356) | </div> |
| [1357](#L1357) | </div> |
| [1358](#L1358) | <div class="pro-options-content"> |
| [1359](#L1359) |  |
| [1360](#L1360) | <div class="shpwcase-section right"> |
| [1361](#L1361) | <div class="content-col"> |
| [1362](#L1362) | <h2>Getting Started With Hedge3 Widgets</h2> |
| [1363](#L1363) | <p></p> |
| [1364](#L1364) | <p>Hedge3 widget are easy to build! To get familiar with widget builder you have to understand propose of four sections!</p> |
| [1365](#L1365) | <ul> |
| [1366](#L1366) | <li><strong>Layout</strong> - construction of the widget.</li> |
| [1367](#L1367) | <li><strong>Data</strong> - what information to aggregate.</li> |
| [1368](#L1368) | <li><strong>Options</strong> - anything related to change.</li> |
| [1369](#L1369) | <li><strong>Styles</strong> - customize styles under your branding.</li> |
| [1370](#L1370) | </ul> |
| [1371](#L1371) | <p>Copy paste <strong>[shortcode]</strong> to publish the widgets!</p> |
| [1372](#L1372) | </div> |
| [1373](#L1373) | <div class="content-col"> |
| [1374](#L1374) | <iframe width="600" height="400" src="https://www.youtube.com/embed/shM6w2sRhO4?si=ER3lHgYvtL\_6F3gT" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe> |
| [1375](#L1375) | </div> |
| [1376](#L1376) | </div> |
| [1377](#L1377) |  |
| [1378](#L1378) | <div class="shpwcase-section left"> |
| [1379](#L1379) | <div class="content-col"> |
| [1380](#L1380) | <img width="100%" src="http://hedge3.org/wp-content/uploads/2024/02/screenshot-7.gif" alt="Hedge3 Demo" /> |
| [1381](#L1381) | </div> |
| [1382](#L1382) | <div class="content-col"> |
| [1383](#L1383) | <h2>Pro Version Advantages</h2> |
| [1384](#L1384) | <p>While the free version of Hedge3 Widgets is  enough, the advanced version is a gamechanger in WordPress</p> |
| [1385](#L1385) | <p>Main advantages of Pro version:</p> |
| [1386](#L1386) |  |
| [1387](#L1387) | <ul> |
| [1388](#L1388) | <li>Design Options</li> |
| [1389](#L1389) | <li>Copyright Free</li> |
| [1390](#L1390) | <li>Unlimited Widgets</li> |
| [1391](#L1391) | <li>Priority Support</li> |
| [1392](#L1392) | <li>Minor Customizations</li> |
| [1393](#L1393) | </ul> |
| [1394](#L1394) |  |
| [1395](#L1395) |  |
| [1396](#L1396) | </div> |
| [1397](#L1397) | </div> |
| [1398](#L1398) |  |
| [1399](#L1399) |  |
| [1400](#L1400) | <div class="related-review"> |
| [1401](#L1401) | <h2>Limited-Time Offer: 50% Discount!</h2> |
| [1402](#L1402) | <p>Pro version allows you to customize widgets, set your own watermark, and access pro support.</br>Do crypto business professionally with Hedge3!</p> |
| [1403](#L1403) | <a class="view-more-button" target="\_blank" href="https://hedge3.org/pricing/?utm\_source=plugin&utm\_medium=plugin-installation">See Pricing</a> |
| [1404](#L1404) | </div> |
| [1405](#L1405) | </div> |
| [1406](#L1406) | </div> |
| [1407](#L1407) | <?php |
| [1408](#L1408) | } |
| [1409](#L1409) |  |
| [1410](#L1410) |  |
| [1411](#L1411) |  |
| [1412](#L1412) |  |
| [1413](#L1413) |  |
| [1414](#L1414) |  |
| [1415](#L1415) |  |
| [1416](#L1416) |  |
| [1417](#L1417) |  |
| [1418](#L1418) |  |
| [1419](#L1419) | /\*\* |
| [1420](#L1420) | \* Display Firewall PHPIDS Menu // Pro Options |
| [1421](#L1421) | \*/ |
| [1422](#L1422) | public function render\_firewall\_phpidspage(){ |
| [1423](#L1423) | $hmadmin = new SECURITYFORCE\_FIREWALL\_Admin(); |
| [1424](#L1424) | $hmadmin->attacks(); |
| [1425](#L1425) | } |
| [1426](#L1426) |  |
| [1427](#L1427) | public function filter\_settings() { |
| [1428](#L1428) | $options\_file = (is\_multisite()) ? 'network/settings.php' : 'admin.php'; |
| [1429](#L1429) | $menuName = isset($this->settings\_menu['name']) ? $this->settings\_menu['name'] : 'default\_menu\_name'; |
| [1430](#L1430) | $page\_url = admin\_url(add\_query\_arg('page', $menuName, $options\_file)); |
| [1431](#L1431) |  |
| [1432](#L1432) | $can\_deactive = false; |
| [1433](#L1433) | if (isset($\_COOKIE['securityforce\_can\_deactivate']) && preg\_replace("/[^a-zA-Z]/", "", substr(NONCE\_SALT, 0, 8)) == preg\_replace("/[^a-zA-Z]/", "", $\_COOKIE['securityforce\_can\_deactivate'])) |
| [1434](#L1434) | $can\_deactive = true; |
| [1435](#L1435) |  |
| [1436](#L1436) | if ($can\_deactive && is\_admin() && isset($\_POST['action']) && $\_POST['action'] == 'update' && isset($\_POST['option\_page']) && $\_POST['option\_page'] == $this->settings\_menu['name']) { |
| [1437](#L1437) |  |
| [1438](#L1438) | //to fix problem with default on checkbox |
| [1439](#L1439) | $def\_keys = array\_keys($this->get\_defaults()); |
| [1440](#L1440) | if (is\_array($def\_keys)) |
| [1441](#L1441) | foreach ($def\_keys as $key) |
| [1442](#L1442) | if (!isset($\_POST[$this->settings\_menu['name']][$key])) |
| [1443](#L1443) | $\_POST[$this->settings\_menu['name']][$key] = ''; |
| [1444](#L1444) |  |
| [1445](#L1445) | $\_POST = apply\_filters('securityforce\_settings\_api\_filter', $\_POST); |
| [1446](#L1446) |  |
| [1447](#L1447) | if (isset($\_POST['import\_field']) && $\_POST['import\_field'] && check\_admin\_referer($this->settings\_menu['name'] . '-options')) { |
| [1448](#L1448) | //delete\_option( $this->settings\_menu['name'] ); |
| [1449](#L1449) | $new\_settings = sanitize\_text\_field(stripslashes($\_POST['import\_field'])); |
| [1450](#L1450) | $new\_settings = json\_decode($new\_settings, true); |
| [1451](#L1451) | $new\_settings = str\_replace('[new\_line]', "\r\n", $new\_settings); |
| [1452](#L1452) | $new\_settings = str\_replace('[double\_slashes]', "\/", $new\_settings); |
| [1453](#L1453) | $new\_settings = str\_replace('[quotation]', '"', $new\_settings); |
| [1454](#L1454) | $new\_settings = str\_replace('[o\_cb]', '{', $new\_settings); |
| [1455](#L1455) | $new\_settings = str\_replace('[c\_cb]', '}', $new\_settings); |
| [1456](#L1456) |  |
| [1457](#L1457) | update\_option($this->settings\_menu['name'], $new\_settings); |
| [1458](#L1458) |  |
| [1459](#L1459) | //      if ( !count( get\_settings\_errors() ) ) |
| [1460](#L1460) | //      add\_settings\_error('general', 'settings\_imported', \_\_('Settings Imported.'), 'updated'); |
| [1461](#L1461) | //      set\_transient('settings\_errors', get\_settings\_errors(), 30); |
| [1462](#L1462) |  |
| [1463](#L1463) | /\*\* |
| [1464](#L1464) | \* Redirect back to the settings page that was submitted |
| [1465](#L1465) | \*/ |
| [1466](#L1466) | $goback = add\_query\_arg(array('settings-imported' => 'true'), $page\_url); |
| [1467](#L1467) | wp\_redirect($goback); |
| [1468](#L1468) | exit; |
| [1469](#L1469) | } |
| [1470](#L1470) |  |
| [1471](#L1471) |  |
| [1472](#L1472) |  |
| [1473](#L1473) | //check to see if the options were reset |
| [1474](#L1474) | if (isset($\_POST['reset-defaults']) && check\_admin\_referer($this->settings\_menu['name'] . '-options')) { |
| [1475](#L1475) |  |
| [1476](#L1476) | // foreach ($this->settings\_sections as $section) |
| [1477](#L1477) | delete\_option($this->settings\_menu['name']); |
| [1478](#L1478) | $this->update\_defaults(); |
| [1479](#L1479) |  |
| [1480](#L1480) | do\_action('securityforce\_settings\_api\_reset'); |
| [1481](#L1481) |  |
| [1482](#L1482) | $goback = add\_query\_arg(array('settings-reseted' => 'true'), $page\_url); |
| [1483](#L1483) | wp\_redirect($goback); |
| [1484](#L1484) | exit; |
| [1485](#L1485) | } |
| [1486](#L1486) |  |
| [1487](#L1487) |  |
| [1488](#L1488) | $clean\_options\_page = remove\_query\_arg(array('settings-reseted', 'wrong-number', 'settings-imported'), $page\_url); |
| [1489](#L1489) |  |
| [1490](#L1490) | $\_SERVER['HTTP\_REFERER'] = $clean\_options\_page; |
| [1491](#L1491) | $\_REQUEST['\_wp\_original\_http\_referer'] = $clean\_options\_page; |
| [1492](#L1492) | $\_REQUEST['\_wp\_http\_referer'] = $clean\_options\_page; |
| [1493](#L1493) | } |
| [1494](#L1494) | } |
| [1495](#L1495) |  |
| [1496](#L1496) |  |
| [1497](#L1497) |  |
| [1498](#L1498) |  |
| [1499](#L1499) |  |
| [1500](#L1500) |  |
| [1501](#L1501) |  |
| [1502](#L1502) | public function render\_security\_dashboard\_page() { |
| [1503](#L1503) | wp\_enqueue\_script('securityforce\_charts',SECURITYFORCE\_URL.'/js/chart.min.js'); |
| [1504](#L1504) | global $wpdb; |
| [1505](#L1505) | $setting\_name = $this->settings\_menu['name']; |
| [1506](#L1506) | $settings = get\_option($setting\_name); |
| [1507](#L1507) | $count = 0; |
| [1508](#L1508) | $htaccess = $api\_msg = $tn\_msg = ''; |
| [1509](#L1509) | $hide\_api\_notice = get\_option('securityforce\_remove\_dashboard\_notice\_api'); |
| [1510](#L1510) | $hide\_htaccess\_notice = get\_option('securityforce\_remove\_dashboard\_notice\_htaccess'); |
| [1511](#L1511) | $hide\_sn\_notice = get\_option('securityforce\_remove\_dashboard\_notice\_sn'); |
| [1512](#L1512) | if(isset($settings['full\_hide']) && $settings['full\_hide'] !== 'on' && $hide\_api\_notice != 1){ |
| [1513](#L1513) | $api\_msg = 'Your full hide is disabled, Wappalyzer will detect you are using WordPress.'; |
| [1514](#L1514) | $count = $count + 1; |
| [1515](#L1515) | $show\_api\_msg = true; |
| [1516](#L1516) | } |
| [1517](#L1517) | if(isset($settings['enable\_firewall']) && $settings['enable\_firewall'] !== 'on' && $hide\_sn\_notice != 1){ |
| [1518](#L1518) | $tn\_msg = 'Firewall is disabled, we can not track dangerous IPS.'; |
| [1519](#L1519) | $count = $count + 1; |
| [1520](#L1520) | $show\_sn\_msg = true; |
| [1521](#L1521) | } |
| [1522](#L1522) |  |
| [1523](#L1523) | if(isset($settings['secure\_network']) && $settings['secure\_network'] !== 'on' && $hide\_sn\_notice != 1) { |
| [1524](#L1524) | $tn\_msg = 'Secure Network is disabled, we can not fetch dangerous IPS.'; |
| [1525](#L1525) | $count = $count + 1; |
| [1526](#L1526) | $show\_sn\_msg = true; |
| [1527](#L1527) | } |
| [1528](#L1528) |  |
| [1529](#L1529) | $filename = ABSPATH . '.htaccess'; |
| [1530](#L1530) | if(!is\_writable($filename) && $hide\_htaccess\_notice != 1){ |
| [1531](#L1531) | $htaccess = 'Plugin is not able to write .htaccess file, Please make it writable.'; |
| [1532](#L1532) | $count = $count + 1; |
| [1533](#L1533) | $show\_htaccess\_msg = true; |
| [1534](#L1534) | } |
| [1535](#L1535) | ?> |
| [1536](#L1536) | <style> |
| [1537](#L1537) | .securityforce-loader{ |
| [1538](#L1538) | background-image: url('<?php echo home\_url() . '/wp-admin/images/spinner-2x.gif'; ?>'); |
| [1539](#L1539) | } |
| [1540](#L1540) | .securityforce-loader{ |
| [1541](#L1541) | position: absolute; |
| [1542](#L1542) | background-color: rgba(255,255,255,0.5); |
| [1543](#L1543) | top: 0px; |
| [1544](#L1544) | left: 2%; |
| [1545](#L1545) | right: 0; |
| [1546](#L1546) | bottom: 0; |
| [1547](#L1547) | width: 96%; |
| [1548](#L1548) | background-repeat: no-repeat; |
| [1549](#L1549) | background-position: center center; |
| [1550](#L1550) | display: none; |
| [1551](#L1551) | } |
| [1552](#L1552) | .show-fixes-div p:empty{ |
| [1553](#L1553) | display: none; |
| [1554](#L1554) | } |
| [1555](#L1555) | .show-fixes-div p{ |
| [1556](#L1556) | padding: 0 0 20px 0; |
| [1557](#L1557) | margin: 0; |
| [1558](#L1558) | font-size: 16px; |
| [1559](#L1559) | color: red; |
| [1560](#L1560) | } |
| [1561](#L1561) | .hndle.ui-sortable-handle{ |
| [1562](#L1562) | cursor: auto !important; |
| [1563](#L1563) | } |
| [1564](#L1564) | #dashboard-widgets-wrap{ |
| [1565](#L1565) | margin: 0 !important; |
| [1566](#L1566) | } |
| [1567](#L1567) | #dashboard\_last10\_instru .table.widefat{ |
| [1568](#L1568) | table-layout: fixed; |
| [1569](#L1569) | } |
| [1570](#L1570) | .securityforce-dashboard-badge { |
| [1571](#L1571) | display: inline-block; |
| [1572](#L1572) | min-width: 10px; |
| [1573](#L1573) | padding: 3px 7px; |
| [1574](#L1574) | margin-left: 0.5rem; |
| [1575](#L1575) | font-size: 12px; |
| [1576](#L1576) | font-weight: bold; |
| [1577](#L1577) | color: #fff; |
| [1578](#L1578) | line-height: 1; |
| [1579](#L1579) | vertical-align: middle; |
| [1580](#L1580) | white-space: nowrap; |
| [1581](#L1581) | text-align: center; |
| [1582](#L1582) | background-color: #fcb214; |
| [1583](#L1583) | border-radius: 10px; |
| [1584](#L1584) | } |
| [1585](#L1585) | .securityforce-dashboard-notification { |
| [1586](#L1586) | border-left: 4px solid #fcb214; |
| [1587](#L1587) | background-color: #f9f9f9; |
| [1588](#L1588) | min-height: 44px; |
| [1589](#L1589) | padding: 0 1rem; |
| [1590](#L1590) | margin: 0; |
| [1591](#L1591) | border-top: 1px solid #eeeeee; |
| [1592](#L1592) | box-sizing: border-box; |
| [1593](#L1593) | display: flex; |
| [1594](#L1594) | align-items: center; |
| [1595](#L1595) | justify-content: space-between; |
| [1596](#L1596) | } |
| [1597](#L1597) | .securityforce-notice-dismiss { |
| [1598](#L1598) | border: none; |
| [1599](#L1599) | margin: 0; |
| [1600](#L1600) | padding: 9px; |
| [1601](#L1601) | background: 0 0; |
| [1602](#L1602) | color: #72777c; |
| [1603](#L1603) | cursor: pointer; |
| [1604](#L1604) | } |
| [1605](#L1605) | .securityforce-notice-dismiss:before { |
| [1606](#L1606) | background: 0 0; |
| [1607](#L1607) | color: #525355; |
| [1608](#L1608) | content: "\f153"; |
| [1609](#L1609) | display: block; |
| [1610](#L1610) | font: normal 16px/20px dashicons; |
| [1611](#L1611) | speak: none; |
| [1612](#L1612) | height: 20px; |
| [1613](#L1613) | text-align: center; |
| [1614](#L1614) | width: 20px; |
| [1615](#L1615) | -webkit-font-smoothing: antialiased; |
| [1616](#L1616) | } |
| [1617](#L1617) | @media (min-width: 768px){ |
| [1618](#L1618) | #dashboard-widgets .postbox-container { |
| [1619](#L1619) | width: 350px; |
| [1620](#L1620) | } |
| [1621](#L1621) | } |
| [1622](#L1622) | @media (min-width: 992px){ |
| [1623](#L1623) | #dashboard-widgets .postbox-container { |
| [1624](#L1624) | width: 450px; |
| [1625](#L1625) | } |
| [1626](#L1626) | } |
| [1627](#L1627) |  |
| [1628](#L1628) | @media (min-width: 1200px){ |
| [1629](#L1629) | #dashboard-widgets .postbox-container { |
| [1630](#L1630) | width: 550px; |
| [1631](#L1631) | } |
| [1632](#L1632) | } |
| [1633](#L1633) |  |
| [1634](#L1634) | </style> |
| [1635](#L1635) | <div class="js"> |
| [1636](#L1636) | <div class="wrap"> |
| [1637](#L1637) | <h1><?php \_e('Dashboard', 'security\_force'); ?></h1> |
| [1638](#L1638) |  |
| [1639](#L1639) | <?php |
| [1640](#L1640) | //Weekly ids data |
| [1641](#L1641) | $now = new DateTime( "6 days ago", new DateTimeZone('America/New\_York')); |
| [1642](#L1642) | $interval = new DateInterval( 'P1D'); // 1 Day interval |
| [1643](#L1643) | $period = new DatePeriod( $now, $interval, 6); // 7 Days |
| [1644](#L1644) | $sale\_data = array(); |
| [1645](#L1645) | foreach( $period as $day) { |
| [1646](#L1646) | $key = $day->format( 'd M Y'); |
| [1647](#L1647) | $key\_1 = $day->format( 'Y-m-d'); |
| [1648](#L1648) | $data\_r = $wpdb->get\_row("SELECT COUNT(\*) cnt FROM " . $wpdb->prefix . "securityforce\_ab\_attacks WHERE date(created) = '". $key\_1 ."'"); |
| [1649](#L1649) | $sale\_data[ $key ] = $data\_r->cnt; |
| [1650](#L1650) | } |
| [1651](#L1651) | $total\_firewall\_phpidsblock = 0; |
| [1652](#L1652) | foreach ($sale\_data as $key => $value) { |
| [1653](#L1653) | $total\_firewall\_phpidsblock = $total\_firewall\_phpidsblock + $value; |
| [1654](#L1654) | } |
| [1655](#L1655) | //Weekly IP data |
| [1656](#L1656) | $sale\_data\_ip = array(); |
| [1657](#L1657) | foreach( $period as $day) { |
| [1658](#L1658) | $key = $day->format( 'd M Y'); |
| [1659](#L1659) | $key\_1 = $day->format( 'Y-m-d'); |
| [1660](#L1660) | $data\_r = $wpdb->get\_row("SELECT COUNT(\*) cnt FROM " . $wpdb->prefix . "securityforce\_blocked\_ips WHERE date(created) = '". $key\_1 ."'"); |
| [1661](#L1661) | $sale\_data\_ip[ $key ] = $data\_r->cnt; |
| [1662](#L1662) | } |
| [1663](#L1663) | $total\_ips\_block = 0; |
| [1664](#L1664) | foreach ($sale\_data\_ip as $key => $value) { |
| [1665](#L1665) | $total\_ips\_block = $total\_ips\_block + $value; |
| [1666](#L1666) | } |
| [1667](#L1667) | ?> |
| [1668](#L1668) | <div id="dashboard-widgets-wrap"> |
| [1669](#L1669) | <div id="dashboard-widgets" class="metabox-holder"> |
| [1670](#L1670) | <div id="postbox-container-1" class="postbox-container"> |
| [1671](#L1671) | <div class="filter-div" style="height: 30px; width: 100%; display: inline-block;"> |
| [1672](#L1672) | </div> |
| [1673](#L1673) | <div id="normal-sortables" class="meta-box-sortables ui-sortable"> |
| [1674](#L1674) | <?php |
| [1675](#L1675) | $hide\_api\_notice = get\_option('securityforce\_remove\_dashboard\_notice\_api'); |
| [1676](#L1676) | $hide\_htaccess\_notice = get\_option('securityforce\_remove\_dashboard\_notice\_htaccess'); |
| [1677](#L1677) | $hide\_sn\_notice = get\_option('securityforce\_remove\_dashboard\_notice\_sn'); |
| [1678](#L1678) | $show\_api\_msg = ($api\_msg != '' && $hide\_api\_notice != 1); |
| [1679](#L1679) | $show\_htaccess\_msg = ($htaccess != '' && $hide\_htaccess\_notice != 1); |
| [1680](#L1680) | $show\_sn\_msg = ($tn\_msg != '' && $hide\_sn\_notice != 1); |
| [1681](#L1681) | if($show\_api\_msg || $show\_htaccess\_msg || $show\_sn\_msg){ ?> |
| [1682](#L1682) | <div id="dashboard\_notices" class="postbox"> |
| [1683](#L1683) | <button type="button" class="handlediv" aria-expanded="true"> |
| [1684](#L1684) | <span class="screen-reader-text">Toggle panel: At a Glance</span> |
| [1685](#L1685) | <span class="toggle-indicator" aria-hidden="true"></span> |
| [1686](#L1686) | </button> |
| [1687](#L1687) | <h2 class="hndle ui-sortable-handle"><strong>Notifications</strong> <span class="securityforce-dashboard-badge" id="securityforce-not-counter"><?php echo $count; ?></span></h2> |
| [1688](#L1688) | <div class="inside"> |
| [1689](#L1689) | <div class="main"> |
| [1690](#L1690) | <div class="securityforce-loader"></div> |
| [1691](#L1691) | <ul> |
| [1692](#L1692) | <?php echo $show\_api\_msg ? '<li class="securityforce-dashboard-notification">'.$api\_msg.'<button type="button" data-type="api" class="securityforce-notice-dismiss securityforce-dash-notice"><span class="screen-reader-text">Dismiss this notice.</span></button></li>' : ''; ?> |
| [1693](#L1693) | <?php echo $show\_htaccess\_msg ? '<li class="securityforce-dashboard-notification">'.$htaccess.'<button type="button" data-type="htaccess" class="securityforce-notice-dismiss securityforce-dash-notice"><span class="screen-reader-text">Dismiss this notice.</span></button></li>' : ''; ?> |
| [1694](#L1694) | <?php echo $show\_sn\_msg ? '<li class="securityforce-dashboard-notification">'.$tn\_msg.'<button type="button" data-type="tn" class="securityforce-notice-dismiss securityforce-dash-notice"><span class="screen-reader-text">Dismiss this notice.</span></button></li>' : ''; ?> |
| [1695](#L1695) | </ul> |
| [1696](#L1696) |  |
| [1697](#L1697) | </div> |
| [1698](#L1698) | </div> |
| [1699](#L1699) | </div> |
| [1700](#L1700) | <?php } ?> |
| [1701](#L1701) | <div id="dashboard\_right\_now" class="postbox"> |
| [1702](#L1702) | <button type="button" class="handlediv" aria-expanded="true"><span class="screen-reader-text">Toggle panel: At a Glance</span><span class="toggle-indicator" aria-hidden="true"></span></button><h2 class="hndle ui-sortable-handle"><span>Attacks blocked</span></h2> |
| [1703](#L1703) | <div class="inside"> |
| [1704](#L1704) | <div class="main"> |
| [1705](#L1705) | <div class="securityforce-loader"></div> |
| [1706](#L1706) | <h2><?php echo $total\_firewall\_phpidsblock; ?></h2> |
| [1707](#L1707) | <p id="wp-version-message" style="display: inline-block; width: 100%;"> |
| [1708](#L1708) | <a href="<?php echo admin\_url('admin.php?page=pro-options'); ?>" class="button" aria-describedby="wp-version">See More >></a> |
| [1709](#L1709) | </p> |
| [1710](#L1710) | </div> |
| [1711](#L1711) | </div> |
| [1712](#L1712) | </div> |
| [1713](#L1713) |  |
| [1714](#L1714) | <div id="dashboard\_top10\_intru" class="postbox" style="display: block;"> |
| [1715](#L1715) | <button type="button" class="handlediv" aria-expanded="true"> |
| [1716](#L1716) | <span class="screen-reader-text">Toggle panel: At a Glance</span> |
| [1717](#L1717) | <span class="toggle-indicator" aria-hidden="true"></span> |
| [1718](#L1718) | </button> |
| [1719](#L1719) | <h2 class="hndle ui-sortable-handle" style="font-size: 14px;padding-bottom: 9px;padding-left: 10px;"> |
| [1720](#L1720) | <span>Top 10 Attacks blocked</span> |
| [1721](#L1721) | </h2> |
| [1722](#L1722) | <div class="inside"> |
| [1723](#L1723) | <div class="main"> |
| [1724](#L1724) | <div class="securityforce-loader"></div> |
| [1725](#L1725) | <script type="text/javascript"> |
| [1726](#L1726) | var config = { |
| [1727](#L1727) | type: 'line', |
| [1728](#L1728) | data: { |
| [1729](#L1729) | labels: [ |
| [1730](#L1730) | <?php |
| [1731](#L1731) | foreach ($sale\_data as $key => $value) { |
| [1732](#L1732) | echo "'". $key ."',"; |
| [1733](#L1733) | } |
| [1734](#L1734) | ?> |
| [1735](#L1735) | ], |
| [1736](#L1736) | datasets: [{ |
| [1737](#L1737) | label: 'Firewall Attack Blocked', |
| [1738](#L1738) | backgroundColor: 'rgb(23,235,81)', |
| [1739](#L1739) | borderColor: 'rgb(23,235,81)', |
| [1740](#L1740) | data: [ |
| [1741](#L1741) | <?php |
| [1742](#L1742) | foreach ($sale\_data as $key => $value) { |
| [1743](#L1743) | echo $value . ', '; |
| [1744](#L1744) | } |
| [1745](#L1745) | ?> |
| [1746](#L1746) | ], |
| [1747](#L1747) | fill: false, |
| [1748](#L1748) | }] |
| [1749](#L1749) | }, |
| [1750](#L1750) | options: { |
| [1751](#L1751) | responsive: true, |
| [1752](#L1752) | title: { |
| [1753](#L1753) | display: true, |
| [1754](#L1754) | text: 'Blocked Attack Chart' |
| [1755](#L1755) | }, |
| [1756](#L1756) | tooltips: { |
| [1757](#L1757) | mode: 'index', |
| [1758](#L1758) | intersect: false, |
| [1759](#L1759) | }, |
| [1760](#L1760) | hover: { |
| [1761](#L1761) | mode: 'nearest', |
| [1762](#L1762) | intersect: true |
| [1763](#L1763) | }, |
| [1764](#L1764) | scales: { |
| [1765](#L1765) | xAxes: [{ |
| [1766](#L1766) | display: true, |
| [1767](#L1767) | scaleLabel: { |
| [1768](#L1768) | display: true, |
| [1769](#L1769) | labelString: 'Date' |
| [1770](#L1770) | } |
| [1771](#L1771) | }], |
| [1772](#L1772) | yAxes: [{ |
| [1773](#L1773) | display: true, |
| [1774](#L1774) | scaleLabel: { |
| [1775](#L1775) | display: true, |
| [1776](#L1776) | labelString: 'Attack Blocked' |
| [1777](#L1777) | }, |
| [1778](#L1778) | ticks: { |
| [1779](#L1779) | beginAtZero:true |
| [1780](#L1780) | } |
| [1781](#L1781) | }] |
| [1782](#L1782) | } |
| [1783](#L1783) | } |
| [1784](#L1784) | }; |
| [1785](#L1785) | </script> |
| [1786](#L1786) | <canvas id="buyers" width="600" height="400"></canvas> |
| [1787](#L1787) | </div> |
| [1788](#L1788) | </div> |
| [1789](#L1789) | </div> |
| [1790](#L1790) | <div id="dashboard\_last10\_instru" class="postbox"> |
| [1791](#L1791) | <button type="button" class="handlediv" aria-expanded="true"><span class="screen-reader-text">Toggle panel: At a Glance</span><span class="toggle-indicator" aria-hidden="true"></span></button><h2 class="hndle ui-sortable-handle" style="font-size: 14px;padding-bottom: 9px;padding-left: 10px;"><span>Last 10 Firewall blocked attack</span></h2> |
| [1792](#L1792) | <div class="inside"> |
| [1793](#L1793) | <div class="main"> |
| [1794](#L1794) | <table class="table widefat"> |
| [1795](#L1795) | <?php |
| [1796](#L1796) | $ids\_blocked\_ips = $wpdb->get\_results('SELECT \* FROM ' . $wpdb->prefix . 'securityforce\_ab\_attacks ORDER BY id DESC LIMIT 0, 10'); |
| [1797](#L1797) | ?> |
| [1798](#L1798) | <thead> |
| [1799](#L1799) | <tr> |
| [1800](#L1800) | <th>Name</th> |
| [1801](#L1801) | <th>Value</th> |
| [1802](#L1802) | <th>Impact / Total</th> |
| [1803](#L1803) | <th>IP</th> |
| [1804](#L1804) | <th>Date</th> |
| [1805](#L1805) | </tr> |
| [1806](#L1806) | </thead> |
| [1807](#L1807) | <tbody> |
| [1808](#L1808) | <?php |
| [1809](#L1809) | if(!empty($ids\_blocked\_ips)){ |
| [1810](#L1810) | foreach ($ids\_blocked\_ips as $key => $single\_arr) { |
| [1811](#L1811) | ?> |
| [1812](#L1812) | <tr> |
| [1813](#L1813) | <td><strong><?php echo sanitize\_title($single\_arr->name); ?></strong></td> |
| [1814](#L1814) | <td><?php |
| [1815](#L1815) | $allowed = array( |
| [1816](#L1816) | 'a' => array( |
| [1817](#L1817) | 'href' => array(), |
| [1818](#L1818) | 'title' => array() |
| [1819](#L1819) | ), |
| [1820](#L1820) | 'br' => array(), |
| [1821](#L1821) | 'em' => array(), |
| [1822](#L1822) | 'strong' => array() |
| [1823](#L1823) | ); |
| [1824](#L1824) | $v = wp\_kses(esc\_attr( $single\_arr->value ), $allowed); |
| [1825](#L1825) | echo $v; |
| [1826](#L1826) | ?></td> |
| [1827](#L1827) | <td><?php echo esc\_html( $single\_arr->impact )  .' / '. $single\_arr->total\_impact; ?></td> |
| [1828](#L1828) | <td><?php echo sanitize\_text\_field( $single\_arr->ip ); ?></td> |
| [1829](#L1829) | <td><?php echo date( "M d Y", strtotime( $single\_arr->created ) ); ?></td> |
| [1830](#L1830) | </tr> |
| [1831](#L1831) | <?php |
| [1832](#L1832) | } |
| [1833](#L1833) | }else{ ?> |
| [1834](#L1834) | <tr> |
| [1835](#L1835) | <td colspan="5">No result found.</td> |
| [1836](#L1836) | </tr> |
| [1837](#L1837) | <?php } |
| [1838](#L1838) | ?> |
| [1839](#L1839) | </tbody> |
| [1840](#L1840) | </table> |
| [1841](#L1841) | </div> |
| [1842](#L1842) | </div> |
| [1843](#L1843) | </div> |
| [1844](#L1844) | </div> |
| [1845](#L1845) | </div> |
| [1846](#L1846) | <div id="postbox-container-2" class="postbox-container" > |
| [1847](#L1847) | <div id="normal-sortables" class="meta-box-sortables ui-sortable"> |
| [1848](#L1848) | <div class="filter-div" style="width: 100%; display: inline-block;"> |
| [1849](#L1849) | <select id="filter\_based\_on\_time" style="float: right;"> |
| [1850](#L1850) | <option value="last-7">Last Week</option> |
| [1851](#L1851) | <option value="this month">This month</option> |
| [1852](#L1852) | <option value="last month">Last month</option> |
| [1853](#L1853) | <option value="this year">This Year</option> |
| [1854](#L1854) | </select> |
| [1855](#L1855) | </div> |
| [1856](#L1856) | <?php if(SECURITYFORCE\_LI): ?> |
| [1857](#L1857) | <div id="dashboard\_right\_now" class="postbox"> |
| [1858](#L1858) |  |
| [1859](#L1859) | <button type="button" class="handlediv" aria-expanded="true"> |
| [1860](#L1860) | <span class="screen-reader-text">Toggle panel: At a Glance</span><span class="toggle-indicator" aria-hidden="true"></span> |
| [1861](#L1861) | </button> |
| [1862](#L1862) | <h2 class="hndle ui-sortable-handle"><span>Blocked by Secure Network</span></h2> |
| [1863](#L1863) | <div class="inside"> |
| [1864](#L1864) | <div class="main"> |
| [1865](#L1865) | <div class="securityforce-loader"></div> |
| [1866](#L1866) | <h2><?php echo $total\_ips\_block; ?></h2> |
| [1867](#L1867) | <p id="wp-version-message" style="display: inline-block; width: 100%;"> |
| [1868](#L1868) | <a href="<?php echo admin\_url('admin.php?page=securityforce\_ab\_attacks') ?>" class="button" aria-describedby="wp-version">See More >></a> |
| [1869](#L1869) | </p> |
| [1870](#L1870) | </div> |
| [1871](#L1871) | </div> |
| [1872](#L1872) | </div> |
| [1873](#L1873) | <?php else: ?> |
| [1874](#L1874) | <div id="dashboard\_right\_now" class="postbox"> |
| [1875](#L1875) |  |
| [1876](#L1876) | <button type="button" class="handlediv" aria-expanded="true"> |
| [1877](#L1877) | <span class="screen-reader-text">Toggle panel: At a Glance</span><span class="toggle-indicator" aria-hidden="true"></span> |
| [1878](#L1878) | </button> |
| [1879](#L1879) | <h2 class="hndle ui-sortable-handle"><span>Premium Protection Disabled</span></h2> |
| [1880](#L1880) | <div class="inside"> |
| [1881](#L1881) | <div class="main"> |
| [1882](#L1882) | <div class="securityforce-loader"></div> |
| [1883](#L1883) | <p style="font-size: 14px;">As a free SecurityForce user, you are currently using the Community version of the Threat Defense. Premium users are protected by <u>Additional Firewall Rules</u>, <u>Malware Signatures</u>, <u>Location Based Locking</u>, <u>Reputation Checks</u> & <u>Secure Network</u>. Upgrade to Premium today to improve your protection.</p> |
| [1884](#L1884) | <div style="margin-top:20px;"> |
| [1885](#L1885) | <a href="https://securityfoce.io" target="\_blank" class="button-primary">UPGRATE TO PREMIUM</a> |
| [1886](#L1886) | &nbsp;&nbsp;<a href="https://securityfoce.io" target="\_blank" class="button-secondary">LEARN MORE</a> |
| [1887](#L1887) | </div> |
| [1888](#L1888) | </div> |
| [1889](#L1889) | </div> |
| [1890](#L1890) | </div> |
| [1891](#L1891) | <?php endif; ?> |
| [1892](#L1892) |  |
| [1893](#L1893) | <div id="dashboard\_top10\_attackers" class="postbox"> |
| [1894](#L1894) | <button type="button" class="handlediv" aria-expanded="true"> |
| [1895](#L1895) | <span class="screen-reader-text">Toggle panel: At a Glance</span> |
| [1896](#L1896) | <span class="toggle-indicator" aria-hidden="true"></span> |
| [1897](#L1897) | </button> |
| [1898](#L1898) | <h2 class="hndle ui-sortable-handle" style="font-size: 14px;padding-bottom: 9px;padding-left: 10px;"> |
| [1899](#L1899) | <span>Top 10 IP attacked blocked</span> |
| [1900](#L1900) | </h2> |
| [1901](#L1901) | <div class="inside"> |
| [1902](#L1902) | <div class="main"> |
| [1903](#L1903) | <div class="securityforce-loader"></div> |
| [1904](#L1904) | <script type="text/javascript"> |
| [1905](#L1905) | var ips\_config = { |
| [1906](#L1906) | type: 'line', |
| [1907](#L1907) | data: { |
| [1908](#L1908) | labels: [ |
| [1909](#L1909) | <?php |
| [1910](#L1910) | foreach ($sale\_data\_ip as $key => $value) { |
| [1911](#L1911) | echo "'". $key ."',"; |
| [1912](#L1912) | } |
| [1913](#L1913) | ?> |
| [1914](#L1914) | ], |
| [1915](#L1915) | datasets: [{ |
| [1916](#L1916) | label: 'IP Attack Blocked', |
| [1917](#L1917) | backgroundColor: 'rgb(23,235,81)', |
| [1918](#L1918) | borderColor: 'rgb(23,235,81)', |
| [1919](#L1919) | data: [ |
| [1920](#L1920) | <?php |
| [1921](#L1921) | foreach ($sale\_data\_ip as $key => $value) { |
| [1922](#L1922) | echo $value . ', '; |
| [1923](#L1923) | } |
| [1924](#L1924) | ?> |
| [1925](#L1925) | ], |
| [1926](#L1926) | fill: false, |
| [1927](#L1927) | }] |
| [1928](#L1928) | }, |
| [1929](#L1929) | options: { |
| [1930](#L1930) | responsive: true, |
| [1931](#L1931) | title: { |
| [1932](#L1932) | display: true, |
| [1933](#L1933) | text: 'IP Blocked Attack Chart' |
| [1934](#L1934) | }, |
| [1935](#L1935) | tooltips: { |
| [1936](#L1936) | mode: 'index', |
| [1937](#L1937) | intersect: false, |
| [1938](#L1938) | }, |
| [1939](#L1939) | hover: { |
| [1940](#L1940) | mode: 'nearest', |
| [1941](#L1941) | intersect: true |
| [1942](#L1942) | }, |
| [1943](#L1943) | scales: { |
| [1944](#L1944) | xAxes: [{ |
| [1945](#L1945) | display: true, |
| [1946](#L1946) | scaleLabel: { |
| [1947](#L1947) | display: true, |
| [1948](#L1948) | labelString: 'Date' |
| [1949](#L1949) | } |
| [1950](#L1950) | }], |
| [1951](#L1951) | yAxes: [{ |
| [1952](#L1952) | display: true, |
| [1953](#L1953) | scaleLabel: { |
| [1954](#L1954) | display: true, |
| [1955](#L1955) | labelString: 'Attack Blocked' |
| [1956](#L1956) | }, |
| [1957](#L1957) | ticks: { |
| [1958](#L1958) | beginAtZero:true |
| [1959](#L1959) | } |
| [1960](#L1960) | }] |
| [1961](#L1961) | } |
| [1962](#L1962) | } |
| [1963](#L1963) | }; |
| [1964](#L1964) |  |
| [1965](#L1965) | window.onload = function () { |
| [1966](#L1966) | //Ip chart |
| [1967](#L1967) | var ips\_ctx = document.getElementById('securityforce\_ips\_blocked').getContext('2d'); |
| [1968](#L1968) | var ips\_chart = new Chart(ips\_ctx, ips\_config); |
| [1969](#L1969) |  |
| [1970](#L1970) | //Firewall chart |
| [1971](#L1971) | var ctx = document.getElementById('buyers').getContext('2d'); |
| [1972](#L1972) | var myChart = new Chart(ctx, config); |
| [1973](#L1973) |  |
| [1974](#L1974) | jQuery('#filter\_based\_on\_time').change(function(){ |
| [1975](#L1975) | jQuery('.securityforce-loader').show(); |
| [1976](#L1976) | jQuery.ajax({ |
| [1977](#L1977) | url: ajaxurl, |
| [1978](#L1978) | data: { |
| [1979](#L1979) | "action": "securityforce\_get\_firewall\_phpidsdata", |
| [1980](#L1980) | "call\_type": jQuery(this).val(), |
| [1981](#L1981) | "attack\_type": 'IPS' |
| [1982](#L1982) | }, |
| [1983](#L1983) | type: "POST", |
| [1984](#L1984) | success: function (data) { |
| [1985](#L1985) | var obj = JSON.parse(data); |
| [1986](#L1986) | ips\_chart.data.labels = []; |
| [1987](#L1987) | ips\_chart.data.datasets[0].data = []; |
| [1988](#L1988) | var total\_ips\_cnt = 0; |
| [1989](#L1989) | jQuery.each(obj, function(key, value){ |
| [1990](#L1990) | ips\_chart.data.labels.push(value['x']); |
| [1991](#L1991) | ips\_chart.data.datasets[0].data.push(value['y']); |
| [1992](#L1992) | total\_ips\_cnt = total\_ips\_cnt + parseInt(value['y']); |
| [1993](#L1993) | }); |
| [1994](#L1994) | ips\_chart.update(); |
| [1995](#L1995) | jQuery('#postbox-container-3').find('.inside h2').text('').text(total\_ips\_cnt); |
| [1996](#L1996) | jQuery('#postbox-container-3').find('.securityforce-loader').hide(); |
| [1997](#L1997) | jQuery('#ips\_blocked\_chart').find('.securityforce-loader').hide(); |
| [1998](#L1998) | } |
| [1999](#L1999) | }); |
| [2000](#L2000) |  |
| [2001](#L2001) | jQuery.ajax({ |
| [2002](#L2002) | url: ajaxurl, |
| [2003](#L2003) | data: { |
| [2004](#L2004) | "action": "securityforce\_get\_firewall\_phpidsdata", |
| [2005](#L2005) | "call\_type": jQuery(this).val(), |
| [2006](#L2006) | }, |
| [2007](#L2007) | type: "POST", |
| [2008](#L2008) | success: function (data) { |
| [2009](#L2009) | var obj = JSON.parse(data); |
| [2010](#L2010) | myChart.data.labels = []; |
| [2011](#L2011) | myChart.data.datasets[0].data = []; |
| [2012](#L2012) | var total\_firewall\_phpidscnt = 0; |
| [2013](#L2013) | jQuery.each(obj, function(key, value){ |
| [2014](#L2014) | myChart.data.labels.push(value['x']); |
| [2015](#L2015) | myChart.data.datasets[0].data.push(value['y']); |
| [2016](#L2016) | total\_firewall\_phpidscnt = total\_firewall\_phpidscnt + parseInt(value['y']); |
| [2017](#L2017) | }); |
| [2018](#L2018) | myChart.update(); |
| [2019](#L2019) | jQuery('#postbox-container-2').find('.inside h2').text('').text(total\_firewall\_phpidscnt); |
| [2020](#L2020) | jQuery('#postbox-container-2').find('.securityforce-loader').hide(); |
| [2021](#L2021) | jQuery('#ids\_blocked\_chart').find('.securityforce-loader').hide(); |
| [2022](#L2022) | //Remove this code |
| [2023](#L2023) | jQuery('.securityforce-loader').hide(); |
| [2024](#L2024) | } |
| [2025](#L2025) | }); |
| [2026](#L2026) | }); |
| [2027](#L2027) |  |
| [2028](#L2028) | jQuery('.show-fixes-button').click(function(e){ |
| [2029](#L2029) | e.preventDefault(); |
| [2030](#L2030) | if(jQuery('.show-fixes-div').is(":visible")){ |
| [2031](#L2031) | jQuery('.show-fixes-div').slideUp(); |
| [2032](#L2032) | jQuery('.show-fixes-button').text('').text('Show Fixes'); |
| [2033](#L2033) | }else{ |
| [2034](#L2034) | jQuery('.show-fixes-button').text('').text('Hide Fixes'); |
| [2035](#L2035) | jQuery('.show-fixes-div').slideDown(); |
| [2036](#L2036) | } |
| [2037](#L2037) | }); |
| [2038](#L2038) |  |
| [2039](#L2039) | jQuery('.securityforce-dash-notice').click(function (e){ |
| [2040](#L2040) | e.preventDefault(); |
| [2041](#L2041) | var btn = jQuery(this); |
| [2042](#L2042) | jQuery.ajax({ |
| [2043](#L2043) | url: ajaxurl, |
| [2044](#L2044) | data: { |
| [2045](#L2045) | "action": "securityforce\_remove\_dashboard\_notice", |
| [2046](#L2046) | "type": btn.data('type') |
| [2047](#L2047) | }, |
| [2048](#L2048) | type: "POST", |
| [2049](#L2049) | success: function (data) { |
| [2050](#L2050) | btn.closest('li').slideUp(); |
| [2051](#L2051) | var c = +jQuery('#securityforce-not-counter').text(); |
| [2052](#L2052) | if(c == 1) { |
| [2053](#L2053) | jQuery('#dashboard\_notices').slideUp(); |
| [2054](#L2054) | } else { |
| [2055](#L2055) | jQuery('#securityforce-not-counter').text(--c) |
| [2056](#L2056) | } |
| [2057](#L2057) | } |
| [2058](#L2058) | }); |
| [2059](#L2059) | }); |
| [2060](#L2060) | } |
| [2061](#L2061) | </script> |
| [2062](#L2062) | <canvas id="securityforce\_ips\_blocked" width="600" height="400"></canvas> |
| [2063](#L2063) | </div> |
| [2064](#L2064) | </div> |
| [2065](#L2065) | </div> |
| [2066](#L2066) | <div id="dashboard\_last10\_attackers" class="postbox" > |
| [2067](#L2067) | <button type="button" class="handlediv" aria-expanded="true"><span class="screen-reader-text">Toggle panel: At a Glance</span><span class="toggle-indicator" aria-hidden="true"></span></button><h2 class="hndle ui-sortable-handle" style="font-size: 14px;padding-bottom: 9px;padding-left: 10px;"><span>Top 10 IP addresses blocked</span></h2> |
| [2068](#L2068) | <div class="inside"> |
| [2069](#L2069) | <div class="main"> |
| [2070](#L2070) | <?php |
| [2071](#L2071) | $ips\_arr = $wpdb->get\_results('SELECT \* FROM ' . $wpdb->prefix . 'securityforce\_blocked\_ips ORDER BY id DESC LIMIT 0, 10'); |
| [2072](#L2072) | ?> |
| [2073](#L2073) | <table class="table widefat"> |
| [2074](#L2074) | <thead> |
| [2075](#L2075) | <tr> |
| [2076](#L2076) | <th>IP</th> |
| [2077](#L2077) | <th>Date</th> |
| [2078](#L2078) | </tr> |
| [2079](#L2079) | </thead> |
| [2080](#L2080) | <tbody> |
| [2081](#L2081) | <?php |
| [2082](#L2082) | if(!empty($ips\_arr)){ |
| [2083](#L2083) | foreach ($ips\_arr as $key => $ips\_single\_arr) { ?> |
| [2084](#L2084) | <tr> |
| [2085](#L2085) | <td><?php echo $ips\_single\_arr->ip; ?></td> |
| [2086](#L2086) | <td><?php echo date( "M d Y", strtotime( $ips\_single\_arr->created ) ); ?></td> |
| [2087](#L2087) | </tr> |
| [2088](#L2088) | <?php |
| [2089](#L2089) | } |
| [2090](#L2090) | } else { ?> |
| [2091](#L2091) | <tr> |
| [2092](#L2092) | <td colspan="2">No result found.</td> |
| [2093](#L2093) | </tr> |
| [2094](#L2094) | <?php } |
| [2095](#L2095) | ?> |
| [2096](#L2096) | </tbody> |
| [2097](#L2097) | </table> |
| [2098](#L2098) | </div> |
| [2099](#L2099) | </div> |
| [2100](#L2100) | </div> |
| [2101](#L2101) | </div> |
| [2102](#L2102) | </div> <!-- postbox-2 --> |
| [2103](#L2103) | </div> |
| [2104](#L2104) | </div> |
| [2105](#L2105) | </div> |
| [2106](#L2106) |  |
| [2107](#L2107) | <?php |
| [2108](#L2108) | } |
| [2109](#L2109) |  |
| [2110](#L2110) | public function plugin\_actions\_links($links) { |
| [2111](#L2111) | if ($this->settings\_menu['action\_link']) |
| [2112](#L2112) | $links[] = '<a href="' . admin\_url("admin.php?page=" . $this->settings\_menu['name']) . '" >' . |
| [2113](#L2113) | $this->settings\_menu['action\_link'] . '</a>'; |
| [2114](#L2114) | return $links; |
| [2115](#L2115) | } |
| [2116](#L2116) |  |
| [2117](#L2117) | public static function getInstance() { |
| [2118](#L2118) | if (!self::$\_instance) { |
| [2119](#L2119) | self::$\_instance = new WeDevs\_Settings\_API(); |
| [2120](#L2120) | } |
| [2121](#L2121) |  |
| [2122](#L2122) | return self::$\_instance; |
| [2123](#L2123) | } |
| [2124](#L2124) |  |
| [2125](#L2125) | /\*\* |
| [2126](#L2126) | \* Set settings sections |
| [2127](#L2127) | \* |
| [2128](#L2128) | \* @param array $sections setting sections array |
| [2129](#L2129) | \*/ |
| [2130](#L2130) | function set\_sections($sections) { |
| [2131](#L2131) | $this->settings\_sections = $sections; |
| [2132](#L2132) | } |
| [2133](#L2133) |  |
| [2134](#L2134) | /\*\* |
| [2135](#L2135) | \* Set settings fields |
| [2136](#L2136) | \* |
| [2137](#L2137) | \* @param array $fields settings fields array |
| [2138](#L2138) | \*/ |
| [2139](#L2139) | function set\_fields($fields) { |
| [2140](#L2140) | $this->settings\_fields = $fields; |
| [2141](#L2141) | } |
| [2142](#L2142) |  |
| [2143](#L2143) | /\*\* |
| [2144](#L2144) | \* Set settings fields |
| [2145](#L2145) | \* |
| [2146](#L2146) | \* @param array $fields settings fields array |
| [2147](#L2147) | \*/ |
| [2148](#L2148) | function set\_menu($menu) { |
| [2149](#L2149) | $this->settings\_menu = $menu; |
| [2150](#L2150) | } |
| [2151](#L2151) |  |
| [2152](#L2152) | /\*\* |
| [2153](#L2153) | \* Initialize and registers the settings sections and fileds to WordPress |
| [2154](#L2154) | \* |
| [2155](#L2155) | \* Usually this should be called at `admin\_init` hook. |
| [2156](#L2156) | \* |
| [2157](#L2157) | \* This function gets the initiated settings sections and fields. Then |
| [2158](#L2158) | \* registers them to WordPress and ready for use. |
| [2159](#L2159) | \*/ |
| [2160](#L2160) | public function admin\_init() { |
| [2161](#L2161) | //Disable Drag |
| [2162](#L2162) | $pageName = $this->settings\_menu['name'] ?? 'default\_name'; |
| [2163](#L2163) |  |
| [2164](#L2164) | if (isset($\_GET['page']) && $\_GET['page'] == $pageName) { |
| [2165](#L2165) | // This will deregister the 'postbox' script only on the specific admin page |
| [2166](#L2166) | wp\_deregister\_script('postbox'); |
| [2167](#L2167) | } |
| [2168](#L2168) |  |
| [2169](#L2169) |  |
| [2170](#L2170) |  |
| [2171](#L2171) | // if (isset($\_GET['page']) && $\_GET['page'] == 'security\_force\_dashboard' && isset($\_GET['action']) && $\_GET['action'] == 'add\_new') { |
| [2172](#L2172) | //     $this->render\_add\_new\_widget\_page(); |
| [2173](#L2173) | //     return;  // Stop further processing since we're handling the add new widget page |
| [2174](#L2174) | // } |
| [2175](#L2175) |  |
| [2176](#L2176) | $menuName = isset($this->settings\_menu['name']) ? $this->settings\_menu['name'] : 'default\_menu\_name'; |
| [2177](#L2177) | $menuVersion = isset($this->settings\_menu['version']) ? $this->settings\_menu['version'] : 'default\_version'; |
| [2178](#L2178) |  |
| [2179](#L2179) | if (!get\_option($menuName) || !$this->get\_option('db\_ver') || $this->get\_option('db\_ver') < $menuVersion) { |
| [2180](#L2180) | $this->update\_defaults(); |
| [2181](#L2181) | } |
| [2182](#L2182) | //add\_option( $this->settings\_menu['name'] ); |
| [2183](#L2183) | //register settings sections |
| [2184](#L2184) | foreach ($this->settings\_sections as $section) { |
| [2185](#L2185) |  |
| [2186](#L2186) |  |
| [2187](#L2187) | add\_settings\_section($section['id'], $section['title'], '\_\_return\_false', $this->settings\_menu['name']); |
| [2188](#L2188) | } |
| [2189](#L2189) |  |
| [2190](#L2190) | //register settings fields |
| [2191](#L2191) | foreach ($this->settings\_fields as $section => $field) { |
| [2192](#L2192) | foreach ($field as $option) { |
| [2193](#L2193) | $args = array( |
| [2194](#L2194) | 'id' => $option['name'], |
| [2195](#L2195) | 'desc' => $option['desc'], |
| [2196](#L2196) | 'name' => $option['label'], |
| [2197](#L2197) | 'section' => $section, |
| [2198](#L2198) | 'class' => isset($option['class']) ? $option['class'] : null, |
| [2199](#L2199) | 'options' => isset($option['options']) ? $option['options'] : '', |
| [2200](#L2200) | 'std' => isset($option['default']) ? $option['default'] : '' |
| [2201](#L2201) | ); |
| [2202](#L2202) | add\_settings\_field($option['name'], $option['label'], array($this, 'callback\_' . $option['type']), $this->settings\_menu['name'], $section, $args); |
| [2203](#L2203) | } |
| [2204](#L2204) | } |
| [2205](#L2205) |  |
| [2206](#L2206) | // creates our settings in the options table |
| [2207](#L2207) | //foreach ($this->settings\_sections as $section) { |
| [2208](#L2208) | $menuName = $this->settings\_menu['name'] ?? 'default\_settings\_name'; |
| [2209](#L2209) | register\_setting($menuName, $menuName, array(&$this, 'admin\_settings\_validate')); |
| [2210](#L2210) | //} |
| [2211](#L2211) | } |
| [2212](#L2212) |  |
| [2213](#L2213) | // validate our settings |
| [2214](#L2214) |  |
| [2215](#L2215) | function admin\_settings\_validate($input) { |
| [2216](#L2216) |  |
| [2217](#L2217) | do\_action('securityforce\_settings\_api\_validate', $input); |
| [2218](#L2218) |  |
| [2219](#L2219) |  |
| [2220](#L2220) |  |
| [2221](#L2221) | //      if (empty($input['sample\_text'])) { |
| [2222](#L2222) | // |
| [2223](#L2223) | //                add\_settings\_error( |
| [2224](#L2224) | //                    'sample\_text',           // setting title |
| [2225](#L2225) | //                    'sample\_text\_error',            // error ID |
| [2226](#L2226) | //                    'Please enter some sample text',   // error message |
| [2227](#L2227) | //                    'error'                        // type of message |
| [2228](#L2228) | //                ); |
| [2229](#L2229) | // |
| [2230](#L2230) | //       } |
| [2231](#L2231) | return $input; |
| [2232](#L2232) | } |
| [2233](#L2233) |  |
| [2234](#L2234) | /\*\* |
| [2235](#L2235) | \* Displays a text field for a settings field |
| [2236](#L2236) | \* |
| [2237](#L2237) | \* @param array $args settings field args |
| [2238](#L2238) | \*/ |
| [2239](#L2239) | function callback\_text($args) { |
| [2240](#L2240) |  |
| [2241](#L2241) | $value = esc\_attr($this->get\_option($args['id'], $this->settings\_menu['name'])); |
| [2242](#L2242) | // $class = isset( $args['class'] ) && !is\_null( $args['class'] ) ? $args['class'] : 'regular'; |
| [2243](#L2243) |  |
| [2244](#L2244) | $html = sprintf('<input type="text" class="regular-text %1$s" id="%4$s" name="%2$s[%4$s]" value="%5$s"/>', $args['class'], $this->settings\_menu['name'], $args['section'], $args['id'], $value); |
| [2245](#L2245) | $html .= '<span class="securityforce-help"><span class="securityforce-help-icon"></span><span class="securityforce-help-text">'.$args['desc'].'</span></span>'; |
| [2246](#L2246) |  |
| [2247](#L2247) | echo $html; |
| [2248](#L2248) | } |
| [2249](#L2249) |  |
| [2250](#L2250) | function callback\_number($args) { |
| [2251](#L2251) |  |
| [2252](#L2252) | $value = esc\_attr($this->get\_option($args['id'], $this->settings\_menu['name'])); |
| [2253](#L2253) | // $class = isset( $args['class'] ) && !is\_null( $args['class'] ) ? $args['class'] : 'regular'; |
| [2254](#L2254) |  |
| [2255](#L2255) | $html = sprintf('<input type="text" class="regular-number %1$s" id="%4$s" name="%2$s[%4$s]" value="%5$s" style="width:50px;"/>', $args['class'], $this->settings\_menu['name'], $args['section'], $args['id'], $value); |
| [2256](#L2256) | $html .= '<span class="securityforce-help"><span class="securityforce-help-icon"></span><span class="securityforce-help-text">'.$args['desc'].'</span></span>'; |
| [2257](#L2257) |  |
| [2258](#L2258) | echo $html; |
| [2259](#L2259) | } |
| [2260](#L2260) |  |
| [2261](#L2261) | function callback\_hidden($args) { |
| [2262](#L2262) | echo '</td></tr><tr valign="top" style="display:none;"><td colspan="2"><span class="' . $args['class'] . '">' . $args['desc'] . '</span>'; |
| [2263](#L2263) | } |
| [2264](#L2264) |  |
| [2265](#L2265) | function callback\_html($args) { |
| [2266](#L2266) | echo '</td></tr><tr valign="top"><td colspan="2"><span class="' . $args['class'] . '">' . $args['desc'] . '</span>'; |
| [2267](#L2267) | } |
| [2268](#L2268) |  |
| [2269](#L2269) | function callback\_custom($args) { |
| [2270](#L2270) | echo '<div class="' . $args['class'] . '">' . $args['desc'] . '</div>'; |
| [2271](#L2271) | } |
| [2272](#L2272) |  |
| [2273](#L2273) | function callback\_wp\_editor($args) { |
| [2274](#L2274) | // $value = esc\_attr( $this->get\_option( $args['id'], $this->settings\_menu['name'], $args['std'] ) ); |
| [2275](#L2275) |  |
| [2276](#L2276) | $value = $this->get\_option($args['id'], $this->settings\_menu['name']); |
| [2277](#L2277) |  |
| [2278](#L2278) | echo wp\_editor($value, $this->settings\_menu['name'] . '\_' . $args['id'], array('textarea\_name' => $this->settings\_menu['name'] . '[' . $args['id'] . ']', 'textarea\_rows' => '5', 'wpautop' => false, 'dfw' => false, 'media\_buttons' => true, 'quicktags' => true, 'tinymce' => true, 'editor\_class' => $args['class'], 'teeny' => false)); |
| [2279](#L2279) | echo sprintf('<span class="description"> %s</span>', $args['desc']); |
| [2280](#L2280) | } |
| [2281](#L2281) |  |
| [2282](#L2282) | function callback\_file($args) { |
| [2283](#L2283) | $value = esc\_attr($this->get\_option($args['id'], $this->settings\_menu['name'])); |
| [2284](#L2284) |  |
| [2285](#L2285) | $html = sprintf('<input type="text" class="regular-text image-upload-url %1$s" id="%3$s" name="%2$s[%3$s]" value="%4$s" />', $args['class'], $this->settings\_menu['name'], $args['id'], $value); |
| [2286](#L2286) | $html .= sprintf('<input id="st\_upload\_button" class="image-upload-button" type="button" name="upload\_button" value="%s" />', \_\_('Select', $this->settings\_menu['name'])); |
| [2287](#L2287) |  |
| [2288](#L2288) | $html .= sprintf('<span class="description"> %s</span>', $args['desc']); |
| [2289](#L2289) |  |
| [2290](#L2290) | echo $html; |
| [2291](#L2291) | } |
| [2292](#L2292) |  |
| [2293](#L2293) | /\*\* |
| [2294](#L2294) | \* Displays a checkbox for a settings field |
| [2295](#L2295) | \* |
| [2296](#L2296) | \* @param array $args settings field args |
| [2297](#L2297) | \*/ |
| [2298](#L2298) | function callback\_checkbox($args) { |
| [2299](#L2299) |  |
| [2300](#L2300) | $value = esc\_attr($this->get\_option($args['id'], $this->settings\_menu['name'])); |
| [2301](#L2301) |  |
| [2302](#L2302) | $html = sprintf('<input type="checkbox" class="checkbox %1$s" id="%3$s" name="%2$s[%3$s]" value="on"%4$s/>', $args['class'], $this->settings\_menu['name'], $args['id'], checked('on', $value, false)); |
| [2303](#L2303) | $html .= '<span class="securityforce-help"><span class="securityforce-help-icon"></span><span class="securityforce-help-text">'.$args['desc'].'</span></span>'; |
| [2304](#L2304) |  |
| [2305](#L2305) | echo $html; |
| [2306](#L2306) | } |
| [2307](#L2307) |  |
| [2308](#L2308) | /\*\* |
| [2309](#L2309) | \* Displays a multicheckbox a settings field |
| [2310](#L2310) | \* |
| [2311](#L2311) | \* @param array $args settings field args |
| [2312](#L2312) | \*/ |
| [2313](#L2313) | function callback\_multicheck($args) { |
| [2314](#L2314) |  |
| [2315](#L2315) | $value = $this->get\_option($args['id'], $this->settings\_menu['name']); |
| [2316](#L2316) |  |
| [2317](#L2317) | if (!$args['options']) |
| [2318](#L2318) | return; |
| [2319](#L2319) | //option name should not be 0 to work correctly with empty option |
| [2320](#L2320) | $html = ''; |
| [2321](#L2321) | foreach ($args['options'] as $key => $label) { |
| [2322](#L2322) | $checked = isset($value[$key]) ? $value[$key] : '0'; |
| [2323](#L2323) | $html .= sprintf('<input type="checkbox" class="checkbox %1$s" id="%3$s\_%4$s" name="%2$s[%3$s][%4$s]" value="%4$s"%5$s />', $args['class'], $this->settings\_menu['name'], $args['id'], $key, checked($checked, $key, false)); |
| [2324](#L2324) | $html .= sprintf('<label for="%2$s\_%4$s"> %3$s</label><br>', $this->settings\_menu['name'], $args['id'], $label, $key); |
| [2325](#L2325) | } |
| [2326](#L2326) | $html .= sprintf('<span class="description"> %s</label>', $args['desc']); |
| [2327](#L2327) |  |
| [2328](#L2328) | echo $html; |
| [2329](#L2329) | } |
| [2330](#L2330) |  |
| [2331](#L2331) | /\*\* |
| [2332](#L2332) | \* Displays a multicheckbox a settings field |
| [2333](#L2333) | \* |
| [2334](#L2334) | \* @param array $args settings field args |
| [2335](#L2335) | \*/ |
| [2336](#L2336) | function callback\_radio($args) { |
| [2337](#L2337) |  |
| [2338](#L2338) | $value = $this->get\_option($args['id'], $this->settings\_menu['name']); |
| [2339](#L2339) |  |
| [2340](#L2340) | $html = '<div class="securityforce-radio">'; |
| [2341](#L2341) | foreach ($args['options'] as $key => $label) { |
| [2342](#L2342) | $html .= sprintf('<input type="radio" class="radio %1$s" id="%3$s\_%4$s" name="%2$s[%3$s]" value="%4$s"%5$s />', $args['class'], $this->settings\_menu['name'], $args['id'], $key, checked($value, $key, false)); |
| [2343](#L2343) | $html .= sprintf('<label for="%2$s\_%4$s"> %3$s</label><br>', $this->settings\_menu['name'], $args['id'], $label, $key); |
| [2344](#L2344) | } |
| [2345](#L2345) | $html .= '</div>'; |
| [2346](#L2346) | $html .= sprintf('<span class="description"> %s</label>', $args['desc']); |
| [2347](#L2347) |  |
| [2348](#L2348) | echo $html; |
| [2349](#L2349) | } |
| [2350](#L2350) |  |
| [2351](#L2351) | /\*\* |
| [2352](#L2352) | \* Displays a selectbox for a settings field |
| [2353](#L2353) | \* |
| [2354](#L2354) | \* @param array $args settings field args |
| [2355](#L2355) | \*/ |
| [2356](#L2356) | function callback\_select($args) { |
| [2357](#L2357) |  |
| [2358](#L2358) |  |
| [2359](#L2359) | $value = esc\_attr($this->get\_option($args['id'], $this->settings\_menu['name'])); |
| [2360](#L2360) | //$class = isset( $args['class'] ) && !is\_null( $args['class'] ) ? $args['class'] : 'regular'; |
| [2361](#L2361) |  |
| [2362](#L2362) | $html = sprintf('<select class="regular pages\_list selectbox %1$s" name="%2$s[%3$s]" id="%3$s">', $args['class'], $this->settings\_menu['name'], $args['id']); |
| [2363](#L2363) | foreach ($args['options'] as $key => $label) { |
| [2364](#L2364) | $html .= sprintf('<option value="%s"%s>%s</option>', $key, selected($value, $key, false), $label); |
| [2365](#L2365) | } |
| [2366](#L2366) | $html .= sprintf('</select>'); |
| [2367](#L2367) | $html .= sprintf('<span class="description"> %s</span>', $args['desc']); |
| [2368](#L2368) |  |
| [2369](#L2369) | echo $html; |
| [2370](#L2370) | } |
| [2371](#L2371) |  |
| [2372](#L2372) | /\*\* |
| [2373](#L2373) | \* Displays a selectbox for a settings field |
| [2374](#L2374) | \* |
| [2375](#L2375) | \* @param array $args settings field args |
| [2376](#L2376) | \*/ |
| [2377](#L2377) | function callback\_rolelist($args) { |
| [2378](#L2378) | global $wp\_roles; |
| [2379](#L2379) |  |
| [2380](#L2380) | if ($wp\_roles->roles) |
| [2381](#L2381) | foreach ($wp\_roles->roles as $key => $val) |
| [2382](#L2382) | if ($key != 'administrator') |
| [2383](#L2383) | $args['options'][$key] = $wp\_roles->roles[$key]['name']; |
| [2384](#L2384) |  |
| [2385](#L2385) | $value = $this->get\_option($args['id'], $this->settings\_menu['name']); |
| [2386](#L2386) | $html = ''; |
| [2387](#L2387) | $html .= '<div class="securityforce-checkbox">'; |
| [2388](#L2388) | foreach ($args['options'] as $key => $label) { |
| [2389](#L2389) | $checked = isset($value[$key]) ? $value[$key] : '0'; |
| [2390](#L2390) |  |
| [2391](#L2391) | $html .= sprintf('<input type="checkbox" class="checkbox user\_roles\_checkbox %1$s" id="%3$s\_%4$s" name="%2$s[%3$s][%4$s]" value="%4$s"%5$s />', $args['class'], $this->settings\_menu['name'], $args['id'], $key, checked($checked, $key, false)); |
| [2392](#L2392) | $html .= sprintf('<label for="%2$s\_%4$s"> %3$s</label><br>', $this->settings\_menu['name'], $args['id'], $label, $key); |
| [2393](#L2393) | } |
| [2394](#L2394) | $html .= '</div>'; |
| [2395](#L2395) | $html .= '<span class="securityforce-help"><span class="securityforce-help-icon"></span><span class="securityforce-help-text">'.$args['desc'].'</span></span>'; |
| [2396](#L2396) |  |
| [2397](#L2397) | echo $html; |
| [2398](#L2398) | } |
| [2399](#L2399) |  |
| [2400](#L2400) | function callback\_pagelist($args) { |
| [2401](#L2401) | $value = esc\_attr($this->get\_option($args['id'], $this->settings\_menu['name'])); |
| [2402](#L2402) | $name = sprintf('%1$s[%2$s]', $this->settings\_menu['name'], $args['id']); |
| [2403](#L2403) |  |
| [2404](#L2404) | $q = array( |
| [2405](#L2405) | 'depth' => 0, 'child\_of' => 0, |
| [2406](#L2406) | 'selected' => $value, 'echo' => 0, |
| [2407](#L2407) | 'name' => $name, 'id' => $args['id'], |
| [2408](#L2408) | 'show\_option\_none' => '', 'show\_option\_no\_change' => '', |
| [2409](#L2409) | 'option\_none\_value' => '' |
| [2410](#L2410) | ); |
| [2411](#L2411) |  |
| [2412](#L2412) | $html = wp\_dropdown\_pages($q); |
| [2413](#L2413) | $html = str\_replace('<select', '<select class="' . $args['class'] . '" ', $html); |
| [2414](#L2414) |  |
| [2415](#L2415) | $html .= sprintf('<span class="description"> %s</span>', $args['desc']); |
| [2416](#L2416) | echo $html; |
| [2417](#L2417) | } |
| [2418](#L2418) |  |
| [2419](#L2419) | /\*\* |
| [2420](#L2420) | \* Displays a textarea for a settings field |
| [2421](#L2421) | \* |
| [2422](#L2422) | \* @param array $args settings field args |
| [2423](#L2423) | \*/ |
| [2424](#L2424) | function callback\_textarea($args) { |
| [2425](#L2425) |  |
| [2426](#L2426) | $value = esc\_textarea($this->get\_option($args['id'], $this->settings\_menu['name'])); |
| [2427](#L2427) | //$class = isset( $args['class'] ) && !is\_null( $args['class'] ) ? $args['class'] : 'regular'; |
| [2428](#L2428) |  |
| [2429](#L2429) | $html = sprintf('<textarea rows="5" cols="65" class="regular-text %1$s" id="%3$s" name="%2$s[%3$s]">%4$s</textarea>', $args['class'], $this->settings\_menu['name'], $args['id'], $value); |
| [2430](#L2430) | $html .= '<span class="securityforce-help"><span class="securityforce-help-icon"></span><span class="securityforce-help-text">'.$args['desc'].'</span></span>'; |
| [2431](#L2431) |  |
| [2432](#L2432) | echo $html; |
| [2433](#L2433) | } |
| [2434](#L2434) |  |
| [2435](#L2435) | function callback\_export($args) { |
| [2436](#L2436) |  |
| [2437](#L2437) | if (isset($\_GET['export\_settings']) && $\_GET['export\_settings']) { |
| [2438](#L2438) |  |
| [2439](#L2439) | $empty\_keys = array\_keys(array\_diff\_key($this->get\_defaults(), get\_option($this->settings\_menu['name']))); |
| [2440](#L2440) | $empty\_keys = array\_fill\_keys($empty\_keys, ''); |
| [2441](#L2441) | $value = get\_option($this->settings\_menu['name']); |
| [2442](#L2442) | $value = str\_replace(array("\r\n", "\n", "\r"), '[new\_line]', $value); |
| [2443](#L2443) | $value = str\_replace("\/", '[double\_slashes]', $value); |
| [2444](#L2444) |  |
| [2445](#L2445) | $value = str\_replace('"', '[quotation]', $value); |
| [2446](#L2446) | $value = str\_replace('{', '[o\_cb]', $value); |
| [2447](#L2447) | $value = str\_replace('}', '[c\_cb]', $value); |
| [2448](#L2448) | //$value = str\_replace('[', '[o\_b]', $value); |
| [2449](#L2449) | //  $value = str\_replace(']', '[c\_b]', $value); |
| [2450](#L2450) |  |
| [2451](#L2451) | $value = esc\_textarea(stripslashes(json\_encode(array\_merge($value, $empty\_keys), JSON\_UNESCAPED\_UNICODE))); |
| [2452](#L2452) |  |
| [2453](#L2453) | //$class = isset( $args['class'] ) && !is\_null( $args['class'] ) ? $args['class'] : 'regular'; |
| [2454](#L2454) | $html = sprintf('<strong> %s </strong><br/>', $args['desc']); |
| [2455](#L2455) | $html .= sprintf('<textarea readonly="readonly" onclick="this.focus();this.select()" rows="5" cols="65" class="regular-text %1$s" id="%2$s" name="%2$s" style="%4$s">%3$s</textarea>', $args['class'], 'export\_field', $value, 'width:95% !important;height:400px !important'); |
| [2456](#L2456) |  |
| [2457](#L2457) |  |
| [2458](#L2458) | echo $html; |
| [2459](#L2459) | } else { |
| [2460](#L2460) | echo '<a href="' . add\_query\_arg(array('export\_settings' => true)) . '" class="button">' . \_\_('Export Current Settings', $this->settings\_menu['name']) . '</a>'; |
| [2461](#L2461) | echo sprintf('<br><span class="description"> %s</span>', $args['desc']); |
| [2462](#L2462) | } |
| [2463](#L2463) | } |
| [2464](#L2464) |  |
| [2465](#L2465) | function callback\_import($args) { |
| [2466](#L2466) | $html = ''; |
| [2467](#L2467) |  |
| [2468](#L2468) | if ($args['options']) { |
| [2469](#L2469) | $html .= sprintf('<select class="regular selectbox %1$s" name="import\_options" id="%3$s">', $args['class'], $this->settings\_menu['name'], $args['id']); |
| [2470](#L2470) |  |
| [2471](#L2471) | $html .= sprintf('<option value="" selected="selected">&#8212; Select Security Level &#8212;</option>'); |
| [2472](#L2472) | foreach ($args['options'] as $key => $settings\_value) |
| [2473](#L2473) | $html .= sprintf('<option value="%s">%s</option>', esc\_textarea(stripslashes($settings\_value)), ucfirst($key)); |
| [2474](#L2474) |  |
| [2475](#L2475) |  |
| [2476](#L2476) | $html .= sprintf('</select>'); |
| [2477](#L2477) | //$html .= '  <a href="'. home\_url() . '/wp-admin/admin.php?page=pro-options' .'" class="button button-primary">Open Wizard</a>'; |
| [2478](#L2478) | $html .= '<br>'; |
| [2479](#L2479) | } |
| [2480](#L2480) |  |
| [2481](#L2481) | //$html .= sprintf('<span class="description">%s</span>', $args['desc']); |
| [2482](#L2482) | $html .= '<br>'; |
| [2483](#L2483) |  |
| [2484](#L2484) | $value = ''; |
| [2485](#L2485) | //$class = isset( $args['class'] ) && !is\_null( $args['class'] ) ? $args['class'] : 'regular'; |
| [2486](#L2486) |  |
| [2487](#L2487) | $html .= sprintf('<textarea style="display: none;" rows="5" cols="65" class="regular-text %1$s" id="%2$s" name="%2$s">%3$s</textarea>', $args['class'], 'import\_field', $value); |
| [2488](#L2488) | // $html .= sprintf( '<br><span class="description"> %s</span>', $args['desc'] ); |
| [2489](#L2489) |  |
| [2490](#L2490) | echo $html; |
| [2491](#L2491) | } |
| [2492](#L2492) |  |
| [2493](#L2493) | function callback\_debug\_report($args) { |
| [2494](#L2494) | global $wp\_version; |
| [2495](#L2495) |  |
| [2496](#L2496) | if (!isset($\_GET['debug\_report'])) { |
| [2497](#L2497) | echo '<a href="' . add\_query\_arg(array('debug\_report' => true)) . '" class="button">' . \_\_('Generate Debug Report', $this->settings\_menu['name']) . '</a>'; |
| [2498](#L2498) | echo sprintf('<br><span class="description"> %s</span>', $args['desc']); |
| [2499](#L2499) | } else { |
| [2500](#L2500) |  |
| [2501](#L2501) | /\* Get from WooCommerce by WooThemes http://woothemes.com  \*/ |
| [2502](#L2502) | $active\_plugins = (array) get\_option('active\_plugins', array()); |
| [2503](#L2503) | if (is\_multisite()) |
| [2504](#L2504) | $active\_plugins = array\_merge($active\_plugins, get\_site\_option('active\_sitewide\_plugins', array())); |
| [2505](#L2505) |  |
| [2506](#L2506) | $active\_plugins = array\_map('strtolower', $active\_plugins); |
| [2507](#L2507) | $securityforce\_plugins = array(); |
| [2508](#L2508) |  |
| [2509](#L2509) | foreach ($active\_plugins as $plugin) { |
| [2510](#L2510) | $plugin\_data = @get\_plugin\_data(WP\_PLUGIN\_DIR . '/' . $plugin); |
| [2511](#L2511) | if (!empty($plugin\_data['Name'])) { |
| [2512](#L2512) | $securityforce\_plugins[] = $plugin\_data['Name'] . ' ' . $plugin\_data['Version'] . ' [' . $plugin\_data['PluginURI'] . "]"; |
| [2513](#L2513) | } |
| [2514](#L2514) | } |
| [2515](#L2515) |  |
| [2516](#L2516) | if ($securityforce\_plugins) |
| [2517](#L2517) | $plugin\_list = implode("\n", $securityforce\_plugins); |
| [2518](#L2518) |  |
| [2519](#L2519) |  |
| [2520](#L2520) | $wp\_info = ( is\_multisite() ) ? 'WPMU ' . $wp\_version : 'WP ' . $wp\_version; |
| [2521](#L2521) | $wp\_debug = ( defined('WP\_DEBUG') && WP\_DEBUG ) ? 'true' : 'false'; |
| [2522](#L2522) | $is\_ssl = ( is\_ssl() ) ? 'true' : 'false'; |
| [2523](#L2523) | $is\_rtl = ( is\_rtl() ) ? 'true' : 'false'; |
| [2524](#L2524) | $fsockopen = ( function\_exists('fsockopen') ) ? 'true' : 'false'; |
| [2525](#L2525) | $curl = ( function\_exists('curl\_init') ) ? 'true' : 'false'; |
| [2526](#L2526) | $max\_upload\_size = (function\_exists('size\_format')) ? size\_format(wp\_max\_upload\_size()) : wp\_convert\_bytes\_to\_hr(wp\_max\_upload\_size()); |
| [2527](#L2527) |  |
| [2528](#L2528) | if (function\_exists('phpversion')) { |
| [2529](#L2529) | $php\_info = phpversion(); |
| [2530](#L2530) | $max\_server\_upload = ini\_get('upload\_max\_filesize'); |
| [2531](#L2531) | $post\_max\_size = ini\_get('post\_max\_size'); |
| [2532](#L2532) | } |
| [2533](#L2533) |  |
| [2534](#L2534) | $empty\_keys = array\_keys(array\_diff\_key($this->get\_defaults(), get\_option($this->settings\_menu['name']))); |
| [2535](#L2535) | $empty\_keys = array\_fill\_keys($empty\_keys, ''); |
| [2536](#L2536) |  |
| [2537](#L2537) | $value = ' |
| [2538](#L2538) | =========================================================== |
| [2539](#L2539) | WP Settings |
| [2540](#L2540) | =========================================================== |
| [2541](#L2541) | WordPress version:      ' . $wp\_info . ' |
| [2542](#L2542) | Home URL:       ' . home\_url() . ' |
| [2543](#L2543) | Site URL:       ' . site\_url() . ' |
| [2544](#L2544) | Is SSL:         ' . $is\_ssl . ' |
| [2545](#L2545) | Is RTL:         ' . $is\_rtl . ' |
| [2546](#L2546) | Permalink:      ' . get\_option('permalink\_structure') . ' |
| [2547](#L2547) |  |
| [2548](#L2548) | ============================================================ |
| [2549](#L2549) | Server Environment |
| [2550](#L2550) | ============================================================ |
| [2551](#L2551) | PHP Version:            ' . $php\_info . ' |
| [2552](#L2552) | Server Software:        ' . $\_SERVER['SERVER\_SOFTWARE'] . ' |
| [2553](#L2553) | WP Max Upload Size: ' . $max\_upload\_size . ' |
| [2554](#L2554) | Server upload\_max\_filesize:     ' . $max\_server\_upload . ' |
| [2555](#L2555) | Server post\_max\_size:   ' . $post\_max\_size . ' |
| [2556](#L2556) | WP Memory Limit:        ' . WP\_MEMORY\_LIMIT . ' |
| [2557](#L2557) | WP Debug Mode:      ' . $wp\_debug . ' |
| [2558](#L2558) | CURL:               ' . $curl . ' |
| [2559](#L2559) | fsockopen:          ' . $fsockopen . ' |
| [2560](#L2560) |  |
| [2561](#L2561) | ============================================================ |
| [2562](#L2562) | Active plugins |
| [2563](#L2563) | ============================================================ |
| [2564](#L2564) | ' . $plugin\_list . ' |
| [2565](#L2565) |  |
| [2566](#L2566) | ============================================================ |
| [2567](#L2567) | Plugin Option |
| [2568](#L2568) | ============================================================ |
| [2569](#L2569) | ' . esc\_textarea(stripslashes(json\_encode(array\_merge(get\_option($this->settings\_menu['name']), $empty\_keys)))) . ' |
| [2570](#L2570) | '; |
| [2571](#L2571) |  |
| [2572](#L2572) |  |
| [2573](#L2573) | $html = sprintf('<textarea readonly="readonly" rows="5" cols="65" style="%4$s" class="%1$s" id="%2$s" name="%2$s">%3$s</textarea>', $args['class'], 'debug\_report', $value, 'width:95% !important;height:400px !important'); |
| [2574](#L2574) | $html .= sprintf('<br><span class="description"> %s</span>', $args['desc']); |
| [2575](#L2575) |  |
| [2576](#L2576) | echo $html; |
| [2577](#L2577) | } |
| [2578](#L2578) | } |
| [2579](#L2579) |  |
| [2580](#L2580) | /\*\* |
| [2581](#L2581) | \* Get the value of a settings field |
| [2582](#L2582) | \* |
| [2583](#L2583) | \* @param string $option settings field name |
| [2584](#L2584) | \* @param string $option\_page the $option\_page name this field belongs to |
| [2585](#L2585) | \* @param string $default default text if it's not found |
| [2586](#L2586) | \* @return string |
| [2587](#L2587) | \*/ |
| [2588](#L2588) | function get\_option($option, $option\_page = '', $\_disabled\_default = '') { |
| [2589](#L2589) | if (!$option\_page) |
| [2590](#L2590) | $option\_page = $this->settings\_menu['name']; |
| [2591](#L2591) |  |
| [2592](#L2592) | $options = $this->get\_options($option\_page); |
| [2593](#L2593) |  |
| [2594](#L2594) | if (isset($options[$option])) |
| [2595](#L2595) | return $options[$option]; |
| [2596](#L2596) |  |
| [2597](#L2597) | return false; |
| [2598](#L2598) | } |
| [2599](#L2599) |  |
| [2600](#L2600) | public function get\_defaults() { |
| [2601](#L2601) | $defaults\_val = array(); |
| [2602](#L2602) | foreach ($this->settings\_fields as $tabs => $field) { |
| [2603](#L2603) | foreach ($field as $opt) { |
| [2604](#L2604) | if (isset($opt['name'])) { |
| [2605](#L2605) | if (isset($opt['default'])) { |
| [2606](#L2606) | $temp = str\_replace('[new\_line]', "\r\n", $opt['default']); |
| [2607](#L2607) | $temp = str\_replace('[double\_slashes]', "\/", $temp); |
| [2608](#L2608) | $temp = str\_replace('[o\_cb]', '{', $temp); |
| [2609](#L2609) | $temp = str\_replace('[c\_cb]', '}', $temp); |
| [2610](#L2610) |  |
| [2611](#L2611) | $defaults\_val[$opt['name']] = str\_replace('[quotation]', '"', $temp); |
| [2612](#L2612) | } else { |
| [2613](#L2613) | $defaults\_val[$opt['name']] = ''; |
| [2614](#L2614) | } |
| [2615](#L2615) | } |
| [2616](#L2616) | } |
| [2617](#L2617) | } |
| [2618](#L2618) | return $defaults\_val; |
| [2619](#L2619) | } |
| [2620](#L2620) |  |
| [2621](#L2621) | public function update\_options($main\_key, $options) { |
| [2622](#L2622) |  |
| [2623](#L2623) | if (is\_multisite()) |
| [2624](#L2624) | update\_blog\_option(BLOG\_ID\_CURRENT\_SITE, $main\_key, $options); |
| [2625](#L2625) | else |
| [2626](#L2626) | update\_option($main\_key, $options); |
| [2627](#L2627) | } |
| [2628](#L2628) |  |
| [2629](#L2629) | public function get\_options() { |
| [2630](#L2630) | $main\_key = isset($this->settings\_menu['name']) ? $this->settings\_menu['name'] : 'default\_name'; |
| [2631](#L2631) |  |
| [2632](#L2632) | if (is\_multisite()) |
| [2633](#L2633) | $current\_options = get\_blog\_option(BLOG\_ID\_CURRENT\_SITE, $main\_key); |
| [2634](#L2634) | else |
| [2635](#L2635) | $current\_options = get\_option($main\_key); |
| [2636](#L2636) |  |
| [2637](#L2637) | return $current\_options; |
| [2638](#L2638) | } |
| [2639](#L2639) |  |
| [2640](#L2640) | public function update\_defaults() { |
| [2641](#L2641) | $defaults\_options = $this->get\_defaults(); |
| [2642](#L2642) |  |
| [2643](#L2643) | $main\_key = isset($this->settings\_menu['name']) ? $this->settings\_menu['name'] : 'default\_name'; |
| [2644](#L2644) | $prev\_options = $this->get\_options(); |
| [2645](#L2645) |  |
| [2646](#L2646) |  |
| [2647](#L2647) | // Do previous options exist? Merge them, this way we keep existing options |
| [2648](#L2648) | // and if an update adds new options they get added too. |
| [2649](#L2649) | if (is\_array($prev\_options)) { |
| [2650](#L2650) | $options = array\_merge($defaults\_options, $prev\_options); |
| [2651](#L2651) | } else { |
| [2652](#L2652) | $options = $defaults\_options; |
| [2653](#L2653) | } |
| [2654](#L2654) |  |
| [2655](#L2655) |  |
| [2656](#L2656) | $options['db\_ver'] = isset($this->settings\_menu['version']) ? $this->settings\_menu['version'] : 'default\_version'; |
| [2657](#L2657) |  |
| [2658](#L2658) | $this->update\_options($main\_key, $options); |
| [2659](#L2659) | } |
| [2660](#L2660) |  |
| [2661](#L2661) | /\*\* |
| [2662](#L2662) | \* Show navigations as tab |
| [2663](#L2663) | \* |
| [2664](#L2664) | \* Shows all the settings section labels as tab |
| [2665](#L2665) | \*/ |
| [2666](#L2666) | function show\_navigation() { |
| [2667](#L2667) | $html = '<h2 class="nav-tab-wrapper">'; |
| [2668](#L2668) |  |
| [2669](#L2669) | foreach ($this->settings\_sections as $tab) { |
| [2670](#L2670) | $html .= sprintf('<a href="#%1$s" class="nav-tab" style="font-size:18px;" id="%1$s-tab">%2$s</a>', $tab['id'], $tab['title']); |
| [2671](#L2671) | } |
| [2672](#L2672) |  |
| [2673](#L2673) | $html .= '</h2>'; |
| [2674](#L2674) |  |
| [2675](#L2675) | echo $html; |
| [2676](#L2676) | } |
| [2677](#L2677) |  |
| [2678](#L2678) | /\*\* |
| [2679](#L2679) | \* Show the section settings forms |
| [2680](#L2680) | \* |
| [2681](#L2681) | \* This function displays every sections in a different form |
| [2682](#L2682) | \*/ |
| [2683](#L2683) | function show\_forms() { |
| [2684](#L2684) |  |
| [2685](#L2685) |  |
| [2686](#L2686) | /\* if ($this->settings\_menu['display\_metabox']) |
| [2687](#L2687) | echo '<div class="" style="width:77%; background: white;padding: 7px 15px;margin-top: 5px; border: 1px solid #ddd;"><div class="">';\*/ |
| [2688](#L2688) |  |
| [2689](#L2689) | if (is\_network\_admin()) |
| [2690](#L2690) | echo '<form class="securityforce-form" method="post" action="../options.php">'; |
| [2691](#L2691) | else |
| [2692](#L2692) | echo '<form class="securityforce-form" method="post" action="options.php">'; |
| [2693](#L2693) |  |
| [2694](#L2694) | settings\_fields($this->settings\_menu['name']); |
| [2695](#L2695) | // do\_settings\_sections( $this->settings\_menu['name']); |
| [2696](#L2696) | foreach ($this->settings\_sections as $form) { |
| [2697](#L2697) | ?> |
| [2698](#L2698) | <div class="securityforce-section" id="<?php echo $form['id']; ?>"> |
| [2699](#L2699) |  |
| [2700](#L2700) |  |
| [2701](#L2701) | <?php |
| [2702](#L2702) | $page = $this->settings\_menu['name']; |
| [2703](#L2703) | $sections = $form; |
| [2704](#L2704) | //$this->do\_settings\_sections\_for\_tab($this->settings\_menu['name'], $form); |
| [2705](#L2705) | global $wp\_settings\_sections, $wp\_settings\_fields; |
| [2706](#L2706) |  |
| [2707](#L2707) | if (!isset($wp\_settings\_sections) || !isset($wp\_settings\_sections[$page])) |
| [2708](#L2708) | return; |
| [2709](#L2709) |  |
| [2710](#L2710) | foreach ((array) $wp\_settings\_sections[$page] as $section) { |
| [2711](#L2711) | if (in\_array($section['id'], $sections)) { |
| [2712](#L2712) | echo "<h3>{$section['title']}</h3>\n"; |
| [2713](#L2713) | //call\_user\_func($section['callback'], $section); |
| [2714](#L2714) | if (!isset($wp\_settings\_fields) || !isset($wp\_settings\_fields[$page]) || !isset($wp\_settings\_fields[$page][$section['id']])) |
| [2715](#L2715) | continue; |
| [2716](#L2716) |  |
| [2717](#L2717) | echo '<div>'; |
| [2718](#L2718) | //echo '<table class="form-table">'; |
| [2719](#L2719) | //do\_settings\_fields($page, $section['id']); |
| [2720](#L2720) | if ( ! isset( $wp\_settings\_fields[ $page ][ $section['id'] ] ) ) { |
| [2721](#L2721) | continue; |
| [2722](#L2722) | } |
| [2723](#L2723) | foreach ( (array) $wp\_settings\_fields[ $page ][ $section['id'] ] as $field ) { |
| [2724](#L2724) | $class = ''; |
| [2725](#L2725) |  |
| [2726](#L2726) | if ( ! empty( $field['args']['class'] ) ) { |
| [2727](#L2727) | $class = ' class="securityforce-field ' . esc\_attr( $field['args']['class'] ) . '"'; |
| [2728](#L2728) | } else { |
| [2729](#L2729) | $class = ' class="securityforce-field"'; |
| [2730](#L2730) | } |
| [2731](#L2731) |  |
| [2732](#L2732) | echo "<div{$class}>"; |
| [2733](#L2733) |  |
| [2734](#L2734) | if ( ! empty( $field['args']['label\_for'] ) ) { |
| [2735](#L2735) | echo '<div class="securityforce-label"><label for="' . esc\_attr( $field['args']['label\_for'] ) . '">' . $field['title'] . '</label></div>'; |
| [2736](#L2736) | } else { |
| [2737](#L2737) | echo '<div class="securityforce-label">' . $field['title'] . '</div>'; |
| [2738](#L2738) | } |
| [2739](#L2739) |  |
| [2740](#L2740) | //echo '<td>'; |
| [2741](#L2741) | call\_user\_func( $field['callback'], $field['args'] ); |
| [2742](#L2742) | //echo '</td>'; |
| [2743](#L2743) | echo '</div>'; |
| [2744](#L2744) | } |
| [2745](#L2745) | echo '</div>'; //.securityforce-section |
| [2746](#L2746) | //echo '</table>'; |
| [2747](#L2747) | } |
| [2748](#L2748) | } |
| [2749](#L2749) | // |
| [2750](#L2750) | ?> |
| [2751](#L2751) | <?php //do\_settings\_sections( $this->settings\_menu['name']); ?> |
| [2752](#L2752) |  |
| [2753](#L2753) |  |
| [2754](#L2754) |  |
| [2755](#L2755) |  |
| [2756](#L2756) | </div> |
| [2757](#L2757) |  |
| [2758](#L2758) |  |
| [2759](#L2759) | <?php } ?> |
| [2760](#L2760) |  |
| [2761](#L2761) |  |
| [2762](#L2762) |  |
| [2763](#L2763) | <style> |
| [2764](#L2764) | .securityforce-section { |
| [2765](#L2765) | width: calc(50% - 50px); |
| [2766](#L2766) | margin-top: 23px; |
| [2767](#L2767) | margin-right: 20px; |
| [2768](#L2768) | padding: 10px; |
| [2769](#L2769) | background: #fbfbfb; |
| [2770](#L2770) | border: 1px solid #ccd0d4; |
| [2771](#L2771) | box-shadow: 0 1px 1px rgba(0,0,0,.04); |
| [2772](#L2772) | } |
| [2773](#L2773) | .securityforce-field { |
| [2774](#L2774) | padding: 10px 0; |
| [2775](#L2775) | } |
| [2776](#L2776) | .securityforce-field:not(:last-child) { |
| [2777](#L2777) | border-bottom: 1px solid #e8ecee; |
| [2778](#L2778) | } |
| [2779](#L2779) | .securityforce-label { |
| [2780](#L2780) | display: inline-block; |
| [2781](#L2781) | width: 200px; |
| [2782](#L2782) | vertical-align: top; |
| [2783](#L2783) | } |
| [2784](#L2784) | .securityforce-help { |
| [2785](#L2785) | margin-left: 30px; |
| [2786](#L2786) | position: relative; |
| [2787](#L2787) | display: inline-block; |
| [2788](#L2788) | vertical-align: top; |
| [2789](#L2789) | } |
| [2790](#L2790) | .securityforce-help-icon { |
| [2791](#L2791) | display: inline-block; |
| [2792](#L2792) | width: 20px; |
| [2793](#L2793) | height: 20px; |
| [2794](#L2794) | background-image: url("<?php echo SECURITYFORCE\_URL.'/img/help.svg'; ?>"); |
| [2795](#L2795) | background-size: 20px 20px; |
| [2796](#L2796) | } |
| [2797](#L2797) | .securityforce-help-icon:hover ~ .securityforce-help-text, |
| [2798](#L2798) | .securityforce-help-text:hover { |
| [2799](#L2799) | display: block; |
| [2800](#L2800) | } |
| [2801](#L2801) | .securityforce-help-text { |
| [2802](#L2802) | display: none; |
| [2803](#L2803) | position: absolute; |
| [2804](#L2804) | width: 150px; |
| [2805](#L2805) | top:0; |
| [2806](#L2806) | left:100%; |
| [2807](#L2807) | background: white; |
| [2808](#L2808) | padding: 15px; |
| [2809](#L2809) | border: 1px solid #ccd0d4; |
| [2810](#L2810) | box-shadow: 0 1px 1px rgba(0,0,0,.04); |
| [2811](#L2811) | z-index: 2; |
| [2812](#L2812) | } |
| [2813](#L2813) | .securityforce-radio, |
| [2814](#L2814) | .securityforce-checkbox { |
| [2815](#L2815) | display: inline-block; |
| [2816](#L2816) | } |
| [2817](#L2817) | </style> |
| [2818](#L2818) |  |
| [2819](#L2819) |  |
| [2820](#L2820) |  |
| [2821](#L2821) |  |
| [2822](#L2822) | <div class="clear"></div> |
| [2823](#L2823) | <span style="padding:0 10px;display: block;position: absolute;top: -40px;right: 40px;" class="alignleft"> |
| [2824](#L2824) | <?php submit\_button('Save Settings'); ?> |
| [2825](#L2825) | </span> |
| [2826](#L2826) | </form> |
| [2827](#L2827) | <?php |
| [2828](#L2828) | /\*if ($this->settings\_menu['display\_metabox']) |
| [2829](#L2829) | echo '</div></div>';\*/ |
| [2830](#L2830) |  |
| [2831](#L2831) | $this->script(); |
| [2832](#L2832) | } |
| [2833](#L2833) |  |
| [2834](#L2834) | /\*\* |
| [2835](#L2835) | \* Tabbable JavaScript codes |
| [2836](#L2836) | \* |
| [2837](#L2837) | \* This code uses localstorage for displaying active tabs |
| [2838](#L2838) | \*/ |
| [2839](#L2839) | function script() { |
| [2840](#L2840) | ?> |
| [2841](#L2841) | <style type="text/css"> |
| [2842](#L2842) | <!-- |
| [2843](#L2843) | .postbox h3{cursor: auto!important;} |
| [2844](#L2844) | --> |
| [2845](#L2845) | </style> |
| [2846](#L2846) |  |
| [2847](#L2847) | <script> |
| [2848](#L2848) | jQuery(document).ready(function ($) { |
| [2849](#L2849) | window.msnry = new Masonry( '.securityforce-form', { |
| [2850](#L2850) | itemSelector: '.securityforce-section' |
| [2851](#L2851) | }); |
| [2852](#L2852) | // Switches option sections |
| [2853](#L2853) | $('.group').hide(); |
| [2854](#L2854) |  |
| [2855](#L2855) | $('#import\_options').change(function (e) { |
| [2856](#L2856) |  |
| [2857](#L2857) | if (confirm('You may lose your current settings. Is it OK?') == true) |
| [2858](#L2858) | $('#import\_field').val($(this).val()); |
| [2859](#L2859) | else |
| [2860](#L2860) | $('#import\_field').val(''); |
| [2861](#L2861) | }); |
| [2862](#L2862) |  |
| [2863](#L2863) | $('.opener').change(function (e) { |
| [2864](#L2864) |  |
| [2865](#L2865) | var this\_obj = $(this); |
| [2866](#L2866) | var id = this\_obj.attr('id'); |
| [2867](#L2867) | var name = this\_obj.attr('name'); |
| [2868](#L2868) |  |
| [2869](#L2869) | if (this\_obj.attr('type') == 'checkbox') { |
| [2870](#L2870) |  |
| [2871](#L2871) | if (this\_obj.is(':checked')) |
| [2872](#L2872) | $('.open\_by\_' + id).removeClass('securityforce\_hidden').slideDown('150'); |
| [2873](#L2873) | else |
| [2874](#L2874) | $('.open\_by\_' + id).addClass('securityforce\_hidden').slideUp('150'); |
| [2875](#L2875) |  |
| [2876](#L2876) | } else if (this\_obj.attr('type') == 'radio') { |
| [2877](#L2877) |  |
| [2878](#L2878) | $('.open\_by\_' + $('input[name="' + name + '"]:checked').attr('id')).removeClass('securityforce\_hidden').slideDown('150'); |
| [2879](#L2879) | //hide other |
| [2880](#L2880) | $('.open\_by\_' + $('input[name="' + name + '"]:not(:checked)').attr('id')).addClass('securityforce\_hidden').slideUp('150'); |
| [2881](#L2881) | } else if (this\_obj.hasClass('selectbox')) { |
| [2882](#L2882) |  |
| [2883](#L2883) | $('.open\_by\_' + id + '\_' + this\_obj.val()).removeClass('securityforce\_hidden').slideDown('150'); |
| [2884](#L2884) | //hide other |
| [2885](#L2885) | $("[class^='open\_by\_" + id + "\_'],[class\*=' open\_by\_" + id + "\_']").not('.open\_by\_' + id + '\_' + this\_obj.val()).addClass('securityforce\_hidden').slideUp(); |
| [2886](#L2886) |  |
| [2887](#L2887) | } |
| [2888](#L2888) | setTimeout(function(){ |
| [2889](#L2889) | if(window.msnry) { |
| [2890](#L2890) | window.msnry.layout(); |
| [2891](#L2891) | } |
| [2892](#L2892) | },500); |
| [2893](#L2893) | }); |
| [2894](#L2894) |  |
| [2895](#L2895) |  |
| [2896](#L2896) | //first time load should be after change |
| [2897](#L2897) | $('.opener').trigger('change'); |
| [2898](#L2898) | /\* |
| [2899](#L2899) |  |
| [2900](#L2900) | var activetab = ''; |
| [2901](#L2901) | if (typeof (localStorage) != 'undefined') { |
| [2902](#L2902) | activetab = localStorage.getItem("activetab"); |
| [2903](#L2903) | } |
| [2904](#L2904) | if (activetab != '' && $(activetab).length) { |
| [2905](#L2905) | $(activetab).fadeIn(); |
| [2906](#L2906) | } else { |
| [2907](#L2907) | $('.group:first').fadeIn(); |
| [2908](#L2908) | }\*/ |
| [2909](#L2909) | /\* $('.group .collapsed').each(function () { |
| [2910](#L2910) | $(this).find('input:checked').parent().parent().parent().nextAll().each( |
| [2911](#L2911) | function () { |
| [2912](#L2912) | if ($(this).hasClass('last')) { |
| [2913](#L2913) | $(this).removeClass('hidden'); |
| [2914](#L2914) | return false; |
| [2915](#L2915) | } |
| [2916](#L2916) | $(this).filter('.hidden').removeClass('hidden'); |
| [2917](#L2917) | }); |
| [2918](#L2918) | });\*/ |
| [2919](#L2919) |  |
| [2920](#L2920) | // if (activetab != '' && $(activetab + '-tab').length) { |
| [2921](#L2921) | //     $(activetab + '-tab').addClass('nav-tab-active'); |
| [2922](#L2922) | // } else { |
| [2923](#L2923) | //     $('.nav-tab-wrapper a:first').addClass('nav-tab-active'); |
| [2924](#L2924) | // } |
| [2925](#L2925) | /\*$('.nav-tab-wrapper a').click(function (evt) { |
| [2926](#L2926) | $('.nav-tab-wrapper a').removeClass('nav-tab-active'); |
| [2927](#L2927) | $(this).addClass('nav-tab-active').blur(); |
| [2928](#L2928) | var clicked\_group = $(this).attr('href'); |
| [2929](#L2929) | if (typeof (localStorage) != 'undefined') { |
| [2930](#L2930) | localStorage.setItem("activetab", $(this).attr('href')); |
| [2931](#L2931) | } |
| [2932](#L2932) | $('.group').hide(); |
| [2933](#L2933) | $(clicked\_group).fadeIn(); |
| [2934](#L2934) | evt.preventDefault(); |
| [2935](#L2935) | });\*/ |
| [2936](#L2936) | }); |
| [2937](#L2937) | </script> |
| [2938](#L2938) | <?php |
| [2939](#L2939) | } |
| [2940](#L2940) |  |
| [2941](#L2941) | } |
| [2942](#L2942) |  |
| [2943](#L2943) | $security\_force\_settings\_api = SecurityForce\_Settings\_API::get\_instance(); |
| [2944](#L2944) |  |
| [2945](#L2945) | //add\_action('admin\_enqueue\_scripts', array($security\_force\_settings\_api, 'enqueue\_and\_localize\_my\_scripts')); |

**Note:** See [TracBrowser](/wiki/TracBrowser)
for help on using the repository browser.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Plain Text](/browser/security-force/trunk/lib/class.settings-api.php?format=txt)
* [Original Format](/export/3222480/security-force/trunk/lib/class.settings-api.php)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)


