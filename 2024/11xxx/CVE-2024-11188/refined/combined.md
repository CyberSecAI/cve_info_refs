=== Content from plugins.trac.wordpress.org_d747da22_20250114_221052.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fbrowser%2Fformidable%2Ftags%2F6.16%2Fclasses%2Fhelpers%2FFrmFieldsHelper.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Revision](/browser/formidable/trunk/classes/helpers/FrmFieldsHelper.php?rev=3152934 "Revision 3152934")
* [Next Revision](/browser/formidable/trunk/classes/helpers/FrmFieldsHelper.php?rev=3187774 "Revision 3187774") →
* [Blame](/browser/formidable/trunk/classes/helpers/FrmFieldsHelper.php?annotate=blame "Annotate each line with the last changed revision (this can be time consuming...)")
* [Revision Log](/log/formidable/tags/6.16/classes/helpers/FrmFieldsHelper.php)

---

# [source:](/browser?order=name "Go to repository root") [formidable](/browser/formidable?order=name "View formidable")/[tags](/browser/formidable/tags?order=name "View tags")/[6.16](/browser/formidable/tags/6.16?order=name "View 6.16")/[classes](/browser/formidable/tags/6.16/classes?order=name "View classes")/[helpers](/browser/formidable/tags/6.16/classes/helpers?order=name "View helpers")/[FrmFieldsHelper.php](/browser/formidable/tags/6.16/classes/helpers/FrmFieldsHelper.php?order=name "View FrmFieldsHelper.php")

View diff against:

View revision:

| [Last change](/changeset/3161629/formidable/trunk/classes/helpers/FrmFieldsHelper.php "View differences") on this file was [3161629](/changeset/3161629/ "View changeset 3161629"), checked in by formidableforms, [3 months ago](/timeline?from=2024-10-02T17%3A14%3A52Z&precision=second "See timeline at 10/02/2024 05:14:52 PM") |
| --- |
| Update to version 6.15 from GitHub |
| **File size:** 69.7 KB | |

| Line |  |
| --- | --- |
| [1](#L1) | <?php |
| [2](#L2) | if ( ! defined( 'ABSPATH' ) ) { |
| [3](#L3) | die( 'You are not allowed to call this page directly.' ); |
| [4](#L4) | } |
| [5](#L5) |  |
| [6](#L6) | class FrmFieldsHelper { |
| [7](#L7) |  |
| [8](#L8) | public static function setup\_new\_vars( $type = '', $form\_id = '' ) { |
| [9](#L9) |  |
| [10](#L10) | if ( strpos( $type, '|' ) ) { |
| [11](#L11) | list( $type, $setting ) = explode( '|', $type ); |
| [12](#L12) | } |
| [13](#L13) |  |
| [14](#L14) | $values = self::get\_default\_field( $type ); |
| [15](#L15) |  |
| [16](#L16) | global $wpdb; |
| [17](#L17) | $field\_count = FrmDb::get\_var( |
| [18](#L18) | 'frm\_fields', |
| [19](#L19) | array( 'form\_id' => $form\_id ), |
| [20](#L20) | 'field\_order', |
| [21](#L21) | array( 'order\_by' => 'field\_order DESC' ) |
| [22](#L22) | ); |
| [23](#L23) |  |
| [24](#L24) | $values['field\_key']   = FrmAppHelper::get\_unique\_key( '', $wpdb->prefix . 'frm\_fields', 'field\_key' ); |
| [25](#L25) | $values['form\_id']     = $form\_id; |
| [26](#L26) | $values['field\_order'] = $field\_count + 1; |
| [27](#L27) |  |
| [28](#L28) | $values['field\_options']['custom\_html'] = self::get\_default\_html( $type ); |
| [29](#L29) |  |
| [30](#L30) | if ( ! empty( $setting ) ) { |
| [31](#L31) | if ( in\_array( $type, array( 'data', 'lookup' ), true ) ) { |
| [32](#L32) | $values['field\_options']['data\_type'] = $setting; |
| [33](#L33) | } else { |
| [34](#L34) | $values['field\_options'][ $setting ] = 1; |
| [35](#L35) | } |
| [36](#L36) | } |
| [37](#L37) |  |
| [38](#L38) | // Increase the field order of submit field and fields in the same row. |
| [39](#L39) | $last\_row\_field\_ids = FrmAppHelper::get\_post\_param( 'last\_row\_field\_ids', array() ); |
| [40](#L40) | if ( $last\_row\_field\_ids ) { |
| [41](#L41) | foreach ( $last\_row\_field\_ids as $index => $last\_row\_field\_id ) { |
| [42](#L42) | FrmField::update( |
| [43](#L43) | $last\_row\_field\_id, |
| [44](#L44) | array( 'field\_order' => $field\_count + $index + 2 ) |
| [45](#L45) | ); |
| [46](#L46) | } |
| [47](#L47) | } |
| [48](#L48) |  |
| [49](#L49) | return $values; |
| [50](#L50) | } |
| [51](#L51) |  |
| [52](#L52) | public static function get\_html\_id( $field, $plus = '' ) { |
| [53](#L53) | return apply\_filters( 'frm\_field\_html\_id', 'field\_' . $field['field\_key'] . $plus, $field ); |
| [54](#L54) | } |
| [55](#L55) |  |
| [56](#L56) | public static function setup\_edit\_vars( $field, $doing\_ajax = false ) { |
| [57](#L57) | $values = self::field\_object\_to\_array( $field ); |
| [58](#L58) |  |
| [59](#L59) | return apply\_filters( 'frm\_setup\_edit\_field\_vars', $values, array( 'doing\_ajax' => $doing\_ajax ) ); |
| [60](#L60) | } |
| [61](#L61) |  |
| [62](#L62) | public static function field\_object\_to\_array( $field ) { |
| [63](#L63) | $values = (array) $field; |
| [64](#L64) |  |
| [65](#L65) | self::fill\_field\_array( $field, $values ); |
| [66](#L66) |  |
| [67](#L67) | $values['custom\_html'] = isset( $field->field\_options['custom\_html'] ) ? $field->field\_options['custom\_html'] : self::get\_default\_html( $field->type ); |
| [68](#L68) |  |
| [69](#L69) | return $values; |
| [70](#L70) | } |
| [71](#L71) |  |
| [72](#L72) | private static function fill\_field\_array( $field, array &$field\_array ) { |
| [73](#L73) | $field\_array['options'] = $field->options; |
| [74](#L74) | $field\_array['value']   = $field->default\_value; |
| [75](#L75) |  |
| [76](#L76) | self::prepare\_edit\_front\_field( $field\_array, $field ); |
| [77](#L77) |  |
| [78](#L78) | $field\_array = array\_merge( (array) $field->field\_options, $field\_array ); |
| [79](#L79) | } |
| [80](#L80) |  |
| [81](#L81) | /\*\* |
| [82](#L82) | \* Prepare field while creating a new entry |
| [83](#L83) | \* |
| [84](#L84) | \* @since 3.0 |
| [85](#L85) | \*/ |
| [86](#L86) | public static function prepare\_new\_front\_field( &$field\_array, $field, $args = array() ) { |
| [87](#L87) | $args['action'] = 'new'; |
| [88](#L88) | self::prepare\_front\_field( $field\_array, $field, $args ); |
| [89](#L89) | } |
| [90](#L90) |  |
| [91](#L91) | /\*\* |
| [92](#L92) | \* Prepare field while editing an entry |
| [93](#L93) | \* |
| [94](#L94) | \* @since 3.0 |
| [95](#L95) | \*/ |
| [96](#L96) | public static function prepare\_edit\_front\_field( &$field\_array, $field, $entry\_id = 0, $args = array() ) { |
| [97](#L97) | $args['entry\_id'] = $entry\_id; |
| [98](#L98) | $args['action']   = 'edit'; |
| [99](#L99) | self::prepare\_front\_field( $field\_array, $field, $args ); |
| [100](#L100) | } |
| [101](#L101) |  |
| [102](#L102) | /\*\* |
| [103](#L103) | \* Prepare field while creating a new entry |
| [104](#L104) | \* |
| [105](#L105) | \* @since 3.0 |
| [106](#L106) | \* |
| [107](#L107) | \* @param array    $field\_array |
| [108](#L108) | \* @param stdClass $field |
| [109](#L109) | \* @param array    $args |
| [110](#L110) | \* @return void |
| [111](#L111) | \*/ |
| [112](#L112) | private static function prepare\_front\_field( &$field\_array, $field, $args ) { |
| [113](#L113) | self::fill\_default\_field\_opts( $field, $field\_array ); |
| [114](#L114) | self::fill\_cleared\_strings( $field, $field\_array ); |
| [115](#L115) |  |
| [116](#L116) | // Track the original field's type |
| [117](#L117) | $field\_array['original\_type'] = isset( $field->field\_options['original\_type'] ) ? $field->field\_options['original\_type'] : $field->type; |
| [118](#L118) |  |
| [119](#L119) | self::prepare\_field\_options\_for\_display( $field\_array, $field, $args ); |
| [120](#L120) |  |
| [121](#L121) | if ( $args['action'] === 'edit' ) { |
| [122](#L122) | /\*\* |
| [123](#L123) | \* @param array      $field\_array |
| [124](#L124) | \* @param stdClass   $field |
| [125](#L125) | \* @param int|string $entry\_id |
| [126](#L126) | \* @param array      $args |
| [127](#L127) | \*/ |
| [128](#L128) | $field\_array = apply\_filters( 'frm\_setup\_edit\_fields\_vars', $field\_array, $field, $args['entry\_id'], $args ); |
| [129](#L129) | } else { |
| [130](#L130) | /\*\* |
| [131](#L131) | \* @param array      $field\_array |
| [132](#L132) | \* @param stdClass   $field |
| [133](#L133) | \* @param array      $args |
| [134](#L134) | \*/ |
| [135](#L135) | $field\_array = apply\_filters( 'frm\_setup\_new\_fields\_vars', $field\_array, $field, $args ); |
| [136](#L136) | } |
| [137](#L137) | } |
| [138](#L138) |  |
| [139](#L139) | /\*\* |
| [140](#L140) | \* @since 3.0 |
| [141](#L141) | \* |
| [142](#L142) | \* @param string $type |
| [143](#L143) | \* |
| [144](#L144) | \* @return array |
| [145](#L145) | \*/ |
| [146](#L146) | public static function get\_default\_field\_options( $type ) { |
| [147](#L147) | $field\_type = FrmFieldFactory::get\_field\_type( $type ); |
| [148](#L148) |  |
| [149](#L149) | return $field\_type->get\_default\_field\_options(); |
| [150](#L150) | } |
| [151](#L151) |  |
| [152](#L152) | /\*\* |
| [153](#L153) | \* @since 3.0 |
| [154](#L154) | \* |
| [155](#L155) | \* @param object $field |
| [156](#L156) | \* @param array  $values |
| [157](#L157) | \*/ |
| [158](#L158) | private static function fill\_default\_field\_opts( $field, array &$values ) { |
| [159](#L159) | $check\_post = FrmAppHelper::is\_admin\_page() && $\_POST && isset( $\_POST['field\_options'] ); // phpcs:ignore WordPress.Security.NonceVerification.Missing |
| [160](#L160) |  |
| [161](#L161) | $defaults = self::get\_default\_field\_options\_from\_field( $field, $values ); |
| [162](#L162) | if ( ! $check\_post ) { |
| [163](#L163) | $defaults['required\_indicator'] = ''; |
| [164](#L164) | $defaults['original\_type']      = $field->type; |
| [165](#L165) | } |
| [166](#L166) |  |
| [167](#L167) | foreach ( $defaults as $opt => $default ) { |
| [168](#L168) | $values[ $opt ] = isset( $field->field\_options[ $opt ] ) ? $field->field\_options[ $opt ] : $default; |
| [169](#L169) |  |
| [170](#L170) | if ( $check\_post ) { |
| [171](#L171) | self::get\_posted\_field\_setting( $opt . '\_' . $field->id, $values[ $opt ] ); |
| [172](#L172) | } |
| [173](#L173) |  |
| [174](#L174) | unset( $opt, $default ); |
| [175](#L175) | } |
| [176](#L176) | } |
| [177](#L177) |  |
| [178](#L178) | /\*\* |
| [179](#L179) | \* Fill the required message, invalid message, |
| [180](#L180) | \* and refill the HTML when cleared |
| [181](#L181) | \* |
| [182](#L182) | \* @since 3.0 |
| [183](#L183) | \* |
| [184](#L184) | \* @param object $field |
| [185](#L185) | \* @param array  $field\_array |
| [186](#L186) | \*/ |
| [187](#L187) | private static function fill\_cleared\_strings( $field, array &$field\_array ) { |
| [188](#L188) | if ( '' == $field\_array['blank'] && '1' === $field\_array['required'] ) { |
| [189](#L189) | $field\_array['blank'] = self::default\_blank\_msg(); |
| [190](#L190) | } |
| [191](#L191) |  |
| [192](#L192) | if ( '' === $field\_array['invalid'] ) { |
| [193](#L193) | if ( 'captcha' === $field->type ) { |
| [194](#L194) | $frm\_settings           = FrmAppHelper::get\_settings(); |
| [195](#L195) | $field\_array['invalid'] = $frm\_settings->re\_msg; |
| [196](#L196) | } else { |
| [197](#L197) | $field\_array['invalid'] = self::default\_invalid\_msg(); |
| [198](#L198) | } |
| [199](#L199) | } |
| [200](#L200) |  |
| [201](#L201) | if ( '' == $field\_array['custom\_html'] ) { |
| [202](#L202) | $field\_array['custom\_html'] = self::get\_default\_html( $field->type ); |
| [203](#L203) | } |
| [204](#L204) | } |
| [205](#L205) |  |
| [206](#L206) | /\*\* |
| [207](#L207) | \* @since 6.8.3 |
| [208](#L208) | \* |
| [209](#L209) | \* @return string |
| [210](#L210) | \*/ |
| [211](#L211) | public static function default\_invalid\_msg() { |
| [212](#L212) | /\* translators: %s: [field\_name] shortcode (Which gets replaced by a Field Name) \*/ |
| [213](#L213) | return sprintf( \_\_( '%s is invalid', 'formidable' ), '[field\_name]' ); |
| [214](#L214) | } |
| [215](#L215) |  |
| [216](#L216) | /\*\* |
| [217](#L217) | \* @since 6.8.3 |
| [218](#L218) | \* |
| [219](#L219) | \* @return string |
| [220](#L220) | \*/ |
| [221](#L221) | public static function default\_unique\_msg() { |
| [222](#L222) | $frm\_settings   = FrmAppHelper::get\_settings(); |
| [223](#L223) | $unique\_message = $frm\_settings->unique\_msg; |
| [224](#L224) | $unique\_message = str\_replace( 'This value', '[field\_name]', $unique\_message ); |
| [225](#L225) | return $unique\_message; |
| [226](#L226) | } |
| [227](#L227) |  |
| [228](#L228) | /\*\* |
| [229](#L229) | \* @since 6.8.3 |
| [230](#L230) | \* |
| [231](#L231) | \* @return string |
| [232](#L232) | \*/ |
| [233](#L233) | public static function default\_blank\_msg() { |
| [234](#L234) | $frm\_settings  = FrmAppHelper::get\_settings(); |
| [235](#L235) | $blank\_message = $frm\_settings->blank\_msg; |
| [236](#L236) | $blank\_message = str\_replace( 'This field', '[field\_name]', $blank\_message ); |
| [237](#L237) | return $blank\_message; |
| [238](#L238) | } |
| [239](#L239) |  |
| [240](#L240) | /\*\* |
| [241](#L241) | \* @since 3.0 |
| [242](#L242) | \* |
| [243](#L243) | \* @param string $setting |
| [244](#L244) | \* @param mixed  $value |
| [245](#L245) | \*/ |
| [246](#L246) | private static function get\_posted\_field\_setting( $setting, &$value ) { |
| [247](#L247) | if ( ! isset( $\_POST['field\_options'][ $setting ] ) ) { // phpcs:ignore WordPress.Security.NonceVerification.Missing |
| [248](#L248) | return; |
| [249](#L249) | } |
| [250](#L250) |  |
| [251](#L251) | if ( strpos( $setting, 'html' ) !== false ) { |
| [252](#L252) | // Strip slashes from HTML but not regex or script tags. |
| [253](#L253) | $value = wp\_unslash( $\_POST['field\_options'][ $setting ] ); // phpcs:ignore WordPress.Security.ValidatedSanitizedInput.InputNotSanitized, WordPress.Security.NonceVerification.Missing |
| [254](#L254) | } elseif ( strpos( $setting, 'format\_' ) === 0 ) { |
| [255](#L255) | // TODO: Remove stripslashes on output, and use on input only. |
| [256](#L256) | $value = sanitize\_text\_field( $\_POST['field\_options'][ $setting ] ); // phpcs:ignore WordPress.Security.ValidatedSanitizedInput.MissingUnslash, WordPress.Security.NonceVerification.Missing |
| [257](#L257) | } else { |
| [258](#L258) | $value = wp\_unslash( $\_POST['field\_options'][ $setting ] ); // phpcs:ignore WordPress.Security.ValidatedSanitizedInput.InputNotSanitized, WordPress.Security.NonceVerification.Missing |
| [259](#L259) | FrmAppHelper::sanitize\_value( 'wp\_kses\_post', $value ); |
| [260](#L260) | } |
| [261](#L261) | } |
| [262](#L262) |  |
| [263](#L263) | /\*\* |
| [264](#L264) | \* @since 3.0 |
| [265](#L265) | \* |
| [266](#L266) | \* @param object $field |
| [267](#L267) | \* @param array  $values The field array is needed for hooks. |
| [268](#L268) | \* |
| [269](#L269) | \* @return array |
| [270](#L270) | \*/ |
| [271](#L271) | public static function get\_default\_field\_options\_from\_field( $field, $values = array() ) { |
| [272](#L272) | $field\_type = self::get\_original\_field( $field ); |
| [273](#L273) | $opts       = $field\_type->get\_default\_field\_options(); |
| [274](#L274) |  |
| [275](#L275) | $opts = apply\_filters( 'frm\_default\_field\_opts', $opts, $values, $field ); |
| [276](#L276) | $opts = apply\_filters( 'frm\_default\_' . $field->type . '\_field\_opts', $opts, $values, $field ); |
| [277](#L277) |  |
| [278](#L278) | return $opts; |
| [279](#L279) | } |
| [280](#L280) |  |
| [281](#L281) | /\*\* |
| [282](#L282) | \* @since 3.0 |
| [283](#L283) | \* |
| [284](#L284) | \* @param object $field |
| [285](#L285) | \* |
| [286](#L286) | \* @return FrmFieldType |
| [287](#L287) | \*/ |
| [288](#L288) | private static function get\_original\_field( $field ) { |
| [289](#L289) | $original\_type = FrmField::get\_option( $field, 'original\_type' ); |
| [290](#L290) | if ( ! empty( $original\_type ) && $field->type != $original\_type ) { |
| [291](#L291) | $field->type = $original\_type; |
| [292](#L292) | } |
| [293](#L293) |  |
| [294](#L294) | return FrmFieldFactory::get\_field\_object( $field ); |
| [295](#L295) | } |
| [296](#L296) |  |
| [297](#L297) | /\*\* |
| [298](#L298) | \* @since 3.0 |
| [299](#L299) | \* |
| [300](#L300) | \* @param array  $field\_array |
| [301](#L301) | \* @param object $field |
| [302](#L302) | \* @param array  $atts |
| [303](#L303) | \*/ |
| [304](#L304) | private static function prepare\_field\_options\_for\_display( &$field\_array, $field, $atts ) { |
| [305](#L305) | $field\_obj   = FrmFieldFactory::get\_field\_object( $field ); |
| [306](#L306) | $field\_array = $field\_obj->prepare\_front\_field( $field\_array, $atts ); |
| [307](#L307) | } |
| [308](#L308) |  |
| [309](#L309) | /\*\* |
| [310](#L310) | \* @since 3.0 |
| [311](#L311) | \* |
| [312](#L312) | \* @param string $type |
| [313](#L313) | \* |
| [314](#L314) | \* @return array |
| [315](#L315) | \*/ |
| [316](#L316) | public static function get\_default\_field( $type ) { |
| [317](#L317) | $field\_type = FrmFieldFactory::get\_field\_type( $type ); |
| [318](#L318) |  |
| [319](#L319) | return $field\_type->get\_new\_field\_defaults(); |
| [320](#L320) | } |
| [321](#L321) |  |
| [322](#L322) | public static function fill\_field( &$values, $field, $form\_id, $new\_key = '' ) { |
| [323](#L323) | global $wpdb; |
| [324](#L324) |  |
| [325](#L325) | $values['field\_key']     = FrmAppHelper::get\_unique\_key( $new\_key, $wpdb->prefix . 'frm\_fields', 'field\_key' ); |
| [326](#L326) | $values['form\_id']       = $form\_id; |
| [327](#L327) | $values['options']       = maybe\_serialize( $field->options ); |
| [328](#L328) | $values['default\_value'] = FrmAppHelper::maybe\_json\_encode( $field->default\_value ); |
| [329](#L329) |  |
| [330](#L330) | foreach ( array( 'name', 'description', 'type', 'field\_order', 'field\_options', 'required' ) as $col ) { |
| [331](#L331) | $values[ $col ] = $field->{$col}; |
| [332](#L332) | } |
| [333](#L333) | } |
| [334](#L334) |  |
| [335](#L335) | /\*\* |
| [336](#L336) | \* @since 2.0 |
| [337](#L337) | \* |
| [338](#L338) | \* @param array|object $field |
| [339](#L339) | \* @param string       $error |
| [340](#L340) | \* |
| [341](#L341) | \* @return string |
| [342](#L342) | \*/ |
| [343](#L343) | public static function get\_error\_msg( $field, $error ) { |
| [344](#L344) | $frm\_settings = FrmAppHelper::get\_settings(); |
| [345](#L345) |  |
| [346](#L346) | $conf\_msg = \_\_( 'The entered values do not match', 'formidable' ); |
| [347](#L347) | $defaults = array( |
| [348](#L348) | 'unique\_msg' => array( |
| [349](#L349) | 'full' => self::default\_unique\_msg(), |
| [350](#L350) | /\* translators: %s: Field name \*/ |
| [351](#L351) | 'part' => sprintf( \_\_( '%s must be unique', 'formidable' ), '[field\_name]' ), |
| [352](#L352) | ), |
| [353](#L353) | 'invalid'    => array( |
| [354](#L354) | 'full' => \_\_( 'This field is invalid', 'formidable' ), |
| [355](#L355) | /\* translators: %s: Field name \*/ |
| [356](#L356) | 'part' => sprintf( \_\_( '%s is invalid', 'formidable' ), '[field\_name]' ), |
| [357](#L357) | ), |
| [358](#L358) | 'blank'      => array( |
| [359](#L359) | 'full' => $frm\_settings->blank\_msg, |
| [360](#L360) | 'part' => $frm\_settings->blank\_msg, |
| [361](#L361) | ), |
| [362](#L362) | 'conf\_msg'   => array( |
| [363](#L363) | 'full' => $conf\_msg, |
| [364](#L364) | 'part' => $conf\_msg, |
| [365](#L365) | ), |
| [366](#L366) | ); |
| [367](#L367) |  |
| [368](#L368) | $msg = FrmField::get\_option( $field, $error ); |
| [369](#L369) | $msg = empty( $msg ) ? $defaults[ $error ]['part'] : $msg; |
| [370](#L370) | $msg = do\_shortcode( $msg ); |
| [371](#L371) |  |
| [372](#L372) | $msg = self::maybe\_replace\_substrings\_with\_field\_name( $msg, $error, $field ); |
| [373](#L373) |  |
| [374](#L374) | return $msg; |
| [375](#L375) | } |
| [376](#L376) |  |
| [377](#L377) | /\*\* |
| [378](#L378) | \* @since 6.8.3 |
| [379](#L379) | \* |
| [380](#L380) | \* @param string       $msg |
| [381](#L381) | \* @param string       $error |
| [382](#L382) | \* @param array|object $field |
| [383](#L383) | \*/ |
| [384](#L384) | private static function maybe\_replace\_substrings\_with\_field\_name( $msg, $error, $field ) { |
| [385](#L385) | $field\_name = is\_array( $field ) ? $field['name'] : $field->name; |
| [386](#L386) | $field\_name = FrmAppHelper::maybe\_kses( $field\_name ); |
| [387](#L387) | $substrings = self::get\_substrings\_to\_replace\_with\_field\_name( $field\_name, compact( 'msg', 'error', 'field' ) ); |
| [388](#L388) |  |
| [389](#L389) | // Use the "This value"/"This field" placeholder strings if field name is empty. |
| [390](#L390) | if ( ! $field\_name ) { |
| [391](#L391) | if ( 'unique\_msg' === $error ) { |
| [392](#L392) | $field\_name = \_\_( 'This value', 'formidable' ); |
| [393](#L393) | } else { |
| [394](#L394) | $field\_name = \_\_( 'This field', 'formidable' ); |
| [395](#L395) | } |
| [396](#L396) | } |
| [397](#L397) |  |
| [398](#L398) | $msg = str\_replace( $substrings, $field\_name, $msg ); |
| [399](#L399) | return $msg; |
| [400](#L400) | } |
| [401](#L401) |  |
| [402](#L402) | /\*\* |
| [403](#L403) | \* @since 6.8.3 |
| [404](#L404) | \* |
| [405](#L405) | \* @param string $field\_name |
| [406](#L406) | \* @param array  $filter\_args { |
| [407](#L407) | \*     Filter arguments. |
| [408](#L408) | \* |
| [409](#L409) | \*     @type string       $msg   The current error message before the substrings are replaced. |
| [410](#L410) | \*     @type string       $error A key including 'unique\_msg', 'invalid', 'blank', or 'conf\_msg'. |
| [411](#L411) | \*     @type array|object $field The field with the error. |
| [412](#L412) | \* } |
| [413](#L413) | \* @return array |
| [414](#L414) | \*/ |
| [415](#L415) | private static function get\_substrings\_to\_replace\_with\_field\_name( $field\_name, $filter\_args ) { |
| [416](#L416) | $substrings = array( '[field\_name]' ); |
| [417](#L417) | if ( $field\_name ) { |
| [418](#L418) | array\_push( $substrings, 'This value', 'This field' ); |
| [419](#L419) | } |
| [420](#L420) |  |
| [421](#L421) | /\*\* |
| [422](#L422) | \* @since 6.8.3 |
| [423](#L423) | \* |
| [424](#L424) | \* @param array<string> $substrings |
| [425](#L425) | \* @param array         $filter\_args |
| [426](#L426) | \*/ |
| [427](#L427) | $filtered\_substrings = apply\_filters( 'frm\_error\_substrings\_to\_replace\_with\_field\_name', $substrings, $filter\_args ); |
| [428](#L428) |  |
| [429](#L429) | if ( is\_array( $filtered\_substrings ) ) { |
| [430](#L430) | $substrings = $filtered\_substrings; |
| [431](#L431) | } else { |
| [432](#L432) | \_doing\_it\_wrong( \_\_METHOD\_\_, 'Only arrays should be returned when using the frm\_error\_substrings\_to\_replace\_with\_field\_name filter.', '6.8.3' ); |
| [433](#L433) | } |
| [434](#L434) |  |
| [435](#L435) | return $substrings; |
| [436](#L436) | } |
| [437](#L437) |  |
| [438](#L438) | public static function get\_form\_fields( $form\_id, $error = array() ) { |
| [439](#L439) | $fields = FrmField::get\_all\_for\_form( $form\_id ); |
| [440](#L440) |  |
| [441](#L441) | return apply\_filters( 'frm\_get\_paged\_fields', $fields, $form\_id, $error ); |
| [442](#L442) | } |
| [443](#L443) |  |
| [444](#L444) | public static function get\_default\_html( $type = 'text' ) { |
| [445](#L445) | $field        = FrmFieldFactory::get\_field\_type( $type ); |
| [446](#L446) | $default\_html = $field->default\_html(); |
| [447](#L447) |  |
| [448](#L448) | // these hooks are here for reverse compatibility since 3.0 |
| [449](#L449) | if ( ! apply\_filters( 'frm\_normal\_field\_type\_html', true, $type ) ) { |
| [450](#L450) | $default\_html = apply\_filters( 'frm\_other\_custom\_html', '', $type ); |
| [451](#L451) | } |
| [452](#L452) |  |
| [453](#L453) | return apply\_filters( 'frm\_custom\_html', $default\_html, $type ); |
| [454](#L454) | } |
| [455](#L455) |  |
| [456](#L456) | /\*\* |
| [457](#L457) | \* @param array  $fields |
| [458](#L458) | \* @param array  $errors |
| [459](#L459) | \* @param object $form |
| [460](#L460) | \* @param object $form\_action |
| [461](#L461) | \*/ |
| [462](#L462) | public static function show\_fields( $fields, $errors, $form, $form\_action ) { |
| [463](#L463) | foreach ( $fields as $field ) { |
| [464](#L464) | $field\_obj = FrmFieldFactory::get\_field\_type( $field['type'], $field ); |
| [465](#L465) | $field\_obj->show\_field( compact( 'errors', 'form', 'form\_action' ) ); |
| [466](#L466) | } |
| [467](#L467) | } |
| [468](#L468) |  |
| [469](#L469) | /\*\* |
| [470](#L470) | \* @since 3.0 |
| [471](#L471) | \* |
| [472](#L472) | \* @param array        $atts |
| [473](#L473) | \* @param array|string $value |
| [474](#L474) | \*/ |
| [475](#L475) | public static function run\_wpautop( $atts, &$value ) { |
| [476](#L476) | $autop = isset( $atts['wpautop'] ) ? $atts['wpautop'] : true; |
| [477](#L477) | if ( apply\_filters( 'frm\_use\_wpautop', $autop ) ) { |
| [478](#L478) | if ( is\_array( $value ) ) { |
| [479](#L479) | $value = implode( "\n", $value ); |
| [480](#L480) | } |
| [481](#L481) | $value = wpautop( $value ); |
| [482](#L482) | } |
| [483](#L483) | } |
| [484](#L484) |  |
| [485](#L485) | /\*\* |
| [486](#L486) | \* Get the class to use for the label position |
| [487](#L487) | \* |
| [488](#L488) | \* @since 2.05 |
| [489](#L489) | \*/ |
| [490](#L490) | public static function &label\_position( $position, $field, $form ) { |
| [491](#L491) | if ( $position && $position != '' ) { |
| [492](#L492) | if ( $position === 'inside' && ! self::is\_placeholder\_field\_type( $field['type'] ) ) { |
| [493](#L493) | $position = 'top'; |
| [494](#L494) | } |
| [495](#L495) |  |
| [496](#L496) | return $position; |
| [497](#L497) | } |
| [498](#L498) |  |
| [499](#L499) | $position = FrmStylesController::get\_style\_val( 'position', $form ); |
| [500](#L500) | if ( $position === 'none' ) { |
| [501](#L501) | $position = 'top'; |
| [502](#L502) | } elseif ( $position === 'no\_label' ) { |
| [503](#L503) | $position = 'none'; |
| [504](#L504) | } elseif ( $position === 'inside' && ! self::is\_placeholder\_field\_type( $field['type'] ) ) { |
| [505](#L505) | $position = 'top'; |
| [506](#L506) | } |
| [507](#L507) |  |
| [508](#L508) | $position = apply\_filters( 'frm\_html\_label\_position', $position, $field, $form ); |
| [509](#L509) | $position = ! empty( $position ) ? $position : 'top'; |
| [510](#L510) |  |
| [511](#L511) | return $position; |
| [512](#L512) | } |
| [513](#L513) |  |
| [514](#L514) | /\*\* |
| [515](#L515) | \* Check if this field type allows placeholders |
| [516](#L516) | \* |
| [517](#L517) | \* @since 2.05 |
| [518](#L518) | \* @param string $type |
| [519](#L519) | \* @return bool |
| [520](#L520) | \*/ |
| [521](#L521) | public static function is\_placeholder\_field\_type( $type ) { |
| [522](#L522) | return ! in\_array( $type, array( 'radio', 'checkbox', 'hidden', 'file' ), true ); |
| [523](#L523) | } |
| [524](#L524) |  |
| [525](#L525) | public static function get\_checkbox\_id( $field, $opt\_key, $type = 'checkbox' ) { |
| [526](#L526) | $id = $field['id']; |
| [527](#L527) | if ( isset( $field['in\_section'] ) && $field['in\_section'] && ! FrmAppHelper::is\_admin\_page( 'formidable' ) ) { |
| [528](#L528) | $id .= '-' . $field['in\_section']; |
| [529](#L529) | } |
| [530](#L530) |  |
| [531](#L531) | return 'frm\_' . $type . '\_' . $id . '-' . $opt\_key; |
| [532](#L532) | } |
| [533](#L533) |  |
| [534](#L534) | public static function show\_single\_option( $field ) { |
| [535](#L535) | self::hidden\_field\_option( $field ); |
| [536](#L536) |  |
| [537](#L537) | if ( ! is\_array( $field['options'] ) ) { |
| [538](#L538) | return; |
| [539](#L539) | } |
| [540](#L540) |  |
| [541](#L541) | $base\_name = 'default\_value\_' . $field['id']; |
| [542](#L542) | $html\_id   = isset( $field['html\_id'] ) ? $field['html\_id'] : self::get\_html\_id( $field ); |
| [543](#L543) |  |
| [544](#L544) | $default\_type = self::get\_default\_value\_type( $field ); |
| [545](#L545) |  |
| [546](#L546) | foreach ( $field['options'] as $opt\_key => $opt ) { |
| [547](#L547) | $field\_val = self::get\_value\_from\_array( $opt, $opt\_key, $field ); |
| [548](#L548) | $opt       = self::get\_label\_from\_array( $opt, $opt\_key, $field ); |
| [549](#L549) |  |
| [550](#L550) | $field\_name = $base\_name . ( $default\_type === 'checkbox' ? '[' . $opt\_key . ']' : '' ); |
| [551](#L551) |  |
| [552](#L552) | $checked = ( isset( $field['default\_value'] ) && ( ( ! is\_array( $field['default\_value'] ) && $field['default\_value'] == $field\_val ) || ( is\_array( $field['default\_value'] ) && in\_array( $field\_val, $field['default\_value'] ) ) ) ); |
| [553](#L553) |  |
| [554](#L554) | // If this is an "Other" option, get the HTML for it. |
| [555](#L555) | if ( self::is\_other\_opt( $opt\_key ) ) { |
| [556](#L556) | if ( FrmAppHelper::pro\_is\_installed() ) { |
| [557](#L557) | require FrmProAppHelper::plugin\_path() . '/classes/views/frmpro-fields/other-option.php'; |
| [558](#L558) | } |
| [559](#L559) | } else { |
| [560](#L560) | require FrmAppHelper::plugin\_path() . '/classes/views/frm-fields/single-option.php'; |
| [561](#L561) | } |
| [562](#L562) |  |
| [563](#L563) | unset( $checked ); |
| [564](#L564) | } |
| [565](#L565) | } |
| [566](#L566) |  |
| [567](#L567) | /\*\* |
| [568](#L568) | \* Include hidden row for javascript to duplicate. |
| [569](#L569) | \* |
| [570](#L570) | \* @since 4.0 |
| [571](#L571) | \* @param array $field |
| [572](#L572) | \*/ |
| [573](#L573) | private static function hidden\_field\_option( $field ) { |
| [574](#L574) | // Don't duplicate during an ajax add option. |
| [575](#L575) | $ajax\_action = FrmAppHelper::get\_param( 'action', '', 'post', 'sanitize\_text\_field' ); |
| [576](#L576) | if ( $ajax\_action === 'frm\_add\_field\_option' ) { |
| [577](#L577) | return; |
| [578](#L578) | } |
| [579](#L579) |  |
| [580](#L580) | $opt\_key    = '000'; |
| [581](#L581) | $field\_val  = \_\_( 'New Option', 'formidable' ); |
| [582](#L582) | $opt        = \_\_( 'New Option', 'formidable' ); |
| [583](#L583) | $checked    = false; |
| [584](#L584) | $field\_name = 'default\_value\_' . $field['id']; |
| [585](#L585) | $html\_id    = isset( $field['html\_id'] ) ? $field['html\_id'] : self::get\_html\_id( $field ); |
| [586](#L586) |  |
| [587](#L587) | $default\_type = self::get\_default\_value\_type( $field ); |
| [588](#L588) | $field\_name  .= ( $default\_type === 'checkbox' ? '[' . $opt\_key . ']' : '' ); |
| [589](#L589) |  |
| [590](#L590) | require FrmAppHelper::plugin\_path() . '/classes/views/frm-fields/single-option.php'; |
| [591](#L591) | } |
| [592](#L592) |  |
| [593](#L593) | /\*\* |
| [594](#L594) | \* @since 4.0 |
| [595](#L595) | \* |
| [596](#L596) | \* @param array $field |
| [597](#L597) | \* @return string radio or checkbox |
| [598](#L598) | \*/ |
| [599](#L599) | private static function get\_default\_value\_type( $field ) { |
| [600](#L600) | $default\_type = $field['type']; |
| [601](#L601) | if ( $field['type'] === 'select' ) { |
| [602](#L602) | $default\_type = FrmField::is\_multiple\_select( $field ) ? 'checkbox' : 'radio'; |
| [603](#L603) | } |
| [604](#L604) | return $default\_type; |
| [605](#L605) | } |
| [606](#L606) |  |
| [607](#L607) | public static function get\_value\_from\_array( $opt, $opt\_key, $field ) { |
| [608](#L608) | $opt = apply\_filters( 'frm\_field\_value\_saved', $opt, $opt\_key, $field ); |
| [609](#L609) |  |
| [610](#L610) | return FrmFieldsController::check\_value( $opt, $opt\_key, $field ); |
| [611](#L611) | } |
| [612](#L612) |  |
| [613](#L613) | public static function get\_label\_from\_array( $opt, $opt\_key, $field ) { |
| [614](#L614) | $opt = apply\_filters( 'frm\_field\_label\_seen', $opt, $opt\_key, $field ); |
| [615](#L615) |  |
| [616](#L616) | return FrmFieldsController::check\_label( $opt ); |
| [617](#L617) | } |
| [618](#L618) |  |
| [619](#L619) | /\*\* |
| [620](#L620) | \* Shows the inline modal. |
| [621](#L621) | \* |
| [622](#L622) | \* @since 4.0 |
| [623](#L623) | \* @since 6.4.1 Added `inside\_class` in the arguments. |
| [624](#L624) | \* |
| [625](#L625) | \* @param array $args The arguments. |
| [626](#L626) | \*/ |
| [627](#L627) | public static function inline\_modal( $args ) { |
| [628](#L628) | $defaults = array( |
| [629](#L629) | 'id'           => '', |
| [630](#L630) | 'class'        => '', |
| [631](#L631) | 'show'         => 0, |
| [632](#L632) | 'callback'     => array(), |
| [633](#L633) | 'args'         => array(), |
| [634](#L634) | 'title'        => '', |
| [635](#L635) | 'inside\_class' => 'inside', |
| [636](#L636) | ); |
| [637](#L637) | $args     = array\_merge( $defaults, $args ); |
| [638](#L638) |  |
| [639](#L639) | include FrmAppHelper::plugin\_path() . '/classes/views/frm-fields/back-end/inline-modal.php'; |
| [640](#L640) | } |
| [641](#L641) |  |
| [642](#L642) | /\*\* |
| [643](#L643) | \* @since 4.0 |
| [644](#L644) | \*/ |
| [645](#L645) | public static function smart\_values() { |
| [646](#L646) | $continue = apply\_filters( 'frm\_smart\_values\_box', true ); |
| [647](#L647) | if ( $continue === true ) { |
| [648](#L648) | $upgrade\_link = array( |
| [649](#L649) | 'medium'  => 'builder', |
| [650](#L650) | 'content' => 'smart-tags', |
| [651](#L651) | ); |
| [652](#L652) | include FrmAppHelper::plugin\_path() . '/classes/views/frm-fields/back-end/smart-values.php'; |
| [653](#L653) | } |
| [654](#L654) | } |
| [655](#L655) |  |
| [656](#L656) | /\*\* |
| [657](#L657) | \* @since 4.0 |
| [658](#L658) | \*/ |
| [659](#L659) | public static function input\_mask() { |
| [660](#L660) | include FrmAppHelper::plugin\_path() . '/classes/views/frm-fields/back-end/input-mask-info.php'; |
| [661](#L661) | } |
| [662](#L662) |  |
| [663](#L663) | /\*\* |
| [664](#L664) | \* @since 4.0 |
| [665](#L665) | \*/ |
| [666](#L666) | public static function layout\_classes() { |
| [667](#L667) | include FrmAppHelper::plugin\_path() . '/classes/views/frm-fields/back-end/layout-classes.php'; |
| [668](#L668) | } |
| [669](#L669) |  |
| [670](#L670) | /\*\* |
| [671](#L671) | \* @param int $tax\_id |
| [672](#L672) | \* |
| [673](#L673) | \* @return string |
| [674](#L674) | \*/ |
| [675](#L675) | public static function get\_term\_link( $tax\_id ) { |
| [676](#L676) | $tax = get\_taxonomy( $tax\_id ); |
| [677](#L677) | if ( ! $tax ) { |
| [678](#L678) | return ''; |
| [679](#L679) | } |
| [680](#L680) |  |
| [681](#L681) | $link = sprintf( |
| [682](#L682) | /\* translators: %1$s: Start HTML link, %2$s: Content type label, %3$s: Content type, %4$s: End HTML link \*/ |
| [683](#L683) | esc\_html\_\_( 'Options are dynamically created from your %1$s%2$s: %3$s%4$s', 'formidable' ), |
| [684](#L684) | '<a href="' . esc\_url( admin\_url( 'edit-tags.php?taxonomy=' . $tax->name ) ) . '" target="\_blank">', |
| [685](#L685) | esc\_html\_\_( 'taxonomy', 'formidable' ), |
| [686](#L686) | empty( $tax->labels->name ) ? esc\_html\_\_( 'Categories', 'formidable' ) : $tax->labels->name, |
| [687](#L687) | '</a>' |
| [688](#L688) | ); |
| [689](#L689) | unset( $tax ); |
| [690](#L690) |  |
| [691](#L691) | return $link; |
| [692](#L692) | } |
| [693](#L693) |  |
| [694](#L694) | public static function value\_meets\_condition( $observed\_value, $cond, $hide\_opt ) { |
| [695](#L695) | $hide\_opt       = self::get\_value\_for\_comparison( $hide\_opt ); |
| [696](#L696) | $observed\_value = self::get\_value\_for\_comparison( $observed\_value ); |
| [697](#L697) |  |
| [698](#L698) | if ( is\_array( $observed\_value ) ) { |
| [699](#L699) | return self::array\_value\_condition( $observed\_value, $cond, $hide\_opt ); |
| [700](#L700) | } |
| [701](#L701) |  |
| [702](#L702) | $m = false; |
| [703](#L703) | if ( $cond === '==' ) { |
| [704](#L704) | $m = $observed\_value == $hide\_opt; |
| [705](#L705) | } elseif ( $cond === '!=' ) { |
| [706](#L706) | $m = $observed\_value != $hide\_opt; |
| [707](#L707) | } elseif ( $cond === '>' ) { |
| [708](#L708) | $m = $observed\_value > $hide\_opt; |
| [709](#L709) | } elseif ( $cond === '>=' ) { |
| [710](#L710) | $m = $observed\_value >= $hide\_opt; |
| [711](#L711) | } elseif ( $cond === '<' ) { |
| [712](#L712) | $m = $observed\_value < $hide\_opt; |
| [713](#L713) | } elseif ( $cond === '<=' ) { |
| [714](#L714) | $m = $observed\_value <= $hide\_opt; |
| [715](#L715) | } elseif ( $cond === 'LIKE' || $cond === 'not LIKE' ) { |
| [716](#L716) | $m = stripos( $observed\_value, $hide\_opt ); |
| [717](#L717) | if ( $cond === 'not LIKE' ) { |
| [718](#L718) | $m = $m === false; |
| [719](#L719) | } else { |
| [720](#L720) | $m = $m !== false; |
| [721](#L721) | } |
| [722](#L722) | } elseif ( $cond === '%LIKE' ) { |
| [723](#L723) | // ends with |
| [724](#L724) | $length = strlen( $hide\_opt ); |
| [725](#L725) | $substr = substr( $observed\_value, strlen( $observed\_value ) - $length ); |
| [726](#L726) | $m      = 0 === strcasecmp( $substr, $hide\_opt ); |
| [727](#L727) | } elseif ( 'LIKE%' === $cond ) { |
| [728](#L728) | // starts with |
| [729](#L729) | $length = strlen( $hide\_opt ); |
| [730](#L730) | $substr = substr( $observed\_value, 0, $length ); |
| [731](#L731) | $m      = 0 === strcasecmp( $substr, $hide\_opt ); |
| [732](#L732) | }//end if |
| [733](#L733) |  |
| [734](#L734) | return $m; |
| [735](#L735) | } |
| [736](#L736) |  |
| [737](#L737) | /\*\* |
| [738](#L738) | \* Trim and sanitize the values |
| [739](#L739) | \* |
| [740](#L740) | \* @since 2.05 |
| [741](#L741) | \*/ |
| [742](#L742) | private static function get\_value\_for\_comparison( $value ) { |
| [743](#L743) | // Remove white space from hide\_opt |
| [744](#L744) | if ( ! is\_array( $value ) ) { |
| [745](#L745) | $value = trim( $value ); |
| [746](#L746) | } |
| [747](#L747) |  |
| [748](#L748) | FrmAppHelper::sanitize\_value( 'wp\_kses\_post', $value ); |
| [749](#L749) |  |
| [750](#L750) | return $value; |
| [751](#L751) | } |
| [752](#L752) |  |
| [753](#L753) | public static function array\_value\_condition( $observed\_value, $cond, $hide\_opt ) { |
| [754](#L754) | $m = false; |
| [755](#L755) | if ( $cond === '==' ) { |
| [756](#L756) | if ( is\_array( $hide\_opt ) ) { |
| [757](#L757) | $m = array\_intersect( $hide\_opt, $observed\_value ); |
| [758](#L758) | $m = ! empty( $m ); |
| [759](#L759) | } else { |
| [760](#L760) | $m = in\_array( $hide\_opt, $observed\_value ); |
| [761](#L761) | } |
| [762](#L762) | } elseif ( $cond === '!=' ) { |
| [763](#L763) | $m = ! in\_array( $hide\_opt, $observed\_value ); |
| [764](#L764) | } elseif ( $cond === '>' ) { |
| [765](#L765) | $min = min( $observed\_value ); |
| [766](#L766) | $m   = $min > $hide\_opt; |
| [767](#L767) | } elseif ( $cond === '<' ) { |
| [768](#L768) | $max = max( $observed\_value ); |
| [769](#L769) | $m   = $max < $hide\_opt; |
| [770](#L770) | } elseif ( $cond === 'LIKE' || $cond === 'not LIKE' ) { |
| [771](#L771) | foreach ( $observed\_value as $ob ) { |
| [772](#L772) | $m = strpos( $ob, $hide\_opt ); |
| [773](#L773) | if ( $m !== false ) { |
| [774](#L774) | $m = true; |
| [775](#L775) | break; |
| [776](#L776) | } |
| [777](#L777) | } |
| [778](#L778) |  |
| [779](#L779) | if ( $cond === 'not LIKE' ) { |
| [780](#L780) | $m = $m === false; |
| [781](#L781) | } |
| [782](#L782) | } elseif ( $cond === '%LIKE' ) { |
| [783](#L783) | // ends with |
| [784](#L784) | foreach ( $observed\_value as $ob ) { |
| [785](#L785) | if ( $hide\_opt === substr( $ob, strlen( $ob ) - strlen( $hide\_opt ) ) ) { |
| [786](#L786) | $m = true; |
| [787](#L787) | break; |
| [788](#L788) | } |
| [789](#L789) | } |
| [790](#L790) | } elseif ( $cond === 'LIKE%' ) { |
| [791](#L791) | // starts with |
| [792](#L792) | foreach ( $observed\_value as $ob ) { |
| [793](#L793) | if ( $hide\_opt === substr( $ob, 0, strlen( $hide\_opt ) ) ) { |
| [794](#L794) | $m = true; |
| [795](#L795) | break; |
| [796](#L796) | } |
| [797](#L797) | } |
| [798](#L798) | }//end if |
| [799](#L799) |  |
| [800](#L800) | return $m; |
| [801](#L801) | } |
| [802](#L802) |  |
| [803](#L803) | /\*\* |
| [804](#L804) | \* Replace a few basic shortcodes and field ids |
| [805](#L805) | \* |
| [806](#L806) | \* @since 2.0 |
| [807](#L807) | \* @return string |
| [808](#L808) | \*/ |
| [809](#L809) | public static function basic\_replace\_shortcodes( $value, $form, $entry ) { |
| [810](#L810) | if ( strpos( $value, '[sitename]' ) !== false ) { |
| [811](#L811) | $new\_value = wp\_specialchars\_decode( FrmAppHelper::site\_name(), ENT\_QUOTES ); |
| [812](#L812) | $value     = str\_replace( '[sitename]', $new\_value, $value ); |
| [813](#L813) | } |
| [814](#L814) |  |
| [815](#L815) | $value = apply\_filters( 'frm\_content', $value, $form, $entry ); |
| [816](#L816) | $value = do\_shortcode( $value ); |
| [817](#L817) |  |
| [818](#L818) | return $value; |
| [819](#L819) | } |
| [820](#L820) |  |
| [821](#L821) | public static function get\_shortcodes( $content, $form\_id ) { |
| [822](#L822) | if ( FrmAppHelper::pro\_is\_installed() ) { |
| [823](#L823) | return FrmProDisplaysHelper::get\_shortcodes( $content, $form\_id ); |
| [824](#L824) | } |
| [825](#L825) |  |
| [826](#L826) | $fields = FrmField::getAll( |
| [827](#L827) | array( |
| [828](#L828) | 'fi.form\_id'  => (int) $form\_id, |
| [829](#L829) | 'fi.type not' => FrmField::no\_save\_fields(), |
| [830](#L830) | ) |
| [831](#L831) | ); |
| [832](#L832) |  |
| [833](#L833) | $tagregexp = self::allowed\_shortcodes( $fields ); |
| [834](#L834) |  |
| [835](#L835) | preg\_match\_all( "/\[(if )?($tagregexp)\b(.\*?)(?:(\/))?\](?:(.+?)\[\/\2\])?/s", $content, $matches, PREG\_PATTERN\_ORDER ); |
| [836](#L836) |  |
| [837](#L837) | return $matches; |
| [838](#L838) | } |
| [839](#L839) |  |
| [840](#L840) | public static function allowed\_shortcodes( $fields = array() ) { |
| [841](#L841) | $tagregexp = array( |
| [842](#L842) | 'editlink', |
| [843](#L843) | 'id', |
| [844](#L844) | 'key', |
| [845](#L845) | 'ip', |
| [846](#L846) | 'siteurl', |
| [847](#L847) | 'sitename', |
| [848](#L848) | 'admin\_email', |
| [849](#L849) | 'default-email', |
| [850](#L850) | 'default-from-email', |
| [851](#L851) | 'post[-|\_]id', |
| [852](#L852) | 'created[-|\_]at', |
| [853](#L853) | 'updated[-|\_]at', |
| [854](#L854) | 'updated[-|\_]by', |
| [855](#L855) | 'parent[-|\_]id', |
| [856](#L856) | ); |
| [857](#L857) |  |
| [858](#L858) | foreach ( $fields as $field ) { |
| [859](#L859) | $tagregexp[] = $field->id; |
| [860](#L860) | $tagregexp[] = $field->field\_key; |
| [861](#L861) | } |
| [862](#L862) |  |
| [863](#L863) | $tagregexp = implode( '|', $tagregexp ); |
| [864](#L864) |  |
| [865](#L865) | return $tagregexp; |
| [866](#L866) | } |
| [867](#L867) |  |
| [868](#L868) | public static function replace\_content\_shortcodes( $content, $entry, $shortcodes ) { |
| [869](#L869) | foreach ( $shortcodes[0] as $short\_key => $tag ) { |
| [870](#L870) | if ( empty( $tag ) ) { |
| [871](#L871) | continue; |
| [872](#L872) | } |
| [873](#L873) |  |
| [874](#L874) | $atts = FrmShortcodeHelper::get\_shortcode\_attribute\_array( $shortcodes[3][ $short\_key ] ); |
| [875](#L875) | $tag  = FrmShortcodeHelper::get\_shortcode\_tag( $shortcodes, $short\_key ); |
| [876](#L876) |  |
| [877](#L877) | $atts['entry'] = $entry; |
| [878](#L878) | $atts['tag']   = $tag; |
| [879](#L879) | $replace\_with  = self::get\_value\_for\_shortcode( $atts ); |
| [880](#L880) |  |
| [881](#L881) | if ( $replace\_with !== null ) { |
| [882](#L882) | $replace\_with = self::trigger\_shortcode\_atts( $replace\_with, $atts ); |
| [883](#L883) | self::sanitize\_embedded\_shortcodes( compact( 'entry' ), $replace\_with ); |
| [884](#L884) | $content = str\_replace( $shortcodes[0][ $short\_key ], $replace\_with, $content ); |
| [885](#L885) | } |
| [886](#L886) |  |
| [887](#L887) | unset( $atts, $replace\_with ); |
| [888](#L888) | } |
| [889](#L889) |  |
| [890](#L890) | return $content; |
| [891](#L891) | } |
| [892](#L892) |  |
| [893](#L893) | /\*\* |
| [894](#L894) | \* @param string $replace\_with |
| [895](#L895) | \* @param array  $atts |
| [896](#L896) | \* @return string |
| [897](#L897) | \*/ |
| [898](#L898) | private static function trigger\_shortcode\_atts( $replace\_with, $atts ) { |
| [899](#L899) | $supported\_atts = array( 'remove\_accents', 'sanitize', 'sanitize\_url' ); |
| [900](#L900) | $included\_atts  = array\_intersect( $supported\_atts, array\_keys( $atts ) ); |
| [901](#L901) | foreach ( $included\_atts as $included\_att ) { |
| [902](#L902) | if ( '0' === $atts[ $included\_att ] ) { |
| [903](#L903) | // Skip any option that uses 0 so sanitize\_url=0 does not encode. |
| [904](#L904) | continue; |
| [905](#L905) | } |
| [906](#L906) | $function     = 'atts\_' . $included\_att; |
| [907](#L907) | $replace\_with = self::$function( $replace\_with, $atts ); |
| [908](#L908) | } |
| [909](#L909) | return $replace\_with; |
| [910](#L910) | } |
| [911](#L911) |  |
| [912](#L912) | /\*\* |
| [913](#L913) | \* Converts all accent characters to ASCII characters. |
| [914](#L914) | \* |
| [915](#L915) | \* @since 6.3.1 |
| [916](#L916) | \* |
| [917](#L917) | \* @param string $replace\_with The text to remove accents from. |
| [918](#L918) | \* |
| [919](#L919) | \* @return string |
| [920](#L920) | \*/ |
| [921](#L921) | public static function atts\_remove\_accents( $replace\_with ) { |
| [922](#L922) | return remove\_accents( $replace\_with ); |
| [923](#L923) | } |
| [924](#L924) |  |
| [925](#L925) | /\*\* |
| [926](#L926) | \* @param string $replace\_with |
| [927](#L927) | \* @return string |
| [928](#L928) | \*/ |
| [929](#L929) | private static function atts\_sanitize( $replace\_with ) { |
| [930](#L930) | return sanitize\_title\_with\_dashes( $replace\_with ); |
| [931](#L931) | } |
| [932](#L932) |  |
| [933](#L933) | /\*\* |
| [934](#L934) | \* @param string $replace\_with |
| [935](#L935) | \* @return string |
| [936](#L936) | \*/ |
| [937](#L937) | private static function atts\_sanitize\_url( $replace\_with ) { |
| [938](#L938) | return urlencode( $replace\_with ); |
| [939](#L939) | } |
| [940](#L940) |  |
| [941](#L941) | /\*\* |
| [942](#L942) | \* Prevent shortcodes in fields from being processed |
| [943](#L943) | \* |
| [944](#L944) | \* @since 3.01.02 |
| [945](#L945) | \* |
| [946](#L946) | \* @param array  $atts  Includes entry object. |
| [947](#L947) | \* @param string $value |
| [948](#L948) | \*/ |
| [949](#L949) | public static function sanitize\_embedded\_shortcodes( $atts, &$value ) { |
| [950](#L950) | $atts['value']   = $value; |
| [951](#L951) | $should\_sanitize = apply\_filters( 'frm\_sanitize\_shortcodes', true, $atts ); |
| [952](#L952) | if ( $should\_sanitize ) { |
| [953](#L953) | $value = str\_replace( '[', '&#91;', $value ); |
| [954](#L954) | } |
| [955](#L955) | } |
| [956](#L956) |  |
| [957](#L957) | /\*\* |
| [958](#L958) | \* @since 3.0 |
| [959](#L959) | \* |
| [960](#L960) | \* @param array $atts |
| [961](#L961) | \* |
| [962](#L962) | \* @return string |
| [963](#L963) | \*/ |
| [964](#L964) | private static function get\_value\_for\_shortcode( $atts ) { |
| [965](#L965) | $clean\_tag = str\_replace( '-', '\_', $atts['tag'] ); |
| [966](#L966) |  |
| [967](#L967) | $shortcode\_values = array( |
| [968](#L968) | 'id'  => $atts['entry']->id, |
| [969](#L969) | 'key' => $atts['entry']->item\_key, |
| [970](#L970) | 'ip'  => $atts['entry']->ip, |
| [971](#L971) | ); |
| [972](#L972) |  |
| [973](#L973) | $dynamic\_default = array( 'admin\_email', 'siteurl', 'frmurl', 'sitename', 'get', 'default-email', 'default-from-email' ); |
| [974](#L974) |  |
| [975](#L975) | if ( isset( $shortcode\_values[ $atts['tag'] ] ) ) { |
| [976](#L976) | $replace\_with = $shortcode\_values[ $atts['tag'] ]; |
| [977](#L977) | } elseif ( in\_array( $atts['tag'], $dynamic\_default, true ) ) { |
| [978](#L978) | $replace\_with = self::dynamic\_default\_values( $atts['tag'], $atts ); |
| [979](#L979) | } elseif ( $clean\_tag === 'user\_agent' ) { |
| [980](#L980) | $description  = $atts['entry']->description; |
| [981](#L981) | $replace\_with = FrmEntriesHelper::get\_browser( $description['browser'] ); |
| [982](#L982) | } elseif ( $clean\_tag === 'created\_at' || $clean\_tag === 'updated\_at' ) { |
| [983](#L983) | $atts['tag']  = $clean\_tag; |
| [984](#L984) | $replace\_with = self::get\_entry\_timestamp( $atts ); |
| [985](#L985) | } elseif ( $clean\_tag === 'created\_by' || $clean\_tag === 'updated\_by' ) { |
| [986](#L986) | $replace\_with = self::get\_display\_value( $atts['entry']->{$clean\_tag}, (object) array( 'type' => 'user\_id' ), $atts ); |
| [987](#L987) | } else { |
| [988](#L988) | $replace\_with = self::get\_field\_shortcode\_value( $atts ); |
| [989](#L989) | } |
| [990](#L990) |  |
| [991](#L991) | return $replace\_with; |
| [992](#L992) | } |
| [993](#L993) |  |
| [994](#L994) | /\*\* |
| [995](#L995) | \* @since 3.0 |
| [996](#L996) | \* |
| [997](#L997) | \* @param array $atts |
| [998](#L998) | \* |
| [999](#L999) | \* @return string |
| [1000](#L1000) | \*/ |
| [1001](#L1001) | private static function get\_entry\_timestamp( $atts ) { |
| [1002](#L1002) | if ( isset( $atts['format'] ) ) { |
| [1003](#L1003) | $time\_format = ' '; |
| [1004](#L1004) | } else { |
| [1005](#L1005) | $atts['format'] = get\_option( 'date\_format' ); |
| [1006](#L1006) | $time\_format    = ''; |
| [1007](#L1007) | } |
| [1008](#L1008) |  |
| [1009](#L1009) | return FrmAppHelper::get\_formatted\_time( $atts['entry']->{$atts['tag']}, $atts['format'], $time\_format ); |
| [1010](#L1010) | } |
| [1011](#L1011) |  |
| [1012](#L1012) | /\*\* |
| [1013](#L1013) | \* @since 3.0 |
| [1014](#L1014) | \* |
| [1015](#L1015) | \* @param array $atts |
| [1016](#L1016) | \* |
| [1017](#L1017) | \* @return string|null |
| [1018](#L1018) | \*/ |
| [1019](#L1019) | private static function get\_field\_shortcode\_value( $atts ) { |
| [1020](#L1020) | $field = FrmField::getOne( $atts['tag'] ); |
| [1021](#L1021) | if ( empty( $field ) ) { |
| [1022](#L1022) | return null; |
| [1023](#L1023) | } |
| [1024](#L1024) |  |
| [1025](#L1025) | if ( isset( $atts['show'] ) && $atts['show'] === 'field\_label' ) { |
| [1026](#L1026) | $replace\_with = $field->name; |
| [1027](#L1027) | } elseif ( isset( $atts['show'] ) && $atts['show'] === 'description' ) { |
| [1028](#L1028) | $replace\_with = $field->description; |
| [1029](#L1029) | } else { |
| [1030](#L1030) | $replace\_with = FrmEntryMeta::get\_meta\_value( $atts['entry'], $field->id ); |
| [1031](#L1031) | $string\_value = $replace\_with; |
| [1032](#L1032) | if ( is\_array( $replace\_with ) ) { |
| [1033](#L1033) | $sep          = isset( $atts['sep'] ) ? $atts['sep'] : ', '; |
| [1034](#L1034) | $string\_value = implode( $sep, $replace\_with ); |
| [1035](#L1035) | } |
| [1036](#L1036) |  |
| [1037](#L1037) | if ( empty( $string\_value ) && $string\_value != '0' ) { |
| [1038](#L1038) | $replace\_with = ''; |
| [1039](#L1039) | } else { |
| [1040](#L1040) | $atts['entry\_id']  = $atts['entry']->id; |
| [1041](#L1041) | $atts['entry\_key'] = $atts['entry']->item\_key; |
| [1042](#L1042) | $replace\_with      = self::get\_display\_value( $replace\_with, $field, $atts ); |
| [1043](#L1043) | } |
| [1044](#L1044) | } |
| [1045](#L1045) |  |
| [1046](#L1046) | return $replace\_with; |
| [1047](#L1047) | } |
| [1048](#L1048) |  |
| [1049](#L1049) | /\*\* |
| [1050](#L1050) | \* Get the value to replace a few standard shortcodes |
| [1051](#L1051) | \* |
| [1052](#L1052) | \* @since 2.0 |
| [1053](#L1053) | \* @return string |
| [1054](#L1054) | \*/ |
| [1055](#L1055) | public static function dynamic\_default\_values( $tag, $atts = array(), $return\_array = false ) { |
| [1056](#L1056) | $new\_value = ''; |
| [1057](#L1057) | switch ( $tag ) { |
| [1058](#L1058) | case 'admin\_email': |
| [1059](#L1059) | $new\_value = get\_option( 'admin\_email' ); |
| [1060](#L1060) | break; |
| [1061](#L1061) | case 'default-email': |
| [1062](#L1062) | $frm\_settings = FrmAppHelper::get\_settings(); |
| [1063](#L1063) | $new\_value    = ! empty( $frm\_settings->default\_email ) && is\_email( $frm\_settings->default\_email ) ? $frm\_settings->default\_email : get\_option( 'admin\_email' ); |
| [1064](#L1064) | break; |
| [1065](#L1065) | case 'default-from-email': |
| [1066](#L1066) | $frm\_settings = FrmAppHelper::get\_settings(); |
| [1067](#L1067) | $new\_value    = ! empty( $frm\_settings->from\_email ) && is\_email( $frm\_settings->from\_email ) ? $frm\_settings->from\_email : get\_option( 'admin\_email' ); |
| [1068](#L1068) | break; |
| [1069](#L1069) | case 'siteurl': |
| [1070](#L1070) | $new\_value = FrmAppHelper::site\_url(); |
| [1071](#L1071) | break; |
| [1072](#L1072) | case 'frmurl': |
| [1073](#L1073) | $new\_value = FrmAppHelper::plugin\_url(); |
| [1074](#L1074) | break; |
| [1075](#L1075) | case 'sitename': |
| [1076](#L1076) | $new\_value = FrmAppHelper::site\_name(); |
| [1077](#L1077) | break; |
| [1078](#L1078) | case 'get': |
| [1079](#L1079) | $new\_value = self::process\_get\_shortcode( $atts, $return\_array ); |
| [1080](#L1080) | }//end switch |
| [1081](#L1081) |  |
| [1082](#L1082) | return $new\_value; |
| [1083](#L1083) | } |
| [1084](#L1084) |  |
| [1085](#L1085) | /\*\* |
| [1086](#L1086) | \* Process the [get] shortcode |
| [1087](#L1087) | \* |
| [1088](#L1088) | \* @since 2.0 |
| [1089](#L1089) | \* @return array|string |
| [1090](#L1090) | \*/ |
| [1091](#L1091) | public static function process\_get\_shortcode( $atts, $return\_array = false ) { |
| [1092](#L1092) | if ( ! isset( $atts['param'] ) ) { |
| [1093](#L1093) | return ''; |
| [1094](#L1094) | } |
| [1095](#L1095) |  |
| [1096](#L1096) | if ( strpos( $atts['param'], '&#91;' ) ) { |
| [1097](#L1097) | $atts['param'] = str\_replace( '&#91;', '[', $atts['param'] ); |
| [1098](#L1098) | $atts['param'] = str\_replace( '&#93;', ']', $atts['param'] ); |
| [1099](#L1099) | } |
| [1100](#L1100) |  |
| [1101](#L1101) | $new\_value = FrmAppHelper::get\_param( $atts['param'], '', 'get', 'sanitize\_text\_field' ); |
| [1102](#L1102) | $new\_value = FrmAppHelper::get\_query\_var( $new\_value, $atts['param'] ); |
| [1103](#L1103) |  |
| [1104](#L1104) | if ( $new\_value == '' ) { |
| [1105](#L1105) | if ( ! isset( $atts['prev\_val'] ) ) { |
| [1106](#L1106) | $atts['prev\_val'] = ''; |
| [1107](#L1107) | } |
| [1108](#L1108) |  |
| [1109](#L1109) | $new\_value = isset( $atts['default'] ) ? $atts['default'] : $atts['prev\_val']; |
| [1110](#L1110) | } |
| [1111](#L1111) |  |
| [1112](#L1112) | if ( is\_array( $new\_value ) && ! $return\_array ) { |
| [1113](#L1113) | $new\_value = implode( ', ', $new\_value ); |
| [1114](#L1114) | } |
| [1115](#L1115) |  |
| [1116](#L1116) | return $new\_value; |
| [1117](#L1117) | } |
| [1118](#L1118) |  |
| [1119](#L1119) | public static function get\_display\_value( $value, $field, $atts = array() ) { |
| [1120](#L1120) |  |
| [1121](#L1121) | $value = apply\_filters( 'frm\_get\_' . $field->type . '\_display\_value', $value, $field, $atts ); |
| [1122](#L1122) | $value = apply\_filters( 'frm\_get\_display\_value', $value, $field, $atts ); |
| [1123](#L1123) |  |
| [1124](#L1124) | $value = self::get\_unfiltered\_display\_value( compact( 'value', 'field', 'atts' ) ); |
| [1125](#L1125) |  |
| [1126](#L1126) | return apply\_filters( 'frm\_display\_value', $value, $field, $atts ); |
| [1127](#L1127) | } |
| [1128](#L1128) |  |
| [1129](#L1129) | /\*\* |
| [1130](#L1130) | \* @param array $atts Includes value, field, and atts. |
| [1131](#L1131) | \*/ |
| [1132](#L1132) | public static function get\_unfiltered\_display\_value( $atts ) { |
| [1133](#L1133) | $value = $atts['value']; |
| [1134](#L1134) | $field = $atts['field']; |
| [1135](#L1135) | $atts  = isset( $atts['atts'] ) ? $atts['atts'] : $atts; |
| [1136](#L1136) |  |
| [1137](#L1137) | if ( is\_array( $field ) ) { |
| [1138](#L1138) | $field = $field['id']; |
| [1139](#L1139) | } |
| [1140](#L1140) |  |
| [1141](#L1141) | $field\_obj = FrmFieldFactory::get\_field\_object( $field ); |
| [1142](#L1142) |  |
| [1143](#L1143) | return $field\_obj->get\_display\_value( $value, $atts ); |
| [1144](#L1144) | } |
| [1145](#L1145) |  |
| [1146](#L1146) | /\*\* |
| [1147](#L1147) | \* Get a value from the user profile from the user ID |
| [1148](#L1148) | \* |
| [1149](#L1149) | \* @since 3.0 |
| [1150](#L1150) | \* |
| [1151](#L1151) | \* @return string |
| [1152](#L1152) | \*/ |
| [1153](#L1153) | public static function get\_user\_display\_name( $user\_id, $user\_info = 'display\_name', $args = array() ) { |
| [1154](#L1154) | $defaults = array( |
| [1155](#L1155) | 'blank' => false, |
| [1156](#L1156) | 'link'  => false, |
| [1157](#L1157) | 'size'  => 96, |
| [1158](#L1158) | ); |
| [1159](#L1159) |  |
| [1160](#L1160) | $args = wp\_parse\_args( $args, $defaults ); |
| [1161](#L1161) |  |
| [1162](#L1162) | $user = get\_userdata( $user\_id ); |
| [1163](#L1163) | $info = ''; |
| [1164](#L1164) |  |
| [1165](#L1165) | if ( $user ) { |
| [1166](#L1166) | if ( $user\_info === 'avatar' ) { |
| [1167](#L1167) | $info = get\_avatar( $user\_id, $args['size'] ); |
| [1168](#L1168) | } elseif ( $user\_info === 'author\_link' ) { |
| [1169](#L1169) | $info = get\_author\_posts\_url( $user\_id ); |
| [1170](#L1170) | } else { |
| [1171](#L1171) | $info = isset( $user->$user\_info ) ? $user->$user\_info : ''; |
| [1172](#L1172) | } |
| [1173](#L1173) |  |
| [1174](#L1174) | if ( 'display\_name' === $user\_info && empty( $info ) && ! $args['blank'] ) { |
| [1175](#L1175) | $info = $user->user\_login; |
| [1176](#L1176) | } |
| [1177](#L1177) | } |
| [1178](#L1178) |  |
| [1179](#L1179) | if ( $args['link'] ) { |
| [1180](#L1180) | $info = '<a href="' . esc\_url( admin\_url( 'user-edit.php?user\_id=' . $user\_id ) ) . '">' . $info . '</a>'; |
| [1181](#L1181) | } |
| [1182](#L1182) |  |
| [1183](#L1183) | return $info; |
| [1184](#L1184) | } |
| [1185](#L1185) |  |
| [1186](#L1186) | /\*\* |
| [1187](#L1187) | \* @param string $type |
| [1188](#L1188) | \* @return array |
| [1189](#L1189) | \*/ |
| [1190](#L1190) | public static function get\_field\_types( $type ) { |
| [1191](#L1191) | $single\_input    = self::single\_input\_fields(); |
| [1192](#L1192) | $multiple\_input  = array( 'radio', 'checkbox', 'select', 'scale', 'star', 'lookup' ); |
| [1193](#L1193) | $field\_selection = FrmField::all\_field\_selection(); |
| [1194](#L1194) | $field\_types     = array(); |
| [1195](#L1195) |  |
| [1196](#L1196) | if ( in\_array( $type, $single\_input, true ) ) { |
| [1197](#L1197) | self::field\_types\_for\_input( $single\_input, $field\_selection, $field\_types ); |
| [1198](#L1198) | } elseif ( in\_array( $type, $multiple\_input, true ) ) { |
| [1199](#L1199) | self::field\_types\_for\_input( $multiple\_input, $field\_selection, $field\_types ); |
| [1200](#L1200) | } elseif ( isset( $field\_selection[ $type ] ) ) { |
| [1201](#L1201) | $field\_types[ $type ] = $field\_selection[ $type ]; |
| [1202](#L1202) | } |
| [1203](#L1203) |  |
| [1204](#L1204) | $field\_types = apply\_filters( 'frm\_switch\_field\_types', $field\_types, compact( 'type', 'field\_selection' ) ); |
| [1205](#L1205) |  |
| [1206](#L1206) | return $field\_types; |
| [1207](#L1207) | } |
| [1208](#L1208) |  |
| [1209](#L1209) | /\*\* |
| [1210](#L1210) | \* Get a list of all fields that use a single value input. |
| [1211](#L1211) | \* |
| [1212](#L1212) | \* @since 4.0 |
| [1213](#L1213) | \*/ |
| [1214](#L1214) | public static function single\_input\_fields() { |
| [1215](#L1215) | $fields = array( |
| [1216](#L1216) | 'text', |
| [1217](#L1217) | 'textarea', |
| [1218](#L1218) | 'rte', |
| [1219](#L1219) | 'number', |
| [1220](#L1220) | 'email', |
| [1221](#L1221) | 'url', |
| [1222](#L1222) | 'date', |
| [1223](#L1223) | 'phone', |
| [1224](#L1224) | 'hidden', |
| [1225](#L1225) | 'time', |
| [1226](#L1226) | 'tag', |
| [1227](#L1227) | 'password', |
| [1228](#L1228) | ); |
| [1229](#L1229) | return apply\_filters( 'frm\_single\_input\_fields', $fields ); |
| [1230](#L1230) | } |
| [1231](#L1231) |  |
| [1232](#L1232) | /\*\* |
| [1233](#L1233) | \* @param string[] $inputs |
| [1234](#L1234) | \* @param array    $fields |
| [1235](#L1235) | \* @param array    $field\_types |
| [1236](#L1236) | \* @return void |
| [1237](#L1237) | \*/ |
| [1238](#L1238) | private static function field\_types\_for\_input( $inputs, $fields, &$field\_types ) { |
| [1239](#L1239) | foreach ( $inputs as $input ) { |
| [1240](#L1240) | // This may not be set if a field type was removed using the frm\_available\_fields or frm\_pro\_available\_fields filters. |
| [1241](#L1241) | if ( array\_key\_exists( $input, $fields ) ) { |
| [1242](#L1242) | $field\_types[ $input ] = $fields[ $input ]; |
| [1243](#L1243) | } |
| [1244](#L1244) | unset( $input ); |
| [1245](#L1245) | } |
| [1246](#L1246) | } |
| [1247](#L1247) |  |
| [1248](#L1248) | /\*\* |
| [1249](#L1249) | \* Check if current field option is an "other" option |
| [1250](#L1250) | \* |
| [1251](#L1251) | \* @since 2.0.6 |
| [1252](#L1252) | \* |
| [1253](#L1253) | \* @param string $opt\_key |
| [1254](#L1254) | \* |
| [1255](#L1255) | \* @return bool Returns true if current field option is an "Other" option |
| [1256](#L1256) | \*/ |
| [1257](#L1257) | public static function is\_other\_opt( $opt\_key ) { |
| [1258](#L1258) | return $opt\_key && strpos( $opt\_key, 'other\_' ) === 0; |
| [1259](#L1259) | } |
| [1260](#L1260) |  |
| [1261](#L1261) | /\*\* |
| [1262](#L1262) | \* Get value that belongs in "Other" text box |
| [1263](#L1263) | \* |
| [1264](#L1264) | \* @since 2.0.6 |
| [1265](#L1265) | \* |
| [1266](#L1266) | \* @param array $args |
| [1267](#L1267) | \*/ |
| [1268](#L1268) | public static function get\_other\_val( $args ) { |
| [1269](#L1269) | $defaults = array( |
| [1270](#L1270) | 'opt\_key' => 0, |
| [1271](#L1271) | 'field'   => array(), |
| [1272](#L1272) | 'parent'  => false, |
| [1273](#L1273) | 'pointer' => false, |
| [1274](#L1274) | ); |
| [1275](#L1275) | $args     = wp\_parse\_args( $args, $defaults ); |
| [1276](#L1276) |  |
| [1277](#L1277) | $opt\_key   = $args['opt\_key']; |
| [1278](#L1278) | $field     = $args['field']; |
| [1279](#L1279) | $parent    = $args['parent']; |
| [1280](#L1280) | $pointer   = $args['pointer']; |
| [1281](#L1281) | $other\_val = ''; |
| [1282](#L1282) |  |
| [1283](#L1283) | // If option is an "other" option and there is a value set for this field, |
| [1284](#L1284) | // check if the value belongs in the current "Other" option text field |
| [1285](#L1285) | if ( ! self::is\_other\_opt( $opt\_key ) || ! FrmField::is\_option\_true( $field, 'value' ) ) { |
| [1286](#L1286) | return $other\_val; |
| [1287](#L1287) | } |
| [1288](#L1288) |  |
| [1289](#L1289) | // Check posted vals before checking saved values |
| [1290](#L1290) | // For fields inside repeating sections - note, don't check if $pointer is true because it will often be zero |
| [1291](#L1291) | if ( $parent && isset( $\_POST['item\_meta'][ $parent ][ $pointer ]['other'][ $field['id'] ] ) ) { // phpcs:ignore WordPress.Security.NonceVerification.Missing |
| [1292](#L1292) | if ( FrmField::is\_field\_with\_multiple\_values( $field ) ) { |
| [1293](#L1293) | // phpcs:ignore WordPress.Security.NonceVerification.Missing |
| [1294](#L1294) | $other\_val = isset( $\_POST['item\_meta'][ $parent ][ $pointer ]['other'][ $field['id'] ][ $opt\_key ] ) ? sanitize\_text\_field( wp\_unslash( $\_POST['item\_meta'][ $parent ][ $pointer ]['other'][ $field['id'] ][ $opt\_key ] ) ) : ''; |
| [1295](#L1295) | } else { |
| [1296](#L1296) | $other\_val = sanitize\_text\_field( wp\_unslash( $\_POST['item\_meta'][ $parent ][ $pointer ]['other'][ $field['id'] ] ) ); // phpcs:ignore WordPress.Security.NonceVerification.Missing |
| [1297](#L1297) | } |
| [1298](#L1298) |  |
| [1299](#L1299) | return $other\_val; |
| [1300](#L1300) | } |
| [1301](#L1301) |  |
| [1302](#L1302) | if ( isset( $field['id'] ) && isset( $\_POST['item\_meta']['other'][ $field['id'] ] ) ) { // phpcs:ignore WordPress.Security.NonceVerification.Missing |
| [1303](#L1303) | // For normal fields |
| [1304](#L1304) |  |
| [1305](#L1305) | if ( FrmField::is\_field\_with\_multiple\_values( $field ) ) { |
| [1306](#L1306) | // phpcs:ignore WordPress.Security.NonceVerification.Missing |
| [1307](#L1307) | $other\_val = isset( $\_POST['item\_meta']['other'][ $field['id'] ][ $opt\_key ] ) ? sanitize\_text\_field( wp\_unslash( $\_POST['item\_meta']['other'][ $field['id'] ][ $opt\_key ] ) ) : ''; |
| [1308](#L1308) | } else { |
| [1309](#L1309) | $other\_val = sanitize\_text\_field( wp\_unslash( $\_POST['item\_meta']['other'][ $field['id'] ] ) ); // phpcs:ignore WordPress.Security.NonceVerification.Missing |
| [1310](#L1310) | } |
| [1311](#L1311) |  |
| [1312](#L1312) | return $other\_val; |
| [1313](#L1313) | }//end if |
| [1314](#L1314) |  |
| [1315](#L1315) | // For checkboxes |
| [1316](#L1316) | if ( $field['type'] === 'checkbox' && is\_array( $field['value'] ) ) { |
| [1317](#L1317) | // Check if there is an "other" val in saved value and make sure the |
| [1318](#L1318) | // "other" val is not equal to the Other checkbox option |
| [1319](#L1319) | if ( isset( $field['value'][ $opt\_key ] ) && $field['options'][ $opt\_key ] != $field['value'][ $opt\_key ] ) { |
| [1320](#L1320) | $other\_val = $field['value'][ $opt\_key ]; |
| [1321](#L1321) | } |
| [1322](#L1322) | } else { |
| [1323](#L1323) | /\*\* |
| [1324](#L1324) | \* For radio buttons and dropdowns |
| [1325](#L1325) | \* Check if saved value equals any of the options. If not, set it as the other value. |
| [1326](#L1326) | \*/ |
| [1327](#L1327) | foreach ( $field['options'] as $opt\_key => $opt\_val ) { |
| [1328](#L1328) | $temp\_val = is\_array( $opt\_val ) ? $opt\_val['value'] : $opt\_val; |
| [1329](#L1329) | // Multi-select dropdowns - key is not preserved |
| [1330](#L1330) | if ( is\_array( $field['value'] ) ) { |
| [1331](#L1331) | $o\_key = array\_search( $temp\_val, $field['value'] ); |
| [1332](#L1332) | if ( isset( $field['value'][ $o\_key ] ) ) { |
| [1333](#L1333) | unset( $field['value'][ $o\_key ], $o\_key ); |
| [1334](#L1334) | } |
| [1335](#L1335) | } elseif ( $temp\_val == $field['value'] ) { |
| [1336](#L1336) | // For radio and regular dropdowns |
| [1337](#L1337) | return ''; |
| [1338](#L1338) | } else { |
| [1339](#L1339) | $other\_val = $field['value']; |
| [1340](#L1340) | } |
| [1341](#L1341) | unset( $opt\_key, $opt\_val, $temp\_val ); |
| [1342](#L1342) | } |
| [1343](#L1343) | // For multi-select dropdowns only |
| [1344](#L1344) | if ( is\_array( $field['value'] ) && ! empty( $field['value'] ) ) { |
| [1345](#L1345) | $other\_val = reset( $field['value'] ); |
| [1346](#L1346) | } |
| [1347](#L1347) | }//end if |
| [1348](#L1348) |  |
| [1349](#L1349) | return $other\_val; |
| [1350](#L1350) | } |
| [1351](#L1351) |  |
| [1352](#L1352) | /\*\* |
| [1353](#L1353) | \* Check if there is a saved value for the "Other" text field. If so, set it as the $other\_val. |
| [1354](#L1354) | \* Intended for front-end use |
| [1355](#L1355) | \* |
| [1356](#L1356) | \* @since 2.0.6 |
| [1357](#L1357) | \* |
| [1358](#L1358) | \* @param array  $args Should include field, opt\_key and field name. |
| [1359](#L1359) | \* @param bool   $other\_opt |
| [1360](#L1360) | \* @param string $checked |
| [1361](#L1361) | \* |
| [1362](#L1362) | \* @return array $other\_args |
| [1363](#L1363) | \*/ |
| [1364](#L1364) | public static function prepare\_other\_input( $args, &$other\_opt, &$checked ) { |
| [1365](#L1365) | $other\_args = array( |
| [1366](#L1366) | 'name'  => '', |
| [1367](#L1367) | 'value' => '', |
| [1368](#L1368) | ); |
| [1369](#L1369) |  |
| [1370](#L1370) | // Check if this is an "Other" option. |
| [1371](#L1371) | if ( ! self::is\_other\_opt( $args['opt\_key'] ) ) { |
| [1372](#L1372) | return $other\_args; |
| [1373](#L1373) | } |
| [1374](#L1374) |  |
| [1375](#L1375) | $other\_opt = true; |
| [1376](#L1376) |  |
| [1377](#L1377) | self::set\_other\_name( $args, $other\_args ); |
| [1378](#L1378) | self::set\_other\_value( $args, $other\_args ); |
| [1379](#L1379) |  |
| [1380](#L1380) | if ( '' !== $other\_args['value'] ) { |
| [1381](#L1381) | $checked = 'checked="checked" '; |
| [1382](#L1382) | } |
| [1383](#L1383) |  |
| [1384](#L1384) | // If 'other' is selected as one of the default values for a checkbox field, 'checked' attribute should be on. |
| [1385](#L1385) | if ( ! $checked && |
| [1386](#L1386) | $args['field']['type'] === 'checkbox' && |
| [1387](#L1387) | is\_array( $args['field']['value'] ) && |
| [1388](#L1388) | isset( $args['field\_val'] ) && |
| [1389](#L1389) | in\_array( $args['field\_val'], $args['field']['value'], true ) |
| [1390](#L1390) | ) { |
| [1391](#L1391) | $checked = 'checked="checked" '; |
| [1392](#L1392) | } |
| [1393](#L1393) |  |
| [1394](#L1394) | return $other\_args; |
| [1395](#L1395) | } |
| [1396](#L1396) |  |
| [1397](#L1397) | /\*\* |
| [1398](#L1398) | \* @since 2.0.6 |
| [1399](#L1399) | \* @param array $args |
| [1400](#L1400) | \* @param array $other\_args |
| [1401](#L1401) | \*/ |
| [1402](#L1402) | private static function set\_other\_name( $args, &$other\_args ) { |
| [1403](#L1403) | // Set up name for other field |
| [1404](#L1404) | $other\_args['name'] = str\_replace( '[]', '', $args['field\_name'] ); |
| [1405](#L1405) | $other\_args['name'] = preg\_replace( '/\[' . $args['field']['id'] . '\]$/', '', $other\_args['name'] ); |
| [1406](#L1406) | $other\_args['name'] = $other\_args['name'] . '[other][' . $args['field']['id'] . ']'; |
| [1407](#L1407) |  |
| [1408](#L1408) | // Converts item\_meta[field\_id] => item\_meta[other][field\_id] and |
| [1409](#L1409) | // item\_meta[parent][0][field\_id] => item\_meta[parent][0][other][field\_id] |
| [1410](#L1410) | if ( FrmField::is\_field\_with\_multiple\_values( $args['field'] ) ) { |
| [1411](#L1411) | $other\_args['name'] .= '[' . $args['opt\_key'] . ']'; |
| [1412](#L1412) | } |
| [1413](#L1413) | } |
| [1414](#L1414) |  |
| [1415](#L1415) | /\*\* |
| [1416](#L1416) | \* Find the parent and pointer, and get text for "other" text field |
| [1417](#L1417) | \* |
| [1418](#L1418) | \* @since 2.0.6 |
| [1419](#L1419) | \* @param array $args |
| [1420](#L1420) | \* @param array $other\_args |
| [1421](#L1421) | \*/ |
| [1422](#L1422) | private static function set\_other\_value( $args, &$other\_args ) { |
| [1423](#L1423) | $parent  = ''; |
| [1424](#L1424) | $pointer = ''; |
| [1425](#L1425) |  |
| [1426](#L1426) | // Check for parent ID and pointer |
| [1427](#L1427) | $temp\_array = explode( '[', $args['field\_name'] ); |
| [1428](#L1428) |  |
| [1429](#L1429) | // Count should only be greater than 3 if inside of a repeating section |
| [1430](#L1430) | if ( count( $temp\_array ) > 3 ) { |
| [1431](#L1431) | $parent  = str\_replace( ']', '', $temp\_array[1] ); |
| [1432](#L1432) | $pointer = str\_replace( ']', '', $temp\_array[2] ); |
| [1433](#L1433) | } |
| [1434](#L1434) |  |
| [1435](#L1435) | // Get text for "other" text field |
| [1436](#L1436) | $other\_args['value'] = self::get\_other\_val( |
| [1437](#L1437) | array( |
| [1438](#L1438) | 'opt\_key' => $args['opt\_key'], |
| [1439](#L1439) | 'field'   => $args['field'], |
| [1440](#L1440) | 'parent'  => $parent, |
| [1441](#L1441) | 'pointer' => $pointer, |
| [1442](#L1442) | ) |
| [1443](#L1443) | ); |
| [1444](#L1444) | } |
| [1445](#L1445) |  |
| [1446](#L1446) | /\*\* |
| [1447](#L1447) | \* If this field includes an other option, show it |
| [1448](#L1448) | \* |
| [1449](#L1449) | \* @since 2.0.6 |
| [1450](#L1450) | \* @param array $args |
| [1451](#L1451) | \*/ |
| [1452](#L1452) | public static function include\_other\_input( $args ) { |
| [1453](#L1453) | if ( ! $args['other\_opt'] ) { |
| [1454](#L1454) | return; |
| [1455](#L1455) | } |
| [1456](#L1456) |  |
| [1457](#L1457) | $classes = array( 'frm\_other\_input' ); |
| [1458](#L1458) | if ( ! $args['checked'] || trim( $args['checked'] ) == '' ) { |
| [1459](#L1459) | // hide the field if the other option is not selected |
| [1460](#L1460) | $classes[] = 'frm\_pos\_none'; |
| [1461](#L1461) | } |
| [1462](#L1462) | if ( $args['field']['type'] === 'select' && $args['field']['multiple'] ) { |
| [1463](#L1463) | $classes[] = 'frm\_other\_full'; |
| [1464](#L1464) | } |
| [1465](#L1465) |  |
| [1466](#L1466) | // Set up HTML ID for Other field |
| [1467](#L1467) | $other\_id = self::get\_other\_field\_html\_id( $args['field']['type'], $args['html\_id'], $args['opt\_key'] ); |
| [1468](#L1468) |  |
| [1469](#L1469) | $label = isset( $args['opt\_label'] ) ? $args['opt\_label'] : $args['field']['name']; |
| [1470](#L1470) |  |
| [1471](#L1471) | echo '<label for="' . esc\_attr( $other\_id ) . '" class="frm\_screen\_reader frm\_hidden">' . |
| [1472](#L1472) | esc\_html( $label ) . |
| [1473](#L1473) | '</label>' . |
| [1474](#L1474) | '<input type="text" id="' . esc\_attr( $other\_id ) . '" class="' . esc\_attr( implode( ' ', $classes ) ) . '" ' . |
| [1475](#L1475) | ( $args['read\_only'] ? ' readonly="readonly" disabled="disabled"' : '' ) . |
| [1476](#L1476) | ' name="' . esc\_attr( $args['name'] ) . '" value="' . esc\_attr( $args['value'] ) . '" />'; |
| [1477](#L1477) | } |
| [1478](#L1478) |  |
| [1479](#L1479) | /\*\* |
| [1480](#L1480) | \* Get the HTML id for an "Other" text field |
| [1481](#L1481) | \* Note: This does not affect fields in repeating sections |
| [1482](#L1482) | \* |
| [1483](#L1483) | \* @since 2.0.08 |
| [1484](#L1484) | \* |
| [1485](#L1485) | \* @param string      $type    Field type. |
| [1486](#L1486) | \* @param string      $html\_id |
| [1487](#L1487) | \* @param bool|string $opt\_key |
| [1488](#L1488) | \* |
| [1489](#L1489) | \* @return string $other\_id |
| [1490](#L1490) | \*/ |
| [1491](#L1491) | public static function get\_other\_field\_html\_id( $type, $html\_id, $opt\_key = false ) { |
| [1492](#L1492) | $other\_id = $html\_id; |
| [1493](#L1493) |  |
| [1494](#L1494) | // If hidden radio field, add an opt key of 0 |
| [1495](#L1495) | if ( $type === 'radio' && $opt\_key === false ) { |
| [1496](#L1496) | $opt\_key = 0; |
| [1497](#L1497) | } |
| [1498](#L1498) |  |
| [1499](#L1499) | if ( $opt\_key !== false ) { |
| [1500](#L1500) | $other\_id .= '-' . $opt\_key; |
| [1501](#L1501) | } |
| [1502](#L1502) |  |
| [1503](#L1503) | $other\_id .= '-otext'; |
| [1504](#L1504) |  |
| [1505](#L1505) | return $other\_id; |
| [1506](#L1506) | } |
| [1507](#L1507) |  |
| [1508](#L1508) | public static function switch\_field\_ids( $val ) { |
| [1509](#L1509) | global $frm\_duplicate\_ids; |
| [1510](#L1510) | $replace      = array(); |
| [1511](#L1511) | $replace\_with = array(); |
| [1512](#L1512) | foreach ( (array) $frm\_duplicate\_ids as $old => $new ) { |
| [1513](#L1513) | $replace[]      = '[if ' . $old . ']'; |
| [1514](#L1514) | $replace\_with[] = '[if ' . $new . ']'; |
| [1515](#L1515) | $replace[]      = '[if ' . $old . ' '; |
| [1516](#L1516) | $replace\_with[] = '[if ' . $new . ' '; |
| [1517](#L1517) | $replace[]      = '[/if ' . $old . ']'; |
| [1518](#L1518) | $replace\_with[] = '[/if ' . $new . ']'; |
| [1519](#L1519) | $replace[]      = '[\/if ' . $old . ']'; |
| [1520](#L1520) | $replace\_with[] = '[\/if ' . $new . ']'; |
| [1521](#L1521) | $replace[]      = '[foreach ' . $old . ']'; |
| [1522](#L1522) | $replace\_with[] = '[foreach ' . $new . ']'; |
| [1523](#L1523) | $replace[]      = '[/foreach ' . $old . ']'; |
| [1524](#L1524) | $replace\_with[] = '[/foreach ' . $new . ']'; |
| [1525](#L1525) | $replace[]      = '[\/foreach ' . $old . ']'; |
| [1526](#L1526) | $replace\_with[] = '[\/foreach ' . $new . ']'; |
| [1527](#L1527) | $replace[]      = '[' . $old . ']'; |
| [1528](#L1528) | $replace\_with[] = '[' . $new . ']'; |
| [1529](#L1529) | $replace[]      = '[' . $old . ' '; |
| [1530](#L1530) | $replace\_with[] = '[' . $new . ' '; |
| [1531](#L1531) | $replace[]      = 'field\_id="' . $old . '"'; |
| [1532](#L1532) | $replace\_with[] = 'field\_id="' . $new . '"'; |
| [1533](#L1533) | $replace[]      = 'field\_id=\"' . $old . '\"'; |
| [1534](#L1534) | $replace\_with[] = 'field\_id=\"' . $new . '\"'; |
| [1535](#L1535) | unset( $old, $new ); |
| [1536](#L1536) | }//end foreach |
| [1537](#L1537) | if ( is\_array( $val ) ) { |
| [1538](#L1538) | foreach ( $val as $k => $v ) { |
| [1539](#L1539) | if ( is\_string( $v ) ) { |
| [1540](#L1540) | if ( 'custom\_html' === $k ) { |
| [1541](#L1541) | $val[ $k ] = self::switch\_ids\_except\_strings( $replace, $replace\_with, array( '[if description]', '[description]', '[/if description]' ), $v ); |
| [1542](#L1542) | unset( $k, $v ); |
| [1543](#L1543) | continue; |
| [1544](#L1544) | } |
| [1545](#L1545) | $val[ $k ] = str\_replace( $replace, $replace\_with, $v ); |
| [1546](#L1546) | unset( $k, $v ); |
| [1547](#L1547) | } |
| [1548](#L1548) | } |
| [1549](#L1549) | } else { |
| [1550](#L1550) | $val = str\_replace( $replace, $replace\_with, $val ); |
| [1551](#L1551) | } |
| [1552](#L1552) |  |
| [1553](#L1553) | return $val; |
| [1554](#L1554) | } |
| [1555](#L1555) |  |
| [1556](#L1556) | /\*\* |
| [1557](#L1557) | \* Removes exception strings from replacement arrays and replaces the rest in the provided value string. |
| [1558](#L1558) | \* |
| [1559](#L1559) | \* @since 6.14 |
| [1560](#L1560) | \* |
| [1561](#L1561) | \* @param array  $replace      Values to be replaced. |
| [1562](#L1562) | \* @param array  $replace\_with Replacement values. |
| [1563](#L1563) | \* @param array  $exceptions   Array of strings to skip. |
| [1564](#L1564) | \* @param string $value        Value to be updated. |
| [1565](#L1565) | \* |
| [1566](#L1566) | \* @return string |
| [1567](#L1567) | \*/ |
| [1568](#L1568) | private static function switch\_ids\_except\_strings( $replace, $replace\_with, $exceptions, $value ) { |
| [1569](#L1569) | foreach ( $exceptions as $exception ) { |
| [1570](#L1570) | $index = array\_search( $exception, $replace, true ); |
| [1571](#L1571) | if ( false === $index ) { |
| [1572](#L1572) | continue; |
| [1573](#L1573) | } |
| [1574](#L1574) | unset( $replace[ $index ] ); |
| [1575](#L1575) | unset( $replace\_with[ $index ] ); |
| [1576](#L1576) | } |
| [1577](#L1577) | $value = str\_replace( $replace, $replace\_with, $value ); |
| [1578](#L1578) | return $value; |
| [1579](#L1579) | } |
| [1580](#L1580) |  |
| [1581](#L1581) | /\*\* |
| [1582](#L1582) | \* @since 4.0 |
| [1583](#L1583) | \*/ |
| [1584](#L1584) | public static function bulk\_options\_overlay() { |
| [1585](#L1585) | $prepop = array(); |
| [1586](#L1586) | self::get\_bulk\_prefilled\_opts( $prepop, true ); |
| [1587](#L1587) |  |
| [1588](#L1588) | include FrmAppHelper::plugin\_path() . '/classes/views/frm-fields/back-end/bulk-options-overlay.php'; |
| [1589](#L1589) | } |
| [1590](#L1590) |  |
| [1591](#L1591) | public static function get\_us\_states() { |
| [1592](#L1592) | $states = array( |
| [1593](#L1593) | 'AL' => 'Alabama', |
| [1594](#L1594) | 'AK' => 'Alaska', |
| [1595](#L1595) | 'AR' => 'Arkansas', |
| [1596](#L1596) | 'AZ' => 'Arizona', |
| [1597](#L1597) | 'CA' => 'California', |
| [1598](#L1598) | 'CO' => 'Colorado', |
| [1599](#L1599) | 'CT' => 'Connecticut', |
| [1600](#L1600) | 'DE' => 'Delaware', |
| [1601](#L1601) | 'DC' => 'District of Columbia', |
| [1602](#L1602) | 'FL' => 'Florida', |
| [1603](#L1603) | 'GA' => 'Georgia', |
| [1604](#L1604) | 'HI' => 'Hawaii', |
| [1605](#L1605) | 'ID' => 'Idaho', |
| [1606](#L1606) | 'IL' => 'Illinois', |
| [1607](#L1607) | 'IN' => 'Indiana', |
| [1608](#L1608) | 'IA' => 'Iowa', |
| [1609](#L1609) | 'KS' => 'Kansas', |
| [1610](#L1610) | 'KY' => 'Kentucky', |
| [1611](#L1611) | 'LA' => 'Louisiana', |
| [1612](#L1612) | 'ME' => 'Maine', |
| [1613](#L1613) | 'MD' => 'Maryland', |
| [1614](#L1614) | 'MA' => 'Massachusetts', |
| [1615](#L1615) | 'MI' => 'Michigan', |
| [1616](#L1616) | 'MN' => 'Minnesota', |
| [1617](#L1617) | 'MS' => 'Mississippi', |
| [1618](#L1618) | 'MO' => 'Missouri', |
| [1619](#L1619) | 'MT' => 'Montana', |
| [1620](#L1620) | 'NE' => 'Nebraska', |
| [1621](#L1621) | 'NV' => 'Nevada', |
| [1622](#L1622) | 'NH' => 'New Hampshire', |
| [1623](#L1623) | 'NJ' => 'New Jersey', |
| [1624](#L1624) | 'NM' => 'New Mexico', |
| [1625](#L1625) | 'NY' => 'New York', |
| [1626](#L1626) | 'NC' => 'North Carolina', |
| [1627](#L1627) | 'ND' => 'North Dakota', |
| [1628](#L1628) | 'OH' => 'Ohio', |
| [1629](#L1629) | 'OK' => 'Oklahoma', |
| [1630](#L1630) | 'OR' => 'Oregon', |
| [1631](#L1631) | 'PA' => 'Pennsylvania', |
| [1632](#L1632) | 'RI' => 'Rhode Island', |
| [1633](#L1633) | 'SC' => 'South Carolina', |
| [1634](#L1634) | 'SD' => 'South Dakota', |
| [1635](#L1635) | 'TN' => 'Tennessee', |
| [1636](#L1636) | 'TX' => 'Texas', |
| [1637](#L1637) | 'UT' => 'Utah', |
| [1638](#L1638) | 'VT' => 'Vermont', |
| [1639](#L1639) | 'VA' => 'Virginia', |
| [1640](#L1640) | 'WA' => 'Washington', |
| [1641](#L1641) | 'WV' => 'West Virginia', |
| [1642](#L1642) | 'WI' => 'Wisconsin', |
| [1643](#L1643) | 'WY' => 'Wyoming', |
| [1644](#L1644) | ); |
| [1645](#L1645) |  |
| [1646](#L1646) | return apply\_filters( 'frm\_us\_states', $states ); |
| [1647](#L1647) | } |
| [1648](#L1648) |  |
| [1649](#L1649) | public static function get\_countries() { |
| [1650](#L1650) | $countries = array( |
| [1651](#L1651) | \_\_( 'Afghanistan', 'formidable' ), |
| [1652](#L1652) | \_\_( 'Aland Islands', 'formidable' ), |
| [1653](#L1653) | \_\_( 'Albania', 'formidable' ), |
| [1654](#L1654) | \_\_( 'Algeria', 'formidable' ), |
| [1655](#L1655) | \_\_( 'American Samoa', 'formidable' ), |
| [1656](#L1656) | \_\_( 'Andorra', 'formidable' ), |
| [1657](#L1657) | \_\_( 'Angola', 'formidable' ), |
| [1658](#L1658) | \_\_( 'Anguilla', 'formidable' ), |
| [1659](#L1659) | \_\_( 'Antarctica', 'formidable' ), |
| [1660](#L1660) | \_\_( 'Antigua and Barbuda', 'formidable' ), |
| [1661](#L1661) | \_\_( 'Argentina', 'formidable' ), |
| [1662](#L1662) | \_\_( 'Armenia', 'formidable' ), |
| [1663](#L1663) | \_\_( 'Aruba', 'formidable' ), |
| [1664](#L1664) | \_\_( 'Australia', 'formidable' ), |
| [1665](#L1665) | \_\_( 'Austria', 'formidable' ), |
| [1666](#L1666) | \_\_( 'Azerbaijan', 'formidable' ), |
| [1667](#L1667) | \_\_( 'Bahamas', 'formidable' ), |
| [1668](#L1668) | \_\_( 'Bahrain', 'formidable' ), |
| [1669](#L1669) | \_\_( 'Bangladesh', 'formidable' ), |
| [1670](#L1670) | \_\_( 'Barbados', 'formidable' ), |
| [1671](#L1671) | \_\_( 'Belarus', 'formidable' ), |
| [1672](#L1672) | \_\_( 'Belgium', 'formidable' ), |
| [1673](#L1673) | \_\_( 'Belize', 'formidable' ), |
| [1674](#L1674) | \_\_( 'Benin', 'formidable' ), |
| [1675](#L1675) | \_\_( 'Bermuda', 'formidable' ), |
| [1676](#L1676) | \_\_( 'Bhutan', 'formidable' ), |
| [1677](#L1677) | \_\_( 'Bolivia', 'formidable' ), |
| [1678](#L1678) | \_\_( 'Bonaire, Sint Eustatius and Saba', 'formidable' ), |
| [1679](#L1679) | \_\_( 'Bosnia and Herzegovina', 'formidable' ), |
| [1680](#L1680) | \_\_( 'Botswana', 'formidable' ), |
| [1681](#L1681) | \_\_( 'Bouvet Island', 'formidable' ), |
| [1682](#L1682) | \_\_( 'Brazil', 'formidable' ), |
| [1683](#L1683) | \_\_( 'British Indian Ocean Territory', 'formidable' ), |
| [1684](#L1684) | \_\_( 'Brunei', 'formidable' ), |
| [1685](#L1685) | \_\_( 'Bulgaria', 'formidable' ), |
| [1686](#L1686) | \_\_( 'Burkina Faso', 'formidable' ), |
| [1687](#L1687) | \_\_( 'Burundi', 'formidable' ), |
| [1688](#L1688) | \_\_( 'Cambodia', 'formidable' ), |
| [1689](#L1689) | \_\_( 'Cameroon', 'formidable' ), |
| [1690](#L1690) | \_\_( 'Canada', 'formidable' ), |
| [1691](#L1691) | \_\_( 'Cape Verde', 'formidable' ), |
| [1692](#L1692) | \_\_( 'Cayman Islands', 'formidable' ), |
| [1693](#L1693) | \_\_( 'Central African Republic', 'formidable' ), |
| [1694](#L1694) | \_\_( 'Chad', 'formidable' ), |
| [1695](#L1695) | \_\_( 'Chile', 'formidable' ), |
| [1696](#L1696) | \_\_( 'China', 'formidable' ), |
| [1697](#L1697) | \_\_( 'Christmas Island', 'formidable' ), |
| [1698](#L1698) | \_\_( 'Cocos (Keeling) Islands', 'formidable' ), |
| [1699](#L1699) | \_\_( 'Colombia', 'formidable' ), |
| [1700](#L1700) | \_\_( 'Comoros', 'formidable' ), |
| [1701](#L1701) | \_\_( 'Congo', 'formidable' ), |
| [1702](#L1702) | \_\_( 'Cook Islands', 'formidable' ), |
| [1703](#L1703) | \_\_( 'Costa Rica', 'formidable' ), |
| [1704](#L1704) | \_\_( 'C&ocirc;te d\'Ivoire', 'formidable' ), |
| [1705](#L1705) | \_\_( 'Croatia', 'formidable' ), |
| [1706](#L1706) | \_\_( 'Cuba', 'formidable' ), |
| [1707](#L1707) | \_\_( 'Curacao', 'formidable' ), |
| [1708](#L1708) | \_\_( 'Cyprus', 'formidable' ), |
| [1709](#L1709) | \_\_( 'Czech Republic', 'formidable' ), |
| [1710](#L1710) | \_\_( 'Denmark', 'formidable' ), |
| [1711](#L1711) | \_\_( 'Djibouti', 'formidable' ), |
| [1712](#L1712) | \_\_( 'Dominica', 'formidable' ), |
| [1713](#L1713) | \_\_( 'Dominican Republic', 'formidable' ), |
| [1714](#L1714) | \_\_( 'East Timor', 'formidable' ), |
| [1715](#L1715) | \_\_( 'Ecuador', 'formidable' ), |
| [1716](#L1716) | \_\_( 'Egypt', 'formidable' ), |
| [1717](#L1717) | \_\_( 'El Salvador', 'formidable' ), |
| [1718](#L1718) | \_\_( 'Equatorial Guinea', 'formidable' ), |
| [1719](#L1719) | \_\_( 'Eritrea', 'formidable' ), |
| [1720](#L1720) | \_\_( 'Estonia', 'formidable' ), |
| [1721](#L1721) | \_\_( 'Ethiopia', 'formidable' ), |
| [1722](#L1722) | \_\_( 'Falkland Islands (Malvinas)', 'formidable' ), |
| [1723](#L1723) | \_\_( 'Faroe Islands', 'formidable' ), |
| [1724](#L1724) | \_\_( 'Fiji', 'formidable' ), |
| [1725](#L1725) | \_\_( 'Finland', 'formidable' ), |
| [1726](#L1726) | \_\_( 'France', 'formidable' ), |
| [1727](#L1727) | \_\_( 'French Guiana', 'formidable' ), |
| [1728](#L1728) | \_\_( 'French Polynesia', 'formidable' ), |
| [1729](#L1729) | \_\_( 'French Southern Territories', 'formidable' ), |
| [1730](#L1730) | \_\_( 'Gabon', 'formidable' ), |
| [1731](#L1731) | \_\_( 'Gambia', 'formidable' ), |
| [1732](#L1732) | \_\_( 'Georgia', 'formidable' ), |
| [1733](#L1733) | \_\_( 'Germany', 'formidable' ), |
| [1734](#L1734) | \_\_( 'Ghana', 'formidable' ), |
| [1735](#L1735) | \_\_( 'Gibraltar', 'formidable' ), |
| [1736](#L1736) | \_\_( 'Greece', 'formidable' ), |
| [1737](#L1737) | \_\_( 'Greenland', 'formidable' ), |
| [1738](#L1738) | \_\_( 'Grenada', 'formidable' ), |
| [1739](#L1739) | \_\_( 'Guadeloupe', 'formidable' ), |
| [1740](#L1740) | \_\_( 'Guam', 'formidable' ), |
| [1741](#L1741) | \_\_( 'Guatemala', 'formidable' ), |
| [1742](#L1742) | \_\_( 'Guernsey', 'formidable' ), |
| [1743](#L1743) | \_\_( 'Guinea', 'formidable' ), |
| [1744](#L1744) | \_\_( 'Guinea-Bissau', 'formidable' ), |
| [1745](#L1745) | \_\_( 'Guyana', 'formidable' ), |
| [1746](#L1746) | \_\_( 'Haiti', 'formidable' ), |
| [1747](#L1747) | \_\_( 'Heard Island and McDonald Islands', 'formidable' ), |
| [1748](#L1748) | \_\_( 'Holy See', 'formidable' ), |
| [1749](#L1749) | \_\_( 'Honduras', 'formidable' ), |
| [1750](#L1750) | \_\_( 'Hong Kong', 'formidable' ), |
| [1751](#L1751) | \_\_( 'Hungary', 'formidable' ), |
| [1752](#L1752) | \_\_( 'Iceland', 'formidable' ), |
| [1753](#L1753) | \_\_( 'India', 'formidable' ), |
| [1754](#L1754) | \_\_( 'Indonesia', 'formidable' ), |
| [1755](#L1755) | \_\_( 'Iran', 'formidable' ), |
| [1756](#L1756) | \_\_( 'Iraq', 'formidable' ), |
| [1757](#L1757) | \_\_( 'Ireland', 'formidable' ), |
| [1758](#L1758) | \_\_( 'Israel', 'formidable' ), |
| [1759](#L1759) | \_\_( 'Isle of Man', 'formidable' ), |
| [1760](#L1760) | \_\_( 'Italy', 'formidable' ), |
| [1761](#L1761) | \_\_( 'Jamaica', 'formidable' ), |
| [1762](#L1762) | \_\_( 'Japan', 'formidable' ), |
| [1763](#L1763) | \_\_( 'Jersey', 'formidable' ), |
| [1764](#L1764) | \_\_( 'Jordan', 'formidable' ), |
| [1765](#L1765) | \_\_( 'Kazakhstan', 'formidable' ), |
| [1766](#L1766) | \_\_( 'Kenya', 'formidable' ), |
| [1767](#L1767) | \_\_( 'Kiribati', 'formidable' ), |
| [1768](#L1768) | \_\_( 'North Korea', 'formidable' ), |
| [1769](#L1769) | \_\_( 'South Korea', 'formidable' ), |
| [1770](#L1770) | \_\_( 'Kosovo', 'formidable' ), |
| [1771](#L1771) | \_\_( 'Kuwait', 'formidable' ), |
| [1772](#L1772) | \_\_( 'Kyrgyzstan', 'formidable' ), |
| [1773](#L1773) | \_\_( 'Laos', 'formidable' ), |
| [1774](#L1774) | \_\_( 'Latvia', 'formidable' ), |
| [1775](#L1775) | \_\_( 'Lebanon', 'formidable' ), |
| [1776](#L1776) | \_\_( 'Lesotho', 'formidable' ), |
| [1777](#L1777) | \_\_( 'Liberia', 'formidable' ), |
| [1778](#L1778) | \_\_( 'Libya', 'formidable' ), |
| [1779](#L1779) | \_\_( 'Liechtenstein', 'formidable' ), |
| [1780](#L1780) | \_\_( 'Lithuania', 'formidable' ), |
| [1781](#L1781) | \_\_( 'Luxembourg', 'formidable' ), |
| [1782](#L1782) | \_\_( 'Macao', 'formidable' ), |
| [1783](#L1783) | \_\_( 'Macedonia', 'formidable' ), |
| [1784](#L1784) | \_\_( 'Madagascar', 'formidable' ), |
| [1785](#L1785) | \_\_( 'Malawi', 'formidable' ), |
| [1786](#L1786) | \_\_( 'Malaysia', 'formidable' ), |
| [1787](#L1787) | \_\_( 'Maldives', 'formidable' ), |
| [1788](#L1788) | \_\_( 'Mali', 'formidable' ), |
| [1789](#L1789) | \_\_( 'Malta', 'formidable' ), |
| [1790](#L1790) | \_\_( 'Marshall Islands', 'formidable' ), |
| [1791](#L1791) | \_\_( 'Martinique', 'formidable' ), |
| [1792](#L1792) | \_\_( 'Mauritania', 'formidable' ), |
| [1793](#L1793) | \_\_( 'Mauritius', 'formidable' ), |
| [1794](#L1794) | \_\_( 'Mayotte', 'formidable' ), |
| [1795](#L1795) | \_\_( 'Mexico', 'formidable' ), |
| [1796](#L1796) | \_\_( 'Micronesia', 'formidable' ), |
| [1797](#L1797) | \_\_( 'Moldova', 'formidable' ), |
| [1798](#L1798) | \_\_( 'Monaco', 'formidable' ), |
| [1799](#L1799) | \_\_( 'Mongolia', 'formidable' ), |
| [1800](#L1800) | \_\_( 'Montenegro', 'formidable' ), |
| [1801](#L1801) | \_\_( 'Montserrat', 'formidable' ), |
| [1802](#L1802) | \_\_( 'Morocco', 'formidable' ), |
| [1803](#L1803) | \_\_( 'Mozambique', 'formidable' ), |
| [1804](#L1804) | \_\_( 'Myanmar', 'formidable' ), |
| [1805](#L1805) | \_\_( 'Namibia', 'formidable' ), |
| [1806](#L1806) | \_\_( 'Nauru', 'formidable' ), |
| [1807](#L1807) | \_\_( 'Nepal', 'formidable' ), |
| [1808](#L1808) | \_\_( 'Netherlands', 'formidable' ), |
| [1809](#L1809) | \_\_( 'New Caledonia', 'formidable' ), |
| [1810](#L1810) | \_\_( 'New Zealand', 'formidable' ), |
| [1811](#L1811) | \_\_( 'Nicaragua', 'formidable' ), |
| [1812](#L1812) | \_\_( 'Niger', 'formidable' ), |
| [1813](#L1813) | \_\_( 'Nigeria', 'formidable' ), |
| [1814](#L1814) | \_\_( 'Niue', 'formidable' ), |
| [1815](#L1815) | \_\_( 'Norfolk Island', 'formidable' ), |
| [1816](#L1816) | \_\_( 'Northern Mariana Islands', 'formidable' ), |
| [1817](#L1817) | \_\_( 'Norway', 'formidable' ), |
| [1818](#L1818) | \_\_( 'Oman', 'formidable' ), |
| [1819](#L1819) | \_\_( 'Pakistan', 'formidable' ), |
| [1820](#L1820) | \_\_( 'Palau', 'formidable' ), |
| [1821](#L1821) | \_\_( 'Palestine', 'formidable' ), |
| [1822](#L1822) | \_\_( 'Panama', 'formidable' ), |
| [1823](#L1823) | \_\_( 'Papua New Guinea', 'formidable' ), |
| [1824](#L1824) | \_\_( 'Paraguay', 'formidable' ), |
| [1825](#L1825) | \_\_( 'Peru', 'formidable' ), |
| [1826](#L1826) | \_\_( 'Philippines', 'formidable' ), |
| [1827](#L1827) | \_\_( 'Pitcairn', 'formidable' ), |
| [1828](#L1828) | \_\_( 'Poland', 'formidable' ), |
| [1829](#L1829) | \_\_( 'Portugal', 'formidable' ), |
| [1830](#L1830) | \_\_( 'Puerto Rico', 'formidable' ), |
| [1831](#L1831) | \_\_( 'Qatar', 'formidable' ), |
| [1832](#L1832) | \_\_( 'Reunion', 'formidable' ), |
| [1833](#L1833) | \_\_( 'Romania', 'formidable' ), |
| [1834](#L1834) | \_\_( 'Russia', 'formidable' ), |
| [1835](#L1835) | \_\_( 'Rwanda', 'formidable' ), |
| [1836](#L1836) | \_\_( 'Saint Barthelemy', 'formidable' ), |
| [1837](#L1837) | \_\_( 'Saint Helena, Ascension and Tristan da Cunha', 'formidable' ), |
| [1838](#L1838) | \_\_( 'Saint Kitts and Nevis', 'formidable' ), |
| [1839](#L1839) | \_\_( 'Saint Lucia', 'formidable' ), |
| [1840](#L1840) | \_\_( 'Saint Martin (French part)', 'formidable' ), |
| [1841](#L1841) | \_\_( 'Saint Pierre and Miquelon', 'formidable' ), |
| [1842](#L1842) | \_\_( 'Saint Vincent and the Grenadines', 'formidable' ), |
| [1843](#L1843) | \_\_( 'Samoa', 'formidable' ), |
| [1844](#L1844) | \_\_( 'San Marino', 'formidable' ), |
| [1845](#L1845) | \_\_( 'Sao Tome and Principe', 'formidable' ), |
| [1846](#L1846) | \_\_( 'Saudi Arabia', 'formidable' ), |
| [1847](#L1847) | \_\_( 'Senegal', 'formidable' ), |
| [1848](#L1848) | \_\_( 'Serbia', 'formidable' ), |
| [1849](#L1849) | \_\_( 'Seychelles', 'formidable' ), |
| [1850](#L1850) | \_\_( 'Sierra Leone', 'formidable' ), |
| [1851](#L1851) | \_\_( 'Singapore', 'formidable' ), |
| [1852](#L1852) | \_\_( 'Sint Maarten (Dutch part)', 'formidable' ), |
| [1853](#L1853) | \_\_( 'Slovakia', 'formidable' ), |
| [1854](#L1854) | \_\_( 'Slovenia', 'formidable' ), |
| [1855](#L1855) | \_\_( 'Solomon Islands', 'formidable' ), |
| [1856](#L1856) | \_\_( 'Somalia', 'formidable' ), |
| [1857](#L1857) | \_\_( 'South Africa', 'formidable' ), |
| [1858](#L1858) | \_\_( 'South Georgia and the South Sandwich Islands', 'formidable' ), |
| [1859](#L1859) | \_\_( 'South Sudan', 'formidable' ), |
| [1860](#L1860) | \_\_( 'Spain', 'formidable' ), |
| [1861](#L1861) | \_\_( 'Sri Lanka', 'formidable' ), |
| [1862](#L1862) | \_\_( 'Sudan', 'formidable' ), |
| [1863](#L1863) | \_\_( 'Suriname', 'formidable' ), |
| [1864](#L1864) | \_\_( 'Svalbard and Jan Mayen', 'formidable' ), |
| [1865](#L1865) | \_\_( 'Swaziland', 'formidable' ), |
| [1866](#L1866) | \_\_( 'Sweden', 'formidable' ), |
| [1867](#L1867) | \_\_( 'Switzerland', 'formidable' ), |
| [1868](#L1868) | \_\_( 'Syria', 'formidable' ), |
| [1869](#L1869) | \_\_( 'Taiwan', 'formidable' ), |
| [1870](#L1870) | \_\_( 'Tajikistan', 'formidable' ), |
| [1871](#L1871) | \_\_( 'Tanzania', 'formidable' ), |
| [1872](#L1872) | \_\_( 'Thailand', 'formidable' ), |
| [1873](#L1873) | \_\_( 'Timor-Leste', 'formidable' ), |
| [1874](#L1874) | \_\_( 'Togo', 'formidable' ), |
| [1875](#L1875) | \_\_( 'Tokelau', 'formidable' ), |
| [1876](#L1876) | \_\_( 'Tonga', 'formidable' ), |
| [1877](#L1877) | \_\_( 'Trinidad and Tobago', 'formidable' ), |
| [1878](#L1878) | \_\_( 'Tunisia', 'formidable' ), |
| [1879](#L1879) | \_\_( 'Turkey', 'formidable' ), |
| [1880](#L1880) | \_\_( 'Turkmenistan', 'formidable' ), |
| [1881](#L1881) | \_\_( 'Turks and Caicos Islands', 'formidable' ), |
| [1882](#L1882) | \_\_( 'Tuvalu', 'formidable' ), |
| [1883](#L1883) | \_\_( 'Uganda', 'formidable' ), |
| [1884](#L1884) | \_\_( 'Ukraine', 'formidable' ), |
| [1885](#L1885) | \_\_( 'United Arab Emirates', 'formidable' ), |
| [1886](#L1886) | \_\_( 'United Kingdom', 'formidable' ), |
| [1887](#L1887) | \_\_( 'United States', 'formidable' ), |
| [1888](#L1888) | \_\_( 'United States Minor Outlying Islands', 'formidable' ), |
| [1889](#L1889) | \_\_( 'Uruguay', 'formidable' ), |
| [1890](#L1890) | \_\_( 'Uzbekistan', 'formidable' ), |
| [1891](#L1891) | \_\_( 'Vanuatu', 'formidable' ), |
| [1892](#L1892) | \_\_( 'Vatican City', 'formidable' ), |
| [1893](#L1893) | \_\_( 'Venezuela', 'formidable' ), |
| [1894](#L1894) | \_\_( 'Vietnam', 'formidable' ), |
| [1895](#L1895) | \_\_( 'Virgin Islands, British', 'formidable' ), |
| [1896](#L1896) | \_\_( 'Virgin Islands, U.S.', 'formidable' ), |
| [1897](#L1897) | \_\_( 'Wallis and Futuna', 'formidable' ), |
| [1898](#L1898) | \_\_( 'Western Sahara', 'formidable' ), |
| [1899](#L1899) | \_\_( 'Yemen', 'formidable' ), |
| [1900](#L1900) | \_\_( 'Zambia', 'formidable' ), |
| [1901](#L1901) | \_\_( 'Zimbabwe', 'formidable' ), |
| [1902](#L1902) | ); |
| [1903](#L1903) |  |
| [1904](#L1904) | sort( $countries, SORT\_LOCALE\_STRING ); |
| [1905](#L1905) | return apply\_filters( 'frm\_countries', $countries ); |
| [1906](#L1906) | } |
| [1907](#L1907) |  |
| [1908](#L1908) | /\*\* |
| [1909](#L1909) | \* Gets bulk prefilled options. |
| [1910](#L1910) | \* |
| [1911](#L1911) | \* @since 5.0.04 Add `$include\_class` param. |
| [1912](#L1912) | \* |
| [1913](#L1913) | \* @param array       $prepop        Bulk options. |
| [1914](#L1914) | \* @param array|false $include\_class Include the class in the bulk options. |
| [1915](#L1915) | \*/ |
| [1916](#L1916) | public static function get\_bulk\_prefilled\_opts( array &$prepop, $include\_class = false ) { |
| [1917](#L1917) | // Countries. |
| [1918](#L1918) | $countries = self::get\_countries(); |
| [1919](#L1919) | if ( $include\_class ) { |
| [1920](#L1920) | $countries['class'] = 'frm-countries-opts'; |
| [1921](#L1921) | } |
| [1922](#L1922) |  |
| [1923](#L1923) | $prepop[ \_\_( 'Countries', 'formidable' ) ] = $countries; |
| [1924](#L1924) |  |
| [1925](#L1925) | // State abv. |
| [1926](#L1926) | $states    = self::get\_us\_states(); |
| [1927](#L1927) | $state\_abv = array\_keys( $states ); |
| [1928](#L1928) | sort( $state\_abv ); |
| [1929](#L1929) | if ( $include\_class ) { |
| [1930](#L1930) | $state\_abv['class'] = 'frm-state-abv-opts'; |
| [1931](#L1931) | } |
| [1932](#L1932) |  |
| [1933](#L1933) | $prepop[ \_\_( 'U.S. State Abbreviations', 'formidable' ) ] = $state\_abv; |
| [1934](#L1934) |  |
| [1935](#L1935) | // States. |
| [1936](#L1936) | $states = array\_values( $states ); |
| [1937](#L1937) | sort( $states ); |
| [1938](#L1938) | if ( $include\_class ) { |
| [1939](#L1939) | $states['class'] = 'frm-states-opts'; |
| [1940](#L1940) | } |
| [1941](#L1941) |  |
| [1942](#L1942) | $prepop[ \_\_( 'U.S. States', 'formidable' ) ] = $states; |
| [1943](#L1943) | unset( $state\_abv, $states ); |
| [1944](#L1944) |  |
| [1945](#L1945) | // Age. |
| [1946](#L1946) | $ages = array( |
| [1947](#L1947) | \_\_( 'Under 18', 'formidable' ), |
| [1948](#L1948) | \_\_( '18-24', 'formidable' ), |
| [1949](#L1949) | \_\_( '25-34', 'formidable' ), |
| [1950](#L1950) | \_\_( '35-44', 'formidable' ), |
| [1951](#L1951) | \_\_( '45-54', 'formidable' ), |
| [1952](#L1952) | \_\_( '55-64', 'formidable' ), |
| [1953](#L1953) | \_\_( '65 or Above', 'formidable' ), |
| [1954](#L1954) | \_\_( 'Prefer Not to Answer', 'formidable' ), |
| [1955](#L1955) | ); |
| [1956](#L1956) | if ( $include\_class ) { |
| [1957](#L1957) | $ages['class'] = 'frm-age-opts'; |
| [1958](#L1958) | } |
| [1959](#L1959) |  |
| [1960](#L1960) | $prepop[ \_\_( 'Age', 'formidable' ) ] = $ages; |
| [1961](#L1961) |  |
| [1962](#L1962) | // Satisfaction. |
| [1963](#L1963) | $satisfaction = array( |
| [1964](#L1964) | \_\_( 'Very Unsatisfied', 'formidable' ), |
| [1965](#L1965) | \_\_( 'Unsatisfied', 'formidable' ), |
| [1966](#L1966) | \_\_( 'Neutral', 'formidable' ), |
| [1967](#L1967) | \_\_( 'Satisfied', 'formidable' ), |
| [1968](#L1968) | \_\_( 'Very Satisfied', 'formidable' ), |
| [1969](#L1969) | \_\_( 'N/A', 'formidable' ), |
| [1970](#L1970) | ); |
| [1971](#L1971) | if ( $include\_class ) { |
| [1972](#L1972) | $satisfaction['class'] = 'frm-satisfaction-opts'; |
| [1973](#L1973) | } |
| [1974](#L1974) |  |
| [1975](#L1975) | $prepop[ \_\_( 'Satisfaction', 'formidable' ) ] = $satisfaction; |
| [1976](#L1976) |  |
| [1977](#L1977) | // Importance. |
| [1978](#L1978) | $importance = array( |
| [1979](#L1979) | \_\_( 'Not at all Important', 'formidable' ), |
| [1980](#L1980) | \_\_( 'Somewhat Important', 'formidable' ), |
| [1981](#L1981) | \_\_( 'Neutral', 'formidable' ), |
| [1982](#L1982) | \_\_( 'Important', 'formidable' ), |
| [1983](#L1983) | \_\_( 'Very Important', 'formidable' ), |
| [1984](#L1984) | \_\_( 'N/A', 'formidable' ), |
| [1985](#L1985) | ); |
| [1986](#L1986) | if ( $include\_class ) { |
| [1987](#L1987) | $importance['class'] = 'frm-importance-opts'; |
| [1988](#L1988) | } |
| [1989](#L1989) |  |
| [1990](#L1990) | $prepop[ \_\_( 'Importance', 'formidable' ) ] = $importance; |
| [1991](#L1991) |  |
| [1992](#L1992) | // Agreement. |
| [1993](#L1993) | $agreement = array( |
| [1994](#L1994) | \_\_( 'Strongly Disagree', 'formidable' ), |
| [1995](#L1995) | \_\_( 'Disagree', 'formidable' ), |
| [1996](#L1996) | \_\_( 'Neutral', 'formidable' ), |
| [1997](#L1997) | \_\_( 'Agree', 'formidable' ), |
| [1998](#L1998) | \_\_( 'Strongly Agree', 'formidable' ), |
| [1999](#L1999) | \_\_( 'N/A', 'formidable' ), |
| [2000](#L2000) | ); |
| [2001](#L2001) | if ( $include\_class ) { |
| [2002](#L2002) | $agreement['class'] = 'frm-agreement-opts'; |
| [2003](#L2003) | } |
| [2004](#L2004) |  |
| [2005](#L2005) | $prepop[ \_\_( 'Agreement', 'formidable' ) ] = $agreement; |
| [2006](#L2006) |  |
| [2007](#L2007) | // Likely. |
| [2008](#L2008) | $likely = array( |
| [2009](#L2009) | \_\_( 'Extremely Unlikely', 'formidable' ), |
| [2010](#L2010) | \_\_( 'Unlikely', 'formidable' ), |
| [2011](#L2011) | \_\_( 'Neutral', 'formidable' ), |
| [2012](#L2012) | \_\_( 'Likely', 'formidable' ), |
| [2013](#L2013) | \_\_( 'Extremely Likely', 'formidable' ), |
| [2014](#L2014) | \_\_( 'N/A', 'formidable' ), |
| [2015](#L2015) | ); |
| [2016](#L2016) | if ( $include\_class ) { |
| [2017](#L2017) | $likely['class'] = 'frm-likely-opts'; |
| [2018](#L2018) | } |
| [2019](#L2019) |  |
| [2020](#L2020) | $prepop[ \_\_( 'Likely', 'formidable' ) ] = $likely; |
| [2021](#L2021) |  |
| [2022](#L2022) | $prepop = apply\_filters( 'frm\_bulk\_field\_choices', $prepop ); |
| [2023](#L2023) | } |
| [2024](#L2024) |  |
| [2025](#L2025) | /\*\* |
| [2026](#L2026) | \* Display a field value selector |
| [2027](#L2027) | \* |
| [2028](#L2028) | \* @since 2.03.05 |
| [2029](#L2029) | \* |
| [2030](#L2030) | \* @param int   $selector\_field\_id |
| [2031](#L2031) | \* @param array $selector\_args |
| [2032](#L2032) | \*/ |
| [2033](#L2033) | public static function display\_field\_value\_selector( $selector\_field\_id, $selector\_args ) { |
| [2034](#L2034) | $field\_value\_selector = FrmFieldFactory::create\_field\_value\_selector( $selector\_field\_id, $selector\_args ); |
| [2035](#L2035) | $field\_value\_selector->display(); |
| [2036](#L2036) | } |
| [2037](#L2037) |  |
| [2038](#L2038) | /\*\* |
| [2039](#L2039) | \* Convert a field object to a flat array |
| [2040](#L2040) | \* |
| [2041](#L2041) | \* @since 2.03.05 |
| [2042](#L2042) | \* |
| [2043](#L2043) | \* @param object $field |
| [2044](#L2044) | \* |
| [2045](#L2045) | \* @return array |
| [2046](#L2046) | \*/ |
| [2047](#L2047) | public static function convert\_field\_object\_to\_flat\_array( $field ) { |
| [2048](#L2048) | $field\_options = $field->field\_options; |
| [2049](#L2049) | $field\_array   = get\_object\_vars( $field ); |
| [2050](#L2050) | unset( $field\_array['field\_options'] ); |
| [2051](#L2051) |  |
| [2052](#L2052) | return $field\_array + $field\_options; |
| [2053](#L2053) | } |
| [2054](#L2054) |  |
| [2055](#L2055) | /\*\* |
| [2056](#L2056) | \* @since 4.04 |
| [2057](#L2057) | \* |
| [2058](#L2058) | \* @param array $args |
| [2059](#L2059) | \* @return void |
| [2060](#L2060) | \*/ |
| [2061](#L2061) | public static function show\_add\_field\_buttons( $args ) { |
| [2062](#L2062) | $field\_key    = $args['field\_key']; |
| [2063](#L2063) | $field\_type   = $args['field\_type']; |
| [2064](#L2064) | $field\_label  = FrmAppHelper::icon\_by\_class( FrmFormsHelper::get\_field\_link\_icon( $field\_type ), array( 'echo' => false ) ); |
| [2065](#L2065) | $field\_name   = FrmFormsHelper::get\_field\_link\_name( $field\_type ); |
| [2066](#L2066) | $field\_label .= ' <span>' . $field\_name . '</span>'; |
| [2067](#L2067) |  |
| [2068](#L2068) | if ( ! empty( $field\_type['is\_new'] ) ) { |
| [2069](#L2069) | ob\_start(); |
| [2070](#L2070) | FrmAppHelper::show\_pill\_text(); |
| [2071](#L2071) | $field\_label .= ob\_get\_clean(); |
| [2072](#L2072) | } |
| [2073](#L2073) |  |
| [2074](#L2074) | // If the individual field isn't allowed, disable it. |
| [2075](#L2075) | $run\_filter             = true; |
| [2076](#L2076) | $single\_no\_allow        = ' '; |
| [2077](#L2077) | $install\_data           = ''; |
| [2078](#L2078) | $requires               = ''; |
| [2079](#L2079) | $link                   = isset( $field\_type['link'] ) ? esc\_url\_raw( $field\_type['link'] ) : ''; |
| [2080](#L2080) | $has\_show\_upgrade\_class = strpos( $field\_type['icon'], ' frm\_show\_upgrade' ); |
| [2081](#L2081) | $show\_upgrade           = $has\_show\_upgrade\_class || false !== strpos( $args['no\_allow\_class'], 'frm\_show\_upgrade' ); |
| [2082](#L2082) |  |
| [2083](#L2083) | if ( $has\_show\_upgrade\_class ) { |
| [2084](#L2084) | $single\_no\_allow   .= 'frm\_show\_upgrade'; |
| [2085](#L2085) | $field\_type['icon'] = str\_replace( ' frm\_show\_upgrade', '', $field\_type['icon'] ); |
| [2086](#L2086) | $run\_filter         = false; |
| [2087](#L2087) | if ( isset( $field\_type['addon'] ) ) { |
| [2088](#L2088) | $upgrading = FrmAddonsController::install\_link( $field\_type['addon'] ); |
| [2089](#L2089) | if ( isset( $upgrading['url'] ) ) { |
| [2090](#L2090) | $install\_data = json\_encode( $upgrading ); |
| [2091](#L2091) | } |
| [2092](#L2092) | $requires = FrmFormsHelper::get\_plan\_required( $upgrading ); |
| [2093](#L2093) | } elseif ( isset( $field\_type['require'] ) ) { |
| [2094](#L2094) | $requires = $field\_type['require']; |
| [2095](#L2095) | } |
| [2096](#L2096) | } |
| [2097](#L2097) |  |
| [2098](#L2098) | $upgrade\_label   = ''; |
| [2099](#L2099) | $upgrade\_message = ''; |
| [2100](#L2100) | if ( $show\_upgrade ) { |
| [2101](#L2101) | /\* translators: %s: Field name \*/ |
| [2102](#L2102) | $upgrade\_label = sprintf( esc\_html\_\_( '%s fields', 'formidable' ), $field\_name ); |
| [2103](#L2103) |  |
| [2104](#L2104) | if ( isset( $field\_type['message'] ) ) { |
| [2105](#L2105) | $upgrade\_message = FrmAppHelper::kses( $field\_type['message'], array( 'a', 'img' ) ); |
| [2106](#L2106) | } |
| [2107](#L2107) | } |
| [2108](#L2108) |  |
| [2109](#L2109) | $li\_params = array( |
| [2110](#L2110) | 'class'         => 'frmbutton frm6 ' . $args['no\_allow\_class'] . $single\_no\_allow . ' frm\_t' . str\_replace( '|', '-', $field\_key ), |
| [2111](#L2111) | 'id'            => $field\_key, |
| [2112](#L2112) | 'data-upgrade'  => $upgrade\_label, |
| [2113](#L2113) | 'data-link'     => $link, |
| [2114](#L2114) | 'data-medium'   => 'builder', |
| [2115](#L2115) | 'data-oneclick' => $install\_data, |
| [2116](#L2116) | 'data-content'  => $field\_key, |
| [2117](#L2117) | 'data-requires' => $requires, |
| [2118](#L2118) | ); |
| [2119](#L2119) |  |
| [2120](#L2120) | if ( ! empty( $field\_type['hide'] ) ) { |
| [2121](#L2121) | $li\_params['class'] .= ' frm\_hidden'; |
| [2122](#L2122) | } |
| [2123](#L2123) |  |
| [2124](#L2124) | if ( ! empty( $field\_type['upsell\_image'] ) ) { |
| [2125](#L2125) | $li\_params['data-upsell-image'] = $field\_type['upsell\_image']; |
| [2126](#L2126) | } |
| [2127](#L2127) |  |
| [2128](#L2128) | if ( $upgrade\_message ) { |
| [2129](#L2129) | $li\_params['data-message'] = $upgrade\_message; |
| [2130](#L2130) | } |
| [2131](#L2131) | ?> |
| [2132](#L2132) | <li <?php FrmAppHelper::array\_to\_html\_params( $li\_params, true ); ?>> |
| [2133](#L2133) | <?php |
| [2134](#L2134) | if ( $run\_filter ) { |
| [2135](#L2135) | $field\_label = apply\_filters( 'frmpro\_field\_links', $field\_label, $args['id'], $field\_key ); |
| [2136](#L2136) | } |
| [2137](#L2137) | echo FrmAppHelper::kses( $field\_label, array( 'a', 'i', 'span', 'use', 'svg' ) ); // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped |
| [2138](#L2138) | ?> |
| [2139](#L2139) | </li> |
| [2140](#L2140) | <?php |
| [2141](#L2141) | } |
| [2142](#L2142) |  |
| [2143](#L2143) | /\*\* |
| [2144](#L2144) | \* Shows Display format option. |
| [2145](#L2145) | \* |
| [2146](#L2146) | \* @since 5.0.04 |
| [2147](#L2147) | \* |
| [2148](#L2148) | \* @param array $field Field data. |
| [2149](#L2149) | \*/ |
| [2150](#L2150) | public static function show\_radio\_display\_format( $field ) { |
| [2151](#L2151) | $options = self::get\_display\_format\_options( $field ); |
| [2152](#L2152) |  |
| [2153](#L2153) | $args = self::get\_display\_format\_args( $field, $options ); |
| [2154](#L2154) |  |
| [2155](#L2155) | include FrmAppHelper::plugin\_path() . '/classes/views/frm-fields/back-end/radio-display-format.php'; |
| [2156](#L2156) | } |
| [2157](#L2157) |  |
| [2158](#L2158) | /\*\* |
| [2159](#L2159) | \* Creates an array that contains variables used for display format options setting. |
| [2160](#L2160) | \* |
| [2161](#L2161) | \* @since 6.3.2 |
| [2162](#L2162) | \* |
| [2163](#L2163) | \* @param array $field The field. |
| [2164](#L2164) | \* |
| [2165](#L2165) | \* @return array |
| [2166](#L2166) | \*/ |
| [2167](#L2167) | public static function get\_display\_format\_options( $field ) { |
| [2168](#L2168) | $options = array( |
| [2169](#L2169) | '0'       => array( |
| [2170](#L2170) | 'text' => \_\_( 'Simple', 'formidable' ), |
| [2171](#L2171) | 'svg'  => 'frm\_simple\_radio', |
| [2172](#L2172) | ), |
| [2173](#L2173) | '1'       => array( |
| [2174](#L2174) | 'text'    => \_\_( 'Images', 'formidable' ), |
| [2175](#L2175) | 'svg'     => 'frm\_image\_as\_option', |
| [2176](#L2176) | 'addon'   => 'pro', |
| [2177](#L2177) | 'upgrade' => \_\_( 'Image Options', 'formidable' ), |
| [2178](#L2178) | 'message' => \_\_( 'Show images instead of radio buttons or check boxes. This is ideal for polls, surveys, segmenting questionnaires and more.', 'formidable' ) . '<img src="' . esc\_url( FrmAppHelper::plugin\_url() ) . '/images/image-options.png" />', |
| [2179](#L2179) | 'content' => 'image-options', |
| [2180](#L2180) | ), |
| [2181](#L2181) | 'buttons' => array( |
| [2182](#L2182) | 'text'    => \_\_( 'Buttons', 'formidable' ), |
| [2183](#L2183) | 'svg'     => 'frm\_button\_as\_option', |
| [2184](#L2184) | 'addon'   => 'surveys', |
| [2185](#L2185) | 'upgrade' => \_\_( 'Button Options', 'formidable' ), |
| [2186](#L2186) | 'message' => \_\_( 'Show buttons for radio buttons or check boxes. This is ideal for polls, surveys, segmenting questionnaires and more.', 'formidable' ), |
| [2187](#L2187) | 'content' => 'button-options', |
| [2188](#L2188) | ), |
| [2189](#L2189) | ); |
| [2190](#L2190) |  |
| [2191](#L2191) | /\*\* |
| [2192](#L2192) | \* Allows modifying the options of Display format setting of Radio field. |
| [2193](#L2193) | \* |
| [2194](#L2194) | \* @since 5.0.04 |
| [2195](#L2195) | \* |
| [2196](#L2196) | \* @param array $options Options. |
| [2197](#L2197) | \* @param array $field |
| [2198](#L2198) | \*/ |
| [2199](#L2199) | $options = apply\_filters( 'frm\_' . $field['type'] . '\_display\_format\_options', $options, $field ); |
| [2200](#L2200) |  |
| [2201](#L2201) | return $options; |
| [2202](#L2202) | } |
| [2203](#L2203) |  |
| [2204](#L2204) | /\*\* |
| [2205](#L2205) | \* Gets display format arguments to pass to the images\_dropdown() method. |
| [2206](#L2206) | \* |
| [2207](#L2207) | \* @since 5.0.04 |
| [2208](#L2208) | \* |
| [2209](#L2209) | \* @param array $field   Field data. |
| [2210](#L2210) | \* @param array $options Options array. |
| [2211](#L2211) | \* @return array |
| [2212](#L2212) | \*/ |
| [2213](#L2213) | public static function get\_display\_format\_args( $field, $options ) { |
| [2214](#L2214) | $args = array( |
| [2215](#L2215) | 'selected'    => '0', |
| [2216](#L2216) | 'options'     => array(), |
| [2217](#L2217) | 'name'        => 'field\_options[image\_options\_' . $field['id'] . ']', |
| [2218](#L2218) | 'input\_attrs' => array( |
| [2219](#L2219) | 'class' => 'frm\_toggle\_image\_options', |
| [2220](#L2220) | ), |
| [2221](#L2221) | ); |
| [2222](#L2222) |  |
| [2223](#L2223) | self::fill\_image\_setting\_options( $options, $args ); |
| [2224](#L2224) |  |
| [2225](#L2225) | /\*\* |
| [2226](#L2226) | \* Allows modifying the arguments of Display format setting of Radio field. |
| [2227](#L2227) | \* |
| [2228](#L2228) | \* @since 5.0.04 |
| [2229](#L2229) | \* |
| [2230](#L2230) | \* @param array $args        Arguments. |
| [2231](#L2231) | \* @param array $method\_args The arguments from the method. Contains `field`, `options`. |
| [2232](#L2232) | \*/ |
| [2233](#L2233) | return apply\_filters( 'frm\_' . $field['type'] . '\_display\_format\_args', $args, compact( 'field', 'options' ) ); |
| [2234](#L2234) | } |
| [2235](#L2235) |  |
| [2236](#L2236) | /\*\* |
| [2237](#L2237) | \* @since 5.0.04 |
| [2238](#L2238) | \*/ |
| [2239](#L2239) | private static function fill\_image\_setting\_options( $options, &$args ) { |
| [2240](#L2240) | foreach ( $options as $key => $option ) { |
| [2241](#L2241) | $args['options'][ $key ] = $option; |
| [2242](#L2242) |  |
| [2243](#L2243) | if ( ! empty( $option['addon'] ) ) { |
| [2244](#L2244) | $args['options'][ $key ]['custom\_attrs'] = self::fill\_image\_setting\_addon\_link( $option ); |
| [2245](#L2245) | } |
| [2246](#L2246) |  |
| [2247](#L2247) | unset( $args['options'][ $key ]['addon'] ); |
| [2248](#L2248) | $fill = array( 'upgrade', 'message', 'content' ); |
| [2249](#L2249) | foreach ( $fill as $f ) { |
| [2250](#L2250) | unset( $args['options'][ $key ][ $f ], $f ); |
| [2251](#L2251) | } |
| [2252](#L2252) | } |
| [2253](#L2253) | } |
| [2254](#L2254) |  |
| [2255](#L2255) | /\*\* |
| [2256](#L2256) | \* @since 5.0.04 |
| [2257](#L2257) | \* |
| [2258](#L2258) | \* @return array |
| [2259](#L2259) | \*/ |
| [2260](#L2260) | private static function fill\_image\_setting\_addon\_link( $option ) { |
| [2261](#L2261) | $custom\_attrs = array( |
| [2262](#L2262) | 'class'       => 'frm\_noallow frm\_show\_upgrade', |
| [2263](#L2263) | 'data-medium' => 'builder', |
| [2264](#L2264) | ); |
| [2265](#L2265) |  |
| [2266](#L2266) | // translators: Add-on name. |
| [2267](#L2267) | $custom\_attrs['data-upgrade'] = sprintf( \_\_( 'Formidable %s', 'formidable' ), ucwords( $option['addon'] ) ); |
| [2268](#L2268) |  |
| [2269](#L2269) | $fill = array( 'upgrade', 'message', 'content' ); |
| [2270](#L2270) | foreach ( $fill as $f ) { |
| [2271](#L2271) | if ( isset( $option[ $f ] ) ) { |
| [2272](#L2272) | $custom\_attrs[ 'data-' . $f ] = $option[ $f ]; |
| [2273](#L2273) | } |
| [2274](#L2274) | } |
| [2275](#L2275) |  |
| [2276](#L2276) | if ( 'pro' === $option['addon'] ) { |
| [2277](#L2277) | return $custom\_attrs; |
| [2278](#L2278) | } |
| [2279](#L2279) |  |
| [2280](#L2280) | $upgrading = FrmAddonsController::install\_link( $option['addon'] ); |
| [2281](#L2281) | if ( isset( $upgrading['url'] ) ) { |
| [2282](#L2282) | $install\_data = wp\_json\_encode( $upgrading ); |
| [2283](#L2283) | } else { |
| [2284](#L2284) | $install\_data = ''; |
| [2285](#L2285) | } |
| [2286](#L2286) |  |
| [2287](#L2287) | $custom\_attrs['data-oneclick'] = $install\_data; |
| [2288](#L2288) | $custom\_attrs['data-requires'] = FrmFormsHelper::get\_plan\_required( $upgrading ); |
| [2289](#L2289) |  |
| [2290](#L2290) | return $custom\_attrs; |
| [2291](#L2291) | } |
| [2292](#L2292) |  |
| [2293](#L2293) | /\*\* |
| [2294](#L2294) | \* Maybe adjust a field value based on type. |
| [2295](#L2295) | \* Some types require unserializing an array. |
| [2296](#L2296) | \* These types are defined by a array\_allowed property on their field model class. |
| [2297](#L2297) | \* |
| [2298](#L2298) | \* @since 6.2 |
| [2299](#L2299) | \* |
| [2300](#L2300) | \* @param mixed  $value |
| [2301](#L2301) | \* @param string $field\_type |
| [2302](#L2302) | \* @return void |
| [2303](#L2303) | \*/ |
| [2304](#L2304) | public static function prepare\_field\_value( &$value, $field\_type ) { |
| [2305](#L2305) | $field\_object = FrmFieldFactory::get\_field\_type( $field\_type ); |
| [2306](#L2306) | $value        = $field\_object->maybe\_decode\_value( $value ); |
| [2307](#L2307) | } |
| [2308](#L2308) |  |
| [2309](#L2309) | /\*\* |
| [2310](#L2310) | \* @since 6.8 |
| [2311](#L2311) | \* |
| [2312](#L2312) | \* @param int|string $form\_id |
| [2313](#L2313) | \* @param array      $field\_ids If this is not empty, the results will be filtered by field id. |
| [2314](#L2314) | \* @return array |
| [2315](#L2315) | \*/ |
| [2316](#L2316) | public static function get\_draft\_field\_results( $form\_id, $field\_ids = array() ) { |
| [2317](#L2317) | if ( FrmAppHelper::pro\_is\_installed() ) { |
| [2318](#L2318) | $child\_form\_ids = FrmDb::get\_col( 'frm\_forms', array( 'parent\_form\_id' => $form\_id ) ); |
| [2319](#L2319) | $form\_ids       = array\_merge( array( $form\_id ), $child\_form\_ids ); |
| [2320](#L2320) | } else { |
| [2321](#L2321) | $form\_ids = array( $form\_id ); |
| [2322](#L2322) | } |
| [2323](#L2323) |  |
| [2324](#L2324) | $where = array( |
| [2325](#L2325) | 'form\_id'            => $form\_ids, |
| [2326](#L2326) | // Do a soft check for fields that look like drafts only. |
| [2327](#L2327) | 'field\_options LIKE' => 's:5:"draft";i:1;', |
| [2328](#L2328) | ); |
| [2329](#L2329) |  |
| [2330](#L2330) | if ( $field\_ids ) { |
| [2331](#L2331) | $where['id'] = $field\_ids; |
| [2332](#L2332) | } |
| [2333](#L2333) |  |
| [2334](#L2334) | $rows = FrmDb::get\_results( 'frm\_fields', $where, 'id, field\_options' ); |
| [2335](#L2335) |  |
| [2336](#L2336) | return array\_filter( |
| [2337](#L2337) | $rows, |
| [2338](#L2338) | function ( $row ) { |
| [2339](#L2339) | FrmAppHelper::unserialize\_or\_decode( $row->field\_options ); |
| [2340](#L2340) | return is\_array( $row->field\_options ) && ! empty( $row->field\_options['draft'] ); |
| [2341](#L2341) | } |
| [2342](#L2342) | ); |
| [2343](#L2343) | } |
| [2344](#L2344) |  |
| [2345](#L2345) | /\*\* |
| [2346](#L2346) | \* This is called when loading the form builder. |
| [2347](#L2347) | \* Any unsaved draft fields get added to a hidden draft\_fields input on load. |
| [2348](#L2348) | \* |
| [2349](#L2349) | \* @since 6.8 |
| [2350](#L2350) | \* |
| [2351](#L2351) | \* @param int|string $form\_id |
| [2352](#L2352) | \* @return array |
| [2353](#L2353) | \*/ |
| [2354](#L2354) | public static function get\_all\_draft\_field\_ids( $form\_id ) { |
| [2355](#L2355) | $draft\_field\_rows = self::get\_draft\_field\_results( $form\_id ); |
| [2356](#L2356) | return wp\_list\_pluck( $draft\_field\_rows, 'id' ); |
| [2357](#L2357) | } |
| [2358](#L2358) | } |

**Note:** See [TracBrowser](/wiki/TracBrowser)
for help on using the repository browser.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Plain Text](/browser/formidable/tags/6.16/classes/helpers/FrmFieldsHelper.php?format=txt)
* [Original Format](/export/3222487/formidable/tags/6.16/classes/helpers/FrmFieldsHelper.php)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from www.wordfence.com_43ffb4ba_20250114_221053.html ===


[![](https://www.wordfence.com/img/wordfence-intelligence-logo.svg)](/threat-intel/)

Have you found a vulnerability in a WordPress plugin or theme? Report vulnerabilities in WordPress plugins and themes through our [bug bounty program](https://www.wordfence.com/threat-intel/bug-bounty-program) and earn a bounty on all in-scope submissions, while we handle the responsible disclosure process on your behalf.

As a reminder, the Wordfence Intelligence Vulnerability Database API is completely free to query and utilize, both personally and commercially, and contains all the same vulnerability data as the user interface. Please review the API documentation and Webhook documentation for more information on how to query the vulnerability API endpoints and configure webhooks utilizing all the same data present in the Wordfence Intelligence user interface.

# Formidable Forms – Contact Form Plugin, Survey, Quiz, Payment, Calculator Form & Custom Form Builder <= 6.16.1.2 - Reflected Cross-Site Scripting via Custom HTML Form Parameter

 [Wordfence Intelligence](https://www.wordfence.com/threat-intel)   >    [Vulnerability Database](https://www.wordfence.com/threat-intel/vulnerabilities)   >   Formidable Forms – Contact Form Plugin, Survey, Quiz, Payment, Calculator Form & Custom Form Builder <= 6.16.1.2 - Reflected Cross-Site Scripting via Custom HTML Form Parameter

6.1

**Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')**
**CVSS Vector**
[CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N)

| CVE | [CVE-2024-11188](https://www.cve.org/CVERecord?id=CVE-2024-11188) |
| --- | --- |
| CVSS | 6.1 (Medium) |
| Publicly Published | November 22, 2024 |
| Last Updated | November 23, 2024 |
| Researcher | [mikemyers](https://www.wordfence.com/threat-intel/vulnerabilities/researchers/michael-mazzolini) |

### Description

The Formidable Forms – Contact Form Plugin, Survey, Quiz, Payment, Calculator Form & Custom Form Builder plugin for WordPress is vulnerable to POST-Based Reflected Cross-Site Scripting via the Custom HTML Form parameters in all versions up to, and including, 6.16.1.2 due to insufficient input sanitization and output escaping. This makes it possible for unauthenticated attackers to inject arbitrary web scripts in pages that execute if they can successfully trick a user into performing an action such as clicking on a link.

#### References

* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/browser/formidable/tags/6.16/classes/helpers/FrmFieldsHelper.php#L158)

#### Share

[Facebook](https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fformidable%2Fformidable-forms-contact-form-plugin-survey-quiz-payment-calculator-form-custom-form-builder-61612-reflected-cross-site-scripting-via-custom-html-form-parameter&t=Formidable%20Forms%20%E2%80%93%20Contact%20Form%20Plugin%2C%20Survey%2C%20Quiz%2C%20Payment%2C%20Calculator%20Form%20%26%20Custom%20Form%20Builder%20%3C%3D%206.16.1.2%20-%20Reflected%20Cross-Site%20Scripting%20via%20Custom%20HTML%20Form%20Parameter "Facebook")
[Twitter](https://twitter.com/share?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fformidable%2Fformidable-forms-contact-form-plugin-survey-quiz-payment-calculator-form-custom-form-builder-61612-reflected-cross-site-scripting-via-custom-html-form-parameter&text=Formidable%20Forms%20%E2%80%93%20Contact%20Form%20Plugin%2C%20Survey%2C%20Quiz%2C%20Payment%2C%20Calculator%20Form%20%26%20Custom%20Form%20Builder%20%3C%3D%206.16.1.2%20-%20Reflected%20Cross-Site%20Scripting%20via%20Custom%20HTML%20Form%20Parameter "Twitter")
[LinkedIn](https://www.linkedin.com/shareArticle?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fformidable%2Fformidable-forms-contact-form-plugin-survey-quiz-payment-calculator-form-custom-form-builder-61612-reflected-cross-site-scripting-via-custom-html-form-parameter "LinkedIn")
Email

## Vulnerability Details for Formidable Forms – Contact Form Plugin, Survey, Quiz, Payment, Calculator Form & Custom Form Builder

#### [Formidable Forms – Contact Form Plugin, Survey, Quiz, Payment, Calculator Form & Custom Form Builder](https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/formidable)

| Software Type | Plugin |
| --- | --- |
| Software Slug | formidable [(view on wordpress.org)](https://wordpress.org/plugins/formidable) |
| Patched? | Yes |
| Remediation | Update to version 6.16.2, or a newer patched version |
| Affected Version | * <= 6.16.1.2 |
| Patched Version | * 6.16.2 |

This record contains material that is subject to copyright.

**Copyright 2012-2025 Defiant Inc.**

**License:**
Defiant hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute this software vulnerability information. Any copy of the software vulnerability information you make for such purposes is authorized provided that you include a hyperlink to this vulnerability record and reproduce Defiant's copyright designation and this license in any such copy.
**[Read more.](https://www.wordfence.com/wordfence-intelligence-terms-and-conditions/)**

**Copyright 1999-2025 The MITRE Corporation**

**License:**
CVE Usage: MITRE hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute Common Vulnerabilities and Exposures (CVE®). Any copy you make for such purposes is authorized provided that you reproduce MITRE's copyright designation and this license in any such copy.
**[Read more.](https://www.cve.org/Legal/TermsOfUse)**

Have information to add, or spot any errors? Contact us at wfi-support@wordfence.com so we can make any appropriate adjustments.

Did you know Wordfence Intelligence provides free personal and commercial API access to our comprehensive WordPress vulnerability database, along with a free webhook integration to stay on top of the latest vulnerabilities added and updated in the database? Get started today!

Learn more

Want to get notified of the latest vulnerabilities that may affect your WordPress site?
 Install Wordfence on your site today to get notified immediately if your site is affected by a vulnerability that has been added to our database.

Get Wordfence

The Wordfence Intelligence WordPress vulnerability database is completely free to access and query via API. Please review the documentation on how to access and consume the vulnerability data via API.

Documentation


