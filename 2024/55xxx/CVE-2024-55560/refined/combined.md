=== Content from github.com_c87fcb10_20250114_182442.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FMailCleaner%2FMailCleaner%2Fcommit%2F28d913eaa044b689eb114f72ebe92d48cb4aaca7)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FMailCleaner%2FMailCleaner%2Fcommit%2F28d913eaa044b689eb114f72ebe92d48cb4aaca7)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=MailCleaner%2FMailCleaner)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[MailCleaner](/MailCleaner)
/
**[MailCleaner](/MailCleaner/MailCleaner)**
Public

* [Notifications](/login?return_to=%2FMailCleaner%2FMailCleaner) You must be signed in to change notification settings
* [Fork
  35](/login?return_to=%2FMailCleaner%2FMailCleaner)
* [Star
   92](/login?return_to=%2FMailCleaner%2FMailCleaner)

* [Code](/MailCleaner/MailCleaner)
* [Issues
  9](/MailCleaner/MailCleaner/issues)
* [Pull requests
  1](/MailCleaner/MailCleaner/pulls)
* [Actions](/MailCleaner/MailCleaner/actions)
* [Projects
  0](/MailCleaner/MailCleaner/projects)
* [Wiki](/MailCleaner/MailCleaner/wiki)
* [Security](/MailCleaner/MailCleaner/security)
* [Insights](/MailCleaner/MailCleaner/pulse)

Additional navigation options

* [Code](/MailCleaner/MailCleaner)
* [Issues](/MailCleaner/MailCleaner/issues)
* [Pull requests](/MailCleaner/MailCleaner/pulls)
* [Actions](/MailCleaner/MailCleaner/actions)
* [Projects](/MailCleaner/MailCleaner/projects)
* [Wiki](/MailCleaner/MailCleaner/wiki)
* [Security](/MailCleaner/MailCleaner/security)
* [Insights](/MailCleaner/MailCleaner/pulse)

## Commit

[Permalink](/MailCleaner/MailCleaner/commit/28d913eaa044b689eb114f72ebe92d48cb4aaca7)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Rotate host keys during firstruncmd

[Browse files](/MailCleaner/MailCleaner/tree/28d913eaa044b689eb114f72ebe92d48cb4aaca7)
Browse the repository at this point in the history

* Loading branch information

[![@JohnMertz](https://avatars.githubusercontent.com/u/6070612?s=40&v=4)](/JohnMertz)

[JohnMertz](/MailCleaner/MailCleaner/commits?author=JohnMertz "View all commits by JohnMertz")
committed
Nov 19, 2024

1 parent
[3d1f16d](/MailCleaner/MailCleaner/commit/3d1f16d7e506304cb15872fa1ad900b2f9f4d4ec)

commit 28d913e

 Show file tree

 Hide file tree

Showing
**2 changed files**
with
**32 additions**
and
**1 deletion**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* install

  + install/MC\_rotate\_host\_keys.sh
    [MC\_rotate\_host\_keys.sh](#diff-8f47fdedeec2eafc56c6380de9fa65313983bbc55a52cef4328820d05f5bfb76)
* scripts/installer

  + scripts/installer/installer.pl
    [installer.pl](#diff-f4a8d9bde6af64c4a27a29f98840578d425e2ed323159c4dc3b565398ff51581)

## There are no files selected for viewing

28 changes: 28 additions & 0 deletions

28
[install/MC\_rotate\_host\_keys.sh](#diff-8f47fdedeec2eafc56c6380de9fa65313983bbc55a52cef4328820d05f5bfb76 "install/MC_rotate_host_keys.sh")

Show comments

[View file](/MailCleaner/MailCleaner/blob/28d913eaa044b689eb114f72ebe92d48cb4aaca7/install/MC_rotate_host_keys.sh)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,28 @@ |
|  |  | #!/bin/bash |
|  |  |  |
|  |  | GEN=0 |
|  |  |  |
|  |  | if [[ "$(sha256sum /etc/ssh/ssh\_host\_dsa\_key | cut -d ' ' -f 1)" == "322ccaf54b5169334405c54c1e00edebfa0ca8b67c53603d3af523ae978c81f4" ]]; then |
|  |  | GEN=1 |
|  |  | echo "Disabling default DSA key" |
|  |  | mv /etc/ssh/ssh\_host\_dsa\_key /etc/ssh/.ssh\_host\_dsa\_key.old |
|  |  | mv /etc/ssh/ssh\_host\_dsa\_key.pub /etc/ssh/.ssh\_host\_dsa\_key.pub.old |
|  |  | fi |
|  |  | if [[ "$(sha256sum /etc/ssh/ssh\_host\_rsa\_key | cut -d ' ' -f 1)" == "cf9a7e0cffbc7235b288da3ead2b71733945fe6c773e496f85a450781ef4cf33" ]]; then |
|  |  | GEN=1 |
|  |  | echo "Disabling default RSA key" |
|  |  | mv /etc/ssh/ssh\_host\_rsa\_key /etc/ssh/.ssh\_host\_rsa\_key.old |
|  |  | mv /etc/ssh/ssh\_host\_rsa\_key.pub /etc/ssh/.ssh\_host\_rsa\_key.pub.old |
|  |  | fi |
|  |  | if [[ "$(sha256sum /etc/ssh/ssh\_host\_ed25519\_key | cut -d ' ' -f 1)" == "da41b256dc70344f06bdb6d74245688a941633b5d312aca10895c4f997f35884" ]]; then |
|  |  | GEN=1 |
|  |  | echo "Disabling default ED25519 key" |
|  |  | mv /etc/ssh/ssh\_host\_ed25519\_key /etc/ssh/.ssh\_host\_ed25519\_key.old |
|  |  | mv /etc/ssh/ssh\_host\_ed25519\_key.pub /etc/ssh/.ssh\_host\_ed25519\_key.pub.old |
|  |  | fi |
|  |  |  |
|  |  | if [[ $GEN != 0 ]]; then |
|  |  | echo "Generating new host keys..." |
|  |  | /usr/bin/ssh-keygen -A |
|  |  | echo "You may need to remove the old host keys from the .ssh/known\_hosts file for any client which has previously connected to this machine." |
|  |  | fi |

5 changes: 4 additions & 1 deletion

5
[scripts/installer/installer.pl](#diff-f4a8d9bde6af64c4a27a29f98840578d425e2ed323159c4dc3b565398ff51581 "scripts/installer/installer.pl")

Show comments

[View file](/MailCleaner/MailCleaner/blob/28d913eaa044b689eb114f72ebe92d48cb4aaca7/scripts/installer/installer.pl)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -21,8 +21,9 @@ |
|  |  |  |
|  |  | use strict; |
|  |  |  |
|  |  | my $path; |
|  |  | if ($0 =~ m/(\S\*)\/\S+.pl$/) { |
|  |  | my $path = $1; |
|  |  | $path = $1; |
|  |  | unshift (@INC, $path); |
|  |  | } |
|  |  |  |
| Expand Down  Expand Up | | @@ -51,6 +52,8 @@ |
|  |  | # $mcinstall->do(); |
|  |  | #} |
|  |  |  |
|  |  | system("$path/../../install/MC\_rotate\_host\_keys.sh") if (defined($path)); |
|  |  |  |
|  |  | $dlg->clear(); |
|  |  | exit 0; |
|  |  |  |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `28d913e`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FMailCleaner%2FMailCleaner%2Fcommit%2F28d913eaa044b689eb114f72ebe92d48cb4aaca7) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from www.mailcleaner.net_79eaf765_20250114_182446.html ===

### Forced update of generic SSH host keys

(*Published on 2024-11-18*)

In order to allow immediate SSH access to a new appliance, MailCleaner VA images ship with a generic set of SSH host keys. These keys are the same for every installation. This creates a potential for a man-in-the-middle attack to be able to read SSH session information in plain text if it could intercept the connections using this known set of host keys. Given that the MailCleaner firewall only allows SSH connections from your local IP network by default, this threat should be limited to compromised or malicious devices within the same LAN as your MailCleaner machine(s).

In order to improve security, we have published an update which all MailCleaner machines should install over the next 24 hours. This update will disactivate the generic keys and generate a set of unique keys for your host. The impact of this is that you may be prompted, upon your next login, with a warning that the host keys of the MailCleaner machine have changed. This is to be expected and you can follow the instructions in that prompt to remove the old key from your clients' **.known\_hosts** files, then approve the new key on your next connection.

For future installations, these keys will be rotated during the installation process.

---

### Exim 4.98

(*Published on 2024-07-12*)

A new version of Exim has been published to address a severe [attachment filtering bypass vulnerability](https://bugs.exim.org/show_bug.cgi?id=3099).

As always, your machine should receive the update automatically during the update cycle (either 22:30 on newer machines or 02:30 on older ones). The Update was merged at 19:02 UTC on July 12th. You can check that your machine(s) have received the latest version with:

`/opt/exim4/bin/exim --version`

which should mention '4.98' on the first line of the output. If you don't have this version, it is likely that there is an issue blocking updates which should be available in the output of '/root/Updater4MC/updater4mc.sh' or from '/var/mailcleaner/log/mailcleaner/updater4mc.log.0'.

This update comes bundled with an update to version 10.44 of the PRCE2 library.

---

### Tips to improve deliverability of outgoing messages (esp. Office 365)

(*Published on 2024-04-03*)

Due to some recent changes to Office 365, we have received several reports of mail being relayed outbound through MailCleaner being rejected by that service. This is in addition to several other large mail hosts imposing more strict requirements to verify email legitimacy and security in recent years. These policies apply to all sources of outbound mail, not just MailCleaner, but there are some default configurations which mean that MailCleaner machines are quite likely to be impacted unless specific actions are taken.

If you currently use MailCleaner as an outgoing relay (AKA "SmartHost"), or if you have plans to do so, please read [our guide](https://support.mailcleaner.net/boards/3/topics/106) to ensure that you are setting it up correctly.

Once set up, please see [our other new guide](https://support.mailcleaner.net/boards/3/topics/107) discussing the best practices to ensure that mail being relayed through MailCleaner stands the best chance possible of being delivered to host with even the most strict requirements.

Please open [a support ticket](https://support.mailcleaner.net) if you need any help, or if you continue to face delivery problems. Some problems will be out of our control to resolve, but we can do our best to advise you or point you in the right direction for more help.

---

### Exim 4.97.1

(*Published on 2024-01-13*)

Note: This update is superceded by the update to 4.98. The Updater4MC script will only apply the necessary database changes, but it will not actually install 4.97.1. Details are included here for posterity.

A new version of Exim has been published to address a moderate [spoofing vulnerability](https://seclists.org/oss-sec/2023/q3/254).

As always, your machine should receive the update automatically during the update cycle (either 22:30 on newer machines or 02:30 on older ones). The Update was merged at 20:05 UTC on February 13th. You can check that your machine(s) have received the latest version with:

`/opt/exim4/bin/exim --version`

which should mention '4.97.1' on the first line of the output. If you don't have this version, it is likely that there is an issue blocking updates which should be available in the output of '/root/Updater4MC/updater4mc.sh' or from '/var/mailcleaner/log/mailcleaner/updater4mc.log.0'.

One important note is that as of version 4.97, exim now uses longer Exim IDs. Extensive testing of accommodations for these longer IDs was done over the last several weeks, but it is possible that something was missed. If you see any problem with indexing or managing of quarantined items, please [open a ticket](https://support.mailcleaner.net) or alert us with [a GitHub issue](https://github.com/MailCleaner/MailCleaner/issues) immediately.

---

### Exim 4.96.2 and patches to libspf2

(*Published on 2023-10-23*)

Note: This update is superceded by the update to 4.97.1. The Updater4MC script to install 4.96.2, specifically, has been removed. Details are included here for posterity.

As mentioned in a previous update, [a series of vulnerabilities in Exim 4.96 were made public](https://seclists.org/oss-sec/2023/q3/254). We have now published 4.96.2 to our repositories, along with patches to libspf2 to address the remaining vulnerabilities.

As always, your machine should receive the update automatically during the update cycle (either 22:30 on newer machines or 02:30 on older ones). The Update was merged at 22:25 UTC on October 23rd. You can check that your machine(s) have received the latest version with:

`/opt/exim4/bin/exim --version`

which could mention '4.96.2' on the first line of the output. If you don't have this version, it is likely that there is an issue blocking updates which should be available in the output of '/root/Updater4MC/updater4mc.sh' or from '/var/mailcleaner/log/mailcleaner/updater4mc.log.0'.

---

### Change to version numbering

(*Published on 2023-10-12*)

A change has recently been made to the version numbering that you will see in the Administrator web interface, within the SMTP banner, and within SNMP queries. This is an enhancement to provide more meaningful information about the update status of the machine. Historically, the 'Version' and 'Patch level' have been redundant, with the later being a somewhat more precise version of the former (eg. '2023-10' vs. '2023101201'). Now, the 'Version' will adopt the more precise format and the 'Patch level' will follow the format: <Updater4MC level>-<MC Git commit> (eg. as of this update, it should be '83-1d7f248').

Internally, only the 'Version' has been changed. However, for what is most intuitive to users, the labels for these values have been swapped in the web interface. This means the values mentioned above are actually swapped when querying the SNMP interface, and the newly formatted value is visible in the SMTP banner.

This change should have very limited impact for most users, except those who might have an SNMP agent tracking their system's update status. The advantage to this change is that the publicly visible version now provides meaningful information. It is sometimes the case that specific updates will fail, or custom changes within the MailCleaner Git tree ('/usr/mailcleaner/') will conflict and block updates. This more meaningful number will allow for features to be more easily added to alert administrators to failed or available updates. It will also allow MailCleaner staff to monitor Enterprise Edition machines and provide proactive support.

If you have disabled automatic updates, you may wish to hide your version from the public SMTP banner. This is now possible by creating the file '/var/mailcleaner/spool/mailcleaner/hide\_smtp\_version' then restarting the Incoming MTA. This file must be created on each node of a cluster.

Note: Since part of the mechanism for this change is applied within the Updater4MC update script, it will actually take a second update for the new version to be applied. This means that most users will see the new format on 2023-10-14. In the meantime, a less meaningful version with the Updater4MC Git commit instead of the actual successfully installed update level may be shown (eg. 8715121.1d7f248).

---

### Exim 4.96.1

(*Published on 2023-10-02*)

Note: This update is superceded by the update to 4.96.2. The Updater4MC script to install 4.96.1, specifically, has been removed. Details are included here for posterity.

Recently, [a series of vulnerabilities in Exim 4.96 were made public](https://seclists.org/oss-sec/2023/q3/254). The most critical of these CVEs were patched quickly and MailCleaner followed up by compiling a patched version of our custom Exim package. Your machine should have received the update automatically during the update cycle (either 22:30 on newer machines or 02:30 on older ones) following 01:45 UTC on October 2nd.

A follow up version is expected in the near future to resolve the remaining, less critical, issues. We will compile and release this version as soon as it is made available by the Exim team. In the meantime, you can check that your machine(s) have received the latest version with:

`/opt/exim4/bin/exim --version`

which could mention '4.96.1' on the first line of the output. If you don't have this version, please feel free to [open a ticket](https://support.mailcleaner.net) immediately. You can also find details on why the update is being blocked by manually running updates again '/root/Updater4MC/updater4mc.sh' or by checking the previous update log from '/var/mailcleaner/log/mailcleaner/updater4mc.log.0'. Any problem with this update will also block the upcoming update as well, but with a successful update, you should expect the next update to work well also.

---

### Exim 4.96

(*Published on 2022-08-24*)

Note: This update is superceded by the update to 4.96.1. The Updater4MC script to install 4.96, specifically, has been removed. Details are included here for posterity.

Recently, a new release of MailCleaner's MTA, Exim, was published and pushed to all MailCleaner machines using the regular Updater4MC script. There are a couple of points to note about this upgrade.

This resolved several vulnerablities, including problems in LibSPF2 and Exim itself.

This intruduces support for [ARC](https://en.wikipedia.org/wiki/Authenticated_Received_Chain).

The upgrade was not entirely smooth. There was an issue related to some mail from Microsoft clients. You can read more about this issue, how it was remedied and additional options to deal with this problem [here](https://support.mailcleaner.net/boards/3/topics/103-smtp-long-lines). As long as you are up-to-date, this issue no longer exists.

Your machine may not have installed the upgrade. There should be a watchdog called 'detect\_exim\_current' which should tell you if your machine has failed to update. If this is the case, you can check your latest update attempt from '/var/mailcleaner/log/mailcleaner/updater4mc.log.0' or run '/root/Updater4MC/updater4mc.sh' to see the output. This should mention a modified file or other issue which is preventing the upgrade. See the previous InfoBox notice from 2021-05-17 for more information since the update procedure is the same.

---

### ClamAV 0.103.5

(*Published on 2020-03-01*)

As of the next nightly update after this post, all Mailcleaner machines will update ClamAV to 0.103.5. This will:

* Enable updating with latest signatures using `freshclam`
* Upgrades libprce2 library to enhance security
* Changes to run permissions and options to optimize performance and security globally

---

### Block .xlsb files

(*Published on 2021-11-02*)

Block .xlsb files

---

### Upgrade for vulnerable Exim package

(*Published on 2021-05-17*)

Note: This update is superceded by the update to 4.96. The Updater4MC script to install 4.94, specifically, has been removed. Details are included here for posterity.

Warning: There have recently been disclosures made for several critical vulnerabilities with the Exim MTA which is used in MailCleaner. In addition to patching these vulnerabilities, there have been additional changes to the intervening versions of Exim which have required some changes to the configuration templates used in MailCleaner to prevent other mail delivery issues. After carefully testing these changes we have now made a new version of the package available. This should be automatically installed during the first nightly update after this notice.

However, to ensure a safe upgrade without any of the delivery issues mentioned, the automatic upgrade will refuse to proceed if either 1) the new template files are not yet present or 2) if you have made modifications to the template files which will fail to be automatically replicated to the new templates. The upgrade will retry nightly until the new version is installed. To verify that the upgrade was successful, you can check the current version (looking for 4.94), by running:
```
/opt/exim4/bin/exim --version | head -n 1
```

If you are not already on this version, please only attempt the upgrade using the official installation script since manually installing the package may result in incompatible configuration templates being used:
```
/root/Updater4MC/updater4mc.sh
```

Monitor for the progress immediately following "Executing update: /root/Updater4MC/updates/62\_mc\_exim\_4.94.update" and follow up by checking the version again to be sure. If the upgrade is abandoned, the relevant error will be printed. This will be either that your Git tree is behind, meaning that you don't have the new templates, or that you need to ensure that the changes from your old templates have been ported correctly. In the latter case, you can run the update script manually - after you have replicated your customizations - to force the upgrade:
```
/root/Updater4MC/updates/62_mc_exim_4.94.update --force
```

We will be monitoring Enterprise customers over the following days and weeks to ensure full uptake of this update.

---

### Hostlist Entry Formatting

(*Published on 2021-02-22*)

You can now use the SPF od a domain to whtielist / blacklist corresponding IPs.

Please check [this Knowledge Base](https://support.mailcleaner.net/boards/3/topics/94-hostlist-entry-formatting%22) to know more about it

---

### SpamC scores adaptation at domain level

(*Published on 2021-02-22*)

To give you more control on the filtering rules, you can now adapt the scores per rule per domain (and even per user if needed)

Find more in [this Knowledge Base](https://support.mailcleaner.net/boards/3/topics/93-spamc-score-adaptation)

---

### Whitelists are now applied before blacklists

(*Published on 2021-01-26*)

Whitelists will be applied before blacklists from now on.
 This will allow end users to whitelist john.doe@example.org while the domain example.org is blacklisted.

---

### SpamC scores modification

(*Published on 2020-12-28*)

A wave of mails with almost no text in the body, a PDF attachment coming from [freemails](https://support.mailcleaner.net/boards/3/topics/91-freemail) has been reported.

To stop this, we added 2.0 points to mails coming from freemails with a .doc or .pdf attached. (rule : T\_FREEMAIL\_DOC\_PDF)

We also added more rules about PDF attachments.

For this specific wave, the main rule is PDF\_TEXT\_RATIO

This rule is also worth 2.0 points.

For now those mails should have their score raised by 4.0 splitted in 2 rules to try to prevent false positives.

[As always, you can create/modify rules (based on that one for the ratio)](https://support.mailcleaner.net/boards/3/topics/51-how-to-create-custom-spamc-rules).
If so, please let me know, this can be useful for other customers of ours and we would then backport your modification in the main MailCleaner s tree.

As we dont face those spams on our own cloud, we are willing to adapt those rules according to your feedbacks, so dont hesitate to open a ticket if this led you to false positives or if you think we should increase/modify our scores. (The rule PDF\_TEXT\_RATIO is based on a ratio so if it is not triggered it may be due to a ratio above the one we picked, you are very welcome to report this as well)

Note : This will automatically update on your servers at 22:30 you can have this live before by running
```
/root/Updater4MC/updater4mc.sh
```

on all your hosts.

---

### Reject domains using capital letters

(*Published on 2020-10-03*)

We straighten some of our anti spoofing measures as we currently want to focus in blocking more phishing mails.
We decided to block the use of capital letters in the domain names of the sender s of a mail
As this increases the security of all end users, we decided to enable it by default.
You can find everything you need to know about this new feature in this **[Knowledge Base](https://support.mailcleaner.net/boards/3/topics/87-reject-domains-containing-capital-letters)**

---

### Fail2Ban integrated into MailCleaner

(*Published on 2020-06-04*)

As announced in our last Newsletter, fail2ban is now integrated in MailCleaner.
For now, it is disabled by default.
You can find everythin you need to know about this new feature in this **[Knowledge Base](https://support.mailcleaner.net/boards/3/topics/80-fail2ban)**

---

### Log mails subjects and/or attachments names

(*Published on 2020-03-31*)

You can now log mails subjects and/or attachments names for the Tracing Tool with the new options

**Configuration-> SMTP-> Include mails subjects in the logs**

**Configuration-> SMTP-> Include attachement names in the logs**

[More informations here](https://support.mailcleaner.net/boards/3/topics/79-log-mails-subjects-and-or-attachments-names)

---

### Per domain IP white/black -lists

(*Published on 2020-03-16*)

You can now whitelist or blacklist IPs or subnets per Domains via Configuration->Domains->Advanced Features.
These white/black lists will be effective either at SMTP or SpamC stage.

---

### Now blocking Wav files per default

(*Published on 2019-10-20*)

Wav files have been found susceptible to contain viruses or crypto miners recently, therefore those filenames are now blocked by default.
You can change this in

**Configuration->Content Protection->Attachment name**

[More informations here](https://www.bleepingcomputer.com/news/security/attackers-hide-backdoors-and-cryptominers-in-wav-audio-files/)

---

### ClamAV and ClamSpam updates

(*Published on 2019-10-02*)

ClamAV and ClamSpam were updated to the latest stable version : 0.101.4.

---

### [Exim - New CVE-2019-16928] Information

(*Published on 2019-10-01*)

We upgraded to the latest exim available.
Here is the related CVE [CVE-2019-16928](https://www.exim.org/static/doc/security/CVE-2019-16928.txt)

---

### Wave of infected documents with macros

(*Published on 2019-09-24*)

We currently see (since a few days) a wave of spams containing infected documents with macros.
We strongly encourage to use our Anti-Macro feature. This is currently not accessible from the web interface
This can be enabled by simply creating this file on each of your nodes and restarting clamav with **/usr/mailcleaner/etc/init.d/clamd
restart** or via **Monitoring > Status** in admin interface:
```
 touch /var/mailcleaner/spool/mailcleaner/mc-experimental-macros
```
When the wave is over, if you want to disable this feature, you ll need to run
```
 rm /var/mailcleaner/spool/mailcleaner/mc-experimental-macros
```
on all nodes and restart the services as described above.

**Warning:** Enabling this feature will cause all documents embedding macros to be dropped (including Office documents with macros) ! No recovery possible (SMTP stage) !

---

### [Exim - New CVE-2019-15846] Information

(*Published on 2019-09-12*)

We upgraded to the latest exim available.

---

### [Exim - New CVE-2019-13917] Information

(*Published on 2019-07-25*)

Dear customers, we wanted to inform you that MailCleaner is **NOT** vulnerable to the new CVE-2019-13917. Although we are using version 4.92 of the Exim package, this vulnerability can only be exploited under certain conditions that are not possible by default in MailCleaner.

However, as a precaution, we will in the coming days update the package.

Here is the related CVE [CVE-2019-13917](https://www.exim.org/static/doc/security/CVE-2019-13917.txt)

---

### [Exim - Security Fix] Automatic upgrade to Exim 4.92

(*Published on 2019-06-11*)

Due to the latest CVE revealed for Exim, we automatically upgraded your Exim package to the version 4.92. Your Exim version is no longer vulnerable to the CVE [CVE-2019-10149](https://www.exim.org/static/doc/security/CVE-2019-10149.txt)

---

### [Bug Fix] Fixed SpamC score persistence and display for user quarantine

(*Published on 2019-04-29*)

When a user open mail traces in his quarantine, the SpamC score isn't correctly displayed because of a bad persistence.

---

### [Improvment] Exception list for SPF and DMARC checks at SMTP stage

(*Published on 2019-04-24*)

This feature will be available at Configuration->SMTP->Don't check these hosts for SPF or DMARC

---

### [Bug Fix] Text over-written in filter adjustment reports

(*Published on 2019-02-19*)

When you request a filter adjustment from the MailCleaner email reports, the last line is over-written. Fixed it.

**Warning:** if you're using a custom template for the summary, please update it by copying the unlogged.css of the default template to your custom template.

---

### [Bug Fix] Web interface System Sender address

(*Published on 2019-02-19*)

Fixing a little bug which create confusion. By default, the System Sender address is displayed in lower case even on the web interface even if the value in database are case sensitive.

---

### [Bug Fix] MailCleaner internal updates

(*Published on 2019-02-15*)

Fixing a bug which didn't restart MailCleaner services every time when related data are updated.

---

### [Improvement] Update the TLD list

(*Published on 2019-02-12*)

Update of the TLD list used by MailCleaner services.

---

### [Improvement] Added MailCleaner script for installing options

(*Published on 2019-02-11*)

Bug fix for avoiding errors when the stage4 is rebooting for sending the summaries.

See the [Knowledge Base](https://support.mailcleaner.net/boards/3/topics/62-installation-of-mailcleaner-options).

---

### [Bug Fix] : Avoid exim\_stage4 errors

(*Published on 2019-02-05*)

Bug fix for avoiding errors when the stage4 is rebooting for sending the summaries.

---

### Password protected archives : Manage a whitelist

(*Published on 2019-01-03*)

You now can whitelist domains for the feature : Password protected archives. Please read the
[Password protected archives : Manage a whitelist](https://support.mailcleaner.net/boards/3/topics/61-password-protected-archives-manage-a-whitelist)
knowledge base about this.

---

### [Bugfix] Security fix on tracing

(*Published on 2019-01-03*)

Fix a security issue: a remote code execution on the tracing section.

---

### [Improvement] Update of MailCleaner's bayesians

(*Published on 2018-12-08*)

We have just updated the bayesians of NiceBayes and SpamAssassin.

---

### [Anti-virus] Virus reporting

(*Published on 2018-12-05*)
To report a virus that did not get detected by MailCleaner,
report the email to virus@mailcleaner.net, as described in the [Wrong
analysis reporting](https://support.mailcleaner.net/boards/3/topics/17-how-to-report-a-wrong-analyze) knowledge base

---

### [SpamAssassin] Filtering rules

(*Published on 2018-11-06*)
Added multiple filtering rules in SpamAssassin to prevent spam and phishing waves

---

### [Bugfix] XSS Breach

(*Published on 2018-10-26*)
Fixed a XSS breach that allowed for code injection in the login page

---

### [Improvement] Watchdog

(*Published on 2018-10-08*)
Added three watchdog which will warns us when more than 85% of inodes are used, more than 85% of disk is used and if there are too much mails in mail queues.

---

### [Improvement] Infobox

(*Published on 2018-10-01*)
Added a timeout protection for the infobox and changed the source content.

---

### [Improvement] Lockfiles

(*Published on 2018-09-30*)
Added a LockFile system.

---

### [Improvement] IPv6

(*Published on 2018-09-20*)
Enable IPv6 in Exim only when an ethX interface support it.

---

### Servers unavailability

(*Published on 2018-09-18*)

An upgrade from our ISP forces the connection to most of our servers to be down for about 20 minutes.
The external servers should take the hand for that time and this operation should not impact your machines.
In case you observe messages piling up in the queues, this will be due to an overload of those machines, which
will resolve within an hour.

Sorry for the inconvenience.

---

### [Improvement] Update of MailCleaner's bayesians

(*Published on 2018-09-07*)

We have just updated the bayesians of NiceBayes and SpamAssassin.

---

### [Bug Fix] Use english as default summary language

(*Published on 2018-08-30*)

Sometimes, the user interface is translated but not the corresponding summary and vice-versa. Thus, we use english as the default summary language.

---

### [Improvement] Root server list update

(*Published on 2018-08-22*)

The root server list for bind is now updated on a daily base.

---

### [Improvement] Languages support

(*Published on 2018-08-16*)

Add support for new languages through Weblate <https://www.mailcleaner.org/translations/>.

[2018-08-20 11h43] Bug fix

---

### [Improvement] Kaspersky

(*Published on 2018-08-06*)

Add Kaspersky support by default (for a better integration).

---

### [Bug Fix] Watchdog modules

(*Published on 2018-07-31*)

We just fixed some watchdog modules and added a new one for monitoring better your MailCleaner's services.

---

### [Improvement] Newsletters and whitelists

(*Published on 2018-07-27*)

It is now possible to have both a whitelist and a newsletter address for the same sender and recipient.

---

### [Improvement] Newsletters whitelist

(*Published on 2018-07-25*)

A lot of our customers would have prefered Newsletter feature to work both on envelop and body senders. We changed this point to meet your expectations.
In addition to that, now, when you accept a newsletter, both sender and from addresses are added to the newsletter whitelist.

---

### [Feature] Newsletters management interface

(*Published on 2018-07-11*)

Management of the accepted newsletters at the user, domain and global level.

---

### [Bug fix] IPv6 conditional deactivation

(*Published on 2018-07-11*)

Disabling automatically IPv6 when not configured on the machine.

---

### [Internal] Improving whitelist globbing

(*Published on 2018-07-11*)

Improving pattern matching when parsing the whitelist, blacklist, newsletters lists and warnlists.

---

### [API] API Improvement

(*Published on 2018-07-09*)

Added `user/allow_newsletters` to the REST API.

---

### [Internal] Update SSH keys

(*Published on 2018-07-09*)

We removed some internal SSH keys for security reasons.

---

### [Improvement] First start update

(*Published on 2018-06-26*)

Improving the first startup of a VA, upgrading it at first start when internet access is available.

---

### [Bug fix] SOAP and Exim

(*Published on 2018-06-07*)

We just fixed a bug concerning the newsletter SOAP interface. We also fixed a bug for the field Don't check these hosts when inserting IPv6.

---

### [Bug fix] REST API

(*Published on 2018-05-22*)

We recently fixed a bug with the REST interface in the User/Add function.

---

### [Bug fix] Updater4MC

(*Published on 2018-05-11*)

Due to a recent bug discovered we fixed the Updater4MC concerning the update of the patch level.
We also removed some internal SSH keys for security reasons.

---

### [Bug fix] Newsletter

(*Published on 2018-05-01*)

We recently fixed a bug concerning the newsletter. In some specific cases, accepting a newsletter was causing an unhandled exception.
We also removed some internal SSH keys for security reasons.

---

### New InfoBox by administrators for administrators

(*Published on 2016-11-05*)

We decided to publish this InfoBox in which we will communicate about important informations. Thank you for consulting this section regularly.



=== Content from github.com_16a0e06a_20250114_182445.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FMailCleaner%2FMailCleaner%2Fwiki%2FWatchdogs)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FMailCleaner%2FMailCleaner%2Fwiki%2FWatchdogs)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fwiki%2Fshow&source=header-repo&source_repo=MailCleaner%2FMailCleaner)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[MailCleaner](/MailCleaner)
/
**[MailCleaner](/MailCleaner/MailCleaner)**
Public

* [Notifications](/login?return_to=%2FMailCleaner%2FMailCleaner) You must be signed in to change notification settings
* [Fork
  35](/login?return_to=%2FMailCleaner%2FMailCleaner)
* [Star
   92](/login?return_to=%2FMailCleaner%2FMailCleaner)

* [Code](/MailCleaner/MailCleaner)
* [Issues
  9](/MailCleaner/MailCleaner/issues)
* [Pull requests
  1](/MailCleaner/MailCleaner/pulls)
* [Actions](/MailCleaner/MailCleaner/actions)
* [Projects
  0](/MailCleaner/MailCleaner/projects)
* [Wiki](/MailCleaner/MailCleaner/wiki)
* [Security](/MailCleaner/MailCleaner/security)
* [Insights](/MailCleaner/MailCleaner/pulse)

Additional navigation options

* [Code](/MailCleaner/MailCleaner)
* [Issues](/MailCleaner/MailCleaner/issues)
* [Pull requests](/MailCleaner/MailCleaner/pulls)
* [Actions](/MailCleaner/MailCleaner/actions)
* [Projects](/MailCleaner/MailCleaner/projects)
* [Wiki](/MailCleaner/MailCleaner/wiki)
* [Security](/MailCleaner/MailCleaner/security)
* [Insights](/MailCleaner/MailCleaner/pulse)

# Watchdogs

[Jump to bottom](#wiki-pages-box)

John Mertz edited this page Nov 28, 2024
·
[6 revisions](/MailCleaner/MailCleaner/wiki/Watchdogs/_history)

MailCleaner has a number of Watchdogs which report common errors to to the system administrator via an optional [`Home->System warnings`](https://github.com/MailCleaner/MailCleaner/wiki/Administrator-Interface#System-warnings) field which will appear if any problems exist, and via e-mail during the [`Configuration->General settings->Periodic tasks->Run daily tasks at`](https://github.com/MailCleaner/MailCleaner/wiki/Administrator-Interface#Periodic-tasks) time, if you have configured a [`Configuration->General settings->Defaults->System support address`](https://github.com/MailCleaner/MailCleaner/wiki/Administrator-Interface#Defaults).

If you are using MailCleaner Enterprise Edition, these reports will also be sent to MailCleaner so that our staff can periodically review the warnings on your behalf. Note that there are also a few extra watchdogs that are only included with Enterprise Edition.

Below are a list of the current Watchdogs as well as recommendations on the possible resolutions.

Notes:

* many of the watchdogs that are specifically checking a daemon's status by monitoring the current day's logs. If you fix a problem, this may not be noticed until the next day when no errors remain in the current log file.
* At most the watchdog reporting is only generated every 15 minutes, so you will not see them immediately disappear.
* If you would like to refresh all of the watchdogs immediately, you can use:  `/usr/mailcleaner/bin/watchdog/watchdogs.pl All ; /usr/mailcleaner/bin/watchdog/watchdogs_report.sh`
* If you do not care about a particular watchdog, it can be disabled to avoid future alerts by creating a `.disabled` file in the watchdog configuration directory like: `touch /usr/mailcleaner/etc/watchdog/MC_mod_detect_F2B.disabled`

## detect\_bad\_DKIM.pl

This indicates an issue with one of the DKIM keys on your machine.

**Note: This watchdog is brand new and an exception was not made for a blank version of the 'default.pkey' file. If you have an 'invalid' message for this key file, check to see if that file is blank before reading further:**

```
cat /var/mailcleaner/spool/tmp/mailcleaner/dkim/default.pkey

```

**If it is, you can ignore the warning for that file. This watchdog will be patched shortly to ignore a blank version of this file if you have not yet generated one.**

One or both of the following issues can appear:

* Short DKIM key length:

The first indicates that those keys are shorter than 1024 bits which is the recommended standard. Some services are beginning to reject, ignore, or otherwise penalize messages signed with an out-dated (short) key. To resolve this issue for 'default.pkey' you need to generate a new key with:

```
Configuration->SMTP->DKIM->Generate new private key...

```

For any domain-specific key you need to generate a new one from:

```
Configuration->Domains->[select domain]->Outgoing Relay->Generate new private key...

```

* Invalid DKIM key:

This error indicates that the private key file cannot actually be read/decoded by OpenSSL. The files are located in the directory:

```
/var/mailcleaner/spool/tmp/mailcleaner/dkim/

```

You can see what OpenSSL sees by running:

```
openssl rsa -in /var/mailcleaner/spool/tmp/mailcleaner/dkim/<domain.pkey> -noout -text

```

The Watchdog is specifically looking for the line containing:

```
Private-Key: (**N** bit)

```

where **N** is the length. If you see this error, it is likely that OpenSSL will output an error, having not read the key at all. Otherwise, it is possible that the output does not include this line, but this is not a case that is known to us. You will probably need to generate a new key as described in the other case.

## detect\_bad\_git.sh

This indicates that the last time the automatic update script (/root/Updater4MC/updater4mc.sh) ran, it exited with an error showing that the Git repository couldn't be synced due to local corruption. You can try to diagnose the issue by moving to the MailCleaner repository and checking the status and/or attempting to pull changes:

```
cd /usr/mailcleaner
git status
git pull

```

## detect\_Community (Enterprise only)

This test simply reports whether the version of the host is seen to be Community. This watchdog is only downloaded when a machine is registered for Enterprise and will report if the machine that had been registered now appears to be using Community. Some events, such as running a 'reset' on the Git tree can cause a registered appliance to revert to Community.

If you believe the appliance should still be registered, log in to the web interface of the affected host and use the Configuration->Base System->Registration form to register the host again. If this does not resolve the issue, you can contact support.

If you intentionally unregistered the appliance, it is possible that this script failed to be removed. You can simply delete the script and its configuration file:

```
rm /usr/mailcleaner/bin/watchdog/MC_mod_detect_Community.sh /usr/mailcleaner/etc/watchdog/MC_mod_detect_Community.conf

```

## detect\_F2B

This indicates that either the Fail2Ban server is not running at all, or there are too many processes running (ie. there is not exactly 1). The former is much more likely. You can start it with:

```
/usr/mailcleaner/etc/init.d/fail2ban start

```

We are working on a solution to automatically start the service if it is not currently running. In the unlikely case that there are multiple fail2ban processes running, using 'restart' instead of 'start' should kill all of them and start only one.

## detect\_license\_Kaspersky

Checks to see if the Kaspersky license is expired, if installed. Contact your sales representative if your license has expired. If you trialled Kaspersky or used it for a time but no longer wish to use it you can uninstall the package with:

```
apt-get remove kaspersky-64-2.0

```

## detect\_msg\_sniffer\_db

Searches for MessageSniffer logs without a current database.

If you are still subscribed to MessageSniffer, re-download with:

```
cd /opt/messagesniffer/share/snf-server
wget http://www.sortmonster.net/Sniffer/Updates/`echo "select licenseid from MessageSniffer;" | mc_mysql -m mc_config | tail -n 1`.snf --user=sniffer --password=ki11sp8m

```

If you are no longer subscribed to messagesniffer, uninstall the package and remove from the database:

```
apt-get remove mc-messagesniffer
echo "delete from prefilter where name = 'MessageSniffer'; delete from MessageSniffer;" | mc_mysql -m mc_config

```

In either case, restart mailscanner:

```
/usr/mailcleaner/etc/init.d/mailscanner restart

```

## detect\_PrefTDaemon

Checks for redundant PrefTDaemon processes

Restart the Preferences daemon to kill any orphaned processes. This can be done from Monitoring->Status (you will need to expand the Status column with "Show more..."), or with the command:

```
/usr/mailcleaner/etc/init.d/preftdaemon restart

```

NOTE: An update to the init scripts should have removed the chance of seeing this error during normal operation. If you are regularly seeing this watchdog it is likely that your system has not fully updated.

## detect\_pyenv\_install.sh

Detects the unsuccessful installation of the new Python libraries being used to develop new tools. These libraries are not yet used for any component of the system other than Fail2Ban, so it is not critical to fix at this time. We will monitor the reports that we receive as it nears broader usage.

If you would like to try installing these libraries manually to remove the error, you can do so with:

```
/usr/mailcleaner/install/install_pyenv_3-7-7.sh
pip3 install --upgrade pip
pip3 install mailcleaner-library==1.0.2 --index https://repository.mailcleaner.net/python/ --extra-index https://pypi.org/simple/

```

Start Fail2Ban to confirm that this was successful ('ok' means success, even if there are warnings):

```
/usr/mailcleaner/etc/init.d/fail2ban start

```

If successful, remove the log that originally spawned this watchdog:

```
rm /var/mailcleaner/log/mailcleaner/install_pyenv.log

```

## detect\_Spam\_Handler

Checks for redundant Spam\_Handler processes

Restart the SpamHandler daemon to kill any orphaned processes. This can be done from Monitoring->Status (SpamHandler is identified as "Filtering Engine"), or with the command:

```
/usr/mailcleaner/etc/init.d/spamhandler restart

```

NOTE: An update to the init scripts should have removed the chance of seeing this error during normal operation. If you are regularly seeing this watchdog it is likely that your system has not fully updated.

## detect\_StatsDaemon

Checks for redundant StatsDaemon processes

Restart the StatsDaemon to kill any orphaned processes. This can be done from Monitoring->Status, or with the command:

```
/usr/mailcleaner/etc/init.d/statsdaemon restart

```

NOTE: An update to the init scripts should have removed the chance of seeing this error during normal operation. If you are regularly seeing this watchdog it is likely that your system has not fully updated.

## detect\_Summaries

Reports an inability for the summaries to be sent due to an inability to connect to the database on the previous day. This normally indicates that the Summaries have conflicted with a MailCleaner restart. This will happen if the summaries are sent too soon after the nightly updates at 10:30pm, or if they are still running prior to the updates. Consider changing the daily task timing from Configuration->General Settings->Periodic Tasks.

## detect\_unsync\_git

Less severe than detect\_bad\_git. This simply reports that there is something in your Git tree that has diverged from origin/master. This will happen if you or a MailCleaner staff member is testing experimental commits or making other changes that have been commited but not merged upstream. You will have to navigate to /usr/mailcleaner and reset the tree to match origin/master for this to disappear.

## disk\_full

Reports if the / or /var partitions are over 85% used.

You may choose to clear space, reduce the retention time for quarantined items, or increase the size of your disk.gg

## disk\_full\_inodes

Same as previous except that it is based on the inode count (available unique files) instead of the actual bytes used.

## exim\_4.92

This watchdog should be deprecated. So long as your machine is fully up-to-date, this can only mean that it apparently failed to be removed from your appliance. Simply remove it with:

```
rm /usr/mailcleaner/bin/watchdog/MC_mod_exim_4.92.sh /usr/mailcleaner/etc/watchdog/MC_mod_exim_4.92.conf

```

## exim\_4.94

This watchdog should also be deprecated. Upon updating for Exim 4.96, the name of the watchdog was changed to exim\_current, see below. If you still see this error your machine needs to be updated.

## exim\_current

Checks to make sure that you are using the latest supported version of Exim.

There must be something blocking your update. Run `/root/Updater4MC/updater4mc.sh` and watch the output, or check the output from the last automatic attempt in `/var/mailcleaner/log/mailcleaner/updater4mc.log.0`. It will include detailed instructions. Usually this will look like:

```
ATTENTION: Cannot install Exim 4.98

Your existing exim configuration template{s):

  /usr/mailcleaner/etc/exim/exim_stage1.conf_template_4.97

contain modifications.

The modifications will not be carried over to the new template files automatically.

Please port your modifications to version of each of these files ending in '_4.98' or confirm that you are okay abandoning these modifications.

Once you are statisfied with the state of the '_4.98' templates run the following to force this update:

  bash /root/Updater4MC/updates/91_mc_exim_4.98.update --force

```

Follow those instructions, or roll back your customizations and run Updater4MC again.

## git\_conflicts

The last automatic update was unable to pull changes to the git tree because there are conflicting changes that could not be stashed and restored. This is probably because you've modified files that have since been changed upstream. Manually resolving the merge conflict is generally the only solution. You can find which files cause the issue from the last update log (/root/Updater4MC/updater\_.log) which should contain:

```
error: The following untracked working tree files would be overwritten by merge:

```

followed by the list of files. Once these files are known, you can use the 'git diff' command to find out what changes you made:

```
cd /usr/mailcleaner
git diff path/to/file

```

You can then reset this file(s):

```
git reset -- path/to/file

```

then try manualy running the updater again:

```
/root/Updater4MC/updater4mc.sh

```

and reapply your modifications to the updated file, if possible/necessary.

## host\_keys

In order to allow immediate SSH access to a new appliance, MailCleaner VA images ship with a generic set of SSH host keys. These keys are the same for every installation. This creates a potential for a man-in-the-middle attack to be able to read SSH session information in plain text if it could intercept the connections using this known set of host keys. Given that the MailCleaner firewall only allows SSH connections from your local IP network by default, this threat should be limited to compromised or malicious devices within the same LAN as your MailCleaner machine(s).

These keys should be rotated out for a unique set on your appliance by patch '92', so if you are seeing this watchdog, it appears that your machine has not yet installed that update successfully, or the change was reverted.

You can resolve this by running the following on all of your machines:

```
rm /etc/ssh/ssh_host_*
ssh-keygen -A

```

Note: You may find that the `-A` flag is not supported by your version of `ssh-keygen`. If this is the case, you will need to run:

```
apt-get update
apt-get dist-upgrade -y

```

then try again.

An impact of this is that you will be prompted, upon your next login, with a warning that the host keys of the MailCleaner machine have changed. This is to be expected and you can follow the instructions in that prompt to remove the old key from your clients' .known\_hosts files, then approve the new key on your next connection.

## Internal\_keys

Reports missing or excessive internal keys in /root/.ssh/authorized\_keys

You can generate, propagate and install missing keys with: /usr/mailcleaner/bin/internal\_access -gpi

If there are multiple, you should clean all but the last 'mailcleaner-internal' from /root/.ssh/authorized\_keys

Warning: Making these changes can cause you to lose access to the appliance, so be careful that you take a backup of the file first and ensure that connections can still be established before logging out of the existing session.

## modified\_exim1

Checks for modifications to: /usr/mailcleaner/etc/exim/exim\_stage1.conf\_template

Historically many clients have customized this template in order to change Exim settings not available in the UI. Unfortunately, this file is tracked by Git, so changes would be overwitten any time that an upstream change to the file was published. This alert allows us to know who will be impacted by an upstream change.

Currently, this customization is rarely necessary as there are dedicated files to hold customization to all of the most frequently modified settings in the /usr/mailcleaner/etc/exim/stage1 directory. These will not be overwritten since the upstream copy should never change.

## nb\_mails\_in\_queue

Reports when there are a greater number of messages in each of the Exim queues than are expected during normal operation. Reasons for queuing vary. Open the queued item list from Monitoring->Status by clicking on the queue count. If the issue is resolved, you can try to flush the queue directly:

<https://support.mailcleaner.net/boards/3/topics/49>

If you have several machines and only one with a backlog, you may wish to temporarily stop the Inbound MTA on that machine until it clears.

## port\_25\_relay

There are 2 errors you will see for this report:

* "Port 25 authentication is open (not used today)"

This simply indicates that SMTP authentication has not been strictly prohibited on port 25, but this is not being actively used. Best practice is to disable authentication on this port, but it is enabled by default to support legacy installations. You can disable this setting from:

```
Configuration->SMTP->SMTP Checks->Block authenticated relaying on port 25

```

* "Port 25 authentication is in use ( occurences)"

This indicates that not only is port 25 authentication enabled, but you have users who are successfully using this port for authenticated relaying. Best practice would be to locate who by searching for:

```
"Accepting authenticated session from .* on port 25"

```

in:

```
/var/mailcleaner/log/exim_stage1/mainlog

```

have those users change to port 587, then close the port as mentioned above when there are no more users on port 25.

## slave\_status

Checks if the Slave DB is in sync. This can happen for a number of reasons during normal operations. The database syncronization has been updated to automatically restore itself during the main Cron tasks. If you see this persist, you can manually run the resync command:

```
/usr/mailcleaner/bin/resync_db.sh

```

It is likely that you will be told that the DB is already synced, indicating that this was one of the transient issues mentioned.

## TesseractOcr (Not yet implemented)

Checks to ensure that TesseractOcr dependencies have been installed. These will be necessary when the TesseractOcr module is added to SpamAssassin. The dependencies require about 250MB, so the upgrade is scheduled to avoid installing them if there won't be room to spare.

Check do see available disk space:

df -h /

If you have at least 400MB, you can install the dependencies manually:

apt-get install tesseract-ocr libopencv-dev libswitch-perl

## Updater\_Status

Reports troubles with last automatic update. Will report

* if the update exited unsuccessfully
* if the main /etc/mailcleaner.conf file is invalid and thus cannot provide the necessary details to do an update
* if it started running over 1 hour ago and never finished.

You can try manually running the updater (/root/Updater4MC/updater4mc.sh) or inspect the last log (/root/Updater4MC/updater\_.log).

May appear alongside other watchdogs with a better description of the issue.

## Updater\_TLS

Checks for TLS issues during the update process. This is likely to be an issue on our end. Contact us if you see this error.

## Others

Watchogs are added and removed regularly. Check to make sure you are on the latest version because you could be seeing a watchdog that is no longer relevant. If you do believe that you are on the latest version and see an error that isn't listed, report it to us as we may be required to update the documentatino. Thanks!

# Custom Watchdogs

If you are considering writing your own custom module, please consider submitting it as a Pull Request to our GitHub page. The documentation that follows will instruct you to use the 'CUSTOM\_mod\_' naming convention. These will be included in the WebUI but will not be reported to us, ever if you use Enterprise Edition, so it is a way to have modules that only exist and report locally. This will also ensure that you don't risk having a naming conflict with watchdogs that exist in the Git tree or that would be fetched from our Enterprise servers. If you are satisfied with the results of the custom module and believe that it will be useful for others, please rename it to a 'MC\_mod\_' and submit a Pull Request with that name.

You can create your own watchdogs that will be displayed in the WebUI. To do this, copy one of the 'MC\_mod\_SKELETON.pl' or 'MC\_mod\_SKELETON.sh' scripts with a filename starting with 'CUSTOM\_mod\_' then change this file to accomplish whatever task you need it to check. The output file should contain:

```
A text description of the error (optional)
RC : 0
EXEC : 0

```

where RC is the return code (0 meaning no error, any other value meaning there was an error). If you are going to submit a module to GitHub, please ensure that there is a comment indicating the significance of the return code, or that the significance is obvious from context. This will allow us to no better monitor user reports. EXEC should simply be the execution time in seconds as presented in the example code. If one is to be provided, the text description should be printed first on one line. The order of the other two does not matter.

Once the script is complete, create an accompanying config file in /usr/mailcleaner/etc/watchdog/ with the same name other than the extension being substituted for '.conf'. The contents of this file should be:

```
TAGS=oneday
EXEC_MODE=Parralel

```

The TAGS are the list of groups that this watchdog will be included in. The built-in tags are:

dix - Run every 10 minutes
oneday - Run 3 times a day (used to be once)
all - (Redundant) to be included with manual evocations of 'watchdogs.pl All'

You may use your own TAG value for custom modules if you do want to run on a different schedule. These existing TAGS are run by the root user's Crontab. Edit with:

```
crontab -e

```

The EXEC\_MODE can be:

Parrallel - All run at once and before sequential processes.
Sequence - Run one after another in alphabetical order (useful if an existing watchdog might cause an error if it has yet to complete).

The config file can also have a TIMEOUT value (in seconds) if you anticipate that it could stall.

### Toggle table of contents Pages 38

* Loading

  [Home](/MailCleaner/MailCleaner/wiki)
* Loading

  [Administrator Interface](/MailCleaner/MailCleaner/wiki/Administrator-Interface)
* Loading

  [Alpha Testing](/MailCleaner/MailCleaner/wiki/Alpha-Testing)
* Loading

  [API](/MailCleaner/MailCleaner/wiki/API)
* Loading

  [ClamAV Unofficial Signatures](/MailCleaner/MailCleaner/wiki/ClamAV-Unofficial-Signatures)
* Loading

  [Cloning Migration Guide](/MailCleaner/MailCleaner/wiki/Cloning-Migration-Guide)
* Loading

  [Cluster Configuration](/MailCleaner/MailCleaner/wiki/Cluster-Configuration)
* Loading

  [Common SpamC Rules](/MailCleaner/MailCleaner/wiki/Common-SpamC-Rules)
* Loading

  [Contributing Guide](/MailCleaner/MailCleaner/wiki/Contributing-Guide)
* Loading

  [Custom SpamC Rules and Adjustments](/MailCleaner/MailCleaner/wiki/Custom-SpamC-Rules-and-Adjustments)
* Loading

  [DMARC](/MailCleaner/MailCleaner/wiki/DMARC)
* Loading

  [DNS Configuration](/MailCleaner/MailCleaner/wiki/DNS-Configuration)
* Loading

  [ESET Anti‐virus](/MailCleaner/MailCleaner/wiki/ESET-Anti%E2%80%90virus)
* Loading

  [Fail2Ban](/MailCleaner/MailCleaner/wiki/Fail2Ban)
* Loading

  [FAQ ‐ Administrators](/MailCleaner/MailCleaner/wiki/FAQ-%E2%80%90-Administrators)
* Loading

  [FAQ ‐ Users](/MailCleaner/MailCleaner/wiki/FAQ-%E2%80%90-Users)
* Loading

  [Filtering Modules](/MailCleaner/MailCleaner/wiki/Filtering-Modules)
* Loading

  [General Administration and Maintenance Issues](/MailCleaner/MailCleaner/wiki/General-Administration-and-Maintenance-Issues)
* Loading

  [Greylisting](/MailCleaner/MailCleaner/wiki/Greylisting)
* Loading

  [Hidden Features](/MailCleaner/MailCleaner/wiki/Hidden-Features)
* Loading

  [Hostlist Entry Formatting](/MailCleaner/MailCleaner/wiki/Hostlist-Entry-Formatting)
* Loading

  [Installation Guide](/MailCleaner/MailCleaner/wiki/Installation-Guide)
* Loading

  [Kaspersky Anti‐virus](/MailCleaner/MailCleaner/wiki/Kaspersky-Anti%E2%80%90virus)
* Loading

  [MailCleaner Firewall](/MailCleaner/MailCleaner/wiki/MailCleaner-Firewall)
* Loading

  [Microsoft Exchange](/MailCleaner/MailCleaner/wiki/Microsoft-Exchange)
* Loading

  [Networking](/MailCleaner/MailCleaner/wiki/Networking)
* Loading

  [Office 365](/MailCleaner/MailCleaner/wiki/Office-365)
* Loading

  [Optional Add‐ons](/MailCleaner/MailCleaner/wiki/Optional-Add%E2%80%90ons)
* Loading

  [Outgoing Relay Deliverability Tips](/MailCleaner/MailCleaner/wiki/Outgoing-Relay-Deliverability-Tips)
* Loading

  [RBLs](/MailCleaner/MailCleaner/wiki/RBLs)
* Loading

  [Sender Rule Lists](/MailCleaner/MailCleaner/wiki/Sender-Rule-Lists)
* Loading

  [SNMP Monitoring](/MailCleaner/MailCleaner/wiki/SNMP-Monitoring)
* Loading

  [Upgrading Guide](/MailCleaner/MailCleaner/wiki/Upgrading-Guide)
* Loading

  [URL Shorteners and Redirectors](/MailCleaner/MailCleaner/wiki/URL-Shorteners-and-Redirectors)
* Loading

  [Using Mailcleaner as an Outgoing Relay](/MailCleaner/MailCleaner/wiki/Using-Mailcleaner-as-an-Outgoing-Relay)
* Loading

  [Using with Google Workspace](/MailCleaner/MailCleaner/wiki/Using-with-Google-Workspace)
* Loading

  [Watchdogs](/MailCleaner/MailCleaner/wiki/Watchdogs)

  + [detect\_bad\_DKIM.pl](/MailCleaner/MailCleaner/wiki/Watchdogs#detect_bad_dkimpl)
  + [detect\_bad\_git.sh](/MailCleaner/MailCleaner/wiki/Watchdogs#detect_bad_gitsh)
  + [detect\_Community (Enterprise only)](/MailCleaner/MailCleaner/wiki/Watchdogs#detect_community-enterprise-only)
  + [detect\_F2B](/MailCleaner/MailCleaner/wiki/Watchdogs#detect_f2b)
  + [detect\_license\_Kaspersky](/MailCleaner/MailCleaner/wiki/Watchdogs#detect_license_kaspersky)
  + [detect\_msg\_sniffer\_db](/MailCleaner/MailCleaner/wiki/Watchdogs#detect_msg_sniffer_db)
  + [detect\_PrefTDaemon](/MailCleaner/MailCleaner/wiki/Watchdogs#detect_preftdaemon)
  + [detect\_pyenv\_install.sh](/MailCleaner/MailCleaner/wiki/Watchdogs#detect_pyenv_installsh)
  + [detect\_Spam\_Handler](/MailCleaner/MailCleaner/wiki/Watchdogs#detect_spam_handler)
  + [detect\_StatsDaemon](/MailCleaner/MailCleaner/wiki/Watchdogs#detect_statsdaemon)
  + [detect\_Summaries](/MailCleaner/MailCleaner/wiki/Watchdogs#detect_summaries)
  + [detect\_unsync\_git](/MailCleaner/MailCleaner/wiki/Watchdogs#detect_unsync_git)
  + [disk\_full](/MailCleaner/MailCleaner/wiki/Watchdogs#disk_full)
  + [disk\_full\_inodes](/MailCleaner/MailCleaner/wiki/Watchdogs#disk_full_inodes)
  + [exim\_4.92](/MailCleaner/MailCleaner/wiki/Watchdogs#exim_492)
  + [exim\_4.94](/MailCleaner/MailCleaner/wiki/Watchdogs#exim_494)
  + [exim\_current](/MailCleaner/MailCleaner/wiki/Watchdogs#exim_current)
  + [git\_conflicts](/MailCleaner/MailCleaner/wiki/Watchdogs#git_conflicts)
  + [host\_keys](/MailCleaner/MailCleaner/wiki/Watchdogs#host_keys)
  + [Internal\_keys](/MailCleaner/MailCleaner/wiki/Watchdogs#internal_keys)
  + [modified\_exim1](/MailCleaner/MailCleaner/wiki/Watchdogs#modified_exim1)
  + [nb\_mails\_in\_queue](/MailCleaner/MailCleaner/wiki/Watchdogs#nb_mails_in_queue)
  + [port\_25\_relay](/MailCleaner/MailCleaner/wiki/Watchdogs#port_25_relay)
  + [slave\_status](/MailCleaner/MailCleaner/wiki/Watchdogs#slave_status)
  + [TesseractOcr (Not yet implemented)](/MailCleaner/MailCleaner/wiki/Watchdogs#tesseractocr-not-yet-implemented)
  + [Updater\_Status](/MailCleaner/MailCleaner/wiki/Watchdogs#updater_status)
  + [Updater\_TLS](/MailCleaner/MailCleaner/wiki/Watchdogs#updater_tls)
  + [Others](/MailCleaner/MailCleaner/wiki/Watchdogs#others)
  + [Custom Watchdogs](/MailCleaner/MailCleaner/wiki/Watchdogs#custom-watchdogs)
* Loading

  [Web UI Templates Theming](/MailCleaner/MailCleaner/wiki/Web-UI-Templates---Theming)
* Show 23 more pages…

# Administrator Shortcuts

* [Installation](https://github.com/MailCleaner/MailCleaner/wiki/Installation-Guide)
* [Overview of Admin Interface](https://github.com/MailCleaner/MailCleaner/wiki/Administrator-Interface)
* [General Administration and Maintenance Issues](https://github.com/MailCleaner/MailCleaner/wiki/General-Administration-and-Maintenance-Issues)
* [Clustering](https://github.com/MailCleaner/MailCleaner/wiki/Cluster-Configuration)
* [Upgrading](https://github.com/MailCleaner/MailCleaner/wiki/Upgrading-Guide)
* [FAQ](https://github.com/MailCleaner/MailCleaner/wiki/FAQ-%E2%80%90-Administrators)

# User Shortcuts

* [Overview of User Interface](https://github.com/MailCleaner/MailCleaner/wiki/User-Interface)
* [FAQ](https://github.com/MailCleaner/MailCleaner/wiki/FAQ-%E2%80%90-Users)

# Developer Shortcuts

* [Contributing](https://github.com/MailCleaner/MailCleaner/wiki/Contributing-Guide)
* [API Documentation](https://github.com/MailCleaner/MailCleaner/wiki/API)
* [Alpha Testing](https://github.com/MailCleaner/MailCleaner/wiki/Alpha-Testing)

Expand `▶ Pages` above to view the Table of Contents for the article you are already reading, or to browse additional topics. You can also [search for keywords](https://github.com/search?q=repo%3AMailCleaner%2FMailCleaner+SEARCH+TERM&type=wikis) in the Wiki.

##### Clone this wiki locally

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


