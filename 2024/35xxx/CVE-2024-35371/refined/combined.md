=== Content from gist.github.com_d6f94f61_20250114_222321.html ===

[Skip to content](#start-of-content)

[All gists](/discover)
[Back to GitHub](https://github.com)
[Sign in](https://gist.github.com/auth/github?return_to=https%3A%2F%2Fgist.github.com%2F1047524396%2F4eb17867f2e375f4824274c5e7b4d384)
[Sign up](/join?return_to=https%3A%2F%2Fgist.github.com%2F1047524396%2F4eb17867f2e375f4824274c5e7b4d384&source=header-gist)

[Sign in](https://gist.github.com/auth/github?return_to=https%3A%2F%2Fgist.github.com%2F1047524396%2F4eb17867f2e375f4824274c5e7b4d384) [Sign up](/join?return_to=https%3A%2F%2Fgist.github.com%2F1047524396%2F4eb17867f2e375f4824274c5e7b4d384&source=header-gist)

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

Instantly share code, notes, and snippets.

[![@1047524396](https://avatars.githubusercontent.com/u/77877041?s=64&v=4)](/1047524396)

# [1047524396](/1047524396)/**[CVE-2024-35371](/1047524396/4eb17867f2e375f4824274c5e7b4d384)**

Last active
November 29, 2024 04:11

Show Gist options

* [Download ZIP](/1047524396/4eb17867f2e375f4824274c5e7b4d384/archive/52080fc944ef73d1747cac63167f9d34fe12dbb9.zip)

* [Star
  (0)
  0](/login?return_to=https%3A%2F%2Fgist.github.com%2F1047524396%2F4eb17867f2e375f4824274c5e7b4d384)You must be signed in to star a gist
* [Fork
  (0)
  0](/login?return_to=https%3A%2F%2Fgist.github.com%2F1047524396%2F4eb17867f2e375f4824274c5e7b4d384)You must be signed in to fork a gist

* Embed

  + Embed
     Embed this gist in your website.
  + Share
     Copy sharable link for this gist.
  + Clone via HTTPS
     Clone using the web URL.
  + [Learn more about clone URLs](https://docs.github.com/articles/which-remote-url-should-i-use)

  Clone this repository at &lt;script src=&quot;https://gist.github.com/1047524396/4eb17867f2e375f4824274c5e7b4d384.js&quot;&gt;&lt;/script&gt;
* Save 1047524396/4eb17867f2e375f4824274c5e7b4d384 to your computer and use it in GitHub Desktop.

[Code](/1047524396/4eb17867f2e375f4824274c5e7b4d384)
[Revisions
2](/1047524396/4eb17867f2e375f4824274c5e7b4d384/revisions)

Embed

* Embed
   Embed this gist in your website.
* Share
   Copy sharable link for this gist.
* Clone via HTTPS
   Clone using the web URL.
* [Learn more about clone URLs](https://docs.github.com/articles/which-remote-url-should-i-use)

Clone this repository at &lt;script src=&quot;https://gist.github.com/1047524396/4eb17867f2e375f4824274c5e7b4d384.js&quot;&gt;&lt;/script&gt;

Save 1047524396/4eb17867f2e375f4824274c5e7b4d384 to your computer and use it in GitHub Desktop.

[Download ZIP](/1047524396/4eb17867f2e375f4824274c5e7b4d384/archive/52080fc944ef73d1747cac63167f9d34fe12dbb9.zip)

CVE-2024-35371

 [Raw](/1047524396/4eb17867f2e375f4824274c5e7b4d384/raw/52080fc944ef73d1747cac63167f9d34fe12dbb9/CVE-2024-35371)

[**CVE-2024-35371**](#file-cve-2024-35371)

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

|  | [CVE ID] |
| --- | --- |
|  | CVE-2024-35371 |
|  | [PRODUCT] |
|  | Ant-Media-Server |
|  | [VERSION] |
|  | v2.8.2 |
|  | [PROBLEM TYPE] |
|  | Improper Output Neutralization for Logs |
|  | [DESCRIPTION] |
|  | Ant-Media-Serverv2.8.2 is affected by Improper Output Neutralization for Logs. The vulnerability stems from insufficient input sanitization in the logging mechanism. Without proper filtering or validation, user-controllable data, such as identifiers or other sensitive information, can be included in log entries without restrictions. |
|  | [PATCH LINK] |
|  | https://github.com/ant-media/ant-media-server/commit/4d4763bd4fd06e515c19544e5170ca0f34c9ce45 |

[Sign up for free](/join?source=comment-gist)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgist.github.com%2F1047524396%2F4eb17867f2e375f4824274c5e7b4d384)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_fe01ed18_20250114_222329.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fant-media%2FAnt-Media-Server%2Fblob%2Fams-v2.8.2%2Fsrc%2Fmain%2Fjava%2Fio%2Fantmedia%2Frest%2FRestServiceBase.java)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fant-media%2FAnt-Media-Server%2Fblob%2Fams-v2.8.2%2Fsrc%2Fmain%2Fjava%2Fio%2Fantmedia%2Frest%2FRestServiceBase.java)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=ant-media%2FAnt-Media-Server)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[ant-media](/ant-media)
/
**[Ant-Media-Server](/ant-media/Ant-Media-Server)**
Public

* [Notifications](/login?return_to=%2Fant-media%2FAnt-Media-Server) You must be signed in to change notification settings
* [Fork
  641](/login?return_to=%2Fant-media%2FAnt-Media-Server)
* [Star
   4.3k](/login?return_to=%2Fant-media%2FAnt-Media-Server)

* [Code](/ant-media/Ant-Media-Server/tree/ams-v2.8.2)
* [Issues
  1.2k](/ant-media/Ant-Media-Server/issues)
* [Pull requests
  19](/ant-media/Ant-Media-Server/pulls)
* [Discussions](/ant-media/Ant-Media-Server/discussions)
* [Actions](/ant-media/Ant-Media-Server/actions)
* [Projects
  1](/ant-media/Ant-Media-Server/projects)
* [Wiki](/ant-media/Ant-Media-Server/wiki)
* [Security](/ant-media/Ant-Media-Server/security)
* [Insights](/ant-media/Ant-Media-Server/pulse)

Additional navigation options

* [Code](/ant-media/Ant-Media-Server/tree/ams-v2.8.2)
* [Issues](/ant-media/Ant-Media-Server/issues)
* [Pull requests](/ant-media/Ant-Media-Server/pulls)
* [Discussions](/ant-media/Ant-Media-Server/discussions)
* [Actions](/ant-media/Ant-Media-Server/actions)
* [Projects](/ant-media/Ant-Media-Server/projects)
* [Wiki](/ant-media/Ant-Media-Server/wiki)
* [Security](/ant-media/Ant-Media-Server/security)
* [Insights](/ant-media/Ant-Media-Server/pulse)

## Files

 ams-v2.8.2
## Breadcrumbs

1. [Ant-Media-Server](/ant-media/Ant-Media-Server/tree/ams-v2.8.2)
2. /[src](/ant-media/Ant-Media-Server/tree/ams-v2.8.2/src)
3. /[main](/ant-media/Ant-Media-Server/tree/ams-v2.8.2/src/main)
4. /[java](/ant-media/Ant-Media-Server/tree/ams-v2.8.2/src/main/java)
5. /[io](/ant-media/Ant-Media-Server/tree/ams-v2.8.2/src/main/java/io)
6. /[antmedia](/ant-media/Ant-Media-Server/tree/ams-v2.8.2/src/main/java/io/antmedia)
7. /[rest](/ant-media/Ant-Media-Server/tree/ams-v2.8.2/src/main/java/io/antmedia/rest)
/
# RestServiceBase.java

Copy path Blame  Blame
## Latest commit

## History

[History](/ant-media/Ant-Media-Server/commits/ams-v2.8.2/src/main/java/io/antmedia/rest/RestServiceBase.java)executable file·2032 lines (1623 loc) · 58.4 KB ams-v2.8.2
## Breadcrumbs

1. [Ant-Media-Server](/ant-media/Ant-Media-Server/tree/ams-v2.8.2)
2. /[src](/ant-media/Ant-Media-Server/tree/ams-v2.8.2/src)
3. /[main](/ant-media/Ant-Media-Server/tree/ams-v2.8.2/src/main)
4. /[java](/ant-media/Ant-Media-Server/tree/ams-v2.8.2/src/main/java)
5. /[io](/ant-media/Ant-Media-Server/tree/ams-v2.8.2/src/main/java/io)
6. /[antmedia](/ant-media/Ant-Media-Server/tree/ams-v2.8.2/src/main/java/io/antmedia)
7. /[rest](/ant-media/Ant-Media-Server/tree/ams-v2.8.2/src/main/java/io/antmedia/rest)
/
# RestServiceBase.java

Top
## File metadata and controls

* Code
* Blame

executable file·2032 lines (1623 loc) · 58.4 KB[Raw](https://github.com/ant-media/Ant-Media-Server/raw/refs/tags/ams-v2.8.2/src/main/java/io/antmedia/rest/RestServiceBase.java)1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192939495969798991001011021031041051061071081091101111121131141151161171181191201211221231241251261271281291301311321331341351361371381391401411421431441451461471481491501511521531541551561571581591601611621631641651661671681691701711721731741751761771781791801811821831841851861871881891901911921931941951961971981992002012022032042052062072082092102112122132142152162172182192202212222232242252262272282292302312322332342352362372382392402412422432442452462472482492502512522532542552562572582592602612622632642652662672682692702712722732742752762772782792802812822832842852862872882892902912922932942952962972982993003013023033043053063073083093103113123133143153163173183193203213223233243253263273283293303313323333343353363373383393403413423433443453463473483493503513523533543553563573583593603613623633643653663673683693703713723733743753763773783793803813823833843853863873883893903913923933943953963973983994004014024034044054064074084094104114124134144154164174184194204214224234244254264274284294304314324334344354364374384394404414424434444454464474484494504514524534544554564574584594604614624634644654664674684694704714724734744754764774784794804814824834844854864874884894904914924934944954964974984995005015025035045055065075085095105115125135145155165175185195205215225235245255265275285295305315325335345355365375385395405415425435445455465475485495505515525535545555565575585595605615625635645655665675685695705715725735745755765775785795805815825835845855865875885895905915925935945955965975985996006016026036046056066076086096106116126136146156166176186196206216226236246256266276286296306316326336346356366376386396406416426436446456466476486496506516526536546556566576586596606616626636646656666676686696706716726736746756766776786796806816826836846856866876886896906916926936946956966976986997007017027037047057067077087097107117127137147157167177187197207217227237247257267277287297307317327337347357367377387397407417427437447457467477487497507517527537547557567577587597607617627637647657667677687697707717727737747757767777787797807817827837847857867877887897907917927937947957967977987998008018028038048058068078088098108118128138148158168178188198208218228238248258268278288298308318328338348358368378388398408418428438448458468478488498508518528538548558568578588598608618628638648658668678688698708718728738748758768778788798808818828838848858868878888898908918928938948958968978988999009019029039049059069079089099109119129139149159169179189199209219229239249259269279289299309319329339349359369379389399409419429439449459469479489499509519529539549559569579589599609619629639649659669679689699709719729739749759769779789799809819829839849859869879889899909919929939949959969979989991000package io.antmedia.rest;
import java.io.File;import java.io.FileOutputStream;import java.io.IOException;import java.io.InputStream;import java.io.OutputStream;import java.net.InetAddress;import java.net.MalformedURLException;import java.net.NetworkInterface;import java.net.SocketException;import java.net.URL;import java.nio.file.Files;import java.time.Instant;import java.util.ArrayList;import java.util.Collection;import java.util.Date;import java.util.Enumeration;import java.util.HashMap;import java.util.Iterator;import java.util.List;import java.util.Map;import java.util.Objects;import java.util.jar.Manifest;import java.util.regex.Pattern;
import javax.annotation.Nullable;import jakarta.servlet.ServletContext;
import org.apache.commons.io.FilenameUtils;import org.apache.commons.lang3.RandomStringUtils;import org.apache.commons.lang3.StringUtils;import org.apache.commons.lang3.exception.ExceptionUtils;import org.red5.server.api.scope.IBroadcastScope;import org.red5.server.api.scope.IScope;import org.slf4j.Logger;import org.slf4j.LoggerFactory;import org.springframework.context.ApplicationContext;import org.springframework.web.context.WebApplicationContext;import org.springframework.web.context.support.WebApplicationContextUtils;
import io.antmedia.AntMediaApplicationAdapter;import io.antmedia.AppSettings;import io.antmedia.RecordType;import io.antmedia.cluster.IClusterNotifier;import io.antmedia.datastore.db.DataStore;import io.antmedia.datastore.db.DataStoreFactory;import io.antmedia.datastore.db.types.Broadcast;import io.antmedia.datastore.db.types.Broadcast.PlayListItem;import io.antmedia.datastore.db.types.ConferenceRoom;import io.antmedia.datastore.db.types.Endpoint;import io.antmedia.datastore.db.types.TensorFlowObject;import io.antmedia.datastore.db.types.Token;import io.antmedia.datastore.db.types.VoD;import io.antmedia.ipcamera.OnvifCamera;import io.antmedia.ipcamera.onvifdiscovery.OnvifDiscovery;import io.antmedia.muxer.IAntMediaStreamHandler;import io.antmedia.muxer.Mp4Muxer;import io.antmedia.muxer.MuxAdaptor;import io.antmedia.muxer.Muxer;import io.antmedia.muxer.RecordMuxer;import io.antmedia.rest.model.Result;import io.antmedia.rest.model.Version;import io.antmedia.security.ITokenService;import io.antmedia.settings.ServerSettings;import io.antmedia.statistic.DashViewerStats;import io.antmedia.statistic.HlsViewerStats;import io.antmedia.statistic.IStatsCollector;import io.antmedia.storage.StorageClient;import io.antmedia.streamsource.StreamFetcher;import io.antmedia.streamsource.StreamFetcher.IStreamFetcherListener;import io.antmedia.webrtc.api.IWebRTCAdaptor;import io.swagger.annotations.ApiModel;import io.swagger.annotations.ApiModelProperty;import jakarta.ws.rs.core.Context;
public abstract class RestServiceBase {
 @ApiModel(value="BroadcastStatistics", description="The statistics class of the broadcasts") public static class BroadcastStatistics {
 @ApiModelProperty(value = "the total RTMP viewers of the stream") public final int totalRTMPWatchersCount;
 @ApiModelProperty(value = "the total HLS viewers of the stream") public final int totalHLSWatchersCount;
 @ApiModelProperty(value = "the total WebRTC viewers of the stream") public final int totalWebRTCWatchersCount;
 @ApiModelProperty(value = "the total DASH viewers of the stream") public final int totalDASHWatchersCount;
 public BroadcastStatistics(int totalRTMPWatchersCount, int totalHLSWatchersCount, int totalWebRTCWatchersCount, int totalDASHWatchersCount) { this.totalRTMPWatchersCount = totalRTMPWatchersCount; this.totalHLSWatchersCount = totalHLSWatchersCount; this.totalWebRTCWatchersCount = totalWebRTCWatchersCount; this.totalDASHWatchersCount = totalDASHWatchersCount; } }
 @ApiModel(value="AppBroadcastStatistics", description="The statistics class of the app. It provides total number of viewers and active live streams") public static class AppBroadcastStatistics extends BroadcastStatistics {
 @ApiModelProperty(value = "the total active live stream count") public final int activeLiveStreamCount;
 public AppBroadcastStatistics(int totalRTMPWatchersCount, int totalHLSWatchersCount, int totalWebRTCWatchersCount, int totalDASHWatchersCount, int activeLiveStreamCount ) { super(totalRTMPWatchersCount, totalHLSWatchersCount, totalWebRTCWatchersCount, totalDASHWatchersCount); this.activeLiveStreamCount = activeLiveStreamCount; }
 }
 public interface ProcessBuilderFactory { Process make(String...args); }
 /\*\* \* Key for Manifest entry of Build number. It should match with the value in pom.xml \*/ public static final String BUILD\_NUMBER = "Build-Number";
 public static final String ENTERPRISE\_EDITION = "Enterprise Edition";
 public static final String COMMUNITY\_EDITION = "Community Edition";
 public static final int MAX\_ITEM\_IN\_ONE\_LIST = 50; public static final int ERROR\_SOCIAL\_ENDPOINT\_UNDEFINED\_CLIENT\_ID = -1; public static final int ERROR\_SOCIAL\_ENDPOINT\_UNDEFINED\_ENDPOINT = -2; public static final int ERROR\_SOCIAL\_ENDPOINT\_EXCEPTION\_IN\_ASKING\_AUTHPARAMS = -3;
 public static final int RECORD\_ENABLE = 1; public static final int RECORD\_DISABLE = -1; public static final int RECORD\_NO\_SET = 0;
 public static final int HIGH\_CPU\_ERROR = -3; public static final int FETCHER\_NOT\_STARTED\_ERROR = -4; public static final int INVALID\_STREAM\_NAME\_ERROR = -5;
 public static final String HTTP = "http://"; public static final String RTSP = "rtsp://"; public static final String ENDPOINT\_GENERIC = "generic";
 protected static Logger logger = LoggerFactory.getLogger(RestServiceBase.class);
 private ProcessBuilderFactory processBuilderFactory = null;
 //TODO: This REGEX does not fully match 10.10.157.200. It ignores the last 0 it matches 10.10.157.20 and it cause problem in replacements public static final String IPV4\_REGEX = "(([0-1]?[0-9]{1,2}\\.)|(2[0-4][0-9]\\.)|(25[0-5]\\.)){3}(([0-1]?[0-9]{1,2})|(2[0-4][0-9])|(25[0-5]))";
 public static final String LOOPBACK\_REGEX = "^localhost$|^127(?:\\.[0-9]+){0,2}\\.[0-9]+$|^(?:0\*\\:)\*?:?0\*1$"; private static final String REPLACE\_CHARS = "[\n|\r|\t]"; @Context protected ServletContext servletContext; protected DataStoreFactory dataStoreFactory; private DataStore dbStore; protected ApplicationContext appCtx; protected IScope scope; protected AntMediaApplicationAdapter appInstance;
 private AppSettings appSettings;
 private ServerSettings serverSettings;
 public void setAppCtx(ApplicationContext appCtx) { this.appCtx = appCtx; }
 @Nullable public ApplicationContext getAppContext() { if (servletContext != null) { appCtx = (ApplicationContext) servletContext .getAttribute(WebApplicationContext.ROOT\_WEB\_APPLICATION\_CONTEXT\_ATTRIBUTE); } return appCtx; }
 /\*\* \* this is for testing \* @param app \*/ public void setApplication(AntMediaApplicationAdapter app) { this.appInstance = app; }
 public AntMediaApplicationAdapter getApplication() { if (appInstance == null) { ApplicationContext appContext = getAppContext(); if (appContext != null) { appInstance = (AntMediaApplicationAdapter) appContext.getBean(AntMediaApplicationAdapter.BEAN\_NAME); } } return appInstance; }
 public IScope getScope() { if (scope == null) { scope = getApplication().getScope(); } return scope; }
 public void setScope(IScope scope) { this.scope = scope; }
 public DataStore getDataStore() { if (dbStore == null) { dbStore = getDataStoreFactory().getDataStore(); } return dbStore; }
 public void setDataStore(DataStore dataStore) { this.dbStore = dataStore; }
 public DataStoreFactory getDataStoreFactory() { if(dataStoreFactory == null) { WebApplicationContext ctxt = WebApplicationContextUtils.getWebApplicationContext(servletContext); if (ctxt != null) { dataStoreFactory = (DataStoreFactory) ctxt.getBean("dataStoreFactory"); } } return dataStoreFactory; }
 public void setDataStoreFactory(DataStoreFactory dataStoreFactory) { this.dataStoreFactory = dataStoreFactory; }
 public Broadcast createBroadcastWithStreamID(Broadcast broadcast) { return saveBroadcast(broadcast, IAntMediaStreamHandler.BROADCAST\_STATUS\_CREATED, getScope().getName(), getDataStore(), getAppSettings().getListenerHookURL(), getServerSettings(), 0); }
 public static Broadcast saveBroadcast(Broadcast broadcast, String status, String scopeName, DataStore dataStore, String settingsListenerHookURL, ServerSettings serverSettings, long absoluteStartTimeMs) {
 if (broadcast == null) { broadcast = new Broadcast(); }
 broadcast.setStatus(status); broadcast.setDate(System.currentTimeMillis());
 String listenerHookURL = broadcast.getListenerHookURL();
 if ((listenerHookURL == null || listenerHookURL.isEmpty()) && settingsListenerHookURL != null && !settingsListenerHookURL.isEmpty()) {
 broadcast.setListenerHookURL(settingsListenerHookURL); } String fqdn = serverSettings.getServerName();
 if (fqdn == null || fqdn.length() == 0) { fqdn = serverSettings.getHostAddress(); } broadcast.setOriginAdress(serverSettings.getHostAddress()); broadcast.setAbsoluteStartTimeMs(absoluteStartTimeMs);
 removeEmptyPlayListItems(broadcast);
 if (fqdn != null && fqdn.length() >= 0) { broadcast.setRtmpURL("rtmp://" + fqdn + "/" + scopeName + "/"); }
 dataStore.save(broadcast); return broadcast; }
 public AppSettings getAppSettings() { if (appSettings == null) { ApplicationContext appContext = getAppContext(); if (appContext != null) { appSettings = (AppSettings) appContext.getBean(AppSettings.BEAN\_NAME); } } return appSettings; }
 public void setAppSettings(AppSettings appSettings) { this.appSettings = appSettings; }
 public ServerSettings getServerSettings() { if (serverSettings == null) { ApplicationContext appContext = getAppContext(); if (appContext != null) { serverSettings = (ServerSettings) appContext.getBean(ServerSettings.BEAN\_NAME); } } return serverSettings; }
 public void setServerSettings(ServerSettings serverSettings) { this.serverSettings = serverSettings; }
 protected Result deleteBroadcast(String id) { Result result = new Result (false); boolean stopResult = false; Broadcast broadcast = null;
 if (id != null && (broadcast = getDataStore().get(id)) != null) { //no need to check if the stream is another node because RestProxyFilter makes this arrangement
 stopResult = stopBroadcastInternal(broadcast);
 result.setSuccess(getDataStore().delete(id));
 if(result.isSuccess()) { if (stopResult) { logger.info("broadcast {} is deleted and stopped successfully", broadcast.getStreamId()); result.setMessage("broadcast is deleted and stopped successfully"); } else { logger.info("broadcast {} is deleted but could not stopped", broadcast); result.setMessage("broadcast is deleted but could not stopped "); } }
 } else { logger.warn("Broadcast delete operation not successfull because broadcast is not found in db for stream id:{}", id != null ? id.replaceAll(REPLACE\_CHARS, "\_") : null); } return result; }
 protected Result deleteBroadcasts(String[] streamIds) {
 Result result = new Result(false);
 if(streamIds != null) { for (String id : streamIds) { result = deleteBroadcast(id); if (!result.isSuccess()) { logger.warn("It cannot delete {} and breaking the loop", id); break; } } } else { logger.warn("Requested deletion for Stream Ids is empty"); }
 return result; }
 protected boolean stopBroadcastInternal(Broadcast broadcast) { boolean result = false; if (broadcast != null) { result = getApplication().stopStreaming(broadcast).isSuccess(); if (result) { logger.info("broadcast is stopped streamId: {}", broadcast.getStreamId()); } else { logger.error("No active broadcast found with id {}, so could not stopped", broadcast.getStreamId()); } } return result; }
 protected Broadcast lookupBroadcast(String id) { Broadcast broadcast = null; try { broadcast = getDataStore().get(id); } catch (Exception e) { logger.error(ExceptionUtils.getStackTrace(e)); } return broadcast; }
 protected ConferenceRoom lookupConference(String id) { ConferenceRoom room = null; try { room = getDataStore().getConferenceRoom(id); } catch (Exception e) { logger.error(ExceptionUtils.getStackTrace(e)); } return room; }
 protected Result updateBroadcast(String streamId, Broadcast broadcast) {
 removeEmptyPlayListItems(broadcast);
 boolean result = getDataStore().updateBroadcastFields(streamId, broadcast);
 return new Result(result); }
 private static void removeEmptyPlayListItems(Broadcast broadcast) { List<PlayListItem> playListItemList = broadcast.getPlayListItemList(); if (playListItemList != null) { Iterator<PlayListItem> iterator = playListItemList.iterator(); while (iterator.hasNext()) { PlayListItem listItem = iterator.next(); if (listItem.getStreamUrl() == null || listItem.getStreamUrl().isEmpty()) { iterator.remove(); } } } }
 /\*\* \* Update Stream Source or IP Camera info \* @param broadcast \* @param socialNetworksToPublish \* @return \*/ protected Result updateStreamSource(String streamId, Broadcast broadcast) { logger.debug("Updating camera info for stream {}", broadcast.getStreamId());
 if (!checkStreamUrl(broadcast.getStreamUrl())) { return new Result(false, "Stream URL is not valid"); }
 Broadcast broadcastInDB = getDataStore().get(streamId); if (broadcastInDB == null) { streamId = streamId.replaceAll("[\n|\r|\t]", "\_"); logger.info("Broadcast with stream id: {} is null", streamId); return new Result(false, "Broadcast with streamId: " + streamId + " does not exist"); }
 boolean resultStopStreaming = checkStopStreaming(broadcastInDB); waitStopStreaming(broadcastInDB, resultStopStreaming);
 if (AntMediaApplicationAdapter.IP\_CAMERA.equals(broadcast.getType())) { Result connectionRes = connectToCamera(broadcast); if (!connectionRes.isSuccess()) { return connectionRes; }
 String rtspURL = connectionRes.getMessage(); String authparam = broadcast.getUsername() + ":" + broadcast.getPassword() + "@"; String rtspURLWithAuth = RTSP + authparam + rtspURL.substring(RTSP.length()); logger.info("New Stream Source URL: {}", rtspURLWithAuth); broadcast.setStreamUrl(rtspURLWithAuth); }
 boolean result = getDataStore().updateBroadcastFields(streamId, broadcast); if (result) { Broadcast fetchedBroadcast = getDataStore().get(streamId); getApplication().startStreaming(fetchedBroadcast); }
 return new Result(result); }
 public boolean checkStopStreaming(Broadcast broadcast) { // If broadcast status is broadcasting, this will force stop the streaming.
 if(IAntMediaStreamHandler.BROADCAST\_STATUS\_BROADCASTING.equals(broadcast.getStatus())) { return getApplication().stopStreaming(broadcast).isSuccess(); } else if(getApplication().getStreamFetcherManager().isStreamRunning(broadcast)) { return getApplication().stopStreaming(broadcast).isSuccess(); } else { // If broadcast status is stopped, this will return true. return true; } }
 public boolean waitStopStreaming(Broadcast broadcast, Boolean resultStopStreaming) {
 int i = 0; int waitPeriod = 250; // Broadcast status finished is not enough to be sure about broadcast's status. while (!IAntMediaStreamHandler.BROADCAST\_STATUS\_FINISHED.equals(getDataStore().get(broadcast.getStreamId()).getStatus()) && !resultStopStreaming.equals(true)) { try { i++; logger.info("Waiting for stop broadcast: {} Total wait time: {}ms", broadcast.getStreamId() , i\*waitPeriod);
 Thread.sleep(waitPeriod);
 if(i > 20) { logger.warn("{} Stream ID broadcast could not be stopped. Total wait time: {}ms", broadcast.getStreamId() , i\*waitPeriod); break; } } catch (InterruptedException e) { logger.error(e.getMessage()); Thread.currentThread().interrupt(); }
 } return true; }
 @Deprecated public Result addEndpoint(String id, String rtmpUrl) { boolean success = false; String message = null; try { if (validateStreamURL(rtmpUrl)) { Endpoint endpoint = new Endpoint(); endpoint.setRtmpUrl(rtmpUrl); endpoint.setType(ENDPOINT\_GENERIC);
 success = getDataStore().addEndpoint(id, endpoint); } } catch (Exception e) { logger.error(ExceptionUtils.getStackTrace(e)); }
 return new Result(success, message); }
 public Result addEndpoint(String id, Endpoint endpoint) { boolean success = false; String message = null;
 endpoint.setType(ENDPOINT\_GENERIC);
 String endpointServiceId = endpoint.getEndpointServiceId(); if (endpointServiceId == null || endpointServiceId.isEmpty()) { //generate custom endpoint invidual ID endpointServiceId = "custom"+RandomStringUtils.randomAlphabetic(6); } endpoint.setEndpointServiceId(endpointServiceId);
 try { if (validateStreamURL(endpoint.getRtmpUrl())) { success = getDataStore().addEndpoint(id, endpoint); } } catch (Exception e) { logger.error(ExceptionUtils.getStackTrace(e)); }
 return new Result(success, endpointServiceId, message); }
 @Deprecated public Result removeEndpoint(String id, String rtmpUrl) { Endpoint endpoint = new Endpoint(); endpoint.setRtmpUrl(rtmpUrl); endpoint.setType(ENDPOINT\_GENERIC);
 boolean removed = getDataStore().removeEndpoint(id, endpoint, true); return new Result(removed); }
 public Result removeRTMPEndpoint(String id, Endpoint endpoint) { boolean removed = getDataStore().removeEndpoint(id, endpoint, false);
 return new Result(removed);
 }
 public boolean isInSameNodeInCluster(String originAddress) { boolean isCluster = getAppContext().containsBean(IClusterNotifier.BEAN\_NAME); return !isCluster || originAddress.equals(getServerSettings().getHostAddress()); }
 public Result processRTMPEndpoint(String streamId, String originAddress, String rtmpUrl, boolean addEndpoint, int resolution) { Result result = new Result(false); if(isInSameNodeInCluster(originAddress)) { if(addEndpoint) { result = getMuxAdaptor(streamId).startRtmpStreaming(rtmpUrl, resolution); } else { result = getMuxAdaptor(streamId).stopRtmpStreaming(rtmpUrl, resolution); } } else { logger.error("Please send a RTMP Endpoint request to the {} node or {} RTMP Endpoint in a stopped broadcast.", originAddress, addEndpoint ? "add" : "remove"); result.setSuccess(false); } return result; }
 public Result importLiveStreams2Stalker() {
 String stalkerDBServer = getAppSettings().getStalkerDBServer(); String stalkerDBUsername = getAppSettings().getStalkerDBUsername(); String stalkerDBPassword = getAppSettings().getStalkerDBPassword();
 boolean result = false; String message = ""; int errorId = -1; if (stalkerDBServer != null && stalkerDBServer.length() > 0 && stalkerDBUsername != null && stalkerDBUsername.length() > 0 && stalkerDBPassword != null && stalkerDBPassword.length() > 0) {
 long broadcastCount = getDataStore().getBroadcastCount(); int pageCount = (int) broadcastCount/DataStore.MAX\_ITEM\_IN\_ONE\_LIST + ((broadcastCount % DataStore.MAX\_ITEM\_IN\_ONE\_LIST != 0) ? 1 : 0);
 List<Broadcast> broadcastList = new ArrayList<>(); for (int i = 0; i < pageCount; i++) { broadcastList.addAll(getDataStore().getBroadcastList(i\*DataStore.MAX\_ITEM\_IN\_ONE\_LIST, DataStore.MAX\_ITEM\_IN\_ONE\_LIST,null,null,null,null)); }
 StringBuilder insertQueryString = new StringBuilder();
 insertQueryString.append("DELETE FROM stalker\_db.ch\_links;"); insertQueryString.append("DELETE FROM stalker\_db.itv;");
 String fqdn = getServerSettings().getServerName(); if (fqdn == null || fqdn.length() == 0) { fqdn = getServerSettings().getHostAddress(); }
 int number = 1; for (Broadcast broadcast : broadcastList) { String cmd = "ffmpeg http://"+ fqdn + ":"+serverSettings.getDefaultHttpPort()+"/" + getScope().getName() + "/streams/"+broadcast.getStreamId()+".m3u8";
 insertQueryString.append("INSERT INTO stalker\_db.itv(name, number, tv\_genre\_id, base\_ch, cmd, languages)" + " VALUES ('"+broadcast.getName()+"' , "+ number +", 2, 1, '"+ cmd +"', '');");
 insertQueryString.append("SET @last\_id=LAST\_INSERT\_ID();" + "INSERT INTO stalker\_db.ch\_links(ch\_id, url)" + " VALUES(@last\_id, '"+ cmd +"');"); number++; } result = runStalkerImportQuery(insertQueryString.toString(), stalkerDBServer, stalkerDBUsername, stalkerDBPassword); } else { message = "Portal DB info is missing"; errorId = 404; }
 return new Result(result, message, errorId); }
 private boolean runStalkerImportQuery(String query, String stalkerDBServer, String stalkerDBUsername, String stalkerDBPassword) {
 boolean result = false; try {
 Process p = getProcess(query, stalkerDBServer, stalkerDBUsername, stalkerDBPassword);
 if (p != null) { InputStream is = p.getInputStream(); if (is != null) { byte[] data = new byte[1024]; int length; while ((length = is.read(data, 0, data.length)) != -1) { if (logger.isInfoEnabled()) { logger.info(new String(data, 0, length)); } } }
 int exitWith = p.waitFor();
 if (exitWith == 0) { result = true; } }
 } catch (IOException e) { logger.error(ExceptionUtils.getStackTrace(e)); } catch (InterruptedException e) { logger.error(ExceptionUtils.getStackTrace(e)); Thread.currentThread().interrupt(); } return result; }
 private Process getProcess(String query, String stalkerDBServer, String stalkerDBUsername, String stalkerDBPassword) { Process process = null; String mysqlClientPath = getAppSettings().getMySqlClientPath(); if (processBuilderFactory != null) {
 process = processBuilderFactory.make(mysqlClientPath, "-h", stalkerDBServer, "-u", stalkerDBUsername, "-p"+stalkerDBPassword, "-e", query); } else { try { process = new ProcessBuilder( mysqlClientPath, "-h", stalkerDBServer, "-u", stalkerDBUsername, "-p"+stalkerDBPassword, "-e", query ).redirectErrorStream(true).start(); } catch (IOException e) { logger.error(ExceptionUtils.getStackTrace(e)); } }
 return process;
 }
 public Result importVoDsToStalker() {
 String stalkerDBServer = getAppSettings().getStalkerDBServer(); String stalkerDBUsername = getAppSettings().getStalkerDBUsername(); String stalkerDBPassword = getAppSettings().getStalkerDBPassword();
 boolean result = false; String message = ""; int errorId = -1; if (stalkerDBServer != null && stalkerDBUsername != null && stalkerDBPassword != null) {
 String vodFolderPath = getAppSettings().getVodFolder(); if (vodFolderPath != null && !vodFolderPath.isEmpty()) {
 long totalVodNumber = getDataStore().getTotalVodNumber(); int pageCount = (int) totalVodNumber/DataStore.MAX\_ITEM\_IN\_ONE\_LIST + ((totalVodNumber % DataStore.MAX\_ITEM\_IN\_ONE\_LIST != 0) ? 1 : 0);
 List<VoD> vodList = new ArrayList<>(); for (int i = 0; i < pageCount; i++) { vodList.addAll(getDataStore().getVodList(i\*DataStore.MAX\_ITEM\_IN\_ONE\_LIST, DataStore.MAX\_ITEM\_IN\_ONE\_LIST, null, null, null, null)); }
 String fqdn = getServerSettings().getServerName(); if (fqdn == null || fqdn.length() == 0) { fqdn = getServerSettings().getHostAddress(); }
 StringBuilder insertQueryString = new StringBuilder();
 //delete all videos in stalker to import new ones insertQueryString.append("DELETE FROM stalker\_db.video\_series\_files;"); insertQueryString.append("DELETE FROM stalker\_db.video;");
 for (VoD vod : vodList) { if (vod.getType().equals(VoD.USER\_VOD)) { insertQueryString.append("INSERT INTO stalker\_db.video(name, o\_name, protocol, category\_id, cat\_genre\_id\_1, status, cost, path, accessed) " + "values('"+ vod.getVodName() + "', '"+vod.getVodName()+"', '', 1, 1, 1, 0, '"+vod.getVodName()+"', 1);");
 File vodFolder = new File(vodFolderPath); int lastIndexOf = vod.getFilePath().lastIndexOf(vodFolder.getName()); String filePath = vod.getFilePath().substring(lastIndexOf); String cmd = "ffmpeg http://"+ fqdn + ":"+serverSettings.getDefaultHttpPort()+"/" + getScope().getName() + "/streams/" + filePath;
 insertQueryString.append("SET @last\_id=LAST\_INSERT\_ID();");
 insertQueryString.append("INSERT INTO stalker\_db.video\_series\_files" + "(video\_id, file\_type, protocol, url, languages, quality, date\_add, date\_modify, status, accessed)" + "VALUES(@last\_id, 'video', 'custom', '"+cmd+"', 'a:1:{i:0;s:2:\"en\";}', 5, NOW(), NOW(), 1, 1);");
 }
 }
 result = runStalkerImportQuery(insertQueryString.toString(), stalkerDBServer, stalkerDBUsername, stalkerDBPassword ); } else { message = "No VoD folder specified"; errorId = 500; } } else { message = "Portal DB info is missing"; errorId = 404; }
 return new Result(result, message, errorId);
 }
 protected ProcessBuilderFactory getProcessBuilderFactory() { return processBuilderFactory; }
 public void setProcessBuilderFactory(ProcessBuilderFactory processBuilderFactory) { this.processBuilderFactory = processBuilderFactory; }
 public IWebRTCAdaptor getWebRTCAdaptor() { IWebRTCAdaptor adaptor = null; ApplicationContext appContext = getAppContext(); if (appContext != null && appContext.containsBean(IWebRTCAdaptor.BEAN\_NAME)) { Object webRTCAdaptorBean = appContext.getBean(IWebRTCAdaptor.BEAN\_NAME);
 if(webRTCAdaptorBean != null) { adaptor = (IWebRTCAdaptor) webRTCAdaptorBean; } } return adaptor; }
 public Result addIPCamera(Broadcast stream) {
 Result connResult = new Result(false);
 if(validateStreamURL(stream.getIpAddr())) { logger.info("type {}", stream.getType());
 connResult = connectToCamera(stream);
 if (connResult.isSuccess()) {
 String authparam = stream.getUsername() + ":" + stream.getPassword() + "@"; String rtspURLWithAuth = RTSP + authparam + connResult.getMessage().substring(RTSP.length()); logger.info("rtsp url with auth: {}", rtspURLWithAuth); stream.setStreamUrl(rtspURLWithAuth); Date currentDate = new Date(); long unixTime = currentDate.getTime();
 stream.setDate(unixTime);
 Broadcast savedBroadcast = saveBroadcast(stream, IAntMediaStreamHandler.BROADCAST\_STATUS\_CREATED, getScope().getName(), getDataStore(), getAppSettings().getListenerHookURL(), getServerSettings(), 0);
 connResult = getApplication().startStreaming(savedBroadcast); //if IP Camera is not being started while adding, do not record it to datastore if (!connResult.isSuccess()) { getDataStore().delete(savedBroadcast.getStreamId()); } } } else { connResult.setMessage("IP camera addr is not valid: " + stream.getIpAddr()); }
 return connResult; }
 public Result addStreamSource(Broadcast stream) {
 Result result = new Result(false);
 IStatsCollector monitor = (IStatsCollector) getAppContext().getBean(IStatsCollector.BEAN\_NAME);
 if(monitor.enoughResource()) { if (stream.getType().equals(AntMediaApplicationAdapter.IP\_CAMERA)) { result = addIPCamera(stream); } else if (stream.getType().equals(AntMediaApplicationAdapter.STREAM\_SOURCE) ) { result = addSource(stream); } else{ result.setMessage("Auto start query needs an IP camera or stream source."); } } else {
 logger.error("Stream Fetcher can not be created due to high cpu load/limit: {}/{} ram free/minfree:{}/{}", monitor.getCpuLoad(), monitor.getCpuLimit(), monitor.getFreeRam(), monitor.getMinFreeRamSize()); result.setMessage("Resource usage is high"); result.setErrorId(HIGH\_CPU\_ERROR); }
 return result; }
 public Result connectToCamera(Broadcast stream) {
 Result result = new Result(false);
 OnvifCamera onvif = new OnvifCamera(); int connResult = onvif.connect(stream.getIpAddr(), stream.getUsername(), stream.getPassword()); if (connResult == 0) { result.setSuccess(true); //set RTSP URL. This message is directly used in saving stream url to the datastore result.setMessage(onvif.getRTSPStreamURI()); }else { //there is an error //set error code and send it result.setMessage("Could not connect to " + stream.getIpAddr() + " result:" + connResult); result.setErrorId(connResult); logger.info("Cannot connect to ip camera:{}", stream.getIpAddr()); }
 return result;
 }
 /\*\* \* Parse the string to check it's a valid url \* It can parse protocol://username:passwrd@server.fqdn/stream format as well \* @param url \* @return \*/ protected static boolean validateStreamURL(String url) {
 boolean ipAddrControl = false; String[] ipAddrParts = null; String serverAddr = url;
 if(url != null && (url.startsWith(HTTP) || url.startsWith("https://") || url.startsWith("rtmp://") || url.startsWith("rtmps://") || url.startsWith(RTSP))) {
 ipAddrParts = url.split("//"); serverAddr = ipAddrParts[1]; ipAddrControl=true;
 } if (serverAddr != null) { if (serverAddr.contains("@")){
 ipAddrParts = serverAddr.split("@"); serverAddr = ipAddrParts[1];
 } if (serverAddr.contains(":")){
 ipAddrParts = serverAddr.split(":"); serverAddr = ipAddrParts[0];
 } if (serverAddr.contains("/")){ ipAddrParts = serverAddr.split("/"); serverAddr = ipAddrParts[0]; }
 if (logger.isInfoEnabled()) { logger.info("IP: {}", serverAddr.replaceAll("[\n|\r|\t]", "\_")); }
 if(serverAddr.split("\\.").length == 4 && validateIPaddress(serverAddr)){ ipAddrControl = true; } } return ipAddrControl; }
 protected static boolean validateIPaddress(String ipaddress) {
 Pattern patternIP4 = Pattern.compile(IPV4\_REGEX); Pattern patternLoopBack = Pattern.compile(LOOPBACK\_REGEX);
 return patternIP4.matcher(ipaddress).matches() || patternLoopBack.matcher(ipaddress).matches() ;
 }
 public boolean checkStreamUrl (String url) {
 boolean streamUrlControl = false; String[] ipAddrParts = null; String ipAddr = null;
 if(url != null && (url.startsWith(HTTP) || url.startsWith("https://") || url.startsWith("rtmp://") || url.startsWith("rtmps://") || url.startsWith(RTSP) || url.startsWith("udp://") || url.startsWith("srt://") )) { streamUrlControl=true; ipAddrParts = url.split("//"); ipAddr = ipAddrParts[1];
 if (ipAddr.contains("@")){
 ipAddrParts = ipAddr.split("@"); ipAddr = ipAddrParts[1];
 }[View remainder of file in raw view](https://github.com/ant-media/Ant-Media-Server/raw/refs/tags/ams-v2.8.2/src/main/java/io/antmedia/rest/RestServiceBase.java)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_2a0220e5_20250114_222332.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fant-media%2Fant-media-server%2Fcommit%2F4d4763bd4fd06e515c19544e5170ca0f34c9ce45)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fant-media%2Fant-media-server%2Fcommit%2F4d4763bd4fd06e515c19544e5170ca0f34c9ce45)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=ant-media%2FAnt-Media-Server)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[ant-media](/ant-media)
/
**[Ant-Media-Server](/ant-media/Ant-Media-Server)**
Public

* [Notifications](/login?return_to=%2Fant-media%2FAnt-Media-Server) You must be signed in to change notification settings
* [Fork
  641](/login?return_to=%2Fant-media%2FAnt-Media-Server)
* [Star
   4.3k](/login?return_to=%2Fant-media%2FAnt-Media-Server)

* [Code](/ant-media/Ant-Media-Server)
* [Issues
  1.2k](/ant-media/Ant-Media-Server/issues)
* [Pull requests
  19](/ant-media/Ant-Media-Server/pulls)
* [Discussions](/ant-media/Ant-Media-Server/discussions)
* [Actions](/ant-media/Ant-Media-Server/actions)
* [Projects
  1](/ant-media/Ant-Media-Server/projects)
* [Wiki](/ant-media/Ant-Media-Server/wiki)
* [Security](/ant-media/Ant-Media-Server/security)
* [Insights](/ant-media/Ant-Media-Server/pulse)

Additional navigation options

* [Code](/ant-media/Ant-Media-Server)
* [Issues](/ant-media/Ant-Media-Server/issues)
* [Pull requests](/ant-media/Ant-Media-Server/pulls)
* [Discussions](/ant-media/Ant-Media-Server/discussions)
* [Actions](/ant-media/Ant-Media-Server/actions)
* [Projects](/ant-media/Ant-Media-Server/projects)
* [Wiki](/ant-media/Ant-Media-Server/wiki)
* [Security](/ant-media/Ant-Media-Server/security)
* [Insights](/ant-media/Ant-Media-Server/pulse)

## Commit

[Permalink](/ant-media/Ant-Media-Server/commit/4d4763bd4fd06e515c19544e5170ca0f34c9ce45)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Fix vulnerability about logging

[Browse files](/ant-media/Ant-Media-Server/tree/4d4763bd4fd06e515c19544e5170ca0f34c9ce45)
Browse the repository at this point in the history

* Loading branch information

[![@mekya](https://avatars.githubusercontent.com/u/3456251?s=40&v=4)](/mekya)

[mekya](/ant-media/Ant-Media-Server/commits?author=mekya "View all commits by mekya")
committed
Mar 23, 2024

1 parent
[3dfaf9a](/ant-media/Ant-Media-Server/commit/3dfaf9a9e3774c65cd396eec4d9b0f759e5085c4)

commit 4d4763b

Showing
**1 changed file**
with
**6 additions**
and
**2 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

## There are no files selected for viewing

8 changes: 6 additions & 2 deletions

8
[src/main/java/io/antmedia/rest/RestServiceBase.java](#diff-33be7567a184ef420d62857f9684d81e86bf9d866a6e7962affd2556c31c9519 "src/main/java/io/antmedia/rest/RestServiceBase.java")

Show comments

[View file](/ant-media/Ant-Media-Server/blob/4d4763bd4fd06e515c19544e5170ca0f34c9ce45/src/main/java/io/antmedia/rest/RestServiceBase.java)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -75,6 +75,8 @@ |
|  |  |  |
|  |  | public abstract class RestServiceBase { |
|  |  |  |
|  |  | private static final String REPLACE\_CHARS\_FOR\_SECURITY = "[\n\r]"; |
|  |  |  |
|  |  | public class BroadcastStatistics { |
|  |  |  |
|  |  | @Schema(description = "The total RTMP viewers of the stream") |
| Expand Down  Expand Up | | @@ -365,6 +367,7 @@ protected Result deleteBroadcasts(String[] streamIds) { |
|  |  | result = deleteBroadcast(id); |
|  |  | if (!result.isSuccess()) |
|  |  | { |
|  |  | id = id.replaceAll(REPLACE\_CHARS\_FOR\_SECURITY, "\_" ); |
|  |  | logger.warn("It cannot delete {} and breaking the loop", id); |
|  |  | break; |
|  |  | } |
| Expand Down  Expand Up | | @@ -1168,6 +1171,7 @@ protected Result deleteVoDs(String[] vodIds) |
|  |  |  |
|  |  | if (!result.isSuccess()) |
|  |  | { |
|  |  | id = id.replaceAll(REPLACE\_CHARS\_FOR\_SECURITY, "\_" ); |
|  |  | logger.warn("VoD:{} cannot be deleted and breaking the loop", id); |
|  |  | break; |
|  |  | } |
| Expand Down  Expand Up | | @@ -1311,7 +1315,7 @@ protected RecordMuxer startRecord(String streamId, RecordType recordType, int re |
|  |  | } |
|  |  | else { |
|  |  | logger.info("No mux adaptor found for {} recordType:{} resolutionHeight:{}", streamId != null ? |
|  |  | streamId.replaceAll("[\n\r]", "\_") : "null ", |
|  |  | streamId.replaceAll(REPLACE\_CHARS\_FOR\_SECURITY, "\_") : "null ", |
|  |  | recordType, resolutionHeight); |
|  |  | } |
|  |  |  |
| Expand Down  Expand Up | | @@ -1478,7 +1482,7 @@ else if (!AntMediaApplicationAdapter.PLAY\_LIST.equals(broadcast.getType())) { |
|  |  | streamFetcher.setStreamFetcherListener(null); |
|  |  |  |
|  |  | if (logger.isInfoEnabled()) { |
|  |  | logger.info("Switching to next item by REST method for playlist:{} and forwarding stream fetcher listener:{}", id.replaceAll("[\n\r]", "\_"), streamFetcherListener.hashCode()); |
|  |  | logger.info("Switching to next item by REST method for playlist:{} and forwarding stream fetcher listener:{}", id.replaceAll(REPLACE\_CHARS\_FOR\_SECURITY, "\_"), streamFetcherListener.hashCode()); |
|  |  | } |
|  |  |  |
|  |  | result = getApplication().getStreamFetcherManager().playItemInList(broadcast, streamFetcherListener, index); |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `4d4763b`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fant-media%2Fant-media-server%2Fcommit%2F4d4763bd4fd06e515c19544e5170ca0f34c9ce45) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


