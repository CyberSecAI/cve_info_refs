=== Content from gist.github.com_afd2c6c6_20250114_185025.html ===

[Skip to content](#start-of-content)

[All gists](/discover)
[Back to GitHub](https://github.com)
[Sign in](https://gist.github.com/auth/github?return_to=https%3A%2F%2Fgist.github.com%2F1047524396%2Ff7ff51d24ebbb29e21dfb70a0c97302b)
[Sign up](/join?return_to=https%3A%2F%2Fgist.github.com%2F1047524396%2Ff7ff51d24ebbb29e21dfb70a0c97302b&source=header-gist)

[Sign in](https://gist.github.com/auth/github?return_to=https%3A%2F%2Fgist.github.com%2F1047524396%2Ff7ff51d24ebbb29e21dfb70a0c97302b) [Sign up](/join?return_to=https%3A%2F%2Fgist.github.com%2F1047524396%2Ff7ff51d24ebbb29e21dfb70a0c97302b&source=header-gist)

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

Instantly share code, notes, and snippets.

[![@1047524396](https://avatars.githubusercontent.com/u/77877041?s=64&v=4)](/1047524396)

# [1047524396](/1047524396)/**[CVE-2024-36612](/1047524396/f7ff51d24ebbb29e21dfb70a0c97302b)**

Created
November 29, 2024 04:13

Show Gist options

* [Download ZIP](/1047524396/f7ff51d24ebbb29e21dfb70a0c97302b/archive/2a7fe7d223ae77a275cb5f8a770d388e06040667.zip)

* [Star
  (0)
  0](/login?return_to=https%3A%2F%2Fgist.github.com%2F1047524396%2Ff7ff51d24ebbb29e21dfb70a0c97302b)You must be signed in to star a gist
* [Fork
  (0)
  0](/login?return_to=https%3A%2F%2Fgist.github.com%2F1047524396%2Ff7ff51d24ebbb29e21dfb70a0c97302b)You must be signed in to fork a gist

* Embed

  + Embed
     Embed this gist in your website.
  + Share
     Copy sharable link for this gist.
  + Clone via HTTPS
     Clone using the web URL.
  + [Learn more about clone URLs](https://docs.github.com/articles/which-remote-url-should-i-use)

  Clone this repository at &lt;script src=&quot;https://gist.github.com/1047524396/f7ff51d24ebbb29e21dfb70a0c97302b.js&quot;&gt;&lt;/script&gt;
* Save 1047524396/f7ff51d24ebbb29e21dfb70a0c97302b to your computer and use it in GitHub Desktop.

[Code](/1047524396/f7ff51d24ebbb29e21dfb70a0c97302b)
[Revisions
1](/1047524396/f7ff51d24ebbb29e21dfb70a0c97302b/revisions)

Embed

* Embed
   Embed this gist in your website.
* Share
   Copy sharable link for this gist.
* Clone via HTTPS
   Clone using the web URL.
* [Learn more about clone URLs](https://docs.github.com/articles/which-remote-url-should-i-use)

Clone this repository at &lt;script src=&quot;https://gist.github.com/1047524396/f7ff51d24ebbb29e21dfb70a0c97302b.js&quot;&gt;&lt;/script&gt;

Save 1047524396/f7ff51d24ebbb29e21dfb70a0c97302b to your computer and use it in GitHub Desktop.

[Download ZIP](/1047524396/f7ff51d24ebbb29e21dfb70a0c97302b/archive/2a7fe7d223ae77a275cb5f8a770d388e06040667.zip)

CVE-2024-36612

 [Raw](/1047524396/f7ff51d24ebbb29e21dfb70a0c97302b/raw/2a7fe7d223ae77a275cb5f8a770d388e06040667/CVE-2024-36612)

[**CVE-2024-36612**](#file-cve-2024-36612)

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

|  | [CVE ID] |
| --- | --- |
|  | CVE-2024-36612 |
|  | [PRODUCT] |
|  | Zulip |
|  | [VERSION] |
|  | from 8.0 to 8.3 |
|  | [PROBLEM TYPE] |
|  | Memory leak |
|  | [DESCRIPTION] |
|  | Zulip from 8.0 to 8.3 contains a memory leak vulnerability in the handling of popovers. |
|  | [PATCH LINK] |
|  | https://github.com/zulip/zulip/commit/0a90a13becbf0338a8fc1ad37946e51c2c25b0a5 |

[Sign up for free](/join?source=comment-gist)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgist.github.com%2F1047524396%2Ff7ff51d24ebbb29e21dfb70a0c97302b)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_cc293fde_20250114_185031.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fzulip%2Fzulip%2Fcommit%2F0a90a13becbf0338a8fc1ad37946e51c2c25b0a5)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fzulip%2Fzulip%2Fcommit%2F0a90a13becbf0338a8fc1ad37946e51c2c25b0a5)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=zulip%2Fzulip)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[zulip](/zulip)
/
**[zulip](/zulip/zulip)**
Public

* [Notifications](/login?return_to=%2Fzulip%2Fzulip) You must be signed in to change notification settings
* [Fork
  8.1k](/login?return_to=%2Fzulip%2Fzulip)
* [Star
   22k](/login?return_to=%2Fzulip%2Fzulip)

* [Code](/zulip/zulip)
* [Issues
  1.6k](/zulip/zulip/issues)
* [Pull requests
  888](/zulip/zulip/pulls)
* [Actions](/zulip/zulip/actions)
* [Projects
  2](/zulip/zulip/projects)
* [Security](/zulip/zulip/security)
* [Insights](/zulip/zulip/pulse)

Additional navigation options

* [Code](/zulip/zulip)
* [Issues](/zulip/zulip/issues)
* [Pull requests](/zulip/zulip/pulls)
* [Actions](/zulip/zulip/actions)
* [Projects](/zulip/zulip/projects)
* [Security](/zulip/zulip/security)
* [Insights](/zulip/zulip/pulse)

## Commit

[Permalink](/zulip/zulip/commit/0a90a13becbf0338a8fc1ad37946e51c2c25b0a5)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

popover\_menus: Fix event handler trying to hide a hidden popover.

[Browse files](/zulip/zulip/tree/0a90a13becbf0338a8fc1ad37946e51c2c25b0a5)
Browse the repository at this point in the history

```
When user is trying to open a modal after clicking on a button
in a popover, we call popovers.hide_all() before opening the modal
which hides the popover but since the event handler call isn't
finished running yet, we call instance.hide() again resulting in
tippy throwing errors that this could be a memory leak.

We introduce a wrapper function for `instance.hide` which if
the popover/tooltip is visible before hiding it to fix it.
```

* Loading branch information

[![@amanagr](https://avatars.githubusercontent.com/u/25124304?s=40&v=4)](/amanagr) [![@timabbott](https://avatars.githubusercontent.com/u/2746074?s=40&v=4)](/timabbott)

[amanagr](/zulip/zulip/commits?author=amanagr "View all commits by amanagr")
authored and
[timabbott](/zulip/zulip/commits?author=timabbott "View all commits by timabbott")
committed
Apr 4, 2024

1 parent
[ac5161f](/zulip/zulip/commit/ac5161f4397eb6d984cdc27f56fba52f6a220af2)

commit 0a90a13

 Show file tree

 Hide file tree

Showing
**12 changed files**
with
**62 additions**
and
**51 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* web/src

  + web/src/click\_handlers.js
    [click\_handlers.js](#diff-5c514710061a67b369f6923d0684fb9534acfff1d668c397726ce050d67f6234)
  + web/src/compose\_popovers.js
    [compose\_popovers.js](#diff-d2a79e8eb6409a351b7b691f21a1799cd78e384cc16c1ce359768047b6105f2f)
  + web/src/dropdown\_widget.ts
    [dropdown\_widget.ts](#diff-3d75782a024fef483d43826562d097aa9f8705902c79495d68e39547feacb562)
  + web/src/gear\_menu.js
    [gear\_menu.js](#diff-e7bc813ca35c80d5826ca688920c8855795387969ead4d5271368fb1da1effc5)
  + web/src/left\_sidebar\_navigation\_area\_popovers.js
    [left\_sidebar\_navigation\_area\_popovers.js](#diff-f99d5e25e33692b9de416d878dd83650f1c9a8c66a79cf4783cd4d949d52e466)
  + web/src/message\_actions\_popover.js
    [message\_actions\_popover.js](#diff-019492c805dc3b1c7814e9bfa318a9a3267e9e4d3651a1fb8c522f7d0fa3a337)
  + web/src/message\_list\_tooltips.ts
    [message\_list\_tooltips.ts](#diff-ae51ae554ae31e15a719ffc8db29155380a209fcecd4a69caf97ff43c1348b51)
  + web/src/personal\_menu\_popover.js
    [personal\_menu\_popover.js](#diff-ddea2e8e6a90b58404ab63663005081617fb3ecf917c5fbb1e32d127da033625)
  + web/src/popover\_menus.ts
    [popover\_menus.ts](#diff-a82b0ec84aca5ee44d9762c23daecd4112bf76cabb85c97e7448b336b4088eb8)
  + web/src/scheduled\_messages\_popover.js
    [scheduled\_messages\_popover.js](#diff-a2007ef4ad24ff08d7abd30578cde8eed81517a386c56e3d5e956d2233de7763)
  + web/src/topic\_popover.js
    [topic\_popover.js](#diff-8302e84c19cb054accdc3c421556498aad90ab0b1647724af60967a5584944f0)
  + web/src/user\_topic\_popover.js
    [user\_topic\_popover.js](#diff-d41f00ee3fd9e4e2cc3ecc18859a7338de1f920a90550df5963ae9ccda4bcdbe)

## There are no files selected for viewing

3 changes: 2 additions & 1 deletion

3
[web/src/click\_handlers.js](#diff-5c514710061a67b369f6923d0684fb9534acfff1d668c397726ce050d67f6234 "web/src/click_handlers.js")

Show comments

[View file](/zulip/zulip/blob/0a90a13becbf0338a8fc1ad37946e51c2c25b0a5/web/src/click_handlers.js)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -25,6 +25,7 @@ import \* as narrow\_state from "./narrow\_state"; |
|  |  | import \* as navigate from "./navigate"; |
|  |  | import {page\_params} from "./page\_params"; |
|  |  | import \* as pm\_list from "./pm\_list"; |
|  |  | import \* as popover\_menus from "./popover\_menus"; |
|  |  | import \* as reactions from "./reactions"; |
|  |  | import \* as recent\_view\_ui from "./recent\_view\_ui"; |
|  |  | import \* as rows from "./rows"; |
| Expand Down  Expand Up | | @@ -542,7 +543,7 @@ export function initialize() { |
|  |  | for (const mutation of mutationsList) { |
|  |  | // Hide instance if reference is in the removed node list. |
|  |  | if (check\_reference\_removed(mutation, instance)) { |
|  |  | instance.hide(); |
|  |  | popover\_menus.hide\_current\_popover\_if\_visible(instance); |
|  |  | } |
|  |  | } |
|  |  | }; |
| Expand Down | |  |

4 changes: 2 additions & 2 deletions

4
[web/src/compose\_popovers.js](#diff-d2a79e8eb6409a351b7b691f21a1799cd78e384cc16c1ce359768047b6105f2f "web/src/compose_popovers.js")

Show comments

[View file](/zulip/zulip/blob/0a90a13becbf0338a8fc1ad37946e51c2c25b0a5/web/src/compose_popovers.js)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -41,12 +41,12 @@ export function initialize() { |
|  |  | $popper.one("click", ".compose\_mobile\_stream\_button", (e) => { |
|  |  | compose\_actions.start("stream", {trigger: "clear topic button"}); |
|  |  | e.stopPropagation(); |
|  |  | instance.hide(); |
|  |  | popover\_menus.hide\_current\_popover\_if\_visible(instance); |
|  |  | }); |
|  |  | $popper.one("click", ".compose\_mobile\_direct\_message\_button", (e) => { |
|  |  | compose\_actions.start("private"); |
|  |  | e.stopPropagation(); |
|  |  | instance.hide(); |
|  |  | popover\_menus.hide\_current\_popover\_if\_visible(instance); |
|  |  | }); |
|  |  | }, |
|  |  | onHidden(instance) { |
| Expand Down | |  |

6 changes: 3 additions & 3 deletions

6
[web/src/dropdown\_widget.ts](#diff-3d75782a024fef483d43826562d097aa9f8705902c79495d68e39547feacb562 "web/src/dropdown_widget.ts")

Show comments

[View file](/zulip/zulip/blob/0a90a13becbf0338a8fc1ad37946e51c2c25b0a5/web/src/dropdown_widget.ts)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -12,7 +12,7 @@ import \* as blueslip from "./blueslip"; |
|  |  | import \* as ListWidget from "./list\_widget"; |
|  |  | import type {ListWidget as ListWidgetType} from "./list\_widget"; |
|  |  | import {page\_params} from "./page\_params"; |
|  |  | import {default\_popover\_props} from "./popover\_menus"; |
|  |  | import \* as popover\_menus from "./popover\_menus"; |
|  |  | import type {StreamSubscription} from "./sub\_store"; |
|  |  | import {parse\_html} from "./ui\_util"; |
|  |  |  |
| Expand Down  Expand Up | | @@ -180,7 +180,7 @@ export class DropdownWidget { |
|  |  | return; |
|  |  | } |
|  |  | this.instance = tippy.delegate(delegate\_container, { |
|  |  | ...default\_popover\_props, |
|  |  | ...popover\_menus.default\_popover\_props, |
|  |  | target: this.widget\_selector, |
|  |  | // Custom theme defined in popovers.css |
|  |  | theme: "dropdown-widget", |
| Expand Down  Expand Up | | @@ -286,7 +286,7 @@ export class DropdownWidget { |
|  |  | break; |
|  |  |  |
|  |  | case "Escape": |
|  |  | instance.hide(); |
|  |  | popover\_menus.hide\_current\_popover\_if\_visible(instance); |
|  |  | this.on\_exit\_with\_escape\_callback(); |
|  |  | e.stopPropagation(); |
|  |  | e.preventDefault(); |
| Expand Down | |  |

8 changes: 4 additions & 4 deletions

8
[web/src/gear\_menu.js](#diff-e7bc813ca35c80d5826ca688920c8855795387969ead4d5271368fb1da1effc5 "web/src/gear_menu.js")

Show comments

[View file](/zulip/zulip/blob/0a90a13becbf0338a8fc1ad37946e51c2c25b0a5/web/src/gear_menu.js)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -145,13 +145,13 @@ export function initialize() { |
|  |  | }); |
|  |  | }, |
|  |  | ); |
|  |  | instance.hide(); |
|  |  | popover\_menus.hide\_current\_popover\_if\_visible(instance); |
|  |  | e.preventDefault(); |
|  |  | e.stopPropagation(); |
|  |  | }); |
|  |  |  |
|  |  | $popper.on("click", ".change-language-spectator", (e) => { |
|  |  | instance.hide(); |
|  |  | popover\_menus.hide\_current\_popover\_if\_visible(instance); |
|  |  | e.preventDefault(); |
|  |  | e.stopPropagation(); |
|  |  | settings\_preferences.launch\_default\_language\_setting\_modal(); |
| Expand All | | @@ -162,7 +162,7 @@ export function initialize() { |
|  |  | // Also, since these buttons are only visible for spectators which doesn't have events, |
|  |  | // if theme is changed in a different tab, the theme of this tab remains the same. |
|  |  | $popper.on("click", "#gear-menu-dropdown .gear-menu-select-dark-theme", (e) => { |
|  |  | instance.hide(); |
|  |  | popover\_menus.hide\_current\_popover\_if\_visible(instance); |
|  |  | e.preventDefault(); |
|  |  | e.stopPropagation(); |
|  |  | requestAnimationFrame(() => { |
| Expand All | | @@ -172,7 +172,7 @@ export function initialize() { |
|  |  | }); |
|  |  |  |
|  |  | $popper.on("click", "#gear-menu-dropdown .gear-menu-select-light-theme", (e) => { |
|  |  | instance.hide(); |
|  |  | popover\_menus.hide\_current\_popover\_if\_visible(instance); |
|  |  | e.preventDefault(); |
|  |  | e.stopPropagation(); |
|  |  | requestAnimationFrame(() => { |
| Expand Down | |  |

8 changes: 4 additions & 4 deletions

8
[web/src/left\_sidebar\_navigation\_area\_popovers.js](#diff-f99d5e25e33692b9de416d878dd83650f1c9a8c66a79cf4783cd4d949d52e466 "web/src/left_sidebar_navigation_area_popovers.js")

Show comments

[View file](/zulip/zulip/blob/0a90a13becbf0338a8fc1ad37946e51c2c25b0a5/web/src/left_sidebar_navigation_area_popovers.js)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -38,7 +38,7 @@ function common\_click\_handlers() { |
|  |  | function register\_mark\_all\_read\_handler(event) { |
|  |  | const {instance} = event.data; |
|  |  | unread\_ops.confirm\_mark\_all\_as\_read(); |
|  |  | instance.hide(); |
|  |  | popover\_menus.hide\_current\_popover\_if\_visible(instance); |
|  |  | } |
|  |  |  |
|  |  | export function initialize() { |
| Expand All | | @@ -52,7 +52,7 @@ export function initialize() { |
|  |  |  |
|  |  | $popper.one("click", "#unstar\_all\_messages", () => { |
|  |  | starred\_messages\_ui.confirm\_unstar\_all\_messages(); |
|  |  | instance.hide(); |
|  |  | popover\_menus.hide\_current\_popover\_if\_visible(instance); |
|  |  | }); |
|  |  | $popper.one("click", "#toggle\_display\_starred\_msg\_count", () => { |
|  |  | const data = {}; |
| Expand All | | @@ -63,7 +63,7 @@ export function initialize() { |
|  |  | url: "/json/settings", |
|  |  | data, |
|  |  | }); |
|  |  | instance.hide(); |
|  |  | popover\_menus.hide\_current\_popover\_if\_visible(instance); |
|  |  | }); |
|  |  | }, |
|  |  | onShow(instance) { |
| Expand Down  Expand Up | | @@ -97,7 +97,7 @@ export function initialize() { |
|  |  |  |
|  |  | $popper.one("click", "#delete\_all\_drafts\_sidebar", () => { |
|  |  | drafts.confirm\_delete\_all\_drafts(); |
|  |  | instance.hide(); |
|  |  | popover\_menus.hide\_current\_popover\_if\_visible(instance); |
|  |  | }); |
|  |  | }, |
|  |  | onShow(instance) { |
| Expand Down | |  |

20 changes: 10 additions & 10 deletions

20
[web/src/message\_actions\_popover.js](#diff-019492c805dc3b1c7814e9bfa318a9a3267e9e4d3651a1fb8c522f7d0fa3a337 "web/src/message_actions_popover.js")

Show comments

[View file](/zulip/zulip/blob/0a90a13becbf0338a8fc1ad37946e51c2c25b0a5/web/src/message_actions_popover.js)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -123,7 +123,7 @@ export function initialize() { |
|  |  | }); |
|  |  | e.preventDefault(); |
|  |  | e.stopPropagation(); |
|  |  | instance.hide(); |
|  |  | popover\_menus.hide\_current\_popover\_if\_visible(instance); |
|  |  | }); |
|  |  |  |
|  |  | $popper.one("click", ".popover\_edit\_message, .popover\_view\_source", (e) => { |
| Expand All | | @@ -133,7 +133,7 @@ export function initialize() { |
|  |  | message\_edit.start($row); |
|  |  | e.preventDefault(); |
|  |  | e.stopPropagation(); |
|  |  | instance.hide(); |
|  |  | popover\_menus.hide\_current\_popover\_if\_visible(instance); |
|  |  | }); |
|  |  |  |
|  |  | $popper.one("click", ".popover\_move\_message", (e) => { |
| Expand All | | @@ -149,15 +149,15 @@ export function initialize() { |
|  |  | ); |
|  |  | e.preventDefault(); |
|  |  | e.stopPropagation(); |
|  |  | instance.hide(); |
|  |  | popover\_menus.hide\_current\_popover\_if\_visible(instance); |
|  |  | }); |
|  |  |  |
|  |  | $popper.one("click", ".mark\_as\_unread", (e) => { |
|  |  | const message\_id = $(e.currentTarget).data("message-id"); |
|  |  | unread\_ops.mark\_as\_unread\_from\_here(message\_id); |
|  |  | e.preventDefault(); |
|  |  | e.stopPropagation(); |
|  |  | instance.hide(); |
|  |  | popover\_menus.hide\_current\_popover\_if\_visible(instance); |
|  |  | }); |
|  |  |  |
|  |  | $popper.one("click", ".popover\_toggle\_collapse", (e) => { |
| Expand All | | @@ -172,7 +172,7 @@ export function initialize() { |
|  |  | } |
|  |  | e.preventDefault(); |
|  |  | e.stopPropagation(); |
|  |  | instance.hide(); |
|  |  | popover\_menus.hide\_current\_popover\_if\_visible(instance); |
|  |  | }); |
|  |  |  |
|  |  | $popper.one("click", ".rehide\_muted\_user\_message", (e) => { |
| Expand All | | @@ -188,23 +188,23 @@ export function initialize() { |
|  |  | } |
|  |  | e.preventDefault(); |
|  |  | e.stopPropagation(); |
|  |  | instance.hide(); |
|  |  | popover\_menus.hide\_current\_popover\_if\_visible(instance); |
|  |  | }); |
|  |  |  |
|  |  | $popper.one("click", ".view\_read\_receipts", (e) => { |
|  |  | const message\_id = $(e.currentTarget).data("message-id"); |
|  |  | read\_receipts.show\_user\_list(message\_id); |
|  |  | e.preventDefault(); |
|  |  | e.stopPropagation(); |
|  |  | instance.hide(); |
|  |  | popover\_menus.hide\_current\_popover\_if\_visible(instance); |
|  |  | }); |
|  |  |  |
|  |  | $popper.one("click", ".delete\_message", (e) => { |
|  |  | const message\_id = $(e.currentTarget).data("message-id"); |
|  |  | message\_edit.delete\_message(message\_id); |
|  |  | e.preventDefault(); |
|  |  | e.stopPropagation(); |
|  |  | instance.hide(); |
|  |  | popover\_menus.hide\_current\_popover\_if\_visible(instance); |
|  |  | }); |
|  |  |  |
|  |  | $popper.one("click", ".reaction\_button", (e) => { |
| Expand All | | @@ -216,7 +216,7 @@ export function initialize() { |
|  |  | emoji\_picker.toggle\_emoji\_popover(instance.reference.parentElement, message\_id, { |
|  |  | placement: "bottom", |
|  |  | }); |
|  |  | instance.hide(); |
|  |  | popover\_menus.hide\_current\_popover\_if\_visible(instance); |
|  |  | }); |
|  |  |  |
|  |  | new ClipboardJS($popper.find(".copy\_link")[0]).on("success", () => { |
| Expand All | | @@ -226,7 +226,7 @@ export function initialize() { |
|  |  | // We unfocus this so keyboard shortcuts, etc., will work again. |
|  |  | $(":focus").trigger("blur"); |
|  |  | }, 0); |
|  |  | instance.hide(); |
|  |  | popover\_menus.hide\_current\_popover\_if\_visible(instance); |
|  |  | }); |
|  |  | }, |
|  |  | onHidden(instance) { |
| Expand Down | |  |

7 changes: 4 additions & 3 deletions

7
[web/src/message\_list\_tooltips.ts](#diff-ae51ae554ae31e15a719ffc8db29155380a209fcecd4a69caf97ff43c1348b51 "web/src/message_list_tooltips.ts")

Show comments

[View file](/zulip/zulip/blob/0a90a13becbf0338a8fc1ad37946e51c2c25b0a5/web/src/message_list_tooltips.ts)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -10,6 +10,7 @@ import render\_narrow\_tooltip from "../templates/narrow\_tooltip.hbs"; |
|  |  |  |
|  |  | import {$t} from "./i18n"; |
|  |  | import \* as message\_lists from "./message\_lists"; |
|  |  | import \* as popover\_menus from "./popover\_menus"; |
|  |  | import \* as reactions from "./reactions"; |
|  |  | import \* as rows from "./rows"; |
|  |  | import {realm} from "./state\_data"; |
| Expand Down  Expand Up | | @@ -83,7 +84,7 @@ function hide\_tooltip\_if\_reference\_removed( |
|  |  | // We have to be smart about hiding the instance, so we hide it as soon |
|  |  | // as it is displayed. |
|  |  | setTimeout(() => { |
|  |  | instance.hide(); |
|  |  | popover\_menus.hide\_current\_popover\_if\_visible(instance); |
|  |  | }, 0); |
|  |  | return; |
|  |  | } |
| Expand All | | @@ -92,11 +93,11 @@ function hide\_tooltip\_if\_reference\_removed( |
|  |  | for (const node of nodes\_to\_check\_for\_removal) { |
|  |  | // Hide instance if reference's class changes. |
|  |  | if (mutation.type === "attributes" && mutation.attributeName === "class") { |
|  |  | instance.hide(); |
|  |  | popover\_menus.hide\_current\_popover\_if\_visible(instance); |
|  |  | } |
|  |  | // Hide instance if reference is in the removed node list. |
|  |  | if (Array.prototype.includes.call(mutation.removedNodes, node)) { |
|  |  | instance.hide(); |
|  |  | popover\_menus.hide\_current\_popover\_if\_visible(instance); |
|  |  | } |
|  |  | } |
|  |  | } |
| Expand Down | |  |

2 changes: 1 addition & 1 deletion

2
[web/src/personal\_menu\_popover.js](#diff-ddea2e8e6a90b58404ab63663005081617fb3ecf917c5fbb1e32d127da033625 "web/src/personal_menu_popover.js")

Show comments

[View file](/zulip/zulip/blob/0a90a13becbf0338a8fc1ad37946e51c2c25b0a5/web/src/personal_menu_popover.js)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -71,7 +71,7 @@ export function initialize() { |
|  |  | emoji\_name: "", |
|  |  | emoji\_code: "", |
|  |  | success() { |
|  |  | instance.hide(); |
|  |  | popover\_menus.hide\_current\_popover\_if\_visible(instance); |
|  |  | }, |
|  |  | }); |
|  |  | }); |
| Expand Down | |  |

19 changes: 14 additions & 5 deletions

19
[web/src/popover\_menus.ts](#diff-a82b0ec84aca5ee44d9762c23daecd4112bf76cabb85c97e7448b336b4088eb8 "web/src/popover_menus.ts")

Show comments

[View file](/zulip/zulip/blob/0a90a13becbf0338a8fc1ad37946e51c2c25b0a5/web/src/popover_menus.ts)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -149,6 +149,15 @@ function get\_popover\_items\_for\_instance(instance: PopoverInstance): JQuery | und |
|  |  | return $current\_elem.find("a, [tabindex='0']").filter(":visible"); |
|  |  | } |
|  |  |  |
|  |  | export function hide\_current\_popover\_if\_visible(instance: PopoverInstance | null): void { |
|  |  | // Call this function instead of `instance.hide` to avoid tippy |
|  |  | // logging about the possibility of already hidden instances, |
|  |  | // which can occur when a click handler does a hide\_all(). |
|  |  | if (instance?.state.isVisible) { |
|  |  | instance.hide(); |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | export const default\_popover\_props: Partial<PopoverProps> = { |
|  |  | delay: 0, |
|  |  | appendTo: () => document.body, |
| Expand Down  Expand Up | | @@ -191,7 +200,7 @@ export const default\_popover\_props: Partial<PopoverProps> = { |
|  |  | "referenceHidden", |
|  |  | ); |
|  |  | if (is\_reference\_outside\_window) { |
|  |  | instance.hide(); |
|  |  | hide\_current\_popover\_if\_visible(instance); |
|  |  | return; |
|  |  | } |
|  |  |  |
| Expand Down  Expand Up | | @@ -250,7 +259,7 @@ export const default\_popover\_props: Partial<PopoverProps> = { |
|  |  | element.classList.contains("sticky\_header"), |
|  |  | ) |
|  |  | ) { |
|  |  | instance.hide(); |
|  |  | hide\_current\_popover\_if\_visible(instance); |
|  |  | } |
|  |  | }, |
|  |  | }, |
| Expand Down  Expand Up | | @@ -283,7 +292,7 @@ export function on\_show\_prep(instance: PopoverInstance): void { |
|  |  | $(instance.popper).one("click", ".navigate\_and\_close\_popover", (e) => { |
|  |  | // Handler for links inside popover which don't need a special click handler. |
|  |  | e.stopPropagation(); |
|  |  | instance.hide(); |
|  |  | hide\_current\_popover\_if\_visible(instance); |
|  |  | }); |
|  |  | } |
|  |  |  |
| Expand Down  Expand Up | | @@ -361,7 +370,7 @@ export function toggle\_popover\_menu( |
|  |  | ): PopoverInstance { |
|  |  | const instance = target.\_tippy; |
|  |  | if (instance) { |
|  |  | instance.hide(); |
|  |  | hide\_current\_popover\_if\_visible(instance); |
|  |  | return instance; |
|  |  | } |
|  |  |  |
| Expand Down  Expand Up | | @@ -415,7 +424,7 @@ export function register\_popover\_menu(target: string, popover\_props: Partial<Pop |
|  |  | const instance = toggle\_popover\_menu(e.currentTarget, popover\_props); |
|  |  | const $popper = $(instance.popper); |
|  |  | $popper.on("click", "a[href]", () => { |
|  |  | instance.hide(); |
|  |  | hide\_current\_popover\_if\_visible(instance); |
|  |  | }); |
|  |  | }); |
|  |  | } |
| Expand Down | |  |

6 changes: 3 additions & 3 deletions

6
[web/src/scheduled\_messages\_popover.js](#diff-a2007ef4ad24ff08d7abd30578cde8eed81517a386c56e3d5e956d2233de7763 "web/src/scheduled_messages_popover.js")

Show comments

[View file](/zulip/zulip/blob/0a90a13becbf0338a8fc1ad37946e51c2c25b0a5/web/src/scheduled_messages_popover.js)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -173,7 +173,7 @@ export function initialize() { |
|  |  | $popper.one("click", ".send\_later\_selected\_send\_later\_time", () => { |
|  |  | const send\_at\_timestamp = scheduled\_messages.get\_selected\_send\_later\_timestamp(); |
|  |  | do\_schedule\_message(send\_at\_timestamp); |
|  |  | instance.hide(); |
|  |  | popover\_menus.hide\_current\_popover\_if\_visible(instance); |
|  |  | }); |
|  |  | // Handle clicks on Enter-to-send settings |
|  |  | $popper.one("click", ".enter\_sends\_choice", (e) => { |
| Expand All | | @@ -195,13 +195,13 @@ export function initialize() { |
|  |  | }); |
|  |  | e.stopPropagation(); |
|  |  | setTimeout(() => { |
|  |  | instance.hide(); |
|  |  | popover\_menus.hide\_current\_popover\_if\_visible(instance); |
|  |  | }, ENTER\_SENDS\_SELECTION\_DELAY); |
|  |  | }); |
|  |  | // Handle Send later clicks |
|  |  | $popper.one("click", ".open\_send\_later\_modal", () => { |
|  |  | open\_send\_later\_menu(); |
|  |  | instance.hide(); |
|  |  | popover\_menus.hide\_current\_popover\_if\_visible(instance); |
|  |  | }); |
|  |  | }, |
|  |  | onHidden(instance) { |
| Expand Down | |  |

 Loading

Oops, something went wrong.
 Retry

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `0a90a13`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fzulip%2Fzulip%2Fcommit%2F0a90a13becbf0338a8fc1ad37946e51c2c25b0a5) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_79f8c0a5_20250114_185028.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fzulip%2Fzulip%2Fblob%2F8.3%2Fweb%2Fsrc%2Fclick_handlers.js)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fzulip%2Fzulip%2Fblob%2F8.3%2Fweb%2Fsrc%2Fclick_handlers.js)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=zulip%2Fzulip)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[zulip](/zulip)
/
**[zulip](/zulip/zulip)**
Public

* [Notifications](/login?return_to=%2Fzulip%2Fzulip) You must be signed in to change notification settings
* [Fork
  8.1k](/login?return_to=%2Fzulip%2Fzulip)
* [Star
   22k](/login?return_to=%2Fzulip%2Fzulip)

* [Code](/zulip/zulip/tree/8.3)
* [Issues
  1.6k](/zulip/zulip/issues)
* [Pull requests
  888](/zulip/zulip/pulls)
* [Actions](/zulip/zulip/actions)
* [Projects
  2](/zulip/zulip/projects)
* [Security](/zulip/zulip/security)
* [Insights](/zulip/zulip/pulse)

Additional navigation options

* [Code](/zulip/zulip/tree/8.3)
* [Issues](/zulip/zulip/issues)
* [Pull requests](/zulip/zulip/pulls)
* [Actions](/zulip/zulip/actions)
* [Projects](/zulip/zulip/projects)
* [Security](/zulip/zulip/security)
* [Insights](/zulip/zulip/pulse)

## Files

 8.3
## Breadcrumbs

1. [zulip](/zulip/zulip/tree/8.3)
2. /[web](/zulip/zulip/tree/8.3/web)
3. /[src](/zulip/zulip/tree/8.3/web/src)
/
# click\_handlers.js

Copy path Blame  Blame
## Latest commit

## History

[History](/zulip/zulip/commits/8.3/web/src/click_handlers.js)867 lines (752 loc) · 32.4 KB 8.3
## Breadcrumbs

1. [zulip](/zulip/zulip/tree/8.3)
2. /[web](/zulip/zulip/tree/8.3/web)
3. /[src](/zulip/zulip/tree/8.3/web/src)
/
# click\_handlers.js

Top
## File metadata and controls

* Code
* Blame

867 lines (752 loc) · 32.4 KB[Raw](https://github.com/zulip/zulip/raw/refs/tags/8.3/web/src/click_handlers.js)123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323324325326327328329330331332333334335336337338339340341342343344345346347348349350351352353354355356357358359360361362363364365366367368369370371372373374375376377378379380381382383384385386387388389390391392393394395396397398399400401402403404405406407408409410411412413414415416417418419420421422423424425426427428429430431432433434435436437438439440441442443444445446447448449450451452453454455456457458459460461462463464465466467468469470471472473474475476477478479480481482483484485486487488489490491492493494495496497498499500501502503504505506507508509510511512513514515516517518519520521522523524525526527528529530531532533534535536537538539540541542543544545546547548549550551552553554555556557558559560561562563564565566567568569570571572573574575576577578579580581582583584585586587588589590591592593594595596597598599600601602603604605606607608609610611612613614615616617618619620621622623624625626627628629630631632633634635636637638639640641642643644645646647648649650651652653654655656657658659660661662663664665666667668669670671672673674675676677678679680681682683684685686687688689690691692693694695696697698699700701702703704705706707708709710711712713714715716717718719720721722723724725726727728729730731732733734735736737738739740741742743744745746747748749750751752753754755756757758759760761762763764765766767768769770771772773774775776777778779780781782783784785786787788789790791792793794795796797798799800801802803804805806807808809810811812813814815816817818819820821822823824825826827828829830831832833834835836837838839840841842843844845846847848849850851852853854855856857858859860861862863864865866867import $ from "jquery";import tippy from "tippy.js";
// You won't find every click handler here, but it's a good place to start!
import render\_buddy\_list\_tooltip\_content from "../templates/buddy\_list\_tooltip\_content.hbs";
import \* as activity\_ui from "./activity\_ui";import \* as browser\_history from "./browser\_history";import \* as buddy\_data from "./buddy\_data";import \* as compose from "./compose";import \* as compose\_actions from "./compose\_actions";import \* as compose\_reply from "./compose\_reply";import \* as compose\_state from "./compose\_state";import {media\_breakpoints\_num} from "./css\_variables";import \* as emoji\_picker from "./emoji\_picker";import \* as hash\_util from "./hash\_util";import \* as hashchange from "./hashchange";import \* as message\_edit from "./message\_edit";import \* as message\_lists from "./message\_lists";import \* as message\_store from "./message\_store";import \* as narrow from "./narrow";import \* as narrow\_state from "./narrow\_state";import \* as navigate from "./navigate";import {page\_params} from "./page\_params";import \* as pm\_list from "./pm\_list";import \* as reactions from "./reactions";import \* as recent\_view\_ui from "./recent\_view\_ui";import \* as rows from "./rows";import \* as server\_events from "./server\_events";import \* as settings\_display from "./settings\_display";import \* as settings\_panel\_menu from "./settings\_panel\_menu";import \* as settings\_toggle from "./settings\_toggle";import \* as sidebar\_ui from "./sidebar\_ui";import \* as spectators from "./spectators";import \* as starred\_messages\_ui from "./starred\_messages\_ui";import \* as stream\_list from "./stream\_list";import \* as stream\_popover from "./stream\_popover";import \* as topic\_list from "./topic\_list";import \* as ui\_util from "./ui\_util";import {parse\_html} from "./ui\_util";import \* as user\_topics from "./user\_topics";import \* as util from "./util";
export function initialize() { // MESSAGE CLICKING
 function initialize\_long\_tap() { const MS\_DELAY = 750; const meta = { touchdown: false, current\_target: undefined, };
 $("#main\_div").on("touchstart", ".messagebox", function () { meta.touchdown = true; meta.invalid = false; const id = rows.id($(this).closest(".message\_row")); meta.current\_target = id; if (!id) { return; } message\_lists.current.select\_id(id); setTimeout(() => { // The algorithm to trigger long tap is that first, we check // whether the message is still touched after MS\_DELAY ms and // the user isn't scrolling the messages(see other touch event // handlers to see how these meta variables are handled). // Later we check whether after MS\_DELAY the user is still // long touching the same message as it can be possible that // user touched another message within MS\_DELAY period. if (meta.touchdown === true && !meta.invalid && id === meta.current\_target) { $(this).trigger("longtap"); } }, MS\_DELAY); });
 $("#main\_div").on("touchend", ".messagebox", () => { meta.touchdown = false; });
 $("#main\_div").on("touchmove", ".messagebox", () => { meta.invalid = true; });
 $("#main\_div").on("contextmenu", ".messagebox", (e) => { e.preventDefault(); }); }
 // this initializes the trigger that will give off the longtap event, which // there is no point in running if we are on desktop since this isn't a // standard event that we would want to support. if (util.is\_mobile()) { initialize\_long\_tap(); }
 function is\_clickable\_message\_element($target) { // This function defines all the elements within a message // body that have UI behavior other than starting a reply.
 // Links should be handled by the browser. if ($target.closest("a").length > 0) { return true; }
 // Forms for message editing contain input elements if ($target.is("textarea") || $target.is("input")) { return true; }
 // Widget for adjusting the height of a message. if ($target.is("button.message\_expander") || $target.is("button.message\_condenser")) { return true; }
 // Inline image, video and twitter previews. if ( $target.is("img.message\_inline\_image") || $target.is("video") || $target.is(".message\_inline\_video") || $target.is("img.twitter-avatar") ) { return true; }
 // UI elements for triggering message editing or viewing edit history. if ($target.is("i.edit\_message\_button") || $target.is(".message\_edit\_notice")) { return true; }
 // For spoilers, allow clicking either the header or elements within it if ($target.is(".spoiler-header") || $target.parents(".spoiler-header").length > 0) { return true; }
 // Ideally, this should be done via ClipboardJS, but it doesn't support // feature of stopPropagation once clicked. // See https://github.com/zenorocha/clipboard.js/pull/475 if ($target.is(".copy\_codeblock") || $target.parents(".copy\_codeblock").length > 0) { return true; }
 // Don't select message on clicking message control buttons. if ($target.parents(".message\_controls").length > 0) { return true; }
 // Allow toggling of tasks in todo widget if ( $target.is(".todo-widget label.checkbox") || $target.parents(".todo-widget label.checkbox").length > 0 ) { return true; }
 return false; }
 const select\_message\_function = function (e) { if (is\_clickable\_message\_element($(e.target))) { // If this click came from a hyperlink, don't trigger the // reply action. The simple way of doing this is simply // to call e.stopPropagation() from within the link's // click handler. // // Unfortunately, on Firefox, this breaks Ctrl-click and // Shift-click, because those are (apparently) implemented // by adding an event listener on link clicks, and // stopPropagation prevents them from being called. return; }
 if (document.getSelection().type === "Range") { // Drags on the message (to copy message text) shouldn't trigger a reply. return; }
 const $row = $(this).closest(".message\_row"); const id = rows.id($row);
 message\_lists.current.select\_id(id);
 if (message\_edit.is\_editing(id)) { // Clicks on a message being edited shouldn't trigger a reply. return; }
 // Clicks on a message from search results should bring the // user to the message's near view instead of opening the // compose box. const current\_filter = narrow\_state.filter(); if (current\_filter !== undefined && !current\_filter.supports\_collapsing\_recipients()) { const message = message\_store.get(id);
 if (message === undefined) { // This might happen for locally echoed messages, for example. return; } window.location = hash\_util.by\_conversation\_and\_time\_url(message); return; }
 if (page\_params.is\_spectator) { return; } compose\_reply.respond\_to\_message({trigger: "message click"}); e.stopPropagation(); };
 // if on normal non-mobile experience, a `click` event should run the message // selection function which will open the compose box and select the message. if (!util.is\_mobile()) { $("#main\_div").on("click", ".messagebox", select\_message\_function); // on the other hand, on mobile it should be done with a long tap. } else { $("#main\_div").on("longtap", ".messagebox", function (e) { const sel = window.getSelection(); // if one matches, remove the current selections. // after a longtap that is valid, there should be no text selected. if (sel) { if (sel.removeAllRanges) { sel.removeAllRanges(); } else if (sel.empty) { sel.empty(); } }
 select\_message\_function.call(this, e); }); }
 $("#main\_div").on("click", ".star\_container", function (e) { e.stopPropagation();
 if (page\_params.is\_spectator) { spectators.login\_to\_access(); return; }
 const message\_id = rows.id($(this).closest(".message\_row")); const message = message\_store.get(message\_id); starred\_messages\_ui.toggle\_starred\_and\_update\_server(message); });
 $("#main\_div").on("click", ".message\_reaction", function (e) { e.stopPropagation();
 if (page\_params.is\_spectator) { spectators.login\_to\_access(); return; }
 emoji\_picker.hide\_emoji\_popover(); const local\_id = $(this).attr("data-reaction-id"); const message\_id = rows.get\_message\_id(this); reactions.process\_reaction\_click(message\_id, local\_id); $(".tooltip").remove(); });
 $("body").on("click", ".reveal\_hidden\_message", (e) => { const message\_id = rows.id($(e.currentTarget).closest(".message\_row")); message\_lists.current.view.reveal\_hidden\_message(message\_id); e.stopPropagation(); e.preventDefault(); });
 $("#main\_div").on("click", "a.stream", function (e) { e.preventDefault(); // Note that we may have an href here, but we trust the stream id more, // so we re-encode the hash. const stream\_id = Number.parseInt($(this).attr("data-stream-id"), 10); if (stream\_id) { browser\_history.go\_to\_location(hash\_util.by\_stream\_url(stream\_id)); return; } window.location.href = $(this).attr("href"); });
 $("body").on("click", "#scroll-to-bottom-button-clickable-area", (e) => { e.preventDefault(); e.stopPropagation();
 navigate.to\_end(); });
 // MESSAGE EDITING
 $("body").on("click", ".edit\_content\_button, .view\_source\_button", function (e) { const $row = message\_lists.current.get\_row(rows.id($(this).closest(".message\_row"))); message\_lists.current.select\_id(rows.id($row)); message\_edit.start($row); e.stopPropagation(); }); $("body").on("click", ".move\_message\_button", function (e) { const $row = message\_lists.current.get\_row(rows.id($(this).closest(".message\_row"))); const message\_id = rows.id($row); const message = message\_lists.current.get(message\_id); stream\_popover.build\_move\_topic\_to\_stream\_popover( message.stream\_id, message.topic, false, message, ); e.stopPropagation(); }); $("body").on("click", ".always\_visible\_topic\_edit,.on\_hover\_topic\_edit", function (e) { const $recipient\_row = $(this).closest(".recipient\_row"); message\_edit.start\_inline\_topic\_edit($recipient\_row); e.stopPropagation(); }); $("body").on("click", ".topic\_edit\_save", function (e) { const $recipient\_row = $(this).closest(".recipient\_row"); message\_edit.save\_inline\_topic\_edit($recipient\_row); e.stopPropagation(); }); $("body").on("click", ".topic\_edit\_cancel", function (e) { const $recipient\_row = $(this).closest(".recipient\_row"); message\_edit.end\_inline\_topic\_edit($recipient\_row); e.stopPropagation(); }); $("body").on("click", ".message\_edit\_save", function (e) { const $row = $(this).closest(".message\_row"); message\_edit.save\_message\_row\_edit($row); e.stopPropagation(); }); $("body").on("click", ".message\_edit\_cancel", function (e) { const $row = $(this).closest(".message\_row"); message\_edit.end\_message\_row\_edit($row); e.stopPropagation(); }); $("body").on("click", ".message\_edit\_close", function (e) { const $row = $(this).closest(".message\_row"); message\_edit.end\_message\_row\_edit($row); e.stopPropagation(); }); $("body").on("click", "a", function () { if (document.activeElement === this) { ui\_util.blur\_active\_element(); } }); $("body").on("click", ".message\_edit\_form .compose\_upload\_file", function (e) { e.preventDefault();
 const row\_id = rows.id($(this).closest(".message\_row")); $(`#edit\_form\_${CSS.escape(row\_id)} .file\_input`).trigger("click"); }); $("body").on("focus", ".message\_edit\_form .message\_edit\_content", (e) => { compose\_state.set\_last\_focused\_compose\_type\_input(e.target); });
 $("body").on("click", ".message\_edit\_form .markdown\_preview", (e) => { e.preventDefault(); const $row = rows.get\_closest\_row(e.target); const $msg\_edit\_content = $row.find(".message\_edit\_content"); const content = $msg\_edit\_content.val();
 // Disable unneeded compose\_control\_buttons as we don't // need them in preview mode. $row.addClass("preview\_mode"); $row.find(".preview\_mode\_disabled .compose\_control\_button").attr("tabindex", -1);
 $msg\_edit\_content.hide(); $row.find(".markdown\_preview").hide(); $row.find(".undo\_markdown\_preview").show(); $row.find(".preview\_message\_area").show();
 compose.render\_and\_show\_preview( $row.find(".markdown\_preview\_spinner"), $row.find(".preview\_content"), content, ); });
 $("body").on("click", ".message\_edit\_form .undo\_markdown\_preview", (e) => { e.preventDefault(); const $row = rows.get\_closest\_row(e.target);
 // While in preview mode we disable unneeded compose\_control\_buttons, // so here we are re-enabling those compose\_control\_buttons $row.removeClass("preview\_mode"); $row.find(".preview\_mode\_disabled .compose\_control\_button").attr("tabindex", 0);
 $row.find(".message\_edit\_content").show(); $row.find(".undo\_markdown\_preview").hide(); $row.find(".preview\_message\_area").hide(); $row.find(".preview\_content").empty(); $row.find(".markdown\_preview").show(); });
 // RESOLVED TOPICS $("body").on("click", ".message\_header .on\_hover\_topic\_resolve", (e) => { e.stopPropagation(); const $recipient\_row = $(e.target).closest(".recipient\_row"); const message\_id = rows.id\_for\_recipient\_row($recipient\_row); const topic\_name = $(e.target).attr("data-topic-name"); message\_edit.toggle\_resolve\_topic(message\_id, topic\_name, false, $recipient\_row); });
 $("body").on("click", ".message\_header .on\_hover\_topic\_unresolve", (e) => { e.stopPropagation(); const $recipient\_row = $(e.target).closest(".recipient\_row"); const message\_id = rows.id\_for\_recipient\_row($recipient\_row); const topic\_name = $(e.target).attr("data-topic-name"); message\_edit.toggle\_resolve\_topic(message\_id, topic\_name, false, $recipient\_row); });
 // Mute topic in a unmuted stream $("body").on("click", ".message\_header .stream\_unmuted.on\_hover\_topic\_mute", (e) => { e.stopPropagation(); user\_topics.set\_visibility\_policy\_for\_element( $(e.target), user\_topics.all\_visibility\_policies.MUTED, ); });
 // Unmute topic in a unmuted stream $("body").on("click", ".message\_header .stream\_unmuted.on\_hover\_topic\_unmute", (e) => { e.stopPropagation(); user\_topics.set\_visibility\_policy\_for\_element( $(e.target), user\_topics.all\_visibility\_policies.INHERIT, ); });
 // Unmute topic in a muted stream $("body").on("click", ".message\_header .stream\_muted.on\_hover\_topic\_unmute", (e) => { e.stopPropagation(); user\_topics.set\_visibility\_policy\_for\_element( $(e.target), user\_topics.all\_visibility\_policies.UNMUTED, ); });
 // Mute topic in a muted stream $("body").on("click", ".message\_header .stream\_muted.on\_hover\_topic\_mute", (e) => { e.stopPropagation(); user\_topics.set\_visibility\_policy\_for\_element( $(e.target), user\_topics.all\_visibility\_policies.INHERIT, ); });
 // RECIPIENT BARS
 function get\_row\_id\_for\_narrowing(narrow\_link\_elem) { const $group = rows.get\_closest\_group(narrow\_link\_elem); const msg\_id = rows.id\_for\_recipient\_row($group);
 const nearest = message\_lists.current.get(msg\_id); const selected = message\_lists.current.selected\_message(); if (util.same\_recipient(nearest, selected)) { return selected.id; } return nearest.id; }
 $("#message\_feed\_container").on("click", ".narrows\_by\_recipient", function (e) { if (e.metaKey || e.ctrlKey) { return; } e.preventDefault(); const row\_id = get\_row\_id\_for\_narrowing(this); narrow.by\_recipient(row\_id, {trigger: "message header"}); });
 $("#message\_feed\_container").on("click", ".narrows\_by\_topic", function (e) { if (e.metaKey || e.ctrlKey) { return; } e.preventDefault(); const row\_id = get\_row\_id\_for\_narrowing(this); narrow.by\_topic(row\_id, {trigger: "message header"}); });
 // SIDEBARS $("#buddy-list-users-matching-view") .expectOne() .on("click", ".selectable\_sidebar\_block", (e) => { const $li = $(e.target).parents("li");
 activity\_ui.narrow\_for\_user({$li});
 e.preventDefault(); e.stopPropagation(); sidebar\_ui.hide\_userlist\_sidebar(); $(".tooltip").remove(); });
 // Doesn't show tooltip on touch devices. function do\_render\_buddy\_list\_tooltip( $elem, title\_data, get\_target\_node, check\_reference\_removed, subtree = false, parent\_element\_to\_append = null, is\_custom\_observer\_needed = true, ) { let placement = "left"; let observer; if (window.innerWidth < media\_breakpoints\_num.md) { // On small devices display tooltips based on available space. // This will default to "bottom" placement for this tooltip. placement = "auto"; } tippy($elem[0], { // Quickly display and hide right sidebar tooltips // so that they don't stick and overlap with // each other. delay: 0, // Don't show tooltip on touch devices (99% mobile) since touch pressing on users in the left or right // sidebar leads to narrow being changed and the sidebar is hidden. So, there is no user displayed // to show tooltip for. It is safe to show the tooltip on long press but it not worth // the inconvenience of having a tooltip hanging around on a small mobile screen if anything going wrong. touch: false, content: () => parse\_html(render\_buddy\_list\_tooltip\_content(title\_data)), arrow: true, placement, showOnCreate: true, onHidden(instance) { instance.destroy(); if (is\_custom\_observer\_needed) { observer.disconnect(); } }, onShow(instance) { if (!is\_custom\_observer\_needed) { return; } // We cannot use MutationObserver directly on the reference element because // it will be removed and we need to attach it on an element which will remain in the DOM. const target\_node = get\_target\_node(instance); // We only need to know if any of the `li` elements were removed. const config = {attributes: false, childList: true, subtree}; const callback = function (mutationsList) { for (const mutation of mutationsList) { // Hide instance if reference is in the removed node list. if (check\_reference\_removed(mutation, instance)) { instance.hide(); } } }; observer = new MutationObserver(callback); observer.observe(target\_node, config); }, appendTo: () => parent\_element\_to\_append || document.body, }); }
 // BUDDY LIST TOOLTIPS (not displayed on touch devices) $("#buddy-list-users-matching-view").on("mouseenter", ".selectable\_sidebar\_block", (e) => { e.stopPropagation(); const $elem = $(e.currentTarget).closest(".user\_sidebar\_entry").find(".user-presence-link"); const user\_id\_string = $elem.attr("data-user-id"); const title\_data = buddy\_data.get\_title\_data(user\_id\_string, false);
 // `target\_node` is the `ul` element since it stays in DOM even after updates. function get\_target\_node() { return document.querySelector("#buddy-list-users-matching-view"); }
 function check\_reference\_removed(mutation, instance) { return Array.prototype.includes.call( mutation.removedNodes, instance.reference.parentElement, ); }
 do\_render\_buddy\_list\_tooltip( $elem.parent(), title\_data, get\_target\_node, check\_reference\_removed, ); });
 // DIRECT MESSAGE LIST TOOLTIPS (not displayed on touch devices) $("body").on("mouseenter", ".dm-user-status", (e) => { e.stopPropagation(); const $elem = $(e.currentTarget); const user\_ids\_string = $elem.attr("data-user-ids-string"); // This converts from 'true' in the DOM to true. const is\_group = JSON.parse($elem.attr("data-is-group"));
 const title\_data = buddy\_data.get\_title\_data(user\_ids\_string, is\_group);
 // Since anything inside `#left\_sidebar\_scroll\_container` can be replaced, it is our target node here. function get\_target\_node() { return document.querySelector("#left\_sidebar\_scroll\_container"); }
 // Whole list is just replaced, so we need to check for that. function check\_reference\_removed(mutation, instance) { return Array.prototype.includes.call( mutation.removedNodes, $(instance.reference).parents(".dm-list")[0], ); }
 const check\_subtree = true; do\_render\_buddy\_list\_tooltip( $elem, title\_data, get\_target\_node, check\_reference\_removed, check\_subtree, ); });
 // Recent conversations direct messages (Not displayed on small widths) $("body").on("mouseenter", ".recent\_topic\_stream .pm\_status\_icon", (e) => { e.stopPropagation(); const $elem = $(e.currentTarget); const user\_ids\_string = $elem.attr("data-user-ids-string"); // Don't show tooltip for group direct messages. if (!user\_ids\_string || user\_ids\_string.split(",").length !== 1) { return; } const title\_data = recent\_view\_ui.get\_pm\_tooltip\_data(user\_ids\_string); const noop = () => {}; do\_render\_buddy\_list\_tooltip($elem, title\_data, noop, noop, false, undefined, false); });
 // MISC
 { const sel = [ "#stream\_filters", "#left-sidebar-navigation-list", "#buddy-list-users-matching-view", ].join(", ");
 $(sel).on("click", "a", function () { this.blur(); }); }
 $("body").on("click", ".logout\_button", () => { $("#logout\_form").trigger("submit"); });
 $(".restart\_get\_events\_button").on("click", () => { server\_events.restart\_get\_events({dont\_block: true}); });
 $("#settings\_page").on("click", ".collapse-settings-btn", () => { settings\_toggle.toggle\_org\_setting\_collapse(); });
 $("body").on("click", ".reload\_link", () => { window.location.reload(); });
 // COMPOSE
 $("body").on("click", ".empty\_feed\_compose\_stream", (e) => { compose\_actions.start("stream", {trigger: "empty feed message"}); e.preventDefault(); }); $("body").on("click", ".empty\_feed\_compose\_private", (e) => { compose\_actions.start("private", {trigger: "empty feed message"}); e.preventDefault(); });
 $("body").on("click", "[data-overlay-trigger]", function () { const target = $(this).attr("data-overlay-trigger"); browser\_history.go\_to\_location(target); });
 function handle\_compose\_click(e) { const $target = $(e.target); // Emoji clicks should be handled by their own click handler in emoji\_picker.js if ($target.is(".emoji\_map, img.emoji, .drag, .compose\_gif\_icon, .compose\_control\_menu")) { return; }
 if ($target.is("#send\_later i")) { // Since the click for this is handled by tippyjs, we cannot add stopPropagation // there without adding a special click event handler to show the popover, // so it is better just do it here. e.stopPropagation(); return; }
 // The dropdown menu needs to process clicks to open and close. if ($target.parents("#compose\_select\_recipient\_widget\_wrapper").length > 0) { return; }
 // The mobile compose button has its own popover when clicked, so it already. // hides other popovers. if ($target.is(".compose\_mobile\_button, .compose\_mobile\_button \*")) { return; } }
 $("body").on("click", "#compose-content", handle\_compose\_click);
 $("body").on("click", "#compose\_close", () => { compose\_actions.cancel(); });
 $("body").on("focus", "#compose-textarea", (e) => { compose\_state.set\_last\_focused\_compose\_type\_input(e.target); });
 // LEFT SIDEBAR
 $("body").on("click", "#clear\_search\_topic\_button", topic\_list.clear\_topic\_search);
 $(".streams\_filter\_icon").on("click", (e) => { e.stopPropagation(); stream\_list.toggle\_filter\_displayed(e); });
 $("body").on( "click", ".direct-messages-container.zoom-out #private\_messages\_section\_header", (e) => { if ($(e.target).closest("#show\_all\_private\_messages").length === 1) { // Let the browser handle the "all direct messages" widget. return; }
 e.preventDefault(); e.stopPropagation(); const $left\_sidebar\_scrollbar = $( "#left\_sidebar\_scroll\_container .simplebar-content-wrapper", ); const scroll\_position = $left\_sidebar\_scrollbar.scrollTop();
 if (stream\_list.is\_zoomed\_in()) { stream\_list.zoom\_out(); }
 // This next bit of logic is a bit subtle; this header // button scrolls to the top of the direct messages // section is uncollapsed but out of view; otherwise, we // toggle its collapsed state. if (scroll\_position === 0 || pm\_list.is\_private\_messages\_collapsed()) { pm\_list.toggle\_private\_messages\_section(); } $left\_sidebar\_scrollbar.scrollTop(0); }, );
 /\* The DIRECT MESSAGES label's click behavior is complicated; \* only when zoomed in does it have a navigation effect, so we need \* this click handler rather than just a link. \*/ $("body").on( "click", ".direct-messages-container.zoom-in #private\_messages\_section\_header", (e) => { e.preventDefault(); e.stopPropagation();
 window.location.hash = "narrow/is/dm"; }, );
 // disable the draggability for left-sidebar components $("#stream\_filters, #left-sidebar-navigation-list").on("dragstart", (e) => { e.target.blur(); return false; });
 // Chrome focuses an element when dragging it which can be confusing when // users involuntarily drag something and we show them the focus outline. $("body").on("dragstart", "a", (e) => e.target.blur());
 // Don't focus links on middle click. $("body").on("mouseup", "a", (e) => { if (e.button === 1) { // middle click e.target.blur(); } });
 // Don't focus links on context menu. $("body").on("contextmenu", "a", (e) => e.target.blur());
 $("body").on("click", ".language\_selection\_widget button", (e) => { e.preventDefault(); e.stopPropagation(); settings\_display.launch\_default\_language\_setting\_modal(); });
 $("body").on("click", "#header-container .brand", (e) => { e.preventDefault(); e.stopPropagation();
 hashchange.set\_hash\_to\_home\_view(); });
 // MAIN CLICK HANDLER
 $(document).on("click", (e) => { if (e.button !== 0 || $(e.target).is(".drag")) { // Firefox emits right click events on the document, but not on // the child nodes, so the #compose stopPropagation doesn't get a // chance to capture right clicks. return; }
 if (compose\_state.composing() && !$(e.target).parents("#compose").length) { if ( $(e.target).closest("a").length > 0 || $(e.target).closest(".copy\_codeblock").length > 0 ) { // Refocus compose message text box if one clicks an external // link/url to view something else while composing a message. // See issue #4331 for more details. // // We do the same when copying a code block, since the // most likely next action within Zulip is to paste it // into compose and modify it. $("textarea#compose-textarea").trigger("focus"); return; } else if ( !window.getSelection().toString() && // Clicking any input or text area should not close // the compose box; this means using the sidebar // filters or search widgets won't unnecessarily close // compose. !$(e.target).closest("input").length && !$(e.target).closest(".todo-widget label.checkbox").length && !$(e.target).closest("textarea").length && !$(e.target).closest("select").length && // Clicks inside an overlay, popover, custom // modal, or backdrop of one of the above // should not have any effect on the compose // state. !$(e.target).closest(".overlay").length && !$(e.target).closest(".popover").length && !$(e.target).closest(".micromodal").length && !$(e.target).closest("[data-tippy-root]").length && !$(e.target).closest(".typeahead").length && !$(e.target).closest(".flatpickr-calendar").length && $(e.target).closest("body").length ) { // Unfocus our compose area if we click out of it. Don't let exits out // of overlays or selecting text (for copy+paste) trigger cancelling. // Check if the click is within the body to prevent extensions from // interfering with the compose box. compose\_actions.cancel(); } } });
 // Workaround for Bootstrap issue #5900, which basically makes dropdowns // unclickable on mobile devices. // https://github.com/twitter/bootstrap/issues/5900 $("a.dropdown-toggle, .dropdown-menu a").on("touchstart", (e) => { e.stopPropagation(); });
 $(".settings-header.mobile .fa-chevron-left").on("click", () => { settings\_panel\_menu.mobile\_deactivate\_section(); });
 $("body").on("click", ".trigger-natural-click", (e) => { // Jquery prevents default action on anchor for `trigger("click")` // so we need to use click on element to trigger the default action. e.currentTarget.click(); });}

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


