```
Message-Id: <E1ruEzu-0003pl-M1@xenbits.xenproject.org>
Date: Tue, 09 Apr 2024 17:11:02 +0000
From: Xen.org security team <security@....org>
To: xen-announce@...ts.xen.org, xen-devel@...ts.xen.org,
 xen-users@...ts.xen.org, oss-security@...ts.openwall.com
CC: Xen.org security team <security-team-members@....org>
Subject: Xen Security Advisory 456 v2 (CVE-2024-2201) - x86: Native Branch
 History Injection
```
- **Root cause of vulnerability**: The vulnerability stems from a flaw in the branch history prediction mechanism of Intel x86 CPUs. This mechanism, designed to optimize performance, can be manipulated by an attacker to speculatively execute code at an unintended address, leading to information disclosure. The attack is referred to as Native Branch History Injection (Native-BHI), which is a variant of the Spectre-BHB vulnerability. The vulnerability is triggered when a user space process manipulates the branch history before transitioning to a higher privilege level, influencing the CPU's branch prediction and leading to speculative execution of attacker controlled code.
- **Weaknesses/vulnerabilities present**: The core weakness is the ability of an attacker to influence the branch history and thereby control speculative execution paths. Specifically, the vulnerability exploits the fact that branch history may contain branches taken in previous security contexts (e.g. user space), and in particular, in other predictor modes.
- **Impact of exploitation**: Successful exploitation allows an attacker to infer the contents of arbitrary host memory, including memory assigned to other guests. This means the attacker can bypass memory isolation and read sensitive information belonging to other virtual machines or the host system itself.
- **Attack vectors**: The attack is performed entirely from userspace, without the need for a managed runtime in the victim context. The attacker manipulates branch history via user-space code execution which then influences the branch prediction during a transition to kernel mode.
- **Required attacker capabilities/position**: The attacker needs to have the ability to execute code on a system that is vulnerable to Native-BHI. This includes access to a virtual machine or direct access to a system with a vulnerable Intel CPU. No special privileges are needed to perform the attack other than the ability to execute code.

```
Message-Id: <E1s4OMs-0002AQ-Oo@xenbits.xenproject.org>
Date: Tue, 07 May 2024 17:12:42 +0000
From: Xen.org security team <security@....org>
To: xen-announce@...ts.xen.org, xen-devel@...ts.xen.org,
 xen-users@...ts.xen.org, oss-security@...ts.openwall.com
CC: Xen.org security team <security-team-members@....org>
Subject: Xen Security Advisory 456 v3 (CVE-2024-2201) - x86: Native Branch
 History Injection
```
- **Root cause of vulnerability**: The vulnerability is a result of branch history injection on Intel x86 CPUs, where an attacker can manipulate the branch history to cause a misprediction and speculatively execute code at an arbitrary location.
- **Weaknesses/vulnerabilities present**: The core vulnerability is in the branch history prediction mechanism, which allows an attacker to control branch history and influence indirect branch predictions leading to speculative execution of attacker-controlled code.
- **Impact of exploitation**: An attacker can infer the contents of arbitrary host memory, including memory assigned to other guests, potentially gaining access to sensitive data.
- **Attack vectors**: The attack is launched from user space, without needing a managed runtime in the victim context. It involves manipulating branch history before a context switch to a more privileged mode (kernel or hypervisor).
- **Required attacker capabilities/position**: An attacker needs the ability to execute code on a vulnerable Intel x86 system. This includes the ability to execute code within a guest VM to target the hypervisor or other guest VMs.

```
Subject: [SECURITY] Fedora 38 Update: xen-4.17.4-1.fc38
```
- This content is related to the CVE as it mentions "x86: Native Branch History Injection [XSA-456, CVE-2024-2201]"
- It also provides information regarding an update to Xen version 4.17.4 that addresses this vulnerability, along with other issues.
- This content does not provide specific technical details about the vulnerability itself.

```
Subject: [SECURITY] Fedora 40 Update: xen-4.18.2-1.fc40
```
- This content is related to the CVE as it mentions "x86: Native Branch History Injection [XSA-456, CVE-2024-2201]"
- It also provides information regarding an update to Xen version 4.18.2 that addresses this vulnerability, along with other issues.
- This content does not provide specific technical details about the vulnerability itself.

```
Subject: [SECURITY] Fedora 39 Update: xen-4.17.4-1.fc39
```
- This content is related to the CVE as it mentions "x86: Native Branch History Injection [XSA-456, CVE-2024-2201]"
- It also provides information regarding an update to Xen version 4.17.4 that addresses this vulnerability, along with other issues.
- This content does not provide specific technical details about the vulnerability itself.

```
## CERT Coordination Center
#### Vulnerability Note VU#155143
## Linux kernel on Intel systems is susceptible to Spectre v2 attacks
```
- **Root cause of vulnerability**: The vulnerability is a cross-privilege Spectre v2 attack, specifically branch history injection (BHI). Modern CPUs using speculative execution are affected. An attacker can exploit speculative execution of indirect branches to leak privileged memory.
- **Weaknesses/vulnerabilities present**: The vulnerability lies in the CPU's speculative execution and branch prediction mechanisms, specifically how indirect branch predictions are handled, which can be influenced by an attacker. The vulnerability is triggered via a chosen gadget by manipulating branch prediction.
- **Impact of exploitation**: An attacker with access to CPU resources can potentially read arbitrary privileged data or system registry values. This results from speculatively jumping to a chosen gadget.
- **Attack vectors**: Attackers leverage speculative execution of indirect branch predictors, which can be steered to attacker-chosen gadget code. This involves poisoning the branch target buffer of the CPU. Current mitigations like disabling privileged eBPF and enabling IBT are insufficient to stop BHI.
- **Required attacker capabilities/position**: An attacker needs to be able to execute code on the target CPU to manipulate speculative execution. No special privileges other than this are explicitly required for the exploit.

```
# Branch History Injection and Intra-mode Branch Target Injection / CVE-2022-0001, CVE-2022-0002 / INTEL-SA-00598
```
- **Root cause of vulnerability**: Branch History Injection (BHI) is a specific form of intra-mode Branch Target Injection (BTI), where an attacker manipulates the branch history to cause an indirect branch predictor to select a specific entry, leading to speculative execution of a disclosure gadget at the predicted target. Intra-mode BTI (IMBTI) is a related variant of BTI where a branch speculates to an aliased predictor entry for a different branch in the same predictor mode.
- **Weaknesses/vulnerabilities present**: The core vulnerability lies in the CPU's speculative execution of indirect branches based on the branch history, which can be manipulated by an attacker. This allows the attacker to control the flow of speculative execution and cause the execution of a disclosure gadget.
- **Impact of exploitation**: An attacker may cause a disclosure gadget to be speculatively executed leading to the disclosure of sensitive information.
- **Attack vectors**: The attacker manipulates branch history before transitioning from user to supervisor or guest to VMX root mode. The attacker exploits the fact that branch history may contain branches taken in previous security contexts and predictor modes.
- **Required attacker capabilities/position**: An attacker needs to be able to run code on the same machine or virtual machine as the data they are attempting to read. The attacker needs the ability to influence branch history before transitioning to a more privileged context.

```
# InSpectre Gadget
```
- This content is related to the CVE as the tool was designed to analyze and find Spectre disclosure gadgets. It mentions the "InSpectre Gadget" paper which is related to the research that discovered Native-BHI.
- This content does not directly contain vulnerability information but it does provide context and information related to the discovery of exploitable gadgets.
- It is a tool for inspecting potential Spectre disclosure gadgets and performing exploitability analysis. It was developed by the same researchers who discovered the vulnerability.

Based on the provided content, the following can be concluded about CVE-2024-2201:

- It is a vulnerability related to Branch History Injection (BHI) on Intel x86 CPUs.
- An attacker can manipulate the branch history to influence speculative execution and potentially leak sensitive information from the host system or other guest VMs.
- The vulnerability can be exploited from user space.
- The vulnerability affects a wide range of Intel CPUs, especially those with Enhanced IBRS (eIBRS).
- There are mitigations available that involve microcode updates and changes to the hypervisor.

The provided content contains more details than the typical CVE description by providing information about the root cause, the specific CPU microarchitectural weakness being exploited, and the detailed attack vectors and attacker capabilities.