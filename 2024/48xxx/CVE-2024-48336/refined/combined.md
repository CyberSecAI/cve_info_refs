=== Content from github.com_5e2c2a1e_20250115_095856.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftopjohnwu%2FMagisk%2Fcommit%2Fc2eb6039579b8a2fb1e11a753cea7662c07bec02)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftopjohnwu%2FMagisk%2Fcommit%2Fc2eb6039579b8a2fb1e11a753cea7662c07bec02)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=topjohnwu%2FMagisk)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[topjohnwu](/topjohnwu)
/
**[Magisk](/topjohnwu/Magisk)**
Public

* [Notifications](/login?return_to=%2Ftopjohnwu%2FMagisk) You must be signed in to change notification settings
* [Fork
  12.9k](/login?return_to=%2Ftopjohnwu%2FMagisk)
* [Star
   50.2k](/login?return_to=%2Ftopjohnwu%2FMagisk)

* [Code](/topjohnwu/Magisk)
* [Issues
  35](/topjohnwu/Magisk/issues)
* [Pull requests
  4](/topjohnwu/Magisk/pulls)
* [Actions](/topjohnwu/Magisk/actions)
* [Security](/topjohnwu/Magisk/security)
* [Insights](/topjohnwu/Magisk/pulse)

Additional navigation options

* [Code](/topjohnwu/Magisk)
* [Issues](/topjohnwu/Magisk/issues)
* [Pull requests](/topjohnwu/Magisk/pulls)
* [Actions](/topjohnwu/Magisk/actions)
* [Security](/topjohnwu/Magisk/security)
* [Insights](/topjohnwu/Magisk/pulse)

## Commit

[Permalink](/topjohnwu/Magisk/commit/c2eb6039579b8a2fb1e11a753cea7662c07bec02)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Require GMS to be system app

[Browse files](/topjohnwu/Magisk/tree/c2eb6039579b8a2fb1e11a753cea7662c07bec02)
Browse the repository at this point in the history

```
Fixes [#8279](https://github.com/topjohnwu/Magisk/issues/8279).
```

* Loading branch information

[![@aviraxp](https://avatars.githubusercontent.com/u/18079988?s=40&v=4)](/aviraxp) [![@topjohnwu](https://avatars.githubusercontent.com/u/7337301?s=40&v=4)](/topjohnwu)

[aviraxp](/topjohnwu/Magisk/commits?author=aviraxp "View all commits by aviraxp")
authored and
[topjohnwu](/topjohnwu/Magisk/commits?author=topjohnwu "View all commits by topjohnwu")
committed
Aug 20, 2024

1 parent
[e6bd2ff](/topjohnwu/Magisk/commit/e6bd2ff60f4f3a9375138d92714c0b61de3340fa)

commit c2eb603

Showing
**1 changed file**
with
**10 additions**
and
**1 deletion**.

* Whitespace
* Ignore whitespace

* Split
* Unified

## There are no files selected for viewing

11 changes: 10 additions & 1 deletion

11
[app/shared/src/main/java/com/topjohnwu/magisk/ProviderInstaller.java](#diff-94d2edc241feaaf5a13450a459267c149fed6d894faa8b7abdb2ea2e3876f4e6 "app/shared/src/main/java/com/topjohnwu/magisk/ProviderInstaller.java")

Show comments

[View file](/topjohnwu/Magisk/blob/c2eb6039579b8a2fb1e11a753cea7662c07bec02/app/shared/src/main/java/com/topjohnwu/magisk/ProviderInstaller.java)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -1,13 +1,22 @@ |
|  |  | package com.topjohnwu.magisk; |
|  |  |  |
|  |  | import android.content.Context; |
|  |  | import android.content.pm.ApplicationInfo; |
|  |  |  |
|  |  | public class ProviderInstaller { |
|  |  |  |
|  |  | private static final String GMS\_PACKAGE\_NAME = "com.google.android.gms"; |
|  |  |  |
|  |  | public static boolean install(Context context) { |
|  |  | try { |
|  |  | // Check if gms is a system app |
|  |  | ApplicationInfo appInfo = context.getPackageManager().getApplicationInfo(GMS\_PACKAGE\_NAME, 0); |
|  |  | if ((appInfo.flags & ApplicationInfo.FLAG\_SYSTEM) == 0) { |
|  |  | return false; |
|  |  | } |
|  |  |  |
|  |  | // Try installing new SSL provider from Google Play Service |
|  |  | Context gms = context.createPackageContext("com.google.android.gms", |
|  |  | Context gms = context.createPackageContext(GMS\_PACKAGE\_NAME, |
|  |  | Context.CONTEXT\_INCLUDE\_CODE | Context.CONTEXT\_IGNORE\_SECURITY); |
|  |  | gms.getClassLoader() |
|  |  | .loadClass("com.google.android.gms.common.security.ProviderInstallerImpl") |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 1 comment on commit `c2eb603`

[![@Diapolo](https://avatars.githubusercontent.com/u/1419649?s=80&v=4)](/Diapolo)

Copy link

### @Diapolo **[Diapolo](/Diapolo)** commented on `[c2eb603](/topjohnwu/Magisk/commit/c2eb6039579b8a2fb1e11a753cea7662c07bec02)` [Aug 28, 2024](#commitcomment-145941820)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

[@topjohnwu](https://github.com/topjohnwu) Does this impose any implications for users which are relying on microG (<https://github.com/microg/GmsCore>)?

Sorry, something went wrong.

All reactions

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftopjohnwu%2FMagisk%2Fcommit%2Fc2eb6039579b8a2fb1e11a753cea7662c07bec02) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_f801d3aa_20250115_095854.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fcanyie%2FMagiskEoP)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fcanyie%2FMagiskEoP)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E&source=header-repo&source_repo=canyie%2FMagiskEoP)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[canyie](/canyie)
/
**[MagiskEoP](/canyie/MagiskEoP)**
Public

* [Notifications](/login?return_to=%2Fcanyie%2FMagiskEoP) You must be signed in to change notification settings
* [Fork
  30](/login?return_to=%2Fcanyie%2FMagiskEoP)
* [Star
   183](/login?return_to=%2Fcanyie%2FMagiskEoP)

Exploit and writeup for installed app to root privilege escalation through CVE-2024-48336 (Magisk Bug #8279), Privileges Escalation / Arbitrary Code Execution Vulnerability

[183
stars](/canyie/MagiskEoP/stargazers) [30
forks](/canyie/MagiskEoP/forks) [Branches](/canyie/MagiskEoP/branches) [Tags](/canyie/MagiskEoP/tags) [Activity](/canyie/MagiskEoP/activity)
 [Star](/login?return_to=%2Fcanyie%2FMagiskEoP)

 [Notifications](/login?return_to=%2Fcanyie%2FMagiskEoP) You must be signed in to change notification settings

* [Code](/canyie/MagiskEoP)
* [Issues
  0](/canyie/MagiskEoP/issues)
* [Pull requests
  0](/canyie/MagiskEoP/pulls)
* [Actions](/canyie/MagiskEoP/actions)
* [Projects
  0](/canyie/MagiskEoP/projects)
* [Security](/canyie/MagiskEoP/security)
* [Insights](/canyie/MagiskEoP/pulse)

Additional navigation options

* [Code](/canyie/MagiskEoP)
* [Issues](/canyie/MagiskEoP/issues)
* [Pull requests](/canyie/MagiskEoP/pulls)
* [Actions](/canyie/MagiskEoP/actions)
* [Projects](/canyie/MagiskEoP/projects)
* [Security](/canyie/MagiskEoP/security)
* [Insights](/canyie/MagiskEoP/pulse)

# canyie/MagiskEoP

    main[Branches](/canyie/MagiskEoP/branches)[Tags](/canyie/MagiskEoP/tags)Go to fileCode
## Folders and files

| Name | | Name | Last commit message | Last commit date |
| --- | --- | --- | --- | --- |
| Latest commit History[3 Commits](/canyie/MagiskEoP/commits/main/) | | |
| [.idea](/canyie/MagiskEoP/tree/main/.idea ".idea") | | [.idea](/canyie/MagiskEoP/tree/main/.idea ".idea") |  |  |
| [app](/canyie/MagiskEoP/tree/main/app "app") | | [app](/canyie/MagiskEoP/tree/main/app "app") |  |  |
| [gradle/wrapper](/canyie/MagiskEoP/tree/main/gradle/wrapper "This path skips through empty directories") | | [gradle/wrapper](/canyie/MagiskEoP/tree/main/gradle/wrapper "This path skips through empty directories") |  |  |
| [.gitignore](/canyie/MagiskEoP/blob/main/.gitignore ".gitignore") | | [.gitignore](/canyie/MagiskEoP/blob/main/.gitignore ".gitignore") |  |  |
| [README.md](/canyie/MagiskEoP/blob/main/README.md "README.md") | | [README.md](/canyie/MagiskEoP/blob/main/README.md "README.md") |  |  |
| [build.gradle](/canyie/MagiskEoP/blob/main/build.gradle "build.gradle") | | [build.gradle](/canyie/MagiskEoP/blob/main/build.gradle "build.gradle") |  |  |
| [gradle.properties](/canyie/MagiskEoP/blob/main/gradle.properties "gradle.properties") | | [gradle.properties](/canyie/MagiskEoP/blob/main/gradle.properties "gradle.properties") |  |  |
| [gradlew](/canyie/MagiskEoP/blob/main/gradlew "gradlew") | | [gradlew](/canyie/MagiskEoP/blob/main/gradlew "gradlew") |  |  |
| [gradlew.bat](/canyie/MagiskEoP/blob/main/gradlew.bat "gradlew.bat") | | [gradlew.bat](/canyie/MagiskEoP/blob/main/gradlew.bat "gradlew.bat") |  |  |
| [screen-20220302-093745.mp4](/canyie/MagiskEoP/blob/main/screen-20220302-093745.mp4 "screen-20220302-093745.mp4") | | [screen-20220302-093745.mp4](/canyie/MagiskEoP/blob/main/screen-20220302-093745.mp4 "screen-20220302-093745.mp4") |  |  |
| [settings.gradle](/canyie/MagiskEoP/blob/main/settings.gradle "settings.gradle") | | [settings.gradle](/canyie/MagiskEoP/blob/main/settings.gradle "settings.gradle") |  |  |
| View all files | | |

## Repository files navigation

* README
## Introduction

This is an exploit for a vulnerability CVE-2024-48336 in Magisk app that allows a local app to silently gain root access without user consent.

Vulnerability was initially reported by [@vvb2060](https://github.com/vvb2060) and PoC-ed by [@canyie](https://github.com/canyie). It has been fixed in Canary 27007.

Demo video for exploit this vulnerability to silently obtaining root privileges and granting root to any app: <https://github.com/canyie/MagiskEoP/blob/main/screen-20220302-093745.mp4>

Steps to reproduce this vulnerability:

1. Install vulnerable Magisk app builds on a device that has no GMS preinstalled
2. Install this exploit app
3. Force stop Magisk app and this exploit app
4. Open Magisk app
5. Open this exploit app, type your commands and press Execute to execute them with root privileges

## Vulnerability Info

Name: Magisk App Arbitrary Code Execution Vulnerability

Alias: Magisk Privilege Escalation Vulnerability

### The Basics

Product: Magisk

CVE: [CVE-2024-48336](https://nvd.nist.gov/vuln/detail/CVE-2024-48336)

Reporter: [@vvb2060](https://github.com/vvb2060)

Initial Report Date: 2024-08-01

Patch Date: 2024-08-21

Disclosure Date: 2024-08-24

Affected Versions: Manager v7.0.0 ~ Canary 27006

First Patched Versions: Canary 27007

Issue/Bug report: [topjohnwu/Magisk#8279](https://github.com/topjohnwu/Magisk/issues/8279)

Patch CL: <https://github.com/topjohnwu/Magisk/commit/c2eb6039579b8a2fb1e11a753cea7662c07bec02>

Bug-introducing CL: <https://github.com/topjohnwu/Magisk/commit/920b60da19212dd8d54d27ada77a30067ce50de6>

Bug Class: Unsafe Dynamic External Code Loading

Weakness Enumerations:

* [CWE-386: Symbolic Name not Mapping to Correct Object](https://cwe.mitre.org/data/definitions/386.html)
* [CWE-829: Inclusion of Functionality from Untrusted Control Sphere](https://cwe.mitre.org/data/definitions/829.html)

### Summary

The install() function of ProviderInstaller.java in Magisk App before canary version 27007 does not verify the GMS app before loading it, which allows a local untrusted app with no additional privileges to silently execute arbitrary code in the Magisk app and escalate privileges to root via a crafted package, aka Bug #8279. User interaction is not needed for exploitation.

### Details

Old Android versions do not support some algorithms. To make Magisk work properly on these platforms, it tries to load conscrypt from GMS by calling [createCallingContext()](https://developer.android.com/reference/android/content/Context#createPackageContext(java.lang.String,%20int)). Check this link for more details: <https://t.me/vvb2060Channel/692>

However, GMS is not always preinstalled on all devices. Magisk assumes that loading code from GMS is always safe, however attackers can create a fake malicious app with the same package name. When Magisk app is launched, malicious code will get executed in Magisk app. Since Magisk app is always granted root access, this allows attackers to silently gain root access and execute arbitrary code with root privileges without user acceptance.

### Vulnerable Devices

* Devices with no GMS preinstalled
* Devices with broken signature verification implementation (e.g. Disabled by CorePatch)

Note: This issue is fixed in Canary 27007 by ensuring GMS is a system app before loading it. However, it's still possible to exploit this issue on devices with pre-installed GMS but have broken signature verification implementations (e.g. CorePatch).

Note 2: Although a fix for this issue is present in the official Magisk app, there are many other instances of similar code exist in other apps without a proper fix such as [this](https://github.com/Fox2Code/FoxMagiskModuleManager/blob/master/app/src/main/java/com/fox2code/mmm/utils/io/GMSProviderInstaller.java#L51) and [this](https://github.com/vvb2060/KeyAttestation/blob/master/app/src/main/java/io/github/vvb2060/keyattestation/AppApplication.kt#L37). This potentially allows an arbitrary code execution in vulnerable apps and potentially allows attackers to gain root access again if it is granted to victim apps.

## About

Exploit and writeup for installed app to root privilege escalation through CVE-2024-48336 (Magisk Bug #8279), Privileges Escalation / Arbitrary Code Execution Vulnerability

### Resources

[Readme](#readme-ov-file)

[Activity](/canyie/MagiskEoP/activity)
### Stars

[**183**
stars](/canyie/MagiskEoP/stargazers)
### Watchers

[**8**
watching](/canyie/MagiskEoP/watchers)
### Forks

[**30**
forks](/canyie/MagiskEoP/forks)
[Report repository](/contact/report-content?content_url=https%3A%2F%2Fgithub.com%2Fcanyie%2FMagiskEoP&report=canyie+%28user%29)

## [Releases](/canyie/MagiskEoP/releases)

No releases published

## [Packages 0](/users/canyie/packages?repo_name=MagiskEoP)

No packages published

## Languages

* [Java
  100.0%](/canyie/MagiskEoP/search?l=java)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


