=== Content from www.telekom.com_4f9252f1_20250114_181618.html ===
Remote buffer overflow vulnerability
in SharkSSL TLS Client Key Exchange handshake processing
CVE-2024-48075

by Mauritz van den Bosch (mauritz.vandenbosch@telekom.de) and
Robert Hörr (robert.hoerr@telekom.de)

A new remote buffer overflow vulnerability was discovered in the latest version of the SharkSSL library
from 09.09.2024 (https://github.com/RealTimeLogic/SharkSSL) by security evaluators of Deutsche
Telekom Security GmbH and Deutsche Telekom AG with modern fuzzing methods. The vulnerability allows
an attacker to trigger the reading of unallocated memory in the SharkSSL TLS server’s memory. This is
likely to result in a segmentation fault and can be used for a remote Denial-of-Service attack by an
attacker.
Special thanks to Robert Hörr for his support, supervision and guidance during this research.

What is the SharkSSL library?

SharkSSL is an open-source software that provides security implementations of various protocols,
including TLS, WebSocket, MQTT, SMTP etc. for embedded devices, but SharkSSL is not exclusive to this
field of application. Specifically, TLS is a security protocol to ensure communication between two
endpoints over a network like the Internet in a secure way, thus an attacker is not able to read or modify
the exchanged data.

How was the vulnerability discovered?

Software projects usually gain complexity over time, especially when many additional features are
introduced. Therefore, it is hard to perform source code reviews manually by humans with reasonable
coverage in a feasible time. For this reason, modern fuzzing methods are utilized to discover vulnerabilities
like buffer overflows automatically. Among others, libFuzzer and AdressSanitizer have been used for
automatically testing this software. LibFuzzer is a code-coverage based fuzzer and has been combined
with AdressSanitizer, which detects memory errors at runtime. The TLS handshake implementation of
SharkSSL has been tested using these two combined methods.

Where is the vulnerability located in the source code?

The vulnerability is located in the TLSv1.2 server-site handshake implementation for processing a
received TLS Client Key Exchange message. The function seSec_handshake performs the TLS handshake
using the socket and context information about the TLS connection. This function invokes the function
SharkSslCon_decrypt which parses the received TLS Client Key Exchange message. That function uses
the pointer registeredevent for parsing the content of the received message. In the case of a
fragmented TLS Client Key Exchange message, the code location is reached, where the pointer
registeredevent is manipulated, and this sets up the overflow:

There, the unsigned 16-bit integer variable backupdata is set to the current value referenced by
registeredevent. Afterwards this variable is subtracted by 4, and the pointer registeredevent is

added to the current value of backupdata.
Since the pointer is referring to the received TLS Client Key Exchange message, the value of the variable
backupdata is dependent on the message data. This means the TLS Client Key Exchange message data is
attacker-controlled and can lead to a high value of backupdata. This high value is added to the pointer
registeredevent which most likely references an unallocated memory region. At a later point within
SharkSslCon_decrypt‘s control-flow, registeredevent is dereferenced, and the overflow is triggered.
In the Appendix, the described code locations are presented.

How is the vulnerability exploitable by an attacker?

The vulnerability can be used to trigger one or many reads of memory locations beyond the allocated
buffer. Usually, these accesses to memory result in segmentation faults and lead to the termination of the
program. This can be exploited to perform a remote Denial-of-Service attack against the SharkSSL TLS
server and implies that clients are not able to connect to the TLS server anymore. Especially in the context
of Operational-Technology (OT), where SharkSSL seems to be used, availability is an important objective.
The controlled manipulations of the pointer registeredevent might be used to trigger an information
leak at later points of the control flow. By utilizing write instructions, e.g. memcpy or internal functions,
Remote-code-Execution might be possible.

What do we learn from this?

Code-coverage based fuzzing combined with the AddressSanitizer is a powerful method to discover
vulnerabilities, like buffer overflows. With increasingly complex source codes, it is a resource efficient
alternative to source code reviews because this fuzzing approach can be done mainly automatically. As
there are many approaches to fuzzing, it is the art of fuzzing to find the best approach. We have already
discovered several vulnerabilities with our fuzzing approach.

Appendix: Code Section with pointer addition
This is the section of SharkSSL.c that prepares the buffer overflow. The pointer registeredevent
is not dereferenced here, but it is added by a value controlled by the TLS Client Key Exchange
message.

21221 if (o->flags & SHARKSSL_FLAG_FRAGMENTED_HS_RECORD){
[…]
21230 backuppdata = ((U16)(* registeredevent++)) << 8;
21231 backuppdata += *registeredevent++ - 4;
21232 registeredevent += backuppdata;
21233 }

Appendix: Code section with pointer dereference
This example shows the dereference of the pointer registeredevent that is triggering the buffer
overflow.

21317 if ((o->major) || (0 == (*registeredevent & 0x80)) || SharkSsl_isClient(o→sharkSsl))
21318 {
21319 regsetcopyin = *registeredevent++;
[…]

Appendix: AddressSanitizer output

Below is the output from AddressSanitizer on accessing a memory location beyond the allocated memory.
This is triggered by a fragmented TLS Client Key Exchange message. The shown location within
SharkSSLCon_decrypt might not be the only location triggering the overflow. The root cause is the
attacker-controlled addition of the pointer registeredevent as discussed above.

==511345==ERROR: AddressSanitizer: SEGV on unknown address 0x621000010121 (pc
0x65435ade3750 bp 0x7ffcd2da81f0 sp 0x7ffcd2da7680 T0)
==511345==The signal is caused by a READ memory access.
#0 0x65435ade3750 in SharkSslCon_decrypt SharkSSL/src/SharkSSL.c:21319:22
#1 0x65435ae05994 in seSec_readOrHandshake selib.c
#2 0x65435adf72db in LLVMFuzzerTestOneInput
#3 0x65435ac47212 in fuzzer::Fuzzer::ExecuteCallback
#4 0x65435ac31090 in fuzzer::RunOneTest
#5 0x65435ac36d57 in fuzzer::FuzzerDriver
#6 0x65435ac60372 in main
#7 0x716fab829d8f in __libc_start_call_main
#8 0x716fab829e3f in __libc_start_main csu/../csu/libc-start.c:392:3
#9 0x65435ac2ba34 in _start



=== Content from github.com_c1e61c53_20250114_181617.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FRealTimeLogic%2FSharkSSL%2Fcommit%2F7045f6f254060640ff77eef2027f108fcc20e2f2)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FRealTimeLogic%2FSharkSSL%2Fcommit%2F7045f6f254060640ff77eef2027f108fcc20e2f2)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=RealTimeLogic%2FSharkSSL)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[RealTimeLogic](/RealTimeLogic)
/
**[SharkSSL](/RealTimeLogic/SharkSSL)**
Public

* [Notifications](/login?return_to=%2FRealTimeLogic%2FSharkSSL) You must be signed in to change notification settings
* [Fork
  5](/login?return_to=%2FRealTimeLogic%2FSharkSSL)
* [Star
   14](/login?return_to=%2FRealTimeLogic%2FSharkSSL)

* [Code](/RealTimeLogic/SharkSSL)
* [Issues
  0](/RealTimeLogic/SharkSSL/issues)
* [Pull requests
  0](/RealTimeLogic/SharkSSL/pulls)
* [Actions](/RealTimeLogic/SharkSSL/actions)
* [Projects
  0](/RealTimeLogic/SharkSSL/projects)
* [Security](/RealTimeLogic/SharkSSL/security)
* [Insights](/RealTimeLogic/SharkSSL/pulse)

Additional navigation options

* [Code](/RealTimeLogic/SharkSSL)
* [Issues](/RealTimeLogic/SharkSSL/issues)
* [Pull requests](/RealTimeLogic/SharkSSL/pulls)
* [Actions](/RealTimeLogic/SharkSSL/actions)
* [Projects](/RealTimeLogic/SharkSSL/projects)
* [Security](/RealTimeLogic/SharkSSL/security)
* [Insights](/RealTimeLogic/SharkSSL/pulse)

## Commit

[Permalink](/RealTimeLogic/SharkSSL/commit/7045f6f254060640ff77eef2027f108fcc20e2f2)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Update SharkSSL.c

[Browse files](/RealTimeLogic/SharkSSL/tree/7045f6f254060640ff77eef2027f108fcc20e2f2)
Browse the repository at this point in the history

* Loading branch information

[![@RTL-pub](https://avatars.githubusercontent.com/u/24235755?s=40&v=4)](/RTL-pub)

[RTL-pub](/RealTimeLogic/SharkSSL/commits?author=RTL-pub "View all commits by RTL-pub")
committed
Sep 9, 2024

1 parent
[c585490](/RealTimeLogic/SharkSSL/commit/c585490e9567733095d3134eadc054bcc7cec34e)

commit 7045f6f

Showing
**1 changed file**
with
**25 additions**
and
**0 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

## There are no files selected for viewing

25 changes: 25 additions & 0 deletions

25
[src/SharkSSL.c](#diff-634efed2df9a2a402696510d7faef3f83ba457a4d51ec4f3fb861805324c3cd2 "src/SharkSSL.c")

Show comments

[View file](/RealTimeLogic/SharkSSL/blob/7045f6f254060640ff77eef2027f108fcc20e2f2/src/SharkSSL.c)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -2687,6 +2687,11 @@ static int handleptrauth(SharkSslCon\* o, U8\* registeredevent, U16 len) |
|  |  | { |
|  |  | U8 savedsigmask; |
|  |  |  |
|  |  | if (paramnamed < 2) |
|  |  | { |
|  |  | SHARKDBG\_PRINTF(("\045\163\072\040\045\144\012", \_\_FILE\_\_, \_\_LINE\_\_)); |
|  |  | return -1; |
|  |  | } |
|  |  |  |
|  |  | prminstwrite = (U16)(\*registeredevent++) << 8; |
|  |  | prminstwrite += \*registeredevent++; |
| Expand Down  Expand Up | | @@ -2805,6 +2810,11 @@ static int handleptrauth(SharkSslCon\* o, U8\* registeredevent, U16 len) |
|  |  | #endif |
|  |  |  |
|  |  | default: |
|  |  | if (len < paramnamed) |
|  |  | { |
|  |  | SHARKDBG\_PRINTF(("\045\163\072\040\045\144\012", \_\_FILE\_\_, \_\_LINE\_\_)); |
|  |  | return -1; |
|  |  | } |
|  |  | len -= paramnamed; |
|  |  | registeredevent += paramnamed; |
|  |  | break; |
| Expand Down  Expand Up | | @@ -2919,6 +2929,11 @@ static int dfbmcs320device(SharkSslCon\* o, U8\* registeredevent, U16 len) |
|  |  | case clkdmclear: |
|  |  | if (paramnamed) |
|  |  | { |
|  |  | if (len < 2) |
|  |  | { |
|  |  | SHARKDBG\_PRINTF(("\045\163\072\040\045\144\012", \_\_FILE\_\_, \_\_LINE\_\_)); |
|  |  | return -1; |
|  |  | } |
|  |  | paramnamed = (U16)(\*registeredevent++) << 8; |
|  |  | paramnamed += \*registeredevent++; |
|  |  | len -= 2; |
| Expand Down  Expand Up | | @@ -3047,6 +3062,11 @@ static int dfbmcs320device(SharkSslCon\* o, U8\* registeredevent, U16 len) |
|  |  | if (SharkSsl\_isServer(o->sharkSsl)) |
|  |  | { |
|  |  |  |
|  |  | if (len < paramnamed) |
|  |  | { |
|  |  | SHARKDBG\_PRINTF(("\045\163\072\040\045\144\012", \_\_FILE\_\_, \_\_LINE\_\_)); |
|  |  | return -1; |
|  |  | } |
|  |  | len -= paramnamed; |
|  |  | registeredevent += paramnamed; |
|  |  | } |
| Expand All | | @@ -3073,6 +3093,11 @@ static int dfbmcs320device(SharkSslCon\* o, U8\* registeredevent, U16 len) |
|  |  |  |
|  |  | default: |
|  |  |  |
|  |  | if (len < paramnamed) |
|  |  | { |
|  |  | SHARKDBG\_PRINTF(("\045\163\072\040\045\144\012", \_\_FILE\_\_, \_\_LINE\_\_)); |
|  |  | return -1; |
|  |  | } |
|  |  | len -= paramnamed; |
|  |  | registeredevent += paramnamed; |
|  |  | break; |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `7045f6f`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FRealTimeLogic%2FSharkSSL%2Fcommit%2F7045f6f254060640ff77eef2027f108fcc20e2f2) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


