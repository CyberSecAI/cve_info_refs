=== Content from www.wordfence.com_30742d04_20250114_192422.html ===


[![](https://www.wordfence.com/img/wordfence-intelligence-logo.svg)](/threat-intel/)

Have you found a vulnerability in a WordPress plugin or theme? Report vulnerabilities in WordPress plugins and themes through our [bug bounty program](https://www.wordfence.com/threat-intel/bug-bounty-program) and earn a bounty on all in-scope submissions, while we handle the responsible disclosure process on your behalf.

As a reminder, the Wordfence Intelligence Vulnerability Database API is completely free to query and utilize, both personally and commercially, and contains all the same vulnerability data as the user interface. Please review the API documentation and Webhook documentation for more information on how to query the vulnerability API endpoints and configure webhooks utilizing all the same data present in the Wordfence Intelligence user interface.

# NACC WordPress Plugin <= 4.1.0 - Authenticated (Contributor+) Stored Cross-Site Scripting

 [Wordfence Intelligence](https://www.wordfence.com/threat-intel)   >    [Vulnerability Database](https://www.wordfence.com/threat-intel/vulnerabilities)   >   NACC WordPress Plugin <= 4.1.0 - Authenticated (Contributor+) Stored Cross-Site Scripting

6.4

**Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')**
**CVSS Vector**
[CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:C/C:L/I:L/A:N](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:C/C:L/I:L/A:N)

| CVE | [CVE-2024-12506](https://www.cve.org/CVERecord?id=CVE-2024-12506) |
| --- | --- |
| CVSS | 6.4 (Medium) |
| Publicly Published | December 19, 2024 |
| Last Updated | December 23, 2024 |
| Researcher | [yudha](https://www.wordfence.com/threat-intel/vulnerabilities/researchers/yudha) |

### Description

The NACC WordPress Plugin plugin for WordPress is vulnerable to Stored Cross-Site Scripting via the plugin's 'nacc' shortcode in all versions up to, and including, 4.1.0 due to insufficient input sanitization and output escaping on user supplied attributes. This makes it possible for authenticated attackers, with contributor-level access and above, to inject arbitrary web scripts in pages that will execute whenever a user accesses an injected page.

#### References

* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/browser/nacc-wordpress-plugin/tags/4.1.0/nacc-wordpress-plugin.php#L68)
* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/browser/nacc-wordpress-plugin/tags/4.1.0/nacc-wordpress-plugin.php#L85)
* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/browser/nacc-wordpress-plugin/tags/4.1.0/nacc-wordpress-plugin.php#L98)
* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/browser/nacc-wordpress-plugin/tags/4.1.0/nacc-wordpress-plugin.php#L135)
* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/changeset?sfp_email=&sfph_mail=&reponame=&old=3209481%40nacc-wordpress-plugin&new=3209481%40nacc-wordpress-plugin&sfp_email=&sfph_mail=)

#### Share

[Facebook](https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fnacc-wordpress-plugin%2Fnacc-wordpress-plugin-410-authenticated-contributor-stored-cross-site-scripting&t=NACC%20WordPress%20Plugin%20%3C%3D%204.1.0%20-%20Authenticated%20%28Contributor%2B%29%20Stored%20Cross-Site%20Scripting "Facebook")
[Twitter](https://twitter.com/share?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fnacc-wordpress-plugin%2Fnacc-wordpress-plugin-410-authenticated-contributor-stored-cross-site-scripting&text=NACC%20WordPress%20Plugin%20%3C%3D%204.1.0%20-%20Authenticated%20%28Contributor%2B%29%20Stored%20Cross-Site%20Scripting "Twitter")
[LinkedIn](https://www.linkedin.com/shareArticle?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fnacc-wordpress-plugin%2Fnacc-wordpress-plugin-410-authenticated-contributor-stored-cross-site-scripting "LinkedIn")
Email

## Vulnerability Details for NACC WordPress Plugin

#### [NACC WordPress Plugin](https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/nacc-wordpress-plugin)

| Software Type | Plugin |
| --- | --- |
| Software Slug | nacc-wordpress-plugin [(view on wordpress.org)](https://wordpress.org/plugins/nacc-wordpress-plugin) |
| Patched? | Yes |
| Remediation | Update to version 4.2.0, or a newer patched version |
| Affected Version | * <= 4.1.0 |
| Patched Version | * 4.2.0 |

This record contains material that is subject to copyright.

**Copyright 2012-2025 Defiant Inc.**

**License:**
Defiant hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute this software vulnerability information. Any copy of the software vulnerability information you make for such purposes is authorized provided that you include a hyperlink to this vulnerability record and reproduce Defiant's copyright designation and this license in any such copy.
**[Read more.](https://www.wordfence.com/wordfence-intelligence-terms-and-conditions/)**

**Copyright 1999-2025 The MITRE Corporation**

**License:**
CVE Usage: MITRE hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute Common Vulnerabilities and Exposures (CVE®). Any copy you make for such purposes is authorized provided that you reproduce MITRE's copyright designation and this license in any such copy.
**[Read more.](https://www.cve.org/Legal/TermsOfUse)**

Have information to add, or spot any errors? Contact us at wfi-support@wordfence.com so we can make any appropriate adjustments.

Did you know Wordfence Intelligence provides free personal and commercial API access to our comprehensive WordPress vulnerability database, along with a free webhook integration to stay on top of the latest vulnerabilities added and updated in the database? Get started today!

Learn more

Want to get notified of the latest vulnerabilities that may affect your WordPress site?
 Install Wordfence on your site today to get notified immediately if your site is affected by a vulnerability that has been added to our database.

Get Wordfence

The Wordfence Intelligence WordPress vulnerability database is completely free to access and query via API. Please review the documentation on how to access and consume the vulnerability data via API.

Documentation



=== Content from plugins.trac.wordpress.org_dc27d08a_20250114_192419.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fbrowser%2Fnacc-wordpress-plugin%2Ftags%2F4.1.0%2Fnacc-wordpress-plugin.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* [Blame](/browser/nacc-wordpress-plugin/tags/4.1.0/nacc-wordpress-plugin.php?annotate=blame "Annotate each line with the last changed revision (this can be time consuming...)")
* [Revision Log](/log/nacc-wordpress-plugin/tags/4.1.0/nacc-wordpress-plugin.php)

---

# [source:](/browser?order=name "Go to repository root") [nacc-wordpress-plugin](/browser/nacc-wordpress-plugin?order=name "View nacc-wordpress-plugin")/[tags](/browser/nacc-wordpress-plugin/tags?order=name "View tags")/[4.1.0](/browser/nacc-wordpress-plugin/tags/4.1.0?order=name "View 4.1.0")/[nacc-wordpress-plugin.php](/browser/nacc-wordpress-plugin/tags/4.1.0/nacc-wordpress-plugin.php?order=name "View nacc-wordpress-plugin.php")

View diff against:

View revision:

| [Last change](/changeset/3098084/nacc-wordpress-plugin/tags/4.1.0/nacc-wordpress-plugin.php "View differences") on this file was [3098084](/changeset/3098084/ "View changeset 3098084"), checked in by bmltenabled, [7 months ago](/timeline?from=2024-06-05T14%3A22%3A07Z&precision=second "See timeline at 06/05/2024 02:22:07 PM") |
| --- |
| Deploy version 4.1.0 |
| **File size:** 17.2 KB | |

| Line |  |
| --- | --- |
| [1](#L1) | <?php |
| [2](#L2) | /\*\* |
| [3](#L3) | \* Plugin Name:       NACC WordPress Plugin |
| [4](#L4) | \* Plugin URI:        https://wordpress.org/plugins/nacc-wordpress-plugin/ |
| [5](#L5) | \* Description:       This is a WordPress plugin implementation of the N.A. Cleantime Calculator. To use this, specify [NACC] in your text code. That text will be replaced with this cleantime calculator. |
| [6](#L6) | \* Install:           Drop this directory in the "wp-content/plugins/" directory and activate it. You need to specify "[NACC]" in the code section of a page or a post. |
| [7](#L7) | \* Contributors:      BMLTGuy, pjaudiomv, bmltenabled |
| [8](#L8) | \* Authors:           bmltenabled |
| [9](#L9) | \* Version:           4.1.0 |
| [10](#L10) | \* Requires PHP:      8.0 |
| [11](#L11) | \* Requires at least: 5.3 |
| [12](#L12) | \* License:           GPL v2 or later |
| [13](#L13) | \* License URI:       https://www.gnu.org/licenses/gpl-2.0.html |
| [14](#L14) | \*/ |
| [15](#L15) |  |
| [16](#L16) | namespace NACCPlugin; |
| [17](#L17) |  |
| [18](#L18) | if ( basename( $\_SERVER['PHP\_SELF'] ) == basename( \_\_FILE\_\_ ) ) { |
| [19](#L19) | die( 'Sorry, but you cannot access this page directly.' ); |
| [20](#L20) | } |
| [21](#L21) |  |
| [22](#L22) | /\*\* |
| [23](#L23) | \* Class NACC |
| [24](#L24) | \* @package NACCPlugin |
| [25](#L25) | \*/ |
| [26](#L26) | class NACC { |
| [27](#L27) |  |
| [28](#L28) | private const SETTINGS\_GROUP = 'nacc-group'; |
| [29](#L29) | private const DEFAULT\_THEME = 'NACC-Instance'; |
| [30](#L30) | private const DEFAULT\_LANGUAGE = 'en'; |
| [31](#L31) | private const DEFAULT\_LAYOUT = 'linear'; |
| [32](#L32) | private const DEFAULT\_SHOW\_SPECIAL = 'true'; |
| [33](#L33) |  |
| [34](#L34) | private $plugin\_dir; |
| [35](#L35) | /\*\* |
| [36](#L36) | \* Singleton instance of the class. |
| [37](#L37) | \* |
| [38](#L38) | \* @var null|self |
| [39](#L39) | \*/ |
| [40](#L40) | private static ?self $instance = null; |
| [41](#L41) |  |
| [42](#L42) | /\*\* |
| [43](#L43) | \* Constructor method for initializing the plugin. |
| [44](#L44) | \*/ |
| [45](#L45) | public function \_\_construct() { |
| [46](#L46) | $this->plugin\_dir = plugin\_dir\_url( \_\_FILE\_\_ ); |
| [47](#L47) | // Register the 'plugin\_setup' method to be executed during the 'init' action hook |
| [48](#L48) | add\_action( 'init', [ $this, 'plugin\_setup' ] ); |
| [49](#L49) | } |
| [50](#L50) |  |
| [51](#L51) | /\*\* |
| [52](#L52) | \* Setup method for initializing the plugin. |
| [53](#L53) | \* |
| [54](#L54) | \* This method checks if the current context is in the admin dashboard or not. |
| [55](#L55) | \* If in the admin dashboard, it registers admin-related actions and settings. |
| [56](#L56) | \* If not in the admin dashboard, it sets up a shortcode and associated actions. |
| [57](#L57) | \* |
| [58](#L58) | \* @return void |
| [59](#L59) | \*/ |
| [60](#L60) | public function plugin\_setup(): void { |
| [61](#L61) | if ( is\_admin() ) { |
| [62](#L62) | // If in the admin dashboard, register admin menu and settings actions |
| [63](#L63) | add\_action( 'admin\_menu', [ static::class, 'create\_menu' ] ); |
| [64](#L64) | add\_action( 'admin\_init', [ static::class, 'register\_settings' ] ); |
| [65](#L65) | } else { |
| [66](#L66) | // If not in the admin dashboard, set up a shortcode and associated actions |
| [67](#L67) | add\_action( 'wp\_enqueue\_scripts', [ $this, 'assets' ] ); |
| [68](#L68) | add\_shortcode( 'nacc', [ static::class, 'setup\_shortcode' ] ); |
| [69](#L69) | add\_filter( 'do\_shortcode\_tag', [ static::class, 'trigger\_after\_shortcode\_loaded' ], 10, 3 ); |
| [70](#L70) | add\_filter( 'the\_content', [ $this, 'nacc\_content' ] ); // Support for legacy shortcodes |
| [71](#L71) | } |
| [72](#L72) | } |
| [73](#L73) |  |
| [74](#L74) | /\*\* |
| [75](#L75) | \* Setup and render the NACC shortcode. |
| [76](#L76) | \* |
| [77](#L77) | \* This method processes the attributes provided to the [nacc] shortcode and |
| [78](#L78) | \* sets up the necessary shortcode attributes for rendering the N.A. Cleantime |
| [79](#L79) | \* Calculator. If no shortcode attributes are provided, default values from |
| [80](#L80) | \* plugin options are used. |
| [81](#L81) | \* |
| [82](#L82) | \* @param string|array $attrs Shortcode attributes. |
| [83](#L83) | \* @return string The HTML for the NACC shortcode. |
| [84](#L84) | \*/ |
| [85](#L85) | public static function setup\_shortcode( string|array $attrs = [] ): string { |
| [86](#L86) | return '<div id="nacc\_container"></div>'; |
| [87](#L87) | } |
| [88](#L88) |  |
| [89](#L89) | /\*\* |
| [90](#L90) | \* Callback function to trigger actions after the 'nacc' shortcode is loaded. |
| [91](#L91) | \* |
| [92](#L92) | \* @param string $output The output content of the shortcode. |
| [93](#L93) | \* @param string $tag The shortcode tag. |
| [94](#L94) | \* @param string|array $attrs The attributes passed to the shortcode. |
| [95](#L95) | \* |
| [96](#L96) | \* @return string The modified output content. |
| [97](#L97) | \*/ |
| [98](#L98) | public static function trigger\_after\_shortcode\_loaded( string $output, string $tag, string|array $attrs = [] ): string { |
| [99](#L99) | if ( 'nacc' === $tag ) { |
| [100](#L100) | global $shortcode\_attrs; |
| [101](#L101) | // add\_action('wp\_enqueue\_scripts', [$this, 'assets']); |
| [102](#L102) | // Get shortcode attributes or use default values from options |
| [103](#L103) | $theme = ! empty( $attrs['theme'] ) ? sanitize\_text\_field( strtoupper( $attrs['theme'] ) ) : get\_option( 'nacc\_theme' ); |
| [104](#L104) | $language = ! empty( $attrs['lang'] ) ? sanitize\_text\_field( strtolower( $attrs['lang'] ) ) : get\_option( 'nacc\_language' ); |
| [105](#L105) | $layout = ! empty( $attrs['layout'] ) ? sanitize\_text\_field( strtolower( $attrs['layout'] ) ) : get\_option( 'nacc\_layout' ); |
| [106](#L106) | $special = ! empty( $attrs['special'] ) ? sanitize\_text\_field( strtolower( $attrs['special'] ) ) : get\_option( 'nacc\_special' ); |
| [107](#L107) | $site\_uri = plugins\_url( 'nacc2', \_\_FILE\_\_ ); |
| [108](#L108) | $shortcode\_attrs = [ |
| [109](#L109) | 'theme' => $theme, |
| [110](#L110) | 'lang' => $language, |
| [111](#L111) | 'layout' => $layout, |
| [112](#L112) | 'special' => $special, |
| [113](#L113) | 'siteURI' => $site\_uri, |
| [114](#L114) | ]; |
| [115](#L115) | add\_action( |
| [116](#L116) | 'wp\_footer', |
| [117](#L117) | function () use ( $shortcode\_attrs ) { |
| [118](#L118) | static::render\_keytags( $shortcode\_attrs ); |
| [119](#L119) | } |
| [120](#L120) | ); |
| [121](#L121) | return $output; |
| [122](#L122) | } |
| [123](#L123) | return $output; |
| [124](#L124) | } |
| [125](#L125) |  |
| [126](#L126) | /\*\* |
| [127](#L127) | \* Render JavaScript for the shortcode. |
| [128](#L128) | \* |
| [129](#L129) | \* This method generates and adds inline JavaScript to initialize |
| [130](#L130) | \* the NACC (N.A. Cleantime Calculator) with the provided shortcode attributes. |
| [131](#L131) | \* |
| [132](#L132) | \* @param array $args |
| [133](#L133) | \* @return void |
| [134](#L134) | \*/ |
| [135](#L135) | private static function render\_keytags( array $args ): void { |
| [136](#L136) | wp\_add\_inline\_script( 'nacc-js', 'var nacc = new NACC(\'nacc\_container\', "' . $args['theme'] . '", "' . $args['lang'] . '", "' . $args['layout'] . '", "' . $args['special'] . '", "' . $args['siteURI'] . '");' ); |
| [137](#L137) | } |
| [138](#L138) |  |
| [139](#L139) | /\*\* Begin Code to Support Legacy non standard shortcode syntax IE. `<!-- NACC -->` or `[[NACC]]` \*/ |
| [140](#L140) | /\*\* |
| [141](#L141) | \* Process content and replace a shortcode with CleanTime Calculator HTML. |
| [142](#L142) | \* |
| [143](#L143) | \* @param string $the\_content The content to process. |
| [144](#L144) | \* |
| [145](#L145) | \* @return string The modified content with CleanTime Calculator HTML. |
| [146](#L146) | \*/ |
| [147](#L147) | public function nacc\_content( string $the\_content ): string { |
| [148](#L148) | // Get the shortcode and decode it |
| [149](#L149) | $shortcode = html\_entity\_decode( $this->get\_shortcode( $the\_content ) ?? '' ); |
| [150](#L150) |  |
| [151](#L151) | // Check if a shortcode was found |
| [152](#L152) | if ( ! empty( $shortcode ) ) { |
| [153](#L153) | // Parse shortcode parameters, Initialize default values |
| [154](#L154) | $shortcode\_obj = explode( ',', $shortcode ); |
| [155](#L155) | $shortcode\_obj = array\_map( fn( $value ) => trim( trim( $value ), "'" ), $shortcode\_obj ); |
| [156](#L156) |  |
| [157](#L157) | // Prepare parameters for rendering |
| [158](#L158) | $params = [ |
| [159](#L159) | 'theme' => $shortcode\_obj[0] ?? self::DEFAULT\_THEME, |
| [160](#L160) | 'lang' => $shortcode\_obj[1] ?? self::DEFAULT\_LANGUAGE, |
| [161](#L161) | 'layout' => $shortcode\_obj[2] ?? self::DEFAULT\_LAYOUT, |
| [162](#L162) | 'special' => $shortcode\_obj[3] ?? self::DEFAULT\_SHOW\_SPECIAL, |
| [163](#L163) | 'siteURI' => plugins\_url( 'nacc2', \_\_FILE\_\_ ), |
| [164](#L164) | ]; |
| [165](#L165) |  |
| [166](#L166) | // Initialize the CleanTime Calculator text |
| [167](#L167) | $cc\_text = '<div id="nacc\_container"></div>' . "\n"; |
| [168](#L168) | $cc\_text .= '<noscript>'; |
| [169](#L169) | $cc\_text .= '<h1 style="text-align:center">JavaScript Required</h1>'; |
| [170](#L170) | $cc\_text .= '<h2 style="text-align:center">Sadly, you must enable JavaScript on your browser in order to use this cleantime calculator.</h2>'; |
| [171](#L171) | $cc\_text .= '</noscript>' . "\n"; |
| [172](#L172) |  |
| [173](#L173) | // Replace the shortcode in the content with CleanTime Calculator HTML |
| [174](#L174) | $the\_content = $this->replace\_shortcode( $the\_content, $cc\_text ); |
| [175](#L175) |  |
| [176](#L176) | // Add an action to render legacy keytags in wp\_footer |
| [177](#L177) | add\_action( |
| [178](#L178) | 'wp\_footer', |
| [179](#L179) | function () use ( $params ) { |
| [180](#L180) | static::render\_keytags( $params ); |
| [181](#L181) | } |
| [182](#L182) | ); |
| [183](#L183) | } |
| [184](#L184) |  |
| [185](#L185) | return $the\_content; |
| [186](#L186) | } |
| [187](#L187) |  |
| [188](#L188) | /\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*/ |
| [189](#L189) | /\*\* |
| [190](#L190) | \*   \brief This will parse the given text, to see if it contains the submitted code.    \* |
| [191](#L191) | \*                                                                                       \* |
| [192](#L192) | \*   The code can be contained in EITHER an HTML comment (<!--CODE-->), OR a double-[[]] \* |
| [193](#L193) | \*   notation.                                                                           \* |
| [194](#L194) | \*                                                                                       \* |
| [195](#L195) | \*   \returns A string, consisting of the new text.                                      \* |
| [196](#L196) | \*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\* |
| [197](#L197) | \* @param string $in\_text\_to\_parse |
| [198](#L198) | \* @param string $in\_replacement\_text |
| [199](#L199) | \* @return string|null |
| [200](#L200) | \*/ |
| [201](#L201) | private function replace\_shortcode( |
| [202](#L202) | string $in\_text\_to\_parse,      ///< The text to search for shortcodes |
| [203](#L203) | string $in\_replacement\_text    ///< The text we'll be replacing the shortcode with. |
| [204](#L204) | ): string|null { |
| [205](#L205) | // Define the regular expressions for shortcode in HTML and brackets |
| [206](#L206) | $code\_regex\_html = '/(\<p[^\>]\*?\>)?<!--\s?nacc\s?(\(.\*?\))?\s?-->(\<\/p>)?/i'; |
| [207](#L207) | $code\_regex\_brackets = '/(\<p[^\>]\*?\>)?\[\[\s?nacc\s?(\(.\*?\))?\s?]](\<\/p>)?/i'; |
| [208](#L208) |  |
| [209](#L209) | // Replace shortcodes in both formats with the replacement text |
| [210](#L210) | $ret = preg\_replace( $code\_regex\_html, $in\_replacement\_text, $in\_text\_to\_parse, 1 ); |
| [211](#L211) | $ret = preg\_replace( $code\_regex\_brackets, $in\_replacement\_text, $ret, 1 ); |
| [212](#L212) |  |
| [213](#L213) | return $ret; |
| [214](#L214) | } |
| [215](#L215) |  |
| [216](#L216) | /\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*/ |
| [217](#L217) | /\*\* |
| [218](#L218) | \*   \brief This will parse the given text, to see if it contains the submitted code.    \* |
| [219](#L219) | \*                                                                                       \* |
| [220](#L220) | \*   The code can be contained in EITHER an HTML comment (<!--CODE-->), OR a double-[[]] \* |
| [221](#L221) | \*   notation.                                                                           \* |
| [222](#L222) | \*                                                                                       \* |
| [223](#L223) | \*   \returns Boolean true if the code is found (1 or more instances), OR an associative \* |
| [224](#L224) | \*   array of data that is associated with the code (anything within parentheses). Null  \* |
| [225](#L225) | \*   is returned if there is no shortcode detected.                                      \* |
| [226](#L226) | \*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\* |
| [227](#L227) | \* @param string $in\_text\_to\_parse |
| [228](#L228) | \* @return mixed |
| [229](#L229) | \*/ |
| [230](#L230) | private function get\_shortcode( string $in\_text\_to\_parse ) { |
| [231](#L231) | // Define the regular expressions for shortcode in HTML and brackets |
| [232](#L232) | $code\_regex\_html = '/<!--\s?nacc\s?(\(.\*?\))?\s?-->/i'; |
| [233](#L233) | $code\_regex\_brackets = '/\[\[\s?nacc\s?(\(.\*?\))?\s?]]/i'; |
| [234](#L234) |  |
| [235](#L235) | // Initialize the result |
| [236](#L236) | $ret = null; |
| [237](#L237) |  |
| [238](#L238) | // Try to match the shortcode using both regular expressions |
| [239](#L239) | if ( preg\_match( $code\_regex\_html, $in\_text\_to\_parse, $matches ) || preg\_match( $code\_regex\_brackets, $in\_text\_to\_parse, $matches ) ) { |
| [240](#L240) | // Check if there are any parameters and extract them |
| [241](#L241) | if ( ! empty( $matches[1] ) ) { |
| [242](#L242) | $ret = trim( $matches[1], '()' ); |
| [243](#L243) | } else { |
| [244](#L244) | $ret = true; // No parameters, set to true |
| [245](#L245) | } |
| [246](#L246) | } |
| [247](#L247) |  |
| [248](#L248) | return $ret; |
| [249](#L249) | } |
| [250](#L250) | /\*\* End Code to Support Legacy \*/ |
| [251](#L251) |  |
| [252](#L252) | /\*\* |
| [253](#L253) | \* Enqueue plugin styles and scripts. |
| [254](#L254) | \* |
| [255](#L255) | \* This method is responsible for enqueueing the necessary CSS and JavaScript |
| [256](#L256) | \* files for the NACC plugin to function correctly. |
| [257](#L257) | \* |
| [258](#L258) | \* @return void |
| [259](#L259) | \*/ |
| [260](#L260) | public function assets(): void { |
| [261](#L261) | // Enqueue plugin styles and scripts |
| [262](#L262) | wp\_enqueue\_style( 'nacc-css', $this->plugin\_dir . 'nacc2/nacc.css', false, filemtime( plugin\_dir\_path( \_\_FILE\_\_ ) . 'nacc2/nacc.css' ), false ); |
| [263](#L263) | wp\_enqueue\_script( 'nacc-js', $this->plugin\_dir . 'nacc2/nacc.js', [], '4.0', true ); |
| [264](#L264) | } |
| [265](#L265) |  |
| [266](#L266) | /\*\* |
| [267](#L267) | \* Register plugin settings with WordPress. |
| [268](#L268) | \* |
| [269](#L269) | \* This method registers the plugin settings with WordPress using the |
| [270](#L270) | \* `register\_setting` function. It defines the settings for 'nacc\_theme', |
| [271](#L271) | \* 'nacc\_language', 'nacc\_layout', and 'nacc\_special'. |
| [272](#L272) | \* |
| [273](#L273) | \* @return void |
| [274](#L274) | \*/ |
| [275](#L275) | public static function register\_settings(): void { |
| [276](#L276) | // Register plugin settings with WordPress |
| [277](#L277) | register\_setting( |
| [278](#L278) | self::SETTINGS\_GROUP, |
| [279](#L279) | 'nacc\_theme', |
| [280](#L280) | [ |
| [281](#L281) | 'type' => 'string', |
| [282](#L282) | 'default' => self::DEFAULT\_THEME, |
| [283](#L283) | 'sanitize\_callback' => 'sanitize\_text\_field', |
| [284](#L284) | ] |
| [285](#L285) | ); |
| [286](#L286) | register\_setting( |
| [287](#L287) | self::SETTINGS\_GROUP, |
| [288](#L288) | 'nacc\_language', |
| [289](#L289) | [ |
| [290](#L290) | 'type' => 'string', |
| [291](#L291) | 'default' => self::DEFAULT\_LANGUAGE, |
| [292](#L292) | 'sanitize\_callback' => 'sanitize\_text\_field', |
| [293](#L293) | ] |
| [294](#L294) | ); |
| [295](#L295) | register\_setting( |
| [296](#L296) | self::SETTINGS\_GROUP, |
| [297](#L297) | 'nacc\_layout', |
| [298](#L298) | [ |
| [299](#L299) | 'type' => 'string', |
| [300](#L300) | 'default' => self::DEFAULT\_LAYOUT, |
| [301](#L301) | 'sanitize\_callback' => 'sanitize\_text\_field', |
| [302](#L302) | ] |
| [303](#L303) | ); |
| [304](#L304) | register\_setting( |
| [305](#L305) | self::SETTINGS\_GROUP, |
| [306](#L306) | 'nacc\_special', |
| [307](#L307) | [ |
| [308](#L308) | 'type' => 'boolean', |
| [309](#L309) | 'sanitize\_callback' => 'wp\_validate\_boolean', |
| [310](#L310) | ] |
| [311](#L311) | ); |
| [312](#L312) | } |
| [313](#L313) |  |
| [314](#L314) | /\*\* |
| [315](#L315) | \* Create the plugin's settings menu in the WordPress admin. |
| [316](#L316) | \* |
| [317](#L317) | \* This method adds the NACC plugin's settings page to the WordPress admin menu. |
| [318](#L318) | \* It also adds a settings link in the list of plugins on the plugins page. |
| [319](#L319) | \* |
| [320](#L320) | \* @return void |
| [321](#L321) | \*/ |
| [322](#L322) | public static function create\_menu(): void { |
| [323](#L323) | // Create the plugin's settings page in the WordPress admin menu |
| [324](#L324) | add\_options\_page( |
| [325](#L325) | esc\_html\_\_( 'NACC Settings' ), // Page Title |
| [326](#L326) | esc\_html\_\_( 'NACC' ),          // Menu Title |
| [327](#L327) | 'manage\_options',            // Capability |
| [328](#L328) | 'nacc',                      // Menu Slug |
| [329](#L329) | [ static::class, 'draw\_settings' ]      // Callback function to display the page content |
| [330](#L330) | ); |
| [331](#L331) | // Add a settings link in the plugins list |
| [332](#L332) | add\_filter( 'plugin\_action\_links\_' . plugin\_basename( \_\_FILE\_\_ ), [ static::class, 'settings\_link' ] ); |
| [333](#L333) | } |
| [334](#L334) |  |
| [335](#L335) | /\*\* |
| [336](#L336) | \* Add a "Settings" link for the plugin in the WordPress admin. |
| [337](#L337) | \* |
| [338](#L338) | \* This method adds a "Settings" link for the NACC plugin in the WordPress admin |
| [339](#L339) | \* under the plugins list. |
| [340](#L340) | \* |
| [341](#L341) | \* @param array $links An array of plugin action links. |
| [342](#L342) | \* |
| [343](#L343) | \* @return array An updated array of plugin action links. |
| [344](#L344) | \*/ |
| [345](#L345) | public static function settings\_link( array $links ): array { |
| [346](#L346) | // Add a "Settings" link for the plugin in the WordPress admin |
| [347](#L347) | $settings\_url = admin\_url( 'options-general.php?page=nacc' ); |
| [348](#L348) | $links[] = "<a href='{$settings\_url}'>Settings</a>"; |
| [349](#L349) | return $links; |
| [350](#L350) | } |
| [351](#L351) |  |
| [352](#L352) | /\*\* |
| [353](#L353) | \* Display the plugin's settings page. |
| [354](#L354) | \* |
| [355](#L355) | \* This method renders and displays the settings page for the NACC plugin in the WordPress admin. |
| [356](#L356) | \* It includes form fields for configuring plugin settings such as theme, language, layout, and special keytags. |
| [357](#L357) | \* |
| [358](#L358) | \* @return void |
| [359](#L359) | \*/ |
| [360](#L360) | public static function draw\_settings(): void { |
| [361](#L361) | // Display the plugin's settings page |
| [362](#L362) | $nacc\_theme = esc\_attr( get\_option( 'nacc\_theme' ) ); |
| [363](#L363) | $nacc\_special = esc\_attr( get\_option( 'nacc\_special' ) ); |
| [364](#L364) | $nacc\_language = esc\_attr( get\_option( 'nacc\_language' ) ); |
| [365](#L365) | $nacc\_layout = esc\_attr( get\_option( 'nacc\_layout' ) ); |
| [366](#L366) | $allowed\_html = [ |
| [367](#L367) | 'select' => [ |
| [368](#L368) | 'id'   => [], |
| [369](#L369) | 'name' => [], |
| [370](#L370) | ], |
| [371](#L371) | 'option' => [ |
| [372](#L372) | 'value'   => [], |
| [373](#L373) | 'selected'   => [], |
| [374](#L374) | ], |
| [375](#L375) | ]; |
| [376](#L376) | ?> |
| [377](#L377) | <div class="wrap"> |
| [378](#L378) | <h2>NACC Settings</h2> |
| [379](#L379) | <form method="post" action="options.php"> |
| [380](#L380) | <?php settings\_fields( 'nacc-group' ); ?> |
| [381](#L381) | <?php do\_settings\_sections( 'nacc-group' ); ?> |
| [382](#L382) | <table class="form-table"> |
| [383](#L383) | <tr valign="top"> |
| [384](#L384) | <th scope="row">Theme</th> |
| [385](#L385) | <td> |
| [386](#L386) | <?php |
| [387](#L387) | echo wp\_kses( |
| [388](#L388) | static::render\_select\_option( |
| [389](#L389) | 'nacc\_theme', |
| [390](#L390) | $nacc\_theme, |
| [391](#L391) | [ |
| [392](#L392) | 'NACC-BT' => 'BT', |
| [393](#L393) | 'NACC-CRNA' => 'CRNA', |
| [394](#L394) | 'NACC-Instance' => 'Default', |
| [395](#L395) | 'NACC-GNYR2' => 'GNYR2', |
| [396](#L396) | 'NACC-HOLI' => 'HOLI', |
| [397](#L397) | 'NACC-NERNA' => 'NERNA', |
| [398](#L398) | 'NACC-SEZF' => 'SEZF', |
| [399](#L399) | ] |
| [400](#L400) | ), |
| [401](#L401) | $allowed\_html |
| [402](#L402) | ); |
| [403](#L403) | ?> |
| [404](#L404) | </td> |
| [405](#L405) | </tr> |
| [406](#L406) | <tr valign="top"> |
| [407](#L407) | <th scope="row">Language</th> |
| [408](#L408) | <td> |
| [409](#L409) | <?php |
| [410](#L410) | echo wp\_kses( |
| [411](#L411) | static::render\_select\_option( |
| [412](#L412) | 'nacc\_language', |
| [413](#L413) | $nacc\_language, |
| [414](#L414) | [ |
| [415](#L415) | 'en' => 'English', |
| [416](#L416) | 'es' => 'Español', |
| [417](#L417) | 'it' => 'Italiano', |
| [418](#L418) | 'zh-Hans' => 'zh-Hans', |
| [419](#L419) | 'zh-Hant' => 'zh-Hant', |
| [420](#L420) | ] |
| [421](#L421) | ), |
| [422](#L422) | $allowed\_html |
| [423](#L423) | ); |
| [424](#L424) | ?> |
| [425](#L425) | </td> |
| [426](#L426) | </tr> |
| [427](#L427) | <tr valign="top"> |
| [428](#L428) | <th scope="row">Layout</th> |
| [429](#L429) | <td> |
| [430](#L430) | <?php |
| [431](#L431) | echo wp\_kses( |
| [432](#L432) | static::render\_select\_option( |
| [433](#L433) | 'nacc\_layout', |
| [434](#L434) | $nacc\_layout, |
| [435](#L435) | [ |
| [436](#L436) | 'tabular' => 'Tabular', |
| [437](#L437) | 'linear' => 'Linear', |
| [438](#L438) | ] |
| [439](#L439) | ), |
| [440](#L440) | $allowed\_html |
| [441](#L441) | ); |
| [442](#L442) | ?> |
| [443](#L443) | </td> |
| [444](#L444) | </tr> |
| [445](#L445) | <tr valign="top"> |
| [446](#L446) | <th scope="row">Show Special Keytags</th> |
| [447](#L447) | <td> |
| [448](#L448) | <input type="checkbox" name="nacc\_special" value="1" <?php checked( 1, $nacc\_special ); ?> /> |
| [449](#L449) | <label for="nacc\_special">If true, then the "specialty" (over 2 years) tags are displayed. Default is false.</label> |
| [450](#L450) | </td> |
| [451](#L451) | </tr> |
| [452](#L452) | </table> |
| [453](#L453) | <?php submit\_button(); ?> |
| [454](#L454) | </form> |
| [455](#L455) | </div> |
| [456](#L456) | <?php |
| [457](#L457) | } |
| [458](#L458) |  |
| [459](#L459) | /\*\* |
| [460](#L460) | \* Render a dropdown select input for plugin settings. |
| [461](#L461) | \* |
| [462](#L462) | \* This method generates the HTML markup for a dropdown select input field with the specified name |
| [463](#L463) | \* and options. It also preselects the option that matches the provided selected value. |
| [464](#L464) | \* |
| [465](#L465) | \* @param string $name          The name attribute for the select input. |
| [466](#L466) | \* @param string $selected\_value The value to be preselected in the dropdown. |
| [467](#L467) | \* @param array  $options       An associative array of options (value => label) for the dropdown. |
| [468](#L468) | \* |
| [469](#L469) | \* @return string The generated HTML markup for the select input. |
| [470](#L470) | \*/ |
| [471](#L471) | private static function render\_select\_option( string $name, string $selected\_value, array $options ): string { |
| [472](#L472) | // Render a dropdown select input for settings |
| [473](#L473) | $select\_html = "<select id='$name' name='$name'>"; |
| [474](#L474) | foreach ( $options as $value => $label ) { |
| [475](#L475) | $selected = selected( $selected\_value, $value, false ); |
| [476](#L476) | $select\_html .= "<option value='$value' $selected>$label</option>"; |
| [477](#L477) | } |
| [478](#L478) | $select\_html .= '</select>'; |
| [479](#L479) |  |
| [480](#L480) | return $select\_html; |
| [481](#L481) | } |
| [482](#L482) |  |
| [483](#L483) | /\*\* |
| [484](#L484) | \* Get an instance of the NACC plugin class. |
| [485](#L485) | \* |
| [486](#L486) | \* This method ensures that only one instance of the NACC class is created during the plugin's lifecycle. |
| [487](#L487) | \* |
| [488](#L488) | \* @return self An instance of the NACC class. |
| [489](#L489) | \*/ |
| [490](#L490) | public static function get\_instance(): self { |
| [491](#L491) | if ( null == self::$instance ) { |
| [492](#L492) | self::$instance = new self(); |
| [493](#L493) | } |
| [494](#L494) | return self::$instance; |
| [495](#L495) | } |
| [496](#L496) | } |
| [497](#L497) |  |
| [498](#L498) | NACC::get\_instance(); |

**Note:** See [TracBrowser](/wiki/TracBrowser)
for help on using the repository browser.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Plain Text](/browser/nacc-wordpress-plugin/tags/4.1.0/nacc-wordpress-plugin.php?format=txt)
* [Original Format](/export/3222453/nacc-wordpress-plugin/tags/4.1.0/nacc-wordpress-plugin.php)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from plugins.trac.wordpress.org_d53c7798_20250114_192420.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fbrowser%2Fnacc-wordpress-plugin%2Ftags%2F4.1.0%2Fnacc-wordpress-plugin.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* [Blame](/browser/nacc-wordpress-plugin/tags/4.1.0/nacc-wordpress-plugin.php?annotate=blame "Annotate each line with the last changed revision (this can be time consuming...)")
* [Revision Log](/log/nacc-wordpress-plugin/tags/4.1.0/nacc-wordpress-plugin.php)

---

# [source:](/browser?order=name "Go to repository root") [nacc-wordpress-plugin](/browser/nacc-wordpress-plugin?order=name "View nacc-wordpress-plugin")/[tags](/browser/nacc-wordpress-plugin/tags?order=name "View tags")/[4.1.0](/browser/nacc-wordpress-plugin/tags/4.1.0?order=name "View 4.1.0")/[nacc-wordpress-plugin.php](/browser/nacc-wordpress-plugin/tags/4.1.0/nacc-wordpress-plugin.php?order=name "View nacc-wordpress-plugin.php")

View diff against:

View revision:

| [Last change](/changeset/3098084/nacc-wordpress-plugin/tags/4.1.0/nacc-wordpress-plugin.php "View differences") on this file was [3098084](/changeset/3098084/ "View changeset 3098084"), checked in by bmltenabled, [7 months ago](/timeline?from=2024-06-05T14%3A22%3A07Z&precision=second "See timeline at 06/05/2024 02:22:07 PM") |
| --- |
| Deploy version 4.1.0 |
| **File size:** 17.2 KB | |

| Line |  |
| --- | --- |
| [1](#L1) | <?php |
| [2](#L2) | /\*\* |
| [3](#L3) | \* Plugin Name:       NACC WordPress Plugin |
| [4](#L4) | \* Plugin URI:        https://wordpress.org/plugins/nacc-wordpress-plugin/ |
| [5](#L5) | \* Description:       This is a WordPress plugin implementation of the N.A. Cleantime Calculator. To use this, specify [NACC] in your text code. That text will be replaced with this cleantime calculator. |
| [6](#L6) | \* Install:           Drop this directory in the "wp-content/plugins/" directory and activate it. You need to specify "[NACC]" in the code section of a page or a post. |
| [7](#L7) | \* Contributors:      BMLTGuy, pjaudiomv, bmltenabled |
| [8](#L8) | \* Authors:           bmltenabled |
| [9](#L9) | \* Version:           4.1.0 |
| [10](#L10) | \* Requires PHP:      8.0 |
| [11](#L11) | \* Requires at least: 5.3 |
| [12](#L12) | \* License:           GPL v2 or later |
| [13](#L13) | \* License URI:       https://www.gnu.org/licenses/gpl-2.0.html |
| [14](#L14) | \*/ |
| [15](#L15) |  |
| [16](#L16) | namespace NACCPlugin; |
| [17](#L17) |  |
| [18](#L18) | if ( basename( $\_SERVER['PHP\_SELF'] ) == basename( \_\_FILE\_\_ ) ) { |
| [19](#L19) | die( 'Sorry, but you cannot access this page directly.' ); |
| [20](#L20) | } |
| [21](#L21) |  |
| [22](#L22) | /\*\* |
| [23](#L23) | \* Class NACC |
| [24](#L24) | \* @package NACCPlugin |
| [25](#L25) | \*/ |
| [26](#L26) | class NACC { |
| [27](#L27) |  |
| [28](#L28) | private const SETTINGS\_GROUP = 'nacc-group'; |
| [29](#L29) | private const DEFAULT\_THEME = 'NACC-Instance'; |
| [30](#L30) | private const DEFAULT\_LANGUAGE = 'en'; |
| [31](#L31) | private const DEFAULT\_LAYOUT = 'linear'; |
| [32](#L32) | private const DEFAULT\_SHOW\_SPECIAL = 'true'; |
| [33](#L33) |  |
| [34](#L34) | private $plugin\_dir; |
| [35](#L35) | /\*\* |
| [36](#L36) | \* Singleton instance of the class. |
| [37](#L37) | \* |
| [38](#L38) | \* @var null|self |
| [39](#L39) | \*/ |
| [40](#L40) | private static ?self $instance = null; |
| [41](#L41) |  |
| [42](#L42) | /\*\* |
| [43](#L43) | \* Constructor method for initializing the plugin. |
| [44](#L44) | \*/ |
| [45](#L45) | public function \_\_construct() { |
| [46](#L46) | $this->plugin\_dir = plugin\_dir\_url( \_\_FILE\_\_ ); |
| [47](#L47) | // Register the 'plugin\_setup' method to be executed during the 'init' action hook |
| [48](#L48) | add\_action( 'init', [ $this, 'plugin\_setup' ] ); |
| [49](#L49) | } |
| [50](#L50) |  |
| [51](#L51) | /\*\* |
| [52](#L52) | \* Setup method for initializing the plugin. |
| [53](#L53) | \* |
| [54](#L54) | \* This method checks if the current context is in the admin dashboard or not. |
| [55](#L55) | \* If in the admin dashboard, it registers admin-related actions and settings. |
| [56](#L56) | \* If not in the admin dashboard, it sets up a shortcode and associated actions. |
| [57](#L57) | \* |
| [58](#L58) | \* @return void |
| [59](#L59) | \*/ |
| [60](#L60) | public function plugin\_setup(): void { |
| [61](#L61) | if ( is\_admin() ) { |
| [62](#L62) | // If in the admin dashboard, register admin menu and settings actions |
| [63](#L63) | add\_action( 'admin\_menu', [ static::class, 'create\_menu' ] ); |
| [64](#L64) | add\_action( 'admin\_init', [ static::class, 'register\_settings' ] ); |
| [65](#L65) | } else { |
| [66](#L66) | // If not in the admin dashboard, set up a shortcode and associated actions |
| [67](#L67) | add\_action( 'wp\_enqueue\_scripts', [ $this, 'assets' ] ); |
| [68](#L68) | add\_shortcode( 'nacc', [ static::class, 'setup\_shortcode' ] ); |
| [69](#L69) | add\_filter( 'do\_shortcode\_tag', [ static::class, 'trigger\_after\_shortcode\_loaded' ], 10, 3 ); |
| [70](#L70) | add\_filter( 'the\_content', [ $this, 'nacc\_content' ] ); // Support for legacy shortcodes |
| [71](#L71) | } |
| [72](#L72) | } |
| [73](#L73) |  |
| [74](#L74) | /\*\* |
| [75](#L75) | \* Setup and render the NACC shortcode. |
| [76](#L76) | \* |
| [77](#L77) | \* This method processes the attributes provided to the [nacc] shortcode and |
| [78](#L78) | \* sets up the necessary shortcode attributes for rendering the N.A. Cleantime |
| [79](#L79) | \* Calculator. If no shortcode attributes are provided, default values from |
| [80](#L80) | \* plugin options are used. |
| [81](#L81) | \* |
| [82](#L82) | \* @param string|array $attrs Shortcode attributes. |
| [83](#L83) | \* @return string The HTML for the NACC shortcode. |
| [84](#L84) | \*/ |
| [85](#L85) | public static function setup\_shortcode( string|array $attrs = [] ): string { |
| [86](#L86) | return '<div id="nacc\_container"></div>'; |
| [87](#L87) | } |
| [88](#L88) |  |
| [89](#L89) | /\*\* |
| [90](#L90) | \* Callback function to trigger actions after the 'nacc' shortcode is loaded. |
| [91](#L91) | \* |
| [92](#L92) | \* @param string $output The output content of the shortcode. |
| [93](#L93) | \* @param string $tag The shortcode tag. |
| [94](#L94) | \* @param string|array $attrs The attributes passed to the shortcode. |
| [95](#L95) | \* |
| [96](#L96) | \* @return string The modified output content. |
| [97](#L97) | \*/ |
| [98](#L98) | public static function trigger\_after\_shortcode\_loaded( string $output, string $tag, string|array $attrs = [] ): string { |
| [99](#L99) | if ( 'nacc' === $tag ) { |
| [100](#L100) | global $shortcode\_attrs; |
| [101](#L101) | // add\_action('wp\_enqueue\_scripts', [$this, 'assets']); |
| [102](#L102) | // Get shortcode attributes or use default values from options |
| [103](#L103) | $theme = ! empty( $attrs['theme'] ) ? sanitize\_text\_field( strtoupper( $attrs['theme'] ) ) : get\_option( 'nacc\_theme' ); |
| [104](#L104) | $language = ! empty( $attrs['lang'] ) ? sanitize\_text\_field( strtolower( $attrs['lang'] ) ) : get\_option( 'nacc\_language' ); |
| [105](#L105) | $layout = ! empty( $attrs['layout'] ) ? sanitize\_text\_field( strtolower( $attrs['layout'] ) ) : get\_option( 'nacc\_layout' ); |
| [106](#L106) | $special = ! empty( $attrs['special'] ) ? sanitize\_text\_field( strtolower( $attrs['special'] ) ) : get\_option( 'nacc\_special' ); |
| [107](#L107) | $site\_uri = plugins\_url( 'nacc2', \_\_FILE\_\_ ); |
| [108](#L108) | $shortcode\_attrs = [ |
| [109](#L109) | 'theme' => $theme, |
| [110](#L110) | 'lang' => $language, |
| [111](#L111) | 'layout' => $layout, |
| [112](#L112) | 'special' => $special, |
| [113](#L113) | 'siteURI' => $site\_uri, |
| [114](#L114) | ]; |
| [115](#L115) | add\_action( |
| [116](#L116) | 'wp\_footer', |
| [117](#L117) | function () use ( $shortcode\_attrs ) { |
| [118](#L118) | static::render\_keytags( $shortcode\_attrs ); |
| [119](#L119) | } |
| [120](#L120) | ); |
| [121](#L121) | return $output; |
| [122](#L122) | } |
| [123](#L123) | return $output; |
| [124](#L124) | } |
| [125](#L125) |  |
| [126](#L126) | /\*\* |
| [127](#L127) | \* Render JavaScript for the shortcode. |
| [128](#L128) | \* |
| [129](#L129) | \* This method generates and adds inline JavaScript to initialize |
| [130](#L130) | \* the NACC (N.A. Cleantime Calculator) with the provided shortcode attributes. |
| [131](#L131) | \* |
| [132](#L132) | \* @param array $args |
| [133](#L133) | \* @return void |
| [134](#L134) | \*/ |
| [135](#L135) | private static function render\_keytags( array $args ): void { |
| [136](#L136) | wp\_add\_inline\_script( 'nacc-js', 'var nacc = new NACC(\'nacc\_container\', "' . $args['theme'] . '", "' . $args['lang'] . '", "' . $args['layout'] . '", "' . $args['special'] . '", "' . $args['siteURI'] . '");' ); |
| [137](#L137) | } |
| [138](#L138) |  |
| [139](#L139) | /\*\* Begin Code to Support Legacy non standard shortcode syntax IE. `<!-- NACC -->` or `[[NACC]]` \*/ |
| [140](#L140) | /\*\* |
| [141](#L141) | \* Process content and replace a shortcode with CleanTime Calculator HTML. |
| [142](#L142) | \* |
| [143](#L143) | \* @param string $the\_content The content to process. |
| [144](#L144) | \* |
| [145](#L145) | \* @return string The modified content with CleanTime Calculator HTML. |
| [146](#L146) | \*/ |
| [147](#L147) | public function nacc\_content( string $the\_content ): string { |
| [148](#L148) | // Get the shortcode and decode it |
| [149](#L149) | $shortcode = html\_entity\_decode( $this->get\_shortcode( $the\_content ) ?? '' ); |
| [150](#L150) |  |
| [151](#L151) | // Check if a shortcode was found |
| [152](#L152) | if ( ! empty( $shortcode ) ) { |
| [153](#L153) | // Parse shortcode parameters, Initialize default values |
| [154](#L154) | $shortcode\_obj = explode( ',', $shortcode ); |
| [155](#L155) | $shortcode\_obj = array\_map( fn( $value ) => trim( trim( $value ), "'" ), $shortcode\_obj ); |
| [156](#L156) |  |
| [157](#L157) | // Prepare parameters for rendering |
| [158](#L158) | $params = [ |
| [159](#L159) | 'theme' => $shortcode\_obj[0] ?? self::DEFAULT\_THEME, |
| [160](#L160) | 'lang' => $shortcode\_obj[1] ?? self::DEFAULT\_LANGUAGE, |
| [161](#L161) | 'layout' => $shortcode\_obj[2] ?? self::DEFAULT\_LAYOUT, |
| [162](#L162) | 'special' => $shortcode\_obj[3] ?? self::DEFAULT\_SHOW\_SPECIAL, |
| [163](#L163) | 'siteURI' => plugins\_url( 'nacc2', \_\_FILE\_\_ ), |
| [164](#L164) | ]; |
| [165](#L165) |  |
| [166](#L166) | // Initialize the CleanTime Calculator text |
| [167](#L167) | $cc\_text = '<div id="nacc\_container"></div>' . "\n"; |
| [168](#L168) | $cc\_text .= '<noscript>'; |
| [169](#L169) | $cc\_text .= '<h1 style="text-align:center">JavaScript Required</h1>'; |
| [170](#L170) | $cc\_text .= '<h2 style="text-align:center">Sadly, you must enable JavaScript on your browser in order to use this cleantime calculator.</h2>'; |
| [171](#L171) | $cc\_text .= '</noscript>' . "\n"; |
| [172](#L172) |  |
| [173](#L173) | // Replace the shortcode in the content with CleanTime Calculator HTML |
| [174](#L174) | $the\_content = $this->replace\_shortcode( $the\_content, $cc\_text ); |
| [175](#L175) |  |
| [176](#L176) | // Add an action to render legacy keytags in wp\_footer |
| [177](#L177) | add\_action( |
| [178](#L178) | 'wp\_footer', |
| [179](#L179) | function () use ( $params ) { |
| [180](#L180) | static::render\_keytags( $params ); |
| [181](#L181) | } |
| [182](#L182) | ); |
| [183](#L183) | } |
| [184](#L184) |  |
| [185](#L185) | return $the\_content; |
| [186](#L186) | } |
| [187](#L187) |  |
| [188](#L188) | /\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*/ |
| [189](#L189) | /\*\* |
| [190](#L190) | \*   \brief This will parse the given text, to see if it contains the submitted code.    \* |
| [191](#L191) | \*                                                                                       \* |
| [192](#L192) | \*   The code can be contained in EITHER an HTML comment (<!--CODE-->), OR a double-[[]] \* |
| [193](#L193) | \*   notation.                                                                           \* |
| [194](#L194) | \*                                                                                       \* |
| [195](#L195) | \*   \returns A string, consisting of the new text.                                      \* |
| [196](#L196) | \*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\* |
| [197](#L197) | \* @param string $in\_text\_to\_parse |
| [198](#L198) | \* @param string $in\_replacement\_text |
| [199](#L199) | \* @return string|null |
| [200](#L200) | \*/ |
| [201](#L201) | private function replace\_shortcode( |
| [202](#L202) | string $in\_text\_to\_parse,      ///< The text to search for shortcodes |
| [203](#L203) | string $in\_replacement\_text    ///< The text we'll be replacing the shortcode with. |
| [204](#L204) | ): string|null { |
| [205](#L205) | // Define the regular expressions for shortcode in HTML and brackets |
| [206](#L206) | $code\_regex\_html = '/(\<p[^\>]\*?\>)?<!--\s?nacc\s?(\(.\*?\))?\s?-->(\<\/p>)?/i'; |
| [207](#L207) | $code\_regex\_brackets = '/(\<p[^\>]\*?\>)?\[\[\s?nacc\s?(\(.\*?\))?\s?]](\<\/p>)?/i'; |
| [208](#L208) |  |
| [209](#L209) | // Replace shortcodes in both formats with the replacement text |
| [210](#L210) | $ret = preg\_replace( $code\_regex\_html, $in\_replacement\_text, $in\_text\_to\_parse, 1 ); |
| [211](#L211) | $ret = preg\_replace( $code\_regex\_brackets, $in\_replacement\_text, $ret, 1 ); |
| [212](#L212) |  |
| [213](#L213) | return $ret; |
| [214](#L214) | } |
| [215](#L215) |  |
| [216](#L216) | /\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*/ |
| [217](#L217) | /\*\* |
| [218](#L218) | \*   \brief This will parse the given text, to see if it contains the submitted code.    \* |
| [219](#L219) | \*                                                                                       \* |
| [220](#L220) | \*   The code can be contained in EITHER an HTML comment (<!--CODE-->), OR a double-[[]] \* |
| [221](#L221) | \*   notation.                                                                           \* |
| [222](#L222) | \*                                                                                       \* |
| [223](#L223) | \*   \returns Boolean true if the code is found (1 or more instances), OR an associative \* |
| [224](#L224) | \*   array of data that is associated with the code (anything within parentheses). Null  \* |
| [225](#L225) | \*   is returned if there is no shortcode detected.                                      \* |
| [226](#L226) | \*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\* |
| [227](#L227) | \* @param string $in\_text\_to\_parse |
| [228](#L228) | \* @return mixed |
| [229](#L229) | \*/ |
| [230](#L230) | private function get\_shortcode( string $in\_text\_to\_parse ) { |
| [231](#L231) | // Define the regular expressions for shortcode in HTML and brackets |
| [232](#L232) | $code\_regex\_html = '/<!--\s?nacc\s?(\(.\*?\))?\s?-->/i'; |
| [233](#L233) | $code\_regex\_brackets = '/\[\[\s?nacc\s?(\(.\*?\))?\s?]]/i'; |
| [234](#L234) |  |
| [235](#L235) | // Initialize the result |
| [236](#L236) | $ret = null; |
| [237](#L237) |  |
| [238](#L238) | // Try to match the shortcode using both regular expressions |
| [239](#L239) | if ( preg\_match( $code\_regex\_html, $in\_text\_to\_parse, $matches ) || preg\_match( $code\_regex\_brackets, $in\_text\_to\_parse, $matches ) ) { |
| [240](#L240) | // Check if there are any parameters and extract them |
| [241](#L241) | if ( ! empty( $matches[1] ) ) { |
| [242](#L242) | $ret = trim( $matches[1], '()' ); |
| [243](#L243) | } else { |
| [244](#L244) | $ret = true; // No parameters, set to true |
| [245](#L245) | } |
| [246](#L246) | } |
| [247](#L247) |  |
| [248](#L248) | return $ret; |
| [249](#L249) | } |
| [250](#L250) | /\*\* End Code to Support Legacy \*/ |
| [251](#L251) |  |
| [252](#L252) | /\*\* |
| [253](#L253) | \* Enqueue plugin styles and scripts. |
| [254](#L254) | \* |
| [255](#L255) | \* This method is responsible for enqueueing the necessary CSS and JavaScript |
| [256](#L256) | \* files for the NACC plugin to function correctly. |
| [257](#L257) | \* |
| [258](#L258) | \* @return void |
| [259](#L259) | \*/ |
| [260](#L260) | public function assets(): void { |
| [261](#L261) | // Enqueue plugin styles and scripts |
| [262](#L262) | wp\_enqueue\_style( 'nacc-css', $this->plugin\_dir . 'nacc2/nacc.css', false, filemtime( plugin\_dir\_path( \_\_FILE\_\_ ) . 'nacc2/nacc.css' ), false ); |
| [263](#L263) | wp\_enqueue\_script( 'nacc-js', $this->plugin\_dir . 'nacc2/nacc.js', [], '4.0', true ); |
| [264](#L264) | } |
| [265](#L265) |  |
| [266](#L266) | /\*\* |
| [267](#L267) | \* Register plugin settings with WordPress. |
| [268](#L268) | \* |
| [269](#L269) | \* This method registers the plugin settings with WordPress using the |
| [270](#L270) | \* `register\_setting` function. It defines the settings for 'nacc\_theme', |
| [271](#L271) | \* 'nacc\_language', 'nacc\_layout', and 'nacc\_special'. |
| [272](#L272) | \* |
| [273](#L273) | \* @return void |
| [274](#L274) | \*/ |
| [275](#L275) | public static function register\_settings(): void { |
| [276](#L276) | // Register plugin settings with WordPress |
| [277](#L277) | register\_setting( |
| [278](#L278) | self::SETTINGS\_GROUP, |
| [279](#L279) | 'nacc\_theme', |
| [280](#L280) | [ |
| [281](#L281) | 'type' => 'string', |
| [282](#L282) | 'default' => self::DEFAULT\_THEME, |
| [283](#L283) | 'sanitize\_callback' => 'sanitize\_text\_field', |
| [284](#L284) | ] |
| [285](#L285) | ); |
| [286](#L286) | register\_setting( |
| [287](#L287) | self::SETTINGS\_GROUP, |
| [288](#L288) | 'nacc\_language', |
| [289](#L289) | [ |
| [290](#L290) | 'type' => 'string', |
| [291](#L291) | 'default' => self::DEFAULT\_LANGUAGE, |
| [292](#L292) | 'sanitize\_callback' => 'sanitize\_text\_field', |
| [293](#L293) | ] |
| [294](#L294) | ); |
| [295](#L295) | register\_setting( |
| [296](#L296) | self::SETTINGS\_GROUP, |
| [297](#L297) | 'nacc\_layout', |
| [298](#L298) | [ |
| [299](#L299) | 'type' => 'string', |
| [300](#L300) | 'default' => self::DEFAULT\_LAYOUT, |
| [301](#L301) | 'sanitize\_callback' => 'sanitize\_text\_field', |
| [302](#L302) | ] |
| [303](#L303) | ); |
| [304](#L304) | register\_setting( |
| [305](#L305) | self::SETTINGS\_GROUP, |
| [306](#L306) | 'nacc\_special', |
| [307](#L307) | [ |
| [308](#L308) | 'type' => 'boolean', |
| [309](#L309) | 'sanitize\_callback' => 'wp\_validate\_boolean', |
| [310](#L310) | ] |
| [311](#L311) | ); |
| [312](#L312) | } |
| [313](#L313) |  |
| [314](#L314) | /\*\* |
| [315](#L315) | \* Create the plugin's settings menu in the WordPress admin. |
| [316](#L316) | \* |
| [317](#L317) | \* This method adds the NACC plugin's settings page to the WordPress admin menu. |
| [318](#L318) | \* It also adds a settings link in the list of plugins on the plugins page. |
| [319](#L319) | \* |
| [320](#L320) | \* @return void |
| [321](#L321) | \*/ |
| [322](#L322) | public static function create\_menu(): void { |
| [323](#L323) | // Create the plugin's settings page in the WordPress admin menu |
| [324](#L324) | add\_options\_page( |
| [325](#L325) | esc\_html\_\_( 'NACC Settings' ), // Page Title |
| [326](#L326) | esc\_html\_\_( 'NACC' ),          // Menu Title |
| [327](#L327) | 'manage\_options',            // Capability |
| [328](#L328) | 'nacc',                      // Menu Slug |
| [329](#L329) | [ static::class, 'draw\_settings' ]      // Callback function to display the page content |
| [330](#L330) | ); |
| [331](#L331) | // Add a settings link in the plugins list |
| [332](#L332) | add\_filter( 'plugin\_action\_links\_' . plugin\_basename( \_\_FILE\_\_ ), [ static::class, 'settings\_link' ] ); |
| [333](#L333) | } |
| [334](#L334) |  |
| [335](#L335) | /\*\* |
| [336](#L336) | \* Add a "Settings" link for the plugin in the WordPress admin. |
| [337](#L337) | \* |
| [338](#L338) | \* This method adds a "Settings" link for the NACC plugin in the WordPress admin |
| [339](#L339) | \* under the plugins list. |
| [340](#L340) | \* |
| [341](#L341) | \* @param array $links An array of plugin action links. |
| [342](#L342) | \* |
| [343](#L343) | \* @return array An updated array of plugin action links. |
| [344](#L344) | \*/ |
| [345](#L345) | public static function settings\_link( array $links ): array { |
| [346](#L346) | // Add a "Settings" link for the plugin in the WordPress admin |
| [347](#L347) | $settings\_url = admin\_url( 'options-general.php?page=nacc' ); |
| [348](#L348) | $links[] = "<a href='{$settings\_url}'>Settings</a>"; |
| [349](#L349) | return $links; |
| [350](#L350) | } |
| [351](#L351) |  |
| [352](#L352) | /\*\* |
| [353](#L353) | \* Display the plugin's settings page. |
| [354](#L354) | \* |
| [355](#L355) | \* This method renders and displays the settings page for the NACC plugin in the WordPress admin. |
| [356](#L356) | \* It includes form fields for configuring plugin settings such as theme, language, layout, and special keytags. |
| [357](#L357) | \* |
| [358](#L358) | \* @return void |
| [359](#L359) | \*/ |
| [360](#L360) | public static function draw\_settings(): void { |
| [361](#L361) | // Display the plugin's settings page |
| [362](#L362) | $nacc\_theme = esc\_attr( get\_option( 'nacc\_theme' ) ); |
| [363](#L363) | $nacc\_special = esc\_attr( get\_option( 'nacc\_special' ) ); |
| [364](#L364) | $nacc\_language = esc\_attr( get\_option( 'nacc\_language' ) ); |
| [365](#L365) | $nacc\_layout = esc\_attr( get\_option( 'nacc\_layout' ) ); |
| [366](#L366) | $allowed\_html = [ |
| [367](#L367) | 'select' => [ |
| [368](#L368) | 'id'   => [], |
| [369](#L369) | 'name' => [], |
| [370](#L370) | ], |
| [371](#L371) | 'option' => [ |
| [372](#L372) | 'value'   => [], |
| [373](#L373) | 'selected'   => [], |
| [374](#L374) | ], |
| [375](#L375) | ]; |
| [376](#L376) | ?> |
| [377](#L377) | <div class="wrap"> |
| [378](#L378) | <h2>NACC Settings</h2> |
| [379](#L379) | <form method="post" action="options.php"> |
| [380](#L380) | <?php settings\_fields( 'nacc-group' ); ?> |
| [381](#L381) | <?php do\_settings\_sections( 'nacc-group' ); ?> |
| [382](#L382) | <table class="form-table"> |
| [383](#L383) | <tr valign="top"> |
| [384](#L384) | <th scope="row">Theme</th> |
| [385](#L385) | <td> |
| [386](#L386) | <?php |
| [387](#L387) | echo wp\_kses( |
| [388](#L388) | static::render\_select\_option( |
| [389](#L389) | 'nacc\_theme', |
| [390](#L390) | $nacc\_theme, |
| [391](#L391) | [ |
| [392](#L392) | 'NACC-BT' => 'BT', |
| [393](#L393) | 'NACC-CRNA' => 'CRNA', |
| [394](#L394) | 'NACC-Instance' => 'Default', |
| [395](#L395) | 'NACC-GNYR2' => 'GNYR2', |
| [396](#L396) | 'NACC-HOLI' => 'HOLI', |
| [397](#L397) | 'NACC-NERNA' => 'NERNA', |
| [398](#L398) | 'NACC-SEZF' => 'SEZF', |
| [399](#L399) | ] |
| [400](#L400) | ), |
| [401](#L401) | $allowed\_html |
| [402](#L402) | ); |
| [403](#L403) | ?> |
| [404](#L404) | </td> |
| [405](#L405) | </tr> |
| [406](#L406) | <tr valign="top"> |
| [407](#L407) | <th scope="row">Language</th> |
| [408](#L408) | <td> |
| [409](#L409) | <?php |
| [410](#L410) | echo wp\_kses( |
| [411](#L411) | static::render\_select\_option( |
| [412](#L412) | 'nacc\_language', |
| [413](#L413) | $nacc\_language, |
| [414](#L414) | [ |
| [415](#L415) | 'en' => 'English', |
| [416](#L416) | 'es' => 'Español', |
| [417](#L417) | 'it' => 'Italiano', |
| [418](#L418) | 'zh-Hans' => 'zh-Hans', |
| [419](#L419) | 'zh-Hant' => 'zh-Hant', |
| [420](#L420) | ] |
| [421](#L421) | ), |
| [422](#L422) | $allowed\_html |
| [423](#L423) | ); |
| [424](#L424) | ?> |
| [425](#L425) | </td> |
| [426](#L426) | </tr> |
| [427](#L427) | <tr valign="top"> |
| [428](#L428) | <th scope="row">Layout</th> |
| [429](#L429) | <td> |
| [430](#L430) | <?php |
| [431](#L431) | echo wp\_kses( |
| [432](#L432) | static::render\_select\_option( |
| [433](#L433) | 'nacc\_layout', |
| [434](#L434) | $nacc\_layout, |
| [435](#L435) | [ |
| [436](#L436) | 'tabular' => 'Tabular', |
| [437](#L437) | 'linear' => 'Linear', |
| [438](#L438) | ] |
| [439](#L439) | ), |
| [440](#L440) | $allowed\_html |
| [441](#L441) | ); |
| [442](#L442) | ?> |
| [443](#L443) | </td> |
| [444](#L444) | </tr> |
| [445](#L445) | <tr valign="top"> |
| [446](#L446) | <th scope="row">Show Special Keytags</th> |
| [447](#L447) | <td> |
| [448](#L448) | <input type="checkbox" name="nacc\_special" value="1" <?php checked( 1, $nacc\_special ); ?> /> |
| [449](#L449) | <label for="nacc\_special">If true, then the "specialty" (over 2 years) tags are displayed. Default is false.</label> |
| [450](#L450) | </td> |
| [451](#L451) | </tr> |
| [452](#L452) | </table> |
| [453](#L453) | <?php submit\_button(); ?> |
| [454](#L454) | </form> |
| [455](#L455) | </div> |
| [456](#L456) | <?php |
| [457](#L457) | } |
| [458](#L458) |  |
| [459](#L459) | /\*\* |
| [460](#L460) | \* Render a dropdown select input for plugin settings. |
| [461](#L461) | \* |
| [462](#L462) | \* This method generates the HTML markup for a dropdown select input field with the specified name |
| [463](#L463) | \* and options. It also preselects the option that matches the provided selected value. |
| [464](#L464) | \* |
| [465](#L465) | \* @param string $name          The name attribute for the select input. |
| [466](#L466) | \* @param string $selected\_value The value to be preselected in the dropdown. |
| [467](#L467) | \* @param array  $options       An associative array of options (value => label) for the dropdown. |
| [468](#L468) | \* |
| [469](#L469) | \* @return string The generated HTML markup for the select input. |
| [470](#L470) | \*/ |
| [471](#L471) | private static function render\_select\_option( string $name, string $selected\_value, array $options ): string { |
| [472](#L472) | // Render a dropdown select input for settings |
| [473](#L473) | $select\_html = "<select id='$name' name='$name'>"; |
| [474](#L474) | foreach ( $options as $value => $label ) { |
| [475](#L475) | $selected = selected( $selected\_value, $value, false ); |
| [476](#L476) | $select\_html .= "<option value='$value' $selected>$label</option>"; |
| [477](#L477) | } |
| [478](#L478) | $select\_html .= '</select>'; |
| [479](#L479) |  |
| [480](#L480) | return $select\_html; |
| [481](#L481) | } |
| [482](#L482) |  |
| [483](#L483) | /\*\* |
| [484](#L484) | \* Get an instance of the NACC plugin class. |
| [485](#L485) | \* |
| [486](#L486) | \* This method ensures that only one instance of the NACC class is created during the plugin's lifecycle. |
| [487](#L487) | \* |
| [488](#L488) | \* @return self An instance of the NACC class. |
| [489](#L489) | \*/ |
| [490](#L490) | public static function get\_instance(): self { |
| [491](#L491) | if ( null == self::$instance ) { |
| [492](#L492) | self::$instance = new self(); |
| [493](#L493) | } |
| [494](#L494) | return self::$instance; |
| [495](#L495) | } |
| [496](#L496) | } |
| [497](#L497) |  |
| [498](#L498) | NACC::get\_instance(); |

**Note:** See [TracBrowser](/wiki/TracBrowser)
for help on using the repository browser.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Plain Text](/browser/nacc-wordpress-plugin/tags/4.1.0/nacc-wordpress-plugin.php?format=txt)
* [Original Format](/export/3222453/nacc-wordpress-plugin/tags/4.1.0/nacc-wordpress-plugin.php)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from plugins.trac.wordpress.org_22fb8b98_20250114_192414.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fbrowser%2Fnacc-wordpress-plugin%2Ftags%2F4.1.0%2Fnacc-wordpress-plugin.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* [Blame](/browser/nacc-wordpress-plugin/tags/4.1.0/nacc-wordpress-plugin.php?annotate=blame "Annotate each line with the last changed revision (this can be time consuming...)")
* [Revision Log](/log/nacc-wordpress-plugin/tags/4.1.0/nacc-wordpress-plugin.php)

---

# [source:](/browser?order=name "Go to repository root") [nacc-wordpress-plugin](/browser/nacc-wordpress-plugin?order=name "View nacc-wordpress-plugin")/[tags](/browser/nacc-wordpress-plugin/tags?order=name "View tags")/[4.1.0](/browser/nacc-wordpress-plugin/tags/4.1.0?order=name "View 4.1.0")/[nacc-wordpress-plugin.php](/browser/nacc-wordpress-plugin/tags/4.1.0/nacc-wordpress-plugin.php?order=name "View nacc-wordpress-plugin.php")

View diff against:

View revision:

| [Last change](/changeset/3098084/nacc-wordpress-plugin/tags/4.1.0/nacc-wordpress-plugin.php "View differences") on this file was [3098084](/changeset/3098084/ "View changeset 3098084"), checked in by bmltenabled, [7 months ago](/timeline?from=2024-06-05T14%3A22%3A07Z&precision=second "See timeline at 06/05/2024 02:22:07 PM") |
| --- |
| Deploy version 4.1.0 |
| **File size:** 17.2 KB | |

| Line |  |
| --- | --- |
| [1](#L1) | <?php |
| [2](#L2) | /\*\* |
| [3](#L3) | \* Plugin Name:       NACC WordPress Plugin |
| [4](#L4) | \* Plugin URI:        https://wordpress.org/plugins/nacc-wordpress-plugin/ |
| [5](#L5) | \* Description:       This is a WordPress plugin implementation of the N.A. Cleantime Calculator. To use this, specify [NACC] in your text code. That text will be replaced with this cleantime calculator. |
| [6](#L6) | \* Install:           Drop this directory in the "wp-content/plugins/" directory and activate it. You need to specify "[NACC]" in the code section of a page or a post. |
| [7](#L7) | \* Contributors:      BMLTGuy, pjaudiomv, bmltenabled |
| [8](#L8) | \* Authors:           bmltenabled |
| [9](#L9) | \* Version:           4.1.0 |
| [10](#L10) | \* Requires PHP:      8.0 |
| [11](#L11) | \* Requires at least: 5.3 |
| [12](#L12) | \* License:           GPL v2 or later |
| [13](#L13) | \* License URI:       https://www.gnu.org/licenses/gpl-2.0.html |
| [14](#L14) | \*/ |
| [15](#L15) |  |
| [16](#L16) | namespace NACCPlugin; |
| [17](#L17) |  |
| [18](#L18) | if ( basename( $\_SERVER['PHP\_SELF'] ) == basename( \_\_FILE\_\_ ) ) { |
| [19](#L19) | die( 'Sorry, but you cannot access this page directly.' ); |
| [20](#L20) | } |
| [21](#L21) |  |
| [22](#L22) | /\*\* |
| [23](#L23) | \* Class NACC |
| [24](#L24) | \* @package NACCPlugin |
| [25](#L25) | \*/ |
| [26](#L26) | class NACC { |
| [27](#L27) |  |
| [28](#L28) | private const SETTINGS\_GROUP = 'nacc-group'; |
| [29](#L29) | private const DEFAULT\_THEME = 'NACC-Instance'; |
| [30](#L30) | private const DEFAULT\_LANGUAGE = 'en'; |
| [31](#L31) | private const DEFAULT\_LAYOUT = 'linear'; |
| [32](#L32) | private const DEFAULT\_SHOW\_SPECIAL = 'true'; |
| [33](#L33) |  |
| [34](#L34) | private $plugin\_dir; |
| [35](#L35) | /\*\* |
| [36](#L36) | \* Singleton instance of the class. |
| [37](#L37) | \* |
| [38](#L38) | \* @var null|self |
| [39](#L39) | \*/ |
| [40](#L40) | private static ?self $instance = null; |
| [41](#L41) |  |
| [42](#L42) | /\*\* |
| [43](#L43) | \* Constructor method for initializing the plugin. |
| [44](#L44) | \*/ |
| [45](#L45) | public function \_\_construct() { |
| [46](#L46) | $this->plugin\_dir = plugin\_dir\_url( \_\_FILE\_\_ ); |
| [47](#L47) | // Register the 'plugin\_setup' method to be executed during the 'init' action hook |
| [48](#L48) | add\_action( 'init', [ $this, 'plugin\_setup' ] ); |
| [49](#L49) | } |
| [50](#L50) |  |
| [51](#L51) | /\*\* |
| [52](#L52) | \* Setup method for initializing the plugin. |
| [53](#L53) | \* |
| [54](#L54) | \* This method checks if the current context is in the admin dashboard or not. |
| [55](#L55) | \* If in the admin dashboard, it registers admin-related actions and settings. |
| [56](#L56) | \* If not in the admin dashboard, it sets up a shortcode and associated actions. |
| [57](#L57) | \* |
| [58](#L58) | \* @return void |
| [59](#L59) | \*/ |
| [60](#L60) | public function plugin\_setup(): void { |
| [61](#L61) | if ( is\_admin() ) { |
| [62](#L62) | // If in the admin dashboard, register admin menu and settings actions |
| [63](#L63) | add\_action( 'admin\_menu', [ static::class, 'create\_menu' ] ); |
| [64](#L64) | add\_action( 'admin\_init', [ static::class, 'register\_settings' ] ); |
| [65](#L65) | } else { |
| [66](#L66) | // If not in the admin dashboard, set up a shortcode and associated actions |
| [67](#L67) | add\_action( 'wp\_enqueue\_scripts', [ $this, 'assets' ] ); |
| [68](#L68) | add\_shortcode( 'nacc', [ static::class, 'setup\_shortcode' ] ); |
| [69](#L69) | add\_filter( 'do\_shortcode\_tag', [ static::class, 'trigger\_after\_shortcode\_loaded' ], 10, 3 ); |
| [70](#L70) | add\_filter( 'the\_content', [ $this, 'nacc\_content' ] ); // Support for legacy shortcodes |
| [71](#L71) | } |
| [72](#L72) | } |
| [73](#L73) |  |
| [74](#L74) | /\*\* |
| [75](#L75) | \* Setup and render the NACC shortcode. |
| [76](#L76) | \* |
| [77](#L77) | \* This method processes the attributes provided to the [nacc] shortcode and |
| [78](#L78) | \* sets up the necessary shortcode attributes for rendering the N.A. Cleantime |
| [79](#L79) | \* Calculator. If no shortcode attributes are provided, default values from |
| [80](#L80) | \* plugin options are used. |
| [81](#L81) | \* |
| [82](#L82) | \* @param string|array $attrs Shortcode attributes. |
| [83](#L83) | \* @return string The HTML for the NACC shortcode. |
| [84](#L84) | \*/ |
| [85](#L85) | public static function setup\_shortcode( string|array $attrs = [] ): string { |
| [86](#L86) | return '<div id="nacc\_container"></div>'; |
| [87](#L87) | } |
| [88](#L88) |  |
| [89](#L89) | /\*\* |
| [90](#L90) | \* Callback function to trigger actions after the 'nacc' shortcode is loaded. |
| [91](#L91) | \* |
| [92](#L92) | \* @param string $output The output content of the shortcode. |
| [93](#L93) | \* @param string $tag The shortcode tag. |
| [94](#L94) | \* @param string|array $attrs The attributes passed to the shortcode. |
| [95](#L95) | \* |
| [96](#L96) | \* @return string The modified output content. |
| [97](#L97) | \*/ |
| [98](#L98) | public static function trigger\_after\_shortcode\_loaded( string $output, string $tag, string|array $attrs = [] ): string { |
| [99](#L99) | if ( 'nacc' === $tag ) { |
| [100](#L100) | global $shortcode\_attrs; |
| [101](#L101) | // add\_action('wp\_enqueue\_scripts', [$this, 'assets']); |
| [102](#L102) | // Get shortcode attributes or use default values from options |
| [103](#L103) | $theme = ! empty( $attrs['theme'] ) ? sanitize\_text\_field( strtoupper( $attrs['theme'] ) ) : get\_option( 'nacc\_theme' ); |
| [104](#L104) | $language = ! empty( $attrs['lang'] ) ? sanitize\_text\_field( strtolower( $attrs['lang'] ) ) : get\_option( 'nacc\_language' ); |
| [105](#L105) | $layout = ! empty( $attrs['layout'] ) ? sanitize\_text\_field( strtolower( $attrs['layout'] ) ) : get\_option( 'nacc\_layout' ); |
| [106](#L106) | $special = ! empty( $attrs['special'] ) ? sanitize\_text\_field( strtolower( $attrs['special'] ) ) : get\_option( 'nacc\_special' ); |
| [107](#L107) | $site\_uri = plugins\_url( 'nacc2', \_\_FILE\_\_ ); |
| [108](#L108) | $shortcode\_attrs = [ |
| [109](#L109) | 'theme' => $theme, |
| [110](#L110) | 'lang' => $language, |
| [111](#L111) | 'layout' => $layout, |
| [112](#L112) | 'special' => $special, |
| [113](#L113) | 'siteURI' => $site\_uri, |
| [114](#L114) | ]; |
| [115](#L115) | add\_action( |
| [116](#L116) | 'wp\_footer', |
| [117](#L117) | function () use ( $shortcode\_attrs ) { |
| [118](#L118) | static::render\_keytags( $shortcode\_attrs ); |
| [119](#L119) | } |
| [120](#L120) | ); |
| [121](#L121) | return $output; |
| [122](#L122) | } |
| [123](#L123) | return $output; |
| [124](#L124) | } |
| [125](#L125) |  |
| [126](#L126) | /\*\* |
| [127](#L127) | \* Render JavaScript for the shortcode. |
| [128](#L128) | \* |
| [129](#L129) | \* This method generates and adds inline JavaScript to initialize |
| [130](#L130) | \* the NACC (N.A. Cleantime Calculator) with the provided shortcode attributes. |
| [131](#L131) | \* |
| [132](#L132) | \* @param array $args |
| [133](#L133) | \* @return void |
| [134](#L134) | \*/ |
| [135](#L135) | private static function render\_keytags( array $args ): void { |
| [136](#L136) | wp\_add\_inline\_script( 'nacc-js', 'var nacc = new NACC(\'nacc\_container\', "' . $args['theme'] . '", "' . $args['lang'] . '", "' . $args['layout'] . '", "' . $args['special'] . '", "' . $args['siteURI'] . '");' ); |
| [137](#L137) | } |
| [138](#L138) |  |
| [139](#L139) | /\*\* Begin Code to Support Legacy non standard shortcode syntax IE. `<!-- NACC -->` or `[[NACC]]` \*/ |
| [140](#L140) | /\*\* |
| [141](#L141) | \* Process content and replace a shortcode with CleanTime Calculator HTML. |
| [142](#L142) | \* |
| [143](#L143) | \* @param string $the\_content The content to process. |
| [144](#L144) | \* |
| [145](#L145) | \* @return string The modified content with CleanTime Calculator HTML. |
| [146](#L146) | \*/ |
| [147](#L147) | public function nacc\_content( string $the\_content ): string { |
| [148](#L148) | // Get the shortcode and decode it |
| [149](#L149) | $shortcode = html\_entity\_decode( $this->get\_shortcode( $the\_content ) ?? '' ); |
| [150](#L150) |  |
| [151](#L151) | // Check if a shortcode was found |
| [152](#L152) | if ( ! empty( $shortcode ) ) { |
| [153](#L153) | // Parse shortcode parameters, Initialize default values |
| [154](#L154) | $shortcode\_obj = explode( ',', $shortcode ); |
| [155](#L155) | $shortcode\_obj = array\_map( fn( $value ) => trim( trim( $value ), "'" ), $shortcode\_obj ); |
| [156](#L156) |  |
| [157](#L157) | // Prepare parameters for rendering |
| [158](#L158) | $params = [ |
| [159](#L159) | 'theme' => $shortcode\_obj[0] ?? self::DEFAULT\_THEME, |
| [160](#L160) | 'lang' => $shortcode\_obj[1] ?? self::DEFAULT\_LANGUAGE, |
| [161](#L161) | 'layout' => $shortcode\_obj[2] ?? self::DEFAULT\_LAYOUT, |
| [162](#L162) | 'special' => $shortcode\_obj[3] ?? self::DEFAULT\_SHOW\_SPECIAL, |
| [163](#L163) | 'siteURI' => plugins\_url( 'nacc2', \_\_FILE\_\_ ), |
| [164](#L164) | ]; |
| [165](#L165) |  |
| [166](#L166) | // Initialize the CleanTime Calculator text |
| [167](#L167) | $cc\_text = '<div id="nacc\_container"></div>' . "\n"; |
| [168](#L168) | $cc\_text .= '<noscript>'; |
| [169](#L169) | $cc\_text .= '<h1 style="text-align:center">JavaScript Required</h1>'; |
| [170](#L170) | $cc\_text .= '<h2 style="text-align:center">Sadly, you must enable JavaScript on your browser in order to use this cleantime calculator.</h2>'; |
| [171](#L171) | $cc\_text .= '</noscript>' . "\n"; |
| [172](#L172) |  |
| [173](#L173) | // Replace the shortcode in the content with CleanTime Calculator HTML |
| [174](#L174) | $the\_content = $this->replace\_shortcode( $the\_content, $cc\_text ); |
| [175](#L175) |  |
| [176](#L176) | // Add an action to render legacy keytags in wp\_footer |
| [177](#L177) | add\_action( |
| [178](#L178) | 'wp\_footer', |
| [179](#L179) | function () use ( $params ) { |
| [180](#L180) | static::render\_keytags( $params ); |
| [181](#L181) | } |
| [182](#L182) | ); |
| [183](#L183) | } |
| [184](#L184) |  |
| [185](#L185) | return $the\_content; |
| [186](#L186) | } |
| [187](#L187) |  |
| [188](#L188) | /\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*/ |
| [189](#L189) | /\*\* |
| [190](#L190) | \*   \brief This will parse the given text, to see if it contains the submitted code.    \* |
| [191](#L191) | \*                                                                                       \* |
| [192](#L192) | \*   The code can be contained in EITHER an HTML comment (<!--CODE-->), OR a double-[[]] \* |
| [193](#L193) | \*   notation.                                                                           \* |
| [194](#L194) | \*                                                                                       \* |
| [195](#L195) | \*   \returns A string, consisting of the new text.                                      \* |
| [196](#L196) | \*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\* |
| [197](#L197) | \* @param string $in\_text\_to\_parse |
| [198](#L198) | \* @param string $in\_replacement\_text |
| [199](#L199) | \* @return string|null |
| [200](#L200) | \*/ |
| [201](#L201) | private function replace\_shortcode( |
| [202](#L202) | string $in\_text\_to\_parse,      ///< The text to search for shortcodes |
| [203](#L203) | string $in\_replacement\_text    ///< The text we'll be replacing the shortcode with. |
| [204](#L204) | ): string|null { |
| [205](#L205) | // Define the regular expressions for shortcode in HTML and brackets |
| [206](#L206) | $code\_regex\_html = '/(\<p[^\>]\*?\>)?<!--\s?nacc\s?(\(.\*?\))?\s?-->(\<\/p>)?/i'; |
| [207](#L207) | $code\_regex\_brackets = '/(\<p[^\>]\*?\>)?\[\[\s?nacc\s?(\(.\*?\))?\s?]](\<\/p>)?/i'; |
| [208](#L208) |  |
| [209](#L209) | // Replace shortcodes in both formats with the replacement text |
| [210](#L210) | $ret = preg\_replace( $code\_regex\_html, $in\_replacement\_text, $in\_text\_to\_parse, 1 ); |
| [211](#L211) | $ret = preg\_replace( $code\_regex\_brackets, $in\_replacement\_text, $ret, 1 ); |
| [212](#L212) |  |
| [213](#L213) | return $ret; |
| [214](#L214) | } |
| [215](#L215) |  |
| [216](#L216) | /\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*/ |
| [217](#L217) | /\*\* |
| [218](#L218) | \*   \brief This will parse the given text, to see if it contains the submitted code.    \* |
| [219](#L219) | \*                                                                                       \* |
| [220](#L220) | \*   The code can be contained in EITHER an HTML comment (<!--CODE-->), OR a double-[[]] \* |
| [221](#L221) | \*   notation.                                                                           \* |
| [222](#L222) | \*                                                                                       \* |
| [223](#L223) | \*   \returns Boolean true if the code is found (1 or more instances), OR an associative \* |
| [224](#L224) | \*   array of data that is associated with the code (anything within parentheses). Null  \* |
| [225](#L225) | \*   is returned if there is no shortcode detected.                                      \* |
| [226](#L226) | \*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\* |
| [227](#L227) | \* @param string $in\_text\_to\_parse |
| [228](#L228) | \* @return mixed |
| [229](#L229) | \*/ |
| [230](#L230) | private function get\_shortcode( string $in\_text\_to\_parse ) { |
| [231](#L231) | // Define the regular expressions for shortcode in HTML and brackets |
| [232](#L232) | $code\_regex\_html = '/<!--\s?nacc\s?(\(.\*?\))?\s?-->/i'; |
| [233](#L233) | $code\_regex\_brackets = '/\[\[\s?nacc\s?(\(.\*?\))?\s?]]/i'; |
| [234](#L234) |  |
| [235](#L235) | // Initialize the result |
| [236](#L236) | $ret = null; |
| [237](#L237) |  |
| [238](#L238) | // Try to match the shortcode using both regular expressions |
| [239](#L239) | if ( preg\_match( $code\_regex\_html, $in\_text\_to\_parse, $matches ) || preg\_match( $code\_regex\_brackets, $in\_text\_to\_parse, $matches ) ) { |
| [240](#L240) | // Check if there are any parameters and extract them |
| [241](#L241) | if ( ! empty( $matches[1] ) ) { |
| [242](#L242) | $ret = trim( $matches[1], '()' ); |
| [243](#L243) | } else { |
| [244](#L244) | $ret = true; // No parameters, set to true |
| [245](#L245) | } |
| [246](#L246) | } |
| [247](#L247) |  |
| [248](#L248) | return $ret; |
| [249](#L249) | } |
| [250](#L250) | /\*\* End Code to Support Legacy \*/ |
| [251](#L251) |  |
| [252](#L252) | /\*\* |
| [253](#L253) | \* Enqueue plugin styles and scripts. |
| [254](#L254) | \* |
| [255](#L255) | \* This method is responsible for enqueueing the necessary CSS and JavaScript |
| [256](#L256) | \* files for the NACC plugin to function correctly. |
| [257](#L257) | \* |
| [258](#L258) | \* @return void |
| [259](#L259) | \*/ |
| [260](#L260) | public function assets(): void { |
| [261](#L261) | // Enqueue plugin styles and scripts |
| [262](#L262) | wp\_enqueue\_style( 'nacc-css', $this->plugin\_dir . 'nacc2/nacc.css', false, filemtime( plugin\_dir\_path( \_\_FILE\_\_ ) . 'nacc2/nacc.css' ), false ); |
| [263](#L263) | wp\_enqueue\_script( 'nacc-js', $this->plugin\_dir . 'nacc2/nacc.js', [], '4.0', true ); |
| [264](#L264) | } |
| [265](#L265) |  |
| [266](#L266) | /\*\* |
| [267](#L267) | \* Register plugin settings with WordPress. |
| [268](#L268) | \* |
| [269](#L269) | \* This method registers the plugin settings with WordPress using the |
| [270](#L270) | \* `register\_setting` function. It defines the settings for 'nacc\_theme', |
| [271](#L271) | \* 'nacc\_language', 'nacc\_layout', and 'nacc\_special'. |
| [272](#L272) | \* |
| [273](#L273) | \* @return void |
| [274](#L274) | \*/ |
| [275](#L275) | public static function register\_settings(): void { |
| [276](#L276) | // Register plugin settings with WordPress |
| [277](#L277) | register\_setting( |
| [278](#L278) | self::SETTINGS\_GROUP, |
| [279](#L279) | 'nacc\_theme', |
| [280](#L280) | [ |
| [281](#L281) | 'type' => 'string', |
| [282](#L282) | 'default' => self::DEFAULT\_THEME, |
| [283](#L283) | 'sanitize\_callback' => 'sanitize\_text\_field', |
| [284](#L284) | ] |
| [285](#L285) | ); |
| [286](#L286) | register\_setting( |
| [287](#L287) | self::SETTINGS\_GROUP, |
| [288](#L288) | 'nacc\_language', |
| [289](#L289) | [ |
| [290](#L290) | 'type' => 'string', |
| [291](#L291) | 'default' => self::DEFAULT\_LANGUAGE, |
| [292](#L292) | 'sanitize\_callback' => 'sanitize\_text\_field', |
| [293](#L293) | ] |
| [294](#L294) | ); |
| [295](#L295) | register\_setting( |
| [296](#L296) | self::SETTINGS\_GROUP, |
| [297](#L297) | 'nacc\_layout', |
| [298](#L298) | [ |
| [299](#L299) | 'type' => 'string', |
| [300](#L300) | 'default' => self::DEFAULT\_LAYOUT, |
| [301](#L301) | 'sanitize\_callback' => 'sanitize\_text\_field', |
| [302](#L302) | ] |
| [303](#L303) | ); |
| [304](#L304) | register\_setting( |
| [305](#L305) | self::SETTINGS\_GROUP, |
| [306](#L306) | 'nacc\_special', |
| [307](#L307) | [ |
| [308](#L308) | 'type' => 'boolean', |
| [309](#L309) | 'sanitize\_callback' => 'wp\_validate\_boolean', |
| [310](#L310) | ] |
| [311](#L311) | ); |
| [312](#L312) | } |
| [313](#L313) |  |
| [314](#L314) | /\*\* |
| [315](#L315) | \* Create the plugin's settings menu in the WordPress admin. |
| [316](#L316) | \* |
| [317](#L317) | \* This method adds the NACC plugin's settings page to the WordPress admin menu. |
| [318](#L318) | \* It also adds a settings link in the list of plugins on the plugins page. |
| [319](#L319) | \* |
| [320](#L320) | \* @return void |
| [321](#L321) | \*/ |
| [322](#L322) | public static function create\_menu(): void { |
| [323](#L323) | // Create the plugin's settings page in the WordPress admin menu |
| [324](#L324) | add\_options\_page( |
| [325](#L325) | esc\_html\_\_( 'NACC Settings' ), // Page Title |
| [326](#L326) | esc\_html\_\_( 'NACC' ),          // Menu Title |
| [327](#L327) | 'manage\_options',            // Capability |
| [328](#L328) | 'nacc',                      // Menu Slug |
| [329](#L329) | [ static::class, 'draw\_settings' ]      // Callback function to display the page content |
| [330](#L330) | ); |
| [331](#L331) | // Add a settings link in the plugins list |
| [332](#L332) | add\_filter( 'plugin\_action\_links\_' . plugin\_basename( \_\_FILE\_\_ ), [ static::class, 'settings\_link' ] ); |
| [333](#L333) | } |
| [334](#L334) |  |
| [335](#L335) | /\*\* |
| [336](#L336) | \* Add a "Settings" link for the plugin in the WordPress admin. |
| [337](#L337) | \* |
| [338](#L338) | \* This method adds a "Settings" link for the NACC plugin in the WordPress admin |
| [339](#L339) | \* under the plugins list. |
| [340](#L340) | \* |
| [341](#L341) | \* @param array $links An array of plugin action links. |
| [342](#L342) | \* |
| [343](#L343) | \* @return array An updated array of plugin action links. |
| [344](#L344) | \*/ |
| [345](#L345) | public static function settings\_link( array $links ): array { |
| [346](#L346) | // Add a "Settings" link for the plugin in the WordPress admin |
| [347](#L347) | $settings\_url = admin\_url( 'options-general.php?page=nacc' ); |
| [348](#L348) | $links[] = "<a href='{$settings\_url}'>Settings</a>"; |
| [349](#L349) | return $links; |
| [350](#L350) | } |
| [351](#L351) |  |
| [352](#L352) | /\*\* |
| [353](#L353) | \* Display the plugin's settings page. |
| [354](#L354) | \* |
| [355](#L355) | \* This method renders and displays the settings page for the NACC plugin in the WordPress admin. |
| [356](#L356) | \* It includes form fields for configuring plugin settings such as theme, language, layout, and special keytags. |
| [357](#L357) | \* |
| [358](#L358) | \* @return void |
| [359](#L359) | \*/ |
| [360](#L360) | public static function draw\_settings(): void { |
| [361](#L361) | // Display the plugin's settings page |
| [362](#L362) | $nacc\_theme = esc\_attr( get\_option( 'nacc\_theme' ) ); |
| [363](#L363) | $nacc\_special = esc\_attr( get\_option( 'nacc\_special' ) ); |
| [364](#L364) | $nacc\_language = esc\_attr( get\_option( 'nacc\_language' ) ); |
| [365](#L365) | $nacc\_layout = esc\_attr( get\_option( 'nacc\_layout' ) ); |
| [366](#L366) | $allowed\_html = [ |
| [367](#L367) | 'select' => [ |
| [368](#L368) | 'id'   => [], |
| [369](#L369) | 'name' => [], |
| [370](#L370) | ], |
| [371](#L371) | 'option' => [ |
| [372](#L372) | 'value'   => [], |
| [373](#L373) | 'selected'   => [], |
| [374](#L374) | ], |
| [375](#L375) | ]; |
| [376](#L376) | ?> |
| [377](#L377) | <div class="wrap"> |
| [378](#L378) | <h2>NACC Settings</h2> |
| [379](#L379) | <form method="post" action="options.php"> |
| [380](#L380) | <?php settings\_fields( 'nacc-group' ); ?> |
| [381](#L381) | <?php do\_settings\_sections( 'nacc-group' ); ?> |
| [382](#L382) | <table class="form-table"> |
| [383](#L383) | <tr valign="top"> |
| [384](#L384) | <th scope="row">Theme</th> |
| [385](#L385) | <td> |
| [386](#L386) | <?php |
| [387](#L387) | echo wp\_kses( |
| [388](#L388) | static::render\_select\_option( |
| [389](#L389) | 'nacc\_theme', |
| [390](#L390) | $nacc\_theme, |
| [391](#L391) | [ |
| [392](#L392) | 'NACC-BT' => 'BT', |
| [393](#L393) | 'NACC-CRNA' => 'CRNA', |
| [394](#L394) | 'NACC-Instance' => 'Default', |
| [395](#L395) | 'NACC-GNYR2' => 'GNYR2', |
| [396](#L396) | 'NACC-HOLI' => 'HOLI', |
| [397](#L397) | 'NACC-NERNA' => 'NERNA', |
| [398](#L398) | 'NACC-SEZF' => 'SEZF', |
| [399](#L399) | ] |
| [400](#L400) | ), |
| [401](#L401) | $allowed\_html |
| [402](#L402) | ); |
| [403](#L403) | ?> |
| [404](#L404) | </td> |
| [405](#L405) | </tr> |
| [406](#L406) | <tr valign="top"> |
| [407](#L407) | <th scope="row">Language</th> |
| [408](#L408) | <td> |
| [409](#L409) | <?php |
| [410](#L410) | echo wp\_kses( |
| [411](#L411) | static::render\_select\_option( |
| [412](#L412) | 'nacc\_language', |
| [413](#L413) | $nacc\_language, |
| [414](#L414) | [ |
| [415](#L415) | 'en' => 'English', |
| [416](#L416) | 'es' => 'Español', |
| [417](#L417) | 'it' => 'Italiano', |
| [418](#L418) | 'zh-Hans' => 'zh-Hans', |
| [419](#L419) | 'zh-Hant' => 'zh-Hant', |
| [420](#L420) | ] |
| [421](#L421) | ), |
| [422](#L422) | $allowed\_html |
| [423](#L423) | ); |
| [424](#L424) | ?> |
| [425](#L425) | </td> |
| [426](#L426) | </tr> |
| [427](#L427) | <tr valign="top"> |
| [428](#L428) | <th scope="row">Layout</th> |
| [429](#L429) | <td> |
| [430](#L430) | <?php |
| [431](#L431) | echo wp\_kses( |
| [432](#L432) | static::render\_select\_option( |
| [433](#L433) | 'nacc\_layout', |
| [434](#L434) | $nacc\_layout, |
| [435](#L435) | [ |
| [436](#L436) | 'tabular' => 'Tabular', |
| [437](#L437) | 'linear' => 'Linear', |
| [438](#L438) | ] |
| [439](#L439) | ), |
| [440](#L440) | $allowed\_html |
| [441](#L441) | ); |
| [442](#L442) | ?> |
| [443](#L443) | </td> |
| [444](#L444) | </tr> |
| [445](#L445) | <tr valign="top"> |
| [446](#L446) | <th scope="row">Show Special Keytags</th> |
| [447](#L447) | <td> |
| [448](#L448) | <input type="checkbox" name="nacc\_special" value="1" <?php checked( 1, $nacc\_special ); ?> /> |
| [449](#L449) | <label for="nacc\_special">If true, then the "specialty" (over 2 years) tags are displayed. Default is false.</label> |
| [450](#L450) | </td> |
| [451](#L451) | </tr> |
| [452](#L452) | </table> |
| [453](#L453) | <?php submit\_button(); ?> |
| [454](#L454) | </form> |
| [455](#L455) | </div> |
| [456](#L456) | <?php |
| [457](#L457) | } |
| [458](#L458) |  |
| [459](#L459) | /\*\* |
| [460](#L460) | \* Render a dropdown select input for plugin settings. |
| [461](#L461) | \* |
| [462](#L462) | \* This method generates the HTML markup for a dropdown select input field with the specified name |
| [463](#L463) | \* and options. It also preselects the option that matches the provided selected value. |
| [464](#L464) | \* |
| [465](#L465) | \* @param string $name          The name attribute for the select input. |
| [466](#L466) | \* @param string $selected\_value The value to be preselected in the dropdown. |
| [467](#L467) | \* @param array  $options       An associative array of options (value => label) for the dropdown. |
| [468](#L468) | \* |
| [469](#L469) | \* @return string The generated HTML markup for the select input. |
| [470](#L470) | \*/ |
| [471](#L471) | private static function render\_select\_option( string $name, string $selected\_value, array $options ): string { |
| [472](#L472) | // Render a dropdown select input for settings |
| [473](#L473) | $select\_html = "<select id='$name' name='$name'>"; |
| [474](#L474) | foreach ( $options as $value => $label ) { |
| [475](#L475) | $selected = selected( $selected\_value, $value, false ); |
| [476](#L476) | $select\_html .= "<option value='$value' $selected>$label</option>"; |
| [477](#L477) | } |
| [478](#L478) | $select\_html .= '</select>'; |
| [479](#L479) |  |
| [480](#L480) | return $select\_html; |
| [481](#L481) | } |
| [482](#L482) |  |
| [483](#L483) | /\*\* |
| [484](#L484) | \* Get an instance of the NACC plugin class. |
| [485](#L485) | \* |
| [486](#L486) | \* This method ensures that only one instance of the NACC class is created during the plugin's lifecycle. |
| [487](#L487) | \* |
| [488](#L488) | \* @return self An instance of the NACC class. |
| [489](#L489) | \*/ |
| [490](#L490) | public static function get\_instance(): self { |
| [491](#L491) | if ( null == self::$instance ) { |
| [492](#L492) | self::$instance = new self(); |
| [493](#L493) | } |
| [494](#L494) | return self::$instance; |
| [495](#L495) | } |
| [496](#L496) | } |
| [497](#L497) |  |
| [498](#L498) | NACC::get\_instance(); |

**Note:** See [TracBrowser](/wiki/TracBrowser)
for help on using the repository browser.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Plain Text](/browser/nacc-wordpress-plugin/tags/4.1.0/nacc-wordpress-plugin.php?format=txt)
* [Original Format](/export/3222453/nacc-wordpress-plugin/tags/4.1.0/nacc-wordpress-plugin.php)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from plugins.trac.wordpress.org_17653be5_20250114_192421.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fbrowser%2Fnacc-wordpress-plugin%2Ftags%2F4.1.0%2Fnacc-wordpress-plugin.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* [Blame](/browser/nacc-wordpress-plugin/tags/4.1.0/nacc-wordpress-plugin.php?annotate=blame "Annotate each line with the last changed revision (this can be time consuming...)")
* [Revision Log](/log/nacc-wordpress-plugin/tags/4.1.0/nacc-wordpress-plugin.php)

---

# [source:](/browser?order=name "Go to repository root") [nacc-wordpress-plugin](/browser/nacc-wordpress-plugin?order=name "View nacc-wordpress-plugin")/[tags](/browser/nacc-wordpress-plugin/tags?order=name "View tags")/[4.1.0](/browser/nacc-wordpress-plugin/tags/4.1.0?order=name "View 4.1.0")/[nacc-wordpress-plugin.php](/browser/nacc-wordpress-plugin/tags/4.1.0/nacc-wordpress-plugin.php?order=name "View nacc-wordpress-plugin.php")

View diff against:

View revision:

| [Last change](/changeset/3098084/nacc-wordpress-plugin/tags/4.1.0/nacc-wordpress-plugin.php "View differences") on this file was [3098084](/changeset/3098084/ "View changeset 3098084"), checked in by bmltenabled, [7 months ago](/timeline?from=2024-06-05T14%3A22%3A07Z&precision=second "See timeline at 06/05/2024 02:22:07 PM") |
| --- |
| Deploy version 4.1.0 |
| **File size:** 17.2 KB | |

| Line |  |
| --- | --- |
| [1](#L1) | <?php |
| [2](#L2) | /\*\* |
| [3](#L3) | \* Plugin Name:       NACC WordPress Plugin |
| [4](#L4) | \* Plugin URI:        https://wordpress.org/plugins/nacc-wordpress-plugin/ |
| [5](#L5) | \* Description:       This is a WordPress plugin implementation of the N.A. Cleantime Calculator. To use this, specify [NACC] in your text code. That text will be replaced with this cleantime calculator. |
| [6](#L6) | \* Install:           Drop this directory in the "wp-content/plugins/" directory and activate it. You need to specify "[NACC]" in the code section of a page or a post. |
| [7](#L7) | \* Contributors:      BMLTGuy, pjaudiomv, bmltenabled |
| [8](#L8) | \* Authors:           bmltenabled |
| [9](#L9) | \* Version:           4.1.0 |
| [10](#L10) | \* Requires PHP:      8.0 |
| [11](#L11) | \* Requires at least: 5.3 |
| [12](#L12) | \* License:           GPL v2 or later |
| [13](#L13) | \* License URI:       https://www.gnu.org/licenses/gpl-2.0.html |
| [14](#L14) | \*/ |
| [15](#L15) |  |
| [16](#L16) | namespace NACCPlugin; |
| [17](#L17) |  |
| [18](#L18) | if ( basename( $\_SERVER['PHP\_SELF'] ) == basename( \_\_FILE\_\_ ) ) { |
| [19](#L19) | die( 'Sorry, but you cannot access this page directly.' ); |
| [20](#L20) | } |
| [21](#L21) |  |
| [22](#L22) | /\*\* |
| [23](#L23) | \* Class NACC |
| [24](#L24) | \* @package NACCPlugin |
| [25](#L25) | \*/ |
| [26](#L26) | class NACC { |
| [27](#L27) |  |
| [28](#L28) | private const SETTINGS\_GROUP = 'nacc-group'; |
| [29](#L29) | private const DEFAULT\_THEME = 'NACC-Instance'; |
| [30](#L30) | private const DEFAULT\_LANGUAGE = 'en'; |
| [31](#L31) | private const DEFAULT\_LAYOUT = 'linear'; |
| [32](#L32) | private const DEFAULT\_SHOW\_SPECIAL = 'true'; |
| [33](#L33) |  |
| [34](#L34) | private $plugin\_dir; |
| [35](#L35) | /\*\* |
| [36](#L36) | \* Singleton instance of the class. |
| [37](#L37) | \* |
| [38](#L38) | \* @var null|self |
| [39](#L39) | \*/ |
| [40](#L40) | private static ?self $instance = null; |
| [41](#L41) |  |
| [42](#L42) | /\*\* |
| [43](#L43) | \* Constructor method for initializing the plugin. |
| [44](#L44) | \*/ |
| [45](#L45) | public function \_\_construct() { |
| [46](#L46) | $this->plugin\_dir = plugin\_dir\_url( \_\_FILE\_\_ ); |
| [47](#L47) | // Register the 'plugin\_setup' method to be executed during the 'init' action hook |
| [48](#L48) | add\_action( 'init', [ $this, 'plugin\_setup' ] ); |
| [49](#L49) | } |
| [50](#L50) |  |
| [51](#L51) | /\*\* |
| [52](#L52) | \* Setup method for initializing the plugin. |
| [53](#L53) | \* |
| [54](#L54) | \* This method checks if the current context is in the admin dashboard or not. |
| [55](#L55) | \* If in the admin dashboard, it registers admin-related actions and settings. |
| [56](#L56) | \* If not in the admin dashboard, it sets up a shortcode and associated actions. |
| [57](#L57) | \* |
| [58](#L58) | \* @return void |
| [59](#L59) | \*/ |
| [60](#L60) | public function plugin\_setup(): void { |
| [61](#L61) | if ( is\_admin() ) { |
| [62](#L62) | // If in the admin dashboard, register admin menu and settings actions |
| [63](#L63) | add\_action( 'admin\_menu', [ static::class, 'create\_menu' ] ); |
| [64](#L64) | add\_action( 'admin\_init', [ static::class, 'register\_settings' ] ); |
| [65](#L65) | } else { |
| [66](#L66) | // If not in the admin dashboard, set up a shortcode and associated actions |
| [67](#L67) | add\_action( 'wp\_enqueue\_scripts', [ $this, 'assets' ] ); |
| [68](#L68) | add\_shortcode( 'nacc', [ static::class, 'setup\_shortcode' ] ); |
| [69](#L69) | add\_filter( 'do\_shortcode\_tag', [ static::class, 'trigger\_after\_shortcode\_loaded' ], 10, 3 ); |
| [70](#L70) | add\_filter( 'the\_content', [ $this, 'nacc\_content' ] ); // Support for legacy shortcodes |
| [71](#L71) | } |
| [72](#L72) | } |
| [73](#L73) |  |
| [74](#L74) | /\*\* |
| [75](#L75) | \* Setup and render the NACC shortcode. |
| [76](#L76) | \* |
| [77](#L77) | \* This method processes the attributes provided to the [nacc] shortcode and |
| [78](#L78) | \* sets up the necessary shortcode attributes for rendering the N.A. Cleantime |
| [79](#L79) | \* Calculator. If no shortcode attributes are provided, default values from |
| [80](#L80) | \* plugin options are used. |
| [81](#L81) | \* |
| [82](#L82) | \* @param string|array $attrs Shortcode attributes. |
| [83](#L83) | \* @return string The HTML for the NACC shortcode. |
| [84](#L84) | \*/ |
| [85](#L85) | public static function setup\_shortcode( string|array $attrs = [] ): string { |
| [86](#L86) | return '<div id="nacc\_container"></div>'; |
| [87](#L87) | } |
| [88](#L88) |  |
| [89](#L89) | /\*\* |
| [90](#L90) | \* Callback function to trigger actions after the 'nacc' shortcode is loaded. |
| [91](#L91) | \* |
| [92](#L92) | \* @param string $output The output content of the shortcode. |
| [93](#L93) | \* @param string $tag The shortcode tag. |
| [94](#L94) | \* @param string|array $attrs The attributes passed to the shortcode. |
| [95](#L95) | \* |
| [96](#L96) | \* @return string The modified output content. |
| [97](#L97) | \*/ |
| [98](#L98) | public static function trigger\_after\_shortcode\_loaded( string $output, string $tag, string|array $attrs = [] ): string { |
| [99](#L99) | if ( 'nacc' === $tag ) { |
| [100](#L100) | global $shortcode\_attrs; |
| [101](#L101) | // add\_action('wp\_enqueue\_scripts', [$this, 'assets']); |
| [102](#L102) | // Get shortcode attributes or use default values from options |
| [103](#L103) | $theme = ! empty( $attrs['theme'] ) ? sanitize\_text\_field( strtoupper( $attrs['theme'] ) ) : get\_option( 'nacc\_theme' ); |
| [104](#L104) | $language = ! empty( $attrs['lang'] ) ? sanitize\_text\_field( strtolower( $attrs['lang'] ) ) : get\_option( 'nacc\_language' ); |
| [105](#L105) | $layout = ! empty( $attrs['layout'] ) ? sanitize\_text\_field( strtolower( $attrs['layout'] ) ) : get\_option( 'nacc\_layout' ); |
| [106](#L106) | $special = ! empty( $attrs['special'] ) ? sanitize\_text\_field( strtolower( $attrs['special'] ) ) : get\_option( 'nacc\_special' ); |
| [107](#L107) | $site\_uri = plugins\_url( 'nacc2', \_\_FILE\_\_ ); |
| [108](#L108) | $shortcode\_attrs = [ |
| [109](#L109) | 'theme' => $theme, |
| [110](#L110) | 'lang' => $language, |
| [111](#L111) | 'layout' => $layout, |
| [112](#L112) | 'special' => $special, |
| [113](#L113) | 'siteURI' => $site\_uri, |
| [114](#L114) | ]; |
| [115](#L115) | add\_action( |
| [116](#L116) | 'wp\_footer', |
| [117](#L117) | function () use ( $shortcode\_attrs ) { |
| [118](#L118) | static::render\_keytags( $shortcode\_attrs ); |
| [119](#L119) | } |
| [120](#L120) | ); |
| [121](#L121) | return $output; |
| [122](#L122) | } |
| [123](#L123) | return $output; |
| [124](#L124) | } |
| [125](#L125) |  |
| [126](#L126) | /\*\* |
| [127](#L127) | \* Render JavaScript for the shortcode. |
| [128](#L128) | \* |
| [129](#L129) | \* This method generates and adds inline JavaScript to initialize |
| [130](#L130) | \* the NACC (N.A. Cleantime Calculator) with the provided shortcode attributes. |
| [131](#L131) | \* |
| [132](#L132) | \* @param array $args |
| [133](#L133) | \* @return void |
| [134](#L134) | \*/ |
| [135](#L135) | private static function render\_keytags( array $args ): void { |
| [136](#L136) | wp\_add\_inline\_script( 'nacc-js', 'var nacc = new NACC(\'nacc\_container\', "' . $args['theme'] . '", "' . $args['lang'] . '", "' . $args['layout'] . '", "' . $args['special'] . '", "' . $args['siteURI'] . '");' ); |
| [137](#L137) | } |
| [138](#L138) |  |
| [139](#L139) | /\*\* Begin Code to Support Legacy non standard shortcode syntax IE. `<!-- NACC -->` or `[[NACC]]` \*/ |
| [140](#L140) | /\*\* |
| [141](#L141) | \* Process content and replace a shortcode with CleanTime Calculator HTML. |
| [142](#L142) | \* |
| [143](#L143) | \* @param string $the\_content The content to process. |
| [144](#L144) | \* |
| [145](#L145) | \* @return string The modified content with CleanTime Calculator HTML. |
| [146](#L146) | \*/ |
| [147](#L147) | public function nacc\_content( string $the\_content ): string { |
| [148](#L148) | // Get the shortcode and decode it |
| [149](#L149) | $shortcode = html\_entity\_decode( $this->get\_shortcode( $the\_content ) ?? '' ); |
| [150](#L150) |  |
| [151](#L151) | // Check if a shortcode was found |
| [152](#L152) | if ( ! empty( $shortcode ) ) { |
| [153](#L153) | // Parse shortcode parameters, Initialize default values |
| [154](#L154) | $shortcode\_obj = explode( ',', $shortcode ); |
| [155](#L155) | $shortcode\_obj = array\_map( fn( $value ) => trim( trim( $value ), "'" ), $shortcode\_obj ); |
| [156](#L156) |  |
| [157](#L157) | // Prepare parameters for rendering |
| [158](#L158) | $params = [ |
| [159](#L159) | 'theme' => $shortcode\_obj[0] ?? self::DEFAULT\_THEME, |
| [160](#L160) | 'lang' => $shortcode\_obj[1] ?? self::DEFAULT\_LANGUAGE, |
| [161](#L161) | 'layout' => $shortcode\_obj[2] ?? self::DEFAULT\_LAYOUT, |
| [162](#L162) | 'special' => $shortcode\_obj[3] ?? self::DEFAULT\_SHOW\_SPECIAL, |
| [163](#L163) | 'siteURI' => plugins\_url( 'nacc2', \_\_FILE\_\_ ), |
| [164](#L164) | ]; |
| [165](#L165) |  |
| [166](#L166) | // Initialize the CleanTime Calculator text |
| [167](#L167) | $cc\_text = '<div id="nacc\_container"></div>' . "\n"; |
| [168](#L168) | $cc\_text .= '<noscript>'; |
| [169](#L169) | $cc\_text .= '<h1 style="text-align:center">JavaScript Required</h1>'; |
| [170](#L170) | $cc\_text .= '<h2 style="text-align:center">Sadly, you must enable JavaScript on your browser in order to use this cleantime calculator.</h2>'; |
| [171](#L171) | $cc\_text .= '</noscript>' . "\n"; |
| [172](#L172) |  |
| [173](#L173) | // Replace the shortcode in the content with CleanTime Calculator HTML |
| [174](#L174) | $the\_content = $this->replace\_shortcode( $the\_content, $cc\_text ); |
| [175](#L175) |  |
| [176](#L176) | // Add an action to render legacy keytags in wp\_footer |
| [177](#L177) | add\_action( |
| [178](#L178) | 'wp\_footer', |
| [179](#L179) | function () use ( $params ) { |
| [180](#L180) | static::render\_keytags( $params ); |
| [181](#L181) | } |
| [182](#L182) | ); |
| [183](#L183) | } |
| [184](#L184) |  |
| [185](#L185) | return $the\_content; |
| [186](#L186) | } |
| [187](#L187) |  |
| [188](#L188) | /\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*/ |
| [189](#L189) | /\*\* |
| [190](#L190) | \*   \brief This will parse the given text, to see if it contains the submitted code.    \* |
| [191](#L191) | \*                                                                                       \* |
| [192](#L192) | \*   The code can be contained in EITHER an HTML comment (<!--CODE-->), OR a double-[[]] \* |
| [193](#L193) | \*   notation.                                                                           \* |
| [194](#L194) | \*                                                                                       \* |
| [195](#L195) | \*   \returns A string, consisting of the new text.                                      \* |
| [196](#L196) | \*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\* |
| [197](#L197) | \* @param string $in\_text\_to\_parse |
| [198](#L198) | \* @param string $in\_replacement\_text |
| [199](#L199) | \* @return string|null |
| [200](#L200) | \*/ |
| [201](#L201) | private function replace\_shortcode( |
| [202](#L202) | string $in\_text\_to\_parse,      ///< The text to search for shortcodes |
| [203](#L203) | string $in\_replacement\_text    ///< The text we'll be replacing the shortcode with. |
| [204](#L204) | ): string|null { |
| [205](#L205) | // Define the regular expressions for shortcode in HTML and brackets |
| [206](#L206) | $code\_regex\_html = '/(\<p[^\>]\*?\>)?<!--\s?nacc\s?(\(.\*?\))?\s?-->(\<\/p>)?/i'; |
| [207](#L207) | $code\_regex\_brackets = '/(\<p[^\>]\*?\>)?\[\[\s?nacc\s?(\(.\*?\))?\s?]](\<\/p>)?/i'; |
| [208](#L208) |  |
| [209](#L209) | // Replace shortcodes in both formats with the replacement text |
| [210](#L210) | $ret = preg\_replace( $code\_regex\_html, $in\_replacement\_text, $in\_text\_to\_parse, 1 ); |
| [211](#L211) | $ret = preg\_replace( $code\_regex\_brackets, $in\_replacement\_text, $ret, 1 ); |
| [212](#L212) |  |
| [213](#L213) | return $ret; |
| [214](#L214) | } |
| [215](#L215) |  |
| [216](#L216) | /\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*/ |
| [217](#L217) | /\*\* |
| [218](#L218) | \*   \brief This will parse the given text, to see if it contains the submitted code.    \* |
| [219](#L219) | \*                                                                                       \* |
| [220](#L220) | \*   The code can be contained in EITHER an HTML comment (<!--CODE-->), OR a double-[[]] \* |
| [221](#L221) | \*   notation.                                                                           \* |
| [222](#L222) | \*                                                                                       \* |
| [223](#L223) | \*   \returns Boolean true if the code is found (1 or more instances), OR an associative \* |
| [224](#L224) | \*   array of data that is associated with the code (anything within parentheses). Null  \* |
| [225](#L225) | \*   is returned if there is no shortcode detected.                                      \* |
| [226](#L226) | \*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\* |
| [227](#L227) | \* @param string $in\_text\_to\_parse |
| [228](#L228) | \* @return mixed |
| [229](#L229) | \*/ |
| [230](#L230) | private function get\_shortcode( string $in\_text\_to\_parse ) { |
| [231](#L231) | // Define the regular expressions for shortcode in HTML and brackets |
| [232](#L232) | $code\_regex\_html = '/<!--\s?nacc\s?(\(.\*?\))?\s?-->/i'; |
| [233](#L233) | $code\_regex\_brackets = '/\[\[\s?nacc\s?(\(.\*?\))?\s?]]/i'; |
| [234](#L234) |  |
| [235](#L235) | // Initialize the result |
| [236](#L236) | $ret = null; |
| [237](#L237) |  |
| [238](#L238) | // Try to match the shortcode using both regular expressions |
| [239](#L239) | if ( preg\_match( $code\_regex\_html, $in\_text\_to\_parse, $matches ) || preg\_match( $code\_regex\_brackets, $in\_text\_to\_parse, $matches ) ) { |
| [240](#L240) | // Check if there are any parameters and extract them |
| [241](#L241) | if ( ! empty( $matches[1] ) ) { |
| [242](#L242) | $ret = trim( $matches[1], '()' ); |
| [243](#L243) | } else { |
| [244](#L244) | $ret = true; // No parameters, set to true |
| [245](#L245) | } |
| [246](#L246) | } |
| [247](#L247) |  |
| [248](#L248) | return $ret; |
| [249](#L249) | } |
| [250](#L250) | /\*\* End Code to Support Legacy \*/ |
| [251](#L251) |  |
| [252](#L252) | /\*\* |
| [253](#L253) | \* Enqueue plugin styles and scripts. |
| [254](#L254) | \* |
| [255](#L255) | \* This method is responsible for enqueueing the necessary CSS and JavaScript |
| [256](#L256) | \* files for the NACC plugin to function correctly. |
| [257](#L257) | \* |
| [258](#L258) | \* @return void |
| [259](#L259) | \*/ |
| [260](#L260) | public function assets(): void { |
| [261](#L261) | // Enqueue plugin styles and scripts |
| [262](#L262) | wp\_enqueue\_style( 'nacc-css', $this->plugin\_dir . 'nacc2/nacc.css', false, filemtime( plugin\_dir\_path( \_\_FILE\_\_ ) . 'nacc2/nacc.css' ), false ); |
| [263](#L263) | wp\_enqueue\_script( 'nacc-js', $this->plugin\_dir . 'nacc2/nacc.js', [], '4.0', true ); |
| [264](#L264) | } |
| [265](#L265) |  |
| [266](#L266) | /\*\* |
| [267](#L267) | \* Register plugin settings with WordPress. |
| [268](#L268) | \* |
| [269](#L269) | \* This method registers the plugin settings with WordPress using the |
| [270](#L270) | \* `register\_setting` function. It defines the settings for 'nacc\_theme', |
| [271](#L271) | \* 'nacc\_language', 'nacc\_layout', and 'nacc\_special'. |
| [272](#L272) | \* |
| [273](#L273) | \* @return void |
| [274](#L274) | \*/ |
| [275](#L275) | public static function register\_settings(): void { |
| [276](#L276) | // Register plugin settings with WordPress |
| [277](#L277) | register\_setting( |
| [278](#L278) | self::SETTINGS\_GROUP, |
| [279](#L279) | 'nacc\_theme', |
| [280](#L280) | [ |
| [281](#L281) | 'type' => 'string', |
| [282](#L282) | 'default' => self::DEFAULT\_THEME, |
| [283](#L283) | 'sanitize\_callback' => 'sanitize\_text\_field', |
| [284](#L284) | ] |
| [285](#L285) | ); |
| [286](#L286) | register\_setting( |
| [287](#L287) | self::SETTINGS\_GROUP, |
| [288](#L288) | 'nacc\_language', |
| [289](#L289) | [ |
| [290](#L290) | 'type' => 'string', |
| [291](#L291) | 'default' => self::DEFAULT\_LANGUAGE, |
| [292](#L292) | 'sanitize\_callback' => 'sanitize\_text\_field', |
| [293](#L293) | ] |
| [294](#L294) | ); |
| [295](#L295) | register\_setting( |
| [296](#L296) | self::SETTINGS\_GROUP, |
| [297](#L297) | 'nacc\_layout', |
| [298](#L298) | [ |
| [299](#L299) | 'type' => 'string', |
| [300](#L300) | 'default' => self::DEFAULT\_LAYOUT, |
| [301](#L301) | 'sanitize\_callback' => 'sanitize\_text\_field', |
| [302](#L302) | ] |
| [303](#L303) | ); |
| [304](#L304) | register\_setting( |
| [305](#L305) | self::SETTINGS\_GROUP, |
| [306](#L306) | 'nacc\_special', |
| [307](#L307) | [ |
| [308](#L308) | 'type' => 'boolean', |
| [309](#L309) | 'sanitize\_callback' => 'wp\_validate\_boolean', |
| [310](#L310) | ] |
| [311](#L311) | ); |
| [312](#L312) | } |
| [313](#L313) |  |
| [314](#L314) | /\*\* |
| [315](#L315) | \* Create the plugin's settings menu in the WordPress admin. |
| [316](#L316) | \* |
| [317](#L317) | \* This method adds the NACC plugin's settings page to the WordPress admin menu. |
| [318](#L318) | \* It also adds a settings link in the list of plugins on the plugins page. |
| [319](#L319) | \* |
| [320](#L320) | \* @return void |
| [321](#L321) | \*/ |
| [322](#L322) | public static function create\_menu(): void { |
| [323](#L323) | // Create the plugin's settings page in the WordPress admin menu |
| [324](#L324) | add\_options\_page( |
| [325](#L325) | esc\_html\_\_( 'NACC Settings' ), // Page Title |
| [326](#L326) | esc\_html\_\_( 'NACC' ),          // Menu Title |
| [327](#L327) | 'manage\_options',            // Capability |
| [328](#L328) | 'nacc',                      // Menu Slug |
| [329](#L329) | [ static::class, 'draw\_settings' ]      // Callback function to display the page content |
| [330](#L330) | ); |
| [331](#L331) | // Add a settings link in the plugins list |
| [332](#L332) | add\_filter( 'plugin\_action\_links\_' . plugin\_basename( \_\_FILE\_\_ ), [ static::class, 'settings\_link' ] ); |
| [333](#L333) | } |
| [334](#L334) |  |
| [335](#L335) | /\*\* |
| [336](#L336) | \* Add a "Settings" link for the plugin in the WordPress admin. |
| [337](#L337) | \* |
| [338](#L338) | \* This method adds a "Settings" link for the NACC plugin in the WordPress admin |
| [339](#L339) | \* under the plugins list. |
| [340](#L340) | \* |
| [341](#L341) | \* @param array $links An array of plugin action links. |
| [342](#L342) | \* |
| [343](#L343) | \* @return array An updated array of plugin action links. |
| [344](#L344) | \*/ |
| [345](#L345) | public static function settings\_link( array $links ): array { |
| [346](#L346) | // Add a "Settings" link for the plugin in the WordPress admin |
| [347](#L347) | $settings\_url = admin\_url( 'options-general.php?page=nacc' ); |
| [348](#L348) | $links[] = "<a href='{$settings\_url}'>Settings</a>"; |
| [349](#L349) | return $links; |
| [350](#L350) | } |
| [351](#L351) |  |
| [352](#L352) | /\*\* |
| [353](#L353) | \* Display the plugin's settings page. |
| [354](#L354) | \* |
| [355](#L355) | \* This method renders and displays the settings page for the NACC plugin in the WordPress admin. |
| [356](#L356) | \* It includes form fields for configuring plugin settings such as theme, language, layout, and special keytags. |
| [357](#L357) | \* |
| [358](#L358) | \* @return void |
| [359](#L359) | \*/ |
| [360](#L360) | public static function draw\_settings(): void { |
| [361](#L361) | // Display the plugin's settings page |
| [362](#L362) | $nacc\_theme = esc\_attr( get\_option( 'nacc\_theme' ) ); |
| [363](#L363) | $nacc\_special = esc\_attr( get\_option( 'nacc\_special' ) ); |
| [364](#L364) | $nacc\_language = esc\_attr( get\_option( 'nacc\_language' ) ); |
| [365](#L365) | $nacc\_layout = esc\_attr( get\_option( 'nacc\_layout' ) ); |
| [366](#L366) | $allowed\_html = [ |
| [367](#L367) | 'select' => [ |
| [368](#L368) | 'id'   => [], |
| [369](#L369) | 'name' => [], |
| [370](#L370) | ], |
| [371](#L371) | 'option' => [ |
| [372](#L372) | 'value'   => [], |
| [373](#L373) | 'selected'   => [], |
| [374](#L374) | ], |
| [375](#L375) | ]; |
| [376](#L376) | ?> |
| [377](#L377) | <div class="wrap"> |
| [378](#L378) | <h2>NACC Settings</h2> |
| [379](#L379) | <form method="post" action="options.php"> |
| [380](#L380) | <?php settings\_fields( 'nacc-group' ); ?> |
| [381](#L381) | <?php do\_settings\_sections( 'nacc-group' ); ?> |
| [382](#L382) | <table class="form-table"> |
| [383](#L383) | <tr valign="top"> |
| [384](#L384) | <th scope="row">Theme</th> |
| [385](#L385) | <td> |
| [386](#L386) | <?php |
| [387](#L387) | echo wp\_kses( |
| [388](#L388) | static::render\_select\_option( |
| [389](#L389) | 'nacc\_theme', |
| [390](#L390) | $nacc\_theme, |
| [391](#L391) | [ |
| [392](#L392) | 'NACC-BT' => 'BT', |
| [393](#L393) | 'NACC-CRNA' => 'CRNA', |
| [394](#L394) | 'NACC-Instance' => 'Default', |
| [395](#L395) | 'NACC-GNYR2' => 'GNYR2', |
| [396](#L396) | 'NACC-HOLI' => 'HOLI', |
| [397](#L397) | 'NACC-NERNA' => 'NERNA', |
| [398](#L398) | 'NACC-SEZF' => 'SEZF', |
| [399](#L399) | ] |
| [400](#L400) | ), |
| [401](#L401) | $allowed\_html |
| [402](#L402) | ); |
| [403](#L403) | ?> |
| [404](#L404) | </td> |
| [405](#L405) | </tr> |
| [406](#L406) | <tr valign="top"> |
| [407](#L407) | <th scope="row">Language</th> |
| [408](#L408) | <td> |
| [409](#L409) | <?php |
| [410](#L410) | echo wp\_kses( |
| [411](#L411) | static::render\_select\_option( |
| [412](#L412) | 'nacc\_language', |
| [413](#L413) | $nacc\_language, |
| [414](#L414) | [ |
| [415](#L415) | 'en' => 'English', |
| [416](#L416) | 'es' => 'Español', |
| [417](#L417) | 'it' => 'Italiano', |
| [418](#L418) | 'zh-Hans' => 'zh-Hans', |
| [419](#L419) | 'zh-Hant' => 'zh-Hant', |
| [420](#L420) | ] |
| [421](#L421) | ), |
| [422](#L422) | $allowed\_html |
| [423](#L423) | ); |
| [424](#L424) | ?> |
| [425](#L425) | </td> |
| [426](#L426) | </tr> |
| [427](#L427) | <tr valign="top"> |
| [428](#L428) | <th scope="row">Layout</th> |
| [429](#L429) | <td> |
| [430](#L430) | <?php |
| [431](#L431) | echo wp\_kses( |
| [432](#L432) | static::render\_select\_option( |
| [433](#L433) | 'nacc\_layout', |
| [434](#L434) | $nacc\_layout, |
| [435](#L435) | [ |
| [436](#L436) | 'tabular' => 'Tabular', |
| [437](#L437) | 'linear' => 'Linear', |
| [438](#L438) | ] |
| [439](#L439) | ), |
| [440](#L440) | $allowed\_html |
| [441](#L441) | ); |
| [442](#L442) | ?> |
| [443](#L443) | </td> |
| [444](#L444) | </tr> |
| [445](#L445) | <tr valign="top"> |
| [446](#L446) | <th scope="row">Show Special Keytags</th> |
| [447](#L447) | <td> |
| [448](#L448) | <input type="checkbox" name="nacc\_special" value="1" <?php checked( 1, $nacc\_special ); ?> /> |
| [449](#L449) | <label for="nacc\_special">If true, then the "specialty" (over 2 years) tags are displayed. Default is false.</label> |
| [450](#L450) | </td> |
| [451](#L451) | </tr> |
| [452](#L452) | </table> |
| [453](#L453) | <?php submit\_button(); ?> |
| [454](#L454) | </form> |
| [455](#L455) | </div> |
| [456](#L456) | <?php |
| [457](#L457) | } |
| [458](#L458) |  |
| [459](#L459) | /\*\* |
| [460](#L460) | \* Render a dropdown select input for plugin settings. |
| [461](#L461) | \* |
| [462](#L462) | \* This method generates the HTML markup for a dropdown select input field with the specified name |
| [463](#L463) | \* and options. It also preselects the option that matches the provided selected value. |
| [464](#L464) | \* |
| [465](#L465) | \* @param string $name          The name attribute for the select input. |
| [466](#L466) | \* @param string $selected\_value The value to be preselected in the dropdown. |
| [467](#L467) | \* @param array  $options       An associative array of options (value => label) for the dropdown. |
| [468](#L468) | \* |
| [469](#L469) | \* @return string The generated HTML markup for the select input. |
| [470](#L470) | \*/ |
| [471](#L471) | private static function render\_select\_option( string $name, string $selected\_value, array $options ): string { |
| [472](#L472) | // Render a dropdown select input for settings |
| [473](#L473) | $select\_html = "<select id='$name' name='$name'>"; |
| [474](#L474) | foreach ( $options as $value => $label ) { |
| [475](#L475) | $selected = selected( $selected\_value, $value, false ); |
| [476](#L476) | $select\_html .= "<option value='$value' $selected>$label</option>"; |
| [477](#L477) | } |
| [478](#L478) | $select\_html .= '</select>'; |
| [479](#L479) |  |
| [480](#L480) | return $select\_html; |
| [481](#L481) | } |
| [482](#L482) |  |
| [483](#L483) | /\*\* |
| [484](#L484) | \* Get an instance of the NACC plugin class. |
| [485](#L485) | \* |
| [486](#L486) | \* This method ensures that only one instance of the NACC class is created during the plugin's lifecycle. |
| [487](#L487) | \* |
| [488](#L488) | \* @return self An instance of the NACC class. |
| [489](#L489) | \*/ |
| [490](#L490) | public static function get\_instance(): self { |
| [491](#L491) | if ( null == self::$instance ) { |
| [492](#L492) | self::$instance = new self(); |
| [493](#L493) | } |
| [494](#L494) | return self::$instance; |
| [495](#L495) | } |
| [496](#L496) | } |
| [497](#L497) |  |
| [498](#L498) | NACC::get\_instance(); |

**Note:** See [TracBrowser](/wiki/TracBrowser)
for help on using the repository browser.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Plain Text](/browser/nacc-wordpress-plugin/tags/4.1.0/nacc-wordpress-plugin.php?format=txt)
* [Original Format](/export/3222453/nacc-wordpress-plugin/tags/4.1.0/nacc-wordpress-plugin.php)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)


