=== Content from plugins.trac.wordpress.org_1bb11817_20250114_184038.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fbrowser%2Fbp-email-assign-templates%2Ftrunk%2Fpp-email-templates-admin.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Revision](/browser/bp-email-assign-templates/trunk/pp-email-templates-admin.php?rev=2648754 "Revision 2648754")
* Next Revision →
* [Blame](/browser/bp-email-assign-templates/trunk/pp-email-templates-admin.php?annotate=blame "Annotate each line with the last changed revision (this can be time consuming...)")
* [Revision Log](/log/bp-email-assign-templates/trunk/pp-email-templates-admin.php)

---

# [source:](/browser?order=name "Go to repository root") [bp-email-assign-templates](/browser/bp-email-assign-templates?order=name "View bp-email-assign-templates")/[trunk](/browser/bp-email-assign-templates/trunk?order=name "View trunk")/[pp-email-templates-admin.php](/browser/bp-email-assign-templates/trunk/pp-email-templates-admin.php?order=name "View pp-email-templates-admin.php")

View diff against:

View revision:

| [Last change](/changeset/3206532/bp-email-assign-templates/trunk/pp-email-templates-admin.php "View differences") on this file was [3206532](/changeset/3206532/ "View changeset 3206532"), checked in by shanebp, [5 weeks ago](/timeline?from=2024-12-11T18%3A05%3A19Z&precision=second "See timeline at 12/11/2024 06:05:19 PM") |
| --- |
| commit 1.6 |
| **File size:** 18.4 KB | |

| Line |  |
| --- | --- |
| [1](#L1) | <?php |
| [2](#L2) |  |
| [3](#L3) | // Exit if accessed directly |
| [4](#L4) | if ( !defined( 'ABSPATH' ) ) exit; |
| [5](#L5) |  |
| [6](#L6) | //  the List Table class |
| [7](#L7) | pp\_etemplates\_admin\_list(); |
| [8](#L8) |  |
| [9](#L9) |  |
| [10](#L10) | function pp\_etemplates\_page() { |
| [11](#L11) |  |
| [12](#L12) | $capability = bp\_core\_do\_network\_admin() ? 'manage\_network\_options' : 'manage\_options'; |
| [13](#L13) |  |
| [14](#L14) | $pp\_etemplates\_submenu\_page = add\_submenu\_page( |
| [15](#L15) | 'edit.php?post\_type=' . bp\_get\_email\_post\_type(), |
| [16](#L16) | 'Templates', |
| [17](#L17) | 'Templates', |
| [18](#L18) | $capability, |
| [19](#L19) | 'bp-emails-templates', |
| [20](#L20) | 'pp\_etemplates\_admin\_screen' |
| [21](#L21) | ); |
| [22](#L22) |  |
| [23](#L23) | add\_action( 'load-' . $pp\_etemplates\_submenu\_page, 'pp\_etemplates\_help\_tab' ); |
| [24](#L24) | } |
| [25](#L25) | add\_action('admin\_menu', 'pp\_etemplates\_page', 11 ); |
| [26](#L26) |  |
| [27](#L27) | function pp\_etemplates\_help\_tab () { |
| [28](#L28) |  |
| [29](#L29) | $screen = get\_current\_screen(); |
| [30](#L30) |  |
| [31](#L31) | $content = |
| [32](#L32) | '<p>' . \_\_( 'On this screen, you can create, edit or delete an email template option.', 'bp-email-assign-templates' ) . '</p>' . |
| [33](#L33) | '<p>' . \_\_( 'The Option Name can be anything but should be unique.', 'bp-email-assign-templates' ) . '</p>'; |
| [34](#L34) | $screen->add\_help\_tab( array( |
| [35](#L35) | 'id'        => 'name\_tab', |
| [36](#L36) | 'title'     => \_\_('Option Name', 'bp-email-assign-templates'), |
| [37](#L37) | 'content'       => $content, |
| [38](#L38) | ) ); |
| [39](#L39) |  |
| [40](#L40) | $content = |
| [41](#L41) | '<p>' . \_\_( 'The file name needs to end with ".php" and must be a file that exists in your active theme.', 'bp-email-assign-templates' ) . '</p>' . |
| [42](#L42) | '<p>' . \_\_( 'If you want email templates to live in a separate directory in your theme, then include the path as part of the file name. For example "/bp-email-assign-templates/bp-email-for-friends.php"', 'bp-email-assign-templates' ) . '</p>'; |
| [43](#L43) | $screen->add\_help\_tab( array( |
| [44](#L44) | 'id'        => 'file\_tab', |
| [45](#L45) | 'title'     => \_\_('Option File', 'bp-email-assign-templates'), |
| [46](#L46) | 'content'       => $content, |
| [47](#L47) | ) ); |
| [48](#L48) |  |
| [49](#L49) | $content = |
| [50](#L50) | '<p>' . \_\_( 'BuddyPress includes a <em>single</em> default email template.', 'bp-email-assign-templates' ) . |
| [51](#L51) | ' <a href="https://codex.buddypress.org/emails/#customize-email-template" target="\_blank">'. \_\_('More Info', 'bp-email-assign-templates'). '</a>' . '</p>' . |
| [52](#L52) | '<p>' . \_\_( 'But what if you want multiple and assignable templates? Or have a template that does not use the customizer settings?', 'bp-email-assign-templates' ) . '</p>' . |
| [53](#L53) | '<p>' . \_\_( 'If so, create a copy of the default email template, rename it and adjust as necessary. You can change the layout, include images, remove the customizer setting calls, etc.', 'bp-email-assign-templates' ) . '</p>' . |
| [54](#L54) | '<p>' . \_\_( '[ The customizer settings <em>will apply to all templates</em> that call the customizer settings. ]', 'bp-email-assign-templates' ) . '</p>' . |
| [55](#L55) | '<p>' . \_\_( 'Then upload the new template to your active theme directory and create an option here.', 'bp-email-assign-templates' ) . '</p>' . |
| [56](#L56) | '<p>' . \_\_( 'Your new option will be available for selection on the Email create and edit screens in the lower right area.', 'bp-email-assign-templates' ) . '</p>'; |
| [57](#L57) | $screen->add\_help\_tab( array( |
| [58](#L58) | 'id'        => 'template\_tab', |
| [59](#L59) | 'title'     => \_\_('Create a Template', 'bp-email-assign-templates'), |
| [60](#L60) | 'content'       => $content, |
| [61](#L61) | ) ); |
| [62](#L62) | } |
| [63](#L63) |  |
| [64](#L64) | function pp\_etemplates\_edit\_form( $id ) { |
| [65](#L65) | global $wpdb; |
| [66](#L66) |  |
| [67](#L67) | if ( ! isset( $\_POST['eto-id'] ) ) { |
| [68](#L68) |  |
| [69](#L69) | pp\_etemplates\_scripts(); |
| [70](#L70) |  |
| [71](#L71) | echo '<div class="wrap"><h3>Edit Template Option</h3>'; |
| [72](#L72) |  |
| [73](#L73) | $query = " SELECT \* FROM {$wpdb->prefix}options WHERE option\_id = $id "; |
| [74](#L74) | $eto = $wpdb->get\_row($query); |
| [75](#L75) |  |
| [76](#L76) | if ( $eto != NULL ) { |
| [77](#L77) |  |
| [78](#L78) | $eto\_value = maybe\_unserialize( $eto->option\_value ); |
| [79](#L79) |  |
| [80](#L80) | echo '<form action="' . site\_url() . '/wp-admin/edit.php?post\_type=bp-email&page=bp-emails-templates&action=edit-eto" name="eto-form" id="eto-form" method="post" class="standard-form">'; |
| [81](#L81) |  |
| [82](#L82) | wp\_nonce\_field('eto-edit-action', 'eto-edit-field'); |
| [83](#L83) |  |
| [84](#L84) | ?> |
| [85](#L85) |  |
| [86](#L86) | <table border="0" cellspacing="10"> |
| [87](#L87) |  |
| [88](#L88) | <tr> |
| [89](#L89) | <td>Option Name: <div id='eto-name-error' class='error\_div'></div></td> |
| [90](#L90) | <td><input type="text" name="eto-name" id="eto-name" maxlength="50" size="50" value="<?php echo stripslashes( $eto\_value['oname'] ); ?>" /></td> |
| [91](#L91) | </tr> |
| [92](#L92) |  |
| [93](#L93) | <tr> |
| [94](#L94) | <td>Option File: <div id='eto-file-name-error' class='error\_div'></div></td> |
| [95](#L95) | <td><input type="text" name="eto-file-name" id="eto-file-name" maxlength="50" size="50" value="<?php echo stripslashes( $eto\_value['fname'] ); ?>" /></td> |
| [96](#L96) | </tr> |
| [97](#L97) |  |
| [98](#L98) | </table> |
| [99](#L99) |  |
| [100](#L100) | <input type="hidden" id="eto-editor" name="eto-editor" value="1" /> |
| [101](#L101) | <input type="hidden" name="eto-option-name" id="eto-option-name" value="<?php echo $eto->option\_name; ?>"/> |
| [102](#L102) | <input id="eto-submit" name="eto-submit" type="button" class="button button-primary" onclick="validateEtoForm()" value="<?php \_e('Update Template Option', 'bp-email-assign-templates'); ?>"  /> |
| [103](#L103) | </form> |
| [104](#L104) | <?php |
| [105](#L105) | } |
| [106](#L106) | else |
| [107](#L107) | echo '<br/><div class="error\_div"><strong>' . \_\_('The Template Option was not found.', 'bp-email-assign-templates' ) . '</strong></div>'; |
| [108](#L108) |  |
| [109](#L109) | echo '</div>'; |
| [110](#L110) |  |
| [111](#L111) | } |
| [112](#L112) | } |
| [113](#L113) |  |
| [114](#L114) | function pp\_etemplates\_update\_option() { |
| [115](#L115) |  |
| [116](#L116) | if ( isset( $\_POST['eto-option-name'] ) ) { |
| [117](#L117) |  |
| [118](#L118) | if ( !wp\_verify\_nonce($\_POST['eto-edit-field'],'eto-edit-action') ) |
| [119](#L119) | die('Security Check - Failed'); |
| [120](#L120) |  |
| [121](#L121) | if ( ! current\_user\_can('manage\_options') ) |
| [122](#L122) | return false; |
| [123](#L123) |  |
| [124](#L124) | if ( ! empty( $\_POST['eto-name'] ) && ! empty( $\_POST['eto-file-name'] ) ) { |
| [125](#L125) |  |
| [126](#L126) | $validate\_filename = pp\_etemplates\_validate\_filename( $\_POST['eto-file-name'] ); |
| [127](#L127) |  |
| [128](#L128) | if ( $validate\_filename ) { |
| [129](#L129) |  |
| [130](#L130) | $option\_name = $\_POST['eto-option-name']; |
| [131](#L131) |  |
| [132](#L132) | $option\_value = array( |
| [133](#L133) | 'oname' => $\_POST['eto-name'], |
| [134](#L134) | 'fname' => $\_POST['eto-file-name'], |
| [135](#L135) | ); |
| [136](#L136) |  |
| [137](#L137) | $update\_option = update\_option( $option\_name, $option\_value, false ); |
| [138](#L138) |  |
| [139](#L139) | if ( $update\_option ) |
| [140](#L140) | echo '<br/><div class="entry-content"><strong>' . \_\_('Template Option was Updated', 'bp-email-assign-templates' ) . '</strong></div><br/>'; |
| [141](#L141) | else |
| [142](#L142) | echo '<br/><div class="error\_div"><strong>' . \_\_('There was a problem Updating that Template Option.', 'bp-email-assign-templates' ) . '</strong></div><br/>'; |
| [143](#L143) |  |
| [144](#L144) | } |
| [145](#L145) | else |
| [146](#L146) | echo $validate\_filename; |
| [147](#L147) | } |
| [148](#L148) | else |
| [149](#L149) | echo '<br/><div class="error\_div"><strong>' . \_\_('Please fill out both fields.', 'bp-email-assign-templates' ) . '</strong></div><br/>'; |
| [150](#L150) |  |
| [151](#L151) | } |
| [152](#L152) | } |
| [153](#L153) |  |
| [154](#L154) |  |
| [155](#L155) | function pp\_etemplates\_create\_form() { |
| [156](#L156) |  |
| [157](#L157) | pp\_etemplates\_scripts(); |
| [158](#L158) |  |
| [159](#L159) | echo '<div class="wrap"><h3>Create a Template Option</h3>'; |
| [160](#L160) |  |
| [161](#L161) | echo '<form action="' . site\_url() . '/wp-admin/edit.php?post\_type=bp-email&page=bp-emails-templates&action=create-eto" name="eto-form" id="eto-form"  method="post" class="standard-form">'; |
| [162](#L162) |  |
| [163](#L163) | wp\_nonce\_field('eto-create-action', 'eto-create-field'); |
| [164](#L164) | ?> |
| [165](#L165) |  |
| [166](#L166) | <table border="0" cellspacing="10"> |
| [167](#L167) |  |
| [168](#L168) | <tr> |
| [169](#L169) | <td>Option Name: <div id='eto-name-error' class='error\_div'></div></td> |
| [170](#L170) | <td><input type="text" name="eto-name" id="eto-name" maxlength="50" size="50" value="" /></td> |
| [171](#L171) | </tr> |
| [172](#L172) |  |
| [173](#L173) | <tr> |
| [174](#L174) | <td>Option File: <div id='eto-file-name-error' class='error\_div'></div></td> |
| [175](#L175) | <td><input type="text" name="eto-file-name" id="eto-file-name" maxlength="50" size="50" value="" /><br/><em><?php \_e('The file must already exist in your active theme directory.', 'bp-email-assign-templates'); ?></em></td> |
| [176](#L176) | </tr> |
| [177](#L177) |  |
| [178](#L178) | </table> |
| [179](#L179) | <input type="hidden" id="eto-creator" name="eto-creator" value="1" /> |
| [180](#L180) | <input id="eto-submit" name="eto-submit" type="button" class="button button-primary" onclick="validateEtoForm()" value="<?php \_e('Create Template Option', 'bp-email-assign-templates'); ?>"  /> |
| [181](#L181) |  |
| [182](#L182) | </form> |
| [183](#L183) | </div> |
| [184](#L184) | <?php |
| [185](#L185) | } |
| [186](#L186) |  |
| [187](#L187) |  |
| [188](#L188) |  |
| [189](#L189) | function pp\_etemplates\_create\_option() { |
| [190](#L190) |  |
| [191](#L191) | if ( isset( $\_POST['eto-creator'] ) && $\_POST['eto-creator'] == '1' ) { |
| [192](#L192) |  |
| [193](#L193) | if ( ! empty( $\_POST['eto-name'] ) && ! empty( $\_POST['eto-file-name'] ) ) { |
| [194](#L194) |  |
| [195](#L195) | if ( !wp\_verify\_nonce($\_POST['eto-create-field'],'eto-create-action') ) |
| [196](#L196) | die('Security Check - Failed'); |
| [197](#L197) |  |
| [198](#L198) | if ( ! current\_user\_can('manage\_options') ) |
| [199](#L199) | return false; |
| [200](#L200) |  |
| [201](#L201) |  |
| [202](#L202) | $validate\_filename = pp\_etemplates\_validate\_filename( $\_POST['eto-file-name'] ); |
| [203](#L203) |  |
| [204](#L204) | if ( $validate\_filename ) { |
| [205](#L205) |  |
| [206](#L206) | $count = intval( get\_option( 'bp\_email\_templates\_count' ) ) + 1; |
| [207](#L207) | $option\_name = 'bp-email-template-' . $count; |
| [208](#L208) |  |
| [209](#L209) | $option\_value = array( |
| [210](#L210) | 'oname' => $\_POST['eto-name'], |
| [211](#L211) | 'fname' => $\_POST['eto-file-name'], |
| [212](#L212) | ); |
| [213](#L213) |  |
| [214](#L214) | $new\_option = add\_option( $option\_name, $option\_value, '', false ); |
| [215](#L215) |  |
| [216](#L216) | //write\_log( $new\_option ); |
| [217](#L217) |  |
| [218](#L218) | if ( $new\_option ) { |
| [219](#L219) | update\_option( 'bp\_email\_templates\_count', $count, false ); |
| [220](#L220) | echo '<br/><div class="entry-content"><strong>' . \_\_('Template Option was created.', 'bp-email-assign-templates' ) . '</strong></div><br/>'; |
| [221](#L221) | } |
| [222](#L222) | else |
| [223](#L223) | echo '<br/><div class="error\_div"><strong>' . \_\_('There was a problem creating that Template Option.', 'bp-email-assign-templates' ) . '</strong></div><br/>'; |
| [224](#L224) |  |
| [225](#L225) | } |
| [226](#L226) | else |
| [227](#L227) | echo $validate\_filename; |
| [228](#L228) |  |
| [229](#L229) | } |
| [230](#L230) | else |
| [231](#L231) | echo '<br/><div class="error\_div"><strong>' . \_\_('Please fill out both fields.', 'bp-email-assign-templates' ) . '</strong></div>'; |
| [232](#L232) | } |
| [233](#L233) | } |
| [234](#L234) |  |
| [235](#L235) |  |
| [236](#L236) | function pp\_etemplates\_validate\_filename( $filename ) { |
| [237](#L237) |  |
| [238](#L238) | // check for file name ending in .php |
| [239](#L239) | $file\_name\_end = substr( $filename, -4 ); |
| [240](#L240) |  |
| [241](#L241) | if ( '.php' != $file\_name\_end ) { |
| [242](#L242) |  |
| [243](#L243) | echo '<br/><div class="error\_div"><strong>' . \_\_('The file name must end with .php', 'bp-email-assign-templates' ) . '</strong></div>'; |
| [244](#L244) |  |
| [245](#L245) | return false; |
| [246](#L246) | } |
| [247](#L247) |  |
| [248](#L248) | // check if file exists |
| [249](#L249) | $template\_exists = locate\_template( $filename, false ); |
| [250](#L250) |  |
| [251](#L251) | if ( '' == $template\_exists ) { |
| [252](#L252) |  |
| [253](#L253) | echo '<br/><div class="error\_div"><strong>' . sprintf( \_\_('The file %s was not found in your active theme.', 'bp-email-assign-templates' ), $filename ) . '</strong></div>'; |
| [254](#L254) |  |
| [255](#L255) | return false; |
| [256](#L256) | } |
| [257](#L257) |  |
| [258](#L258) | return true; |
| [259](#L259) | } |
| [260](#L260) |  |
| [261](#L261) |  |
| [262](#L262) | function pp\_etemplates\_admin\_screen() { |
| [263](#L263) | ?> |
| [264](#L264) | <div class="wrap"> |
| [265](#L265) | <div id="icon-tools" class="icon32"><br /></div> |
| [266](#L266) | <h2><?php \_e( 'BuddyPress Email Assign Templates', 'bp-email-assign-templates' )?></h2> |
| [267](#L267) |  |
| [268](#L268) | <?php |
| [269](#L269) | pp\_etemplates\_update\_option(); |
| [270](#L270) |  |
| [271](#L271) | if ( isset( $\_GET['action'] ) ) { |
| [272](#L272) |  |
| [273](#L273) | if ( $\_GET['action'] == 'create-eto' ) |
| [274](#L274) | pp\_etemplates\_create\_option(); |
| [275](#L275) |  |
| [276](#L276) | } |
| [277](#L277) |  |
| [278](#L278) |  |
| [279](#L279) | $pp\_etemplates\_list\_table = new BP\_Email\_Templates\_Table(); |
| [280](#L280) |  |
| [281](#L281) | $pp\_etemplates\_list\_table->prepare\_items(); |
| [282](#L282) |  |
| [283](#L283) |  |
| [284](#L284) | if ( isset( $\_GET['action'] ) ) { |
| [285](#L285) | if ( $\_GET['action'] == 'edit-single' ) |
| [286](#L286) | pp\_etemplates\_edit\_form( $\_GET['gid'] ); |
| [287](#L287) | else |
| [288](#L288) | pp\_etemplates\_create\_form(); |
| [289](#L289) | } |
| [290](#L290) | else |
| [291](#L291) | pp\_etemplates\_create\_form(); |
| [292](#L292) |  |
| [293](#L293) | ?> |
| [294](#L294) |  |
| [295](#L295) | <br /> |
| [296](#L296) |  |
| [297](#L297) | <form id="eto-filter" method="post"> |
| [298](#L298) | <input type="hidden" name="page" value="<?php echo esc\_attr( $\_REQUEST['page'] ) ?>" /> |
| [299](#L299) | <?php $pp\_etemplates\_list\_table->display();  ?> |
| [300](#L300) | </form> |
| [301](#L301) |  |
| [302](#L302) | </div> |
| [303](#L303) | <?php |
| [304](#L304) | } |
| [305](#L305) |  |
| [306](#L306) |  |
| [307](#L307) | function pp\_etemplates\_admin\_styles() { |
| [308](#L308) |  |
| [309](#L309) | $page = ( isset($\_GET['page'] ) ) ? esc\_attr( $\_GET['page'] ) : false; |
| [310](#L310) |  |
| [311](#L311) | if ( 'bp-emails-templates' != $page ) |
| [312](#L312) | return; |
| [313](#L313) |  |
| [314](#L314) | $style\_str = '<style type="text/css">'; |
| [315](#L315) | $style\_str .= '.column-name { width: 30%; }'; |
| [316](#L316) | $style\_str .= '.column-file-name { width: 60%; }'; |
| [317](#L317) | $style\_str .= '</style>'; |
| [318](#L318) | echo $style\_str; |
| [319](#L319) | } |
| [320](#L320) | add\_action( 'admin\_head', 'pp\_etemplates\_admin\_styles'  ); |
| [321](#L321) |  |
| [322](#L322) |  |
| [323](#L323) | function pp\_etemplates\_admin\_list() { |
| [324](#L324) |  |
| [325](#L325) | if (!class\_exists('WP\_List\_Table')){ |
| [326](#L326) | require\_once( ABSPATH . 'wp-admin/includes/class-wp-list-table.php' ); |
| [327](#L327) | } |
| [328](#L328) |  |
| [329](#L329) | class BP\_Email\_Templates\_Table extends WP\_List\_Table { |
| [330](#L330) |  |
| [331](#L331) | function \_\_construct() { |
| [332](#L332) | parent::\_\_construct( array( |
| [333](#L333) | 'singular'=> 'eto', |
| [334](#L334) | 'plural' => 'etos', |
| [335](#L335) | 'ajax'  => false |
| [336](#L336) | ) ); |
| [337](#L337) | } |
| [338](#L338) |  |
| [339](#L339) | function get\_columns() { |
| [340](#L340) | return $columns= array( |
| [341](#L341) | 'cb'            => '<input type="checkbox" />', |
| [342](#L342) | 'name'          => \_\_('Name'), |
| [343](#L343) | 'file-name'     => \_\_('File'), |
| [344](#L344) | ); |
| [345](#L345) | } |
| [346](#L346) |  |
| [347](#L347) |  |
| [348](#L348) | function get\_bulk\_actions() { |
| [349](#L349) | $actions = array( |
| [350](#L350) | 'delete' => 'Delete' |
| [351](#L351) | ); |
| [352](#L352) | return $actions; |
| [353](#L353) | } |
| [354](#L354) |  |
| [355](#L355) |  |
| [356](#L356) | function delete\_eto( $id ) { |
| [357](#L357) | global $wpdb; |
| [358](#L358) |  |
| [359](#L359) | $wpdb->query( "DELETE FROM $wpdb->options WHERE option\_id = $id" ); |
| [360](#L360) |  |
| [361](#L361) | } |
| [362](#L362) |  |
| [363](#L363) | function process\_bulk\_action() { |
| [364](#L364) |  |
| [365](#L365) | if ( 'delete'===$this->current\_action() ) { |
| [366](#L366) | foreach($\_POST['bid'] as $id) { |
| [367](#L367) | $this->delete\_eto( $id ); |
| [368](#L368) | } |
| [369](#L369) | } |
| [370](#L370) |  |
| [371](#L371) | if ( 'delete-single'===$this->current\_action() ) { |
| [372](#L372) | if (! wp\_verify\_nonce($\_REQUEST['\_wpnonce'], 'eto-nonce') ) die('Security check'); |
| [373](#L373) | $this->delete\_eto( $\_GET['gid'] ); |
| [374](#L374) | } |
| [375](#L375) |  |
| [376](#L376) | } |
| [377](#L377) |  |
| [378](#L378) |  |
| [379](#L379) | function prepare\_items( $search = NULL ) { |
| [380](#L380) | global $wpdb, $\_wp\_column\_headers; |
| [381](#L381) |  |
| [382](#L382) | $screen = get\_current\_screen(); |
| [383](#L383) |  |
| [384](#L384) | $this->process\_bulk\_action(); |
| [385](#L385) |  |
| [386](#L386) | $query = "SELECT \* FROM {$wpdb->prefix}options WHERE option\_name LIKE 'bp-email-template-%' ORDER BY option\_id DESC "; |
| [387](#L387) |  |
| [388](#L388) | $columns = $this->get\_columns(); |
| [389](#L389) | $hidden = array(); |
| [390](#L390) | $sortable = $this->get\_sortable\_columns(); |
| [391](#L391) | $this->\_column\_headers = array($columns, $hidden, $sortable); |
| [392](#L392) |  |
| [393](#L393) | $this->items = $wpdb->get\_results($query); |
| [394](#L394) |  |
| [395](#L395) | } |
| [396](#L396) |  |
| [397](#L397) |  |
| [398](#L398) |  |
| [399](#L399) | function display\_rows() { |
| [400](#L400) | global $wpdb; |
| [401](#L401) |  |
| [402](#L402) | $records = $this->items;        //print\_r( $records ); |
| [403](#L403) |  |
| [404](#L404) | list( $columns, $hidden ) = $this->get\_column\_info(); |
| [405](#L405) |  |
| [406](#L406) | if ( !empty($records) ) { |
| [407](#L407) | foreach( $records as $rec ) { |
| [408](#L408) |  |
| [409](#L409) | $rec\_data = maybe\_unserialize( $rec->option\_value ); |
| [410](#L410) |  |
| [411](#L411) | if ( $rec\_data['oname'] == 'Default Template' ) { |
| [412](#L412) | echo '<tr id="record\_0"><th scope="row" class="check-column"></th><td class="name column-name">Default Template<br><div class="row-actions"><span class="edit"><a href="https://codex.buddypress.org/emails/#customize-email-template" target="\_blank">This is the default template. You cannot delete it, but you can overload it. More info...</a></div></td><td class="file-name column-file-name">single-bp-email.php</td>'; |
| [413](#L413) | } |
| [414](#L414) | else { |
| [415](#L415) | echo '<tr id="record\_'.$rec->option\_id.'">'; |
| [416](#L416) | foreach ( $columns as $column\_name => $column\_display\_name ) { |
| [417](#L417) |  |
| [418](#L418) | $class = "class='$column\_name column-$column\_name'"; |
| [419](#L419) | $style = ""; |
| [420](#L420) | if ( in\_array( $column\_name, $hidden ) ) $style = ' style="display:none;"'; |
| [421](#L421) | $attributes = $class . $style; |
| [422](#L422) |  |
| [423](#L423) | switch ( $column\_name ) { |
| [424](#L424) |  |
| [425](#L425) | case "cb": |
| [426](#L426) | echo '<th scope="row" class="check-column">'; |
| [427](#L427) | echo '<input type="checkbox" name="bid[]" value="' . $rec->option\_id . '"/>'; |
| [428](#L428) | echo '</th>'; |
| [429](#L429) | break; |
| [430](#L430) |  |
| [431](#L431) | case "name": |
| [432](#L432) | echo '<td '. $attributes . '>' . stripslashes($rec\_data['oname']); |
| [433](#L433) | echo "<br /><div class='row-actions'><span class='edit'>"; |
| [434](#L434) | $edit\_nonce= wp\_create\_nonce('eto-edit-nonce'); |
| [435](#L435) | echo sprintf('<a href="?post\_type=bp-email&page=%s&action=%s&gid=%s&\_wpnonce=%s" ">' . \_\_('Edit', 'bp-email-assign-templates') . '</a>',esc\_attr( $\_REQUEST['page'] ),'edit-single',$rec->option\_id,$edit\_nonce); |
| [436](#L436) | echo "</span> | <span class='trash'>"; |
| [437](#L437) | $nonce= wp\_create\_nonce('eto-nonce'); |
| [438](#L438) | echo sprintf('<a href="?post\_type=bp-email&page=%s&action=%s&gid=%s&\_wpnonce=%s" onclick="return confirm(\'Are you sure you want to Delete this Template Option?\');">' . \_\_('Delete', 'bp-email-assign-templates') . '</a>',esc\_attr( $\_REQUEST['page'] ),'delete-single',$rec->option\_id,$nonce); |
| [439](#L439) | echo "</span></div></td>"; |
| [440](#L440) | break; |
| [441](#L441) |  |
| [442](#L442) | case "file-name": |
| [443](#L443) | echo '<td '. $attributes . '>'. $rec\_data['fname'] . "</td>"; |
| [444](#L444) | break; |
| [445](#L445) | } |
| [446](#L446) | } |
| [447](#L447) | echo'</tr>'; |
| [448](#L448) | } |
| [449](#L449) | } |
| [450](#L450) | } |
| [451](#L451) | } |
| [452](#L452) | } |
| [453](#L453) | } |
| [454](#L454) |  |
| [455](#L455) | // print scripts and styles for create / edit forms |
| [456](#L456) | function pp\_etemplates\_scripts() { |
| [457](#L457) | ?> |
| [458](#L458) | <style> .error\_div { color: red; } </style> |
| [459](#L459) |  |
| [460](#L460) | <script type="text/javascript"> |
| [461](#L461) |  |
| [462](#L462) | function validateEtoForm() { |
| [463](#L463) | removeEtoValidationErrors(); |
| [464](#L464) |  |
| [465](#L465) | if ( validateEtoRequiredField( document.getElementById('eto-name').value ) == false ) { |
| [466](#L466) | document.getElementById('eto-name-error').innerHTML = "Please add a Name."; |
| [467](#L467) | document.getElementById('eto-name').style.background= "#eee"; |
| [468](#L468) | document.getElementById('eto-name').focus(); |
| [469](#L469) | return false; |
| [470](#L470) | } |
| [471](#L471) |  |
| [472](#L472) | if ( validateEtoRequiredField( document.getElementById('eto-file-name').value ) == false ) { |
| [473](#L473) | document.getElementById('eto-file-name-error').innerHTML = "Please add a File Name."; |
| [474](#L474) | document.getElementById('eto-file-name').style.background= "#eee"; |
| [475](#L475) | document.getElementById('eto-file-name').focus(); |
| [476](#L476) | return false; |
| [477](#L477) | } |
| [478](#L478) |  |
| [479](#L479) | document.forms["eto-form"].submit(); |
| [480](#L480) | return false; |
| [481](#L481) | } |
| [482](#L482) |  |
| [483](#L483) |  |
| [484](#L484) | function removeEtoValidationErrors() { |
| [485](#L485) | document.getElementById('eto-name-error').innerHTML = ""; |
| [486](#L486) | document.getElementById('eto-file-name-error').innerHTML = ""; |
| [487](#L487) | } |
| [488](#L488) |  |
| [489](#L489) | function validateEtoRequiredField(value) { |
| [490](#L490) | if ( value == null || value == "" ) { |
| [491](#L491) | return false; |
| [492](#L492) | } |
| [493](#L493) | } |
| [494](#L494) |  |
| [495](#L495) | </script> |
| [496](#L496) | <?php |
| [497](#L497) | } |
| [498](#L498) |  |
| [499](#L499) | // add Template Name column |
| [500](#L500) | function pp\_etemplates\_add\_custom\_column( $columns ){ |
| [501](#L501) |  |
| [502](#L502) | unset($columns['title']); |
| [503](#L503) | unset($columns['date']); |
| [504](#L504) |  |
| [505](#L505) | $columns['title']       = \_\_( 'Title', 'buddypress' ); |
| [506](#L506) | $columns['etemplate']   = \_\_( 'Template', 'bp-email-assign-templates' ); |
| [507](#L507) | $columns['date']        = \_\_( 'Date', 'bp-email-assign-templates' ); |
| [508](#L508) |  |
| [509](#L509) | return $columns; |
| [510](#L510) | } |
| [511](#L511) | add\_filter( 'manage\_' . bp\_get\_email\_post\_type() . '\_posts\_columns', 'pp\_etemplates\_add\_custom\_column' ); |
| [512](#L512) |  |
| [513](#L513) | // add data to Template Name column |
| [514](#L514) | function pp\_etemplates\_add\_custom\_column\_data( $column, $post\_id ){ |
| [515](#L515) |  |
| [516](#L516) | if ( $column == 'etemplate' ) { |
| [517](#L517) |  |
| [518](#L518) | $value = get\_post\_meta( $post\_id, 'bp-etemplate', true ); |
| [519](#L519) |  |
| [520](#L520) | if ( ! empty( $value ) ) { |
| [521](#L521) |  |
| [522](#L522) | $option = get\_option( $value ); |
| [523](#L523) |  |
| [524](#L524) | if ( ! $option ) { |
| [525](#L525) |  |
| [526](#L526) | // option does not exist, so get rid of post\_meta and use default template |
| [527](#L527) | delete\_post\_meta( $post\_id, 'bp-etemplate' ); |
| [528](#L528) |  |
| [529](#L529) | echo 'Default Template'; |
| [530](#L530) |  |
| [531](#L531) | } |
| [532](#L532) | else |
| [533](#L533) | echo $option['oname']; |
| [534](#L534) | } |
| [535](#L535) | else |
| [536](#L536) | echo 'Default Template'; |
| [537](#L537) | } |
| [538](#L538) | } |
| [539](#L539) | add\_action( 'manage\_' . bp\_get\_email\_post\_type() . '\_posts\_custom\_column', 'pp\_etemplates\_add\_custom\_column\_data', 10, 2 ); |
| [540](#L540) |  |
| [541](#L541) |  |
| [542](#L542) | function pp\_etemplates\_custom\_column\_css() { |
| [543](#L543) | echo '<style> .column-etemplate {width: 20%} </style>'; |
| [544](#L544) | } |
| [545](#L545) | add\_action( 'admin\_head', 'pp\_etemplates\_custom\_column\_css' ); |
| [546](#L546) |  |
| [547](#L547) |  |
| [548](#L548) | /\*\* |
| [549](#L549) | \* Making the column sortable is more confusing then helpful |
| [550](#L550) | \* because it displays the option value associated with the meta value |
| [551](#L551) | \* but will try to sort on the meta name |
| [552](#L552) | \* and template may not have a meta\_value for that field |
| [553](#L553) |  |
| [554](#L554) | function pp\_etemplates\_custom\_column\_sortable( $columns ) { |
| [555](#L555) |  |
| [556](#L556) | $columns['etemplate'] = 'etemplatee'; |
| [557](#L557) |  |
| [558](#L558) | return $columns; |
| [559](#L559) | } |
| [560](#L560) | add\_filter( 'manage\_edit-' . bp\_get\_email\_post\_type() . '\_sortable\_columns', 'pp\_etemplates\_custom\_column\_sortable' ); |
| [561](#L561) |  |
| [562](#L562) |  |
| [563](#L563) | function pp\_etemplates\_custom\_orderby( $query ) { |
| [564](#L564) |  |
| [565](#L565) | if( ! is\_admin() ) |
| [566](#L566) | return; |
| [567](#L567) |  |
| [568](#L568) | $orderby = $query->get( 'orderby'); |
| [569](#L569) |  |
| [570](#L570) | if( 'etemplate' == $orderby ) { |
| [571](#L571) | $query->set( 'meta\_key', 'bp-etemplate' ); |
| [572](#L572) | $query->set( 'orderby', 'meta\_value' ); |
| [573](#L573) | } |
| [574](#L574) | } |
| [575](#L575) | add\_action( 'pre\_get\_posts', 'pp\_etemplates\_custom\_orderby' ); |
| [576](#L576) | \*/ |

**Note:** See [TracBrowser](/wiki/TracBrowser)
for help on using the repository browser.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Plain Text](/browser/bp-email-assign-templates/trunk/pp-email-templates-admin.php?format=txt)
* [Original Format](/export/3222436/bp-email-assign-templates/trunk/pp-email-templates-admin.php)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from www.wordfence.com_9330973d_20250114_184041.html ===


[![](https://www.wordfence.com/img/wordfence-intelligence-logo.svg)](/threat-intel/)

Have you found a vulnerability in a WordPress plugin or theme? Report vulnerabilities in WordPress plugins and themes through our [bug bounty program](https://www.wordfence.com/threat-intel/bug-bounty-program) and earn a bounty on all in-scope submissions, while we handle the responsible disclosure process on your behalf.

As a reminder, the Wordfence Intelligence Vulnerability Database API is completely free to query and utilize, both personally and commercially, and contains all the same vulnerability data as the user interface. Please review the API documentation and Webhook documentation for more information on how to query the vulnerability API endpoints and configure webhooks utilizing all the same data present in the Wordfence Intelligence user interface.

# BP Email Assign Templates <= 1.5 - Reflected Cross-Site Scripting

 [Wordfence Intelligence](https://www.wordfence.com/threat-intel)   >    [Vulnerability Database](https://www.wordfence.com/threat-intel/vulnerabilities)   >   BP Email Assign Templates <= 1.5 - Reflected Cross-Site Scripting

6.1

**Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')**
**CVSS Vector**
[CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N)

| CVE | [CVE-2024-12441](https://www.cve.org/CVERecord?id=CVE-2024-12441) |
| --- | --- |
| CVSS | 6.1 (Medium) |
| Publicly Published | December 11, 2024 |
| Last Updated | December 12, 2024 |
| Researcher | [vgo0](https://www.wordfence.com/threat-intel/vulnerabilities/researchers/dale-mavers) |

### Description

The BP Email Assign Templates plugin for WordPress is vulnerable to Reflected Cross-Site Scripting via the 'page' parameter in all versions up to, and including, 1.5 due to insufficient input sanitization and output escaping. This makes it possible for unauthenticated attackers to inject arbitrary web scripts in pages that execute if they can successfully trick a user into performing an action such as clicking on a link.

#### References

* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/browser/bp-email-assign-templates/trunk/pp-email-templates-admin.php#L297)
* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/changeset/3206532/)

#### Share

[Facebook](https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fbp-email-assign-templates%2Fbp-email-assign-templates-15-reflected-cross-site-scripting&t=BP%20Email%20Assign%20Templates%20%3C%3D%201.5%20-%20Reflected%20Cross-Site%20Scripting "Facebook")
[Twitter](https://twitter.com/share?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fbp-email-assign-templates%2Fbp-email-assign-templates-15-reflected-cross-site-scripting&text=BP%20Email%20Assign%20Templates%20%3C%3D%201.5%20-%20Reflected%20Cross-Site%20Scripting "Twitter")
[LinkedIn](https://www.linkedin.com/shareArticle?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fbp-email-assign-templates%2Fbp-email-assign-templates-15-reflected-cross-site-scripting "LinkedIn")
Email

## Vulnerability Details for BP Email Assign Templates

#### [BP Email Assign Templates](https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/bp-email-assign-templates)

| Software Type | Plugin |
| --- | --- |
| Software Slug | bp-email-assign-templates [(view on wordpress.org)](https://wordpress.org/plugins/bp-email-assign-templates) |
| Patched? | Yes |
| Remediation | Update to version 1.6, or a newer patched version |
| Affected Version | * <= 1.5 |
| Patched Version | * 1.6 |

This record contains material that is subject to copyright.

**Copyright 2012-2025 Defiant Inc.**

**License:**
Defiant hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute this software vulnerability information. Any copy of the software vulnerability information you make for such purposes is authorized provided that you include a hyperlink to this vulnerability record and reproduce Defiant's copyright designation and this license in any such copy.
**[Read more.](https://www.wordfence.com/wordfence-intelligence-terms-and-conditions/)**

**Copyright 1999-2025 The MITRE Corporation**

**License:**
CVE Usage: MITRE hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute Common Vulnerabilities and Exposures (CVE®). Any copy you make for such purposes is authorized provided that you reproduce MITRE's copyright designation and this license in any such copy.
**[Read more.](https://www.cve.org/Legal/TermsOfUse)**

Have information to add, or spot any errors? Contact us at wfi-support@wordfence.com so we can make any appropriate adjustments.

Did you know Wordfence Intelligence provides free personal and commercial API access to our comprehensive WordPress vulnerability database, along with a free webhook integration to stay on top of the latest vulnerabilities added and updated in the database? Get started today!

Learn more

Want to get notified of the latest vulnerabilities that may affect your WordPress site?
 Install Wordfence on your site today to get notified immediately if your site is affected by a vulnerability that has been added to our database.

Get Wordfence

The Wordfence Intelligence WordPress vulnerability database is completely free to access and query via API. Please review the documentation on how to access and consume the vulnerability data via API.

Documentation


