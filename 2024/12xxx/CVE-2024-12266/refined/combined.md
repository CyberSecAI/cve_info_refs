=== Content from plugins.trac.wordpress.org_4b4971e0_20250114_202137.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fchangeset%3Fnew%3D3211131%2540elex-woocommerce-dynamic-pricing-and-discounts%26old%3D3211131%2540elex-woocommerce-dynamic-pricing-and-discounts)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Change](/changeset/3189520/elex-woocommerce-dynamic-pricing-and-discounts "Changeset 3189520 for elex-woocommerce-dynamic-pricing-and-discounts")
* Next Change →

---

# Changeset [3211131](/changeset/3211131 "Show full changeset") for [elex-woocommerce-dynamic-pricing-and-discounts](/browser/elex-woocommerce-dynamic-pricing-and-discounts?rev=3211131 "Show entry in browser")

View differences
inline
side by side

Show
lines around each change

Show the changes in full context

Ignore:

Blank lines

Case changes

White space changes

Timestamp:
12/20/2024 02:33:40 PM
([4 weeks](/timeline?from=2024-12-20T14%3A33%3A40Z&precision=second "See timeline at 12/20/2024 02:33:40 PM") ago)

Author:
elextensions
Message:

Updated to v2.1.8.

Location:
[elex-woocommerce-dynamic-pricing-and-discounts](/browser/elex-woocommerce-dynamic-pricing-and-discounts?rev=3211131)
Files:

55 edited
6 copied

* [tags/2.1.8](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8?rev=3211131 "Show entry in browser")
  (copied)
  *(copied from [elex-woocommerce-dynamic-pricing-and-discounts/trunk](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk?rev=3093836 "Show original file (revision 3133195)"))*
* [tags/2.1.8/admin/data/category\_rules/elex-save-options.php](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/data/category_rules/elex-save-options.php?rev=3211131 "Show entry in browser")
  (modified)
  ([2 diffs](#file1 "Show differences"))
* [tags/2.1.8/admin/data/category\_rules/elex-update-options.php](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/data/category_rules/elex-update-options.php?rev=3211131 "Show entry in browser")
  (modified)
  ([3 diffs](#file2 "Show differences"))
* [tags/2.1.8/admin/data/product\_rules/elex-save-options.php](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/data/product_rules/elex-save-options.php?rev=3211131 "Show entry in browser")
  (modified)
  ([2 diffs](#file3 "Show differences"))
* [tags/2.1.8/admin/data/product\_rules/elex-update-options.php](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/data/product_rules/elex-update-options.php?rev=3211131 "Show entry in browser")
  (modified)
  ([1 diff](#file4 "Show differences"))
* [tags/2.1.8/admin/data/settings\_page/elex-save-options.php](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/data/settings_page/elex-save-options.php?rev=3211131 "Show entry in browser")
  (modified)
  ([3 diffs](#file5 "Show differences"))
* [tags/2.1.8/admin/elex-admin-actions-function.php](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/elex-admin-actions-function.php?rev=3211131 "Show entry in browser")
  (modified)
  ([4 diffs](#file6 "Show differences"))
* [tags/2.1.8/admin/elex-exporter.php](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/elex-exporter.php?rev=3211131 "Show entry in browser")
  (modified)
  ([5 diffs](#file7 "Show differences"))
* [tags/2.1.8/admin/elex-importer.php](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/elex-importer.php?rev=3211131 "Show entry in browser")
  (modified)
  ([3 diffs](#file8 "Show differences"))
* [tags/2.1.8/admin/ui/display/discount-rules.php](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/display/discount-rules.php?rev=3211131 "Show entry in browser")
  (modified)
  ([7 diffs](#file9 "Show differences"))
* [tags/2.1.8/admin/ui/display/settings.php](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/display/settings.php?rev=3211131 "Show entry in browser")
  (modified)
  ([1 diff](#file10 "Show differences"))
* [tags/2.1.8/admin/ui/renderer/discount-rules.php](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/renderer/discount-rules.php?rev=3211131 "Show entry in browser")
  (modified)
  ([13 diffs](#file11 "Show differences"))
* [tags/2.1.8/admin/ui/view/discount-rules/card/category-rules.php](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/view/discount-rules/card/category-rules.php?rev=3211131 "Show entry in browser")
  (copied)
  *(copied from [elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/card/category-rules.php](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/card/category-rules.php?rev=3133197 "Show original file (revision 3133197)"))*
  ([5 diffs](#file14 "Show differences"))
* [tags/2.1.8/admin/ui/view/discount-rules/card/product-rules.php](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/view/discount-rules/card/product-rules.php?rev=3211131 "Show entry in browser")
  (copied)
  *(copied from [elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/card/product-rules.php](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/card/product-rules.php?rev=3133197 "Show original file (revision 3133197)"))*
  ([6 diffs](#file15 "Show differences"))
* [tags/2.1.8/admin/ui/view/discount-rules/popup/category-rules.php](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/view/discount-rules/popup/category-rules.php?rev=3211131 "Show entry in browser")
  (modified)
  ([5 diffs](#file16 "Show differences"))
* [tags/2.1.8/admin/ui/view/discount-rules/popup/product-rules.php](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/view/discount-rules/popup/product-rules.php?rev=3211131 "Show entry in browser")
  (modified)
  ([4 diffs](#file17 "Show differences"))
* [tags/2.1.8/admin/ui/view/help-support/faqs.php](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/view/help-support/faqs.php?rev=3211131 "Show entry in browser")
  (modified)
  ([2 diffs](#file18 "Show differences"))
* [tags/2.1.8/admin/ui/view/help-support/ticket.php](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/view/help-support/ticket.php?rev=3211131 "Show entry in browser")
  (modified)
  ([2 diffs](#file19 "Show differences"))
* [tags/2.1.8/admin/ui/view/market.php](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/view/market.php?rev=3211131 "Show entry in browser")
  (modified)
  ([4 diffs](#file20 "Show differences"))
* [tags/2.1.8/admin/ui/view/settings/rules-execution-order.php](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/view/settings/rules-execution-order.php?rev=3211131 "Show entry in browser")
  (modified)
  ([1 diff](#file22 "Show differences"))
* [tags/2.1.8/elex-dynamic-pricing-and-discounts-for-woocommerce-basic-version.php](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/elex-dynamic-pricing-and-discounts-for-woocommerce-basic-version.php?rev=3211131 "Show entry in browser")
  (copied)
  *(copied from [elex-woocommerce-dynamic-pricing-and-discounts/trunk/elex-dynamic-pricing-and-discounts-for-woocommerce-basic-version.php](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/elex-dynamic-pricing-and-discounts-for-woocommerce-basic-version.php?rev=3189520 "Show original file (revision 3189520)"))*
  ([2 diffs](#file23 "Show differences"))
* [tags/2.1.8/includes/elex-common-functions.php](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/includes/elex-common-functions.php?rev=3211131 "Show entry in browser")
  (modified)
  ([1 diff](#file24 "Show differences"))
* [tags/2.1.8/includes/elex-dynamic-pricing-plugin-activator.php](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/includes/elex-dynamic-pricing-plugin-activator.php?rev=3211131 "Show entry in browser")
  (modified)
  ([1 diff](#file25 "Show differences"))
* [tags/2.1.8/includes/wf\_api\_manager/class-wc-am-plugin-activate.php](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/includes/wf_api_manager/class-wc-am-plugin-activate.php?rev=3211131 "Show entry in browser")
  (modified)
  ([1 diff](#file26 "Show differences"))
* [tags/2.1.8/includes/wf\_api\_manager/wf\_api\_manager.php](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/includes/wf_api_manager/wf_api_manager.php?rev=3211131 "Show entry in browser")
  (modified)
  ([1 diff](#file27 "Show differences"))
* [tags/2.1.8/public/elex-dynamic-pricing-plugin-public.php](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-dynamic-pricing-plugin-public.php?rev=3211131 "Show entry in browser")
  (modified)
  ([11 diffs](#file28 "Show differences"))
* [tags/2.1.8/public/elex-new-calculation-handler.php](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-new-calculation-handler.php?rev=3211131 "Show entry in browser")
  (modified)
  ([10 diffs](#file29 "Show differences"))
* [tags/2.1.8/public/elex-rules-validator.php](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131 "Show entry in browser")
  (copied)
  *(copied from [elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659 "Show original file (revision 3183659)"))*
  ([128 diffs](#file30 "Show differences"))
* [tags/2.1.8/public/elex-single-product-offer-table.php](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-single-product-offer-table.php?rev=3211131 "Show entry in browser")
  (modified)
  ([2 diffs](#file31 "Show differences"))
* [tags/2.1.8/public/elex-single-product-pricing-table.php](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-single-product-pricing-table.php?rev=3211131 "Show entry in browser")
  (modified)
  ([2 diffs](#file32 "Show differences"))
* [tags/2.1.8/readme.txt](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/readme.txt?rev=3211131 "Show entry in browser")
  (copied)
  *(copied from [elex-woocommerce-dynamic-pricing-and-discounts/trunk/readme.txt](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/readme.txt?rev=3189520 "Show original file (revision 3189520)"))*
  ([3 diffs](#file33 "Show differences"))
* [trunk/admin/data/category\_rules/elex-save-options.php](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/data/category_rules/elex-save-options.php?rev=3211131 "Show entry in browser")
  (modified)
  ([2 diffs](#file34 "Show differences"))
* [trunk/admin/data/category\_rules/elex-update-options.php](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/data/category_rules/elex-update-options.php?rev=3211131 "Show entry in browser")
  (modified)
  ([3 diffs](#file35 "Show differences"))
* [trunk/admin/data/product\_rules/elex-save-options.php](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/data/product_rules/elex-save-options.php?rev=3211131 "Show entry in browser")
  (modified)
  ([2 diffs](#file36 "Show differences"))
* [trunk/admin/data/product\_rules/elex-update-options.php](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/data/product_rules/elex-update-options.php?rev=3211131 "Show entry in browser")
  (modified)
  ([1 diff](#file37 "Show differences"))
* [trunk/admin/data/settings\_page/elex-save-options.php](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/data/settings_page/elex-save-options.php?rev=3211131 "Show entry in browser")
  (modified)
  ([3 diffs](#file38 "Show differences"))
* [trunk/admin/elex-admin-actions-function.php](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/elex-admin-actions-function.php?rev=3211131 "Show entry in browser")
  (modified)
  ([4 diffs](#file39 "Show differences"))
* [trunk/admin/elex-exporter.php](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/elex-exporter.php?rev=3211131 "Show entry in browser")
  (modified)
  ([5 diffs](#file40 "Show differences"))
* [trunk/admin/elex-importer.php](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/elex-importer.php?rev=3211131 "Show entry in browser")
  (modified)
  ([3 diffs](#file41 "Show differences"))
* [trunk/admin/ui/display/discount-rules.php](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/display/discount-rules.php?rev=3211131 "Show entry in browser")
  (modified)
  ([7 diffs](#file42 "Show differences"))
* [trunk/admin/ui/display/settings.php](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/display/settings.php?rev=3211131 "Show entry in browser")
  (modified)
  ([1 diff](#file43 "Show differences"))
* [trunk/admin/ui/renderer/discount-rules.php](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/renderer/discount-rules.php?rev=3211131 "Show entry in browser")
  (modified)
  ([13 diffs](#file44 "Show differences"))
* [trunk/admin/ui/view/discount-rules/card/category-rules.php](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/card/category-rules.php?rev=3211131 "Show entry in browser")
  (modified)
  ([5 diffs](#file47 "Show differences"))
* [trunk/admin/ui/view/discount-rules/card/product-rules.php](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/card/product-rules.php?rev=3211131 "Show entry in browser")
  (modified)
  ([6 diffs](#file48 "Show differences"))
* [trunk/admin/ui/view/discount-rules/popup/category-rules.php](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/popup/category-rules.php?rev=3211131 "Show entry in browser")
  (modified)
  ([5 diffs](#file49 "Show differences"))
* [trunk/admin/ui/view/discount-rules/popup/product-rules.php](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/popup/product-rules.php?rev=3211131 "Show entry in browser")
  (modified)
  ([4 diffs](#file50 "Show differences"))
* [trunk/admin/ui/view/help-support/faqs.php](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/help-support/faqs.php?rev=3211131 "Show entry in browser")
  (modified)
  ([2 diffs](#file51 "Show differences"))
* [trunk/admin/ui/view/help-support/ticket.php](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/help-support/ticket.php?rev=3211131 "Show entry in browser")
  (modified)
  ([2 diffs](#file52 "Show differences"))
* [trunk/admin/ui/view/market.php](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/market.php?rev=3211131 "Show entry in browser")
  (modified)
  ([4 diffs](#file53 "Show differences"))
* [trunk/admin/ui/view/settings/rules-execution-order.php](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/settings/rules-execution-order.php?rev=3211131 "Show entry in browser")
  (modified)
  ([1 diff](#file55 "Show differences"))
* [trunk/elex-dynamic-pricing-and-discounts-for-woocommerce-basic-version.php](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/elex-dynamic-pricing-and-discounts-for-woocommerce-basic-version.php?rev=3211131 "Show entry in browser")
  (modified)
  ([2 diffs](#file56 "Show differences"))
* [trunk/includes/elex-common-functions.php](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/includes/elex-common-functions.php?rev=3211131 "Show entry in browser")
  (modified)
  ([1 diff](#file57 "Show differences"))
* [trunk/includes/elex-dynamic-pricing-plugin-activator.php](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/includes/elex-dynamic-pricing-plugin-activator.php?rev=3211131 "Show entry in browser")
  (modified)
  ([1 diff](#file58 "Show differences"))
* [trunk/includes/wf\_api\_manager/class-wc-am-plugin-activate.php](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/includes/wf_api_manager/class-wc-am-plugin-activate.php?rev=3211131 "Show entry in browser")
  (modified)
  ([1 diff](#file59 "Show differences"))
* [trunk/includes/wf\_api\_manager/wf\_api\_manager.php](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/includes/wf_api_manager/wf_api_manager.php?rev=3211131 "Show entry in browser")
  (modified)
  ([1 diff](#file60 "Show differences"))
* [trunk/public/elex-dynamic-pricing-plugin-public.php](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-dynamic-pricing-plugin-public.php?rev=3211131 "Show entry in browser")
  (modified)
  ([11 diffs](#file61 "Show differences"))
* [trunk/public/elex-new-calculation-handler.php](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-new-calculation-handler.php?rev=3211131 "Show entry in browser")
  (modified)
  ([10 diffs](#file62 "Show differences"))
* [trunk/public/elex-rules-validator.php](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131 "Show entry in browser")
  (modified)
  ([128 diffs](#file63 "Show differences"))
* [trunk/public/elex-single-product-offer-table.php](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-single-product-offer-table.php?rev=3211131 "Show entry in browser")
  (modified)
  ([2 diffs](#file64 "Show differences"))
* [trunk/public/elex-single-product-pricing-table.php](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-single-product-pricing-table.php?rev=3211131 "Show entry in browser")
  (modified)
  ([2 diffs](#file65 "Show differences"))
* [trunk/readme.txt](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/readme.txt?rev=3211131 "Show entry in browser")
  (modified)
  ([3 diffs](#file66 "Show differences"))

### Legend:

Unmodified
Added
Removed

* ## [elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/data/category\_rules/elex-save-options.php](/changeset/3211131/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/data/category_rules/elex-save-options.php "Show the changeset 3211131 restricted to elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/data/category_rules/elex-save-options.php")

  | [r3049195](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/data/category_rules/elex-save-options.php?rev=3049195#L22 "Show revision 3049195 of this file in browser") | [r3211131](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/data/category_rules/elex-save-options.php?rev=3211131#L22 "Show revision 3211131 of this file in browser") |  |
  | --- | --- | --- |
  | 22 | 22 | $prev\_data = get\_option('xa\_dp\_rules', $dummy\_settings); |
  | 23 | 23 | $new\_rule = array( |
  | 24 |  | 'offer\_name'             => sanitize\_text\_field($\_REQUEST['offer\_name']), |
  | 25 |  | 'category\_id'            => array\_map('sanitize\_text\_field', $\_REQUEST['category\_id']), |
  | 26 |  | 'check\_on'               => sanitize\_text\_field($\_REQUEST['check\_on']), |
  | 27 |  | 'min'                    => sanitize\_text\_field($\_REQUEST['min']), |
  | 28 |  | 'max'                    => !empty($\_REQUEST['max']) ? sanitize\_text\_field($\_REQUEST['max']) : null, |
  | 29 |  | 'discount\_type'          => sanitize\_text\_field($\_REQUEST['discount\_type']), |
  | 30 |  | 'value'                  => sanitize\_text\_field($\_REQUEST['value']), |
  |  | 24 | 'offer\_name'             => sanitize\_text\_field($\_REQUEST['offer\_name']), |
  |  | 25 | 'category\_id'            => array\_map('sanitize\_text\_field', $\_REQUEST['category\_id']), |
  |  | 26 | 'check\_on'               => sanitize\_text\_field($\_REQUEST['check\_on']), |
  |  | 27 | 'min'                    => sanitize\_text\_field($\_REQUEST['min']), |
  |  | 28 | 'max'                    => !empty($\_REQUEST['max']) ? sanitize\_text\_field($\_REQUEST['max']) : null, |
  |  | 29 | 'discount\_type'          => sanitize\_text\_field($\_REQUEST['discount\_type']), |
  |  | 30 | 'value'                  => sanitize\_text\_field($\_REQUEST['value']), |
  | 31 | 31 | 'max\_discount' => null, |
  | 32 | 32 | 'allow\_roles' => array(), |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/data/category_rules/elex-save-options.php?rev=3049195#L38) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/data/category_rules/elex-save-options.php?rev=3211131#L38) |  |
  | 38 | 38 | 'prev\_order\_count' => null, |
  | 39 | 39 | 'prev\_order\_total\_amt' => null, |
  | 40 |  | ); |
  |  | 40 | ); |
  | 41 | 41 |  |
  | 42 | 42 | if (!isset($prev\_data[$active\_tab]) || count($prev\_data[$active\_tab]) == 0) { |
  | 43 |  | $prev\_data[$active\_tab][1] = $new\_rule; |
  | 44 |  | } else { |
  | 45 |  | $prev\_data[$active\_tab][] = $new\_rule; |
  | 46 |  | } |
  |  | 43 | $prev\_data[$active\_tab][1] = $new\_rule; |
  |  | 44 | } else { |
  |  | 45 | $prev\_data[$active\_tab][] = $new\_rule; |
  |  | 46 | } |
  | 47 | 47 |  |
  | 48 | 48 | do\_action( 'wpml\_register\_single\_string', 'eh-dynamic-pricing', $active\_tab . ':' . count($prev\_data[$active\_tab]), sanitize\_text\_field($\_REQUEST['offer\_name'])); |
* ## [elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/data/category\_rules/elex-update-options.php](/changeset/3211131/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/data/category_rules/elex-update-options.php "Show the changeset 3211131 restricted to elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/data/category_rules/elex-update-options.php")

  | [r3049195](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/data/category_rules/elex-update-options.php?rev=3049195#L13 "Show revision 3049195 of this file in browser") | [r3211131](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/data/category_rules/elex-update-options.php?rev=3211131#L13 "Show revision 3211131 of this file in browser") |  |
  | --- | --- | --- |
  | 13 | 13 | $prev\_data = get\_option('xa\_dp\_rules'); |
  | 14 | 14 | $new\_rule = array( |
  | 15 |  | 'offer\_name'             => sanitize\_text\_field($\_REQUEST['offer\_name']), |
  | 16 |  | 'category\_id'            => array\_map('sanitize\_text\_field', $\_REQUEST['category\_id']), |
  | 17 |  | 'check\_on'               => sanitize\_text\_field($\_REQUEST['check\_on']), |
  | 18 |  | 'min'                    => sanitize\_text\_field($\_REQUEST['min']), |
  | 19 |  | 'max'                    => !empty($\_REQUEST['max']) ? sanitize\_text\_field($\_REQUEST['max']) : null, |
  | 20 |  | 'discount\_type'          => sanitize\_text\_field($\_REQUEST['discount\_type']), |
  | 21 |  | 'value'                  => sanitize\_text\_field($\_REQUEST['value']), |
  |  | 15 | 'offer\_name'             => sanitize\_text\_field($\_REQUEST['offer\_name']), |
  |  | 16 | 'category\_id'            => array\_map('sanitize\_text\_field', $\_REQUEST['category\_id']), |
  |  | 17 | 'check\_on'               => sanitize\_text\_field($\_REQUEST['check\_on']), |
  |  | 18 | 'min'                    => sanitize\_text\_field($\_REQUEST['min']), |
  |  | 19 | 'max'                    => !empty($\_REQUEST['max']) ? sanitize\_text\_field($\_REQUEST['max']) : null, |
  |  | 20 | 'discount\_type'          => sanitize\_text\_field($\_REQUEST['discount\_type']), |
  |  | 21 | 'value'                  => sanitize\_text\_field($\_REQUEST['value']), |
  | 22 | 22 | 'max\_discount' => null, |
  | 23 | 23 | 'allow\_roles' => array(), |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/data/category_rules/elex-update-options.php?rev=3049195#L29) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/data/category_rules/elex-update-options.php?rev=3211131#L29) |  |
  | 29 | 29 | 'prev\_order\_count' => null, |
  | 30 | 30 | 'prev\_order\_total\_amt' => null, |
  | 31 |  | ); |
  |  | 31 | ); |
  | 32 | 32 |  |
  | 33 | 33 | $prev\_data[$active\_tab][sanitize\_text\_field($\_REQUEST['update'])] = $new\_rule; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/data/category_rules/elex-update-options.php?rev=3049195#L43) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/data/category_rules/elex-update-options.php?rev=3211131#L43) |  |
  | 43 | 43 | <?php |
  | 44 | 44 | wp\_safe\_redirect(add\_query\_arg(array('page' => 'dp-discount-rules-page', 'tab' => $active\_tab,'updatesuccess' => 1), admin\_url('admin.php'))); |
  | 45 |  | } else { |
  |  | 45 | } else { |
  | 46 | 46 | echo '<div class="notice notice-error is-dismissible">'; |
  | 47 | 47 | echo '<p>' . esc\_html\_e('Please Enter All Fields ,Then Try To Update!!', 'eh-dynamic-pricing-discounts') . '</p> </div>'; |
* ## [elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/data/product\_rules/elex-save-options.php](/changeset/3211131/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/data/product_rules/elex-save-options.php "Show the changeset 3211131 restricted to elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/data/product_rules/elex-save-options.php")

  | [r3049195](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/data/product_rules/elex-save-options.php?rev=3049195#L8 "Show revision 3049195 of this file in browser") | [r3211131](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/data/product_rules/elex-save-options.php?rev=3211131#L8 "Show revision 3211131 of this file in browser") |  |
  | --- | --- | --- |
  | 8 | 8 |  |
  | 9 | 9 |  |
  | 10 |  | if (!empty($\_REQUEST['offer\_name']) && isset($\_REQUEST['rule\_on']) && (~~(isset($\_REQUEST['product\_id'])~~) && ( !empty($\_REQUEST['product\_id']) && ( 'products' == $\_REQUEST['rule\_on'] ) ) || ( isset($\_REQUEST['category\_id']) && !empty($\_REQUEST['category\_id']) && ( 'categories' === $\_REQUEST['rule\_on'] ) ) || ( 'cart' === $\_REQUEST['rule\_on'] ) ) && !empty($\_REQUEST['check\_on']) && !empty($\_REQUEST['min']) && !empty($\_REQUEST['discount\_type']) && ( !empty($\_REQUEST['value']) ) && !isset($\_REQUEST['edit'])) { |
  |  | 10 | if (!empty($\_REQUEST['offer\_name']) && isset($\_REQUEST['rule\_on']) && ( ( isset($\_REQUEST['product\_id']) ) && ( !empty($\_REQUEST['product\_id']) && ( 'products' == $\_REQUEST['rule\_on'] ) ) || ( isset($\_REQUEST['category\_id']) && !empty($\_REQUEST['category\_id']) && ( 'categories' === $\_REQUEST['rule\_on'] ) ) || ( 'cart' === $\_REQUEST['rule\_on'] ) ) && !empty($\_REQUEST['check\_on']) && !empty($\_REQUEST['min']) && !empty($\_REQUEST['discount\_type']) && ( !empty($\_REQUEST['value']) ) && !isset($\_REQUEST['edit'])) { |
  | 11 | 11 | $dummy\_settings = []; |
  | 12 | 12 | $dummy\_settings['product\_rules']       = array(); |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/data/product_rules/elex-save-options.php?rev=3049195#L19) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/data/product_rules/elex-save-options.php?rev=3211131#L19) |  |
  | 19 | 19 |  |
  | 20 | 20 | $products\_ids = null; |
  | 21 |  | $categories   = null; |
  |  | 21 | $categories   = null; |
  | 22 | 22 |  |
  | 23 | 23 | if ($\_REQUEST['rule\_on'] === 'products' && isset($\_REQUEST['product\_id']) && !empty($\_REQUEST['product\_id'])) { |
  | 24 |  | if (elex\_dp\_is\_wc\_version\_gt\_eql('2.7')) { |
  |  | 24 | if (elex\_dp\_is\_wc\_version\_gt\_eql('2.7')) { |
  | 25 | 25 | $products\_ids = array\_map('sanitize\_text\_field', $\_REQUEST['product\_id']);// array |
  | 26 |  | } else { |
  | 27 |  | $products\_ids = explode(',', sanitize\_text\_field($\_REQUEST['product\_id'])); // string |
  | 28 |  | } |
  | 29 |  | } elseif ($\_REQUEST['rule\_on'] === 'categories' && isset($\_REQUEST['category\_id']) && !empty($\_REQUEST['category\_id'])) { |
  | 30 |  | $categories = sanitize\_text\_field($\_REQUEST['category\_id']); // string |
  | 31 |  | } |
  |  | 26 | } else { |
  |  | 27 | $products\_ids = explode(',', sanitize\_text\_field($\_REQUEST['product\_id'])); // string |
  |  | 28 | } |
  |  | 29 | } elseif ($\_REQUEST['rule\_on'] === 'categories' && isset($\_REQUEST['category\_id']) && !empty($\_REQUEST['category\_id'])) { |
  |  | 30 | $categories = sanitize\_text\_field($\_REQUEST['category\_id']); // string |
  |  | 31 | } |
  | 32 | 32 |  |
  | 33 | 33 | $prev\_data = get\_option('xa\_dp\_rules', $dummy\_settings); |
  | 34 | 34 | $new\_rule = array( |
  | 35 |  | 'offer\_name'             => sanitize\_text\_field($\_REQUEST['offer\_name']), |
  | 36 |  | 'rule\_on'                => sanitize\_text\_field($\_REQUEST['rule\_on']), |
  | 37 |  | 'product\_id'             => $products\_ids, |
  | 38 |  | 'category\_id'            => $categories, |
  | 39 |  | 'check\_on'               => sanitize\_text\_field($\_REQUEST['check\_on']), |
  | 40 |  | 'min'                    => sanitize\_text\_field($\_REQUEST['min']), |
  | 41 |  | 'max'                    => !empty($\_REQUEST['max']) ? sanitize\_text\_field($\_REQUEST['max']) : null, |
  | 42 |  | 'discount\_type'          => sanitize\_text\_field($\_REQUEST['discount\_type']), |
  | 43 |  | 'value'                  => sanitize\_text\_field($\_REQUEST['value']), |
  | 44 |  | 'max\_discount'           => null, |
  | 45 |  | ~~'allow\_roles'            => (isset($\_REQUEST['from\_date']) && !empty($\_REQUEST['allow\_roles'])~~) ? array\_map('sanitize\_text\_field', $\_REQUEST['allow\_roles']) : array(), |
  | 46 |  | ~~'allow\_membership\_plans' => (isset($\_REQUEST['from\_date']) && !empty($\_REQUEST['allow\_membership\_plans'])~~) ? array\_map('sanitize\_text\_field', $\_REQUEST['allow\_membership\_plans']) : array(), |
  | 47 |  | ~~'from\_date'              => (isset($\_REQUEST['from\_date']) && !empty($\_REQUEST['from\_date'])~~) ? sanitize\_text\_field($\_REQUEST['from\_date']) : null, |
  | 48 |  | ~~'to\_date'                => (isset($\_REQUEST['from\_date']) &&!empty($\_REQUEST['to\_date'])~~) ? sanitize\_text\_field($\_REQUEST['to\_date']) : null, |
  | 49 |  | 'adjustment'             => null, |
  | 50 |  | 'repeat\_rule'            => '', |
  | 51 |  | 'email\_ids'              => null, |
  | 52 |  | 'prev\_order\_count'       => null, |
  | 53 |  | 'prev\_order\_total\_amt'   => null, |
  | 54 |  | ); |
  |  | 35 | 'offer\_name'             => sanitize\_text\_field($\_REQUEST['offer\_name']), |
  |  | 36 | 'rule\_on'                => sanitize\_text\_field($\_REQUEST['rule\_on']), |
  |  | 37 | 'product\_id'             => $products\_ids, |
  |  | 38 | 'category\_id'            => $categories, |
  |  | 39 | 'check\_on'               => sanitize\_text\_field($\_REQUEST['check\_on']), |
  |  | 40 | 'min'                    => sanitize\_text\_field($\_REQUEST['min']), |
  |  | 41 | 'max'                    => !empty($\_REQUEST['max']) ? sanitize\_text\_field($\_REQUEST['max']) : null, |
  |  | 42 | 'discount\_type'          => sanitize\_text\_field($\_REQUEST['discount\_type']), |
  |  | 43 | 'value'                  => sanitize\_text\_field($\_REQUEST['value']), |
  |  | 44 | 'max\_discount'           => null, |
  |  | 45 | 'allow\_roles'            => ( isset($\_REQUEST['from\_date']) && !empty($\_REQUEST['allow\_roles']) ) ? array\_map('sanitize\_text\_field', $\_REQUEST['allow\_roles']) : array(), |
  |  | 46 | 'allow\_membership\_plans' => ( isset($\_REQUEST['from\_date']) && !empty($\_REQUEST['allow\_membership\_plans']) ) ? array\_map('sanitize\_text\_field', $\_REQUEST['allow\_membership\_plans']) : array(), |
  |  | 47 | 'from\_date'              => ( isset($\_REQUEST['from\_date']) && !empty($\_REQUEST['from\_date']) ) ? sanitize\_text\_field($\_REQUEST['from\_date']) : null, |
  |  | 48 | 'to\_date'                => ( isset($\_REQUEST['from\_date']) &&!empty($\_REQUEST['to\_date']) ) ? sanitize\_text\_field($\_REQUEST['to\_date']) : null, |
  |  | 49 | 'adjustment'             => null, |
  |  | 50 | 'repeat\_rule'            => '', |
  |  | 51 | 'email\_ids'              => null, |
  |  | 52 | 'prev\_order\_count'       => null, |
  |  | 53 | 'prev\_order\_total\_amt'   => null, |
  |  | 54 | ); |
  | 55 | 55 |  |
  | 56 | 56 | if (!isset($prev\_data[$active\_tab]) || count($prev\_data[$active\_tab]) == 0) { |
  | 57 |  | $prev\_data[$active\_tab][1] = $new\_rule; |
  | 58 |  | } else { |
  | 59 |  | $prev\_data[$active\_tab][] = $new\_rule; |
  | 60 |  | } |
  |  | 57 | $prev\_data[$active\_tab][1] = $new\_rule; |
  |  | 58 | } else { |
  |  | 59 | $prev\_data[$active\_tab][] = $new\_rule; |
  |  | 60 | } |
  | 61 | 61 |  |
  | 62 | 62 | do\_action( 'wpml\_register\_single\_string', 'eh-dynamic-pricing', $active\_tab . ':' . count($prev\_data[$active\_tab]), sanitize\_text\_field($\_REQUEST['offer\_name'])); |
* ## [elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/data/product\_rules/elex-update-options.php](/changeset/3211131/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/data/product_rules/elex-update-options.php "Show the changeset 3211131 restricted to elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/data/product_rules/elex-update-options.php")

  | [r3049195](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/data/product_rules/elex-update-options.php?rev=3049195#L10 "Show revision 3049195 of this file in browser") | [r3211131](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/data/product_rules/elex-update-options.php?rev=3211131#L10 "Show revision 3211131 of this file in browser") |  |
  | --- | --- | --- |
  | 10 | 10 |  |
  | 11 | 11 | $products\_ids = null; |
  | 12 |  | $categories   = null; |
  |  | 12 | $categories   = null; |
  | 13 | 13 |  |
  | 14 | 14 | if ($\_REQUEST['rule\_on'] === 'products' && isset($\_REQUEST['product\_id']) && !empty($\_REQUEST['product\_id'])) { |
  | 15 |  | if (elex\_dp\_is\_wc\_version\_gt\_eql('2.7')) { |
  |  | 15 | if (elex\_dp\_is\_wc\_version\_gt\_eql('2.7')) { |
  | 16 | 16 | $products\_ids = array\_map('sanitize\_text\_field', $\_REQUEST['product\_id']);// array |
  | 17 |  | } else { |
  | 18 |  | $products\_ids = explode(',', sanitize\_text\_field($\_REQUEST['product\_id'])); // string |
  | 19 |  | } |
  | 20 |  | } elseif ($\_REQUEST['rule\_on'] === 'categories' && isset($\_REQUEST['category\_id']) && !empty($\_REQUEST['category\_id'])) { |
  | 21 |  | $categories = sanitize\_text\_field($\_REQUEST['category\_id']); // string |
  | 22 |  | } |
  |  | 17 | } else { |
  |  | 18 | $products\_ids = explode(',', sanitize\_text\_field($\_REQUEST['product\_id'])); // string |
  |  | 19 | } |
  |  | 20 | } elseif ($\_REQUEST['rule\_on'] === 'categories' && isset($\_REQUEST['category\_id']) && !empty($\_REQUEST['category\_id'])) { |
  |  | 21 | $categories = sanitize\_text\_field($\_REQUEST['category\_id']); // string |
  |  | 22 | } |
  | 23 | 23 |  |
  | 24 | 24 | $prev\_data = get\_option('xa\_dp\_rules'); |
  | 25 | 25 | $new\_rule = array( |
  | 26 |  | 'offer\_name'             => sanitize\_text\_field($\_REQUEST['offer\_name']), |
  | 27 |  | 'rule\_on'                => sanitize\_text\_field($\_REQUEST['rule\_on']), |
  | 28 |  | 'product\_id'             => $products\_ids, |
  | 29 |  | 'category\_id'            => $categories, |
  | 30 |  | 'check\_on'               => sanitize\_text\_field($\_REQUEST['check\_on']), |
  | 31 |  | 'min'                    => sanitize\_text\_field($\_REQUEST['min']), |
  | 32 |  | 'max'                    => !empty($\_REQUEST['max']) ? sanitize\_text\_field($\_REQUEST['max']) : null, |
  | 33 |  | 'discount\_type'          => sanitize\_text\_field($\_REQUEST['discount\_type']), |
  | 34 |  | 'value'                  => sanitize\_text\_field($\_REQUEST['value']), |
  | 35 |  | 'max\_discount'           => null, |
  | 36 |  | ~~'allow\_roles'            => (isset($\_REQUEST['from\_date']) && !empty($\_REQUEST['allow\_roles'])~~) ? array\_map('sanitize\_text\_field', $\_REQUEST['allow\_roles']) : array(), |
  | 37 |  | ~~'allow\_membership\_plans' => (isset($\_REQUEST['from\_date']) && !empty($\_REQUEST['allow\_membership\_plans'])~~) ? array\_map('sanitize\_text\_field', $\_REQUEST['allow\_membership\_plans']) : array(), |
  | 38 |  | ~~'from\_date'              => (isset($\_REQUEST['from\_date']) && !empty($\_REQUEST['from\_date'])~~) ? sanitize\_text\_field($\_REQUEST['from\_date']) : null, |
  | 39 |  | ~~'to\_date'                => (isset($\_REQUEST['from\_date']) &&!empty($\_REQUEST['to\_date'])~~) ? sanitize\_text\_field($\_REQUEST['to\_date']) : null, |
  | 40 |  | 'adjustment'             => null, |
  | 41 |  | 'repeat\_rule'            => '', |
  | 42 |  | 'email\_ids'              => null, |
  | 43 |  | 'prev\_order\_count'       => null, |
  | 44 |  | 'prev\_order\_total\_amt'   => null, |
  | 45 |  | ); |
  |  | 26 | 'offer\_name'             => sanitize\_text\_field($\_REQUEST['offer\_name']), |
  |  | 27 | 'rule\_on'                => sanitize\_text\_field($\_REQUEST['rule\_on']), |
  |  | 28 | 'product\_id'             => $products\_ids, |
  |  | 29 | 'category\_id'            => $categories, |
  |  | 30 | 'check\_on'               => sanitize\_text\_field($\_REQUEST['check\_on']), |
  |  | 31 | 'min'                    => sanitize\_text\_field($\_REQUEST['min']), |
  |  | 32 | 'max'                    => !empty($\_REQUEST['max']) ? sanitize\_text\_field($\_REQUEST['max']) : null, |
  |  | 33 | 'discount\_type'          => sanitize\_text\_field($\_REQUEST['discount\_type']), |
  |  | 34 | 'value'                  => sanitize\_text\_field($\_REQUEST['value']), |
  |  | 35 | 'max\_discount'           => null, |
  |  | 36 | 'allow\_roles'            => ( isset($\_REQUEST['from\_date']) && !empty($\_REQUEST['allow\_roles']) ) ? array\_map('sanitize\_text\_field', $\_REQUEST['allow\_roles']) : array(), |
  |  | 37 | 'allow\_membership\_plans' => ( isset($\_REQUEST['from\_date']) && !empty($\_REQUEST['allow\_membership\_plans']) ) ? array\_map('sanitize\_text\_field', $\_REQUEST['allow\_membership\_plans']) : array(), |
  |  | 38 | 'from\_date'              => ( isset($\_REQUEST['from\_date']) && !empty($\_REQUEST['from\_date']) ) ? sanitize\_text\_field($\_REQUEST['from\_date']) : null, |
  |  | 39 | 'to\_date'                => ( isset($\_REQUEST['from\_date']) &&!empty($\_REQUEST['to\_date']) ) ? sanitize\_text\_field($\_REQUEST['to\_date']) : null, |
  |  | 40 | 'adjustment'             => null, |
  |  | 41 | 'repeat\_rule'            => '', |
  |  | 42 | 'email\_ids'              => null, |
  |  | 43 | 'prev\_order\_count'       => null, |
  |  | 44 | 'prev\_order\_total\_amt'   => null, |
  |  | 45 | ); |
  | 46 | 46 | $prev\_data[$active\_tab][sanitize\_text\_field($\_REQUEST['update'])] = $new\_rule; |
  | 47 | 47 |  |
* ## [elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/data/settings\_page/elex-save-options.php](/changeset/3211131/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/data/settings_page/elex-save-options.php "Show the changeset 3211131 restricted to elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/data/settings_page/elex-save-options.php")

  | [r3049195](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/data/settings_page/elex-save-options.php?rev=3049195#L17 "Show revision 3049195 of this file in browser") | [r3211131](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/data/settings_page/elex-save-options.php?rev=3211131#L17 "Show revision 3211131 of this file in browser") |  |
  | --- | --- | --- |
  | 17 | 17 | </div> |
  | 18 | 18 | <?php |
  | 19 |  | ~~}else~~{ |
  |  | 19 | } else { |
  | 20 | 20 |  |
  | 21 | 21 | if (isset($\_REQUEST['tab'])) { |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/data/settings_page/elex-save-options.php?rev=3049195#L117) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/data/settings_page/elex-save-options.php?rev=3211131#L117) |  |
  | 117 | 117 | update\_option('xa\_dynamic\_pricing\_setting', $saved\_data); |
  | 118 | 118 | wp\_safe\_redirect(add\_query\_arg(array('page' => 'dp-settings-page', 'tab' => $active\_tab), admin\_url('admin.php'))); |
  | 119 |  | ?> |
  |  | 119 | ?> |
  | 120 | 120 | <div class="notice notice-success is-dismissible"> |
  | 121 | 121 | <p><?php esc\_html\_e('Saved Successfully', 'eh-dynamic-pricing-discounts'); ?></p> |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/data/settings_page/elex-save-options.php?rev=3049195#L129) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/data/settings_page/elex-save-options.php?rev=3211131#L129) |  |
  | 129 | 129 | <?php |
  | 130 | 130 | } |
  | 131 |  | } |
  |  | 131 | } |
  | 132 | 132 | } |
* ## [elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/elex-admin-actions-function.php](/changeset/3211131/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/elex-admin-actions-function.php "Show the changeset 3211131 restricted to elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/elex-admin-actions-function.php")

  | [r3049195](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/elex-admin-actions-function.php?rev=3049195#L120 "Show revision 3049195 of this file in browser") | [r3211131](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/elex-admin-actions-function.php?rev=3211131#L120 "Show revision 3211131 of this file in browser") |  |
  | --- | --- | --- |
  | 120 | 120 | $rules\_type  = !empty($\_POST['rules-type'])?$\_POST['rules-type']:''; |
  | 121 | 121 | if (!wp\_verify\_nonce($nonce, 'update\_rules\_arrangement')) { |
  | 122 |  | wp\_die('unauthorised access [unable to verify nonce]'); |
  | 123 |  | } else { |
  | 124 |  | $allrules = get\_option('xa\_dp\_rules'); |
  |  | 122 | wp\_die('unauthorised access [unable to verify nonce]'); |
  |  | 123 | } else { |
  |  | 124 | $allrules = get\_option('xa\_dp\_rules'); |
  | 125 | 125 | $allRules = !empty($allrules[$rules\_type])?$allrules[$rules\_type]:array(); |
  | 126 | 126 |  |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/elex-admin-actions-function.php?rev=3049195#L137) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/elex-admin-actions-function.php?rev=3211131#L137) |  |
  | 137 | 137 |  |
  | 138 | 138 | //Updating rules order in existing\_perpage\_rules\_order |
  | 139 |  | if~~($reordered\_rules\_on\_given\_page)~~{ |
  | 140 |  | if~~($paged\_rules = $existing\_perpage\_rules\_order[1])~~{ |
  |  | 139 | if ($reordered\_rules\_on\_given\_page) { |
  |  | 140 | if ($paged\_rules = $existing\_perpage\_rules\_order[1]) { |
  | 141 | 141 | $updated\_order\_on\_index = []; |
  | 142 | 142 | $i=0; |
  | 143 |  | ~~foreach($paged\_rules as $key => $rule)~~{ |
  |  | 143 | foreach ($paged\_rules as $key => $rule) { |
  | 144 | 144 | $updated\_order\_on\_index[$key] = $reordered\_rules\_on\_given\_page[$i]; |
  | 145 | 145 | $i++; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/elex-admin-actions-function.php?rev=3049195#L151) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/elex-admin-actions-function.php?rev=3211131#L151) |  |
  | 151 | 151 | //Setting up final data |
  | 152 | 152 | $reordered\_final\_rules\_array = []; |
  | 153 |  | ~~foreach($existing\_perpage\_rules\_order as $rules\_array)~~{ |
  | 154 |  | if~~($rules\_array)~~{ |
  | 155 |  | foreach~~($rules\_array as $key => $rules)~~{ |
  |  | 153 | foreach ($existing\_perpage\_rules\_order as $rules\_array) { |
  |  | 154 | if ($rules\_array) { |
  |  | 155 | foreach ($rules\_array as $key => $rules) { |
  | 156 | 156 | $reordered\_final\_rules\_array[$key] = $rules; |
  | 157 | 157 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/elex-admin-actions-function.php?rev=3049195#L160) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/elex-admin-actions-function.php?rev=3211131#L160) |  |
  | 160 | 160 |  |
  | 161 | 161 | //Saving it to database |
  | 162 |  | if~~(!empty($reordered\_final\_rules\_array))~~{ |
  | 163 |  | $reordered\_final\_rules\_array = array\_reverse($reordered\_final\_rules\_array,true); |
  |  | 162 | if (!empty($reordered\_final\_rules\_array)) { |
  |  | 163 | $reordered\_final\_rules\_array = array\_reverse($reordered\_final\_rules\_array, true); |
  | 164 | 164 | $allrules[$rules\_type] = $reordered\_final\_rules\_array; |
  | 165 | 165 | update\_option('xa\_dp\_rules', $allrules); |
  | 166 | 166 | wp\_die('Arrangements Saved'); |
  | 167 |  | }~~else~~{ |
  |  | 167 | } else { |
  | 168 | 168 | wp\_die('unable to save'); |
  | 169 | 169 | } |
  | 170 |  | } |
  |  | 170 | } |
  | 171 | 171 | } |
  | 172 | 172 |  |
* ## [elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/elex-exporter.php](/changeset/3211131/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/elex-exporter.php "Show the changeset 3211131 restricted to elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/elex-exporter.php")

  | [r3004919](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/elex-exporter.php?rev=3004919#L8 "Show revision 3004919 of this file in browser") | [r3211131](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/elex-exporter.php?rev=3211131#L8 "Show revision 3211131 of this file in browser") |  |
  | --- | --- | --- |
  | 8 | 8 |  |
  | 9 | 9 | function elex\_dp\_export\_rules() { |
  | 10 |  |  |
  |  | 10 | if (!current\_user\_can('manage\_options')) { |
  |  | 11 | return; |
  |  | 12 | } |
  |  | 13 |  |
  |  | 14 | if ( isset($\_POST['eha-export']) && ( !isset($\_POST['eha\_export\_nonce']) || !wp\_verify\_nonce($\_POST['eha\_export\_nonce'], 'eha\_export\_nonce') ) ) { |
  |  | 15 | // Nonce is invalid or not present |
  |  | 16 | wp\_safe\_redirect(admin\_url('admin.php?page=dp-import-export-page&nonce\_verification\_failed')); |
  |  | 17 | return false; |
  |  | 18 |  |
  |  | 19 | } |
  | 11 | 20 | if (isset($\_POST['eha-export'])) { |
  | 12 | 21 | if (isset($\_POST['export\_type']) && ( $\_POST['export\_type'] == 'eha-export-json' )) { |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/elex-exporter.php?rev=3004919#L16) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/elex-exporter.php?rev=3211131#L25) |  |
  | 16 | 25 |  |
  | 17 | 26 | $file\_rule = $tab\_c; |
  | 18 |  | if~~($tab\_c == 'combinational\_rules')~~{ |
  |  | 27 | if ($tab\_c == 'combinational\_rules') { |
  | 19 | 28 | $file\_rule = 'multi\_product\_rules'; |
  | 20 |  | }~~else if($tab\_c == 'cat\_combinational\_rules')~~{ |
  |  | 29 | } else if ($tab\_c == 'cat\_combinational\_rules') { |
  | 21 | 30 | $file\_rule = 'multi\_category\_rules'; |
  | 22 |  | }~~else if($tab\_c == 'buy\_get\_free\_rules')~~{ |
  |  | 31 | } else if ($tab\_c == 'buy\_get\_free\_rules') { |
  | 23 | 32 | $file\_rule = 'bogo\_product\_rules'; |
  | 24 | 33 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/elex-exporter.php?rev=3004919#L46) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/elex-exporter.php?rev=3211131#L55) |  |
  | 46 | 55 |  |
  | 47 | 56 | $file\_rule = $tab\_c; |
  | 48 |  | if~~($tab\_c == 'combinational\_rules')~~{ |
  |  | 57 | if ($tab\_c == 'combinational\_rules') { |
  | 49 | 58 | $file\_rule = 'multi\_product\_rules'; |
  | 50 |  | }~~else if($tab\_c == 'cat\_combinational\_rules')~~{ |
  |  | 59 | } else if ($tab\_c == 'cat\_combinational\_rules') { |
  | 51 | 60 | $file\_rule = 'multi\_category\_rules'; |
  | 52 |  | }~~else if($tab\_c == 'buy\_get\_free\_rules')~~{ |
  |  | 61 | } else if ($tab\_c == 'buy\_get\_free\_rules') { |
  | 53 | 62 | $file\_rule = 'bogo\_product\_rules'; |
  | 54 | 63 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/elex-exporter.php?rev=3004919#L83) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/elex-exporter.php?rev=3211131#L92) |  |
  | 83 | 92 | $line[] ="[$tmp]"; |
  | 84 | 93 | } else { |
  | 85 |  | if~~($v)~~{ |
  |  | 94 | if ($v) { |
  | 86 | 95 | $v      = str\_replace(',', '&comma', $v); |
  | 87 | 96 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/elex-exporter.php?rev=3004919#L100) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/elex-exporter.php?rev=3211131#L109) |  |
  | 100 | 109 | } |
  | 101 | 110 | } |
  | 102 |  | if (isset($\_POST['system-info-export'])) { |
  | 103 |  | $Info = phpinfo(1); |
  | 104 |  | if~~($Info)~~{ |
  |  | 111 | if (isset($\_POST['system-info-export'])) { |
  |  | 112 | $Info = phpinfo(1); |
  |  | 113 | if ($Info) { |
  | 105 | 114 | nocache\_headers(); |
  | 106 | 115 | header('Content-Type: application/html; charset=utf-8'); |
  | 107 | 116 | header('Content-Disposition: attachment; filename= System-info-export-' . date('d-M-Y') . '.html'); |
  | 108 | 117 | header('Expires: 0'); |
  | 109 |  | echo (~~$Info~~); |
  |  | 118 | echo ( $Info ); |
  | 110 | 119 | exit; |
  | 111 | 120 | } else { |
* ## [elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/elex-importer.php](/changeset/3211131/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/elex-importer.php "Show the changeset 3211131 restricted to elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/elex-importer.php")

  | [r2965037](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/elex-importer.php?rev=2965037#L8 "Show revision 2965037 of this file in browser") | [r3211131](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/elex-importer.php?rev=3211131#L8 "Show revision 3211131 of this file in browser") |  |
  | --- | --- | --- |
  | 8 | 8 | function elex\_dp\_import\_rules() { |
  | 9 | 9 | $rules\_array = get\_option('xa\_dp\_rules', array()); |
  |  | 10 | if (!current\_user\_can('manage\_options')) { |
  |  | 11 | return; |
  |  | 12 | } |
  |  | 13 |  |
  |  | 14 | if ( isset($\_POST['import\_tab']) && ( !isset($\_POST['eha\_import\_export\_nonce']) || !wp\_verify\_nonce($\_POST['eha\_import\_export\_nonce'], 'eha\_import\_export\_nonce') ) ) { |
  |  | 15 | // Nonce is invalid or not present |
  |  | 16 | wp\_safe\_redirect(admin\_url('admin.php?page=dp-import-export-page&nonce\_verification\_failed')); |
  |  | 17 | return false; |
  |  | 18 |  |
  |  | 19 | } |
  |  | 20 |  |
  | 10 | 21 | if (isset($\_POST['import\_tab']) && !empty($\_POST['import\_tab']) && !empty($\_FILES['import\_file'])) { |
  | 11 | 22 | $tab       = $\_POST['import\_tab']; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/elex-importer.php?rev=2965037#L91) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/elex-importer.php?rev=3211131#L102) |  |
  | 91 | 102 | } else { |
  | 92 | 103 | $file\_data = $\_FILES; |
  | 93 |  | add\_action('admin\_notices', function() use (~~$file\_data, $tab)~~{ |
  |  | 104 | add\_action('admin\_notices', function() use ( $file\_data, $tab) { |
  | 94 | 105 | ?> |
  | 95 | 106 | <div class="notice notice-error is-dismissible" style=""> |
  | 96 |  | <p><?php \_e( ~~"You can not import " . $file\_data['import\_file']['name'] . " into "~~ . $tab , 'eh-dynamic-pricing-discounts'); ?></p> |
  |  | 107 | <p><?php \_e( 'You can not import ' . $file\_data['import\_file']['name'] . ' into ' . $tab , 'eh-dynamic-pricing-discounts'); ?></p> |
  | 97 | 108 | </div> |
  | 98 | 109 | <?php |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/elex-importer.php?rev=2965037#L110) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/elex-importer.php?rev=3211131#L121) |  |
  | 110 | 121 | $data = (array) json\_decode(file\_get\_contents($import\_file), true); |
  | 111 | 122 | if (!empty($data['type']) && $data['type'] !== $tab) { |
  | 112 |  | add\_action('admin\_notices', function() use (~~$data, $tab)~~{ |
  |  | 123 | add\_action('admin\_notices', function() use ( $data, $tab) { |
  | 113 | 124 | ?> |
  | 114 | 125 | <div class="notice notice-error is-dismissible" style=""> |
  | 115 |  | <p><?php \_e( ~~"You can not import " . $data['type'] . " into "~~ . $tab , 'eh-dynamic-pricing-discounts'); ?></p> |
  |  | 126 | <p><?php \_e( 'You can not import ' . $data['type'] . ' into ' . $tab , 'eh-dynamic-pricing-discounts'); ?></p> |
  | 116 | 127 | </div> |
  | 117 | 128 | <?php |
* ## [elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/display/discount-rules.php](/changeset/3211131/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/display/discount-rules.php "Show the changeset 3211131 restricted to elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/display/discount-rules.php")

  | [r3049195](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/display/discount-rules.php?rev=3049195#L5 "Show revision 3049195 of this file in browser") | [r3211131](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/display/discount-rules.php?rev=3211131#L5 "Show revision 3211131 of this file in browser") |  |
  | --- | --- | --- |
  | 5 | 5 | } |
  | 6 | 6 |  |
  | 7 |  | $active\_tab = (~~isset($\_REQUEST['tab']) && is\_string($\_REQUEST['tab'])~~) ? sanitize\_text\_field($\_REQUEST['tab']) : 'product\_rules'; |
  |  | 7 | $active\_tab = ( isset($\_REQUEST['tab']) && is\_string($\_REQUEST['tab']) ) ? sanitize\_text\_field($\_REQUEST['tab']) : 'product\_rules'; |
  | 8 | 8 |  |
  | 9 | 9 | if (isset($\_REQUEST['cancel\_btn'])) { |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/display/discount-rules.php?rev=3049195#L12) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/display/discount-rules.php?rev=3211131#L12) |  |
  | 12 | 12 | } |
  | 13 | 13 |  |
  |  | 14 | if ( !empty($\_REQUEST['delete']) || ( isset($\_REQUEST['update']) && empty($\_REQUEST['update']) ) || !empty($\_REQUEST['update']) ) { |
  |  | 15 |  |
  |  | 16 | global $wpdb; |
  |  | 17 |  |
  |  | 18 | // Specify the transient key pattern |
  |  | 19 | $transient\_key\_pattern = 'elex\_dp\_product\_data\_%'; |
  |  | 20 |  |
  |  | 21 | $wpdb->query( |
  |  | 22 | $wpdb->prepare( |
  |  | 23 | "DELETE FROM $wpdb->options WHERE option\_name LIKE %s OR option\_name LIKE %s", |
  |  | 24 | '\_transient\_%' . $transient\_key\_pattern, |
  |  | 25 | '\_transient\_timeout\_%' . $transient\_key\_pattern |
  |  | 26 | ) |
  |  | 27 | ); |
  |  | 28 |  |
  |  | 29 | // Clear the object cache |
  |  | 30 | wp\_cache\_flush(); |
  |  | 31 |  |
  |  | 32 | } |
  |  | 33 |  |
  | 14 | 34 | if (!empty($\_REQUEST['delete'])) { |
  | 15 |  | if~~(!isset($\_REQUEST['eh\_rule\_form\_nonce']) || !wp\_verify\_nonce(sanitize\_text\_field($\_REQUEST['eh\_rule\_form\_nonce']), 'eh\_rule\_form\_nonce'))~~{ |
  |  | 35 | if (!isset($\_REQUEST['eh\_rule\_form\_nonce']) || !wp\_verify\_nonce(sanitize\_text\_field($\_REQUEST['eh\_rule\_form\_nonce']), 'eh\_rule\_form\_nonce')) { |
  | 16 | 36 | wp\_safe\_redirect(add\_query\_arg(array('page' => 'dp-discount-rules-page', 'tab' => $active\_tab), admin\_url('admin.php'))); |
  | 17 | 37 | die(); |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/display/discount-rules.php?rev=3049195#L20) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/display/discount-rules.php?rev=3211131#L40) |  |
  | 20 | 40 | $dp\_coupons\_data = get\_option('dp\_coupons\_data', array()); |
  | 21 | 41 | $deleting\_rule\_coupon\_code = isset($prev\_data[$active\_tab][$\_REQUEST['delete']]['coupon\_code']) ? sanitize\_text\_field($prev\_data[$active\_tab][$\_REQUEST['delete']]['coupon\_code']) : ''; |
  | 22 |  | if~~(isset($deleting\_rule\_coupon\_code) && !empty($deleting\_rule\_coupon\_code) && (array\_key\_exists($deleting\_rule\_coupon\_code, $dp\_coupons\_data)))~~{ |
  |  | 42 | if (isset($deleting\_rule\_coupon\_code) && !empty($deleting\_rule\_coupon\_code) && ( array\_key\_exists($deleting\_rule\_coupon\_code, $dp\_coupons\_data) )) { |
  | 23 | 43 | unset($dp\_coupons\_data[$deleting\_rule\_coupon\_code]); |
  | 24 | 44 | $dp\_coupons\_data = array\_values($dp\_coupons\_data); |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/display/discount-rules.php?rev=3049195#L28) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/display/discount-rules.php?rev=3211131#L48) |  |
  | 28 | 48 | $index\_to\_delete = sanitize\_text\_field($\_REQUEST['delete']); |
  | 29 | 49 | unset($activetab\_rules\_data[$index\_to\_delete]); |
  | 30 |  | if~~($activetab\_rules\_data)~~{ |
  |  | 50 | if ($activetab\_rules\_data) { |
  | 31 | 51 | $activetab\_rules\_data = array\_values($activetab\_rules\_data); |
  | 32 | 52 | $activetab\_rules\_data = array\_combine(range(1, count($activetab\_rules\_data)), array\_values($activetab\_rules\_data)); |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/display/discount-rules.php?rev=3049195#L43) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/display/discount-rules.php?rev=3211131#L63) |  |
  | 43 | 63 |  |
  | 44 | 64 | if (isset($\_REQUEST['update']) && empty($\_REQUEST['update'])) {    //Submit And Not Edit Then Saving New Record |
  | 45 |  | if~~(!isset($\_REQUEST['save\_rule\_nonce']) || !wp\_verify\_nonce(sanitize\_text\_field($\_REQUEST['save\_rule\_nonce']), 'save\_rule\_nonce'))~~{ |
  |  | 65 | if (!isset($\_REQUEST['save\_rule\_nonce']) || !wp\_verify\_nonce(sanitize\_text\_field($\_REQUEST['save\_rule\_nonce']), 'save\_rule\_nonce')) { |
  | 46 | 66 | wp\_safe\_redirect(add\_query\_arg(array('page' => 'dp-discount-rules-page', 'tab' => $active\_tab), admin\_url('admin.php'))); |
  | 47 | 67 | die(); |
  | 48 | 68 | } |
  | 49 |  | $current\_tab\_loc = (isset($\_REQUEST['tab']) && is\_string($\_REQUEST['tab'])) ? sanitize\_text\_field($\_REQUEST['tab']) . '/' : 'product\_rules/'; |
  |  | 69 | // Specify the transient key pattern |
  |  | 70 | $transient\_key\_pattern = 'elex\_dp\_product\_data\_'; |
  |  | 71 |  |
  |  | 72 | // Delete transients with similar keys |
  |  | 73 | $wpdb->query( |
  |  | 74 | $wpdb->prepare( |
  |  | 75 | "DELETE FROM $wpdb->options WHERE option\_name LIKE %s OR option\_name LIKE %s", |
  |  | 76 | 'transient' . $transient\_key\_pattern, |
  |  | 77 | 'transient\_timeout' . $transient\_key\_pattern |
  |  | 78 | ) |
  |  | 79 | ); |
  |  | 80 | $current\_tab\_loc = ( isset($\_REQUEST['tab']) && is\_string($\_REQUEST['tab']) ) ? sanitize\_text\_field($\_REQUEST['tab']) . '/' : 'product\_rules/'; |
  | 50 | 81 | $path            = ELEX\_DP\_BASIC\_ROOT\_PATH . 'admin/data/' . $current\_tab\_loc . 'elex-save-options.php'; |
  | 51 | 82 | if (file\_exists($path) == true) { |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/display/discount-rules.php?rev=3049195#L54) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/display/discount-rules.php?rev=3211131#L85) |  |
  | 54 | 85 |  |
  | 55 | 86 | } elseif (isset($\_REQUEST['edit']) && !empty($\_REQUEST['edit'])) {    //Loading Edit Form Or Updating Data |
  | 56 |  | if~~(!isset($\_REQUEST['eh\_rule\_form\_nonce']) || !wp\_verify\_nonce(sanitize\_text\_field($\_REQUEST['eh\_rule\_form\_nonce']), 'eh\_rule\_form\_nonce'))~~{ |
  |  | 87 | if (!isset($\_REQUEST['eh\_rule\_form\_nonce']) || !wp\_verify\_nonce(sanitize\_text\_field($\_REQUEST['eh\_rule\_form\_nonce']), 'eh\_rule\_form\_nonce')) { |
  | 57 | 88 | wp\_safe\_redirect(add\_query\_arg(array('page' => 'dp-discount-rules-page', 'tab' => $active\_tab), admin\_url('admin.php'))); |
  | 58 | 89 | die(); |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/display/discount-rules.php?rev=3049195#L61) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/display/discount-rules.php?rev=3211131#L92) |  |
  | 61 | 92 | $old\_option = $old\_option[$active\_tab]; |
  | 62 | 93 | $\_REQUEST = array\_merge($\_REQUEST, $old\_option[$\_REQUEST['edit']]); |
  | 63 |  | $current\_tab\_loc = (~~isset($\_REQUEST['tab']) && is\_string($\_REQUEST['tab'])~~) ? sanitize\_text\_field($\_REQUEST['tab']) . '/' : 'product\_rules/'; |
  |  | 94 | $current\_tab\_loc = ( isset($\_REQUEST['tab']) && is\_string($\_REQUEST['tab']) ) ? sanitize\_text\_field($\_REQUEST['tab']) . '/' : 'product\_rules/'; |
  | 64 | 95 | $path            = ELEX\_DP\_BASIC\_ROOT\_PATH . 'admin/data/' . $current\_tab\_loc . 'elex-load-edit.php'; |
  | 65 | 96 | include\_once  $path ; |
  | 66 | 97 |  |
  | 67 | 98 | } elseif ( !empty($\_REQUEST['update'])) { |
  | 68 |  | if~~(!isset($\_REQUEST['update\_rule\_' . sanitize\_text\_field($\_REQUEST['update'])]) || !wp\_verify\_nonce(sanitize\_text\_field($\_REQUEST['update\_rule\_' . sanitize\_text\_field($\_REQUEST['update'])]), 'update\_rule\_' . sanitize\_text\_field($\_REQUEST['update'])))~~{ |
  |  | 99 | if (!isset($\_REQUEST['update\_rule\_' . sanitize\_text\_field($\_REQUEST['update'])]) || !wp\_verify\_nonce(sanitize\_text\_field($\_REQUEST['update\_rule\_' . sanitize\_text\_field($\_REQUEST['update'])]), 'update\_rule\_' . sanitize\_text\_field($\_REQUEST['update']))) { |
  | 69 | 100 | wp\_safe\_redirect(add\_query\_arg(array('page' => 'dp-discount-rules-page', 'tab' => $active\_tab), admin\_url('admin.php'))); |
  | 70 | 101 | die(); |
  | 71 | 102 | } |
  | 72 |  | $path = (isset($\_REQUEST['tab']) && is\_string($\_REQUEST['tab'])) ? sanitize\_text\_field($\_REQUEST['tab']) . '/' : 'product\_rules/'; |
  |  | 103 | // Specify the transient key pattern |
  |  | 104 | $transient\_key\_pattern = 'elex\_dp\_product\_data\_'; |
  |  | 105 |  |
  |  | 106 | // Delete transients with similar keys |
  |  | 107 | $wpdb->query( |
  |  | 108 | $wpdb->prepare( |
  |  | 109 | "DELETE FROM $wpdb->options WHERE option\_name LIKE %s OR option\_name LIKE %s", |
  |  | 110 | 'transient' . $transient\_key\_pattern, |
  |  | 111 | 'transient\_timeout' . $transient\_key\_pattern |
  |  | 112 | ) |
  |  | 113 | ); |
  |  | 114 |  |
  |  | 115 | $path = ( isset($\_REQUEST['tab']) && is\_string($\_REQUEST['tab']) ) ? sanitize\_text\_field($\_REQUEST['tab']) . '/' : 'product\_rules/'; |
  | 73 | 116 | $path = ELEX\_DP\_BASIC\_ROOT\_PATH . 'admin/data/' . $path . 'elex-update-options.php'; |
  | 74 | 117 | include\_once  $path ; |
* ## [elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/display/settings.php](/changeset/3211131/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/display/settings.php "Show the changeset 3211131 restricted to elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/display/settings.php")

  | [r3049195](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/display/settings.php?rev=3049195#L6 "Show revision 3049195 of this file in browser") | [r3211131](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/display/settings.php?rev=3211131#L6 "Show revision 3211131 of this file in browser") |  |
  | --- | --- | --- |
  | 6 | 6 |  |
  | 7 | 7 | // Sets active tab |
  | 8 |  | $active\_tab = (~~isset($\_REQUEST['tab']) && is\_string($\_REQUEST['tab'])~~) ? sanitize\_text\_field($\_REQUEST['tab']) : 'rules\_order'; |
  |  | 8 | $active\_tab = ( isset($\_REQUEST['tab']) && is\_string($\_REQUEST['tab']) ) ? sanitize\_text\_field($\_REQUEST['tab']) : 'rules\_order'; |
  | 9 | 9 |  |
  | 10 | 10 | // Data handling of form submit request. |
  | 11 | 11 | if (isset($\_REQUEST['submit'])) { |
  |  | 12 | global $wpdb; |
  |  | 13 | // Specify the transient key pattern |
  |  | 14 | $transient\_key\_pattern = 'elex\_dp\_product\_data\_%'; |
  |  | 15 |  |
  |  | 16 | $wpdb->query( |
  |  | 17 | $wpdb->prepare( |
  |  | 18 | "DELETE FROM $wpdb->options WHERE option\_name LIKE %s OR option\_name LIKE %s", |
  |  | 19 | '\_transient\_%' . $transient\_key\_pattern, |
  |  | 20 | '\_transient\_timeout\_%' . $transient\_key\_pattern |
  |  | 21 | ) |
  |  | 22 | ); |
  |  | 23 |  |
  |  | 24 | // Clear the object cache |
  |  | 25 | wp\_cache\_flush(); |
  | 12 | 26 | $path = ELEX\_DP\_BASIC\_ROOT\_PATH . 'admin/data/settings\_page/elex-save-options.php'; |
  | 13 | 27 | if (file\_exists($path) == true) { |
* ## [elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/renderer/discount-rules.php](/changeset/3211131/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/renderer/discount-rules.php "Show the changeset 3211131 restricted to elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/renderer/discount-rules.php")

  | [r3049195](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/renderer/discount-rules.php?rev=3049195#L56 "Show revision 3049195 of this file in browser") | [r3211131](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/renderer/discount-rules.php?rev=3211131#L56 "Show revision 3211131 of this file in browser") |  |
  | --- | --- | --- |
  | 56 | 56 | $tablink = esc\_url(add\_query\_arg(array('page' => 'dp-discount-rules-page', 'tab' => $tabkey), admin\_url('admin.php'))); |
  | 57 | 57 | switch ($tabkey) { |
  | 58 |  | case 'product\_rules': ?> |
  |  | 58 | case 'product\_rules': |
  |  | 59 | ?> |
  | 59 | 60 | <a href="<?php echo $tablink; ?>" class=" elex-dynamic-pricing-main-link <?php echo $active\_tab === 'product\_rules' ? 'active' : ''; ?>"> |
  | 60 | 61 | <?php esc\_html\_e('Product Rule', 'eh-dynamic-pricing-discounts'); ?> |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/renderer/discount-rules.php?rev=3049195#L63) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/renderer/discount-rules.php?rev=3211131#L64) |  |
  | 63 | 64 | <path id="carrier\_seperator" data-name="carrier seperator" d="M2565.89-576v23.587" transform="translate(-2564.89 577)" fill="none" stroke="#707070" stroke-linecap="round" stroke-width="2" /> |
  | 64 | 65 | </svg> |
  | 65 |  | <?php break; |
  | 66 |  | case 'category\_rules':  ?> |
  |  | 66 | <?php |
  |  | 67 | break; |
  |  | 68 | case 'category\_rules': |
  |  | 69 | ?> |
  | 67 | 70 | <a href="<?php echo $tablink; ?>" class=" elex-dynamic-pricing-main-link <?php echo $active\_tab === 'category\_rules' ? 'active' : ''; ?>"> |
  | 68 | 71 | <?php esc\_html\_e('Category Rules', 'eh-dynamic-pricing-discounts'); ?> |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/renderer/discount-rules.php?rev=3049195#L71) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/renderer/discount-rules.php?rev=3211131#L74) |  |
  | 71 | 74 | <path id="carrier\_seperator" data-name="carrier seperator" d="M2565.89-576v23.587" transform="translate(-2564.89 577)" fill="none" stroke="#707070" stroke-linecap="round" stroke-width="2" /> |
  | 72 | 75 | </svg> |
  | 73 |  | <?php break; |
  |  | 76 | <?php |
  |  | 77 | break; |
  | 74 | 78 | default: |
  | 75 | 79 | break; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/renderer/discount-rules.php?rev=3049195#L82) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/renderer/discount-rules.php?rev=3211131#L86) |  |
  | 82 | 86 |  |
  | 83 | 87 | <div> |
  | 84 |  | <?php if (!in\_array($active\_tab, $execution\_order)) { ?> |
  |  | 88 | <?php if (!in\_array($active\_tab, $execution\_order)) { ?> |
  | 85 | 89 | <!-- when no rule tab is there --> |
  | 86 | 90 | <div class="w-100 text-center"> |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/renderer/discount-rules.php?rev=3049195#L95) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/renderer/discount-rules.php?rev=3211131#L99) |  |
  | 95 | 99 | <img src="<?php echo esc\_url( ELEX\_DP\_CRM\_MAIN\_IMG . 'IsolationMode.svg' ); ?>" alt="" class="w-100" style="max-width: 684px; margin: auto;"> |
  | 96 | 100 | <div class="text-center"> |
  | 97 |  | <button class="btn btn-primary elex-dynamic-pricing-popup-open-btn"><?php esc\_html\_e('Create My First |
  | 98 |  | Rule', 'eh-dynamic-pricing-discounts'); ?></button> |
  |  | 101 | <button class="btn btn-primary elex-dynamic-pricing-popup-open-btn"> |
  |  | 102 | <?php |
  |  | 103 | esc\_html\_e('Create My First |
  |  | 104 | Rule', 'eh-dynamic-pricing-discounts'); |
  |  | 105 | ?> |
  |  | 106 | </button> |
  | 99 | 107 | </div> |
  | 100 | 108 | </div> |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/renderer/discount-rules.php?rev=3049195#L105) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/renderer/discount-rules.php?rev=3211131#L113) |  |
  | 105 | 113 | $settings       = get\_option('xa\_dynamic\_pricing\_setting', array()); |
  | 106 | 114 |  |
  | 107 |  | ?> |
  |  | 115 | ?> |
  | 108 | 116 |  |
  | 109 | 117 | <div class="d-flex justify-content-between align-items-center mb-3"> |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/renderer/discount-rules.php?rev=3049195#L132) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/renderer/discount-rules.php?rev=3211131#L140) |  |
  | 132 | 140 | $member\_plans = wc\_memberships\_get\_membership\_plans(); |
  | 133 | 141 | } |
  | 134 |  | $no\_of\_rules = count($allrules); |
  |  | 142 | $no\_of\_rules = count($allrules); |
  | 135 | 143 | ?> |
  | 136 | 144 | <input type="hidden" id="no\_of\_rules" name="no\_of\_rules" value="<?php echo esc\_attr($no\_of\_rules); ?>"> |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/renderer/discount-rules.php?rev=3049195#L140) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/renderer/discount-rules.php?rev=3211131#L148) |  |
  | 140 | 148 | //Checkon |
  | 141 | 149 | $checkon= ''; |
  | 142 |  | if(isset($value['check\_on']) && !empty($value['check\_on'])) { |
  |  | 150 | if (isset($value['check\_on']) && !empty($value['check\_on'])) { |
  | 143 | 151 | switch ($value['check\_on']) { |
  | 144 | 152 | case 'Quantity': |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/renderer/discount-rules.php?rev=3049195#L161) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/renderer/discount-rules.php?rev=3211131#L169) |  |
  | 161 | 169 | if ($active\_tab === 'product\_rules') { |
  | 162 | 170 | require ELEX\_DP\_BASIC\_ROOT\_PATH . 'admin/ui/view/discount-rules/card/product-rules.php'; |
  | 163 |  | }else if ($active\_tab === 'category\_rules') { |
  |  | 171 | } else if ($active\_tab === 'category\_rules') { |
  | 164 | 172 | require ELEX\_DP\_BASIC\_ROOT\_PATH . 'admin/ui/view/discount-rules/card/category-rules.php'; |
  | 165 | 173 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/renderer/discount-rules.php?rev=3049195#L180) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/renderer/discount-rules.php?rev=3211131#L188) |  |
  | 180 | 188 | <?php |
  | 181 | 189 | if (isset($\_REQUEST['edit'])) { |
  | 182 |  | wp\_nonce\_field('update\_rule\_' . $\_REQUEST['edit'],'update\_rule\_' . $\_REQUEST['edit']); |
  |  | 190 | wp\_nonce\_field('update\_rule\_' . $\_REQUEST['edit'], 'update\_rule\_' . $\_REQUEST['edit']); |
  | 183 | 191 | } else { |
  | 184 |  | wp\_nonce\_field('save\_rule\_nonce','save\_rule\_nonce'); |
  |  | 192 | wp\_nonce\_field('save\_rule\_nonce', 'save\_rule\_nonce'); |
  | 185 | 193 | } |
  | 186 | 194 | ?> |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/renderer/discount-rules.php?rev=3049195#L381) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/renderer/discount-rules.php?rev=3211131#L389) |  |
  | 381 | 389 | if(no\_of\_rules == 1){ |
  | 382 | 390 | // var className = document.getElementById('className').value; |
  | 383 |  | document.getElementsByClassName('elex-ac-edit-rule-up-btn')[0].disabled=true; |
  |  | 391 | document.getElementsByClassName('elex-ac-edit-rule-up-btn')[0].disabled=true; |
  | 384 | 392 | document.getElementsByClassName('elex-ac-edit-rule-down-btn')[0].disabled=true; |
  | 385 | 393 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/renderer/discount-rules.php?rev=3049195#L418) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/renderer/discount-rules.php?rev=3211131#L426) |  |
  | 418 | 426 | return; |
  | 419 | 427 | } |
  | 420 |  | } |
  |  | 428 | } |
  | 421 | 429 |  |
  | 422 | 430 | isFormSubmitting = true; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/renderer/discount-rules.php?rev=3049195#L433) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/renderer/discount-rules.php?rev=3211131#L441) |  |
  | 433 | 441 | document.getElementById("myForm").reset(); |
  | 434 | 442 | }); |
  | 435 |  |  |
  |  | 443 |  |
  | 436 | 444 |  |
  | 437 | 445 | //Js for rule deleting confirmation Alert ==> |
* ## [elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/view/discount-rules/card/category-rules.php](/changeset/3211131/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/view/discount-rules/card/category-rules.php "Show the changeset 3211131 restricted to elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/view/discount-rules/card/category-rules.php")

  | [r3133197](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/card/category-rules.php?rev=3133197#L21 "Show revision 3133197 of this file in browser") | [r3211131](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/view/discount-rules/card/category-rules.php?rev=3211131#L21 "Show revision 3211131 of this file in browser") |  |
  | --- | --- | --- |
  | 21 | 21 | <div class="flex-fill"> |
  | 22 | 22 | <div class="d-flex justify-content-between mb-3"> |
  | 23 |  | <h6 class="mb-0"><?php esc\_html\_e('Rule #: ', 'eh-dynamic-pricing-discounts'); ?><span class="fw-normal"><?php echo esc\_html($key); ?></span> | <?php esc\_html\_e('Rule Name: ', 'eh-dynamic-pricing-discounts'); ?><span class="fw-normal"><?php echo (~~isset($value['offer\_name']) && !empty($value['offer\_name'])~~) ? esc\_html($value['offer\_name']) : ' - - '; ?></span></h6> |
  | 24 |  | <h6 class="mb-0"><?php esc\_html\_e('Validty: ', 'eh-dynamic-pricing-discounts'); ?><span class="fw-normal"><?php echo (~~isset($value['from\_date']) && !empty($value['from\_date']) && isset($value['to\_date']) && !empty($value['to\_date'])~~) ? esc\_html($value['from\_date'] . '/' . esc\_html($value['to\_date'])) : ' --/--'; ?></span> |
  |  | 23 | <h6 class="mb-0"><?php esc\_html\_e('Rule #: ', 'eh-dynamic-pricing-discounts'); ?><span class="fw-normal"><?php echo esc\_html($key); ?></span> | <?php esc\_html\_e('Rule Name: ', 'eh-dynamic-pricing-discounts'); ?><span class="fw-normal"><?php echo ( isset($value['offer\_name']) && !empty($value['offer\_name']) ) ? esc\_html($value['offer\_name']) : ' - - '; ?></span></h6> |
  |  | 24 | <h6 class="mb-0"><?php esc\_html\_e('Validty: ', 'eh-dynamic-pricing-discounts'); ?><span class="fw-normal"><?php echo ( isset($value['from\_date']) && !empty($value['from\_date']) && isset($value['to\_date']) && !empty($value['to\_date']) ) ? esc\_html($value['from\_date'] . '/' . esc\_html($value['to\_date'])) : ' --/--'; ?></span> |
  | 25 | 25 | </h6> |
  | 26 | 26 | </div> |
  | 27 | 27 |  |
  | 28 | 28 | <div class="d-flex justify-content-between "> |
  | 29 |  | <h6 class="mb-0"><?php esc\_html\_e('Discount Type: ', 'eh-dynamic-pricing-discounts'); ?><span class="fw-normal"><?php echo (~~isset($value['discount\_type']) && !empty($value['discount\_type'])~~)? esc\_html($value['discount\_type']) : ' - - '; ?></span> |
  |  | 29 | <h6 class="mb-0"><?php esc\_html\_e('Discount Type: ', 'eh-dynamic-pricing-discounts'); ?><span class="fw-normal"><?php echo ( isset($value['discount\_type']) && !empty($value['discount\_type']) )? esc\_html($value['discount\_type']) : ' - - '; ?></span> |
  | 30 | 30 | </h6> |
  | 31 |  | <h6 class="mb-0"><?php esc\_html\_e('Discount Value: ', 'eh-dynamic-pricing-discounts'); ?><span class="fw-normal"><?php echo (~~isset($value['value']) && !empty($value['value'])~~) ? esc\_html($value['value']) : ' - - '; ?></span> |
  |  | 31 | <h6 class="mb-0"><?php esc\_html\_e('Discount Value: ', 'eh-dynamic-pricing-discounts'); ?><span class="fw-normal"><?php echo ( isset($value['value']) && !empty($value['value']) ) ? esc\_html($value['value']) : ' - - '; ?></span> |
  | 32 | 32 | </h6> |
  | 33 |  | <h6 class="mb-0"><?php esc\_html\_e('Max Discount: ', 'eh-dynamic-pricing-discounts'); ?><span class="fw-normal"><?php echo (~~isset($value['max\_discount']) && !empty($value['max\_discount'])~~) ? esc\_html($value['max\_discount']) : ' - - '; ?></span></h6> |
  |  | 33 | <h6 class="mb-0"><?php esc\_html\_e('Max Discount: ', 'eh-dynamic-pricing-discounts'); ?><span class="fw-normal"><?php echo ( isset($value['max\_discount']) && !empty($value['max\_discount']) ) ? esc\_html($value['max\_discount']) : ' - - '; ?></span></h6> |
  | 34 | 34 | </div> |
  | 35 | 35 | </div> |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/card/category-rules.php?rev=3133197#L69) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/view/discount-rules/card/category-rules.php?rev=3211131#L69) |  |
  | 69 | 69 | } |
  | 70 | 70 | } |
  | 71 |  | }~~else~~{ |
  |  | 71 | } else { |
  | 72 | 72 | echo '<div class="btn elex-light-blue-bg">' . esc\_html\_\_(' - - ', 'eh-dynamic-pricing-discounts') . '</div>'; |
  | 73 | 73 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/card/category-rules.php?rev=3133197#L102) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/view/discount-rules/card/category-rules.php?rev=3211131#L102) |  |
  | 102 | 102 | <div class="border-0 border-bottom mb-3"> |
  | 103 | 103 | <div class="d-flex gap-4"> |
  | 104 |  | <h6><?php esc\_html\_e('Check On: ', 'eh-dynamic-pricing-discounts');?><span class="fw-normal"><?php echo esc\_html(isset($checkon) && !empty($checkon) ? $checkon : ' - - '); ?></span></h6> |
  |  | 104 | <h6><?php esc\_html\_e('Check On: ', 'eh-dynamic-pricing-discounts'); ?><span class="fw-normal"><?php echo esc\_html(isset($checkon) && !empty($checkon) ? $checkon : ' - - '); ?></span></h6> |
  | 105 | 105 | <h6><?php esc\_html\_e('Minimum ', 'eh-dynamic-pricing-discounts'); ?><?php echo esc\_html(isset($checkon) && !empty($checkon) ? $checkon : ' - - '); ?>: <span class="fw-normal"><?php echo esc\_html(isset($value['min']) && !empty($value['min']) ? $value['min'] : ' - - '); ?></span></h6> |
  | 106 | 106 | <h6><?php esc\_html\_e('Maximum ', 'eh-dynamic-pricing-discounts'); ?><?php echo esc\_html(isset($checkon) && !empty($checkon) ? $checkon : ' - - '); ?>: <span class="fw-normal"><?php echo esc\_html(isset($value['max']) && !empty($value['max']) ? $value['max'] : ' - - '); ?></span></h6> |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/card/category-rules.php?rev=3133197#L128) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/view/discount-rules/card/category-rules.php?rev=3211131#L128) |  |
  | 128 | 128 | } |
  | 129 | 129 | } |
  | 130 |  | }~~else~~{ |
  |  | 130 | } else { |
  | 131 | 131 | echo '<div class="btn elex-light-blue-bg">' . esc\_html\_\_(' - - ', 'eh-dynamic-pricing-discounts') . '</div>'; |
  | 132 | 132 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/card/category-rules.php?rev=3133197#L150) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/view/discount-rules/card/category-rules.php?rev=3211131#L150) |  |
  | 150 | 150 | </div> |
  | 151 | 151 | <div class="d-flex justify-content-between"> |
  | 152 |  | <h6 class="mb-0"><?php esc\_html\_e('Minimum Number of Previous Order: ', 'eh-dynamic-pricing-discounts');?> <?php echo esc\_html(isset($value['prev\_order\_count']) && !empty($value['prev\_order\_count']) ? $value['prev\_order\_count'] : ' - - '); ?></h6> |
  | 153 |  | <h6 class="mb-0"><?php esc\_html\_e('Minimum Total Spending on Previous Order: ', 'eh-dynamic-pricing-discounts');?> <?php echo esc\_html(isset($value['prev\_order\_total\_amt']) && !empty($value['prev\_order\_total\_amt']) ? $value['prev\_order\_total\_amt'] : ' - - '); ?></h6> |
  |  | 152 | <h6 class="mb-0"><?php esc\_html\_e('Minimum Number of Previous Order: ', 'eh-dynamic-pricing-discounts'); ?> <?php echo esc\_html(isset($value['prev\_order\_count']) && !empty($value['prev\_order\_count']) ? $value['prev\_order\_count'] : ' - - '); ?></h6> |
  |  | 153 | <h6 class="mb-0"><?php esc\_html\_e('Minimum Total Spending on Previous Order: ', 'eh-dynamic-pricing-discounts'); ?> <?php echo esc\_html(isset($value['prev\_order\_total\_amt']) && !empty($value['prev\_order\_total\_amt']) ? $value['prev\_order\_total\_amt'] : ' - - '); ?></h6> |
  | 154 | 154 | </div> |
  | 155 | 155 | </div> |
* ## [elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/view/discount-rules/card/product-rules.php](/changeset/3211131/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/view/discount-rules/card/product-rules.php "Show the changeset 3211131 restricted to elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/view/discount-rules/card/product-rules.php")

  | [r3133197](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/card/product-rules.php?rev=3133197#L21 "Show revision 3133197 of this file in browser") | [r3211131](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/view/discount-rules/card/product-rules.php?rev=3211131#L21 "Show revision 3211131 of this file in browser") |  |
  | --- | --- | --- |
  | 21 | 21 | <div class="flex-fill"> |
  | 22 | 22 | <div class="d-flex justify-content-between mb-3"> |
  | 23 |  | <h6 class="mb-0"><?php esc\_html\_e('Rule #: ', 'eh-dynamic-pricing-discounts'); ?><span class="fw-normal"><?php echo esc\_html($key); ?></span> | <?php esc\_html\_e('Rule Name: ', 'eh-dynamic-pricing-discounts'); ?><span class="fw-normal"><?php echo (~~isset($value['offer\_name']) && !empty($value['offer\_name'])~~) ? esc\_html($value['offer\_name']) : ' - - '; ?></span></h6> |
  | 24 |  | <h6 class="mb-0"><?php esc\_html\_e('Validty: ', 'eh-dynamic-pricing-discounts'); ?><span class="fw-normal"><?php echo (~~isset($value['from\_date']) && !empty($value['from\_date']) && isset($value['to\_date']) && !empty($value['to\_date'])~~) ? esc\_html($value['from\_date'] . '/' . esc\_html($value['to\_date'])) : ' --/--'; ?></span> |
  |  | 23 | <h6 class="mb-0"><?php esc\_html\_e('Rule #: ', 'eh-dynamic-pricing-discounts'); ?><span class="fw-normal"><?php echo esc\_html($key); ?></span> | <?php esc\_html\_e('Rule Name: ', 'eh-dynamic-pricing-discounts'); ?><span class="fw-normal"><?php echo ( isset($value['offer\_name']) && !empty($value['offer\_name']) ) ? esc\_html($value['offer\_name']) : ' - - '; ?></span></h6> |
  |  | 24 | <h6 class="mb-0"><?php esc\_html\_e('Validty: ', 'eh-dynamic-pricing-discounts'); ?><span class="fw-normal"><?php echo ( isset($value['from\_date']) && !empty($value['from\_date']) && isset($value['to\_date']) && !empty($value['to\_date']) ) ? esc\_html($value['from\_date'] . '/' . esc\_html($value['to\_date'])) : ' --/--'; ?></span> |
  | 25 | 25 | </h6> |
  | 26 | 26 | </div> |
  | 27 | 27 |  |
  | 28 | 28 | <div class="d-flex justify-content-between "> |
  | 29 |  | <h6 class="mb-0"><?php esc\_html\_e('Discount Type: ', 'eh-dynamic-pricing-discounts'); ?><span class="fw-normal"><?php echo (~~isset($value['discount\_type']) && !empty($value['discount\_type'])~~)? esc\_html($value['discount\_type']) : ' - - '; ?></span> |
  |  | 29 | <h6 class="mb-0"><?php esc\_html\_e('Discount Type: ', 'eh-dynamic-pricing-discounts'); ?><span class="fw-normal"><?php echo ( isset($value['discount\_type']) && !empty($value['discount\_type']) )? esc\_html($value['discount\_type']) : ' - - '; ?></span> |
  | 30 | 30 | </h6> |
  | 31 |  | <h6 class="mb-0"><?php esc\_html\_e('Discount Value: ', 'eh-dynamic-pricing-discounts'); ?><span class="fw-normal"><?php echo (~~isset($value['value']) && !empty($value['value'])~~) ? esc\_html($value['value']) : ' - - '; ?></span> |
  |  | 31 | <h6 class="mb-0"><?php esc\_html\_e('Discount Value: ', 'eh-dynamic-pricing-discounts'); ?><span class="fw-normal"><?php echo ( isset($value['value']) && !empty($value['value']) ) ? esc\_html($value['value']) : ' - - '; ?></span> |
  | 32 | 32 | </h6> |
  | 33 |  | <h6 class="mb-0"><?php esc\_html\_e('Max Discount: ', 'eh-dynamic-pricing-discounts'); ?><span class="fw-normal"><?php echo (~~isset($value['max\_discount']) && !empty($value['max\_discount'])~~) ? esc\_html($value['max\_discount']) : ' - - '; ?></span></h6> |
  |  | 33 | <h6 class="mb-0"><?php esc\_html\_e('Max Discount: ', 'eh-dynamic-pricing-discounts'); ?><span class="fw-normal"><?php echo ( isset($value['max\_discount']) && !empty($value['max\_discount']) ) ? esc\_html($value['max\_discount']) : ' - - '; ?></span></h6> |
  | 34 | 34 | </div> |
  | 35 | 35 | </div> |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/card/product-rules.php?rev=3133197#L63) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/view/discount-rules/card/product-rules.php?rev=3211131#L63) |  |
  | 63 | 63 | $product = wc\_get\_product($\_pid); |
  | 64 | 64 | if (!empty($\_pid) && !empty($product)) { |
  | 65 |  | echo '<div class="btn elex-light-blue-bg">' . \_\_($product->get\_formatted\_name(),'eh-dynamic-pricing-discounts') . '</div>'; |
  |  | 65 | echo '<div class="btn elex-light-blue-bg">' . \_\_($product->get\_formatted\_name(), 'eh-dynamic-pricing-discounts') . '</div>'; |
  | 66 | 66 | } |
  | 67 | 67 | } |
  | 68 |  | }~~else~~{ |
  |  | 68 | } else { |
  | 69 | 69 | echo '<div class="btn elex-light-blue-bg">' . esc\_html\_\_(' - - ', 'eh-dynamic-pricing-discounts') . '</div>'; |
  | 70 | 70 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/card/product-rules.php?rev=3133197#L82) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/view/discount-rules/card/product-rules.php?rev=3211131#L82) |  |
  | 82 | 82 | echo '<div class="btn elex-light-blue-bg">' . esc\_html($category) . '</div>'; |
  | 83 | 83 | } |
  | 84 |  | }~~else~~{ |
  |  | 84 | } else { |
  | 85 | 85 | echo '<div class="btn elex-light-blue-bg">' . esc\_html\_\_(' - - ', 'eh-dynamic-pricing-discounts') . '</div>'; |
  | 86 | 86 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/card/product-rules.php?rev=3133197#L94) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/view/discount-rules/card/product-rules.php?rev=3211131#L94) |  |
  | 94 | 94 | <?php |
  | 95 | 95 | echo '<div class="btn elex-light-blue-bg">' . esc\_html\_\_('\* All Products in cart \*', 'eh-dynamic-pricing-discounts') . '</div>'; |
  | 96 |  | ?> |
  |  | 96 | ?> |
  | 97 | 97 | </div> |
  | 98 | 98 | </div> |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/card/product-rules.php?rev=3133197#L154) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/view/discount-rules/card/product-rules.php?rev=3211131#L154) |  |
  | 154 | 154 | } |
  | 155 | 155 | } |
  | 156 |  | }~~else~~{ |
  |  | 156 | } else { |
  | 157 | 157 | echo '<div class="btn elex-light-blue-bg">' . esc\_html\_\_(' - - ', 'eh-dynamic-pricing-discounts') . '</div>'; |
  | 158 | 158 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/card/product-rules.php?rev=3133197#L176) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/view/discount-rules/card/product-rules.php?rev=3211131#L176) |  |
  | 176 | 176 | </div> |
  | 177 | 177 | <div class="d-flex justify-content-between"> |
  | 178 |  | <h6 class="mb-0"><?php esc\_html\_e('Minimum Number of Previous Order: ', 'eh-dynamic-pricing-discounts');?> <?php echo esc\_html(isset($value['prev\_order\_count']) && !empty($value['prev\_order\_count']) ? $value['prev\_order\_count'] : ' - - '); ?></h6> |
  | 179 |  | <h6 class="mb-0"><?php esc\_html\_e('Minimum Total Spending on Previous Order: ', 'eh-dynamic-pricing-discounts');?> <?php echo esc\_html(isset($value['prev\_order\_total\_amt']) && !empty($value['prev\_order\_total\_amt']) ? $value['prev\_order\_total\_amt'] : ' - - '); ?></h6> |
  |  | 178 | <h6 class="mb-0"><?php esc\_html\_e('Minimum Number of Previous Order: ', 'eh-dynamic-pricing-discounts'); ?> <?php echo esc\_html(isset($value['prev\_order\_count']) && !empty($value['prev\_order\_count']) ? $value['prev\_order\_count'] : ' - - '); ?></h6> |
  |  | 179 | <h6 class="mb-0"><?php esc\_html\_e('Minimum Total Spending on Previous Order: ', 'eh-dynamic-pricing-discounts'); ?> <?php echo esc\_html(isset($value['prev\_order\_total\_amt']) && !empty($value['prev\_order\_total\_amt']) ? $value['prev\_order\_total\_amt'] : ' - - '); ?></h6> |
  | 180 | 180 | </div> |
  | 181 | 181 | </div> |
* ## [elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/view/discount-rules/popup/category-rules.php](/changeset/3211131/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/view/discount-rules/popup/category-rules.php "Show the changeset 3211131 restricted to elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/view/discount-rules/popup/category-rules.php")

  | [r3049195](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/popup/category-rules.php?rev=3049195#L5 "Show revision 3049195 of this file in browser") | [r3211131](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/view/discount-rules/popup/category-rules.php?rev=3211131#L5 "Show revision 3211131 of this file in browser") |  |
  | --- | --- | --- |
  | 5 | 5 | if (isset($\_REQUEST['edit']) && !empty($\_REQUEST['edit'])) { |
  | 6 | 6 | $edit\_value = sanitize\_text\_field($\_REQUEST['edit']); |
  | 7 |  | echo '<input type="hidden" name="update" value="' . esc\_attr($edit\_value) . '" >'; |
  |  | 7 | echo '<input type="hidden" name="update" value="' . esc\_attr($edit\_value) . '" >'; |
  | 8 | 8 | } |
  | 9 | 9 | ?> |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/popup/category-rules.php?rev=3049195#L101) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/view/discount-rules/popup/category-rules.php?rev=3211131#L101) |  |
  | 101 | 101 | <span><?php esc\_html\_e('Restrictions', 'eh-dynamic-pricing-discounts'); ?><sup class="elex\_dp\_go\_premium\_color"><?php esc\_html\_e('[Premium]', 'eh-dynamic-pricing-discounts'); ?></sup></span> |
  | 102 | 102 | </div> |
  | 103 |  | </div> |
  |  | 103 | </div> |
  | 104 | 104 |  |
  | 105 | 105 | <!-- tabs content --> |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/popup/category-rules.php?rev=3049195#L161) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/view/discount-rules/popup/category-rules.php?rev=3211131#L161) |  |
  | 161 | 161 | <div class="col-md-8"> |
  | 162 | 162 | <select name="check\_on" id="check\_on" class="form-select min-width-100"> |
  | 163 |  | <option value="Quantity" <?php selected(!empty($\_REQUEST['check\_on']) && (~~$\_REQUEST['check\_on'] == 'Quantity'~~)); ?>><?php esc\_html\_e('No. of items', 'eh-dynamic-pricing-discounts'); ?></option> |
  | 164 |  | <option value="Weight" <?php selected(!empty($\_REQUEST['check\_on']) && (~~$\_REQUEST['check\_on'] == 'Weight'~~)); ?>><?php esc\_html\_e('Weight', 'eh-dynamic-pricing-discounts'); ?></option> |
  | 165 |  | <option value="Price" <?php selected(!empty($\_REQUEST['check\_on']) && (~~$\_REQUEST['check\_on'] == 'Price'~~)); ?>><?php esc\_html\_e('Price', 'eh-dynamic-pricing-discounts'); ?></option> |
  | 166 |  | <option value="TotalQuantity" <?php selected(!empty($\_REQUEST['check\_on']) && (~~$\_REQUEST['check\_on'] == 'TotalQuantity'~~)); ?>><?php esc\_html\_e('No. of Units', 'eh-dynamic-pricing-discounts'); ?></option> |
  |  | 163 | <option value="Quantity" <?php selected(!empty($\_REQUEST['check\_on']) && ( $\_REQUEST['check\_on'] == 'Quantity' )); ?>><?php esc\_html\_e('No. of items', 'eh-dynamic-pricing-discounts'); ?></option> |
  |  | 164 | <option value="Weight" <?php selected(!empty($\_REQUEST['check\_on']) && ( $\_REQUEST['check\_on'] == 'Weight' )); ?>><?php esc\_html\_e('Weight', 'eh-dynamic-pricing-discounts'); ?></option> |
  |  | 165 | <option value="Price" <?php selected(!empty($\_REQUEST['check\_on']) && ( $\_REQUEST['check\_on'] == 'Price' )); ?>><?php esc\_html\_e('Price', 'eh-dynamic-pricing-discounts'); ?></option> |
  |  | 166 | <option value="TotalQuantity" <?php selected(!empty($\_REQUEST['check\_on']) && ( $\_REQUEST['check\_on'] == 'TotalQuantity' )); ?>><?php esc\_html\_e('No. of Units', 'eh-dynamic-pricing-discounts'); ?></option> |
  | 167 | 167 | </select> |
  | 168 | 168 | </div> |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/popup/category-rules.php?rev=3049195#L211) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/view/discount-rules/popup/category-rules.php?rev=3211131#L211) |  |
  | 211 | 211 | <select name="discount\_type" id="discount\_type" |
  | 212 | 212 | class="form-select min-width-100 elex-dynamic-pricing-discount-type-select"> |
  | 213 |  | <option value="Percent Discount" <?php selected(!empty($\_REQUEST['discount\_type']) && (~~$\_REQUEST['discount\_type'] == 'Percent Discount'~~)); ?>><?php esc\_html\_e('Percent Discount', 'eh-dynamic-pricing-discounts'); ?></option> |
  | 214 |  | <option value="Flat Discount" <?php selected(!empty($\_REQUEST['discount\_type']) && (~~$\_REQUEST['discount\_type'] == 'Flat Discount'~~)); ?>><?php esc\_html\_e('Flat Discount', 'eh-dynamic-pricing-discounts'); ?></option> |
  | 215 |  | <option value="Fixed Price" <?php selected(!empty($\_REQUEST['discount\_type']) && (~~$\_REQUEST['discount\_type'] == 'Fixed Price'~~)); ?>><?php esc\_html\_e('Fixed Price', 'eh-dynamic-pricing-discounts'); ?></option> |
  |  | 213 | <option value="Percent Discount" <?php selected(!empty($\_REQUEST['discount\_type']) && ( $\_REQUEST['discount\_type'] == 'Percent Discount' )); ?>><?php esc\_html\_e('Percent Discount', 'eh-dynamic-pricing-discounts'); ?></option> |
  |  | 214 | <option value="Flat Discount" <?php selected(!empty($\_REQUEST['discount\_type']) && ( $\_REQUEST['discount\_type'] == 'Flat Discount' )); ?>><?php esc\_html\_e('Flat Discount', 'eh-dynamic-pricing-discounts'); ?></option> |
  |  | 215 | <option value="Fixed Price" <?php selected(!empty($\_REQUEST['discount\_type']) && ( $\_REQUEST['discount\_type'] == 'Fixed Price' )); ?>><?php esc\_html\_e('Fixed Price', 'eh-dynamic-pricing-discounts'); ?></option> |
  | 216 | 216 | <option value="Coupon Discount" disabled><?php esc\_html\_e('Coupon Discount', 'eh-dynamic-pricing-discounts'); ?> |
  | 217 | 217 | <sup class="elex\_dp\_go\_premium\_color"><?php esc\_html\_e('[Premium]', 'eh-dynamic-pricing-discounts'); ?></sup></option> |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/popup/category-rules.php?rev=3049195#L224) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/view/discount-rules/popup/category-rules.php?rev=3211131#L224) |  |
  | 224 | 224 | <div class="d-flex gap-2 justify-content-between"> |
  | 225 | 225 | <h6 id="discount\_value" class="mb-0 elex-dynamic-input-label"><?php esc\_html\_e('Discount Percent', 'eh-dynamic-pricing-discounts'); ?><span class="text-danger">\*</span> </h6> |
  | 226 |  | <i id="discount\_desc" class="desc-tip fa-regular fa-circle-question" data-tip='<?php echo esc\_attr\_\_('If you select `Percentage Discount`, the given percentage (value) would be discounted on each unit of the product in the cart. |
  |  | 226 | <i id="discount\_desc" class="desc-tip fa-regular fa-circle-question" data-tip=' |
  |  | 227 | <?php |
  |  | 228 | echo esc\_attr\_\_('If you select `Percentage Discount`, the given percentage (value) would be discounted on each unit of the product in the cart. |
  | 227 | 229 | If you select `Flat Discount`, the given amount (value) would be discounted at subtotal level in the cart. |
  | 228 | 230 | If you select `Fixed Price`, the original price of the product is replaced by the given fixed price (value). |
  | 229 |  | If you select `Coupon dicount`, the original price of the cart total is discounted with the selected coupon offer (value).'); ?>'></i> |
  |  | 231 | If you select `Coupon dicount`, the original price of the cart total is discounted with the selected coupon offer (value).'); |
  |  | 232 | ?> |
  |  | 233 | '></i> |
  | 230 | 234 | </div> |
  | 231 | 235 | </div> |
* ## [elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/view/discount-rules/popup/product-rules.php](/changeset/3211131/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/view/discount-rules/popup/product-rules.php "Show the changeset 3211131 restricted to elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/view/discount-rules/popup/product-rules.php")

  | [r3049195](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/popup/product-rules.php?rev=3049195#L238 "Show revision 3049195 of this file in browser") | [r3211131](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/view/discount-rules/popup/product-rules.php?rev=3211131#L238 "Show revision 3211131 of this file in browser") |  |
  | --- | --- | --- |
  | 238 | 238 | <div class="col-md-8"> |
  | 239 | 239 | <select name="check\_on" id="check\_on" class="form-select min-width-100"> |
  | 240 |  | <option value="Quantity" <?php selected(!empty($\_REQUEST['check\_on']) && (~~$\_REQUEST['check\_on'] == 'Quantity'~~)); ?>><?php esc\_html\_e('No. of items', 'eh-dynamic-pricing-discounts'); ?></option> |
  | 241 |  | <option value="Weight" <?php selected(!empty($\_REQUEST['check\_on']) && (~~$\_REQUEST['check\_on'] == 'Weight'~~)); ?>><?php esc\_html\_e('Weight', 'eh-dynamic-pricing-discounts'); ?></option> |
  | 242 |  | <option value="Price" <?php selected(!empty($\_REQUEST['check\_on']) && (~~$\_REQUEST['check\_on'] == 'Price'~~)); ?>><?php esc\_html\_e('Price', 'eh-dynamic-pricing-discounts'); ?></option> |
  | 243 |  | <option value="Units" <?php selected(!empty($\_REQUEST['check\_on']) && (~~$\_REQUEST['check\_on'] == 'Units'~~)); ?>><?php esc\_html\_e('No. of Units', 'eh-dynamic-pricing-discounts'); ?></option> |
  |  | 240 | <option value="Quantity" <?php selected(!empty($\_REQUEST['check\_on']) && ( $\_REQUEST['check\_on'] == 'Quantity' )); ?>><?php esc\_html\_e('No. of items', 'eh-dynamic-pricing-discounts'); ?></option> |
  |  | 241 | <option value="Weight" <?php selected(!empty($\_REQUEST['check\_on']) && ( $\_REQUEST['check\_on'] == 'Weight' )); ?>><?php esc\_html\_e('Weight', 'eh-dynamic-pricing-discounts'); ?></option> |
  |  | 242 | <option value="Price" <?php selected(!empty($\_REQUEST['check\_on']) && ( $\_REQUEST['check\_on'] == 'Price' )); ?>><?php esc\_html\_e('Price', 'eh-dynamic-pricing-discounts'); ?></option> |
  |  | 243 | <option value="Units" <?php selected(!empty($\_REQUEST['check\_on']) && ( $\_REQUEST['check\_on'] == 'Units' )); ?>><?php esc\_html\_e('No. of Units', 'eh-dynamic-pricing-discounts'); ?></option> |
  | 244 | 244 | </select> |
  | 245 | 245 | </div> |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/popup/product-rules.php?rev=3049195#L288) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/view/discount-rules/popup/product-rules.php?rev=3211131#L288) |  |
  | 288 | 288 | <select name="discount\_type" id="discount\_type" |
  | 289 | 289 | class="form-select min-width-100 elex-dynamic-pricing-discount-type-select"> |
  | 290 |  | <option value="Percent Discount" <?php selected(!empty($\_REQUEST['discount\_type']) && (~~$\_REQUEST['discount\_type'] == 'Percent Discount'~~)); ?>><?php esc\_html\_e('Percent Discount', 'eh-dynamic-pricing-discounts'); ?></option> |
  | 291 |  | <option value="Flat Discount" <?php selected(!empty($\_REQUEST['discount\_type']) && (~~$\_REQUEST['discount\_type'] == 'Flat Discount'~~)); ?>><?php esc\_html\_e('Flat Discount', 'eh-dynamic-pricing-discounts'); ?></option> |
  | 292 |  | <option value="Fixed Price" <?php selected(!empty($\_REQUEST['discount\_type']) && (~~$\_REQUEST['discount\_type'] == 'Fixed Price'~~)); ?>><?php esc\_html\_e('Fixed Price', 'eh-dynamic-pricing-discounts'); ?></option> |
  |  | 290 | <option value="Percent Discount" <?php selected(!empty($\_REQUEST['discount\_type']) && ( $\_REQUEST['discount\_type'] == 'Percent Discount' )); ?>><?php esc\_html\_e('Percent Discount', 'eh-dynamic-pricing-discounts'); ?></option> |
  |  | 291 | <option value="Flat Discount" <?php selected(!empty($\_REQUEST['discount\_type']) && ( $\_REQUEST['discount\_type'] == 'Flat Discount' )); ?>><?php esc\_html\_e('Flat Discount', 'eh-dynamic-pricing-discounts'); ?></option> |
  |  | 292 | <option value="Fixed Price" <?php selected(!empty($\_REQUEST['discount\_type']) && ( $\_REQUEST['discount\_type'] == 'Fixed Price' )); ?>><?php esc\_html\_e('Fixed Price', 'eh-dynamic-pricing-discounts'); ?></option> |
  | 293 | 293 | <option value="Coupon Discount" disabled><?php esc\_html\_e('Coupon Discount', 'eh-dynamic-pricing-discounts'); ?> |
  | 294 | 294 | <sup class="elex\_dp\_go\_premium\_color"><?php esc\_html\_e('[Premium]', 'eh-dynamic-pricing-discounts'); ?></sup></option> |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/popup/product-rules.php?rev=3049195#L301) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/view/discount-rules/popup/product-rules.php?rev=3211131#L301) |  |
  | 301 | 301 | <div class="d-flex gap-2 justify-content-between"> |
  | 302 | 302 | <h6 id="discount\_value" class="mb-0 elex-dynamic-input-label"><?php esc\_html\_e('Discount Percent', 'eh-dynamic-pricing-discounts'); ?><span class="text-danger">\*</span> </h6> |
  | 303 |  | <i id="discount\_desc" class="desc-tip fa-regular fa-circle-question" data-tip='<?php echo esc\_attr\_\_('If you select `Percentage Discount`, the given percentage (value) would be discounted on each unit of the product in the cart. |
  |  | 303 | <i id="discount\_desc" class="desc-tip fa-regular fa-circle-question" data-tip=' |
  |  | 304 | <?php |
  |  | 305 | echo esc\_attr\_\_('If you select `Percentage Discount`, the given percentage (value) would be discounted on each unit of the product in the cart. |
  | 304 | 306 | If you select `Flat Discount`, the given amount (value) would be discounted at subtotal level in the cart. |
  | 305 | 307 | If you select `Fixed Price`, the original price of the product is replaced by the given fixed price (value). |
  | 306 |  | If you select `Coupon dicount`, the original price of the cart total is discounted with the selected coupon offer (value).'); ?>'></i> |
  |  | 308 | If you select `Coupon dicount`, the original price of the cart total is discounted with the selected coupon offer (value).'); |
  |  | 309 | ?> |
  |  | 310 | '></i> |
  | 307 | 311 | </div> |
  | 308 | 312 | </div> |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/popup/product-rules.php?rev=3049195#L409) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/view/discount-rules/popup/product-rules.php?rev=3211131#L413) |  |
  | 409 | 413 | foreach ($roles as $key=>$val) { |
  | 410 | 414 | $is\_selected =in\_array($key, $selected)?' selected ':' '; |
  | 411 |  | echo "<option value='$key' " . esc\_attr($is\_selected). " >$val</option>"; |
  |  | 415 | echo "<option value='$key' " . esc\_attr($is\_selected) . " >$val</option>"; |
  | 412 | 416 | } |
  | 413 | 417 | ?> |
* ## [elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/view/help-support/faqs.php](/changeset/3211131/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/view/help-support/faqs.php "Show the changeset 3211131 restricted to elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/view/help-support/faqs.php")

  | [r3049195](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/help-support/faqs.php?rev=3049195#L5 "Show revision 3049195 of this file in browser") | [r3211131](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/view/help-support/faqs.php?rev=3211131#L5 "Show revision 3211131 of this file in browser") |  |
  | --- | --- | --- |
  | 5 | 5 |  |
  | 6 | 6 | $faqs = array( |
  | 7 |  | ~~array(~~ |
  | 8 |  | ~~'question' => esc\_html\_\_('Can the BOGO rule apply percentage discounts on the second product?', 'eh-dynamic-pricing-discounts'),~~ |
  | 9 |  | ~~'answer'   => esc\_html\_\_('Currently, the plugin only allows you to keep the second product as a free product. However, our team has explored the feasibility of giving a percentage discount on it, and this feature will be available in the upcoming version.', 'eh-dynamic-pricing-discounts'),~~ |
  | 10 |  | ~~),~~ |
  | 11 |  | ~~array(~~ |
  | 12 |  | ~~'question' => esc\_html\_\_('How can I apply coupon codes for the discount rules?', 'eh-dynamic-pricing-discounts'),~~ |
  | 13 |  | ~~'answer'   => esc\_html\_\_('While creating a rule, you can apply a coupon discount by selecting "Coupon Discount" as the discount type. Then, you can either create a dynamic coupon or associate an existing WooCommerce coupon with the rule from the "Associate Coupon & Roles" section.', 'eh-dynamic-pricing-discounts'),~~ |
  | 14 |  | ~~),~~ |
  | 15 |  | ~~array(~~ |
  | 16 |  | ~~'question' => esc\_html\_\_('Can I offer the cheapest product in the cart as a free product to the customer?', 'eh-dynamic-pricing-discounts'),~~ |
  | 17 |  | ~~'answer'   => esc\_html\_\_('Yes, you can offer the cheapest product in the cart as a free product. To do this, you need to create a BOGO rule and select "The Cheapest product in the Cart" under the free products section.', 'eh-dynamic-pricing-discounts'),~~ |
  | 18 |  | ~~),~~ |
  | 19 | 7 | array( |
  | 20 |  | ~~'question' => esc\_html\_\_('What does the "504 Timeout error" on the shop page mean~~?', 'eh-dynamic-pricing-discounts'), |
  | 21 |  | ~~'answer'   => esc\_html\_\_('When a website has a large number of products and multiple rules created with the plugin, the scanning of all the products during page loading can lead to performance issues and cause a 504 error to occur~~.', 'eh-dynamic-pricing-discounts'), |
  | 22 |  | ), |
  |  | 8 | 'question' => esc\_html\_\_('Can the BOGO rule apply percentage discounts on the second product?', 'eh-dynamic-pricing-discounts'), |
  |  | 9 | 'answer'   => esc\_html\_\_('Currently, the plugin only allows you to keep the second product as a free product. However, our team has explored the feasibility of giving a percentage discount on it, and this feature will be available in the upcoming version.', 'eh-dynamic-pricing-discounts'), |
  |  | 10 | ), |
  | 23 | 11 | array( |
  | 24 |  | ~~'question' => esc\_html\_\_('If the BOGO rule is satisfied, does it automatically add the free product to the cart~~?', 'eh-dynamic-pricing-discounts'), |
  | 25 |  | ~~'answer'   => esc\_html\_\_('Yes, the plugin automatically adds the free product to the cart page if the rule is satisfied~~.', 'eh-dynamic-pricing-discounts'), |
  | 26 |  | ), |
  |  | 12 | 'question' => esc\_html\_\_('How can I apply coupon codes for the discount rules?', 'eh-dynamic-pricing-discounts'), |
  |  | 13 | 'answer'   => esc\_html\_\_('While creating a rule, you can apply a coupon discount by selecting "Coupon Discount" as the discount type. Then, you can either create a dynamic coupon or associate an existing WooCommerce coupon with the rule from the "Associate Coupon & Roles" section.', 'eh-dynamic-pricing-discounts'), |
  |  | 14 | ), |
  | 27 | 15 | array( |
  | 28 |  | ~~'question' => esc\_html\_\_('What is the difference between a product rule and a cart rule~~?', 'eh-dynamic-pricing-discounts'), |
  | 29 |  | ~~'answer'   => esc\_html\_\_('In a product rule, you can select and apply discounts to the specific product(s) in your store. On the other hand, a cart rule allows you to give a discount for the products that are added to the cart~~.', 'eh-dynamic-pricing-discounts'), |
  | 30 |  | ), |
  |  | 16 | 'question' => esc\_html\_\_('Can I offer the cheapest product in the cart as a free product to the customer?', 'eh-dynamic-pricing-discounts'), |
  |  | 17 | 'answer'   => esc\_html\_\_('Yes, you can offer the cheapest product in the cart as a free product. To do this, you need to create a BOGO rule and select "The Cheapest product in the Cart" under the free products section.', 'eh-dynamic-pricing-discounts'), |
  |  | 18 | ), |
  | 31 | 19 | array( |
  | 32 |  | 'question' => esc\_html\_\_('How can I customize the pricing table?', 'eh-dynamic-pricing-discounts'), |
  | 33 |  | 'answer'   => esc\_html\_\_('You can customize the pricing table by configuring it in the "Settings" > "Other Options" > "Pricing Table" section.', 'eh-dynamic-pricing-discounts'), |
  | 34 |  | ), |
  |  | 20 | 'question' => esc\_html\_\_('What does the "504 Timeout error" on the shop page mean?', 'eh-dynamic-pricing-discounts'), |
  |  | 21 | 'answer'   => esc\_html\_\_('When a website has a large number of products and multiple rules created with the plugin, the scanning of all the products during page loading can lead to performance issues and cause a 504 error to occur.', 'eh-dynamic-pricing-discounts'), |
  |  | 22 | ), |
  |  | 23 | array( |
  |  | 24 | 'question' => esc\_html\_\_('If the BOGO rule is satisfied, does it automatically add the free product to the cart?', 'eh-dynamic-pricing-discounts'), |
  |  | 25 | 'answer'   => esc\_html\_\_('Yes, the plugin automatically adds the free product to the cart page if the rule is satisfied.', 'eh-dynamic-pricing-discounts'), |
  |  | 26 | ), |
  |  | 27 | array( |
  |  | 28 | 'question' => esc\_html\_\_('What is the difference between a product rule and a cart rule?', 'eh-dynamic-pricing-discounts'), |
  |  | 29 | 'answer'   => esc\_html\_\_('In a product rule, you can select and apply discounts to the specific product(s) in your store. On the other hand, a cart rule allows you to give a discount for the products that are added to the cart.', 'eh-dynamic-pricing-discounts'), |
  |  | 30 | ), |
  |  | 31 | array( |
  |  | 32 | 'question' => esc\_html\_\_('How can I customize the pricing table?', 'eh-dynamic-pricing-discounts'), |
  |  | 33 | 'answer'   => esc\_html\_\_('You can customize the pricing table by configuring it in the "Settings" > "Other Options" > "Pricing Table" section.', 'eh-dynamic-pricing-discounts'), |
  |  | 34 | ), |
  | 35 | 35 | ); |
  | 36 | 36 | ?> |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/help-support/faqs.php?rev=3049195#L44) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/view/help-support/faqs.php?rev=3211131#L44) |  |
  | 44 | 44 | data-bs-target="#flush-collapse<?php echo esc\_attr($index + 1); ?>" |
  | 45 | 45 | aria-expanded="false" aria-controls="flush-collapse<?php echo esc\_attr($index + 1); ?>"> |
  | 46 |  | <div><?php echo esc\_html\_\_('Q', 'eh-dynamic-pricing-discounts') . (~~$index + 1~~) . '.'; ?></div> |
  |  | 46 | <div><?php echo esc\_html\_\_('Q', 'eh-dynamic-pricing-discounts') . ( $index + 1 ) . '.'; ?></div> |
  | 47 | 47 | <div><?php echo esc\_html($faq['question']); ?></div> |
  | 48 | 48 | </button> |
* ## [elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/view/help-support/ticket.php](/changeset/3211131/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/view/help-support/ticket.php "Show the changeset 3211131 restricted to elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/view/help-support/ticket.php")

  | [r3049195](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/help-support/ticket.php?rev=3049195#L7 "Show revision 3049195 of this file in browser") | [r3211131](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/view/help-support/ticket.php?rev=3211131#L7 "Show revision 3211131 of this file in browser") |  |
  | --- | --- | --- |
  | 7 | 7 | <div class="p-1 fw-bold"> |
  | 8 | 8 | <p><?php esc\_html\_e('Before raising the ticket, we recommend you to go through our', 'eh-dynamic-pricing-discounts'); ?> |
  | 9 |  | <a href="<?php echo esc\_url('https://elextensions.com/knowledge-base/set-up-elex-dynamic-pricing-and-discounts-plugin-for-woocommerce/'); ?>" target="\_blank"><?php esc\_html\_e('detailed documentation.', 'eh-dynamic-pricing-discounts'); ?></a></p> |
  |  | 9 | <a href="<?php echo esc\_url('https://elextensions.com/knowledge-base/set-up-elex-dynamic-pricing-and-discounts-plugin-for-woocommerce/'); ?>" target="\_blank"><?php esc\_html\_e('detailed documentation.', 'eh-dynamic-pricing-discounts'); ?></a></p> |
  | 10 | 10 | <p><?php esc\_html\_e('Or', 'eh-dynamic-pricing-discounts'); ?></p> |
  | 11 | 11 | <p class="mb-0"><?php esc\_html\_e('To get in touch with our helpdesk representative. Just raise a support ticket on our website.', 'eh-dynamic-pricing-discounts'); ?></p> |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/help-support/ticket.php?rev=3049195#L38) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/view/help-support/ticket.php?rev=3211131#L38) |  |
  | 38 | 38 | <script> |
  | 39 | 39 | jQuery(document).ready(function() { |
  | 40 |  |  |
  |  | 40 |  |
  | 41 | 41 | if (hasURLKey('downloadfailure')) { |
  | 42 | 42 | showSuccessNotification('downloadfailure'); |
* ## [elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/view/market.php](/changeset/3211131/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/view/market.php "Show the changeset 3211131 restricted to elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/view/market.php")

  | [r3049195](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/market.php?rev=3049195#L16 "Show revision 3049195 of this file in browser") | [r3211131](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/view/market.php?rev=3211131#L16 "Show revision 3211131 of this file in browser") |  |
  | --- | --- | --- |
  | 16 | 16 | <div class="row"> |
  | 17 | 17 | <div class=" elex-license-like-img-container col-md-5"> |
  | 18 |  | <?php $dp\_premium\_url = ~~"https://elextensions.com/plugin/dynamic-pricing-and-discounts-plugin-for-woocommerce/?utm\_source=plugin-settings-related&utm\_medium=wp-admin&utm\_campaign=in-prod-ads"~~ ?> |
  |  | 18 | <?php $dp\_premium\_url = 'https://elextensions.com/plugin/dynamic-pricing-and-discounts-plugin-for-woocommerce/?utm\_source=plugin-settings-related&utm\_medium=wp-admin&utm\_campaign=in-prod-ads'; ?> |
  | 19 | 19 | <a target="\_blank" href="<?php echo esc\_url($dp\_premium\_url); ?>"> |
  | 20 | 20 | <img src="<?php echo esc\_url(ELEX\_DP\_CRM\_MAIN\_URL . '/img/dynamic\_pricing.png'); ?>" class="marketing\_logos" alt="<?php esc\_attr\_e('Dynamic Pricing Logo', 'eh-dynamic-pricing-discounts'); ?>"> |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/market.php?rev=3049195#L38) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/view/market.php?rev=3211131#L38) |  |
  | 38 | 38 | </p> |
  | 39 | 39 | </ul> |
  | 40 |  | <?php $dp\_documentation\_url = ~~"https://elextensions.com/knowledge-base/set-up-elex-dynamic-pricing-and-discounts-plugin-for-woocommerce/"~~ ?> |
  |  | 40 | <?php $dp\_documentation\_url = 'https://elextensions.com/knowledge-base/set-up-elex-dynamic-pricing-and-discounts-plugin-for-woocommerce/'; ?> |
  | 41 | 41 | <center> <a href="<?php echo esc\_url($dp\_documentation\_url); ?>" target="\_blank" class="button button-primary"><?php esc\_html\_e('Documentation', 'eh-dynamic-pricing-discounts'); ?></a></center> |
  | 42 | 42 | </div> |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/market.php?rev=3049195#L48) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/view/market.php?rev=3211131#L48) |  |
  | 48 | 48 | <h6 class="mb-4"><b><?php esc\_html\_e('You May Also like', 'eh-dynamic-pricing-discounts'); ?></b></h6> |
  | 49 | 49 | <div class="row"> |
  | 50 |  | <?php $plugins = array( |
  |  | 50 | <?php |
  |  | 51 | $plugins = array( |
  | 51 | 52 | array( |
  | 52 | 53 | 'url'   => 'https://elextensions.com/plugin/woocommerce-catalog-mode-wholesale-role-based-pricing/?utm\_source=plugin-settings-related&utm\_medium=wp-admin&utm\_campaign=in-prod-ads', |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/market.php?rev=3049195#L71) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/view/market.php?rev=3211131#L72) |  |
  | 71 | 72 | ); |
  | 72 | 73 |  |
  | 73 |  | foreach ($plugins as $plugin) : ?> |
  |  | 74 | foreach ($plugins as $plugin) : |
  |  | 75 | ?> |
  | 74 | 76 | <div class="col-md-3 col-6"> |
  | 75 | 77 | <div class="elex-license-like-img-container w-100  mb-3"> |
* ## [elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/view/settings/rules-execution-order.php](/changeset/3211131/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/view/settings/rules-execution-order.php "Show the changeset 3211131 restricted to elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/view/settings/rules-execution-order.php")

  | [r3049195](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/settings/rules-execution-order.php?rev=3049195#L33 "Show revision 3049195 of this file in browser") | [r3211131](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/view/settings/rules-execution-order.php?rev=3211131#L33 "Show revision 3211131 of this file in browser") |  |
  | --- | --- | --- |
  | 33 | 33 | </th> |
  | 34 | 34 | <td class="text-start fw-bold"> |
  | 35 |  | <?php if($key == 'product\_rules' || $key == 'category\_rules'){ |
  |  | 35 | <?php |
  |  | 36 | if ($key == 'product\_rules' || $key == 'category\_rules') { |
  | 36 | 37 | echo esc\_html($rules\_modes[$key]); |
  | 37 |  | }else{ |
  | 38 |  | echo esc\_html($rules\_modes[$key]);?> |
  | 39 |  | <sup class="elex\_dp\_go\_premium\_color"><?php esc\_html\_e('[Premium]', 'eh-dynamic-pricing-discounts'); ?></sup><?php |
  |  | 38 | } else { |
  |  | 39 | echo esc\_html($rules\_modes[$key]); |
  |  | 40 | ?> |
  |  | 41 | <sup class="elex\_dp\_go\_premium\_color"><?php esc\_html\_e('[Premium]', 'eh-dynamic-pricing-discounts'); ?></sup> |
  |  | 42 | <?php |
  | 40 | 43 |  |
  | 41 |  | } |
  |  | 44 | } |
  | 42 | 45 | ?> |
  | 43 | 46 | </td> |
  | 44 | 47 | <td> |
  | 45 | 48 | <label class="elex-switch-btn"> |
  | 46 |  | <?php if~~($key == 'product\_rules' || $key == 'category\_rules')~~{ ?> |
  |  | 49 | <?php if ($key == 'product\_rules' || $key == 'category\_rules') { ?> |
  | 47 | 50 | <input type="checkbox" name='enabled\_modes[<?php echo esc\_attr($key); ?>]' value='<?php echo esc\_attr($key); ?>' <?php echo in\_array($key, $execution\_order) ? 'checked' : ''; ?>> |
  | 48 | 51 | <div class="elex-switch-icon round"></div> |
  | 49 |  | <?php }~~else~~{ ?> |
  |  | 52 | <?php } else { ?> |
  | 50 | 53 | <div class="elex-switch-icon round"></div> |
  | 51 | 54 | <?php |
  | 52 | 55 |  |
  | 53 | 56 | } |
  | 54 |  | ?> |
  |  | 57 | ?> |
  | 55 | 58 | </label> |
  | 56 | 59 | </td> |
* ## [elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/elex-dynamic-pricing-and-discounts-for-woocommerce-basic-version.php](/changeset/3211131/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/elex-dynamic-pricing-and-discounts-for-woocommerce-basic-version.php "Show the changeset 3211131 restricted to elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/elex-dynamic-pricing-and-discounts-for-woocommerce-basic-version.php")

  | [r3189520](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/elex-dynamic-pricing-and-discounts-for-woocommerce-basic-version.php?rev=3189520#L4 "Show revision 3189520 of this file in browser") | [r3211131](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/elex-dynamic-pricing-and-discounts-for-woocommerce-basic-version.php?rev=3211131#L4 "Show revision 3211131 of this file in browser") |  |
  | --- | --- | --- |
  | 4 | 4 | \*   Plugin URI: https://elextensions.com/plugin/elex-dynamic-pricing-and-discounts-plugin-for-woocommerce-free-version/ |
  | 5 | 5 | \*   Description: This plugin helps you to set discounts and pricing dynamically based on minimum quantity,weight,price and allow you to set maximum allowed discounts on every rule. |
  | 6 |  | \*   Version: 2.1.~~7~~ |
  |  | 6 | \*   Version: 2.1.8 |
  | 7 | 7 | \*   Author: ELEXtensions |
  | 8 | 8 | \*   WC requires at least: 3.0.0 |
  | 9 |  | \*   WC tested up to: 9.~~4~~ |
  |  | 9 | \*   WC tested up to: 9.5 |
  | 10 | 10 | \*   Author URI: https://elextensions.com |
  | 11 | 11 | \*   Copyright: 2018 ELEX. |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/elex-dynamic-pricing-and-discounts-for-woocommerce-basic-version.php?rev=3189520#L182) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/elex-dynamic-pricing-and-discounts-for-woocommerce-basic-version.php?rev=3211131#L182) |  |
  | 182 | 182 |  |
  | 183 | 183 | $rules\_indexing\_status   = get\_option('xa\_dp\_rules\_indexing\_status'); |
  | 184 |  | if~~(!isset($rules\_indexing\_status) || $rules\_indexing\_status == false)~~{ |
  |  | 184 | if (!isset($rules\_indexing\_status) || $rules\_indexing\_status == false) { |
  | 185 | 185 | require\_once plugin\_dir\_path(\_\_FILE\_\_) . 'includes/elex-dynamic-pricing-plugin-activator.php'; |
  | 186 | 186 | Elex\_dynamic\_pricing\_plugin\_Activator::activate(); |
* ## [elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/includes/elex-common-functions.php](/changeset/3211131/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/includes/elex-common-functions.php "Show the changeset 3211131 restricted to elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/includes/elex-common-functions.php")

  | [r3004919](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/includes/elex-common-functions.php?rev=3004919#L394 "Show revision 3004919 of this file in browser") | [r3211131](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/includes/elex-common-functions.php?rev=3211131#L394 "Show revision 3211131 of this file in browser") |  |
  | --- | --- | --- |
  | 394 | 394 | $parent\_id =$product->get\_parent\_id(); |
  | 395 | 395 | $parent\_tags = get\_the\_terms($parent\_id, 'product\_tag'); |
  | 396 |  | if~~($parent\_tags)~~{ |
  |  | 396 | if ($parent\_tags) { |
  | 397 | 397 | foreach ($parent\_tags as $key => $parent\_tag) { |
  | 398 | 398 | array\_push($tags\_ids\_array, $parent\_tag->term\_id); |
* ## [elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/includes/elex-dynamic-pricing-plugin-activator.php](/changeset/3211131/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/includes/elex-dynamic-pricing-plugin-activator.php "Show the changeset 3211131 restricted to elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/includes/elex-dynamic-pricing-plugin-activator.php")

  | [r3004919](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/includes/elex-dynamic-pricing-plugin-activator.php?rev=3004919#L35 "Show revision 3004919 of this file in browser") | [r3211131](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/includes/elex-dynamic-pricing-plugin-activator.php?rev=3211131#L35 "Show revision 3211131 of this file in browser") |  |
  | --- | --- | --- |
  | 35 | 35 | $dummy\_option = array('product\_rules' => array(), 'combinational\_rules' => array(), 'cat\_combinational\_rules' => array(), 'category\_rules' => array(), 'cart\_rules' => array(), 'buy\_get\_free\_rules' => array() ,'BOGO\_category\_rules'=>array(), 'bogo\_tag\_rules' =>array(), 'tag\_rules' => array()); |
  | 36 | 36 | $prev\_rules   = get\_option('xa\_dp\_rules', $dummy\_option); |
  | 37 |  | foreach~~($prev\_rules as $rule\_type => $rules)~~{ |
  |  | 37 | foreach ($prev\_rules as $rule\_type => $rules) { |
  | 38 | 38 | $reordered\_rules = []; |
  | 39 | 39 | $i = 1; |
  | 40 |  | if($rules) { |
  | 41 |  | foreach($rules as $rule) { |
  |  | 40 | if ($rules) { |
  |  | 41 | foreach ($rules as $rule) { |
  | 42 | 42 | $reordered\_rules[$i] = $rule; |
  | 43 | 43 | $i++; |
* ## [elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/includes/wf\_api\_manager/class-wc-am-plugin-activate.php](/changeset/3211131/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/includes/wf_api_manager/class-wc-am-plugin-activate.php "Show the changeset 3211131 restricted to elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/includes/wf_api_manager/class-wc-am-plugin-activate.php")

  | [r2965037](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/includes/wf_api_manager/class-wc-am-plugin-activate.php?rev=2965037#L12 "Show revision 2965037 of this file in browser") | [r3211131](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/includes/wf_api_manager/class-wc-am-plugin-activate.php?rev=3211131#L12 "Show revision 3211131 of this file in browser") |  |
  | --- | --- | --- |
  | 12 | 12 | class WF\_Software\_Activate { |
  | 13 | 13 | private $is\_ajax; |
  | 14 |  | private $upgrade\_url; |
  | 15 |  | private $plugin\_name; |
  | 16 |  | private $product\_id; |
  | 17 |  | private $api\_key; |
  | 18 |  | private $activation\_unique\_product\_id; |
  | 19 |  | private $renew\_license\_url; |
  | 20 |  | private $instance; |
  | 21 |  | private $domain; |
  | 22 |  | private $software\_version; |
  | 23 |  | private $wf\_unique\_product\_id\_key; |
  | 24 |  | private $wf\_api\_licence\_key; |
  | 25 |  | private $wf\_instance\_key; |
  |  | 14 | private $upgrade\_url; |
  |  | 15 | private $plugin\_name; |
  |  | 16 | private $product\_id; |
  |  | 17 | private $api\_key; |
  |  | 18 | private $activation\_unique\_product\_id; |
  |  | 19 | private $renew\_license\_url; |
  |  | 20 | private $instance; |
  |  | 21 | private $domain; |
  |  | 22 | private $software\_version; |
  |  | 23 | private $wf\_unique\_product\_id\_key; |
  |  | 24 | private $wf\_api\_licence\_key; |
  |  | 25 | private $wf\_instance\_key; |
  | 26 | 26 | public function \_\_construct( $upgrade\_url, $plugin\_name, $product\_id, $api\_key, $activation\_unique\_product\_id, $renew\_license\_url, $instance, $domain, $software\_version, $plugin\_or\_theme, $text\_domain, $extra, $wf\_unique\_product\_id\_key, $wf\_api\_licence\_key, $wf\_instance\_key ) { |
  | 27 | 27 | // API data |
* ## [elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/includes/wf\_api\_manager/wf\_api\_manager.php](/changeset/3211131/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/includes/wf_api_manager/wf_api_manager.php "Show the changeset 3211131 restricted to elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/includes/wf_api_manager/wf_api_manager.php")

  | [r2965037](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/includes/wf_api_manager/wf_api_manager.php?rev=2965037#L16 "Show revision 2965037 of this file in browser") | [r3211131](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/includes/wf_api_manager/wf_api_manager.php?rev=3211131#L16 "Show revision 3211131 of this file in browser") |  |
  | --- | --- | --- |
  | 16 | 16 | class WF\_API\_Manager { |
  | 17 | 17 | private $is\_ajax; |
  | 18 |  | private $upgrade\_url; |
  | 19 |  | private $plugin\_name; |
  | 20 |  | private $product\_id; |
  | 21 |  | private $api\_key; |
  | 22 |  | private $activation\_unique\_product\_id; |
  | 23 |  | private $renew\_license\_url; |
  | 24 |  | private $instance; |
  | 25 |  | private $domain; |
  | 26 |  | private $software\_version; |
  | 27 |  | private $wf\_unique\_product\_id\_key; |
  | 28 |  | private $wf\_api\_licence\_key; |
  | 29 |  | private $wf\_instance\_key; |
  | 30 |  | private $plugin\_settings\_url; |
  | 31 |  | private $plugin\_or\_theme; |
  | 32 |  | private $text\_domain; |
  | 33 |  | private $extra; |
  |  | 18 | private $upgrade\_url; |
  |  | 19 | private $plugin\_name; |
  |  | 20 | private $product\_id; |
  |  | 21 | private $api\_key; |
  |  | 22 | private $activation\_unique\_product\_id; |
  |  | 23 | private $renew\_license\_url; |
  |  | 24 | private $instance; |
  |  | 25 | private $domain; |
  |  | 26 | private $software\_version; |
  |  | 27 | private $wf\_unique\_product\_id\_key; |
  |  | 28 | private $wf\_api\_licence\_key; |
  |  | 29 | private $wf\_instance\_key; |
  |  | 30 | private $plugin\_settings\_url; |
  |  | 31 | private $plugin\_or\_theme; |
  |  | 32 | private $text\_domain; |
  |  | 33 | private $extra; |
  | 34 | 34 |  |
  | 35 | 35 | public function \_\_construct( $product\_id, $plugin\_version, $plugin\_slug, $server\_url, $plugin\_settings\_url = '' ) { |
* ## [elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-dynamic-pricing-plugin-public.php](/changeset/3211131/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-dynamic-pricing-plugin-public.php "Show the changeset 3211131 restricted to elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-dynamic-pricing-plugin-public.php")

  | [r3030019](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-dynamic-pricing-plugin-public.php?rev=3030019#L10 "Show revision 3030019 of this file in browser") | [r3211131](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-dynamic-pricing-plugin-public.php?rev=3211131#L10 "Show revision 3211131 of this file in browser") |  |
  | --- | --- | --- |
  | 10 | 10 | $GLOBALS['elex\_dp\_settings'] = get\_option('xa\_dynamic\_pricing\_setting'); |
  | 11 | 11 | add\_action('wp\_footer', 'elex\_dp\_print\_scripts\_payment\_gateway', 5); |
  | 12 |  | function elex\_dp\_print\_scripts\_payment\_gateway() |
  | 13 |  | { |
  | 14 |  | ?> |
  |  | 12 | function elex\_dp\_print\_scripts\_payment\_gateway() { |
  |  | 13 | ?> |
  | 15 | 14 | <script> |
  | 16 | 15 | jQuery(function($) { |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-dynamic-pricing-plugin-public.php?rev=3030019#L30) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-dynamic-pricing-plugin-public.php?rev=3211131#L29) |  |
  | 30 | 29 | <?php |
  | 31 | 30 | } |
  | 32 |  | function elex\_dp\_init\_calculator() |
  | 33 |  | { |
  |  | 31 | function elex\_dp\_init\_calculator() { |
  | 34 | 32 | $xa\_dp\_rules = get\_option('xa\_dp\_rules', array()); |
  | 35 | 33 | if (isset($GLOBALS['elex\_dp\_settings']) && empty($GLOBALS['elex\_dp\_settings']) || empty($xa\_dp\_rules)) { |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-dynamic-pricing-plugin-public.php?rev=3030019#L46) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-dynamic-pricing-plugin-public.php?rev=3211131#L44) |  |
  | 46 | 44 | add\_action('woocommerce\_before\_calculate\_totals', 'elex\_dp\_update\_globals'); |
  | 47 | 45 |  |
  | 48 |  |  |
  | 49 |  | function elex\_dp\_update\_globals($cart) |
  | 50 |  | { |
  |  | 46 | add\_action('woocommerce\_before\_cart\_totals', 'elex\_dp\_update\_cart\_total'); |
  |  | 47 |  |
  |  | 48 | function elex\_dp\_update\_cart\_total() { |
  |  | 49 | global $woocommerce; |
  |  | 50 | if ($woocommerce->cart) { |
  |  | 51 | $woocommerce->cart->calculate\_totals(); |
  |  | 52 | } |
  |  | 53 | } |
  |  | 54 |  |
  |  | 55 | function elex\_dp\_update\_globals( $cart) { |
  | 51 | 56 | if (isset($\_REQUEST['debugcart'])) { |
  | 52 | 57 | echo '<pre>'; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-dynamic-pricing-plugin-public.php?rev=3030019#L101) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-dynamic-pricing-plugin-public.php?rev=3211131#L106) |  |
  | 101 | 106 | } |
  | 102 | 107 | foreach ($xa\_cart\_categories[$\_pid] as $\_cid) { |
  | 103 |  | $xa\_cart\_categories\_items[$\_cid] = isset($xa\_cart\_categories\_items[$\_cid]) ? (~~$xa\_cart\_categories\_items[$\_cid] + 1~~) : 1; |
  | 104 |  | $xa\_cart\_categories\_units[$\_cid] = isset($xa\_cart\_categories\_units[$\_cid]) ? (~~$xa\_cart\_categories\_units[$\_cid] + $\_qnty~~) : $\_qnty; |
  |  | 108 | $xa\_cart\_categories\_items[$\_cid] = isset($xa\_cart\_categories\_items[$\_cid]) ? ( $xa\_cart\_categories\_items[$\_cid] + 1 ) : 1; |
  |  | 109 | $xa\_cart\_categories\_units[$\_cid] = isset($xa\_cart\_categories\_units[$\_cid]) ? ( $xa\_cart\_categories\_units[$\_cid] + $\_qnty ) : $\_qnty; |
  | 105 | 110 | } |
  | 106 | 111 | foreach ($xa\_cart\_tags[$\_pid] as $\_tid) { |
  | 107 |  | $xa\_cart\_tags\_items[$\_tid] = isset($xa\_cart\_tags\_items[$\_tid]) ? (~~$xa\_cart\_tags\_items[$\_tid] + 1~~) : 1; |
  | 108 |  | $xa\_cart\_tags\_units[$\_tid] = isset($xa\_cart\_tags\_units[$\_tid]) ? (~~$xa\_cart\_tags\_units[$\_tid] + $\_qnty~~) : $\_qnty; |
  |  | 112 | $xa\_cart\_tags\_items[$\_tid] = isset($xa\_cart\_tags\_items[$\_tid]) ? ( $xa\_cart\_tags\_items[$\_tid] + 1 ) : 1; |
  |  | 113 | $xa\_cart\_tags\_units[$\_tid] = isset($xa\_cart\_tags\_units[$\_tid]) ? ( $xa\_cart\_tags\_units[$\_tid] + $\_qnty ) : $\_qnty; |
  | 109 | 114 | } |
  | 110 | 115 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-dynamic-pricing-plugin-public.php?rev=3030019#L121) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-dynamic-pricing-plugin-public.php?rev=3211131#L126) |  |
  | 121 | 126 | add\_filter('woocommerce\_product\_is\_on\_sale', 'elex\_dp\_product\_is\_on\_sale', 99, 2); |
  | 122 | 127 |  |
  | 123 |  | function elex\_dp\_product\_is\_on\_sale($on\_sale, $product) |
  | 124 |  | { |
  |  | 128 | function elex\_dp\_product\_is\_on\_sale( $on\_sale, $product) { |
  | 125 | 129 |  |
  | 126 | 130 | if ($product->is\_type('grouped') || $product->is\_type('variable')) { |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-dynamic-pricing-plugin-public.php?rev=3030019#L172) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-dynamic-pricing-plugin-public.php?rev=3211131#L176) |  |
  | 172 | 176 | } |
  | 173 | 177 |  |
  | 174 |  | function elex\_dp\_calculate\_and\_apply\_discount\_and\_add\_fee() |
  | 175 |  | { |
  |  | 178 | function elex\_dp\_calculate\_and\_apply\_discount\_and\_add\_fee() { |
  | 176 | 179 | global $xa\_common\_flat\_discount; |
  | 177 | 180 | global $woocommerce; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-dynamic-pricing-plugin-public.php?rev=3030019#L192) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-dynamic-pricing-plugin-public.php?rev=3211131#L195) |  |
  | 192 | 195 | add\_action($pricing\_table\_hook, 'elex\_dp\_show\_pricing\_table', 40); |
  | 193 | 196 |  |
  | 194 |  | function elex\_dp\_show\_pricing\_table() |
  | 195 |  | { |
  |  | 197 | function elex\_dp\_show\_pricing\_table() { |
  | 196 | 198 | $selected\_role = get\_option('elex\_dp\_allowed\_roles\_to\_show\_pricing\_table'); |
  | 197 | 199 | if (!empty($selected\_role)) { |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-dynamic-pricing-plugin-public.php?rev=3030019#L210) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-dynamic-pricing-plugin-public.php?rev=3211131#L212) |  |
  | 210 | 212 | add\_action($offer\_table\_hook, 'elex\_dp\_show\_offer\_table', 40); |
  | 211 | 213 |  |
  | 212 |  | function elex\_dp\_show\_offer\_table() |
  | 213 |  | { |
  |  | 214 | function elex\_dp\_show\_offer\_table() { |
  | 214 | 215 | $path = dirname(\_\_FILE\_\_) . '/elex-single-product-offer-table.php'; |
  | 215 | 216 | if (isset($GLOBALS['elex\_dp\_settings']['offer\_table\_on\_off']) && $GLOBALS['elex\_dp\_settings']['offer\_table\_on\_off'] == 'enable' && file\_exists($path) == true) { |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-dynamic-pricing-plugin-public.php?rev=3030019#L220) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-dynamic-pricing-plugin-public.php?rev=3211131#L221) |  |
  | 220 | 221 | add\_filter('woocommerce\_cart\_item\_price', 'elex\_dp\_show\_discount\_on\_line\_item', 100, 2); |
  | 221 | 222 |  |
  | 222 |  | function elex\_dp\_show\_discount\_on\_line\_item($price, $cart\_item) |
  | 223 |  | { |
  |  | 223 | function elex\_dp\_show\_discount\_on\_line\_item( $price, $cart\_item) { |
  | 224 | 224 | $prod  = $cart\_item['data']; |
  | 225 | 225 | $price = $prod->get\_price\_html(); |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-dynamic-pricing-plugin-public.php?rev=3030019#L229) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-dynamic-pricing-plugin-public.php?rev=3211131#L229) |  |
  | 229 | 229 | add\_action('wc\_ajax\_get\_refreshed\_fragments', 'elex\_dp\_wc\_ajax\_get\_refreshed\_fragments', 1); |
  | 230 | 230 |  |
  | 231 |  | function elex\_dp\_wc\_ajax\_get\_refreshed\_fragments() |
  | 232 |  | { |
  |  | 231 | function elex\_dp\_wc\_ajax\_get\_refreshed\_fragments() { |
  | 233 | 232 | global $woocommerce; |
  | 234 | 233 | if ($woocommerce->cart) { |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-dynamic-pricing-plugin-public.php?rev=3030019#L238) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-dynamic-pricing-plugin-public.php?rev=3211131#L237) |  |
  | 238 | 237 |  |
  | 239 | 238 | // Exclude discount from taxes |
  | 240 |  | function excludeCartFeesTaxes($taxes, $fee, $cart) |
  | 241 |  | { |
  |  | 239 | function excludeCartFeesTaxes( $taxes, $fee, $cart) { |
  | 242 | 240 | return []; |
  | 243 | 241 | } |
  | 244 |  | add\_action('woocommerce\_cart\_totals\_get\_fees\_from\_cart\_taxes', 'excludeCartFeesTaxes', 10 ,3); |
  |  | 242 | add\_action('woocommerce\_cart\_totals\_get\_fees\_from\_cart\_taxes', 'excludeCartFeesTaxes', 10 , 3); |
  |  | 243 |  |
  |  | 244 | add\_action('save\_post\_product', 'delete\_product\_transient\_on\_price\_update', 10, 3); |
  |  | 245 |  |
  |  | 246 | function delete\_product\_transient\_on\_price\_update( $post\_id, $post, $update) { |
  |  | 247 |  |
  |  | 248 | global $wpdb; |
  |  | 249 | // Specify the transient key pattern |
  |  | 250 | $transient\_key\_pattern = 'elex\_dp\_product\_data\_' . $post\_id; |
  |  | 251 |  |
  |  | 252 | $wpdb->query( |
  |  | 253 | $wpdb->prepare( |
  |  | 254 | "DELETE FROM $wpdb->options WHERE option\_name LIKE %s OR option\_name LIKE %s", |
  |  | 255 | '\_transient\_%' . $transient\_key\_pattern, |
  |  | 256 | '\_transient\_timeout\_%' . $transient\_key\_pattern |
  |  | 257 | ) |
  |  | 258 | ); |
  |  | 259 |  |
  |  | 260 | // Clear the object cache |
  |  | 261 | wp\_cache\_flush(); |
  |  | 262 |  |
  |  | 263 | } |
  |  | 264 |  |
  |  | 265 | add\_action('woocommerce\_update\_product\_variation', 'delete\_variation\_transient\_on\_price\_update', 10, 1); |
  |  | 266 |  |
  |  | 267 | function delete\_variation\_transient\_on\_price\_update( $variation\_id) { |
  |  | 268 |  |
  |  | 269 | global $wpdb; |
  |  | 270 | // Specify the transient key pattern for the variation |
  |  | 271 | $transient\_key\_pattern = 'elex\_dp\_product\_data\_' . $variation\_id; |
  |  | 272 |  |
  |  | 273 | $wpdb->query( |
  |  | 274 | $wpdb->prepare( |
  |  | 275 | "DELETE FROM $wpdb->options WHERE option\_name LIKE %s OR option\_name LIKE %s", |
  |  | 276 | '\_transient\_%' . $transient\_key\_pattern, |
  |  | 277 | '\_transient\_timeout\_%' . $transient\_key\_pattern |
  |  | 278 | ) |
  |  | 279 | ); |
  |  | 280 |  |
  |  | 281 | // Clear the object cache |
  |  | 282 | wp\_cache\_flush(); |
  |  | 283 |  |
  |  | 284 | } |
* ## [elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-new-calculation-handler.php](/changeset/3211131/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-new-calculation-handler.php "Show the changeset 3211131 restricted to elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-new-calculation-handler.php")

  | [r3046337](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-new-calculation-handler.php?rev=3046337#L16 "Show revision 3046337 of this file in browser") | [r3211131](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-new-calculation-handler.php?rev=3211131#L16 "Show revision 3211131 of this file in browser") |  |
  | --- | --- | --- |
  | 16 | 16 | \* @author Akshay |
  | 17 | 17 | \*/ |
  | 18 |  | class Elex\_NewCalculationHandler |
  | 19 |  | { |
  |  | 18 | class Elex\_NewCalculationHandler { |
  |  | 19 |  |
  | 20 | 20 |  |
  | 21 | 21 | public $debug\_mode = false; |
  | 22 | 22 |  |
  | 23 |  | public function \_\_construct() |
  | 24 |  | { |
  |  | 23 | public function \_\_construct() { |
  | 25 | 24 | $dummy\_settings['product\_rules\_on\_off']          = 'enable'; |
  | 26 | 25 | $dummy\_settings['combinational\_rules\_on\_off']    = 'enable'; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-new-calculation-handler.php?rev=3046337#L110) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-new-calculation-handler.php?rev=3211131#L109) |  |
  | 110 | 109 | $parent\_id                 = elex\_dp\_is\_wc\_version\_gt\_eql('2.7') ? $prod->get\_parent\_id() : $prod->parent->id; |
  | 111 | 110 | $parent\_product            = wc\_get\_product($parent\_id); |
  | 112 |  | if~~($parent\_product)~~{ |
  |  | 111 | if ($parent\_product) { |
  | 113 | 112 | $xa\_cart\_categories[$\_pid] = elex\_dp\_is\_wc\_version\_gt\_eql('2.7') ? $parent\_product->get\_category\_ids() : elex\_dp\_get\_category\_ids($parent\_product); |
  | 114 | 113 | $xa\_cart\_tags[$\_pid]       = xa\_get\_tag\_ids($\_pid); |
  | 115 |  | }~~else~~{ |
  |  | 114 | } else { |
  | 116 | 115 | $xa\_cart\_categories[$\_pid] = elex\_dp\_is\_wc\_version\_gt\_eql('2.7') ? $prod->get\_category\_ids() : elex\_dp\_get\_category\_ids($prod); |
  | 117 | 116 | $xa\_cart\_tags[$\_pid]       = xa\_get\_tag\_ids($prod); |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-new-calculation-handler.php?rev=3046337#L123) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-new-calculation-handler.php?rev=3211131#L122) |  |
  | 123 | 122 | } |
  | 124 | 123 | foreach ($xa\_cart\_categories[$\_pid] as $\_cid) { |
  | 125 |  | $xa\_cart\_categories\_items[$\_cid] = isset($xa\_cart\_categories\_items[$\_cid]) ? (~~$xa\_cart\_categories\_items[$\_cid] + 1~~) : 1; |
  | 126 |  | $xa\_cart\_categories\_units[$\_cid] = isset($xa\_cart\_categories\_units[$\_cid]) ? (~~$xa\_cart\_categories\_units[$\_cid] + $\_qnty~~) : $\_qnty; |
  |  | 124 | $xa\_cart\_categories\_items[$\_cid] = isset($xa\_cart\_categories\_items[$\_cid]) ? ( $xa\_cart\_categories\_items[$\_cid] + 1 ) : 1; |
  |  | 125 | $xa\_cart\_categories\_units[$\_cid] = isset($xa\_cart\_categories\_units[$\_cid]) ? ( $xa\_cart\_categories\_units[$\_cid] + $\_qnty ) : $\_qnty; |
  | 127 | 126 | } |
  | 128 | 127 | foreach ($xa\_cart\_tags[$\_pid] as $\_tid) { |
  | 129 |  | $xa\_cart\_tags\_items[$\_tid] = isset($xa\_cart\_tags\_items[$\_tid]) ? (~~$xa\_cart\_tags\_items[$\_tid] + 1~~) : 1; |
  | 130 |  | $xa\_cart\_tags\_units[$\_tid] = isset($xa\_cart\_tags\_units[$\_tid]) ? (~~$xa\_cart\_tags\_units[$\_tid] + $\_qnty~~) : $\_qnty; |
  |  | 128 | $xa\_cart\_tags\_items[$\_tid] = isset($xa\_cart\_tags\_items[$\_tid]) ? ( $xa\_cart\_tags\_items[$\_tid] + 1 ) : 1; |
  |  | 129 | $xa\_cart\_tags\_units[$\_tid] = isset($xa\_cart\_tags\_units[$\_tid]) ? ( $xa\_cart\_tags\_units[$\_tid] + $\_qnty ) : $\_qnty; |
  | 131 | 130 | } |
  | 132 | 131 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-new-calculation-handler.php?rev=3046337#L145) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-new-calculation-handler.php?rev=3211131#L144) |  |
  | 145 | 144 | } |
  | 146 | 145 |  |
  | 147 |  | /\*\* |
  |  | 146 | /\*\* |
  | 148 | 147 | \* Finds valid rules for this product and return discounted price based on (all rules,first match,best discount) |
  | 149 | 148 | \* |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-new-calculation-handler.php?rev=3046337#L154) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-new-calculation-handler.php?rev=3211131#L153) |  |
  | 154 | 153 | \* @return $discounted\_price |
  | 155 | 154 | \*/ |
  | 156 |  | public function elex\_dp\_getDiscountedPriceForProduct($old\_price = '', $product = null, $pid = null) |
  | 157 |  | { |
  | 158 |  | //error\_log($product->get\_id()." filter=".current\_filter()); |
  | 159 |  | global $elex\_dp\_cached\_prices; |
  | 160 |  | if (!$elex\_dp\_cached\_prices) { |
  | 161 |  | $elex\_dp\_cached\_prices = array(); |
  | 162 |  | } |
  | 163 |  |  |
  | 164 |  | if (!isset($elex\_dp\_cached\_prices[$product->get\_id()])) { |
  | 165 |  | $elex\_dp\_cached\_prices[$product->get\_id()] = array(); |
  | 166 |  | } |
  | 167 |  |  |
  | 168 |  | // if (isset($elex\_dp\_cached\_prices[$product->get\_id()][current\_filter()])) { |
  | 169 |  | //  return $elex\_dp\_cached\_prices[$product->get\_id()][current\_filter()]; |
  | 170 |  | // } |
  | 171 |  | // print("<pre>".print\_r(debug\_backtrace(),true)."</pre>"); |
  | 172 |  |  |
  | 173 |  | global $xa\_dp\_setting; |
  | 174 |  | $xa\_add\_on\_true  = true; |
  | 175 |  | $xa\_add\_on\_false = false; |
  | 176 |  | if (is\_plugin\_active('woocommerce-product-addons/woocommerce-product-addons.php')) { |
  | 177 |  | if ($xa\_dp\_setting['xa\_product\_add\_on\_option'] == 'disable') { |
  | 178 |  | $xa\_add\_on\_true  = false; |
  | 179 |  | $xa\_add\_on\_false = true; |
  | 180 |  | } |
  | 181 |  | } |
  | 182 |  |  |
  | 183 |  | //Code added to make discount apply in custom woocommerce pages. |
  | 184 |  | $product\_filters = array('woocommerce\_product\_get\_price', 'woocommerce\_product\_variation\_get\_price', 'woocommerce\_product\_variation\_get\_sale\_price', 'woocommerce\_product\_get\_sale\_price'); |
  | 185 |  |  |
  | 186 |  | if (apply\_filters('xa\_give\_discount\_on\_addon\_prices', true) == $xa\_add\_on\_false && did\_action('woocommerce\_before\_calculate\_totals') || doing\_action('woocommerce\_before\_calculate\_totals')) {   // added this code for compatiblity with woocommerce product addons |
  | 187 |  | // $elex\_dp\_cached\_prices[$product->get\_id()][current\_filter()] = $old\_price; |
  |  | 155 | public function elex\_dp\_getDiscountedPriceForProduct( $old\_price = '', $product = null, $pid = null) { |
  |  | 156 | static $cached\_prices = array(); |
  |  | 157 |  |
  |  | 158 | // Early return if product or price is not provided |
  |  | 159 | if (!$product || !$old\_price) { |
  | 188 | 160 | return $old\_price; |
  | 189 | 161 | } |
  | 190 |  | if (!is\_shop() && !is\_product() && !is\_product\_tag() &&  !is\_product\_category() && !did\_action('woocommerce\_before\_calculate\_totals') && apply\_filters('xa\_give\_discount\_on\_addon\_prices', true) == $xa\_add\_on\_true && !in\_array(current\_filter(), $product\_filters)) {   // added this code for compatiblity with woocommerce product addons |
  | 191 |  | // $elex\_dp\_cached\_prices[$product->get\_id()][current\_filter()] = $old\_price; |
  |  | 162 |  |
  |  | 163 | $product\_id = $product->get\_id(); |
  |  | 164 | if (!isset($cached\_prices[$product\_id])) { |
  |  | 165 | $cached\_prices[$product\_id] = array(); |
  |  | 166 | } |
  |  | 167 |  |
  |  | 168 | // Check if the discount calculation should be skipped |
  |  | 169 | global $xa\_hooks, $xa\_dp\_setting, $xa\_cart\_quantities, $xa\_common\_flat\_discount; |
  |  | 170 | $apply\_discount = apply\_filters('xa\_give\_discount\_on\_addon\_prices', true); |
  |  | 171 |  |
  |  | 172 | if (( !is\_shop() && !is\_product() && !is\_product\_tag() && !is\_product\_category() && !did\_action('woocommerce\_before\_calculate\_totals') ) |
  |  | 173 | || ( !$apply\_discount && ( did\_action('woocommerce\_before\_calculate\_totals') || doing\_action('woocommerce\_before\_calculate\_totals') ) ) |
  |  | 174 | ) { |
  | 192 | 175 | return $old\_price; |
  | 193 | 176 | } |
  | 194 |  | global $xa\_hooks, $xa\_common\_flat\_discount, $xa\_cart\_price, $executed\_pids; |
  | 195 |  | remove\_filter($xa\_hooks['woocommerce\_get\_price\_hook\_name'], array($this, 'elex\_dp\_getDiscountedPriceForProduct'), 22); |
  | 196 |  | remove\_filter($xa\_hooks['woocommerce\_get\_sale\_price\_hook\_name'], array($this, 'elex\_dp\_getDiscountedPriceForProduct'), 22);    // update sale price on product page |
  | 197 |  | remove\_filter('woocommerce\_product\_variation\_get\_price', array($this, 'elex\_dp\_getDiscountedPriceForProduct'), 22); |
  | 198 |  | remove\_filter('woocommerce\_product\_variation\_get\_sale\_price', array($this, 'elex\_dp\_getDiscountedPriceForProduct'), 22);    // update sale price on product page |
  | 199 |  |  |
  | 200 |  | $regular\_price = $product->get\_regular\_price(); |
  | 201 |  |  |
  | 202 |  | if (empty($pid)) { |
  | 203 |  | $pid = elex\_dp\_get\_pid($product); |
  | 204 |  | } |
  | 205 |  |  |
  | 206 |  | if ($pid == false) { |
  | 207 |  | add\_filter($xa\_hooks['woocommerce\_get\_price\_hook\_name'], array($this, 'elex\_dp\_getDiscountedPriceForProduct'), 22, 2);         // update sale price on product page |
  | 208 |  | add\_filter($xa\_hooks['woocommerce\_get\_sale\_price\_hook\_name'], array($this, 'elex\_dp\_getDiscountedPriceForProduct'), 22, 2);    // update sale price on product page |
  | 209 |  | add\_filter('woocommerce\_product\_variation\_get\_price', array($this, 'elex\_dp\_getDiscountedPriceForProduct'), 22, 2);    // update sale price on product page |
  | 210 |  | add\_filter('woocommerce\_product\_variation\_get\_sale\_price', array($this, 'elex\_dp\_getDiscountedPriceForProduct'), 22, 2);    // update sale price on product page |
  | 211 |  | $elex\_dp\_cached\_prices[$product->get\_id()][current\_filter()] = $old\_price; |
  |  | 177 | if ( !is\_cart() && !is\_checkout() && !empty( get\_transient('elex\_dp\_product\_data\_' . $product\_id) ) ) { |
  |  | 178 | $discounted\_price = get\_transient('elex\_dp\_product\_data\_' . $product\_id); |
  |  | 179 | return $discounted\_price; |
  |  | 180 | } |
  |  | 181 |  |
  |  | 182 | // If the discounted price is cached in transient, return it immediately |
  |  | 183 | if (isset($cached\_prices[$product\_id][current\_filter()])) { |
  |  | 184 | return $cached\_prices[$product\_id][current\_filter()]; |
  |  | 185 | } |
  |  | 186 | // Ensure hooks are added and removed properly |
  |  | 187 | $this->manageHooks(false); |
  |  | 188 |  |
  |  | 189 | $regular\_price = $product->get\_regular\_price(); |
  |  | 190 | $pid = $pid ?: elex\_dp\_get\_pid($product); |
  |  | 191 |  |
  |  | 192 | if (!$pid) { |
  |  | 193 | $this->manageHooks(true); |
  | 212 | 194 | return $old\_price; |
  | 213 | 195 | } |
  | 214 |  | if (((current\_filter() == $xa\_hooks['woocommerce\_get\_sale\_price\_hook\_name']) || (current\_filter() == 'woocommerce\_product\_variation\_get\_sale\_price')) && empty($old\_price)) {  // if sale price is empty then old price is regular\_price |
  |  | 196 |  |
  |  | 197 | // Set old\_price if empty in certain filters |
  |  | 198 |  |
  |  | 199 |  |
  |  | 200 | if (in\_array(current\_filter(), array($xa\_hooks['woocommerce\_get\_sale\_price\_hook\_name'], 'woocommerce\_product\_variation\_get\_sale\_price')) && empty($old\_price)) { |
  | 215 | 201 | $old\_price = $regular\_price; |
  | 216 | 202 | } |
  | 217 |  | $discounted\_price = $old\_price; |
  | 218 |  | $weight           = $product->get\_weight(); |
  | 219 |  | if (!empty($old\_price) && (!empty($product) || !empty($pid))) { |
  | 220 |  |  |
  | 221 |  | global $xa\_cart\_quantities; |
  | 222 |  | $parent\_id = $pid; |
  | 223 |  | if ($product->get\_type() == 'variation') { |
  | 224 |  | $parent\_id = elex\_dp\_is\_wc\_version\_gt\_eql('2.7') ? $product->get\_parent\_id() : $product->parent->id; |
  | 225 |  | } |
  | 226 |  | if (isset($xa\_cart\_quantities[$pid]) || isset($xa\_cart\_quantities[$parent\_id])) { |
  | 227 |  | $current\_quantity = isset($xa\_cart\_quantities[$pid]) ? $xa\_cart\_quantities[$pid] : $xa\_cart\_quantities[$parent\_id]; |
  | 228 |  | } else { |
  | 229 |  | $current\_quantity = 0; |
  | 230 |  | } |
  | 231 |  | if ($current\_quantity == 0  && class\_exists('SitePress')) { |
  | 232 |  | global $sitepress; |
  | 233 |  | $trid    = $sitepress->get\_element\_trid($pid); |
  | 234 |  | $trans   = $sitepress->get\_element\_translations($trid); |
  | 235 |  | $all\_ids = array(); |
  | 236 |  | foreach ($trans as $lan) { |
  | 237 |  | $all\_ids[] = $lan->element\_id; |
  | 238 |  | } |
  | 239 |  | foreach ($all\_ids as $\_pid) { |
  | 240 |  | if (!empty($xa\_cart\_quantities[$\_pid])) { |
  | 241 |  | $current\_quantity = $xa\_cart\_quantities[$\_pid]; |
  | 242 |  | break; |
  | 243 |  | } |
  | 244 |  | } |
  | 245 |  | } |
  |  | 203 |  |
  |  | 204 | $discounted\_price = $old\_price; |
  |  | 205 | $weight = $product->get\_weight(); |
  |  | 206 |  |
  |  | 207 | if (!empty($old\_price) && $pid) { |
  |  | 208 | $parent\_id = ( $product->get\_type() == 'variation' ) ? $product->get\_parent\_id() : $pid; |
  |  | 209 | $current\_quantity = $xa\_cart\_quantities[$pid] ?? $xa\_cart\_quantities[$parent\_id] ?? 0; |
  |  | 210 |  |
  | 246 | 211 | if (is\_shop() || is\_product\_category() || is\_product() || is\_product\_tag()) { |
  | 247 | 212 | $current\_quantity++; |
  | 248 | 213 | } |
  |  | 214 |  |
  | 249 | 215 | $objRulesValidator = new Elex\_RulesValidator(); |
  | 250 |  |  |
  | 251 | 216 | $valid\_rules = $objRulesValidator->elex\_dp\_getValidRulesForProduct($product, $pid, $current\_quantity, $discounted\_price, $weight); |
  | 252 |  |  |
  |  | 217 |  |
  | 253 | 218 | if ($this->debug\_mode) { |
  | 254 | 219 | error\_log(str\_repeat('-', 380)); |
  | 255 | 220 | error\_log('Valid Rules for Pid=' . $pid . ' and qnty=' . $current\_quantity . ' Valid Rules= ' . print\_r($valid\_rules, true)); |
  | 256 | 221 | } |
  | 257 |  | $mode = !empty($xa\_dp\_setting['mode']) ? $xa\_dp\_setting['mode'] : 'first\_match'; |
  | 258 |  | // if (!empty($executed\_pids[$pid]) && $mode == 'best\_discount' && !$product->is\_type('variation')) { |
  | 259 |  | //  $product->set\_price($executed\_pids[$pid]); |
  | 260 |  | //  add\_filter($xa\_hooks['woocommerce\_get\_price\_hook\_name'], array($this, 'elex\_dp\_getDiscountedPriceForProduct'), 22, 2);         // update sale price on product page |
  | 261 |  | //  add\_filter($xa\_hooks['woocommerce\_get\_sale\_price\_hook\_name'], array($this, 'elex\_dp\_getDiscountedPriceForProduct'), 22, 2);    // update sale price on product page |
  | 262 |  | //  add\_filter('woocommerce\_product\_variation\_get\_price', array($this, 'elex\_dp\_getDiscountedPriceForProduct'), 22, 2);    // update sale price on product page |
  | 263 |  | //  add\_filter('woocommerce\_product\_variation\_get\_sale\_price', array($this, 'elex\_dp\_getDiscountedPriceForProduct'), 22, 2);    // update sale price on product page |
  | 264 |  | //  $elex\_dp\_cached\_prices[$product->get\_id()][current\_filter()] = $executed\_pids[$pid]; |
  | 265 |  | //  return $executed\_pids[$pid]; |
  | 266 |  | // } |
  | 267 |  | if (is\_array($valid\_rules) && $valid\_rules) { |
  | 268 |  | $valid\_flat\_discount = []; |
  |  | 222 |  |
  |  | 223 | if (is\_array($valid\_rules) && $valid\_rules) { |
  | 269 | 224 | foreach ($valid\_rules as $rule\_type\_colon\_rule\_no => $rule) { |
  | 270 |  | //this section supports repeat execution for product rules |
  | 271 |  | if (isset($rule['repeat\_rule']) && $rule['repeat\_rule'] == 'yes' && !empty($rule['max']) && !empty($rule['min'])) { |
  | 272 |  | if ($rule['rule\_type'] == 'product\_rules') { |
  | 273 |  | if ($product->get\_type() == 'variation') { |
  | 274 |  | $pparent\_id = elex\_dp\_is\_wc\_version\_gt\_eql('2.7') ? $product->get\_parent\_id() : $product->parent->id; |
  | 275 |  |  |
  | 276 |  | if (is\_array($rule['product\_id']) && in\_array($pparent\_id, $rule['product\_id'])) { |
  | 277 |  | $pparent\_product  = new WC\_Product\_Variable($pparent\_id); |
  | 278 |  | $variations       = $pparent\_product->get\_children(); |
  | 279 |  | $current\_quantity = 0; |
  | 280 |  | foreach ($variations as $value) { |
  | 281 |  | if (isset($xa\_cart\_quantities[$value])) { |
  | 282 |  | $current\_quantity += $xa\_cart\_quantities[$value]; |
  | 283 |  | } |
  | 284 |  | } |
  | 285 |  | if (isset($xa\_cart\_quantities[$pparent\_id])) { |
  | 286 |  | $current\_quantity += $xa\_cart\_quantities[$value]; |
  | 287 |  | } |
  | 288 |  | if (is\_shop() || is\_product\_category() || is\_product() || is\_product\_tag()) { |
  | 289 |  | $current\_quantity++; |
  | 290 |  | } |
  | 291 |  | } |
  | 292 |  | } |
  | 293 |  | } |
  | 294 |  | $times       = intval($current\_quantity / $rule['max']); |
  | 295 |  | $total\_price = 0; |
  | 296 |  | $repeat\_qnty = (float) $rule['max']; |
  | 297 |  | if ($this->debug\_mode) { |
  | 298 |  | error\_log(str\_repeat('>', 208)); |
  | 299 |  | error\_log('Executing Rule(Repeat=True):' . $rule\_type\_colon\_rule\_no); |
  | 300 |  | } |
  | 301 |  | if (!empty($rule['discount\_type']) && $rule['discount\_type'] == 'Flat Discount') { |
  | 302 |  | $xa\_common\_flat\_discount[$rule['rule\_type'] . ':' . $rule['rule\_no'] . ':' . $pid] = floatval($rule['value']) \* floatval($times); |
  | 303 |  | if (!empty($rule['adjustment'])) { |
  | 304 |  | $adjusted\_qnty    = !empty($objRulesValidator->rule\_based\_quantity[$rule['rule\_type'] . ':' . $rule['rule\_no']]) ? $objRulesValidator->rule\_based\_quantity[$rule['rule\_type'] . ':' . $rule['rule\_no']] : $current\_quantity; |
  | 305 |  | $discounted\_price = $discounted\_price + ((float) $rule['adjustment'] / $adjusted\_qnty); |
  | 306 |  | } |
  | 307 |  | } else { |
  | 308 |  | $object\_hash = spl\_object\_hash($product); |
  | 309 |  | $object\_hash = $object\_hash . $pid; |
  | 310 |  | $r\_price     = $objRulesValidator->elex\_dp\_execute\_rule($discounted\_price, $rule\_type\_colon\_rule\_no, $rule, $repeat\_qnty, $pid, $object\_hash); |
  | 311 |  | //error\_log("$total\_price = $r\_price \* $times \* $repeat\_qnty"); |
  | 312 |  | $total\_price    = $r\_price \* $times \* $repeat\_qnty; |
  | 313 |  | $remaining\_qnty = $current\_quantity - ($times \* $repeat\_qnty); |
  | 314 |  | if ($remaining\_qnty > 0) { |
  | 315 |  | $price = isset($xa\_cart\_price[$pid]) ? $xa\_cart\_price[$pid] : 0; |
  | 316 |  | $total\_price = $total\_price + ($remaining\_qnty \* $price); |
  | 317 |  | } |
  | 318 |  | $discounted\_price = $total\_price / $current\_quantity; |
  | 319 |  | } |
  | 320 |  | } else { |
  | 321 |  | if ($this->debug\_mode) { |
  | 322 |  | error\_log(str\_repeat('>', 208)); |
  | 323 |  | error\_log('Executing Rule:' . $rule\_type\_colon\_rule\_no); |
  | 324 |  | } |
  | 325 |  | //fix for best discount mode flat discount is not getting calculated] |
  | 326 |  |  |
  | 327 |  | // if (!empty($rule['discount\_type']) && $rule['discount\_type'] == 'Flat Discount') { // removed variation condition because variations were getting executed like non flat discounts |
  | 328 |  | //  if ($rule['rule\_type'] == 'product\_rules') { |
  | 329 |  | //      $xa\_common\_flat\_discount[$rule['rule\_type'] . ':' . $rule['rule\_no'] . ':' . $pid] = floatval($rule['value']); |
  | 330 |  | //  } elseif ($rule['rule\_type'] == 'category\_rules') { |
  | 331 |  | //      $cid = !empty($rule['selected\_cids']) ? current($rule['selected\_cids']) : ''; |
  | 332 |  | //      $xa\_common\_flat\_discount[$rule['rule\_type'] . ':' . $rule['rule\_no'] . ':' . $cid] = floatval($rule['value']); |
  | 333 |  | //  } else { |
  | 334 |  | //      $xa\_common\_flat\_discount[$rule['rule\_type'] . ':' . $rule['rule\_no']] = floatval($rule['value']); |
  | 335 |  | //  } |
  | 336 |  | //  if (!empty($rule['adjustment'])) { |
  | 337 |  | //      $adjusted\_qnty    = !empty($objRulesValidator->rule\_based\_quantity[$rule['rule\_type'] . ':' . $rule['rule\_no']]) ? $objRulesValidator->rule\_based\_quantity[$rule['rule\_type'] . ':' . $rule['rule\_no']] : $current\_quantity; |
  | 338 |  | //      $discounted\_price = $discounted\_price + ((float) $rule['adjustment'] / $adjusted\_qnty); |
  | 339 |  | //  } |
  | 340 |  | // } else { |
  | 341 |  |  |
  | 342 |  | $object\_hash      = spl\_object\_hash($product); |
  | 343 |  | $object\_hash      = $object\_hash . $pid; |
  | 344 |  | $discounted\_price = $objRulesValidator->elex\_dp\_execute\_rule($discounted\_price, $rule\_type\_colon\_rule\_no, $rule, $current\_quantity, $pid, $object\_hash); |
  | 345 |  | } |
  | 346 |  | // } |
  |  | 225 | $object\_hash = spl\_object\_hash($product) . $pid; |
  |  | 226 | $discounted\_price = $objRulesValidator->elex\_dp\_execute\_rule($discounted\_price, $rule\_type\_colon\_rule\_no, $rule, $current\_quantity, $pid, $object\_hash); |
  | 347 | 227 | if ($rule['rule\_type'] != 'BOGO\_category\_rules' && $rule['rule\_type'] != 'buy\_get\_free\_rules' && $rule['rule\_type'] != 'bogo\_tag\_rules') { |
  | 348 | 228 | $product->set\_price($discounted\_price); |
  | 349 |  | ~~}~~ |
  | 350 |  |  |
  | 351 |  | ~~//Calculating the valid flat discounts.~~ |
  | 352 |  | ~~$key = $rule['rule\_type'] . ':' . $rule['rule\_no'] . ':' . $pid;~~ |
  | 353 |  | ~~if($xa\_common\_flat\_discount && array\_key\_exists($key, $xa\_common\_flat\_discount)){~~ |
  | 354 |  | ~~$valid\_flat\_discount[$key] = $key;~~ |
  | 355 |  | ~~}~~ |
  | 356 |  | ~~}~~ |
  | 357 |  | ~~if($xa\_common\_flat\_discount){~~ |
  | 358 |  | ~~foreach($xa\_common\_flat\_discount as $key => $value){~~ |
  | 359 |  | ~~$key\_parts = explode(':', $key);~~ |
  | 360 |  | ~~$current\_pid = end($key\_parts);~~ |
  | 361 |  | ~~if(!array\_key\_exists($key, $valid\_flat\_discount) && ($current\_pid == $pid)){~~ |
  | 362 |  | ~~unset($xa\_common\_flat\_discount[$key]);~~ |
  | 363 |  | ~~}~~ |
  | 364 | 229 | } |
  | 365 | 230 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-new-calculation-handler.php?rev=3046337#L367) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-new-calculation-handler.php?rev=3211131#L232) |  |
  | 367 | 232 | foreach ($xa\_common\_flat\_discount as $key => $value) { |
  | 368 | 233 | $key\_parts = explode(':', $key); |
  | 369 |  | $current\_pid = end($key\_parts); |
  | 370 |  | if ($current\_pid == $pid) { |
  |  | 234 | if (end($key\_parts) == $pid) { |
  | 371 | 235 | unset($xa\_common\_flat\_discount[$key]); |
  | 372 | 236 | } |
  | 373 | 237 | } |
  | 374 | 238 | } |
  | 375 |  | } |
  | 376 |  | $elex\_dp\_cached\_prices[$product->get\_id()][current\_filter()] = $discounted\_price; |
  | 377 |  | add\_filter($xa\_hooks['woocommerce\_get\_price\_hook\_name'], array($this, 'elex\_dp\_getDiscountedPriceForProduct'), 22, 2);         // update sale price on product page |
  | 378 |  | add\_filter($xa\_hooks['woocommerce\_get\_sale\_price\_hook\_name'], array($this, 'elex\_dp\_getDiscountedPriceForProduct'), 22, 2);    // update sale price on product page |
  | 379 |  | add\_filter('woocommerce\_product\_variation\_get\_price', array($this, 'elex\_dp\_getDiscountedPriceForProduct'), 22, 2);    // update sale price on product page |
  | 380 |  | add\_filter('woocommerce\_product\_variation\_get\_sale\_price', array($this, 'elex\_dp\_getDiscountedPriceForProduct'), 22, 2);    // update sale price on product page |
  | 381 |  | if (((current\_filter() == $xa\_hooks['woocommerce\_get\_sale\_price\_hook\_name']) || (current\_filter() == 'woocommerce\_product\_variation\_get\_sale\_price')) && ($regular\_price == $discounted\_price)) {  // if sale price is empty then old price is regular\_price |
  | 382 |  | return ''; |
  | 383 |  | } |
  | 384 |  | return $discounted\_price; |
  | 385 |  | } |
  | 386 |  |  |
  | 387 |  | public function elex\_dp\_getDiscountedPriceHTML($price, $product) |
  | 388 |  | { |
  |  | 239 |  |
  |  | 240 |  |
  |  | 241 | } |
  |  | 242 | if ( empty( get\_transient('elex\_dp\_product\_data\_' . $product\_id) ) ) { |
  |  | 243 | set\_transient( 'elex\_dp\_product\_data\_' . $product\_id, $discounted\_price ); |
  |  | 244 | } |
  |  | 245 | $cached\_prices[$product\_id][current\_filter()] = $discounted\_price; |
  |  | 246 |  |
  |  | 247 | // Restore hooks |
  |  | 248 | $this->manageHooks(true); |
  |  | 249 |  |
  |  | 250 | return ( in\_array(current\_filter(), array($xa\_hooks['woocommerce\_get\_sale\_price\_hook\_name'], 'woocommerce\_product\_variation\_get\_sale\_price')) && $regular\_price == $discounted\_price ) ? '' : $discounted\_price; |
  |  | 251 | } |
  |  | 252 |  |
  |  | 253 | // Helper method to manage hooks |
  |  | 254 | public function manageHooks( $add) { |
  |  | 255 | global $xa\_hooks; |
  |  | 256 |  |
  |  | 257 | $action = $add ? 'add\_filter' : 'remove\_filter'; |
  |  | 258 | $priority = 22; |
  |  | 259 |  |
  |  | 260 | $filters = [ |
  |  | 261 | $xa\_hooks['woocommerce\_get\_price\_hook\_name'], |
  |  | 262 | $xa\_hooks['woocommerce\_get\_sale\_price\_hook\_name'], |
  |  | 263 | 'woocommerce\_product\_variation\_get\_price', |
  |  | 264 | 'woocommerce\_product\_variation\_get\_sale\_price' |
  |  | 265 | ]; |
  |  | 266 |  |
  |  | 267 | foreach ($filters as $filter) { |
  |  | 268 | $action($filter, [$this, 'elex\_dp\_getDiscountedPriceForProduct'], $priority, 2); |
  |  | 269 | } |
  |  | 270 | } |
  |  | 271 |  |
  |  | 272 | public function elex\_dp\_getDiscountedPriceHTML( $price, $product) { |
  | 389 | 273 | // hooked to get\_price\_html filter |
  | 390 | 274 | if ($product->is\_type('simple') || $product->is\_type('variation')) { |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-new-calculation-handler.php?rev=3046337#L398) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-new-calculation-handler.php?rev=3211131#L282) |  |
  | 398 | 282 | } |
  | 399 | 283 |  |
  | 400 |  | public function elex\_dp\_getDiscountedPriceHTML\_for\_simple\_product($price, $product) |
  | 401 |  | { |
  |  | 284 | public function elex\_dp\_getDiscountedPriceHTML\_for\_simple\_product( $price, $product) { |
  | 402 | 285 | // hooked to get\_price\_html filter |
  | 403 | 286 | return $price; |
  | 404 | 287 | } |
  | 405 | 288 |  |
  | 406 |  | public function elex\_dp\_getDiscountedPriceHTML\_for\_group\_product($price, $product) |
  | 407 |  | { |
  |  | 289 | public function elex\_dp\_getDiscountedPriceHTML\_for\_group\_product( $price, $product) { |
  | 408 | 290 | // hooked to get\_price\_html filter |
  | 409 | 291 | $tax\_display\_mode = get\_option('woocommerce\_tax\_display\_shop'); |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-new-calculation-handler.php?rev=3046337#L413) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-new-calculation-handler.php?rev=3211131#L295) |  |
  | 413 | 295 | $child = wc\_get\_product($child\_id); |
  | 414 | 296 | //$child\_prices[] = 'incl' === $tax\_display\_mode ? wc\_get\_price\_including\_tax($child) : wc\_get\_price\_excluding\_tax($child); |
  | 415 |  | if($child) { |
  |  | 297 | if ($child) { |
  | 416 | 298 | if ($child->is\_type('variable')) { |
  | 417 | 299 | $prices = $child->get\_variation\_prices(true); |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-new-calculation-handler.php?rev=3046337#L441) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-new-calculation-handler.php?rev=3211131#L323) |  |
  | 441 | 323 | if ('' !== $min\_price) { |
  | 442 | 324 | $price   = $min\_price !== $max\_price ? sprintf(\_x('%1$s&ndash;%2$s', 'Price range: from-to', 'woocommerce'), wc\_price($min\_price), wc\_price($max\_price)) : wc\_price($min\_price); |
  | 443 |  | $is\_free = (~~0 == $min\_price && 0 == $max\_price~~); |
  |  | 325 | $is\_free = ( 0 == $min\_price && 0 == $max\_price ); |
  | 444 | 326 |  |
  | 445 | 327 | if ($is\_free) { |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-new-calculation-handler.php?rev=3046337#L455) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-new-calculation-handler.php?rev=3211131#L337) |  |
  | 455 | 337 | } |
  | 456 | 338 |  |
  | 457 |  | public function elex\_dp\_getDiscountedPriceHTML\_for\_variable\_product($price, $product) |
  | 458 |  | { |
  |  | 339 | public function elex\_dp\_getDiscountedPriceHTML\_for\_variable\_product( $price, $product) { |
  | 459 | 340 | // hooked to get\_price\_html filter |
  | 460 | 341 | $prices               = array(); |
* ## [elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php](/changeset/3211131/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php "Show the changeset 3211131 restricted to elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php")

  | [r3183659](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L6 "Show revision 3183659 of this file in browser") | [r3211131](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L6 "Show revision 3211131 of this file in browser") |  |
  | --- | --- | --- |
  | 6 | 6 | \* @author Akshay |
  | 7 | 7 | \*/ |
  | 8 |  | class Elex\_RulesValidator |
  | 9 |  | { |
  |  | 8 | class Elex\_RulesValidator { |
  |  | 9 |  |
  | 10 | 10 |  |
  | 11 | 11 | public $execution\_mode      = 'first\_match'; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L22) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L22) |  |
  | 22 | 22 | \* @return array $valid\_rules |
  | 23 | 23 | \*/ |
  | 24 |  | function \_\_construct($mode = '', $for\_offers\_table = false, $only\_execute\_this\_mode = '') |
  | 25 |  | { |
  |  | 24 | function \_\_construct( $mode = '', $for\_offers\_table = false, $only\_execute\_this\_mode = '') { |
  | 26 | 25 | global $xa\_dp\_setting; |
  | 27 | 26 |  |
  | 28 | 27 | $this->for\_offers\_table = $for\_offers\_table; |
  | 29 | 28 | $this->execution\_mode   = empty($mode) ? $xa\_dp\_setting['mode'] : $mode; |
  | 30 |  | $this->execution\_order  = empty($only\_execute\_this\_mode) ? (isset($xa\_dp\_setting['execution\_order']) ? $xa\_dp\_setting['execution\_order'] : array( |
  |  | 29 | $this->execution\_order  = empty($only\_execute\_this\_mode) ? ( isset($xa\_dp\_setting['execution\_order']) ? $xa\_dp\_setting['execution\_order'] : array( |
  | 31 | 30 | 'product\_rules', |
  | 32 | 31 | 'category\_rules' |
  | 33 |  | )) : array($only\_execute\_this\_mode); |
  |  | 32 | ) ) : array($only\_execute\_this\_mode); |
  | 34 | 33 | } |
  | 35 | 34 | /\*\* |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L37) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L36) |  |
  | 37 | 36 | \*/ |
  | 38 | 37 |  |
  | 39 |  | public function elex\_dp\_getValidRulesForProduct($product, $pid = null, $current\_quantity = 1, $price = 0, $weight = 0) |
  | 40 |  | { |
  |  | 38 | public function elex\_dp\_getValidRulesForProduct( $product, $pid = null, $current\_quantity = 1, $price = 0, $weight = 0) { |
  | 41 | 39 | if (empty($pid)) { |
  | 42 | 40 | $pid = elex\_dp\_get\_pid($product); |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L58) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L56) |  |
  | 58 | 56 |  |
  | 59 | 57 |  |
  | 60 |  | function elex\_dp\_getFirstMatchedRule($product, $pid, $current\_quantity = 1, $price = 0, $weight = 0) |
  | 61 |  | { |
  |  | 58 | function elex\_dp\_getFirstMatchedRule( $product, $pid, $current\_quantity = 1, $price = 0, $weight = 0) { |
  | 62 | 59 | global $xa\_dp\_rules, $xa\_first\_match\_rule\_executed; |
  | 63 | 60 | //if(!$xa\_first\_match\_rule\_executed) |
  | 64 | 61 | { |
  | 65 |  | foreach ($this->execution\_order as $rule\_type) { |
  | 66 |  | $rules = !empty($xa\_dp\_rules[$rule\_type]) ? $xa\_dp\_rules[$rule\_type] : array(); |
  | 67 |  | foreach ($rules as $rule\_no => $rule) { |
  | 68 |  | //print\_r($rule\_type.'->'.$rule\_no." pid=".$pid); |
  | 69 |  | $rule['rule\_no']   = $rule\_no; |
  | 70 |  | $rule['rule\_type'] = $rule\_type; |
  | 71 |  | if ($this->elex\_dp\_checkRuleApplicableForProduct($rule, $rule\_type, $product, $pid, $current\_quantity, $price, $weight) === true) { |
  | 72 |  | if ($rule\_type == 'product\_rules') { |
  | 73 |  | $xa\_first\_match\_rule\_executed = true; |
  | 74 |  | } |
  | 75 |  | //error\_log('type='.$rule\_type.' ruleno='.$rule\_no.' pid='.$pid); |
  | 76 |  | return array($rule\_type . ':' . $rule\_no => $rule); |
  | 77 |  | } |
  | 78 |  | } |
  | 79 |  | } |
  |  | 62 | foreach ($this->execution\_order as $rule\_type) { |
  |  | 63 | $rules = !empty($xa\_dp\_rules[$rule\_type]) ? $xa\_dp\_rules[$rule\_type] : array(); |
  |  | 64 | foreach ($rules as $rule\_no => $rule) { |
  |  | 65 | //print\_r($rule\_type.'->'.$rule\_no." pid=".$pid); |
  |  | 66 | $rule['rule\_no']   = $rule\_no; |
  |  | 67 | $rule['rule\_type'] = $rule\_type; |
  |  | 68 | if ($this->elex\_dp\_checkRuleApplicableForProduct($rule, $rule\_type, $product, $pid, $current\_quantity, $price, $weight) === true) { |
  |  | 69 | if ($rule\_type == 'product\_rules') { |
  |  | 70 | $xa\_first\_match\_rule\_executed = true; |
  |  | 71 | } |
  |  | 72 | //error\_log('type='.$rule\_type.' ruleno='.$rule\_no.' pid='.$pid); |
  |  | 73 | return array($rule\_type . ':' . $rule\_no => $rule); |
  |  | 74 | } |
  |  | 75 | } |
  |  | 76 | } |
  | 80 | 77 | } |
  | 81 | 78 | return array(); |
  | 82 | 79 | } |
  | 83 | 80 |  |
  | 84 |  | function elex\_dp\_getAllMatchedRules($product, $pid, $current\_quantity = 1, $price = 0, $weight = 0) |
  | 85 |  | { |
  |  | 81 | function elex\_dp\_getAllMatchedRules( $product, $pid, $current\_quantity = 1, $price = 0, $weight = 0) { |
  | 86 | 82 | global $xa\_dp\_rules; |
  | 87 | 83 | $valid\_rules = array(); |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L104) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L100) |  |
  | 104 | 100 | } |
  | 105 | 101 |  |
  | 106 |  | function elex\_dp\_getBestMatchedRules($product, $pid, $current\_quantity = 1, $price = 0, $weight = 0) |
  | 107 |  | { |
  |  | 102 | function elex\_dp\_getBestMatchedRules( $product, $pid, $current\_quantity = 1, $price = 0, $weight = 0) { |
  | 108 | 103 | global $xa\_dp\_rules; |
  | 109 | 104 | $valid\_rules = array(); |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L129) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L124) |  |
  | 129 | 124 | } |
  | 130 | 125 |  |
  | 131 |  | public function elex\_dp\_checkRuleApplicableForProduct(&$rule = null, $rule\_type = '', $product = null, $pid = null, $current\_quantity = 1, $price = 0, $weight = 0) |
  | 132 |  | { |
  |  | 126 | public function elex\_dp\_checkRuleApplicableForProduct( &$rule = null, $rule\_type = '', $product = null, $pid = null, $current\_quantity = 1, $price = 0, $weight = 0) { |
  | 133 | 127 | if (apply\_filters('eha\_dp\_skip\_product', false, $pid, $rule, $rule\_type) != false) { |
  | 134 | 128 | return false; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L165) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L159) |  |
  | 165 | 159 | } |
  | 166 | 160 | global $customer; |
  | 167 |  | if ((~~!empty($rule['prev\_order\_count']) || !empty($rule['prev\_order\_total\_amt'])~~) && !empty($customer)) { |
  |  | 161 | if (( !empty($rule['prev\_order\_count']) || !empty($rule['prev\_order\_total\_amt']) ) && !empty($customer)) { |
  | 168 | 162 | $order\_count = elex\_dp\_is\_wc\_version\_gt\_eql('2.7') ? $customer->get\_order\_count() : wc\_get\_customer\_order\_count($customer->id); |
  | 169 | 163 | $total\_spent = elex\_dp\_is\_wc\_version\_gt\_eql('2.7') ? $customer->get\_total\_spent() : wc\_get\_customer\_total\_spent($customer->id); |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L189) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L183) |  |
  | 189 | 183 | } |
  | 190 | 184 |  |
  | 191 |  | function elex\_dp\_checkBOGO\_RuleApplicableForProduct(&$rule = null, $product = null, $pid = null, $current\_quantity = 1, $price = 0, $weight = 0) |
  | 192 |  | { |
  |  | 185 | function elex\_dp\_checkBOGO\_RuleApplicableForProduct( &$rule = null, $product = null, $pid = null, $current\_quantity = 1, $price = 0, $weight = 0) { |
  | 193 | 186 | $rule['purchased\_product\_id'] = elex\_dp\_WPML\_Compatible\_ids($rule['purchased\_product\_id'], 'product', true); |
  | 194 | 187 | $rule['free\_product\_id']      = elex\_dp\_WPML\_Compatible\_ids($rule['free\_product\_id'], 'product', true); |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L196) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L189) |  |
  | 196 | 189 |  |
  | 197 | 190 | //If free product is selected |
  | 198 |  | if (!isset($rule['set\_free\_option']) || (~~isset($rule['set\_free\_option']) && $rule['set\_free\_option'] == 'select\_product'~~)) { |
  |  | 191 | if (!isset($rule['set\_free\_option']) || ( isset($rule['set\_free\_option']) && $rule['set\_free\_option'] == 'select\_product' )) { |
  | 199 | 192 |  |
  | 200 | 193 | if (empty($rule['purchased\_product\_id']) || empty($rule['free\_product\_id'])) { |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L237) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L230) |  |
  | 237 | 230 | } |
  | 238 | 231 | } |
  | 239 |  | if ((~~in\_array($pid, array\_keys($rule['purchased\_product\_id'])) || in\_array($parent\_id, array\_keys($rule['purchased\_product\_id']))~~) || in\_array($pid, array\_keys($rule['free\_product\_id']))) { |
  |  | 232 | if (( in\_array($pid, array\_keys($rule['purchased\_product\_id'])) || in\_array($parent\_id, array\_keys($rule['purchased\_product\_id'])) ) || in\_array($pid, array\_keys($rule['free\_product\_id']))) { |
  | 240 | 233 | $dprice = 0; |
  | 241 | 234 | foreach ($rule['free\_product\_id'] as $\_pid => $\_qnty) { |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L246) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L239) |  |
  | 246 | 239 | } |
  | 247 | 240 | $\_product = wc\_get\_product( $\_pid ); |
  | 248 |  | if~~($\_product)~~{ |
  |  | 241 | if ($\_product) { |
  | 249 | 242 | $product\_price = $\_product->get\_price(); |
  | 250 | 243 | $price\_val = !empty($product\_price) ? $product\_price : 0; |
  | 251 |  | $dprice   += (~~$price\_val \* $\_qnty~~); |
  |  | 244 | $dprice   += ( $price\_val \* $\_qnty ); |
  | 252 | 245 | } |
  | 253 | 246 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L281) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L274) |  |
  | 281 | 274 | return false; |
  | 282 | 275 | } |
  | 283 |  | if (in\_array($pid, array\_keys($rule['purchased\_product\_id'])) && !(~~$current\_quantity > 1~~) ) { |
  |  | 276 | if (in\_array($pid, array\_keys($rule['purchased\_product\_id'])) && !( $current\_quantity > 1 ) ) { |
  | 284 | 277 | return false; |
  | 285 | 278 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L310) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L303) |  |
  | 310 | 303 | } |
  | 311 | 304 | ////////if free product is already in cart with exact quanitty this code will set its price as zero |
  | 312 |  | if ((~~in\_array($pid, array\_keys($rule['purchased\_product\_id'])) || in\_array($parent\_id, array\_keys($rule['purchased\_product\_id'])) || ($pid == $product\_tosetfree)~~)) { |
  |  | 305 | if (( in\_array($pid, array\_keys($rule['purchased\_product\_id'])) || in\_array($parent\_id, array\_keys($rule['purchased\_product\_id'])) || ( $pid == $product\_tosetfree ) )) { |
  | 313 | 306 | $dprice = 0; |
  | 314 |  | $dprice = $minvalue; |
  |  | 307 | $dprice = $minvalue; |
  | 315 | 308 | if ($this->execution\_mode == 'best\_discount') { |
  | 316 | 309 | $rule['calculated\_discount'] = $dprice;    //to check best descount rule |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L323) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L316) |  |
  | 323 | 316 | return $this->elex\_dp\_check\_date\_range\_and\_roles($rule, 'buy\_get\_free\_rules'); |
  | 324 | 317 | } |
  | 325 |  | function elex\_dp\_checkBOGO\_category\_RuleApplicableForProduct(&$rule = null, $product = null, $pid = null, $current\_quantity = 1, $price = 0, $weight = 0) |
  | 326 |  | { |
  |  | 318 | function elex\_dp\_checkBOGO\_category\_RuleApplicableForProduct( &$rule = null, $product = null, $pid = null, $current\_quantity = 1, $price = 0, $weight = 0) { |
  | 327 | 319 |  |
  | 328 | 320 | $rule['purchased\_category\_id'] = elex\_dp\_WPML\_Compatible\_ids($rule['purchased\_category\_id'], 'category', true); |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L332) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L324) |  |
  | 332 | 324 |  |
  | 333 | 325 | //If free product is selected |
  | 334 |  | if (!isset($rule['set\_free\_option']) || (~~isset($rule['set\_free\_option']) && $rule['set\_free\_option'] == 'select\_product'~~)) { |
  |  | 326 | if (!isset($rule['set\_free\_option']) || ( isset($rule['set\_free\_option']) && $rule['set\_free\_option'] == 'select\_product' )) { |
  | 335 | 327 |  |
  | 336 | 328 | if (empty($rule['purchased\_category\_id']) || empty($rule['free\_product\_id'])) { |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L349) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L341) |  |
  | 349 | 341 |  |
  | 350 | 342 | $tmp1 = array\_keys($rule['free\_product\_id']); |
  | 351 |  | if (in\_array($pid, $tmp1) && in\_array($\_cid, $product\_categories) && $xa\_dp\_setting['auto\_add\_free\_product\_on\_off'] != 'on' && !(~~$xa\_cart\_categories\_items[$\_cid] > 1~~) && $current\_quantity == 1) { |
  |  | 343 | if (in\_array($pid, $tmp1) && in\_array($\_cid, $product\_categories) && $xa\_dp\_setting['auto\_add\_free\_product\_on\_off'] != 'on' && !( $xa\_cart\_categories\_items[$\_cid] > 1 ) && $current\_quantity == 1) { |
  | 352 | 344 | $add\_if\_not\_auto = $add\_if\_not\_auto + 1; |
  | 353 | 345 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L355) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L347) |  |
  | 355 | 347 | $\_qnty   = !empty($tmp[0]) ? $tmp[0] : 0; |
  | 356 | 348 | $checkon = !empty($tmp[1]) ? $tmp[1] : 'items'; |
  | 357 |  | if ($checkon == 'items' && (~~!isset($xa\_cart\_categories\_items[$\_cid]) || $xa\_cart\_categories\_items[$\_cid] < ($\_qnty)~~)) { |
  |  | 349 | if ($checkon == 'items' && ( !isset($xa\_cart\_categories\_items[$\_cid]) || $xa\_cart\_categories\_items[$\_cid] < ( $\_qnty ) )) { |
  | 358 | 350 | return false; |
  | 359 |  | } elseif ($checkon == 'units' && (~~!isset($xa\_cart\_categories\_units[$\_cid]) || $xa\_cart\_categories\_units[$\_cid] < $\_qnty~~)) { |
  |  | 351 | } elseif ($checkon == 'units' && ( !isset($xa\_cart\_categories\_units[$\_cid]) || $xa\_cart\_categories\_units[$\_cid] < $\_qnty )) { |
  | 360 | 352 | return false; |
  | 361 | 353 | } |
  | 362 | 354 | } |
  | 363 |  | if~~($add\_if\_not\_auto > 0)~~{ |
  |  | 355 | if ($add\_if\_not\_auto > 0) { |
  | 364 | 356 | return false; |
  | 365 | 357 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L369) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L361) |  |
  | 369 | 361 | $product\_price = $\_product->get\_price(); |
  | 370 | 362 | $price\_val = !empty($product\_price) ? $product\_price : 0; |
  | 371 |  | $dprice   += (~~$price\_val \* $\_qnty~~); |
  |  | 363 | $dprice   += ( $price\_val \* $\_qnty ); |
  | 372 | 364 | } |
  | 373 | 365 | if ($this->execution\_mode == 'best\_discount') { |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L408) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L400) |  |
  | 408 | 400 | foreach ($rule['purchased\_category\_id'] as $\_cid => $\_qnty\_and\_checkon) { |
  | 409 | 401 |  |
  | 410 |  | if ((~~$pid == $product\_tosetfree) && in\_array($\_cid, $product\_categories) && !($xa\_cart\_categories\_items[$\_cid] > 1) && !($current\_quantity > 1~~)) { |
  |  | 402 | if (( $pid == $product\_tosetfree ) && in\_array($\_cid, $product\_categories) && !( $xa\_cart\_categories\_items[$\_cid] > 1 ) && !( $current\_quantity > 1 )) { |
  | 411 | 403 | $add\_if\_not\_auto = $add\_if\_not\_auto + 1; |
  | 412 | 404 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L414) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L406) |  |
  | 414 | 406 | $\_qnty   = !empty($tmp[0]) ? $tmp[0] : 0; |
  | 415 | 407 | $checkon = !empty($tmp[1]) ? $tmp[1] : 'items'; |
  | 416 |  | if ($checkon == 'items' && (~~!isset($xa\_cart\_categories\_items[$\_cid]) || $xa\_cart\_categories\_items[$\_cid] < ($\_qnty)~~)) { |
  |  | 408 | if ($checkon == 'items' && ( !isset($xa\_cart\_categories\_items[$\_cid]) || $xa\_cart\_categories\_items[$\_cid] < ( $\_qnty ) )) { |
  | 417 | 409 | return false; |
  | 418 |  | } elseif ($checkon == 'units' && (~~!isset($xa\_cart\_categories\_units[$\_cid]) || $xa\_cart\_categories\_units[$\_cid] < $\_qnty~~)) { |
  |  | 410 | } elseif ($checkon == 'units' && ( !isset($xa\_cart\_categories\_units[$\_cid]) || $xa\_cart\_categories\_units[$\_cid] < $\_qnty )) { |
  | 419 | 411 | return false; |
  | 420 | 412 | } |
  | 421 | 413 | } |
  | 422 |  | if~~($add\_if\_not\_auto > 0)~~{ |
  |  | 414 | if ($add\_if\_not\_auto > 0) { |
  | 423 | 415 | return false; |
  | 424 | 416 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L438) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L430) |  |
  | 438 | 430 | } |
  | 439 | 431 |  |
  | 440 |  | function elex\_dp\_checkbogo\_tag\_rulesApplicableForProduct(&$rule = null, $product = null, $pid = null, $current\_quantity = 1, $price = 0, $weight = 0) |
  | 441 |  | { |
  |  | 432 | function elex\_dp\_checkbogo\_tag\_rulesApplicableForProduct( &$rule = null, $product = null, $pid = null, $current\_quantity = 1, $price = 0, $weight = 0) { |
  | 442 | 433 |  |
  | 443 | 434 | $rule['purchased\_tag\_id'] = elex\_dp\_WPML\_Compatible\_ids($rule['purchased\_tag\_id'], 'tag', true); |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L446) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L437) |  |
  | 446 | 437 |  |
  | 447 | 438 | //If free product is selected |
  | 448 |  | if (!isset($rule['set\_free\_option']) || (~~isset($rule['set\_free\_option']) && $rule['set\_free\_option'] == 'select\_product'~~)) { |
  |  | 439 | if (!isset($rule['set\_free\_option']) || ( isset($rule['set\_free\_option']) && $rule['set\_free\_option'] == 'select\_product' )) { |
  | 449 | 440 |  |
  | 450 | 441 | if (empty($rule['purchased\_tag\_id']) || empty($rule['free\_product\_id'])) { |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L463) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L454) |  |
  | 463 | 454 |  |
  | 464 | 455 | $tmp1 = array\_keys($rule['free\_product\_id']); |
  | 465 |  | if (in\_array($pid, $tmp1) && in\_array($\_cid, $product\_tags) && $xa\_dp\_setting['auto\_add\_free\_product\_on\_off'] != 'on' && !(~~$xa\_cart\_tags\_items[$\_cid] > 1~~) && $current\_quantity == 1) { |
  |  | 456 | if (in\_array($pid, $tmp1) && in\_array($\_cid, $product\_tags) && $xa\_dp\_setting['auto\_add\_free\_product\_on\_off'] != 'on' && !( $xa\_cart\_tags\_items[$\_cid] > 1 ) && $current\_quantity == 1) { |
  | 466 | 457 | $add\_if\_not\_auto = $add\_if\_not\_auto + 1; |
  | 467 | 458 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L469) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L460) |  |
  | 469 | 460 | $\_qnty   = !empty($tmp[0]) ? $tmp[0] : 0; |
  | 470 | 461 | $checkon = !empty($tmp[1]) ? $tmp[1] : 'items'; |
  | 471 |  | if ($checkon == 'items' && (~~!isset($xa\_cart\_tags\_items[$\_cid]) || $xa\_cart\_tags\_items[$\_cid] < ($\_qnty)~~)) { |
  |  | 462 | if ($checkon == 'items' && ( !isset($xa\_cart\_tags\_items[$\_cid]) || $xa\_cart\_tags\_items[$\_cid] < ( $\_qnty ) )) { |
  | 472 | 463 | return false; |
  | 473 |  | } elseif ($checkon == 'units' && (~~!isset($xa\_cart\_tags\_units[$\_cid]) || $xa\_cart\_tags\_units[$\_cid] < $\_qnty~~)) { |
  |  | 464 | } elseif ($checkon == 'units' && ( !isset($xa\_cart\_tags\_units[$\_cid]) || $xa\_cart\_tags\_units[$\_cid] < $\_qnty )) { |
  | 474 | 465 | return false; |
  | 475 | 466 | } |
  | 476 | 467 | } |
  | 477 |  | if~~($add\_if\_not\_auto > 0)~~{ |
  |  | 468 | if ($add\_if\_not\_auto > 0) { |
  | 478 | 469 | return false; |
  | 479 | 470 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L483) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L474) |  |
  | 483 | 474 | $product\_price = $\_product->get\_price(); |
  | 484 | 475 | $price\_val = !empty($product\_price) ? $product\_price : 0; |
  | 485 |  | $dprice   += (~~$price\_val \* $\_qnty~~); |
  |  | 476 | $dprice   += ( $price\_val \* $\_qnty ); |
  | 486 | 477 | } |
  | 487 | 478 | if ($this->execution\_mode == 'best\_discount') { |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L519) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L510) |  |
  | 519 | 510 | foreach ($rule['purchased\_tag\_id'] as $\_cid => $\_qnty\_and\_checkon) { |
  | 520 | 511 |  |
  | 521 |  | if ((~~$pid == $product\_tosetfree) && in\_array($\_cid, $product\_tags) && !($xa\_cart\_tags\_items[$\_cid] > 1) && !($current\_quantity > 1~~)) { |
  |  | 512 | if (( $pid == $product\_tosetfree ) && in\_array($\_cid, $product\_tags) && !( $xa\_cart\_tags\_items[$\_cid] > 1 ) && !( $current\_quantity > 1 )) { |
  | 522 | 513 | $add\_if\_not\_auto = $add\_if\_not\_auto + 1; |
  | 523 | 514 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L525) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L516) |  |
  | 525 | 516 | $\_qnty   = !empty($tmp[0]) ? $tmp[0] : 0; |
  | 526 | 517 | $checkon = !empty($tmp[1]) ? $tmp[1] : 'items'; |
  | 527 |  | if ($checkon == 'items' && (~~!isset($xa\_cart\_tags\_items[$\_cid]) || $xa\_cart\_tags\_items[$\_cid] < ($\_qnty)~~)) { |
  |  | 518 | if ($checkon == 'items' && ( !isset($xa\_cart\_tags\_items[$\_cid]) || $xa\_cart\_tags\_items[$\_cid] < ( $\_qnty ) )) { |
  | 528 | 519 | return false; |
  | 529 |  | } elseif ($checkon == 'units' && (~~!isset($xa\_cart\_tags\_units[$\_cid]) || $xa\_cart\_tags\_units[$\_cid] < $\_qnty~~)) { |
  |  | 520 | } elseif ($checkon == 'units' && ( !isset($xa\_cart\_tags\_units[$\_cid]) || $xa\_cart\_tags\_units[$\_cid] < $\_qnty )) { |
  | 530 | 521 | return false; |
  | 531 | 522 | } |
  | 532 | 523 | } |
  | 533 |  | if~~($add\_if\_not\_auto > 0)~~{ |
  |  | 524 | if ($add\_if\_not\_auto > 0) { |
  | 534 | 525 | return false; |
  | 535 | 526 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L549) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L540) |  |
  | 549 | 540 | } |
  | 550 | 541 |  |
  | 551 |  | function elex\_dp\_checkCategoryCombinationalRuleApplicableForProduct(&$rule = null, $product = null, $pid = null, $current\_quantity = 1, $price = 0, $weight = 0) |
  | 552 |  | { |
  |  | 542 | function elex\_dp\_checkCategoryCombinationalRuleApplicableForProduct( &$rule = null, $product = null, $pid = null, $current\_quantity = 1, $price = 0, $weight = 0) { |
  | 553 | 543 |  |
  | 554 | 544 | global $xa\_cart\_quantities; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L594) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L584) |  |
  | 594 | 584 | $\_product = wc\_get\_product($pid); |
  | 595 | 585 | $old\_price = $\_product->get\_price(); |
  | 596 |  | $rule['calculated\_discount'] = (~~(float)$old\_price - (float)$new\_price~~) \* $current\_quantity; |
  |  | 586 | $rule['calculated\_discount'] = ( (float) $old\_price - (float) $new\_price ) \* $current\_quantity; |
  | 597 | 587 | } |
  | 598 | 588 | //checking roles and tofrom date for which rule is applicable |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L600) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L590) |  |
  | 600 | 590 | } |
  | 601 | 591 |  |
  | 602 |  | function elex\_dp\_checkCategoryRuleApplicableForProduct(&$rule = null, $product = null, $pid = null, $current\_quantity = 1, $price = 0, $weight = 0) |
  | 603 |  | { |
  |  | 592 | function elex\_dp\_checkCategoryRuleApplicableForProduct( &$rule = null, $product = null, $pid = null, $current\_quantity = 1, $price = 0, $weight = 0) { |
  | 604 | 593 |  |
  | 605 | 594 | global $xa\_cart\_quantities; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L607) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L596) |  |
  | 607 | 596 | global $xa\_cart\_price; |
  | 608 | 597 | global $xa\_cart\_categories; |
  | 609 |  | $min = (~~empty($rule['min']) == true~~) ? 1 : $rule['min']; |
  | 610 |  | $max = (~~empty($rule['max']) == true~~) ? 999999999 : $rule['max']; |
  |  | 598 | $min = ( empty($rule['min']) == true ) ? 1 : $rule['min']; |
  |  | 599 | $max = ( empty($rule['max']) == true ) ? 999999999 : $rule['max']; |
  | 611 | 600 |  |
  | 612 | 601 | if ($max < $min && $max != 0) { |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L656) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L645) |  |
  | 656 | 645 | } |
  | 657 | 646 | if (!empty($xa\_cart\_weight[$\_pid])) { |
  | 658 |  | $total\_weight\_of\_this\_category += (float) (~~$qnty \* $xa\_cart\_weight[$\_pid]~~); |
  |  | 647 | $total\_weight\_of\_this\_category += (float) ( $qnty \* $xa\_cart\_weight[$\_pid] ); |
  | 659 | 648 | } |
  | 660 | 649 | if (!empty($xa\_cart\_price[$\_pid])) { |
  | 661 |  | $total\_price\_of\_this\_category += (float) (~~$qnty \* $xa\_cart\_price[$\_pid]~~); |
  |  | 650 | $total\_price\_of\_this\_category += (float) ( $qnty \* $xa\_cart\_price[$\_pid] ); |
  | 662 | 651 | } |
  | 663 | 652 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L672) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L661) |  |
  | 672 | 661 | //error\_log('total units=' . $total\_all\_units\_of\_this\_category\_in\_cart . " total items=" . $total\_items\_of\_this\_category\_in\_cart); |
  | 673 | 662 | //error\_log('total price=' . $total\_price\_of\_this\_category . " total weights=" . $total\_weight\_of\_this\_category); |
  | 674 |  | if ($rule['check\_on'] == 'TotalQuantity' && (~~$total\_all\_units\_of\_this\_category\_in\_cart < $min || $total\_all\_units\_of\_this\_category\_in\_cart > $max || empty($total\_all\_units\_of\_this\_category\_in\_cart)~~)) { |
  | 675 |  | return false; |
  | 676 |  | } elseif ($rule['check\_on'] == 'Quantity' && (~~$total\_items\_of\_this\_category\_in\_cart < $min || $total\_items\_of\_this\_category\_in\_cart > $max || empty($total\_items\_of\_this\_category\_in\_cart)~~)) { |
  | 677 |  | return false; |
  | 678 |  | } elseif ($rule['check\_on'] == 'Weight' && (~~$total\_weight\_of\_this\_category < $min || $total\_weight\_of\_this\_category > $max || empty($total\_weight\_of\_this\_category)~~)) { |
  | 679 |  | return false; |
  | 680 |  | } elseif ($rule['check\_on'] == 'Price' && (~~$total\_price\_of\_this\_category < $min || $total\_price\_of\_this\_category > $max || empty($total\_price\_of\_this\_category)~~)) { |
  |  | 663 | if ($rule['check\_on'] == 'TotalQuantity' && ( $total\_all\_units\_of\_this\_category\_in\_cart < $min || $total\_all\_units\_of\_this\_category\_in\_cart > $max || empty($total\_all\_units\_of\_this\_category\_in\_cart) )) { |
  |  | 664 | return false; |
  |  | 665 | } elseif ($rule['check\_on'] == 'Quantity' && ( $total\_items\_of\_this\_category\_in\_cart < $min || $total\_items\_of\_this\_category\_in\_cart > $max || empty($total\_items\_of\_this\_category\_in\_cart) )) { |
  |  | 666 | return false; |
  |  | 667 | } elseif ($rule['check\_on'] == 'Weight' && ( $total\_weight\_of\_this\_category < $min || $total\_weight\_of\_this\_category > $max || empty($total\_weight\_of\_this\_category) )) { |
  |  | 668 | return false; |
  |  | 669 | } elseif ($rule['check\_on'] == 'Price' && ( $total\_price\_of\_this\_category < $min || $total\_price\_of\_this\_category > $max || empty($total\_price\_of\_this\_category) )) { |
  | 681 | 670 | return false; |
  | 682 | 671 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L687) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L676) |  |
  | 687 | 676 | $\_product = wc\_get\_product($pid); |
  | 688 | 677 | $old\_price = $\_product->get\_price(); |
  | 689 |  | $rule['calculated\_discount'] = (~~(float)$old\_price - (float)$new\_price~~) \* $current\_quantity; |
  |  | 678 | $rule['calculated\_discount'] = ( (float) $old\_price - (float) $new\_price ) \* $current\_quantity; |
  | 690 | 679 | } |
  | 691 | 680 |  |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L694) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L683) |  |
  | 694 | 683 | } |
  | 695 | 684 |  |
  | 696 |  | function elex\_dp\_checkTagRuleApplicableForProduct(&$rule = null, $product = null, $pid = null, $current\_quantity = 1, $price = 0, $weight = 0) |
  | 697 |  | { |
  |  | 685 | function elex\_dp\_checkTagRuleApplicableForProduct( &$rule = null, $product = null, $pid = null, $current\_quantity = 1, $price = 0, $weight = 0) { |
  | 698 | 686 |  |
  | 699 | 687 | global $xa\_cart\_quantities; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L701) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L689) |  |
  | 701 | 689 | global $xa\_cart\_price; |
  | 702 | 690 | global $xa\_cart\_tags; |
  | 703 |  | $min = (~~empty($rule['min']) == true~~) ? 1 : $rule['min']; |
  | 704 |  | $max = (~~empty($rule['max']) == true~~) ? 999999999 : $rule['max']; |
  |  | 691 | $min = ( empty($rule['min']) == true ) ? 1 : $rule['min']; |
  |  | 692 | $max = ( empty($rule['max']) == true ) ? 999999999 : $rule['max']; |
  | 705 | 693 |  |
  | 706 | 694 | if ($max < $min && $max != 0) { |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L750) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L738) |  |
  | 750 | 738 | } |
  | 751 | 739 | if (!empty($xa\_cart\_weight[$\_pid])) { |
  | 752 |  | $total\_weight\_of\_this\_tag += (int) (~~$qnty \* $xa\_cart\_weight[$\_pid]~~); |
  |  | 740 | $total\_weight\_of\_this\_tag += (int) ( $qnty \* $xa\_cart\_weight[$\_pid] ); |
  | 753 | 741 | } |
  | 754 | 742 | if (!empty($xa\_cart\_price[$\_pid])) { |
  | 755 |  | $total\_price\_of\_this\_tag += (int) (~~$qnty \* $xa\_cart\_price[$\_pid]~~); |
  |  | 743 | $total\_price\_of\_this\_tag += (int) ( $qnty \* $xa\_cart\_price[$\_pid] ); |
  | 756 | 744 | } |
  | 757 | 745 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L766) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L754) |  |
  | 766 | 754 | //error\_log('total units=' . $total\_all\_units\_of\_this\_tag\_in\_cart . " total items=" . $total\_items\_of\_this\_tag\_in\_cart); |
  | 767 | 755 | //error\_log('total price=' . $total\_price\_of\_this\_tag . " total weights=" . $total\_weight\_of\_this\_tag); |
  | 768 |  | if ($rule['check\_on'] == 'TotalQuantity' && (~~$total\_all\_units\_of\_this\_tag\_in\_cart < $min || $total\_all\_units\_of\_this\_tag\_in\_cart > $max || empty($total\_all\_units\_of\_this\_tag\_in\_cart)~~)) { |
  | 769 |  | return false; |
  | 770 |  | } elseif ($rule['check\_on'] == 'Quantity' && (~~$total\_items\_of\_this\_tag\_in\_cart < $min || $total\_items\_of\_this\_tag\_in\_cart > $max || empty($total\_items\_of\_this\_tag\_in\_cart)~~)) { |
  | 771 |  | return false; |
  | 772 |  | } elseif ($rule['check\_on'] == 'Weight' && (~~$total\_weight\_of\_this\_tag < $min || $total\_weight\_of\_this\_tag > $max || empty($total\_weight\_of\_this\_tag)~~)) { |
  | 773 |  | return false; |
  | 774 |  | } elseif ($rule['check\_on'] == 'Price' && (~~$total\_price\_of\_this\_tag < $min || $total\_price\_of\_this\_tag > $max || empty($total\_price\_of\_this\_tag)~~)) { |
  |  | 756 | if ($rule['check\_on'] == 'TotalQuantity' && ( $total\_all\_units\_of\_this\_tag\_in\_cart < $min || $total\_all\_units\_of\_this\_tag\_in\_cart > $max || empty($total\_all\_units\_of\_this\_tag\_in\_cart) )) { |
  |  | 757 | return false; |
  |  | 758 | } elseif ($rule['check\_on'] == 'Quantity' && ( $total\_items\_of\_this\_tag\_in\_cart < $min || $total\_items\_of\_this\_tag\_in\_cart > $max || empty($total\_items\_of\_this\_tag\_in\_cart) )) { |
  |  | 759 | return false; |
  |  | 760 | } elseif ($rule['check\_on'] == 'Weight' && ( $total\_weight\_of\_this\_tag < $min || $total\_weight\_of\_this\_tag > $max || empty($total\_weight\_of\_this\_tag) )) { |
  |  | 761 | return false; |
  |  | 762 | } elseif ($rule['check\_on'] == 'Price' && ( $total\_price\_of\_this\_tag < $min || $total\_price\_of\_this\_tag > $max || empty($total\_price\_of\_this\_tag) )) { |
  | 775 | 763 | return false; |
  | 776 | 764 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L781) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L769) |  |
  | 781 | 769 | $\_product = wc\_get\_product($pid); |
  | 782 | 770 | $old\_price = $\_product->get\_price(); |
  | 783 |  | $rule['calculated\_discount'] = (~~(float)$old\_price - (float)$new\_price~~) \* $current\_quantity; |
  |  | 771 | $rule['calculated\_discount'] = ( (float) $old\_price - (float) $new\_price ) \* $current\_quantity; |
  | 784 | 772 | } |
  | 785 | 773 |  |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L788) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L776) |  |
  | 788 | 776 | } |
  | 789 | 777 |  |
  | 790 |  | function elex\_dp\_checkCartRuleApplicableForProduct(&$rule = null, $product = null, $pid = null, $current\_quantity = 1, $price = 0, $weight = 0) |
  | 791 |  | { |
  |  | 778 | function elex\_dp\_checkCartRuleApplicableForProduct( &$rule = null, $product = null, $pid = null, $current\_quantity = 1, $price = 0, $weight = 0) { |
  | 792 | 779 |  |
  | 793 | 780 | global $xa\_cart\_quantities; |
  | 794 | 781 | global $xa\_cart\_weight; |
  | 795 | 782 | global $xa\_cart\_price; |
  | 796 |  | $min  = (~~empty($rule['min']) == true~~) ? 1 : $rule['min']; |
  | 797 |  | $max  = (~~empty($rule['max']) == true~~) ? 999999999 : $rule['max']; |
  |  | 783 | $min  = ( empty($rule['min']) == true ) ? 1 : $rule['min']; |
  |  | 784 | $max  = ( empty($rule['max']) == true ) ? 999999999 : $rule['max']; |
  | 798 | 785 | $attr = $product->get\_attributes(); |
  | 799 | 786 | $attribute\_data = array(); |
  | 800 | 787 | foreach ($attr as $attribute\_name => $attribute) { |
  | 801 |  | if(is\_object($attribute)) { |
  |  | 788 | if (is\_object($attribute)) { |
  | 802 | 789 | $attribute\_values = $attribute->get\_options(); |
  | 803 | 790 |  |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L812) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L799) |  |
  | 812 | 799 | $attribute\_data[$attribute\_name] = $term\_slugs; |
  | 813 | 800 | } |
  | 814 |  | }~~else if(is\_string($attribute))~~{ |
  | 815 |  | $attribute\_data[$attribute\_name] = (array)$attribute; |
  |  | 801 | } else if (is\_string($attribute)) { |
  |  | 802 | $attribute\_data[$attribute\_name] = (array) $attribute; |
  | 816 | 803 |  |
  | 817 | 804 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L881) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L868) |  |
  | 881 | 868 | //if pid is selected in this rule |
  | 882 | 869 |  |
  | 883 |  | if (is\_cart() && (~~empty($pid) || !in\_array($pid, array\_keys($xa\_cart\_quantities))~~)) { |
  |  | 870 | if (is\_cart() && ( empty($pid) || !in\_array($pid, array\_keys($xa\_cart\_quantities)) )) { |
  | 884 | 871 | return false; |
  | 885 | 872 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L903) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L890) |  |
  | 903 | 890 | $total\_all\_units\_in\_cart += $\_qnty; |
  | 904 | 891 | if (!empty($xa\_cart\_weight[$\_pid])) { |
  | 905 |  | $total\_weight\_in\_cart += (~~$\_qnty \* $xa\_cart\_weight[$\_pid]~~); |
  |  | 892 | $total\_weight\_in\_cart += ( $\_qnty \* $xa\_cart\_weight[$\_pid] ); |
  | 906 | 893 | } |
  | 907 | 894 | if (!empty($xa\_cart\_price[$\_pid])) { |
  | 908 |  | $total\_price\_in\_cart += (~~$\_qnty \* $xa\_cart\_price[$\_pid]~~); |
  |  | 895 | $total\_price\_in\_cart += ( $\_qnty \* $xa\_cart\_price[$\_pid] ); |
  | 909 | 896 | } |
  | 910 | 897 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L912) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L899) |  |
  | 912 | 899 | //error\_log('total units=' . $total\_all\_units\_of\_this\_category\_in\_cart . " total items=" . $total\_items\_of\_this\_category\_in\_cart); |
  | 913 | 900 | //error\_log('total price=' . $total\_price\_of\_this\_category . " total weights=" . $total\_weight\_of\_this\_category); |
  | 914 |  | if ($rule['check\_on'] == 'TotalQuantity' && (~~$total\_all\_units\_in\_cart < $min || $total\_all\_units\_in\_cart > $max || empty($total\_all\_units\_in\_cart)~~)) { |
  | 915 |  | return false; |
  | 916 |  | } elseif ($rule['check\_on'] == 'Quantity' && (~~$total\_items\_in\_cart < $min || $total\_items\_in\_cart > $max || empty($total\_items\_in\_cart)~~)) { |
  | 917 |  | return false; |
  | 918 |  | } elseif ($rule['check\_on'] == 'Weight' && (~~$total\_weight\_in\_cart < $min || $total\_weight\_in\_cart > $max || empty($total\_weight\_in\_cart)~~)) { |
  | 919 |  | return false; |
  | 920 |  | } elseif ($rule['check\_on'] == 'Price' && (~~$total\_price\_in\_cart < $min || $total\_price\_in\_cart > $max || empty($total\_price\_in\_cart)~~)) { |
  |  | 901 | if ($rule['check\_on'] == 'TotalQuantity' && ( $total\_all\_units\_in\_cart < $min || $total\_all\_units\_in\_cart > $max || empty($total\_all\_units\_in\_cart) )) { |
  |  | 902 | return false; |
  |  | 903 | } elseif ($rule['check\_on'] == 'Quantity' && ( $total\_items\_in\_cart < $min || $total\_items\_in\_cart > $max || empty($total\_items\_in\_cart) )) { |
  |  | 904 | return false; |
  |  | 905 | } elseif ($rule['check\_on'] == 'Weight' && ( $total\_weight\_in\_cart < $min || $total\_weight\_in\_cart > $max || empty($total\_weight\_in\_cart) )) { |
  |  | 906 | return false; |
  |  | 907 | } elseif ($rule['check\_on'] == 'Price' && ( $total\_price\_in\_cart < $min || $total\_price\_in\_cart > $max || empty($total\_price\_in\_cart) )) { |
  | 921 | 908 | return false; |
  | 922 | 909 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L928) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L915) |  |
  | 928 | 915 | $\_product = wc\_get\_product($pid); |
  | 929 | 916 | $old\_price = $\_product->get\_price(); |
  | 930 |  | $rule['calculated\_discount'] = (~~(float)$old\_price - (float)$new\_price~~) \* $current\_quantity; |
  |  | 917 | $rule['calculated\_discount'] = ( (float) $old\_price - (float) $new\_price ) \* $current\_quantity; |
  | 931 | 918 | } |
  | 932 | 919 | //checking roles and tofrom date for which rule is applicable |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L934) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L921) |  |
  | 934 | 921 | } |
  | 935 | 922 |  |
  | 936 |  | function elex\_dp\_checkCombinationalRuleApplicableForProduct(&$rule = null, $product = null, $pid = null, $current\_quantity = 1, $price = 0, $weight = 0) |
  | 937 |  | { |
  |  | 923 | function elex\_dp\_checkCombinationalRuleApplicableForProduct( &$rule = null, $product = null, $pid = null, $current\_quantity = 1, $price = 0, $weight = 0) { |
  | 938 | 924 | global $xa\_cart\_quantities; |
  | 939 | 925 | $total\_units        = 0; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L965) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L951) |  |
  | 965 | 951 | } |
  | 966 | 952 | } |
  | 967 |  | if ((~~empty($xa\_cart\_quantities[$\_pid]) || $xa\_cart\_quantities[$\_pid] < $\_qnty) && ($total\_child\_qty == 0 || $total\_child\_qty < $\_qnty~~)) { |
  |  | 953 | if (( empty($xa\_cart\_quantities[$\_pid]) || $xa\_cart\_quantities[$\_pid] < $\_qnty ) && ( $total\_child\_qty == 0 || $total\_child\_qty < $\_qnty )) { |
  | 968 | 954 | if ($\_pid != $check\_for\_pid || empty($xa\_cart\_quantities[$pid]) || $xa\_cart\_quantities[$pid] < $\_qnty) { //code to consider parent id of variable products |
  | 969 | 955 | return false; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L976) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L962) |  |
  | 976 | 962 | } |
  | 977 | 963 | $rule['discount\_on\_product\_id'] = elex\_dp\_WPML\_Compatible\_ids($rule['discount\_on\_product\_id']); |
  | 978 |  | if (!empty($rule['discount\_on\_product\_id']) && is\_array($rule['discount\_on\_product\_id']) && (~~!in\_array($pid, $rule['discount\_on\_product\_id']) && !in\_array($product->get\_parent\_id(), $rule['discount\_on\_product\_id'])~~)) { |
  |  | 964 | if (!empty($rule['discount\_on\_product\_id']) && is\_array($rule['discount\_on\_product\_id']) && ( !in\_array($pid, $rule['discount\_on\_product\_id']) && !in\_array($product->get\_parent\_id(), $rule['discount\_on\_product\_id']) )) { |
  | 979 | 965 | return false; |
  | 980 | 966 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L985) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L971) |  |
  | 985 | 971 | $\_product = wc\_get\_product($pid); |
  | 986 | 972 | $old\_price = $\_product->get\_price(); |
  | 987 |  | $rule['calculated\_discount'] = (~~(float)$old\_price - (float)$new\_price~~) \* $current\_quantity; |
  |  | 973 | $rule['calculated\_discount'] = ( (float) $old\_price - (float) $new\_price ) \* $current\_quantity; |
  | 988 | 974 | } |
  | 989 | 975 | //checking roles and tofrom date for which rule is applicable |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L991) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L977) |  |
  | 991 | 977 | } |
  | 992 | 978 |  |
  | 993 |  | function elex\_dp\_checkProductRuleApplicableForProduct(&$rule = null, $product = null, $pid = null, $current\_quantity = 1, $price = 0, $weight = 0) |
  | 994 |  | { |
  |  | 979 | function elex\_dp\_checkProductRuleApplicableForProduct( &$rule = null, $product = null, $pid = null, $current\_quantity = 1, $price = 0, $weight = 0) { |
  | 995 | 980 | global $xa\_cart\_categories; |
  | 996 | 981 | global $xa\_cart\_quantities; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1000) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L985) |  |
  | 1000 | 985 | $pid = elex\_dp\_get\_pid($product); |
  | 1001 | 986 | } |
  | 1002 |  | $min          = (~~empty($rule['min']) == true~~) ? 1 : $rule['min']; |
  | 1003 |  | $max          = (~~empty($rule['max']) == true~~) ? 999999999 : $rule['max']; |
  | 1004 |  | $total\_price  = !empty($price) ? (~~$price \* $current\_quantity~~) : 0; |
  | 1005 |  | $total\_weight = !empty($weight) ? (~~(float)$weight \* $current\_quantity~~) : 0; |
  |  | 987 | $min          = ( empty($rule['min']) == true ) ? 1 : $rule['min']; |
  |  | 988 | $max          = ( empty($rule['max']) == true ) ? 999999999 : $rule['max']; |
  |  | 989 | $total\_price  = !empty($price) ? ( $price \* $current\_quantity ) : 0; |
  |  | 990 | $total\_weight = !empty($weight) ? ( (float) $weight \* $current\_quantity ) : 0; |
  | 1006 | 991 | if ($max < $min && $max != 0) { |
  | 1007 | 992 | return false; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1040) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L1025) |  |
  | 1040 | 1025 | if ($rule['rule\_on'] == 'products') { |
  | 1041 | 1026 | $pids = elex\_dp\_WPML\_Compatible\_ids($rule['product\_id']); |
  | 1042 |  | if (empty($pids) || (~~!is\_array($pids) || (!in\_array($check\_for\_pid, $pids) && !in\_array($pid, $pids))~~)) { |
  |  | 1027 | if (empty($pids) || ( !is\_array($pids) || ( !in\_array($check\_for\_pid, $pids) && !in\_array($pid, $pids) ) )) { |
  | 1043 | 1028 | return false; |
  | 1044 | 1029 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1074) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L1059) |  |
  | 1074 | 1059 | if ($rule['check\_on'] == 'Quantity') { |
  | 1075 | 1060 |  |
  | 1076 |  | if (is\_cart() && (~~empty($pid) || !in\_array($pid, array\_keys($xa\_cart\_quantities))~~)) { |
  |  | 1061 | if (is\_cart() && ( empty($pid) || !in\_array($pid, array\_keys($xa\_cart\_quantities)) )) { |
  | 1077 | 1062 | return false; |
  | 1078 | 1063 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1095) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L1080) |  |
  | 1095 | 1080 | foreach ($xa\_cart\_quantities as $\_pid => $\_qnty) { |
  | 1096 | 1081 | $total\_items\_in\_cart++; |
  | 1097 |  | if~~($pids && in\_array($\_pid, $pids))~~{ |
  |  | 1082 | if ($pids && in\_array($\_pid, $pids)) { |
  | 1098 | 1083 | $total\_all\_product\_items++; |
  | 1099 | 1084 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1102) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L1087) |  |
  | 1102 | 1087 |  |
  | 1103 | 1088 | //Conditions for different rule type |
  | 1104 |  | if ('products' === $rule['rule\_on'] && in\_array($pid, $rule\_product\_ids) && (~~$total\_all\_product\_items < $min || ($total\_all\_product\_items > $max && $repeat == false) || empty($total\_all\_product\_items)~~)) { |
  | 1105 |  | return false; |
  |  | 1089 | if ('products' === $rule['rule\_on'] && in\_array($pid, $rule\_product\_ids) && ( $total\_all\_product\_items < $min || ( $total\_all\_product\_items > $max && $repeat == false ) || empty($total\_all\_product\_items) )) { |
  |  | 1090 | return false; |
  | 1106 | 1091 |  |
  | 1107 |  | }else if ('categories' === $rule['rule\_on'] && $this->validate\_product\_matches\_categories(wc\_get\_product($pid), $rule)) { |
  |  | 1092 | } else if ('categories' === $rule['rule\_on'] && $this->validate\_product\_matches\_categories(wc\_get\_product($pid), $rule)) { |
  | 1108 | 1093 | $tmp=elex\_dp\_get\_category\_ids($pid); |
  | 1109 | 1094 | $product\_categories=!empty($tmp)?$tmp:array(); |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1113) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L1098) |  |
  | 1113 | 1098 | } |
  | 1114 | 1099 | foreach ($xa\_cart\_categories as $\_pid => $\_categories) { |
  | 1115 |  | $match=array\_intersect($matched,$\_categories); |
  |  | 1100 | $match=array\_intersect($matched, $\_categories); |
  | 1116 | 1101 | if (!empty($match)) { |
  | 1117 | 1102 | $total\_items\_of\_this\_category\_in\_cart++; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1126) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L1111) |  |
  | 1126 | 1111 | $total\_all\_units\_of\_this\_category\_in\_cart = 1; |
  | 1127 | 1112 | } |
  | 1128 |  | if~~($total\_items\_of\_this\_category\_in\_cart < $min || (($total\_items\_of\_this\_category\_in\_cart > $max && $repeat == false)) || empty($total\_items\_of\_this\_category\_in\_cart))~~{ |
  | 1129 |  | return false; |
  | 1130 |  | } |
  | 1131 |  |  |
  | 1132 |  | }~~else if (('cart' === $rule['rule\_on'])  && ($total\_items\_in\_cart < $min || (($total\_items\_in\_cart > $max && $repeat == false)) || empty($total\_items\_in\_cart)~~)) { |
  | 1133 |  | return false; |
  | 1134 |  | } |
  | 1135 |  | } elseif ($rule['check\_on'] == 'Weight' && (~~$total\_weight < $min || ($total\_weight > $max && $repeat == false) || empty($total\_weight)~~)) { |
  | 1136 |  | return false; |
  | 1137 |  | } elseif ($rule['check\_on'] == 'Price' && (~~$total\_price < $min || ($total\_price > $max && $repeat == false) || empty($total\_price)~~)) { |
  | 1138 |  | return false; |
  | 1139 |  | } elseif ($rule['check\_on'] == 'Units' && (~~$current\_quantity < $min || ($current\_quantity > $max && $repeat == false)~~)) { |
  |  | 1113 | if ($total\_items\_of\_this\_category\_in\_cart < $min || ( ( $total\_items\_of\_this\_category\_in\_cart > $max && $repeat == false ) ) || empty($total\_items\_of\_this\_category\_in\_cart)) { |
  |  | 1114 | return false; |
  |  | 1115 | } |
  |  | 1116 |  |
  |  | 1117 | } else if (( 'cart' === $rule['rule\_on'] )  && ( $total\_items\_in\_cart < $min || ( ( $total\_items\_in\_cart > $max && $repeat == false ) ) || empty($total\_items\_in\_cart) )) { |
  |  | 1118 | return false; |
  |  | 1119 | } |
  |  | 1120 | } elseif ($rule['check\_on'] == 'Weight' && ( $total\_weight < $min || ( $total\_weight > $max && $repeat == false ) || empty($total\_weight) )) { |
  |  | 1121 | return false; |
  |  | 1122 | } elseif ($rule['check\_on'] == 'Price' && ( $total\_price < $min || ( $total\_price > $max && $repeat == false ) || empty($total\_price) )) { |
  |  | 1123 | return false; |
  |  | 1124 | } elseif ($rule['check\_on'] == 'Units' && ( $current\_quantity < $min || ( $current\_quantity > $max && $repeat == false ) )) { |
  | 1140 | 1125 | return false; |
  | 1141 | 1126 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1147) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L1132) |  |
  | 1147 | 1132 | $\_product = wc\_get\_product($pid); |
  | 1148 | 1133 | $old\_price = $\_product->get\_price(); |
  | 1149 |  | $rule['calculated\_discount'] = (~~(float)$old\_price - (float)$new\_price~~) \* $current\_quantity; |
  |  | 1134 | $rule['calculated\_discount'] = ( (float) $old\_price - (float) $new\_price ) \* $current\_quantity; |
  | 1150 | 1135 | } |
  | 1151 | 1136 | //checking roles and tofrom date for which rule is applicable |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1153) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L1138) |  |
  | 1153 | 1138 | } |
  | 1154 | 1139 |  |
  | 1155 |  | function elex\_dp\_check\_date\_range\_and\_roles($rule, $rule\_type) |
  | 1156 |  | { |
  |  | 1140 | function elex\_dp\_check\_date\_range\_and\_roles( $rule, $rule\_type) { |
  | 1157 | 1141 | $fromdate   = $rule['from\_date']; |
  | 1158 | 1142 | $todate     = $rule['to\_date']; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1180) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L1164) |  |
  | 1180 | 1164 | $match = array\_intersect((array) $user\_roles, (array) $current\_user->roles); |
  | 1181 | 1165 | if (!in\_array('all', $user\_roles) && empty($match) && !empty($user\_roles)) { |
  | 1182 |  | if (!(~~in\_array('guest\_user', $user\_roles) && !is\_user\_logged\_in()~~)) { |
  |  | 1166 | if (!( in\_array('guest\_user', $user\_roles) && !is\_user\_logged\_in() )) { |
  | 1183 | 1167 | return false; |
  | 1184 | 1168 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1186) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L1170) |  |
  | 1186 | 1170 |  |
  | 1187 | 1171 | $now = current\_time('d-m-Y'); |
  | 1188 |  | if ((~~empty($fromdate) && empty($todate)) || (empty($fromdate) && empty($todate) == false && (strtotime($now) <= strtotime($todate))) || (empty($fromdate) == false && (strtotime($now) >= strtotime($fromdate)) && empty($todate)) || ((strtotime($now) >= strtotime($fromdate)) && (strtotime($now) <= strtotime($todate))~~)) { |
  |  | 1172 | if (( empty($fromdate) && empty($todate) ) || ( empty($fromdate) && empty($todate) == false && ( strtotime($now) <= strtotime($todate) ) ) || ( empty($fromdate) == false && ( strtotime($now) >= strtotime($fromdate) ) && empty($todate) ) || ( ( strtotime($now) >= strtotime($fromdate) ) && ( strtotime($now) <= strtotime($todate) ) )) { |
  | 1189 | 1173 | } else { |
  | 1190 | 1174 | return false; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1194) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L1178) |  |
  | 1194 | 1178 | } |
  | 1195 | 1179 |  |
  | 1196 |  | public function elex\_dp\_execute\_rule($old\_price, $rule\_type\_colon\_rule\_no, $rule, $current\_quantity = 1, $pid = 0, $object\_hash = '') |
  | 1197 |  | { |
  |  | 1180 | public function elex\_dp\_execute\_rule( $old\_price, $rule\_type\_colon\_rule\_no, $rule, $current\_quantity = 1, $pid = 0, $object\_hash = '') { |
  | 1198 | 1181 | global $executed\_rule\_pid\_price, $executed\_pids; |
  | 1199 | 1182 | $new\_price = $old\_price; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1245) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L1228) |  |
  | 1245 | 1228 | } |
  | 1246 | 1229 |  |
  | 1247 |  | public function elex\_dp\_calculate\_discount($old\_price, $rule\_no, $rule, $pid = 0, $current\_quantity = 1, $do\_not\_execute = false) |
  | 1248 |  | { |
  |  | 1230 | public function elex\_dp\_calculate\_discount( $old\_price, $rule\_no, $rule, $pid = 0, $current\_quantity = 1, $do\_not\_execute = false) { |
  | 1249 | 1231 | global $xa\_common\_flat\_discount, $xa\_cart\_quantities, $executed\_rule\_pid\_price, $xa\_cart\_categories\_units, $xa\_cart\_categories, $xa\_cart\_price; |
  | 1250 | 1232 | $new\_price           = $old\_price; |
  | 1251 |  | $type\_code           = $rule['rule\_type'] == 'product\_rules'  ?  (~~$rule['rule\_type'] . $pid~~)   :  $rule['rule\_type']; |
  |  | 1233 | $type\_code           = $rule['rule\_type'] == 'product\_rules'  ?  ( $rule['rule\_type'] . $pid )   :  $rule['rule\_type']; |
  | 1252 | 1234 | $cart\_quantity       = 0; |
  | 1253 | 1235 | $prev\_total\_discount = 0; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1269) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L1251) |  |
  | 1269 | 1251 | $rprice               = isset($xa\_cart\_price[$ppid]) ?  $xa\_cart\_price[$ppid] : 0; |
  | 1270 | 1252 | $sprice               = isset($executed\_rule\_pid\_price[$rule['rule\_type'] . ':' . $rule\_no][$ppid]) ?  $executed\_rule\_pid\_price[$rule['rule\_type'] . ':' . $rule\_no][$ppid] : $rprice; |
  | 1271 |  | $prev\_total\_discount += (~~$rprice - $sprice~~) \* $qnty; |
  |  | 1253 | $prev\_total\_discount += ( $rprice - $sprice ) \* $qnty; |
  | 1272 | 1254 | } |
  | 1273 | 1255 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1283) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L1265) |  |
  | 1283 | 1265 | $rprice               = isset($xa\_cart\_price[$ppid]) ?  $xa\_cart\_price[$ppid] : 0; |
  | 1284 | 1266 | $sprice               = isset($executed\_rule\_pid\_price[$rule['rule\_type'] . ':' . $rule\_no][$ppid]) ?  $executed\_rule\_pid\_price[$rule['rule\_type'] . ':' . $rule\_no][$ppid] : $rprice; |
  | 1285 |  | $prev\_total\_discount += (~~$rprice - $sprice~~) \* $units; |
  |  | 1267 | $prev\_total\_discount += ( $rprice - $sprice ) \* $units; |
  | 1286 | 1268 | } |
  | 1287 | 1269 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1303) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L1285) |  |
  | 1303 | 1285 | $discount\_amt = floatval($value) \* floatval($old\_price) / 100; |
  | 1304 | 1286 | } elseif ($discount\_type == 'Flat Discount') { |
  | 1305 |  | if~~($current\_quantity)~~{ |
  |  | 1287 | if ($current\_quantity) { |
  | 1306 | 1288 | if ($do\_not\_execute === true) { |
  | 1307 | 1289 | $discount\_amt = floatval($value); |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1312) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L1294) |  |
  | 1312 | 1294 | } elseif ($discount\_type == 'Fixed Price') { |
  | 1313 | 1295 | $discount\_amt = floatval($old\_price) - floatval($value); |
  | 1314 |  | } elseif~~($discount\_type == 'Coupon Discount')~~{ |
  | 1315 |  |  |
  | 1316 |  | if~~($rule['coupon\_discount\_type'] == 'percent')~~{ |
  |  | 1296 | } elseif ($discount\_type == 'Coupon Discount') { |
  |  | 1297 |  |
  |  | 1298 | if ($rule['coupon\_discount\_type'] == 'percent') { |
  | 1317 | 1299 |  |
  | 1318 | 1300 | $discount\_amt = floatval($value) \* floatval($old\_price) / 100; |
  | 1319 |  | } elseif ($rule['coupon\_discount\_type'] == 'fixed\_cart'){ |
  | 1320 |  | if~~($current\_quantity)~~{ |
  |  | 1301 | } elseif ($rule['coupon\_discount\_type'] == 'fixed\_cart') { |
  |  | 1302 | if ($current\_quantity) { |
  | 1321 | 1303 | if ($do\_not\_execute === true) { |
  | 1322 | 1304 | $discount\_amt = floatval($value); |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1326) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L1308) |  |
  | 1326 | 1308 | } |
  | 1327 | 1309 |  |
  | 1328 |  | } elseif ($rule['coupon\_discount\_type'] == 'fixed\_product'){ |
  |  | 1310 | } elseif ($rule['coupon\_discount\_type'] == 'fixed\_product') { |
  | 1329 | 1311 | $discount\_amt = floatval($old\_price) - floatval($value); |
  | 1330 | 1312 | } else { |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1339) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L1321) |  |
  | 1339 | 1321 | } |
  | 1340 | 1322 |  |
  | 1341 |  | if (!empty($max\_discount) && is\_numeric($max\_discount) && (~~(($discount\_amt \* $cart\_quantity) + $prev\_total\_discount) >= $max\_discount~~)) { |
  | 1342 |  | $discount\_amt = (~~$max\_discount - $prev\_total\_discount~~) / $cart\_quantity; |
  |  | 1323 | if (!empty($max\_discount) && is\_numeric($max\_discount) && ( ( ( $discount\_amt \* $cart\_quantity ) + $prev\_total\_discount ) >= $max\_discount )) { |
  |  | 1324 | $discount\_amt = ( $max\_discount - $prev\_total\_discount ) / $cart\_quantity; |
  | 1343 | 1325 | } |
  | 1344 | 1326 |  |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1348) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L1330) |  |
  | 1348 | 1330 |  |
  | 1349 | 1331 | } |
  | 1350 |  | ~~if($old\_price && $discount\_amt)~~{ |
  | 1351 |  | $new\_price = (float)~~$old\_price - (float)~~$discount\_amt; |
  |  | 1332 | if ($old\_price && $discount\_amt) { |
  |  | 1333 | $new\_price = (float) $old\_price - (float) $discount\_amt; |
  | 1352 | 1334 | } |
  | 1353 | 1335 | if (isset($\_GET['debug']) && $do\_not\_execute == false) { |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1357) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L1339) |  |
  | 1357 | 1339 | if (!empty($rule['discount\_on\_product\_id']) && in\_array($pid, $rule['discount\_on\_product\_id']) && !empty($rule['product\_id'][$pid]) && !empty($xa\_cart\_quantities[$pid]) && $rule['product\_id'][$pid] < $xa\_cart\_quantities[$pid]) { |
  | 1358 | 1340 | $remaining\_qnty = $xa\_cart\_quantities[$pid] - $rule['product\_id'][$pid]; |
  | 1359 |  | $new\_price      =  (~~($new\_price \* $rule['product\_id'][$pid]) + ($old\_price \* $remaining\_qnty)~~) / $xa\_cart\_quantities[$pid]; |
  |  | 1341 | $new\_price      =  ( ( $new\_price \* $rule['product\_id'][$pid] ) + ( $old\_price \* $remaining\_qnty ) ) / $xa\_cart\_quantities[$pid]; |
  | 1360 | 1342 | } |
  | 1361 | 1343 | return $new\_price; |
  | 1362 | 1344 | } |
  | 1363 | 1345 |  |
  | 1364 |  | public function elex\_dp\_SimpleExecute($old\_price, $rule\_no, $rule, $pid = 0, $current\_quantity = 1, $do\_not\_execute = false, $object\_hash = '') |
  | 1365 |  | { |
  |  | 1346 | public function elex\_dp\_SimpleExecute( $old\_price, $rule\_no, $rule, $pid = 0, $current\_quantity = 1, $do\_not\_execute = false, $object\_hash = '') { |
  | 1366 | 1347 | global $xa\_common\_flat\_discount, $xa\_cart\_quantities, $executed\_rule\_pid\_price, $xa\_cart\_categories\_units, $xa\_cart\_categories, $xa\_cart\_price; |
  | 1367 | 1348 | $new\_price           = $old\_price; |
  | 1368 |  | $type\_code           = $rule['rule\_type'] == 'product\_rules'  ?  (~~$rule['rule\_type'] . $pid~~)   :  $rule['rule\_type']; |
  |  | 1349 | $type\_code           = $rule['rule\_type'] == 'product\_rules'  ?  ( $rule['rule\_type'] . $pid )   :  $rule['rule\_type']; |
  | 1369 | 1350 | $cart\_quantity       = 0; |
  | 1370 | 1351 | $prev\_total\_discount = 0; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1386) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L1367) |  |
  | 1386 | 1367 | $rprice               = isset($xa\_cart\_price[$ppid]) ?  $xa\_cart\_price[$ppid] : 0; |
  | 1387 | 1368 | $sprice               = isset($executed\_rule\_pid\_price[$rule['rule\_type'] . ':' . $rule\_no][$ppid]) ?  $executed\_rule\_pid\_price[$rule['rule\_type'] . ':' . $rule\_no][$ppid] : $rprice; |
  | 1388 |  | $prev\_total\_discount += (~~$rprice - $sprice~~) \* $qnty; |
  |  | 1369 | $prev\_total\_discount += ( $rprice - $sprice ) \* $qnty; |
  | 1389 | 1370 | } |
  | 1390 | 1371 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1400) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L1381) |  |
  | 1400 | 1381 | $rprice               = isset($xa\_cart\_price[$ppid]) ?  $xa\_cart\_price[$ppid] : 0; |
  | 1401 | 1382 | $sprice               = isset($executed\_rule\_pid\_price[$rule['rule\_type'] . ':' . $rule\_no][$ppid]) ?  $executed\_rule\_pid\_price[$rule['rule\_type'] . ':' . $rule\_no][$ppid] : $rprice; |
  | 1402 |  | $prev\_total\_discount += (~~$rprice - $sprice~~) \* $units; |
  |  | 1383 | $prev\_total\_discount += ( $rprice - $sprice ) \* $units; |
  | 1403 | 1384 | } |
  | 1404 | 1385 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1420) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L1401) |  |
  | 1420 | 1401 | $discount\_amt = floatval($value) \* floatval($old\_price) / 100; |
  | 1421 | 1402 | } elseif ($discount\_type == 'Flat Discount') { |
  | 1422 |  | if~~($current\_quantity)~~{ |
  |  | 1403 | if ($current\_quantity) { |
  | 1423 | 1404 | if ($do\_not\_execute === true) { |
  | 1424 | 1405 | $discount\_amt = floatval($value); |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1437) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L1418) |  |
  | 1437 | 1418 | } |
  | 1438 | 1419 |  |
  | 1439 |  | if (!empty($max\_discount) && is\_numeric($max\_discount) && (~~(($discount\_amt \* $cart\_quantity) + $prev\_total\_discount) >= $max\_discount~~)) { |
  | 1440 |  | $discount\_amt = (~~$max\_discount - $prev\_total\_discount~~) / $cart\_quantity; |
  |  | 1420 | if (!empty($max\_discount) && is\_numeric($max\_discount) && ( ( ( $discount\_amt \* $cart\_quantity ) + $prev\_total\_discount ) >= $max\_discount )) { |
  |  | 1421 | $discount\_amt = ( $max\_discount - $prev\_total\_discount ) / $cart\_quantity; |
  | 1441 | 1422 | } |
  | 1442 | 1423 |  |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1453) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L1434) |  |
  | 1453 | 1434 | if (!empty($rule['discount\_on\_product\_id']) && in\_array($pid, $rule['discount\_on\_product\_id']) && !empty($rule['product\_id'][$pid]) && !empty($xa\_cart\_quantities[$pid]) && $rule['product\_id'][$pid] < $xa\_cart\_quantities[$pid]) { |
  | 1454 | 1435 | $remaining\_qnty = $xa\_cart\_quantities[$pid] - $rule['product\_id'][$pid]; |
  | 1455 |  | $new\_price      =  (~~($new\_price \* $rule['product\_id'][$pid]) + ($old\_price \* $remaining\_qnty)~~) / $xa\_cart\_quantities[$pid]; |
  |  | 1436 | $new\_price      =  ( ( $new\_price \* $rule['product\_id'][$pid] ) + ( $old\_price \* $remaining\_qnty ) ) / $xa\_cart\_quantities[$pid]; |
  | 1456 | 1437 | } |
  | 1457 | 1438 | ///// adding to cache |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1465) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L1446) |  |
  | 1465 | 1446 | } |
  | 1466 | 1447 |  |
  | 1467 |  | public function elex\_dp\_Simple\_Category\_Combinational\_Execute($old\_price, $rule\_no, $rule, $pid = 0, $current\_quantity = 1, $do\_not\_execute = false, $object\_hash = '') |
  | 1468 |  | { |
  |  | 1448 | public function elex\_dp\_Simple\_Category\_Combinational\_Execute( $old\_price, $rule\_no, $rule, $pid = 0, $current\_quantity = 1, $do\_not\_execute = false, $object\_hash = '') { |
  | 1469 | 1449 | global $xa\_common\_flat\_discount, $xa\_cart\_quantities, $executed\_rule\_pid\_price, $xa\_cart\_categories\_units, $xa\_cart\_categories, $xa\_cart\_price; |
  | 1470 | 1450 | $new\_price           = $old\_price; |
  | 1471 |  | $type\_code           = $rule['rule\_type'] == 'product\_rules'  ?  (~~$rule['rule\_type'] . $pid~~)   :  $rule['rule\_type']; |
  |  | 1451 | $type\_code           = $rule['rule\_type'] == 'product\_rules'  ?  ( $rule['rule\_type'] . $pid )   :  $rule['rule\_type']; |
  | 1472 | 1452 | $prev\_total\_discount = 0; |
  | 1473 | 1453 | $cart\_quantity       = isset($xa\_cart\_quantities[$pid]) ?  $xa\_cart\_quantities[$pid] : 0; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1478) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L1458) |  |
  | 1478 | 1458 | $rprice               = isset($xa\_cart\_price[$ppid]) ?  $xa\_cart\_price[$ppid] : 0; |
  | 1479 | 1459 | $sprice               = isset($executed\_rule\_pid\_price[$rule['rule\_type'] . ':' . $rule\_no][$ppid]) ?  $executed\_rule\_pid\_price[$rule['rule\_type'] . ':' . $rule\_no][$ppid] : $rprice; |
  | 1480 |  | $prev\_total\_discount += (~~$rprice - $sprice~~) \* $qnty; |
  |  | 1460 | $prev\_total\_discount += ( $rprice - $sprice ) \* $qnty; |
  | 1481 | 1461 | } |
  | 1482 | 1462 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1489) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L1469) |  |
  | 1489 | 1469 | $discount\_amt = floatval($value) \* floatval($old\_price) / 100; |
  | 1490 | 1470 | } elseif ($discount\_type == 'Flat Discount') { |
  | 1491 |  | if~~($current\_quantity)~~{ |
  |  | 1471 | if ($current\_quantity) { |
  | 1492 | 1472 | if ($do\_not\_execute === true) { |
  | 1493 | 1473 | $discount\_amt = floatval($value); |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1506) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L1486) |  |
  | 1506 | 1486 | } |
  | 1507 | 1487 |  |
  | 1508 |  | if (!empty($max\_discount) && is\_numeric($max\_discount) && (~~(($discount\_amt \* $cart\_quantity) + $prev\_total\_discount) >= $max\_discount~~)) { |
  | 1509 |  | $discount\_amt = (~~$max\_discount - $prev\_total\_discount~~) / $cart\_quantity; |
  |  | 1488 | if (!empty($max\_discount) && is\_numeric($max\_discount) && ( ( ( $discount\_amt \* $cart\_quantity ) + $prev\_total\_discount ) >= $max\_discount )) { |
  |  | 1489 | $discount\_amt = ( $max\_discount - $prev\_total\_discount ) / $cart\_quantity; |
  | 1510 | 1490 | } |
  | 1511 | 1491 |  |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1522) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L1502) |  |
  | 1522 | 1502 | if (!empty($rule['discount\_on\_product\_id']) && in\_array($pid, $rule['discount\_on\_product\_id']) && !empty($rule['product\_id'][$pid]) && !empty($xa\_cart\_quantities[$pid]) && $rule['product\_id'][$pid] < $xa\_cart\_quantities[$pid]) { |
  | 1523 | 1503 | $remaining\_qnty = $xa\_cart\_quantities[$pid] - $rule['product\_id'][$pid]; |
  | 1524 |  | $new\_price      =  (~~($new\_price \* $rule['product\_id'][$pid]) + ($old\_price \* $remaining\_qnty)~~) / $xa\_cart\_quantities[$pid]; |
  |  | 1504 | $new\_price      =  ( ( $new\_price \* $rule['product\_id'][$pid] ) + ( $old\_price \* $remaining\_qnty ) ) / $xa\_cart\_quantities[$pid]; |
  | 1525 | 1505 | } |
  | 1526 | 1506 | ///// adding to cache |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1534) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L1514) |  |
  | 1534 | 1514 | } |
  | 1535 | 1515 |  |
  | 1536 |  | public function elex\_dp\_Simple\_Combinational\_Execute($old\_price, $rule\_no, $rule, $pid = 0, $current\_quantity = 1, $do\_not\_execute = false, $object\_hash = '') |
  | 1537 |  | { |
  |  | 1516 | public function elex\_dp\_Simple\_Combinational\_Execute( $old\_price, $rule\_no, $rule, $pid = 0, $current\_quantity = 1, $do\_not\_execute = false, $object\_hash = '') { |
  | 1538 | 1517 | global $xa\_common\_flat\_discount, $xa\_cart\_quantities, $executed\_rule\_pid\_price, $xa\_cart\_categories\_units, $xa\_cart\_categories, $xa\_cart\_price; |
  | 1539 | 1518 | $new\_price           = $old\_price; |
  | 1540 |  | $type\_code           = $rule['rule\_type'] == 'product\_rules'  ?  (~~$rule['rule\_type'] . $pid~~)   :  $rule['rule\_type']; |
  |  | 1519 | $type\_code           = $rule['rule\_type'] == 'product\_rules'  ?  ( $rule['rule\_type'] . $pid )   :  $rule['rule\_type']; |
  | 1541 | 1520 | $prev\_total\_discount = 0; |
  | 1542 | 1521 | $cart\_quantity       = isset($xa\_cart\_quantities[$pid]) ?  $xa\_cart\_quantities[$pid] : 0; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1546) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L1525) |  |
  | 1546 | 1525 | $rprice               = isset($xa\_cart\_price[$ppid]) ?  $xa\_cart\_price[$ppid] : 0; |
  | 1547 | 1526 | $sprice               = isset($executed\_rule\_pid\_price[$rule['rule\_type'] . ':' . $rule\_no][$ppid]) ?  $executed\_rule\_pid\_price[$rule['rule\_type'] . ':' . $rule\_no][$ppid] : $rprice; |
  | 1548 |  | $prev\_total\_discount += (~~$rprice - $sprice~~) \* $qnty; |
  |  | 1527 | $prev\_total\_discount += ( $rprice - $sprice ) \* $qnty; |
  | 1549 | 1528 | } |
  | 1550 | 1529 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1557) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L1536) |  |
  | 1557 | 1536 | $discount\_amt = floatval($value) \* floatval($old\_price) / 100; |
  | 1558 | 1537 | } elseif ($discount\_type == 'Flat Discount') { |
  | 1559 |  | if~~($current\_quantity)~~{ |
  |  | 1538 | if ($current\_quantity) { |
  | 1560 | 1539 | if ($do\_not\_execute === true) { |
  | 1561 | 1540 | $discount\_amt = floatval($value); |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1574) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L1553) |  |
  | 1574 | 1553 | } |
  | 1575 | 1554 |  |
  | 1576 |  | if (!empty($max\_discount) && is\_numeric($max\_discount) && (~~(($discount\_amt \* $cart\_quantity) + $prev\_total\_discount) >= $max\_discount~~)) { |
  | 1577 |  | $discount\_amt = (~~$max\_discount - $prev\_total\_discount~~) / $cart\_quantity; |
  |  | 1555 | if (!empty($max\_discount) && is\_numeric($max\_discount) && ( ( ( $discount\_amt \* $cart\_quantity ) + $prev\_total\_discount ) >= $max\_discount )) { |
  |  | 1556 | $discount\_amt = ( $max\_discount - $prev\_total\_discount ) / $cart\_quantity; |
  | 1578 | 1557 | } |
  | 1579 | 1558 |  |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1591) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L1570) |  |
  | 1591 | 1570 | // removed this code to make restrictions work for any quantity |
  | 1592 | 1571 | //$remaining\_qnty=$xa\_cart\_quantities[$pid]-$rule['product\_id'][$pid]; |
  | 1593 |  | $new\_price =  (~~$new\_price \* $rule['product\_id'][$pid]~~); // + ($old\_price \* $remaining\_qnty ))/$xa\_cart\_quantities[$pid]; |
  |  | 1572 | $new\_price =  ( $new\_price \* $rule['product\_id'][$pid] ); // + ($old\_price \* $remaining\_qnty ))/$xa\_cart\_quantities[$pid]; |
  | 1594 | 1573 | } |
  | 1595 | 1574 | ///// adding to cache |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1604) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L1583) |  |
  | 1604 | 1583 |  |
  | 1605 | 1584 |  |
  | 1606 |  | public function elex\_dp\_Simple\_Cart\_Execute($old\_price, $rule\_no, $rule, $pid = 0, $current\_quantity = 1, $do\_not\_execute = false, $object\_hash = '') |
  | 1607 |  | { |
  |  | 1585 | public function elex\_dp\_Simple\_Cart\_Execute( $old\_price, $rule\_no, $rule, $pid = 0, $current\_quantity = 1, $do\_not\_execute = false, $object\_hash = '') { |
  | 1608 | 1586 | global $xa\_common\_flat\_discount, $xa\_cart\_quantities, $executed\_rule\_pid\_price, $xa\_cart\_categories\_units, $xa\_cart\_categories, $xa\_cart\_price; |
  | 1609 | 1587 | $new\_price           = $old\_price; |
  | 1610 |  | $type\_code           = $rule['rule\_type'] == 'product\_rules'  ?  (~~$rule['rule\_type'] . $pid~~)   :  $rule['rule\_type']; |
  |  | 1588 | $type\_code           = $rule['rule\_type'] == 'product\_rules'  ?  ( $rule['rule\_type'] . $pid )   :  $rule['rule\_type']; |
  | 1611 | 1589 | $cart\_quantity       = 0; |
  | 1612 | 1590 | $prev\_total\_discount = 0; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1617) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L1595) |  |
  | 1617 | 1595 | $rprice               = isset($xa\_cart\_price[$ppid]) ?  $xa\_cart\_price[$ppid] : 0; |
  | 1618 | 1596 | $sprice               = isset($executed\_rule\_pid\_price[$rule['rule\_type'] . ':' . $rule\_no][$ppid]) ?  $executed\_rule\_pid\_price[$rule['rule\_type'] . ':' . $rule\_no][$ppid] : $rprice; |
  | 1619 |  | $prev\_total\_discount += (~~$rprice - $sprice~~) \* $qnty; |
  |  | 1597 | $prev\_total\_discount += ( $rprice - $sprice ) \* $qnty; |
  | 1620 | 1598 | } |
  | 1621 | 1599 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1629) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L1607) |  |
  | 1629 | 1607 | $discount\_amt = floatval($value) \* floatval($old\_price) / 100; |
  | 1630 | 1608 | } elseif ($discount\_type == 'Flat Discount') { |
  | 1631 |  | if~~($current\_quantity)~~{ |
  |  | 1609 | if ($current\_quantity) { |
  | 1632 | 1610 | if ($do\_not\_execute === true) { |
  | 1633 | 1611 | $discount\_amt = floatval($value); |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1646) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L1624) |  |
  | 1646 | 1624 | } |
  | 1647 | 1625 |  |
  | 1648 |  | if (!empty($max\_discount) && is\_numeric($max\_discount) && (~~(($discount\_amt \* $cart\_quantity) + $prev\_total\_discount) >= $max\_discount~~)) { |
  | 1649 |  | $discount\_amt = (~~$max\_discount - $prev\_total\_discount~~) / $cart\_quantity; |
  |  | 1626 | if (!empty($max\_discount) && is\_numeric($max\_discount) && ( ( ( $discount\_amt \* $cart\_quantity ) + $prev\_total\_discount ) >= $max\_discount )) { |
  |  | 1627 | $discount\_amt = ( $max\_discount - $prev\_total\_discount ) / $cart\_quantity; |
  | 1650 | 1628 | } |
  | 1651 | 1629 |  |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1661) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L1639) |  |
  | 1661 | 1639 | if (!empty($rule['discount\_on\_product\_id']) && in\_array($pid, $rule['discount\_on\_product\_id']) && !empty($rule['product\_id'][$pid]) && !empty($xa\_cart\_quantities[$pid]) && $rule['product\_id'][$pid] < $xa\_cart\_quantities[$pid]) { |
  | 1662 | 1640 | $remaining\_qnty = $xa\_cart\_quantities[$pid] - $rule['product\_id'][$pid]; |
  | 1663 |  | $new\_price      =  (~~($new\_price \* $rule['product\_id'][$pid]) + ($old\_price \* $remaining\_qnty)~~) / $xa\_cart\_quantities[$pid]; |
  |  | 1641 | $new\_price      =  ( ( $new\_price \* $rule['product\_id'][$pid] ) + ( $old\_price \* $remaining\_qnty ) ) / $xa\_cart\_quantities[$pid]; |
  | 1664 | 1642 | } |
  | 1665 | 1643 | ///// adding to cache |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1674) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L1652) |  |
  | 1674 | 1652 |  |
  | 1675 | 1653 |  |
  | 1676 |  | public function elex\_dp\_Simple\_Category\_Execute($old\_price, $rule\_no, $rule, $pid = 0, $current\_quantity = 1, $do\_not\_execute = false, $object\_hash = '') |
  | 1677 |  | { |
  |  | 1654 | public function elex\_dp\_Simple\_Category\_Execute( $old\_price, $rule\_no, $rule, $pid = 0, $current\_quantity = 1, $do\_not\_execute = false, $object\_hash = '') { |
  | 1678 | 1655 | global $xa\_common\_flat\_discount, $xa\_cart\_quantities, $executed\_rule\_pid\_price, $xa\_cart\_categories\_units, $xa\_cart\_categories, $xa\_cart\_price; |
  | 1679 | 1656 | $new\_price           = $old\_price; |
  | 1680 |  | $type\_code           = $rule['rule\_type'] == 'product\_rules'  ?  (~~$rule['rule\_type'] . $pid~~)   :  $rule['rule\_type']; |
  |  | 1657 | $type\_code           = $rule['rule\_type'] == 'product\_rules'  ?  ( $rule['rule\_type'] . $pid )   :  $rule['rule\_type']; |
  | 1681 | 1658 | $cart\_quantity       = 0; |
  | 1682 | 1659 | $prev\_total\_discount = 0; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1694) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L1671) |  |
  | 1694 | 1671 | $rprice               = isset($xa\_cart\_price[$ppid]) ?  $xa\_cart\_price[$ppid] : 0; |
  | 1695 | 1672 | $sprice               = isset($executed\_rule\_pid\_price[$rule['rule\_type'] . ':' . $rule\_no][$ppid]) ?  $executed\_rule\_pid\_price[$rule['rule\_type'] . ':' . $rule\_no][$ppid] : $rprice; |
  | 1696 |  | $prev\_total\_discount += (~~$rprice - $sprice~~) \* $units; |
  |  | 1673 | $prev\_total\_discount += ( $rprice - $sprice ) \* $units; |
  | 1697 | 1674 | } |
  | 1698 | 1675 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1710) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L1687) |  |
  | 1710 | 1687 | $discount\_amt = floatval($value) \* floatval($old\_price) / 100; |
  | 1711 | 1688 | } elseif ($discount\_type == 'Flat Discount') { |
  | 1712 |  | if~~($current\_quantity)~~{ |
  |  | 1689 | if ($current\_quantity) { |
  | 1713 | 1690 | if ($do\_not\_execute === true) { |
  | 1714 | 1691 | $discount\_amt = floatval($value); |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1723) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L1700) |  |
  | 1723 | 1700 | } |
  | 1724 | 1701 |  |
  | 1725 |  | if (!empty($max\_discount) && is\_numeric($max\_discount) && (~~(($discount\_amt \* $cart\_quantity) + $prev\_total\_discount) >= $max\_discount~~)) { |
  | 1726 |  | $discount\_amt = (~~$max\_discount - $prev\_total\_discount~~) / $cart\_quantity; |
  |  | 1702 | if (!empty($max\_discount) && is\_numeric($max\_discount) && ( ( ( $discount\_amt \* $cart\_quantity ) + $prev\_total\_discount ) >= $max\_discount )) { |
  |  | 1703 | $discount\_amt = ( $max\_discount - $prev\_total\_discount ) / $cart\_quantity; |
  | 1727 | 1704 | } |
  | 1728 | 1705 |  |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1738) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L1715) |  |
  | 1738 | 1715 | if (!empty($rule['discount\_on\_product\_id']) && in\_array($pid, $rule['discount\_on\_product\_id']) && !empty($rule['product\_id'][$pid]) && !empty($xa\_cart\_quantities[$pid]) && $rule['product\_id'][$pid] < $xa\_cart\_quantities[$pid]) { |
  | 1739 | 1716 | $remaining\_qnty = $xa\_cart\_quantities[$pid] - $rule['product\_id'][$pid]; |
  | 1740 |  | $new\_price      =  (~~($new\_price \* $rule['product\_id'][$pid]) + ($old\_price \* $remaining\_qnty)~~) / $xa\_cart\_quantities[$pid]; |
  |  | 1717 | $new\_price      =  ( ( $new\_price \* $rule['product\_id'][$pid] ) + ( $old\_price \* $remaining\_qnty ) ) / $xa\_cart\_quantities[$pid]; |
  | 1741 | 1718 | } |
  | 1742 | 1719 | ///// adding to cache |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1750) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L1727) |  |
  | 1750 | 1727 | } |
  | 1751 | 1728 |  |
  | 1752 |  | public function elex\_dp\_Simple\_Tag\_Execute($old\_price, $rule\_no, $rule, $pid = 0, $current\_quantity = 1, $do\_not\_execute = false, $object\_hash = '') |
  | 1753 |  | { |
  |  | 1729 | public function elex\_dp\_Simple\_Tag\_Execute( $old\_price, $rule\_no, $rule, $pid = 0, $current\_quantity = 1, $do\_not\_execute = false, $object\_hash = '') { |
  | 1754 | 1730 | global $xa\_common\_flat\_discount, $xa\_cart\_quantities, $executed\_rule\_pid\_price, $xa\_cart\_tags\_units, $xa\_cart\_tags, $xa\_cart\_price; |
  | 1755 | 1731 | $new\_price           = $old\_price; |
  | 1756 |  | $type\_code           = $rule['rule\_type'] == 'product\_rules'  ?  (~~$rule['rule\_type'] . $pid~~)   :  $rule['rule\_type']; |
  |  | 1732 | $type\_code           = $rule['rule\_type'] == 'product\_rules'  ?  ( $rule['rule\_type'] . $pid )   :  $rule['rule\_type']; |
  | 1757 | 1733 | $cart\_quantity       = 0; |
  | 1758 | 1734 | $prev\_total\_discount = 0; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1770) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L1746) |  |
  | 1770 | 1746 | $rprice               = isset($xa\_cart\_price[$ppid]) ?  $xa\_cart\_price[$ppid] : 0; |
  | 1771 | 1747 | $sprice               = isset($executed\_rule\_pid\_price[$rule['rule\_type'] . ':' . $rule\_no][$ppid]) ?  $executed\_rule\_pid\_price[$rule['rule\_type'] . ':' . $rule\_no][$ppid] : $rprice; |
  | 1772 |  | $prev\_total\_discount += (~~$rprice - $sprice~~) \* $units; |
  |  | 1748 | $prev\_total\_discount += ( $rprice - $sprice ) \* $units; |
  | 1773 | 1749 | } |
  | 1774 | 1750 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1786) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L1762) |  |
  | 1786 | 1762 | $discount\_amt = floatval($value) \* floatval($old\_price) / 100; |
  | 1787 | 1763 | } elseif ($discount\_type == 'Flat Discount') { |
  | 1788 |  | if~~($current\_quantity)~~{ |
  |  | 1764 | if ($current\_quantity) { |
  | 1789 | 1765 | if ($do\_not\_execute === true) { |
  | 1790 | 1766 | $discount\_amt = floatval($value); |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1799) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L1775) |  |
  | 1799 | 1775 | } |
  | 1800 | 1776 |  |
  | 1801 |  | if (!empty($max\_discount) && is\_numeric($max\_discount) && (~~(($discount\_amt \* $cart\_quantity) + $prev\_total\_discount) >= $max\_discount~~)) { |
  | 1802 |  | $discount\_amt = (~~$max\_discount - $prev\_total\_discount~~) / $cart\_quantity; |
  |  | 1777 | if (!empty($max\_discount) && is\_numeric($max\_discount) && ( ( ( $discount\_amt \* $cart\_quantity ) + $prev\_total\_discount ) >= $max\_discount )) { |
  |  | 1778 | $discount\_amt = ( $max\_discount - $prev\_total\_discount ) / $cart\_quantity; |
  | 1803 | 1779 | } |
  | 1804 | 1780 |  |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1814) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L1790) |  |
  | 1814 | 1790 | if (!empty($rule['discount\_on\_product\_id']) && in\_array($pid, $rule['discount\_on\_product\_id']) && !empty($rule['product\_id'][$pid]) && !empty($xa\_cart\_quantities[$pid]) && $rule['product\_id'][$pid] < $xa\_cart\_quantities[$pid]) { |
  | 1815 | 1791 | $remaining\_qnty = $xa\_cart\_quantities[$pid] - $rule['product\_id'][$pid]; |
  | 1816 |  | $new\_price      =  (~~($new\_price \* $rule['product\_id'][$pid]) + ($old\_price \* $remaining\_qnty)~~) / $xa\_cart\_quantities[$pid]; |
  |  | 1792 | $new\_price      =  ( ( $new\_price \* $rule['product\_id'][$pid] ) + ( $old\_price \* $remaining\_qnty ) ) / $xa\_cart\_quantities[$pid]; |
  | 1817 | 1793 | } |
  | 1818 | 1794 | ///// adding to cache |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1826) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L1802) |  |
  | 1826 | 1802 | } |
  | 1827 | 1803 |  |
  | 1828 |  | public function elex\_dp\_ExecuteBOGORule($old\_price, $rule\_no, $rule, $pid = 0, $current\_quantity = 1) |
  | 1829 |  | { |
  |  | 1804 | public function elex\_dp\_ExecuteBOGORule( $old\_price, $rule\_no, $rule, $pid = 0, $current\_quantity = 1) { |
  | 1830 | 1805 | global $xa\_dp\_setting; |
  | 1831 | 1806 | global $woocommerce; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1844) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L1819) |  |
  | 1844 | 1819 | foreach ($rule['purchased\_product\_id'] as $\_pid => $\_qnty) { |
  | 1845 | 1820 | if (!empty($xa\_cart\_quantities[$\_pid]) && !empty($\_qnty) && $xa\_cart\_quantities[$\_pid] > $\_qnty) { |
  | 1846 |  | $tmp = (int) (~~$xa\_cart\_quantities[$\_pid] / $\_qnty~~); |
  |  | 1821 | $tmp = (int) ( $xa\_cart\_quantities[$\_pid] / $\_qnty ); |
  | 1847 | 1822 | if ($tmp > 1 && $tmp < $multiple) { |
  | 1848 | 1823 | $multiple = $tmp; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1859) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L1834) |  |
  | 1859 | 1834 | } |
  | 1860 | 1835 | if ($total\_childs\_qty\_in\_cart) { |
  | 1861 |  | $tmp = (int) (~~$total\_childs\_qty\_in\_cart / $\_qnty~~); |
  |  | 1836 | $tmp = (int) ( $total\_childs\_qty\_in\_cart / $\_qnty ); |
  | 1862 | 1837 | if ($tmp > 1 && $tmp < $multiple) { |
  | 1863 | 1838 | $multiple = $tmp; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1873) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L1848) |  |
  | 1873 | 1848 |  |
  | 1874 | 1849 | //If free product is set |
  | 1875 |  | if (!isset($rule['set\_free\_option']) || (~~isset($rule['set\_free\_option']) && $rule['set\_free\_option'] == 'select\_product'~~)) { |
  |  | 1850 | if (!isset($rule['set\_free\_option']) || ( isset($rule['set\_free\_option']) && $rule['set\_free\_option'] == 'select\_product' )) { |
  | 1876 | 1851 |  |
  | 1877 | 1852 | ////////if free product is already in cart with exact quanitty this code will set its price as zero |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1888) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L1863) |  |
  | 1888 | 1863 | $free\_unit = $free\_unit > $unit ? $unit : $free\_unit; |
  | 1889 | 1864 |  |
  | 1890 |  | if~~(array\_key\_exists($pid, $rule['purchased\_product\_id']) && array\_key\_exists($pid, $rule['free\_product\_id']))~~{ |
  | 1891 |  | if~~($free\_unit >= $unit)~~{ |
  | 1892 |  | $free\_unit = $unit - (int)$rule['purchased\_product\_id'][$pid]; |
  | 1893 |  | }~~else~~{ |
  | 1894 |  | $free\_unit = (~~$rule['free\_product\_id'][$pid]~~); |
  | 1895 |  | } |
  | 1896 |  | } |
  | 1897 |  | if ($all\_free\_product\_present == true && (~~is\_cart() || is\_ajax() || is\_checkout()~~)) { |
  |  | 1865 | if (array\_key\_exists($pid, $rule['purchased\_product\_id']) && array\_key\_exists($pid, $rule['free\_product\_id'])) { |
  |  | 1866 | if ($free\_unit >= $unit) { |
  |  | 1867 | $free\_unit = $unit - (int) $rule['purchased\_product\_id'][$pid]; |
  |  | 1868 | } else { |
  |  | 1869 | $free\_unit = ( $rule['free\_product\_id'][$pid] ); |
  |  | 1870 | } |
  |  | 1871 | } |
  |  | 1872 | if ($all\_free\_product\_present == true && ( is\_cart() || is\_ajax() || is\_checkout() )) { |
  | 1898 | 1873 | $total\_adjustment\_price = 0; |
  | 1899 | 1874 | if (isset($adjustment) && is\_numeric($adjustment)) { |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1906) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L1881) |  |
  | 1906 | 1881 | $total\_adjustment\_price = 0; |
  | 1907 | 1882 | } |
  | 1908 |  | if ((~~$unit - (float) $free\_unit \* $multiple~~) < 0) { //to make repeat rule work with auto add disabled |
  |  | 1883 | if (( $unit - (float) $free\_unit \* $multiple ) < 0) { //to make repeat rule work with auto add disabled |
  | 1909 | 1884 | $total\_old\_price = 0; |
  | 1910 | 1885 | } else { |
  | 1911 |  | $total\_old\_price = $old\_price \* (~~$unit - (float) $free\_unit \* $multiple~~); |
  |  | 1886 | $total\_old\_price = $old\_price \* ( $unit - (float) $free\_unit \* $multiple ); |
  | 1912 | 1887 | } |
  | 1913 | 1888 | if ($xa\_dp\_setting['auto\_add\_free\_product\_on\_off'] == 'on') { |
  | 1914 | 1889 | return  $old\_price; |
  | 1915 | 1890 | } else { |
  | 1916 |  | return (~~($total\_old\_price + $total\_adjustment\_price) / $unit~~); |
  |  | 1891 | return ( ( $total\_old\_price + $total\_adjustment\_price ) / $unit ); |
  | 1917 | 1892 | } |
  | 1918 | 1893 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1977) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L1952) |  |
  | 1977 | 1952 |  |
  | 1978 | 1953 |  |
  | 1979 |  | if ((~~$pid == $product\_tosetfree~~)) { |
  |  | 1954 | if (( $pid == $product\_tosetfree )) { |
  | 1980 | 1955 |  |
  | 1981 | 1956 | $unit      = isset($xa\_cart\_quantities[$product\_tosetfree]) ? $xa\_cart\_quantities[$product\_tosetfree] : 1; |
  | 1982 | 1957 | $free\_unit = $cheapest\_product\_quantity > $unit ? $unit : $cheapest\_product\_quantity; |
  | 1983 | 1958 |  |
  | 1984 |  | if~~(array\_key\_exists($pid, $rule['purchased\_product\_id']))~~{ |
  | 1985 |  | if~~($cheapest\_product\_quantity >= $unit)~~{ |
  | 1986 |  | $free\_unit = $unit - (int)$rule['purchased\_product\_id'][$pid]; |
  | 1987 |  | }~~else~~{ |
  |  | 1959 | if (array\_key\_exists($pid, $rule['purchased\_product\_id'])) { |
  |  | 1960 | if ($cheapest\_product\_quantity >= $unit) { |
  |  | 1961 | $free\_unit = $unit - (int) $rule['purchased\_product\_id'][$pid]; |
  |  | 1962 | } else { |
  | 1988 | 1963 | $free\_unit = $cheapest\_product\_quantity ; |
  | 1989 | 1964 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1994) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L1969) |  |
  | 1994 | 1969 | } |
  | 1995 | 1970 |  |
  | 1996 |  | if ($all\_free\_product\_present == true && (~~is\_cart() || is\_ajax() || is\_checkout()~~)) { |
  |  | 1971 | if ($all\_free\_product\_present == true && ( is\_cart() || is\_ajax() || is\_checkout() )) { |
  | 1997 | 1972 | $total\_adjustment\_price = 0; |
  | 1998 | 1973 | if (isset($adjustment) && is\_numeric($adjustment)) { |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L2005) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L1980) |  |
  | 2005 | 1980 | $total\_adjustment\_price = 0; |
  | 2006 | 1981 | } |
  | 2007 |  | if ((~~$unit - (float) $free\_unit \* $multiple~~) < 0) { //to make repeat rule work with auto add disabled |
  |  | 1982 | if (( $unit - (float) $free\_unit \* $multiple ) < 0) { //to make repeat rule work with auto add disabled |
  | 2008 | 1983 | $total\_old\_price = 0; |
  | 2009 | 1984 | } else { |
  | 2010 |  | $total\_old\_price = $old\_price \* (~~$unit - (float) $free\_unit \* $multiple~~); |
  | 2011 |  | } |
  | 2012 |  | return (~~($total\_old\_price + $total\_adjustment\_price) / $unit~~); |
  |  | 1985 | $total\_old\_price = $old\_price \* ( $unit - (float) $free\_unit \* $multiple ); |
  |  | 1986 | } |
  |  | 1987 | return ( ( $total\_old\_price + $total\_adjustment\_price ) / $unit ); |
  | 2013 | 1988 | } |
  | 2014 | 1989 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L2029) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L2004) |  |
  | 2029 | 2004 | return $old\_price; |
  | 2030 | 2005 | } |
  | 2031 |  | public function elex\_dp\_ExecuteBOGO\_category\_Rule($old\_price, $rule\_no, $rule, $pid = 0, $current\_quantity = 1) |
  | 2032 |  | { |
  |  | 2006 | public function elex\_dp\_ExecuteBOGO\_category\_Rule( $old\_price, $rule\_no, $rule, $pid = 0, $current\_quantity = 1) { |
  | 2033 | 2007 | global $xa\_dp\_setting; |
  | 2034 | 2008 | global $woocommerce; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L2047) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L2021) |  |
  | 2047 | 2021 |  |
  | 2048 | 2022 | //If free product is set |
  | 2049 |  | if (!isset($rule['set\_free\_option']) || (~~isset($rule['set\_free\_option']) && $rule['set\_free\_option'] == 'select\_product'~~)) { |
  |  | 2023 | if (!isset($rule['set\_free\_option']) || ( isset($rule['set\_free\_option']) && $rule['set\_free\_option'] == 'select\_product' )) { |
  | 2050 | 2024 |  |
  | 2051 | 2025 | ////////if free product is already in cart with exact quanitty this code will set its price as zero |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L2066) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L2040) |  |
  | 2066 | 2040 | foreach ($rule['purchased\_category\_id'] as $\_cid => $\_qnty\_and\_checkon) { |
  | 2067 | 2041 |  |
  | 2068 |  | if ((~~array\_key\_exists($pid, $rule['free\_product\_id'])) && in\_array($\_cid, $product\_categories) && !($xa\_cart\_categories\_items[$\_cid] > 1~~)) { |
  |  | 2042 | if (( array\_key\_exists($pid, $rule['free\_product\_id']) ) && in\_array($\_cid, $product\_categories) && !( $xa\_cart\_categories\_items[$\_cid] > 1 )) { |
  | 2069 | 2043 | $add\_if\_not\_auto = $add\_if\_not\_auto + 1; |
  | 2070 | 2044 | } |
  | 2071 | 2045 | } |
  | 2072 |  | if~~($add\_if\_not\_auto > 0)~~{ |
  | 2073 |  | if~~($free\_unit >= $unit)~~{ |
  |  | 2046 | if ($add\_if\_not\_auto > 0) { |
  |  | 2047 | if ($free\_unit >= $unit) { |
  | 2074 | 2048 | $free\_unit = $unit - 1; |
  | 2075 | 2049 | } |
  | 2076 | 2050 | } |
  | 2077 | 2051 |  |
  | 2078 |  | if ($all\_free\_product\_present == true && (~~is\_cart() || is\_checkout()~~)) { |
  |  | 2052 | if ($all\_free\_product\_present == true && ( is\_cart() || is\_checkout() )) { |
  | 2079 | 2053 | $total\_adjustment\_price = 0; |
  | 2080 | 2054 | if (isset($adjustment) && is\_numeric($adjustment)) { |
  | 2081 | 2055 | $total\_adjustment\_price = $adjustment \* $free\_unit; |
  | 2082 | 2056 | } |
  | 2083 |  | $total\_old\_price = $old\_price \* (~~$unit - (float) $free\_unit~~); |
  |  | 2057 | $total\_old\_price = $old\_price \* ( $unit - (float) $free\_unit ); |
  | 2084 | 2058 | if ($xa\_dp\_setting['auto\_add\_free\_product\_on\_off'] == 'on') { |
  | 2085 | 2059 | return  $old\_price; |
  | 2086 | 2060 | } else { |
  | 2087 |  | return (~~($total\_old\_price + $total\_adjustment\_price)~~) / $unit; |
  |  | 2061 | return ( ( $total\_old\_price + $total\_adjustment\_price ) ) / $unit; |
  | 2088 | 2062 | } |
  | 2089 | 2063 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L2141) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L2115) |  |
  | 2141 | 2115 |  |
  | 2142 | 2116 | ////////if free product is already in cart with exact quanitty this code will set its price as zero |
  | 2143 |  | if ((~~$pid == $product\_tosetfree~~)) { |
  |  | 2117 | if (( $pid == $product\_tosetfree )) { |
  | 2144 | 2118 |  |
  | 2145 | 2119 | $product\_categories = !empty($xa\_cart\_categories[$pid]) ? $xa\_cart\_categories[$pid] : array(); |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L2148) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L2122) |  |
  | 2148 | 2122 | foreach ($rule['purchased\_category\_id'] as $\_cid => $\_qnty\_and\_checkon) { |
  | 2149 | 2123 |  |
  | 2150 |  | if ((~~$pid == $product\_tosetfree) && in\_array($\_cid, $product\_categories) && !($xa\_cart\_categories\_items[$\_cid] > 1~~)) { |
  |  | 2124 | if (( $pid == $product\_tosetfree ) && in\_array($\_cid, $product\_categories) && !( $xa\_cart\_categories\_items[$\_cid] > 1 )) { |
  | 2151 | 2125 | $add\_if\_not\_auto = $add\_if\_not\_auto + 1; |
  | 2152 | 2126 | } |
  | 2153 | 2127 | } |
  | 2154 |  | if~~($add\_if\_not\_auto > 0)~~{ |
  | 2155 |  | if~~($cheapest\_product\_quantity >= $unit)~~{ |
  |  | 2128 | if ($add\_if\_not\_auto > 0) { |
  |  | 2129 | if ($cheapest\_product\_quantity >= $unit) { |
  | 2156 | 2130 | $free\_unit = $unit - 1; |
  | 2157 |  | }~~else~~{ |
  |  | 2131 | } else { |
  | 2158 | 2132 | $free\_unit = $cheapest\_product\_quantity ; |
  | 2159 | 2133 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L2164) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L2138) |  |
  | 2164 | 2138 | } |
  | 2165 | 2139 |  |
  | 2166 |  | if ($all\_free\_product\_present == true && (~~is\_cart() || is\_checkout()~~)) { |
  |  | 2140 | if ($all\_free\_product\_present == true && ( is\_cart() || is\_checkout() )) { |
  | 2167 | 2141 |  |
  | 2168 | 2142 | $total\_adjustment\_price = 0; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L2171) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L2145) |  |
  | 2171 | 2145 | } |
  | 2172 | 2146 |  |
  | 2173 |  | $total\_old\_price = $old\_price \* (~~$unit - (float) $free\_unit~~); |
  | 2174 |  |  |
  | 2175 |  | return (~~($total\_old\_price + $total\_adjustment\_price)~~) / $unit; |
  |  | 2147 | $total\_old\_price = $old\_price \* ( $unit - (float) $free\_unit ); |
  |  | 2148 |  |
  |  | 2149 | return ( ( $total\_old\_price + $total\_adjustment\_price ) ) / $unit; |
  | 2176 | 2150 | } |
  | 2177 | 2151 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L2185) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L2159) |  |
  | 2185 | 2159 | } |
  | 2186 | 2160 |  |
  | 2187 |  | public function elex\_dp\_Executebogo\_tag\_rules($old\_price, $rule\_no, $rule, $pid = 0, $current\_quantity = 1) |
  | 2188 |  | { |
  |  | 2161 | public function elex\_dp\_Executebogo\_tag\_rules( $old\_price, $rule\_no, $rule, $pid = 0, $current\_quantity = 1) { |
  | 2189 | 2162 | global $xa\_dp\_setting; |
  | 2190 | 2163 | global $woocommerce; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L2217) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L2190) |  |
  | 2217 | 2190 | } |
  | 2218 | 2191 | if ($count != 0) { |
  | 2219 |  | $tmp = (int) (~~$count / $\_qnty~~); |
  |  | 2192 | $tmp = (int) ( $count / $\_qnty ); |
  | 2220 | 2193 | if ($tmp > 1 && $tmp < $multiple) { |
  | 2221 | 2194 | $multiple = $tmp; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L2231) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L2204) |  |
  | 2231 | 2204 |  |
  | 2232 | 2205 | if ($total\_items\_with\_tag != 0) { |
  | 2233 |  | $tmp = (int) (~~$total\_items\_with\_tag / $\_qnty~~); |
  |  | 2206 | $tmp = (int) ( $total\_items\_with\_tag / $\_qnty ); |
  | 2234 | 2207 | if ($tmp > 1 && $tmp < $multiple) { |
  | 2235 | 2208 | $multiple = $tmp; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L2244) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L2217) |  |
  | 2244 | 2217 |  |
  | 2245 | 2218 | //If free product is set |
  | 2246 |  | if (!isset($rule['set\_free\_option']) || (~~isset($rule['set\_free\_option']) && $rule['set\_free\_option'] == 'select\_product'~~)) { |
  |  | 2219 | if (!isset($rule['set\_free\_option']) || ( isset($rule['set\_free\_option']) && $rule['set\_free\_option'] == 'select\_product' )) { |
  | 2247 | 2220 |  |
  | 2248 | 2221 | ////////if free product is already in cart with exact quanitty this code will set its price as zero |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L2263) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L2236) |  |
  | 2263 | 2236 | foreach ($rule['purchased\_tag\_id'] as $\_cid => $\_qnty\_and\_checkon) { |
  | 2264 | 2237 |  |
  | 2265 |  | if ((~~array\_key\_exists($pid, $rule['free\_product\_id'])) && in\_array($\_cid, $product\_tags) && !($xa\_cart\_tags\_items[$\_cid] > 1~~)) { |
  |  | 2238 | if (( array\_key\_exists($pid, $rule['free\_product\_id']) ) && in\_array($\_cid, $product\_tags) && !( $xa\_cart\_tags\_items[$\_cid] > 1 )) { |
  | 2266 | 2239 | $add\_if\_not\_auto = $add\_if\_not\_auto + 1; |
  | 2267 | 2240 | } |
  | 2268 | 2241 |  |
  | 2269 | 2242 | } |
  | 2270 |  | if~~($add\_if\_not\_auto > 0)~~{ |
  | 2271 |  | if~~($free\_unit >= $unit)~~{ |
  |  | 2243 | if ($add\_if\_not\_auto > 0) { |
  |  | 2244 | if ($free\_unit >= $unit) { |
  | 2272 | 2245 | $free\_unit = $unit - 1; |
  | 2273 | 2246 | } |
  | 2274 | 2247 | } |
  | 2275 | 2248 |  |
  | 2276 |  | if ($all\_free\_product\_present == true && (~~is\_cart() || is\_checkout()~~)) { |
  |  | 2249 | if ($all\_free\_product\_present == true && ( is\_cart() || is\_checkout() )) { |
  | 2277 | 2250 | $total\_adjustment\_price = 0; |
  | 2278 | 2251 | if (isset($adjustment) && is\_numeric($adjustment)) { |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L2285) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L2258) |  |
  | 2285 | 2258 | $total\_adjustment\_price = 0; |
  | 2286 | 2259 | } |
  | 2287 |  | if ((~~$unit - (float) $free\_unit \* $multiple~~) < 0) { //to make repeat rule work with auto add disabled |
  |  | 2260 | if (( $unit - (float) $free\_unit \* $multiple ) < 0) { //to make repeat rule work with auto add disabled |
  | 2288 | 2261 | $total\_old\_price = 0; |
  | 2289 | 2262 | } else { |
  | 2290 |  | $total\_old\_price = $old\_price \* (~~$unit - (float) $free\_unit \* $multiple~~); |
  |  | 2263 | $total\_old\_price = $old\_price \* ( $unit - (float) $free\_unit \* $multiple ); |
  | 2291 | 2264 | } |
  | 2292 | 2265 | if ($xa\_dp\_setting['auto\_add\_free\_product\_on\_off'] == 'on') { |
  | 2293 | 2266 | return  $old\_price; |
  | 2294 | 2267 | } else { |
  | 2295 |  | return (~~($total\_old\_price + $total\_adjustment\_price)~~) / $unit; |
  |  | 2268 | return ( ( $total\_old\_price + $total\_adjustment\_price ) ) / $unit; |
  | 2296 | 2269 | } |
  | 2297 | 2270 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L2349) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L2322) |  |
  | 2349 | 2322 |  |
  | 2350 | 2323 | ////////if free product is already in cart with exact quanitty this code will set its price as zero |
  | 2351 |  | if ((~~$pid == $product\_tosetfree~~)) { |
  |  | 2324 | if (( $pid == $product\_tosetfree )) { |
  | 2352 | 2325 |  |
  | 2353 | 2326 | $product\_tags = !empty($xa\_cart\_tags[$pid]) ? $xa\_cart\_tags[$pid] : array(); |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L2356) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L2329) |  |
  | 2356 | 2329 | foreach ($rule['purchased\_tag\_id'] as $\_cid => $\_qnty\_and\_checkon) { |
  | 2357 | 2330 |  |
  | 2358 |  | if ((~~$pid == $product\_tosetfree) && in\_array($\_cid, $product\_tags) && !($xa\_cart\_tags\_items[$\_cid] > 1~~)) { |
  |  | 2331 | if (( $pid == $product\_tosetfree ) && in\_array($\_cid, $product\_tags) && !( $xa\_cart\_tags\_items[$\_cid] > 1 )) { |
  | 2359 | 2332 | $add\_if\_not\_auto = $add\_if\_not\_auto + 1; |
  | 2360 | 2333 | } |
  | 2361 | 2334 | } |
  | 2362 |  | if~~($add\_if\_not\_auto > 0)~~{ |
  | 2363 |  | if~~($cheapest\_product\_quantity >= $unit)~~{ |
  |  | 2335 | if ($add\_if\_not\_auto > 0) { |
  |  | 2336 | if ($cheapest\_product\_quantity >= $unit) { |
  | 2364 | 2337 | $free\_unit = $unit - 1; |
  | 2365 |  | }~~else~~{ |
  |  | 2338 | } else { |
  | 2366 | 2339 | $free\_unit = $cheapest\_product\_quantity ; |
  | 2367 | 2340 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L2373) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L2346) |  |
  | 2373 | 2346 |  |
  | 2374 | 2347 |  |
  | 2375 |  | if ($all\_free\_product\_present == true && (~~is\_cart() || is\_checkout()~~)) { |
  |  | 2348 | if ($all\_free\_product\_present == true && ( is\_cart() || is\_checkout() )) { |
  | 2376 | 2349 |  |
  | 2377 | 2350 | $total\_adjustment\_price = 0; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L2385) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L2358) |  |
  | 2385 | 2358 | $total\_adjustment\_price = 0; |
  | 2386 | 2359 | } |
  | 2387 |  | if ((~~$unit - (float) $free\_unit \* $multiple~~) < 0) { //to make repeat rule work with auto add disabled |
  |  | 2360 | if (( $unit - (float) $free\_unit \* $multiple ) < 0) { //to make repeat rule work with auto add disabled |
  | 2388 | 2361 | $total\_old\_price = 0; |
  | 2389 | 2362 | } else { |
  | 2390 |  | $total\_old\_price = $old\_price \* (~~$unit - (float) $free\_unit \* $multiple~~); |
  | 2391 |  | } |
  | 2392 |  |  |
  | 2393 |  | return (~~($total\_old\_price + $total\_adjustment\_price)~~) / $unit; |
  |  | 2363 | $total\_old\_price = $old\_price \* ( $unit - (float) $free\_unit \* $multiple ); |
  |  | 2364 | } |
  |  | 2365 |  |
  |  | 2366 | return ( ( $total\_old\_price + $total\_adjustment\_price ) ) / $unit; |
  | 2394 | 2367 | } |
  | 2395 | 2368 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L2403) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L2376) |  |
  | 2403 | 2376 | } |
  | 2404 | 2377 |  |
  | 2405 |  | public function validate\_product\_matches\_categories($product, $rule) |
  | 2406 |  | { |
  |  | 2378 | public function validate\_product\_matches\_categories( $product, $rule) { |
  | 2407 | 2379 | if ($product->is\_type('variation')) { |
  | 2408 | 2380 | $parent\_id          = elex\_dp\_is\_wc\_version\_gt\_eql('2.7') ? $product->get\_parent\_id() : $product->parent->id; |
* ## [elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-single-product-offer-table.php](/changeset/3211131/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-single-product-offer-table.php "Show the changeset 3211131 restricted to elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-single-product-offer-table.php")

  | [r2965037](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-single-product-offer-table.php?rev=2965037#L14 "Show revision 2965037 of this file in browser") | [r3211131](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-single-product-offer-table.php?rev=3211131#L14 "Show revision 3211131 of this file in browser") |  |
  | --- | --- | --- |
  | 14 | 14 |  |
  | 15 | 15 | if (!empty($offers)) { |
  | 16 |  | ?> |
  |  | 16 | ?> |
  | 17 | 17 |  |
  | 18 | 18 | <style> |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-single-product-offer-table.php?rev=2965037#L33) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-single-product-offer-table.php?rev=3211131#L33) |  |
  | 33 | 33 | <?php |
  | 34 | 34 | foreach ($offers as $type\_rule\_no => $offer) { |
  | 35 |  | ?> |
  |  | 35 | ?> |
  | 36 | 36 | <li class="<?php echo $type\_rule\_no; ?>\_item  xa\_offer\_table\_list\_item "><span class="xa\_offer\_item\_span"><?php echo apply\_filters('wpml\_translate\_single\_string', $offer, 'eh-dynamic-pricing', $type\_rule\_no); ?></span></li> |
  | 37 | 37 | <?php |
* ## [elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-single-product-pricing-table.php](/changeset/3211131/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-single-product-pricing-table.php "Show the changeset 3211131 restricted to elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-single-product-pricing-table.php")

  | [r2965037](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-single-product-pricing-table.php?rev=2965037#L61 "Show revision 2965037 of this file in browser") | [r3211131](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-single-product-pricing-table.php?rev=3211131#L61 "Show revision 3211131 of this file in browser") |  |
  | --- | --- | --- |
  | 61 | 61 | //checking if product rules are enabled on settings page |
  | 62 | 62 | global $xa\_dp\_setting; |
  | 63 |  | if (!empty($xa\_dp\_setting['product\_rules\_on\_off']) && (~~'enable' !== $xa\_dp\_setting['product\_rules\_on\_off']~~)) { |
  |  | 63 | if (!empty($xa\_dp\_setting['product\_rules\_on\_off']) && ( 'enable' !== $xa\_dp\_setting['product\_rules\_on\_off'] )) { |
  | 64 | 64 | $product\_rules = array(); |
  | 65 | 65 | } else { |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-single-product-pricing-table.php?rev=2965037#L98) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-single-product-pricing-table.php?rev=3211131#L98) |  |
  | 98 | 98 | echo "<td class='xa\_sp\_table\_cell'> " . esc\_attr($rule['min']) . esc\_html(\_\_($unit, 'eh-dynamic-pricing-discounts')) . ' </td>'; |
  | 99 | 99 | echo "<td class='xa\_sp\_table\_cell'>"; |
  | 100 |  | echo (~~isset($rule['max']) ? esc\_html($rule['max']) : '-'~~); |
  |  | 100 | echo ( isset($rule['max']) ? esc\_html($rule['max']) : '-' ); |
  | 101 | 101 | echo ' ' . esc\_html(\_\_(isset($rule['max']) ? $unit : ' ', 'eh-dynamic-pricing-discounts')) . '</td>'; |
  | 102 | 102 | $currency\_pos = get\_option('woocommerce\_currency\_pos'); |
* ## [elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/readme.txt](/changeset/3211131/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/readme.txt "Show the changeset 3211131 restricted to elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/readme.txt")

  | [r3189520](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/readme.txt?rev=3189520#L5 "Show revision 3189520 of this file in browser") | [r3211131](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/readme.txt?rev=3211131#L5 "Show revision 3211131 of this file in browser") |  |
  | --- | --- | --- |
  | 5 | 5 | Tested up to: 6.7 |
  | 6 | 6 | Requires PHP: 7.4 |
  | 7 |  | Stable tag: 2.1.~~7~~ |
  |  | 7 | Stable tag: 2.1.8 |
  | 8 | 8 | License: GPLv2 or later |
  | 9 | 9 | License URI: http://www.gnu.org/licenses/gpl-2.0.html |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/readme.txt?rev=3189520#L142) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/readme.txt?rev=3211131#L142) |  |
  | 142 | 142 |  |
  | 143 | 143 | == Changelog == |
  |  | 144 | = 2.1.8 = |
  |  | 145 | \* Made compatible with WooCommerce 9.5 |
  |  | 146 | \* Corrected a vulnerability issue using Wordfence |
  |  | 147 | \* Optimized code to improve loading time |
  |  | 148 | \* Fixed an issue where the discount did not update when reducing the quantity |
  |  | 149 |  |
  | 144 | 150 | = 2.1.7 = |
  | 145 | 151 | \* Made compatible with WordPress 6.7 |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/readme.txt?rev=3189520#L291) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/readme.txt?rev=3211131#L297) |  |
  | 291 | 297 |  |
  | 292 | 298 | == Upgrade Notice == |
  |  | 299 | = 2.1.8 = |
  |  | 300 | \* Made compatible with WooCommerce 9.5 |
  |  | 301 | \* Corrected a vulnerability issue using Wordfence |
  |  | 302 | \* Optimized code to improve loading time |
  |  | 303 | \* Fixed an issue where the discount did not update when reducing the quantity |
  |  | 304 |  |
  | 293 | 305 | = 2.1.7 = |
  | 294 | 306 | \* Made compatible with WordPress 6.7 |
* ## [elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/data/category\_rules/elex-save-options.php](/changeset/3211131/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/data/category_rules/elex-save-options.php "Show the changeset 3211131 restricted to elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/data/category_rules/elex-save-options.php")

  | [r3049195](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/data/category_rules/elex-save-options.php?rev=3049195#L22 "Show revision 3049195 of this file in browser") | [r3211131](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/data/category_rules/elex-save-options.php?rev=3211131#L22 "Show revision 3211131 of this file in browser") |  |
  | --- | --- | --- |
  | 22 | 22 | $prev\_data = get\_option('xa\_dp\_rules', $dummy\_settings); |
  | 23 | 23 | $new\_rule = array( |
  | 24 |  | 'offer\_name'             => sanitize\_text\_field($\_REQUEST['offer\_name']), |
  | 25 |  | 'category\_id'            => array\_map('sanitize\_text\_field', $\_REQUEST['category\_id']), |
  | 26 |  | 'check\_on'               => sanitize\_text\_field($\_REQUEST['check\_on']), |
  | 27 |  | 'min'                    => sanitize\_text\_field($\_REQUEST['min']), |
  | 28 |  | 'max'                    => !empty($\_REQUEST['max']) ? sanitize\_text\_field($\_REQUEST['max']) : null, |
  | 29 |  | 'discount\_type'          => sanitize\_text\_field($\_REQUEST['discount\_type']), |
  | 30 |  | 'value'                  => sanitize\_text\_field($\_REQUEST['value']), |
  |  | 24 | 'offer\_name'             => sanitize\_text\_field($\_REQUEST['offer\_name']), |
  |  | 25 | 'category\_id'            => array\_map('sanitize\_text\_field', $\_REQUEST['category\_id']), |
  |  | 26 | 'check\_on'               => sanitize\_text\_field($\_REQUEST['check\_on']), |
  |  | 27 | 'min'                    => sanitize\_text\_field($\_REQUEST['min']), |
  |  | 28 | 'max'                    => !empty($\_REQUEST['max']) ? sanitize\_text\_field($\_REQUEST['max']) : null, |
  |  | 29 | 'discount\_type'          => sanitize\_text\_field($\_REQUEST['discount\_type']), |
  |  | 30 | 'value'                  => sanitize\_text\_field($\_REQUEST['value']), |
  | 31 | 31 | 'max\_discount' => null, |
  | 32 | 32 | 'allow\_roles' => array(), |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/data/category_rules/elex-save-options.php?rev=3049195#L38) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/data/category_rules/elex-save-options.php?rev=3211131#L38) |  |
  | 38 | 38 | 'prev\_order\_count' => null, |
  | 39 | 39 | 'prev\_order\_total\_amt' => null, |
  | 40 |  | ); |
  |  | 40 | ); |
  | 41 | 41 |  |
  | 42 | 42 | if (!isset($prev\_data[$active\_tab]) || count($prev\_data[$active\_tab]) == 0) { |
  | 43 |  | $prev\_data[$active\_tab][1] = $new\_rule; |
  | 44 |  | } else { |
  | 45 |  | $prev\_data[$active\_tab][] = $new\_rule; |
  | 46 |  | } |
  |  | 43 | $prev\_data[$active\_tab][1] = $new\_rule; |
  |  | 44 | } else { |
  |  | 45 | $prev\_data[$active\_tab][] = $new\_rule; |
  |  | 46 | } |
  | 47 | 47 |  |
  | 48 | 48 | do\_action( 'wpml\_register\_single\_string', 'eh-dynamic-pricing', $active\_tab . ':' . count($prev\_data[$active\_tab]), sanitize\_text\_field($\_REQUEST['offer\_name'])); |
* ## [elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/data/category\_rules/elex-update-options.php](/changeset/3211131/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/data/category_rules/elex-update-options.php "Show the changeset 3211131 restricted to elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/data/category_rules/elex-update-options.php")

  | [r3049195](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/data/category_rules/elex-update-options.php?rev=3049195#L13 "Show revision 3049195 of this file in browser") | [r3211131](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/data/category_rules/elex-update-options.php?rev=3211131#L13 "Show revision 3211131 of this file in browser") |  |
  | --- | --- | --- |
  | 13 | 13 | $prev\_data = get\_option('xa\_dp\_rules'); |
  | 14 | 14 | $new\_rule = array( |
  | 15 |  | 'offer\_name'             => sanitize\_text\_field($\_REQUEST['offer\_name']), |
  | 16 |  | 'category\_id'            => array\_map('sanitize\_text\_field', $\_REQUEST['category\_id']), |
  | 17 |  | 'check\_on'               => sanitize\_text\_field($\_REQUEST['check\_on']), |
  | 18 |  | 'min'                    => sanitize\_text\_field($\_REQUEST['min']), |
  | 19 |  | 'max'                    => !empty($\_REQUEST['max']) ? sanitize\_text\_field($\_REQUEST['max']) : null, |
  | 20 |  | 'discount\_type'          => sanitize\_text\_field($\_REQUEST['discount\_type']), |
  | 21 |  | 'value'                  => sanitize\_text\_field($\_REQUEST['value']), |
  |  | 15 | 'offer\_name'             => sanitize\_text\_field($\_REQUEST['offer\_name']), |
  |  | 16 | 'category\_id'            => array\_map('sanitize\_text\_field', $\_REQUEST['category\_id']), |
  |  | 17 | 'check\_on'               => sanitize\_text\_field($\_REQUEST['check\_on']), |
  |  | 18 | 'min'                    => sanitize\_text\_field($\_REQUEST['min']), |
  |  | 19 | 'max'                    => !empty($\_REQUEST['max']) ? sanitize\_text\_field($\_REQUEST['max']) : null, |
  |  | 20 | 'discount\_type'          => sanitize\_text\_field($\_REQUEST['discount\_type']), |
  |  | 21 | 'value'                  => sanitize\_text\_field($\_REQUEST['value']), |
  | 22 | 22 | 'max\_discount' => null, |
  | 23 | 23 | 'allow\_roles' => array(), |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/data/category_rules/elex-update-options.php?rev=3049195#L29) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/data/category_rules/elex-update-options.php?rev=3211131#L29) |  |
  | 29 | 29 | 'prev\_order\_count' => null, |
  | 30 | 30 | 'prev\_order\_total\_amt' => null, |
  | 31 |  | ); |
  |  | 31 | ); |
  | 32 | 32 |  |
  | 33 | 33 | $prev\_data[$active\_tab][sanitize\_text\_field($\_REQUEST['update'])] = $new\_rule; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/data/category_rules/elex-update-options.php?rev=3049195#L43) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/data/category_rules/elex-update-options.php?rev=3211131#L43) |  |
  | 43 | 43 | <?php |
  | 44 | 44 | wp\_safe\_redirect(add\_query\_arg(array('page' => 'dp-discount-rules-page', 'tab' => $active\_tab,'updatesuccess' => 1), admin\_url('admin.php'))); |
  | 45 |  | } else { |
  |  | 45 | } else { |
  | 46 | 46 | echo '<div class="notice notice-error is-dismissible">'; |
  | 47 | 47 | echo '<p>' . esc\_html\_e('Please Enter All Fields ,Then Try To Update!!', 'eh-dynamic-pricing-discounts') . '</p> </div>'; |
* ## [elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/data/product\_rules/elex-save-options.php](/changeset/3211131/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/data/product_rules/elex-save-options.php "Show the changeset 3211131 restricted to elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/data/product_rules/elex-save-options.php")

  | [r3049195](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/data/product_rules/elex-save-options.php?rev=3049195#L8 "Show revision 3049195 of this file in browser") | [r3211131](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/data/product_rules/elex-save-options.php?rev=3211131#L8 "Show revision 3211131 of this file in browser") |  |
  | --- | --- | --- |
  | 8 | 8 |  |
  | 9 | 9 |  |
  | 10 |  | if (!empty($\_REQUEST['offer\_name']) && isset($\_REQUEST['rule\_on']) && (~~(isset($\_REQUEST['product\_id'])~~) && ( !empty($\_REQUEST['product\_id']) && ( 'products' == $\_REQUEST['rule\_on'] ) ) || ( isset($\_REQUEST['category\_id']) && !empty($\_REQUEST['category\_id']) && ( 'categories' === $\_REQUEST['rule\_on'] ) ) || ( 'cart' === $\_REQUEST['rule\_on'] ) ) && !empty($\_REQUEST['check\_on']) && !empty($\_REQUEST['min']) && !empty($\_REQUEST['discount\_type']) && ( !empty($\_REQUEST['value']) ) && !isset($\_REQUEST['edit'])) { |
  |  | 10 | if (!empty($\_REQUEST['offer\_name']) && isset($\_REQUEST['rule\_on']) && ( ( isset($\_REQUEST['product\_id']) ) && ( !empty($\_REQUEST['product\_id']) && ( 'products' == $\_REQUEST['rule\_on'] ) ) || ( isset($\_REQUEST['category\_id']) && !empty($\_REQUEST['category\_id']) && ( 'categories' === $\_REQUEST['rule\_on'] ) ) || ( 'cart' === $\_REQUEST['rule\_on'] ) ) && !empty($\_REQUEST['check\_on']) && !empty($\_REQUEST['min']) && !empty($\_REQUEST['discount\_type']) && ( !empty($\_REQUEST['value']) ) && !isset($\_REQUEST['edit'])) { |
  | 11 | 11 | $dummy\_settings = []; |
  | 12 | 12 | $dummy\_settings['product\_rules']       = array(); |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/data/product_rules/elex-save-options.php?rev=3049195#L19) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/data/product_rules/elex-save-options.php?rev=3211131#L19) |  |
  | 19 | 19 |  |
  | 20 | 20 | $products\_ids = null; |
  | 21 |  | $categories   = null; |
  |  | 21 | $categories   = null; |
  | 22 | 22 |  |
  | 23 | 23 | if ($\_REQUEST['rule\_on'] === 'products' && isset($\_REQUEST['product\_id']) && !empty($\_REQUEST['product\_id'])) { |
  | 24 |  | if (elex\_dp\_is\_wc\_version\_gt\_eql('2.7')) { |
  |  | 24 | if (elex\_dp\_is\_wc\_version\_gt\_eql('2.7')) { |
  | 25 | 25 | $products\_ids = array\_map('sanitize\_text\_field', $\_REQUEST['product\_id']);// array |
  | 26 |  | } else { |
  | 27 |  | $products\_ids = explode(',', sanitize\_text\_field($\_REQUEST['product\_id'])); // string |
  | 28 |  | } |
  | 29 |  | } elseif ($\_REQUEST['rule\_on'] === 'categories' && isset($\_REQUEST['category\_id']) && !empty($\_REQUEST['category\_id'])) { |
  | 30 |  | $categories = sanitize\_text\_field($\_REQUEST['category\_id']); // string |
  | 31 |  | } |
  |  | 26 | } else { |
  |  | 27 | $products\_ids = explode(',', sanitize\_text\_field($\_REQUEST['product\_id'])); // string |
  |  | 28 | } |
  |  | 29 | } elseif ($\_REQUEST['rule\_on'] === 'categories' && isset($\_REQUEST['category\_id']) && !empty($\_REQUEST['category\_id'])) { |
  |  | 30 | $categories = sanitize\_text\_field($\_REQUEST['category\_id']); // string |
  |  | 31 | } |
  | 32 | 32 |  |
  | 33 | 33 | $prev\_data = get\_option('xa\_dp\_rules', $dummy\_settings); |
  | 34 | 34 | $new\_rule = array( |
  | 35 |  | 'offer\_name'             => sanitize\_text\_field($\_REQUEST['offer\_name']), |
  | 36 |  | 'rule\_on'                => sanitize\_text\_field($\_REQUEST['rule\_on']), |
  | 37 |  | 'product\_id'             => $products\_ids, |
  | 38 |  | 'category\_id'            => $categories, |
  | 39 |  | 'check\_on'               => sanitize\_text\_field($\_REQUEST['check\_on']), |
  | 40 |  | 'min'                    => sanitize\_text\_field($\_REQUEST['min']), |
  | 41 |  | 'max'                    => !empty($\_REQUEST['max']) ? sanitize\_text\_field($\_REQUEST['max']) : null, |
  | 42 |  | 'discount\_type'          => sanitize\_text\_field($\_REQUEST['discount\_type']), |
  | 43 |  | 'value'                  => sanitize\_text\_field($\_REQUEST['value']), |
  | 44 |  | 'max\_discount'           => null, |
  | 45 |  | ~~'allow\_roles'            => (isset($\_REQUEST['from\_date']) && !empty($\_REQUEST['allow\_roles'])~~) ? array\_map('sanitize\_text\_field', $\_REQUEST['allow\_roles']) : array(), |
  | 46 |  | ~~'allow\_membership\_plans' => (isset($\_REQUEST['from\_date']) && !empty($\_REQUEST['allow\_membership\_plans'])~~) ? array\_map('sanitize\_text\_field', $\_REQUEST['allow\_membership\_plans']) : array(), |
  | 47 |  | ~~'from\_date'              => (isset($\_REQUEST['from\_date']) && !empty($\_REQUEST['from\_date'])~~) ? sanitize\_text\_field($\_REQUEST['from\_date']) : null, |
  | 48 |  | ~~'to\_date'                => (isset($\_REQUEST['from\_date']) &&!empty($\_REQUEST['to\_date'])~~) ? sanitize\_text\_field($\_REQUEST['to\_date']) : null, |
  | 49 |  | 'adjustment'             => null, |
  | 50 |  | 'repeat\_rule'            => '', |
  | 51 |  | 'email\_ids'              => null, |
  | 52 |  | 'prev\_order\_count'       => null, |
  | 53 |  | 'prev\_order\_total\_amt'   => null, |
  | 54 |  | ); |
  |  | 35 | 'offer\_name'             => sanitize\_text\_field($\_REQUEST['offer\_name']), |
  |  | 36 | 'rule\_on'                => sanitize\_text\_field($\_REQUEST['rule\_on']), |
  |  | 37 | 'product\_id'             => $products\_ids, |
  |  | 38 | 'category\_id'            => $categories, |
  |  | 39 | 'check\_on'               => sanitize\_text\_field($\_REQUEST['check\_on']), |
  |  | 40 | 'min'                    => sanitize\_text\_field($\_REQUEST['min']), |
  |  | 41 | 'max'                    => !empty($\_REQUEST['max']) ? sanitize\_text\_field($\_REQUEST['max']) : null, |
  |  | 42 | 'discount\_type'          => sanitize\_text\_field($\_REQUEST['discount\_type']), |
  |  | 43 | 'value'                  => sanitize\_text\_field($\_REQUEST['value']), |
  |  | 44 | 'max\_discount'           => null, |
  |  | 45 | 'allow\_roles'            => ( isset($\_REQUEST['from\_date']) && !empty($\_REQUEST['allow\_roles']) ) ? array\_map('sanitize\_text\_field', $\_REQUEST['allow\_roles']) : array(), |
  |  | 46 | 'allow\_membership\_plans' => ( isset($\_REQUEST['from\_date']) && !empty($\_REQUEST['allow\_membership\_plans']) ) ? array\_map('sanitize\_text\_field', $\_REQUEST['allow\_membership\_plans']) : array(), |
  |  | 47 | 'from\_date'              => ( isset($\_REQUEST['from\_date']) && !empty($\_REQUEST['from\_date']) ) ? sanitize\_text\_field($\_REQUEST['from\_date']) : null, |
  |  | 48 | 'to\_date'                => ( isset($\_REQUEST['from\_date']) &&!empty($\_REQUEST['to\_date']) ) ? sanitize\_text\_field($\_REQUEST['to\_date']) : null, |
  |  | 49 | 'adjustment'             => null, |
  |  | 50 | 'repeat\_rule'            => '', |
  |  | 51 | 'email\_ids'              => null, |
  |  | 52 | 'prev\_order\_count'       => null, |
  |  | 53 | 'prev\_order\_total\_amt'   => null, |
  |  | 54 | ); |
  | 55 | 55 |  |
  | 56 | 56 | if (!isset($prev\_data[$active\_tab]) || count($prev\_data[$active\_tab]) == 0) { |
  | 57 |  | $prev\_data[$active\_tab][1] = $new\_rule; |
  | 58 |  | } else { |
  | 59 |  | $prev\_data[$active\_tab][] = $new\_rule; |
  | 60 |  | } |
  |  | 57 | $prev\_data[$active\_tab][1] = $new\_rule; |
  |  | 58 | } else { |
  |  | 59 | $prev\_data[$active\_tab][] = $new\_rule; |
  |  | 60 | } |
  | 61 | 61 |  |
  | 62 | 62 | do\_action( 'wpml\_register\_single\_string', 'eh-dynamic-pricing', $active\_tab . ':' . count($prev\_data[$active\_tab]), sanitize\_text\_field($\_REQUEST['offer\_name'])); |
* ## [elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/data/product\_rules/elex-update-options.php](/changeset/3211131/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/data/product_rules/elex-update-options.php "Show the changeset 3211131 restricted to elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/data/product_rules/elex-update-options.php")

  | [r3049195](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/data/product_rules/elex-update-options.php?rev=3049195#L10 "Show revision 3049195 of this file in browser") | [r3211131](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/data/product_rules/elex-update-options.php?rev=3211131#L10 "Show revision 3211131 of this file in browser") |  |
  | --- | --- | --- |
  | 10 | 10 |  |
  | 11 | 11 | $products\_ids = null; |
  | 12 |  | $categories   = null; |
  |  | 12 | $categories   = null; |
  | 13 | 13 |  |
  | 14 | 14 | if ($\_REQUEST['rule\_on'] === 'products' && isset($\_REQUEST['product\_id']) && !empty($\_REQUEST['product\_id'])) { |
  | 15 |  | if (elex\_dp\_is\_wc\_version\_gt\_eql('2.7')) { |
  |  | 15 | if (elex\_dp\_is\_wc\_version\_gt\_eql('2.7')) { |
  | 16 | 16 | $products\_ids = array\_map('sanitize\_text\_field', $\_REQUEST['product\_id']);// array |
  | 17 |  | } else { |
  | 18 |  | $products\_ids = explode(',', sanitize\_text\_field($\_REQUEST['product\_id'])); // string |
  | 19 |  | } |
  | 20 |  | } elseif ($\_REQUEST['rule\_on'] === 'categories' && isset($\_REQUEST['category\_id']) && !empty($\_REQUEST['category\_id'])) { |
  | 21 |  | $categories = sanitize\_text\_field($\_REQUEST['category\_id']); // string |
  | 22 |  | } |
  |  | 17 | } else { |
  |  | 18 | $products\_ids = explode(',', sanitize\_text\_field($\_REQUEST['product\_id'])); // string |
  |  | 19 | } |
  |  | 20 | } elseif ($\_REQUEST['rule\_on'] === 'categories' && isset($\_REQUEST['category\_id']) && !empty($\_REQUEST['category\_id'])) { |
  |  | 21 | $categories = sanitize\_text\_field($\_REQUEST['category\_id']); // string |
  |  | 22 | } |
  | 23 | 23 |  |
  | 24 | 24 | $prev\_data = get\_option('xa\_dp\_rules'); |
  | 25 | 25 | $new\_rule = array( |
  | 26 |  | 'offer\_name'             => sanitize\_text\_field($\_REQUEST['offer\_name']), |
  | 27 |  | 'rule\_on'                => sanitize\_text\_field($\_REQUEST['rule\_on']), |
  | 28 |  | 'product\_id'             => $products\_ids, |
  | 29 |  | 'category\_id'            => $categories, |
  | 30 |  | 'check\_on'               => sanitize\_text\_field($\_REQUEST['check\_on']), |
  | 31 |  | 'min'                    => sanitize\_text\_field($\_REQUEST['min']), |
  | 32 |  | 'max'                    => !empty($\_REQUEST['max']) ? sanitize\_text\_field($\_REQUEST['max']) : null, |
  | 33 |  | 'discount\_type'          => sanitize\_text\_field($\_REQUEST['discount\_type']), |
  | 34 |  | 'value'                  => sanitize\_text\_field($\_REQUEST['value']), |
  | 35 |  | 'max\_discount'           => null, |
  | 36 |  | ~~'allow\_roles'            => (isset($\_REQUEST['from\_date']) && !empty($\_REQUEST['allow\_roles'])~~) ? array\_map('sanitize\_text\_field', $\_REQUEST['allow\_roles']) : array(), |
  | 37 |  | ~~'allow\_membership\_plans' => (isset($\_REQUEST['from\_date']) && !empty($\_REQUEST['allow\_membership\_plans'])~~) ? array\_map('sanitize\_text\_field', $\_REQUEST['allow\_membership\_plans']) : array(), |
  | 38 |  | ~~'from\_date'              => (isset($\_REQUEST['from\_date']) && !empty($\_REQUEST['from\_date'])~~) ? sanitize\_text\_field($\_REQUEST['from\_date']) : null, |
  | 39 |  | ~~'to\_date'                => (isset($\_REQUEST['from\_date']) &&!empty($\_REQUEST['to\_date'])~~) ? sanitize\_text\_field($\_REQUEST['to\_date']) : null, |
  | 40 |  | 'adjustment'             => null, |
  | 41 |  | 'repeat\_rule'            => '', |
  | 42 |  | 'email\_ids'              => null, |
  | 43 |  | 'prev\_order\_count'       => null, |
  | 44 |  | 'prev\_order\_total\_amt'   => null, |
  | 45 |  | ); |
  |  | 26 | 'offer\_name'             => sanitize\_text\_field($\_REQUEST['offer\_name']), |
  |  | 27 | 'rule\_on'                => sanitize\_text\_field($\_REQUEST['rule\_on']), |
  |  | 28 | 'product\_id'             => $products\_ids, |
  |  | 29 | 'category\_id'            => $categories, |
  |  | 30 | 'check\_on'               => sanitize\_text\_field($\_REQUEST['check\_on']), |
  |  | 31 | 'min'                    => sanitize\_text\_field($\_REQUEST['min']), |
  |  | 32 | 'max'                    => !empty($\_REQUEST['max']) ? sanitize\_text\_field($\_REQUEST['max']) : null, |
  |  | 33 | 'discount\_type'          => sanitize\_text\_field($\_REQUEST['discount\_type']), |
  |  | 34 | 'value'                  => sanitize\_text\_field($\_REQUEST['value']), |
  |  | 35 | 'max\_discount'           => null, |
  |  | 36 | 'allow\_roles'            => ( isset($\_REQUEST['from\_date']) && !empty($\_REQUEST['allow\_roles']) ) ? array\_map('sanitize\_text\_field', $\_REQUEST['allow\_roles']) : array(), |
  |  | 37 | 'allow\_membership\_plans' => ( isset($\_REQUEST['from\_date']) && !empty($\_REQUEST['allow\_membership\_plans']) ) ? array\_map('sanitize\_text\_field', $\_REQUEST['allow\_membership\_plans']) : array(), |
  |  | 38 | 'from\_date'              => ( isset($\_REQUEST['from\_date']) && !empty($\_REQUEST['from\_date']) ) ? sanitize\_text\_field($\_REQUEST['from\_date']) : null, |
  |  | 39 | 'to\_date'                => ( isset($\_REQUEST['from\_date']) &&!empty($\_REQUEST['to\_date']) ) ? sanitize\_text\_field($\_REQUEST['to\_date']) : null, |
  |  | 40 | 'adjustment'             => null, |
  |  | 41 | 'repeat\_rule'            => '', |
  |  | 42 | 'email\_ids'              => null, |
  |  | 43 | 'prev\_order\_count'       => null, |
  |  | 44 | 'prev\_order\_total\_amt'   => null, |
  |  | 45 | ); |
  | 46 | 46 | $prev\_data[$active\_tab][sanitize\_text\_field($\_REQUEST['update'])] = $new\_rule; |
  | 47 | 47 |  |
* ## [elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/data/settings\_page/elex-save-options.php](/changeset/3211131/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/data/settings_page/elex-save-options.php "Show the changeset 3211131 restricted to elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/data/settings_page/elex-save-options.php")

  | [r3049195](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/data/settings_page/elex-save-options.php?rev=3049195#L17 "Show revision 3049195 of this file in browser") | [r3211131](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/data/settings_page/elex-save-options.php?rev=3211131#L17 "Show revision 3211131 of this file in browser") |  |
  | --- | --- | --- |
  | 17 | 17 | </div> |
  | 18 | 18 | <?php |
  | 19 |  | ~~}else~~{ |
  |  | 19 | } else { |
  | 20 | 20 |  |
  | 21 | 21 | if (isset($\_REQUEST['tab'])) { |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/data/settings_page/elex-save-options.php?rev=3049195#L117) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/data/settings_page/elex-save-options.php?rev=3211131#L117) |  |
  | 117 | 117 | update\_option('xa\_dynamic\_pricing\_setting', $saved\_data); |
  | 118 | 118 | wp\_safe\_redirect(add\_query\_arg(array('page' => 'dp-settings-page', 'tab' => $active\_tab), admin\_url('admin.php'))); |
  | 119 |  | ?> |
  |  | 119 | ?> |
  | 120 | 120 | <div class="notice notice-success is-dismissible"> |
  | 121 | 121 | <p><?php esc\_html\_e('Saved Successfully', 'eh-dynamic-pricing-discounts'); ?></p> |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/data/settings_page/elex-save-options.php?rev=3049195#L129) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/data/settings_page/elex-save-options.php?rev=3211131#L129) |  |
  | 129 | 129 | <?php |
  | 130 | 130 | } |
  | 131 |  | } |
  |  | 131 | } |
  | 132 | 132 | } |
* ## [elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/elex-admin-actions-function.php](/changeset/3211131/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/elex-admin-actions-function.php "Show the changeset 3211131 restricted to elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/elex-admin-actions-function.php")

  | [r3049195](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/elex-admin-actions-function.php?rev=3049195#L120 "Show revision 3049195 of this file in browser") | [r3211131](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/elex-admin-actions-function.php?rev=3211131#L120 "Show revision 3211131 of this file in browser") |  |
  | --- | --- | --- |
  | 120 | 120 | $rules\_type  = !empty($\_POST['rules-type'])?$\_POST['rules-type']:''; |
  | 121 | 121 | if (!wp\_verify\_nonce($nonce, 'update\_rules\_arrangement')) { |
  | 122 |  | wp\_die('unauthorised access [unable to verify nonce]'); |
  | 123 |  | } else { |
  | 124 |  | $allrules = get\_option('xa\_dp\_rules'); |
  |  | 122 | wp\_die('unauthorised access [unable to verify nonce]'); |
  |  | 123 | } else { |
  |  | 124 | $allrules = get\_option('xa\_dp\_rules'); |
  | 125 | 125 | $allRules = !empty($allrules[$rules\_type])?$allrules[$rules\_type]:array(); |
  | 126 | 126 |  |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/elex-admin-actions-function.php?rev=3049195#L137) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/elex-admin-actions-function.php?rev=3211131#L137) |  |
  | 137 | 137 |  |
  | 138 | 138 | //Updating rules order in existing\_perpage\_rules\_order |
  | 139 |  | if~~($reordered\_rules\_on\_given\_page)~~{ |
  | 140 |  | if~~($paged\_rules = $existing\_perpage\_rules\_order[1])~~{ |
  |  | 139 | if ($reordered\_rules\_on\_given\_page) { |
  |  | 140 | if ($paged\_rules = $existing\_perpage\_rules\_order[1]) { |
  | 141 | 141 | $updated\_order\_on\_index = []; |
  | 142 | 142 | $i=0; |
  | 143 |  | ~~foreach($paged\_rules as $key => $rule)~~{ |
  |  | 143 | foreach ($paged\_rules as $key => $rule) { |
  | 144 | 144 | $updated\_order\_on\_index[$key] = $reordered\_rules\_on\_given\_page[$i]; |
  | 145 | 145 | $i++; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/elex-admin-actions-function.php?rev=3049195#L151) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/elex-admin-actions-function.php?rev=3211131#L151) |  |
  | 151 | 151 | //Setting up final data |
  | 152 | 152 | $reordered\_final\_rules\_array = []; |
  | 153 |  | ~~foreach($existing\_perpage\_rules\_order as $rules\_array)~~{ |
  | 154 |  | if~~($rules\_array)~~{ |
  | 155 |  | foreach~~($rules\_array as $key => $rules)~~{ |
  |  | 153 | foreach ($existing\_perpage\_rules\_order as $rules\_array) { |
  |  | 154 | if ($rules\_array) { |
  |  | 155 | foreach ($rules\_array as $key => $rules) { |
  | 156 | 156 | $reordered\_final\_rules\_array[$key] = $rules; |
  | 157 | 157 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/elex-admin-actions-function.php?rev=3049195#L160) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/elex-admin-actions-function.php?rev=3211131#L160) |  |
  | 160 | 160 |  |
  | 161 | 161 | //Saving it to database |
  | 162 |  | if~~(!empty($reordered\_final\_rules\_array))~~{ |
  | 163 |  | $reordered\_final\_rules\_array = array\_reverse($reordered\_final\_rules\_array,true); |
  |  | 162 | if (!empty($reordered\_final\_rules\_array)) { |
  |  | 163 | $reordered\_final\_rules\_array = array\_reverse($reordered\_final\_rules\_array, true); |
  | 164 | 164 | $allrules[$rules\_type] = $reordered\_final\_rules\_array; |
  | 165 | 165 | update\_option('xa\_dp\_rules', $allrules); |
  | 166 | 166 | wp\_die('Arrangements Saved'); |
  | 167 |  | }~~else~~{ |
  |  | 167 | } else { |
  | 168 | 168 | wp\_die('unable to save'); |
  | 169 | 169 | } |
  | 170 |  | } |
  |  | 170 | } |
  | 171 | 171 | } |
  | 172 | 172 |  |
* ## [elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/elex-exporter.php](/changeset/3211131/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/elex-exporter.php "Show the changeset 3211131 restricted to elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/elex-exporter.php")

  | [r3004919](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/elex-exporter.php?rev=3004919#L8 "Show revision 3004919 of this file in browser") | [r3211131](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/elex-exporter.php?rev=3211131#L8 "Show revision 3211131 of this file in browser") |  |
  | --- | --- | --- |
  | 8 | 8 |  |
  | 9 | 9 | function elex\_dp\_export\_rules() { |
  | 10 |  |  |
  |  | 10 | if (!current\_user\_can('manage\_options')) { |
  |  | 11 | return; |
  |  | 12 | } |
  |  | 13 |  |
  |  | 14 | if ( isset($\_POST['eha-export']) && ( !isset($\_POST['eha\_export\_nonce']) || !wp\_verify\_nonce($\_POST['eha\_export\_nonce'], 'eha\_export\_nonce') ) ) { |
  |  | 15 | // Nonce is invalid or not present |
  |  | 16 | wp\_safe\_redirect(admin\_url('admin.php?page=dp-import-export-page&nonce\_verification\_failed')); |
  |  | 17 | return false; |
  |  | 18 |  |
  |  | 19 | } |
  | 11 | 20 | if (isset($\_POST['eha-export'])) { |
  | 12 | 21 | if (isset($\_POST['export\_type']) && ( $\_POST['export\_type'] == 'eha-export-json' )) { |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/elex-exporter.php?rev=3004919#L16) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/elex-exporter.php?rev=3211131#L25) |  |
  | 16 | 25 |  |
  | 17 | 26 | $file\_rule = $tab\_c; |
  | 18 |  | if~~($tab\_c == 'combinational\_rules')~~{ |
  |  | 27 | if ($tab\_c == 'combinational\_rules') { |
  | 19 | 28 | $file\_rule = 'multi\_product\_rules'; |
  | 20 |  | }~~else if($tab\_c == 'cat\_combinational\_rules')~~{ |
  |  | 29 | } else if ($tab\_c == 'cat\_combinational\_rules') { |
  | 21 | 30 | $file\_rule = 'multi\_category\_rules'; |
  | 22 |  | }~~else if($tab\_c == 'buy\_get\_free\_rules')~~{ |
  |  | 31 | } else if ($tab\_c == 'buy\_get\_free\_rules') { |
  | 23 | 32 | $file\_rule = 'bogo\_product\_rules'; |
  | 24 | 33 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/elex-exporter.php?rev=3004919#L46) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/elex-exporter.php?rev=3211131#L55) |  |
  | 46 | 55 |  |
  | 47 | 56 | $file\_rule = $tab\_c; |
  | 48 |  | if~~($tab\_c == 'combinational\_rules')~~{ |
  |  | 57 | if ($tab\_c == 'combinational\_rules') { |
  | 49 | 58 | $file\_rule = 'multi\_product\_rules'; |
  | 50 |  | }~~else if($tab\_c == 'cat\_combinational\_rules')~~{ |
  |  | 59 | } else if ($tab\_c == 'cat\_combinational\_rules') { |
  | 51 | 60 | $file\_rule = 'multi\_category\_rules'; |
  | 52 |  | }~~else if($tab\_c == 'buy\_get\_free\_rules')~~{ |
  |  | 61 | } else if ($tab\_c == 'buy\_get\_free\_rules') { |
  | 53 | 62 | $file\_rule = 'bogo\_product\_rules'; |
  | 54 | 63 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/elex-exporter.php?rev=3004919#L83) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/elex-exporter.php?rev=3211131#L92) |  |
  | 83 | 92 | $line[] ="[$tmp]"; |
  | 84 | 93 | } else { |
  | 85 |  | if~~($v)~~{ |
  |  | 94 | if ($v) { |
  | 86 | 95 | $v      = str\_replace(',', '&comma', $v); |
  | 87 | 96 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/elex-exporter.php?rev=3004919#L100) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/elex-exporter.php?rev=3211131#L109) |  |
  | 100 | 109 | } |
  | 101 | 110 | } |
  | 102 |  | if (isset($\_POST['system-info-export'])) { |
  | 103 |  | $Info = phpinfo(1); |
  | 104 |  | if~~($Info)~~{ |
  |  | 111 | if (isset($\_POST['system-info-export'])) { |
  |  | 112 | $Info = phpinfo(1); |
  |  | 113 | if ($Info) { |
  | 105 | 114 | nocache\_headers(); |
  | 106 | 115 | header('Content-Type: application/html; charset=utf-8'); |
  | 107 | 116 | header('Content-Disposition: attachment; filename= System-info-export-' . date('d-M-Y') . '.html'); |
  | 108 | 117 | header('Expires: 0'); |
  | 109 |  | echo (~~$Info~~); |
  |  | 118 | echo ( $Info ); |
  | 110 | 119 | exit; |
  | 111 | 120 | } else { |
* ## [elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/elex-importer.php](/changeset/3211131/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/elex-importer.php "Show the changeset 3211131 restricted to elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/elex-importer.php")

  | [r2965037](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/elex-importer.php?rev=2965037#L8 "Show revision 2965037 of this file in browser") | [r3211131](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/elex-importer.php?rev=3211131#L8 "Show revision 3211131 of this file in browser") |  |
  | --- | --- | --- |
  | 8 | 8 | function elex\_dp\_import\_rules() { |
  | 9 | 9 | $rules\_array = get\_option('xa\_dp\_rules', array()); |
  |  | 10 | if (!current\_user\_can('manage\_options')) { |
  |  | 11 | return; |
  |  | 12 | } |
  |  | 13 |  |
  |  | 14 | if ( isset($\_POST['import\_tab']) && ( !isset($\_POST['eha\_import\_export\_nonce']) || !wp\_verify\_nonce($\_POST['eha\_import\_export\_nonce'], 'eha\_import\_export\_nonce') ) ) { |
  |  | 15 | // Nonce is invalid or not present |
  |  | 16 | wp\_safe\_redirect(admin\_url('admin.php?page=dp-import-export-page&nonce\_verification\_failed')); |
  |  | 17 | return false; |
  |  | 18 |  |
  |  | 19 | } |
  |  | 20 |  |
  | 10 | 21 | if (isset($\_POST['import\_tab']) && !empty($\_POST['import\_tab']) && !empty($\_FILES['import\_file'])) { |
  | 11 | 22 | $tab       = $\_POST['import\_tab']; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/elex-importer.php?rev=2965037#L91) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/elex-importer.php?rev=3211131#L102) |  |
  | 91 | 102 | } else { |
  | 92 | 103 | $file\_data = $\_FILES; |
  | 93 |  | add\_action('admin\_notices', function() use (~~$file\_data, $tab)~~{ |
  |  | 104 | add\_action('admin\_notices', function() use ( $file\_data, $tab) { |
  | 94 | 105 | ?> |
  | 95 | 106 | <div class="notice notice-error is-dismissible" style=""> |
  | 96 |  | <p><?php \_e( ~~"You can not import " . $file\_data['import\_file']['name'] . " into "~~ . $tab , 'eh-dynamic-pricing-discounts'); ?></p> |
  |  | 107 | <p><?php \_e( 'You can not import ' . $file\_data['import\_file']['name'] . ' into ' . $tab , 'eh-dynamic-pricing-discounts'); ?></p> |
  | 97 | 108 | </div> |
  | 98 | 109 | <?php |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/elex-importer.php?rev=2965037#L110) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/elex-importer.php?rev=3211131#L121) |  |
  | 110 | 121 | $data = (array) json\_decode(file\_get\_contents($import\_file), true); |
  | 111 | 122 | if (!empty($data['type']) && $data['type'] !== $tab) { |
  | 112 |  | add\_action('admin\_notices', function() use (~~$data, $tab)~~{ |
  |  | 123 | add\_action('admin\_notices', function() use ( $data, $tab) { |
  | 113 | 124 | ?> |
  | 114 | 125 | <div class="notice notice-error is-dismissible" style=""> |
  | 115 |  | <p><?php \_e( ~~"You can not import " . $data['type'] . " into "~~ . $tab , 'eh-dynamic-pricing-discounts'); ?></p> |
  |  | 126 | <p><?php \_e( 'You can not import ' . $data['type'] . ' into ' . $tab , 'eh-dynamic-pricing-discounts'); ?></p> |
  | 116 | 127 | </div> |
  | 117 | 128 | <?php |
* ## [elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/display/discount-rules.php](/changeset/3211131/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/display/discount-rules.php "Show the changeset 3211131 restricted to elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/display/discount-rules.php")

  | [r3049195](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/display/discount-rules.php?rev=3049195#L5 "Show revision 3049195 of this file in browser") | [r3211131](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/display/discount-rules.php?rev=3211131#L5 "Show revision 3211131 of this file in browser") |  |
  | --- | --- | --- |
  | 5 | 5 | } |
  | 6 | 6 |  |
  | 7 |  | $active\_tab = (~~isset($\_REQUEST['tab']) && is\_string($\_REQUEST['tab'])~~) ? sanitize\_text\_field($\_REQUEST['tab']) : 'product\_rules'; |
  |  | 7 | $active\_tab = ( isset($\_REQUEST['tab']) && is\_string($\_REQUEST['tab']) ) ? sanitize\_text\_field($\_REQUEST['tab']) : 'product\_rules'; |
  | 8 | 8 |  |
  | 9 | 9 | if (isset($\_REQUEST['cancel\_btn'])) { |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/display/discount-rules.php?rev=3049195#L12) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/display/discount-rules.php?rev=3211131#L12) |  |
  | 12 | 12 | } |
  | 13 | 13 |  |
  |  | 14 | if ( !empty($\_REQUEST['delete']) || ( isset($\_REQUEST['update']) && empty($\_REQUEST['update']) ) || !empty($\_REQUEST['update']) ) { |
  |  | 15 |  |
  |  | 16 | global $wpdb; |
  |  | 17 |  |
  |  | 18 | // Specify the transient key pattern |
  |  | 19 | $transient\_key\_pattern = 'elex\_dp\_product\_data\_%'; |
  |  | 20 |  |
  |  | 21 | $wpdb->query( |
  |  | 22 | $wpdb->prepare( |
  |  | 23 | "DELETE FROM $wpdb->options WHERE option\_name LIKE %s OR option\_name LIKE %s", |
  |  | 24 | '\_transient\_%' . $transient\_key\_pattern, |
  |  | 25 | '\_transient\_timeout\_%' . $transient\_key\_pattern |
  |  | 26 | ) |
  |  | 27 | ); |
  |  | 28 |  |
  |  | 29 | // Clear the object cache |
  |  | 30 | wp\_cache\_flush(); |
  |  | 31 |  |
  |  | 32 | } |
  |  | 33 |  |
  | 14 | 34 | if (!empty($\_REQUEST['delete'])) { |
  | 15 |  | if~~(!isset($\_REQUEST['eh\_rule\_form\_nonce']) || !wp\_verify\_nonce(sanitize\_text\_field($\_REQUEST['eh\_rule\_form\_nonce']), 'eh\_rule\_form\_nonce'))~~{ |
  |  | 35 | if (!isset($\_REQUEST['eh\_rule\_form\_nonce']) || !wp\_verify\_nonce(sanitize\_text\_field($\_REQUEST['eh\_rule\_form\_nonce']), 'eh\_rule\_form\_nonce')) { |
  | 16 | 36 | wp\_safe\_redirect(add\_query\_arg(array('page' => 'dp-discount-rules-page', 'tab' => $active\_tab), admin\_url('admin.php'))); |
  | 17 | 37 | die(); |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/display/discount-rules.php?rev=3049195#L20) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/display/discount-rules.php?rev=3211131#L40) |  |
  | 20 | 40 | $dp\_coupons\_data = get\_option('dp\_coupons\_data', array()); |
  | 21 | 41 | $deleting\_rule\_coupon\_code = isset($prev\_data[$active\_tab][$\_REQUEST['delete']]['coupon\_code']) ? sanitize\_text\_field($prev\_data[$active\_tab][$\_REQUEST['delete']]['coupon\_code']) : ''; |
  | 22 |  | if~~(isset($deleting\_rule\_coupon\_code) && !empty($deleting\_rule\_coupon\_code) && (array\_key\_exists($deleting\_rule\_coupon\_code, $dp\_coupons\_data)))~~{ |
  |  | 42 | if (isset($deleting\_rule\_coupon\_code) && !empty($deleting\_rule\_coupon\_code) && ( array\_key\_exists($deleting\_rule\_coupon\_code, $dp\_coupons\_data) )) { |
  | 23 | 43 | unset($dp\_coupons\_data[$deleting\_rule\_coupon\_code]); |
  | 24 | 44 | $dp\_coupons\_data = array\_values($dp\_coupons\_data); |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/display/discount-rules.php?rev=3049195#L28) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/display/discount-rules.php?rev=3211131#L48) |  |
  | 28 | 48 | $index\_to\_delete = sanitize\_text\_field($\_REQUEST['delete']); |
  | 29 | 49 | unset($activetab\_rules\_data[$index\_to\_delete]); |
  | 30 |  | if~~($activetab\_rules\_data)~~{ |
  |  | 50 | if ($activetab\_rules\_data) { |
  | 31 | 51 | $activetab\_rules\_data = array\_values($activetab\_rules\_data); |
  | 32 | 52 | $activetab\_rules\_data = array\_combine(range(1, count($activetab\_rules\_data)), array\_values($activetab\_rules\_data)); |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/display/discount-rules.php?rev=3049195#L43) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/display/discount-rules.php?rev=3211131#L63) |  |
  | 43 | 63 |  |
  | 44 | 64 | if (isset($\_REQUEST['update']) && empty($\_REQUEST['update'])) {    //Submit And Not Edit Then Saving New Record |
  | 45 |  | if~~(!isset($\_REQUEST['save\_rule\_nonce']) || !wp\_verify\_nonce(sanitize\_text\_field($\_REQUEST['save\_rule\_nonce']), 'save\_rule\_nonce'))~~{ |
  |  | 65 | if (!isset($\_REQUEST['save\_rule\_nonce']) || !wp\_verify\_nonce(sanitize\_text\_field($\_REQUEST['save\_rule\_nonce']), 'save\_rule\_nonce')) { |
  | 46 | 66 | wp\_safe\_redirect(add\_query\_arg(array('page' => 'dp-discount-rules-page', 'tab' => $active\_tab), admin\_url('admin.php'))); |
  | 47 | 67 | die(); |
  | 48 | 68 | } |
  | 49 |  | $current\_tab\_loc = (isset($\_REQUEST['tab']) && is\_string($\_REQUEST['tab'])) ? sanitize\_text\_field($\_REQUEST['tab']) . '/' : 'product\_rules/'; |
  |  | 69 | // Specify the transient key pattern |
  |  | 70 | $transient\_key\_pattern = 'elex\_dp\_product\_data\_'; |
  |  | 71 |  |
  |  | 72 | // Delete transients with similar keys |
  |  | 73 | $wpdb->query( |
  |  | 74 | $wpdb->prepare( |
  |  | 75 | "DELETE FROM $wpdb->options WHERE option\_name LIKE %s OR option\_name LIKE %s", |
  |  | 76 | 'transient' . $transient\_key\_pattern, |
  |  | 77 | 'transient\_timeout' . $transient\_key\_pattern |
  |  | 78 | ) |
  |  | 79 | ); |
  |  | 80 | $current\_tab\_loc = ( isset($\_REQUEST['tab']) && is\_string($\_REQUEST['tab']) ) ? sanitize\_text\_field($\_REQUEST['tab']) . '/' : 'product\_rules/'; |
  | 50 | 81 | $path            = ELEX\_DP\_BASIC\_ROOT\_PATH . 'admin/data/' . $current\_tab\_loc . 'elex-save-options.php'; |
  | 51 | 82 | if (file\_exists($path) == true) { |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/display/discount-rules.php?rev=3049195#L54) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/display/discount-rules.php?rev=3211131#L85) |  |
  | 54 | 85 |  |
  | 55 | 86 | } elseif (isset($\_REQUEST['edit']) && !empty($\_REQUEST['edit'])) {    //Loading Edit Form Or Updating Data |
  | 56 |  | if~~(!isset($\_REQUEST['eh\_rule\_form\_nonce']) || !wp\_verify\_nonce(sanitize\_text\_field($\_REQUEST['eh\_rule\_form\_nonce']), 'eh\_rule\_form\_nonce'))~~{ |
  |  | 87 | if (!isset($\_REQUEST['eh\_rule\_form\_nonce']) || !wp\_verify\_nonce(sanitize\_text\_field($\_REQUEST['eh\_rule\_form\_nonce']), 'eh\_rule\_form\_nonce')) { |
  | 57 | 88 | wp\_safe\_redirect(add\_query\_arg(array('page' => 'dp-discount-rules-page', 'tab' => $active\_tab), admin\_url('admin.php'))); |
  | 58 | 89 | die(); |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/display/discount-rules.php?rev=3049195#L61) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/display/discount-rules.php?rev=3211131#L92) |  |
  | 61 | 92 | $old\_option = $old\_option[$active\_tab]; |
  | 62 | 93 | $\_REQUEST = array\_merge($\_REQUEST, $old\_option[$\_REQUEST['edit']]); |
  | 63 |  | $current\_tab\_loc = (~~isset($\_REQUEST['tab']) && is\_string($\_REQUEST['tab'])~~) ? sanitize\_text\_field($\_REQUEST['tab']) . '/' : 'product\_rules/'; |
  |  | 94 | $current\_tab\_loc = ( isset($\_REQUEST['tab']) && is\_string($\_REQUEST['tab']) ) ? sanitize\_text\_field($\_REQUEST['tab']) . '/' : 'product\_rules/'; |
  | 64 | 95 | $path            = ELEX\_DP\_BASIC\_ROOT\_PATH . 'admin/data/' . $current\_tab\_loc . 'elex-load-edit.php'; |
  | 65 | 96 | include\_once  $path ; |
  | 66 | 97 |  |
  | 67 | 98 | } elseif ( !empty($\_REQUEST['update'])) { |
  | 68 |  | if~~(!isset($\_REQUEST['update\_rule\_' . sanitize\_text\_field($\_REQUEST['update'])]) || !wp\_verify\_nonce(sanitize\_text\_field($\_REQUEST['update\_rule\_' . sanitize\_text\_field($\_REQUEST['update'])]), 'update\_rule\_' . sanitize\_text\_field($\_REQUEST['update'])))~~{ |
  |  | 99 | if (!isset($\_REQUEST['update\_rule\_' . sanitize\_text\_field($\_REQUEST['update'])]) || !wp\_verify\_nonce(sanitize\_text\_field($\_REQUEST['update\_rule\_' . sanitize\_text\_field($\_REQUEST['update'])]), 'update\_rule\_' . sanitize\_text\_field($\_REQUEST['update']))) { |
  | 69 | 100 | wp\_safe\_redirect(add\_query\_arg(array('page' => 'dp-discount-rules-page', 'tab' => $active\_tab), admin\_url('admin.php'))); |
  | 70 | 101 | die(); |
  | 71 | 102 | } |
  | 72 |  | $path = (isset($\_REQUEST['tab']) && is\_string($\_REQUEST['tab'])) ? sanitize\_text\_field($\_REQUEST['tab']) . '/' : 'product\_rules/'; |
  |  | 103 | // Specify the transient key pattern |
  |  | 104 | $transient\_key\_pattern = 'elex\_dp\_product\_data\_'; |
  |  | 105 |  |
  |  | 106 | // Delete transients with similar keys |
  |  | 107 | $wpdb->query( |
  |  | 108 | $wpdb->prepare( |
  |  | 109 | "DELETE FROM $wpdb->options WHERE option\_name LIKE %s OR option\_name LIKE %s", |
  |  | 110 | 'transient' . $transient\_key\_pattern, |
  |  | 111 | 'transient\_timeout' . $transient\_key\_pattern |
  |  | 112 | ) |
  |  | 113 | ); |
  |  | 114 |  |
  |  | 115 | $path = ( isset($\_REQUEST['tab']) && is\_string($\_REQUEST['tab']) ) ? sanitize\_text\_field($\_REQUEST['tab']) . '/' : 'product\_rules/'; |
  | 73 | 116 | $path = ELEX\_DP\_BASIC\_ROOT\_PATH . 'admin/data/' . $path . 'elex-update-options.php'; |
  | 74 | 117 | include\_once  $path ; |
* ## [elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/display/settings.php](/changeset/3211131/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/display/settings.php "Show the changeset 3211131 restricted to elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/display/settings.php")

  | [r3049195](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/display/settings.php?rev=3049195#L6 "Show revision 3049195 of this file in browser") | [r3211131](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/display/settings.php?rev=3211131#L6 "Show revision 3211131 of this file in browser") |  |
  | --- | --- | --- |
  | 6 | 6 |  |
  | 7 | 7 | // Sets active tab |
  | 8 |  | $active\_tab = (~~isset($\_REQUEST['tab']) && is\_string($\_REQUEST['tab'])~~) ? sanitize\_text\_field($\_REQUEST['tab']) : 'rules\_order'; |
  |  | 8 | $active\_tab = ( isset($\_REQUEST['tab']) && is\_string($\_REQUEST['tab']) ) ? sanitize\_text\_field($\_REQUEST['tab']) : 'rules\_order'; |
  | 9 | 9 |  |
  | 10 | 10 | // Data handling of form submit request. |
  | 11 | 11 | if (isset($\_REQUEST['submit'])) { |
  |  | 12 | global $wpdb; |
  |  | 13 | // Specify the transient key pattern |
  |  | 14 | $transient\_key\_pattern = 'elex\_dp\_product\_data\_%'; |
  |  | 15 |  |
  |  | 16 | $wpdb->query( |
  |  | 17 | $wpdb->prepare( |
  |  | 18 | "DELETE FROM $wpdb->options WHERE option\_name LIKE %s OR option\_name LIKE %s", |
  |  | 19 | '\_transient\_%' . $transient\_key\_pattern, |
  |  | 20 | '\_transient\_timeout\_%' . $transient\_key\_pattern |
  |  | 21 | ) |
  |  | 22 | ); |
  |  | 23 |  |
  |  | 24 | // Clear the object cache |
  |  | 25 | wp\_cache\_flush(); |
  | 12 | 26 | $path = ELEX\_DP\_BASIC\_ROOT\_PATH . 'admin/data/settings\_page/elex-save-options.php'; |
  | 13 | 27 | if (file\_exists($path) == true) { |
* ## [elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/renderer/discount-rules.php](/changeset/3211131/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/renderer/discount-rules.php "Show the changeset 3211131 restricted to elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/renderer/discount-rules.php")

  | [r3049195](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/renderer/discount-rules.php?rev=3049195#L56 "Show revision 3049195 of this file in browser") | [r3211131](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/renderer/discount-rules.php?rev=3211131#L56 "Show revision 3211131 of this file in browser") |  |
  | --- | --- | --- |
  | 56 | 56 | $tablink = esc\_url(add\_query\_arg(array('page' => 'dp-discount-rules-page', 'tab' => $tabkey), admin\_url('admin.php'))); |
  | 57 | 57 | switch ($tabkey) { |
  | 58 |  | case 'product\_rules': ?> |
  |  | 58 | case 'product\_rules': |
  |  | 59 | ?> |
  | 59 | 60 | <a href="<?php echo $tablink; ?>" class=" elex-dynamic-pricing-main-link <?php echo $active\_tab === 'product\_rules' ? 'active' : ''; ?>"> |
  | 60 | 61 | <?php esc\_html\_e('Product Rule', 'eh-dynamic-pricing-discounts'); ?> |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/renderer/discount-rules.php?rev=3049195#L63) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/renderer/discount-rules.php?rev=3211131#L64) |  |
  | 63 | 64 | <path id="carrier\_seperator" data-name="carrier seperator" d="M2565.89-576v23.587" transform="translate(-2564.89 577)" fill="none" stroke="#707070" stroke-linecap="round" stroke-width="2" /> |
  | 64 | 65 | </svg> |
  | 65 |  | <?php break; |
  | 66 |  | case 'category\_rules':  ?> |
  |  | 66 | <?php |
  |  | 67 | break; |
  |  | 68 | case 'category\_rules': |
  |  | 69 | ?> |
  | 67 | 70 | <a href="<?php echo $tablink; ?>" class=" elex-dynamic-pricing-main-link <?php echo $active\_tab === 'category\_rules' ? 'active' : ''; ?>"> |
  | 68 | 71 | <?php esc\_html\_e('Category Rules', 'eh-dynamic-pricing-discounts'); ?> |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/renderer/discount-rules.php?rev=3049195#L71) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/renderer/discount-rules.php?rev=3211131#L74) |  |
  | 71 | 74 | <path id="carrier\_seperator" data-name="carrier seperator" d="M2565.89-576v23.587" transform="translate(-2564.89 577)" fill="none" stroke="#707070" stroke-linecap="round" stroke-width="2" /> |
  | 72 | 75 | </svg> |
  | 73 |  | <?php break; |
  |  | 76 | <?php |
  |  | 77 | break; |
  | 74 | 78 | default: |
  | 75 | 79 | break; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/renderer/discount-rules.php?rev=3049195#L82) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/renderer/discount-rules.php?rev=3211131#L86) |  |
  | 82 | 86 |  |
  | 83 | 87 | <div> |
  | 84 |  | <?php if (!in\_array($active\_tab, $execution\_order)) { ?> |
  |  | 88 | <?php if (!in\_array($active\_tab, $execution\_order)) { ?> |
  | 85 | 89 | <!-- when no rule tab is there --> |
  | 86 | 90 | <div class="w-100 text-center"> |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/renderer/discount-rules.php?rev=3049195#L95) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/renderer/discount-rules.php?rev=3211131#L99) |  |
  | 95 | 99 | <img src="<?php echo esc\_url( ELEX\_DP\_CRM\_MAIN\_IMG . 'IsolationMode.svg' ); ?>" alt="" class="w-100" style="max-width: 684px; margin: auto;"> |
  | 96 | 100 | <div class="text-center"> |
  | 97 |  | <button class="btn btn-primary elex-dynamic-pricing-popup-open-btn"><?php esc\_html\_e('Create My First |
  | 98 |  | Rule', 'eh-dynamic-pricing-discounts'); ?></button> |
  |  | 101 | <button class="btn btn-primary elex-dynamic-pricing-popup-open-btn"> |
  |  | 102 | <?php |
  |  | 103 | esc\_html\_e('Create My First |
  |  | 104 | Rule', 'eh-dynamic-pricing-discounts'); |
  |  | 105 | ?> |
  |  | 106 | </button> |
  | 99 | 107 | </div> |
  | 100 | 108 | </div> |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/renderer/discount-rules.php?rev=3049195#L105) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/renderer/discount-rules.php?rev=3211131#L113) |  |
  | 105 | 113 | $settings       = get\_option('xa\_dynamic\_pricing\_setting', array()); |
  | 106 | 114 |  |
  | 107 |  | ?> |
  |  | 115 | ?> |
  | 108 | 116 |  |
  | 109 | 117 | <div class="d-flex justify-content-between align-items-center mb-3"> |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/renderer/discount-rules.php?rev=3049195#L132) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/renderer/discount-rules.php?rev=3211131#L140) |  |
  | 132 | 140 | $member\_plans = wc\_memberships\_get\_membership\_plans(); |
  | 133 | 141 | } |
  | 134 |  | $no\_of\_rules = count($allrules); |
  |  | 142 | $no\_of\_rules = count($allrules); |
  | 135 | 143 | ?> |
  | 136 | 144 | <input type="hidden" id="no\_of\_rules" name="no\_of\_rules" value="<?php echo esc\_attr($no\_of\_rules); ?>"> |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/renderer/discount-rules.php?rev=3049195#L140) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/renderer/discount-rules.php?rev=3211131#L148) |  |
  | 140 | 148 | //Checkon |
  | 141 | 149 | $checkon= ''; |
  | 142 |  | if(isset($value['check\_on']) && !empty($value['check\_on'])) { |
  |  | 150 | if (isset($value['check\_on']) && !empty($value['check\_on'])) { |
  | 143 | 151 | switch ($value['check\_on']) { |
  | 144 | 152 | case 'Quantity': |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/renderer/discount-rules.php?rev=3049195#L161) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/renderer/discount-rules.php?rev=3211131#L169) |  |
  | 161 | 169 | if ($active\_tab === 'product\_rules') { |
  | 162 | 170 | require ELEX\_DP\_BASIC\_ROOT\_PATH . 'admin/ui/view/discount-rules/card/product-rules.php'; |
  | 163 |  | }else if ($active\_tab === 'category\_rules') { |
  |  | 171 | } else if ($active\_tab === 'category\_rules') { |
  | 164 | 172 | require ELEX\_DP\_BASIC\_ROOT\_PATH . 'admin/ui/view/discount-rules/card/category-rules.php'; |
  | 165 | 173 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/renderer/discount-rules.php?rev=3049195#L180) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/renderer/discount-rules.php?rev=3211131#L188) |  |
  | 180 | 188 | <?php |
  | 181 | 189 | if (isset($\_REQUEST['edit'])) { |
  | 182 |  | wp\_nonce\_field('update\_rule\_' . $\_REQUEST['edit'],'update\_rule\_' . $\_REQUEST['edit']); |
  |  | 190 | wp\_nonce\_field('update\_rule\_' . $\_REQUEST['edit'], 'update\_rule\_' . $\_REQUEST['edit']); |
  | 183 | 191 | } else { |
  | 184 |  | wp\_nonce\_field('save\_rule\_nonce','save\_rule\_nonce'); |
  |  | 192 | wp\_nonce\_field('save\_rule\_nonce', 'save\_rule\_nonce'); |
  | 185 | 193 | } |
  | 186 | 194 | ?> |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/renderer/discount-rules.php?rev=3049195#L381) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/renderer/discount-rules.php?rev=3211131#L389) |  |
  | 381 | 389 | if(no\_of\_rules == 1){ |
  | 382 | 390 | // var className = document.getElementById('className').value; |
  | 383 |  | document.getElementsByClassName('elex-ac-edit-rule-up-btn')[0].disabled=true; |
  |  | 391 | document.getElementsByClassName('elex-ac-edit-rule-up-btn')[0].disabled=true; |
  | 384 | 392 | document.getElementsByClassName('elex-ac-edit-rule-down-btn')[0].disabled=true; |
  | 385 | 393 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/renderer/discount-rules.php?rev=3049195#L418) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/renderer/discount-rules.php?rev=3211131#L426) |  |
  | 418 | 426 | return; |
  | 419 | 427 | } |
  | 420 |  | } |
  |  | 428 | } |
  | 421 | 429 |  |
  | 422 | 430 | isFormSubmitting = true; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/renderer/discount-rules.php?rev=3049195#L433) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/renderer/discount-rules.php?rev=3211131#L441) |  |
  | 433 | 441 | document.getElementById("myForm").reset(); |
  | 434 | 442 | }); |
  | 435 |  |  |
  |  | 443 |  |
  | 436 | 444 |  |
  | 437 | 445 | //Js for rule deleting confirmation Alert ==> |
* ## [elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/card/category-rules.php](/changeset/3211131/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/card/category-rules.php "Show the changeset 3211131 restricted to elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/card/category-rules.php")

  | [r3133197](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/card/category-rules.php?rev=3133197#L21 "Show revision 3133197 of this file in browser") | [r3211131](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/card/category-rules.php?rev=3211131#L21 "Show revision 3211131 of this file in browser") |  |
  | --- | --- | --- |
  | 21 | 21 | <div class="flex-fill"> |
  | 22 | 22 | <div class="d-flex justify-content-between mb-3"> |
  | 23 |  | <h6 class="mb-0"><?php esc\_html\_e('Rule #: ', 'eh-dynamic-pricing-discounts'); ?><span class="fw-normal"><?php echo esc\_html($key); ?></span> | <?php esc\_html\_e('Rule Name: ', 'eh-dynamic-pricing-discounts'); ?><span class="fw-normal"><?php echo (~~isset($value['offer\_name']) && !empty($value['offer\_name'])~~) ? esc\_html($value['offer\_name']) : ' - - '; ?></span></h6> |
  | 24 |  | <h6 class="mb-0"><?php esc\_html\_e('Validty: ', 'eh-dynamic-pricing-discounts'); ?><span class="fw-normal"><?php echo (~~isset($value['from\_date']) && !empty($value['from\_date']) && isset($value['to\_date']) && !empty($value['to\_date'])~~) ? esc\_html($value['from\_date'] . '/' . esc\_html($value['to\_date'])) : ' --/--'; ?></span> |
  |  | 23 | <h6 class="mb-0"><?php esc\_html\_e('Rule #: ', 'eh-dynamic-pricing-discounts'); ?><span class="fw-normal"><?php echo esc\_html($key); ?></span> | <?php esc\_html\_e('Rule Name: ', 'eh-dynamic-pricing-discounts'); ?><span class="fw-normal"><?php echo ( isset($value['offer\_name']) && !empty($value['offer\_name']) ) ? esc\_html($value['offer\_name']) : ' - - '; ?></span></h6> |
  |  | 24 | <h6 class="mb-0"><?php esc\_html\_e('Validty: ', 'eh-dynamic-pricing-discounts'); ?><span class="fw-normal"><?php echo ( isset($value['from\_date']) && !empty($value['from\_date']) && isset($value['to\_date']) && !empty($value['to\_date']) ) ? esc\_html($value['from\_date'] . '/' . esc\_html($value['to\_date'])) : ' --/--'; ?></span> |
  | 25 | 25 | </h6> |
  | 26 | 26 | </div> |
  | 27 | 27 |  |
  | 28 | 28 | <div class="d-flex justify-content-between "> |
  | 29 |  | <h6 class="mb-0"><?php esc\_html\_e('Discount Type: ', 'eh-dynamic-pricing-discounts'); ?><span class="fw-normal"><?php echo (~~isset($value['discount\_type']) && !empty($value['discount\_type'])~~)? esc\_html($value['discount\_type']) : ' - - '; ?></span> |
  |  | 29 | <h6 class="mb-0"><?php esc\_html\_e('Discount Type: ', 'eh-dynamic-pricing-discounts'); ?><span class="fw-normal"><?php echo ( isset($value['discount\_type']) && !empty($value['discount\_type']) )? esc\_html($value['discount\_type']) : ' - - '; ?></span> |
  | 30 | 30 | </h6> |
  | 31 |  | <h6 class="mb-0"><?php esc\_html\_e('Discount Value: ', 'eh-dynamic-pricing-discounts'); ?><span class="fw-normal"><?php echo (~~isset($value['value']) && !empty($value['value'])~~) ? esc\_html($value['value']) : ' - - '; ?></span> |
  |  | 31 | <h6 class="mb-0"><?php esc\_html\_e('Discount Value: ', 'eh-dynamic-pricing-discounts'); ?><span class="fw-normal"><?php echo ( isset($value['value']) && !empty($value['value']) ) ? esc\_html($value['value']) : ' - - '; ?></span> |
  | 32 | 32 | </h6> |
  | 33 |  | <h6 class="mb-0"><?php esc\_html\_e('Max Discount: ', 'eh-dynamic-pricing-discounts'); ?><span class="fw-normal"><?php echo (~~isset($value['max\_discount']) && !empty($value['max\_discount'])~~) ? esc\_html($value['max\_discount']) : ' - - '; ?></span></h6> |
  |  | 33 | <h6 class="mb-0"><?php esc\_html\_e('Max Discount: ', 'eh-dynamic-pricing-discounts'); ?><span class="fw-normal"><?php echo ( isset($value['max\_discount']) && !empty($value['max\_discount']) ) ? esc\_html($value['max\_discount']) : ' - - '; ?></span></h6> |
  | 34 | 34 | </div> |
  | 35 | 35 | </div> |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/card/category-rules.php?rev=3133197#L69) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/card/category-rules.php?rev=3211131#L69) |  |
  | 69 | 69 | } |
  | 70 | 70 | } |
  | 71 |  | }~~else~~{ |
  |  | 71 | } else { |
  | 72 | 72 | echo '<div class="btn elex-light-blue-bg">' . esc\_html\_\_(' - - ', 'eh-dynamic-pricing-discounts') . '</div>'; |
  | 73 | 73 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/card/category-rules.php?rev=3133197#L102) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/card/category-rules.php?rev=3211131#L102) |  |
  | 102 | 102 | <div class="border-0 border-bottom mb-3"> |
  | 103 | 103 | <div class="d-flex gap-4"> |
  | 104 |  | <h6><?php esc\_html\_e('Check On: ', 'eh-dynamic-pricing-discounts');?><span class="fw-normal"><?php echo esc\_html(isset($checkon) && !empty($checkon) ? $checkon : ' - - '); ?></span></h6> |
  |  | 104 | <h6><?php esc\_html\_e('Check On: ', 'eh-dynamic-pricing-discounts'); ?><span class="fw-normal"><?php echo esc\_html(isset($checkon) && !empty($checkon) ? $checkon : ' - - '); ?></span></h6> |
  | 105 | 105 | <h6><?php esc\_html\_e('Minimum ', 'eh-dynamic-pricing-discounts'); ?><?php echo esc\_html(isset($checkon) && !empty($checkon) ? $checkon : ' - - '); ?>: <span class="fw-normal"><?php echo esc\_html(isset($value['min']) && !empty($value['min']) ? $value['min'] : ' - - '); ?></span></h6> |
  | 106 | 106 | <h6><?php esc\_html\_e('Maximum ', 'eh-dynamic-pricing-discounts'); ?><?php echo esc\_html(isset($checkon) && !empty($checkon) ? $checkon : ' - - '); ?>: <span class="fw-normal"><?php echo esc\_html(isset($value['max']) && !empty($value['max']) ? $value['max'] : ' - - '); ?></span></h6> |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/card/category-rules.php?rev=3133197#L128) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/card/category-rules.php?rev=3211131#L128) |  |
  | 128 | 128 | } |
  | 129 | 129 | } |
  | 130 |  | }~~else~~{ |
  |  | 130 | } else { |
  | 131 | 131 | echo '<div class="btn elex-light-blue-bg">' . esc\_html\_\_(' - - ', 'eh-dynamic-pricing-discounts') . '</div>'; |
  | 132 | 132 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/card/category-rules.php?rev=3133197#L150) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/card/category-rules.php?rev=3211131#L150) |  |
  | 150 | 150 | </div> |
  | 151 | 151 | <div class="d-flex justify-content-between"> |
  | 152 |  | <h6 class="mb-0"><?php esc\_html\_e('Minimum Number of Previous Order: ', 'eh-dynamic-pricing-discounts');?> <?php echo esc\_html(isset($value['prev\_order\_count']) && !empty($value['prev\_order\_count']) ? $value['prev\_order\_count'] : ' - - '); ?></h6> |
  | 153 |  | <h6 class="mb-0"><?php esc\_html\_e('Minimum Total Spending on Previous Order: ', 'eh-dynamic-pricing-discounts');?> <?php echo esc\_html(isset($value['prev\_order\_total\_amt']) && !empty($value['prev\_order\_total\_amt']) ? $value['prev\_order\_total\_amt'] : ' - - '); ?></h6> |
  |  | 152 | <h6 class="mb-0"><?php esc\_html\_e('Minimum Number of Previous Order: ', 'eh-dynamic-pricing-discounts'); ?> <?php echo esc\_html(isset($value['prev\_order\_count']) && !empty($value['prev\_order\_count']) ? $value['prev\_order\_count'] : ' - - '); ?></h6> |
  |  | 153 | <h6 class="mb-0"><?php esc\_html\_e('Minimum Total Spending on Previous Order: ', 'eh-dynamic-pricing-discounts'); ?> <?php echo esc\_html(isset($value['prev\_order\_total\_amt']) && !empty($value['prev\_order\_total\_amt']) ? $value['prev\_order\_total\_amt'] : ' - - '); ?></h6> |
  | 154 | 154 | </div> |
  | 155 | 155 | </div> |
* ## [elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/card/product-rules.php](/changeset/3211131/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/card/product-rules.php "Show the changeset 3211131 restricted to elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/card/product-rules.php")

  | [r3133197](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/card/product-rules.php?rev=3133197#L21 "Show revision 3133197 of this file in browser") | [r3211131](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/card/product-rules.php?rev=3211131#L21 "Show revision 3211131 of this file in browser") |  |
  | --- | --- | --- |
  | 21 | 21 | <div class="flex-fill"> |
  | 22 | 22 | <div class="d-flex justify-content-between mb-3"> |
  | 23 |  | <h6 class="mb-0"><?php esc\_html\_e('Rule #: ', 'eh-dynamic-pricing-discounts'); ?><span class="fw-normal"><?php echo esc\_html($key); ?></span> | <?php esc\_html\_e('Rule Name: ', 'eh-dynamic-pricing-discounts'); ?><span class="fw-normal"><?php echo (~~isset($value['offer\_name']) && !empty($value['offer\_name'])~~) ? esc\_html($value['offer\_name']) : ' - - '; ?></span></h6> |
  | 24 |  | <h6 class="mb-0"><?php esc\_html\_e('Validty: ', 'eh-dynamic-pricing-discounts'); ?><span class="fw-normal"><?php echo (~~isset($value['from\_date']) && !empty($value['from\_date']) && isset($value['to\_date']) && !empty($value['to\_date'])~~) ? esc\_html($value['from\_date'] . '/' . esc\_html($value['to\_date'])) : ' --/--'; ?></span> |
  |  | 23 | <h6 class="mb-0"><?php esc\_html\_e('Rule #: ', 'eh-dynamic-pricing-discounts'); ?><span class="fw-normal"><?php echo esc\_html($key); ?></span> | <?php esc\_html\_e('Rule Name: ', 'eh-dynamic-pricing-discounts'); ?><span class="fw-normal"><?php echo ( isset($value['offer\_name']) && !empty($value['offer\_name']) ) ? esc\_html($value['offer\_name']) : ' - - '; ?></span></h6> |
  |  | 24 | <h6 class="mb-0"><?php esc\_html\_e('Validty: ', 'eh-dynamic-pricing-discounts'); ?><span class="fw-normal"><?php echo ( isset($value['from\_date']) && !empty($value['from\_date']) && isset($value['to\_date']) && !empty($value['to\_date']) ) ? esc\_html($value['from\_date'] . '/' . esc\_html($value['to\_date'])) : ' --/--'; ?></span> |
  | 25 | 25 | </h6> |
  | 26 | 26 | </div> |
  | 27 | 27 |  |
  | 28 | 28 | <div class="d-flex justify-content-between "> |
  | 29 |  | <h6 class="mb-0"><?php esc\_html\_e('Discount Type: ', 'eh-dynamic-pricing-discounts'); ?><span class="fw-normal"><?php echo (~~isset($value['discount\_type']) && !empty($value['discount\_type'])~~)? esc\_html($value['discount\_type']) : ' - - '; ?></span> |
  |  | 29 | <h6 class="mb-0"><?php esc\_html\_e('Discount Type: ', 'eh-dynamic-pricing-discounts'); ?><span class="fw-normal"><?php echo ( isset($value['discount\_type']) && !empty($value['discount\_type']) )? esc\_html($value['discount\_type']) : ' - - '; ?></span> |
  | 30 | 30 | </h6> |
  | 31 |  | <h6 class="mb-0"><?php esc\_html\_e('Discount Value: ', 'eh-dynamic-pricing-discounts'); ?><span class="fw-normal"><?php echo (~~isset($value['value']) && !empty($value['value'])~~) ? esc\_html($value['value']) : ' - - '; ?></span> |
  |  | 31 | <h6 class="mb-0"><?php esc\_html\_e('Discount Value: ', 'eh-dynamic-pricing-discounts'); ?><span class="fw-normal"><?php echo ( isset($value['value']) && !empty($value['value']) ) ? esc\_html($value['value']) : ' - - '; ?></span> |
  | 32 | 32 | </h6> |
  | 33 |  | <h6 class="mb-0"><?php esc\_html\_e('Max Discount: ', 'eh-dynamic-pricing-discounts'); ?><span class="fw-normal"><?php echo (~~isset($value['max\_discount']) && !empty($value['max\_discount'])~~) ? esc\_html($value['max\_discount']) : ' - - '; ?></span></h6> |
  |  | 33 | <h6 class="mb-0"><?php esc\_html\_e('Max Discount: ', 'eh-dynamic-pricing-discounts'); ?><span class="fw-normal"><?php echo ( isset($value['max\_discount']) && !empty($value['max\_discount']) ) ? esc\_html($value['max\_discount']) : ' - - '; ?></span></h6> |
  | 34 | 34 | </div> |
  | 35 | 35 | </div> |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/card/product-rules.php?rev=3133197#L63) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/card/product-rules.php?rev=3211131#L63) |  |
  | 63 | 63 | $product = wc\_get\_product($\_pid); |
  | 64 | 64 | if (!empty($\_pid) && !empty($product)) { |
  | 65 |  | echo '<div class="btn elex-light-blue-bg">' . \_\_($product->get\_formatted\_name(),'eh-dynamic-pricing-discounts') . '</div>'; |
  |  | 65 | echo '<div class="btn elex-light-blue-bg">' . \_\_($product->get\_formatted\_name(), 'eh-dynamic-pricing-discounts') . '</div>'; |
  | 66 | 66 | } |
  | 67 | 67 | } |
  | 68 |  | }~~else~~{ |
  |  | 68 | } else { |
  | 69 | 69 | echo '<div class="btn elex-light-blue-bg">' . esc\_html\_\_(' - - ', 'eh-dynamic-pricing-discounts') . '</div>'; |
  | 70 | 70 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/card/product-rules.php?rev=3133197#L82) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/card/product-rules.php?rev=3211131#L82) |  |
  | 82 | 82 | echo '<div class="btn elex-light-blue-bg">' . esc\_html($category) . '</div>'; |
  | 83 | 83 | } |
  | 84 |  | }~~else~~{ |
  |  | 84 | } else { |
  | 85 | 85 | echo '<div class="btn elex-light-blue-bg">' . esc\_html\_\_(' - - ', 'eh-dynamic-pricing-discounts') . '</div>'; |
  | 86 | 86 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/card/product-rules.php?rev=3133197#L94) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/card/product-rules.php?rev=3211131#L94) |  |
  | 94 | 94 | <?php |
  | 95 | 95 | echo '<div class="btn elex-light-blue-bg">' . esc\_html\_\_('\* All Products in cart \*', 'eh-dynamic-pricing-discounts') . '</div>'; |
  | 96 |  | ?> |
  |  | 96 | ?> |
  | 97 | 97 | </div> |
  | 98 | 98 | </div> |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/card/product-rules.php?rev=3133197#L154) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/card/product-rules.php?rev=3211131#L154) |  |
  | 154 | 154 | } |
  | 155 | 155 | } |
  | 156 |  | }~~else~~{ |
  |  | 156 | } else { |
  | 157 | 157 | echo '<div class="btn elex-light-blue-bg">' . esc\_html\_\_(' - - ', 'eh-dynamic-pricing-discounts') . '</div>'; |
  | 158 | 158 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/card/product-rules.php?rev=3133197#L176) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/card/product-rules.php?rev=3211131#L176) |  |
  | 176 | 176 | </div> |
  | 177 | 177 | <div class="d-flex justify-content-between"> |
  | 178 |  | <h6 class="mb-0"><?php esc\_html\_e('Minimum Number of Previous Order: ', 'eh-dynamic-pricing-discounts');?> <?php echo esc\_html(isset($value['prev\_order\_count']) && !empty($value['prev\_order\_count']) ? $value['prev\_order\_count'] : ' - - '); ?></h6> |
  | 179 |  | <h6 class="mb-0"><?php esc\_html\_e('Minimum Total Spending on Previous Order: ', 'eh-dynamic-pricing-discounts');?> <?php echo esc\_html(isset($value['prev\_order\_total\_amt']) && !empty($value['prev\_order\_total\_amt']) ? $value['prev\_order\_total\_amt'] : ' - - '); ?></h6> |
  |  | 178 | <h6 class="mb-0"><?php esc\_html\_e('Minimum Number of Previous Order: ', 'eh-dynamic-pricing-discounts'); ?> <?php echo esc\_html(isset($value['prev\_order\_count']) && !empty($value['prev\_order\_count']) ? $value['prev\_order\_count'] : ' - - '); ?></h6> |
  |  | 179 | <h6 class="mb-0"><?php esc\_html\_e('Minimum Total Spending on Previous Order: ', 'eh-dynamic-pricing-discounts'); ?> <?php echo esc\_html(isset($value['prev\_order\_total\_amt']) && !empty($value['prev\_order\_total\_amt']) ? $value['prev\_order\_total\_amt'] : ' - - '); ?></h6> |
  | 180 | 180 | </div> |
  | 181 | 181 | </div> |
* ## [elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/popup/category-rules.php](/changeset/3211131/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/popup/category-rules.php "Show the changeset 3211131 restricted to elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/popup/category-rules.php")

  | [r3049195](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/popup/category-rules.php?rev=3049195#L5 "Show revision 3049195 of this file in browser") | [r3211131](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/popup/category-rules.php?rev=3211131#L5 "Show revision 3211131 of this file in browser") |  |
  | --- | --- | --- |
  | 5 | 5 | if (isset($\_REQUEST['edit']) && !empty($\_REQUEST['edit'])) { |
  | 6 | 6 | $edit\_value = sanitize\_text\_field($\_REQUEST['edit']); |
  | 7 |  | echo '<input type="hidden" name="update" value="' . esc\_attr($edit\_value) . '" >'; |
  |  | 7 | echo '<input type="hidden" name="update" value="' . esc\_attr($edit\_value) . '" >'; |
  | 8 | 8 | } |
  | 9 | 9 | ?> |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/popup/category-rules.php?rev=3049195#L101) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/popup/category-rules.php?rev=3211131#L101) |  |
  | 101 | 101 | <span><?php esc\_html\_e('Restrictions', 'eh-dynamic-pricing-discounts'); ?><sup class="elex\_dp\_go\_premium\_color"><?php esc\_html\_e('[Premium]', 'eh-dynamic-pricing-discounts'); ?></sup></span> |
  | 102 | 102 | </div> |
  | 103 |  | </div> |
  |  | 103 | </div> |
  | 104 | 104 |  |
  | 105 | 105 | <!-- tabs content --> |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/popup/category-rules.php?rev=3049195#L161) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/popup/category-rules.php?rev=3211131#L161) |  |
  | 161 | 161 | <div class="col-md-8"> |
  | 162 | 162 | <select name="check\_on" id="check\_on" class="form-select min-width-100"> |
  | 163 |  | <option value="Quantity" <?php selected(!empty($\_REQUEST['check\_on']) && (~~$\_REQUEST['check\_on'] == 'Quantity'~~)); ?>><?php esc\_html\_e('No. of items', 'eh-dynamic-pricing-discounts'); ?></option> |
  | 164 |  | <option value="Weight" <?php selected(!empty($\_REQUEST['check\_on']) && (~~$\_REQUEST['check\_on'] == 'Weight'~~)); ?>><?php esc\_html\_e('Weight', 'eh-dynamic-pricing-discounts'); ?></option> |
  | 165 |  | <option value="Price" <?php selected(!empty($\_REQUEST['check\_on']) && (~~$\_REQUEST['check\_on'] == 'Price'~~)); ?>><?php esc\_html\_e('Price', 'eh-dynamic-pricing-discounts'); ?></option> |
  | 166 |  | <option value="TotalQuantity" <?php selected(!empty($\_REQUEST['check\_on']) && (~~$\_REQUEST['check\_on'] == 'TotalQuantity'~~)); ?>><?php esc\_html\_e('No. of Units', 'eh-dynamic-pricing-discounts'); ?></option> |
  |  | 163 | <option value="Quantity" <?php selected(!empty($\_REQUEST['check\_on']) && ( $\_REQUEST['check\_on'] == 'Quantity' )); ?>><?php esc\_html\_e('No. of items', 'eh-dynamic-pricing-discounts'); ?></option> |
  |  | 164 | <option value="Weight" <?php selected(!empty($\_REQUEST['check\_on']) && ( $\_REQUEST['check\_on'] == 'Weight' )); ?>><?php esc\_html\_e('Weight', 'eh-dynamic-pricing-discounts'); ?></option> |
  |  | 165 | <option value="Price" <?php selected(!empty($\_REQUEST['check\_on']) && ( $\_REQUEST['check\_on'] == 'Price' )); ?>><?php esc\_html\_e('Price', 'eh-dynamic-pricing-discounts'); ?></option> |
  |  | 166 | <option value="TotalQuantity" <?php selected(!empty($\_REQUEST['check\_on']) && ( $\_REQUEST['check\_on'] == 'TotalQuantity' )); ?>><?php esc\_html\_e('No. of Units', 'eh-dynamic-pricing-discounts'); ?></option> |
  | 167 | 167 | </select> |
  | 168 | 168 | </div> |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/popup/category-rules.php?rev=3049195#L211) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/popup/category-rules.php?rev=3211131#L211) |  |
  | 211 | 211 | <select name="discount\_type" id="discount\_type" |
  | 212 | 212 | class="form-select min-width-100 elex-dynamic-pricing-discount-type-select"> |
  | 213 |  | <option value="Percent Discount" <?php selected(!empty($\_REQUEST['discount\_type']) && (~~$\_REQUEST['discount\_type'] == 'Percent Discount'~~)); ?>><?php esc\_html\_e('Percent Discount', 'eh-dynamic-pricing-discounts'); ?></option> |
  | 214 |  | <option value="Flat Discount" <?php selected(!empty($\_REQUEST['discount\_type']) && (~~$\_REQUEST['discount\_type'] == 'Flat Discount'~~)); ?>><?php esc\_html\_e('Flat Discount', 'eh-dynamic-pricing-discounts'); ?></option> |
  | 215 |  | <option value="Fixed Price" <?php selected(!empty($\_REQUEST['discount\_type']) && (~~$\_REQUEST['discount\_type'] == 'Fixed Price'~~)); ?>><?php esc\_html\_e('Fixed Price', 'eh-dynamic-pricing-discounts'); ?></option> |
  |  | 213 | <option value="Percent Discount" <?php selected(!empty($\_REQUEST['discount\_type']) && ( $\_REQUEST['discount\_type'] == 'Percent Discount' )); ?>><?php esc\_html\_e('Percent Discount', 'eh-dynamic-pricing-discounts'); ?></option> |
  |  | 214 | <option value="Flat Discount" <?php selected(!empty($\_REQUEST['discount\_type']) && ( $\_REQUEST['discount\_type'] == 'Flat Discount' )); ?>><?php esc\_html\_e('Flat Discount', 'eh-dynamic-pricing-discounts'); ?></option> |
  |  | 215 | <option value="Fixed Price" <?php selected(!empty($\_REQUEST['discount\_type']) && ( $\_REQUEST['discount\_type'] == 'Fixed Price' )); ?>><?php esc\_html\_e('Fixed Price', 'eh-dynamic-pricing-discounts'); ?></option> |
  | 216 | 216 | <option value="Coupon Discount" disabled><?php esc\_html\_e('Coupon Discount', 'eh-dynamic-pricing-discounts'); ?> |
  | 217 | 217 | <sup class="elex\_dp\_go\_premium\_color"><?php esc\_html\_e('[Premium]', 'eh-dynamic-pricing-discounts'); ?></sup></option> |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/popup/category-rules.php?rev=3049195#L224) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/popup/category-rules.php?rev=3211131#L224) |  |
  | 224 | 224 | <div class="d-flex gap-2 justify-content-between"> |
  | 225 | 225 | <h6 id="discount\_value" class="mb-0 elex-dynamic-input-label"><?php esc\_html\_e('Discount Percent', 'eh-dynamic-pricing-discounts'); ?><span class="text-danger">\*</span> </h6> |
  | 226 |  | <i id="discount\_desc" class="desc-tip fa-regular fa-circle-question" data-tip='<?php echo esc\_attr\_\_('If you select `Percentage Discount`, the given percentage (value) would be discounted on each unit of the product in the cart. |
  |  | 226 | <i id="discount\_desc" class="desc-tip fa-regular fa-circle-question" data-tip=' |
  |  | 227 | <?php |
  |  | 228 | echo esc\_attr\_\_('If you select `Percentage Discount`, the given percentage (value) would be discounted on each unit of the product in the cart. |
  | 227 | 229 | If you select `Flat Discount`, the given amount (value) would be discounted at subtotal level in the cart. |
  | 228 | 230 | If you select `Fixed Price`, the original price of the product is replaced by the given fixed price (value). |
  | 229 |  | If you select `Coupon dicount`, the original price of the cart total is discounted with the selected coupon offer (value).'); ?>'></i> |
  |  | 231 | If you select `Coupon dicount`, the original price of the cart total is discounted with the selected coupon offer (value).'); |
  |  | 232 | ?> |
  |  | 233 | '></i> |
  | 230 | 234 | </div> |
  | 231 | 235 | </div> |
* ## [elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/popup/product-rules.php](/changeset/3211131/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/popup/product-rules.php "Show the changeset 3211131 restricted to elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/popup/product-rules.php")

  | [r3049195](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/popup/product-rules.php?rev=3049195#L238 "Show revision 3049195 of this file in browser") | [r3211131](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/popup/product-rules.php?rev=3211131#L238 "Show revision 3211131 of this file in browser") |  |
  | --- | --- | --- |
  | 238 | 238 | <div class="col-md-8"> |
  | 239 | 239 | <select name="check\_on" id="check\_on" class="form-select min-width-100"> |
  | 240 |  | <option value="Quantity" <?php selected(!empty($\_REQUEST['check\_on']) && (~~$\_REQUEST['check\_on'] == 'Quantity'~~)); ?>><?php esc\_html\_e('No. of items', 'eh-dynamic-pricing-discounts'); ?></option> |
  | 241 |  | <option value="Weight" <?php selected(!empty($\_REQUEST['check\_on']) && (~~$\_REQUEST['check\_on'] == 'Weight'~~)); ?>><?php esc\_html\_e('Weight', 'eh-dynamic-pricing-discounts'); ?></option> |
  | 242 |  | <option value="Price" <?php selected(!empty($\_REQUEST['check\_on']) && (~~$\_REQUEST['check\_on'] == 'Price'~~)); ?>><?php esc\_html\_e('Price', 'eh-dynamic-pricing-discounts'); ?></option> |
  | 243 |  | <option value="Units" <?php selected(!empty($\_REQUEST['check\_on']) && (~~$\_REQUEST['check\_on'] == 'Units'~~)); ?>><?php esc\_html\_e('No. of Units', 'eh-dynamic-pricing-discounts'); ?></option> |
  |  | 240 | <option value="Quantity" <?php selected(!empty($\_REQUEST['check\_on']) && ( $\_REQUEST['check\_on'] == 'Quantity' )); ?>><?php esc\_html\_e('No. of items', 'eh-dynamic-pricing-discounts'); ?></option> |
  |  | 241 | <option value="Weight" <?php selected(!empty($\_REQUEST['check\_on']) && ( $\_REQUEST['check\_on'] == 'Weight' )); ?>><?php esc\_html\_e('Weight', 'eh-dynamic-pricing-discounts'); ?></option> |
  |  | 242 | <option value="Price" <?php selected(!empty($\_REQUEST['check\_on']) && ( $\_REQUEST['check\_on'] == 'Price' )); ?>><?php esc\_html\_e('Price', 'eh-dynamic-pricing-discounts'); ?></option> |
  |  | 243 | <option value="Units" <?php selected(!empty($\_REQUEST['check\_on']) && ( $\_REQUEST['check\_on'] == 'Units' )); ?>><?php esc\_html\_e('No. of Units', 'eh-dynamic-pricing-discounts'); ?></option> |
  | 244 | 244 | </select> |
  | 245 | 245 | </div> |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/popup/product-rules.php?rev=3049195#L288) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/popup/product-rules.php?rev=3211131#L288) |  |
  | 288 | 288 | <select name="discount\_type" id="discount\_type" |
  | 289 | 289 | class="form-select min-width-100 elex-dynamic-pricing-discount-type-select"> |
  | 290 |  | <option value="Percent Discount" <?php selected(!empty($\_REQUEST['discount\_type']) && (~~$\_REQUEST['discount\_type'] == 'Percent Discount'~~)); ?>><?php esc\_html\_e('Percent Discount', 'eh-dynamic-pricing-discounts'); ?></option> |
  | 291 |  | <option value="Flat Discount" <?php selected(!empty($\_REQUEST['discount\_type']) && (~~$\_REQUEST['discount\_type'] == 'Flat Discount'~~)); ?>><?php esc\_html\_e('Flat Discount', 'eh-dynamic-pricing-discounts'); ?></option> |
  | 292 |  | <option value="Fixed Price" <?php selected(!empty($\_REQUEST['discount\_type']) && (~~$\_REQUEST['discount\_type'] == 'Fixed Price'~~)); ?>><?php esc\_html\_e('Fixed Price', 'eh-dynamic-pricing-discounts'); ?></option> |
  |  | 290 | <option value="Percent Discount" <?php selected(!empty($\_REQUEST['discount\_type']) && ( $\_REQUEST['discount\_type'] == 'Percent Discount' )); ?>><?php esc\_html\_e('Percent Discount', 'eh-dynamic-pricing-discounts'); ?></option> |
  |  | 291 | <option value="Flat Discount" <?php selected(!empty($\_REQUEST['discount\_type']) && ( $\_REQUEST['discount\_type'] == 'Flat Discount' )); ?>><?php esc\_html\_e('Flat Discount', 'eh-dynamic-pricing-discounts'); ?></option> |
  |  | 292 | <option value="Fixed Price" <?php selected(!empty($\_REQUEST['discount\_type']) && ( $\_REQUEST['discount\_type'] == 'Fixed Price' )); ?>><?php esc\_html\_e('Fixed Price', 'eh-dynamic-pricing-discounts'); ?></option> |
  | 293 | 293 | <option value="Coupon Discount" disabled><?php esc\_html\_e('Coupon Discount', 'eh-dynamic-pricing-discounts'); ?> |
  | 294 | 294 | <sup class="elex\_dp\_go\_premium\_color"><?php esc\_html\_e('[Premium]', 'eh-dynamic-pricing-discounts'); ?></sup></option> |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/popup/product-rules.php?rev=3049195#L301) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/popup/product-rules.php?rev=3211131#L301) |  |
  | 301 | 301 | <div class="d-flex gap-2 justify-content-between"> |
  | 302 | 302 | <h6 id="discount\_value" class="mb-0 elex-dynamic-input-label"><?php esc\_html\_e('Discount Percent', 'eh-dynamic-pricing-discounts'); ?><span class="text-danger">\*</span> </h6> |
  | 303 |  | <i id="discount\_desc" class="desc-tip fa-regular fa-circle-question" data-tip='<?php echo esc\_attr\_\_('If you select `Percentage Discount`, the given percentage (value) would be discounted on each unit of the product in the cart. |
  |  | 303 | <i id="discount\_desc" class="desc-tip fa-regular fa-circle-question" data-tip=' |
  |  | 304 | <?php |
  |  | 305 | echo esc\_attr\_\_('If you select `Percentage Discount`, the given percentage (value) would be discounted on each unit of the product in the cart. |
  | 304 | 306 | If you select `Flat Discount`, the given amount (value) would be discounted at subtotal level in the cart. |
  | 305 | 307 | If you select `Fixed Price`, the original price of the product is replaced by the given fixed price (value). |
  | 306 |  | If you select `Coupon dicount`, the original price of the cart total is discounted with the selected coupon offer (value).'); ?>'></i> |
  |  | 308 | If you select `Coupon dicount`, the original price of the cart total is discounted with the selected coupon offer (value).'); |
  |  | 309 | ?> |
  |  | 310 | '></i> |
  | 307 | 311 | </div> |
  | 308 | 312 | </div> |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/popup/product-rules.php?rev=3049195#L409) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/popup/product-rules.php?rev=3211131#L413) |  |
  | 409 | 413 | foreach ($roles as $key=>$val) { |
  | 410 | 414 | $is\_selected =in\_array($key, $selected)?' selected ':' '; |
  | 411 |  | echo "<option value='$key' " . esc\_attr($is\_selected). " >$val</option>"; |
  |  | 415 | echo "<option value='$key' " . esc\_attr($is\_selected) . " >$val</option>"; |
  | 412 | 416 | } |
  | 413 | 417 | ?> |
* ## [elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/help-support/faqs.php](/changeset/3211131/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/help-support/faqs.php "Show the changeset 3211131 restricted to elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/help-support/faqs.php")

  | [r3049195](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/help-support/faqs.php?rev=3049195#L5 "Show revision 3049195 of this file in browser") | [r3211131](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/help-support/faqs.php?rev=3211131#L5 "Show revision 3211131 of this file in browser") |  |
  | --- | --- | --- |
  | 5 | 5 |  |
  | 6 | 6 | $faqs = array( |
  | 7 |  | ~~array(~~ |
  | 8 |  | ~~'question' => esc\_html\_\_('Can the BOGO rule apply percentage discounts on the second product?', 'eh-dynamic-pricing-discounts'),~~ |
  | 9 |  | ~~'answer'   => esc\_html\_\_('Currently, the plugin only allows you to keep the second product as a free product. However, our team has explored the feasibility of giving a percentage discount on it, and this feature will be available in the upcoming version.', 'eh-dynamic-pricing-discounts'),~~ |
  | 10 |  | ~~),~~ |
  | 11 |  | ~~array(~~ |
  | 12 |  | ~~'question' => esc\_html\_\_('How can I apply coupon codes for the discount rules?', 'eh-dynamic-pricing-discounts'),~~ |
  | 13 |  | ~~'answer'   => esc\_html\_\_('While creating a rule, you can apply a coupon discount by selecting "Coupon Discount" as the discount type. Then, you can either create a dynamic coupon or associate an existing WooCommerce coupon with the rule from the "Associate Coupon & Roles" section.', 'eh-dynamic-pricing-discounts'),~~ |
  | 14 |  | ~~),~~ |
  | 15 |  | ~~array(~~ |
  | 16 |  | ~~'question' => esc\_html\_\_('Can I offer the cheapest product in the cart as a free product to the customer?', 'eh-dynamic-pricing-discounts'),~~ |
  | 17 |  | ~~'answer'   => esc\_html\_\_('Yes, you can offer the cheapest product in the cart as a free product. To do this, you need to create a BOGO rule and select "The Cheapest product in the Cart" under the free products section.', 'eh-dynamic-pricing-discounts'),~~ |
  | 18 |  | ~~),~~ |
  | 19 | 7 | array( |
  | 20 |  | ~~'question' => esc\_html\_\_('What does the "504 Timeout error" on the shop page mean~~?', 'eh-dynamic-pricing-discounts'), |
  | 21 |  | ~~'answer'   => esc\_html\_\_('When a website has a large number of products and multiple rules created with the plugin, the scanning of all the products during page loading can lead to performance issues and cause a 504 error to occur~~.', 'eh-dynamic-pricing-discounts'), |
  | 22 |  | ), |
  |  | 8 | 'question' => esc\_html\_\_('Can the BOGO rule apply percentage discounts on the second product?', 'eh-dynamic-pricing-discounts'), |
  |  | 9 | 'answer'   => esc\_html\_\_('Currently, the plugin only allows you to keep the second product as a free product. However, our team has explored the feasibility of giving a percentage discount on it, and this feature will be available in the upcoming version.', 'eh-dynamic-pricing-discounts'), |
  |  | 10 | ), |
  | 23 | 11 | array( |
  | 24 |  | ~~'question' => esc\_html\_\_('If the BOGO rule is satisfied, does it automatically add the free product to the cart~~?', 'eh-dynamic-pricing-discounts'), |
  | 25 |  | ~~'answer'   => esc\_html\_\_('Yes, the plugin automatically adds the free product to the cart page if the rule is satisfied~~.', 'eh-dynamic-pricing-discounts'), |
  | 26 |  | ), |
  |  | 12 | 'question' => esc\_html\_\_('How can I apply coupon codes for the discount rules?', 'eh-dynamic-pricing-discounts'), |
  |  | 13 | 'answer'   => esc\_html\_\_('While creating a rule, you can apply a coupon discount by selecting "Coupon Discount" as the discount type. Then, you can either create a dynamic coupon or associate an existing WooCommerce coupon with the rule from the "Associate Coupon & Roles" section.', 'eh-dynamic-pricing-discounts'), |
  |  | 14 | ), |
  | 27 | 15 | array( |
  | 28 |  | ~~'question' => esc\_html\_\_('What is the difference between a product rule and a cart rule~~?', 'eh-dynamic-pricing-discounts'), |
  | 29 |  | ~~'answer'   => esc\_html\_\_('In a product rule, you can select and apply discounts to the specific product(s) in your store. On the other hand, a cart rule allows you to give a discount for the products that are added to the cart~~.', 'eh-dynamic-pricing-discounts'), |
  | 30 |  | ), |
  |  | 16 | 'question' => esc\_html\_\_('Can I offer the cheapest product in the cart as a free product to the customer?', 'eh-dynamic-pricing-discounts'), |
  |  | 17 | 'answer'   => esc\_html\_\_('Yes, you can offer the cheapest product in the cart as a free product. To do this, you need to create a BOGO rule and select "The Cheapest product in the Cart" under the free products section.', 'eh-dynamic-pricing-discounts'), |
  |  | 18 | ), |
  | 31 | 19 | array( |
  | 32 |  | 'question' => esc\_html\_\_('How can I customize the pricing table?', 'eh-dynamic-pricing-discounts'), |
  | 33 |  | 'answer'   => esc\_html\_\_('You can customize the pricing table by configuring it in the "Settings" > "Other Options" > "Pricing Table" section.', 'eh-dynamic-pricing-discounts'), |
  | 34 |  | ), |
  |  | 20 | 'question' => esc\_html\_\_('What does the "504 Timeout error" on the shop page mean?', 'eh-dynamic-pricing-discounts'), |
  |  | 21 | 'answer'   => esc\_html\_\_('When a website has a large number of products and multiple rules created with the plugin, the scanning of all the products during page loading can lead to performance issues and cause a 504 error to occur.', 'eh-dynamic-pricing-discounts'), |
  |  | 22 | ), |
  |  | 23 | array( |
  |  | 24 | 'question' => esc\_html\_\_('If the BOGO rule is satisfied, does it automatically add the free product to the cart?', 'eh-dynamic-pricing-discounts'), |
  |  | 25 | 'answer'   => esc\_html\_\_('Yes, the plugin automatically adds the free product to the cart page if the rule is satisfied.', 'eh-dynamic-pricing-discounts'), |
  |  | 26 | ), |
  |  | 27 | array( |
  |  | 28 | 'question' => esc\_html\_\_('What is the difference between a product rule and a cart rule?', 'eh-dynamic-pricing-discounts'), |
  |  | 29 | 'answer'   => esc\_html\_\_('In a product rule, you can select and apply discounts to the specific product(s) in your store. On the other hand, a cart rule allows you to give a discount for the products that are added to the cart.', 'eh-dynamic-pricing-discounts'), |
  |  | 30 | ), |
  |  | 31 | array( |
  |  | 32 | 'question' => esc\_html\_\_('How can I customize the pricing table?', 'eh-dynamic-pricing-discounts'), |
  |  | 33 | 'answer'   => esc\_html\_\_('You can customize the pricing table by configuring it in the "Settings" > "Other Options" > "Pricing Table" section.', 'eh-dynamic-pricing-discounts'), |
  |  | 34 | ), |
  | 35 | 35 | ); |
  | 36 | 36 | ?> |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/help-support/faqs.php?rev=3049195#L44) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/help-support/faqs.php?rev=3211131#L44) |  |
  | 44 | 44 | data-bs-target="#flush-collapse<?php echo esc\_attr($index + 1); ?>" |
  | 45 | 45 | aria-expanded="false" aria-controls="flush-collapse<?php echo esc\_attr($index + 1); ?>"> |
  | 46 |  | <div><?php echo esc\_html\_\_('Q', 'eh-dynamic-pricing-discounts') . (~~$index + 1~~) . '.'; ?></div> |
  |  | 46 | <div><?php echo esc\_html\_\_('Q', 'eh-dynamic-pricing-discounts') . ( $index + 1 ) . '.'; ?></div> |
  | 47 | 47 | <div><?php echo esc\_html($faq['question']); ?></div> |
  | 48 | 48 | </button> |
* ## [elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/help-support/ticket.php](/changeset/3211131/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/help-support/ticket.php "Show the changeset 3211131 restricted to elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/help-support/ticket.php")

  | [r3049195](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/help-support/ticket.php?rev=3049195#L7 "Show revision 3049195 of this file in browser") | [r3211131](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/help-support/ticket.php?rev=3211131#L7 "Show revision 3211131 of this file in browser") |  |
  | --- | --- | --- |
  | 7 | 7 | <div class="p-1 fw-bold"> |
  | 8 | 8 | <p><?php esc\_html\_e('Before raising the ticket, we recommend you to go through our', 'eh-dynamic-pricing-discounts'); ?> |
  | 9 |  | <a href="<?php echo esc\_url('https://elextensions.com/knowledge-base/set-up-elex-dynamic-pricing-and-discounts-plugin-for-woocommerce/'); ?>" target="\_blank"><?php esc\_html\_e('detailed documentation.', 'eh-dynamic-pricing-discounts'); ?></a></p> |
  |  | 9 | <a href="<?php echo esc\_url('https://elextensions.com/knowledge-base/set-up-elex-dynamic-pricing-and-discounts-plugin-for-woocommerce/'); ?>" target="\_blank"><?php esc\_html\_e('detailed documentation.', 'eh-dynamic-pricing-discounts'); ?></a></p> |
  | 10 | 10 | <p><?php esc\_html\_e('Or', 'eh-dynamic-pricing-discounts'); ?></p> |
  | 11 | 11 | <p class="mb-0"><?php esc\_html\_e('To get in touch with our helpdesk representative. Just raise a support ticket on our website.', 'eh-dynamic-pricing-discounts'); ?></p> |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/help-support/ticket.php?rev=3049195#L38) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/help-support/ticket.php?rev=3211131#L38) |  |
  | 38 | 38 | <script> |
  | 39 | 39 | jQuery(document).ready(function() { |
  | 40 |  |  |
  |  | 40 |  |
  | 41 | 41 | if (hasURLKey('downloadfailure')) { |
  | 42 | 42 | showSuccessNotification('downloadfailure'); |
* ## [elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/market.php](/changeset/3211131/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/market.php "Show the changeset 3211131 restricted to elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/market.php")

  | [r3049195](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/market.php?rev=3049195#L16 "Show revision 3049195 of this file in browser") | [r3211131](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/market.php?rev=3211131#L16 "Show revision 3211131 of this file in browser") |  |
  | --- | --- | --- |
  | 16 | 16 | <div class="row"> |
  | 17 | 17 | <div class=" elex-license-like-img-container col-md-5"> |
  | 18 |  | <?php $dp\_premium\_url = ~~"https://elextensions.com/plugin/dynamic-pricing-and-discounts-plugin-for-woocommerce/?utm\_source=plugin-settings-related&utm\_medium=wp-admin&utm\_campaign=in-prod-ads"~~ ?> |
  |  | 18 | <?php $dp\_premium\_url = 'https://elextensions.com/plugin/dynamic-pricing-and-discounts-plugin-for-woocommerce/?utm\_source=plugin-settings-related&utm\_medium=wp-admin&utm\_campaign=in-prod-ads'; ?> |
  | 19 | 19 | <a target="\_blank" href="<?php echo esc\_url($dp\_premium\_url); ?>"> |
  | 20 | 20 | <img src="<?php echo esc\_url(ELEX\_DP\_CRM\_MAIN\_URL . '/img/dynamic\_pricing.png'); ?>" class="marketing\_logos" alt="<?php esc\_attr\_e('Dynamic Pricing Logo', 'eh-dynamic-pricing-discounts'); ?>"> |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/market.php?rev=3049195#L38) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/market.php?rev=3211131#L38) |  |
  | 38 | 38 | </p> |
  | 39 | 39 | </ul> |
  | 40 |  | <?php $dp\_documentation\_url = ~~"https://elextensions.com/knowledge-base/set-up-elex-dynamic-pricing-and-discounts-plugin-for-woocommerce/"~~ ?> |
  |  | 40 | <?php $dp\_documentation\_url = 'https://elextensions.com/knowledge-base/set-up-elex-dynamic-pricing-and-discounts-plugin-for-woocommerce/'; ?> |
  | 41 | 41 | <center> <a href="<?php echo esc\_url($dp\_documentation\_url); ?>" target="\_blank" class="button button-primary"><?php esc\_html\_e('Documentation', 'eh-dynamic-pricing-discounts'); ?></a></center> |
  | 42 | 42 | </div> |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/market.php?rev=3049195#L48) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/market.php?rev=3211131#L48) |  |
  | 48 | 48 | <h6 class="mb-4"><b><?php esc\_html\_e('You May Also like', 'eh-dynamic-pricing-discounts'); ?></b></h6> |
  | 49 | 49 | <div class="row"> |
  | 50 |  | <?php $plugins = array( |
  |  | 50 | <?php |
  |  | 51 | $plugins = array( |
  | 51 | 52 | array( |
  | 52 | 53 | 'url'   => 'https://elextensions.com/plugin/woocommerce-catalog-mode-wholesale-role-based-pricing/?utm\_source=plugin-settings-related&utm\_medium=wp-admin&utm\_campaign=in-prod-ads', |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/market.php?rev=3049195#L71) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/market.php?rev=3211131#L72) |  |
  | 71 | 72 | ); |
  | 72 | 73 |  |
  | 73 |  | foreach ($plugins as $plugin) : ?> |
  |  | 74 | foreach ($plugins as $plugin) : |
  |  | 75 | ?> |
  | 74 | 76 | <div class="col-md-3 col-6"> |
  | 75 | 77 | <div class="elex-license-like-img-container w-100  mb-3"> |
* ## [elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/settings/rules-execution-order.php](/changeset/3211131/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/settings/rules-execution-order.php "Show the changeset 3211131 restricted to elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/settings/rules-execution-order.php")

  | [r3049195](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/settings/rules-execution-order.php?rev=3049195#L33 "Show revision 3049195 of this file in browser") | [r3211131](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/settings/rules-execution-order.php?rev=3211131#L33 "Show revision 3211131 of this file in browser") |  |
  | --- | --- | --- |
  | 33 | 33 | </th> |
  | 34 | 34 | <td class="text-start fw-bold"> |
  | 35 |  | <?php if($key == 'product\_rules' || $key == 'category\_rules'){ |
  |  | 35 | <?php |
  |  | 36 | if ($key == 'product\_rules' || $key == 'category\_rules') { |
  | 36 | 37 | echo esc\_html($rules\_modes[$key]); |
  | 37 |  | }else{ |
  | 38 |  | echo esc\_html($rules\_modes[$key]);?> |
  | 39 |  | <sup class="elex\_dp\_go\_premium\_color"><?php esc\_html\_e('[Premium]', 'eh-dynamic-pricing-discounts'); ?></sup><?php |
  |  | 38 | } else { |
  |  | 39 | echo esc\_html($rules\_modes[$key]); |
  |  | 40 | ?> |
  |  | 41 | <sup class="elex\_dp\_go\_premium\_color"><?php esc\_html\_e('[Premium]', 'eh-dynamic-pricing-discounts'); ?></sup> |
  |  | 42 | <?php |
  | 40 | 43 |  |
  | 41 |  | } |
  |  | 44 | } |
  | 42 | 45 | ?> |
  | 43 | 46 | </td> |
  | 44 | 47 | <td> |
  | 45 | 48 | <label class="elex-switch-btn"> |
  | 46 |  | <?php if~~($key == 'product\_rules' || $key == 'category\_rules')~~{ ?> |
  |  | 49 | <?php if ($key == 'product\_rules' || $key == 'category\_rules') { ?> |
  | 47 | 50 | <input type="checkbox" name='enabled\_modes[<?php echo esc\_attr($key); ?>]' value='<?php echo esc\_attr($key); ?>' <?php echo in\_array($key, $execution\_order) ? 'checked' : ''; ?>> |
  | 48 | 51 | <div class="elex-switch-icon round"></div> |
  | 49 |  | <?php }~~else~~{ ?> |
  |  | 52 | <?php } else { ?> |
  | 50 | 53 | <div class="elex-switch-icon round"></div> |
  | 51 | 54 | <?php |
  | 52 | 55 |  |
  | 53 | 56 | } |
  | 54 |  | ?> |
  |  | 57 | ?> |
  | 55 | 58 | </label> |
  | 56 | 59 | </td> |
* ## [elex-woocommerce-dynamic-pricing-and-discounts/trunk/elex-dynamic-pricing-and-discounts-for-woocommerce-basic-version.php](/changeset/3211131/elex-woocommerce-dynamic-pricing-and-discounts/trunk/elex-dynamic-pricing-and-discounts-for-woocommerce-basic-version.php "Show the changeset 3211131 restricted to elex-woocommerce-dynamic-pricing-and-discounts/trunk/elex-dynamic-pricing-and-discounts-for-woocommerce-basic-version.php")

  | [r3189520](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/elex-dynamic-pricing-and-discounts-for-woocommerce-basic-version.php?rev=3189520#L4 "Show revision 3189520 of this file in browser") | [r3211131](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/elex-dynamic-pricing-and-discounts-for-woocommerce-basic-version.php?rev=3211131#L4 "Show revision 3211131 of this file in browser") |  |
  | --- | --- | --- |
  | 4 | 4 | \*   Plugin URI: https://elextensions.com/plugin/elex-dynamic-pricing-and-discounts-plugin-for-woocommerce-free-version/ |
  | 5 | 5 | \*   Description: This plugin helps you to set discounts and pricing dynamically based on minimum quantity,weight,price and allow you to set maximum allowed discounts on every rule. |
  | 6 |  | \*   Version: 2.1.~~7~~ |
  |  | 6 | \*   Version: 2.1.8 |
  | 7 | 7 | \*   Author: ELEXtensions |
  | 8 | 8 | \*   WC requires at least: 3.0.0 |
  | 9 |  | \*   WC tested up to: 9.~~4~~ |
  |  | 9 | \*   WC tested up to: 9.5 |
  | 10 | 10 | \*   Author URI: https://elextensions.com |
  | 11 | 11 | \*   Copyright: 2018 ELEX. |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/elex-dynamic-pricing-and-discounts-for-woocommerce-basic-version.php?rev=3189520#L182) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/elex-dynamic-pricing-and-discounts-for-woocommerce-basic-version.php?rev=3211131#L182) |  |
  | 182 | 182 |  |
  | 183 | 183 | $rules\_indexing\_status   = get\_option('xa\_dp\_rules\_indexing\_status'); |
  | 184 |  | if~~(!isset($rules\_indexing\_status) || $rules\_indexing\_status == false)~~{ |
  |  | 184 | if (!isset($rules\_indexing\_status) || $rules\_indexing\_status == false) { |
  | 185 | 185 | require\_once plugin\_dir\_path(\_\_FILE\_\_) . 'includes/elex-dynamic-pricing-plugin-activator.php'; |
  | 186 | 186 | Elex\_dynamic\_pricing\_plugin\_Activator::activate(); |
* ## [elex-woocommerce-dynamic-pricing-and-discounts/trunk/includes/elex-common-functions.php](/changeset/3211131/elex-woocommerce-dynamic-pricing-and-discounts/trunk/includes/elex-common-functions.php "Show the changeset 3211131 restricted to elex-woocommerce-dynamic-pricing-and-discounts/trunk/includes/elex-common-functions.php")

  | [r3004919](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/includes/elex-common-functions.php?rev=3004919#L394 "Show revision 3004919 of this file in browser") | [r3211131](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/includes/elex-common-functions.php?rev=3211131#L394 "Show revision 3211131 of this file in browser") |  |
  | --- | --- | --- |
  | 394 | 394 | $parent\_id =$product->get\_parent\_id(); |
  | 395 | 395 | $parent\_tags = get\_the\_terms($parent\_id, 'product\_tag'); |
  | 396 |  | if~~($parent\_tags)~~{ |
  |  | 396 | if ($parent\_tags) { |
  | 397 | 397 | foreach ($parent\_tags as $key => $parent\_tag) { |
  | 398 | 398 | array\_push($tags\_ids\_array, $parent\_tag->term\_id); |
* ## [elex-woocommerce-dynamic-pricing-and-discounts/trunk/includes/elex-dynamic-pricing-plugin-activator.php](/changeset/3211131/elex-woocommerce-dynamic-pricing-and-discounts/trunk/includes/elex-dynamic-pricing-plugin-activator.php "Show the changeset 3211131 restricted to elex-woocommerce-dynamic-pricing-and-discounts/trunk/includes/elex-dynamic-pricing-plugin-activator.php")

  | [r3004919](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/includes/elex-dynamic-pricing-plugin-activator.php?rev=3004919#L35 "Show revision 3004919 of this file in browser") | [r3211131](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/includes/elex-dynamic-pricing-plugin-activator.php?rev=3211131#L35 "Show revision 3211131 of this file in browser") |  |
  | --- | --- | --- |
  | 35 | 35 | $dummy\_option = array('product\_rules' => array(), 'combinational\_rules' => array(), 'cat\_combinational\_rules' => array(), 'category\_rules' => array(), 'cart\_rules' => array(), 'buy\_get\_free\_rules' => array() ,'BOGO\_category\_rules'=>array(), 'bogo\_tag\_rules' =>array(), 'tag\_rules' => array()); |
  | 36 | 36 | $prev\_rules   = get\_option('xa\_dp\_rules', $dummy\_option); |
  | 37 |  | foreach~~($prev\_rules as $rule\_type => $rules)~~{ |
  |  | 37 | foreach ($prev\_rules as $rule\_type => $rules) { |
  | 38 | 38 | $reordered\_rules = []; |
  | 39 | 39 | $i = 1; |
  | 40 |  | if($rules) { |
  | 41 |  | foreach($rules as $rule) { |
  |  | 40 | if ($rules) { |
  |  | 41 | foreach ($rules as $rule) { |
  | 42 | 42 | $reordered\_rules[$i] = $rule; |
  | 43 | 43 | $i++; |
* ## [elex-woocommerce-dynamic-pricing-and-discounts/trunk/includes/wf\_api\_manager/class-wc-am-plugin-activate.php](/changeset/3211131/elex-woocommerce-dynamic-pricing-and-discounts/trunk/includes/wf_api_manager/class-wc-am-plugin-activate.php "Show the changeset 3211131 restricted to elex-woocommerce-dynamic-pricing-and-discounts/trunk/includes/wf_api_manager/class-wc-am-plugin-activate.php")

  | [r2965037](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/includes/wf_api_manager/class-wc-am-plugin-activate.php?rev=2965037#L12 "Show revision 2965037 of this file in browser") | [r3211131](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/includes/wf_api_manager/class-wc-am-plugin-activate.php?rev=3211131#L12 "Show revision 3211131 of this file in browser") |  |
  | --- | --- | --- |
  | 12 | 12 | class WF\_Software\_Activate { |
  | 13 | 13 | private $is\_ajax; |
  | 14 |  | private $upgrade\_url; |
  | 15 |  | private $plugin\_name; |
  | 16 |  | private $product\_id; |
  | 17 |  | private $api\_key; |
  | 18 |  | private $activation\_unique\_product\_id; |
  | 19 |  | private $renew\_license\_url; |
  | 20 |  | private $instance; |
  | 21 |  | private $domain; |
  | 22 |  | private $software\_version; |
  | 23 |  | private $wf\_unique\_product\_id\_key; |
  | 24 |  | private $wf\_api\_licence\_key; |
  | 25 |  | private $wf\_instance\_key; |
  |  | 14 | private $upgrade\_url; |
  |  | 15 | private $plugin\_name; |
  |  | 16 | private $product\_id; |
  |  | 17 | private $api\_key; |
  |  | 18 | private $activation\_unique\_product\_id; |
  |  | 19 | private $renew\_license\_url; |
  |  | 20 | private $instance; |
  |  | 21 | private $domain; |
  |  | 22 | private $software\_version; |
  |  | 23 | private $wf\_unique\_product\_id\_key; |
  |  | 24 | private $wf\_api\_licence\_key; |
  |  | 25 | private $wf\_instance\_key; |
  | 26 | 26 | public function \_\_construct( $upgrade\_url, $plugin\_name, $product\_id, $api\_key, $activation\_unique\_product\_id, $renew\_license\_url, $instance, $domain, $software\_version, $plugin\_or\_theme, $text\_domain, $extra, $wf\_unique\_product\_id\_key, $wf\_api\_licence\_key, $wf\_instance\_key ) { |
  | 27 | 27 | // API data |
* ## [elex-woocommerce-dynamic-pricing-and-discounts/trunk/includes/wf\_api\_manager/wf\_api\_manager.php](/changeset/3211131/elex-woocommerce-dynamic-pricing-and-discounts/trunk/includes/wf_api_manager/wf_api_manager.php "Show the changeset 3211131 restricted to elex-woocommerce-dynamic-pricing-and-discounts/trunk/includes/wf_api_manager/wf_api_manager.php")

  | [r2965037](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/includes/wf_api_manager/wf_api_manager.php?rev=2965037#L16 "Show revision 2965037 of this file in browser") | [r3211131](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/includes/wf_api_manager/wf_api_manager.php?rev=3211131#L16 "Show revision 3211131 of this file in browser") |  |
  | --- | --- | --- |
  | 16 | 16 | class WF\_API\_Manager { |
  | 17 | 17 | private $is\_ajax; |
  | 18 |  | private $upgrade\_url; |
  | 19 |  | private $plugin\_name; |
  | 20 |  | private $product\_id; |
  | 21 |  | private $api\_key; |
  | 22 |  | private $activation\_unique\_product\_id; |
  | 23 |  | private $renew\_license\_url; |
  | 24 |  | private $instance; |
  | 25 |  | private $domain; |
  | 26 |  | private $software\_version; |
  | 27 |  | private $wf\_unique\_product\_id\_key; |
  | 28 |  | private $wf\_api\_licence\_key; |
  | 29 |  | private $wf\_instance\_key; |
  | 30 |  | private $plugin\_settings\_url; |
  | 31 |  | private $plugin\_or\_theme; |
  | 32 |  | private $text\_domain; |
  | 33 |  | private $extra; |
  |  | 18 | private $upgrade\_url; |
  |  | 19 | private $plugin\_name; |
  |  | 20 | private $product\_id; |
  |  | 21 | private $api\_key; |
  |  | 22 | private $activation\_unique\_product\_id; |
  |  | 23 | private $renew\_license\_url; |
  |  | 24 | private $instance; |
  |  | 25 | private $domain; |
  |  | 26 | private $software\_version; |
  |  | 27 | private $wf\_unique\_product\_id\_key; |
  |  | 28 | private $wf\_api\_licence\_key; |
  |  | 29 | private $wf\_instance\_key; |
  |  | 30 | private $plugin\_settings\_url; |
  |  | 31 | private $plugin\_or\_theme; |
  |  | 32 | private $text\_domain; |
  |  | 33 | private $extra; |
  | 34 | 34 |  |
  | 35 | 35 | public function \_\_construct( $product\_id, $plugin\_version, $plugin\_slug, $server\_url, $plugin\_settings\_url = '' ) { |
* ## [elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-dynamic-pricing-plugin-public.php](/changeset/3211131/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-dynamic-pricing-plugin-public.php "Show the changeset 3211131 restricted to elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-dynamic-pricing-plugin-public.php")

  | [r3030019](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-dynamic-pricing-plugin-public.php?rev=3030019#L10 "Show revision 3030019 of this file in browser") | [r3211131](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-dynamic-pricing-plugin-public.php?rev=3211131#L10 "Show revision 3211131 of this file in browser") |  |
  | --- | --- | --- |
  | 10 | 10 | $GLOBALS['elex\_dp\_settings'] = get\_option('xa\_dynamic\_pricing\_setting'); |
  | 11 | 11 | add\_action('wp\_footer', 'elex\_dp\_print\_scripts\_payment\_gateway', 5); |
  | 12 |  | function elex\_dp\_print\_scripts\_payment\_gateway() |
  | 13 |  | { |
  | 14 |  | ?> |
  |  | 12 | function elex\_dp\_print\_scripts\_payment\_gateway() { |
  |  | 13 | ?> |
  | 15 | 14 | <script> |
  | 16 | 15 | jQuery(function($) { |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-dynamic-pricing-plugin-public.php?rev=3030019#L30) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-dynamic-pricing-plugin-public.php?rev=3211131#L29) |  |
  | 30 | 29 | <?php |
  | 31 | 30 | } |
  | 32 |  | function elex\_dp\_init\_calculator() |
  | 33 |  | { |
  |  | 31 | function elex\_dp\_init\_calculator() { |
  | 34 | 32 | $xa\_dp\_rules = get\_option('xa\_dp\_rules', array()); |
  | 35 | 33 | if (isset($GLOBALS['elex\_dp\_settings']) && empty($GLOBALS['elex\_dp\_settings']) || empty($xa\_dp\_rules)) { |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-dynamic-pricing-plugin-public.php?rev=3030019#L46) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-dynamic-pricing-plugin-public.php?rev=3211131#L44) |  |
  | 46 | 44 | add\_action('woocommerce\_before\_calculate\_totals', 'elex\_dp\_update\_globals'); |
  | 47 | 45 |  |
  | 48 |  |  |
  | 49 |  | function elex\_dp\_update\_globals($cart) |
  | 50 |  | { |
  |  | 46 | add\_action('woocommerce\_before\_cart\_totals', 'elex\_dp\_update\_cart\_total'); |
  |  | 47 |  |
  |  | 48 | function elex\_dp\_update\_cart\_total() { |
  |  | 49 | global $woocommerce; |
  |  | 50 | if ($woocommerce->cart) { |
  |  | 51 | $woocommerce->cart->calculate\_totals(); |
  |  | 52 | } |
  |  | 53 | } |
  |  | 54 |  |
  |  | 55 | function elex\_dp\_update\_globals( $cart) { |
  | 51 | 56 | if (isset($\_REQUEST['debugcart'])) { |
  | 52 | 57 | echo '<pre>'; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-dynamic-pricing-plugin-public.php?rev=3030019#L101) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-dynamic-pricing-plugin-public.php?rev=3211131#L106) |  |
  | 101 | 106 | } |
  | 102 | 107 | foreach ($xa\_cart\_categories[$\_pid] as $\_cid) { |
  | 103 |  | $xa\_cart\_categories\_items[$\_cid] = isset($xa\_cart\_categories\_items[$\_cid]) ? (~~$xa\_cart\_categories\_items[$\_cid] + 1~~) : 1; |
  | 104 |  | $xa\_cart\_categories\_units[$\_cid] = isset($xa\_cart\_categories\_units[$\_cid]) ? (~~$xa\_cart\_categories\_units[$\_cid] + $\_qnty~~) : $\_qnty; |
  |  | 108 | $xa\_cart\_categories\_items[$\_cid] = isset($xa\_cart\_categories\_items[$\_cid]) ? ( $xa\_cart\_categories\_items[$\_cid] + 1 ) : 1; |
  |  | 109 | $xa\_cart\_categories\_units[$\_cid] = isset($xa\_cart\_categories\_units[$\_cid]) ? ( $xa\_cart\_categories\_units[$\_cid] + $\_qnty ) : $\_qnty; |
  | 105 | 110 | } |
  | 106 | 111 | foreach ($xa\_cart\_tags[$\_pid] as $\_tid) { |
  | 107 |  | $xa\_cart\_tags\_items[$\_tid] = isset($xa\_cart\_tags\_items[$\_tid]) ? (~~$xa\_cart\_tags\_items[$\_tid] + 1~~) : 1; |
  | 108 |  | $xa\_cart\_tags\_units[$\_tid] = isset($xa\_cart\_tags\_units[$\_tid]) ? (~~$xa\_cart\_tags\_units[$\_tid] + $\_qnty~~) : $\_qnty; |
  |  | 112 | $xa\_cart\_tags\_items[$\_tid] = isset($xa\_cart\_tags\_items[$\_tid]) ? ( $xa\_cart\_tags\_items[$\_tid] + 1 ) : 1; |
  |  | 113 | $xa\_cart\_tags\_units[$\_tid] = isset($xa\_cart\_tags\_units[$\_tid]) ? ( $xa\_cart\_tags\_units[$\_tid] + $\_qnty ) : $\_qnty; |
  | 109 | 114 | } |
  | 110 | 115 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-dynamic-pricing-plugin-public.php?rev=3030019#L121) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-dynamic-pricing-plugin-public.php?rev=3211131#L126) |  |
  | 121 | 126 | add\_filter('woocommerce\_product\_is\_on\_sale', 'elex\_dp\_product\_is\_on\_sale', 99, 2); |
  | 122 | 127 |  |
  | 123 |  | function elex\_dp\_product\_is\_on\_sale($on\_sale, $product) |
  | 124 |  | { |
  |  | 128 | function elex\_dp\_product\_is\_on\_sale( $on\_sale, $product) { |
  | 125 | 129 |  |
  | 126 | 130 | if ($product->is\_type('grouped') || $product->is\_type('variable')) { |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-dynamic-pricing-plugin-public.php?rev=3030019#L172) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-dynamic-pricing-plugin-public.php?rev=3211131#L176) |  |
  | 172 | 176 | } |
  | 173 | 177 |  |
  | 174 |  | function elex\_dp\_calculate\_and\_apply\_discount\_and\_add\_fee() |
  | 175 |  | { |
  |  | 178 | function elex\_dp\_calculate\_and\_apply\_discount\_and\_add\_fee() { |
  | 176 | 179 | global $xa\_common\_flat\_discount; |
  | 177 | 180 | global $woocommerce; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-dynamic-pricing-plugin-public.php?rev=3030019#L192) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-dynamic-pricing-plugin-public.php?rev=3211131#L195) |  |
  | 192 | 195 | add\_action($pricing\_table\_hook, 'elex\_dp\_show\_pricing\_table', 40); |
  | 193 | 196 |  |
  | 194 |  | function elex\_dp\_show\_pricing\_table() |
  | 195 |  | { |
  |  | 197 | function elex\_dp\_show\_pricing\_table() { |
  | 196 | 198 | $selected\_role = get\_option('elex\_dp\_allowed\_roles\_to\_show\_pricing\_table'); |
  | 197 | 199 | if (!empty($selected\_role)) { |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-dynamic-pricing-plugin-public.php?rev=3030019#L210) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-dynamic-pricing-plugin-public.php?rev=3211131#L212) |  |
  | 210 | 212 | add\_action($offer\_table\_hook, 'elex\_dp\_show\_offer\_table', 40); |
  | 211 | 213 |  |
  | 212 |  | function elex\_dp\_show\_offer\_table() |
  | 213 |  | { |
  |  | 214 | function elex\_dp\_show\_offer\_table() { |
  | 214 | 215 | $path = dirname(\_\_FILE\_\_) . '/elex-single-product-offer-table.php'; |
  | 215 | 216 | if (isset($GLOBALS['elex\_dp\_settings']['offer\_table\_on\_off']) && $GLOBALS['elex\_dp\_settings']['offer\_table\_on\_off'] == 'enable' && file\_exists($path) == true) { |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-dynamic-pricing-plugin-public.php?rev=3030019#L220) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-dynamic-pricing-plugin-public.php?rev=3211131#L221) |  |
  | 220 | 221 | add\_filter('woocommerce\_cart\_item\_price', 'elex\_dp\_show\_discount\_on\_line\_item', 100, 2); |
  | 221 | 222 |  |
  | 222 |  | function elex\_dp\_show\_discount\_on\_line\_item($price, $cart\_item) |
  | 223 |  | { |
  |  | 223 | function elex\_dp\_show\_discount\_on\_line\_item( $price, $cart\_item) { |
  | 224 | 224 | $prod  = $cart\_item['data']; |
  | 225 | 225 | $price = $prod->get\_price\_html(); |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-dynamic-pricing-plugin-public.php?rev=3030019#L229) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-dynamic-pricing-plugin-public.php?rev=3211131#L229) |  |
  | 229 | 229 | add\_action('wc\_ajax\_get\_refreshed\_fragments', 'elex\_dp\_wc\_ajax\_get\_refreshed\_fragments', 1); |
  | 230 | 230 |  |
  | 231 |  | function elex\_dp\_wc\_ajax\_get\_refreshed\_fragments() |
  | 232 |  | { |
  |  | 231 | function elex\_dp\_wc\_ajax\_get\_refreshed\_fragments() { |
  | 233 | 232 | global $woocommerce; |
  | 234 | 233 | if ($woocommerce->cart) { |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-dynamic-pricing-plugin-public.php?rev=3030019#L238) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-dynamic-pricing-plugin-public.php?rev=3211131#L237) |  |
  | 238 | 237 |  |
  | 239 | 238 | // Exclude discount from taxes |
  | 240 |  | function excludeCartFeesTaxes($taxes, $fee, $cart) |
  | 241 |  | { |
  |  | 239 | function excludeCartFeesTaxes( $taxes, $fee, $cart) { |
  | 242 | 240 | return []; |
  | 243 | 241 | } |
  | 244 |  | add\_action('woocommerce\_cart\_totals\_get\_fees\_from\_cart\_taxes', 'excludeCartFeesTaxes', 10 ,3); |
  |  | 242 | add\_action('woocommerce\_cart\_totals\_get\_fees\_from\_cart\_taxes', 'excludeCartFeesTaxes', 10 , 3); |
  |  | 243 |  |
  |  | 244 | add\_action('save\_post\_product', 'delete\_product\_transient\_on\_price\_update', 10, 3); |
  |  | 245 |  |
  |  | 246 | function delete\_product\_transient\_on\_price\_update( $post\_id, $post, $update) { |
  |  | 247 |  |
  |  | 248 | global $wpdb; |
  |  | 249 | // Specify the transient key pattern |
  |  | 250 | $transient\_key\_pattern = 'elex\_dp\_product\_data\_' . $post\_id; |
  |  | 251 |  |
  |  | 252 | $wpdb->query( |
  |  | 253 | $wpdb->prepare( |
  |  | 254 | "DELETE FROM $wpdb->options WHERE option\_name LIKE %s OR option\_name LIKE %s", |
  |  | 255 | '\_transient\_%' . $transient\_key\_pattern, |
  |  | 256 | '\_transient\_timeout\_%' . $transient\_key\_pattern |
  |  | 257 | ) |
  |  | 258 | ); |
  |  | 259 |  |
  |  | 260 | // Clear the object cache |
  |  | 261 | wp\_cache\_flush(); |
  |  | 262 |  |
  |  | 263 | } |
  |  | 264 |  |
  |  | 265 | add\_action('woocommerce\_update\_product\_variation', 'delete\_variation\_transient\_on\_price\_update', 10, 1); |
  |  | 266 |  |
  |  | 267 | function delete\_variation\_transient\_on\_price\_update( $variation\_id) { |
  |  | 268 |  |
  |  | 269 | global $wpdb; |
  |  | 270 | // Specify the transient key pattern for the variation |
  |  | 271 | $transient\_key\_pattern = 'elex\_dp\_product\_data\_' . $variation\_id; |
  |  | 272 |  |
  |  | 273 | $wpdb->query( |
  |  | 274 | $wpdb->prepare( |
  |  | 275 | "DELETE FROM $wpdb->options WHERE option\_name LIKE %s OR option\_name LIKE %s", |
  |  | 276 | '\_transient\_%' . $transient\_key\_pattern, |
  |  | 277 | '\_transient\_timeout\_%' . $transient\_key\_pattern |
  |  | 278 | ) |
  |  | 279 | ); |
  |  | 280 |  |
  |  | 281 | // Clear the object cache |
  |  | 282 | wp\_cache\_flush(); |
  |  | 283 |  |
  |  | 284 | } |
* ## [elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-new-calculation-handler.php](/changeset/3211131/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-new-calculation-handler.php "Show the changeset 3211131 restricted to elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-new-calculation-handler.php")

  | [r3046337](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-new-calculation-handler.php?rev=3046337#L16 "Show revision 3046337 of this file in browser") | [r3211131](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-new-calculation-handler.php?rev=3211131#L16 "Show revision 3211131 of this file in browser") |  |
  | --- | --- | --- |
  | 16 | 16 | \* @author Akshay |
  | 17 | 17 | \*/ |
  | 18 |  | class Elex\_NewCalculationHandler |
  | 19 |  | { |
  |  | 18 | class Elex\_NewCalculationHandler { |
  |  | 19 |  |
  | 20 | 20 |  |
  | 21 | 21 | public $debug\_mode = false; |
  | 22 | 22 |  |
  | 23 |  | public function \_\_construct() |
  | 24 |  | { |
  |  | 23 | public function \_\_construct() { |
  | 25 | 24 | $dummy\_settings['product\_rules\_on\_off']          = 'enable'; |
  | 26 | 25 | $dummy\_settings['combinational\_rules\_on\_off']    = 'enable'; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-new-calculation-handler.php?rev=3046337#L110) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-new-calculation-handler.php?rev=3211131#L109) |  |
  | 110 | 109 | $parent\_id                 = elex\_dp\_is\_wc\_version\_gt\_eql('2.7') ? $prod->get\_parent\_id() : $prod->parent->id; |
  | 111 | 110 | $parent\_product            = wc\_get\_product($parent\_id); |
  | 112 |  | if~~($parent\_product)~~{ |
  |  | 111 | if ($parent\_product) { |
  | 113 | 112 | $xa\_cart\_categories[$\_pid] = elex\_dp\_is\_wc\_version\_gt\_eql('2.7') ? $parent\_product->get\_category\_ids() : elex\_dp\_get\_category\_ids($parent\_product); |
  | 114 | 113 | $xa\_cart\_tags[$\_pid]       = xa\_get\_tag\_ids($\_pid); |
  | 115 |  | }~~else~~{ |
  |  | 114 | } else { |
  | 116 | 115 | $xa\_cart\_categories[$\_pid] = elex\_dp\_is\_wc\_version\_gt\_eql('2.7') ? $prod->get\_category\_ids() : elex\_dp\_get\_category\_ids($prod); |
  | 117 | 116 | $xa\_cart\_tags[$\_pid]       = xa\_get\_tag\_ids($prod); |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-new-calculation-handler.php?rev=3046337#L123) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-new-calculation-handler.php?rev=3211131#L122) |  |
  | 123 | 122 | } |
  | 124 | 123 | foreach ($xa\_cart\_categories[$\_pid] as $\_cid) { |
  | 125 |  | $xa\_cart\_categories\_items[$\_cid] = isset($xa\_cart\_categories\_items[$\_cid]) ? (~~$xa\_cart\_categories\_items[$\_cid] + 1~~) : 1; |
  | 126 |  | $xa\_cart\_categories\_units[$\_cid] = isset($xa\_cart\_categories\_units[$\_cid]) ? (~~$xa\_cart\_categories\_units[$\_cid] + $\_qnty~~) : $\_qnty; |
  |  | 124 | $xa\_cart\_categories\_items[$\_cid] = isset($xa\_cart\_categories\_items[$\_cid]) ? ( $xa\_cart\_categories\_items[$\_cid] + 1 ) : 1; |
  |  | 125 | $xa\_cart\_categories\_units[$\_cid] = isset($xa\_cart\_categories\_units[$\_cid]) ? ( $xa\_cart\_categories\_units[$\_cid] + $\_qnty ) : $\_qnty; |
  | 127 | 126 | } |
  | 128 | 127 | foreach ($xa\_cart\_tags[$\_pid] as $\_tid) { |
  | 129 |  | $xa\_cart\_tags\_items[$\_tid] = isset($xa\_cart\_tags\_items[$\_tid]) ? (~~$xa\_cart\_tags\_items[$\_tid] + 1~~) : 1; |
  | 130 |  | $xa\_cart\_tags\_units[$\_tid] = isset($xa\_cart\_tags\_units[$\_tid]) ? (~~$xa\_cart\_tags\_units[$\_tid] + $\_qnty~~) : $\_qnty; |
  |  | 128 | $xa\_cart\_tags\_items[$\_tid] = isset($xa\_cart\_tags\_items[$\_tid]) ? ( $xa\_cart\_tags\_items[$\_tid] + 1 ) : 1; |
  |  | 129 | $xa\_cart\_tags\_units[$\_tid] = isset($xa\_cart\_tags\_units[$\_tid]) ? ( $xa\_cart\_tags\_units[$\_tid] + $\_qnty ) : $\_qnty; |
  | 131 | 130 | } |
  | 132 | 131 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-new-calculation-handler.php?rev=3046337#L145) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-new-calculation-handler.php?rev=3211131#L144) |  |
  | 145 | 144 | } |
  | 146 | 145 |  |
  | 147 |  | /\*\* |
  |  | 146 | /\*\* |
  | 148 | 147 | \* Finds valid rules for this product and return discounted price based on (all rules,first match,best discount) |
  | 149 | 148 | \* |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-new-calculation-handler.php?rev=3046337#L154) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-new-calculation-handler.php?rev=3211131#L153) |  |
  | 154 | 153 | \* @return $discounted\_price |
  | 155 | 154 | \*/ |
  | 156 |  | public function elex\_dp\_getDiscountedPriceForProduct($old\_price = '', $product = null, $pid = null) |
  | 157 |  | { |
  | 158 |  | //error\_log($product->get\_id()." filter=".current\_filter()); |
  | 159 |  | global $elex\_dp\_cached\_prices; |
  | 160 |  | if (!$elex\_dp\_cached\_prices) { |
  | 161 |  | $elex\_dp\_cached\_prices = array(); |
  | 162 |  | } |
  | 163 |  |  |
  | 164 |  | if (!isset($elex\_dp\_cached\_prices[$product->get\_id()])) { |
  | 165 |  | $elex\_dp\_cached\_prices[$product->get\_id()] = array(); |
  | 166 |  | } |
  | 167 |  |  |
  | 168 |  | // if (isset($elex\_dp\_cached\_prices[$product->get\_id()][current\_filter()])) { |
  | 169 |  | //  return $elex\_dp\_cached\_prices[$product->get\_id()][current\_filter()]; |
  | 170 |  | // } |
  | 171 |  | // print("<pre>".print\_r(debug\_backtrace(),true)."</pre>"); |
  | 172 |  |  |
  | 173 |  | global $xa\_dp\_setting; |
  | 174 |  | $xa\_add\_on\_true  = true; |
  | 175 |  | $xa\_add\_on\_false = false; |
  | 176 |  | if (is\_plugin\_active('woocommerce-product-addons/woocommerce-product-addons.php')) { |
  | 177 |  | if ($xa\_dp\_setting['xa\_product\_add\_on\_option'] == 'disable') { |
  | 178 |  | $xa\_add\_on\_true  = false; |
  | 179 |  | $xa\_add\_on\_false = true; |
  | 180 |  | } |
  | 181 |  | } |
  | 182 |  |  |
  | 183 |  | //Code added to make discount apply in custom woocommerce pages. |
  | 184 |  | $product\_filters = array('woocommerce\_product\_get\_price', 'woocommerce\_product\_variation\_get\_price', 'woocommerce\_product\_variation\_get\_sale\_price', 'woocommerce\_product\_get\_sale\_price'); |
  | 185 |  |  |
  | 186 |  | if (apply\_filters('xa\_give\_discount\_on\_addon\_prices', true) == $xa\_add\_on\_false && did\_action('woocommerce\_before\_calculate\_totals') || doing\_action('woocommerce\_before\_calculate\_totals')) {   // added this code for compatiblity with woocommerce product addons |
  | 187 |  | // $elex\_dp\_cached\_prices[$product->get\_id()][current\_filter()] = $old\_price; |
  |  | 155 | public function elex\_dp\_getDiscountedPriceForProduct( $old\_price = '', $product = null, $pid = null) { |
  |  | 156 | static $cached\_prices = array(); |
  |  | 157 |  |
  |  | 158 | // Early return if product or price is not provided |
  |  | 159 | if (!$product || !$old\_price) { |
  | 188 | 160 | return $old\_price; |
  | 189 | 161 | } |
  | 190 |  | if (!is\_shop() && !is\_product() && !is\_product\_tag() &&  !is\_product\_category() && !did\_action('woocommerce\_before\_calculate\_totals') && apply\_filters('xa\_give\_discount\_on\_addon\_prices', true) == $xa\_add\_on\_true && !in\_array(current\_filter(), $product\_filters)) {   // added this code for compatiblity with woocommerce product addons |
  | 191 |  | // $elex\_dp\_cached\_prices[$product->get\_id()][current\_filter()] = $old\_price; |
  |  | 162 |  |
  |  | 163 | $product\_id = $product->get\_id(); |
  |  | 164 | if (!isset($cached\_prices[$product\_id])) { |
  |  | 165 | $cached\_prices[$product\_id] = array(); |
  |  | 166 | } |
  |  | 167 |  |
  |  | 168 | // Check if the discount calculation should be skipped |
  |  | 169 | global $xa\_hooks, $xa\_dp\_setting, $xa\_cart\_quantities, $xa\_common\_flat\_discount; |
  |  | 170 | $apply\_discount = apply\_filters('xa\_give\_discount\_on\_addon\_prices', true); |
  |  | 171 |  |
  |  | 172 | if (( !is\_shop() && !is\_product() && !is\_product\_tag() && !is\_product\_category() && !did\_action('woocommerce\_before\_calculate\_totals') ) |
  |  | 173 | || ( !$apply\_discount && ( did\_action('woocommerce\_before\_calculate\_totals') || doing\_action('woocommerce\_before\_calculate\_totals') ) ) |
  |  | 174 | ) { |
  | 192 | 175 | return $old\_price; |
  | 193 | 176 | } |
  | 194 |  | global $xa\_hooks, $xa\_common\_flat\_discount, $xa\_cart\_price, $executed\_pids; |
  | 195 |  | remove\_filter($xa\_hooks['woocommerce\_get\_price\_hook\_name'], array($this, 'elex\_dp\_getDiscountedPriceForProduct'), 22); |
  | 196 |  | remove\_filter($xa\_hooks['woocommerce\_get\_sale\_price\_hook\_name'], array($this, 'elex\_dp\_getDiscountedPriceForProduct'), 22);    // update sale price on product page |
  | 197 |  | remove\_filter('woocommerce\_product\_variation\_get\_price', array($this, 'elex\_dp\_getDiscountedPriceForProduct'), 22); |
  | 198 |  | remove\_filter('woocommerce\_product\_variation\_get\_sale\_price', array($this, 'elex\_dp\_getDiscountedPriceForProduct'), 22);    // update sale price on product page |
  | 199 |  |  |
  | 200 |  | $regular\_price = $product->get\_regular\_price(); |
  | 201 |  |  |
  | 202 |  | if (empty($pid)) { |
  | 203 |  | $pid = elex\_dp\_get\_pid($product); |
  | 204 |  | } |
  | 205 |  |  |
  | 206 |  | if ($pid == false) { |
  | 207 |  | add\_filter($xa\_hooks['woocommerce\_get\_price\_hook\_name'], array($this, 'elex\_dp\_getDiscountedPriceForProduct'), 22, 2);         // update sale price on product page |
  | 208 |  | add\_filter($xa\_hooks['woocommerce\_get\_sale\_price\_hook\_name'], array($this, 'elex\_dp\_getDiscountedPriceForProduct'), 22, 2);    // update sale price on product page |
  | 209 |  | add\_filter('woocommerce\_product\_variation\_get\_price', array($this, 'elex\_dp\_getDiscountedPriceForProduct'), 22, 2);    // update sale price on product page |
  | 210 |  | add\_filter('woocommerce\_product\_variation\_get\_sale\_price', array($this, 'elex\_dp\_getDiscountedPriceForProduct'), 22, 2);    // update sale price on product page |
  | 211 |  | $elex\_dp\_cached\_prices[$product->get\_id()][current\_filter()] = $old\_price; |
  |  | 177 | if ( !is\_cart() && !is\_checkout() && !empty( get\_transient('elex\_dp\_product\_data\_' . $product\_id) ) ) { |
  |  | 178 | $discounted\_price = get\_transient('elex\_dp\_product\_data\_' . $product\_id); |
  |  | 179 | return $discounted\_price; |
  |  | 180 | } |
  |  | 181 |  |
  |  | 182 | // If the discounted price is cached in transient, return it immediately |
  |  | 183 | if (isset($cached\_prices[$product\_id][current\_filter()])) { |
  |  | 184 | return $cached\_prices[$product\_id][current\_filter()]; |
  |  | 185 | } |
  |  | 186 | // Ensure hooks are added and removed properly |
  |  | 187 | $this->manageHooks(false); |
  |  | 188 |  |
  |  | 189 | $regular\_price = $product->get\_regular\_price(); |
  |  | 190 | $pid = $pid ?: elex\_dp\_get\_pid($product); |
  |  | 191 |  |
  |  | 192 | if (!$pid) { |
  |  | 193 | $this->manageHooks(true); |
  | 212 | 194 | return $old\_price; |
  | 213 | 195 | } |
  | 214 |  | if (((current\_filter() == $xa\_hooks['woocommerce\_get\_sale\_price\_hook\_name']) || (current\_filter() == 'woocommerce\_product\_variation\_get\_sale\_price')) && empty($old\_price)) {  // if sale price is empty then old price is regular\_price |
  |  | 196 |  |
  |  | 197 | // Set old\_price if empty in certain filters |
  |  | 198 |  |
  |  | 199 |  |
  |  | 200 | if (in\_array(current\_filter(), array($xa\_hooks['woocommerce\_get\_sale\_price\_hook\_name'], 'woocommerce\_product\_variation\_get\_sale\_price')) && empty($old\_price)) { |
  | 215 | 201 | $old\_price = $regular\_price; |
  | 216 | 202 | } |
  | 217 |  | $discounted\_price = $old\_price; |
  | 218 |  | $weight           = $product->get\_weight(); |
  | 219 |  | if (!empty($old\_price) && (!empty($product) || !empty($pid))) { |
  | 220 |  |  |
  | 221 |  | global $xa\_cart\_quantities; |
  | 222 |  | $parent\_id = $pid; |
  | 223 |  | if ($product->get\_type() == 'variation') { |
  | 224 |  | $parent\_id = elex\_dp\_is\_wc\_version\_gt\_eql('2.7') ? $product->get\_parent\_id() : $product->parent->id; |
  | 225 |  | } |
  | 226 |  | if (isset($xa\_cart\_quantities[$pid]) || isset($xa\_cart\_quantities[$parent\_id])) { |
  | 227 |  | $current\_quantity = isset($xa\_cart\_quantities[$pid]) ? $xa\_cart\_quantities[$pid] : $xa\_cart\_quantities[$parent\_id]; |
  | 228 |  | } else { |
  | 229 |  | $current\_quantity = 0; |
  | 230 |  | } |
  | 231 |  | if ($current\_quantity == 0  && class\_exists('SitePress')) { |
  | 232 |  | global $sitepress; |
  | 233 |  | $trid    = $sitepress->get\_element\_trid($pid); |
  | 234 |  | $trans   = $sitepress->get\_element\_translations($trid); |
  | 235 |  | $all\_ids = array(); |
  | 236 |  | foreach ($trans as $lan) { |
  | 237 |  | $all\_ids[] = $lan->element\_id; |
  | 238 |  | } |
  | 239 |  | foreach ($all\_ids as $\_pid) { |
  | 240 |  | if (!empty($xa\_cart\_quantities[$\_pid])) { |
  | 241 |  | $current\_quantity = $xa\_cart\_quantities[$\_pid]; |
  | 242 |  | break; |
  | 243 |  | } |
  | 244 |  | } |
  | 245 |  | } |
  |  | 203 |  |
  |  | 204 | $discounted\_price = $old\_price; |
  |  | 205 | $weight = $product->get\_weight(); |
  |  | 206 |  |
  |  | 207 | if (!empty($old\_price) && $pid) { |
  |  | 208 | $parent\_id = ( $product->get\_type() == 'variation' ) ? $product->get\_parent\_id() : $pid; |
  |  | 209 | $current\_quantity = $xa\_cart\_quantities[$pid] ?? $xa\_cart\_quantities[$parent\_id] ?? 0; |
  |  | 210 |  |
  | 246 | 211 | if (is\_shop() || is\_product\_category() || is\_product() || is\_product\_tag()) { |
  | 247 | 212 | $current\_quantity++; |
  | 248 | 213 | } |
  |  | 214 |  |
  | 249 | 215 | $objRulesValidator = new Elex\_RulesValidator(); |
  | 250 |  |  |
  | 251 | 216 | $valid\_rules = $objRulesValidator->elex\_dp\_getValidRulesForProduct($product, $pid, $current\_quantity, $discounted\_price, $weight); |
  | 252 |  |  |
  |  | 217 |  |
  | 253 | 218 | if ($this->debug\_mode) { |
  | 254 | 219 | error\_log(str\_repeat('-', 380)); |
  | 255 | 220 | error\_log('Valid Rules for Pid=' . $pid . ' and qnty=' . $current\_quantity . ' Valid Rules= ' . print\_r($valid\_rules, true)); |
  | 256 | 221 | } |
  | 257 |  | $mode = !empty($xa\_dp\_setting['mode']) ? $xa\_dp\_setting['mode'] : 'first\_match'; |
  | 258 |  | // if (!empty($executed\_pids[$pid]) && $mode == 'best\_discount' && !$product->is\_type('variation')) { |
  | 259 |  | //  $product->set\_price($executed\_pids[$pid]); |
  | 260 |  | //  add\_filter($xa\_hooks['woocommerce\_get\_price\_hook\_name'], array($this, 'elex\_dp\_getDiscountedPriceForProduct'), 22, 2);         // update sale price on product page |
  | 261 |  | //  add\_filter($xa\_hooks['woocommerce\_get\_sale\_price\_hook\_name'], array($this, 'elex\_dp\_getDiscountedPriceForProduct'), 22, 2);    // update sale price on product page |
  | 262 |  | //  add\_filter('woocommerce\_product\_variation\_get\_price', array($this, 'elex\_dp\_getDiscountedPriceForProduct'), 22, 2);    // update sale price on product page |
  | 263 |  | //  add\_filter('woocommerce\_product\_variation\_get\_sale\_price', array($this, 'elex\_dp\_getDiscountedPriceForProduct'), 22, 2);    // update sale price on product page |
  | 264 |  | //  $elex\_dp\_cached\_prices[$product->get\_id()][current\_filter()] = $executed\_pids[$pid]; |
  | 265 |  | //  return $executed\_pids[$pid]; |
  | 266 |  | // } |
  | 267 |  | if (is\_array($valid\_rules) && $valid\_rules) { |
  | 268 |  | $valid\_flat\_discount = []; |
  |  | 222 |  |
  |  | 223 | if (is\_array($valid\_rules) && $valid\_rules) { |
  | 269 | 224 | foreach ($valid\_rules as $rule\_type\_colon\_rule\_no => $rule) { |
  | 270 |  | //this section supports repeat execution for product rules |
  | 271 |  | if (isset($rule['repeat\_rule']) && $rule['repeat\_rule'] == 'yes' && !empty($rule['max']) && !empty($rule['min'])) { |
  | 272 |  | if ($rule['rule\_type'] == 'product\_rules') { |
  | 273 |  | if ($product->get\_type() == 'variation') { |
  | 274 |  | $pparent\_id = elex\_dp\_is\_wc\_version\_gt\_eql('2.7') ? $product->get\_parent\_id() : $product->parent->id; |
  | 275 |  |  |
  | 276 |  | if (is\_array($rule['product\_id']) && in\_array($pparent\_id, $rule['product\_id'])) { |
  | 277 |  | $pparent\_product  = new WC\_Product\_Variable($pparent\_id); |
  | 278 |  | $variations       = $pparent\_product->get\_children(); |
  | 279 |  | $current\_quantity = 0; |
  | 280 |  | foreach ($variations as $value) { |
  | 281 |  | if (isset($xa\_cart\_quantities[$value])) { |
  | 282 |  | $current\_quantity += $xa\_cart\_quantities[$value]; |
  | 283 |  | } |
  | 284 |  | } |
  | 285 |  | if (isset($xa\_cart\_quantities[$pparent\_id])) { |
  | 286 |  | $current\_quantity += $xa\_cart\_quantities[$value]; |
  | 287 |  | } |
  | 288 |  | if (is\_shop() || is\_product\_category() || is\_product() || is\_product\_tag()) { |
  | 289 |  | $current\_quantity++; |
  | 290 |  | } |
  | 291 |  | } |
  | 292 |  | } |
  | 293 |  | } |
  | 294 |  | $times       = intval($current\_quantity / $rule['max']); |
  | 295 |  | $total\_price = 0; |
  | 296 |  | $repeat\_qnty = (float) $rule['max']; |
  | 297 |  | if ($this->debug\_mode) { |
  | 298 |  | error\_log(str\_repeat('>', 208)); |
  | 299 |  | error\_log('Executing Rule(Repeat=True):' . $rule\_type\_colon\_rule\_no); |
  | 300 |  | } |
  | 301 |  | if (!empty($rule['discount\_type']) && $rule['discount\_type'] == 'Flat Discount') { |
  | 302 |  | $xa\_common\_flat\_discount[$rule['rule\_type'] . ':' . $rule['rule\_no'] . ':' . $pid] = floatval($rule['value']) \* floatval($times); |
  | 303 |  | if (!empty($rule['adjustment'])) { |
  | 304 |  | $adjusted\_qnty    = !empty($objRulesValidator->rule\_based\_quantity[$rule['rule\_type'] . ':' . $rule['rule\_no']]) ? $objRulesValidator->rule\_based\_quantity[$rule['rule\_type'] . ':' . $rule['rule\_no']] : $current\_quantity; |
  | 305 |  | $discounted\_price = $discounted\_price + ((float) $rule['adjustment'] / $adjusted\_qnty); |
  | 306 |  | } |
  | 307 |  | } else { |
  | 308 |  | $object\_hash = spl\_object\_hash($product); |
  | 309 |  | $object\_hash = $object\_hash . $pid; |
  | 310 |  | $r\_price     = $objRulesValidator->elex\_dp\_execute\_rule($discounted\_price, $rule\_type\_colon\_rule\_no, $rule, $repeat\_qnty, $pid, $object\_hash); |
  | 311 |  | //error\_log("$total\_price = $r\_price \* $times \* $repeat\_qnty"); |
  | 312 |  | $total\_price    = $r\_price \* $times \* $repeat\_qnty; |
  | 313 |  | $remaining\_qnty = $current\_quantity - ($times \* $repeat\_qnty); |
  | 314 |  | if ($remaining\_qnty > 0) { |
  | 315 |  | $price = isset($xa\_cart\_price[$pid]) ? $xa\_cart\_price[$pid] : 0; |
  | 316 |  | $total\_price = $total\_price + ($remaining\_qnty \* $price); |
  | 317 |  | } |
  | 318 |  | $discounted\_price = $total\_price / $current\_quantity; |
  | 319 |  | } |
  | 320 |  | } else { |
  | 321 |  | if ($this->debug\_mode) { |
  | 322 |  | error\_log(str\_repeat('>', 208)); |
  | 323 |  | error\_log('Executing Rule:' . $rule\_type\_colon\_rule\_no); |
  | 324 |  | } |
  | 325 |  | //fix for best discount mode flat discount is not getting calculated] |
  | 326 |  |  |
  | 327 |  | // if (!empty($rule['discount\_type']) && $rule['discount\_type'] == 'Flat Discount') { // removed variation condition because variations were getting executed like non flat discounts |
  | 328 |  | //  if ($rule['rule\_type'] == 'product\_rules') { |
  | 329 |  | //      $xa\_common\_flat\_discount[$rule['rule\_type'] . ':' . $rule['rule\_no'] . ':' . $pid] = floatval($rule['value']); |
  | 330 |  | //  } elseif ($rule['rule\_type'] == 'category\_rules') { |
  | 331 |  | //      $cid = !empty($rule['selected\_cids']) ? current($rule['selected\_cids']) : ''; |
  | 332 |  | //      $xa\_common\_flat\_discount[$rule['rule\_type'] . ':' . $rule['rule\_no'] . ':' . $cid] = floatval($rule['value']); |
  | 333 |  | //  } else { |
  | 334 |  | //      $xa\_common\_flat\_discount[$rule['rule\_type'] . ':' . $rule['rule\_no']] = floatval($rule['value']); |
  | 335 |  | //  } |
  | 336 |  | //  if (!empty($rule['adjustment'])) { |
  | 337 |  | //      $adjusted\_qnty    = !empty($objRulesValidator->rule\_based\_quantity[$rule['rule\_type'] . ':' . $rule['rule\_no']]) ? $objRulesValidator->rule\_based\_quantity[$rule['rule\_type'] . ':' . $rule['rule\_no']] : $current\_quantity; |
  | 338 |  | //      $discounted\_price = $discounted\_price + ((float) $rule['adjustment'] / $adjusted\_qnty); |
  | 339 |  | //  } |
  | 340 |  | // } else { |
  | 341 |  |  |
  | 342 |  | $object\_hash      = spl\_object\_hash($product); |
  | 343 |  | $object\_hash      = $object\_hash . $pid; |
  | 344 |  | $discounted\_price = $objRulesValidator->elex\_dp\_execute\_rule($discounted\_price, $rule\_type\_colon\_rule\_no, $rule, $current\_quantity, $pid, $object\_hash); |
  | 345 |  | } |
  | 346 |  | // } |
  |  | 225 | $object\_hash = spl\_object\_hash($product) . $pid; |
  |  | 226 | $discounted\_price = $objRulesValidator->elex\_dp\_execute\_rule($discounted\_price, $rule\_type\_colon\_rule\_no, $rule, $current\_quantity, $pid, $object\_hash); |
  | 347 | 227 | if ($rule['rule\_type'] != 'BOGO\_category\_rules' && $rule['rule\_type'] != 'buy\_get\_free\_rules' && $rule['rule\_type'] != 'bogo\_tag\_rules') { |
  | 348 | 228 | $product->set\_price($discounted\_price); |
  | 349 |  | ~~}~~ |
  | 350 |  |  |
  | 351 |  | ~~//Calculating the valid flat discounts.~~ |
  | 352 |  | ~~$key = $rule['rule\_type'] . ':' . $rule['rule\_no'] . ':' . $pid;~~ |
  | 353 |  | ~~if($xa\_common\_flat\_discount && array\_key\_exists($key, $xa\_common\_flat\_discount)){~~ |
  | 354 |  | ~~$valid\_flat\_discount[$key] = $key;~~ |
  | 355 |  | ~~}~~ |
  | 356 |  | ~~}~~ |
  | 357 |  | ~~if($xa\_common\_flat\_discount){~~ |
  | 358 |  | ~~foreach($xa\_common\_flat\_discount as $key => $value){~~ |
  | 359 |  | ~~$key\_parts = explode(':', $key);~~ |
  | 360 |  | ~~$current\_pid = end($key\_parts);~~ |
  | 361 |  | ~~if(!array\_key\_exists($key, $valid\_flat\_discount) && ($current\_pid == $pid)){~~ |
  | 362 |  | ~~unset($xa\_common\_flat\_discount[$key]);~~ |
  | 363 |  | ~~}~~ |
  | 364 | 229 | } |
  | 365 | 230 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-new-calculation-handler.php?rev=3046337#L367) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-new-calculation-handler.php?rev=3211131#L232) |  |
  | 367 | 232 | foreach ($xa\_common\_flat\_discount as $key => $value) { |
  | 368 | 233 | $key\_parts = explode(':', $key); |
  | 369 |  | $current\_pid = end($key\_parts); |
  | 370 |  | if ($current\_pid == $pid) { |
  |  | 234 | if (end($key\_parts) == $pid) { |
  | 371 | 235 | unset($xa\_common\_flat\_discount[$key]); |
  | 372 | 236 | } |
  | 373 | 237 | } |
  | 374 | 238 | } |
  | 375 |  | } |
  | 376 |  | $elex\_dp\_cached\_prices[$product->get\_id()][current\_filter()] = $discounted\_price; |
  | 377 |  | add\_filter($xa\_hooks['woocommerce\_get\_price\_hook\_name'], array($this, 'elex\_dp\_getDiscountedPriceForProduct'), 22, 2);         // update sale price on product page |
  | 378 |  | add\_filter($xa\_hooks['woocommerce\_get\_sale\_price\_hook\_name'], array($this, 'elex\_dp\_getDiscountedPriceForProduct'), 22, 2);    // update sale price on product page |
  | 379 |  | add\_filter('woocommerce\_product\_variation\_get\_price', array($this, 'elex\_dp\_getDiscountedPriceForProduct'), 22, 2);    // update sale price on product page |
  | 380 |  | add\_filter('woocommerce\_product\_variation\_get\_sale\_price', array($this, 'elex\_dp\_getDiscountedPriceForProduct'), 22, 2);    // update sale price on product page |
  | 381 |  | if (((current\_filter() == $xa\_hooks['woocommerce\_get\_sale\_price\_hook\_name']) || (current\_filter() == 'woocommerce\_product\_variation\_get\_sale\_price')) && ($regular\_price == $discounted\_price)) {  // if sale price is empty then old price is regular\_price |
  | 382 |  | return ''; |
  | 383 |  | } |
  | 384 |  | return $discounted\_price; |
  | 385 |  | } |
  | 386 |  |  |
  | 387 |  | public function elex\_dp\_getDiscountedPriceHTML($price, $product) |
  | 388 |  | { |
  |  | 239 |  |
  |  | 240 |  |
  |  | 241 | } |
  |  | 242 | if ( empty( get\_transient('elex\_dp\_product\_data\_' . $product\_id) ) ) { |
  |  | 243 | set\_transient( 'elex\_dp\_product\_data\_' . $product\_id, $discounted\_price ); |
  |  | 244 | } |
  |  | 245 | $cached\_prices[$product\_id][current\_filter()] = $discounted\_price; |
  |  | 246 |  |
  |  | 247 | // Restore hooks |
  |  | 248 | $this->manageHooks(true); |
  |  | 249 |  |
  |  | 250 | return ( in\_array(current\_filter(), array($xa\_hooks['woocommerce\_get\_sale\_price\_hook\_name'], 'woocommerce\_product\_variation\_get\_sale\_price')) && $regular\_price == $discounted\_price ) ? '' : $discounted\_price; |
  |  | 251 | } |
  |  | 252 |  |
  |  | 253 | // Helper method to manage hooks |
  |  | 254 | public function manageHooks( $add) { |
  |  | 255 | global $xa\_hooks; |
  |  | 256 |  |
  |  | 257 | $action = $add ? 'add\_filter' : 'remove\_filter'; |
  |  | 258 | $priority = 22; |
  |  | 259 |  |
  |  | 260 | $filters = [ |
  |  | 261 | $xa\_hooks['woocommerce\_get\_price\_hook\_name'], |
  |  | 262 | $xa\_hooks['woocommerce\_get\_sale\_price\_hook\_name'], |
  |  | 263 | 'woocommerce\_product\_variation\_get\_price', |
  |  | 264 | 'woocommerce\_product\_variation\_get\_sale\_price' |
  |  | 265 | ]; |
  |  | 266 |  |
  |  | 267 | foreach ($filters as $filter) { |
  |  | 268 | $action($filter, [$this, 'elex\_dp\_getDiscountedPriceForProduct'], $priority, 2); |
  |  | 269 | } |
  |  | 270 | } |
  |  | 271 |  |
  |  | 272 | public function elex\_dp\_getDiscountedPriceHTML( $price, $product) { |
  | 389 | 273 | // hooked to get\_price\_html filter |
  | 390 | 274 | if ($product->is\_type('simple') || $product->is\_type('variation')) { |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-new-calculation-handler.php?rev=3046337#L398) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-new-calculation-handler.php?rev=3211131#L282) |  |
  | 398 | 282 | } |
  | 399 | 283 |  |
  | 400 |  | public function elex\_dp\_getDiscountedPriceHTML\_for\_simple\_product($price, $product) |
  | 401 |  | { |
  |  | 284 | public function elex\_dp\_getDiscountedPriceHTML\_for\_simple\_product( $price, $product) { |
  | 402 | 285 | // hooked to get\_price\_html filter |
  | 403 | 286 | return $price; |
  | 404 | 287 | } |
  | 405 | 288 |  |
  | 406 |  | public function elex\_dp\_getDiscountedPriceHTML\_for\_group\_product($price, $product) |
  | 407 |  | { |
  |  | 289 | public function elex\_dp\_getDiscountedPriceHTML\_for\_group\_product( $price, $product) { |
  | 408 | 290 | // hooked to get\_price\_html filter |
  | 409 | 291 | $tax\_display\_mode = get\_option('woocommerce\_tax\_display\_shop'); |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-new-calculation-handler.php?rev=3046337#L413) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-new-calculation-handler.php?rev=3211131#L295) |  |
  | 413 | 295 | $child = wc\_get\_product($child\_id); |
  | 414 | 296 | //$child\_prices[] = 'incl' === $tax\_display\_mode ? wc\_get\_price\_including\_tax($child) : wc\_get\_price\_excluding\_tax($child); |
  | 415 |  | if($child) { |
  |  | 297 | if ($child) { |
  | 416 | 298 | if ($child->is\_type('variable')) { |
  | 417 | 299 | $prices = $child->get\_variation\_prices(true); |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-new-calculation-handler.php?rev=3046337#L441) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-new-calculation-handler.php?rev=3211131#L323) |  |
  | 441 | 323 | if ('' !== $min\_price) { |
  | 442 | 324 | $price   = $min\_price !== $max\_price ? sprintf(\_x('%1$s&ndash;%2$s', 'Price range: from-to', 'woocommerce'), wc\_price($min\_price), wc\_price($max\_price)) : wc\_price($min\_price); |
  | 443 |  | $is\_free = (~~0 == $min\_price && 0 == $max\_price~~); |
  |  | 325 | $is\_free = ( 0 == $min\_price && 0 == $max\_price ); |
  | 444 | 326 |  |
  | 445 | 327 | if ($is\_free) { |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-new-calculation-handler.php?rev=3046337#L455) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-new-calculation-handler.php?rev=3211131#L337) |  |
  | 455 | 337 | } |
  | 456 | 338 |  |
  | 457 |  | public function elex\_dp\_getDiscountedPriceHTML\_for\_variable\_product($price, $product) |
  | 458 |  | { |
  |  | 339 | public function elex\_dp\_getDiscountedPriceHTML\_for\_variable\_product( $price, $product) { |
  | 459 | 340 | // hooked to get\_price\_html filter |
  | 460 | 341 | $prices               = array(); |
* ## [elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php](/changeset/3211131/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php "Show the changeset 3211131 restricted to elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php")

  | [r3183659](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L6 "Show revision 3183659 of this file in browser") | [r3211131](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L6 "Show revision 3211131 of this file in browser") |  |
  | --- | --- | --- |
  | 6 | 6 | \* @author Akshay |
  | 7 | 7 | \*/ |
  | 8 |  | class Elex\_RulesValidator |
  | 9 |  | { |
  |  | 8 | class Elex\_RulesValidator { |
  |  | 9 |  |
  | 10 | 10 |  |
  | 11 | 11 | public $execution\_mode      = 'first\_match'; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L22) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L22) |  |
  | 22 | 22 | \* @return array $valid\_rules |
  | 23 | 23 | \*/ |
  | 24 |  | function \_\_construct($mode = '', $for\_offers\_table = false, $only\_execute\_this\_mode = '') |
  | 25 |  | { |
  |  | 24 | function \_\_construct( $mode = '', $for\_offers\_table = false, $only\_execute\_this\_mode = '') { |
  | 26 | 25 | global $xa\_dp\_setting; |
  | 27 | 26 |  |
  | 28 | 27 | $this->for\_offers\_table = $for\_offers\_table; |
  | 29 | 28 | $this->execution\_mode   = empty($mode) ? $xa\_dp\_setting['mode'] : $mode; |
  | 30 |  | $this->execution\_order  = empty($only\_execute\_this\_mode) ? (isset($xa\_dp\_setting['execution\_order']) ? $xa\_dp\_setting['execution\_order'] : array( |
  |  | 29 | $this->execution\_order  = empty($only\_execute\_this\_mode) ? ( isset($xa\_dp\_setting['execution\_order']) ? $xa\_dp\_setting['execution\_order'] : array( |
  | 31 | 30 | 'product\_rules', |
  | 32 | 31 | 'category\_rules' |
  | 33 |  | )) : array($only\_execute\_this\_mode); |
  |  | 32 | ) ) : array($only\_execute\_this\_mode); |
  | 34 | 33 | } |
  | 35 | 34 | /\*\* |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L37) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L36) |  |
  | 37 | 36 | \*/ |
  | 38 | 37 |  |
  | 39 |  | public function elex\_dp\_getValidRulesForProduct($product, $pid = null, $current\_quantity = 1, $price = 0, $weight = 0) |
  | 40 |  | { |
  |  | 38 | public function elex\_dp\_getValidRulesForProduct( $product, $pid = null, $current\_quantity = 1, $price = 0, $weight = 0) { |
  | 41 | 39 | if (empty($pid)) { |
  | 42 | 40 | $pid = elex\_dp\_get\_pid($product); |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L58) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L56) |  |
  | 58 | 56 |  |
  | 59 | 57 |  |
  | 60 |  | function elex\_dp\_getFirstMatchedRule($product, $pid, $current\_quantity = 1, $price = 0, $weight = 0) |
  | 61 |  | { |
  |  | 58 | function elex\_dp\_getFirstMatchedRule( $product, $pid, $current\_quantity = 1, $price = 0, $weight = 0) { |
  | 62 | 59 | global $xa\_dp\_rules, $xa\_first\_match\_rule\_executed; |
  | 63 | 60 | //if(!$xa\_first\_match\_rule\_executed) |
  | 64 | 61 | { |
  | 65 |  | foreach ($this->execution\_order as $rule\_type) { |
  | 66 |  | $rules = !empty($xa\_dp\_rules[$rule\_type]) ? $xa\_dp\_rules[$rule\_type] : array(); |
  | 67 |  | foreach ($rules as $rule\_no => $rule) { |
  | 68 |  | //print\_r($rule\_type.'->'.$rule\_no." pid=".$pid); |
  | 69 |  | $rule['rule\_no']   = $rule\_no; |
  | 70 |  | $rule['rule\_type'] = $rule\_type; |
  | 71 |  | if ($this->elex\_dp\_checkRuleApplicableForProduct($rule, $rule\_type, $product, $pid, $current\_quantity, $price, $weight) === true) { |
  | 72 |  | if ($rule\_type == 'product\_rules') { |
  | 73 |  | $xa\_first\_match\_rule\_executed = true; |
  | 74 |  | } |
  | 75 |  | //error\_log('type='.$rule\_type.' ruleno='.$rule\_no.' pid='.$pid); |
  | 76 |  | return array($rule\_type . ':' . $rule\_no => $rule); |
  | 77 |  | } |
  | 78 |  | } |
  | 79 |  | } |
  |  | 62 | foreach ($this->execution\_order as $rule\_type) { |
  |  | 63 | $rules = !empty($xa\_dp\_rules[$rule\_type]) ? $xa\_dp\_rules[$rule\_type] : array(); |
  |  | 64 | foreach ($rules as $rule\_no => $rule) { |
  |  | 65 | //print\_r($rule\_type.'->'.$rule\_no." pid=".$pid); |
  |  | 66 | $rule['rule\_no']   = $rule\_no; |
  |  | 67 | $rule['rule\_type'] = $rule\_type; |
  |  | 68 | if ($this->elex\_dp\_checkRuleApplicableForProduct($rule, $rule\_type, $product, $pid, $current\_quantity, $price, $weight) === true) { |
  |  | 69 | if ($rule\_type == 'product\_rules') { |
  |  | 70 | $xa\_first\_match\_rule\_executed = true; |
  |  | 71 | } |
  |  | 72 | //error\_log('type='.$rule\_type.' ruleno='.$rule\_no.' pid='.$pid); |
  |  | 73 | return array($rule\_type . ':' . $rule\_no => $rule); |
  |  | 74 | } |
  |  | 75 | } |
  |  | 76 | } |
  | 80 | 77 | } |
  | 81 | 78 | return array(); |
  | 82 | 79 | } |
  | 83 | 80 |  |
  | 84 |  | function elex\_dp\_getAllMatchedRules($product, $pid, $current\_quantity = 1, $price = 0, $weight = 0) |
  | 85 |  | { |
  |  | 81 | function elex\_dp\_getAllMatchedRules( $product, $pid, $current\_quantity = 1, $price = 0, $weight = 0) { |
  | 86 | 82 | global $xa\_dp\_rules; |
  | 87 | 83 | $valid\_rules = array(); |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L104) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L100) |  |
  | 104 | 100 | } |
  | 105 | 101 |  |
  | 106 |  | function elex\_dp\_getBestMatchedRules($product, $pid, $current\_quantity = 1, $price = 0, $weight = 0) |
  | 107 |  | { |
  |  | 102 | function elex\_dp\_getBestMatchedRules( $product, $pid, $current\_quantity = 1, $price = 0, $weight = 0) { |
  | 108 | 103 | global $xa\_dp\_rules; |
  | 109 | 104 | $valid\_rules = array(); |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L129) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L124) |  |
  | 129 | 124 | } |
  | 130 | 125 |  |
  | 131 |  | public function elex\_dp\_checkRuleApplicableForProduct(&$rule = null, $rule\_type = '', $product = null, $pid = null, $current\_quantity = 1, $price = 0, $weight = 0) |
  | 132 |  | { |
  |  | 126 | public function elex\_dp\_checkRuleApplicableForProduct( &$rule = null, $rule\_type = '', $product = null, $pid = null, $current\_quantity = 1, $price = 0, $weight = 0) { |
  | 133 | 127 | if (apply\_filters('eha\_dp\_skip\_product', false, $pid, $rule, $rule\_type) != false) { |
  | 134 | 128 | return false; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L165) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L159) |  |
  | 165 | 159 | } |
  | 166 | 160 | global $customer; |
  | 167 |  | if ((~~!empty($rule['prev\_order\_count']) || !empty($rule['prev\_order\_total\_amt'])~~) && !empty($customer)) { |
  |  | 161 | if (( !empty($rule['prev\_order\_count']) || !empty($rule['prev\_order\_total\_amt']) ) && !empty($customer)) { |
  | 168 | 162 | $order\_count = elex\_dp\_is\_wc\_version\_gt\_eql('2.7') ? $customer->get\_order\_count() : wc\_get\_customer\_order\_count($customer->id); |
  | 169 | 163 | $total\_spent = elex\_dp\_is\_wc\_version\_gt\_eql('2.7') ? $customer->get\_total\_spent() : wc\_get\_customer\_total\_spent($customer->id); |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L189) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L183) |  |
  | 189 | 183 | } |
  | 190 | 184 |  |
  | 191 |  | function elex\_dp\_checkBOGO\_RuleApplicableForProduct(&$rule = null, $product = null, $pid = null, $current\_quantity = 1, $price = 0, $weight = 0) |
  | 192 |  | { |
  |  | 185 | function elex\_dp\_checkBOGO\_RuleApplicableForProduct( &$rule = null, $product = null, $pid = null, $current\_quantity = 1, $price = 0, $weight = 0) { |
  | 193 | 186 | $rule['purchased\_product\_id'] = elex\_dp\_WPML\_Compatible\_ids($rule['purchased\_product\_id'], 'product', true); |
  | 194 | 187 | $rule['free\_product\_id']      = elex\_dp\_WPML\_Compatible\_ids($rule['free\_product\_id'], 'product', true); |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L196) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L189) |  |
  | 196 | 189 |  |
  | 197 | 190 | //If free product is selected |
  | 198 |  | if (!isset($rule['set\_free\_option']) || (~~isset($rule['set\_free\_option']) && $rule['set\_free\_option'] == 'select\_product'~~)) { |
  |  | 191 | if (!isset($rule['set\_free\_option']) || ( isset($rule['set\_free\_option']) && $rule['set\_free\_option'] == 'select\_product' )) { |
  | 199 | 192 |  |
  | 200 | 193 | if (empty($rule['purchased\_product\_id']) || empty($rule['free\_product\_id'])) { |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L237) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L230) |  |
  | 237 | 230 | } |
  | 238 | 231 | } |
  | 239 |  | if ((~~in\_array($pid, array\_keys($rule['purchased\_product\_id'])) || in\_array($parent\_id, array\_keys($rule['purchased\_product\_id']))~~) || in\_array($pid, array\_keys($rule['free\_product\_id']))) { |
  |  | 232 | if (( in\_array($pid, array\_keys($rule['purchased\_product\_id'])) || in\_array($parent\_id, array\_keys($rule['purchased\_product\_id'])) ) || in\_array($pid, array\_keys($rule['free\_product\_id']))) { |
  | 240 | 233 | $dprice = 0; |
  | 241 | 234 | foreach ($rule['free\_product\_id'] as $\_pid => $\_qnty) { |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L246) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L239) |  |
  | 246 | 239 | } |
  | 247 | 240 | $\_product = wc\_get\_product( $\_pid ); |
  | 248 |  | if~~($\_product)~~{ |
  |  | 241 | if ($\_product) { |
  | 249 | 242 | $product\_price = $\_product->get\_price(); |
  | 250 | 243 | $price\_val = !empty($product\_price) ? $product\_price : 0; |
  | 251 |  | $dprice   += (~~$price\_val \* $\_qnty~~); |
  |  | 244 | $dprice   += ( $price\_val \* $\_qnty ); |
  | 252 | 245 | } |
  | 253 | 246 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L281) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L274) |  |
  | 281 | 274 | return false; |
  | 282 | 275 | } |
  | 283 |  | if (in\_array($pid, array\_keys($rule['purchased\_product\_id'])) && !(~~$current\_quantity > 1~~) ) { |
  |  | 276 | if (in\_array($pid, array\_keys($rule['purchased\_product\_id'])) && !( $current\_quantity > 1 ) ) { |
  | 284 | 277 | return false; |
  | 285 | 278 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L310) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L303) |  |
  | 310 | 303 | } |
  | 311 | 304 | ////////if free product is already in cart with exact quanitty this code will set its price as zero |
  | 312 |  | if ((~~in\_array($pid, array\_keys($rule['purchased\_product\_id'])) || in\_array($parent\_id, array\_keys($rule['purchased\_product\_id'])) || ($pid == $product\_tosetfree)~~)) { |
  |  | 305 | if (( in\_array($pid, array\_keys($rule['purchased\_product\_id'])) || in\_array($parent\_id, array\_keys($rule['purchased\_product\_id'])) || ( $pid == $product\_tosetfree ) )) { |
  | 313 | 306 | $dprice = 0; |
  | 314 |  | $dprice = $minvalue; |
  |  | 307 | $dprice = $minvalue; |
  | 315 | 308 | if ($this->execution\_mode == 'best\_discount') { |
  | 316 | 309 | $rule['calculated\_discount'] = $dprice;    //to check best descount rule |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L323) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L316) |  |
  | 323 | 316 | return $this->elex\_dp\_check\_date\_range\_and\_roles($rule, 'buy\_get\_free\_rules'); |
  | 324 | 317 | } |
  | 325 |  | function elex\_dp\_checkBOGO\_category\_RuleApplicableForProduct(&$rule = null, $product = null, $pid = null, $current\_quantity = 1, $price = 0, $weight = 0) |
  | 326 |  | { |
  |  | 318 | function elex\_dp\_checkBOGO\_category\_RuleApplicableForProduct( &$rule = null, $product = null, $pid = null, $current\_quantity = 1, $price = 0, $weight = 0) { |
  | 327 | 319 |  |
  | 328 | 320 | $rule['purchased\_category\_id'] = elex\_dp\_WPML\_Compatible\_ids($rule['purchased\_category\_id'], 'category', true); |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L332) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L324) |  |
  | 332 | 324 |  |
  | 333 | 325 | //If free product is selected |
  | 334 |  | if (!isset($rule['set\_free\_option']) || (~~isset($rule['set\_free\_option']) && $rule['set\_free\_option'] == 'select\_product'~~)) { |
  |  | 326 | if (!isset($rule['set\_free\_option']) || ( isset($rule['set\_free\_option']) && $rule['set\_free\_option'] == 'select\_product' )) { |
  | 335 | 327 |  |
  | 336 | 328 | if (empty($rule['purchased\_category\_id']) || empty($rule['free\_product\_id'])) { |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L349) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L341) |  |
  | 349 | 341 |  |
  | 350 | 342 | $tmp1 = array\_keys($rule['free\_product\_id']); |
  | 351 |  | if (in\_array($pid, $tmp1) && in\_array($\_cid, $product\_categories) && $xa\_dp\_setting['auto\_add\_free\_product\_on\_off'] != 'on' && !(~~$xa\_cart\_categories\_items[$\_cid] > 1~~) && $current\_quantity == 1) { |
  |  | 343 | if (in\_array($pid, $tmp1) && in\_array($\_cid, $product\_categories) && $xa\_dp\_setting['auto\_add\_free\_product\_on\_off'] != 'on' && !( $xa\_cart\_categories\_items[$\_cid] > 1 ) && $current\_quantity == 1) { |
  | 352 | 344 | $add\_if\_not\_auto = $add\_if\_not\_auto + 1; |
  | 353 | 345 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L355) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L347) |  |
  | 355 | 347 | $\_qnty   = !empty($tmp[0]) ? $tmp[0] : 0; |
  | 356 | 348 | $checkon = !empty($tmp[1]) ? $tmp[1] : 'items'; |
  | 357 |  | if ($checkon == 'items' && (~~!isset($xa\_cart\_categories\_items[$\_cid]) || $xa\_cart\_categories\_items[$\_cid] < ($\_qnty)~~)) { |
  |  | 349 | if ($checkon == 'items' && ( !isset($xa\_cart\_categories\_items[$\_cid]) || $xa\_cart\_categories\_items[$\_cid] < ( $\_qnty ) )) { |
  | 358 | 350 | return false; |
  | 359 |  | } elseif ($checkon == 'units' && (~~!isset($xa\_cart\_categories\_units[$\_cid]) || $xa\_cart\_categories\_units[$\_cid] < $\_qnty~~)) { |
  |  | 351 | } elseif ($checkon == 'units' && ( !isset($xa\_cart\_categories\_units[$\_cid]) || $xa\_cart\_categories\_units[$\_cid] < $\_qnty )) { |
  | 360 | 352 | return false; |
  | 361 | 353 | } |
  | 362 | 354 | } |
  | 363 |  | if~~($add\_if\_not\_auto > 0)~~{ |
  |  | 355 | if ($add\_if\_not\_auto > 0) { |
  | 364 | 356 | return false; |
  | 365 | 357 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L369) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L361) |  |
  | 369 | 361 | $product\_price = $\_product->get\_price(); |
  | 370 | 362 | $price\_val = !empty($product\_price) ? $product\_price : 0; |
  | 371 |  | $dprice   += (~~$price\_val \* $\_qnty~~); |
  |  | 363 | $dprice   += ( $price\_val \* $\_qnty ); |
  | 372 | 364 | } |
  | 373 | 365 | if ($this->execution\_mode == 'best\_discount') { |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L408) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L400) |  |
  | 408 | 400 | foreach ($rule['purchased\_category\_id'] as $\_cid => $\_qnty\_and\_checkon) { |
  | 409 | 401 |  |
  | 410 |  | if ((~~$pid == $product\_tosetfree) && in\_array($\_cid, $product\_categories) && !($xa\_cart\_categories\_items[$\_cid] > 1) && !($current\_quantity > 1~~)) { |
  |  | 402 | if (( $pid == $product\_tosetfree ) && in\_array($\_cid, $product\_categories) && !( $xa\_cart\_categories\_items[$\_cid] > 1 ) && !( $current\_quantity > 1 )) { |
  | 411 | 403 | $add\_if\_not\_auto = $add\_if\_not\_auto + 1; |
  | 412 | 404 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L414) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L406) |  |
  | 414 | 406 | $\_qnty   = !empty($tmp[0]) ? $tmp[0] : 0; |
  | 415 | 407 | $checkon = !empty($tmp[1]) ? $tmp[1] : 'items'; |
  | 416 |  | if ($checkon == 'items' && (~~!isset($xa\_cart\_categories\_items[$\_cid]) || $xa\_cart\_categories\_items[$\_cid] < ($\_qnty)~~)) { |
  |  | 408 | if ($checkon == 'items' && ( !isset($xa\_cart\_categories\_items[$\_cid]) || $xa\_cart\_categories\_items[$\_cid] < ( $\_qnty ) )) { |
  | 417 | 409 | return false; |
  | 418 |  | } elseif ($checkon == 'units' && (~~!isset($xa\_cart\_categories\_units[$\_cid]) || $xa\_cart\_categories\_units[$\_cid] < $\_qnty~~)) { |
  |  | 410 | } elseif ($checkon == 'units' && ( !isset($xa\_cart\_categories\_units[$\_cid]) || $xa\_cart\_categories\_units[$\_cid] < $\_qnty )) { |
  | 419 | 411 | return false; |
  | 420 | 412 | } |
  | 421 | 413 | } |
  | 422 |  | if~~($add\_if\_not\_auto > 0)~~{ |
  |  | 414 | if ($add\_if\_not\_auto > 0) { |
  | 423 | 415 | return false; |
  | 424 | 416 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L438) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L430) |  |
  | 438 | 430 | } |
  | 439 | 431 |  |
  | 440 |  | function elex\_dp\_checkbogo\_tag\_rulesApplicableForProduct(&$rule = null, $product = null, $pid = null, $current\_quantity = 1, $price = 0, $weight = 0) |
  | 441 |  | { |
  |  | 432 | function elex\_dp\_checkbogo\_tag\_rulesApplicableForProduct( &$rule = null, $product = null, $pid = null, $current\_quantity = 1, $price = 0, $weight = 0) { |
  | 442 | 433 |  |
  | 443 | 434 | $rule['purchased\_tag\_id'] = elex\_dp\_WPML\_Compatible\_ids($rule['purchased\_tag\_id'], 'tag', true); |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L446) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L437) |  |
  | 446 | 437 |  |
  | 447 | 438 | //If free product is selected |
  | 448 |  | if (!isset($rule['set\_free\_option']) || (~~isset($rule['set\_free\_option']) && $rule['set\_free\_option'] == 'select\_product'~~)) { |
  |  | 439 | if (!isset($rule['set\_free\_option']) || ( isset($rule['set\_free\_option']) && $rule['set\_free\_option'] == 'select\_product' )) { |
  | 449 | 440 |  |
  | 450 | 441 | if (empty($rule['purchased\_tag\_id']) || empty($rule['free\_product\_id'])) { |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L463) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L454) |  |
  | 463 | 454 |  |
  | 464 | 455 | $tmp1 = array\_keys($rule['free\_product\_id']); |
  | 465 |  | if (in\_array($pid, $tmp1) && in\_array($\_cid, $product\_tags) && $xa\_dp\_setting['auto\_add\_free\_product\_on\_off'] != 'on' && !(~~$xa\_cart\_tags\_items[$\_cid] > 1~~) && $current\_quantity == 1) { |
  |  | 456 | if (in\_array($pid, $tmp1) && in\_array($\_cid, $product\_tags) && $xa\_dp\_setting['auto\_add\_free\_product\_on\_off'] != 'on' && !( $xa\_cart\_tags\_items[$\_cid] > 1 ) && $current\_quantity == 1) { |
  | 466 | 457 | $add\_if\_not\_auto = $add\_if\_not\_auto + 1; |
  | 467 | 458 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L469) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L460) |  |
  | 469 | 460 | $\_qnty   = !empty($tmp[0]) ? $tmp[0] : 0; |
  | 470 | 461 | $checkon = !empty($tmp[1]) ? $tmp[1] : 'items'; |
  | 471 |  | if ($checkon == 'items' && (~~!isset($xa\_cart\_tags\_items[$\_cid]) || $xa\_cart\_tags\_items[$\_cid] < ($\_qnty)~~)) { |
  |  | 462 | if ($checkon == 'items' && ( !isset($xa\_cart\_tags\_items[$\_cid]) || $xa\_cart\_tags\_items[$\_cid] < ( $\_qnty ) )) { |
  | 472 | 463 | return false; |
  | 473 |  | } elseif ($checkon == 'units' && (~~!isset($xa\_cart\_tags\_units[$\_cid]) || $xa\_cart\_tags\_units[$\_cid] < $\_qnty~~)) { |
  |  | 464 | } elseif ($checkon == 'units' && ( !isset($xa\_cart\_tags\_units[$\_cid]) || $xa\_cart\_tags\_units[$\_cid] < $\_qnty )) { |
  | 474 | 465 | return false; |
  | 475 | 466 | } |
  | 476 | 467 | } |
  | 477 |  | if~~($add\_if\_not\_auto > 0)~~{ |
  |  | 468 | if ($add\_if\_not\_auto > 0) { |
  | 478 | 469 | return false; |
  | 479 | 470 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L483) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L474) |  |
  | 483 | 474 | $product\_price = $\_product->get\_price(); |
  | 484 | 475 | $price\_val = !empty($product\_price) ? $product\_price : 0; |
  | 485 |  | $dprice   += (~~$price\_val \* $\_qnty~~); |
  |  | 476 | $dprice   += ( $price\_val \* $\_qnty ); |
  | 486 | 477 | } |
  | 487 | 478 | if ($this->execution\_mode == 'best\_discount') { |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L519) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L510) |  |
  | 519 | 510 | foreach ($rule['purchased\_tag\_id'] as $\_cid => $\_qnty\_and\_checkon) { |
  | 520 | 511 |  |
  | 521 |  | if ((~~$pid == $product\_tosetfree) && in\_array($\_cid, $product\_tags) && !($xa\_cart\_tags\_items[$\_cid] > 1) && !($current\_quantity > 1~~)) { |
  |  | 512 | if (( $pid == $product\_tosetfree ) && in\_array($\_cid, $product\_tags) && !( $xa\_cart\_tags\_items[$\_cid] > 1 ) && !( $current\_quantity > 1 )) { |
  | 522 | 513 | $add\_if\_not\_auto = $add\_if\_not\_auto + 1; |
  | 523 | 514 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L525) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L516) |  |
  | 525 | 516 | $\_qnty   = !empty($tmp[0]) ? $tmp[0] : 0; |
  | 526 | 517 | $checkon = !empty($tmp[1]) ? $tmp[1] : 'items'; |
  | 527 |  | if ($checkon == 'items' && (~~!isset($xa\_cart\_tags\_items[$\_cid]) || $xa\_cart\_tags\_items[$\_cid] < ($\_qnty)~~)) { |
  |  | 518 | if ($checkon == 'items' && ( !isset($xa\_cart\_tags\_items[$\_cid]) || $xa\_cart\_tags\_items[$\_cid] < ( $\_qnty ) )) { |
  | 528 | 519 | return false; |
  | 529 |  | } elseif ($checkon == 'units' && (~~!isset($xa\_cart\_tags\_units[$\_cid]) || $xa\_cart\_tags\_units[$\_cid] < $\_qnty~~)) { |
  |  | 520 | } elseif ($checkon == 'units' && ( !isset($xa\_cart\_tags\_units[$\_cid]) || $xa\_cart\_tags\_units[$\_cid] < $\_qnty )) { |
  | 530 | 521 | return false; |
  | 531 | 522 | } |
  | 532 | 523 | } |
  | 533 |  | if~~($add\_if\_not\_auto > 0)~~{ |
  |  | 524 | if ($add\_if\_not\_auto > 0) { |
  | 534 | 525 | return false; |
  | 535 | 526 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L549) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L540) |  |
  | 549 | 540 | } |
  | 550 | 541 |  |
  | 551 |  | function elex\_dp\_checkCategoryCombinationalRuleApplicableForProduct(&$rule = null, $product = null, $pid = null, $current\_quantity = 1, $price = 0, $weight = 0) |
  | 552 |  | { |
  |  | 542 | function elex\_dp\_checkCategoryCombinationalRuleApplicableForProduct( &$rule = null, $product = null, $pid = null, $current\_quantity = 1, $price = 0, $weight = 0) { |
  | 553 | 543 |  |
  | 554 | 544 | global $xa\_cart\_quantities; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L594) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L584) |  |
  | 594 | 584 | $\_product = wc\_get\_product($pid); |
  | 595 | 585 | $old\_price = $\_product->get\_price(); |
  | 596 |  | $rule['calculated\_discount'] = (~~(float)$old\_price - (float)$new\_price~~) \* $current\_quantity; |
  |  | 586 | $rule['calculated\_discount'] = ( (float) $old\_price - (float) $new\_price ) \* $current\_quantity; |
  | 597 | 587 | } |
  | 598 | 588 | //checking roles and tofrom date for which rule is applicable |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L600) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L590) |  |
  | 600 | 590 | } |
  | 601 | 591 |  |
  | 602 |  | function elex\_dp\_checkCategoryRuleApplicableForProduct(&$rule = null, $product = null, $pid = null, $current\_quantity = 1, $price = 0, $weight = 0) |
  | 603 |  | { |
  |  | 592 | function elex\_dp\_checkCategoryRuleApplicableForProduct( &$rule = null, $product = null, $pid = null, $current\_quantity = 1, $price = 0, $weight = 0) { |
  | 604 | 593 |  |
  | 605 | 594 | global $xa\_cart\_quantities; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L607) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L596) |  |
  | 607 | 596 | global $xa\_cart\_price; |
  | 608 | 597 | global $xa\_cart\_categories; |
  | 609 |  | $min = (~~empty($rule['min']) == true~~) ? 1 : $rule['min']; |
  | 610 |  | $max = (~~empty($rule['max']) == true~~) ? 999999999 : $rule['max']; |
  |  | 598 | $min = ( empty($rule['min']) == true ) ? 1 : $rule['min']; |
  |  | 599 | $max = ( empty($rule['max']) == true ) ? 999999999 : $rule['max']; |
  | 611 | 600 |  |
  | 612 | 601 | if ($max < $min && $max != 0) { |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L656) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L645) |  |
  | 656 | 645 | } |
  | 657 | 646 | if (!empty($xa\_cart\_weight[$\_pid])) { |
  | 658 |  | $total\_weight\_of\_this\_category += (float) (~~$qnty \* $xa\_cart\_weight[$\_pid]~~); |
  |  | 647 | $total\_weight\_of\_this\_category += (float) ( $qnty \* $xa\_cart\_weight[$\_pid] ); |
  | 659 | 648 | } |
  | 660 | 649 | if (!empty($xa\_cart\_price[$\_pid])) { |
  | 661 |  | $total\_price\_of\_this\_category += (float) (~~$qnty \* $xa\_cart\_price[$\_pid]~~); |
  |  | 650 | $total\_price\_of\_this\_category += (float) ( $qnty \* $xa\_cart\_price[$\_pid] ); |
  | 662 | 651 | } |
  | 663 | 652 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L672) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L661) |  |
  | 672 | 661 | //error\_log('total units=' . $total\_all\_units\_of\_this\_category\_in\_cart . " total items=" . $total\_items\_of\_this\_category\_in\_cart); |
  | 673 | 662 | //error\_log('total price=' . $total\_price\_of\_this\_category . " total weights=" . $total\_weight\_of\_this\_category); |
  | 674 |  | if ($rule['check\_on'] == 'TotalQuantity' && (~~$total\_all\_units\_of\_this\_category\_in\_cart < $min || $total\_all\_units\_of\_this\_category\_in\_cart > $max || empty($total\_all\_units\_of\_this\_category\_in\_cart)~~)) { |
  | 675 |  | return false; |
  | 676 |  | } elseif ($rule['check\_on'] == 'Quantity' && (~~$total\_items\_of\_this\_category\_in\_cart < $min || $total\_items\_of\_this\_category\_in\_cart > $max || empty($total\_items\_of\_this\_category\_in\_cart)~~)) { |
  | 677 |  | return false; |
  | 678 |  | } elseif ($rule['check\_on'] == 'Weight' && (~~$total\_weight\_of\_this\_category < $min || $total\_weight\_of\_this\_category > $max || empty($total\_weight\_of\_this\_category)~~)) { |
  | 679 |  | return false; |
  | 680 |  | } elseif ($rule['check\_on'] == 'Price' && (~~$total\_price\_of\_this\_category < $min || $total\_price\_of\_this\_category > $max || empty($total\_price\_of\_this\_category)~~)) { |
  |  | 663 | if ($rule['check\_on'] == 'TotalQuantity' && ( $total\_all\_units\_of\_this\_category\_in\_cart < $min || $total\_all\_units\_of\_this\_category\_in\_cart > $max || empty($total\_all\_units\_of\_this\_category\_in\_cart) )) { |
  |  | 664 | return false; |
  |  | 665 | } elseif ($rule['check\_on'] == 'Quantity' && ( $total\_items\_of\_this\_category\_in\_cart < $min || $total\_items\_of\_this\_category\_in\_cart > $max || empty($total\_items\_of\_this\_category\_in\_cart) )) { |
  |  | 666 | return false; |
  |  | 667 | } elseif ($rule['check\_on'] == 'Weight' && ( $total\_weight\_of\_this\_category < $min || $total\_weight\_of\_this\_category > $max || empty($total\_weight\_of\_this\_category) )) { |
  |  | 668 | return false; |
  |  | 669 | } elseif ($rule['check\_on'] == 'Price' && ( $total\_price\_of\_this\_category < $min || $total\_price\_of\_this\_category > $max || empty($total\_price\_of\_this\_category) )) { |
  | 681 | 670 | return false; |
  | 682 | 671 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L687) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L676) |  |
  | 687 | 676 | $\_product = wc\_get\_product($pid); |
  | 688 | 677 | $old\_price = $\_product->get\_price(); |
  | 689 |  | $rule['calculated\_discount'] = (~~(float)$old\_price - (float)$new\_price~~) \* $current\_quantity; |
  |  | 678 | $rule['calculated\_discount'] = ( (float) $old\_price - (float) $new\_price ) \* $current\_quantity; |
  | 690 | 679 | } |
  | 691 | 680 |  |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L694) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L683) |  |
  | 694 | 683 | } |
  | 695 | 684 |  |
  | 696 |  | function elex\_dp\_checkTagRuleApplicableForProduct(&$rule = null, $product = null, $pid = null, $current\_quantity = 1, $price = 0, $weight = 0) |
  | 697 |  | { |
  |  | 685 | function elex\_dp\_checkTagRuleApplicableForProduct( &$rule = null, $product = null, $pid = null, $current\_quantity = 1, $price = 0, $weight = 0) { |
  | 698 | 686 |  |
  | 699 | 687 | global $xa\_cart\_quantities; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L701) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L689) |  |
  | 701 | 689 | global $xa\_cart\_price; |
  | 702 | 690 | global $xa\_cart\_tags; |
  | 703 |  | $min = (~~empty($rule['min']) == true~~) ? 1 : $rule['min']; |
  | 704 |  | $max = (~~empty($rule['max']) == true~~) ? 999999999 : $rule['max']; |
  |  | 691 | $min = ( empty($rule['min']) == true ) ? 1 : $rule['min']; |
  |  | 692 | $max = ( empty($rule['max']) == true ) ? 999999999 : $rule['max']; |
  | 705 | 693 |  |
  | 706 | 694 | if ($max < $min && $max != 0) { |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L750) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L738) |  |
  | 750 | 738 | } |
  | 751 | 739 | if (!empty($xa\_cart\_weight[$\_pid])) { |
  | 752 |  | $total\_weight\_of\_this\_tag += (int) (~~$qnty \* $xa\_cart\_weight[$\_pid]~~); |
  |  | 740 | $total\_weight\_of\_this\_tag += (int) ( $qnty \* $xa\_cart\_weight[$\_pid] ); |
  | 753 | 741 | } |
  | 754 | 742 | if (!empty($xa\_cart\_price[$\_pid])) { |
  | 755 |  | $total\_price\_of\_this\_tag += (int) (~~$qnty \* $xa\_cart\_price[$\_pid]~~); |
  |  | 743 | $total\_price\_of\_this\_tag += (int) ( $qnty \* $xa\_cart\_price[$\_pid] ); |
  | 756 | 744 | } |
  | 757 | 745 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L766) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L754) |  |
  | 766 | 754 | //error\_log('total units=' . $total\_all\_units\_of\_this\_tag\_in\_cart . " total items=" . $total\_items\_of\_this\_tag\_in\_cart); |
  | 767 | 755 | //error\_log('total price=' . $total\_price\_of\_this\_tag . " total weights=" . $total\_weight\_of\_this\_tag); |
  | 768 |  | if ($rule['check\_on'] == 'TotalQuantity' && (~~$total\_all\_units\_of\_this\_tag\_in\_cart < $min || $total\_all\_units\_of\_this\_tag\_in\_cart > $max || empty($total\_all\_units\_of\_this\_tag\_in\_cart)~~)) { |
  | 769 |  | return false; |
  | 770 |  | } elseif ($rule['check\_on'] == 'Quantity' && (~~$total\_items\_of\_this\_tag\_in\_cart < $min || $total\_items\_of\_this\_tag\_in\_cart > $max || empty($total\_items\_of\_this\_tag\_in\_cart)~~)) { |
  | 771 |  | return false; |
  | 772 |  | } elseif ($rule['check\_on'] == 'Weight' && (~~$total\_weight\_of\_this\_tag < $min || $total\_weight\_of\_this\_tag > $max || empty($total\_weight\_of\_this\_tag)~~)) { |
  | 773 |  | return false; |
  | 774 |  | } elseif ($rule['check\_on'] == 'Price' && (~~$total\_price\_of\_this\_tag < $min || $total\_price\_of\_this\_tag > $max || empty($total\_price\_of\_this\_tag)~~)) { |
  |  | 756 | if ($rule['check\_on'] == 'TotalQuantity' && ( $total\_all\_units\_of\_this\_tag\_in\_cart < $min || $total\_all\_units\_of\_this\_tag\_in\_cart > $max || empty($total\_all\_units\_of\_this\_tag\_in\_cart) )) { |
  |  | 757 | return false; |
  |  | 758 | } elseif ($rule['check\_on'] == 'Quantity' && ( $total\_items\_of\_this\_tag\_in\_cart < $min || $total\_items\_of\_this\_tag\_in\_cart > $max || empty($total\_items\_of\_this\_tag\_in\_cart) )) { |
  |  | 759 | return false; |
  |  | 760 | } elseif ($rule['check\_on'] == 'Weight' && ( $total\_weight\_of\_this\_tag < $min || $total\_weight\_of\_this\_tag > $max || empty($total\_weight\_of\_this\_tag) )) { |
  |  | 761 | return false; |
  |  | 762 | } elseif ($rule['check\_on'] == 'Price' && ( $total\_price\_of\_this\_tag < $min || $total\_price\_of\_this\_tag > $max || empty($total\_price\_of\_this\_tag) )) { |
  | 775 | 763 | return false; |
  | 776 | 764 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L781) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L769) |  |
  | 781 | 769 | $\_product = wc\_get\_product($pid); |
  | 782 | 770 | $old\_price = $\_product->get\_price(); |
  | 783 |  | $rule['calculated\_discount'] = (~~(float)$old\_price - (float)$new\_price~~) \* $current\_quantity; |
  |  | 771 | $rule['calculated\_discount'] = ( (float) $old\_price - (float) $new\_price ) \* $current\_quantity; |
  | 784 | 772 | } |
  | 785 | 773 |  |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L788) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L776) |  |
  | 788 | 776 | } |
  | 789 | 777 |  |
  | 790 |  | function elex\_dp\_checkCartRuleApplicableForProduct(&$rule = null, $product = null, $pid = null, $current\_quantity = 1, $price = 0, $weight = 0) |
  | 791 |  | { |
  |  | 778 | function elex\_dp\_checkCartRuleApplicableForProduct( &$rule = null, $product = null, $pid = null, $current\_quantity = 1, $price = 0, $weight = 0) { |
  | 792 | 779 |  |
  | 793 | 780 | global $xa\_cart\_quantities; |
  | 794 | 781 | global $xa\_cart\_weight; |
  | 795 | 782 | global $xa\_cart\_price; |
  | 796 |  | $min  = (~~empty($rule['min']) == true~~) ? 1 : $rule['min']; |
  | 797 |  | $max  = (~~empty($rule['max']) == true~~) ? 999999999 : $rule['max']; |
  |  | 783 | $min  = ( empty($rule['min']) == true ) ? 1 : $rule['min']; |
  |  | 784 | $max  = ( empty($rule['max']) == true ) ? 999999999 : $rule['max']; |
  | 798 | 785 | $attr = $product->get\_attributes(); |
  | 799 | 786 | $attribute\_data = array(); |
  | 800 | 787 | foreach ($attr as $attribute\_name => $attribute) { |
  | 801 |  | if(is\_object($attribute)) { |
  |  | 788 | if (is\_object($attribute)) { |
  | 802 | 789 | $attribute\_values = $attribute->get\_options(); |
  | 803 | 790 |  |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L812) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L799) |  |
  | 812 | 799 | $attribute\_data[$attribute\_name] = $term\_slugs; |
  | 813 | 800 | } |
  | 814 |  | }~~else if(is\_string($attribute))~~{ |
  | 815 |  | $attribute\_data[$attribute\_name] = (array)$attribute; |
  |  | 801 | } else if (is\_string($attribute)) { |
  |  | 802 | $attribute\_data[$attribute\_name] = (array) $attribute; |
  | 816 | 803 |  |
  | 817 | 804 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L881) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L868) |  |
  | 881 | 868 | //if pid is selected in this rule |
  | 882 | 869 |  |
  | 883 |  | if (is\_cart() && (~~empty($pid) || !in\_array($pid, array\_keys($xa\_cart\_quantities))~~)) { |
  |  | 870 | if (is\_cart() && ( empty($pid) || !in\_array($pid, array\_keys($xa\_cart\_quantities)) )) { |
  | 884 | 871 | return false; |
  | 885 | 872 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L903) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L890) |  |
  | 903 | 890 | $total\_all\_units\_in\_cart += $\_qnty; |
  | 904 | 891 | if (!empty($xa\_cart\_weight[$\_pid])) { |
  | 905 |  | $total\_weight\_in\_cart += (~~$\_qnty \* $xa\_cart\_weight[$\_pid]~~); |
  |  | 892 | $total\_weight\_in\_cart += ( $\_qnty \* $xa\_cart\_weight[$\_pid] ); |
  | 906 | 893 | } |
  | 907 | 894 | if (!empty($xa\_cart\_price[$\_pid])) { |
  | 908 |  | $total\_price\_in\_cart += (~~$\_qnty \* $xa\_cart\_price[$\_pid]~~); |
  |  | 895 | $total\_price\_in\_cart += ( $\_qnty \* $xa\_cart\_price[$\_pid] ); |
  | 909 | 896 | } |
  | 910 | 897 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L912) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L899) |  |
  | 912 | 899 | //error\_log('total units=' . $total\_all\_units\_of\_this\_category\_in\_cart . " total items=" . $total\_items\_of\_this\_category\_in\_cart); |
  | 913 | 900 | //error\_log('total price=' . $total\_price\_of\_this\_category . " total weights=" . $total\_weight\_of\_this\_category); |
  | 914 |  | if ($rule['check\_on'] == 'TotalQuantity' && (~~$total\_all\_units\_in\_cart < $min || $total\_all\_units\_in\_cart > $max || empty($total\_all\_units\_in\_cart)~~)) { |
  | 915 |  | return false; |
  | 916 |  | } elseif ($rule['check\_on'] == 'Quantity' && (~~$total\_items\_in\_cart < $min || $total\_items\_in\_cart > $max || empty($total\_items\_in\_cart)~~)) { |
  | 917 |  | return false; |
  | 918 |  | } elseif ($rule['check\_on'] == 'Weight' && (~~$total\_weight\_in\_cart < $min || $total\_weight\_in\_cart > $max || empty($total\_weight\_in\_cart)~~)) { |
  | 919 |  | return false; |
  | 920 |  | } elseif ($rule['check\_on'] == 'Price' && (~~$total\_price\_in\_cart < $min || $total\_price\_in\_cart > $max || empty($total\_price\_in\_cart)~~)) { |
  |  | 901 | if ($rule['check\_on'] == 'TotalQuantity' && ( $total\_all\_units\_in\_cart < $min || $total\_all\_units\_in\_cart > $max || empty($total\_all\_units\_in\_cart) )) { |
  |  | 902 | return false; |
  |  | 903 | } elseif ($rule['check\_on'] == 'Quantity' && ( $total\_items\_in\_cart < $min || $total\_items\_in\_cart > $max || empty($total\_items\_in\_cart) )) { |
  |  | 904 | return false; |
  |  | 905 | } elseif ($rule['check\_on'] == 'Weight' && ( $total\_weight\_in\_cart < $min || $total\_weight\_in\_cart > $max || empty($total\_weight\_in\_cart) )) { |
  |  | 906 | return false; |
  |  | 907 | } elseif ($rule['check\_on'] == 'Price' && ( $total\_price\_in\_cart < $min || $total\_price\_in\_cart > $max || empty($total\_price\_in\_cart) )) { |
  | 921 | 908 | return false; |
  | 922 | 909 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L928) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L915) |  |
  | 928 | 915 | $\_product = wc\_get\_product($pid); |
  | 929 | 916 | $old\_price = $\_product->get\_price(); |
  | 930 |  | $rule['calculated\_discount'] = (~~(float)$old\_price - (float)$new\_price~~) \* $current\_quantity; |
  |  | 917 | $rule['calculated\_discount'] = ( (float) $old\_price - (float) $new\_price ) \* $current\_quantity; |
  | 931 | 918 | } |
  | 932 | 919 | //checking roles and tofrom date for which rule is applicable |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L934) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L921) |  |
  | 934 | 921 | } |
  | 935 | 922 |  |
  | 936 |  | function elex\_dp\_checkCombinationalRuleApplicableForProduct(&$rule = null, $product = null, $pid = null, $current\_quantity = 1, $price = 0, $weight = 0) |
  | 937 |  | { |
  |  | 923 | function elex\_dp\_checkCombinationalRuleApplicableForProduct( &$rule = null, $product = null, $pid = null, $current\_quantity = 1, $price = 0, $weight = 0) { |
  | 938 | 924 | global $xa\_cart\_quantities; |
  | 939 | 925 | $total\_units        = 0; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L965) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L951) |  |
  | 965 | 951 | } |
  | 966 | 952 | } |
  | 967 |  | if ((~~empty($xa\_cart\_quantities[$\_pid]) || $xa\_cart\_quantities[$\_pid] < $\_qnty) && ($total\_child\_qty == 0 || $total\_child\_qty < $\_qnty~~)) { |
  |  | 953 | if (( empty($xa\_cart\_quantities[$\_pid]) || $xa\_cart\_quantities[$\_pid] < $\_qnty ) && ( $total\_child\_qty == 0 || $total\_child\_qty < $\_qnty )) { |
  | 968 | 954 | if ($\_pid != $check\_for\_pid || empty($xa\_cart\_quantities[$pid]) || $xa\_cart\_quantities[$pid] < $\_qnty) { //code to consider parent id of variable products |
  | 969 | 955 | return false; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L976) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L962) |  |
  | 976 | 962 | } |
  | 977 | 963 | $rule['discount\_on\_product\_id'] = elex\_dp\_WPML\_Compatible\_ids($rule['discount\_on\_product\_id']); |
  | 978 |  | if (!empty($rule['discount\_on\_product\_id']) && is\_array($rule['discount\_on\_product\_id']) && (~~!in\_array($pid, $rule['discount\_on\_product\_id']) && !in\_array($product->get\_parent\_id(), $rule['discount\_on\_product\_id'])~~)) { |
  |  | 964 | if (!empty($rule['discount\_on\_product\_id']) && is\_array($rule['discount\_on\_product\_id']) && ( !in\_array($pid, $rule['discount\_on\_product\_id']) && !in\_array($product->get\_parent\_id(), $rule['discount\_on\_product\_id']) )) { |
  | 979 | 965 | return false; |
  | 980 | 966 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L985) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L971) |  |
  | 985 | 971 | $\_product = wc\_get\_product($pid); |
  | 986 | 972 | $old\_price = $\_product->get\_price(); |
  | 987 |  | $rule['calculated\_discount'] = (~~(float)$old\_price - (float)$new\_price~~) \* $current\_quantity; |
  |  | 973 | $rule['calculated\_discount'] = ( (float) $old\_price - (float) $new\_price ) \* $current\_quantity; |
  | 988 | 974 | } |
  | 989 | 975 | //checking roles and tofrom date for which rule is applicable |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L991) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L977) |  |
  | 991 | 977 | } |
  | 992 | 978 |  |
  | 993 |  | function elex\_dp\_checkProductRuleApplicableForProduct(&$rule = null, $product = null, $pid = null, $current\_quantity = 1, $price = 0, $weight = 0) |
  | 994 |  | { |
  |  | 979 | function elex\_dp\_checkProductRuleApplicableForProduct( &$rule = null, $product = null, $pid = null, $current\_quantity = 1, $price = 0, $weight = 0) { |
  | 995 | 980 | global $xa\_cart\_categories; |
  | 996 | 981 | global $xa\_cart\_quantities; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1000) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L985) |  |
  | 1000 | 985 | $pid = elex\_dp\_get\_pid($product); |
  | 1001 | 986 | } |
  | 1002 |  | $min          = (~~empty($rule['min']) == true~~) ? 1 : $rule['min']; |
  | 1003 |  | $max          = (~~empty($rule['max']) == true~~) ? 999999999 : $rule['max']; |
  | 1004 |  | $total\_price  = !empty($price) ? (~~$price \* $current\_quantity~~) : 0; |
  | 1005 |  | $total\_weight = !empty($weight) ? (~~(float)$weight \* $current\_quantity~~) : 0; |
  |  | 987 | $min          = ( empty($rule['min']) == true ) ? 1 : $rule['min']; |
  |  | 988 | $max          = ( empty($rule['max']) == true ) ? 999999999 : $rule['max']; |
  |  | 989 | $total\_price  = !empty($price) ? ( $price \* $current\_quantity ) : 0; |
  |  | 990 | $total\_weight = !empty($weight) ? ( (float) $weight \* $current\_quantity ) : 0; |
  | 1006 | 991 | if ($max < $min && $max != 0) { |
  | 1007 | 992 | return false; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1040) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L1025) |  |
  | 1040 | 1025 | if ($rule['rule\_on'] == 'products') { |
  | 1041 | 1026 | $pids = elex\_dp\_WPML\_Compatible\_ids($rule['product\_id']); |
  | 1042 |  | if (empty($pids) || (~~!is\_array($pids) || (!in\_array($check\_for\_pid, $pids) && !in\_array($pid, $pids))~~)) { |
  |  | 1027 | if (empty($pids) || ( !is\_array($pids) || ( !in\_array($check\_for\_pid, $pids) && !in\_array($pid, $pids) ) )) { |
  | 1043 | 1028 | return false; |
  | 1044 | 1029 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1074) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L1059) |  |
  | 1074 | 1059 | if ($rule['check\_on'] == 'Quantity') { |
  | 1075 | 1060 |  |
  | 1076 |  | if (is\_cart() && (~~empty($pid) || !in\_array($pid, array\_keys($xa\_cart\_quantities))~~)) { |
  |  | 1061 | if (is\_cart() && ( empty($pid) || !in\_array($pid, array\_keys($xa\_cart\_quantities)) )) { |
  | 1077 | 1062 | return false; |
  | 1078 | 1063 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1095) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L1080) |  |
  | 1095 | 1080 | foreach ($xa\_cart\_quantities as $\_pid => $\_qnty) { |
  | 1096 | 1081 | $total\_items\_in\_cart++; |
  | 1097 |  | if~~($pids && in\_array($\_pid, $pids))~~{ |
  |  | 1082 | if ($pids && in\_array($\_pid, $pids)) { |
  | 1098 | 1083 | $total\_all\_product\_items++; |
  | 1099 | 1084 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1102) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L1087) |  |
  | 1102 | 1087 |  |
  | 1103 | 1088 | //Conditions for different rule type |
  | 1104 |  | if ('products' === $rule['rule\_on'] && in\_array($pid, $rule\_product\_ids) && (~~$total\_all\_product\_items < $min || ($total\_all\_product\_items > $max && $repeat == false) || empty($total\_all\_product\_items)~~)) { |
  | 1105 |  | return false; |
  |  | 1089 | if ('products' === $rule['rule\_on'] && in\_array($pid, $rule\_product\_ids) && ( $total\_all\_product\_items < $min || ( $total\_all\_product\_items > $max && $repeat == false ) || empty($total\_all\_product\_items) )) { |
  |  | 1090 | return false; |
  | 1106 | 1091 |  |
  | 1107 |  | }else if ('categories' === $rule['rule\_on'] && $this->validate\_product\_matches\_categories(wc\_get\_product($pid), $rule)) { |
  |  | 1092 | } else if ('categories' === $rule['rule\_on'] && $this->validate\_product\_matches\_categories(wc\_get\_product($pid), $rule)) { |
  | 1108 | 1093 | $tmp=elex\_dp\_get\_category\_ids($pid); |
  | 1109 | 1094 | $product\_categories=!empty($tmp)?$tmp:array(); |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1113) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L1098) |  |
  | 1113 | 1098 | } |
  | 1114 | 1099 | foreach ($xa\_cart\_categories as $\_pid => $\_categories) { |
  | 1115 |  | $match=array\_intersect($matched,$\_categories); |
  |  | 1100 | $match=array\_intersect($matched, $\_categories); |
  | 1116 | 1101 | if (!empty($match)) { |
  | 1117 | 1102 | $total\_items\_of\_this\_category\_in\_cart++; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1126) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L1111) |  |
  | 1126 | 1111 | $total\_all\_units\_of\_this\_category\_in\_cart = 1; |
  | 1127 | 1112 | } |
  | 1128 |  | if~~($total\_items\_of\_this\_category\_in\_cart < $min || (($total\_items\_of\_this\_category\_in\_cart > $max && $repeat == false)) || empty($total\_items\_of\_this\_category\_in\_cart))~~{ |
  | 1129 |  | return false; |
  | 1130 |  | } |
  | 1131 |  |  |
  | 1132 |  | }~~else if (('cart' === $rule['rule\_on'])  && ($total\_items\_in\_cart < $min || (($total\_items\_in\_cart > $max && $repeat == false)) || empty($total\_items\_in\_cart)~~)) { |
  | 1133 |  | return false; |
  | 1134 |  | } |
  | 1135 |  | } elseif ($rule['check\_on'] == 'Weight' && (~~$total\_weight < $min || ($total\_weight > $max && $repeat == false) || empty($total\_weight)~~)) { |
  | 1136 |  | return false; |
  | 1137 |  | } elseif ($rule['check\_on'] == 'Price' && (~~$total\_price < $min || ($total\_price > $max && $repeat == false) || empty($total\_price)~~)) { |
  | 1138 |  | return false; |
  | 1139 |  | } elseif ($rule['check\_on'] == 'Units' && (~~$current\_quantity < $min || ($current\_quantity > $max && $repeat == false)~~)) { |
  |  | 1113 | if ($total\_items\_of\_this\_category\_in\_cart < $min || ( ( $total\_items\_of\_this\_category\_in\_cart > $max && $repeat == false ) ) || empty($total\_items\_of\_this\_category\_in\_cart)) { |
  |  | 1114 | return false; |
  |  | 1115 | } |
  |  | 1116 |  |
  |  | 1117 | } else if (( 'cart' === $rule['rule\_on'] )  && ( $total\_items\_in\_cart < $min || ( ( $total\_items\_in\_cart > $max && $repeat == false ) ) || empty($total\_items\_in\_cart) )) { |
  |  | 1118 | return false; |
  |  | 1119 | } |
  |  | 1120 | } elseif ($rule['check\_on'] == 'Weight' && ( $total\_weight < $min || ( $total\_weight > $max && $repeat == false ) || empty($total\_weight) )) { |
  |  | 1121 | return false; |
  |  | 1122 | } elseif ($rule['check\_on'] == 'Price' && ( $total\_price < $min || ( $total\_price > $max && $repeat == false ) || empty($total\_price) )) { |
  |  | 1123 | return false; |
  |  | 1124 | } elseif ($rule['check\_on'] == 'Units' && ( $current\_quantity < $min || ( $current\_quantity > $max && $repeat == false ) )) { |
  | 1140 | 1125 | return false; |
  | 1141 | 1126 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1147) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L1132) |  |
  | 1147 | 1132 | $\_product = wc\_get\_product($pid); |
  | 1148 | 1133 | $old\_price = $\_product->get\_price(); |
  | 1149 |  | $rule['calculated\_discount'] = (~~(float)$old\_price - (float)$new\_price~~) \* $current\_quantity; |
  |  | 1134 | $rule['calculated\_discount'] = ( (float) $old\_price - (float) $new\_price ) \* $current\_quantity; |
  | 1150 | 1135 | } |
  | 1151 | 1136 | //checking roles and tofrom date for which rule is applicable |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1153) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L1138) |  |
  | 1153 | 1138 | } |
  | 1154 | 1139 |  |
  | 1155 |  | function elex\_dp\_check\_date\_range\_and\_roles($rule, $rule\_type) |
  | 1156 |  | { |
  |  | 1140 | function elex\_dp\_check\_date\_range\_and\_roles( $rule, $rule\_type) { |
  | 1157 | 1141 | $fromdate   = $rule['from\_date']; |
  | 1158 | 1142 | $todate     = $rule['to\_date']; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1180) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L1164) |  |
  | 1180 | 1164 | $match = array\_intersect((array) $user\_roles, (array) $current\_user->roles); |
  | 1181 | 1165 | if (!in\_array('all', $user\_roles) && empty($match) && !empty($user\_roles)) { |
  | 1182 |  | if (!(~~in\_array('guest\_user', $user\_roles) && !is\_user\_logged\_in()~~)) { |
  |  | 1166 | if (!( in\_array('guest\_user', $user\_roles) && !is\_user\_logged\_in() )) { |
  | 1183 | 1167 | return false; |
  | 1184 | 1168 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1186) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L1170) |  |
  | 1186 | 1170 |  |
  | 1187 | 1171 | $now = current\_time('d-m-Y'); |
  | 1188 |  | if ((~~empty($fromdate) && empty($todate)) || (empty($fromdate) && empty($todate) == false && (strtotime($now) <= strtotime($todate))) || (empty($fromdate) == false && (strtotime($now) >= strtotime($fromdate)) && empty($todate)) || ((strtotime($now) >= strtotime($fromdate)) && (strtotime($now) <= strtotime($todate))~~)) { |
  |  | 1172 | if (( empty($fromdate) && empty($todate) ) || ( empty($fromdate) && empty($todate) == false && ( strtotime($now) <= strtotime($todate) ) ) || ( empty($fromdate) == false && ( strtotime($now) >= strtotime($fromdate) ) && empty($todate) ) || ( ( strtotime($now) >= strtotime($fromdate) ) && ( strtotime($now) <= strtotime($todate) ) )) { |
  | 1189 | 1173 | } else { |
  | 1190 | 1174 | return false; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1194) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L1178) |  |
  | 1194 | 1178 | } |
  | 1195 | 1179 |  |
  | 1196 |  | public function elex\_dp\_execute\_rule($old\_price, $rule\_type\_colon\_rule\_no, $rule, $current\_quantity = 1, $pid = 0, $object\_hash = '') |
  | 1197 |  | { |
  |  | 1180 | public function elex\_dp\_execute\_rule( $old\_price, $rule\_type\_colon\_rule\_no, $rule, $current\_quantity = 1, $pid = 0, $object\_hash = '') { |
  | 1198 | 1181 | global $executed\_rule\_pid\_price, $executed\_pids; |
  | 1199 | 1182 | $new\_price = $old\_price; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1245) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L1228) |  |
  | 1245 | 1228 | } |
  | 1246 | 1229 |  |
  | 1247 |  | public function elex\_dp\_calculate\_discount($old\_price, $rule\_no, $rule, $pid = 0, $current\_quantity = 1, $do\_not\_execute = false) |
  | 1248 |  | { |
  |  | 1230 | public function elex\_dp\_calculate\_discount( $old\_price, $rule\_no, $rule, $pid = 0, $current\_quantity = 1, $do\_not\_execute = false) { |
  | 1249 | 1231 | global $xa\_common\_flat\_discount, $xa\_cart\_quantities, $executed\_rule\_pid\_price, $xa\_cart\_categories\_units, $xa\_cart\_categories, $xa\_cart\_price; |
  | 1250 | 1232 | $new\_price           = $old\_price; |
  | 1251 |  | $type\_code           = $rule['rule\_type'] == 'product\_rules'  ?  (~~$rule['rule\_type'] . $pid~~)   :  $rule['rule\_type']; |
  |  | 1233 | $type\_code           = $rule['rule\_type'] == 'product\_rules'  ?  ( $rule['rule\_type'] . $pid )   :  $rule['rule\_type']; |
  | 1252 | 1234 | $cart\_quantity       = 0; |
  | 1253 | 1235 | $prev\_total\_discount = 0; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1269) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L1251) |  |
  | 1269 | 1251 | $rprice               = isset($xa\_cart\_price[$ppid]) ?  $xa\_cart\_price[$ppid] : 0; |
  | 1270 | 1252 | $sprice               = isset($executed\_rule\_pid\_price[$rule['rule\_type'] . ':' . $rule\_no][$ppid]) ?  $executed\_rule\_pid\_price[$rule['rule\_type'] . ':' . $rule\_no][$ppid] : $rprice; |
  | 1271 |  | $prev\_total\_discount += (~~$rprice - $sprice~~) \* $qnty; |
  |  | 1253 | $prev\_total\_discount += ( $rprice - $sprice ) \* $qnty; |
  | 1272 | 1254 | } |
  | 1273 | 1255 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1283) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L1265) |  |
  | 1283 | 1265 | $rprice               = isset($xa\_cart\_price[$ppid]) ?  $xa\_cart\_price[$ppid] : 0; |
  | 1284 | 1266 | $sprice               = isset($executed\_rule\_pid\_price[$rule['rule\_type'] . ':' . $rule\_no][$ppid]) ?  $executed\_rule\_pid\_price[$rule['rule\_type'] . ':' . $rule\_no][$ppid] : $rprice; |
  | 1285 |  | $prev\_total\_discount += (~~$rprice - $sprice~~) \* $units; |
  |  | 1267 | $prev\_total\_discount += ( $rprice - $sprice ) \* $units; |
  | 1286 | 1268 | } |
  | 1287 | 1269 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1303) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L1285) |  |
  | 1303 | 1285 | $discount\_amt = floatval($value) \* floatval($old\_price) / 100; |
  | 1304 | 1286 | } elseif ($discount\_type == 'Flat Discount') { |
  | 1305 |  | if~~($current\_quantity)~~{ |
  |  | 1287 | if ($current\_quantity) { |
  | 1306 | 1288 | if ($do\_not\_execute === true) { |
  | 1307 | 1289 | $discount\_amt = floatval($value); |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1312) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L1294) |  |
  | 1312 | 1294 | } elseif ($discount\_type == 'Fixed Price') { |
  | 1313 | 1295 | $discount\_amt = floatval($old\_price) - floatval($value); |
  | 1314 |  | } elseif~~($discount\_type == 'Coupon Discount')~~{ |
  | 1315 |  |  |
  | 1316 |  | if~~($rule['coupon\_discount\_type'] == 'percent')~~{ |
  |  | 1296 | } elseif ($discount\_type == 'Coupon Discount') { |
  |  | 1297 |  |
  |  | 1298 | if ($rule['coupon\_discount\_type'] == 'percent') { |
  | 1317 | 1299 |  |
  | 1318 | 1300 | $discount\_amt = floatval($value) \* floatval($old\_price) / 100; |
  | 1319 |  | } elseif ($rule['coupon\_discount\_type'] == 'fixed\_cart'){ |
  | 1320 |  | if~~($current\_quantity)~~{ |
  |  | 1301 | } elseif ($rule['coupon\_discount\_type'] == 'fixed\_cart') { |
  |  | 1302 | if ($current\_quantity) { |
  | 1321 | 1303 | if ($do\_not\_execute === true) { |
  | 1322 | 1304 | $discount\_amt = floatval($value); |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1326) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L1308) |  |
  | 1326 | 1308 | } |
  | 1327 | 1309 |  |
  | 1328 |  | } elseif ($rule['coupon\_discount\_type'] == 'fixed\_product'){ |
  |  | 1310 | } elseif ($rule['coupon\_discount\_type'] == 'fixed\_product') { |
  | 1329 | 1311 | $discount\_amt = floatval($old\_price) - floatval($value); |
  | 1330 | 1312 | } else { |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1339) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L1321) |  |
  | 1339 | 1321 | } |
  | 1340 | 1322 |  |
  | 1341 |  | if (!empty($max\_discount) && is\_numeric($max\_discount) && (~~(($discount\_amt \* $cart\_quantity) + $prev\_total\_discount) >= $max\_discount~~)) { |
  | 1342 |  | $discount\_amt = (~~$max\_discount - $prev\_total\_discount~~) / $cart\_quantity; |
  |  | 1323 | if (!empty($max\_discount) && is\_numeric($max\_discount) && ( ( ( $discount\_amt \* $cart\_quantity ) + $prev\_total\_discount ) >= $max\_discount )) { |
  |  | 1324 | $discount\_amt = ( $max\_discount - $prev\_total\_discount ) / $cart\_quantity; |
  | 1343 | 1325 | } |
  | 1344 | 1326 |  |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1348) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L1330) |  |
  | 1348 | 1330 |  |
  | 1349 | 1331 | } |
  | 1350 |  | ~~if($old\_price && $discount\_amt)~~{ |
  | 1351 |  | $new\_price = (float)~~$old\_price - (float)~~$discount\_amt; |
  |  | 1332 | if ($old\_price && $discount\_amt) { |
  |  | 1333 | $new\_price = (float) $old\_price - (float) $discount\_amt; |
  | 1352 | 1334 | } |
  | 1353 | 1335 | if (isset($\_GET['debug']) && $do\_not\_execute == false) { |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1357) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L1339) |  |
  | 1357 | 1339 | if (!empty($rule['discount\_on\_product\_id']) && in\_array($pid, $rule['discount\_on\_product\_id']) && !empty($rule['product\_id'][$pid]) && !empty($xa\_cart\_quantities[$pid]) && $rule['product\_id'][$pid] < $xa\_cart\_quantities[$pid]) { |
  | 1358 | 1340 | $remaining\_qnty = $xa\_cart\_quantities[$pid] - $rule['product\_id'][$pid]; |
  | 1359 |  | $new\_price      =  (~~($new\_price \* $rule['product\_id'][$pid]) + ($old\_price \* $remaining\_qnty)~~) / $xa\_cart\_quantities[$pid]; |
  |  | 1341 | $new\_price      =  ( ( $new\_price \* $rule['product\_id'][$pid] ) + ( $old\_price \* $remaining\_qnty ) ) / $xa\_cart\_quantities[$pid]; |
  | 1360 | 1342 | } |
  | 1361 | 1343 | return $new\_price; |
  | 1362 | 1344 | } |
  | 1363 | 1345 |  |
  | 1364 |  | public function elex\_dp\_SimpleExecute($old\_price, $rule\_no, $rule, $pid = 0, $current\_quantity = 1, $do\_not\_execute = false, $object\_hash = '') |
  | 1365 |  | { |
  |  | 1346 | public function elex\_dp\_SimpleExecute( $old\_price, $rule\_no, $rule, $pid = 0, $current\_quantity = 1, $do\_not\_execute = false, $object\_hash = '') { |
  | 1366 | 1347 | global $xa\_common\_flat\_discount, $xa\_cart\_quantities, $executed\_rule\_pid\_price, $xa\_cart\_categories\_units, $xa\_cart\_categories, $xa\_cart\_price; |
  | 1367 | 1348 | $new\_price           = $old\_price; |
  | 1368 |  | $type\_code           = $rule['rule\_type'] == 'product\_rules'  ?  (~~$rule['rule\_type'] . $pid~~)   :  $rule['rule\_type']; |
  |  | 1349 | $type\_code           = $rule['rule\_type'] == 'product\_rules'  ?  ( $rule['rule\_type'] . $pid )   :  $rule['rule\_type']; |
  | 1369 | 1350 | $cart\_quantity       = 0; |
  | 1370 | 1351 | $prev\_total\_discount = 0; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1386) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L1367) |  |
  | 1386 | 1367 | $rprice               = isset($xa\_cart\_price[$ppid]) ?  $xa\_cart\_price[$ppid] : 0; |
  | 1387 | 1368 | $sprice               = isset($executed\_rule\_pid\_price[$rule['rule\_type'] . ':' . $rule\_no][$ppid]) ?  $executed\_rule\_pid\_price[$rule['rule\_type'] . ':' . $rule\_no][$ppid] : $rprice; |
  | 1388 |  | $prev\_total\_discount += (~~$rprice - $sprice~~) \* $qnty; |
  |  | 1369 | $prev\_total\_discount += ( $rprice - $sprice ) \* $qnty; |
  | 1389 | 1370 | } |
  | 1390 | 1371 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1400) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L1381) |  |
  | 1400 | 1381 | $rprice               = isset($xa\_cart\_price[$ppid]) ?  $xa\_cart\_price[$ppid] : 0; |
  | 1401 | 1382 | $sprice               = isset($executed\_rule\_pid\_price[$rule['rule\_type'] . ':' . $rule\_no][$ppid]) ?  $executed\_rule\_pid\_price[$rule['rule\_type'] . ':' . $rule\_no][$ppid] : $rprice; |
  | 1402 |  | $prev\_total\_discount += (~~$rprice - $sprice~~) \* $units; |
  |  | 1383 | $prev\_total\_discount += ( $rprice - $sprice ) \* $units; |
  | 1403 | 1384 | } |
  | 1404 | 1385 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1420) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L1401) |  |
  | 1420 | 1401 | $discount\_amt = floatval($value) \* floatval($old\_price) / 100; |
  | 1421 | 1402 | } elseif ($discount\_type == 'Flat Discount') { |
  | 1422 |  | if~~($current\_quantity)~~{ |
  |  | 1403 | if ($current\_quantity) { |
  | 1423 | 1404 | if ($do\_not\_execute === true) { |
  | 1424 | 1405 | $discount\_amt = floatval($value); |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1437) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L1418) |  |
  | 1437 | 1418 | } |
  | 1438 | 1419 |  |
  | 1439 |  | if (!empty($max\_discount) && is\_numeric($max\_discount) && (~~(($discount\_amt \* $cart\_quantity) + $prev\_total\_discount) >= $max\_discount~~)) { |
  | 1440 |  | $discount\_amt = (~~$max\_discount - $prev\_total\_discount~~) / $cart\_quantity; |
  |  | 1420 | if (!empty($max\_discount) && is\_numeric($max\_discount) && ( ( ( $discount\_amt \* $cart\_quantity ) + $prev\_total\_discount ) >= $max\_discount )) { |
  |  | 1421 | $discount\_amt = ( $max\_discount - $prev\_total\_discount ) / $cart\_quantity; |
  | 1441 | 1422 | } |
  | 1442 | 1423 |  |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1453) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L1434) |  |
  | 1453 | 1434 | if (!empty($rule['discount\_on\_product\_id']) && in\_array($pid, $rule['discount\_on\_product\_id']) && !empty($rule['product\_id'][$pid]) && !empty($xa\_cart\_quantities[$pid]) && $rule['product\_id'][$pid] < $xa\_cart\_quantities[$pid]) { |
  | 1454 | 1435 | $remaining\_qnty = $xa\_cart\_quantities[$pid] - $rule['product\_id'][$pid]; |
  | 1455 |  | $new\_price      =  (~~($new\_price \* $rule['product\_id'][$pid]) + ($old\_price \* $remaining\_qnty)~~) / $xa\_cart\_quantities[$pid]; |
  |  | 1436 | $new\_price      =  ( ( $new\_price \* $rule['product\_id'][$pid] ) + ( $old\_price \* $remaining\_qnty ) ) / $xa\_cart\_quantities[$pid]; |
  | 1456 | 1437 | } |
  | 1457 | 1438 | ///// adding to cache |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1465) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L1446) |  |
  | 1465 | 1446 | } |
  | 1466 | 1447 |  |
  | 1467 |  | public function elex\_dp\_Simple\_Category\_Combinational\_Execute($old\_price, $rule\_no, $rule, $pid = 0, $current\_quantity = 1, $do\_not\_execute = false, $object\_hash = '') |
  | 1468 |  | { |
  |  | 1448 | public function elex\_dp\_Simple\_Category\_Combinational\_Execute( $old\_price, $rule\_no, $rule, $pid = 0, $current\_quantity = 1, $do\_not\_execute = false, $object\_hash = '') { |
  | 1469 | 1449 | global $xa\_common\_flat\_discount, $xa\_cart\_quantities, $executed\_rule\_pid\_price, $xa\_cart\_categories\_units, $xa\_cart\_categories, $xa\_cart\_price; |
  | 1470 | 1450 | $new\_price           = $old\_price; |
  | 1471 |  | $type\_code           = $rule['rule\_type'] == 'product\_rules'  ?  (~~$rule['rule\_type'] . $pid~~)   :  $rule['rule\_type']; |
  |  | 1451 | $type\_code           = $rule['rule\_type'] == 'product\_rules'  ?  ( $rule['rule\_type'] . $pid )   :  $rule['rule\_type']; |
  | 1472 | 1452 | $prev\_total\_discount = 0; |
  | 1473 | 1453 | $cart\_quantity       = isset($xa\_cart\_quantities[$pid]) ?  $xa\_cart\_quantities[$pid] : 0; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1478) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L1458) |  |
  | 1478 | 1458 | $rprice               = isset($xa\_cart\_price[$ppid]) ?  $xa\_cart\_price[$ppid] : 0; |
  | 1479 | 1459 | $sprice               = isset($executed\_rule\_pid\_price[$rule['rule\_type'] . ':' . $rule\_no][$ppid]) ?  $executed\_rule\_pid\_price[$rule['rule\_type'] . ':' . $rule\_no][$ppid] : $rprice; |
  | 1480 |  | $prev\_total\_discount += (~~$rprice - $sprice~~) \* $qnty; |
  |  | 1460 | $prev\_total\_discount += ( $rprice - $sprice ) \* $qnty; |
  | 1481 | 1461 | } |
  | 1482 | 1462 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1489) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L1469) |  |
  | 1489 | 1469 | $discount\_amt = floatval($value) \* floatval($old\_price) / 100; |
  | 1490 | 1470 | } elseif ($discount\_type == 'Flat Discount') { |
  | 1491 |  | if~~($current\_quantity)~~{ |
  |  | 1471 | if ($current\_quantity) { |
  | 1492 | 1472 | if ($do\_not\_execute === true) { |
  | 1493 | 1473 | $discount\_amt = floatval($value); |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1506) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L1486) |  |
  | 1506 | 1486 | } |
  | 1507 | 1487 |  |
  | 1508 |  | if (!empty($max\_discount) && is\_numeric($max\_discount) && (~~(($discount\_amt \* $cart\_quantity) + $prev\_total\_discount) >= $max\_discount~~)) { |
  | 1509 |  | $discount\_amt = (~~$max\_discount - $prev\_total\_discount~~) / $cart\_quantity; |
  |  | 1488 | if (!empty($max\_discount) && is\_numeric($max\_discount) && ( ( ( $discount\_amt \* $cart\_quantity ) + $prev\_total\_discount ) >= $max\_discount )) { |
  |  | 1489 | $discount\_amt = ( $max\_discount - $prev\_total\_discount ) / $cart\_quantity; |
  | 1510 | 1490 | } |
  | 1511 | 1491 |  |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1522) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L1502) |  |
  | 1522 | 1502 | if (!empty($rule['discount\_on\_product\_id']) && in\_array($pid, $rule['discount\_on\_product\_id']) && !empty($rule['product\_id'][$pid]) && !empty($xa\_cart\_quantities[$pid]) && $rule['product\_id'][$pid] < $xa\_cart\_quantities[$pid]) { |
  | 1523 | 1503 | $remaining\_qnty = $xa\_cart\_quantities[$pid] - $rule['product\_id'][$pid]; |
  | 1524 |  | $new\_price      =  (~~($new\_price \* $rule['product\_id'][$pid]) + ($old\_price \* $remaining\_qnty)~~) / $xa\_cart\_quantities[$pid]; |
  |  | 1504 | $new\_price      =  ( ( $new\_price \* $rule['product\_id'][$pid] ) + ( $old\_price \* $remaining\_qnty ) ) / $xa\_cart\_quantities[$pid]; |
  | 1525 | 1505 | } |
  | 1526 | 1506 | ///// adding to cache |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1534) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L1514) |  |
  | 1534 | 1514 | } |
  | 1535 | 1515 |  |
  | 1536 |  | public function elex\_dp\_Simple\_Combinational\_Execute($old\_price, $rule\_no, $rule, $pid = 0, $current\_quantity = 1, $do\_not\_execute = false, $object\_hash = '') |
  | 1537 |  | { |
  |  | 1516 | public function elex\_dp\_Simple\_Combinational\_Execute( $old\_price, $rule\_no, $rule, $pid = 0, $current\_quantity = 1, $do\_not\_execute = false, $object\_hash = '') { |
  | 1538 | 1517 | global $xa\_common\_flat\_discount, $xa\_cart\_quantities, $executed\_rule\_pid\_price, $xa\_cart\_categories\_units, $xa\_cart\_categories, $xa\_cart\_price; |
  | 1539 | 1518 | $new\_price           = $old\_price; |
  | 1540 |  | $type\_code           = $rule['rule\_type'] == 'product\_rules'  ?  (~~$rule['rule\_type'] . $pid~~)   :  $rule['rule\_type']; |
  |  | 1519 | $type\_code           = $rule['rule\_type'] == 'product\_rules'  ?  ( $rule['rule\_type'] . $pid )   :  $rule['rule\_type']; |
  | 1541 | 1520 | $prev\_total\_discount = 0; |
  | 1542 | 1521 | $cart\_quantity       = isset($xa\_cart\_quantities[$pid]) ?  $xa\_cart\_quantities[$pid] : 0; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1546) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L1525) |  |
  | 1546 | 1525 | $rprice               = isset($xa\_cart\_price[$ppid]) ?  $xa\_cart\_price[$ppid] : 0; |
  | 1547 | 1526 | $sprice               = isset($executed\_rule\_pid\_price[$rule['rule\_type'] . ':' . $rule\_no][$ppid]) ?  $executed\_rule\_pid\_price[$rule['rule\_type'] . ':' . $rule\_no][$ppid] : $rprice; |
  | 1548 |  | $prev\_total\_discount += (~~$rprice - $sprice~~) \* $qnty; |
  |  | 1527 | $prev\_total\_discount += ( $rprice - $sprice ) \* $qnty; |
  | 1549 | 1528 | } |
  | 1550 | 1529 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1557) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L1536) |  |
  | 1557 | 1536 | $discount\_amt = floatval($value) \* floatval($old\_price) / 100; |
  | 1558 | 1537 | } elseif ($discount\_type == 'Flat Discount') { |
  | 1559 |  | if~~($current\_quantity)~~{ |
  |  | 1538 | if ($current\_quantity) { |
  | 1560 | 1539 | if ($do\_not\_execute === true) { |
  | 1561 | 1540 | $discount\_amt = floatval($value); |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1574) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L1553) |  |
  | 1574 | 1553 | } |
  | 1575 | 1554 |  |
  | 1576 |  | if (!empty($max\_discount) && is\_numeric($max\_discount) && (~~(($discount\_amt \* $cart\_quantity) + $prev\_total\_discount) >= $max\_discount~~)) { |
  | 1577 |  | $discount\_amt = (~~$max\_discount - $prev\_total\_discount~~) / $cart\_quantity; |
  |  | 1555 | if (!empty($max\_discount) && is\_numeric($max\_discount) && ( ( ( $discount\_amt \* $cart\_quantity ) + $prev\_total\_discount ) >= $max\_discount )) { |
  |  | 1556 | $discount\_amt = ( $max\_discount - $prev\_total\_discount ) / $cart\_quantity; |
  | 1578 | 1557 | } |
  | 1579 | 1558 |  |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1591) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L1570) |  |
  | 1591 | 1570 | // removed this code to make restrictions work for any quantity |
  | 1592 | 1571 | //$remaining\_qnty=$xa\_cart\_quantities[$pid]-$rule['product\_id'][$pid]; |
  | 1593 |  | $new\_price =  (~~$new\_price \* $rule['product\_id'][$pid]~~); // + ($old\_price \* $remaining\_qnty ))/$xa\_cart\_quantities[$pid]; |
  |  | 1572 | $new\_price =  ( $new\_price \* $rule['product\_id'][$pid] ); // + ($old\_price \* $remaining\_qnty ))/$xa\_cart\_quantities[$pid]; |
  | 1594 | 1573 | } |
  | 1595 | 1574 | ///// adding to cache |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1604) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L1583) |  |
  | 1604 | 1583 |  |
  | 1605 | 1584 |  |
  | 1606 |  | public function elex\_dp\_Simple\_Cart\_Execute($old\_price, $rule\_no, $rule, $pid = 0, $current\_quantity = 1, $do\_not\_execute = false, $object\_hash = '') |
  | 1607 |  | { |
  |  | 1585 | public function elex\_dp\_Simple\_Cart\_Execute( $old\_price, $rule\_no, $rule, $pid = 0, $current\_quantity = 1, $do\_not\_execute = false, $object\_hash = '') { |
  | 1608 | 1586 | global $xa\_common\_flat\_discount, $xa\_cart\_quantities, $executed\_rule\_pid\_price, $xa\_cart\_categories\_units, $xa\_cart\_categories, $xa\_cart\_price; |
  | 1609 | 1587 | $new\_price           = $old\_price; |
  | 1610 |  | $type\_code           = $rule['rule\_type'] == 'product\_rules'  ?  (~~$rule['rule\_type'] . $pid~~)   :  $rule['rule\_type']; |
  |  | 1588 | $type\_code           = $rule['rule\_type'] == 'product\_rules'  ?  ( $rule['rule\_type'] . $pid )   :  $rule['rule\_type']; |
  | 1611 | 1589 | $cart\_quantity       = 0; |
  | 1612 | 1590 | $prev\_total\_discount = 0; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1617) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L1595) |  |
  | 1617 | 1595 | $rprice               = isset($xa\_cart\_price[$ppid]) ?  $xa\_cart\_price[$ppid] : 0; |
  | 1618 | 1596 | $sprice               = isset($executed\_rule\_pid\_price[$rule['rule\_type'] . ':' . $rule\_no][$ppid]) ?  $executed\_rule\_pid\_price[$rule['rule\_type'] . ':' . $rule\_no][$ppid] : $rprice; |
  | 1619 |  | $prev\_total\_discount += (~~$rprice - $sprice~~) \* $qnty; |
  |  | 1597 | $prev\_total\_discount += ( $rprice - $sprice ) \* $qnty; |
  | 1620 | 1598 | } |
  | 1621 | 1599 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1629) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L1607) |  |
  | 1629 | 1607 | $discount\_amt = floatval($value) \* floatval($old\_price) / 100; |
  | 1630 | 1608 | } elseif ($discount\_type == 'Flat Discount') { |
  | 1631 |  | if~~($current\_quantity)~~{ |
  |  | 1609 | if ($current\_quantity) { |
  | 1632 | 1610 | if ($do\_not\_execute === true) { |
  | 1633 | 1611 | $discount\_amt = floatval($value); |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1646) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L1624) |  |
  | 1646 | 1624 | } |
  | 1647 | 1625 |  |
  | 1648 |  | if (!empty($max\_discount) && is\_numeric($max\_discount) && (~~(($discount\_amt \* $cart\_quantity) + $prev\_total\_discount) >= $max\_discount~~)) { |
  | 1649 |  | $discount\_amt = (~~$max\_discount - $prev\_total\_discount~~) / $cart\_quantity; |
  |  | 1626 | if (!empty($max\_discount) && is\_numeric($max\_discount) && ( ( ( $discount\_amt \* $cart\_quantity ) + $prev\_total\_discount ) >= $max\_discount )) { |
  |  | 1627 | $discount\_amt = ( $max\_discount - $prev\_total\_discount ) / $cart\_quantity; |
  | 1650 | 1628 | } |
  | 1651 | 1629 |  |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1661) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L1639) |  |
  | 1661 | 1639 | if (!empty($rule['discount\_on\_product\_id']) && in\_array($pid, $rule['discount\_on\_product\_id']) && !empty($rule['product\_id'][$pid]) && !empty($xa\_cart\_quantities[$pid]) && $rule['product\_id'][$pid] < $xa\_cart\_quantities[$pid]) { |
  | 1662 | 1640 | $remaining\_qnty = $xa\_cart\_quantities[$pid] - $rule['product\_id'][$pid]; |
  | 1663 |  | $new\_price      =  (~~($new\_price \* $rule['product\_id'][$pid]) + ($old\_price \* $remaining\_qnty)~~) / $xa\_cart\_quantities[$pid]; |
  |  | 1641 | $new\_price      =  ( ( $new\_price \* $rule['product\_id'][$pid] ) + ( $old\_price \* $remaining\_qnty ) ) / $xa\_cart\_quantities[$pid]; |
  | 1664 | 1642 | } |
  | 1665 | 1643 | ///// adding to cache |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1674) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L1652) |  |
  | 1674 | 1652 |  |
  | 1675 | 1653 |  |
  | 1676 |  | public function elex\_dp\_Simple\_Category\_Execute($old\_price, $rule\_no, $rule, $pid = 0, $current\_quantity = 1, $do\_not\_execute = false, $object\_hash = '') |
  | 1677 |  | { |
  |  | 1654 | public function elex\_dp\_Simple\_Category\_Execute( $old\_price, $rule\_no, $rule, $pid = 0, $current\_quantity = 1, $do\_not\_execute = false, $object\_hash = '') { |
  | 1678 | 1655 | global $xa\_common\_flat\_discount, $xa\_cart\_quantities, $executed\_rule\_pid\_price, $xa\_cart\_categories\_units, $xa\_cart\_categories, $xa\_cart\_price; |
  | 1679 | 1656 | $new\_price           = $old\_price; |
  | 1680 |  | $type\_code           = $rule['rule\_type'] == 'product\_rules'  ?  (~~$rule['rule\_type'] . $pid~~)   :  $rule['rule\_type']; |
  |  | 1657 | $type\_code           = $rule['rule\_type'] == 'product\_rules'  ?  ( $rule['rule\_type'] . $pid )   :  $rule['rule\_type']; |
  | 1681 | 1658 | $cart\_quantity       = 0; |
  | 1682 | 1659 | $prev\_total\_discount = 0; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1694) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L1671) |  |
  | 1694 | 1671 | $rprice               = isset($xa\_cart\_price[$ppid]) ?  $xa\_cart\_price[$ppid] : 0; |
  | 1695 | 1672 | $sprice               = isset($executed\_rule\_pid\_price[$rule['rule\_type'] . ':' . $rule\_no][$ppid]) ?  $executed\_rule\_pid\_price[$rule['rule\_type'] . ':' . $rule\_no][$ppid] : $rprice; |
  | 1696 |  | $prev\_total\_discount += (~~$rprice - $sprice~~) \* $units; |
  |  | 1673 | $prev\_total\_discount += ( $rprice - $sprice ) \* $units; |
  | 1697 | 1674 | } |
  | 1698 | 1675 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1710) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L1687) |  |
  | 1710 | 1687 | $discount\_amt = floatval($value) \* floatval($old\_price) / 100; |
  | 1711 | 1688 | } elseif ($discount\_type == 'Flat Discount') { |
  | 1712 |  | if~~($current\_quantity)~~{ |
  |  | 1689 | if ($current\_quantity) { |
  | 1713 | 1690 | if ($do\_not\_execute === true) { |
  | 1714 | 1691 | $discount\_amt = floatval($value); |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1723) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L1700) |  |
  | 1723 | 1700 | } |
  | 1724 | 1701 |  |
  | 1725 |  | if (!empty($max\_discount) && is\_numeric($max\_discount) && (~~(($discount\_amt \* $cart\_quantity) + $prev\_total\_discount) >= $max\_discount~~)) { |
  | 1726 |  | $discount\_amt = (~~$max\_discount - $prev\_total\_discount~~) / $cart\_quantity; |
  |  | 1702 | if (!empty($max\_discount) && is\_numeric($max\_discount) && ( ( ( $discount\_amt \* $cart\_quantity ) + $prev\_total\_discount ) >= $max\_discount )) { |
  |  | 1703 | $discount\_amt = ( $max\_discount - $prev\_total\_discount ) / $cart\_quantity; |
  | 1727 | 1704 | } |
  | 1728 | 1705 |  |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1738) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L1715) |  |
  | 1738 | 1715 | if (!empty($rule['discount\_on\_product\_id']) && in\_array($pid, $rule['discount\_on\_product\_id']) && !empty($rule['product\_id'][$pid]) && !empty($xa\_cart\_quantities[$pid]) && $rule['product\_id'][$pid] < $xa\_cart\_quantities[$pid]) { |
  | 1739 | 1716 | $remaining\_qnty = $xa\_cart\_quantities[$pid] - $rule['product\_id'][$pid]; |
  | 1740 |  | $new\_price      =  (~~($new\_price \* $rule['product\_id'][$pid]) + ($old\_price \* $remaining\_qnty)~~) / $xa\_cart\_quantities[$pid]; |
  |  | 1717 | $new\_price      =  ( ( $new\_price \* $rule['product\_id'][$pid] ) + ( $old\_price \* $remaining\_qnty ) ) / $xa\_cart\_quantities[$pid]; |
  | 1741 | 1718 | } |
  | 1742 | 1719 | ///// adding to cache |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1750) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L1727) |  |
  | 1750 | 1727 | } |
  | 1751 | 1728 |  |
  | 1752 |  | public function elex\_dp\_Simple\_Tag\_Execute($old\_price, $rule\_no, $rule, $pid = 0, $current\_quantity = 1, $do\_not\_execute = false, $object\_hash = '') |
  | 1753 |  | { |
  |  | 1729 | public function elex\_dp\_Simple\_Tag\_Execute( $old\_price, $rule\_no, $rule, $pid = 0, $current\_quantity = 1, $do\_not\_execute = false, $object\_hash = '') { |
  | 1754 | 1730 | global $xa\_common\_flat\_discount, $xa\_cart\_quantities, $executed\_rule\_pid\_price, $xa\_cart\_tags\_units, $xa\_cart\_tags, $xa\_cart\_price; |
  | 1755 | 1731 | $new\_price           = $old\_price; |
  | 1756 |  | $type\_code           = $rule['rule\_type'] == 'product\_rules'  ?  (~~$rule['rule\_type'] . $pid~~)   :  $rule['rule\_type']; |
  |  | 1732 | $type\_code           = $rule['rule\_type'] == 'product\_rules'  ?  ( $rule['rule\_type'] . $pid )   :  $rule['rule\_type']; |
  | 1757 | 1733 | $cart\_quantity       = 0; |
  | 1758 | 1734 | $prev\_total\_discount = 0; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1770) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L1746) |  |
  | 1770 | 1746 | $rprice               = isset($xa\_cart\_price[$ppid]) ?  $xa\_cart\_price[$ppid] : 0; |
  | 1771 | 1747 | $sprice               = isset($executed\_rule\_pid\_price[$rule['rule\_type'] . ':' . $rule\_no][$ppid]) ?  $executed\_rule\_pid\_price[$rule['rule\_type'] . ':' . $rule\_no][$ppid] : $rprice; |
  | 1772 |  | $prev\_total\_discount += (~~$rprice - $sprice~~) \* $units; |
  |  | 1748 | $prev\_total\_discount += ( $rprice - $sprice ) \* $units; |
  | 1773 | 1749 | } |
  | 1774 | 1750 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1786) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L1762) |  |
  | 1786 | 1762 | $discount\_amt = floatval($value) \* floatval($old\_price) / 100; |
  | 1787 | 1763 | } elseif ($discount\_type == 'Flat Discount') { |
  | 1788 |  | if~~($current\_quantity)~~{ |
  |  | 1764 | if ($current\_quantity) { |
  | 1789 | 1765 | if ($do\_not\_execute === true) { |
  | 1790 | 1766 | $discount\_amt = floatval($value); |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1799) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L1775) |  |
  | 1799 | 1775 | } |
  | 1800 | 1776 |  |
  | 1801 |  | if (!empty($max\_discount) && is\_numeric($max\_discount) && (~~(($discount\_amt \* $cart\_quantity) + $prev\_total\_discount) >= $max\_discount~~)) { |
  | 1802 |  | $discount\_amt = (~~$max\_discount - $prev\_total\_discount~~) / $cart\_quantity; |
  |  | 1777 | if (!empty($max\_discount) && is\_numeric($max\_discount) && ( ( ( $discount\_amt \* $cart\_quantity ) + $prev\_total\_discount ) >= $max\_discount )) { |
  |  | 1778 | $discount\_amt = ( $max\_discount - $prev\_total\_discount ) / $cart\_quantity; |
  | 1803 | 1779 | } |
  | 1804 | 1780 |  |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1814) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L1790) |  |
  | 1814 | 1790 | if (!empty($rule['discount\_on\_product\_id']) && in\_array($pid, $rule['discount\_on\_product\_id']) && !empty($rule['product\_id'][$pid]) && !empty($xa\_cart\_quantities[$pid]) && $rule['product\_id'][$pid] < $xa\_cart\_quantities[$pid]) { |
  | 1815 | 1791 | $remaining\_qnty = $xa\_cart\_quantities[$pid] - $rule['product\_id'][$pid]; |
  | 1816 |  | $new\_price      =  (~~($new\_price \* $rule['product\_id'][$pid]) + ($old\_price \* $remaining\_qnty)~~) / $xa\_cart\_quantities[$pid]; |
  |  | 1792 | $new\_price      =  ( ( $new\_price \* $rule['product\_id'][$pid] ) + ( $old\_price \* $remaining\_qnty ) ) / $xa\_cart\_quantities[$pid]; |
  | 1817 | 1793 | } |
  | 1818 | 1794 | ///// adding to cache |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1826) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L1802) |  |
  | 1826 | 1802 | } |
  | 1827 | 1803 |  |
  | 1828 |  | public function elex\_dp\_ExecuteBOGORule($old\_price, $rule\_no, $rule, $pid = 0, $current\_quantity = 1) |
  | 1829 |  | { |
  |  | 1804 | public function elex\_dp\_ExecuteBOGORule( $old\_price, $rule\_no, $rule, $pid = 0, $current\_quantity = 1) { |
  | 1830 | 1805 | global $xa\_dp\_setting; |
  | 1831 | 1806 | global $woocommerce; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1844) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L1819) |  |
  | 1844 | 1819 | foreach ($rule['purchased\_product\_id'] as $\_pid => $\_qnty) { |
  | 1845 | 1820 | if (!empty($xa\_cart\_quantities[$\_pid]) && !empty($\_qnty) && $xa\_cart\_quantities[$\_pid] > $\_qnty) { |
  | 1846 |  | $tmp = (int) (~~$xa\_cart\_quantities[$\_pid] / $\_qnty~~); |
  |  | 1821 | $tmp = (int) ( $xa\_cart\_quantities[$\_pid] / $\_qnty ); |
  | 1847 | 1822 | if ($tmp > 1 && $tmp < $multiple) { |
  | 1848 | 1823 | $multiple = $tmp; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1859) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L1834) |  |
  | 1859 | 1834 | } |
  | 1860 | 1835 | if ($total\_childs\_qty\_in\_cart) { |
  | 1861 |  | $tmp = (int) (~~$total\_childs\_qty\_in\_cart / $\_qnty~~); |
  |  | 1836 | $tmp = (int) ( $total\_childs\_qty\_in\_cart / $\_qnty ); |
  | 1862 | 1837 | if ($tmp > 1 && $tmp < $multiple) { |
  | 1863 | 1838 | $multiple = $tmp; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1873) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L1848) |  |
  | 1873 | 1848 |  |
  | 1874 | 1849 | //If free product is set |
  | 1875 |  | if (!isset($rule['set\_free\_option']) || (~~isset($rule['set\_free\_option']) && $rule['set\_free\_option'] == 'select\_product'~~)) { |
  |  | 1850 | if (!isset($rule['set\_free\_option']) || ( isset($rule['set\_free\_option']) && $rule['set\_free\_option'] == 'select\_product' )) { |
  | 1876 | 1851 |  |
  | 1877 | 1852 | ////////if free product is already in cart with exact quanitty this code will set its price as zero |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1888) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L1863) |  |
  | 1888 | 1863 | $free\_unit = $free\_unit > $unit ? $unit : $free\_unit; |
  | 1889 | 1864 |  |
  | 1890 |  | if~~(array\_key\_exists($pid, $rule['purchased\_product\_id']) && array\_key\_exists($pid, $rule['free\_product\_id']))~~{ |
  | 1891 |  | if~~($free\_unit >= $unit)~~{ |
  | 1892 |  | $free\_unit = $unit - (int)$rule['purchased\_product\_id'][$pid]; |
  | 1893 |  | }~~else~~{ |
  | 1894 |  | $free\_unit = (~~$rule['free\_product\_id'][$pid]~~); |
  | 1895 |  | } |
  | 1896 |  | } |
  | 1897 |  | if ($all\_free\_product\_present == true && (~~is\_cart() || is\_ajax() || is\_checkout()~~)) { |
  |  | 1865 | if (array\_key\_exists($pid, $rule['purchased\_product\_id']) && array\_key\_exists($pid, $rule['free\_product\_id'])) { |
  |  | 1866 | if ($free\_unit >= $unit) { |
  |  | 1867 | $free\_unit = $unit - (int) $rule['purchased\_product\_id'][$pid]; |
  |  | 1868 | } else { |
  |  | 1869 | $free\_unit = ( $rule['free\_product\_id'][$pid] ); |
  |  | 1870 | } |
  |  | 1871 | } |
  |  | 1872 | if ($all\_free\_product\_present == true && ( is\_cart() || is\_ajax() || is\_checkout() )) { |
  | 1898 | 1873 | $total\_adjustment\_price = 0; |
  | 1899 | 1874 | if (isset($adjustment) && is\_numeric($adjustment)) { |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1906) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L1881) |  |
  | 1906 | 1881 | $total\_adjustment\_price = 0; |
  | 1907 | 1882 | } |
  | 1908 |  | if ((~~$unit - (float) $free\_unit \* $multiple~~) < 0) { //to make repeat rule work with auto add disabled |
  |  | 1883 | if (( $unit - (float) $free\_unit \* $multiple ) < 0) { //to make repeat rule work with auto add disabled |
  | 1909 | 1884 | $total\_old\_price = 0; |
  | 1910 | 1885 | } else { |
  | 1911 |  | $total\_old\_price = $old\_price \* (~~$unit - (float) $free\_unit \* $multiple~~); |
  |  | 1886 | $total\_old\_price = $old\_price \* ( $unit - (float) $free\_unit \* $multiple ); |
  | 1912 | 1887 | } |
  | 1913 | 1888 | if ($xa\_dp\_setting['auto\_add\_free\_product\_on\_off'] == 'on') { |
  | 1914 | 1889 | return  $old\_price; |
  | 1915 | 1890 | } else { |
  | 1916 |  | return (~~($total\_old\_price + $total\_adjustment\_price) / $unit~~); |
  |  | 1891 | return ( ( $total\_old\_price + $total\_adjustment\_price ) / $unit ); |
  | 1917 | 1892 | } |
  | 1918 | 1893 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1977) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L1952) |  |
  | 1977 | 1952 |  |
  | 1978 | 1953 |  |
  | 1979 |  | if ((~~$pid == $product\_tosetfree~~)) { |
  |  | 1954 | if (( $pid == $product\_tosetfree )) { |
  | 1980 | 1955 |  |
  | 1981 | 1956 | $unit      = isset($xa\_cart\_quantities[$product\_tosetfree]) ? $xa\_cart\_quantities[$product\_tosetfree] : 1; |
  | 1982 | 1957 | $free\_unit = $cheapest\_product\_quantity > $unit ? $unit : $cheapest\_product\_quantity; |
  | 1983 | 1958 |  |
  | 1984 |  | if~~(array\_key\_exists($pid, $rule['purchased\_product\_id']))~~{ |
  | 1985 |  | if~~($cheapest\_product\_quantity >= $unit)~~{ |
  | 1986 |  | $free\_unit = $unit - (int)$rule['purchased\_product\_id'][$pid]; |
  | 1987 |  | }~~else~~{ |
  |  | 1959 | if (array\_key\_exists($pid, $rule['purchased\_product\_id'])) { |
  |  | 1960 | if ($cheapest\_product\_quantity >= $unit) { |
  |  | 1961 | $free\_unit = $unit - (int) $rule['purchased\_product\_id'][$pid]; |
  |  | 1962 | } else { |
  | 1988 | 1963 | $free\_unit = $cheapest\_product\_quantity ; |
  | 1989 | 1964 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1994) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L1969) |  |
  | 1994 | 1969 | } |
  | 1995 | 1970 |  |
  | 1996 |  | if ($all\_free\_product\_present == true && (~~is\_cart() || is\_ajax() || is\_checkout()~~)) { |
  |  | 1971 | if ($all\_free\_product\_present == true && ( is\_cart() || is\_ajax() || is\_checkout() )) { |
  | 1997 | 1972 | $total\_adjustment\_price = 0; |
  | 1998 | 1973 | if (isset($adjustment) && is\_numeric($adjustment)) { |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L2005) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L1980) |  |
  | 2005 | 1980 | $total\_adjustment\_price = 0; |
  | 2006 | 1981 | } |
  | 2007 |  | if ((~~$unit - (float) $free\_unit \* $multiple~~) < 0) { //to make repeat rule work with auto add disabled |
  |  | 1982 | if (( $unit - (float) $free\_unit \* $multiple ) < 0) { //to make repeat rule work with auto add disabled |
  | 2008 | 1983 | $total\_old\_price = 0; |
  | 2009 | 1984 | } else { |
  | 2010 |  | $total\_old\_price = $old\_price \* (~~$unit - (float) $free\_unit \* $multiple~~); |
  | 2011 |  | } |
  | 2012 |  | return (~~($total\_old\_price + $total\_adjustment\_price) / $unit~~); |
  |  | 1985 | $total\_old\_price = $old\_price \* ( $unit - (float) $free\_unit \* $multiple ); |
  |  | 1986 | } |
  |  | 1987 | return ( ( $total\_old\_price + $total\_adjustment\_price ) / $unit ); |
  | 2013 | 1988 | } |
  | 2014 | 1989 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L2029) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L2004) |  |
  | 2029 | 2004 | return $old\_price; |
  | 2030 | 2005 | } |
  | 2031 |  | public function elex\_dp\_ExecuteBOGO\_category\_Rule($old\_price, $rule\_no, $rule, $pid = 0, $current\_quantity = 1) |
  | 2032 |  | { |
  |  | 2006 | public function elex\_dp\_ExecuteBOGO\_category\_Rule( $old\_price, $rule\_no, $rule, $pid = 0, $current\_quantity = 1) { |
  | 2033 | 2007 | global $xa\_dp\_setting; |
  | 2034 | 2008 | global $woocommerce; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L2047) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L2021) |  |
  | 2047 | 2021 |  |
  | 2048 | 2022 | //If free product is set |
  | 2049 |  | if (!isset($rule['set\_free\_option']) || (~~isset($rule['set\_free\_option']) && $rule['set\_free\_option'] == 'select\_product'~~)) { |
  |  | 2023 | if (!isset($rule['set\_free\_option']) || ( isset($rule['set\_free\_option']) && $rule['set\_free\_option'] == 'select\_product' )) { |
  | 2050 | 2024 |  |
  | 2051 | 2025 | ////////if free product is already in cart with exact quanitty this code will set its price as zero |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L2066) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L2040) |  |
  | 2066 | 2040 | foreach ($rule['purchased\_category\_id'] as $\_cid => $\_qnty\_and\_checkon) { |
  | 2067 | 2041 |  |
  | 2068 |  | if ((~~array\_key\_exists($pid, $rule['free\_product\_id'])) && in\_array($\_cid, $product\_categories) && !($xa\_cart\_categories\_items[$\_cid] > 1~~)) { |
  |  | 2042 | if (( array\_key\_exists($pid, $rule['free\_product\_id']) ) && in\_array($\_cid, $product\_categories) && !( $xa\_cart\_categories\_items[$\_cid] > 1 )) { |
  | 2069 | 2043 | $add\_if\_not\_auto = $add\_if\_not\_auto + 1; |
  | 2070 | 2044 | } |
  | 2071 | 2045 | } |
  | 2072 |  | if~~($add\_if\_not\_auto > 0)~~{ |
  | 2073 |  | if~~($free\_unit >= $unit)~~{ |
  |  | 2046 | if ($add\_if\_not\_auto > 0) { |
  |  | 2047 | if ($free\_unit >= $unit) { |
  | 2074 | 2048 | $free\_unit = $unit - 1; |
  | 2075 | 2049 | } |
  | 2076 | 2050 | } |
  | 2077 | 2051 |  |
  | 2078 |  | if ($all\_free\_product\_present == true && (~~is\_cart() || is\_checkout()~~)) { |
  |  | 2052 | if ($all\_free\_product\_present == true && ( is\_cart() || is\_checkout() )) { |
  | 2079 | 2053 | $total\_adjustment\_price = 0; |
  | 2080 | 2054 | if (isset($adjustment) && is\_numeric($adjustment)) { |
  | 2081 | 2055 | $total\_adjustment\_price = $adjustment \* $free\_unit; |
  | 2082 | 2056 | } |
  | 2083 |  | $total\_old\_price = $old\_price \* (~~$unit - (float) $free\_unit~~); |
  |  | 2057 | $total\_old\_price = $old\_price \* ( $unit - (float) $free\_unit ); |
  | 2084 | 2058 | if ($xa\_dp\_setting['auto\_add\_free\_product\_on\_off'] == 'on') { |
  | 2085 | 2059 | return  $old\_price; |
  | 2086 | 2060 | } else { |
  | 2087 |  | return (~~($total\_old\_price + $total\_adjustment\_price)~~) / $unit; |
  |  | 2061 | return ( ( $total\_old\_price + $total\_adjustment\_price ) ) / $unit; |
  | 2088 | 2062 | } |
  | 2089 | 2063 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L2141) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L2115) |  |
  | 2141 | 2115 |  |
  | 2142 | 2116 | ////////if free product is already in cart with exact quanitty this code will set its price as zero |
  | 2143 |  | if ((~~$pid == $product\_tosetfree~~)) { |
  |  | 2117 | if (( $pid == $product\_tosetfree )) { |
  | 2144 | 2118 |  |
  | 2145 | 2119 | $product\_categories = !empty($xa\_cart\_categories[$pid]) ? $xa\_cart\_categories[$pid] : array(); |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L2148) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L2122) |  |
  | 2148 | 2122 | foreach ($rule['purchased\_category\_id'] as $\_cid => $\_qnty\_and\_checkon) { |
  | 2149 | 2123 |  |
  | 2150 |  | if ((~~$pid == $product\_tosetfree) && in\_array($\_cid, $product\_categories) && !($xa\_cart\_categories\_items[$\_cid] > 1~~)) { |
  |  | 2124 | if (( $pid == $product\_tosetfree ) && in\_array($\_cid, $product\_categories) && !( $xa\_cart\_categories\_items[$\_cid] > 1 )) { |
  | 2151 | 2125 | $add\_if\_not\_auto = $add\_if\_not\_auto + 1; |
  | 2152 | 2126 | } |
  | 2153 | 2127 | } |
  | 2154 |  | if~~($add\_if\_not\_auto > 0)~~{ |
  | 2155 |  | if~~($cheapest\_product\_quantity >= $unit)~~{ |
  |  | 2128 | if ($add\_if\_not\_auto > 0) { |
  |  | 2129 | if ($cheapest\_product\_quantity >= $unit) { |
  | 2156 | 2130 | $free\_unit = $unit - 1; |
  | 2157 |  | }~~else~~{ |
  |  | 2131 | } else { |
  | 2158 | 2132 | $free\_unit = $cheapest\_product\_quantity ; |
  | 2159 | 2133 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L2164) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L2138) |  |
  | 2164 | 2138 | } |
  | 2165 | 2139 |  |
  | 2166 |  | if ($all\_free\_product\_present == true && (~~is\_cart() || is\_checkout()~~)) { |
  |  | 2140 | if ($all\_free\_product\_present == true && ( is\_cart() || is\_checkout() )) { |
  | 2167 | 2141 |  |
  | 2168 | 2142 | $total\_adjustment\_price = 0; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L2171) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L2145) |  |
  | 2171 | 2145 | } |
  | 2172 | 2146 |  |
  | 2173 |  | $total\_old\_price = $old\_price \* (~~$unit - (float) $free\_unit~~); |
  | 2174 |  |  |
  | 2175 |  | return (~~($total\_old\_price + $total\_adjustment\_price)~~) / $unit; |
  |  | 2147 | $total\_old\_price = $old\_price \* ( $unit - (float) $free\_unit ); |
  |  | 2148 |  |
  |  | 2149 | return ( ( $total\_old\_price + $total\_adjustment\_price ) ) / $unit; |
  | 2176 | 2150 | } |
  | 2177 | 2151 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L2185) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L2159) |  |
  | 2185 | 2159 | } |
  | 2186 | 2160 |  |
  | 2187 |  | public function elex\_dp\_Executebogo\_tag\_rules($old\_price, $rule\_no, $rule, $pid = 0, $current\_quantity = 1) |
  | 2188 |  | { |
  |  | 2161 | public function elex\_dp\_Executebogo\_tag\_rules( $old\_price, $rule\_no, $rule, $pid = 0, $current\_quantity = 1) { |
  | 2189 | 2162 | global $xa\_dp\_setting; |
  | 2190 | 2163 | global $woocommerce; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L2217) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L2190) |  |
  | 2217 | 2190 | } |
  | 2218 | 2191 | if ($count != 0) { |
  | 2219 |  | $tmp = (int) (~~$count / $\_qnty~~); |
  |  | 2192 | $tmp = (int) ( $count / $\_qnty ); |
  | 2220 | 2193 | if ($tmp > 1 && $tmp < $multiple) { |
  | 2221 | 2194 | $multiple = $tmp; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L2231) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L2204) |  |
  | 2231 | 2204 |  |
  | 2232 | 2205 | if ($total\_items\_with\_tag != 0) { |
  | 2233 |  | $tmp = (int) (~~$total\_items\_with\_tag / $\_qnty~~); |
  |  | 2206 | $tmp = (int) ( $total\_items\_with\_tag / $\_qnty ); |
  | 2234 | 2207 | if ($tmp > 1 && $tmp < $multiple) { |
  | 2235 | 2208 | $multiple = $tmp; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L2244) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L2217) |  |
  | 2244 | 2217 |  |
  | 2245 | 2218 | //If free product is set |
  | 2246 |  | if (!isset($rule['set\_free\_option']) || (~~isset($rule['set\_free\_option']) && $rule['set\_free\_option'] == 'select\_product'~~)) { |
  |  | 2219 | if (!isset($rule['set\_free\_option']) || ( isset($rule['set\_free\_option']) && $rule['set\_free\_option'] == 'select\_product' )) { |
  | 2247 | 2220 |  |
  | 2248 | 2221 | ////////if free product is already in cart with exact quanitty this code will set its price as zero |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L2263) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L2236) |  |
  | 2263 | 2236 | foreach ($rule['purchased\_tag\_id'] as $\_cid => $\_qnty\_and\_checkon) { |
  | 2264 | 2237 |  |
  | 2265 |  | if ((~~array\_key\_exists($pid, $rule['free\_product\_id'])) && in\_array($\_cid, $product\_tags) && !($xa\_cart\_tags\_items[$\_cid] > 1~~)) { |
  |  | 2238 | if (( array\_key\_exists($pid, $rule['free\_product\_id']) ) && in\_array($\_cid, $product\_tags) && !( $xa\_cart\_tags\_items[$\_cid] > 1 )) { |
  | 2266 | 2239 | $add\_if\_not\_auto = $add\_if\_not\_auto + 1; |
  | 2267 | 2240 | } |
  | 2268 | 2241 |  |
  | 2269 | 2242 | } |
  | 2270 |  | if~~($add\_if\_not\_auto > 0)~~{ |
  | 2271 |  | if~~($free\_unit >= $unit)~~{ |
  |  | 2243 | if ($add\_if\_not\_auto > 0) { |
  |  | 2244 | if ($free\_unit >= $unit) { |
  | 2272 | 2245 | $free\_unit = $unit - 1; |
  | 2273 | 2246 | } |
  | 2274 | 2247 | } |
  | 2275 | 2248 |  |
  | 2276 |  | if ($all\_free\_product\_present == true && (~~is\_cart() || is\_checkout()~~)) { |
  |  | 2249 | if ($all\_free\_product\_present == true && ( is\_cart() || is\_checkout() )) { |
  | 2277 | 2250 | $total\_adjustment\_price = 0; |
  | 2278 | 2251 | if (isset($adjustment) && is\_numeric($adjustment)) { |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L2285) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L2258) |  |
  | 2285 | 2258 | $total\_adjustment\_price = 0; |
  | 2286 | 2259 | } |
  | 2287 |  | if ((~~$unit - (float) $free\_unit \* $multiple~~) < 0) { //to make repeat rule work with auto add disabled |
  |  | 2260 | if (( $unit - (float) $free\_unit \* $multiple ) < 0) { //to make repeat rule work with auto add disabled |
  | 2288 | 2261 | $total\_old\_price = 0; |
  | 2289 | 2262 | } else { |
  | 2290 |  | $total\_old\_price = $old\_price \* (~~$unit - (float) $free\_unit \* $multiple~~); |
  |  | 2263 | $total\_old\_price = $old\_price \* ( $unit - (float) $free\_unit \* $multiple ); |
  | 2291 | 2264 | } |
  | 2292 | 2265 | if ($xa\_dp\_setting['auto\_add\_free\_product\_on\_off'] == 'on') { |
  | 2293 | 2266 | return  $old\_price; |
  | 2294 | 2267 | } else { |
  | 2295 |  | return (~~($total\_old\_price + $total\_adjustment\_price)~~) / $unit; |
  |  | 2268 | return ( ( $total\_old\_price + $total\_adjustment\_price ) ) / $unit; |
  | 2296 | 2269 | } |
  | 2297 | 2270 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L2349) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L2322) |  |
  | 2349 | 2322 |  |
  | 2350 | 2323 | ////////if free product is already in cart with exact quanitty this code will set its price as zero |
  | 2351 |  | if ((~~$pid == $product\_tosetfree~~)) { |
  |  | 2324 | if (( $pid == $product\_tosetfree )) { |
  | 2352 | 2325 |  |
  | 2353 | 2326 | $product\_tags = !empty($xa\_cart\_tags[$pid]) ? $xa\_cart\_tags[$pid] : array(); |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L2356) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L2329) |  |
  | 2356 | 2329 | foreach ($rule['purchased\_tag\_id'] as $\_cid => $\_qnty\_and\_checkon) { |
  | 2357 | 2330 |  |
  | 2358 |  | if ((~~$pid == $product\_tosetfree) && in\_array($\_cid, $product\_tags) && !($xa\_cart\_tags\_items[$\_cid] > 1~~)) { |
  |  | 2331 | if (( $pid == $product\_tosetfree ) && in\_array($\_cid, $product\_tags) && !( $xa\_cart\_tags\_items[$\_cid] > 1 )) { |
  | 2359 | 2332 | $add\_if\_not\_auto = $add\_if\_not\_auto + 1; |
  | 2360 | 2333 | } |
  | 2361 | 2334 | } |
  | 2362 |  | if~~($add\_if\_not\_auto > 0)~~{ |
  | 2363 |  | if~~($cheapest\_product\_quantity >= $unit)~~{ |
  |  | 2335 | if ($add\_if\_not\_auto > 0) { |
  |  | 2336 | if ($cheapest\_product\_quantity >= $unit) { |
  | 2364 | 2337 | $free\_unit = $unit - 1; |
  | 2365 |  | }~~else~~{ |
  |  | 2338 | } else { |
  | 2366 | 2339 | $free\_unit = $cheapest\_product\_quantity ; |
  | 2367 | 2340 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L2373) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L2346) |  |
  | 2373 | 2346 |  |
  | 2374 | 2347 |  |
  | 2375 |  | if ($all\_free\_product\_present == true && (~~is\_cart() || is\_checkout()~~)) { |
  |  | 2348 | if ($all\_free\_product\_present == true && ( is\_cart() || is\_checkout() )) { |
  | 2376 | 2349 |  |
  | 2377 | 2350 | $total\_adjustment\_price = 0; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L2385) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L2358) |  |
  | 2385 | 2358 | $total\_adjustment\_price = 0; |
  | 2386 | 2359 | } |
  | 2387 |  | if ((~~$unit - (float) $free\_unit \* $multiple~~) < 0) { //to make repeat rule work with auto add disabled |
  |  | 2360 | if (( $unit - (float) $free\_unit \* $multiple ) < 0) { //to make repeat rule work with auto add disabled |
  | 2388 | 2361 | $total\_old\_price = 0; |
  | 2389 | 2362 | } else { |
  | 2390 |  | $total\_old\_price = $old\_price \* (~~$unit - (float) $free\_unit \* $multiple~~); |
  | 2391 |  | } |
  | 2392 |  |  |
  | 2393 |  | return (~~($total\_old\_price + $total\_adjustment\_price)~~) / $unit; |
  |  | 2363 | $total\_old\_price = $old\_price \* ( $unit - (float) $free\_unit \* $multiple ); |
  |  | 2364 | } |
  |  | 2365 |  |
  |  | 2366 | return ( ( $total\_old\_price + $total\_adjustment\_price ) ) / $unit; |
  | 2394 | 2367 | } |
  | 2395 | 2368 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L2403) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L2376) |  |
  | 2403 | 2376 | } |
  | 2404 | 2377 |  |
  | 2405 |  | public function validate\_product\_matches\_categories($product, $rule) |
  | 2406 |  | { |
  |  | 2378 | public function validate\_product\_matches\_categories( $product, $rule) { |
  | 2407 | 2379 | if ($product->is\_type('variation')) { |
  | 2408 | 2380 | $parent\_id          = elex\_dp\_is\_wc\_version\_gt\_eql('2.7') ? $product->get\_parent\_id() : $product->parent->id; |
* ## [elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-single-product-offer-table.php](/changeset/3211131/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-single-product-offer-table.php "Show the changeset 3211131 restricted to elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-single-product-offer-table.php")

  | [r2965037](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-single-product-offer-table.php?rev=2965037#L14 "Show revision 2965037 of this file in browser") | [r3211131](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-single-product-offer-table.php?rev=3211131#L14 "Show revision 3211131 of this file in browser") |  |
  | --- | --- | --- |
  | 14 | 14 |  |
  | 15 | 15 | if (!empty($offers)) { |
  | 16 |  | ?> |
  |  | 16 | ?> |
  | 17 | 17 |  |
  | 18 | 18 | <style> |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-single-product-offer-table.php?rev=2965037#L33) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-single-product-offer-table.php?rev=3211131#L33) |  |
  | 33 | 33 | <?php |
  | 34 | 34 | foreach ($offers as $type\_rule\_no => $offer) { |
  | 35 |  | ?> |
  |  | 35 | ?> |
  | 36 | 36 | <li class="<?php echo $type\_rule\_no; ?>\_item  xa\_offer\_table\_list\_item "><span class="xa\_offer\_item\_span"><?php echo apply\_filters('wpml\_translate\_single\_string', $offer, 'eh-dynamic-pricing', $type\_rule\_no); ?></span></li> |
  | 37 | 37 | <?php |
* ## [elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-single-product-pricing-table.php](/changeset/3211131/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-single-product-pricing-table.php "Show the changeset 3211131 restricted to elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-single-product-pricing-table.php")

  | [r2965037](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-single-product-pricing-table.php?rev=2965037#L61 "Show revision 2965037 of this file in browser") | [r3211131](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-single-product-pricing-table.php?rev=3211131#L61 "Show revision 3211131 of this file in browser") |  |
  | --- | --- | --- |
  | 61 | 61 | //checking if product rules are enabled on settings page |
  | 62 | 62 | global $xa\_dp\_setting; |
  | 63 |  | if (!empty($xa\_dp\_setting['product\_rules\_on\_off']) && (~~'enable' !== $xa\_dp\_setting['product\_rules\_on\_off']~~)) { |
  |  | 63 | if (!empty($xa\_dp\_setting['product\_rules\_on\_off']) && ( 'enable' !== $xa\_dp\_setting['product\_rules\_on\_off'] )) { |
  | 64 | 64 | $product\_rules = array(); |
  | 65 | 65 | } else { |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-single-product-pricing-table.php?rev=2965037#L98) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-single-product-pricing-table.php?rev=3211131#L98) |  |
  | 98 | 98 | echo "<td class='xa\_sp\_table\_cell'> " . esc\_attr($rule['min']) . esc\_html(\_\_($unit, 'eh-dynamic-pricing-discounts')) . ' </td>'; |
  | 99 | 99 | echo "<td class='xa\_sp\_table\_cell'>"; |
  | 100 |  | echo (~~isset($rule['max']) ? esc\_html($rule['max']) : '-'~~); |
  |  | 100 | echo ( isset($rule['max']) ? esc\_html($rule['max']) : '-' ); |
  | 101 | 101 | echo ' ' . esc\_html(\_\_(isset($rule['max']) ? $unit : ' ', 'eh-dynamic-pricing-discounts')) . '</td>'; |
  | 102 | 102 | $currency\_pos = get\_option('woocommerce\_currency\_pos'); |
* ## [elex-woocommerce-dynamic-pricing-and-discounts/trunk/readme.txt](/changeset/3211131/elex-woocommerce-dynamic-pricing-and-discounts/trunk/readme.txt "Show the changeset 3211131 restricted to elex-woocommerce-dynamic-pricing-and-discounts/trunk/readme.txt")

  | [r3189520](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/readme.txt?rev=3189520#L5 "Show revision 3189520 of this file in browser") | [r3211131](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/readme.txt?rev=3211131#L5 "Show revision 3211131 of this file in browser") |  |
  | --- | --- | --- |
  | 5 | 5 | Tested up to: 6.7 |
  | 6 | 6 | Requires PHP: 7.4 |
  | 7 |  | Stable tag: 2.1.~~7~~ |
  |  | 7 | Stable tag: 2.1.8 |
  | 8 | 8 | License: GPLv2 or later |
  | 9 | 9 | License URI: http://www.gnu.org/licenses/gpl-2.0.html |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/readme.txt?rev=3189520#L142) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/readme.txt?rev=3211131#L142) |  |
  | 142 | 142 |  |
  | 143 | 143 | == Changelog == |
  |  | 144 | = 2.1.8 = |
  |  | 145 | \* Made compatible with WooCommerce 9.5 |
  |  | 146 | \* Corrected a vulnerability issue using Wordfence |
  |  | 147 | \* Optimized code to improve loading time |
  |  | 148 | \* Fixed an issue where the discount did not update when reducing the quantity |
  |  | 149 |  |
  | 144 | 150 | = 2.1.7 = |
  | 145 | 151 | \* Made compatible with WordPress 6.7 |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/readme.txt?rev=3189520#L291) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/readme.txt?rev=3211131#L297) |  |
  | 291 | 297 |  |
  | 292 | 298 | == Upgrade Notice == |
  |  | 299 | = 2.1.8 = |
  |  | 300 | \* Made compatible with WooCommerce 9.5 |
  |  | 301 | \* Corrected a vulnerability issue using Wordfence |
  |  | 302 | \* Optimized code to improve loading time |
  |  | 303 | \* Fixed an issue where the discount did not update when reducing the quantity |
  |  | 304 |  |
  | 293 | 305 | = 2.1.7 = |
  | 294 | 306 | \* Made compatible with WordPress 6.7 |

**Note:** See [TracChangeset](/wiki/TracChangeset)
for help on using the changeset viewer.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Unified Diff](?format=diff&new=3211131)
* [Zip Archive](?format=zip&new=3211131)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from plugins.trac.wordpress.org_b10983f3_20250114_201908.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fbrowser%2Felex-woocommerce-dynamic-pricing-and-discounts%2Ftags%2F2.1.7%2Fadmin%2Felex-exporter.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Revision](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/elex-exporter.php?rev=2965037 "Revision 2965037")
* [Next Revision](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/elex-exporter.php?rev=3211131 "Revision 3211131") →
* [Blame](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/elex-exporter.php?annotate=blame "Annotate each line with the last changed revision (this can be time consuming...)")
* [Revision Log](/log/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.7/admin/elex-exporter.php)

---

# [source:](/browser?order=name "Go to repository root") [elex-woocommerce-dynamic-pricing-and-discounts](/browser/elex-woocommerce-dynamic-pricing-and-discounts?order=name "View elex-woocommerce-dynamic-pricing-and-discounts")/[tags](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags?order=name "View tags")/[2.1.7](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.7?order=name "View 2.1.7")/[admin](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.7/admin?order=name "View admin")/[elex-exporter.php](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.7/admin/elex-exporter.php?order=name "View elex-exporter.php")

View diff against:

View revision:

| [Last change](/changeset/3004919/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/elex-exporter.php "View differences") on this file was [3004919](/changeset/3004919/ "View changeset 3004919"), checked in by elextensions, [14 months ago](/timeline?from=2023-12-04T05%3A17%3A44Z&precision=second "See timeline at 12/04/2023 05:17:44 AM") |
| --- |
| Updated to v2.1.0 |
| **File size:** 3.4 KB | |

| Line |  |
| --- | --- |
| [1](#L1) | <?php |
| [2](#L2) |  |
| [3](#L3) | if (!defined('ABSPATH')) { |
| [4](#L4) | exit; // Exit if accessed directly |
| [5](#L5) | } |
| [6](#L6) |  |
| [7](#L7) | add\_action('admin\_init', 'elex\_dp\_export\_rules'); |
| [8](#L8) |  |
| [9](#L9) | function elex\_dp\_export\_rules() { |
| [10](#L10) |  |
| [11](#L11) | if (isset($\_POST['eha-export'])) { |
| [12](#L12) | if (isset($\_POST['export\_type']) && ( $\_POST['export\_type'] == 'eha-export-json' )) { |
| [13](#L13) |  |
| [14](#L14) | $rules = get\_option('xa\_dp\_rules', array()); |
| [15](#L15) | $tab\_c = $\_POST['export\_tab']; |
| [16](#L16) |  |
| [17](#L17) | $file\_rule = $tab\_c; |
| [18](#L18) | if($tab\_c == 'combinational\_rules'){ |
| [19](#L19) | $file\_rule = 'multi\_product\_rules'; |
| [20](#L20) | }else if($tab\_c == 'cat\_combinational\_rules'){ |
| [21](#L21) | $file\_rule = 'multi\_category\_rules'; |
| [22](#L22) | }else if($tab\_c == 'buy\_get\_free\_rules'){ |
| [23](#L23) | $file\_rule = 'bogo\_product\_rules'; |
| [24](#L24) | } |
| [25](#L25) |  |
| [26](#L26) | if (!isset($rules[$tab\_c])) { |
| [27](#L27) | wp\_safe\_redirect(admin\_url('admin.php?page=dp-import-export-page&exportfailure1')); |
| [28](#L28) | return false; |
| [29](#L29) | } |
| [30](#L30) | if (empty($rules[$tab\_c])) { |
| [31](#L31) | wp\_safe\_redirect(admin\_url('admin.php?page=dp-import-export-page&exportfailure2')); |
| [32](#L32) | return false; |
| [33](#L33) | } |
| [34](#L34) | nocache\_headers(); |
| [35](#L35) | header('Content-Type: application/json; charset=utf-8'); |
| [36](#L36) | header('Content-Disposition: attachment; filename=' . $file\_rule . '-export-' . date('d-M-Y') . '.json'); |
| [37](#L37) | header('Expires: 0'); |
| [38](#L38) | $data =array('type'=> $tab\_c , 'rules'=>$rules[$tab\_c]); |
| [39](#L39) | echo json\_encode($data); |
| [40](#L40) | exit; |
| [41](#L41) |  |
| [42](#L42) | } elseif (isset($\_POST['export\_type']) && ( $\_POST['export\_type'] == 'eha-export-csv' )) { |
| [43](#L43) |  |
| [44](#L44) | $rules = get\_option('xa\_dp\_rules', array()); |
| [45](#L45) | $tab\_c = $\_POST['export\_tab']; |
| [46](#L46) |  |
| [47](#L47) | $file\_rule = $tab\_c; |
| [48](#L48) | if($tab\_c == 'combinational\_rules'){ |
| [49](#L49) | $file\_rule = 'multi\_product\_rules'; |
| [50](#L50) | }else if($tab\_c == 'cat\_combinational\_rules'){ |
| [51](#L51) | $file\_rule = 'multi\_category\_rules'; |
| [52](#L52) | }else if($tab\_c == 'buy\_get\_free\_rules'){ |
| [53](#L53) | $file\_rule = 'bogo\_product\_rules'; |
| [54](#L54) | } |
| [55](#L55) |  |
| [56](#L56) | if (!isset($rules[$tab\_c])) { |
| [57](#L57) | wp\_safe\_redirect(admin\_url('admin.php?page=dp-import-export-page&exportfailure1')); |
| [58](#L58) | return false; |
| [59](#L59) | } |
| [60](#L60) | if (empty($rules[$tab\_c])) { |
| [61](#L61) | wp\_safe\_redirect(admin\_url('admin.php?page=dp-import-export-page&exportfailure2')); |
| [62](#L62) | return false; |
| [63](#L63) | } |
| [64](#L64) | nocache\_headers(); |
| [65](#L65) | header('Content-Type: application/json; charset=utf-8'); |
| [66](#L66) | header('Content-Disposition: attachment; filename=' . $file\_rule . '-export-' . date('d-M-Y') . '.csv'); |
| [67](#L67) | header('Expires: 0'); |
| [68](#L68) | $output\_file\_name =$tab\_c . '-export-' . date('m-d-Y') . '.csv'; |
| [69](#L69) | foreach (current($rules[$tab\_c]) as $colname=>$colval) { |
| [70](#L70) | $line[] =$colname; |
| [71](#L71) | } |
| [72](#L72) | $lines =implode(',', $line); |
| [73](#L73) | echo $lines . "\n"; |
| [74](#L74) | foreach ($rules[$tab\_c] as $row) { |
| [75](#L75) | $line =array(); |
| [76](#L76) | foreach ($row as $k=>$v) { |
| [77](#L77) | if (is\_array($v) || is\_object($v)) { |
| [78](#L78) | $v   =(array) $v; |
| [79](#L79) | $tmp =''; |
| [80](#L80) | foreach ($v as $k2=>$v2) { |
| [81](#L81) | $tmp .=( empty($tmp) ? '   ' : ' | ' ) . "$k2=>$v2"; |
| [82](#L82) | } |
| [83](#L83) | $line[] ="[$tmp]"; |
| [84](#L84) | } else { |
| [85](#L85) | if($v){ |
| [86](#L86) | $v      = str\_replace(',', '&comma', $v); |
| [87](#L87) | } |
| [88](#L88) | $line[] =$v; |
| [89](#L89) | } |
| [90](#L90) | } |
| [91](#L91) | $lines =implode(',', $line); |
| [92](#L92) | echo $lines . "\n"; |
| [93](#L93) | } |
| [94](#L94) |  |
| [95](#L95) | exit; |
| [96](#L96) |  |
| [97](#L97) | } else { |
| [98](#L98) | wp\_safe\_redirect(admin\_url('admin.php?page=dp-import-export-page&exportfailure3')); |
| [99](#L99) | return false; |
| [100](#L100) | } |
| [101](#L101) | } |
| [102](#L102) | if (isset($\_POST['system-info-export'])) { |
| [103](#L103) | $Info = phpinfo(1); |
| [104](#L104) | if($Info){ |
| [105](#L105) | nocache\_headers(); |
| [106](#L106) | header('Content-Type: application/html; charset=utf-8'); |
| [107](#L107) | header('Content-Disposition: attachment; filename= System-info-export-' . date('d-M-Y') . '.html'); |
| [108](#L108) | header('Expires: 0'); |
| [109](#L109) | echo ($Info); |
| [110](#L110) | exit; |
| [111](#L111) | } else { |
| [112](#L112) | wp\_safe\_redirect(admin\_url('admin.php?page=dp-help-and-support-page&tab=ticket&downloadfailure')); |
| [113](#L113) | return false; |
| [114](#L114) | } |
| [115](#L115) | } |
| [116](#L116) |  |
| [117](#L117) | } |

**Note:** See [TracBrowser](/wiki/TracBrowser)
for help on using the repository browser.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Plain Text](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.7/admin/elex-exporter.php?format=txt)
* [Original Format](/export/3222465/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.7/admin/elex-exporter.php)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from plugins.trac.wordpress.org_da3c57ff_20250114_202023.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fchangeset%3Fnew%3D3211131%2540elex-woocommerce-dynamic-pricing-and-discounts%26old%3D3211131%2540elex-woocommerce-dynamic-pricing-and-discounts)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Change](/changeset/3189520/elex-woocommerce-dynamic-pricing-and-discounts "Changeset 3189520 for elex-woocommerce-dynamic-pricing-and-discounts")
* Next Change →

---

# Changeset [3211131](/changeset/3211131 "Show full changeset") for [elex-woocommerce-dynamic-pricing-and-discounts](/browser/elex-woocommerce-dynamic-pricing-and-discounts?rev=3211131 "Show entry in browser")

View differences
inline
side by side

Show
lines around each change

Show the changes in full context

Ignore:

Blank lines

Case changes

White space changes

Timestamp:
12/20/2024 02:33:40 PM
([4 weeks](/timeline?from=2024-12-20T14%3A33%3A40Z&precision=second "See timeline at 12/20/2024 02:33:40 PM") ago)

Author:
elextensions
Message:

Updated to v2.1.8.

Location:
[elex-woocommerce-dynamic-pricing-and-discounts](/browser/elex-woocommerce-dynamic-pricing-and-discounts?rev=3211131)
Files:

55 edited
6 copied

* [tags/2.1.8](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8?rev=3211131 "Show entry in browser")
  (copied)
  *(copied from [elex-woocommerce-dynamic-pricing-and-discounts/trunk](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk?rev=3093836 "Show original file (revision 3133195)"))*
* [tags/2.1.8/admin/data/category\_rules/elex-save-options.php](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/data/category_rules/elex-save-options.php?rev=3211131 "Show entry in browser")
  (modified)
  ([2 diffs](#file1 "Show differences"))
* [tags/2.1.8/admin/data/category\_rules/elex-update-options.php](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/data/category_rules/elex-update-options.php?rev=3211131 "Show entry in browser")
  (modified)
  ([3 diffs](#file2 "Show differences"))
* [tags/2.1.8/admin/data/product\_rules/elex-save-options.php](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/data/product_rules/elex-save-options.php?rev=3211131 "Show entry in browser")
  (modified)
  ([2 diffs](#file3 "Show differences"))
* [tags/2.1.8/admin/data/product\_rules/elex-update-options.php](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/data/product_rules/elex-update-options.php?rev=3211131 "Show entry in browser")
  (modified)
  ([1 diff](#file4 "Show differences"))
* [tags/2.1.8/admin/data/settings\_page/elex-save-options.php](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/data/settings_page/elex-save-options.php?rev=3211131 "Show entry in browser")
  (modified)
  ([3 diffs](#file5 "Show differences"))
* [tags/2.1.8/admin/elex-admin-actions-function.php](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/elex-admin-actions-function.php?rev=3211131 "Show entry in browser")
  (modified)
  ([4 diffs](#file6 "Show differences"))
* [tags/2.1.8/admin/elex-exporter.php](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/elex-exporter.php?rev=3211131 "Show entry in browser")
  (modified)
  ([5 diffs](#file7 "Show differences"))
* [tags/2.1.8/admin/elex-importer.php](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/elex-importer.php?rev=3211131 "Show entry in browser")
  (modified)
  ([3 diffs](#file8 "Show differences"))
* [tags/2.1.8/admin/ui/display/discount-rules.php](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/display/discount-rules.php?rev=3211131 "Show entry in browser")
  (modified)
  ([7 diffs](#file9 "Show differences"))
* [tags/2.1.8/admin/ui/display/settings.php](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/display/settings.php?rev=3211131 "Show entry in browser")
  (modified)
  ([1 diff](#file10 "Show differences"))
* [tags/2.1.8/admin/ui/renderer/discount-rules.php](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/renderer/discount-rules.php?rev=3211131 "Show entry in browser")
  (modified)
  ([13 diffs](#file11 "Show differences"))
* [tags/2.1.8/admin/ui/view/discount-rules/card/category-rules.php](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/view/discount-rules/card/category-rules.php?rev=3211131 "Show entry in browser")
  (copied)
  *(copied from [elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/card/category-rules.php](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/card/category-rules.php?rev=3133197 "Show original file (revision 3133197)"))*
  ([5 diffs](#file14 "Show differences"))
* [tags/2.1.8/admin/ui/view/discount-rules/card/product-rules.php](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/view/discount-rules/card/product-rules.php?rev=3211131 "Show entry in browser")
  (copied)
  *(copied from [elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/card/product-rules.php](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/card/product-rules.php?rev=3133197 "Show original file (revision 3133197)"))*
  ([6 diffs](#file15 "Show differences"))
* [tags/2.1.8/admin/ui/view/discount-rules/popup/category-rules.php](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/view/discount-rules/popup/category-rules.php?rev=3211131 "Show entry in browser")
  (modified)
  ([5 diffs](#file16 "Show differences"))
* [tags/2.1.8/admin/ui/view/discount-rules/popup/product-rules.php](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/view/discount-rules/popup/product-rules.php?rev=3211131 "Show entry in browser")
  (modified)
  ([4 diffs](#file17 "Show differences"))
* [tags/2.1.8/admin/ui/view/help-support/faqs.php](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/view/help-support/faqs.php?rev=3211131 "Show entry in browser")
  (modified)
  ([2 diffs](#file18 "Show differences"))
* [tags/2.1.8/admin/ui/view/help-support/ticket.php](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/view/help-support/ticket.php?rev=3211131 "Show entry in browser")
  (modified)
  ([2 diffs](#file19 "Show differences"))
* [tags/2.1.8/admin/ui/view/market.php](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/view/market.php?rev=3211131 "Show entry in browser")
  (modified)
  ([4 diffs](#file20 "Show differences"))
* [tags/2.1.8/admin/ui/view/settings/rules-execution-order.php](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/view/settings/rules-execution-order.php?rev=3211131 "Show entry in browser")
  (modified)
  ([1 diff](#file22 "Show differences"))
* [tags/2.1.8/elex-dynamic-pricing-and-discounts-for-woocommerce-basic-version.php](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/elex-dynamic-pricing-and-discounts-for-woocommerce-basic-version.php?rev=3211131 "Show entry in browser")
  (copied)
  *(copied from [elex-woocommerce-dynamic-pricing-and-discounts/trunk/elex-dynamic-pricing-and-discounts-for-woocommerce-basic-version.php](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/elex-dynamic-pricing-and-discounts-for-woocommerce-basic-version.php?rev=3189520 "Show original file (revision 3189520)"))*
  ([2 diffs](#file23 "Show differences"))
* [tags/2.1.8/includes/elex-common-functions.php](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/includes/elex-common-functions.php?rev=3211131 "Show entry in browser")
  (modified)
  ([1 diff](#file24 "Show differences"))
* [tags/2.1.8/includes/elex-dynamic-pricing-plugin-activator.php](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/includes/elex-dynamic-pricing-plugin-activator.php?rev=3211131 "Show entry in browser")
  (modified)
  ([1 diff](#file25 "Show differences"))
* [tags/2.1.8/includes/wf\_api\_manager/class-wc-am-plugin-activate.php](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/includes/wf_api_manager/class-wc-am-plugin-activate.php?rev=3211131 "Show entry in browser")
  (modified)
  ([1 diff](#file26 "Show differences"))
* [tags/2.1.8/includes/wf\_api\_manager/wf\_api\_manager.php](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/includes/wf_api_manager/wf_api_manager.php?rev=3211131 "Show entry in browser")
  (modified)
  ([1 diff](#file27 "Show differences"))
* [tags/2.1.8/public/elex-dynamic-pricing-plugin-public.php](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-dynamic-pricing-plugin-public.php?rev=3211131 "Show entry in browser")
  (modified)
  ([11 diffs](#file28 "Show differences"))
* [tags/2.1.8/public/elex-new-calculation-handler.php](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-new-calculation-handler.php?rev=3211131 "Show entry in browser")
  (modified)
  ([10 diffs](#file29 "Show differences"))
* [tags/2.1.8/public/elex-rules-validator.php](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131 "Show entry in browser")
  (copied)
  *(copied from [elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659 "Show original file (revision 3183659)"))*
  ([128 diffs](#file30 "Show differences"))
* [tags/2.1.8/public/elex-single-product-offer-table.php](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-single-product-offer-table.php?rev=3211131 "Show entry in browser")
  (modified)
  ([2 diffs](#file31 "Show differences"))
* [tags/2.1.8/public/elex-single-product-pricing-table.php](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-single-product-pricing-table.php?rev=3211131 "Show entry in browser")
  (modified)
  ([2 diffs](#file32 "Show differences"))
* [tags/2.1.8/readme.txt](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/readme.txt?rev=3211131 "Show entry in browser")
  (copied)
  *(copied from [elex-woocommerce-dynamic-pricing-and-discounts/trunk/readme.txt](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/readme.txt?rev=3189520 "Show original file (revision 3189520)"))*
  ([3 diffs](#file33 "Show differences"))
* [trunk/admin/data/category\_rules/elex-save-options.php](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/data/category_rules/elex-save-options.php?rev=3211131 "Show entry in browser")
  (modified)
  ([2 diffs](#file34 "Show differences"))
* [trunk/admin/data/category\_rules/elex-update-options.php](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/data/category_rules/elex-update-options.php?rev=3211131 "Show entry in browser")
  (modified)
  ([3 diffs](#file35 "Show differences"))
* [trunk/admin/data/product\_rules/elex-save-options.php](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/data/product_rules/elex-save-options.php?rev=3211131 "Show entry in browser")
  (modified)
  ([2 diffs](#file36 "Show differences"))
* [trunk/admin/data/product\_rules/elex-update-options.php](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/data/product_rules/elex-update-options.php?rev=3211131 "Show entry in browser")
  (modified)
  ([1 diff](#file37 "Show differences"))
* [trunk/admin/data/settings\_page/elex-save-options.php](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/data/settings_page/elex-save-options.php?rev=3211131 "Show entry in browser")
  (modified)
  ([3 diffs](#file38 "Show differences"))
* [trunk/admin/elex-admin-actions-function.php](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/elex-admin-actions-function.php?rev=3211131 "Show entry in browser")
  (modified)
  ([4 diffs](#file39 "Show differences"))
* [trunk/admin/elex-exporter.php](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/elex-exporter.php?rev=3211131 "Show entry in browser")
  (modified)
  ([5 diffs](#file40 "Show differences"))
* [trunk/admin/elex-importer.php](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/elex-importer.php?rev=3211131 "Show entry in browser")
  (modified)
  ([3 diffs](#file41 "Show differences"))
* [trunk/admin/ui/display/discount-rules.php](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/display/discount-rules.php?rev=3211131 "Show entry in browser")
  (modified)
  ([7 diffs](#file42 "Show differences"))
* [trunk/admin/ui/display/settings.php](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/display/settings.php?rev=3211131 "Show entry in browser")
  (modified)
  ([1 diff](#file43 "Show differences"))
* [trunk/admin/ui/renderer/discount-rules.php](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/renderer/discount-rules.php?rev=3211131 "Show entry in browser")
  (modified)
  ([13 diffs](#file44 "Show differences"))
* [trunk/admin/ui/view/discount-rules/card/category-rules.php](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/card/category-rules.php?rev=3211131 "Show entry in browser")
  (modified)
  ([5 diffs](#file47 "Show differences"))
* [trunk/admin/ui/view/discount-rules/card/product-rules.php](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/card/product-rules.php?rev=3211131 "Show entry in browser")
  (modified)
  ([6 diffs](#file48 "Show differences"))
* [trunk/admin/ui/view/discount-rules/popup/category-rules.php](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/popup/category-rules.php?rev=3211131 "Show entry in browser")
  (modified)
  ([5 diffs](#file49 "Show differences"))
* [trunk/admin/ui/view/discount-rules/popup/product-rules.php](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/popup/product-rules.php?rev=3211131 "Show entry in browser")
  (modified)
  ([4 diffs](#file50 "Show differences"))
* [trunk/admin/ui/view/help-support/faqs.php](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/help-support/faqs.php?rev=3211131 "Show entry in browser")
  (modified)
  ([2 diffs](#file51 "Show differences"))
* [trunk/admin/ui/view/help-support/ticket.php](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/help-support/ticket.php?rev=3211131 "Show entry in browser")
  (modified)
  ([2 diffs](#file52 "Show differences"))
* [trunk/admin/ui/view/market.php](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/market.php?rev=3211131 "Show entry in browser")
  (modified)
  ([4 diffs](#file53 "Show differences"))
* [trunk/admin/ui/view/settings/rules-execution-order.php](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/settings/rules-execution-order.php?rev=3211131 "Show entry in browser")
  (modified)
  ([1 diff](#file55 "Show differences"))
* [trunk/elex-dynamic-pricing-and-discounts-for-woocommerce-basic-version.php](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/elex-dynamic-pricing-and-discounts-for-woocommerce-basic-version.php?rev=3211131 "Show entry in browser")
  (modified)
  ([2 diffs](#file56 "Show differences"))
* [trunk/includes/elex-common-functions.php](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/includes/elex-common-functions.php?rev=3211131 "Show entry in browser")
  (modified)
  ([1 diff](#file57 "Show differences"))
* [trunk/includes/elex-dynamic-pricing-plugin-activator.php](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/includes/elex-dynamic-pricing-plugin-activator.php?rev=3211131 "Show entry in browser")
  (modified)
  ([1 diff](#file58 "Show differences"))
* [trunk/includes/wf\_api\_manager/class-wc-am-plugin-activate.php](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/includes/wf_api_manager/class-wc-am-plugin-activate.php?rev=3211131 "Show entry in browser")
  (modified)
  ([1 diff](#file59 "Show differences"))
* [trunk/includes/wf\_api\_manager/wf\_api\_manager.php](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/includes/wf_api_manager/wf_api_manager.php?rev=3211131 "Show entry in browser")
  (modified)
  ([1 diff](#file60 "Show differences"))
* [trunk/public/elex-dynamic-pricing-plugin-public.php](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-dynamic-pricing-plugin-public.php?rev=3211131 "Show entry in browser")
  (modified)
  ([11 diffs](#file61 "Show differences"))
* [trunk/public/elex-new-calculation-handler.php](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-new-calculation-handler.php?rev=3211131 "Show entry in browser")
  (modified)
  ([10 diffs](#file62 "Show differences"))
* [trunk/public/elex-rules-validator.php](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131 "Show entry in browser")
  (modified)
  ([128 diffs](#file63 "Show differences"))
* [trunk/public/elex-single-product-offer-table.php](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-single-product-offer-table.php?rev=3211131 "Show entry in browser")
  (modified)
  ([2 diffs](#file64 "Show differences"))
* [trunk/public/elex-single-product-pricing-table.php](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-single-product-pricing-table.php?rev=3211131 "Show entry in browser")
  (modified)
  ([2 diffs](#file65 "Show differences"))
* [trunk/readme.txt](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/readme.txt?rev=3211131 "Show entry in browser")
  (modified)
  ([3 diffs](#file66 "Show differences"))

### Legend:

Unmodified
Added
Removed

* ## [elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/data/category\_rules/elex-save-options.php](/changeset/3211131/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/data/category_rules/elex-save-options.php "Show the changeset 3211131 restricted to elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/data/category_rules/elex-save-options.php")

  | [r3049195](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/data/category_rules/elex-save-options.php?rev=3049195#L22 "Show revision 3049195 of this file in browser") | [r3211131](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/data/category_rules/elex-save-options.php?rev=3211131#L22 "Show revision 3211131 of this file in browser") |  |
  | --- | --- | --- |
  | 22 | 22 | $prev\_data = get\_option('xa\_dp\_rules', $dummy\_settings); |
  | 23 | 23 | $new\_rule = array( |
  | 24 |  | 'offer\_name'             => sanitize\_text\_field($\_REQUEST['offer\_name']), |
  | 25 |  | 'category\_id'            => array\_map('sanitize\_text\_field', $\_REQUEST['category\_id']), |
  | 26 |  | 'check\_on'               => sanitize\_text\_field($\_REQUEST['check\_on']), |
  | 27 |  | 'min'                    => sanitize\_text\_field($\_REQUEST['min']), |
  | 28 |  | 'max'                    => !empty($\_REQUEST['max']) ? sanitize\_text\_field($\_REQUEST['max']) : null, |
  | 29 |  | 'discount\_type'          => sanitize\_text\_field($\_REQUEST['discount\_type']), |
  | 30 |  | 'value'                  => sanitize\_text\_field($\_REQUEST['value']), |
  |  | 24 | 'offer\_name'             => sanitize\_text\_field($\_REQUEST['offer\_name']), |
  |  | 25 | 'category\_id'            => array\_map('sanitize\_text\_field', $\_REQUEST['category\_id']), |
  |  | 26 | 'check\_on'               => sanitize\_text\_field($\_REQUEST['check\_on']), |
  |  | 27 | 'min'                    => sanitize\_text\_field($\_REQUEST['min']), |
  |  | 28 | 'max'                    => !empty($\_REQUEST['max']) ? sanitize\_text\_field($\_REQUEST['max']) : null, |
  |  | 29 | 'discount\_type'          => sanitize\_text\_field($\_REQUEST['discount\_type']), |
  |  | 30 | 'value'                  => sanitize\_text\_field($\_REQUEST['value']), |
  | 31 | 31 | 'max\_discount' => null, |
  | 32 | 32 | 'allow\_roles' => array(), |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/data/category_rules/elex-save-options.php?rev=3049195#L38) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/data/category_rules/elex-save-options.php?rev=3211131#L38) |  |
  | 38 | 38 | 'prev\_order\_count' => null, |
  | 39 | 39 | 'prev\_order\_total\_amt' => null, |
  | 40 |  | ); |
  |  | 40 | ); |
  | 41 | 41 |  |
  | 42 | 42 | if (!isset($prev\_data[$active\_tab]) || count($prev\_data[$active\_tab]) == 0) { |
  | 43 |  | $prev\_data[$active\_tab][1] = $new\_rule; |
  | 44 |  | } else { |
  | 45 |  | $prev\_data[$active\_tab][] = $new\_rule; |
  | 46 |  | } |
  |  | 43 | $prev\_data[$active\_tab][1] = $new\_rule; |
  |  | 44 | } else { |
  |  | 45 | $prev\_data[$active\_tab][] = $new\_rule; |
  |  | 46 | } |
  | 47 | 47 |  |
  | 48 | 48 | do\_action( 'wpml\_register\_single\_string', 'eh-dynamic-pricing', $active\_tab . ':' . count($prev\_data[$active\_tab]), sanitize\_text\_field($\_REQUEST['offer\_name'])); |
* ## [elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/data/category\_rules/elex-update-options.php](/changeset/3211131/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/data/category_rules/elex-update-options.php "Show the changeset 3211131 restricted to elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/data/category_rules/elex-update-options.php")

  | [r3049195](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/data/category_rules/elex-update-options.php?rev=3049195#L13 "Show revision 3049195 of this file in browser") | [r3211131](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/data/category_rules/elex-update-options.php?rev=3211131#L13 "Show revision 3211131 of this file in browser") |  |
  | --- | --- | --- |
  | 13 | 13 | $prev\_data = get\_option('xa\_dp\_rules'); |
  | 14 | 14 | $new\_rule = array( |
  | 15 |  | 'offer\_name'             => sanitize\_text\_field($\_REQUEST['offer\_name']), |
  | 16 |  | 'category\_id'            => array\_map('sanitize\_text\_field', $\_REQUEST['category\_id']), |
  | 17 |  | 'check\_on'               => sanitize\_text\_field($\_REQUEST['check\_on']), |
  | 18 |  | 'min'                    => sanitize\_text\_field($\_REQUEST['min']), |
  | 19 |  | 'max'                    => !empty($\_REQUEST['max']) ? sanitize\_text\_field($\_REQUEST['max']) : null, |
  | 20 |  | 'discount\_type'          => sanitize\_text\_field($\_REQUEST['discount\_type']), |
  | 21 |  | 'value'                  => sanitize\_text\_field($\_REQUEST['value']), |
  |  | 15 | 'offer\_name'             => sanitize\_text\_field($\_REQUEST['offer\_name']), |
  |  | 16 | 'category\_id'            => array\_map('sanitize\_text\_field', $\_REQUEST['category\_id']), |
  |  | 17 | 'check\_on'               => sanitize\_text\_field($\_REQUEST['check\_on']), |
  |  | 18 | 'min'                    => sanitize\_text\_field($\_REQUEST['min']), |
  |  | 19 | 'max'                    => !empty($\_REQUEST['max']) ? sanitize\_text\_field($\_REQUEST['max']) : null, |
  |  | 20 | 'discount\_type'          => sanitize\_text\_field($\_REQUEST['discount\_type']), |
  |  | 21 | 'value'                  => sanitize\_text\_field($\_REQUEST['value']), |
  | 22 | 22 | 'max\_discount' => null, |
  | 23 | 23 | 'allow\_roles' => array(), |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/data/category_rules/elex-update-options.php?rev=3049195#L29) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/data/category_rules/elex-update-options.php?rev=3211131#L29) |  |
  | 29 | 29 | 'prev\_order\_count' => null, |
  | 30 | 30 | 'prev\_order\_total\_amt' => null, |
  | 31 |  | ); |
  |  | 31 | ); |
  | 32 | 32 |  |
  | 33 | 33 | $prev\_data[$active\_tab][sanitize\_text\_field($\_REQUEST['update'])] = $new\_rule; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/data/category_rules/elex-update-options.php?rev=3049195#L43) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/data/category_rules/elex-update-options.php?rev=3211131#L43) |  |
  | 43 | 43 | <?php |
  | 44 | 44 | wp\_safe\_redirect(add\_query\_arg(array('page' => 'dp-discount-rules-page', 'tab' => $active\_tab,'updatesuccess' => 1), admin\_url('admin.php'))); |
  | 45 |  | } else { |
  |  | 45 | } else { |
  | 46 | 46 | echo '<div class="notice notice-error is-dismissible">'; |
  | 47 | 47 | echo '<p>' . esc\_html\_e('Please Enter All Fields ,Then Try To Update!!', 'eh-dynamic-pricing-discounts') . '</p> </div>'; |
* ## [elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/data/product\_rules/elex-save-options.php](/changeset/3211131/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/data/product_rules/elex-save-options.php "Show the changeset 3211131 restricted to elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/data/product_rules/elex-save-options.php")

  | [r3049195](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/data/product_rules/elex-save-options.php?rev=3049195#L8 "Show revision 3049195 of this file in browser") | [r3211131](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/data/product_rules/elex-save-options.php?rev=3211131#L8 "Show revision 3211131 of this file in browser") |  |
  | --- | --- | --- |
  | 8 | 8 |  |
  | 9 | 9 |  |
  | 10 |  | if (!empty($\_REQUEST['offer\_name']) && isset($\_REQUEST['rule\_on']) && (~~(isset($\_REQUEST['product\_id'])~~) && ( !empty($\_REQUEST['product\_id']) && ( 'products' == $\_REQUEST['rule\_on'] ) ) || ( isset($\_REQUEST['category\_id']) && !empty($\_REQUEST['category\_id']) && ( 'categories' === $\_REQUEST['rule\_on'] ) ) || ( 'cart' === $\_REQUEST['rule\_on'] ) ) && !empty($\_REQUEST['check\_on']) && !empty($\_REQUEST['min']) && !empty($\_REQUEST['discount\_type']) && ( !empty($\_REQUEST['value']) ) && !isset($\_REQUEST['edit'])) { |
  |  | 10 | if (!empty($\_REQUEST['offer\_name']) && isset($\_REQUEST['rule\_on']) && ( ( isset($\_REQUEST['product\_id']) ) && ( !empty($\_REQUEST['product\_id']) && ( 'products' == $\_REQUEST['rule\_on'] ) ) || ( isset($\_REQUEST['category\_id']) && !empty($\_REQUEST['category\_id']) && ( 'categories' === $\_REQUEST['rule\_on'] ) ) || ( 'cart' === $\_REQUEST['rule\_on'] ) ) && !empty($\_REQUEST['check\_on']) && !empty($\_REQUEST['min']) && !empty($\_REQUEST['discount\_type']) && ( !empty($\_REQUEST['value']) ) && !isset($\_REQUEST['edit'])) { |
  | 11 | 11 | $dummy\_settings = []; |
  | 12 | 12 | $dummy\_settings['product\_rules']       = array(); |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/data/product_rules/elex-save-options.php?rev=3049195#L19) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/data/product_rules/elex-save-options.php?rev=3211131#L19) |  |
  | 19 | 19 |  |
  | 20 | 20 | $products\_ids = null; |
  | 21 |  | $categories   = null; |
  |  | 21 | $categories   = null; |
  | 22 | 22 |  |
  | 23 | 23 | if ($\_REQUEST['rule\_on'] === 'products' && isset($\_REQUEST['product\_id']) && !empty($\_REQUEST['product\_id'])) { |
  | 24 |  | if (elex\_dp\_is\_wc\_version\_gt\_eql('2.7')) { |
  |  | 24 | if (elex\_dp\_is\_wc\_version\_gt\_eql('2.7')) { |
  | 25 | 25 | $products\_ids = array\_map('sanitize\_text\_field', $\_REQUEST['product\_id']);// array |
  | 26 |  | } else { |
  | 27 |  | $products\_ids = explode(',', sanitize\_text\_field($\_REQUEST['product\_id'])); // string |
  | 28 |  | } |
  | 29 |  | } elseif ($\_REQUEST['rule\_on'] === 'categories' && isset($\_REQUEST['category\_id']) && !empty($\_REQUEST['category\_id'])) { |
  | 30 |  | $categories = sanitize\_text\_field($\_REQUEST['category\_id']); // string |
  | 31 |  | } |
  |  | 26 | } else { |
  |  | 27 | $products\_ids = explode(',', sanitize\_text\_field($\_REQUEST['product\_id'])); // string |
  |  | 28 | } |
  |  | 29 | } elseif ($\_REQUEST['rule\_on'] === 'categories' && isset($\_REQUEST['category\_id']) && !empty($\_REQUEST['category\_id'])) { |
  |  | 30 | $categories = sanitize\_text\_field($\_REQUEST['category\_id']); // string |
  |  | 31 | } |
  | 32 | 32 |  |
  | 33 | 33 | $prev\_data = get\_option('xa\_dp\_rules', $dummy\_settings); |
  | 34 | 34 | $new\_rule = array( |
  | 35 |  | 'offer\_name'             => sanitize\_text\_field($\_REQUEST['offer\_name']), |
  | 36 |  | 'rule\_on'                => sanitize\_text\_field($\_REQUEST['rule\_on']), |
  | 37 |  | 'product\_id'             => $products\_ids, |
  | 38 |  | 'category\_id'            => $categories, |
  | 39 |  | 'check\_on'               => sanitize\_text\_field($\_REQUEST['check\_on']), |
  | 40 |  | 'min'                    => sanitize\_text\_field($\_REQUEST['min']), |
  | 41 |  | 'max'                    => !empty($\_REQUEST['max']) ? sanitize\_text\_field($\_REQUEST['max']) : null, |
  | 42 |  | 'discount\_type'          => sanitize\_text\_field($\_REQUEST['discount\_type']), |
  | 43 |  | 'value'                  => sanitize\_text\_field($\_REQUEST['value']), |
  | 44 |  | 'max\_discount'           => null, |
  | 45 |  | ~~'allow\_roles'            => (isset($\_REQUEST['from\_date']) && !empty($\_REQUEST['allow\_roles'])~~) ? array\_map('sanitize\_text\_field', $\_REQUEST['allow\_roles']) : array(), |
  | 46 |  | ~~'allow\_membership\_plans' => (isset($\_REQUEST['from\_date']) && !empty($\_REQUEST['allow\_membership\_plans'])~~) ? array\_map('sanitize\_text\_field', $\_REQUEST['allow\_membership\_plans']) : array(), |
  | 47 |  | ~~'from\_date'              => (isset($\_REQUEST['from\_date']) && !empty($\_REQUEST['from\_date'])~~) ? sanitize\_text\_field($\_REQUEST['from\_date']) : null, |
  | 48 |  | ~~'to\_date'                => (isset($\_REQUEST['from\_date']) &&!empty($\_REQUEST['to\_date'])~~) ? sanitize\_text\_field($\_REQUEST['to\_date']) : null, |
  | 49 |  | 'adjustment'             => null, |
  | 50 |  | 'repeat\_rule'            => '', |
  | 51 |  | 'email\_ids'              => null, |
  | 52 |  | 'prev\_order\_count'       => null, |
  | 53 |  | 'prev\_order\_total\_amt'   => null, |
  | 54 |  | ); |
  |  | 35 | 'offer\_name'             => sanitize\_text\_field($\_REQUEST['offer\_name']), |
  |  | 36 | 'rule\_on'                => sanitize\_text\_field($\_REQUEST['rule\_on']), |
  |  | 37 | 'product\_id'             => $products\_ids, |
  |  | 38 | 'category\_id'            => $categories, |
  |  | 39 | 'check\_on'               => sanitize\_text\_field($\_REQUEST['check\_on']), |
  |  | 40 | 'min'                    => sanitize\_text\_field($\_REQUEST['min']), |
  |  | 41 | 'max'                    => !empty($\_REQUEST['max']) ? sanitize\_text\_field($\_REQUEST['max']) : null, |
  |  | 42 | 'discount\_type'          => sanitize\_text\_field($\_REQUEST['discount\_type']), |
  |  | 43 | 'value'                  => sanitize\_text\_field($\_REQUEST['value']), |
  |  | 44 | 'max\_discount'           => null, |
  |  | 45 | 'allow\_roles'            => ( isset($\_REQUEST['from\_date']) && !empty($\_REQUEST['allow\_roles']) ) ? array\_map('sanitize\_text\_field', $\_REQUEST['allow\_roles']) : array(), |
  |  | 46 | 'allow\_membership\_plans' => ( isset($\_REQUEST['from\_date']) && !empty($\_REQUEST['allow\_membership\_plans']) ) ? array\_map('sanitize\_text\_field', $\_REQUEST['allow\_membership\_plans']) : array(), |
  |  | 47 | 'from\_date'              => ( isset($\_REQUEST['from\_date']) && !empty($\_REQUEST['from\_date']) ) ? sanitize\_text\_field($\_REQUEST['from\_date']) : null, |
  |  | 48 | 'to\_date'                => ( isset($\_REQUEST['from\_date']) &&!empty($\_REQUEST['to\_date']) ) ? sanitize\_text\_field($\_REQUEST['to\_date']) : null, |
  |  | 49 | 'adjustment'             => null, |
  |  | 50 | 'repeat\_rule'            => '', |
  |  | 51 | 'email\_ids'              => null, |
  |  | 52 | 'prev\_order\_count'       => null, |
  |  | 53 | 'prev\_order\_total\_amt'   => null, |
  |  | 54 | ); |
  | 55 | 55 |  |
  | 56 | 56 | if (!isset($prev\_data[$active\_tab]) || count($prev\_data[$active\_tab]) == 0) { |
  | 57 |  | $prev\_data[$active\_tab][1] = $new\_rule; |
  | 58 |  | } else { |
  | 59 |  | $prev\_data[$active\_tab][] = $new\_rule; |
  | 60 |  | } |
  |  | 57 | $prev\_data[$active\_tab][1] = $new\_rule; |
  |  | 58 | } else { |
  |  | 59 | $prev\_data[$active\_tab][] = $new\_rule; |
  |  | 60 | } |
  | 61 | 61 |  |
  | 62 | 62 | do\_action( 'wpml\_register\_single\_string', 'eh-dynamic-pricing', $active\_tab . ':' . count($prev\_data[$active\_tab]), sanitize\_text\_field($\_REQUEST['offer\_name'])); |
* ## [elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/data/product\_rules/elex-update-options.php](/changeset/3211131/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/data/product_rules/elex-update-options.php "Show the changeset 3211131 restricted to elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/data/product_rules/elex-update-options.php")

  | [r3049195](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/data/product_rules/elex-update-options.php?rev=3049195#L10 "Show revision 3049195 of this file in browser") | [r3211131](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/data/product_rules/elex-update-options.php?rev=3211131#L10 "Show revision 3211131 of this file in browser") |  |
  | --- | --- | --- |
  | 10 | 10 |  |
  | 11 | 11 | $products\_ids = null; |
  | 12 |  | $categories   = null; |
  |  | 12 | $categories   = null; |
  | 13 | 13 |  |
  | 14 | 14 | if ($\_REQUEST['rule\_on'] === 'products' && isset($\_REQUEST['product\_id']) && !empty($\_REQUEST['product\_id'])) { |
  | 15 |  | if (elex\_dp\_is\_wc\_version\_gt\_eql('2.7')) { |
  |  | 15 | if (elex\_dp\_is\_wc\_version\_gt\_eql('2.7')) { |
  | 16 | 16 | $products\_ids = array\_map('sanitize\_text\_field', $\_REQUEST['product\_id']);// array |
  | 17 |  | } else { |
  | 18 |  | $products\_ids = explode(',', sanitize\_text\_field($\_REQUEST['product\_id'])); // string |
  | 19 |  | } |
  | 20 |  | } elseif ($\_REQUEST['rule\_on'] === 'categories' && isset($\_REQUEST['category\_id']) && !empty($\_REQUEST['category\_id'])) { |
  | 21 |  | $categories = sanitize\_text\_field($\_REQUEST['category\_id']); // string |
  | 22 |  | } |
  |  | 17 | } else { |
  |  | 18 | $products\_ids = explode(',', sanitize\_text\_field($\_REQUEST['product\_id'])); // string |
  |  | 19 | } |
  |  | 20 | } elseif ($\_REQUEST['rule\_on'] === 'categories' && isset($\_REQUEST['category\_id']) && !empty($\_REQUEST['category\_id'])) { |
  |  | 21 | $categories = sanitize\_text\_field($\_REQUEST['category\_id']); // string |
  |  | 22 | } |
  | 23 | 23 |  |
  | 24 | 24 | $prev\_data = get\_option('xa\_dp\_rules'); |
  | 25 | 25 | $new\_rule = array( |
  | 26 |  | 'offer\_name'             => sanitize\_text\_field($\_REQUEST['offer\_name']), |
  | 27 |  | 'rule\_on'                => sanitize\_text\_field($\_REQUEST['rule\_on']), |
  | 28 |  | 'product\_id'             => $products\_ids, |
  | 29 |  | 'category\_id'            => $categories, |
  | 30 |  | 'check\_on'               => sanitize\_text\_field($\_REQUEST['check\_on']), |
  | 31 |  | 'min'                    => sanitize\_text\_field($\_REQUEST['min']), |
  | 32 |  | 'max'                    => !empty($\_REQUEST['max']) ? sanitize\_text\_field($\_REQUEST['max']) : null, |
  | 33 |  | 'discount\_type'          => sanitize\_text\_field($\_REQUEST['discount\_type']), |
  | 34 |  | 'value'                  => sanitize\_text\_field($\_REQUEST['value']), |
  | 35 |  | 'max\_discount'           => null, |
  | 36 |  | ~~'allow\_roles'            => (isset($\_REQUEST['from\_date']) && !empty($\_REQUEST['allow\_roles'])~~) ? array\_map('sanitize\_text\_field', $\_REQUEST['allow\_roles']) : array(), |
  | 37 |  | ~~'allow\_membership\_plans' => (isset($\_REQUEST['from\_date']) && !empty($\_REQUEST['allow\_membership\_plans'])~~) ? array\_map('sanitize\_text\_field', $\_REQUEST['allow\_membership\_plans']) : array(), |
  | 38 |  | ~~'from\_date'              => (isset($\_REQUEST['from\_date']) && !empty($\_REQUEST['from\_date'])~~) ? sanitize\_text\_field($\_REQUEST['from\_date']) : null, |
  | 39 |  | ~~'to\_date'                => (isset($\_REQUEST['from\_date']) &&!empty($\_REQUEST['to\_date'])~~) ? sanitize\_text\_field($\_REQUEST['to\_date']) : null, |
  | 40 |  | 'adjustment'             => null, |
  | 41 |  | 'repeat\_rule'            => '', |
  | 42 |  | 'email\_ids'              => null, |
  | 43 |  | 'prev\_order\_count'       => null, |
  | 44 |  | 'prev\_order\_total\_amt'   => null, |
  | 45 |  | ); |
  |  | 26 | 'offer\_name'             => sanitize\_text\_field($\_REQUEST['offer\_name']), |
  |  | 27 | 'rule\_on'                => sanitize\_text\_field($\_REQUEST['rule\_on']), |
  |  | 28 | 'product\_id'             => $products\_ids, |
  |  | 29 | 'category\_id'            => $categories, |
  |  | 30 | 'check\_on'               => sanitize\_text\_field($\_REQUEST['check\_on']), |
  |  | 31 | 'min'                    => sanitize\_text\_field($\_REQUEST['min']), |
  |  | 32 | 'max'                    => !empty($\_REQUEST['max']) ? sanitize\_text\_field($\_REQUEST['max']) : null, |
  |  | 33 | 'discount\_type'          => sanitize\_text\_field($\_REQUEST['discount\_type']), |
  |  | 34 | 'value'                  => sanitize\_text\_field($\_REQUEST['value']), |
  |  | 35 | 'max\_discount'           => null, |
  |  | 36 | 'allow\_roles'            => ( isset($\_REQUEST['from\_date']) && !empty($\_REQUEST['allow\_roles']) ) ? array\_map('sanitize\_text\_field', $\_REQUEST['allow\_roles']) : array(), |
  |  | 37 | 'allow\_membership\_plans' => ( isset($\_REQUEST['from\_date']) && !empty($\_REQUEST['allow\_membership\_plans']) ) ? array\_map('sanitize\_text\_field', $\_REQUEST['allow\_membership\_plans']) : array(), |
  |  | 38 | 'from\_date'              => ( isset($\_REQUEST['from\_date']) && !empty($\_REQUEST['from\_date']) ) ? sanitize\_text\_field($\_REQUEST['from\_date']) : null, |
  |  | 39 | 'to\_date'                => ( isset($\_REQUEST['from\_date']) &&!empty($\_REQUEST['to\_date']) ) ? sanitize\_text\_field($\_REQUEST['to\_date']) : null, |
  |  | 40 | 'adjustment'             => null, |
  |  | 41 | 'repeat\_rule'            => '', |
  |  | 42 | 'email\_ids'              => null, |
  |  | 43 | 'prev\_order\_count'       => null, |
  |  | 44 | 'prev\_order\_total\_amt'   => null, |
  |  | 45 | ); |
  | 46 | 46 | $prev\_data[$active\_tab][sanitize\_text\_field($\_REQUEST['update'])] = $new\_rule; |
  | 47 | 47 |  |
* ## [elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/data/settings\_page/elex-save-options.php](/changeset/3211131/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/data/settings_page/elex-save-options.php "Show the changeset 3211131 restricted to elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/data/settings_page/elex-save-options.php")

  | [r3049195](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/data/settings_page/elex-save-options.php?rev=3049195#L17 "Show revision 3049195 of this file in browser") | [r3211131](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/data/settings_page/elex-save-options.php?rev=3211131#L17 "Show revision 3211131 of this file in browser") |  |
  | --- | --- | --- |
  | 17 | 17 | </div> |
  | 18 | 18 | <?php |
  | 19 |  | ~~}else~~{ |
  |  | 19 | } else { |
  | 20 | 20 |  |
  | 21 | 21 | if (isset($\_REQUEST['tab'])) { |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/data/settings_page/elex-save-options.php?rev=3049195#L117) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/data/settings_page/elex-save-options.php?rev=3211131#L117) |  |
  | 117 | 117 | update\_option('xa\_dynamic\_pricing\_setting', $saved\_data); |
  | 118 | 118 | wp\_safe\_redirect(add\_query\_arg(array('page' => 'dp-settings-page', 'tab' => $active\_tab), admin\_url('admin.php'))); |
  | 119 |  | ?> |
  |  | 119 | ?> |
  | 120 | 120 | <div class="notice notice-success is-dismissible"> |
  | 121 | 121 | <p><?php esc\_html\_e('Saved Successfully', 'eh-dynamic-pricing-discounts'); ?></p> |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/data/settings_page/elex-save-options.php?rev=3049195#L129) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/data/settings_page/elex-save-options.php?rev=3211131#L129) |  |
  | 129 | 129 | <?php |
  | 130 | 130 | } |
  | 131 |  | } |
  |  | 131 | } |
  | 132 | 132 | } |
* ## [elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/elex-admin-actions-function.php](/changeset/3211131/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/elex-admin-actions-function.php "Show the changeset 3211131 restricted to elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/elex-admin-actions-function.php")

  | [r3049195](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/elex-admin-actions-function.php?rev=3049195#L120 "Show revision 3049195 of this file in browser") | [r3211131](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/elex-admin-actions-function.php?rev=3211131#L120 "Show revision 3211131 of this file in browser") |  |
  | --- | --- | --- |
  | 120 | 120 | $rules\_type  = !empty($\_POST['rules-type'])?$\_POST['rules-type']:''; |
  | 121 | 121 | if (!wp\_verify\_nonce($nonce, 'update\_rules\_arrangement')) { |
  | 122 |  | wp\_die('unauthorised access [unable to verify nonce]'); |
  | 123 |  | } else { |
  | 124 |  | $allrules = get\_option('xa\_dp\_rules'); |
  |  | 122 | wp\_die('unauthorised access [unable to verify nonce]'); |
  |  | 123 | } else { |
  |  | 124 | $allrules = get\_option('xa\_dp\_rules'); |
  | 125 | 125 | $allRules = !empty($allrules[$rules\_type])?$allrules[$rules\_type]:array(); |
  | 126 | 126 |  |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/elex-admin-actions-function.php?rev=3049195#L137) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/elex-admin-actions-function.php?rev=3211131#L137) |  |
  | 137 | 137 |  |
  | 138 | 138 | //Updating rules order in existing\_perpage\_rules\_order |
  | 139 |  | if~~($reordered\_rules\_on\_given\_page)~~{ |
  | 140 |  | if~~($paged\_rules = $existing\_perpage\_rules\_order[1])~~{ |
  |  | 139 | if ($reordered\_rules\_on\_given\_page) { |
  |  | 140 | if ($paged\_rules = $existing\_perpage\_rules\_order[1]) { |
  | 141 | 141 | $updated\_order\_on\_index = []; |
  | 142 | 142 | $i=0; |
  | 143 |  | ~~foreach($paged\_rules as $key => $rule)~~{ |
  |  | 143 | foreach ($paged\_rules as $key => $rule) { |
  | 144 | 144 | $updated\_order\_on\_index[$key] = $reordered\_rules\_on\_given\_page[$i]; |
  | 145 | 145 | $i++; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/elex-admin-actions-function.php?rev=3049195#L151) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/elex-admin-actions-function.php?rev=3211131#L151) |  |
  | 151 | 151 | //Setting up final data |
  | 152 | 152 | $reordered\_final\_rules\_array = []; |
  | 153 |  | ~~foreach($existing\_perpage\_rules\_order as $rules\_array)~~{ |
  | 154 |  | if~~($rules\_array)~~{ |
  | 155 |  | foreach~~($rules\_array as $key => $rules)~~{ |
  |  | 153 | foreach ($existing\_perpage\_rules\_order as $rules\_array) { |
  |  | 154 | if ($rules\_array) { |
  |  | 155 | foreach ($rules\_array as $key => $rules) { |
  | 156 | 156 | $reordered\_final\_rules\_array[$key] = $rules; |
  | 157 | 157 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/elex-admin-actions-function.php?rev=3049195#L160) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/elex-admin-actions-function.php?rev=3211131#L160) |  |
  | 160 | 160 |  |
  | 161 | 161 | //Saving it to database |
  | 162 |  | if~~(!empty($reordered\_final\_rules\_array))~~{ |
  | 163 |  | $reordered\_final\_rules\_array = array\_reverse($reordered\_final\_rules\_array,true); |
  |  | 162 | if (!empty($reordered\_final\_rules\_array)) { |
  |  | 163 | $reordered\_final\_rules\_array = array\_reverse($reordered\_final\_rules\_array, true); |
  | 164 | 164 | $allrules[$rules\_type] = $reordered\_final\_rules\_array; |
  | 165 | 165 | update\_option('xa\_dp\_rules', $allrules); |
  | 166 | 166 | wp\_die('Arrangements Saved'); |
  | 167 |  | }~~else~~{ |
  |  | 167 | } else { |
  | 168 | 168 | wp\_die('unable to save'); |
  | 169 | 169 | } |
  | 170 |  | } |
  |  | 170 | } |
  | 171 | 171 | } |
  | 172 | 172 |  |
* ## [elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/elex-exporter.php](/changeset/3211131/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/elex-exporter.php "Show the changeset 3211131 restricted to elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/elex-exporter.php")

  | [r3004919](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/elex-exporter.php?rev=3004919#L8 "Show revision 3004919 of this file in browser") | [r3211131](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/elex-exporter.php?rev=3211131#L8 "Show revision 3211131 of this file in browser") |  |
  | --- | --- | --- |
  | 8 | 8 |  |
  | 9 | 9 | function elex\_dp\_export\_rules() { |
  | 10 |  |  |
  |  | 10 | if (!current\_user\_can('manage\_options')) { |
  |  | 11 | return; |
  |  | 12 | } |
  |  | 13 |  |
  |  | 14 | if ( isset($\_POST['eha-export']) && ( !isset($\_POST['eha\_export\_nonce']) || !wp\_verify\_nonce($\_POST['eha\_export\_nonce'], 'eha\_export\_nonce') ) ) { |
  |  | 15 | // Nonce is invalid or not present |
  |  | 16 | wp\_safe\_redirect(admin\_url('admin.php?page=dp-import-export-page&nonce\_verification\_failed')); |
  |  | 17 | return false; |
  |  | 18 |  |
  |  | 19 | } |
  | 11 | 20 | if (isset($\_POST['eha-export'])) { |
  | 12 | 21 | if (isset($\_POST['export\_type']) && ( $\_POST['export\_type'] == 'eha-export-json' )) { |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/elex-exporter.php?rev=3004919#L16) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/elex-exporter.php?rev=3211131#L25) |  |
  | 16 | 25 |  |
  | 17 | 26 | $file\_rule = $tab\_c; |
  | 18 |  | if~~($tab\_c == 'combinational\_rules')~~{ |
  |  | 27 | if ($tab\_c == 'combinational\_rules') { |
  | 19 | 28 | $file\_rule = 'multi\_product\_rules'; |
  | 20 |  | }~~else if($tab\_c == 'cat\_combinational\_rules')~~{ |
  |  | 29 | } else if ($tab\_c == 'cat\_combinational\_rules') { |
  | 21 | 30 | $file\_rule = 'multi\_category\_rules'; |
  | 22 |  | }~~else if($tab\_c == 'buy\_get\_free\_rules')~~{ |
  |  | 31 | } else if ($tab\_c == 'buy\_get\_free\_rules') { |
  | 23 | 32 | $file\_rule = 'bogo\_product\_rules'; |
  | 24 | 33 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/elex-exporter.php?rev=3004919#L46) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/elex-exporter.php?rev=3211131#L55) |  |
  | 46 | 55 |  |
  | 47 | 56 | $file\_rule = $tab\_c; |
  | 48 |  | if~~($tab\_c == 'combinational\_rules')~~{ |
  |  | 57 | if ($tab\_c == 'combinational\_rules') { |
  | 49 | 58 | $file\_rule = 'multi\_product\_rules'; |
  | 50 |  | }~~else if($tab\_c == 'cat\_combinational\_rules')~~{ |
  |  | 59 | } else if ($tab\_c == 'cat\_combinational\_rules') { |
  | 51 | 60 | $file\_rule = 'multi\_category\_rules'; |
  | 52 |  | }~~else if($tab\_c == 'buy\_get\_free\_rules')~~{ |
  |  | 61 | } else if ($tab\_c == 'buy\_get\_free\_rules') { |
  | 53 | 62 | $file\_rule = 'bogo\_product\_rules'; |
  | 54 | 63 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/elex-exporter.php?rev=3004919#L83) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/elex-exporter.php?rev=3211131#L92) |  |
  | 83 | 92 | $line[] ="[$tmp]"; |
  | 84 | 93 | } else { |
  | 85 |  | if~~($v)~~{ |
  |  | 94 | if ($v) { |
  | 86 | 95 | $v      = str\_replace(',', '&comma', $v); |
  | 87 | 96 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/elex-exporter.php?rev=3004919#L100) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/elex-exporter.php?rev=3211131#L109) |  |
  | 100 | 109 | } |
  | 101 | 110 | } |
  | 102 |  | if (isset($\_POST['system-info-export'])) { |
  | 103 |  | $Info = phpinfo(1); |
  | 104 |  | if~~($Info)~~{ |
  |  | 111 | if (isset($\_POST['system-info-export'])) { |
  |  | 112 | $Info = phpinfo(1); |
  |  | 113 | if ($Info) { |
  | 105 | 114 | nocache\_headers(); |
  | 106 | 115 | header('Content-Type: application/html; charset=utf-8'); |
  | 107 | 116 | header('Content-Disposition: attachment; filename= System-info-export-' . date('d-M-Y') . '.html'); |
  | 108 | 117 | header('Expires: 0'); |
  | 109 |  | echo (~~$Info~~); |
  |  | 118 | echo ( $Info ); |
  | 110 | 119 | exit; |
  | 111 | 120 | } else { |
* ## [elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/elex-importer.php](/changeset/3211131/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/elex-importer.php "Show the changeset 3211131 restricted to elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/elex-importer.php")

  | [r2965037](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/elex-importer.php?rev=2965037#L8 "Show revision 2965037 of this file in browser") | [r3211131](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/elex-importer.php?rev=3211131#L8 "Show revision 3211131 of this file in browser") |  |
  | --- | --- | --- |
  | 8 | 8 | function elex\_dp\_import\_rules() { |
  | 9 | 9 | $rules\_array = get\_option('xa\_dp\_rules', array()); |
  |  | 10 | if (!current\_user\_can('manage\_options')) { |
  |  | 11 | return; |
  |  | 12 | } |
  |  | 13 |  |
  |  | 14 | if ( isset($\_POST['import\_tab']) && ( !isset($\_POST['eha\_import\_export\_nonce']) || !wp\_verify\_nonce($\_POST['eha\_import\_export\_nonce'], 'eha\_import\_export\_nonce') ) ) { |
  |  | 15 | // Nonce is invalid or not present |
  |  | 16 | wp\_safe\_redirect(admin\_url('admin.php?page=dp-import-export-page&nonce\_verification\_failed')); |
  |  | 17 | return false; |
  |  | 18 |  |
  |  | 19 | } |
  |  | 20 |  |
  | 10 | 21 | if (isset($\_POST['import\_tab']) && !empty($\_POST['import\_tab']) && !empty($\_FILES['import\_file'])) { |
  | 11 | 22 | $tab       = $\_POST['import\_tab']; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/elex-importer.php?rev=2965037#L91) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/elex-importer.php?rev=3211131#L102) |  |
  | 91 | 102 | } else { |
  | 92 | 103 | $file\_data = $\_FILES; |
  | 93 |  | add\_action('admin\_notices', function() use (~~$file\_data, $tab)~~{ |
  |  | 104 | add\_action('admin\_notices', function() use ( $file\_data, $tab) { |
  | 94 | 105 | ?> |
  | 95 | 106 | <div class="notice notice-error is-dismissible" style=""> |
  | 96 |  | <p><?php \_e( ~~"You can not import " . $file\_data['import\_file']['name'] . " into "~~ . $tab , 'eh-dynamic-pricing-discounts'); ?></p> |
  |  | 107 | <p><?php \_e( 'You can not import ' . $file\_data['import\_file']['name'] . ' into ' . $tab , 'eh-dynamic-pricing-discounts'); ?></p> |
  | 97 | 108 | </div> |
  | 98 | 109 | <?php |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/elex-importer.php?rev=2965037#L110) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/elex-importer.php?rev=3211131#L121) |  |
  | 110 | 121 | $data = (array) json\_decode(file\_get\_contents($import\_file), true); |
  | 111 | 122 | if (!empty($data['type']) && $data['type'] !== $tab) { |
  | 112 |  | add\_action('admin\_notices', function() use (~~$data, $tab)~~{ |
  |  | 123 | add\_action('admin\_notices', function() use ( $data, $tab) { |
  | 113 | 124 | ?> |
  | 114 | 125 | <div class="notice notice-error is-dismissible" style=""> |
  | 115 |  | <p><?php \_e( ~~"You can not import " . $data['type'] . " into "~~ . $tab , 'eh-dynamic-pricing-discounts'); ?></p> |
  |  | 126 | <p><?php \_e( 'You can not import ' . $data['type'] . ' into ' . $tab , 'eh-dynamic-pricing-discounts'); ?></p> |
  | 116 | 127 | </div> |
  | 117 | 128 | <?php |
* ## [elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/display/discount-rules.php](/changeset/3211131/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/display/discount-rules.php "Show the changeset 3211131 restricted to elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/display/discount-rules.php")

  | [r3049195](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/display/discount-rules.php?rev=3049195#L5 "Show revision 3049195 of this file in browser") | [r3211131](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/display/discount-rules.php?rev=3211131#L5 "Show revision 3211131 of this file in browser") |  |
  | --- | --- | --- |
  | 5 | 5 | } |
  | 6 | 6 |  |
  | 7 |  | $active\_tab = (~~isset($\_REQUEST['tab']) && is\_string($\_REQUEST['tab'])~~) ? sanitize\_text\_field($\_REQUEST['tab']) : 'product\_rules'; |
  |  | 7 | $active\_tab = ( isset($\_REQUEST['tab']) && is\_string($\_REQUEST['tab']) ) ? sanitize\_text\_field($\_REQUEST['tab']) : 'product\_rules'; |
  | 8 | 8 |  |
  | 9 | 9 | if (isset($\_REQUEST['cancel\_btn'])) { |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/display/discount-rules.php?rev=3049195#L12) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/display/discount-rules.php?rev=3211131#L12) |  |
  | 12 | 12 | } |
  | 13 | 13 |  |
  |  | 14 | if ( !empty($\_REQUEST['delete']) || ( isset($\_REQUEST['update']) && empty($\_REQUEST['update']) ) || !empty($\_REQUEST['update']) ) { |
  |  | 15 |  |
  |  | 16 | global $wpdb; |
  |  | 17 |  |
  |  | 18 | // Specify the transient key pattern |
  |  | 19 | $transient\_key\_pattern = 'elex\_dp\_product\_data\_%'; |
  |  | 20 |  |
  |  | 21 | $wpdb->query( |
  |  | 22 | $wpdb->prepare( |
  |  | 23 | "DELETE FROM $wpdb->options WHERE option\_name LIKE %s OR option\_name LIKE %s", |
  |  | 24 | '\_transient\_%' . $transient\_key\_pattern, |
  |  | 25 | '\_transient\_timeout\_%' . $transient\_key\_pattern |
  |  | 26 | ) |
  |  | 27 | ); |
  |  | 28 |  |
  |  | 29 | // Clear the object cache |
  |  | 30 | wp\_cache\_flush(); |
  |  | 31 |  |
  |  | 32 | } |
  |  | 33 |  |
  | 14 | 34 | if (!empty($\_REQUEST['delete'])) { |
  | 15 |  | if~~(!isset($\_REQUEST['eh\_rule\_form\_nonce']) || !wp\_verify\_nonce(sanitize\_text\_field($\_REQUEST['eh\_rule\_form\_nonce']), 'eh\_rule\_form\_nonce'))~~{ |
  |  | 35 | if (!isset($\_REQUEST['eh\_rule\_form\_nonce']) || !wp\_verify\_nonce(sanitize\_text\_field($\_REQUEST['eh\_rule\_form\_nonce']), 'eh\_rule\_form\_nonce')) { |
  | 16 | 36 | wp\_safe\_redirect(add\_query\_arg(array('page' => 'dp-discount-rules-page', 'tab' => $active\_tab), admin\_url('admin.php'))); |
  | 17 | 37 | die(); |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/display/discount-rules.php?rev=3049195#L20) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/display/discount-rules.php?rev=3211131#L40) |  |
  | 20 | 40 | $dp\_coupons\_data = get\_option('dp\_coupons\_data', array()); |
  | 21 | 41 | $deleting\_rule\_coupon\_code = isset($prev\_data[$active\_tab][$\_REQUEST['delete']]['coupon\_code']) ? sanitize\_text\_field($prev\_data[$active\_tab][$\_REQUEST['delete']]['coupon\_code']) : ''; |
  | 22 |  | if~~(isset($deleting\_rule\_coupon\_code) && !empty($deleting\_rule\_coupon\_code) && (array\_key\_exists($deleting\_rule\_coupon\_code, $dp\_coupons\_data)))~~{ |
  |  | 42 | if (isset($deleting\_rule\_coupon\_code) && !empty($deleting\_rule\_coupon\_code) && ( array\_key\_exists($deleting\_rule\_coupon\_code, $dp\_coupons\_data) )) { |
  | 23 | 43 | unset($dp\_coupons\_data[$deleting\_rule\_coupon\_code]); |
  | 24 | 44 | $dp\_coupons\_data = array\_values($dp\_coupons\_data); |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/display/discount-rules.php?rev=3049195#L28) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/display/discount-rules.php?rev=3211131#L48) |  |
  | 28 | 48 | $index\_to\_delete = sanitize\_text\_field($\_REQUEST['delete']); |
  | 29 | 49 | unset($activetab\_rules\_data[$index\_to\_delete]); |
  | 30 |  | if~~($activetab\_rules\_data)~~{ |
  |  | 50 | if ($activetab\_rules\_data) { |
  | 31 | 51 | $activetab\_rules\_data = array\_values($activetab\_rules\_data); |
  | 32 | 52 | $activetab\_rules\_data = array\_combine(range(1, count($activetab\_rules\_data)), array\_values($activetab\_rules\_data)); |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/display/discount-rules.php?rev=3049195#L43) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/display/discount-rules.php?rev=3211131#L63) |  |
  | 43 | 63 |  |
  | 44 | 64 | if (isset($\_REQUEST['update']) && empty($\_REQUEST['update'])) {    //Submit And Not Edit Then Saving New Record |
  | 45 |  | if~~(!isset($\_REQUEST['save\_rule\_nonce']) || !wp\_verify\_nonce(sanitize\_text\_field($\_REQUEST['save\_rule\_nonce']), 'save\_rule\_nonce'))~~{ |
  |  | 65 | if (!isset($\_REQUEST['save\_rule\_nonce']) || !wp\_verify\_nonce(sanitize\_text\_field($\_REQUEST['save\_rule\_nonce']), 'save\_rule\_nonce')) { |
  | 46 | 66 | wp\_safe\_redirect(add\_query\_arg(array('page' => 'dp-discount-rules-page', 'tab' => $active\_tab), admin\_url('admin.php'))); |
  | 47 | 67 | die(); |
  | 48 | 68 | } |
  | 49 |  | $current\_tab\_loc = (isset($\_REQUEST['tab']) && is\_string($\_REQUEST['tab'])) ? sanitize\_text\_field($\_REQUEST['tab']) . '/' : 'product\_rules/'; |
  |  | 69 | // Specify the transient key pattern |
  |  | 70 | $transient\_key\_pattern = 'elex\_dp\_product\_data\_'; |
  |  | 71 |  |
  |  | 72 | // Delete transients with similar keys |
  |  | 73 | $wpdb->query( |
  |  | 74 | $wpdb->prepare( |
  |  | 75 | "DELETE FROM $wpdb->options WHERE option\_name LIKE %s OR option\_name LIKE %s", |
  |  | 76 | 'transient' . $transient\_key\_pattern, |
  |  | 77 | 'transient\_timeout' . $transient\_key\_pattern |
  |  | 78 | ) |
  |  | 79 | ); |
  |  | 80 | $current\_tab\_loc = ( isset($\_REQUEST['tab']) && is\_string($\_REQUEST['tab']) ) ? sanitize\_text\_field($\_REQUEST['tab']) . '/' : 'product\_rules/'; |
  | 50 | 81 | $path            = ELEX\_DP\_BASIC\_ROOT\_PATH . 'admin/data/' . $current\_tab\_loc . 'elex-save-options.php'; |
  | 51 | 82 | if (file\_exists($path) == true) { |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/display/discount-rules.php?rev=3049195#L54) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/display/discount-rules.php?rev=3211131#L85) |  |
  | 54 | 85 |  |
  | 55 | 86 | } elseif (isset($\_REQUEST['edit']) && !empty($\_REQUEST['edit'])) {    //Loading Edit Form Or Updating Data |
  | 56 |  | if~~(!isset($\_REQUEST['eh\_rule\_form\_nonce']) || !wp\_verify\_nonce(sanitize\_text\_field($\_REQUEST['eh\_rule\_form\_nonce']), 'eh\_rule\_form\_nonce'))~~{ |
  |  | 87 | if (!isset($\_REQUEST['eh\_rule\_form\_nonce']) || !wp\_verify\_nonce(sanitize\_text\_field($\_REQUEST['eh\_rule\_form\_nonce']), 'eh\_rule\_form\_nonce')) { |
  | 57 | 88 | wp\_safe\_redirect(add\_query\_arg(array('page' => 'dp-discount-rules-page', 'tab' => $active\_tab), admin\_url('admin.php'))); |
  | 58 | 89 | die(); |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/display/discount-rules.php?rev=3049195#L61) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/display/discount-rules.php?rev=3211131#L92) |  |
  | 61 | 92 | $old\_option = $old\_option[$active\_tab]; |
  | 62 | 93 | $\_REQUEST = array\_merge($\_REQUEST, $old\_option[$\_REQUEST['edit']]); |
  | 63 |  | $current\_tab\_loc = (~~isset($\_REQUEST['tab']) && is\_string($\_REQUEST['tab'])~~) ? sanitize\_text\_field($\_REQUEST['tab']) . '/' : 'product\_rules/'; |
  |  | 94 | $current\_tab\_loc = ( isset($\_REQUEST['tab']) && is\_string($\_REQUEST['tab']) ) ? sanitize\_text\_field($\_REQUEST['tab']) . '/' : 'product\_rules/'; |
  | 64 | 95 | $path            = ELEX\_DP\_BASIC\_ROOT\_PATH . 'admin/data/' . $current\_tab\_loc . 'elex-load-edit.php'; |
  | 65 | 96 | include\_once  $path ; |
  | 66 | 97 |  |
  | 67 | 98 | } elseif ( !empty($\_REQUEST['update'])) { |
  | 68 |  | if~~(!isset($\_REQUEST['update\_rule\_' . sanitize\_text\_field($\_REQUEST['update'])]) || !wp\_verify\_nonce(sanitize\_text\_field($\_REQUEST['update\_rule\_' . sanitize\_text\_field($\_REQUEST['update'])]), 'update\_rule\_' . sanitize\_text\_field($\_REQUEST['update'])))~~{ |
  |  | 99 | if (!isset($\_REQUEST['update\_rule\_' . sanitize\_text\_field($\_REQUEST['update'])]) || !wp\_verify\_nonce(sanitize\_text\_field($\_REQUEST['update\_rule\_' . sanitize\_text\_field($\_REQUEST['update'])]), 'update\_rule\_' . sanitize\_text\_field($\_REQUEST['update']))) { |
  | 69 | 100 | wp\_safe\_redirect(add\_query\_arg(array('page' => 'dp-discount-rules-page', 'tab' => $active\_tab), admin\_url('admin.php'))); |
  | 70 | 101 | die(); |
  | 71 | 102 | } |
  | 72 |  | $path = (isset($\_REQUEST['tab']) && is\_string($\_REQUEST['tab'])) ? sanitize\_text\_field($\_REQUEST['tab']) . '/' : 'product\_rules/'; |
  |  | 103 | // Specify the transient key pattern |
  |  | 104 | $transient\_key\_pattern = 'elex\_dp\_product\_data\_'; |
  |  | 105 |  |
  |  | 106 | // Delete transients with similar keys |
  |  | 107 | $wpdb->query( |
  |  | 108 | $wpdb->prepare( |
  |  | 109 | "DELETE FROM $wpdb->options WHERE option\_name LIKE %s OR option\_name LIKE %s", |
  |  | 110 | 'transient' . $transient\_key\_pattern, |
  |  | 111 | 'transient\_timeout' . $transient\_key\_pattern |
  |  | 112 | ) |
  |  | 113 | ); |
  |  | 114 |  |
  |  | 115 | $path = ( isset($\_REQUEST['tab']) && is\_string($\_REQUEST['tab']) ) ? sanitize\_text\_field($\_REQUEST['tab']) . '/' : 'product\_rules/'; |
  | 73 | 116 | $path = ELEX\_DP\_BASIC\_ROOT\_PATH . 'admin/data/' . $path . 'elex-update-options.php'; |
  | 74 | 117 | include\_once  $path ; |
* ## [elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/display/settings.php](/changeset/3211131/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/display/settings.php "Show the changeset 3211131 restricted to elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/display/settings.php")

  | [r3049195](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/display/settings.php?rev=3049195#L6 "Show revision 3049195 of this file in browser") | [r3211131](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/display/settings.php?rev=3211131#L6 "Show revision 3211131 of this file in browser") |  |
  | --- | --- | --- |
  | 6 | 6 |  |
  | 7 | 7 | // Sets active tab |
  | 8 |  | $active\_tab = (~~isset($\_REQUEST['tab']) && is\_string($\_REQUEST['tab'])~~) ? sanitize\_text\_field($\_REQUEST['tab']) : 'rules\_order'; |
  |  | 8 | $active\_tab = ( isset($\_REQUEST['tab']) && is\_string($\_REQUEST['tab']) ) ? sanitize\_text\_field($\_REQUEST['tab']) : 'rules\_order'; |
  | 9 | 9 |  |
  | 10 | 10 | // Data handling of form submit request. |
  | 11 | 11 | if (isset($\_REQUEST['submit'])) { |
  |  | 12 | global $wpdb; |
  |  | 13 | // Specify the transient key pattern |
  |  | 14 | $transient\_key\_pattern = 'elex\_dp\_product\_data\_%'; |
  |  | 15 |  |
  |  | 16 | $wpdb->query( |
  |  | 17 | $wpdb->prepare( |
  |  | 18 | "DELETE FROM $wpdb->options WHERE option\_name LIKE %s OR option\_name LIKE %s", |
  |  | 19 | '\_transient\_%' . $transient\_key\_pattern, |
  |  | 20 | '\_transient\_timeout\_%' . $transient\_key\_pattern |
  |  | 21 | ) |
  |  | 22 | ); |
  |  | 23 |  |
  |  | 24 | // Clear the object cache |
  |  | 25 | wp\_cache\_flush(); |
  | 12 | 26 | $path = ELEX\_DP\_BASIC\_ROOT\_PATH . 'admin/data/settings\_page/elex-save-options.php'; |
  | 13 | 27 | if (file\_exists($path) == true) { |
* ## [elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/renderer/discount-rules.php](/changeset/3211131/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/renderer/discount-rules.php "Show the changeset 3211131 restricted to elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/renderer/discount-rules.php")

  | [r3049195](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/renderer/discount-rules.php?rev=3049195#L56 "Show revision 3049195 of this file in browser") | [r3211131](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/renderer/discount-rules.php?rev=3211131#L56 "Show revision 3211131 of this file in browser") |  |
  | --- | --- | --- |
  | 56 | 56 | $tablink = esc\_url(add\_query\_arg(array('page' => 'dp-discount-rules-page', 'tab' => $tabkey), admin\_url('admin.php'))); |
  | 57 | 57 | switch ($tabkey) { |
  | 58 |  | case 'product\_rules': ?> |
  |  | 58 | case 'product\_rules': |
  |  | 59 | ?> |
  | 59 | 60 | <a href="<?php echo $tablink; ?>" class=" elex-dynamic-pricing-main-link <?php echo $active\_tab === 'product\_rules' ? 'active' : ''; ?>"> |
  | 60 | 61 | <?php esc\_html\_e('Product Rule', 'eh-dynamic-pricing-discounts'); ?> |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/renderer/discount-rules.php?rev=3049195#L63) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/renderer/discount-rules.php?rev=3211131#L64) |  |
  | 63 | 64 | <path id="carrier\_seperator" data-name="carrier seperator" d="M2565.89-576v23.587" transform="translate(-2564.89 577)" fill="none" stroke="#707070" stroke-linecap="round" stroke-width="2" /> |
  | 64 | 65 | </svg> |
  | 65 |  | <?php break; |
  | 66 |  | case 'category\_rules':  ?> |
  |  | 66 | <?php |
  |  | 67 | break; |
  |  | 68 | case 'category\_rules': |
  |  | 69 | ?> |
  | 67 | 70 | <a href="<?php echo $tablink; ?>" class=" elex-dynamic-pricing-main-link <?php echo $active\_tab === 'category\_rules' ? 'active' : ''; ?>"> |
  | 68 | 71 | <?php esc\_html\_e('Category Rules', 'eh-dynamic-pricing-discounts'); ?> |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/renderer/discount-rules.php?rev=3049195#L71) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/renderer/discount-rules.php?rev=3211131#L74) |  |
  | 71 | 74 | <path id="carrier\_seperator" data-name="carrier seperator" d="M2565.89-576v23.587" transform="translate(-2564.89 577)" fill="none" stroke="#707070" stroke-linecap="round" stroke-width="2" /> |
  | 72 | 75 | </svg> |
  | 73 |  | <?php break; |
  |  | 76 | <?php |
  |  | 77 | break; |
  | 74 | 78 | default: |
  | 75 | 79 | break; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/renderer/discount-rules.php?rev=3049195#L82) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/renderer/discount-rules.php?rev=3211131#L86) |  |
  | 82 | 86 |  |
  | 83 | 87 | <div> |
  | 84 |  | <?php if (!in\_array($active\_tab, $execution\_order)) { ?> |
  |  | 88 | <?php if (!in\_array($active\_tab, $execution\_order)) { ?> |
  | 85 | 89 | <!-- when no rule tab is there --> |
  | 86 | 90 | <div class="w-100 text-center"> |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/renderer/discount-rules.php?rev=3049195#L95) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/renderer/discount-rules.php?rev=3211131#L99) |  |
  | 95 | 99 | <img src="<?php echo esc\_url( ELEX\_DP\_CRM\_MAIN\_IMG . 'IsolationMode.svg' ); ?>" alt="" class="w-100" style="max-width: 684px; margin: auto;"> |
  | 96 | 100 | <div class="text-center"> |
  | 97 |  | <button class="btn btn-primary elex-dynamic-pricing-popup-open-btn"><?php esc\_html\_e('Create My First |
  | 98 |  | Rule', 'eh-dynamic-pricing-discounts'); ?></button> |
  |  | 101 | <button class="btn btn-primary elex-dynamic-pricing-popup-open-btn"> |
  |  | 102 | <?php |
  |  | 103 | esc\_html\_e('Create My First |
  |  | 104 | Rule', 'eh-dynamic-pricing-discounts'); |
  |  | 105 | ?> |
  |  | 106 | </button> |
  | 99 | 107 | </div> |
  | 100 | 108 | </div> |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/renderer/discount-rules.php?rev=3049195#L105) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/renderer/discount-rules.php?rev=3211131#L113) |  |
  | 105 | 113 | $settings       = get\_option('xa\_dynamic\_pricing\_setting', array()); |
  | 106 | 114 |  |
  | 107 |  | ?> |
  |  | 115 | ?> |
  | 108 | 116 |  |
  | 109 | 117 | <div class="d-flex justify-content-between align-items-center mb-3"> |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/renderer/discount-rules.php?rev=3049195#L132) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/renderer/discount-rules.php?rev=3211131#L140) |  |
  | 132 | 140 | $member\_plans = wc\_memberships\_get\_membership\_plans(); |
  | 133 | 141 | } |
  | 134 |  | $no\_of\_rules = count($allrules); |
  |  | 142 | $no\_of\_rules = count($allrules); |
  | 135 | 143 | ?> |
  | 136 | 144 | <input type="hidden" id="no\_of\_rules" name="no\_of\_rules" value="<?php echo esc\_attr($no\_of\_rules); ?>"> |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/renderer/discount-rules.php?rev=3049195#L140) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/renderer/discount-rules.php?rev=3211131#L148) |  |
  | 140 | 148 | //Checkon |
  | 141 | 149 | $checkon= ''; |
  | 142 |  | if(isset($value['check\_on']) && !empty($value['check\_on'])) { |
  |  | 150 | if (isset($value['check\_on']) && !empty($value['check\_on'])) { |
  | 143 | 151 | switch ($value['check\_on']) { |
  | 144 | 152 | case 'Quantity': |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/renderer/discount-rules.php?rev=3049195#L161) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/renderer/discount-rules.php?rev=3211131#L169) |  |
  | 161 | 169 | if ($active\_tab === 'product\_rules') { |
  | 162 | 170 | require ELEX\_DP\_BASIC\_ROOT\_PATH . 'admin/ui/view/discount-rules/card/product-rules.php'; |
  | 163 |  | }else if ($active\_tab === 'category\_rules') { |
  |  | 171 | } else if ($active\_tab === 'category\_rules') { |
  | 164 | 172 | require ELEX\_DP\_BASIC\_ROOT\_PATH . 'admin/ui/view/discount-rules/card/category-rules.php'; |
  | 165 | 173 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/renderer/discount-rules.php?rev=3049195#L180) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/renderer/discount-rules.php?rev=3211131#L188) |  |
  | 180 | 188 | <?php |
  | 181 | 189 | if (isset($\_REQUEST['edit'])) { |
  | 182 |  | wp\_nonce\_field('update\_rule\_' . $\_REQUEST['edit'],'update\_rule\_' . $\_REQUEST['edit']); |
  |  | 190 | wp\_nonce\_field('update\_rule\_' . $\_REQUEST['edit'], 'update\_rule\_' . $\_REQUEST['edit']); |
  | 183 | 191 | } else { |
  | 184 |  | wp\_nonce\_field('save\_rule\_nonce','save\_rule\_nonce'); |
  |  | 192 | wp\_nonce\_field('save\_rule\_nonce', 'save\_rule\_nonce'); |
  | 185 | 193 | } |
  | 186 | 194 | ?> |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/renderer/discount-rules.php?rev=3049195#L381) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/renderer/discount-rules.php?rev=3211131#L389) |  |
  | 381 | 389 | if(no\_of\_rules == 1){ |
  | 382 | 390 | // var className = document.getElementById('className').value; |
  | 383 |  | document.getElementsByClassName('elex-ac-edit-rule-up-btn')[0].disabled=true; |
  |  | 391 | document.getElementsByClassName('elex-ac-edit-rule-up-btn')[0].disabled=true; |
  | 384 | 392 | document.getElementsByClassName('elex-ac-edit-rule-down-btn')[0].disabled=true; |
  | 385 | 393 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/renderer/discount-rules.php?rev=3049195#L418) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/renderer/discount-rules.php?rev=3211131#L426) |  |
  | 418 | 426 | return; |
  | 419 | 427 | } |
  | 420 |  | } |
  |  | 428 | } |
  | 421 | 429 |  |
  | 422 | 430 | isFormSubmitting = true; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/renderer/discount-rules.php?rev=3049195#L433) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/renderer/discount-rules.php?rev=3211131#L441) |  |
  | 433 | 441 | document.getElementById("myForm").reset(); |
  | 434 | 442 | }); |
  | 435 |  |  |
  |  | 443 |  |
  | 436 | 444 |  |
  | 437 | 445 | //Js for rule deleting confirmation Alert ==> |
* ## [elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/view/discount-rules/card/category-rules.php](/changeset/3211131/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/view/discount-rules/card/category-rules.php "Show the changeset 3211131 restricted to elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/view/discount-rules/card/category-rules.php")

  | [r3133197](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/card/category-rules.php?rev=3133197#L21 "Show revision 3133197 of this file in browser") | [r3211131](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/view/discount-rules/card/category-rules.php?rev=3211131#L21 "Show revision 3211131 of this file in browser") |  |
  | --- | --- | --- |
  | 21 | 21 | <div class="flex-fill"> |
  | 22 | 22 | <div class="d-flex justify-content-between mb-3"> |
  | 23 |  | <h6 class="mb-0"><?php esc\_html\_e('Rule #: ', 'eh-dynamic-pricing-discounts'); ?><span class="fw-normal"><?php echo esc\_html($key); ?></span> | <?php esc\_html\_e('Rule Name: ', 'eh-dynamic-pricing-discounts'); ?><span class="fw-normal"><?php echo (~~isset($value['offer\_name']) && !empty($value['offer\_name'])~~) ? esc\_html($value['offer\_name']) : ' - - '; ?></span></h6> |
  | 24 |  | <h6 class="mb-0"><?php esc\_html\_e('Validty: ', 'eh-dynamic-pricing-discounts'); ?><span class="fw-normal"><?php echo (~~isset($value['from\_date']) && !empty($value['from\_date']) && isset($value['to\_date']) && !empty($value['to\_date'])~~) ? esc\_html($value['from\_date'] . '/' . esc\_html($value['to\_date'])) : ' --/--'; ?></span> |
  |  | 23 | <h6 class="mb-0"><?php esc\_html\_e('Rule #: ', 'eh-dynamic-pricing-discounts'); ?><span class="fw-normal"><?php echo esc\_html($key); ?></span> | <?php esc\_html\_e('Rule Name: ', 'eh-dynamic-pricing-discounts'); ?><span class="fw-normal"><?php echo ( isset($value['offer\_name']) && !empty($value['offer\_name']) ) ? esc\_html($value['offer\_name']) : ' - - '; ?></span></h6> |
  |  | 24 | <h6 class="mb-0"><?php esc\_html\_e('Validty: ', 'eh-dynamic-pricing-discounts'); ?><span class="fw-normal"><?php echo ( isset($value['from\_date']) && !empty($value['from\_date']) && isset($value['to\_date']) && !empty($value['to\_date']) ) ? esc\_html($value['from\_date'] . '/' . esc\_html($value['to\_date'])) : ' --/--'; ?></span> |
  | 25 | 25 | </h6> |
  | 26 | 26 | </div> |
  | 27 | 27 |  |
  | 28 | 28 | <div class="d-flex justify-content-between "> |
  | 29 |  | <h6 class="mb-0"><?php esc\_html\_e('Discount Type: ', 'eh-dynamic-pricing-discounts'); ?><span class="fw-normal"><?php echo (~~isset($value['discount\_type']) && !empty($value['discount\_type'])~~)? esc\_html($value['discount\_type']) : ' - - '; ?></span> |
  |  | 29 | <h6 class="mb-0"><?php esc\_html\_e('Discount Type: ', 'eh-dynamic-pricing-discounts'); ?><span class="fw-normal"><?php echo ( isset($value['discount\_type']) && !empty($value['discount\_type']) )? esc\_html($value['discount\_type']) : ' - - '; ?></span> |
  | 30 | 30 | </h6> |
  | 31 |  | <h6 class="mb-0"><?php esc\_html\_e('Discount Value: ', 'eh-dynamic-pricing-discounts'); ?><span class="fw-normal"><?php echo (~~isset($value['value']) && !empty($value['value'])~~) ? esc\_html($value['value']) : ' - - '; ?></span> |
  |  | 31 | <h6 class="mb-0"><?php esc\_html\_e('Discount Value: ', 'eh-dynamic-pricing-discounts'); ?><span class="fw-normal"><?php echo ( isset($value['value']) && !empty($value['value']) ) ? esc\_html($value['value']) : ' - - '; ?></span> |
  | 32 | 32 | </h6> |
  | 33 |  | <h6 class="mb-0"><?php esc\_html\_e('Max Discount: ', 'eh-dynamic-pricing-discounts'); ?><span class="fw-normal"><?php echo (~~isset($value['max\_discount']) && !empty($value['max\_discount'])~~) ? esc\_html($value['max\_discount']) : ' - - '; ?></span></h6> |
  |  | 33 | <h6 class="mb-0"><?php esc\_html\_e('Max Discount: ', 'eh-dynamic-pricing-discounts'); ?><span class="fw-normal"><?php echo ( isset($value['max\_discount']) && !empty($value['max\_discount']) ) ? esc\_html($value['max\_discount']) : ' - - '; ?></span></h6> |
  | 34 | 34 | </div> |
  | 35 | 35 | </div> |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/card/category-rules.php?rev=3133197#L69) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/view/discount-rules/card/category-rules.php?rev=3211131#L69) |  |
  | 69 | 69 | } |
  | 70 | 70 | } |
  | 71 |  | }~~else~~{ |
  |  | 71 | } else { |
  | 72 | 72 | echo '<div class="btn elex-light-blue-bg">' . esc\_html\_\_(' - - ', 'eh-dynamic-pricing-discounts') . '</div>'; |
  | 73 | 73 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/card/category-rules.php?rev=3133197#L102) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/view/discount-rules/card/category-rules.php?rev=3211131#L102) |  |
  | 102 | 102 | <div class="border-0 border-bottom mb-3"> |
  | 103 | 103 | <div class="d-flex gap-4"> |
  | 104 |  | <h6><?php esc\_html\_e('Check On: ', 'eh-dynamic-pricing-discounts');?><span class="fw-normal"><?php echo esc\_html(isset($checkon) && !empty($checkon) ? $checkon : ' - - '); ?></span></h6> |
  |  | 104 | <h6><?php esc\_html\_e('Check On: ', 'eh-dynamic-pricing-discounts'); ?><span class="fw-normal"><?php echo esc\_html(isset($checkon) && !empty($checkon) ? $checkon : ' - - '); ?></span></h6> |
  | 105 | 105 | <h6><?php esc\_html\_e('Minimum ', 'eh-dynamic-pricing-discounts'); ?><?php echo esc\_html(isset($checkon) && !empty($checkon) ? $checkon : ' - - '); ?>: <span class="fw-normal"><?php echo esc\_html(isset($value['min']) && !empty($value['min']) ? $value['min'] : ' - - '); ?></span></h6> |
  | 106 | 106 | <h6><?php esc\_html\_e('Maximum ', 'eh-dynamic-pricing-discounts'); ?><?php echo esc\_html(isset($checkon) && !empty($checkon) ? $checkon : ' - - '); ?>: <span class="fw-normal"><?php echo esc\_html(isset($value['max']) && !empty($value['max']) ? $value['max'] : ' - - '); ?></span></h6> |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/card/category-rules.php?rev=3133197#L128) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/view/discount-rules/card/category-rules.php?rev=3211131#L128) |  |
  | 128 | 128 | } |
  | 129 | 129 | } |
  | 130 |  | }~~else~~{ |
  |  | 130 | } else { |
  | 131 | 131 | echo '<div class="btn elex-light-blue-bg">' . esc\_html\_\_(' - - ', 'eh-dynamic-pricing-discounts') . '</div>'; |
  | 132 | 132 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/card/category-rules.php?rev=3133197#L150) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/view/discount-rules/card/category-rules.php?rev=3211131#L150) |  |
  | 150 | 150 | </div> |
  | 151 | 151 | <div class="d-flex justify-content-between"> |
  | 152 |  | <h6 class="mb-0"><?php esc\_html\_e('Minimum Number of Previous Order: ', 'eh-dynamic-pricing-discounts');?> <?php echo esc\_html(isset($value['prev\_order\_count']) && !empty($value['prev\_order\_count']) ? $value['prev\_order\_count'] : ' - - '); ?></h6> |
  | 153 |  | <h6 class="mb-0"><?php esc\_html\_e('Minimum Total Spending on Previous Order: ', 'eh-dynamic-pricing-discounts');?> <?php echo esc\_html(isset($value['prev\_order\_total\_amt']) && !empty($value['prev\_order\_total\_amt']) ? $value['prev\_order\_total\_amt'] : ' - - '); ?></h6> |
  |  | 152 | <h6 class="mb-0"><?php esc\_html\_e('Minimum Number of Previous Order: ', 'eh-dynamic-pricing-discounts'); ?> <?php echo esc\_html(isset($value['prev\_order\_count']) && !empty($value['prev\_order\_count']) ? $value['prev\_order\_count'] : ' - - '); ?></h6> |
  |  | 153 | <h6 class="mb-0"><?php esc\_html\_e('Minimum Total Spending on Previous Order: ', 'eh-dynamic-pricing-discounts'); ?> <?php echo esc\_html(isset($value['prev\_order\_total\_amt']) && !empty($value['prev\_order\_total\_amt']) ? $value['prev\_order\_total\_amt'] : ' - - '); ?></h6> |
  | 154 | 154 | </div> |
  | 155 | 155 | </div> |
* ## [elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/view/discount-rules/card/product-rules.php](/changeset/3211131/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/view/discount-rules/card/product-rules.php "Show the changeset 3211131 restricted to elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/view/discount-rules/card/product-rules.php")

  | [r3133197](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/card/product-rules.php?rev=3133197#L21 "Show revision 3133197 of this file in browser") | [r3211131](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/view/discount-rules/card/product-rules.php?rev=3211131#L21 "Show revision 3211131 of this file in browser") |  |
  | --- | --- | --- |
  | 21 | 21 | <div class="flex-fill"> |
  | 22 | 22 | <div class="d-flex justify-content-between mb-3"> |
  | 23 |  | <h6 class="mb-0"><?php esc\_html\_e('Rule #: ', 'eh-dynamic-pricing-discounts'); ?><span class="fw-normal"><?php echo esc\_html($key); ?></span> | <?php esc\_html\_e('Rule Name: ', 'eh-dynamic-pricing-discounts'); ?><span class="fw-normal"><?php echo (~~isset($value['offer\_name']) && !empty($value['offer\_name'])~~) ? esc\_html($value['offer\_name']) : ' - - '; ?></span></h6> |
  | 24 |  | <h6 class="mb-0"><?php esc\_html\_e('Validty: ', 'eh-dynamic-pricing-discounts'); ?><span class="fw-normal"><?php echo (~~isset($value['from\_date']) && !empty($value['from\_date']) && isset($value['to\_date']) && !empty($value['to\_date'])~~) ? esc\_html($value['from\_date'] . '/' . esc\_html($value['to\_date'])) : ' --/--'; ?></span> |
  |  | 23 | <h6 class="mb-0"><?php esc\_html\_e('Rule #: ', 'eh-dynamic-pricing-discounts'); ?><span class="fw-normal"><?php echo esc\_html($key); ?></span> | <?php esc\_html\_e('Rule Name: ', 'eh-dynamic-pricing-discounts'); ?><span class="fw-normal"><?php echo ( isset($value['offer\_name']) && !empty($value['offer\_name']) ) ? esc\_html($value['offer\_name']) : ' - - '; ?></span></h6> |
  |  | 24 | <h6 class="mb-0"><?php esc\_html\_e('Validty: ', 'eh-dynamic-pricing-discounts'); ?><span class="fw-normal"><?php echo ( isset($value['from\_date']) && !empty($value['from\_date']) && isset($value['to\_date']) && !empty($value['to\_date']) ) ? esc\_html($value['from\_date'] . '/' . esc\_html($value['to\_date'])) : ' --/--'; ?></span> |
  | 25 | 25 | </h6> |
  | 26 | 26 | </div> |
  | 27 | 27 |  |
  | 28 | 28 | <div class="d-flex justify-content-between "> |
  | 29 |  | <h6 class="mb-0"><?php esc\_html\_e('Discount Type: ', 'eh-dynamic-pricing-discounts'); ?><span class="fw-normal"><?php echo (~~isset($value['discount\_type']) && !empty($value['discount\_type'])~~)? esc\_html($value['discount\_type']) : ' - - '; ?></span> |
  |  | 29 | <h6 class="mb-0"><?php esc\_html\_e('Discount Type: ', 'eh-dynamic-pricing-discounts'); ?><span class="fw-normal"><?php echo ( isset($value['discount\_type']) && !empty($value['discount\_type']) )? esc\_html($value['discount\_type']) : ' - - '; ?></span> |
  | 30 | 30 | </h6> |
  | 31 |  | <h6 class="mb-0"><?php esc\_html\_e('Discount Value: ', 'eh-dynamic-pricing-discounts'); ?><span class="fw-normal"><?php echo (~~isset($value['value']) && !empty($value['value'])~~) ? esc\_html($value['value']) : ' - - '; ?></span> |
  |  | 31 | <h6 class="mb-0"><?php esc\_html\_e('Discount Value: ', 'eh-dynamic-pricing-discounts'); ?><span class="fw-normal"><?php echo ( isset($value['value']) && !empty($value['value']) ) ? esc\_html($value['value']) : ' - - '; ?></span> |
  | 32 | 32 | </h6> |
  | 33 |  | <h6 class="mb-0"><?php esc\_html\_e('Max Discount: ', 'eh-dynamic-pricing-discounts'); ?><span class="fw-normal"><?php echo (~~isset($value['max\_discount']) && !empty($value['max\_discount'])~~) ? esc\_html($value['max\_discount']) : ' - - '; ?></span></h6> |
  |  | 33 | <h6 class="mb-0"><?php esc\_html\_e('Max Discount: ', 'eh-dynamic-pricing-discounts'); ?><span class="fw-normal"><?php echo ( isset($value['max\_discount']) && !empty($value['max\_discount']) ) ? esc\_html($value['max\_discount']) : ' - - '; ?></span></h6> |
  | 34 | 34 | </div> |
  | 35 | 35 | </div> |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/card/product-rules.php?rev=3133197#L63) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/view/discount-rules/card/product-rules.php?rev=3211131#L63) |  |
  | 63 | 63 | $product = wc\_get\_product($\_pid); |
  | 64 | 64 | if (!empty($\_pid) && !empty($product)) { |
  | 65 |  | echo '<div class="btn elex-light-blue-bg">' . \_\_($product->get\_formatted\_name(),'eh-dynamic-pricing-discounts') . '</div>'; |
  |  | 65 | echo '<div class="btn elex-light-blue-bg">' . \_\_($product->get\_formatted\_name(), 'eh-dynamic-pricing-discounts') . '</div>'; |
  | 66 | 66 | } |
  | 67 | 67 | } |
  | 68 |  | }~~else~~{ |
  |  | 68 | } else { |
  | 69 | 69 | echo '<div class="btn elex-light-blue-bg">' . esc\_html\_\_(' - - ', 'eh-dynamic-pricing-discounts') . '</div>'; |
  | 70 | 70 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/card/product-rules.php?rev=3133197#L82) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/view/discount-rules/card/product-rules.php?rev=3211131#L82) |  |
  | 82 | 82 | echo '<div class="btn elex-light-blue-bg">' . esc\_html($category) . '</div>'; |
  | 83 | 83 | } |
  | 84 |  | }~~else~~{ |
  |  | 84 | } else { |
  | 85 | 85 | echo '<div class="btn elex-light-blue-bg">' . esc\_html\_\_(' - - ', 'eh-dynamic-pricing-discounts') . '</div>'; |
  | 86 | 86 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/card/product-rules.php?rev=3133197#L94) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/view/discount-rules/card/product-rules.php?rev=3211131#L94) |  |
  | 94 | 94 | <?php |
  | 95 | 95 | echo '<div class="btn elex-light-blue-bg">' . esc\_html\_\_('\* All Products in cart \*', 'eh-dynamic-pricing-discounts') . '</div>'; |
  | 96 |  | ?> |
  |  | 96 | ?> |
  | 97 | 97 | </div> |
  | 98 | 98 | </div> |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/card/product-rules.php?rev=3133197#L154) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/view/discount-rules/card/product-rules.php?rev=3211131#L154) |  |
  | 154 | 154 | } |
  | 155 | 155 | } |
  | 156 |  | }~~else~~{ |
  |  | 156 | } else { |
  | 157 | 157 | echo '<div class="btn elex-light-blue-bg">' . esc\_html\_\_(' - - ', 'eh-dynamic-pricing-discounts') . '</div>'; |
  | 158 | 158 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/card/product-rules.php?rev=3133197#L176) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/view/discount-rules/card/product-rules.php?rev=3211131#L176) |  |
  | 176 | 176 | </div> |
  | 177 | 177 | <div class="d-flex justify-content-between"> |
  | 178 |  | <h6 class="mb-0"><?php esc\_html\_e('Minimum Number of Previous Order: ', 'eh-dynamic-pricing-discounts');?> <?php echo esc\_html(isset($value['prev\_order\_count']) && !empty($value['prev\_order\_count']) ? $value['prev\_order\_count'] : ' - - '); ?></h6> |
  | 179 |  | <h6 class="mb-0"><?php esc\_html\_e('Minimum Total Spending on Previous Order: ', 'eh-dynamic-pricing-discounts');?> <?php echo esc\_html(isset($value['prev\_order\_total\_amt']) && !empty($value['prev\_order\_total\_amt']) ? $value['prev\_order\_total\_amt'] : ' - - '); ?></h6> |
  |  | 178 | <h6 class="mb-0"><?php esc\_html\_e('Minimum Number of Previous Order: ', 'eh-dynamic-pricing-discounts'); ?> <?php echo esc\_html(isset($value['prev\_order\_count']) && !empty($value['prev\_order\_count']) ? $value['prev\_order\_count'] : ' - - '); ?></h6> |
  |  | 179 | <h6 class="mb-0"><?php esc\_html\_e('Minimum Total Spending on Previous Order: ', 'eh-dynamic-pricing-discounts'); ?> <?php echo esc\_html(isset($value['prev\_order\_total\_amt']) && !empty($value['prev\_order\_total\_amt']) ? $value['prev\_order\_total\_amt'] : ' - - '); ?></h6> |
  | 180 | 180 | </div> |
  | 181 | 181 | </div> |
* ## [elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/view/discount-rules/popup/category-rules.php](/changeset/3211131/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/view/discount-rules/popup/category-rules.php "Show the changeset 3211131 restricted to elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/view/discount-rules/popup/category-rules.php")

  | [r3049195](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/popup/category-rules.php?rev=3049195#L5 "Show revision 3049195 of this file in browser") | [r3211131](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/view/discount-rules/popup/category-rules.php?rev=3211131#L5 "Show revision 3211131 of this file in browser") |  |
  | --- | --- | --- |
  | 5 | 5 | if (isset($\_REQUEST['edit']) && !empty($\_REQUEST['edit'])) { |
  | 6 | 6 | $edit\_value = sanitize\_text\_field($\_REQUEST['edit']); |
  | 7 |  | echo '<input type="hidden" name="update" value="' . esc\_attr($edit\_value) . '" >'; |
  |  | 7 | echo '<input type="hidden" name="update" value="' . esc\_attr($edit\_value) . '" >'; |
  | 8 | 8 | } |
  | 9 | 9 | ?> |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/popup/category-rules.php?rev=3049195#L101) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/view/discount-rules/popup/category-rules.php?rev=3211131#L101) |  |
  | 101 | 101 | <span><?php esc\_html\_e('Restrictions', 'eh-dynamic-pricing-discounts'); ?><sup class="elex\_dp\_go\_premium\_color"><?php esc\_html\_e('[Premium]', 'eh-dynamic-pricing-discounts'); ?></sup></span> |
  | 102 | 102 | </div> |
  | 103 |  | </div> |
  |  | 103 | </div> |
  | 104 | 104 |  |
  | 105 | 105 | <!-- tabs content --> |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/popup/category-rules.php?rev=3049195#L161) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/view/discount-rules/popup/category-rules.php?rev=3211131#L161) |  |
  | 161 | 161 | <div class="col-md-8"> |
  | 162 | 162 | <select name="check\_on" id="check\_on" class="form-select min-width-100"> |
  | 163 |  | <option value="Quantity" <?php selected(!empty($\_REQUEST['check\_on']) && (~~$\_REQUEST['check\_on'] == 'Quantity'~~)); ?>><?php esc\_html\_e('No. of items', 'eh-dynamic-pricing-discounts'); ?></option> |
  | 164 |  | <option value="Weight" <?php selected(!empty($\_REQUEST['check\_on']) && (~~$\_REQUEST['check\_on'] == 'Weight'~~)); ?>><?php esc\_html\_e('Weight', 'eh-dynamic-pricing-discounts'); ?></option> |
  | 165 |  | <option value="Price" <?php selected(!empty($\_REQUEST['check\_on']) && (~~$\_REQUEST['check\_on'] == 'Price'~~)); ?>><?php esc\_html\_e('Price', 'eh-dynamic-pricing-discounts'); ?></option> |
  | 166 |  | <option value="TotalQuantity" <?php selected(!empty($\_REQUEST['check\_on']) && (~~$\_REQUEST['check\_on'] == 'TotalQuantity'~~)); ?>><?php esc\_html\_e('No. of Units', 'eh-dynamic-pricing-discounts'); ?></option> |
  |  | 163 | <option value="Quantity" <?php selected(!empty($\_REQUEST['check\_on']) && ( $\_REQUEST['check\_on'] == 'Quantity' )); ?>><?php esc\_html\_e('No. of items', 'eh-dynamic-pricing-discounts'); ?></option> |
  |  | 164 | <option value="Weight" <?php selected(!empty($\_REQUEST['check\_on']) && ( $\_REQUEST['check\_on'] == 'Weight' )); ?>><?php esc\_html\_e('Weight', 'eh-dynamic-pricing-discounts'); ?></option> |
  |  | 165 | <option value="Price" <?php selected(!empty($\_REQUEST['check\_on']) && ( $\_REQUEST['check\_on'] == 'Price' )); ?>><?php esc\_html\_e('Price', 'eh-dynamic-pricing-discounts'); ?></option> |
  |  | 166 | <option value="TotalQuantity" <?php selected(!empty($\_REQUEST['check\_on']) && ( $\_REQUEST['check\_on'] == 'TotalQuantity' )); ?>><?php esc\_html\_e('No. of Units', 'eh-dynamic-pricing-discounts'); ?></option> |
  | 167 | 167 | </select> |
  | 168 | 168 | </div> |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/popup/category-rules.php?rev=3049195#L211) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/view/discount-rules/popup/category-rules.php?rev=3211131#L211) |  |
  | 211 | 211 | <select name="discount\_type" id="discount\_type" |
  | 212 | 212 | class="form-select min-width-100 elex-dynamic-pricing-discount-type-select"> |
  | 213 |  | <option value="Percent Discount" <?php selected(!empty($\_REQUEST['discount\_type']) && (~~$\_REQUEST['discount\_type'] == 'Percent Discount'~~)); ?>><?php esc\_html\_e('Percent Discount', 'eh-dynamic-pricing-discounts'); ?></option> |
  | 214 |  | <option value="Flat Discount" <?php selected(!empty($\_REQUEST['discount\_type']) && (~~$\_REQUEST['discount\_type'] == 'Flat Discount'~~)); ?>><?php esc\_html\_e('Flat Discount', 'eh-dynamic-pricing-discounts'); ?></option> |
  | 215 |  | <option value="Fixed Price" <?php selected(!empty($\_REQUEST['discount\_type']) && (~~$\_REQUEST['discount\_type'] == 'Fixed Price'~~)); ?>><?php esc\_html\_e('Fixed Price', 'eh-dynamic-pricing-discounts'); ?></option> |
  |  | 213 | <option value="Percent Discount" <?php selected(!empty($\_REQUEST['discount\_type']) && ( $\_REQUEST['discount\_type'] == 'Percent Discount' )); ?>><?php esc\_html\_e('Percent Discount', 'eh-dynamic-pricing-discounts'); ?></option> |
  |  | 214 | <option value="Flat Discount" <?php selected(!empty($\_REQUEST['discount\_type']) && ( $\_REQUEST['discount\_type'] == 'Flat Discount' )); ?>><?php esc\_html\_e('Flat Discount', 'eh-dynamic-pricing-discounts'); ?></option> |
  |  | 215 | <option value="Fixed Price" <?php selected(!empty($\_REQUEST['discount\_type']) && ( $\_REQUEST['discount\_type'] == 'Fixed Price' )); ?>><?php esc\_html\_e('Fixed Price', 'eh-dynamic-pricing-discounts'); ?></option> |
  | 216 | 216 | <option value="Coupon Discount" disabled><?php esc\_html\_e('Coupon Discount', 'eh-dynamic-pricing-discounts'); ?> |
  | 217 | 217 | <sup class="elex\_dp\_go\_premium\_color"><?php esc\_html\_e('[Premium]', 'eh-dynamic-pricing-discounts'); ?></sup></option> |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/popup/category-rules.php?rev=3049195#L224) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/view/discount-rules/popup/category-rules.php?rev=3211131#L224) |  |
  | 224 | 224 | <div class="d-flex gap-2 justify-content-between"> |
  | 225 | 225 | <h6 id="discount\_value" class="mb-0 elex-dynamic-input-label"><?php esc\_html\_e('Discount Percent', 'eh-dynamic-pricing-discounts'); ?><span class="text-danger">\*</span> </h6> |
  | 226 |  | <i id="discount\_desc" class="desc-tip fa-regular fa-circle-question" data-tip='<?php echo esc\_attr\_\_('If you select `Percentage Discount`, the given percentage (value) would be discounted on each unit of the product in the cart. |
  |  | 226 | <i id="discount\_desc" class="desc-tip fa-regular fa-circle-question" data-tip=' |
  |  | 227 | <?php |
  |  | 228 | echo esc\_attr\_\_('If you select `Percentage Discount`, the given percentage (value) would be discounted on each unit of the product in the cart. |
  | 227 | 229 | If you select `Flat Discount`, the given amount (value) would be discounted at subtotal level in the cart. |
  | 228 | 230 | If you select `Fixed Price`, the original price of the product is replaced by the given fixed price (value). |
  | 229 |  | If you select `Coupon dicount`, the original price of the cart total is discounted with the selected coupon offer (value).'); ?>'></i> |
  |  | 231 | If you select `Coupon dicount`, the original price of the cart total is discounted with the selected coupon offer (value).'); |
  |  | 232 | ?> |
  |  | 233 | '></i> |
  | 230 | 234 | </div> |
  | 231 | 235 | </div> |
* ## [elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/view/discount-rules/popup/product-rules.php](/changeset/3211131/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/view/discount-rules/popup/product-rules.php "Show the changeset 3211131 restricted to elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/view/discount-rules/popup/product-rules.php")

  | [r3049195](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/popup/product-rules.php?rev=3049195#L238 "Show revision 3049195 of this file in browser") | [r3211131](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/view/discount-rules/popup/product-rules.php?rev=3211131#L238 "Show revision 3211131 of this file in browser") |  |
  | --- | --- | --- |
  | 238 | 238 | <div class="col-md-8"> |
  | 239 | 239 | <select name="check\_on" id="check\_on" class="form-select min-width-100"> |
  | 240 |  | <option value="Quantity" <?php selected(!empty($\_REQUEST['check\_on']) && (~~$\_REQUEST['check\_on'] == 'Quantity'~~)); ?>><?php esc\_html\_e('No. of items', 'eh-dynamic-pricing-discounts'); ?></option> |
  | 241 |  | <option value="Weight" <?php selected(!empty($\_REQUEST['check\_on']) && (~~$\_REQUEST['check\_on'] == 'Weight'~~)); ?>><?php esc\_html\_e('Weight', 'eh-dynamic-pricing-discounts'); ?></option> |
  | 242 |  | <option value="Price" <?php selected(!empty($\_REQUEST['check\_on']) && (~~$\_REQUEST['check\_on'] == 'Price'~~)); ?>><?php esc\_html\_e('Price', 'eh-dynamic-pricing-discounts'); ?></option> |
  | 243 |  | <option value="Units" <?php selected(!empty($\_REQUEST['check\_on']) && (~~$\_REQUEST['check\_on'] == 'Units'~~)); ?>><?php esc\_html\_e('No. of Units', 'eh-dynamic-pricing-discounts'); ?></option> |
  |  | 240 | <option value="Quantity" <?php selected(!empty($\_REQUEST['check\_on']) && ( $\_REQUEST['check\_on'] == 'Quantity' )); ?>><?php esc\_html\_e('No. of items', 'eh-dynamic-pricing-discounts'); ?></option> |
  |  | 241 | <option value="Weight" <?php selected(!empty($\_REQUEST['check\_on']) && ( $\_REQUEST['check\_on'] == 'Weight' )); ?>><?php esc\_html\_e('Weight', 'eh-dynamic-pricing-discounts'); ?></option> |
  |  | 242 | <option value="Price" <?php selected(!empty($\_REQUEST['check\_on']) && ( $\_REQUEST['check\_on'] == 'Price' )); ?>><?php esc\_html\_e('Price', 'eh-dynamic-pricing-discounts'); ?></option> |
  |  | 243 | <option value="Units" <?php selected(!empty($\_REQUEST['check\_on']) && ( $\_REQUEST['check\_on'] == 'Units' )); ?>><?php esc\_html\_e('No. of Units', 'eh-dynamic-pricing-discounts'); ?></option> |
  | 244 | 244 | </select> |
  | 245 | 245 | </div> |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/popup/product-rules.php?rev=3049195#L288) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/view/discount-rules/popup/product-rules.php?rev=3211131#L288) |  |
  | 288 | 288 | <select name="discount\_type" id="discount\_type" |
  | 289 | 289 | class="form-select min-width-100 elex-dynamic-pricing-discount-type-select"> |
  | 290 |  | <option value="Percent Discount" <?php selected(!empty($\_REQUEST['discount\_type']) && (~~$\_REQUEST['discount\_type'] == 'Percent Discount'~~)); ?>><?php esc\_html\_e('Percent Discount', 'eh-dynamic-pricing-discounts'); ?></option> |
  | 291 |  | <option value="Flat Discount" <?php selected(!empty($\_REQUEST['discount\_type']) && (~~$\_REQUEST['discount\_type'] == 'Flat Discount'~~)); ?>><?php esc\_html\_e('Flat Discount', 'eh-dynamic-pricing-discounts'); ?></option> |
  | 292 |  | <option value="Fixed Price" <?php selected(!empty($\_REQUEST['discount\_type']) && (~~$\_REQUEST['discount\_type'] == 'Fixed Price'~~)); ?>><?php esc\_html\_e('Fixed Price', 'eh-dynamic-pricing-discounts'); ?></option> |
  |  | 290 | <option value="Percent Discount" <?php selected(!empty($\_REQUEST['discount\_type']) && ( $\_REQUEST['discount\_type'] == 'Percent Discount' )); ?>><?php esc\_html\_e('Percent Discount', 'eh-dynamic-pricing-discounts'); ?></option> |
  |  | 291 | <option value="Flat Discount" <?php selected(!empty($\_REQUEST['discount\_type']) && ( $\_REQUEST['discount\_type'] == 'Flat Discount' )); ?>><?php esc\_html\_e('Flat Discount', 'eh-dynamic-pricing-discounts'); ?></option> |
  |  | 292 | <option value="Fixed Price" <?php selected(!empty($\_REQUEST['discount\_type']) && ( $\_REQUEST['discount\_type'] == 'Fixed Price' )); ?>><?php esc\_html\_e('Fixed Price', 'eh-dynamic-pricing-discounts'); ?></option> |
  | 293 | 293 | <option value="Coupon Discount" disabled><?php esc\_html\_e('Coupon Discount', 'eh-dynamic-pricing-discounts'); ?> |
  | 294 | 294 | <sup class="elex\_dp\_go\_premium\_color"><?php esc\_html\_e('[Premium]', 'eh-dynamic-pricing-discounts'); ?></sup></option> |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/popup/product-rules.php?rev=3049195#L301) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/view/discount-rules/popup/product-rules.php?rev=3211131#L301) |  |
  | 301 | 301 | <div class="d-flex gap-2 justify-content-between"> |
  | 302 | 302 | <h6 id="discount\_value" class="mb-0 elex-dynamic-input-label"><?php esc\_html\_e('Discount Percent', 'eh-dynamic-pricing-discounts'); ?><span class="text-danger">\*</span> </h6> |
  | 303 |  | <i id="discount\_desc" class="desc-tip fa-regular fa-circle-question" data-tip='<?php echo esc\_attr\_\_('If you select `Percentage Discount`, the given percentage (value) would be discounted on each unit of the product in the cart. |
  |  | 303 | <i id="discount\_desc" class="desc-tip fa-regular fa-circle-question" data-tip=' |
  |  | 304 | <?php |
  |  | 305 | echo esc\_attr\_\_('If you select `Percentage Discount`, the given percentage (value) would be discounted on each unit of the product in the cart. |
  | 304 | 306 | If you select `Flat Discount`, the given amount (value) would be discounted at subtotal level in the cart. |
  | 305 | 307 | If you select `Fixed Price`, the original price of the product is replaced by the given fixed price (value). |
  | 306 |  | If you select `Coupon dicount`, the original price of the cart total is discounted with the selected coupon offer (value).'); ?>'></i> |
  |  | 308 | If you select `Coupon dicount`, the original price of the cart total is discounted with the selected coupon offer (value).'); |
  |  | 309 | ?> |
  |  | 310 | '></i> |
  | 307 | 311 | </div> |
  | 308 | 312 | </div> |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/popup/product-rules.php?rev=3049195#L409) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/view/discount-rules/popup/product-rules.php?rev=3211131#L413) |  |
  | 409 | 413 | foreach ($roles as $key=>$val) { |
  | 410 | 414 | $is\_selected =in\_array($key, $selected)?' selected ':' '; |
  | 411 |  | echo "<option value='$key' " . esc\_attr($is\_selected). " >$val</option>"; |
  |  | 415 | echo "<option value='$key' " . esc\_attr($is\_selected) . " >$val</option>"; |
  | 412 | 416 | } |
  | 413 | 417 | ?> |
* ## [elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/view/help-support/faqs.php](/changeset/3211131/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/view/help-support/faqs.php "Show the changeset 3211131 restricted to elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/view/help-support/faqs.php")

  | [r3049195](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/help-support/faqs.php?rev=3049195#L5 "Show revision 3049195 of this file in browser") | [r3211131](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/view/help-support/faqs.php?rev=3211131#L5 "Show revision 3211131 of this file in browser") |  |
  | --- | --- | --- |
  | 5 | 5 |  |
  | 6 | 6 | $faqs = array( |
  | 7 |  | ~~array(~~ |
  | 8 |  | ~~'question' => esc\_html\_\_('Can the BOGO rule apply percentage discounts on the second product?', 'eh-dynamic-pricing-discounts'),~~ |
  | 9 |  | ~~'answer'   => esc\_html\_\_('Currently, the plugin only allows you to keep the second product as a free product. However, our team has explored the feasibility of giving a percentage discount on it, and this feature will be available in the upcoming version.', 'eh-dynamic-pricing-discounts'),~~ |
  | 10 |  | ~~),~~ |
  | 11 |  | ~~array(~~ |
  | 12 |  | ~~'question' => esc\_html\_\_('How can I apply coupon codes for the discount rules?', 'eh-dynamic-pricing-discounts'),~~ |
  | 13 |  | ~~'answer'   => esc\_html\_\_('While creating a rule, you can apply a coupon discount by selecting "Coupon Discount" as the discount type. Then, you can either create a dynamic coupon or associate an existing WooCommerce coupon with the rule from the "Associate Coupon & Roles" section.', 'eh-dynamic-pricing-discounts'),~~ |
  | 14 |  | ~~),~~ |
  | 15 |  | ~~array(~~ |
  | 16 |  | ~~'question' => esc\_html\_\_('Can I offer the cheapest product in the cart as a free product to the customer?', 'eh-dynamic-pricing-discounts'),~~ |
  | 17 |  | ~~'answer'   => esc\_html\_\_('Yes, you can offer the cheapest product in the cart as a free product. To do this, you need to create a BOGO rule and select "The Cheapest product in the Cart" under the free products section.', 'eh-dynamic-pricing-discounts'),~~ |
  | 18 |  | ~~),~~ |
  | 19 | 7 | array( |
  | 20 |  | ~~'question' => esc\_html\_\_('What does the "504 Timeout error" on the shop page mean~~?', 'eh-dynamic-pricing-discounts'), |
  | 21 |  | ~~'answer'   => esc\_html\_\_('When a website has a large number of products and multiple rules created with the plugin, the scanning of all the products during page loading can lead to performance issues and cause a 504 error to occur~~.', 'eh-dynamic-pricing-discounts'), |
  | 22 |  | ), |
  |  | 8 | 'question' => esc\_html\_\_('Can the BOGO rule apply percentage discounts on the second product?', 'eh-dynamic-pricing-discounts'), |
  |  | 9 | 'answer'   => esc\_html\_\_('Currently, the plugin only allows you to keep the second product as a free product. However, our team has explored the feasibility of giving a percentage discount on it, and this feature will be available in the upcoming version.', 'eh-dynamic-pricing-discounts'), |
  |  | 10 | ), |
  | 23 | 11 | array( |
  | 24 |  | ~~'question' => esc\_html\_\_('If the BOGO rule is satisfied, does it automatically add the free product to the cart~~?', 'eh-dynamic-pricing-discounts'), |
  | 25 |  | ~~'answer'   => esc\_html\_\_('Yes, the plugin automatically adds the free product to the cart page if the rule is satisfied~~.', 'eh-dynamic-pricing-discounts'), |
  | 26 |  | ), |
  |  | 12 | 'question' => esc\_html\_\_('How can I apply coupon codes for the discount rules?', 'eh-dynamic-pricing-discounts'), |
  |  | 13 | 'answer'   => esc\_html\_\_('While creating a rule, you can apply a coupon discount by selecting "Coupon Discount" as the discount type. Then, you can either create a dynamic coupon or associate an existing WooCommerce coupon with the rule from the "Associate Coupon & Roles" section.', 'eh-dynamic-pricing-discounts'), |
  |  | 14 | ), |
  | 27 | 15 | array( |
  | 28 |  | ~~'question' => esc\_html\_\_('What is the difference between a product rule and a cart rule~~?', 'eh-dynamic-pricing-discounts'), |
  | 29 |  | ~~'answer'   => esc\_html\_\_('In a product rule, you can select and apply discounts to the specific product(s) in your store. On the other hand, a cart rule allows you to give a discount for the products that are added to the cart~~.', 'eh-dynamic-pricing-discounts'), |
  | 30 |  | ), |
  |  | 16 | 'question' => esc\_html\_\_('Can I offer the cheapest product in the cart as a free product to the customer?', 'eh-dynamic-pricing-discounts'), |
  |  | 17 | 'answer'   => esc\_html\_\_('Yes, you can offer the cheapest product in the cart as a free product. To do this, you need to create a BOGO rule and select "The Cheapest product in the Cart" under the free products section.', 'eh-dynamic-pricing-discounts'), |
  |  | 18 | ), |
  | 31 | 19 | array( |
  | 32 |  | 'question' => esc\_html\_\_('How can I customize the pricing table?', 'eh-dynamic-pricing-discounts'), |
  | 33 |  | 'answer'   => esc\_html\_\_('You can customize the pricing table by configuring it in the "Settings" > "Other Options" > "Pricing Table" section.', 'eh-dynamic-pricing-discounts'), |
  | 34 |  | ), |
  |  | 20 | 'question' => esc\_html\_\_('What does the "504 Timeout error" on the shop page mean?', 'eh-dynamic-pricing-discounts'), |
  |  | 21 | 'answer'   => esc\_html\_\_('When a website has a large number of products and multiple rules created with the plugin, the scanning of all the products during page loading can lead to performance issues and cause a 504 error to occur.', 'eh-dynamic-pricing-discounts'), |
  |  | 22 | ), |
  |  | 23 | array( |
  |  | 24 | 'question' => esc\_html\_\_('If the BOGO rule is satisfied, does it automatically add the free product to the cart?', 'eh-dynamic-pricing-discounts'), |
  |  | 25 | 'answer'   => esc\_html\_\_('Yes, the plugin automatically adds the free product to the cart page if the rule is satisfied.', 'eh-dynamic-pricing-discounts'), |
  |  | 26 | ), |
  |  | 27 | array( |
  |  | 28 | 'question' => esc\_html\_\_('What is the difference between a product rule and a cart rule?', 'eh-dynamic-pricing-discounts'), |
  |  | 29 | 'answer'   => esc\_html\_\_('In a product rule, you can select and apply discounts to the specific product(s) in your store. On the other hand, a cart rule allows you to give a discount for the products that are added to the cart.', 'eh-dynamic-pricing-discounts'), |
  |  | 30 | ), |
  |  | 31 | array( |
  |  | 32 | 'question' => esc\_html\_\_('How can I customize the pricing table?', 'eh-dynamic-pricing-discounts'), |
  |  | 33 | 'answer'   => esc\_html\_\_('You can customize the pricing table by configuring it in the "Settings" > "Other Options" > "Pricing Table" section.', 'eh-dynamic-pricing-discounts'), |
  |  | 34 | ), |
  | 35 | 35 | ); |
  | 36 | 36 | ?> |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/help-support/faqs.php?rev=3049195#L44) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/view/help-support/faqs.php?rev=3211131#L44) |  |
  | 44 | 44 | data-bs-target="#flush-collapse<?php echo esc\_attr($index + 1); ?>" |
  | 45 | 45 | aria-expanded="false" aria-controls="flush-collapse<?php echo esc\_attr($index + 1); ?>"> |
  | 46 |  | <div><?php echo esc\_html\_\_('Q', 'eh-dynamic-pricing-discounts') . (~~$index + 1~~) . '.'; ?></div> |
  |  | 46 | <div><?php echo esc\_html\_\_('Q', 'eh-dynamic-pricing-discounts') . ( $index + 1 ) . '.'; ?></div> |
  | 47 | 47 | <div><?php echo esc\_html($faq['question']); ?></div> |
  | 48 | 48 | </button> |
* ## [elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/view/help-support/ticket.php](/changeset/3211131/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/view/help-support/ticket.php "Show the changeset 3211131 restricted to elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/view/help-support/ticket.php")

  | [r3049195](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/help-support/ticket.php?rev=3049195#L7 "Show revision 3049195 of this file in browser") | [r3211131](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/view/help-support/ticket.php?rev=3211131#L7 "Show revision 3211131 of this file in browser") |  |
  | --- | --- | --- |
  | 7 | 7 | <div class="p-1 fw-bold"> |
  | 8 | 8 | <p><?php esc\_html\_e('Before raising the ticket, we recommend you to go through our', 'eh-dynamic-pricing-discounts'); ?> |
  | 9 |  | <a href="<?php echo esc\_url('https://elextensions.com/knowledge-base/set-up-elex-dynamic-pricing-and-discounts-plugin-for-woocommerce/'); ?>" target="\_blank"><?php esc\_html\_e('detailed documentation.', 'eh-dynamic-pricing-discounts'); ?></a></p> |
  |  | 9 | <a href="<?php echo esc\_url('https://elextensions.com/knowledge-base/set-up-elex-dynamic-pricing-and-discounts-plugin-for-woocommerce/'); ?>" target="\_blank"><?php esc\_html\_e('detailed documentation.', 'eh-dynamic-pricing-discounts'); ?></a></p> |
  | 10 | 10 | <p><?php esc\_html\_e('Or', 'eh-dynamic-pricing-discounts'); ?></p> |
  | 11 | 11 | <p class="mb-0"><?php esc\_html\_e('To get in touch with our helpdesk representative. Just raise a support ticket on our website.', 'eh-dynamic-pricing-discounts'); ?></p> |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/help-support/ticket.php?rev=3049195#L38) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/view/help-support/ticket.php?rev=3211131#L38) |  |
  | 38 | 38 | <script> |
  | 39 | 39 | jQuery(document).ready(function() { |
  | 40 |  |  |
  |  | 40 |  |
  | 41 | 41 | if (hasURLKey('downloadfailure')) { |
  | 42 | 42 | showSuccessNotification('downloadfailure'); |
* ## [elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/view/market.php](/changeset/3211131/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/view/market.php "Show the changeset 3211131 restricted to elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/view/market.php")

  | [r3049195](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/market.php?rev=3049195#L16 "Show revision 3049195 of this file in browser") | [r3211131](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/view/market.php?rev=3211131#L16 "Show revision 3211131 of this file in browser") |  |
  | --- | --- | --- |
  | 16 | 16 | <div class="row"> |
  | 17 | 17 | <div class=" elex-license-like-img-container col-md-5"> |
  | 18 |  | <?php $dp\_premium\_url = ~~"https://elextensions.com/plugin/dynamic-pricing-and-discounts-plugin-for-woocommerce/?utm\_source=plugin-settings-related&utm\_medium=wp-admin&utm\_campaign=in-prod-ads"~~ ?> |
  |  | 18 | <?php $dp\_premium\_url = 'https://elextensions.com/plugin/dynamic-pricing-and-discounts-plugin-for-woocommerce/?utm\_source=plugin-settings-related&utm\_medium=wp-admin&utm\_campaign=in-prod-ads'; ?> |
  | 19 | 19 | <a target="\_blank" href="<?php echo esc\_url($dp\_premium\_url); ?>"> |
  | 20 | 20 | <img src="<?php echo esc\_url(ELEX\_DP\_CRM\_MAIN\_URL . '/img/dynamic\_pricing.png'); ?>" class="marketing\_logos" alt="<?php esc\_attr\_e('Dynamic Pricing Logo', 'eh-dynamic-pricing-discounts'); ?>"> |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/market.php?rev=3049195#L38) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/view/market.php?rev=3211131#L38) |  |
  | 38 | 38 | </p> |
  | 39 | 39 | </ul> |
  | 40 |  | <?php $dp\_documentation\_url = ~~"https://elextensions.com/knowledge-base/set-up-elex-dynamic-pricing-and-discounts-plugin-for-woocommerce/"~~ ?> |
  |  | 40 | <?php $dp\_documentation\_url = 'https://elextensions.com/knowledge-base/set-up-elex-dynamic-pricing-and-discounts-plugin-for-woocommerce/'; ?> |
  | 41 | 41 | <center> <a href="<?php echo esc\_url($dp\_documentation\_url); ?>" target="\_blank" class="button button-primary"><?php esc\_html\_e('Documentation', 'eh-dynamic-pricing-discounts'); ?></a></center> |
  | 42 | 42 | </div> |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/market.php?rev=3049195#L48) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/view/market.php?rev=3211131#L48) |  |
  | 48 | 48 | <h6 class="mb-4"><b><?php esc\_html\_e('You May Also like', 'eh-dynamic-pricing-discounts'); ?></b></h6> |
  | 49 | 49 | <div class="row"> |
  | 50 |  | <?php $plugins = array( |
  |  | 50 | <?php |
  |  | 51 | $plugins = array( |
  | 51 | 52 | array( |
  | 52 | 53 | 'url'   => 'https://elextensions.com/plugin/woocommerce-catalog-mode-wholesale-role-based-pricing/?utm\_source=plugin-settings-related&utm\_medium=wp-admin&utm\_campaign=in-prod-ads', |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/market.php?rev=3049195#L71) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/view/market.php?rev=3211131#L72) |  |
  | 71 | 72 | ); |
  | 72 | 73 |  |
  | 73 |  | foreach ($plugins as $plugin) : ?> |
  |  | 74 | foreach ($plugins as $plugin) : |
  |  | 75 | ?> |
  | 74 | 76 | <div class="col-md-3 col-6"> |
  | 75 | 77 | <div class="elex-license-like-img-container w-100  mb-3"> |
* ## [elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/view/settings/rules-execution-order.php](/changeset/3211131/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/view/settings/rules-execution-order.php "Show the changeset 3211131 restricted to elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/view/settings/rules-execution-order.php")

  | [r3049195](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/settings/rules-execution-order.php?rev=3049195#L33 "Show revision 3049195 of this file in browser") | [r3211131](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/admin/ui/view/settings/rules-execution-order.php?rev=3211131#L33 "Show revision 3211131 of this file in browser") |  |
  | --- | --- | --- |
  | 33 | 33 | </th> |
  | 34 | 34 | <td class="text-start fw-bold"> |
  | 35 |  | <?php if($key == 'product\_rules' || $key == 'category\_rules'){ |
  |  | 35 | <?php |
  |  | 36 | if ($key == 'product\_rules' || $key == 'category\_rules') { |
  | 36 | 37 | echo esc\_html($rules\_modes[$key]); |
  | 37 |  | }else{ |
  | 38 |  | echo esc\_html($rules\_modes[$key]);?> |
  | 39 |  | <sup class="elex\_dp\_go\_premium\_color"><?php esc\_html\_e('[Premium]', 'eh-dynamic-pricing-discounts'); ?></sup><?php |
  |  | 38 | } else { |
  |  | 39 | echo esc\_html($rules\_modes[$key]); |
  |  | 40 | ?> |
  |  | 41 | <sup class="elex\_dp\_go\_premium\_color"><?php esc\_html\_e('[Premium]', 'eh-dynamic-pricing-discounts'); ?></sup> |
  |  | 42 | <?php |
  | 40 | 43 |  |
  | 41 |  | } |
  |  | 44 | } |
  | 42 | 45 | ?> |
  | 43 | 46 | </td> |
  | 44 | 47 | <td> |
  | 45 | 48 | <label class="elex-switch-btn"> |
  | 46 |  | <?php if~~($key == 'product\_rules' || $key == 'category\_rules')~~{ ?> |
  |  | 49 | <?php if ($key == 'product\_rules' || $key == 'category\_rules') { ?> |
  | 47 | 50 | <input type="checkbox" name='enabled\_modes[<?php echo esc\_attr($key); ?>]' value='<?php echo esc\_attr($key); ?>' <?php echo in\_array($key, $execution\_order) ? 'checked' : ''; ?>> |
  | 48 | 51 | <div class="elex-switch-icon round"></div> |
  | 49 |  | <?php }~~else~~{ ?> |
  |  | 52 | <?php } else { ?> |
  | 50 | 53 | <div class="elex-switch-icon round"></div> |
  | 51 | 54 | <?php |
  | 52 | 55 |  |
  | 53 | 56 | } |
  | 54 |  | ?> |
  |  | 57 | ?> |
  | 55 | 58 | </label> |
  | 56 | 59 | </td> |
* ## [elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/elex-dynamic-pricing-and-discounts-for-woocommerce-basic-version.php](/changeset/3211131/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/elex-dynamic-pricing-and-discounts-for-woocommerce-basic-version.php "Show the changeset 3211131 restricted to elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/elex-dynamic-pricing-and-discounts-for-woocommerce-basic-version.php")

  | [r3189520](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/elex-dynamic-pricing-and-discounts-for-woocommerce-basic-version.php?rev=3189520#L4 "Show revision 3189520 of this file in browser") | [r3211131](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/elex-dynamic-pricing-and-discounts-for-woocommerce-basic-version.php?rev=3211131#L4 "Show revision 3211131 of this file in browser") |  |
  | --- | --- | --- |
  | 4 | 4 | \*   Plugin URI: https://elextensions.com/plugin/elex-dynamic-pricing-and-discounts-plugin-for-woocommerce-free-version/ |
  | 5 | 5 | \*   Description: This plugin helps you to set discounts and pricing dynamically based on minimum quantity,weight,price and allow you to set maximum allowed discounts on every rule. |
  | 6 |  | \*   Version: 2.1.~~7~~ |
  |  | 6 | \*   Version: 2.1.8 |
  | 7 | 7 | \*   Author: ELEXtensions |
  | 8 | 8 | \*   WC requires at least: 3.0.0 |
  | 9 |  | \*   WC tested up to: 9.~~4~~ |
  |  | 9 | \*   WC tested up to: 9.5 |
  | 10 | 10 | \*   Author URI: https://elextensions.com |
  | 11 | 11 | \*   Copyright: 2018 ELEX. |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/elex-dynamic-pricing-and-discounts-for-woocommerce-basic-version.php?rev=3189520#L182) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/elex-dynamic-pricing-and-discounts-for-woocommerce-basic-version.php?rev=3211131#L182) |  |
  | 182 | 182 |  |
  | 183 | 183 | $rules\_indexing\_status   = get\_option('xa\_dp\_rules\_indexing\_status'); |
  | 184 |  | if~~(!isset($rules\_indexing\_status) || $rules\_indexing\_status == false)~~{ |
  |  | 184 | if (!isset($rules\_indexing\_status) || $rules\_indexing\_status == false) { |
  | 185 | 185 | require\_once plugin\_dir\_path(\_\_FILE\_\_) . 'includes/elex-dynamic-pricing-plugin-activator.php'; |
  | 186 | 186 | Elex\_dynamic\_pricing\_plugin\_Activator::activate(); |
* ## [elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/includes/elex-common-functions.php](/changeset/3211131/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/includes/elex-common-functions.php "Show the changeset 3211131 restricted to elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/includes/elex-common-functions.php")

  | [r3004919](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/includes/elex-common-functions.php?rev=3004919#L394 "Show revision 3004919 of this file in browser") | [r3211131](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/includes/elex-common-functions.php?rev=3211131#L394 "Show revision 3211131 of this file in browser") |  |
  | --- | --- | --- |
  | 394 | 394 | $parent\_id =$product->get\_parent\_id(); |
  | 395 | 395 | $parent\_tags = get\_the\_terms($parent\_id, 'product\_tag'); |
  | 396 |  | if~~($parent\_tags)~~{ |
  |  | 396 | if ($parent\_tags) { |
  | 397 | 397 | foreach ($parent\_tags as $key => $parent\_tag) { |
  | 398 | 398 | array\_push($tags\_ids\_array, $parent\_tag->term\_id); |
* ## [elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/includes/elex-dynamic-pricing-plugin-activator.php](/changeset/3211131/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/includes/elex-dynamic-pricing-plugin-activator.php "Show the changeset 3211131 restricted to elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/includes/elex-dynamic-pricing-plugin-activator.php")

  | [r3004919](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/includes/elex-dynamic-pricing-plugin-activator.php?rev=3004919#L35 "Show revision 3004919 of this file in browser") | [r3211131](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/includes/elex-dynamic-pricing-plugin-activator.php?rev=3211131#L35 "Show revision 3211131 of this file in browser") |  |
  | --- | --- | --- |
  | 35 | 35 | $dummy\_option = array('product\_rules' => array(), 'combinational\_rules' => array(), 'cat\_combinational\_rules' => array(), 'category\_rules' => array(), 'cart\_rules' => array(), 'buy\_get\_free\_rules' => array() ,'BOGO\_category\_rules'=>array(), 'bogo\_tag\_rules' =>array(), 'tag\_rules' => array()); |
  | 36 | 36 | $prev\_rules   = get\_option('xa\_dp\_rules', $dummy\_option); |
  | 37 |  | foreach~~($prev\_rules as $rule\_type => $rules)~~{ |
  |  | 37 | foreach ($prev\_rules as $rule\_type => $rules) { |
  | 38 | 38 | $reordered\_rules = []; |
  | 39 | 39 | $i = 1; |
  | 40 |  | if($rules) { |
  | 41 |  | foreach($rules as $rule) { |
  |  | 40 | if ($rules) { |
  |  | 41 | foreach ($rules as $rule) { |
  | 42 | 42 | $reordered\_rules[$i] = $rule; |
  | 43 | 43 | $i++; |
* ## [elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/includes/wf\_api\_manager/class-wc-am-plugin-activate.php](/changeset/3211131/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/includes/wf_api_manager/class-wc-am-plugin-activate.php "Show the changeset 3211131 restricted to elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/includes/wf_api_manager/class-wc-am-plugin-activate.php")

  | [r2965037](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/includes/wf_api_manager/class-wc-am-plugin-activate.php?rev=2965037#L12 "Show revision 2965037 of this file in browser") | [r3211131](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/includes/wf_api_manager/class-wc-am-plugin-activate.php?rev=3211131#L12 "Show revision 3211131 of this file in browser") |  |
  | --- | --- | --- |
  | 12 | 12 | class WF\_Software\_Activate { |
  | 13 | 13 | private $is\_ajax; |
  | 14 |  | private $upgrade\_url; |
  | 15 |  | private $plugin\_name; |
  | 16 |  | private $product\_id; |
  | 17 |  | private $api\_key; |
  | 18 |  | private $activation\_unique\_product\_id; |
  | 19 |  | private $renew\_license\_url; |
  | 20 |  | private $instance; |
  | 21 |  | private $domain; |
  | 22 |  | private $software\_version; |
  | 23 |  | private $wf\_unique\_product\_id\_key; |
  | 24 |  | private $wf\_api\_licence\_key; |
  | 25 |  | private $wf\_instance\_key; |
  |  | 14 | private $upgrade\_url; |
  |  | 15 | private $plugin\_name; |
  |  | 16 | private $product\_id; |
  |  | 17 | private $api\_key; |
  |  | 18 | private $activation\_unique\_product\_id; |
  |  | 19 | private $renew\_license\_url; |
  |  | 20 | private $instance; |
  |  | 21 | private $domain; |
  |  | 22 | private $software\_version; |
  |  | 23 | private $wf\_unique\_product\_id\_key; |
  |  | 24 | private $wf\_api\_licence\_key; |
  |  | 25 | private $wf\_instance\_key; |
  | 26 | 26 | public function \_\_construct( $upgrade\_url, $plugin\_name, $product\_id, $api\_key, $activation\_unique\_product\_id, $renew\_license\_url, $instance, $domain, $software\_version, $plugin\_or\_theme, $text\_domain, $extra, $wf\_unique\_product\_id\_key, $wf\_api\_licence\_key, $wf\_instance\_key ) { |
  | 27 | 27 | // API data |
* ## [elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/includes/wf\_api\_manager/wf\_api\_manager.php](/changeset/3211131/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/includes/wf_api_manager/wf_api_manager.php "Show the changeset 3211131 restricted to elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/includes/wf_api_manager/wf_api_manager.php")

  | [r2965037](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/includes/wf_api_manager/wf_api_manager.php?rev=2965037#L16 "Show revision 2965037 of this file in browser") | [r3211131](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/includes/wf_api_manager/wf_api_manager.php?rev=3211131#L16 "Show revision 3211131 of this file in browser") |  |
  | --- | --- | --- |
  | 16 | 16 | class WF\_API\_Manager { |
  | 17 | 17 | private $is\_ajax; |
  | 18 |  | private $upgrade\_url; |
  | 19 |  | private $plugin\_name; |
  | 20 |  | private $product\_id; |
  | 21 |  | private $api\_key; |
  | 22 |  | private $activation\_unique\_product\_id; |
  | 23 |  | private $renew\_license\_url; |
  | 24 |  | private $instance; |
  | 25 |  | private $domain; |
  | 26 |  | private $software\_version; |
  | 27 |  | private $wf\_unique\_product\_id\_key; |
  | 28 |  | private $wf\_api\_licence\_key; |
  | 29 |  | private $wf\_instance\_key; |
  | 30 |  | private $plugin\_settings\_url; |
  | 31 |  | private $plugin\_or\_theme; |
  | 32 |  | private $text\_domain; |
  | 33 |  | private $extra; |
  |  | 18 | private $upgrade\_url; |
  |  | 19 | private $plugin\_name; |
  |  | 20 | private $product\_id; |
  |  | 21 | private $api\_key; |
  |  | 22 | private $activation\_unique\_product\_id; |
  |  | 23 | private $renew\_license\_url; |
  |  | 24 | private $instance; |
  |  | 25 | private $domain; |
  |  | 26 | private $software\_version; |
  |  | 27 | private $wf\_unique\_product\_id\_key; |
  |  | 28 | private $wf\_api\_licence\_key; |
  |  | 29 | private $wf\_instance\_key; |
  |  | 30 | private $plugin\_settings\_url; |
  |  | 31 | private $plugin\_or\_theme; |
  |  | 32 | private $text\_domain; |
  |  | 33 | private $extra; |
  | 34 | 34 |  |
  | 35 | 35 | public function \_\_construct( $product\_id, $plugin\_version, $plugin\_slug, $server\_url, $plugin\_settings\_url = '' ) { |
* ## [elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-dynamic-pricing-plugin-public.php](/changeset/3211131/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-dynamic-pricing-plugin-public.php "Show the changeset 3211131 restricted to elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-dynamic-pricing-plugin-public.php")

  | [r3030019](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-dynamic-pricing-plugin-public.php?rev=3030019#L10 "Show revision 3030019 of this file in browser") | [r3211131](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-dynamic-pricing-plugin-public.php?rev=3211131#L10 "Show revision 3211131 of this file in browser") |  |
  | --- | --- | --- |
  | 10 | 10 | $GLOBALS['elex\_dp\_settings'] = get\_option('xa\_dynamic\_pricing\_setting'); |
  | 11 | 11 | add\_action('wp\_footer', 'elex\_dp\_print\_scripts\_payment\_gateway', 5); |
  | 12 |  | function elex\_dp\_print\_scripts\_payment\_gateway() |
  | 13 |  | { |
  | 14 |  | ?> |
  |  | 12 | function elex\_dp\_print\_scripts\_payment\_gateway() { |
  |  | 13 | ?> |
  | 15 | 14 | <script> |
  | 16 | 15 | jQuery(function($) { |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-dynamic-pricing-plugin-public.php?rev=3030019#L30) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-dynamic-pricing-plugin-public.php?rev=3211131#L29) |  |
  | 30 | 29 | <?php |
  | 31 | 30 | } |
  | 32 |  | function elex\_dp\_init\_calculator() |
  | 33 |  | { |
  |  | 31 | function elex\_dp\_init\_calculator() { |
  | 34 | 32 | $xa\_dp\_rules = get\_option('xa\_dp\_rules', array()); |
  | 35 | 33 | if (isset($GLOBALS['elex\_dp\_settings']) && empty($GLOBALS['elex\_dp\_settings']) || empty($xa\_dp\_rules)) { |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-dynamic-pricing-plugin-public.php?rev=3030019#L46) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-dynamic-pricing-plugin-public.php?rev=3211131#L44) |  |
  | 46 | 44 | add\_action('woocommerce\_before\_calculate\_totals', 'elex\_dp\_update\_globals'); |
  | 47 | 45 |  |
  | 48 |  |  |
  | 49 |  | function elex\_dp\_update\_globals($cart) |
  | 50 |  | { |
  |  | 46 | add\_action('woocommerce\_before\_cart\_totals', 'elex\_dp\_update\_cart\_total'); |
  |  | 47 |  |
  |  | 48 | function elex\_dp\_update\_cart\_total() { |
  |  | 49 | global $woocommerce; |
  |  | 50 | if ($woocommerce->cart) { |
  |  | 51 | $woocommerce->cart->calculate\_totals(); |
  |  | 52 | } |
  |  | 53 | } |
  |  | 54 |  |
  |  | 55 | function elex\_dp\_update\_globals( $cart) { |
  | 51 | 56 | if (isset($\_REQUEST['debugcart'])) { |
  | 52 | 57 | echo '<pre>'; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-dynamic-pricing-plugin-public.php?rev=3030019#L101) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-dynamic-pricing-plugin-public.php?rev=3211131#L106) |  |
  | 101 | 106 | } |
  | 102 | 107 | foreach ($xa\_cart\_categories[$\_pid] as $\_cid) { |
  | 103 |  | $xa\_cart\_categories\_items[$\_cid] = isset($xa\_cart\_categories\_items[$\_cid]) ? (~~$xa\_cart\_categories\_items[$\_cid] + 1~~) : 1; |
  | 104 |  | $xa\_cart\_categories\_units[$\_cid] = isset($xa\_cart\_categories\_units[$\_cid]) ? (~~$xa\_cart\_categories\_units[$\_cid] + $\_qnty~~) : $\_qnty; |
  |  | 108 | $xa\_cart\_categories\_items[$\_cid] = isset($xa\_cart\_categories\_items[$\_cid]) ? ( $xa\_cart\_categories\_items[$\_cid] + 1 ) : 1; |
  |  | 109 | $xa\_cart\_categories\_units[$\_cid] = isset($xa\_cart\_categories\_units[$\_cid]) ? ( $xa\_cart\_categories\_units[$\_cid] + $\_qnty ) : $\_qnty; |
  | 105 | 110 | } |
  | 106 | 111 | foreach ($xa\_cart\_tags[$\_pid] as $\_tid) { |
  | 107 |  | $xa\_cart\_tags\_items[$\_tid] = isset($xa\_cart\_tags\_items[$\_tid]) ? (~~$xa\_cart\_tags\_items[$\_tid] + 1~~) : 1; |
  | 108 |  | $xa\_cart\_tags\_units[$\_tid] = isset($xa\_cart\_tags\_units[$\_tid]) ? (~~$xa\_cart\_tags\_units[$\_tid] + $\_qnty~~) : $\_qnty; |
  |  | 112 | $xa\_cart\_tags\_items[$\_tid] = isset($xa\_cart\_tags\_items[$\_tid]) ? ( $xa\_cart\_tags\_items[$\_tid] + 1 ) : 1; |
  |  | 113 | $xa\_cart\_tags\_units[$\_tid] = isset($xa\_cart\_tags\_units[$\_tid]) ? ( $xa\_cart\_tags\_units[$\_tid] + $\_qnty ) : $\_qnty; |
  | 109 | 114 | } |
  | 110 | 115 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-dynamic-pricing-plugin-public.php?rev=3030019#L121) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-dynamic-pricing-plugin-public.php?rev=3211131#L126) |  |
  | 121 | 126 | add\_filter('woocommerce\_product\_is\_on\_sale', 'elex\_dp\_product\_is\_on\_sale', 99, 2); |
  | 122 | 127 |  |
  | 123 |  | function elex\_dp\_product\_is\_on\_sale($on\_sale, $product) |
  | 124 |  | { |
  |  | 128 | function elex\_dp\_product\_is\_on\_sale( $on\_sale, $product) { |
  | 125 | 129 |  |
  | 126 | 130 | if ($product->is\_type('grouped') || $product->is\_type('variable')) { |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-dynamic-pricing-plugin-public.php?rev=3030019#L172) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-dynamic-pricing-plugin-public.php?rev=3211131#L176) |  |
  | 172 | 176 | } |
  | 173 | 177 |  |
  | 174 |  | function elex\_dp\_calculate\_and\_apply\_discount\_and\_add\_fee() |
  | 175 |  | { |
  |  | 178 | function elex\_dp\_calculate\_and\_apply\_discount\_and\_add\_fee() { |
  | 176 | 179 | global $xa\_common\_flat\_discount; |
  | 177 | 180 | global $woocommerce; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-dynamic-pricing-plugin-public.php?rev=3030019#L192) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-dynamic-pricing-plugin-public.php?rev=3211131#L195) |  |
  | 192 | 195 | add\_action($pricing\_table\_hook, 'elex\_dp\_show\_pricing\_table', 40); |
  | 193 | 196 |  |
  | 194 |  | function elex\_dp\_show\_pricing\_table() |
  | 195 |  | { |
  |  | 197 | function elex\_dp\_show\_pricing\_table() { |
  | 196 | 198 | $selected\_role = get\_option('elex\_dp\_allowed\_roles\_to\_show\_pricing\_table'); |
  | 197 | 199 | if (!empty($selected\_role)) { |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-dynamic-pricing-plugin-public.php?rev=3030019#L210) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-dynamic-pricing-plugin-public.php?rev=3211131#L212) |  |
  | 210 | 212 | add\_action($offer\_table\_hook, 'elex\_dp\_show\_offer\_table', 40); |
  | 211 | 213 |  |
  | 212 |  | function elex\_dp\_show\_offer\_table() |
  | 213 |  | { |
  |  | 214 | function elex\_dp\_show\_offer\_table() { |
  | 214 | 215 | $path = dirname(\_\_FILE\_\_) . '/elex-single-product-offer-table.php'; |
  | 215 | 216 | if (isset($GLOBALS['elex\_dp\_settings']['offer\_table\_on\_off']) && $GLOBALS['elex\_dp\_settings']['offer\_table\_on\_off'] == 'enable' && file\_exists($path) == true) { |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-dynamic-pricing-plugin-public.php?rev=3030019#L220) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-dynamic-pricing-plugin-public.php?rev=3211131#L221) |  |
  | 220 | 221 | add\_filter('woocommerce\_cart\_item\_price', 'elex\_dp\_show\_discount\_on\_line\_item', 100, 2); |
  | 221 | 222 |  |
  | 222 |  | function elex\_dp\_show\_discount\_on\_line\_item($price, $cart\_item) |
  | 223 |  | { |
  |  | 223 | function elex\_dp\_show\_discount\_on\_line\_item( $price, $cart\_item) { |
  | 224 | 224 | $prod  = $cart\_item['data']; |
  | 225 | 225 | $price = $prod->get\_price\_html(); |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-dynamic-pricing-plugin-public.php?rev=3030019#L229) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-dynamic-pricing-plugin-public.php?rev=3211131#L229) |  |
  | 229 | 229 | add\_action('wc\_ajax\_get\_refreshed\_fragments', 'elex\_dp\_wc\_ajax\_get\_refreshed\_fragments', 1); |
  | 230 | 230 |  |
  | 231 |  | function elex\_dp\_wc\_ajax\_get\_refreshed\_fragments() |
  | 232 |  | { |
  |  | 231 | function elex\_dp\_wc\_ajax\_get\_refreshed\_fragments() { |
  | 233 | 232 | global $woocommerce; |
  | 234 | 233 | if ($woocommerce->cart) { |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-dynamic-pricing-plugin-public.php?rev=3030019#L238) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-dynamic-pricing-plugin-public.php?rev=3211131#L237) |  |
  | 238 | 237 |  |
  | 239 | 238 | // Exclude discount from taxes |
  | 240 |  | function excludeCartFeesTaxes($taxes, $fee, $cart) |
  | 241 |  | { |
  |  | 239 | function excludeCartFeesTaxes( $taxes, $fee, $cart) { |
  | 242 | 240 | return []; |
  | 243 | 241 | } |
  | 244 |  | add\_action('woocommerce\_cart\_totals\_get\_fees\_from\_cart\_taxes', 'excludeCartFeesTaxes', 10 ,3); |
  |  | 242 | add\_action('woocommerce\_cart\_totals\_get\_fees\_from\_cart\_taxes', 'excludeCartFeesTaxes', 10 , 3); |
  |  | 243 |  |
  |  | 244 | add\_action('save\_post\_product', 'delete\_product\_transient\_on\_price\_update', 10, 3); |
  |  | 245 |  |
  |  | 246 | function delete\_product\_transient\_on\_price\_update( $post\_id, $post, $update) { |
  |  | 247 |  |
  |  | 248 | global $wpdb; |
  |  | 249 | // Specify the transient key pattern |
  |  | 250 | $transient\_key\_pattern = 'elex\_dp\_product\_data\_' . $post\_id; |
  |  | 251 |  |
  |  | 252 | $wpdb->query( |
  |  | 253 | $wpdb->prepare( |
  |  | 254 | "DELETE FROM $wpdb->options WHERE option\_name LIKE %s OR option\_name LIKE %s", |
  |  | 255 | '\_transient\_%' . $transient\_key\_pattern, |
  |  | 256 | '\_transient\_timeout\_%' . $transient\_key\_pattern |
  |  | 257 | ) |
  |  | 258 | ); |
  |  | 259 |  |
  |  | 260 | // Clear the object cache |
  |  | 261 | wp\_cache\_flush(); |
  |  | 262 |  |
  |  | 263 | } |
  |  | 264 |  |
  |  | 265 | add\_action('woocommerce\_update\_product\_variation', 'delete\_variation\_transient\_on\_price\_update', 10, 1); |
  |  | 266 |  |
  |  | 267 | function delete\_variation\_transient\_on\_price\_update( $variation\_id) { |
  |  | 268 |  |
  |  | 269 | global $wpdb; |
  |  | 270 | // Specify the transient key pattern for the variation |
  |  | 271 | $transient\_key\_pattern = 'elex\_dp\_product\_data\_' . $variation\_id; |
  |  | 272 |  |
  |  | 273 | $wpdb->query( |
  |  | 274 | $wpdb->prepare( |
  |  | 275 | "DELETE FROM $wpdb->options WHERE option\_name LIKE %s OR option\_name LIKE %s", |
  |  | 276 | '\_transient\_%' . $transient\_key\_pattern, |
  |  | 277 | '\_transient\_timeout\_%' . $transient\_key\_pattern |
  |  | 278 | ) |
  |  | 279 | ); |
  |  | 280 |  |
  |  | 281 | // Clear the object cache |
  |  | 282 | wp\_cache\_flush(); |
  |  | 283 |  |
  |  | 284 | } |
* ## [elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-new-calculation-handler.php](/changeset/3211131/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-new-calculation-handler.php "Show the changeset 3211131 restricted to elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-new-calculation-handler.php")

  | [r3046337](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-new-calculation-handler.php?rev=3046337#L16 "Show revision 3046337 of this file in browser") | [r3211131](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-new-calculation-handler.php?rev=3211131#L16 "Show revision 3211131 of this file in browser") |  |
  | --- | --- | --- |
  | 16 | 16 | \* @author Akshay |
  | 17 | 17 | \*/ |
  | 18 |  | class Elex\_NewCalculationHandler |
  | 19 |  | { |
  |  | 18 | class Elex\_NewCalculationHandler { |
  |  | 19 |  |
  | 20 | 20 |  |
  | 21 | 21 | public $debug\_mode = false; |
  | 22 | 22 |  |
  | 23 |  | public function \_\_construct() |
  | 24 |  | { |
  |  | 23 | public function \_\_construct() { |
  | 25 | 24 | $dummy\_settings['product\_rules\_on\_off']          = 'enable'; |
  | 26 | 25 | $dummy\_settings['combinational\_rules\_on\_off']    = 'enable'; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-new-calculation-handler.php?rev=3046337#L110) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-new-calculation-handler.php?rev=3211131#L109) |  |
  | 110 | 109 | $parent\_id                 = elex\_dp\_is\_wc\_version\_gt\_eql('2.7') ? $prod->get\_parent\_id() : $prod->parent->id; |
  | 111 | 110 | $parent\_product            = wc\_get\_product($parent\_id); |
  | 112 |  | if~~($parent\_product)~~{ |
  |  | 111 | if ($parent\_product) { |
  | 113 | 112 | $xa\_cart\_categories[$\_pid] = elex\_dp\_is\_wc\_version\_gt\_eql('2.7') ? $parent\_product->get\_category\_ids() : elex\_dp\_get\_category\_ids($parent\_product); |
  | 114 | 113 | $xa\_cart\_tags[$\_pid]       = xa\_get\_tag\_ids($\_pid); |
  | 115 |  | }~~else~~{ |
  |  | 114 | } else { |
  | 116 | 115 | $xa\_cart\_categories[$\_pid] = elex\_dp\_is\_wc\_version\_gt\_eql('2.7') ? $prod->get\_category\_ids() : elex\_dp\_get\_category\_ids($prod); |
  | 117 | 116 | $xa\_cart\_tags[$\_pid]       = xa\_get\_tag\_ids($prod); |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-new-calculation-handler.php?rev=3046337#L123) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-new-calculation-handler.php?rev=3211131#L122) |  |
  | 123 | 122 | } |
  | 124 | 123 | foreach ($xa\_cart\_categories[$\_pid] as $\_cid) { |
  | 125 |  | $xa\_cart\_categories\_items[$\_cid] = isset($xa\_cart\_categories\_items[$\_cid]) ? (~~$xa\_cart\_categories\_items[$\_cid] + 1~~) : 1; |
  | 126 |  | $xa\_cart\_categories\_units[$\_cid] = isset($xa\_cart\_categories\_units[$\_cid]) ? (~~$xa\_cart\_categories\_units[$\_cid] + $\_qnty~~) : $\_qnty; |
  |  | 124 | $xa\_cart\_categories\_items[$\_cid] = isset($xa\_cart\_categories\_items[$\_cid]) ? ( $xa\_cart\_categories\_items[$\_cid] + 1 ) : 1; |
  |  | 125 | $xa\_cart\_categories\_units[$\_cid] = isset($xa\_cart\_categories\_units[$\_cid]) ? ( $xa\_cart\_categories\_units[$\_cid] + $\_qnty ) : $\_qnty; |
  | 127 | 126 | } |
  | 128 | 127 | foreach ($xa\_cart\_tags[$\_pid] as $\_tid) { |
  | 129 |  | $xa\_cart\_tags\_items[$\_tid] = isset($xa\_cart\_tags\_items[$\_tid]) ? (~~$xa\_cart\_tags\_items[$\_tid] + 1~~) : 1; |
  | 130 |  | $xa\_cart\_tags\_units[$\_tid] = isset($xa\_cart\_tags\_units[$\_tid]) ? (~~$xa\_cart\_tags\_units[$\_tid] + $\_qnty~~) : $\_qnty; |
  |  | 128 | $xa\_cart\_tags\_items[$\_tid] = isset($xa\_cart\_tags\_items[$\_tid]) ? ( $xa\_cart\_tags\_items[$\_tid] + 1 ) : 1; |
  |  | 129 | $xa\_cart\_tags\_units[$\_tid] = isset($xa\_cart\_tags\_units[$\_tid]) ? ( $xa\_cart\_tags\_units[$\_tid] + $\_qnty ) : $\_qnty; |
  | 131 | 130 | } |
  | 132 | 131 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-new-calculation-handler.php?rev=3046337#L145) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-new-calculation-handler.php?rev=3211131#L144) |  |
  | 145 | 144 | } |
  | 146 | 145 |  |
  | 147 |  | /\*\* |
  |  | 146 | /\*\* |
  | 148 | 147 | \* Finds valid rules for this product and return discounted price based on (all rules,first match,best discount) |
  | 149 | 148 | \* |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-new-calculation-handler.php?rev=3046337#L154) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-new-calculation-handler.php?rev=3211131#L153) |  |
  | 154 | 153 | \* @return $discounted\_price |
  | 155 | 154 | \*/ |
  | 156 |  | public function elex\_dp\_getDiscountedPriceForProduct($old\_price = '', $product = null, $pid = null) |
  | 157 |  | { |
  | 158 |  | //error\_log($product->get\_id()." filter=".current\_filter()); |
  | 159 |  | global $elex\_dp\_cached\_prices; |
  | 160 |  | if (!$elex\_dp\_cached\_prices) { |
  | 161 |  | $elex\_dp\_cached\_prices = array(); |
  | 162 |  | } |
  | 163 |  |  |
  | 164 |  | if (!isset($elex\_dp\_cached\_prices[$product->get\_id()])) { |
  | 165 |  | $elex\_dp\_cached\_prices[$product->get\_id()] = array(); |
  | 166 |  | } |
  | 167 |  |  |
  | 168 |  | // if (isset($elex\_dp\_cached\_prices[$product->get\_id()][current\_filter()])) { |
  | 169 |  | //  return $elex\_dp\_cached\_prices[$product->get\_id()][current\_filter()]; |
  | 170 |  | // } |
  | 171 |  | // print("<pre>".print\_r(debug\_backtrace(),true)."</pre>"); |
  | 172 |  |  |
  | 173 |  | global $xa\_dp\_setting; |
  | 174 |  | $xa\_add\_on\_true  = true; |
  | 175 |  | $xa\_add\_on\_false = false; |
  | 176 |  | if (is\_plugin\_active('woocommerce-product-addons/woocommerce-product-addons.php')) { |
  | 177 |  | if ($xa\_dp\_setting['xa\_product\_add\_on\_option'] == 'disable') { |
  | 178 |  | $xa\_add\_on\_true  = false; |
  | 179 |  | $xa\_add\_on\_false = true; |
  | 180 |  | } |
  | 181 |  | } |
  | 182 |  |  |
  | 183 |  | //Code added to make discount apply in custom woocommerce pages. |
  | 184 |  | $product\_filters = array('woocommerce\_product\_get\_price', 'woocommerce\_product\_variation\_get\_price', 'woocommerce\_product\_variation\_get\_sale\_price', 'woocommerce\_product\_get\_sale\_price'); |
  | 185 |  |  |
  | 186 |  | if (apply\_filters('xa\_give\_discount\_on\_addon\_prices', true) == $xa\_add\_on\_false && did\_action('woocommerce\_before\_calculate\_totals') || doing\_action('woocommerce\_before\_calculate\_totals')) {   // added this code for compatiblity with woocommerce product addons |
  | 187 |  | // $elex\_dp\_cached\_prices[$product->get\_id()][current\_filter()] = $old\_price; |
  |  | 155 | public function elex\_dp\_getDiscountedPriceForProduct( $old\_price = '', $product = null, $pid = null) { |
  |  | 156 | static $cached\_prices = array(); |
  |  | 157 |  |
  |  | 158 | // Early return if product or price is not provided |
  |  | 159 | if (!$product || !$old\_price) { |
  | 188 | 160 | return $old\_price; |
  | 189 | 161 | } |
  | 190 |  | if (!is\_shop() && !is\_product() && !is\_product\_tag() &&  !is\_product\_category() && !did\_action('woocommerce\_before\_calculate\_totals') && apply\_filters('xa\_give\_discount\_on\_addon\_prices', true) == $xa\_add\_on\_true && !in\_array(current\_filter(), $product\_filters)) {   // added this code for compatiblity with woocommerce product addons |
  | 191 |  | // $elex\_dp\_cached\_prices[$product->get\_id()][current\_filter()] = $old\_price; |
  |  | 162 |  |
  |  | 163 | $product\_id = $product->get\_id(); |
  |  | 164 | if (!isset($cached\_prices[$product\_id])) { |
  |  | 165 | $cached\_prices[$product\_id] = array(); |
  |  | 166 | } |
  |  | 167 |  |
  |  | 168 | // Check if the discount calculation should be skipped |
  |  | 169 | global $xa\_hooks, $xa\_dp\_setting, $xa\_cart\_quantities, $xa\_common\_flat\_discount; |
  |  | 170 | $apply\_discount = apply\_filters('xa\_give\_discount\_on\_addon\_prices', true); |
  |  | 171 |  |
  |  | 172 | if (( !is\_shop() && !is\_product() && !is\_product\_tag() && !is\_product\_category() && !did\_action('woocommerce\_before\_calculate\_totals') ) |
  |  | 173 | || ( !$apply\_discount && ( did\_action('woocommerce\_before\_calculate\_totals') || doing\_action('woocommerce\_before\_calculate\_totals') ) ) |
  |  | 174 | ) { |
  | 192 | 175 | return $old\_price; |
  | 193 | 176 | } |
  | 194 |  | global $xa\_hooks, $xa\_common\_flat\_discount, $xa\_cart\_price, $executed\_pids; |
  | 195 |  | remove\_filter($xa\_hooks['woocommerce\_get\_price\_hook\_name'], array($this, 'elex\_dp\_getDiscountedPriceForProduct'), 22); |
  | 196 |  | remove\_filter($xa\_hooks['woocommerce\_get\_sale\_price\_hook\_name'], array($this, 'elex\_dp\_getDiscountedPriceForProduct'), 22);    // update sale price on product page |
  | 197 |  | remove\_filter('woocommerce\_product\_variation\_get\_price', array($this, 'elex\_dp\_getDiscountedPriceForProduct'), 22); |
  | 198 |  | remove\_filter('woocommerce\_product\_variation\_get\_sale\_price', array($this, 'elex\_dp\_getDiscountedPriceForProduct'), 22);    // update sale price on product page |
  | 199 |  |  |
  | 200 |  | $regular\_price = $product->get\_regular\_price(); |
  | 201 |  |  |
  | 202 |  | if (empty($pid)) { |
  | 203 |  | $pid = elex\_dp\_get\_pid($product); |
  | 204 |  | } |
  | 205 |  |  |
  | 206 |  | if ($pid == false) { |
  | 207 |  | add\_filter($xa\_hooks['woocommerce\_get\_price\_hook\_name'], array($this, 'elex\_dp\_getDiscountedPriceForProduct'), 22, 2);         // update sale price on product page |
  | 208 |  | add\_filter($xa\_hooks['woocommerce\_get\_sale\_price\_hook\_name'], array($this, 'elex\_dp\_getDiscountedPriceForProduct'), 22, 2);    // update sale price on product page |
  | 209 |  | add\_filter('woocommerce\_product\_variation\_get\_price', array($this, 'elex\_dp\_getDiscountedPriceForProduct'), 22, 2);    // update sale price on product page |
  | 210 |  | add\_filter('woocommerce\_product\_variation\_get\_sale\_price', array($this, 'elex\_dp\_getDiscountedPriceForProduct'), 22, 2);    // update sale price on product page |
  | 211 |  | $elex\_dp\_cached\_prices[$product->get\_id()][current\_filter()] = $old\_price; |
  |  | 177 | if ( !is\_cart() && !is\_checkout() && !empty( get\_transient('elex\_dp\_product\_data\_' . $product\_id) ) ) { |
  |  | 178 | $discounted\_price = get\_transient('elex\_dp\_product\_data\_' . $product\_id); |
  |  | 179 | return $discounted\_price; |
  |  | 180 | } |
  |  | 181 |  |
  |  | 182 | // If the discounted price is cached in transient, return it immediately |
  |  | 183 | if (isset($cached\_prices[$product\_id][current\_filter()])) { |
  |  | 184 | return $cached\_prices[$product\_id][current\_filter()]; |
  |  | 185 | } |
  |  | 186 | // Ensure hooks are added and removed properly |
  |  | 187 | $this->manageHooks(false); |
  |  | 188 |  |
  |  | 189 | $regular\_price = $product->get\_regular\_price(); |
  |  | 190 | $pid = $pid ?: elex\_dp\_get\_pid($product); |
  |  | 191 |  |
  |  | 192 | if (!$pid) { |
  |  | 193 | $this->manageHooks(true); |
  | 212 | 194 | return $old\_price; |
  | 213 | 195 | } |
  | 214 |  | if (((current\_filter() == $xa\_hooks['woocommerce\_get\_sale\_price\_hook\_name']) || (current\_filter() == 'woocommerce\_product\_variation\_get\_sale\_price')) && empty($old\_price)) {  // if sale price is empty then old price is regular\_price |
  |  | 196 |  |
  |  | 197 | // Set old\_price if empty in certain filters |
  |  | 198 |  |
  |  | 199 |  |
  |  | 200 | if (in\_array(current\_filter(), array($xa\_hooks['woocommerce\_get\_sale\_price\_hook\_name'], 'woocommerce\_product\_variation\_get\_sale\_price')) && empty($old\_price)) { |
  | 215 | 201 | $old\_price = $regular\_price; |
  | 216 | 202 | } |
  | 217 |  | $discounted\_price = $old\_price; |
  | 218 |  | $weight           = $product->get\_weight(); |
  | 219 |  | if (!empty($old\_price) && (!empty($product) || !empty($pid))) { |
  | 220 |  |  |
  | 221 |  | global $xa\_cart\_quantities; |
  | 222 |  | $parent\_id = $pid; |
  | 223 |  | if ($product->get\_type() == 'variation') { |
  | 224 |  | $parent\_id = elex\_dp\_is\_wc\_version\_gt\_eql('2.7') ? $product->get\_parent\_id() : $product->parent->id; |
  | 225 |  | } |
  | 226 |  | if (isset($xa\_cart\_quantities[$pid]) || isset($xa\_cart\_quantities[$parent\_id])) { |
  | 227 |  | $current\_quantity = isset($xa\_cart\_quantities[$pid]) ? $xa\_cart\_quantities[$pid] : $xa\_cart\_quantities[$parent\_id]; |
  | 228 |  | } else { |
  | 229 |  | $current\_quantity = 0; |
  | 230 |  | } |
  | 231 |  | if ($current\_quantity == 0  && class\_exists('SitePress')) { |
  | 232 |  | global $sitepress; |
  | 233 |  | $trid    = $sitepress->get\_element\_trid($pid); |
  | 234 |  | $trans   = $sitepress->get\_element\_translations($trid); |
  | 235 |  | $all\_ids = array(); |
  | 236 |  | foreach ($trans as $lan) { |
  | 237 |  | $all\_ids[] = $lan->element\_id; |
  | 238 |  | } |
  | 239 |  | foreach ($all\_ids as $\_pid) { |
  | 240 |  | if (!empty($xa\_cart\_quantities[$\_pid])) { |
  | 241 |  | $current\_quantity = $xa\_cart\_quantities[$\_pid]; |
  | 242 |  | break; |
  | 243 |  | } |
  | 244 |  | } |
  | 245 |  | } |
  |  | 203 |  |
  |  | 204 | $discounted\_price = $old\_price; |
  |  | 205 | $weight = $product->get\_weight(); |
  |  | 206 |  |
  |  | 207 | if (!empty($old\_price) && $pid) { |
  |  | 208 | $parent\_id = ( $product->get\_type() == 'variation' ) ? $product->get\_parent\_id() : $pid; |
  |  | 209 | $current\_quantity = $xa\_cart\_quantities[$pid] ?? $xa\_cart\_quantities[$parent\_id] ?? 0; |
  |  | 210 |  |
  | 246 | 211 | if (is\_shop() || is\_product\_category() || is\_product() || is\_product\_tag()) { |
  | 247 | 212 | $current\_quantity++; |
  | 248 | 213 | } |
  |  | 214 |  |
  | 249 | 215 | $objRulesValidator = new Elex\_RulesValidator(); |
  | 250 |  |  |
  | 251 | 216 | $valid\_rules = $objRulesValidator->elex\_dp\_getValidRulesForProduct($product, $pid, $current\_quantity, $discounted\_price, $weight); |
  | 252 |  |  |
  |  | 217 |  |
  | 253 | 218 | if ($this->debug\_mode) { |
  | 254 | 219 | error\_log(str\_repeat('-', 380)); |
  | 255 | 220 | error\_log('Valid Rules for Pid=' . $pid . ' and qnty=' . $current\_quantity . ' Valid Rules= ' . print\_r($valid\_rules, true)); |
  | 256 | 221 | } |
  | 257 |  | $mode = !empty($xa\_dp\_setting['mode']) ? $xa\_dp\_setting['mode'] : 'first\_match'; |
  | 258 |  | // if (!empty($executed\_pids[$pid]) && $mode == 'best\_discount' && !$product->is\_type('variation')) { |
  | 259 |  | //  $product->set\_price($executed\_pids[$pid]); |
  | 260 |  | //  add\_filter($xa\_hooks['woocommerce\_get\_price\_hook\_name'], array($this, 'elex\_dp\_getDiscountedPriceForProduct'), 22, 2);         // update sale price on product page |
  | 261 |  | //  add\_filter($xa\_hooks['woocommerce\_get\_sale\_price\_hook\_name'], array($this, 'elex\_dp\_getDiscountedPriceForProduct'), 22, 2);    // update sale price on product page |
  | 262 |  | //  add\_filter('woocommerce\_product\_variation\_get\_price', array($this, 'elex\_dp\_getDiscountedPriceForProduct'), 22, 2);    // update sale price on product page |
  | 263 |  | //  add\_filter('woocommerce\_product\_variation\_get\_sale\_price', array($this, 'elex\_dp\_getDiscountedPriceForProduct'), 22, 2);    // update sale price on product page |
  | 264 |  | //  $elex\_dp\_cached\_prices[$product->get\_id()][current\_filter()] = $executed\_pids[$pid]; |
  | 265 |  | //  return $executed\_pids[$pid]; |
  | 266 |  | // } |
  | 267 |  | if (is\_array($valid\_rules) && $valid\_rules) { |
  | 268 |  | $valid\_flat\_discount = []; |
  |  | 222 |  |
  |  | 223 | if (is\_array($valid\_rules) && $valid\_rules) { |
  | 269 | 224 | foreach ($valid\_rules as $rule\_type\_colon\_rule\_no => $rule) { |
  | 270 |  | //this section supports repeat execution for product rules |
  | 271 |  | if (isset($rule['repeat\_rule']) && $rule['repeat\_rule'] == 'yes' && !empty($rule['max']) && !empty($rule['min'])) { |
  | 272 |  | if ($rule['rule\_type'] == 'product\_rules') { |
  | 273 |  | if ($product->get\_type() == 'variation') { |
  | 274 |  | $pparent\_id = elex\_dp\_is\_wc\_version\_gt\_eql('2.7') ? $product->get\_parent\_id() : $product->parent->id; |
  | 275 |  |  |
  | 276 |  | if (is\_array($rule['product\_id']) && in\_array($pparent\_id, $rule['product\_id'])) { |
  | 277 |  | $pparent\_product  = new WC\_Product\_Variable($pparent\_id); |
  | 278 |  | $variations       = $pparent\_product->get\_children(); |
  | 279 |  | $current\_quantity = 0; |
  | 280 |  | foreach ($variations as $value) { |
  | 281 |  | if (isset($xa\_cart\_quantities[$value])) { |
  | 282 |  | $current\_quantity += $xa\_cart\_quantities[$value]; |
  | 283 |  | } |
  | 284 |  | } |
  | 285 |  | if (isset($xa\_cart\_quantities[$pparent\_id])) { |
  | 286 |  | $current\_quantity += $xa\_cart\_quantities[$value]; |
  | 287 |  | } |
  | 288 |  | if (is\_shop() || is\_product\_category() || is\_product() || is\_product\_tag()) { |
  | 289 |  | $current\_quantity++; |
  | 290 |  | } |
  | 291 |  | } |
  | 292 |  | } |
  | 293 |  | } |
  | 294 |  | $times       = intval($current\_quantity / $rule['max']); |
  | 295 |  | $total\_price = 0; |
  | 296 |  | $repeat\_qnty = (float) $rule['max']; |
  | 297 |  | if ($this->debug\_mode) { |
  | 298 |  | error\_log(str\_repeat('>', 208)); |
  | 299 |  | error\_log('Executing Rule(Repeat=True):' . $rule\_type\_colon\_rule\_no); |
  | 300 |  | } |
  | 301 |  | if (!empty($rule['discount\_type']) && $rule['discount\_type'] == 'Flat Discount') { |
  | 302 |  | $xa\_common\_flat\_discount[$rule['rule\_type'] . ':' . $rule['rule\_no'] . ':' . $pid] = floatval($rule['value']) \* floatval($times); |
  | 303 |  | if (!empty($rule['adjustment'])) { |
  | 304 |  | $adjusted\_qnty    = !empty($objRulesValidator->rule\_based\_quantity[$rule['rule\_type'] . ':' . $rule['rule\_no']]) ? $objRulesValidator->rule\_based\_quantity[$rule['rule\_type'] . ':' . $rule['rule\_no']] : $current\_quantity; |
  | 305 |  | $discounted\_price = $discounted\_price + ((float) $rule['adjustment'] / $adjusted\_qnty); |
  | 306 |  | } |
  | 307 |  | } else { |
  | 308 |  | $object\_hash = spl\_object\_hash($product); |
  | 309 |  | $object\_hash = $object\_hash . $pid; |
  | 310 |  | $r\_price     = $objRulesValidator->elex\_dp\_execute\_rule($discounted\_price, $rule\_type\_colon\_rule\_no, $rule, $repeat\_qnty, $pid, $object\_hash); |
  | 311 |  | //error\_log("$total\_price = $r\_price \* $times \* $repeat\_qnty"); |
  | 312 |  | $total\_price    = $r\_price \* $times \* $repeat\_qnty; |
  | 313 |  | $remaining\_qnty = $current\_quantity - ($times \* $repeat\_qnty); |
  | 314 |  | if ($remaining\_qnty > 0) { |
  | 315 |  | $price = isset($xa\_cart\_price[$pid]) ? $xa\_cart\_price[$pid] : 0; |
  | 316 |  | $total\_price = $total\_price + ($remaining\_qnty \* $price); |
  | 317 |  | } |
  | 318 |  | $discounted\_price = $total\_price / $current\_quantity; |
  | 319 |  | } |
  | 320 |  | } else { |
  | 321 |  | if ($this->debug\_mode) { |
  | 322 |  | error\_log(str\_repeat('>', 208)); |
  | 323 |  | error\_log('Executing Rule:' . $rule\_type\_colon\_rule\_no); |
  | 324 |  | } |
  | 325 |  | //fix for best discount mode flat discount is not getting calculated] |
  | 326 |  |  |
  | 327 |  | // if (!empty($rule['discount\_type']) && $rule['discount\_type'] == 'Flat Discount') { // removed variation condition because variations were getting executed like non flat discounts |
  | 328 |  | //  if ($rule['rule\_type'] == 'product\_rules') { |
  | 329 |  | //      $xa\_common\_flat\_discount[$rule['rule\_type'] . ':' . $rule['rule\_no'] . ':' . $pid] = floatval($rule['value']); |
  | 330 |  | //  } elseif ($rule['rule\_type'] == 'category\_rules') { |
  | 331 |  | //      $cid = !empty($rule['selected\_cids']) ? current($rule['selected\_cids']) : ''; |
  | 332 |  | //      $xa\_common\_flat\_discount[$rule['rule\_type'] . ':' . $rule['rule\_no'] . ':' . $cid] = floatval($rule['value']); |
  | 333 |  | //  } else { |
  | 334 |  | //      $xa\_common\_flat\_discount[$rule['rule\_type'] . ':' . $rule['rule\_no']] = floatval($rule['value']); |
  | 335 |  | //  } |
  | 336 |  | //  if (!empty($rule['adjustment'])) { |
  | 337 |  | //      $adjusted\_qnty    = !empty($objRulesValidator->rule\_based\_quantity[$rule['rule\_type'] . ':' . $rule['rule\_no']]) ? $objRulesValidator->rule\_based\_quantity[$rule['rule\_type'] . ':' . $rule['rule\_no']] : $current\_quantity; |
  | 338 |  | //      $discounted\_price = $discounted\_price + ((float) $rule['adjustment'] / $adjusted\_qnty); |
  | 339 |  | //  } |
  | 340 |  | // } else { |
  | 341 |  |  |
  | 342 |  | $object\_hash      = spl\_object\_hash($product); |
  | 343 |  | $object\_hash      = $object\_hash . $pid; |
  | 344 |  | $discounted\_price = $objRulesValidator->elex\_dp\_execute\_rule($discounted\_price, $rule\_type\_colon\_rule\_no, $rule, $current\_quantity, $pid, $object\_hash); |
  | 345 |  | } |
  | 346 |  | // } |
  |  | 225 | $object\_hash = spl\_object\_hash($product) . $pid; |
  |  | 226 | $discounted\_price = $objRulesValidator->elex\_dp\_execute\_rule($discounted\_price, $rule\_type\_colon\_rule\_no, $rule, $current\_quantity, $pid, $object\_hash); |
  | 347 | 227 | if ($rule['rule\_type'] != 'BOGO\_category\_rules' && $rule['rule\_type'] != 'buy\_get\_free\_rules' && $rule['rule\_type'] != 'bogo\_tag\_rules') { |
  | 348 | 228 | $product->set\_price($discounted\_price); |
  | 349 |  | ~~}~~ |
  | 350 |  |  |
  | 351 |  | ~~//Calculating the valid flat discounts.~~ |
  | 352 |  | ~~$key = $rule['rule\_type'] . ':' . $rule['rule\_no'] . ':' . $pid;~~ |
  | 353 |  | ~~if($xa\_common\_flat\_discount && array\_key\_exists($key, $xa\_common\_flat\_discount)){~~ |
  | 354 |  | ~~$valid\_flat\_discount[$key] = $key;~~ |
  | 355 |  | ~~}~~ |
  | 356 |  | ~~}~~ |
  | 357 |  | ~~if($xa\_common\_flat\_discount){~~ |
  | 358 |  | ~~foreach($xa\_common\_flat\_discount as $key => $value){~~ |
  | 359 |  | ~~$key\_parts = explode(':', $key);~~ |
  | 360 |  | ~~$current\_pid = end($key\_parts);~~ |
  | 361 |  | ~~if(!array\_key\_exists($key, $valid\_flat\_discount) && ($current\_pid == $pid)){~~ |
  | 362 |  | ~~unset($xa\_common\_flat\_discount[$key]);~~ |
  | 363 |  | ~~}~~ |
  | 364 | 229 | } |
  | 365 | 230 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-new-calculation-handler.php?rev=3046337#L367) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-new-calculation-handler.php?rev=3211131#L232) |  |
  | 367 | 232 | foreach ($xa\_common\_flat\_discount as $key => $value) { |
  | 368 | 233 | $key\_parts = explode(':', $key); |
  | 369 |  | $current\_pid = end($key\_parts); |
  | 370 |  | if ($current\_pid == $pid) { |
  |  | 234 | if (end($key\_parts) == $pid) { |
  | 371 | 235 | unset($xa\_common\_flat\_discount[$key]); |
  | 372 | 236 | } |
  | 373 | 237 | } |
  | 374 | 238 | } |
  | 375 |  | } |
  | 376 |  | $elex\_dp\_cached\_prices[$product->get\_id()][current\_filter()] = $discounted\_price; |
  | 377 |  | add\_filter($xa\_hooks['woocommerce\_get\_price\_hook\_name'], array($this, 'elex\_dp\_getDiscountedPriceForProduct'), 22, 2);         // update sale price on product page |
  | 378 |  | add\_filter($xa\_hooks['woocommerce\_get\_sale\_price\_hook\_name'], array($this, 'elex\_dp\_getDiscountedPriceForProduct'), 22, 2);    // update sale price on product page |
  | 379 |  | add\_filter('woocommerce\_product\_variation\_get\_price', array($this, 'elex\_dp\_getDiscountedPriceForProduct'), 22, 2);    // update sale price on product page |
  | 380 |  | add\_filter('woocommerce\_product\_variation\_get\_sale\_price', array($this, 'elex\_dp\_getDiscountedPriceForProduct'), 22, 2);    // update sale price on product page |
  | 381 |  | if (((current\_filter() == $xa\_hooks['woocommerce\_get\_sale\_price\_hook\_name']) || (current\_filter() == 'woocommerce\_product\_variation\_get\_sale\_price')) && ($regular\_price == $discounted\_price)) {  // if sale price is empty then old price is regular\_price |
  | 382 |  | return ''; |
  | 383 |  | } |
  | 384 |  | return $discounted\_price; |
  | 385 |  | } |
  | 386 |  |  |
  | 387 |  | public function elex\_dp\_getDiscountedPriceHTML($price, $product) |
  | 388 |  | { |
  |  | 239 |  |
  |  | 240 |  |
  |  | 241 | } |
  |  | 242 | if ( empty( get\_transient('elex\_dp\_product\_data\_' . $product\_id) ) ) { |
  |  | 243 | set\_transient( 'elex\_dp\_product\_data\_' . $product\_id, $discounted\_price ); |
  |  | 244 | } |
  |  | 245 | $cached\_prices[$product\_id][current\_filter()] = $discounted\_price; |
  |  | 246 |  |
  |  | 247 | // Restore hooks |
  |  | 248 | $this->manageHooks(true); |
  |  | 249 |  |
  |  | 250 | return ( in\_array(current\_filter(), array($xa\_hooks['woocommerce\_get\_sale\_price\_hook\_name'], 'woocommerce\_product\_variation\_get\_sale\_price')) && $regular\_price == $discounted\_price ) ? '' : $discounted\_price; |
  |  | 251 | } |
  |  | 252 |  |
  |  | 253 | // Helper method to manage hooks |
  |  | 254 | public function manageHooks( $add) { |
  |  | 255 | global $xa\_hooks; |
  |  | 256 |  |
  |  | 257 | $action = $add ? 'add\_filter' : 'remove\_filter'; |
  |  | 258 | $priority = 22; |
  |  | 259 |  |
  |  | 260 | $filters = [ |
  |  | 261 | $xa\_hooks['woocommerce\_get\_price\_hook\_name'], |
  |  | 262 | $xa\_hooks['woocommerce\_get\_sale\_price\_hook\_name'], |
  |  | 263 | 'woocommerce\_product\_variation\_get\_price', |
  |  | 264 | 'woocommerce\_product\_variation\_get\_sale\_price' |
  |  | 265 | ]; |
  |  | 266 |  |
  |  | 267 | foreach ($filters as $filter) { |
  |  | 268 | $action($filter, [$this, 'elex\_dp\_getDiscountedPriceForProduct'], $priority, 2); |
  |  | 269 | } |
  |  | 270 | } |
  |  | 271 |  |
  |  | 272 | public function elex\_dp\_getDiscountedPriceHTML( $price, $product) { |
  | 389 | 273 | // hooked to get\_price\_html filter |
  | 390 | 274 | if ($product->is\_type('simple') || $product->is\_type('variation')) { |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-new-calculation-handler.php?rev=3046337#L398) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-new-calculation-handler.php?rev=3211131#L282) |  |
  | 398 | 282 | } |
  | 399 | 283 |  |
  | 400 |  | public function elex\_dp\_getDiscountedPriceHTML\_for\_simple\_product($price, $product) |
  | 401 |  | { |
  |  | 284 | public function elex\_dp\_getDiscountedPriceHTML\_for\_simple\_product( $price, $product) { |
  | 402 | 285 | // hooked to get\_price\_html filter |
  | 403 | 286 | return $price; |
  | 404 | 287 | } |
  | 405 | 288 |  |
  | 406 |  | public function elex\_dp\_getDiscountedPriceHTML\_for\_group\_product($price, $product) |
  | 407 |  | { |
  |  | 289 | public function elex\_dp\_getDiscountedPriceHTML\_for\_group\_product( $price, $product) { |
  | 408 | 290 | // hooked to get\_price\_html filter |
  | 409 | 291 | $tax\_display\_mode = get\_option('woocommerce\_tax\_display\_shop'); |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-new-calculation-handler.php?rev=3046337#L413) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-new-calculation-handler.php?rev=3211131#L295) |  |
  | 413 | 295 | $child = wc\_get\_product($child\_id); |
  | 414 | 296 | //$child\_prices[] = 'incl' === $tax\_display\_mode ? wc\_get\_price\_including\_tax($child) : wc\_get\_price\_excluding\_tax($child); |
  | 415 |  | if($child) { |
  |  | 297 | if ($child) { |
  | 416 | 298 | if ($child->is\_type('variable')) { |
  | 417 | 299 | $prices = $child->get\_variation\_prices(true); |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-new-calculation-handler.php?rev=3046337#L441) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-new-calculation-handler.php?rev=3211131#L323) |  |
  | 441 | 323 | if ('' !== $min\_price) { |
  | 442 | 324 | $price   = $min\_price !== $max\_price ? sprintf(\_x('%1$s&ndash;%2$s', 'Price range: from-to', 'woocommerce'), wc\_price($min\_price), wc\_price($max\_price)) : wc\_price($min\_price); |
  | 443 |  | $is\_free = (~~0 == $min\_price && 0 == $max\_price~~); |
  |  | 325 | $is\_free = ( 0 == $min\_price && 0 == $max\_price ); |
  | 444 | 326 |  |
  | 445 | 327 | if ($is\_free) { |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-new-calculation-handler.php?rev=3046337#L455) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-new-calculation-handler.php?rev=3211131#L337) |  |
  | 455 | 337 | } |
  | 456 | 338 |  |
  | 457 |  | public function elex\_dp\_getDiscountedPriceHTML\_for\_variable\_product($price, $product) |
  | 458 |  | { |
  |  | 339 | public function elex\_dp\_getDiscountedPriceHTML\_for\_variable\_product( $price, $product) { |
  | 459 | 340 | // hooked to get\_price\_html filter |
  | 460 | 341 | $prices               = array(); |
* ## [elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php](/changeset/3211131/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php "Show the changeset 3211131 restricted to elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php")

  | [r3183659](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L6 "Show revision 3183659 of this file in browser") | [r3211131](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L6 "Show revision 3211131 of this file in browser") |  |
  | --- | --- | --- |
  | 6 | 6 | \* @author Akshay |
  | 7 | 7 | \*/ |
  | 8 |  | class Elex\_RulesValidator |
  | 9 |  | { |
  |  | 8 | class Elex\_RulesValidator { |
  |  | 9 |  |
  | 10 | 10 |  |
  | 11 | 11 | public $execution\_mode      = 'first\_match'; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L22) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L22) |  |
  | 22 | 22 | \* @return array $valid\_rules |
  | 23 | 23 | \*/ |
  | 24 |  | function \_\_construct($mode = '', $for\_offers\_table = false, $only\_execute\_this\_mode = '') |
  | 25 |  | { |
  |  | 24 | function \_\_construct( $mode = '', $for\_offers\_table = false, $only\_execute\_this\_mode = '') { |
  | 26 | 25 | global $xa\_dp\_setting; |
  | 27 | 26 |  |
  | 28 | 27 | $this->for\_offers\_table = $for\_offers\_table; |
  | 29 | 28 | $this->execution\_mode   = empty($mode) ? $xa\_dp\_setting['mode'] : $mode; |
  | 30 |  | $this->execution\_order  = empty($only\_execute\_this\_mode) ? (isset($xa\_dp\_setting['execution\_order']) ? $xa\_dp\_setting['execution\_order'] : array( |
  |  | 29 | $this->execution\_order  = empty($only\_execute\_this\_mode) ? ( isset($xa\_dp\_setting['execution\_order']) ? $xa\_dp\_setting['execution\_order'] : array( |
  | 31 | 30 | 'product\_rules', |
  | 32 | 31 | 'category\_rules' |
  | 33 |  | )) : array($only\_execute\_this\_mode); |
  |  | 32 | ) ) : array($only\_execute\_this\_mode); |
  | 34 | 33 | } |
  | 35 | 34 | /\*\* |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L37) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L36) |  |
  | 37 | 36 | \*/ |
  | 38 | 37 |  |
  | 39 |  | public function elex\_dp\_getValidRulesForProduct($product, $pid = null, $current\_quantity = 1, $price = 0, $weight = 0) |
  | 40 |  | { |
  |  | 38 | public function elex\_dp\_getValidRulesForProduct( $product, $pid = null, $current\_quantity = 1, $price = 0, $weight = 0) { |
  | 41 | 39 | if (empty($pid)) { |
  | 42 | 40 | $pid = elex\_dp\_get\_pid($product); |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L58) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L56) |  |
  | 58 | 56 |  |
  | 59 | 57 |  |
  | 60 |  | function elex\_dp\_getFirstMatchedRule($product, $pid, $current\_quantity = 1, $price = 0, $weight = 0) |
  | 61 |  | { |
  |  | 58 | function elex\_dp\_getFirstMatchedRule( $product, $pid, $current\_quantity = 1, $price = 0, $weight = 0) { |
  | 62 | 59 | global $xa\_dp\_rules, $xa\_first\_match\_rule\_executed; |
  | 63 | 60 | //if(!$xa\_first\_match\_rule\_executed) |
  | 64 | 61 | { |
  | 65 |  | foreach ($this->execution\_order as $rule\_type) { |
  | 66 |  | $rules = !empty($xa\_dp\_rules[$rule\_type]) ? $xa\_dp\_rules[$rule\_type] : array(); |
  | 67 |  | foreach ($rules as $rule\_no => $rule) { |
  | 68 |  | //print\_r($rule\_type.'->'.$rule\_no." pid=".$pid); |
  | 69 |  | $rule['rule\_no']   = $rule\_no; |
  | 70 |  | $rule['rule\_type'] = $rule\_type; |
  | 71 |  | if ($this->elex\_dp\_checkRuleApplicableForProduct($rule, $rule\_type, $product, $pid, $current\_quantity, $price, $weight) === true) { |
  | 72 |  | if ($rule\_type == 'product\_rules') { |
  | 73 |  | $xa\_first\_match\_rule\_executed = true; |
  | 74 |  | } |
  | 75 |  | //error\_log('type='.$rule\_type.' ruleno='.$rule\_no.' pid='.$pid); |
  | 76 |  | return array($rule\_type . ':' . $rule\_no => $rule); |
  | 77 |  | } |
  | 78 |  | } |
  | 79 |  | } |
  |  | 62 | foreach ($this->execution\_order as $rule\_type) { |
  |  | 63 | $rules = !empty($xa\_dp\_rules[$rule\_type]) ? $xa\_dp\_rules[$rule\_type] : array(); |
  |  | 64 | foreach ($rules as $rule\_no => $rule) { |
  |  | 65 | //print\_r($rule\_type.'->'.$rule\_no." pid=".$pid); |
  |  | 66 | $rule['rule\_no']   = $rule\_no; |
  |  | 67 | $rule['rule\_type'] = $rule\_type; |
  |  | 68 | if ($this->elex\_dp\_checkRuleApplicableForProduct($rule, $rule\_type, $product, $pid, $current\_quantity, $price, $weight) === true) { |
  |  | 69 | if ($rule\_type == 'product\_rules') { |
  |  | 70 | $xa\_first\_match\_rule\_executed = true; |
  |  | 71 | } |
  |  | 72 | //error\_log('type='.$rule\_type.' ruleno='.$rule\_no.' pid='.$pid); |
  |  | 73 | return array($rule\_type . ':' . $rule\_no => $rule); |
  |  | 74 | } |
  |  | 75 | } |
  |  | 76 | } |
  | 80 | 77 | } |
  | 81 | 78 | return array(); |
  | 82 | 79 | } |
  | 83 | 80 |  |
  | 84 |  | function elex\_dp\_getAllMatchedRules($product, $pid, $current\_quantity = 1, $price = 0, $weight = 0) |
  | 85 |  | { |
  |  | 81 | function elex\_dp\_getAllMatchedRules( $product, $pid, $current\_quantity = 1, $price = 0, $weight = 0) { |
  | 86 | 82 | global $xa\_dp\_rules; |
  | 87 | 83 | $valid\_rules = array(); |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L104) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L100) |  |
  | 104 | 100 | } |
  | 105 | 101 |  |
  | 106 |  | function elex\_dp\_getBestMatchedRules($product, $pid, $current\_quantity = 1, $price = 0, $weight = 0) |
  | 107 |  | { |
  |  | 102 | function elex\_dp\_getBestMatchedRules( $product, $pid, $current\_quantity = 1, $price = 0, $weight = 0) { |
  | 108 | 103 | global $xa\_dp\_rules; |
  | 109 | 104 | $valid\_rules = array(); |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L129) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L124) |  |
  | 129 | 124 | } |
  | 130 | 125 |  |
  | 131 |  | public function elex\_dp\_checkRuleApplicableForProduct(&$rule = null, $rule\_type = '', $product = null, $pid = null, $current\_quantity = 1, $price = 0, $weight = 0) |
  | 132 |  | { |
  |  | 126 | public function elex\_dp\_checkRuleApplicableForProduct( &$rule = null, $rule\_type = '', $product = null, $pid = null, $current\_quantity = 1, $price = 0, $weight = 0) { |
  | 133 | 127 | if (apply\_filters('eha\_dp\_skip\_product', false, $pid, $rule, $rule\_type) != false) { |
  | 134 | 128 | return false; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L165) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L159) |  |
  | 165 | 159 | } |
  | 166 | 160 | global $customer; |
  | 167 |  | if ((~~!empty($rule['prev\_order\_count']) || !empty($rule['prev\_order\_total\_amt'])~~) && !empty($customer)) { |
  |  | 161 | if (( !empty($rule['prev\_order\_count']) || !empty($rule['prev\_order\_total\_amt']) ) && !empty($customer)) { |
  | 168 | 162 | $order\_count = elex\_dp\_is\_wc\_version\_gt\_eql('2.7') ? $customer->get\_order\_count() : wc\_get\_customer\_order\_count($customer->id); |
  | 169 | 163 | $total\_spent = elex\_dp\_is\_wc\_version\_gt\_eql('2.7') ? $customer->get\_total\_spent() : wc\_get\_customer\_total\_spent($customer->id); |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L189) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L183) |  |
  | 189 | 183 | } |
  | 190 | 184 |  |
  | 191 |  | function elex\_dp\_checkBOGO\_RuleApplicableForProduct(&$rule = null, $product = null, $pid = null, $current\_quantity = 1, $price = 0, $weight = 0) |
  | 192 |  | { |
  |  | 185 | function elex\_dp\_checkBOGO\_RuleApplicableForProduct( &$rule = null, $product = null, $pid = null, $current\_quantity = 1, $price = 0, $weight = 0) { |
  | 193 | 186 | $rule['purchased\_product\_id'] = elex\_dp\_WPML\_Compatible\_ids($rule['purchased\_product\_id'], 'product', true); |
  | 194 | 187 | $rule['free\_product\_id']      = elex\_dp\_WPML\_Compatible\_ids($rule['free\_product\_id'], 'product', true); |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L196) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L189) |  |
  | 196 | 189 |  |
  | 197 | 190 | //If free product is selected |
  | 198 |  | if (!isset($rule['set\_free\_option']) || (~~isset($rule['set\_free\_option']) && $rule['set\_free\_option'] == 'select\_product'~~)) { |
  |  | 191 | if (!isset($rule['set\_free\_option']) || ( isset($rule['set\_free\_option']) && $rule['set\_free\_option'] == 'select\_product' )) { |
  | 199 | 192 |  |
  | 200 | 193 | if (empty($rule['purchased\_product\_id']) || empty($rule['free\_product\_id'])) { |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L237) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L230) |  |
  | 237 | 230 | } |
  | 238 | 231 | } |
  | 239 |  | if ((~~in\_array($pid, array\_keys($rule['purchased\_product\_id'])) || in\_array($parent\_id, array\_keys($rule['purchased\_product\_id']))~~) || in\_array($pid, array\_keys($rule['free\_product\_id']))) { |
  |  | 232 | if (( in\_array($pid, array\_keys($rule['purchased\_product\_id'])) || in\_array($parent\_id, array\_keys($rule['purchased\_product\_id'])) ) || in\_array($pid, array\_keys($rule['free\_product\_id']))) { |
  | 240 | 233 | $dprice = 0; |
  | 241 | 234 | foreach ($rule['free\_product\_id'] as $\_pid => $\_qnty) { |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L246) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L239) |  |
  | 246 | 239 | } |
  | 247 | 240 | $\_product = wc\_get\_product( $\_pid ); |
  | 248 |  | if~~($\_product)~~{ |
  |  | 241 | if ($\_product) { |
  | 249 | 242 | $product\_price = $\_product->get\_price(); |
  | 250 | 243 | $price\_val = !empty($product\_price) ? $product\_price : 0; |
  | 251 |  | $dprice   += (~~$price\_val \* $\_qnty~~); |
  |  | 244 | $dprice   += ( $price\_val \* $\_qnty ); |
  | 252 | 245 | } |
  | 253 | 246 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L281) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L274) |  |
  | 281 | 274 | return false; |
  | 282 | 275 | } |
  | 283 |  | if (in\_array($pid, array\_keys($rule['purchased\_product\_id'])) && !(~~$current\_quantity > 1~~) ) { |
  |  | 276 | if (in\_array($pid, array\_keys($rule['purchased\_product\_id'])) && !( $current\_quantity > 1 ) ) { |
  | 284 | 277 | return false; |
  | 285 | 278 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L310) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L303) |  |
  | 310 | 303 | } |
  | 311 | 304 | ////////if free product is already in cart with exact quanitty this code will set its price as zero |
  | 312 |  | if ((~~in\_array($pid, array\_keys($rule['purchased\_product\_id'])) || in\_array($parent\_id, array\_keys($rule['purchased\_product\_id'])) || ($pid == $product\_tosetfree)~~)) { |
  |  | 305 | if (( in\_array($pid, array\_keys($rule['purchased\_product\_id'])) || in\_array($parent\_id, array\_keys($rule['purchased\_product\_id'])) || ( $pid == $product\_tosetfree ) )) { |
  | 313 | 306 | $dprice = 0; |
  | 314 |  | $dprice = $minvalue; |
  |  | 307 | $dprice = $minvalue; |
  | 315 | 308 | if ($this->execution\_mode == 'best\_discount') { |
  | 316 | 309 | $rule['calculated\_discount'] = $dprice;    //to check best descount rule |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L323) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L316) |  |
  | 323 | 316 | return $this->elex\_dp\_check\_date\_range\_and\_roles($rule, 'buy\_get\_free\_rules'); |
  | 324 | 317 | } |
  | 325 |  | function elex\_dp\_checkBOGO\_category\_RuleApplicableForProduct(&$rule = null, $product = null, $pid = null, $current\_quantity = 1, $price = 0, $weight = 0) |
  | 326 |  | { |
  |  | 318 | function elex\_dp\_checkBOGO\_category\_RuleApplicableForProduct( &$rule = null, $product = null, $pid = null, $current\_quantity = 1, $price = 0, $weight = 0) { |
  | 327 | 319 |  |
  | 328 | 320 | $rule['purchased\_category\_id'] = elex\_dp\_WPML\_Compatible\_ids($rule['purchased\_category\_id'], 'category', true); |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L332) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L324) |  |
  | 332 | 324 |  |
  | 333 | 325 | //If free product is selected |
  | 334 |  | if (!isset($rule['set\_free\_option']) || (~~isset($rule['set\_free\_option']) && $rule['set\_free\_option'] == 'select\_product'~~)) { |
  |  | 326 | if (!isset($rule['set\_free\_option']) || ( isset($rule['set\_free\_option']) && $rule['set\_free\_option'] == 'select\_product' )) { |
  | 335 | 327 |  |
  | 336 | 328 | if (empty($rule['purchased\_category\_id']) || empty($rule['free\_product\_id'])) { |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L349) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L341) |  |
  | 349 | 341 |  |
  | 350 | 342 | $tmp1 = array\_keys($rule['free\_product\_id']); |
  | 351 |  | if (in\_array($pid, $tmp1) && in\_array($\_cid, $product\_categories) && $xa\_dp\_setting['auto\_add\_free\_product\_on\_off'] != 'on' && !(~~$xa\_cart\_categories\_items[$\_cid] > 1~~) && $current\_quantity == 1) { |
  |  | 343 | if (in\_array($pid, $tmp1) && in\_array($\_cid, $product\_categories) && $xa\_dp\_setting['auto\_add\_free\_product\_on\_off'] != 'on' && !( $xa\_cart\_categories\_items[$\_cid] > 1 ) && $current\_quantity == 1) { |
  | 352 | 344 | $add\_if\_not\_auto = $add\_if\_not\_auto + 1; |
  | 353 | 345 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L355) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L347) |  |
  | 355 | 347 | $\_qnty   = !empty($tmp[0]) ? $tmp[0] : 0; |
  | 356 | 348 | $checkon = !empty($tmp[1]) ? $tmp[1] : 'items'; |
  | 357 |  | if ($checkon == 'items' && (~~!isset($xa\_cart\_categories\_items[$\_cid]) || $xa\_cart\_categories\_items[$\_cid] < ($\_qnty)~~)) { |
  |  | 349 | if ($checkon == 'items' && ( !isset($xa\_cart\_categories\_items[$\_cid]) || $xa\_cart\_categories\_items[$\_cid] < ( $\_qnty ) )) { |
  | 358 | 350 | return false; |
  | 359 |  | } elseif ($checkon == 'units' && (~~!isset($xa\_cart\_categories\_units[$\_cid]) || $xa\_cart\_categories\_units[$\_cid] < $\_qnty~~)) { |
  |  | 351 | } elseif ($checkon == 'units' && ( !isset($xa\_cart\_categories\_units[$\_cid]) || $xa\_cart\_categories\_units[$\_cid] < $\_qnty )) { |
  | 360 | 352 | return false; |
  | 361 | 353 | } |
  | 362 | 354 | } |
  | 363 |  | if~~($add\_if\_not\_auto > 0)~~{ |
  |  | 355 | if ($add\_if\_not\_auto > 0) { |
  | 364 | 356 | return false; |
  | 365 | 357 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L369) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L361) |  |
  | 369 | 361 | $product\_price = $\_product->get\_price(); |
  | 370 | 362 | $price\_val = !empty($product\_price) ? $product\_price : 0; |
  | 371 |  | $dprice   += (~~$price\_val \* $\_qnty~~); |
  |  | 363 | $dprice   += ( $price\_val \* $\_qnty ); |
  | 372 | 364 | } |
  | 373 | 365 | if ($this->execution\_mode == 'best\_discount') { |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L408) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L400) |  |
  | 408 | 400 | foreach ($rule['purchased\_category\_id'] as $\_cid => $\_qnty\_and\_checkon) { |
  | 409 | 401 |  |
  | 410 |  | if ((~~$pid == $product\_tosetfree) && in\_array($\_cid, $product\_categories) && !($xa\_cart\_categories\_items[$\_cid] > 1) && !($current\_quantity > 1~~)) { |
  |  | 402 | if (( $pid == $product\_tosetfree ) && in\_array($\_cid, $product\_categories) && !( $xa\_cart\_categories\_items[$\_cid] > 1 ) && !( $current\_quantity > 1 )) { |
  | 411 | 403 | $add\_if\_not\_auto = $add\_if\_not\_auto + 1; |
  | 412 | 404 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L414) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L406) |  |
  | 414 | 406 | $\_qnty   = !empty($tmp[0]) ? $tmp[0] : 0; |
  | 415 | 407 | $checkon = !empty($tmp[1]) ? $tmp[1] : 'items'; |
  | 416 |  | if ($checkon == 'items' && (~~!isset($xa\_cart\_categories\_items[$\_cid]) || $xa\_cart\_categories\_items[$\_cid] < ($\_qnty)~~)) { |
  |  | 408 | if ($checkon == 'items' && ( !isset($xa\_cart\_categories\_items[$\_cid]) || $xa\_cart\_categories\_items[$\_cid] < ( $\_qnty ) )) { |
  | 417 | 409 | return false; |
  | 418 |  | } elseif ($checkon == 'units' && (~~!isset($xa\_cart\_categories\_units[$\_cid]) || $xa\_cart\_categories\_units[$\_cid] < $\_qnty~~)) { |
  |  | 410 | } elseif ($checkon == 'units' && ( !isset($xa\_cart\_categories\_units[$\_cid]) || $xa\_cart\_categories\_units[$\_cid] < $\_qnty )) { |
  | 419 | 411 | return false; |
  | 420 | 412 | } |
  | 421 | 413 | } |
  | 422 |  | if~~($add\_if\_not\_auto > 0)~~{ |
  |  | 414 | if ($add\_if\_not\_auto > 0) { |
  | 423 | 415 | return false; |
  | 424 | 416 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L438) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L430) |  |
  | 438 | 430 | } |
  | 439 | 431 |  |
  | 440 |  | function elex\_dp\_checkbogo\_tag\_rulesApplicableForProduct(&$rule = null, $product = null, $pid = null, $current\_quantity = 1, $price = 0, $weight = 0) |
  | 441 |  | { |
  |  | 432 | function elex\_dp\_checkbogo\_tag\_rulesApplicableForProduct( &$rule = null, $product = null, $pid = null, $current\_quantity = 1, $price = 0, $weight = 0) { |
  | 442 | 433 |  |
  | 443 | 434 | $rule['purchased\_tag\_id'] = elex\_dp\_WPML\_Compatible\_ids($rule['purchased\_tag\_id'], 'tag', true); |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L446) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L437) |  |
  | 446 | 437 |  |
  | 447 | 438 | //If free product is selected |
  | 448 |  | if (!isset($rule['set\_free\_option']) || (~~isset($rule['set\_free\_option']) && $rule['set\_free\_option'] == 'select\_product'~~)) { |
  |  | 439 | if (!isset($rule['set\_free\_option']) || ( isset($rule['set\_free\_option']) && $rule['set\_free\_option'] == 'select\_product' )) { |
  | 449 | 440 |  |
  | 450 | 441 | if (empty($rule['purchased\_tag\_id']) || empty($rule['free\_product\_id'])) { |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L463) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L454) |  |
  | 463 | 454 |  |
  | 464 | 455 | $tmp1 = array\_keys($rule['free\_product\_id']); |
  | 465 |  | if (in\_array($pid, $tmp1) && in\_array($\_cid, $product\_tags) && $xa\_dp\_setting['auto\_add\_free\_product\_on\_off'] != 'on' && !(~~$xa\_cart\_tags\_items[$\_cid] > 1~~) && $current\_quantity == 1) { |
  |  | 456 | if (in\_array($pid, $tmp1) && in\_array($\_cid, $product\_tags) && $xa\_dp\_setting['auto\_add\_free\_product\_on\_off'] != 'on' && !( $xa\_cart\_tags\_items[$\_cid] > 1 ) && $current\_quantity == 1) { |
  | 466 | 457 | $add\_if\_not\_auto = $add\_if\_not\_auto + 1; |
  | 467 | 458 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L469) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L460) |  |
  | 469 | 460 | $\_qnty   = !empty($tmp[0]) ? $tmp[0] : 0; |
  | 470 | 461 | $checkon = !empty($tmp[1]) ? $tmp[1] : 'items'; |
  | 471 |  | if ($checkon == 'items' && (~~!isset($xa\_cart\_tags\_items[$\_cid]) || $xa\_cart\_tags\_items[$\_cid] < ($\_qnty)~~)) { |
  |  | 462 | if ($checkon == 'items' && ( !isset($xa\_cart\_tags\_items[$\_cid]) || $xa\_cart\_tags\_items[$\_cid] < ( $\_qnty ) )) { |
  | 472 | 463 | return false; |
  | 473 |  | } elseif ($checkon == 'units' && (~~!isset($xa\_cart\_tags\_units[$\_cid]) || $xa\_cart\_tags\_units[$\_cid] < $\_qnty~~)) { |
  |  | 464 | } elseif ($checkon == 'units' && ( !isset($xa\_cart\_tags\_units[$\_cid]) || $xa\_cart\_tags\_units[$\_cid] < $\_qnty )) { |
  | 474 | 465 | return false; |
  | 475 | 466 | } |
  | 476 | 467 | } |
  | 477 |  | if~~($add\_if\_not\_auto > 0)~~{ |
  |  | 468 | if ($add\_if\_not\_auto > 0) { |
  | 478 | 469 | return false; |
  | 479 | 470 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L483) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L474) |  |
  | 483 | 474 | $product\_price = $\_product->get\_price(); |
  | 484 | 475 | $price\_val = !empty($product\_price) ? $product\_price : 0; |
  | 485 |  | $dprice   += (~~$price\_val \* $\_qnty~~); |
  |  | 476 | $dprice   += ( $price\_val \* $\_qnty ); |
  | 486 | 477 | } |
  | 487 | 478 | if ($this->execution\_mode == 'best\_discount') { |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L519) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L510) |  |
  | 519 | 510 | foreach ($rule['purchased\_tag\_id'] as $\_cid => $\_qnty\_and\_checkon) { |
  | 520 | 511 |  |
  | 521 |  | if ((~~$pid == $product\_tosetfree) && in\_array($\_cid, $product\_tags) && !($xa\_cart\_tags\_items[$\_cid] > 1) && !($current\_quantity > 1~~)) { |
  |  | 512 | if (( $pid == $product\_tosetfree ) && in\_array($\_cid, $product\_tags) && !( $xa\_cart\_tags\_items[$\_cid] > 1 ) && !( $current\_quantity > 1 )) { |
  | 522 | 513 | $add\_if\_not\_auto = $add\_if\_not\_auto + 1; |
  | 523 | 514 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L525) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L516) |  |
  | 525 | 516 | $\_qnty   = !empty($tmp[0]) ? $tmp[0] : 0; |
  | 526 | 517 | $checkon = !empty($tmp[1]) ? $tmp[1] : 'items'; |
  | 527 |  | if ($checkon == 'items' && (~~!isset($xa\_cart\_tags\_items[$\_cid]) || $xa\_cart\_tags\_items[$\_cid] < ($\_qnty)~~)) { |
  |  | 518 | if ($checkon == 'items' && ( !isset($xa\_cart\_tags\_items[$\_cid]) || $xa\_cart\_tags\_items[$\_cid] < ( $\_qnty ) )) { |
  | 528 | 519 | return false; |
  | 529 |  | } elseif ($checkon == 'units' && (~~!isset($xa\_cart\_tags\_units[$\_cid]) || $xa\_cart\_tags\_units[$\_cid] < $\_qnty~~)) { |
  |  | 520 | } elseif ($checkon == 'units' && ( !isset($xa\_cart\_tags\_units[$\_cid]) || $xa\_cart\_tags\_units[$\_cid] < $\_qnty )) { |
  | 530 | 521 | return false; |
  | 531 | 522 | } |
  | 532 | 523 | } |
  | 533 |  | if~~($add\_if\_not\_auto > 0)~~{ |
  |  | 524 | if ($add\_if\_not\_auto > 0) { |
  | 534 | 525 | return false; |
  | 535 | 526 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L549) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L540) |  |
  | 549 | 540 | } |
  | 550 | 541 |  |
  | 551 |  | function elex\_dp\_checkCategoryCombinationalRuleApplicableForProduct(&$rule = null, $product = null, $pid = null, $current\_quantity = 1, $price = 0, $weight = 0) |
  | 552 |  | { |
  |  | 542 | function elex\_dp\_checkCategoryCombinationalRuleApplicableForProduct( &$rule = null, $product = null, $pid = null, $current\_quantity = 1, $price = 0, $weight = 0) { |
  | 553 | 543 |  |
  | 554 | 544 | global $xa\_cart\_quantities; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L594) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L584) |  |
  | 594 | 584 | $\_product = wc\_get\_product($pid); |
  | 595 | 585 | $old\_price = $\_product->get\_price(); |
  | 596 |  | $rule['calculated\_discount'] = (~~(float)$old\_price - (float)$new\_price~~) \* $current\_quantity; |
  |  | 586 | $rule['calculated\_discount'] = ( (float) $old\_price - (float) $new\_price ) \* $current\_quantity; |
  | 597 | 587 | } |
  | 598 | 588 | //checking roles and tofrom date for which rule is applicable |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L600) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L590) |  |
  | 600 | 590 | } |
  | 601 | 591 |  |
  | 602 |  | function elex\_dp\_checkCategoryRuleApplicableForProduct(&$rule = null, $product = null, $pid = null, $current\_quantity = 1, $price = 0, $weight = 0) |
  | 603 |  | { |
  |  | 592 | function elex\_dp\_checkCategoryRuleApplicableForProduct( &$rule = null, $product = null, $pid = null, $current\_quantity = 1, $price = 0, $weight = 0) { |
  | 604 | 593 |  |
  | 605 | 594 | global $xa\_cart\_quantities; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L607) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L596) |  |
  | 607 | 596 | global $xa\_cart\_price; |
  | 608 | 597 | global $xa\_cart\_categories; |
  | 609 |  | $min = (~~empty($rule['min']) == true~~) ? 1 : $rule['min']; |
  | 610 |  | $max = (~~empty($rule['max']) == true~~) ? 999999999 : $rule['max']; |
  |  | 598 | $min = ( empty($rule['min']) == true ) ? 1 : $rule['min']; |
  |  | 599 | $max = ( empty($rule['max']) == true ) ? 999999999 : $rule['max']; |
  | 611 | 600 |  |
  | 612 | 601 | if ($max < $min && $max != 0) { |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L656) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L645) |  |
  | 656 | 645 | } |
  | 657 | 646 | if (!empty($xa\_cart\_weight[$\_pid])) { |
  | 658 |  | $total\_weight\_of\_this\_category += (float) (~~$qnty \* $xa\_cart\_weight[$\_pid]~~); |
  |  | 647 | $total\_weight\_of\_this\_category += (float) ( $qnty \* $xa\_cart\_weight[$\_pid] ); |
  | 659 | 648 | } |
  | 660 | 649 | if (!empty($xa\_cart\_price[$\_pid])) { |
  | 661 |  | $total\_price\_of\_this\_category += (float) (~~$qnty \* $xa\_cart\_price[$\_pid]~~); |
  |  | 650 | $total\_price\_of\_this\_category += (float) ( $qnty \* $xa\_cart\_price[$\_pid] ); |
  | 662 | 651 | } |
  | 663 | 652 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L672) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L661) |  |
  | 672 | 661 | //error\_log('total units=' . $total\_all\_units\_of\_this\_category\_in\_cart . " total items=" . $total\_items\_of\_this\_category\_in\_cart); |
  | 673 | 662 | //error\_log('total price=' . $total\_price\_of\_this\_category . " total weights=" . $total\_weight\_of\_this\_category); |
  | 674 |  | if ($rule['check\_on'] == 'TotalQuantity' && (~~$total\_all\_units\_of\_this\_category\_in\_cart < $min || $total\_all\_units\_of\_this\_category\_in\_cart > $max || empty($total\_all\_units\_of\_this\_category\_in\_cart)~~)) { |
  | 675 |  | return false; |
  | 676 |  | } elseif ($rule['check\_on'] == 'Quantity' && (~~$total\_items\_of\_this\_category\_in\_cart < $min || $total\_items\_of\_this\_category\_in\_cart > $max || empty($total\_items\_of\_this\_category\_in\_cart)~~)) { |
  | 677 |  | return false; |
  | 678 |  | } elseif ($rule['check\_on'] == 'Weight' && (~~$total\_weight\_of\_this\_category < $min || $total\_weight\_of\_this\_category > $max || empty($total\_weight\_of\_this\_category)~~)) { |
  | 679 |  | return false; |
  | 680 |  | } elseif ($rule['check\_on'] == 'Price' && (~~$total\_price\_of\_this\_category < $min || $total\_price\_of\_this\_category > $max || empty($total\_price\_of\_this\_category)~~)) { |
  |  | 663 | if ($rule['check\_on'] == 'TotalQuantity' && ( $total\_all\_units\_of\_this\_category\_in\_cart < $min || $total\_all\_units\_of\_this\_category\_in\_cart > $max || empty($total\_all\_units\_of\_this\_category\_in\_cart) )) { |
  |  | 664 | return false; |
  |  | 665 | } elseif ($rule['check\_on'] == 'Quantity' && ( $total\_items\_of\_this\_category\_in\_cart < $min || $total\_items\_of\_this\_category\_in\_cart > $max || empty($total\_items\_of\_this\_category\_in\_cart) )) { |
  |  | 666 | return false; |
  |  | 667 | } elseif ($rule['check\_on'] == 'Weight' && ( $total\_weight\_of\_this\_category < $min || $total\_weight\_of\_this\_category > $max || empty($total\_weight\_of\_this\_category) )) { |
  |  | 668 | return false; |
  |  | 669 | } elseif ($rule['check\_on'] == 'Price' && ( $total\_price\_of\_this\_category < $min || $total\_price\_of\_this\_category > $max || empty($total\_price\_of\_this\_category) )) { |
  | 681 | 670 | return false; |
  | 682 | 671 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L687) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L676) |  |
  | 687 | 676 | $\_product = wc\_get\_product($pid); |
  | 688 | 677 | $old\_price = $\_product->get\_price(); |
  | 689 |  | $rule['calculated\_discount'] = (~~(float)$old\_price - (float)$new\_price~~) \* $current\_quantity; |
  |  | 678 | $rule['calculated\_discount'] = ( (float) $old\_price - (float) $new\_price ) \* $current\_quantity; |
  | 690 | 679 | } |
  | 691 | 680 |  |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L694) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L683) |  |
  | 694 | 683 | } |
  | 695 | 684 |  |
  | 696 |  | function elex\_dp\_checkTagRuleApplicableForProduct(&$rule = null, $product = null, $pid = null, $current\_quantity = 1, $price = 0, $weight = 0) |
  | 697 |  | { |
  |  | 685 | function elex\_dp\_checkTagRuleApplicableForProduct( &$rule = null, $product = null, $pid = null, $current\_quantity = 1, $price = 0, $weight = 0) { |
  | 698 | 686 |  |
  | 699 | 687 | global $xa\_cart\_quantities; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L701) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L689) |  |
  | 701 | 689 | global $xa\_cart\_price; |
  | 702 | 690 | global $xa\_cart\_tags; |
  | 703 |  | $min = (~~empty($rule['min']) == true~~) ? 1 : $rule['min']; |
  | 704 |  | $max = (~~empty($rule['max']) == true~~) ? 999999999 : $rule['max']; |
  |  | 691 | $min = ( empty($rule['min']) == true ) ? 1 : $rule['min']; |
  |  | 692 | $max = ( empty($rule['max']) == true ) ? 999999999 : $rule['max']; |
  | 705 | 693 |  |
  | 706 | 694 | if ($max < $min && $max != 0) { |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L750) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L738) |  |
  | 750 | 738 | } |
  | 751 | 739 | if (!empty($xa\_cart\_weight[$\_pid])) { |
  | 752 |  | $total\_weight\_of\_this\_tag += (int) (~~$qnty \* $xa\_cart\_weight[$\_pid]~~); |
  |  | 740 | $total\_weight\_of\_this\_tag += (int) ( $qnty \* $xa\_cart\_weight[$\_pid] ); |
  | 753 | 741 | } |
  | 754 | 742 | if (!empty($xa\_cart\_price[$\_pid])) { |
  | 755 |  | $total\_price\_of\_this\_tag += (int) (~~$qnty \* $xa\_cart\_price[$\_pid]~~); |
  |  | 743 | $total\_price\_of\_this\_tag += (int) ( $qnty \* $xa\_cart\_price[$\_pid] ); |
  | 756 | 744 | } |
  | 757 | 745 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L766) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L754) |  |
  | 766 | 754 | //error\_log('total units=' . $total\_all\_units\_of\_this\_tag\_in\_cart . " total items=" . $total\_items\_of\_this\_tag\_in\_cart); |
  | 767 | 755 | //error\_log('total price=' . $total\_price\_of\_this\_tag . " total weights=" . $total\_weight\_of\_this\_tag); |
  | 768 |  | if ($rule['check\_on'] == 'TotalQuantity' && (~~$total\_all\_units\_of\_this\_tag\_in\_cart < $min || $total\_all\_units\_of\_this\_tag\_in\_cart > $max || empty($total\_all\_units\_of\_this\_tag\_in\_cart)~~)) { |
  | 769 |  | return false; |
  | 770 |  | } elseif ($rule['check\_on'] == 'Quantity' && (~~$total\_items\_of\_this\_tag\_in\_cart < $min || $total\_items\_of\_this\_tag\_in\_cart > $max || empty($total\_items\_of\_this\_tag\_in\_cart)~~)) { |
  | 771 |  | return false; |
  | 772 |  | } elseif ($rule['check\_on'] == 'Weight' && (~~$total\_weight\_of\_this\_tag < $min || $total\_weight\_of\_this\_tag > $max || empty($total\_weight\_of\_this\_tag)~~)) { |
  | 773 |  | return false; |
  | 774 |  | } elseif ($rule['check\_on'] == 'Price' && (~~$total\_price\_of\_this\_tag < $min || $total\_price\_of\_this\_tag > $max || empty($total\_price\_of\_this\_tag)~~)) { |
  |  | 756 | if ($rule['check\_on'] == 'TotalQuantity' && ( $total\_all\_units\_of\_this\_tag\_in\_cart < $min || $total\_all\_units\_of\_this\_tag\_in\_cart > $max || empty($total\_all\_units\_of\_this\_tag\_in\_cart) )) { |
  |  | 757 | return false; |
  |  | 758 | } elseif ($rule['check\_on'] == 'Quantity' && ( $total\_items\_of\_this\_tag\_in\_cart < $min || $total\_items\_of\_this\_tag\_in\_cart > $max || empty($total\_items\_of\_this\_tag\_in\_cart) )) { |
  |  | 759 | return false; |
  |  | 760 | } elseif ($rule['check\_on'] == 'Weight' && ( $total\_weight\_of\_this\_tag < $min || $total\_weight\_of\_this\_tag > $max || empty($total\_weight\_of\_this\_tag) )) { |
  |  | 761 | return false; |
  |  | 762 | } elseif ($rule['check\_on'] == 'Price' && ( $total\_price\_of\_this\_tag < $min || $total\_price\_of\_this\_tag > $max || empty($total\_price\_of\_this\_tag) )) { |
  | 775 | 763 | return false; |
  | 776 | 764 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L781) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L769) |  |
  | 781 | 769 | $\_product = wc\_get\_product($pid); |
  | 782 | 770 | $old\_price = $\_product->get\_price(); |
  | 783 |  | $rule['calculated\_discount'] = (~~(float)$old\_price - (float)$new\_price~~) \* $current\_quantity; |
  |  | 771 | $rule['calculated\_discount'] = ( (float) $old\_price - (float) $new\_price ) \* $current\_quantity; |
  | 784 | 772 | } |
  | 785 | 773 |  |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L788) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L776) |  |
  | 788 | 776 | } |
  | 789 | 777 |  |
  | 790 |  | function elex\_dp\_checkCartRuleApplicableForProduct(&$rule = null, $product = null, $pid = null, $current\_quantity = 1, $price = 0, $weight = 0) |
  | 791 |  | { |
  |  | 778 | function elex\_dp\_checkCartRuleApplicableForProduct( &$rule = null, $product = null, $pid = null, $current\_quantity = 1, $price = 0, $weight = 0) { |
  | 792 | 779 |  |
  | 793 | 780 | global $xa\_cart\_quantities; |
  | 794 | 781 | global $xa\_cart\_weight; |
  | 795 | 782 | global $xa\_cart\_price; |
  | 796 |  | $min  = (~~empty($rule['min']) == true~~) ? 1 : $rule['min']; |
  | 797 |  | $max  = (~~empty($rule['max']) == true~~) ? 999999999 : $rule['max']; |
  |  | 783 | $min  = ( empty($rule['min']) == true ) ? 1 : $rule['min']; |
  |  | 784 | $max  = ( empty($rule['max']) == true ) ? 999999999 : $rule['max']; |
  | 798 | 785 | $attr = $product->get\_attributes(); |
  | 799 | 786 | $attribute\_data = array(); |
  | 800 | 787 | foreach ($attr as $attribute\_name => $attribute) { |
  | 801 |  | if(is\_object($attribute)) { |
  |  | 788 | if (is\_object($attribute)) { |
  | 802 | 789 | $attribute\_values = $attribute->get\_options(); |
  | 803 | 790 |  |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L812) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L799) |  |
  | 812 | 799 | $attribute\_data[$attribute\_name] = $term\_slugs; |
  | 813 | 800 | } |
  | 814 |  | }~~else if(is\_string($attribute))~~{ |
  | 815 |  | $attribute\_data[$attribute\_name] = (array)$attribute; |
  |  | 801 | } else if (is\_string($attribute)) { |
  |  | 802 | $attribute\_data[$attribute\_name] = (array) $attribute; |
  | 816 | 803 |  |
  | 817 | 804 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L881) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L868) |  |
  | 881 | 868 | //if pid is selected in this rule |
  | 882 | 869 |  |
  | 883 |  | if (is\_cart() && (~~empty($pid) || !in\_array($pid, array\_keys($xa\_cart\_quantities))~~)) { |
  |  | 870 | if (is\_cart() && ( empty($pid) || !in\_array($pid, array\_keys($xa\_cart\_quantities)) )) { |
  | 884 | 871 | return false; |
  | 885 | 872 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L903) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L890) |  |
  | 903 | 890 | $total\_all\_units\_in\_cart += $\_qnty; |
  | 904 | 891 | if (!empty($xa\_cart\_weight[$\_pid])) { |
  | 905 |  | $total\_weight\_in\_cart += (~~$\_qnty \* $xa\_cart\_weight[$\_pid]~~); |
  |  | 892 | $total\_weight\_in\_cart += ( $\_qnty \* $xa\_cart\_weight[$\_pid] ); |
  | 906 | 893 | } |
  | 907 | 894 | if (!empty($xa\_cart\_price[$\_pid])) { |
  | 908 |  | $total\_price\_in\_cart += (~~$\_qnty \* $xa\_cart\_price[$\_pid]~~); |
  |  | 895 | $total\_price\_in\_cart += ( $\_qnty \* $xa\_cart\_price[$\_pid] ); |
  | 909 | 896 | } |
  | 910 | 897 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L912) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L899) |  |
  | 912 | 899 | //error\_log('total units=' . $total\_all\_units\_of\_this\_category\_in\_cart . " total items=" . $total\_items\_of\_this\_category\_in\_cart); |
  | 913 | 900 | //error\_log('total price=' . $total\_price\_of\_this\_category . " total weights=" . $total\_weight\_of\_this\_category); |
  | 914 |  | if ($rule['check\_on'] == 'TotalQuantity' && (~~$total\_all\_units\_in\_cart < $min || $total\_all\_units\_in\_cart > $max || empty($total\_all\_units\_in\_cart)~~)) { |
  | 915 |  | return false; |
  | 916 |  | } elseif ($rule['check\_on'] == 'Quantity' && (~~$total\_items\_in\_cart < $min || $total\_items\_in\_cart > $max || empty($total\_items\_in\_cart)~~)) { |
  | 917 |  | return false; |
  | 918 |  | } elseif ($rule['check\_on'] == 'Weight' && (~~$total\_weight\_in\_cart < $min || $total\_weight\_in\_cart > $max || empty($total\_weight\_in\_cart)~~)) { |
  | 919 |  | return false; |
  | 920 |  | } elseif ($rule['check\_on'] == 'Price' && (~~$total\_price\_in\_cart < $min || $total\_price\_in\_cart > $max || empty($total\_price\_in\_cart)~~)) { |
  |  | 901 | if ($rule['check\_on'] == 'TotalQuantity' && ( $total\_all\_units\_in\_cart < $min || $total\_all\_units\_in\_cart > $max || empty($total\_all\_units\_in\_cart) )) { |
  |  | 902 | return false; |
  |  | 903 | } elseif ($rule['check\_on'] == 'Quantity' && ( $total\_items\_in\_cart < $min || $total\_items\_in\_cart > $max || empty($total\_items\_in\_cart) )) { |
  |  | 904 | return false; |
  |  | 905 | } elseif ($rule['check\_on'] == 'Weight' && ( $total\_weight\_in\_cart < $min || $total\_weight\_in\_cart > $max || empty($total\_weight\_in\_cart) )) { |
  |  | 906 | return false; |
  |  | 907 | } elseif ($rule['check\_on'] == 'Price' && ( $total\_price\_in\_cart < $min || $total\_price\_in\_cart > $max || empty($total\_price\_in\_cart) )) { |
  | 921 | 908 | return false; |
  | 922 | 909 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L928) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L915) |  |
  | 928 | 915 | $\_product = wc\_get\_product($pid); |
  | 929 | 916 | $old\_price = $\_product->get\_price(); |
  | 930 |  | $rule['calculated\_discount'] = (~~(float)$old\_price - (float)$new\_price~~) \* $current\_quantity; |
  |  | 917 | $rule['calculated\_discount'] = ( (float) $old\_price - (float) $new\_price ) \* $current\_quantity; |
  | 931 | 918 | } |
  | 932 | 919 | //checking roles and tofrom date for which rule is applicable |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L934) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L921) |  |
  | 934 | 921 | } |
  | 935 | 922 |  |
  | 936 |  | function elex\_dp\_checkCombinationalRuleApplicableForProduct(&$rule = null, $product = null, $pid = null, $current\_quantity = 1, $price = 0, $weight = 0) |
  | 937 |  | { |
  |  | 923 | function elex\_dp\_checkCombinationalRuleApplicableForProduct( &$rule = null, $product = null, $pid = null, $current\_quantity = 1, $price = 0, $weight = 0) { |
  | 938 | 924 | global $xa\_cart\_quantities; |
  | 939 | 925 | $total\_units        = 0; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L965) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L951) |  |
  | 965 | 951 | } |
  | 966 | 952 | } |
  | 967 |  | if ((~~empty($xa\_cart\_quantities[$\_pid]) || $xa\_cart\_quantities[$\_pid] < $\_qnty) && ($total\_child\_qty == 0 || $total\_child\_qty < $\_qnty~~)) { |
  |  | 953 | if (( empty($xa\_cart\_quantities[$\_pid]) || $xa\_cart\_quantities[$\_pid] < $\_qnty ) && ( $total\_child\_qty == 0 || $total\_child\_qty < $\_qnty )) { |
  | 968 | 954 | if ($\_pid != $check\_for\_pid || empty($xa\_cart\_quantities[$pid]) || $xa\_cart\_quantities[$pid] < $\_qnty) { //code to consider parent id of variable products |
  | 969 | 955 | return false; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L976) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L962) |  |
  | 976 | 962 | } |
  | 977 | 963 | $rule['discount\_on\_product\_id'] = elex\_dp\_WPML\_Compatible\_ids($rule['discount\_on\_product\_id']); |
  | 978 |  | if (!empty($rule['discount\_on\_product\_id']) && is\_array($rule['discount\_on\_product\_id']) && (~~!in\_array($pid, $rule['discount\_on\_product\_id']) && !in\_array($product->get\_parent\_id(), $rule['discount\_on\_product\_id'])~~)) { |
  |  | 964 | if (!empty($rule['discount\_on\_product\_id']) && is\_array($rule['discount\_on\_product\_id']) && ( !in\_array($pid, $rule['discount\_on\_product\_id']) && !in\_array($product->get\_parent\_id(), $rule['discount\_on\_product\_id']) )) { |
  | 979 | 965 | return false; |
  | 980 | 966 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L985) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L971) |  |
  | 985 | 971 | $\_product = wc\_get\_product($pid); |
  | 986 | 972 | $old\_price = $\_product->get\_price(); |
  | 987 |  | $rule['calculated\_discount'] = (~~(float)$old\_price - (float)$new\_price~~) \* $current\_quantity; |
  |  | 973 | $rule['calculated\_discount'] = ( (float) $old\_price - (float) $new\_price ) \* $current\_quantity; |
  | 988 | 974 | } |
  | 989 | 975 | //checking roles and tofrom date for which rule is applicable |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L991) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L977) |  |
  | 991 | 977 | } |
  | 992 | 978 |  |
  | 993 |  | function elex\_dp\_checkProductRuleApplicableForProduct(&$rule = null, $product = null, $pid = null, $current\_quantity = 1, $price = 0, $weight = 0) |
  | 994 |  | { |
  |  | 979 | function elex\_dp\_checkProductRuleApplicableForProduct( &$rule = null, $product = null, $pid = null, $current\_quantity = 1, $price = 0, $weight = 0) { |
  | 995 | 980 | global $xa\_cart\_categories; |
  | 996 | 981 | global $xa\_cart\_quantities; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1000) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L985) |  |
  | 1000 | 985 | $pid = elex\_dp\_get\_pid($product); |
  | 1001 | 986 | } |
  | 1002 |  | $min          = (~~empty($rule['min']) == true~~) ? 1 : $rule['min']; |
  | 1003 |  | $max          = (~~empty($rule['max']) == true~~) ? 999999999 : $rule['max']; |
  | 1004 |  | $total\_price  = !empty($price) ? (~~$price \* $current\_quantity~~) : 0; |
  | 1005 |  | $total\_weight = !empty($weight) ? (~~(float)$weight \* $current\_quantity~~) : 0; |
  |  | 987 | $min          = ( empty($rule['min']) == true ) ? 1 : $rule['min']; |
  |  | 988 | $max          = ( empty($rule['max']) == true ) ? 999999999 : $rule['max']; |
  |  | 989 | $total\_price  = !empty($price) ? ( $price \* $current\_quantity ) : 0; |
  |  | 990 | $total\_weight = !empty($weight) ? ( (float) $weight \* $current\_quantity ) : 0; |
  | 1006 | 991 | if ($max < $min && $max != 0) { |
  | 1007 | 992 | return false; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1040) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L1025) |  |
  | 1040 | 1025 | if ($rule['rule\_on'] == 'products') { |
  | 1041 | 1026 | $pids = elex\_dp\_WPML\_Compatible\_ids($rule['product\_id']); |
  | 1042 |  | if (empty($pids) || (~~!is\_array($pids) || (!in\_array($check\_for\_pid, $pids) && !in\_array($pid, $pids))~~)) { |
  |  | 1027 | if (empty($pids) || ( !is\_array($pids) || ( !in\_array($check\_for\_pid, $pids) && !in\_array($pid, $pids) ) )) { |
  | 1043 | 1028 | return false; |
  | 1044 | 1029 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1074) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L1059) |  |
  | 1074 | 1059 | if ($rule['check\_on'] == 'Quantity') { |
  | 1075 | 1060 |  |
  | 1076 |  | if (is\_cart() && (~~empty($pid) || !in\_array($pid, array\_keys($xa\_cart\_quantities))~~)) { |
  |  | 1061 | if (is\_cart() && ( empty($pid) || !in\_array($pid, array\_keys($xa\_cart\_quantities)) )) { |
  | 1077 | 1062 | return false; |
  | 1078 | 1063 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1095) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L1080) |  |
  | 1095 | 1080 | foreach ($xa\_cart\_quantities as $\_pid => $\_qnty) { |
  | 1096 | 1081 | $total\_items\_in\_cart++; |
  | 1097 |  | if~~($pids && in\_array($\_pid, $pids))~~{ |
  |  | 1082 | if ($pids && in\_array($\_pid, $pids)) { |
  | 1098 | 1083 | $total\_all\_product\_items++; |
  | 1099 | 1084 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1102) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L1087) |  |
  | 1102 | 1087 |  |
  | 1103 | 1088 | //Conditions for different rule type |
  | 1104 |  | if ('products' === $rule['rule\_on'] && in\_array($pid, $rule\_product\_ids) && (~~$total\_all\_product\_items < $min || ($total\_all\_product\_items > $max && $repeat == false) || empty($total\_all\_product\_items)~~)) { |
  | 1105 |  | return false; |
  |  | 1089 | if ('products' === $rule['rule\_on'] && in\_array($pid, $rule\_product\_ids) && ( $total\_all\_product\_items < $min || ( $total\_all\_product\_items > $max && $repeat == false ) || empty($total\_all\_product\_items) )) { |
  |  | 1090 | return false; |
  | 1106 | 1091 |  |
  | 1107 |  | }else if ('categories' === $rule['rule\_on'] && $this->validate\_product\_matches\_categories(wc\_get\_product($pid), $rule)) { |
  |  | 1092 | } else if ('categories' === $rule['rule\_on'] && $this->validate\_product\_matches\_categories(wc\_get\_product($pid), $rule)) { |
  | 1108 | 1093 | $tmp=elex\_dp\_get\_category\_ids($pid); |
  | 1109 | 1094 | $product\_categories=!empty($tmp)?$tmp:array(); |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1113) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L1098) |  |
  | 1113 | 1098 | } |
  | 1114 | 1099 | foreach ($xa\_cart\_categories as $\_pid => $\_categories) { |
  | 1115 |  | $match=array\_intersect($matched,$\_categories); |
  |  | 1100 | $match=array\_intersect($matched, $\_categories); |
  | 1116 | 1101 | if (!empty($match)) { |
  | 1117 | 1102 | $total\_items\_of\_this\_category\_in\_cart++; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1126) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L1111) |  |
  | 1126 | 1111 | $total\_all\_units\_of\_this\_category\_in\_cart = 1; |
  | 1127 | 1112 | } |
  | 1128 |  | if~~($total\_items\_of\_this\_category\_in\_cart < $min || (($total\_items\_of\_this\_category\_in\_cart > $max && $repeat == false)) || empty($total\_items\_of\_this\_category\_in\_cart))~~{ |
  | 1129 |  | return false; |
  | 1130 |  | } |
  | 1131 |  |  |
  | 1132 |  | }~~else if (('cart' === $rule['rule\_on'])  && ($total\_items\_in\_cart < $min || (($total\_items\_in\_cart > $max && $repeat == false)) || empty($total\_items\_in\_cart)~~)) { |
  | 1133 |  | return false; |
  | 1134 |  | } |
  | 1135 |  | } elseif ($rule['check\_on'] == 'Weight' && (~~$total\_weight < $min || ($total\_weight > $max && $repeat == false) || empty($total\_weight)~~)) { |
  | 1136 |  | return false; |
  | 1137 |  | } elseif ($rule['check\_on'] == 'Price' && (~~$total\_price < $min || ($total\_price > $max && $repeat == false) || empty($total\_price)~~)) { |
  | 1138 |  | return false; |
  | 1139 |  | } elseif ($rule['check\_on'] == 'Units' && (~~$current\_quantity < $min || ($current\_quantity > $max && $repeat == false)~~)) { |
  |  | 1113 | if ($total\_items\_of\_this\_category\_in\_cart < $min || ( ( $total\_items\_of\_this\_category\_in\_cart > $max && $repeat == false ) ) || empty($total\_items\_of\_this\_category\_in\_cart)) { |
  |  | 1114 | return false; |
  |  | 1115 | } |
  |  | 1116 |  |
  |  | 1117 | } else if (( 'cart' === $rule['rule\_on'] )  && ( $total\_items\_in\_cart < $min || ( ( $total\_items\_in\_cart > $max && $repeat == false ) ) || empty($total\_items\_in\_cart) )) { |
  |  | 1118 | return false; |
  |  | 1119 | } |
  |  | 1120 | } elseif ($rule['check\_on'] == 'Weight' && ( $total\_weight < $min || ( $total\_weight > $max && $repeat == false ) || empty($total\_weight) )) { |
  |  | 1121 | return false; |
  |  | 1122 | } elseif ($rule['check\_on'] == 'Price' && ( $total\_price < $min || ( $total\_price > $max && $repeat == false ) || empty($total\_price) )) { |
  |  | 1123 | return false; |
  |  | 1124 | } elseif ($rule['check\_on'] == 'Units' && ( $current\_quantity < $min || ( $current\_quantity > $max && $repeat == false ) )) { |
  | 1140 | 1125 | return false; |
  | 1141 | 1126 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1147) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L1132) |  |
  | 1147 | 1132 | $\_product = wc\_get\_product($pid); |
  | 1148 | 1133 | $old\_price = $\_product->get\_price(); |
  | 1149 |  | $rule['calculated\_discount'] = (~~(float)$old\_price - (float)$new\_price~~) \* $current\_quantity; |
  |  | 1134 | $rule['calculated\_discount'] = ( (float) $old\_price - (float) $new\_price ) \* $current\_quantity; |
  | 1150 | 1135 | } |
  | 1151 | 1136 | //checking roles and tofrom date for which rule is applicable |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1153) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L1138) |  |
  | 1153 | 1138 | } |
  | 1154 | 1139 |  |
  | 1155 |  | function elex\_dp\_check\_date\_range\_and\_roles($rule, $rule\_type) |
  | 1156 |  | { |
  |  | 1140 | function elex\_dp\_check\_date\_range\_and\_roles( $rule, $rule\_type) { |
  | 1157 | 1141 | $fromdate   = $rule['from\_date']; |
  | 1158 | 1142 | $todate     = $rule['to\_date']; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1180) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L1164) |  |
  | 1180 | 1164 | $match = array\_intersect((array) $user\_roles, (array) $current\_user->roles); |
  | 1181 | 1165 | if (!in\_array('all', $user\_roles) && empty($match) && !empty($user\_roles)) { |
  | 1182 |  | if (!(~~in\_array('guest\_user', $user\_roles) && !is\_user\_logged\_in()~~)) { |
  |  | 1166 | if (!( in\_array('guest\_user', $user\_roles) && !is\_user\_logged\_in() )) { |
  | 1183 | 1167 | return false; |
  | 1184 | 1168 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1186) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L1170) |  |
  | 1186 | 1170 |  |
  | 1187 | 1171 | $now = current\_time('d-m-Y'); |
  | 1188 |  | if ((~~empty($fromdate) && empty($todate)) || (empty($fromdate) && empty($todate) == false && (strtotime($now) <= strtotime($todate))) || (empty($fromdate) == false && (strtotime($now) >= strtotime($fromdate)) && empty($todate)) || ((strtotime($now) >= strtotime($fromdate)) && (strtotime($now) <= strtotime($todate))~~)) { |
  |  | 1172 | if (( empty($fromdate) && empty($todate) ) || ( empty($fromdate) && empty($todate) == false && ( strtotime($now) <= strtotime($todate) ) ) || ( empty($fromdate) == false && ( strtotime($now) >= strtotime($fromdate) ) && empty($todate) ) || ( ( strtotime($now) >= strtotime($fromdate) ) && ( strtotime($now) <= strtotime($todate) ) )) { |
  | 1189 | 1173 | } else { |
  | 1190 | 1174 | return false; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1194) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L1178) |  |
  | 1194 | 1178 | } |
  | 1195 | 1179 |  |
  | 1196 |  | public function elex\_dp\_execute\_rule($old\_price, $rule\_type\_colon\_rule\_no, $rule, $current\_quantity = 1, $pid = 0, $object\_hash = '') |
  | 1197 |  | { |
  |  | 1180 | public function elex\_dp\_execute\_rule( $old\_price, $rule\_type\_colon\_rule\_no, $rule, $current\_quantity = 1, $pid = 0, $object\_hash = '') { |
  | 1198 | 1181 | global $executed\_rule\_pid\_price, $executed\_pids; |
  | 1199 | 1182 | $new\_price = $old\_price; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1245) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L1228) |  |
  | 1245 | 1228 | } |
  | 1246 | 1229 |  |
  | 1247 |  | public function elex\_dp\_calculate\_discount($old\_price, $rule\_no, $rule, $pid = 0, $current\_quantity = 1, $do\_not\_execute = false) |
  | 1248 |  | { |
  |  | 1230 | public function elex\_dp\_calculate\_discount( $old\_price, $rule\_no, $rule, $pid = 0, $current\_quantity = 1, $do\_not\_execute = false) { |
  | 1249 | 1231 | global $xa\_common\_flat\_discount, $xa\_cart\_quantities, $executed\_rule\_pid\_price, $xa\_cart\_categories\_units, $xa\_cart\_categories, $xa\_cart\_price; |
  | 1250 | 1232 | $new\_price           = $old\_price; |
  | 1251 |  | $type\_code           = $rule['rule\_type'] == 'product\_rules'  ?  (~~$rule['rule\_type'] . $pid~~)   :  $rule['rule\_type']; |
  |  | 1233 | $type\_code           = $rule['rule\_type'] == 'product\_rules'  ?  ( $rule['rule\_type'] . $pid )   :  $rule['rule\_type']; |
  | 1252 | 1234 | $cart\_quantity       = 0; |
  | 1253 | 1235 | $prev\_total\_discount = 0; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1269) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L1251) |  |
  | 1269 | 1251 | $rprice               = isset($xa\_cart\_price[$ppid]) ?  $xa\_cart\_price[$ppid] : 0; |
  | 1270 | 1252 | $sprice               = isset($executed\_rule\_pid\_price[$rule['rule\_type'] . ':' . $rule\_no][$ppid]) ?  $executed\_rule\_pid\_price[$rule['rule\_type'] . ':' . $rule\_no][$ppid] : $rprice; |
  | 1271 |  | $prev\_total\_discount += (~~$rprice - $sprice~~) \* $qnty; |
  |  | 1253 | $prev\_total\_discount += ( $rprice - $sprice ) \* $qnty; |
  | 1272 | 1254 | } |
  | 1273 | 1255 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1283) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L1265) |  |
  | 1283 | 1265 | $rprice               = isset($xa\_cart\_price[$ppid]) ?  $xa\_cart\_price[$ppid] : 0; |
  | 1284 | 1266 | $sprice               = isset($executed\_rule\_pid\_price[$rule['rule\_type'] . ':' . $rule\_no][$ppid]) ?  $executed\_rule\_pid\_price[$rule['rule\_type'] . ':' . $rule\_no][$ppid] : $rprice; |
  | 1285 |  | $prev\_total\_discount += (~~$rprice - $sprice~~) \* $units; |
  |  | 1267 | $prev\_total\_discount += ( $rprice - $sprice ) \* $units; |
  | 1286 | 1268 | } |
  | 1287 | 1269 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1303) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L1285) |  |
  | 1303 | 1285 | $discount\_amt = floatval($value) \* floatval($old\_price) / 100; |
  | 1304 | 1286 | } elseif ($discount\_type == 'Flat Discount') { |
  | 1305 |  | if~~($current\_quantity)~~{ |
  |  | 1287 | if ($current\_quantity) { |
  | 1306 | 1288 | if ($do\_not\_execute === true) { |
  | 1307 | 1289 | $discount\_amt = floatval($value); |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1312) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L1294) |  |
  | 1312 | 1294 | } elseif ($discount\_type == 'Fixed Price') { |
  | 1313 | 1295 | $discount\_amt = floatval($old\_price) - floatval($value); |
  | 1314 |  | } elseif~~($discount\_type == 'Coupon Discount')~~{ |
  | 1315 |  |  |
  | 1316 |  | if~~($rule['coupon\_discount\_type'] == 'percent')~~{ |
  |  | 1296 | } elseif ($discount\_type == 'Coupon Discount') { |
  |  | 1297 |  |
  |  | 1298 | if ($rule['coupon\_discount\_type'] == 'percent') { |
  | 1317 | 1299 |  |
  | 1318 | 1300 | $discount\_amt = floatval($value) \* floatval($old\_price) / 100; |
  | 1319 |  | } elseif ($rule['coupon\_discount\_type'] == 'fixed\_cart'){ |
  | 1320 |  | if~~($current\_quantity)~~{ |
  |  | 1301 | } elseif ($rule['coupon\_discount\_type'] == 'fixed\_cart') { |
  |  | 1302 | if ($current\_quantity) { |
  | 1321 | 1303 | if ($do\_not\_execute === true) { |
  | 1322 | 1304 | $discount\_amt = floatval($value); |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1326) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L1308) |  |
  | 1326 | 1308 | } |
  | 1327 | 1309 |  |
  | 1328 |  | } elseif ($rule['coupon\_discount\_type'] == 'fixed\_product'){ |
  |  | 1310 | } elseif ($rule['coupon\_discount\_type'] == 'fixed\_product') { |
  | 1329 | 1311 | $discount\_amt = floatval($old\_price) - floatval($value); |
  | 1330 | 1312 | } else { |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1339) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L1321) |  |
  | 1339 | 1321 | } |
  | 1340 | 1322 |  |
  | 1341 |  | if (!empty($max\_discount) && is\_numeric($max\_discount) && (~~(($discount\_amt \* $cart\_quantity) + $prev\_total\_discount) >= $max\_discount~~)) { |
  | 1342 |  | $discount\_amt = (~~$max\_discount - $prev\_total\_discount~~) / $cart\_quantity; |
  |  | 1323 | if (!empty($max\_discount) && is\_numeric($max\_discount) && ( ( ( $discount\_amt \* $cart\_quantity ) + $prev\_total\_discount ) >= $max\_discount )) { |
  |  | 1324 | $discount\_amt = ( $max\_discount - $prev\_total\_discount ) / $cart\_quantity; |
  | 1343 | 1325 | } |
  | 1344 | 1326 |  |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1348) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L1330) |  |
  | 1348 | 1330 |  |
  | 1349 | 1331 | } |
  | 1350 |  | ~~if($old\_price && $discount\_amt)~~{ |
  | 1351 |  | $new\_price = (float)~~$old\_price - (float)~~$discount\_amt; |
  |  | 1332 | if ($old\_price && $discount\_amt) { |
  |  | 1333 | $new\_price = (float) $old\_price - (float) $discount\_amt; |
  | 1352 | 1334 | } |
  | 1353 | 1335 | if (isset($\_GET['debug']) && $do\_not\_execute == false) { |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1357) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L1339) |  |
  | 1357 | 1339 | if (!empty($rule['discount\_on\_product\_id']) && in\_array($pid, $rule['discount\_on\_product\_id']) && !empty($rule['product\_id'][$pid]) && !empty($xa\_cart\_quantities[$pid]) && $rule['product\_id'][$pid] < $xa\_cart\_quantities[$pid]) { |
  | 1358 | 1340 | $remaining\_qnty = $xa\_cart\_quantities[$pid] - $rule['product\_id'][$pid]; |
  | 1359 |  | $new\_price      =  (~~($new\_price \* $rule['product\_id'][$pid]) + ($old\_price \* $remaining\_qnty)~~) / $xa\_cart\_quantities[$pid]; |
  |  | 1341 | $new\_price      =  ( ( $new\_price \* $rule['product\_id'][$pid] ) + ( $old\_price \* $remaining\_qnty ) ) / $xa\_cart\_quantities[$pid]; |
  | 1360 | 1342 | } |
  | 1361 | 1343 | return $new\_price; |
  | 1362 | 1344 | } |
  | 1363 | 1345 |  |
  | 1364 |  | public function elex\_dp\_SimpleExecute($old\_price, $rule\_no, $rule, $pid = 0, $current\_quantity = 1, $do\_not\_execute = false, $object\_hash = '') |
  | 1365 |  | { |
  |  | 1346 | public function elex\_dp\_SimpleExecute( $old\_price, $rule\_no, $rule, $pid = 0, $current\_quantity = 1, $do\_not\_execute = false, $object\_hash = '') { |
  | 1366 | 1347 | global $xa\_common\_flat\_discount, $xa\_cart\_quantities, $executed\_rule\_pid\_price, $xa\_cart\_categories\_units, $xa\_cart\_categories, $xa\_cart\_price; |
  | 1367 | 1348 | $new\_price           = $old\_price; |
  | 1368 |  | $type\_code           = $rule['rule\_type'] == 'product\_rules'  ?  (~~$rule['rule\_type'] . $pid~~)   :  $rule['rule\_type']; |
  |  | 1349 | $type\_code           = $rule['rule\_type'] == 'product\_rules'  ?  ( $rule['rule\_type'] . $pid )   :  $rule['rule\_type']; |
  | 1369 | 1350 | $cart\_quantity       = 0; |
  | 1370 | 1351 | $prev\_total\_discount = 0; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1386) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L1367) |  |
  | 1386 | 1367 | $rprice               = isset($xa\_cart\_price[$ppid]) ?  $xa\_cart\_price[$ppid] : 0; |
  | 1387 | 1368 | $sprice               = isset($executed\_rule\_pid\_price[$rule['rule\_type'] . ':' . $rule\_no][$ppid]) ?  $executed\_rule\_pid\_price[$rule['rule\_type'] . ':' . $rule\_no][$ppid] : $rprice; |
  | 1388 |  | $prev\_total\_discount += (~~$rprice - $sprice~~) \* $qnty; |
  |  | 1369 | $prev\_total\_discount += ( $rprice - $sprice ) \* $qnty; |
  | 1389 | 1370 | } |
  | 1390 | 1371 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1400) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L1381) |  |
  | 1400 | 1381 | $rprice               = isset($xa\_cart\_price[$ppid]) ?  $xa\_cart\_price[$ppid] : 0; |
  | 1401 | 1382 | $sprice               = isset($executed\_rule\_pid\_price[$rule['rule\_type'] . ':' . $rule\_no][$ppid]) ?  $executed\_rule\_pid\_price[$rule['rule\_type'] . ':' . $rule\_no][$ppid] : $rprice; |
  | 1402 |  | $prev\_total\_discount += (~~$rprice - $sprice~~) \* $units; |
  |  | 1383 | $prev\_total\_discount += ( $rprice - $sprice ) \* $units; |
  | 1403 | 1384 | } |
  | 1404 | 1385 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1420) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L1401) |  |
  | 1420 | 1401 | $discount\_amt = floatval($value) \* floatval($old\_price) / 100; |
  | 1421 | 1402 | } elseif ($discount\_type == 'Flat Discount') { |
  | 1422 |  | if~~($current\_quantity)~~{ |
  |  | 1403 | if ($current\_quantity) { |
  | 1423 | 1404 | if ($do\_not\_execute === true) { |
  | 1424 | 1405 | $discount\_amt = floatval($value); |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1437) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L1418) |  |
  | 1437 | 1418 | } |
  | 1438 | 1419 |  |
  | 1439 |  | if (!empty($max\_discount) && is\_numeric($max\_discount) && (~~(($discount\_amt \* $cart\_quantity) + $prev\_total\_discount) >= $max\_discount~~)) { |
  | 1440 |  | $discount\_amt = (~~$max\_discount - $prev\_total\_discount~~) / $cart\_quantity; |
  |  | 1420 | if (!empty($max\_discount) && is\_numeric($max\_discount) && ( ( ( $discount\_amt \* $cart\_quantity ) + $prev\_total\_discount ) >= $max\_discount )) { |
  |  | 1421 | $discount\_amt = ( $max\_discount - $prev\_total\_discount ) / $cart\_quantity; |
  | 1441 | 1422 | } |
  | 1442 | 1423 |  |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1453) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L1434) |  |
  | 1453 | 1434 | if (!empty($rule['discount\_on\_product\_id']) && in\_array($pid, $rule['discount\_on\_product\_id']) && !empty($rule['product\_id'][$pid]) && !empty($xa\_cart\_quantities[$pid]) && $rule['product\_id'][$pid] < $xa\_cart\_quantities[$pid]) { |
  | 1454 | 1435 | $remaining\_qnty = $xa\_cart\_quantities[$pid] - $rule['product\_id'][$pid]; |
  | 1455 |  | $new\_price      =  (~~($new\_price \* $rule['product\_id'][$pid]) + ($old\_price \* $remaining\_qnty)~~) / $xa\_cart\_quantities[$pid]; |
  |  | 1436 | $new\_price      =  ( ( $new\_price \* $rule['product\_id'][$pid] ) + ( $old\_price \* $remaining\_qnty ) ) / $xa\_cart\_quantities[$pid]; |
  | 1456 | 1437 | } |
  | 1457 | 1438 | ///// adding to cache |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1465) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L1446) |  |
  | 1465 | 1446 | } |
  | 1466 | 1447 |  |
  | 1467 |  | public function elex\_dp\_Simple\_Category\_Combinational\_Execute($old\_price, $rule\_no, $rule, $pid = 0, $current\_quantity = 1, $do\_not\_execute = false, $object\_hash = '') |
  | 1468 |  | { |
  |  | 1448 | public function elex\_dp\_Simple\_Category\_Combinational\_Execute( $old\_price, $rule\_no, $rule, $pid = 0, $current\_quantity = 1, $do\_not\_execute = false, $object\_hash = '') { |
  | 1469 | 1449 | global $xa\_common\_flat\_discount, $xa\_cart\_quantities, $executed\_rule\_pid\_price, $xa\_cart\_categories\_units, $xa\_cart\_categories, $xa\_cart\_price; |
  | 1470 | 1450 | $new\_price           = $old\_price; |
  | 1471 |  | $type\_code           = $rule['rule\_type'] == 'product\_rules'  ?  (~~$rule['rule\_type'] . $pid~~)   :  $rule['rule\_type']; |
  |  | 1451 | $type\_code           = $rule['rule\_type'] == 'product\_rules'  ?  ( $rule['rule\_type'] . $pid )   :  $rule['rule\_type']; |
  | 1472 | 1452 | $prev\_total\_discount = 0; |
  | 1473 | 1453 | $cart\_quantity       = isset($xa\_cart\_quantities[$pid]) ?  $xa\_cart\_quantities[$pid] : 0; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1478) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L1458) |  |
  | 1478 | 1458 | $rprice               = isset($xa\_cart\_price[$ppid]) ?  $xa\_cart\_price[$ppid] : 0; |
  | 1479 | 1459 | $sprice               = isset($executed\_rule\_pid\_price[$rule['rule\_type'] . ':' . $rule\_no][$ppid]) ?  $executed\_rule\_pid\_price[$rule['rule\_type'] . ':' . $rule\_no][$ppid] : $rprice; |
  | 1480 |  | $prev\_total\_discount += (~~$rprice - $sprice~~) \* $qnty; |
  |  | 1460 | $prev\_total\_discount += ( $rprice - $sprice ) \* $qnty; |
  | 1481 | 1461 | } |
  | 1482 | 1462 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1489) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L1469) |  |
  | 1489 | 1469 | $discount\_amt = floatval($value) \* floatval($old\_price) / 100; |
  | 1490 | 1470 | } elseif ($discount\_type == 'Flat Discount') { |
  | 1491 |  | if~~($current\_quantity)~~{ |
  |  | 1471 | if ($current\_quantity) { |
  | 1492 | 1472 | if ($do\_not\_execute === true) { |
  | 1493 | 1473 | $discount\_amt = floatval($value); |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1506) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L1486) |  |
  | 1506 | 1486 | } |
  | 1507 | 1487 |  |
  | 1508 |  | if (!empty($max\_discount) && is\_numeric($max\_discount) && (~~(($discount\_amt \* $cart\_quantity) + $prev\_total\_discount) >= $max\_discount~~)) { |
  | 1509 |  | $discount\_amt = (~~$max\_discount - $prev\_total\_discount~~) / $cart\_quantity; |
  |  | 1488 | if (!empty($max\_discount) && is\_numeric($max\_discount) && ( ( ( $discount\_amt \* $cart\_quantity ) + $prev\_total\_discount ) >= $max\_discount )) { |
  |  | 1489 | $discount\_amt = ( $max\_discount - $prev\_total\_discount ) / $cart\_quantity; |
  | 1510 | 1490 | } |
  | 1511 | 1491 |  |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1522) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L1502) |  |
  | 1522 | 1502 | if (!empty($rule['discount\_on\_product\_id']) && in\_array($pid, $rule['discount\_on\_product\_id']) && !empty($rule['product\_id'][$pid]) && !empty($xa\_cart\_quantities[$pid]) && $rule['product\_id'][$pid] < $xa\_cart\_quantities[$pid]) { |
  | 1523 | 1503 | $remaining\_qnty = $xa\_cart\_quantities[$pid] - $rule['product\_id'][$pid]; |
  | 1524 |  | $new\_price      =  (~~($new\_price \* $rule['product\_id'][$pid]) + ($old\_price \* $remaining\_qnty)~~) / $xa\_cart\_quantities[$pid]; |
  |  | 1504 | $new\_price      =  ( ( $new\_price \* $rule['product\_id'][$pid] ) + ( $old\_price \* $remaining\_qnty ) ) / $xa\_cart\_quantities[$pid]; |
  | 1525 | 1505 | } |
  | 1526 | 1506 | ///// adding to cache |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1534) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L1514) |  |
  | 1534 | 1514 | } |
  | 1535 | 1515 |  |
  | 1536 |  | public function elex\_dp\_Simple\_Combinational\_Execute($old\_price, $rule\_no, $rule, $pid = 0, $current\_quantity = 1, $do\_not\_execute = false, $object\_hash = '') |
  | 1537 |  | { |
  |  | 1516 | public function elex\_dp\_Simple\_Combinational\_Execute( $old\_price, $rule\_no, $rule, $pid = 0, $current\_quantity = 1, $do\_not\_execute = false, $object\_hash = '') { |
  | 1538 | 1517 | global $xa\_common\_flat\_discount, $xa\_cart\_quantities, $executed\_rule\_pid\_price, $xa\_cart\_categories\_units, $xa\_cart\_categories, $xa\_cart\_price; |
  | 1539 | 1518 | $new\_price           = $old\_price; |
  | 1540 |  | $type\_code           = $rule['rule\_type'] == 'product\_rules'  ?  (~~$rule['rule\_type'] . $pid~~)   :  $rule['rule\_type']; |
  |  | 1519 | $type\_code           = $rule['rule\_type'] == 'product\_rules'  ?  ( $rule['rule\_type'] . $pid )   :  $rule['rule\_type']; |
  | 1541 | 1520 | $prev\_total\_discount = 0; |
  | 1542 | 1521 | $cart\_quantity       = isset($xa\_cart\_quantities[$pid]) ?  $xa\_cart\_quantities[$pid] : 0; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1546) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L1525) |  |
  | 1546 | 1525 | $rprice               = isset($xa\_cart\_price[$ppid]) ?  $xa\_cart\_price[$ppid] : 0; |
  | 1547 | 1526 | $sprice               = isset($executed\_rule\_pid\_price[$rule['rule\_type'] . ':' . $rule\_no][$ppid]) ?  $executed\_rule\_pid\_price[$rule['rule\_type'] . ':' . $rule\_no][$ppid] : $rprice; |
  | 1548 |  | $prev\_total\_discount += (~~$rprice - $sprice~~) \* $qnty; |
  |  | 1527 | $prev\_total\_discount += ( $rprice - $sprice ) \* $qnty; |
  | 1549 | 1528 | } |
  | 1550 | 1529 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1557) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L1536) |  |
  | 1557 | 1536 | $discount\_amt = floatval($value) \* floatval($old\_price) / 100; |
  | 1558 | 1537 | } elseif ($discount\_type == 'Flat Discount') { |
  | 1559 |  | if~~($current\_quantity)~~{ |
  |  | 1538 | if ($current\_quantity) { |
  | 1560 | 1539 | if ($do\_not\_execute === true) { |
  | 1561 | 1540 | $discount\_amt = floatval($value); |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1574) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L1553) |  |
  | 1574 | 1553 | } |
  | 1575 | 1554 |  |
  | 1576 |  | if (!empty($max\_discount) && is\_numeric($max\_discount) && (~~(($discount\_amt \* $cart\_quantity) + $prev\_total\_discount) >= $max\_discount~~)) { |
  | 1577 |  | $discount\_amt = (~~$max\_discount - $prev\_total\_discount~~) / $cart\_quantity; |
  |  | 1555 | if (!empty($max\_discount) && is\_numeric($max\_discount) && ( ( ( $discount\_amt \* $cart\_quantity ) + $prev\_total\_discount ) >= $max\_discount )) { |
  |  | 1556 | $discount\_amt = ( $max\_discount - $prev\_total\_discount ) / $cart\_quantity; |
  | 1578 | 1557 | } |
  | 1579 | 1558 |  |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1591) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L1570) |  |
  | 1591 | 1570 | // removed this code to make restrictions work for any quantity |
  | 1592 | 1571 | //$remaining\_qnty=$xa\_cart\_quantities[$pid]-$rule['product\_id'][$pid]; |
  | 1593 |  | $new\_price =  (~~$new\_price \* $rule['product\_id'][$pid]~~); // + ($old\_price \* $remaining\_qnty ))/$xa\_cart\_quantities[$pid]; |
  |  | 1572 | $new\_price =  ( $new\_price \* $rule['product\_id'][$pid] ); // + ($old\_price \* $remaining\_qnty ))/$xa\_cart\_quantities[$pid]; |
  | 1594 | 1573 | } |
  | 1595 | 1574 | ///// adding to cache |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1604) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L1583) |  |
  | 1604 | 1583 |  |
  | 1605 | 1584 |  |
  | 1606 |  | public function elex\_dp\_Simple\_Cart\_Execute($old\_price, $rule\_no, $rule, $pid = 0, $current\_quantity = 1, $do\_not\_execute = false, $object\_hash = '') |
  | 1607 |  | { |
  |  | 1585 | public function elex\_dp\_Simple\_Cart\_Execute( $old\_price, $rule\_no, $rule, $pid = 0, $current\_quantity = 1, $do\_not\_execute = false, $object\_hash = '') { |
  | 1608 | 1586 | global $xa\_common\_flat\_discount, $xa\_cart\_quantities, $executed\_rule\_pid\_price, $xa\_cart\_categories\_units, $xa\_cart\_categories, $xa\_cart\_price; |
  | 1609 | 1587 | $new\_price           = $old\_price; |
  | 1610 |  | $type\_code           = $rule['rule\_type'] == 'product\_rules'  ?  (~~$rule['rule\_type'] . $pid~~)   :  $rule['rule\_type']; |
  |  | 1588 | $type\_code           = $rule['rule\_type'] == 'product\_rules'  ?  ( $rule['rule\_type'] . $pid )   :  $rule['rule\_type']; |
  | 1611 | 1589 | $cart\_quantity       = 0; |
  | 1612 | 1590 | $prev\_total\_discount = 0; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1617) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L1595) |  |
  | 1617 | 1595 | $rprice               = isset($xa\_cart\_price[$ppid]) ?  $xa\_cart\_price[$ppid] : 0; |
  | 1618 | 1596 | $sprice               = isset($executed\_rule\_pid\_price[$rule['rule\_type'] . ':' . $rule\_no][$ppid]) ?  $executed\_rule\_pid\_price[$rule['rule\_type'] . ':' . $rule\_no][$ppid] : $rprice; |
  | 1619 |  | $prev\_total\_discount += (~~$rprice - $sprice~~) \* $qnty; |
  |  | 1597 | $prev\_total\_discount += ( $rprice - $sprice ) \* $qnty; |
  | 1620 | 1598 | } |
  | 1621 | 1599 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1629) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L1607) |  |
  | 1629 | 1607 | $discount\_amt = floatval($value) \* floatval($old\_price) / 100; |
  | 1630 | 1608 | } elseif ($discount\_type == 'Flat Discount') { |
  | 1631 |  | if~~($current\_quantity)~~{ |
  |  | 1609 | if ($current\_quantity) { |
  | 1632 | 1610 | if ($do\_not\_execute === true) { |
  | 1633 | 1611 | $discount\_amt = floatval($value); |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1646) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L1624) |  |
  | 1646 | 1624 | } |
  | 1647 | 1625 |  |
  | 1648 |  | if (!empty($max\_discount) && is\_numeric($max\_discount) && (~~(($discount\_amt \* $cart\_quantity) + $prev\_total\_discount) >= $max\_discount~~)) { |
  | 1649 |  | $discount\_amt = (~~$max\_discount - $prev\_total\_discount~~) / $cart\_quantity; |
  |  | 1626 | if (!empty($max\_discount) && is\_numeric($max\_discount) && ( ( ( $discount\_amt \* $cart\_quantity ) + $prev\_total\_discount ) >= $max\_discount )) { |
  |  | 1627 | $discount\_amt = ( $max\_discount - $prev\_total\_discount ) / $cart\_quantity; |
  | 1650 | 1628 | } |
  | 1651 | 1629 |  |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1661) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L1639) |  |
  | 1661 | 1639 | if (!empty($rule['discount\_on\_product\_id']) && in\_array($pid, $rule['discount\_on\_product\_id']) && !empty($rule['product\_id'][$pid]) && !empty($xa\_cart\_quantities[$pid]) && $rule['product\_id'][$pid] < $xa\_cart\_quantities[$pid]) { |
  | 1662 | 1640 | $remaining\_qnty = $xa\_cart\_quantities[$pid] - $rule['product\_id'][$pid]; |
  | 1663 |  | $new\_price      =  (~~($new\_price \* $rule['product\_id'][$pid]) + ($old\_price \* $remaining\_qnty)~~) / $xa\_cart\_quantities[$pid]; |
  |  | 1641 | $new\_price      =  ( ( $new\_price \* $rule['product\_id'][$pid] ) + ( $old\_price \* $remaining\_qnty ) ) / $xa\_cart\_quantities[$pid]; |
  | 1664 | 1642 | } |
  | 1665 | 1643 | ///// adding to cache |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1674) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L1652) |  |
  | 1674 | 1652 |  |
  | 1675 | 1653 |  |
  | 1676 |  | public function elex\_dp\_Simple\_Category\_Execute($old\_price, $rule\_no, $rule, $pid = 0, $current\_quantity = 1, $do\_not\_execute = false, $object\_hash = '') |
  | 1677 |  | { |
  |  | 1654 | public function elex\_dp\_Simple\_Category\_Execute( $old\_price, $rule\_no, $rule, $pid = 0, $current\_quantity = 1, $do\_not\_execute = false, $object\_hash = '') { |
  | 1678 | 1655 | global $xa\_common\_flat\_discount, $xa\_cart\_quantities, $executed\_rule\_pid\_price, $xa\_cart\_categories\_units, $xa\_cart\_categories, $xa\_cart\_price; |
  | 1679 | 1656 | $new\_price           = $old\_price; |
  | 1680 |  | $type\_code           = $rule['rule\_type'] == 'product\_rules'  ?  (~~$rule['rule\_type'] . $pid~~)   :  $rule['rule\_type']; |
  |  | 1657 | $type\_code           = $rule['rule\_type'] == 'product\_rules'  ?  ( $rule['rule\_type'] . $pid )   :  $rule['rule\_type']; |
  | 1681 | 1658 | $cart\_quantity       = 0; |
  | 1682 | 1659 | $prev\_total\_discount = 0; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1694) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L1671) |  |
  | 1694 | 1671 | $rprice               = isset($xa\_cart\_price[$ppid]) ?  $xa\_cart\_price[$ppid] : 0; |
  | 1695 | 1672 | $sprice               = isset($executed\_rule\_pid\_price[$rule['rule\_type'] . ':' . $rule\_no][$ppid]) ?  $executed\_rule\_pid\_price[$rule['rule\_type'] . ':' . $rule\_no][$ppid] : $rprice; |
  | 1696 |  | $prev\_total\_discount += (~~$rprice - $sprice~~) \* $units; |
  |  | 1673 | $prev\_total\_discount += ( $rprice - $sprice ) \* $units; |
  | 1697 | 1674 | } |
  | 1698 | 1675 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1710) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L1687) |  |
  | 1710 | 1687 | $discount\_amt = floatval($value) \* floatval($old\_price) / 100; |
  | 1711 | 1688 | } elseif ($discount\_type == 'Flat Discount') { |
  | 1712 |  | if~~($current\_quantity)~~{ |
  |  | 1689 | if ($current\_quantity) { |
  | 1713 | 1690 | if ($do\_not\_execute === true) { |
  | 1714 | 1691 | $discount\_amt = floatval($value); |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1723) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L1700) |  |
  | 1723 | 1700 | } |
  | 1724 | 1701 |  |
  | 1725 |  | if (!empty($max\_discount) && is\_numeric($max\_discount) && (~~(($discount\_amt \* $cart\_quantity) + $prev\_total\_discount) >= $max\_discount~~)) { |
  | 1726 |  | $discount\_amt = (~~$max\_discount - $prev\_total\_discount~~) / $cart\_quantity; |
  |  | 1702 | if (!empty($max\_discount) && is\_numeric($max\_discount) && ( ( ( $discount\_amt \* $cart\_quantity ) + $prev\_total\_discount ) >= $max\_discount )) { |
  |  | 1703 | $discount\_amt = ( $max\_discount - $prev\_total\_discount ) / $cart\_quantity; |
  | 1727 | 1704 | } |
  | 1728 | 1705 |  |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1738) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L1715) |  |
  | 1738 | 1715 | if (!empty($rule['discount\_on\_product\_id']) && in\_array($pid, $rule['discount\_on\_product\_id']) && !empty($rule['product\_id'][$pid]) && !empty($xa\_cart\_quantities[$pid]) && $rule['product\_id'][$pid] < $xa\_cart\_quantities[$pid]) { |
  | 1739 | 1716 | $remaining\_qnty = $xa\_cart\_quantities[$pid] - $rule['product\_id'][$pid]; |
  | 1740 |  | $new\_price      =  (~~($new\_price \* $rule['product\_id'][$pid]) + ($old\_price \* $remaining\_qnty)~~) / $xa\_cart\_quantities[$pid]; |
  |  | 1717 | $new\_price      =  ( ( $new\_price \* $rule['product\_id'][$pid] ) + ( $old\_price \* $remaining\_qnty ) ) / $xa\_cart\_quantities[$pid]; |
  | 1741 | 1718 | } |
  | 1742 | 1719 | ///// adding to cache |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1750) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L1727) |  |
  | 1750 | 1727 | } |
  | 1751 | 1728 |  |
  | 1752 |  | public function elex\_dp\_Simple\_Tag\_Execute($old\_price, $rule\_no, $rule, $pid = 0, $current\_quantity = 1, $do\_not\_execute = false, $object\_hash = '') |
  | 1753 |  | { |
  |  | 1729 | public function elex\_dp\_Simple\_Tag\_Execute( $old\_price, $rule\_no, $rule, $pid = 0, $current\_quantity = 1, $do\_not\_execute = false, $object\_hash = '') { |
  | 1754 | 1730 | global $xa\_common\_flat\_discount, $xa\_cart\_quantities, $executed\_rule\_pid\_price, $xa\_cart\_tags\_units, $xa\_cart\_tags, $xa\_cart\_price; |
  | 1755 | 1731 | $new\_price           = $old\_price; |
  | 1756 |  | $type\_code           = $rule['rule\_type'] == 'product\_rules'  ?  (~~$rule['rule\_type'] . $pid~~)   :  $rule['rule\_type']; |
  |  | 1732 | $type\_code           = $rule['rule\_type'] == 'product\_rules'  ?  ( $rule['rule\_type'] . $pid )   :  $rule['rule\_type']; |
  | 1757 | 1733 | $cart\_quantity       = 0; |
  | 1758 | 1734 | $prev\_total\_discount = 0; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1770) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L1746) |  |
  | 1770 | 1746 | $rprice               = isset($xa\_cart\_price[$ppid]) ?  $xa\_cart\_price[$ppid] : 0; |
  | 1771 | 1747 | $sprice               = isset($executed\_rule\_pid\_price[$rule['rule\_type'] . ':' . $rule\_no][$ppid]) ?  $executed\_rule\_pid\_price[$rule['rule\_type'] . ':' . $rule\_no][$ppid] : $rprice; |
  | 1772 |  | $prev\_total\_discount += (~~$rprice - $sprice~~) \* $units; |
  |  | 1748 | $prev\_total\_discount += ( $rprice - $sprice ) \* $units; |
  | 1773 | 1749 | } |
  | 1774 | 1750 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1786) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L1762) |  |
  | 1786 | 1762 | $discount\_amt = floatval($value) \* floatval($old\_price) / 100; |
  | 1787 | 1763 | } elseif ($discount\_type == 'Flat Discount') { |
  | 1788 |  | if~~($current\_quantity)~~{ |
  |  | 1764 | if ($current\_quantity) { |
  | 1789 | 1765 | if ($do\_not\_execute === true) { |
  | 1790 | 1766 | $discount\_amt = floatval($value); |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1799) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L1775) |  |
  | 1799 | 1775 | } |
  | 1800 | 1776 |  |
  | 1801 |  | if (!empty($max\_discount) && is\_numeric($max\_discount) && (~~(($discount\_amt \* $cart\_quantity) + $prev\_total\_discount) >= $max\_discount~~)) { |
  | 1802 |  | $discount\_amt = (~~$max\_discount - $prev\_total\_discount~~) / $cart\_quantity; |
  |  | 1777 | if (!empty($max\_discount) && is\_numeric($max\_discount) && ( ( ( $discount\_amt \* $cart\_quantity ) + $prev\_total\_discount ) >= $max\_discount )) { |
  |  | 1778 | $discount\_amt = ( $max\_discount - $prev\_total\_discount ) / $cart\_quantity; |
  | 1803 | 1779 | } |
  | 1804 | 1780 |  |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1814) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L1790) |  |
  | 1814 | 1790 | if (!empty($rule['discount\_on\_product\_id']) && in\_array($pid, $rule['discount\_on\_product\_id']) && !empty($rule['product\_id'][$pid]) && !empty($xa\_cart\_quantities[$pid]) && $rule['product\_id'][$pid] < $xa\_cart\_quantities[$pid]) { |
  | 1815 | 1791 | $remaining\_qnty = $xa\_cart\_quantities[$pid] - $rule['product\_id'][$pid]; |
  | 1816 |  | $new\_price      =  (~~($new\_price \* $rule['product\_id'][$pid]) + ($old\_price \* $remaining\_qnty)~~) / $xa\_cart\_quantities[$pid]; |
  |  | 1792 | $new\_price      =  ( ( $new\_price \* $rule['product\_id'][$pid] ) + ( $old\_price \* $remaining\_qnty ) ) / $xa\_cart\_quantities[$pid]; |
  | 1817 | 1793 | } |
  | 1818 | 1794 | ///// adding to cache |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1826) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L1802) |  |
  | 1826 | 1802 | } |
  | 1827 | 1803 |  |
  | 1828 |  | public function elex\_dp\_ExecuteBOGORule($old\_price, $rule\_no, $rule, $pid = 0, $current\_quantity = 1) |
  | 1829 |  | { |
  |  | 1804 | public function elex\_dp\_ExecuteBOGORule( $old\_price, $rule\_no, $rule, $pid = 0, $current\_quantity = 1) { |
  | 1830 | 1805 | global $xa\_dp\_setting; |
  | 1831 | 1806 | global $woocommerce; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1844) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L1819) |  |
  | 1844 | 1819 | foreach ($rule['purchased\_product\_id'] as $\_pid => $\_qnty) { |
  | 1845 | 1820 | if (!empty($xa\_cart\_quantities[$\_pid]) && !empty($\_qnty) && $xa\_cart\_quantities[$\_pid] > $\_qnty) { |
  | 1846 |  | $tmp = (int) (~~$xa\_cart\_quantities[$\_pid] / $\_qnty~~); |
  |  | 1821 | $tmp = (int) ( $xa\_cart\_quantities[$\_pid] / $\_qnty ); |
  | 1847 | 1822 | if ($tmp > 1 && $tmp < $multiple) { |
  | 1848 | 1823 | $multiple = $tmp; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1859) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L1834) |  |
  | 1859 | 1834 | } |
  | 1860 | 1835 | if ($total\_childs\_qty\_in\_cart) { |
  | 1861 |  | $tmp = (int) (~~$total\_childs\_qty\_in\_cart / $\_qnty~~); |
  |  | 1836 | $tmp = (int) ( $total\_childs\_qty\_in\_cart / $\_qnty ); |
  | 1862 | 1837 | if ($tmp > 1 && $tmp < $multiple) { |
  | 1863 | 1838 | $multiple = $tmp; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1873) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L1848) |  |
  | 1873 | 1848 |  |
  | 1874 | 1849 | //If free product is set |
  | 1875 |  | if (!isset($rule['set\_free\_option']) || (~~isset($rule['set\_free\_option']) && $rule['set\_free\_option'] == 'select\_product'~~)) { |
  |  | 1850 | if (!isset($rule['set\_free\_option']) || ( isset($rule['set\_free\_option']) && $rule['set\_free\_option'] == 'select\_product' )) { |
  | 1876 | 1851 |  |
  | 1877 | 1852 | ////////if free product is already in cart with exact quanitty this code will set its price as zero |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1888) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L1863) |  |
  | 1888 | 1863 | $free\_unit = $free\_unit > $unit ? $unit : $free\_unit; |
  | 1889 | 1864 |  |
  | 1890 |  | if~~(array\_key\_exists($pid, $rule['purchased\_product\_id']) && array\_key\_exists($pid, $rule['free\_product\_id']))~~{ |
  | 1891 |  | if~~($free\_unit >= $unit)~~{ |
  | 1892 |  | $free\_unit = $unit - (int)$rule['purchased\_product\_id'][$pid]; |
  | 1893 |  | }~~else~~{ |
  | 1894 |  | $free\_unit = (~~$rule['free\_product\_id'][$pid]~~); |
  | 1895 |  | } |
  | 1896 |  | } |
  | 1897 |  | if ($all\_free\_product\_present == true && (~~is\_cart() || is\_ajax() || is\_checkout()~~)) { |
  |  | 1865 | if (array\_key\_exists($pid, $rule['purchased\_product\_id']) && array\_key\_exists($pid, $rule['free\_product\_id'])) { |
  |  | 1866 | if ($free\_unit >= $unit) { |
  |  | 1867 | $free\_unit = $unit - (int) $rule['purchased\_product\_id'][$pid]; |
  |  | 1868 | } else { |
  |  | 1869 | $free\_unit = ( $rule['free\_product\_id'][$pid] ); |
  |  | 1870 | } |
  |  | 1871 | } |
  |  | 1872 | if ($all\_free\_product\_present == true && ( is\_cart() || is\_ajax() || is\_checkout() )) { |
  | 1898 | 1873 | $total\_adjustment\_price = 0; |
  | 1899 | 1874 | if (isset($adjustment) && is\_numeric($adjustment)) { |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1906) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L1881) |  |
  | 1906 | 1881 | $total\_adjustment\_price = 0; |
  | 1907 | 1882 | } |
  | 1908 |  | if ((~~$unit - (float) $free\_unit \* $multiple~~) < 0) { //to make repeat rule work with auto add disabled |
  |  | 1883 | if (( $unit - (float) $free\_unit \* $multiple ) < 0) { //to make repeat rule work with auto add disabled |
  | 1909 | 1884 | $total\_old\_price = 0; |
  | 1910 | 1885 | } else { |
  | 1911 |  | $total\_old\_price = $old\_price \* (~~$unit - (float) $free\_unit \* $multiple~~); |
  |  | 1886 | $total\_old\_price = $old\_price \* ( $unit - (float) $free\_unit \* $multiple ); |
  | 1912 | 1887 | } |
  | 1913 | 1888 | if ($xa\_dp\_setting['auto\_add\_free\_product\_on\_off'] == 'on') { |
  | 1914 | 1889 | return  $old\_price; |
  | 1915 | 1890 | } else { |
  | 1916 |  | return (~~($total\_old\_price + $total\_adjustment\_price) / $unit~~); |
  |  | 1891 | return ( ( $total\_old\_price + $total\_adjustment\_price ) / $unit ); |
  | 1917 | 1892 | } |
  | 1918 | 1893 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1977) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L1952) |  |
  | 1977 | 1952 |  |
  | 1978 | 1953 |  |
  | 1979 |  | if ((~~$pid == $product\_tosetfree~~)) { |
  |  | 1954 | if (( $pid == $product\_tosetfree )) { |
  | 1980 | 1955 |  |
  | 1981 | 1956 | $unit      = isset($xa\_cart\_quantities[$product\_tosetfree]) ? $xa\_cart\_quantities[$product\_tosetfree] : 1; |
  | 1982 | 1957 | $free\_unit = $cheapest\_product\_quantity > $unit ? $unit : $cheapest\_product\_quantity; |
  | 1983 | 1958 |  |
  | 1984 |  | if~~(array\_key\_exists($pid, $rule['purchased\_product\_id']))~~{ |
  | 1985 |  | if~~($cheapest\_product\_quantity >= $unit)~~{ |
  | 1986 |  | $free\_unit = $unit - (int)$rule['purchased\_product\_id'][$pid]; |
  | 1987 |  | }~~else~~{ |
  |  | 1959 | if (array\_key\_exists($pid, $rule['purchased\_product\_id'])) { |
  |  | 1960 | if ($cheapest\_product\_quantity >= $unit) { |
  |  | 1961 | $free\_unit = $unit - (int) $rule['purchased\_product\_id'][$pid]; |
  |  | 1962 | } else { |
  | 1988 | 1963 | $free\_unit = $cheapest\_product\_quantity ; |
  | 1989 | 1964 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1994) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L1969) |  |
  | 1994 | 1969 | } |
  | 1995 | 1970 |  |
  | 1996 |  | if ($all\_free\_product\_present == true && (~~is\_cart() || is\_ajax() || is\_checkout()~~)) { |
  |  | 1971 | if ($all\_free\_product\_present == true && ( is\_cart() || is\_ajax() || is\_checkout() )) { |
  | 1997 | 1972 | $total\_adjustment\_price = 0; |
  | 1998 | 1973 | if (isset($adjustment) && is\_numeric($adjustment)) { |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L2005) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L1980) |  |
  | 2005 | 1980 | $total\_adjustment\_price = 0; |
  | 2006 | 1981 | } |
  | 2007 |  | if ((~~$unit - (float) $free\_unit \* $multiple~~) < 0) { //to make repeat rule work with auto add disabled |
  |  | 1982 | if (( $unit - (float) $free\_unit \* $multiple ) < 0) { //to make repeat rule work with auto add disabled |
  | 2008 | 1983 | $total\_old\_price = 0; |
  | 2009 | 1984 | } else { |
  | 2010 |  | $total\_old\_price = $old\_price \* (~~$unit - (float) $free\_unit \* $multiple~~); |
  | 2011 |  | } |
  | 2012 |  | return (~~($total\_old\_price + $total\_adjustment\_price) / $unit~~); |
  |  | 1985 | $total\_old\_price = $old\_price \* ( $unit - (float) $free\_unit \* $multiple ); |
  |  | 1986 | } |
  |  | 1987 | return ( ( $total\_old\_price + $total\_adjustment\_price ) / $unit ); |
  | 2013 | 1988 | } |
  | 2014 | 1989 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L2029) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L2004) |  |
  | 2029 | 2004 | return $old\_price; |
  | 2030 | 2005 | } |
  | 2031 |  | public function elex\_dp\_ExecuteBOGO\_category\_Rule($old\_price, $rule\_no, $rule, $pid = 0, $current\_quantity = 1) |
  | 2032 |  | { |
  |  | 2006 | public function elex\_dp\_ExecuteBOGO\_category\_Rule( $old\_price, $rule\_no, $rule, $pid = 0, $current\_quantity = 1) { |
  | 2033 | 2007 | global $xa\_dp\_setting; |
  | 2034 | 2008 | global $woocommerce; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L2047) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L2021) |  |
  | 2047 | 2021 |  |
  | 2048 | 2022 | //If free product is set |
  | 2049 |  | if (!isset($rule['set\_free\_option']) || (~~isset($rule['set\_free\_option']) && $rule['set\_free\_option'] == 'select\_product'~~)) { |
  |  | 2023 | if (!isset($rule['set\_free\_option']) || ( isset($rule['set\_free\_option']) && $rule['set\_free\_option'] == 'select\_product' )) { |
  | 2050 | 2024 |  |
  | 2051 | 2025 | ////////if free product is already in cart with exact quanitty this code will set its price as zero |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L2066) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L2040) |  |
  | 2066 | 2040 | foreach ($rule['purchased\_category\_id'] as $\_cid => $\_qnty\_and\_checkon) { |
  | 2067 | 2041 |  |
  | 2068 |  | if ((~~array\_key\_exists($pid, $rule['free\_product\_id'])) && in\_array($\_cid, $product\_categories) && !($xa\_cart\_categories\_items[$\_cid] > 1~~)) { |
  |  | 2042 | if (( array\_key\_exists($pid, $rule['free\_product\_id']) ) && in\_array($\_cid, $product\_categories) && !( $xa\_cart\_categories\_items[$\_cid] > 1 )) { |
  | 2069 | 2043 | $add\_if\_not\_auto = $add\_if\_not\_auto + 1; |
  | 2070 | 2044 | } |
  | 2071 | 2045 | } |
  | 2072 |  | if~~($add\_if\_not\_auto > 0)~~{ |
  | 2073 |  | if~~($free\_unit >= $unit)~~{ |
  |  | 2046 | if ($add\_if\_not\_auto > 0) { |
  |  | 2047 | if ($free\_unit >= $unit) { |
  | 2074 | 2048 | $free\_unit = $unit - 1; |
  | 2075 | 2049 | } |
  | 2076 | 2050 | } |
  | 2077 | 2051 |  |
  | 2078 |  | if ($all\_free\_product\_present == true && (~~is\_cart() || is\_checkout()~~)) { |
  |  | 2052 | if ($all\_free\_product\_present == true && ( is\_cart() || is\_checkout() )) { |
  | 2079 | 2053 | $total\_adjustment\_price = 0; |
  | 2080 | 2054 | if (isset($adjustment) && is\_numeric($adjustment)) { |
  | 2081 | 2055 | $total\_adjustment\_price = $adjustment \* $free\_unit; |
  | 2082 | 2056 | } |
  | 2083 |  | $total\_old\_price = $old\_price \* (~~$unit - (float) $free\_unit~~); |
  |  | 2057 | $total\_old\_price = $old\_price \* ( $unit - (float) $free\_unit ); |
  | 2084 | 2058 | if ($xa\_dp\_setting['auto\_add\_free\_product\_on\_off'] == 'on') { |
  | 2085 | 2059 | return  $old\_price; |
  | 2086 | 2060 | } else { |
  | 2087 |  | return (~~($total\_old\_price + $total\_adjustment\_price)~~) / $unit; |
  |  | 2061 | return ( ( $total\_old\_price + $total\_adjustment\_price ) ) / $unit; |
  | 2088 | 2062 | } |
  | 2089 | 2063 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L2141) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L2115) |  |
  | 2141 | 2115 |  |
  | 2142 | 2116 | ////////if free product is already in cart with exact quanitty this code will set its price as zero |
  | 2143 |  | if ((~~$pid == $product\_tosetfree~~)) { |
  |  | 2117 | if (( $pid == $product\_tosetfree )) { |
  | 2144 | 2118 |  |
  | 2145 | 2119 | $product\_categories = !empty($xa\_cart\_categories[$pid]) ? $xa\_cart\_categories[$pid] : array(); |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L2148) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L2122) |  |
  | 2148 | 2122 | foreach ($rule['purchased\_category\_id'] as $\_cid => $\_qnty\_and\_checkon) { |
  | 2149 | 2123 |  |
  | 2150 |  | if ((~~$pid == $product\_tosetfree) && in\_array($\_cid, $product\_categories) && !($xa\_cart\_categories\_items[$\_cid] > 1~~)) { |
  |  | 2124 | if (( $pid == $product\_tosetfree ) && in\_array($\_cid, $product\_categories) && !( $xa\_cart\_categories\_items[$\_cid] > 1 )) { |
  | 2151 | 2125 | $add\_if\_not\_auto = $add\_if\_not\_auto + 1; |
  | 2152 | 2126 | } |
  | 2153 | 2127 | } |
  | 2154 |  | if~~($add\_if\_not\_auto > 0)~~{ |
  | 2155 |  | if~~($cheapest\_product\_quantity >= $unit)~~{ |
  |  | 2128 | if ($add\_if\_not\_auto > 0) { |
  |  | 2129 | if ($cheapest\_product\_quantity >= $unit) { |
  | 2156 | 2130 | $free\_unit = $unit - 1; |
  | 2157 |  | }~~else~~{ |
  |  | 2131 | } else { |
  | 2158 | 2132 | $free\_unit = $cheapest\_product\_quantity ; |
  | 2159 | 2133 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L2164) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L2138) |  |
  | 2164 | 2138 | } |
  | 2165 | 2139 |  |
  | 2166 |  | if ($all\_free\_product\_present == true && (~~is\_cart() || is\_checkout()~~)) { |
  |  | 2140 | if ($all\_free\_product\_present == true && ( is\_cart() || is\_checkout() )) { |
  | 2167 | 2141 |  |
  | 2168 | 2142 | $total\_adjustment\_price = 0; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L2171) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L2145) |  |
  | 2171 | 2145 | } |
  | 2172 | 2146 |  |
  | 2173 |  | $total\_old\_price = $old\_price \* (~~$unit - (float) $free\_unit~~); |
  | 2174 |  |  |
  | 2175 |  | return (~~($total\_old\_price + $total\_adjustment\_price)~~) / $unit; |
  |  | 2147 | $total\_old\_price = $old\_price \* ( $unit - (float) $free\_unit ); |
  |  | 2148 |  |
  |  | 2149 | return ( ( $total\_old\_price + $total\_adjustment\_price ) ) / $unit; |
  | 2176 | 2150 | } |
  | 2177 | 2151 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L2185) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L2159) |  |
  | 2185 | 2159 | } |
  | 2186 | 2160 |  |
  | 2187 |  | public function elex\_dp\_Executebogo\_tag\_rules($old\_price, $rule\_no, $rule, $pid = 0, $current\_quantity = 1) |
  | 2188 |  | { |
  |  | 2161 | public function elex\_dp\_Executebogo\_tag\_rules( $old\_price, $rule\_no, $rule, $pid = 0, $current\_quantity = 1) { |
  | 2189 | 2162 | global $xa\_dp\_setting; |
  | 2190 | 2163 | global $woocommerce; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L2217) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L2190) |  |
  | 2217 | 2190 | } |
  | 2218 | 2191 | if ($count != 0) { |
  | 2219 |  | $tmp = (int) (~~$count / $\_qnty~~); |
  |  | 2192 | $tmp = (int) ( $count / $\_qnty ); |
  | 2220 | 2193 | if ($tmp > 1 && $tmp < $multiple) { |
  | 2221 | 2194 | $multiple = $tmp; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L2231) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L2204) |  |
  | 2231 | 2204 |  |
  | 2232 | 2205 | if ($total\_items\_with\_tag != 0) { |
  | 2233 |  | $tmp = (int) (~~$total\_items\_with\_tag / $\_qnty~~); |
  |  | 2206 | $tmp = (int) ( $total\_items\_with\_tag / $\_qnty ); |
  | 2234 | 2207 | if ($tmp > 1 && $tmp < $multiple) { |
  | 2235 | 2208 | $multiple = $tmp; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L2244) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L2217) |  |
  | 2244 | 2217 |  |
  | 2245 | 2218 | //If free product is set |
  | 2246 |  | if (!isset($rule['set\_free\_option']) || (~~isset($rule['set\_free\_option']) && $rule['set\_free\_option'] == 'select\_product'~~)) { |
  |  | 2219 | if (!isset($rule['set\_free\_option']) || ( isset($rule['set\_free\_option']) && $rule['set\_free\_option'] == 'select\_product' )) { |
  | 2247 | 2220 |  |
  | 2248 | 2221 | ////////if free product is already in cart with exact quanitty this code will set its price as zero |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L2263) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L2236) |  |
  | 2263 | 2236 | foreach ($rule['purchased\_tag\_id'] as $\_cid => $\_qnty\_and\_checkon) { |
  | 2264 | 2237 |  |
  | 2265 |  | if ((~~array\_key\_exists($pid, $rule['free\_product\_id'])) && in\_array($\_cid, $product\_tags) && !($xa\_cart\_tags\_items[$\_cid] > 1~~)) { |
  |  | 2238 | if (( array\_key\_exists($pid, $rule['free\_product\_id']) ) && in\_array($\_cid, $product\_tags) && !( $xa\_cart\_tags\_items[$\_cid] > 1 )) { |
  | 2266 | 2239 | $add\_if\_not\_auto = $add\_if\_not\_auto + 1; |
  | 2267 | 2240 | } |
  | 2268 | 2241 |  |
  | 2269 | 2242 | } |
  | 2270 |  | if~~($add\_if\_not\_auto > 0)~~{ |
  | 2271 |  | if~~($free\_unit >= $unit)~~{ |
  |  | 2243 | if ($add\_if\_not\_auto > 0) { |
  |  | 2244 | if ($free\_unit >= $unit) { |
  | 2272 | 2245 | $free\_unit = $unit - 1; |
  | 2273 | 2246 | } |
  | 2274 | 2247 | } |
  | 2275 | 2248 |  |
  | 2276 |  | if ($all\_free\_product\_present == true && (~~is\_cart() || is\_checkout()~~)) { |
  |  | 2249 | if ($all\_free\_product\_present == true && ( is\_cart() || is\_checkout() )) { |
  | 2277 | 2250 | $total\_adjustment\_price = 0; |
  | 2278 | 2251 | if (isset($adjustment) && is\_numeric($adjustment)) { |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L2285) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L2258) |  |
  | 2285 | 2258 | $total\_adjustment\_price = 0; |
  | 2286 | 2259 | } |
  | 2287 |  | if ((~~$unit - (float) $free\_unit \* $multiple~~) < 0) { //to make repeat rule work with auto add disabled |
  |  | 2260 | if (( $unit - (float) $free\_unit \* $multiple ) < 0) { //to make repeat rule work with auto add disabled |
  | 2288 | 2261 | $total\_old\_price = 0; |
  | 2289 | 2262 | } else { |
  | 2290 |  | $total\_old\_price = $old\_price \* (~~$unit - (float) $free\_unit \* $multiple~~); |
  |  | 2263 | $total\_old\_price = $old\_price \* ( $unit - (float) $free\_unit \* $multiple ); |
  | 2291 | 2264 | } |
  | 2292 | 2265 | if ($xa\_dp\_setting['auto\_add\_free\_product\_on\_off'] == 'on') { |
  | 2293 | 2266 | return  $old\_price; |
  | 2294 | 2267 | } else { |
  | 2295 |  | return (~~($total\_old\_price + $total\_adjustment\_price)~~) / $unit; |
  |  | 2268 | return ( ( $total\_old\_price + $total\_adjustment\_price ) ) / $unit; |
  | 2296 | 2269 | } |
  | 2297 | 2270 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L2349) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L2322) |  |
  | 2349 | 2322 |  |
  | 2350 | 2323 | ////////if free product is already in cart with exact quanitty this code will set its price as zero |
  | 2351 |  | if ((~~$pid == $product\_tosetfree~~)) { |
  |  | 2324 | if (( $pid == $product\_tosetfree )) { |
  | 2352 | 2325 |  |
  | 2353 | 2326 | $product\_tags = !empty($xa\_cart\_tags[$pid]) ? $xa\_cart\_tags[$pid] : array(); |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L2356) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L2329) |  |
  | 2356 | 2329 | foreach ($rule['purchased\_tag\_id'] as $\_cid => $\_qnty\_and\_checkon) { |
  | 2357 | 2330 |  |
  | 2358 |  | if ((~~$pid == $product\_tosetfree) && in\_array($\_cid, $product\_tags) && !($xa\_cart\_tags\_items[$\_cid] > 1~~)) { |
  |  | 2331 | if (( $pid == $product\_tosetfree ) && in\_array($\_cid, $product\_tags) && !( $xa\_cart\_tags\_items[$\_cid] > 1 )) { |
  | 2359 | 2332 | $add\_if\_not\_auto = $add\_if\_not\_auto + 1; |
  | 2360 | 2333 | } |
  | 2361 | 2334 | } |
  | 2362 |  | if~~($add\_if\_not\_auto > 0)~~{ |
  | 2363 |  | if~~($cheapest\_product\_quantity >= $unit)~~{ |
  |  | 2335 | if ($add\_if\_not\_auto > 0) { |
  |  | 2336 | if ($cheapest\_product\_quantity >= $unit) { |
  | 2364 | 2337 | $free\_unit = $unit - 1; |
  | 2365 |  | }~~else~~{ |
  |  | 2338 | } else { |
  | 2366 | 2339 | $free\_unit = $cheapest\_product\_quantity ; |
  | 2367 | 2340 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L2373) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L2346) |  |
  | 2373 | 2346 |  |
  | 2374 | 2347 |  |
  | 2375 |  | if ($all\_free\_product\_present == true && (~~is\_cart() || is\_checkout()~~)) { |
  |  | 2348 | if ($all\_free\_product\_present == true && ( is\_cart() || is\_checkout() )) { |
  | 2376 | 2349 |  |
  | 2377 | 2350 | $total\_adjustment\_price = 0; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L2385) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L2358) |  |
  | 2385 | 2358 | $total\_adjustment\_price = 0; |
  | 2386 | 2359 | } |
  | 2387 |  | if ((~~$unit - (float) $free\_unit \* $multiple~~) < 0) { //to make repeat rule work with auto add disabled |
  |  | 2360 | if (( $unit - (float) $free\_unit \* $multiple ) < 0) { //to make repeat rule work with auto add disabled |
  | 2388 | 2361 | $total\_old\_price = 0; |
  | 2389 | 2362 | } else { |
  | 2390 |  | $total\_old\_price = $old\_price \* (~~$unit - (float) $free\_unit \* $multiple~~); |
  | 2391 |  | } |
  | 2392 |  |  |
  | 2393 |  | return (~~($total\_old\_price + $total\_adjustment\_price)~~) / $unit; |
  |  | 2363 | $total\_old\_price = $old\_price \* ( $unit - (float) $free\_unit \* $multiple ); |
  |  | 2364 | } |
  |  | 2365 |  |
  |  | 2366 | return ( ( $total\_old\_price + $total\_adjustment\_price ) ) / $unit; |
  | 2394 | 2367 | } |
  | 2395 | 2368 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L2403) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-rules-validator.php?rev=3211131#L2376) |  |
  | 2403 | 2376 | } |
  | 2404 | 2377 |  |
  | 2405 |  | public function validate\_product\_matches\_categories($product, $rule) |
  | 2406 |  | { |
  |  | 2378 | public function validate\_product\_matches\_categories( $product, $rule) { |
  | 2407 | 2379 | if ($product->is\_type('variation')) { |
  | 2408 | 2380 | $parent\_id          = elex\_dp\_is\_wc\_version\_gt\_eql('2.7') ? $product->get\_parent\_id() : $product->parent->id; |
* ## [elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-single-product-offer-table.php](/changeset/3211131/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-single-product-offer-table.php "Show the changeset 3211131 restricted to elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-single-product-offer-table.php")

  | [r2965037](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-single-product-offer-table.php?rev=2965037#L14 "Show revision 2965037 of this file in browser") | [r3211131](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-single-product-offer-table.php?rev=3211131#L14 "Show revision 3211131 of this file in browser") |  |
  | --- | --- | --- |
  | 14 | 14 |  |
  | 15 | 15 | if (!empty($offers)) { |
  | 16 |  | ?> |
  |  | 16 | ?> |
  | 17 | 17 |  |
  | 18 | 18 | <style> |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-single-product-offer-table.php?rev=2965037#L33) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-single-product-offer-table.php?rev=3211131#L33) |  |
  | 33 | 33 | <?php |
  | 34 | 34 | foreach ($offers as $type\_rule\_no => $offer) { |
  | 35 |  | ?> |
  |  | 35 | ?> |
  | 36 | 36 | <li class="<?php echo $type\_rule\_no; ?>\_item  xa\_offer\_table\_list\_item "><span class="xa\_offer\_item\_span"><?php echo apply\_filters('wpml\_translate\_single\_string', $offer, 'eh-dynamic-pricing', $type\_rule\_no); ?></span></li> |
  | 37 | 37 | <?php |
* ## [elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-single-product-pricing-table.php](/changeset/3211131/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-single-product-pricing-table.php "Show the changeset 3211131 restricted to elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-single-product-pricing-table.php")

  | [r2965037](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-single-product-pricing-table.php?rev=2965037#L61 "Show revision 2965037 of this file in browser") | [r3211131](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-single-product-pricing-table.php?rev=3211131#L61 "Show revision 3211131 of this file in browser") |  |
  | --- | --- | --- |
  | 61 | 61 | //checking if product rules are enabled on settings page |
  | 62 | 62 | global $xa\_dp\_setting; |
  | 63 |  | if (!empty($xa\_dp\_setting['product\_rules\_on\_off']) && (~~'enable' !== $xa\_dp\_setting['product\_rules\_on\_off']~~)) { |
  |  | 63 | if (!empty($xa\_dp\_setting['product\_rules\_on\_off']) && ( 'enable' !== $xa\_dp\_setting['product\_rules\_on\_off'] )) { |
  | 64 | 64 | $product\_rules = array(); |
  | 65 | 65 | } else { |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-single-product-pricing-table.php?rev=2965037#L98) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/public/elex-single-product-pricing-table.php?rev=3211131#L98) |  |
  | 98 | 98 | echo "<td class='xa\_sp\_table\_cell'> " . esc\_attr($rule['min']) . esc\_html(\_\_($unit, 'eh-dynamic-pricing-discounts')) . ' </td>'; |
  | 99 | 99 | echo "<td class='xa\_sp\_table\_cell'>"; |
  | 100 |  | echo (~~isset($rule['max']) ? esc\_html($rule['max']) : '-'~~); |
  |  | 100 | echo ( isset($rule['max']) ? esc\_html($rule['max']) : '-' ); |
  | 101 | 101 | echo ' ' . esc\_html(\_\_(isset($rule['max']) ? $unit : ' ', 'eh-dynamic-pricing-discounts')) . '</td>'; |
  | 102 | 102 | $currency\_pos = get\_option('woocommerce\_currency\_pos'); |
* ## [elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/readme.txt](/changeset/3211131/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/readme.txt "Show the changeset 3211131 restricted to elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/readme.txt")

  | [r3189520](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/readme.txt?rev=3189520#L5 "Show revision 3189520 of this file in browser") | [r3211131](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/readme.txt?rev=3211131#L5 "Show revision 3211131 of this file in browser") |  |
  | --- | --- | --- |
  | 5 | 5 | Tested up to: 6.7 |
  | 6 | 6 | Requires PHP: 7.4 |
  | 7 |  | Stable tag: 2.1.~~7~~ |
  |  | 7 | Stable tag: 2.1.8 |
  | 8 | 8 | License: GPLv2 or later |
  | 9 | 9 | License URI: http://www.gnu.org/licenses/gpl-2.0.html |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/readme.txt?rev=3189520#L142) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/readme.txt?rev=3211131#L142) |  |
  | 142 | 142 |  |
  | 143 | 143 | == Changelog == |
  |  | 144 | = 2.1.8 = |
  |  | 145 | \* Made compatible with WooCommerce 9.5 |
  |  | 146 | \* Corrected a vulnerability issue using Wordfence |
  |  | 147 | \* Optimized code to improve loading time |
  |  | 148 | \* Fixed an issue where the discount did not update when reducing the quantity |
  |  | 149 |  |
  | 144 | 150 | = 2.1.7 = |
  | 145 | 151 | \* Made compatible with WordPress 6.7 |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/readme.txt?rev=3189520#L291) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.8/readme.txt?rev=3211131#L297) |  |
  | 291 | 297 |  |
  | 292 | 298 | == Upgrade Notice == |
  |  | 299 | = 2.1.8 = |
  |  | 300 | \* Made compatible with WooCommerce 9.5 |
  |  | 301 | \* Corrected a vulnerability issue using Wordfence |
  |  | 302 | \* Optimized code to improve loading time |
  |  | 303 | \* Fixed an issue where the discount did not update when reducing the quantity |
  |  | 304 |  |
  | 293 | 305 | = 2.1.7 = |
  | 294 | 306 | \* Made compatible with WordPress 6.7 |
* ## [elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/data/category\_rules/elex-save-options.php](/changeset/3211131/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/data/category_rules/elex-save-options.php "Show the changeset 3211131 restricted to elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/data/category_rules/elex-save-options.php")

  | [r3049195](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/data/category_rules/elex-save-options.php?rev=3049195#L22 "Show revision 3049195 of this file in browser") | [r3211131](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/data/category_rules/elex-save-options.php?rev=3211131#L22 "Show revision 3211131 of this file in browser") |  |
  | --- | --- | --- |
  | 22 | 22 | $prev\_data = get\_option('xa\_dp\_rules', $dummy\_settings); |
  | 23 | 23 | $new\_rule = array( |
  | 24 |  | 'offer\_name'             => sanitize\_text\_field($\_REQUEST['offer\_name']), |
  | 25 |  | 'category\_id'            => array\_map('sanitize\_text\_field', $\_REQUEST['category\_id']), |
  | 26 |  | 'check\_on'               => sanitize\_text\_field($\_REQUEST['check\_on']), |
  | 27 |  | 'min'                    => sanitize\_text\_field($\_REQUEST['min']), |
  | 28 |  | 'max'                    => !empty($\_REQUEST['max']) ? sanitize\_text\_field($\_REQUEST['max']) : null, |
  | 29 |  | 'discount\_type'          => sanitize\_text\_field($\_REQUEST['discount\_type']), |
  | 30 |  | 'value'                  => sanitize\_text\_field($\_REQUEST['value']), |
  |  | 24 | 'offer\_name'             => sanitize\_text\_field($\_REQUEST['offer\_name']), |
  |  | 25 | 'category\_id'            => array\_map('sanitize\_text\_field', $\_REQUEST['category\_id']), |
  |  | 26 | 'check\_on'               => sanitize\_text\_field($\_REQUEST['check\_on']), |
  |  | 27 | 'min'                    => sanitize\_text\_field($\_REQUEST['min']), |
  |  | 28 | 'max'                    => !empty($\_REQUEST['max']) ? sanitize\_text\_field($\_REQUEST['max']) : null, |
  |  | 29 | 'discount\_type'          => sanitize\_text\_field($\_REQUEST['discount\_type']), |
  |  | 30 | 'value'                  => sanitize\_text\_field($\_REQUEST['value']), |
  | 31 | 31 | 'max\_discount' => null, |
  | 32 | 32 | 'allow\_roles' => array(), |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/data/category_rules/elex-save-options.php?rev=3049195#L38) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/data/category_rules/elex-save-options.php?rev=3211131#L38) |  |
  | 38 | 38 | 'prev\_order\_count' => null, |
  | 39 | 39 | 'prev\_order\_total\_amt' => null, |
  | 40 |  | ); |
  |  | 40 | ); |
  | 41 | 41 |  |
  | 42 | 42 | if (!isset($prev\_data[$active\_tab]) || count($prev\_data[$active\_tab]) == 0) { |
  | 43 |  | $prev\_data[$active\_tab][1] = $new\_rule; |
  | 44 |  | } else { |
  | 45 |  | $prev\_data[$active\_tab][] = $new\_rule; |
  | 46 |  | } |
  |  | 43 | $prev\_data[$active\_tab][1] = $new\_rule; |
  |  | 44 | } else { |
  |  | 45 | $prev\_data[$active\_tab][] = $new\_rule; |
  |  | 46 | } |
  | 47 | 47 |  |
  | 48 | 48 | do\_action( 'wpml\_register\_single\_string', 'eh-dynamic-pricing', $active\_tab . ':' . count($prev\_data[$active\_tab]), sanitize\_text\_field($\_REQUEST['offer\_name'])); |
* ## [elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/data/category\_rules/elex-update-options.php](/changeset/3211131/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/data/category_rules/elex-update-options.php "Show the changeset 3211131 restricted to elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/data/category_rules/elex-update-options.php")

  | [r3049195](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/data/category_rules/elex-update-options.php?rev=3049195#L13 "Show revision 3049195 of this file in browser") | [r3211131](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/data/category_rules/elex-update-options.php?rev=3211131#L13 "Show revision 3211131 of this file in browser") |  |
  | --- | --- | --- |
  | 13 | 13 | $prev\_data = get\_option('xa\_dp\_rules'); |
  | 14 | 14 | $new\_rule = array( |
  | 15 |  | 'offer\_name'             => sanitize\_text\_field($\_REQUEST['offer\_name']), |
  | 16 |  | 'category\_id'            => array\_map('sanitize\_text\_field', $\_REQUEST['category\_id']), |
  | 17 |  | 'check\_on'               => sanitize\_text\_field($\_REQUEST['check\_on']), |
  | 18 |  | 'min'                    => sanitize\_text\_field($\_REQUEST['min']), |
  | 19 |  | 'max'                    => !empty($\_REQUEST['max']) ? sanitize\_text\_field($\_REQUEST['max']) : null, |
  | 20 |  | 'discount\_type'          => sanitize\_text\_field($\_REQUEST['discount\_type']), |
  | 21 |  | 'value'                  => sanitize\_text\_field($\_REQUEST['value']), |
  |  | 15 | 'offer\_name'             => sanitize\_text\_field($\_REQUEST['offer\_name']), |
  |  | 16 | 'category\_id'            => array\_map('sanitize\_text\_field', $\_REQUEST['category\_id']), |
  |  | 17 | 'check\_on'               => sanitize\_text\_field($\_REQUEST['check\_on']), |
  |  | 18 | 'min'                    => sanitize\_text\_field($\_REQUEST['min']), |
  |  | 19 | 'max'                    => !empty($\_REQUEST['max']) ? sanitize\_text\_field($\_REQUEST['max']) : null, |
  |  | 20 | 'discount\_type'          => sanitize\_text\_field($\_REQUEST['discount\_type']), |
  |  | 21 | 'value'                  => sanitize\_text\_field($\_REQUEST['value']), |
  | 22 | 22 | 'max\_discount' => null, |
  | 23 | 23 | 'allow\_roles' => array(), |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/data/category_rules/elex-update-options.php?rev=3049195#L29) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/data/category_rules/elex-update-options.php?rev=3211131#L29) |  |
  | 29 | 29 | 'prev\_order\_count' => null, |
  | 30 | 30 | 'prev\_order\_total\_amt' => null, |
  | 31 |  | ); |
  |  | 31 | ); |
  | 32 | 32 |  |
  | 33 | 33 | $prev\_data[$active\_tab][sanitize\_text\_field($\_REQUEST['update'])] = $new\_rule; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/data/category_rules/elex-update-options.php?rev=3049195#L43) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/data/category_rules/elex-update-options.php?rev=3211131#L43) |  |
  | 43 | 43 | <?php |
  | 44 | 44 | wp\_safe\_redirect(add\_query\_arg(array('page' => 'dp-discount-rules-page', 'tab' => $active\_tab,'updatesuccess' => 1), admin\_url('admin.php'))); |
  | 45 |  | } else { |
  |  | 45 | } else { |
  | 46 | 46 | echo '<div class="notice notice-error is-dismissible">'; |
  | 47 | 47 | echo '<p>' . esc\_html\_e('Please Enter All Fields ,Then Try To Update!!', 'eh-dynamic-pricing-discounts') . '</p> </div>'; |
* ## [elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/data/product\_rules/elex-save-options.php](/changeset/3211131/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/data/product_rules/elex-save-options.php "Show the changeset 3211131 restricted to elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/data/product_rules/elex-save-options.php")

  | [r3049195](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/data/product_rules/elex-save-options.php?rev=3049195#L8 "Show revision 3049195 of this file in browser") | [r3211131](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/data/product_rules/elex-save-options.php?rev=3211131#L8 "Show revision 3211131 of this file in browser") |  |
  | --- | --- | --- |
  | 8 | 8 |  |
  | 9 | 9 |  |
  | 10 |  | if (!empty($\_REQUEST['offer\_name']) && isset($\_REQUEST['rule\_on']) && (~~(isset($\_REQUEST['product\_id'])~~) && ( !empty($\_REQUEST['product\_id']) && ( 'products' == $\_REQUEST['rule\_on'] ) ) || ( isset($\_REQUEST['category\_id']) && !empty($\_REQUEST['category\_id']) && ( 'categories' === $\_REQUEST['rule\_on'] ) ) || ( 'cart' === $\_REQUEST['rule\_on'] ) ) && !empty($\_REQUEST['check\_on']) && !empty($\_REQUEST['min']) && !empty($\_REQUEST['discount\_type']) && ( !empty($\_REQUEST['value']) ) && !isset($\_REQUEST['edit'])) { |
  |  | 10 | if (!empty($\_REQUEST['offer\_name']) && isset($\_REQUEST['rule\_on']) && ( ( isset($\_REQUEST['product\_id']) ) && ( !empty($\_REQUEST['product\_id']) && ( 'products' == $\_REQUEST['rule\_on'] ) ) || ( isset($\_REQUEST['category\_id']) && !empty($\_REQUEST['category\_id']) && ( 'categories' === $\_REQUEST['rule\_on'] ) ) || ( 'cart' === $\_REQUEST['rule\_on'] ) ) && !empty($\_REQUEST['check\_on']) && !empty($\_REQUEST['min']) && !empty($\_REQUEST['discount\_type']) && ( !empty($\_REQUEST['value']) ) && !isset($\_REQUEST['edit'])) { |
  | 11 | 11 | $dummy\_settings = []; |
  | 12 | 12 | $dummy\_settings['product\_rules']       = array(); |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/data/product_rules/elex-save-options.php?rev=3049195#L19) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/data/product_rules/elex-save-options.php?rev=3211131#L19) |  |
  | 19 | 19 |  |
  | 20 | 20 | $products\_ids = null; |
  | 21 |  | $categories   = null; |
  |  | 21 | $categories   = null; |
  | 22 | 22 |  |
  | 23 | 23 | if ($\_REQUEST['rule\_on'] === 'products' && isset($\_REQUEST['product\_id']) && !empty($\_REQUEST['product\_id'])) { |
  | 24 |  | if (elex\_dp\_is\_wc\_version\_gt\_eql('2.7')) { |
  |  | 24 | if (elex\_dp\_is\_wc\_version\_gt\_eql('2.7')) { |
  | 25 | 25 | $products\_ids = array\_map('sanitize\_text\_field', $\_REQUEST['product\_id']);// array |
  | 26 |  | } else { |
  | 27 |  | $products\_ids = explode(',', sanitize\_text\_field($\_REQUEST['product\_id'])); // string |
  | 28 |  | } |
  | 29 |  | } elseif ($\_REQUEST['rule\_on'] === 'categories' && isset($\_REQUEST['category\_id']) && !empty($\_REQUEST['category\_id'])) { |
  | 30 |  | $categories = sanitize\_text\_field($\_REQUEST['category\_id']); // string |
  | 31 |  | } |
  |  | 26 | } else { |
  |  | 27 | $products\_ids = explode(',', sanitize\_text\_field($\_REQUEST['product\_id'])); // string |
  |  | 28 | } |
  |  | 29 | } elseif ($\_REQUEST['rule\_on'] === 'categories' && isset($\_REQUEST['category\_id']) && !empty($\_REQUEST['category\_id'])) { |
  |  | 30 | $categories = sanitize\_text\_field($\_REQUEST['category\_id']); // string |
  |  | 31 | } |
  | 32 | 32 |  |
  | 33 | 33 | $prev\_data = get\_option('xa\_dp\_rules', $dummy\_settings); |
  | 34 | 34 | $new\_rule = array( |
  | 35 |  | 'offer\_name'             => sanitize\_text\_field($\_REQUEST['offer\_name']), |
  | 36 |  | 'rule\_on'                => sanitize\_text\_field($\_REQUEST['rule\_on']), |
  | 37 |  | 'product\_id'             => $products\_ids, |
  | 38 |  | 'category\_id'            => $categories, |
  | 39 |  | 'check\_on'               => sanitize\_text\_field($\_REQUEST['check\_on']), |
  | 40 |  | 'min'                    => sanitize\_text\_field($\_REQUEST['min']), |
  | 41 |  | 'max'                    => !empty($\_REQUEST['max']) ? sanitize\_text\_field($\_REQUEST['max']) : null, |
  | 42 |  | 'discount\_type'          => sanitize\_text\_field($\_REQUEST['discount\_type']), |
  | 43 |  | 'value'                  => sanitize\_text\_field($\_REQUEST['value']), |
  | 44 |  | 'max\_discount'           => null, |
  | 45 |  | ~~'allow\_roles'            => (isset($\_REQUEST['from\_date']) && !empty($\_REQUEST['allow\_roles'])~~) ? array\_map('sanitize\_text\_field', $\_REQUEST['allow\_roles']) : array(), |
  | 46 |  | ~~'allow\_membership\_plans' => (isset($\_REQUEST['from\_date']) && !empty($\_REQUEST['allow\_membership\_plans'])~~) ? array\_map('sanitize\_text\_field', $\_REQUEST['allow\_membership\_plans']) : array(), |
  | 47 |  | ~~'from\_date'              => (isset($\_REQUEST['from\_date']) && !empty($\_REQUEST['from\_date'])~~) ? sanitize\_text\_field($\_REQUEST['from\_date']) : null, |
  | 48 |  | ~~'to\_date'                => (isset($\_REQUEST['from\_date']) &&!empty($\_REQUEST['to\_date'])~~) ? sanitize\_text\_field($\_REQUEST['to\_date']) : null, |
  | 49 |  | 'adjustment'             => null, |
  | 50 |  | 'repeat\_rule'            => '', |
  | 51 |  | 'email\_ids'              => null, |
  | 52 |  | 'prev\_order\_count'       => null, |
  | 53 |  | 'prev\_order\_total\_amt'   => null, |
  | 54 |  | ); |
  |  | 35 | 'offer\_name'             => sanitize\_text\_field($\_REQUEST['offer\_name']), |
  |  | 36 | 'rule\_on'                => sanitize\_text\_field($\_REQUEST['rule\_on']), |
  |  | 37 | 'product\_id'             => $products\_ids, |
  |  | 38 | 'category\_id'            => $categories, |
  |  | 39 | 'check\_on'               => sanitize\_text\_field($\_REQUEST['check\_on']), |
  |  | 40 | 'min'                    => sanitize\_text\_field($\_REQUEST['min']), |
  |  | 41 | 'max'                    => !empty($\_REQUEST['max']) ? sanitize\_text\_field($\_REQUEST['max']) : null, |
  |  | 42 | 'discount\_type'          => sanitize\_text\_field($\_REQUEST['discount\_type']), |
  |  | 43 | 'value'                  => sanitize\_text\_field($\_REQUEST['value']), |
  |  | 44 | 'max\_discount'           => null, |
  |  | 45 | 'allow\_roles'            => ( isset($\_REQUEST['from\_date']) && !empty($\_REQUEST['allow\_roles']) ) ? array\_map('sanitize\_text\_field', $\_REQUEST['allow\_roles']) : array(), |
  |  | 46 | 'allow\_membership\_plans' => ( isset($\_REQUEST['from\_date']) && !empty($\_REQUEST['allow\_membership\_plans']) ) ? array\_map('sanitize\_text\_field', $\_REQUEST['allow\_membership\_plans']) : array(), |
  |  | 47 | 'from\_date'              => ( isset($\_REQUEST['from\_date']) && !empty($\_REQUEST['from\_date']) ) ? sanitize\_text\_field($\_REQUEST['from\_date']) : null, |
  |  | 48 | 'to\_date'                => ( isset($\_REQUEST['from\_date']) &&!empty($\_REQUEST['to\_date']) ) ? sanitize\_text\_field($\_REQUEST['to\_date']) : null, |
  |  | 49 | 'adjustment'             => null, |
  |  | 50 | 'repeat\_rule'            => '', |
  |  | 51 | 'email\_ids'              => null, |
  |  | 52 | 'prev\_order\_count'       => null, |
  |  | 53 | 'prev\_order\_total\_amt'   => null, |
  |  | 54 | ); |
  | 55 | 55 |  |
  | 56 | 56 | if (!isset($prev\_data[$active\_tab]) || count($prev\_data[$active\_tab]) == 0) { |
  | 57 |  | $prev\_data[$active\_tab][1] = $new\_rule; |
  | 58 |  | } else { |
  | 59 |  | $prev\_data[$active\_tab][] = $new\_rule; |
  | 60 |  | } |
  |  | 57 | $prev\_data[$active\_tab][1] = $new\_rule; |
  |  | 58 | } else { |
  |  | 59 | $prev\_data[$active\_tab][] = $new\_rule; |
  |  | 60 | } |
  | 61 | 61 |  |
  | 62 | 62 | do\_action( 'wpml\_register\_single\_string', 'eh-dynamic-pricing', $active\_tab . ':' . count($prev\_data[$active\_tab]), sanitize\_text\_field($\_REQUEST['offer\_name'])); |
* ## [elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/data/product\_rules/elex-update-options.php](/changeset/3211131/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/data/product_rules/elex-update-options.php "Show the changeset 3211131 restricted to elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/data/product_rules/elex-update-options.php")

  | [r3049195](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/data/product_rules/elex-update-options.php?rev=3049195#L10 "Show revision 3049195 of this file in browser") | [r3211131](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/data/product_rules/elex-update-options.php?rev=3211131#L10 "Show revision 3211131 of this file in browser") |  |
  | --- | --- | --- |
  | 10 | 10 |  |
  | 11 | 11 | $products\_ids = null; |
  | 12 |  | $categories   = null; |
  |  | 12 | $categories   = null; |
  | 13 | 13 |  |
  | 14 | 14 | if ($\_REQUEST['rule\_on'] === 'products' && isset($\_REQUEST['product\_id']) && !empty($\_REQUEST['product\_id'])) { |
  | 15 |  | if (elex\_dp\_is\_wc\_version\_gt\_eql('2.7')) { |
  |  | 15 | if (elex\_dp\_is\_wc\_version\_gt\_eql('2.7')) { |
  | 16 | 16 | $products\_ids = array\_map('sanitize\_text\_field', $\_REQUEST['product\_id']);// array |
  | 17 |  | } else { |
  | 18 |  | $products\_ids = explode(',', sanitize\_text\_field($\_REQUEST['product\_id'])); // string |
  | 19 |  | } |
  | 20 |  | } elseif ($\_REQUEST['rule\_on'] === 'categories' && isset($\_REQUEST['category\_id']) && !empty($\_REQUEST['category\_id'])) { |
  | 21 |  | $categories = sanitize\_text\_field($\_REQUEST['category\_id']); // string |
  | 22 |  | } |
  |  | 17 | } else { |
  |  | 18 | $products\_ids = explode(',', sanitize\_text\_field($\_REQUEST['product\_id'])); // string |
  |  | 19 | } |
  |  | 20 | } elseif ($\_REQUEST['rule\_on'] === 'categories' && isset($\_REQUEST['category\_id']) && !empty($\_REQUEST['category\_id'])) { |
  |  | 21 | $categories = sanitize\_text\_field($\_REQUEST['category\_id']); // string |
  |  | 22 | } |
  | 23 | 23 |  |
  | 24 | 24 | $prev\_data = get\_option('xa\_dp\_rules'); |
  | 25 | 25 | $new\_rule = array( |
  | 26 |  | 'offer\_name'             => sanitize\_text\_field($\_REQUEST['offer\_name']), |
  | 27 |  | 'rule\_on'                => sanitize\_text\_field($\_REQUEST['rule\_on']), |
  | 28 |  | 'product\_id'             => $products\_ids, |
  | 29 |  | 'category\_id'            => $categories, |
  | 30 |  | 'check\_on'               => sanitize\_text\_field($\_REQUEST['check\_on']), |
  | 31 |  | 'min'                    => sanitize\_text\_field($\_REQUEST['min']), |
  | 32 |  | 'max'                    => !empty($\_REQUEST['max']) ? sanitize\_text\_field($\_REQUEST['max']) : null, |
  | 33 |  | 'discount\_type'          => sanitize\_text\_field($\_REQUEST['discount\_type']), |
  | 34 |  | 'value'                  => sanitize\_text\_field($\_REQUEST['value']), |
  | 35 |  | 'max\_discount'           => null, |
  | 36 |  | ~~'allow\_roles'            => (isset($\_REQUEST['from\_date']) && !empty($\_REQUEST['allow\_roles'])~~) ? array\_map('sanitize\_text\_field', $\_REQUEST['allow\_roles']) : array(), |
  | 37 |  | ~~'allow\_membership\_plans' => (isset($\_REQUEST['from\_date']) && !empty($\_REQUEST['allow\_membership\_plans'])~~) ? array\_map('sanitize\_text\_field', $\_REQUEST['allow\_membership\_plans']) : array(), |
  | 38 |  | ~~'from\_date'              => (isset($\_REQUEST['from\_date']) && !empty($\_REQUEST['from\_date'])~~) ? sanitize\_text\_field($\_REQUEST['from\_date']) : null, |
  | 39 |  | ~~'to\_date'                => (isset($\_REQUEST['from\_date']) &&!empty($\_REQUEST['to\_date'])~~) ? sanitize\_text\_field($\_REQUEST['to\_date']) : null, |
  | 40 |  | 'adjustment'             => null, |
  | 41 |  | 'repeat\_rule'            => '', |
  | 42 |  | 'email\_ids'              => null, |
  | 43 |  | 'prev\_order\_count'       => null, |
  | 44 |  | 'prev\_order\_total\_amt'   => null, |
  | 45 |  | ); |
  |  | 26 | 'offer\_name'             => sanitize\_text\_field($\_REQUEST['offer\_name']), |
  |  | 27 | 'rule\_on'                => sanitize\_text\_field($\_REQUEST['rule\_on']), |
  |  | 28 | 'product\_id'             => $products\_ids, |
  |  | 29 | 'category\_id'            => $categories, |
  |  | 30 | 'check\_on'               => sanitize\_text\_field($\_REQUEST['check\_on']), |
  |  | 31 | 'min'                    => sanitize\_text\_field($\_REQUEST['min']), |
  |  | 32 | 'max'                    => !empty($\_REQUEST['max']) ? sanitize\_text\_field($\_REQUEST['max']) : null, |
  |  | 33 | 'discount\_type'          => sanitize\_text\_field($\_REQUEST['discount\_type']), |
  |  | 34 | 'value'                  => sanitize\_text\_field($\_REQUEST['value']), |
  |  | 35 | 'max\_discount'           => null, |
  |  | 36 | 'allow\_roles'            => ( isset($\_REQUEST['from\_date']) && !empty($\_REQUEST['allow\_roles']) ) ? array\_map('sanitize\_text\_field', $\_REQUEST['allow\_roles']) : array(), |
  |  | 37 | 'allow\_membership\_plans' => ( isset($\_REQUEST['from\_date']) && !empty($\_REQUEST['allow\_membership\_plans']) ) ? array\_map('sanitize\_text\_field', $\_REQUEST['allow\_membership\_plans']) : array(), |
  |  | 38 | 'from\_date'              => ( isset($\_REQUEST['from\_date']) && !empty($\_REQUEST['from\_date']) ) ? sanitize\_text\_field($\_REQUEST['from\_date']) : null, |
  |  | 39 | 'to\_date'                => ( isset($\_REQUEST['from\_date']) &&!empty($\_REQUEST['to\_date']) ) ? sanitize\_text\_field($\_REQUEST['to\_date']) : null, |
  |  | 40 | 'adjustment'             => null, |
  |  | 41 | 'repeat\_rule'            => '', |
  |  | 42 | 'email\_ids'              => null, |
  |  | 43 | 'prev\_order\_count'       => null, |
  |  | 44 | 'prev\_order\_total\_amt'   => null, |
  |  | 45 | ); |
  | 46 | 46 | $prev\_data[$active\_tab][sanitize\_text\_field($\_REQUEST['update'])] = $new\_rule; |
  | 47 | 47 |  |
* ## [elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/data/settings\_page/elex-save-options.php](/changeset/3211131/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/data/settings_page/elex-save-options.php "Show the changeset 3211131 restricted to elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/data/settings_page/elex-save-options.php")

  | [r3049195](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/data/settings_page/elex-save-options.php?rev=3049195#L17 "Show revision 3049195 of this file in browser") | [r3211131](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/data/settings_page/elex-save-options.php?rev=3211131#L17 "Show revision 3211131 of this file in browser") |  |
  | --- | --- | --- |
  | 17 | 17 | </div> |
  | 18 | 18 | <?php |
  | 19 |  | ~~}else~~{ |
  |  | 19 | } else { |
  | 20 | 20 |  |
  | 21 | 21 | if (isset($\_REQUEST['tab'])) { |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/data/settings_page/elex-save-options.php?rev=3049195#L117) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/data/settings_page/elex-save-options.php?rev=3211131#L117) |  |
  | 117 | 117 | update\_option('xa\_dynamic\_pricing\_setting', $saved\_data); |
  | 118 | 118 | wp\_safe\_redirect(add\_query\_arg(array('page' => 'dp-settings-page', 'tab' => $active\_tab), admin\_url('admin.php'))); |
  | 119 |  | ?> |
  |  | 119 | ?> |
  | 120 | 120 | <div class="notice notice-success is-dismissible"> |
  | 121 | 121 | <p><?php esc\_html\_e('Saved Successfully', 'eh-dynamic-pricing-discounts'); ?></p> |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/data/settings_page/elex-save-options.php?rev=3049195#L129) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/data/settings_page/elex-save-options.php?rev=3211131#L129) |  |
  | 129 | 129 | <?php |
  | 130 | 130 | } |
  | 131 |  | } |
  |  | 131 | } |
  | 132 | 132 | } |
* ## [elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/elex-admin-actions-function.php](/changeset/3211131/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/elex-admin-actions-function.php "Show the changeset 3211131 restricted to elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/elex-admin-actions-function.php")

  | [r3049195](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/elex-admin-actions-function.php?rev=3049195#L120 "Show revision 3049195 of this file in browser") | [r3211131](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/elex-admin-actions-function.php?rev=3211131#L120 "Show revision 3211131 of this file in browser") |  |
  | --- | --- | --- |
  | 120 | 120 | $rules\_type  = !empty($\_POST['rules-type'])?$\_POST['rules-type']:''; |
  | 121 | 121 | if (!wp\_verify\_nonce($nonce, 'update\_rules\_arrangement')) { |
  | 122 |  | wp\_die('unauthorised access [unable to verify nonce]'); |
  | 123 |  | } else { |
  | 124 |  | $allrules = get\_option('xa\_dp\_rules'); |
  |  | 122 | wp\_die('unauthorised access [unable to verify nonce]'); |
  |  | 123 | } else { |
  |  | 124 | $allrules = get\_option('xa\_dp\_rules'); |
  | 125 | 125 | $allRules = !empty($allrules[$rules\_type])?$allrules[$rules\_type]:array(); |
  | 126 | 126 |  |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/elex-admin-actions-function.php?rev=3049195#L137) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/elex-admin-actions-function.php?rev=3211131#L137) |  |
  | 137 | 137 |  |
  | 138 | 138 | //Updating rules order in existing\_perpage\_rules\_order |
  | 139 |  | if~~($reordered\_rules\_on\_given\_page)~~{ |
  | 140 |  | if~~($paged\_rules = $existing\_perpage\_rules\_order[1])~~{ |
  |  | 139 | if ($reordered\_rules\_on\_given\_page) { |
  |  | 140 | if ($paged\_rules = $existing\_perpage\_rules\_order[1]) { |
  | 141 | 141 | $updated\_order\_on\_index = []; |
  | 142 | 142 | $i=0; |
  | 143 |  | ~~foreach($paged\_rules as $key => $rule)~~{ |
  |  | 143 | foreach ($paged\_rules as $key => $rule) { |
  | 144 | 144 | $updated\_order\_on\_index[$key] = $reordered\_rules\_on\_given\_page[$i]; |
  | 145 | 145 | $i++; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/elex-admin-actions-function.php?rev=3049195#L151) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/elex-admin-actions-function.php?rev=3211131#L151) |  |
  | 151 | 151 | //Setting up final data |
  | 152 | 152 | $reordered\_final\_rules\_array = []; |
  | 153 |  | ~~foreach($existing\_perpage\_rules\_order as $rules\_array)~~{ |
  | 154 |  | if~~($rules\_array)~~{ |
  | 155 |  | foreach~~($rules\_array as $key => $rules)~~{ |
  |  | 153 | foreach ($existing\_perpage\_rules\_order as $rules\_array) { |
  |  | 154 | if ($rules\_array) { |
  |  | 155 | foreach ($rules\_array as $key => $rules) { |
  | 156 | 156 | $reordered\_final\_rules\_array[$key] = $rules; |
  | 157 | 157 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/elex-admin-actions-function.php?rev=3049195#L160) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/elex-admin-actions-function.php?rev=3211131#L160) |  |
  | 160 | 160 |  |
  | 161 | 161 | //Saving it to database |
  | 162 |  | if~~(!empty($reordered\_final\_rules\_array))~~{ |
  | 163 |  | $reordered\_final\_rules\_array = array\_reverse($reordered\_final\_rules\_array,true); |
  |  | 162 | if (!empty($reordered\_final\_rules\_array)) { |
  |  | 163 | $reordered\_final\_rules\_array = array\_reverse($reordered\_final\_rules\_array, true); |
  | 164 | 164 | $allrules[$rules\_type] = $reordered\_final\_rules\_array; |
  | 165 | 165 | update\_option('xa\_dp\_rules', $allrules); |
  | 166 | 166 | wp\_die('Arrangements Saved'); |
  | 167 |  | }~~else~~{ |
  |  | 167 | } else { |
  | 168 | 168 | wp\_die('unable to save'); |
  | 169 | 169 | } |
  | 170 |  | } |
  |  | 170 | } |
  | 171 | 171 | } |
  | 172 | 172 |  |
* ## [elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/elex-exporter.php](/changeset/3211131/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/elex-exporter.php "Show the changeset 3211131 restricted to elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/elex-exporter.php")

  | [r3004919](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/elex-exporter.php?rev=3004919#L8 "Show revision 3004919 of this file in browser") | [r3211131](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/elex-exporter.php?rev=3211131#L8 "Show revision 3211131 of this file in browser") |  |
  | --- | --- | --- |
  | 8 | 8 |  |
  | 9 | 9 | function elex\_dp\_export\_rules() { |
  | 10 |  |  |
  |  | 10 | if (!current\_user\_can('manage\_options')) { |
  |  | 11 | return; |
  |  | 12 | } |
  |  | 13 |  |
  |  | 14 | if ( isset($\_POST['eha-export']) && ( !isset($\_POST['eha\_export\_nonce']) || !wp\_verify\_nonce($\_POST['eha\_export\_nonce'], 'eha\_export\_nonce') ) ) { |
  |  | 15 | // Nonce is invalid or not present |
  |  | 16 | wp\_safe\_redirect(admin\_url('admin.php?page=dp-import-export-page&nonce\_verification\_failed')); |
  |  | 17 | return false; |
  |  | 18 |  |
  |  | 19 | } |
  | 11 | 20 | if (isset($\_POST['eha-export'])) { |
  | 12 | 21 | if (isset($\_POST['export\_type']) && ( $\_POST['export\_type'] == 'eha-export-json' )) { |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/elex-exporter.php?rev=3004919#L16) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/elex-exporter.php?rev=3211131#L25) |  |
  | 16 | 25 |  |
  | 17 | 26 | $file\_rule = $tab\_c; |
  | 18 |  | if~~($tab\_c == 'combinational\_rules')~~{ |
  |  | 27 | if ($tab\_c == 'combinational\_rules') { |
  | 19 | 28 | $file\_rule = 'multi\_product\_rules'; |
  | 20 |  | }~~else if($tab\_c == 'cat\_combinational\_rules')~~{ |
  |  | 29 | } else if ($tab\_c == 'cat\_combinational\_rules') { |
  | 21 | 30 | $file\_rule = 'multi\_category\_rules'; |
  | 22 |  | }~~else if($tab\_c == 'buy\_get\_free\_rules')~~{ |
  |  | 31 | } else if ($tab\_c == 'buy\_get\_free\_rules') { |
  | 23 | 32 | $file\_rule = 'bogo\_product\_rules'; |
  | 24 | 33 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/elex-exporter.php?rev=3004919#L46) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/elex-exporter.php?rev=3211131#L55) |  |
  | 46 | 55 |  |
  | 47 | 56 | $file\_rule = $tab\_c; |
  | 48 |  | if~~($tab\_c == 'combinational\_rules')~~{ |
  |  | 57 | if ($tab\_c == 'combinational\_rules') { |
  | 49 | 58 | $file\_rule = 'multi\_product\_rules'; |
  | 50 |  | }~~else if($tab\_c == 'cat\_combinational\_rules')~~{ |
  |  | 59 | } else if ($tab\_c == 'cat\_combinational\_rules') { |
  | 51 | 60 | $file\_rule = 'multi\_category\_rules'; |
  | 52 |  | }~~else if($tab\_c == 'buy\_get\_free\_rules')~~{ |
  |  | 61 | } else if ($tab\_c == 'buy\_get\_free\_rules') { |
  | 53 | 62 | $file\_rule = 'bogo\_product\_rules'; |
  | 54 | 63 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/elex-exporter.php?rev=3004919#L83) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/elex-exporter.php?rev=3211131#L92) |  |
  | 83 | 92 | $line[] ="[$tmp]"; |
  | 84 | 93 | } else { |
  | 85 |  | if~~($v)~~{ |
  |  | 94 | if ($v) { |
  | 86 | 95 | $v      = str\_replace(',', '&comma', $v); |
  | 87 | 96 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/elex-exporter.php?rev=3004919#L100) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/elex-exporter.php?rev=3211131#L109) |  |
  | 100 | 109 | } |
  | 101 | 110 | } |
  | 102 |  | if (isset($\_POST['system-info-export'])) { |
  | 103 |  | $Info = phpinfo(1); |
  | 104 |  | if~~($Info)~~{ |
  |  | 111 | if (isset($\_POST['system-info-export'])) { |
  |  | 112 | $Info = phpinfo(1); |
  |  | 113 | if ($Info) { |
  | 105 | 114 | nocache\_headers(); |
  | 106 | 115 | header('Content-Type: application/html; charset=utf-8'); |
  | 107 | 116 | header('Content-Disposition: attachment; filename= System-info-export-' . date('d-M-Y') . '.html'); |
  | 108 | 117 | header('Expires: 0'); |
  | 109 |  | echo (~~$Info~~); |
  |  | 118 | echo ( $Info ); |
  | 110 | 119 | exit; |
  | 111 | 120 | } else { |
* ## [elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/elex-importer.php](/changeset/3211131/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/elex-importer.php "Show the changeset 3211131 restricted to elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/elex-importer.php")

  | [r2965037](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/elex-importer.php?rev=2965037#L8 "Show revision 2965037 of this file in browser") | [r3211131](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/elex-importer.php?rev=3211131#L8 "Show revision 3211131 of this file in browser") |  |
  | --- | --- | --- |
  | 8 | 8 | function elex\_dp\_import\_rules() { |
  | 9 | 9 | $rules\_array = get\_option('xa\_dp\_rules', array()); |
  |  | 10 | if (!current\_user\_can('manage\_options')) { |
  |  | 11 | return; |
  |  | 12 | } |
  |  | 13 |  |
  |  | 14 | if ( isset($\_POST['import\_tab']) && ( !isset($\_POST['eha\_import\_export\_nonce']) || !wp\_verify\_nonce($\_POST['eha\_import\_export\_nonce'], 'eha\_import\_export\_nonce') ) ) { |
  |  | 15 | // Nonce is invalid or not present |
  |  | 16 | wp\_safe\_redirect(admin\_url('admin.php?page=dp-import-export-page&nonce\_verification\_failed')); |
  |  | 17 | return false; |
  |  | 18 |  |
  |  | 19 | } |
  |  | 20 |  |
  | 10 | 21 | if (isset($\_POST['import\_tab']) && !empty($\_POST['import\_tab']) && !empty($\_FILES['import\_file'])) { |
  | 11 | 22 | $tab       = $\_POST['import\_tab']; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/elex-importer.php?rev=2965037#L91) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/elex-importer.php?rev=3211131#L102) |  |
  | 91 | 102 | } else { |
  | 92 | 103 | $file\_data = $\_FILES; |
  | 93 |  | add\_action('admin\_notices', function() use (~~$file\_data, $tab)~~{ |
  |  | 104 | add\_action('admin\_notices', function() use ( $file\_data, $tab) { |
  | 94 | 105 | ?> |
  | 95 | 106 | <div class="notice notice-error is-dismissible" style=""> |
  | 96 |  | <p><?php \_e( ~~"You can not import " . $file\_data['import\_file']['name'] . " into "~~ . $tab , 'eh-dynamic-pricing-discounts'); ?></p> |
  |  | 107 | <p><?php \_e( 'You can not import ' . $file\_data['import\_file']['name'] . ' into ' . $tab , 'eh-dynamic-pricing-discounts'); ?></p> |
  | 97 | 108 | </div> |
  | 98 | 109 | <?php |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/elex-importer.php?rev=2965037#L110) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/elex-importer.php?rev=3211131#L121) |  |
  | 110 | 121 | $data = (array) json\_decode(file\_get\_contents($import\_file), true); |
  | 111 | 122 | if (!empty($data['type']) && $data['type'] !== $tab) { |
  | 112 |  | add\_action('admin\_notices', function() use (~~$data, $tab)~~{ |
  |  | 123 | add\_action('admin\_notices', function() use ( $data, $tab) { |
  | 113 | 124 | ?> |
  | 114 | 125 | <div class="notice notice-error is-dismissible" style=""> |
  | 115 |  | <p><?php \_e( ~~"You can not import " . $data['type'] . " into "~~ . $tab , 'eh-dynamic-pricing-discounts'); ?></p> |
  |  | 126 | <p><?php \_e( 'You can not import ' . $data['type'] . ' into ' . $tab , 'eh-dynamic-pricing-discounts'); ?></p> |
  | 116 | 127 | </div> |
  | 117 | 128 | <?php |
* ## [elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/display/discount-rules.php](/changeset/3211131/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/display/discount-rules.php "Show the changeset 3211131 restricted to elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/display/discount-rules.php")

  | [r3049195](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/display/discount-rules.php?rev=3049195#L5 "Show revision 3049195 of this file in browser") | [r3211131](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/display/discount-rules.php?rev=3211131#L5 "Show revision 3211131 of this file in browser") |  |
  | --- | --- | --- |
  | 5 | 5 | } |
  | 6 | 6 |  |
  | 7 |  | $active\_tab = (~~isset($\_REQUEST['tab']) && is\_string($\_REQUEST['tab'])~~) ? sanitize\_text\_field($\_REQUEST['tab']) : 'product\_rules'; |
  |  | 7 | $active\_tab = ( isset($\_REQUEST['tab']) && is\_string($\_REQUEST['tab']) ) ? sanitize\_text\_field($\_REQUEST['tab']) : 'product\_rules'; |
  | 8 | 8 |  |
  | 9 | 9 | if (isset($\_REQUEST['cancel\_btn'])) { |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/display/discount-rules.php?rev=3049195#L12) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/display/discount-rules.php?rev=3211131#L12) |  |
  | 12 | 12 | } |
  | 13 | 13 |  |
  |  | 14 | if ( !empty($\_REQUEST['delete']) || ( isset($\_REQUEST['update']) && empty($\_REQUEST['update']) ) || !empty($\_REQUEST['update']) ) { |
  |  | 15 |  |
  |  | 16 | global $wpdb; |
  |  | 17 |  |
  |  | 18 | // Specify the transient key pattern |
  |  | 19 | $transient\_key\_pattern = 'elex\_dp\_product\_data\_%'; |
  |  | 20 |  |
  |  | 21 | $wpdb->query( |
  |  | 22 | $wpdb->prepare( |
  |  | 23 | "DELETE FROM $wpdb->options WHERE option\_name LIKE %s OR option\_name LIKE %s", |
  |  | 24 | '\_transient\_%' . $transient\_key\_pattern, |
  |  | 25 | '\_transient\_timeout\_%' . $transient\_key\_pattern |
  |  | 26 | ) |
  |  | 27 | ); |
  |  | 28 |  |
  |  | 29 | // Clear the object cache |
  |  | 30 | wp\_cache\_flush(); |
  |  | 31 |  |
  |  | 32 | } |
  |  | 33 |  |
  | 14 | 34 | if (!empty($\_REQUEST['delete'])) { |
  | 15 |  | if~~(!isset($\_REQUEST['eh\_rule\_form\_nonce']) || !wp\_verify\_nonce(sanitize\_text\_field($\_REQUEST['eh\_rule\_form\_nonce']), 'eh\_rule\_form\_nonce'))~~{ |
  |  | 35 | if (!isset($\_REQUEST['eh\_rule\_form\_nonce']) || !wp\_verify\_nonce(sanitize\_text\_field($\_REQUEST['eh\_rule\_form\_nonce']), 'eh\_rule\_form\_nonce')) { |
  | 16 | 36 | wp\_safe\_redirect(add\_query\_arg(array('page' => 'dp-discount-rules-page', 'tab' => $active\_tab), admin\_url('admin.php'))); |
  | 17 | 37 | die(); |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/display/discount-rules.php?rev=3049195#L20) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/display/discount-rules.php?rev=3211131#L40) |  |
  | 20 | 40 | $dp\_coupons\_data = get\_option('dp\_coupons\_data', array()); |
  | 21 | 41 | $deleting\_rule\_coupon\_code = isset($prev\_data[$active\_tab][$\_REQUEST['delete']]['coupon\_code']) ? sanitize\_text\_field($prev\_data[$active\_tab][$\_REQUEST['delete']]['coupon\_code']) : ''; |
  | 22 |  | if~~(isset($deleting\_rule\_coupon\_code) && !empty($deleting\_rule\_coupon\_code) && (array\_key\_exists($deleting\_rule\_coupon\_code, $dp\_coupons\_data)))~~{ |
  |  | 42 | if (isset($deleting\_rule\_coupon\_code) && !empty($deleting\_rule\_coupon\_code) && ( array\_key\_exists($deleting\_rule\_coupon\_code, $dp\_coupons\_data) )) { |
  | 23 | 43 | unset($dp\_coupons\_data[$deleting\_rule\_coupon\_code]); |
  | 24 | 44 | $dp\_coupons\_data = array\_values($dp\_coupons\_data); |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/display/discount-rules.php?rev=3049195#L28) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/display/discount-rules.php?rev=3211131#L48) |  |
  | 28 | 48 | $index\_to\_delete = sanitize\_text\_field($\_REQUEST['delete']); |
  | 29 | 49 | unset($activetab\_rules\_data[$index\_to\_delete]); |
  | 30 |  | if~~($activetab\_rules\_data)~~{ |
  |  | 50 | if ($activetab\_rules\_data) { |
  | 31 | 51 | $activetab\_rules\_data = array\_values($activetab\_rules\_data); |
  | 32 | 52 | $activetab\_rules\_data = array\_combine(range(1, count($activetab\_rules\_data)), array\_values($activetab\_rules\_data)); |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/display/discount-rules.php?rev=3049195#L43) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/display/discount-rules.php?rev=3211131#L63) |  |
  | 43 | 63 |  |
  | 44 | 64 | if (isset($\_REQUEST['update']) && empty($\_REQUEST['update'])) {    //Submit And Not Edit Then Saving New Record |
  | 45 |  | if~~(!isset($\_REQUEST['save\_rule\_nonce']) || !wp\_verify\_nonce(sanitize\_text\_field($\_REQUEST['save\_rule\_nonce']), 'save\_rule\_nonce'))~~{ |
  |  | 65 | if (!isset($\_REQUEST['save\_rule\_nonce']) || !wp\_verify\_nonce(sanitize\_text\_field($\_REQUEST['save\_rule\_nonce']), 'save\_rule\_nonce')) { |
  | 46 | 66 | wp\_safe\_redirect(add\_query\_arg(array('page' => 'dp-discount-rules-page', 'tab' => $active\_tab), admin\_url('admin.php'))); |
  | 47 | 67 | die(); |
  | 48 | 68 | } |
  | 49 |  | $current\_tab\_loc = (isset($\_REQUEST['tab']) && is\_string($\_REQUEST['tab'])) ? sanitize\_text\_field($\_REQUEST['tab']) . '/' : 'product\_rules/'; |
  |  | 69 | // Specify the transient key pattern |
  |  | 70 | $transient\_key\_pattern = 'elex\_dp\_product\_data\_'; |
  |  | 71 |  |
  |  | 72 | // Delete transients with similar keys |
  |  | 73 | $wpdb->query( |
  |  | 74 | $wpdb->prepare( |
  |  | 75 | "DELETE FROM $wpdb->options WHERE option\_name LIKE %s OR option\_name LIKE %s", |
  |  | 76 | 'transient' . $transient\_key\_pattern, |
  |  | 77 | 'transient\_timeout' . $transient\_key\_pattern |
  |  | 78 | ) |
  |  | 79 | ); |
  |  | 80 | $current\_tab\_loc = ( isset($\_REQUEST['tab']) && is\_string($\_REQUEST['tab']) ) ? sanitize\_text\_field($\_REQUEST['tab']) . '/' : 'product\_rules/'; |
  | 50 | 81 | $path            = ELEX\_DP\_BASIC\_ROOT\_PATH . 'admin/data/' . $current\_tab\_loc . 'elex-save-options.php'; |
  | 51 | 82 | if (file\_exists($path) == true) { |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/display/discount-rules.php?rev=3049195#L54) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/display/discount-rules.php?rev=3211131#L85) |  |
  | 54 | 85 |  |
  | 55 | 86 | } elseif (isset($\_REQUEST['edit']) && !empty($\_REQUEST['edit'])) {    //Loading Edit Form Or Updating Data |
  | 56 |  | if~~(!isset($\_REQUEST['eh\_rule\_form\_nonce']) || !wp\_verify\_nonce(sanitize\_text\_field($\_REQUEST['eh\_rule\_form\_nonce']), 'eh\_rule\_form\_nonce'))~~{ |
  |  | 87 | if (!isset($\_REQUEST['eh\_rule\_form\_nonce']) || !wp\_verify\_nonce(sanitize\_text\_field($\_REQUEST['eh\_rule\_form\_nonce']), 'eh\_rule\_form\_nonce')) { |
  | 57 | 88 | wp\_safe\_redirect(add\_query\_arg(array('page' => 'dp-discount-rules-page', 'tab' => $active\_tab), admin\_url('admin.php'))); |
  | 58 | 89 | die(); |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/display/discount-rules.php?rev=3049195#L61) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/display/discount-rules.php?rev=3211131#L92) |  |
  | 61 | 92 | $old\_option = $old\_option[$active\_tab]; |
  | 62 | 93 | $\_REQUEST = array\_merge($\_REQUEST, $old\_option[$\_REQUEST['edit']]); |
  | 63 |  | $current\_tab\_loc = (~~isset($\_REQUEST['tab']) && is\_string($\_REQUEST['tab'])~~) ? sanitize\_text\_field($\_REQUEST['tab']) . '/' : 'product\_rules/'; |
  |  | 94 | $current\_tab\_loc = ( isset($\_REQUEST['tab']) && is\_string($\_REQUEST['tab']) ) ? sanitize\_text\_field($\_REQUEST['tab']) . '/' : 'product\_rules/'; |
  | 64 | 95 | $path            = ELEX\_DP\_BASIC\_ROOT\_PATH . 'admin/data/' . $current\_tab\_loc . 'elex-load-edit.php'; |
  | 65 | 96 | include\_once  $path ; |
  | 66 | 97 |  |
  | 67 | 98 | } elseif ( !empty($\_REQUEST['update'])) { |
  | 68 |  | if~~(!isset($\_REQUEST['update\_rule\_' . sanitize\_text\_field($\_REQUEST['update'])]) || !wp\_verify\_nonce(sanitize\_text\_field($\_REQUEST['update\_rule\_' . sanitize\_text\_field($\_REQUEST['update'])]), 'update\_rule\_' . sanitize\_text\_field($\_REQUEST['update'])))~~{ |
  |  | 99 | if (!isset($\_REQUEST['update\_rule\_' . sanitize\_text\_field($\_REQUEST['update'])]) || !wp\_verify\_nonce(sanitize\_text\_field($\_REQUEST['update\_rule\_' . sanitize\_text\_field($\_REQUEST['update'])]), 'update\_rule\_' . sanitize\_text\_field($\_REQUEST['update']))) { |
  | 69 | 100 | wp\_safe\_redirect(add\_query\_arg(array('page' => 'dp-discount-rules-page', 'tab' => $active\_tab), admin\_url('admin.php'))); |
  | 70 | 101 | die(); |
  | 71 | 102 | } |
  | 72 |  | $path = (isset($\_REQUEST['tab']) && is\_string($\_REQUEST['tab'])) ? sanitize\_text\_field($\_REQUEST['tab']) . '/' : 'product\_rules/'; |
  |  | 103 | // Specify the transient key pattern |
  |  | 104 | $transient\_key\_pattern = 'elex\_dp\_product\_data\_'; |
  |  | 105 |  |
  |  | 106 | // Delete transients with similar keys |
  |  | 107 | $wpdb->query( |
  |  | 108 | $wpdb->prepare( |
  |  | 109 | "DELETE FROM $wpdb->options WHERE option\_name LIKE %s OR option\_name LIKE %s", |
  |  | 110 | 'transient' . $transient\_key\_pattern, |
  |  | 111 | 'transient\_timeout' . $transient\_key\_pattern |
  |  | 112 | ) |
  |  | 113 | ); |
  |  | 114 |  |
  |  | 115 | $path = ( isset($\_REQUEST['tab']) && is\_string($\_REQUEST['tab']) ) ? sanitize\_text\_field($\_REQUEST['tab']) . '/' : 'product\_rules/'; |
  | 73 | 116 | $path = ELEX\_DP\_BASIC\_ROOT\_PATH . 'admin/data/' . $path . 'elex-update-options.php'; |
  | 74 | 117 | include\_once  $path ; |
* ## [elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/display/settings.php](/changeset/3211131/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/display/settings.php "Show the changeset 3211131 restricted to elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/display/settings.php")

  | [r3049195](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/display/settings.php?rev=3049195#L6 "Show revision 3049195 of this file in browser") | [r3211131](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/display/settings.php?rev=3211131#L6 "Show revision 3211131 of this file in browser") |  |
  | --- | --- | --- |
  | 6 | 6 |  |
  | 7 | 7 | // Sets active tab |
  | 8 |  | $active\_tab = (~~isset($\_REQUEST['tab']) && is\_string($\_REQUEST['tab'])~~) ? sanitize\_text\_field($\_REQUEST['tab']) : 'rules\_order'; |
  |  | 8 | $active\_tab = ( isset($\_REQUEST['tab']) && is\_string($\_REQUEST['tab']) ) ? sanitize\_text\_field($\_REQUEST['tab']) : 'rules\_order'; |
  | 9 | 9 |  |
  | 10 | 10 | // Data handling of form submit request. |
  | 11 | 11 | if (isset($\_REQUEST['submit'])) { |
  |  | 12 | global $wpdb; |
  |  | 13 | // Specify the transient key pattern |
  |  | 14 | $transient\_key\_pattern = 'elex\_dp\_product\_data\_%'; |
  |  | 15 |  |
  |  | 16 | $wpdb->query( |
  |  | 17 | $wpdb->prepare( |
  |  | 18 | "DELETE FROM $wpdb->options WHERE option\_name LIKE %s OR option\_name LIKE %s", |
  |  | 19 | '\_transient\_%' . $transient\_key\_pattern, |
  |  | 20 | '\_transient\_timeout\_%' . $transient\_key\_pattern |
  |  | 21 | ) |
  |  | 22 | ); |
  |  | 23 |  |
  |  | 24 | // Clear the object cache |
  |  | 25 | wp\_cache\_flush(); |
  | 12 | 26 | $path = ELEX\_DP\_BASIC\_ROOT\_PATH . 'admin/data/settings\_page/elex-save-options.php'; |
  | 13 | 27 | if (file\_exists($path) == true) { |
* ## [elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/renderer/discount-rules.php](/changeset/3211131/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/renderer/discount-rules.php "Show the changeset 3211131 restricted to elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/renderer/discount-rules.php")

  | [r3049195](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/renderer/discount-rules.php?rev=3049195#L56 "Show revision 3049195 of this file in browser") | [r3211131](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/renderer/discount-rules.php?rev=3211131#L56 "Show revision 3211131 of this file in browser") |  |
  | --- | --- | --- |
  | 56 | 56 | $tablink = esc\_url(add\_query\_arg(array('page' => 'dp-discount-rules-page', 'tab' => $tabkey), admin\_url('admin.php'))); |
  | 57 | 57 | switch ($tabkey) { |
  | 58 |  | case 'product\_rules': ?> |
  |  | 58 | case 'product\_rules': |
  |  | 59 | ?> |
  | 59 | 60 | <a href="<?php echo $tablink; ?>" class=" elex-dynamic-pricing-main-link <?php echo $active\_tab === 'product\_rules' ? 'active' : ''; ?>"> |
  | 60 | 61 | <?php esc\_html\_e('Product Rule', 'eh-dynamic-pricing-discounts'); ?> |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/renderer/discount-rules.php?rev=3049195#L63) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/renderer/discount-rules.php?rev=3211131#L64) |  |
  | 63 | 64 | <path id="carrier\_seperator" data-name="carrier seperator" d="M2565.89-576v23.587" transform="translate(-2564.89 577)" fill="none" stroke="#707070" stroke-linecap="round" stroke-width="2" /> |
  | 64 | 65 | </svg> |
  | 65 |  | <?php break; |
  | 66 |  | case 'category\_rules':  ?> |
  |  | 66 | <?php |
  |  | 67 | break; |
  |  | 68 | case 'category\_rules': |
  |  | 69 | ?> |
  | 67 | 70 | <a href="<?php echo $tablink; ?>" class=" elex-dynamic-pricing-main-link <?php echo $active\_tab === 'category\_rules' ? 'active' : ''; ?>"> |
  | 68 | 71 | <?php esc\_html\_e('Category Rules', 'eh-dynamic-pricing-discounts'); ?> |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/renderer/discount-rules.php?rev=3049195#L71) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/renderer/discount-rules.php?rev=3211131#L74) |  |
  | 71 | 74 | <path id="carrier\_seperator" data-name="carrier seperator" d="M2565.89-576v23.587" transform="translate(-2564.89 577)" fill="none" stroke="#707070" stroke-linecap="round" stroke-width="2" /> |
  | 72 | 75 | </svg> |
  | 73 |  | <?php break; |
  |  | 76 | <?php |
  |  | 77 | break; |
  | 74 | 78 | default: |
  | 75 | 79 | break; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/renderer/discount-rules.php?rev=3049195#L82) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/renderer/discount-rules.php?rev=3211131#L86) |  |
  | 82 | 86 |  |
  | 83 | 87 | <div> |
  | 84 |  | <?php if (!in\_array($active\_tab, $execution\_order)) { ?> |
  |  | 88 | <?php if (!in\_array($active\_tab, $execution\_order)) { ?> |
  | 85 | 89 | <!-- when no rule tab is there --> |
  | 86 | 90 | <div class="w-100 text-center"> |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/renderer/discount-rules.php?rev=3049195#L95) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/renderer/discount-rules.php?rev=3211131#L99) |  |
  | 95 | 99 | <img src="<?php echo esc\_url( ELEX\_DP\_CRM\_MAIN\_IMG . 'IsolationMode.svg' ); ?>" alt="" class="w-100" style="max-width: 684px; margin: auto;"> |
  | 96 | 100 | <div class="text-center"> |
  | 97 |  | <button class="btn btn-primary elex-dynamic-pricing-popup-open-btn"><?php esc\_html\_e('Create My First |
  | 98 |  | Rule', 'eh-dynamic-pricing-discounts'); ?></button> |
  |  | 101 | <button class="btn btn-primary elex-dynamic-pricing-popup-open-btn"> |
  |  | 102 | <?php |
  |  | 103 | esc\_html\_e('Create My First |
  |  | 104 | Rule', 'eh-dynamic-pricing-discounts'); |
  |  | 105 | ?> |
  |  | 106 | </button> |
  | 99 | 107 | </div> |
  | 100 | 108 | </div> |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/renderer/discount-rules.php?rev=3049195#L105) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/renderer/discount-rules.php?rev=3211131#L113) |  |
  | 105 | 113 | $settings       = get\_option('xa\_dynamic\_pricing\_setting', array()); |
  | 106 | 114 |  |
  | 107 |  | ?> |
  |  | 115 | ?> |
  | 108 | 116 |  |
  | 109 | 117 | <div class="d-flex justify-content-between align-items-center mb-3"> |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/renderer/discount-rules.php?rev=3049195#L132) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/renderer/discount-rules.php?rev=3211131#L140) |  |
  | 132 | 140 | $member\_plans = wc\_memberships\_get\_membership\_plans(); |
  | 133 | 141 | } |
  | 134 |  | $no\_of\_rules = count($allrules); |
  |  | 142 | $no\_of\_rules = count($allrules); |
  | 135 | 143 | ?> |
  | 136 | 144 | <input type="hidden" id="no\_of\_rules" name="no\_of\_rules" value="<?php echo esc\_attr($no\_of\_rules); ?>"> |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/renderer/discount-rules.php?rev=3049195#L140) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/renderer/discount-rules.php?rev=3211131#L148) |  |
  | 140 | 148 | //Checkon |
  | 141 | 149 | $checkon= ''; |
  | 142 |  | if(isset($value['check\_on']) && !empty($value['check\_on'])) { |
  |  | 150 | if (isset($value['check\_on']) && !empty($value['check\_on'])) { |
  | 143 | 151 | switch ($value['check\_on']) { |
  | 144 | 152 | case 'Quantity': |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/renderer/discount-rules.php?rev=3049195#L161) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/renderer/discount-rules.php?rev=3211131#L169) |  |
  | 161 | 169 | if ($active\_tab === 'product\_rules') { |
  | 162 | 170 | require ELEX\_DP\_BASIC\_ROOT\_PATH . 'admin/ui/view/discount-rules/card/product-rules.php'; |
  | 163 |  | }else if ($active\_tab === 'category\_rules') { |
  |  | 171 | } else if ($active\_tab === 'category\_rules') { |
  | 164 | 172 | require ELEX\_DP\_BASIC\_ROOT\_PATH . 'admin/ui/view/discount-rules/card/category-rules.php'; |
  | 165 | 173 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/renderer/discount-rules.php?rev=3049195#L180) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/renderer/discount-rules.php?rev=3211131#L188) |  |
  | 180 | 188 | <?php |
  | 181 | 189 | if (isset($\_REQUEST['edit'])) { |
  | 182 |  | wp\_nonce\_field('update\_rule\_' . $\_REQUEST['edit'],'update\_rule\_' . $\_REQUEST['edit']); |
  |  | 190 | wp\_nonce\_field('update\_rule\_' . $\_REQUEST['edit'], 'update\_rule\_' . $\_REQUEST['edit']); |
  | 183 | 191 | } else { |
  | 184 |  | wp\_nonce\_field('save\_rule\_nonce','save\_rule\_nonce'); |
  |  | 192 | wp\_nonce\_field('save\_rule\_nonce', 'save\_rule\_nonce'); |
  | 185 | 193 | } |
  | 186 | 194 | ?> |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/renderer/discount-rules.php?rev=3049195#L381) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/renderer/discount-rules.php?rev=3211131#L389) |  |
  | 381 | 389 | if(no\_of\_rules == 1){ |
  | 382 | 390 | // var className = document.getElementById('className').value; |
  | 383 |  | document.getElementsByClassName('elex-ac-edit-rule-up-btn')[0].disabled=true; |
  |  | 391 | document.getElementsByClassName('elex-ac-edit-rule-up-btn')[0].disabled=true; |
  | 384 | 392 | document.getElementsByClassName('elex-ac-edit-rule-down-btn')[0].disabled=true; |
  | 385 | 393 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/renderer/discount-rules.php?rev=3049195#L418) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/renderer/discount-rules.php?rev=3211131#L426) |  |
  | 418 | 426 | return; |
  | 419 | 427 | } |
  | 420 |  | } |
  |  | 428 | } |
  | 421 | 429 |  |
  | 422 | 430 | isFormSubmitting = true; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/renderer/discount-rules.php?rev=3049195#L433) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/renderer/discount-rules.php?rev=3211131#L441) |  |
  | 433 | 441 | document.getElementById("myForm").reset(); |
  | 434 | 442 | }); |
  | 435 |  |  |
  |  | 443 |  |
  | 436 | 444 |  |
  | 437 | 445 | //Js for rule deleting confirmation Alert ==> |
* ## [elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/card/category-rules.php](/changeset/3211131/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/card/category-rules.php "Show the changeset 3211131 restricted to elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/card/category-rules.php")

  | [r3133197](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/card/category-rules.php?rev=3133197#L21 "Show revision 3133197 of this file in browser") | [r3211131](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/card/category-rules.php?rev=3211131#L21 "Show revision 3211131 of this file in browser") |  |
  | --- | --- | --- |
  | 21 | 21 | <div class="flex-fill"> |
  | 22 | 22 | <div class="d-flex justify-content-between mb-3"> |
  | 23 |  | <h6 class="mb-0"><?php esc\_html\_e('Rule #: ', 'eh-dynamic-pricing-discounts'); ?><span class="fw-normal"><?php echo esc\_html($key); ?></span> | <?php esc\_html\_e('Rule Name: ', 'eh-dynamic-pricing-discounts'); ?><span class="fw-normal"><?php echo (~~isset($value['offer\_name']) && !empty($value['offer\_name'])~~) ? esc\_html($value['offer\_name']) : ' - - '; ?></span></h6> |
  | 24 |  | <h6 class="mb-0"><?php esc\_html\_e('Validty: ', 'eh-dynamic-pricing-discounts'); ?><span class="fw-normal"><?php echo (~~isset($value['from\_date']) && !empty($value['from\_date']) && isset($value['to\_date']) && !empty($value['to\_date'])~~) ? esc\_html($value['from\_date'] . '/' . esc\_html($value['to\_date'])) : ' --/--'; ?></span> |
  |  | 23 | <h6 class="mb-0"><?php esc\_html\_e('Rule #: ', 'eh-dynamic-pricing-discounts'); ?><span class="fw-normal"><?php echo esc\_html($key); ?></span> | <?php esc\_html\_e('Rule Name: ', 'eh-dynamic-pricing-discounts'); ?><span class="fw-normal"><?php echo ( isset($value['offer\_name']) && !empty($value['offer\_name']) ) ? esc\_html($value['offer\_name']) : ' - - '; ?></span></h6> |
  |  | 24 | <h6 class="mb-0"><?php esc\_html\_e('Validty: ', 'eh-dynamic-pricing-discounts'); ?><span class="fw-normal"><?php echo ( isset($value['from\_date']) && !empty($value['from\_date']) && isset($value['to\_date']) && !empty($value['to\_date']) ) ? esc\_html($value['from\_date'] . '/' . esc\_html($value['to\_date'])) : ' --/--'; ?></span> |
  | 25 | 25 | </h6> |
  | 26 | 26 | </div> |
  | 27 | 27 |  |
  | 28 | 28 | <div class="d-flex justify-content-between "> |
  | 29 |  | <h6 class="mb-0"><?php esc\_html\_e('Discount Type: ', 'eh-dynamic-pricing-discounts'); ?><span class="fw-normal"><?php echo (~~isset($value['discount\_type']) && !empty($value['discount\_type'])~~)? esc\_html($value['discount\_type']) : ' - - '; ?></span> |
  |  | 29 | <h6 class="mb-0"><?php esc\_html\_e('Discount Type: ', 'eh-dynamic-pricing-discounts'); ?><span class="fw-normal"><?php echo ( isset($value['discount\_type']) && !empty($value['discount\_type']) )? esc\_html($value['discount\_type']) : ' - - '; ?></span> |
  | 30 | 30 | </h6> |
  | 31 |  | <h6 class="mb-0"><?php esc\_html\_e('Discount Value: ', 'eh-dynamic-pricing-discounts'); ?><span class="fw-normal"><?php echo (~~isset($value['value']) && !empty($value['value'])~~) ? esc\_html($value['value']) : ' - - '; ?></span> |
  |  | 31 | <h6 class="mb-0"><?php esc\_html\_e('Discount Value: ', 'eh-dynamic-pricing-discounts'); ?><span class="fw-normal"><?php echo ( isset($value['value']) && !empty($value['value']) ) ? esc\_html($value['value']) : ' - - '; ?></span> |
  | 32 | 32 | </h6> |
  | 33 |  | <h6 class="mb-0"><?php esc\_html\_e('Max Discount: ', 'eh-dynamic-pricing-discounts'); ?><span class="fw-normal"><?php echo (~~isset($value['max\_discount']) && !empty($value['max\_discount'])~~) ? esc\_html($value['max\_discount']) : ' - - '; ?></span></h6> |
  |  | 33 | <h6 class="mb-0"><?php esc\_html\_e('Max Discount: ', 'eh-dynamic-pricing-discounts'); ?><span class="fw-normal"><?php echo ( isset($value['max\_discount']) && !empty($value['max\_discount']) ) ? esc\_html($value['max\_discount']) : ' - - '; ?></span></h6> |
  | 34 | 34 | </div> |
  | 35 | 35 | </div> |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/card/category-rules.php?rev=3133197#L69) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/card/category-rules.php?rev=3211131#L69) |  |
  | 69 | 69 | } |
  | 70 | 70 | } |
  | 71 |  | }~~else~~{ |
  |  | 71 | } else { |
  | 72 | 72 | echo '<div class="btn elex-light-blue-bg">' . esc\_html\_\_(' - - ', 'eh-dynamic-pricing-discounts') . '</div>'; |
  | 73 | 73 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/card/category-rules.php?rev=3133197#L102) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/card/category-rules.php?rev=3211131#L102) |  |
  | 102 | 102 | <div class="border-0 border-bottom mb-3"> |
  | 103 | 103 | <div class="d-flex gap-4"> |
  | 104 |  | <h6><?php esc\_html\_e('Check On: ', 'eh-dynamic-pricing-discounts');?><span class="fw-normal"><?php echo esc\_html(isset($checkon) && !empty($checkon) ? $checkon : ' - - '); ?></span></h6> |
  |  | 104 | <h6><?php esc\_html\_e('Check On: ', 'eh-dynamic-pricing-discounts'); ?><span class="fw-normal"><?php echo esc\_html(isset($checkon) && !empty($checkon) ? $checkon : ' - - '); ?></span></h6> |
  | 105 | 105 | <h6><?php esc\_html\_e('Minimum ', 'eh-dynamic-pricing-discounts'); ?><?php echo esc\_html(isset($checkon) && !empty($checkon) ? $checkon : ' - - '); ?>: <span class="fw-normal"><?php echo esc\_html(isset($value['min']) && !empty($value['min']) ? $value['min'] : ' - - '); ?></span></h6> |
  | 106 | 106 | <h6><?php esc\_html\_e('Maximum ', 'eh-dynamic-pricing-discounts'); ?><?php echo esc\_html(isset($checkon) && !empty($checkon) ? $checkon : ' - - '); ?>: <span class="fw-normal"><?php echo esc\_html(isset($value['max']) && !empty($value['max']) ? $value['max'] : ' - - '); ?></span></h6> |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/card/category-rules.php?rev=3133197#L128) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/card/category-rules.php?rev=3211131#L128) |  |
  | 128 | 128 | } |
  | 129 | 129 | } |
  | 130 |  | }~~else~~{ |
  |  | 130 | } else { |
  | 131 | 131 | echo '<div class="btn elex-light-blue-bg">' . esc\_html\_\_(' - - ', 'eh-dynamic-pricing-discounts') . '</div>'; |
  | 132 | 132 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/card/category-rules.php?rev=3133197#L150) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/card/category-rules.php?rev=3211131#L150) |  |
  | 150 | 150 | </div> |
  | 151 | 151 | <div class="d-flex justify-content-between"> |
  | 152 |  | <h6 class="mb-0"><?php esc\_html\_e('Minimum Number of Previous Order: ', 'eh-dynamic-pricing-discounts');?> <?php echo esc\_html(isset($value['prev\_order\_count']) && !empty($value['prev\_order\_count']) ? $value['prev\_order\_count'] : ' - - '); ?></h6> |
  | 153 |  | <h6 class="mb-0"><?php esc\_html\_e('Minimum Total Spending on Previous Order: ', 'eh-dynamic-pricing-discounts');?> <?php echo esc\_html(isset($value['prev\_order\_total\_amt']) && !empty($value['prev\_order\_total\_amt']) ? $value['prev\_order\_total\_amt'] : ' - - '); ?></h6> |
  |  | 152 | <h6 class="mb-0"><?php esc\_html\_e('Minimum Number of Previous Order: ', 'eh-dynamic-pricing-discounts'); ?> <?php echo esc\_html(isset($value['prev\_order\_count']) && !empty($value['prev\_order\_count']) ? $value['prev\_order\_count'] : ' - - '); ?></h6> |
  |  | 153 | <h6 class="mb-0"><?php esc\_html\_e('Minimum Total Spending on Previous Order: ', 'eh-dynamic-pricing-discounts'); ?> <?php echo esc\_html(isset($value['prev\_order\_total\_amt']) && !empty($value['prev\_order\_total\_amt']) ? $value['prev\_order\_total\_amt'] : ' - - '); ?></h6> |
  | 154 | 154 | </div> |
  | 155 | 155 | </div> |
* ## [elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/card/product-rules.php](/changeset/3211131/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/card/product-rules.php "Show the changeset 3211131 restricted to elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/card/product-rules.php")

  | [r3133197](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/card/product-rules.php?rev=3133197#L21 "Show revision 3133197 of this file in browser") | [r3211131](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/card/product-rules.php?rev=3211131#L21 "Show revision 3211131 of this file in browser") |  |
  | --- | --- | --- |
  | 21 | 21 | <div class="flex-fill"> |
  | 22 | 22 | <div class="d-flex justify-content-between mb-3"> |
  | 23 |  | <h6 class="mb-0"><?php esc\_html\_e('Rule #: ', 'eh-dynamic-pricing-discounts'); ?><span class="fw-normal"><?php echo esc\_html($key); ?></span> | <?php esc\_html\_e('Rule Name: ', 'eh-dynamic-pricing-discounts'); ?><span class="fw-normal"><?php echo (~~isset($value['offer\_name']) && !empty($value['offer\_name'])~~) ? esc\_html($value['offer\_name']) : ' - - '; ?></span></h6> |
  | 24 |  | <h6 class="mb-0"><?php esc\_html\_e('Validty: ', 'eh-dynamic-pricing-discounts'); ?><span class="fw-normal"><?php echo (~~isset($value['from\_date']) && !empty($value['from\_date']) && isset($value['to\_date']) && !empty($value['to\_date'])~~) ? esc\_html($value['from\_date'] . '/' . esc\_html($value['to\_date'])) : ' --/--'; ?></span> |
  |  | 23 | <h6 class="mb-0"><?php esc\_html\_e('Rule #: ', 'eh-dynamic-pricing-discounts'); ?><span class="fw-normal"><?php echo esc\_html($key); ?></span> | <?php esc\_html\_e('Rule Name: ', 'eh-dynamic-pricing-discounts'); ?><span class="fw-normal"><?php echo ( isset($value['offer\_name']) && !empty($value['offer\_name']) ) ? esc\_html($value['offer\_name']) : ' - - '; ?></span></h6> |
  |  | 24 | <h6 class="mb-0"><?php esc\_html\_e('Validty: ', 'eh-dynamic-pricing-discounts'); ?><span class="fw-normal"><?php echo ( isset($value['from\_date']) && !empty($value['from\_date']) && isset($value['to\_date']) && !empty($value['to\_date']) ) ? esc\_html($value['from\_date'] . '/' . esc\_html($value['to\_date'])) : ' --/--'; ?></span> |
  | 25 | 25 | </h6> |
  | 26 | 26 | </div> |
  | 27 | 27 |  |
  | 28 | 28 | <div class="d-flex justify-content-between "> |
  | 29 |  | <h6 class="mb-0"><?php esc\_html\_e('Discount Type: ', 'eh-dynamic-pricing-discounts'); ?><span class="fw-normal"><?php echo (~~isset($value['discount\_type']) && !empty($value['discount\_type'])~~)? esc\_html($value['discount\_type']) : ' - - '; ?></span> |
  |  | 29 | <h6 class="mb-0"><?php esc\_html\_e('Discount Type: ', 'eh-dynamic-pricing-discounts'); ?><span class="fw-normal"><?php echo ( isset($value['discount\_type']) && !empty($value['discount\_type']) )? esc\_html($value['discount\_type']) : ' - - '; ?></span> |
  | 30 | 30 | </h6> |
  | 31 |  | <h6 class="mb-0"><?php esc\_html\_e('Discount Value: ', 'eh-dynamic-pricing-discounts'); ?><span class="fw-normal"><?php echo (~~isset($value['value']) && !empty($value['value'])~~) ? esc\_html($value['value']) : ' - - '; ?></span> |
  |  | 31 | <h6 class="mb-0"><?php esc\_html\_e('Discount Value: ', 'eh-dynamic-pricing-discounts'); ?><span class="fw-normal"><?php echo ( isset($value['value']) && !empty($value['value']) ) ? esc\_html($value['value']) : ' - - '; ?></span> |
  | 32 | 32 | </h6> |
  | 33 |  | <h6 class="mb-0"><?php esc\_html\_e('Max Discount: ', 'eh-dynamic-pricing-discounts'); ?><span class="fw-normal"><?php echo (~~isset($value['max\_discount']) && !empty($value['max\_discount'])~~) ? esc\_html($value['max\_discount']) : ' - - '; ?></span></h6> |
  |  | 33 | <h6 class="mb-0"><?php esc\_html\_e('Max Discount: ', 'eh-dynamic-pricing-discounts'); ?><span class="fw-normal"><?php echo ( isset($value['max\_discount']) && !empty($value['max\_discount']) ) ? esc\_html($value['max\_discount']) : ' - - '; ?></span></h6> |
  | 34 | 34 | </div> |
  | 35 | 35 | </div> |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/card/product-rules.php?rev=3133197#L63) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/card/product-rules.php?rev=3211131#L63) |  |
  | 63 | 63 | $product = wc\_get\_product($\_pid); |
  | 64 | 64 | if (!empty($\_pid) && !empty($product)) { |
  | 65 |  | echo '<div class="btn elex-light-blue-bg">' . \_\_($product->get\_formatted\_name(),'eh-dynamic-pricing-discounts') . '</div>'; |
  |  | 65 | echo '<div class="btn elex-light-blue-bg">' . \_\_($product->get\_formatted\_name(), 'eh-dynamic-pricing-discounts') . '</div>'; |
  | 66 | 66 | } |
  | 67 | 67 | } |
  | 68 |  | }~~else~~{ |
  |  | 68 | } else { |
  | 69 | 69 | echo '<div class="btn elex-light-blue-bg">' . esc\_html\_\_(' - - ', 'eh-dynamic-pricing-discounts') . '</div>'; |
  | 70 | 70 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/card/product-rules.php?rev=3133197#L82) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/card/product-rules.php?rev=3211131#L82) |  |
  | 82 | 82 | echo '<div class="btn elex-light-blue-bg">' . esc\_html($category) . '</div>'; |
  | 83 | 83 | } |
  | 84 |  | }~~else~~{ |
  |  | 84 | } else { |
  | 85 | 85 | echo '<div class="btn elex-light-blue-bg">' . esc\_html\_\_(' - - ', 'eh-dynamic-pricing-discounts') . '</div>'; |
  | 86 | 86 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/card/product-rules.php?rev=3133197#L94) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/card/product-rules.php?rev=3211131#L94) |  |
  | 94 | 94 | <?php |
  | 95 | 95 | echo '<div class="btn elex-light-blue-bg">' . esc\_html\_\_('\* All Products in cart \*', 'eh-dynamic-pricing-discounts') . '</div>'; |
  | 96 |  | ?> |
  |  | 96 | ?> |
  | 97 | 97 | </div> |
  | 98 | 98 | </div> |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/card/product-rules.php?rev=3133197#L154) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/card/product-rules.php?rev=3211131#L154) |  |
  | 154 | 154 | } |
  | 155 | 155 | } |
  | 156 |  | }~~else~~{ |
  |  | 156 | } else { |
  | 157 | 157 | echo '<div class="btn elex-light-blue-bg">' . esc\_html\_\_(' - - ', 'eh-dynamic-pricing-discounts') . '</div>'; |
  | 158 | 158 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/card/product-rules.php?rev=3133197#L176) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/card/product-rules.php?rev=3211131#L176) |  |
  | 176 | 176 | </div> |
  | 177 | 177 | <div class="d-flex justify-content-between"> |
  | 178 |  | <h6 class="mb-0"><?php esc\_html\_e('Minimum Number of Previous Order: ', 'eh-dynamic-pricing-discounts');?> <?php echo esc\_html(isset($value['prev\_order\_count']) && !empty($value['prev\_order\_count']) ? $value['prev\_order\_count'] : ' - - '); ?></h6> |
  | 179 |  | <h6 class="mb-0"><?php esc\_html\_e('Minimum Total Spending on Previous Order: ', 'eh-dynamic-pricing-discounts');?> <?php echo esc\_html(isset($value['prev\_order\_total\_amt']) && !empty($value['prev\_order\_total\_amt']) ? $value['prev\_order\_total\_amt'] : ' - - '); ?></h6> |
  |  | 178 | <h6 class="mb-0"><?php esc\_html\_e('Minimum Number of Previous Order: ', 'eh-dynamic-pricing-discounts'); ?> <?php echo esc\_html(isset($value['prev\_order\_count']) && !empty($value['prev\_order\_count']) ? $value['prev\_order\_count'] : ' - - '); ?></h6> |
  |  | 179 | <h6 class="mb-0"><?php esc\_html\_e('Minimum Total Spending on Previous Order: ', 'eh-dynamic-pricing-discounts'); ?> <?php echo esc\_html(isset($value['prev\_order\_total\_amt']) && !empty($value['prev\_order\_total\_amt']) ? $value['prev\_order\_total\_amt'] : ' - - '); ?></h6> |
  | 180 | 180 | </div> |
  | 181 | 181 | </div> |
* ## [elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/popup/category-rules.php](/changeset/3211131/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/popup/category-rules.php "Show the changeset 3211131 restricted to elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/popup/category-rules.php")

  | [r3049195](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/popup/category-rules.php?rev=3049195#L5 "Show revision 3049195 of this file in browser") | [r3211131](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/popup/category-rules.php?rev=3211131#L5 "Show revision 3211131 of this file in browser") |  |
  | --- | --- | --- |
  | 5 | 5 | if (isset($\_REQUEST['edit']) && !empty($\_REQUEST['edit'])) { |
  | 6 | 6 | $edit\_value = sanitize\_text\_field($\_REQUEST['edit']); |
  | 7 |  | echo '<input type="hidden" name="update" value="' . esc\_attr($edit\_value) . '" >'; |
  |  | 7 | echo '<input type="hidden" name="update" value="' . esc\_attr($edit\_value) . '" >'; |
  | 8 | 8 | } |
  | 9 | 9 | ?> |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/popup/category-rules.php?rev=3049195#L101) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/popup/category-rules.php?rev=3211131#L101) |  |
  | 101 | 101 | <span><?php esc\_html\_e('Restrictions', 'eh-dynamic-pricing-discounts'); ?><sup class="elex\_dp\_go\_premium\_color"><?php esc\_html\_e('[Premium]', 'eh-dynamic-pricing-discounts'); ?></sup></span> |
  | 102 | 102 | </div> |
  | 103 |  | </div> |
  |  | 103 | </div> |
  | 104 | 104 |  |
  | 105 | 105 | <!-- tabs content --> |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/popup/category-rules.php?rev=3049195#L161) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/popup/category-rules.php?rev=3211131#L161) |  |
  | 161 | 161 | <div class="col-md-8"> |
  | 162 | 162 | <select name="check\_on" id="check\_on" class="form-select min-width-100"> |
  | 163 |  | <option value="Quantity" <?php selected(!empty($\_REQUEST['check\_on']) && (~~$\_REQUEST['check\_on'] == 'Quantity'~~)); ?>><?php esc\_html\_e('No. of items', 'eh-dynamic-pricing-discounts'); ?></option> |
  | 164 |  | <option value="Weight" <?php selected(!empty($\_REQUEST['check\_on']) && (~~$\_REQUEST['check\_on'] == 'Weight'~~)); ?>><?php esc\_html\_e('Weight', 'eh-dynamic-pricing-discounts'); ?></option> |
  | 165 |  | <option value="Price" <?php selected(!empty($\_REQUEST['check\_on']) && (~~$\_REQUEST['check\_on'] == 'Price'~~)); ?>><?php esc\_html\_e('Price', 'eh-dynamic-pricing-discounts'); ?></option> |
  | 166 |  | <option value="TotalQuantity" <?php selected(!empty($\_REQUEST['check\_on']) && (~~$\_REQUEST['check\_on'] == 'TotalQuantity'~~)); ?>><?php esc\_html\_e('No. of Units', 'eh-dynamic-pricing-discounts'); ?></option> |
  |  | 163 | <option value="Quantity" <?php selected(!empty($\_REQUEST['check\_on']) && ( $\_REQUEST['check\_on'] == 'Quantity' )); ?>><?php esc\_html\_e('No. of items', 'eh-dynamic-pricing-discounts'); ?></option> |
  |  | 164 | <option value="Weight" <?php selected(!empty($\_REQUEST['check\_on']) && ( $\_REQUEST['check\_on'] == 'Weight' )); ?>><?php esc\_html\_e('Weight', 'eh-dynamic-pricing-discounts'); ?></option> |
  |  | 165 | <option value="Price" <?php selected(!empty($\_REQUEST['check\_on']) && ( $\_REQUEST['check\_on'] == 'Price' )); ?>><?php esc\_html\_e('Price', 'eh-dynamic-pricing-discounts'); ?></option> |
  |  | 166 | <option value="TotalQuantity" <?php selected(!empty($\_REQUEST['check\_on']) && ( $\_REQUEST['check\_on'] == 'TotalQuantity' )); ?>><?php esc\_html\_e('No. of Units', 'eh-dynamic-pricing-discounts'); ?></option> |
  | 167 | 167 | </select> |
  | 168 | 168 | </div> |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/popup/category-rules.php?rev=3049195#L211) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/popup/category-rules.php?rev=3211131#L211) |  |
  | 211 | 211 | <select name="discount\_type" id="discount\_type" |
  | 212 | 212 | class="form-select min-width-100 elex-dynamic-pricing-discount-type-select"> |
  | 213 |  | <option value="Percent Discount" <?php selected(!empty($\_REQUEST['discount\_type']) && (~~$\_REQUEST['discount\_type'] == 'Percent Discount'~~)); ?>><?php esc\_html\_e('Percent Discount', 'eh-dynamic-pricing-discounts'); ?></option> |
  | 214 |  | <option value="Flat Discount" <?php selected(!empty($\_REQUEST['discount\_type']) && (~~$\_REQUEST['discount\_type'] == 'Flat Discount'~~)); ?>><?php esc\_html\_e('Flat Discount', 'eh-dynamic-pricing-discounts'); ?></option> |
  | 215 |  | <option value="Fixed Price" <?php selected(!empty($\_REQUEST['discount\_type']) && (~~$\_REQUEST['discount\_type'] == 'Fixed Price'~~)); ?>><?php esc\_html\_e('Fixed Price', 'eh-dynamic-pricing-discounts'); ?></option> |
  |  | 213 | <option value="Percent Discount" <?php selected(!empty($\_REQUEST['discount\_type']) && ( $\_REQUEST['discount\_type'] == 'Percent Discount' )); ?>><?php esc\_html\_e('Percent Discount', 'eh-dynamic-pricing-discounts'); ?></option> |
  |  | 214 | <option value="Flat Discount" <?php selected(!empty($\_REQUEST['discount\_type']) && ( $\_REQUEST['discount\_type'] == 'Flat Discount' )); ?>><?php esc\_html\_e('Flat Discount', 'eh-dynamic-pricing-discounts'); ?></option> |
  |  | 215 | <option value="Fixed Price" <?php selected(!empty($\_REQUEST['discount\_type']) && ( $\_REQUEST['discount\_type'] == 'Fixed Price' )); ?>><?php esc\_html\_e('Fixed Price', 'eh-dynamic-pricing-discounts'); ?></option> |
  | 216 | 216 | <option value="Coupon Discount" disabled><?php esc\_html\_e('Coupon Discount', 'eh-dynamic-pricing-discounts'); ?> |
  | 217 | 217 | <sup class="elex\_dp\_go\_premium\_color"><?php esc\_html\_e('[Premium]', 'eh-dynamic-pricing-discounts'); ?></sup></option> |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/popup/category-rules.php?rev=3049195#L224) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/popup/category-rules.php?rev=3211131#L224) |  |
  | 224 | 224 | <div class="d-flex gap-2 justify-content-between"> |
  | 225 | 225 | <h6 id="discount\_value" class="mb-0 elex-dynamic-input-label"><?php esc\_html\_e('Discount Percent', 'eh-dynamic-pricing-discounts'); ?><span class="text-danger">\*</span> </h6> |
  | 226 |  | <i id="discount\_desc" class="desc-tip fa-regular fa-circle-question" data-tip='<?php echo esc\_attr\_\_('If you select `Percentage Discount`, the given percentage (value) would be discounted on each unit of the product in the cart. |
  |  | 226 | <i id="discount\_desc" class="desc-tip fa-regular fa-circle-question" data-tip=' |
  |  | 227 | <?php |
  |  | 228 | echo esc\_attr\_\_('If you select `Percentage Discount`, the given percentage (value) would be discounted on each unit of the product in the cart. |
  | 227 | 229 | If you select `Flat Discount`, the given amount (value) would be discounted at subtotal level in the cart. |
  | 228 | 230 | If you select `Fixed Price`, the original price of the product is replaced by the given fixed price (value). |
  | 229 |  | If you select `Coupon dicount`, the original price of the cart total is discounted with the selected coupon offer (value).'); ?>'></i> |
  |  | 231 | If you select `Coupon dicount`, the original price of the cart total is discounted with the selected coupon offer (value).'); |
  |  | 232 | ?> |
  |  | 233 | '></i> |
  | 230 | 234 | </div> |
  | 231 | 235 | </div> |
* ## [elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/popup/product-rules.php](/changeset/3211131/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/popup/product-rules.php "Show the changeset 3211131 restricted to elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/popup/product-rules.php")

  | [r3049195](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/popup/product-rules.php?rev=3049195#L238 "Show revision 3049195 of this file in browser") | [r3211131](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/popup/product-rules.php?rev=3211131#L238 "Show revision 3211131 of this file in browser") |  |
  | --- | --- | --- |
  | 238 | 238 | <div class="col-md-8"> |
  | 239 | 239 | <select name="check\_on" id="check\_on" class="form-select min-width-100"> |
  | 240 |  | <option value="Quantity" <?php selected(!empty($\_REQUEST['check\_on']) && (~~$\_REQUEST['check\_on'] == 'Quantity'~~)); ?>><?php esc\_html\_e('No. of items', 'eh-dynamic-pricing-discounts'); ?></option> |
  | 241 |  | <option value="Weight" <?php selected(!empty($\_REQUEST['check\_on']) && (~~$\_REQUEST['check\_on'] == 'Weight'~~)); ?>><?php esc\_html\_e('Weight', 'eh-dynamic-pricing-discounts'); ?></option> |
  | 242 |  | <option value="Price" <?php selected(!empty($\_REQUEST['check\_on']) && (~~$\_REQUEST['check\_on'] == 'Price'~~)); ?>><?php esc\_html\_e('Price', 'eh-dynamic-pricing-discounts'); ?></option> |
  | 243 |  | <option value="Units" <?php selected(!empty($\_REQUEST['check\_on']) && (~~$\_REQUEST['check\_on'] == 'Units'~~)); ?>><?php esc\_html\_e('No. of Units', 'eh-dynamic-pricing-discounts'); ?></option> |
  |  | 240 | <option value="Quantity" <?php selected(!empty($\_REQUEST['check\_on']) && ( $\_REQUEST['check\_on'] == 'Quantity' )); ?>><?php esc\_html\_e('No. of items', 'eh-dynamic-pricing-discounts'); ?></option> |
  |  | 241 | <option value="Weight" <?php selected(!empty($\_REQUEST['check\_on']) && ( $\_REQUEST['check\_on'] == 'Weight' )); ?>><?php esc\_html\_e('Weight', 'eh-dynamic-pricing-discounts'); ?></option> |
  |  | 242 | <option value="Price" <?php selected(!empty($\_REQUEST['check\_on']) && ( $\_REQUEST['check\_on'] == 'Price' )); ?>><?php esc\_html\_e('Price', 'eh-dynamic-pricing-discounts'); ?></option> |
  |  | 243 | <option value="Units" <?php selected(!empty($\_REQUEST['check\_on']) && ( $\_REQUEST['check\_on'] == 'Units' )); ?>><?php esc\_html\_e('No. of Units', 'eh-dynamic-pricing-discounts'); ?></option> |
  | 244 | 244 | </select> |
  | 245 | 245 | </div> |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/popup/product-rules.php?rev=3049195#L288) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/popup/product-rules.php?rev=3211131#L288) |  |
  | 288 | 288 | <select name="discount\_type" id="discount\_type" |
  | 289 | 289 | class="form-select min-width-100 elex-dynamic-pricing-discount-type-select"> |
  | 290 |  | <option value="Percent Discount" <?php selected(!empty($\_REQUEST['discount\_type']) && (~~$\_REQUEST['discount\_type'] == 'Percent Discount'~~)); ?>><?php esc\_html\_e('Percent Discount', 'eh-dynamic-pricing-discounts'); ?></option> |
  | 291 |  | <option value="Flat Discount" <?php selected(!empty($\_REQUEST['discount\_type']) && (~~$\_REQUEST['discount\_type'] == 'Flat Discount'~~)); ?>><?php esc\_html\_e('Flat Discount', 'eh-dynamic-pricing-discounts'); ?></option> |
  | 292 |  | <option value="Fixed Price" <?php selected(!empty($\_REQUEST['discount\_type']) && (~~$\_REQUEST['discount\_type'] == 'Fixed Price'~~)); ?>><?php esc\_html\_e('Fixed Price', 'eh-dynamic-pricing-discounts'); ?></option> |
  |  | 290 | <option value="Percent Discount" <?php selected(!empty($\_REQUEST['discount\_type']) && ( $\_REQUEST['discount\_type'] == 'Percent Discount' )); ?>><?php esc\_html\_e('Percent Discount', 'eh-dynamic-pricing-discounts'); ?></option> |
  |  | 291 | <option value="Flat Discount" <?php selected(!empty($\_REQUEST['discount\_type']) && ( $\_REQUEST['discount\_type'] == 'Flat Discount' )); ?>><?php esc\_html\_e('Flat Discount', 'eh-dynamic-pricing-discounts'); ?></option> |
  |  | 292 | <option value="Fixed Price" <?php selected(!empty($\_REQUEST['discount\_type']) && ( $\_REQUEST['discount\_type'] == 'Fixed Price' )); ?>><?php esc\_html\_e('Fixed Price', 'eh-dynamic-pricing-discounts'); ?></option> |
  | 293 | 293 | <option value="Coupon Discount" disabled><?php esc\_html\_e('Coupon Discount', 'eh-dynamic-pricing-discounts'); ?> |
  | 294 | 294 | <sup class="elex\_dp\_go\_premium\_color"><?php esc\_html\_e('[Premium]', 'eh-dynamic-pricing-discounts'); ?></sup></option> |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/popup/product-rules.php?rev=3049195#L301) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/popup/product-rules.php?rev=3211131#L301) |  |
  | 301 | 301 | <div class="d-flex gap-2 justify-content-between"> |
  | 302 | 302 | <h6 id="discount\_value" class="mb-0 elex-dynamic-input-label"><?php esc\_html\_e('Discount Percent', 'eh-dynamic-pricing-discounts'); ?><span class="text-danger">\*</span> </h6> |
  | 303 |  | <i id="discount\_desc" class="desc-tip fa-regular fa-circle-question" data-tip='<?php echo esc\_attr\_\_('If you select `Percentage Discount`, the given percentage (value) would be discounted on each unit of the product in the cart. |
  |  | 303 | <i id="discount\_desc" class="desc-tip fa-regular fa-circle-question" data-tip=' |
  |  | 304 | <?php |
  |  | 305 | echo esc\_attr\_\_('If you select `Percentage Discount`, the given percentage (value) would be discounted on each unit of the product in the cart. |
  | 304 | 306 | If you select `Flat Discount`, the given amount (value) would be discounted at subtotal level in the cart. |
  | 305 | 307 | If you select `Fixed Price`, the original price of the product is replaced by the given fixed price (value). |
  | 306 |  | If you select `Coupon dicount`, the original price of the cart total is discounted with the selected coupon offer (value).'); ?>'></i> |
  |  | 308 | If you select `Coupon dicount`, the original price of the cart total is discounted with the selected coupon offer (value).'); |
  |  | 309 | ?> |
  |  | 310 | '></i> |
  | 307 | 311 | </div> |
  | 308 | 312 | </div> |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/popup/product-rules.php?rev=3049195#L409) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/discount-rules/popup/product-rules.php?rev=3211131#L413) |  |
  | 409 | 413 | foreach ($roles as $key=>$val) { |
  | 410 | 414 | $is\_selected =in\_array($key, $selected)?' selected ':' '; |
  | 411 |  | echo "<option value='$key' " . esc\_attr($is\_selected). " >$val</option>"; |
  |  | 415 | echo "<option value='$key' " . esc\_attr($is\_selected) . " >$val</option>"; |
  | 412 | 416 | } |
  | 413 | 417 | ?> |
* ## [elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/help-support/faqs.php](/changeset/3211131/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/help-support/faqs.php "Show the changeset 3211131 restricted to elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/help-support/faqs.php")

  | [r3049195](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/help-support/faqs.php?rev=3049195#L5 "Show revision 3049195 of this file in browser") | [r3211131](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/help-support/faqs.php?rev=3211131#L5 "Show revision 3211131 of this file in browser") |  |
  | --- | --- | --- |
  | 5 | 5 |  |
  | 6 | 6 | $faqs = array( |
  | 7 |  | ~~array(~~ |
  | 8 |  | ~~'question' => esc\_html\_\_('Can the BOGO rule apply percentage discounts on the second product?', 'eh-dynamic-pricing-discounts'),~~ |
  | 9 |  | ~~'answer'   => esc\_html\_\_('Currently, the plugin only allows you to keep the second product as a free product. However, our team has explored the feasibility of giving a percentage discount on it, and this feature will be available in the upcoming version.', 'eh-dynamic-pricing-discounts'),~~ |
  | 10 |  | ~~),~~ |
  | 11 |  | ~~array(~~ |
  | 12 |  | ~~'question' => esc\_html\_\_('How can I apply coupon codes for the discount rules?', 'eh-dynamic-pricing-discounts'),~~ |
  | 13 |  | ~~'answer'   => esc\_html\_\_('While creating a rule, you can apply a coupon discount by selecting "Coupon Discount" as the discount type. Then, you can either create a dynamic coupon or associate an existing WooCommerce coupon with the rule from the "Associate Coupon & Roles" section.', 'eh-dynamic-pricing-discounts'),~~ |
  | 14 |  | ~~),~~ |
  | 15 |  | ~~array(~~ |
  | 16 |  | ~~'question' => esc\_html\_\_('Can I offer the cheapest product in the cart as a free product to the customer?', 'eh-dynamic-pricing-discounts'),~~ |
  | 17 |  | ~~'answer'   => esc\_html\_\_('Yes, you can offer the cheapest product in the cart as a free product. To do this, you need to create a BOGO rule and select "The Cheapest product in the Cart" under the free products section.', 'eh-dynamic-pricing-discounts'),~~ |
  | 18 |  | ~~),~~ |
  | 19 | 7 | array( |
  | 20 |  | ~~'question' => esc\_html\_\_('What does the "504 Timeout error" on the shop page mean~~?', 'eh-dynamic-pricing-discounts'), |
  | 21 |  | ~~'answer'   => esc\_html\_\_('When a website has a large number of products and multiple rules created with the plugin, the scanning of all the products during page loading can lead to performance issues and cause a 504 error to occur~~.', 'eh-dynamic-pricing-discounts'), |
  | 22 |  | ), |
  |  | 8 | 'question' => esc\_html\_\_('Can the BOGO rule apply percentage discounts on the second product?', 'eh-dynamic-pricing-discounts'), |
  |  | 9 | 'answer'   => esc\_html\_\_('Currently, the plugin only allows you to keep the second product as a free product. However, our team has explored the feasibility of giving a percentage discount on it, and this feature will be available in the upcoming version.', 'eh-dynamic-pricing-discounts'), |
  |  | 10 | ), |
  | 23 | 11 | array( |
  | 24 |  | ~~'question' => esc\_html\_\_('If the BOGO rule is satisfied, does it automatically add the free product to the cart~~?', 'eh-dynamic-pricing-discounts'), |
  | 25 |  | ~~'answer'   => esc\_html\_\_('Yes, the plugin automatically adds the free product to the cart page if the rule is satisfied~~.', 'eh-dynamic-pricing-discounts'), |
  | 26 |  | ), |
  |  | 12 | 'question' => esc\_html\_\_('How can I apply coupon codes for the discount rules?', 'eh-dynamic-pricing-discounts'), |
  |  | 13 | 'answer'   => esc\_html\_\_('While creating a rule, you can apply a coupon discount by selecting "Coupon Discount" as the discount type. Then, you can either create a dynamic coupon or associate an existing WooCommerce coupon with the rule from the "Associate Coupon & Roles" section.', 'eh-dynamic-pricing-discounts'), |
  |  | 14 | ), |
  | 27 | 15 | array( |
  | 28 |  | ~~'question' => esc\_html\_\_('What is the difference between a product rule and a cart rule~~?', 'eh-dynamic-pricing-discounts'), |
  | 29 |  | ~~'answer'   => esc\_html\_\_('In a product rule, you can select and apply discounts to the specific product(s) in your store. On the other hand, a cart rule allows you to give a discount for the products that are added to the cart~~.', 'eh-dynamic-pricing-discounts'), |
  | 30 |  | ), |
  |  | 16 | 'question' => esc\_html\_\_('Can I offer the cheapest product in the cart as a free product to the customer?', 'eh-dynamic-pricing-discounts'), |
  |  | 17 | 'answer'   => esc\_html\_\_('Yes, you can offer the cheapest product in the cart as a free product. To do this, you need to create a BOGO rule and select "The Cheapest product in the Cart" under the free products section.', 'eh-dynamic-pricing-discounts'), |
  |  | 18 | ), |
  | 31 | 19 | array( |
  | 32 |  | 'question' => esc\_html\_\_('How can I customize the pricing table?', 'eh-dynamic-pricing-discounts'), |
  | 33 |  | 'answer'   => esc\_html\_\_('You can customize the pricing table by configuring it in the "Settings" > "Other Options" > "Pricing Table" section.', 'eh-dynamic-pricing-discounts'), |
  | 34 |  | ), |
  |  | 20 | 'question' => esc\_html\_\_('What does the "504 Timeout error" on the shop page mean?', 'eh-dynamic-pricing-discounts'), |
  |  | 21 | 'answer'   => esc\_html\_\_('When a website has a large number of products and multiple rules created with the plugin, the scanning of all the products during page loading can lead to performance issues and cause a 504 error to occur.', 'eh-dynamic-pricing-discounts'), |
  |  | 22 | ), |
  |  | 23 | array( |
  |  | 24 | 'question' => esc\_html\_\_('If the BOGO rule is satisfied, does it automatically add the free product to the cart?', 'eh-dynamic-pricing-discounts'), |
  |  | 25 | 'answer'   => esc\_html\_\_('Yes, the plugin automatically adds the free product to the cart page if the rule is satisfied.', 'eh-dynamic-pricing-discounts'), |
  |  | 26 | ), |
  |  | 27 | array( |
  |  | 28 | 'question' => esc\_html\_\_('What is the difference between a product rule and a cart rule?', 'eh-dynamic-pricing-discounts'), |
  |  | 29 | 'answer'   => esc\_html\_\_('In a product rule, you can select and apply discounts to the specific product(s) in your store. On the other hand, a cart rule allows you to give a discount for the products that are added to the cart.', 'eh-dynamic-pricing-discounts'), |
  |  | 30 | ), |
  |  | 31 | array( |
  |  | 32 | 'question' => esc\_html\_\_('How can I customize the pricing table?', 'eh-dynamic-pricing-discounts'), |
  |  | 33 | 'answer'   => esc\_html\_\_('You can customize the pricing table by configuring it in the "Settings" > "Other Options" > "Pricing Table" section.', 'eh-dynamic-pricing-discounts'), |
  |  | 34 | ), |
  | 35 | 35 | ); |
  | 36 | 36 | ?> |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/help-support/faqs.php?rev=3049195#L44) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/help-support/faqs.php?rev=3211131#L44) |  |
  | 44 | 44 | data-bs-target="#flush-collapse<?php echo esc\_attr($index + 1); ?>" |
  | 45 | 45 | aria-expanded="false" aria-controls="flush-collapse<?php echo esc\_attr($index + 1); ?>"> |
  | 46 |  | <div><?php echo esc\_html\_\_('Q', 'eh-dynamic-pricing-discounts') . (~~$index + 1~~) . '.'; ?></div> |
  |  | 46 | <div><?php echo esc\_html\_\_('Q', 'eh-dynamic-pricing-discounts') . ( $index + 1 ) . '.'; ?></div> |
  | 47 | 47 | <div><?php echo esc\_html($faq['question']); ?></div> |
  | 48 | 48 | </button> |
* ## [elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/help-support/ticket.php](/changeset/3211131/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/help-support/ticket.php "Show the changeset 3211131 restricted to elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/help-support/ticket.php")

  | [r3049195](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/help-support/ticket.php?rev=3049195#L7 "Show revision 3049195 of this file in browser") | [r3211131](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/help-support/ticket.php?rev=3211131#L7 "Show revision 3211131 of this file in browser") |  |
  | --- | --- | --- |
  | 7 | 7 | <div class="p-1 fw-bold"> |
  | 8 | 8 | <p><?php esc\_html\_e('Before raising the ticket, we recommend you to go through our', 'eh-dynamic-pricing-discounts'); ?> |
  | 9 |  | <a href="<?php echo esc\_url('https://elextensions.com/knowledge-base/set-up-elex-dynamic-pricing-and-discounts-plugin-for-woocommerce/'); ?>" target="\_blank"><?php esc\_html\_e('detailed documentation.', 'eh-dynamic-pricing-discounts'); ?></a></p> |
  |  | 9 | <a href="<?php echo esc\_url('https://elextensions.com/knowledge-base/set-up-elex-dynamic-pricing-and-discounts-plugin-for-woocommerce/'); ?>" target="\_blank"><?php esc\_html\_e('detailed documentation.', 'eh-dynamic-pricing-discounts'); ?></a></p> |
  | 10 | 10 | <p><?php esc\_html\_e('Or', 'eh-dynamic-pricing-discounts'); ?></p> |
  | 11 | 11 | <p class="mb-0"><?php esc\_html\_e('To get in touch with our helpdesk representative. Just raise a support ticket on our website.', 'eh-dynamic-pricing-discounts'); ?></p> |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/help-support/ticket.php?rev=3049195#L38) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/help-support/ticket.php?rev=3211131#L38) |  |
  | 38 | 38 | <script> |
  | 39 | 39 | jQuery(document).ready(function() { |
  | 40 |  |  |
  |  | 40 |  |
  | 41 | 41 | if (hasURLKey('downloadfailure')) { |
  | 42 | 42 | showSuccessNotification('downloadfailure'); |
* ## [elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/market.php](/changeset/3211131/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/market.php "Show the changeset 3211131 restricted to elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/market.php")

  | [r3049195](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/market.php?rev=3049195#L16 "Show revision 3049195 of this file in browser") | [r3211131](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/market.php?rev=3211131#L16 "Show revision 3211131 of this file in browser") |  |
  | --- | --- | --- |
  | 16 | 16 | <div class="row"> |
  | 17 | 17 | <div class=" elex-license-like-img-container col-md-5"> |
  | 18 |  | <?php $dp\_premium\_url = ~~"https://elextensions.com/plugin/dynamic-pricing-and-discounts-plugin-for-woocommerce/?utm\_source=plugin-settings-related&utm\_medium=wp-admin&utm\_campaign=in-prod-ads"~~ ?> |
  |  | 18 | <?php $dp\_premium\_url = 'https://elextensions.com/plugin/dynamic-pricing-and-discounts-plugin-for-woocommerce/?utm\_source=plugin-settings-related&utm\_medium=wp-admin&utm\_campaign=in-prod-ads'; ?> |
  | 19 | 19 | <a target="\_blank" href="<?php echo esc\_url($dp\_premium\_url); ?>"> |
  | 20 | 20 | <img src="<?php echo esc\_url(ELEX\_DP\_CRM\_MAIN\_URL . '/img/dynamic\_pricing.png'); ?>" class="marketing\_logos" alt="<?php esc\_attr\_e('Dynamic Pricing Logo', 'eh-dynamic-pricing-discounts'); ?>"> |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/market.php?rev=3049195#L38) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/market.php?rev=3211131#L38) |  |
  | 38 | 38 | </p> |
  | 39 | 39 | </ul> |
  | 40 |  | <?php $dp\_documentation\_url = ~~"https://elextensions.com/knowledge-base/set-up-elex-dynamic-pricing-and-discounts-plugin-for-woocommerce/"~~ ?> |
  |  | 40 | <?php $dp\_documentation\_url = 'https://elextensions.com/knowledge-base/set-up-elex-dynamic-pricing-and-discounts-plugin-for-woocommerce/'; ?> |
  | 41 | 41 | <center> <a href="<?php echo esc\_url($dp\_documentation\_url); ?>" target="\_blank" class="button button-primary"><?php esc\_html\_e('Documentation', 'eh-dynamic-pricing-discounts'); ?></a></center> |
  | 42 | 42 | </div> |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/market.php?rev=3049195#L48) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/market.php?rev=3211131#L48) |  |
  | 48 | 48 | <h6 class="mb-4"><b><?php esc\_html\_e('You May Also like', 'eh-dynamic-pricing-discounts'); ?></b></h6> |
  | 49 | 49 | <div class="row"> |
  | 50 |  | <?php $plugins = array( |
  |  | 50 | <?php |
  |  | 51 | $plugins = array( |
  | 51 | 52 | array( |
  | 52 | 53 | 'url'   => 'https://elextensions.com/plugin/woocommerce-catalog-mode-wholesale-role-based-pricing/?utm\_source=plugin-settings-related&utm\_medium=wp-admin&utm\_campaign=in-prod-ads', |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/market.php?rev=3049195#L71) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/market.php?rev=3211131#L72) |  |
  | 71 | 72 | ); |
  | 72 | 73 |  |
  | 73 |  | foreach ($plugins as $plugin) : ?> |
  |  | 74 | foreach ($plugins as $plugin) : |
  |  | 75 | ?> |
  | 74 | 76 | <div class="col-md-3 col-6"> |
  | 75 | 77 | <div class="elex-license-like-img-container w-100  mb-3"> |
* ## [elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/settings/rules-execution-order.php](/changeset/3211131/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/settings/rules-execution-order.php "Show the changeset 3211131 restricted to elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/settings/rules-execution-order.php")

  | [r3049195](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/settings/rules-execution-order.php?rev=3049195#L33 "Show revision 3049195 of this file in browser") | [r3211131](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/ui/view/settings/rules-execution-order.php?rev=3211131#L33 "Show revision 3211131 of this file in browser") |  |
  | --- | --- | --- |
  | 33 | 33 | </th> |
  | 34 | 34 | <td class="text-start fw-bold"> |
  | 35 |  | <?php if($key == 'product\_rules' || $key == 'category\_rules'){ |
  |  | 35 | <?php |
  |  | 36 | if ($key == 'product\_rules' || $key == 'category\_rules') { |
  | 36 | 37 | echo esc\_html($rules\_modes[$key]); |
  | 37 |  | }else{ |
  | 38 |  | echo esc\_html($rules\_modes[$key]);?> |
  | 39 |  | <sup class="elex\_dp\_go\_premium\_color"><?php esc\_html\_e('[Premium]', 'eh-dynamic-pricing-discounts'); ?></sup><?php |
  |  | 38 | } else { |
  |  | 39 | echo esc\_html($rules\_modes[$key]); |
  |  | 40 | ?> |
  |  | 41 | <sup class="elex\_dp\_go\_premium\_color"><?php esc\_html\_e('[Premium]', 'eh-dynamic-pricing-discounts'); ?></sup> |
  |  | 42 | <?php |
  | 40 | 43 |  |
  | 41 |  | } |
  |  | 44 | } |
  | 42 | 45 | ?> |
  | 43 | 46 | </td> |
  | 44 | 47 | <td> |
  | 45 | 48 | <label class="elex-switch-btn"> |
  | 46 |  | <?php if~~($key == 'product\_rules' || $key == 'category\_rules')~~{ ?> |
  |  | 49 | <?php if ($key == 'product\_rules' || $key == 'category\_rules') { ?> |
  | 47 | 50 | <input type="checkbox" name='enabled\_modes[<?php echo esc\_attr($key); ?>]' value='<?php echo esc\_attr($key); ?>' <?php echo in\_array($key, $execution\_order) ? 'checked' : ''; ?>> |
  | 48 | 51 | <div class="elex-switch-icon round"></div> |
  | 49 |  | <?php }~~else~~{ ?> |
  |  | 52 | <?php } else { ?> |
  | 50 | 53 | <div class="elex-switch-icon round"></div> |
  | 51 | 54 | <?php |
  | 52 | 55 |  |
  | 53 | 56 | } |
  | 54 |  | ?> |
  |  | 57 | ?> |
  | 55 | 58 | </label> |
  | 56 | 59 | </td> |
* ## [elex-woocommerce-dynamic-pricing-and-discounts/trunk/elex-dynamic-pricing-and-discounts-for-woocommerce-basic-version.php](/changeset/3211131/elex-woocommerce-dynamic-pricing-and-discounts/trunk/elex-dynamic-pricing-and-discounts-for-woocommerce-basic-version.php "Show the changeset 3211131 restricted to elex-woocommerce-dynamic-pricing-and-discounts/trunk/elex-dynamic-pricing-and-discounts-for-woocommerce-basic-version.php")

  | [r3189520](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/elex-dynamic-pricing-and-discounts-for-woocommerce-basic-version.php?rev=3189520#L4 "Show revision 3189520 of this file in browser") | [r3211131](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/elex-dynamic-pricing-and-discounts-for-woocommerce-basic-version.php?rev=3211131#L4 "Show revision 3211131 of this file in browser") |  |
  | --- | --- | --- |
  | 4 | 4 | \*   Plugin URI: https://elextensions.com/plugin/elex-dynamic-pricing-and-discounts-plugin-for-woocommerce-free-version/ |
  | 5 | 5 | \*   Description: This plugin helps you to set discounts and pricing dynamically based on minimum quantity,weight,price and allow you to set maximum allowed discounts on every rule. |
  | 6 |  | \*   Version: 2.1.~~7~~ |
  |  | 6 | \*   Version: 2.1.8 |
  | 7 | 7 | \*   Author: ELEXtensions |
  | 8 | 8 | \*   WC requires at least: 3.0.0 |
  | 9 |  | \*   WC tested up to: 9.~~4~~ |
  |  | 9 | \*   WC tested up to: 9.5 |
  | 10 | 10 | \*   Author URI: https://elextensions.com |
  | 11 | 11 | \*   Copyright: 2018 ELEX. |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/elex-dynamic-pricing-and-discounts-for-woocommerce-basic-version.php?rev=3189520#L182) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/elex-dynamic-pricing-and-discounts-for-woocommerce-basic-version.php?rev=3211131#L182) |  |
  | 182 | 182 |  |
  | 183 | 183 | $rules\_indexing\_status   = get\_option('xa\_dp\_rules\_indexing\_status'); |
  | 184 |  | if~~(!isset($rules\_indexing\_status) || $rules\_indexing\_status == false)~~{ |
  |  | 184 | if (!isset($rules\_indexing\_status) || $rules\_indexing\_status == false) { |
  | 185 | 185 | require\_once plugin\_dir\_path(\_\_FILE\_\_) . 'includes/elex-dynamic-pricing-plugin-activator.php'; |
  | 186 | 186 | Elex\_dynamic\_pricing\_plugin\_Activator::activate(); |
* ## [elex-woocommerce-dynamic-pricing-and-discounts/trunk/includes/elex-common-functions.php](/changeset/3211131/elex-woocommerce-dynamic-pricing-and-discounts/trunk/includes/elex-common-functions.php "Show the changeset 3211131 restricted to elex-woocommerce-dynamic-pricing-and-discounts/trunk/includes/elex-common-functions.php")

  | [r3004919](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/includes/elex-common-functions.php?rev=3004919#L394 "Show revision 3004919 of this file in browser") | [r3211131](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/includes/elex-common-functions.php?rev=3211131#L394 "Show revision 3211131 of this file in browser") |  |
  | --- | --- | --- |
  | 394 | 394 | $parent\_id =$product->get\_parent\_id(); |
  | 395 | 395 | $parent\_tags = get\_the\_terms($parent\_id, 'product\_tag'); |
  | 396 |  | if~~($parent\_tags)~~{ |
  |  | 396 | if ($parent\_tags) { |
  | 397 | 397 | foreach ($parent\_tags as $key => $parent\_tag) { |
  | 398 | 398 | array\_push($tags\_ids\_array, $parent\_tag->term\_id); |
* ## [elex-woocommerce-dynamic-pricing-and-discounts/trunk/includes/elex-dynamic-pricing-plugin-activator.php](/changeset/3211131/elex-woocommerce-dynamic-pricing-and-discounts/trunk/includes/elex-dynamic-pricing-plugin-activator.php "Show the changeset 3211131 restricted to elex-woocommerce-dynamic-pricing-and-discounts/trunk/includes/elex-dynamic-pricing-plugin-activator.php")

  | [r3004919](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/includes/elex-dynamic-pricing-plugin-activator.php?rev=3004919#L35 "Show revision 3004919 of this file in browser") | [r3211131](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/includes/elex-dynamic-pricing-plugin-activator.php?rev=3211131#L35 "Show revision 3211131 of this file in browser") |  |
  | --- | --- | --- |
  | 35 | 35 | $dummy\_option = array('product\_rules' => array(), 'combinational\_rules' => array(), 'cat\_combinational\_rules' => array(), 'category\_rules' => array(), 'cart\_rules' => array(), 'buy\_get\_free\_rules' => array() ,'BOGO\_category\_rules'=>array(), 'bogo\_tag\_rules' =>array(), 'tag\_rules' => array()); |
  | 36 | 36 | $prev\_rules   = get\_option('xa\_dp\_rules', $dummy\_option); |
  | 37 |  | foreach~~($prev\_rules as $rule\_type => $rules)~~{ |
  |  | 37 | foreach ($prev\_rules as $rule\_type => $rules) { |
  | 38 | 38 | $reordered\_rules = []; |
  | 39 | 39 | $i = 1; |
  | 40 |  | if($rules) { |
  | 41 |  | foreach($rules as $rule) { |
  |  | 40 | if ($rules) { |
  |  | 41 | foreach ($rules as $rule) { |
  | 42 | 42 | $reordered\_rules[$i] = $rule; |
  | 43 | 43 | $i++; |
* ## [elex-woocommerce-dynamic-pricing-and-discounts/trunk/includes/wf\_api\_manager/class-wc-am-plugin-activate.php](/changeset/3211131/elex-woocommerce-dynamic-pricing-and-discounts/trunk/includes/wf_api_manager/class-wc-am-plugin-activate.php "Show the changeset 3211131 restricted to elex-woocommerce-dynamic-pricing-and-discounts/trunk/includes/wf_api_manager/class-wc-am-plugin-activate.php")

  | [r2965037](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/includes/wf_api_manager/class-wc-am-plugin-activate.php?rev=2965037#L12 "Show revision 2965037 of this file in browser") | [r3211131](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/includes/wf_api_manager/class-wc-am-plugin-activate.php?rev=3211131#L12 "Show revision 3211131 of this file in browser") |  |
  | --- | --- | --- |
  | 12 | 12 | class WF\_Software\_Activate { |
  | 13 | 13 | private $is\_ajax; |
  | 14 |  | private $upgrade\_url; |
  | 15 |  | private $plugin\_name; |
  | 16 |  | private $product\_id; |
  | 17 |  | private $api\_key; |
  | 18 |  | private $activation\_unique\_product\_id; |
  | 19 |  | private $renew\_license\_url; |
  | 20 |  | private $instance; |
  | 21 |  | private $domain; |
  | 22 |  | private $software\_version; |
  | 23 |  | private $wf\_unique\_product\_id\_key; |
  | 24 |  | private $wf\_api\_licence\_key; |
  | 25 |  | private $wf\_instance\_key; |
  |  | 14 | private $upgrade\_url; |
  |  | 15 | private $plugin\_name; |
  |  | 16 | private $product\_id; |
  |  | 17 | private $api\_key; |
  |  | 18 | private $activation\_unique\_product\_id; |
  |  | 19 | private $renew\_license\_url; |
  |  | 20 | private $instance; |
  |  | 21 | private $domain; |
  |  | 22 | private $software\_version; |
  |  | 23 | private $wf\_unique\_product\_id\_key; |
  |  | 24 | private $wf\_api\_licence\_key; |
  |  | 25 | private $wf\_instance\_key; |
  | 26 | 26 | public function \_\_construct( $upgrade\_url, $plugin\_name, $product\_id, $api\_key, $activation\_unique\_product\_id, $renew\_license\_url, $instance, $domain, $software\_version, $plugin\_or\_theme, $text\_domain, $extra, $wf\_unique\_product\_id\_key, $wf\_api\_licence\_key, $wf\_instance\_key ) { |
  | 27 | 27 | // API data |
* ## [elex-woocommerce-dynamic-pricing-and-discounts/trunk/includes/wf\_api\_manager/wf\_api\_manager.php](/changeset/3211131/elex-woocommerce-dynamic-pricing-and-discounts/trunk/includes/wf_api_manager/wf_api_manager.php "Show the changeset 3211131 restricted to elex-woocommerce-dynamic-pricing-and-discounts/trunk/includes/wf_api_manager/wf_api_manager.php")

  | [r2965037](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/includes/wf_api_manager/wf_api_manager.php?rev=2965037#L16 "Show revision 2965037 of this file in browser") | [r3211131](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/includes/wf_api_manager/wf_api_manager.php?rev=3211131#L16 "Show revision 3211131 of this file in browser") |  |
  | --- | --- | --- |
  | 16 | 16 | class WF\_API\_Manager { |
  | 17 | 17 | private $is\_ajax; |
  | 18 |  | private $upgrade\_url; |
  | 19 |  | private $plugin\_name; |
  | 20 |  | private $product\_id; |
  | 21 |  | private $api\_key; |
  | 22 |  | private $activation\_unique\_product\_id; |
  | 23 |  | private $renew\_license\_url; |
  | 24 |  | private $instance; |
  | 25 |  | private $domain; |
  | 26 |  | private $software\_version; |
  | 27 |  | private $wf\_unique\_product\_id\_key; |
  | 28 |  | private $wf\_api\_licence\_key; |
  | 29 |  | private $wf\_instance\_key; |
  | 30 |  | private $plugin\_settings\_url; |
  | 31 |  | private $plugin\_or\_theme; |
  | 32 |  | private $text\_domain; |
  | 33 |  | private $extra; |
  |  | 18 | private $upgrade\_url; |
  |  | 19 | private $plugin\_name; |
  |  | 20 | private $product\_id; |
  |  | 21 | private $api\_key; |
  |  | 22 | private $activation\_unique\_product\_id; |
  |  | 23 | private $renew\_license\_url; |
  |  | 24 | private $instance; |
  |  | 25 | private $domain; |
  |  | 26 | private $software\_version; |
  |  | 27 | private $wf\_unique\_product\_id\_key; |
  |  | 28 | private $wf\_api\_licence\_key; |
  |  | 29 | private $wf\_instance\_key; |
  |  | 30 | private $plugin\_settings\_url; |
  |  | 31 | private $plugin\_or\_theme; |
  |  | 32 | private $text\_domain; |
  |  | 33 | private $extra; |
  | 34 | 34 |  |
  | 35 | 35 | public function \_\_construct( $product\_id, $plugin\_version, $plugin\_slug, $server\_url, $plugin\_settings\_url = '' ) { |
* ## [elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-dynamic-pricing-plugin-public.php](/changeset/3211131/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-dynamic-pricing-plugin-public.php "Show the changeset 3211131 restricted to elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-dynamic-pricing-plugin-public.php")

  | [r3030019](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-dynamic-pricing-plugin-public.php?rev=3030019#L10 "Show revision 3030019 of this file in browser") | [r3211131](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-dynamic-pricing-plugin-public.php?rev=3211131#L10 "Show revision 3211131 of this file in browser") |  |
  | --- | --- | --- |
  | 10 | 10 | $GLOBALS['elex\_dp\_settings'] = get\_option('xa\_dynamic\_pricing\_setting'); |
  | 11 | 11 | add\_action('wp\_footer', 'elex\_dp\_print\_scripts\_payment\_gateway', 5); |
  | 12 |  | function elex\_dp\_print\_scripts\_payment\_gateway() |
  | 13 |  | { |
  | 14 |  | ?> |
  |  | 12 | function elex\_dp\_print\_scripts\_payment\_gateway() { |
  |  | 13 | ?> |
  | 15 | 14 | <script> |
  | 16 | 15 | jQuery(function($) { |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-dynamic-pricing-plugin-public.php?rev=3030019#L30) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-dynamic-pricing-plugin-public.php?rev=3211131#L29) |  |
  | 30 | 29 | <?php |
  | 31 | 30 | } |
  | 32 |  | function elex\_dp\_init\_calculator() |
  | 33 |  | { |
  |  | 31 | function elex\_dp\_init\_calculator() { |
  | 34 | 32 | $xa\_dp\_rules = get\_option('xa\_dp\_rules', array()); |
  | 35 | 33 | if (isset($GLOBALS['elex\_dp\_settings']) && empty($GLOBALS['elex\_dp\_settings']) || empty($xa\_dp\_rules)) { |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-dynamic-pricing-plugin-public.php?rev=3030019#L46) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-dynamic-pricing-plugin-public.php?rev=3211131#L44) |  |
  | 46 | 44 | add\_action('woocommerce\_before\_calculate\_totals', 'elex\_dp\_update\_globals'); |
  | 47 | 45 |  |
  | 48 |  |  |
  | 49 |  | function elex\_dp\_update\_globals($cart) |
  | 50 |  | { |
  |  | 46 | add\_action('woocommerce\_before\_cart\_totals', 'elex\_dp\_update\_cart\_total'); |
  |  | 47 |  |
  |  | 48 | function elex\_dp\_update\_cart\_total() { |
  |  | 49 | global $woocommerce; |
  |  | 50 | if ($woocommerce->cart) { |
  |  | 51 | $woocommerce->cart->calculate\_totals(); |
  |  | 52 | } |
  |  | 53 | } |
  |  | 54 |  |
  |  | 55 | function elex\_dp\_update\_globals( $cart) { |
  | 51 | 56 | if (isset($\_REQUEST['debugcart'])) { |
  | 52 | 57 | echo '<pre>'; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-dynamic-pricing-plugin-public.php?rev=3030019#L101) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-dynamic-pricing-plugin-public.php?rev=3211131#L106) |  |
  | 101 | 106 | } |
  | 102 | 107 | foreach ($xa\_cart\_categories[$\_pid] as $\_cid) { |
  | 103 |  | $xa\_cart\_categories\_items[$\_cid] = isset($xa\_cart\_categories\_items[$\_cid]) ? (~~$xa\_cart\_categories\_items[$\_cid] + 1~~) : 1; |
  | 104 |  | $xa\_cart\_categories\_units[$\_cid] = isset($xa\_cart\_categories\_units[$\_cid]) ? (~~$xa\_cart\_categories\_units[$\_cid] + $\_qnty~~) : $\_qnty; |
  |  | 108 | $xa\_cart\_categories\_items[$\_cid] = isset($xa\_cart\_categories\_items[$\_cid]) ? ( $xa\_cart\_categories\_items[$\_cid] + 1 ) : 1; |
  |  | 109 | $xa\_cart\_categories\_units[$\_cid] = isset($xa\_cart\_categories\_units[$\_cid]) ? ( $xa\_cart\_categories\_units[$\_cid] + $\_qnty ) : $\_qnty; |
  | 105 | 110 | } |
  | 106 | 111 | foreach ($xa\_cart\_tags[$\_pid] as $\_tid) { |
  | 107 |  | $xa\_cart\_tags\_items[$\_tid] = isset($xa\_cart\_tags\_items[$\_tid]) ? (~~$xa\_cart\_tags\_items[$\_tid] + 1~~) : 1; |
  | 108 |  | $xa\_cart\_tags\_units[$\_tid] = isset($xa\_cart\_tags\_units[$\_tid]) ? (~~$xa\_cart\_tags\_units[$\_tid] + $\_qnty~~) : $\_qnty; |
  |  | 112 | $xa\_cart\_tags\_items[$\_tid] = isset($xa\_cart\_tags\_items[$\_tid]) ? ( $xa\_cart\_tags\_items[$\_tid] + 1 ) : 1; |
  |  | 113 | $xa\_cart\_tags\_units[$\_tid] = isset($xa\_cart\_tags\_units[$\_tid]) ? ( $xa\_cart\_tags\_units[$\_tid] + $\_qnty ) : $\_qnty; |
  | 109 | 114 | } |
  | 110 | 115 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-dynamic-pricing-plugin-public.php?rev=3030019#L121) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-dynamic-pricing-plugin-public.php?rev=3211131#L126) |  |
  | 121 | 126 | add\_filter('woocommerce\_product\_is\_on\_sale', 'elex\_dp\_product\_is\_on\_sale', 99, 2); |
  | 122 | 127 |  |
  | 123 |  | function elex\_dp\_product\_is\_on\_sale($on\_sale, $product) |
  | 124 |  | { |
  |  | 128 | function elex\_dp\_product\_is\_on\_sale( $on\_sale, $product) { |
  | 125 | 129 |  |
  | 126 | 130 | if ($product->is\_type('grouped') || $product->is\_type('variable')) { |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-dynamic-pricing-plugin-public.php?rev=3030019#L172) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-dynamic-pricing-plugin-public.php?rev=3211131#L176) |  |
  | 172 | 176 | } |
  | 173 | 177 |  |
  | 174 |  | function elex\_dp\_calculate\_and\_apply\_discount\_and\_add\_fee() |
  | 175 |  | { |
  |  | 178 | function elex\_dp\_calculate\_and\_apply\_discount\_and\_add\_fee() { |
  | 176 | 179 | global $xa\_common\_flat\_discount; |
  | 177 | 180 | global $woocommerce; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-dynamic-pricing-plugin-public.php?rev=3030019#L192) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-dynamic-pricing-plugin-public.php?rev=3211131#L195) |  |
  | 192 | 195 | add\_action($pricing\_table\_hook, 'elex\_dp\_show\_pricing\_table', 40); |
  | 193 | 196 |  |
  | 194 |  | function elex\_dp\_show\_pricing\_table() |
  | 195 |  | { |
  |  | 197 | function elex\_dp\_show\_pricing\_table() { |
  | 196 | 198 | $selected\_role = get\_option('elex\_dp\_allowed\_roles\_to\_show\_pricing\_table'); |
  | 197 | 199 | if (!empty($selected\_role)) { |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-dynamic-pricing-plugin-public.php?rev=3030019#L210) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-dynamic-pricing-plugin-public.php?rev=3211131#L212) |  |
  | 210 | 212 | add\_action($offer\_table\_hook, 'elex\_dp\_show\_offer\_table', 40); |
  | 211 | 213 |  |
  | 212 |  | function elex\_dp\_show\_offer\_table() |
  | 213 |  | { |
  |  | 214 | function elex\_dp\_show\_offer\_table() { |
  | 214 | 215 | $path = dirname(\_\_FILE\_\_) . '/elex-single-product-offer-table.php'; |
  | 215 | 216 | if (isset($GLOBALS['elex\_dp\_settings']['offer\_table\_on\_off']) && $GLOBALS['elex\_dp\_settings']['offer\_table\_on\_off'] == 'enable' && file\_exists($path) == true) { |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-dynamic-pricing-plugin-public.php?rev=3030019#L220) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-dynamic-pricing-plugin-public.php?rev=3211131#L221) |  |
  | 220 | 221 | add\_filter('woocommerce\_cart\_item\_price', 'elex\_dp\_show\_discount\_on\_line\_item', 100, 2); |
  | 221 | 222 |  |
  | 222 |  | function elex\_dp\_show\_discount\_on\_line\_item($price, $cart\_item) |
  | 223 |  | { |
  |  | 223 | function elex\_dp\_show\_discount\_on\_line\_item( $price, $cart\_item) { |
  | 224 | 224 | $prod  = $cart\_item['data']; |
  | 225 | 225 | $price = $prod->get\_price\_html(); |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-dynamic-pricing-plugin-public.php?rev=3030019#L229) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-dynamic-pricing-plugin-public.php?rev=3211131#L229) |  |
  | 229 | 229 | add\_action('wc\_ajax\_get\_refreshed\_fragments', 'elex\_dp\_wc\_ajax\_get\_refreshed\_fragments', 1); |
  | 230 | 230 |  |
  | 231 |  | function elex\_dp\_wc\_ajax\_get\_refreshed\_fragments() |
  | 232 |  | { |
  |  | 231 | function elex\_dp\_wc\_ajax\_get\_refreshed\_fragments() { |
  | 233 | 232 | global $woocommerce; |
  | 234 | 233 | if ($woocommerce->cart) { |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-dynamic-pricing-plugin-public.php?rev=3030019#L238) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-dynamic-pricing-plugin-public.php?rev=3211131#L237) |  |
  | 238 | 237 |  |
  | 239 | 238 | // Exclude discount from taxes |
  | 240 |  | function excludeCartFeesTaxes($taxes, $fee, $cart) |
  | 241 |  | { |
  |  | 239 | function excludeCartFeesTaxes( $taxes, $fee, $cart) { |
  | 242 | 240 | return []; |
  | 243 | 241 | } |
  | 244 |  | add\_action('woocommerce\_cart\_totals\_get\_fees\_from\_cart\_taxes', 'excludeCartFeesTaxes', 10 ,3); |
  |  | 242 | add\_action('woocommerce\_cart\_totals\_get\_fees\_from\_cart\_taxes', 'excludeCartFeesTaxes', 10 , 3); |
  |  | 243 |  |
  |  | 244 | add\_action('save\_post\_product', 'delete\_product\_transient\_on\_price\_update', 10, 3); |
  |  | 245 |  |
  |  | 246 | function delete\_product\_transient\_on\_price\_update( $post\_id, $post, $update) { |
  |  | 247 |  |
  |  | 248 | global $wpdb; |
  |  | 249 | // Specify the transient key pattern |
  |  | 250 | $transient\_key\_pattern = 'elex\_dp\_product\_data\_' . $post\_id; |
  |  | 251 |  |
  |  | 252 | $wpdb->query( |
  |  | 253 | $wpdb->prepare( |
  |  | 254 | "DELETE FROM $wpdb->options WHERE option\_name LIKE %s OR option\_name LIKE %s", |
  |  | 255 | '\_transient\_%' . $transient\_key\_pattern, |
  |  | 256 | '\_transient\_timeout\_%' . $transient\_key\_pattern |
  |  | 257 | ) |
  |  | 258 | ); |
  |  | 259 |  |
  |  | 260 | // Clear the object cache |
  |  | 261 | wp\_cache\_flush(); |
  |  | 262 |  |
  |  | 263 | } |
  |  | 264 |  |
  |  | 265 | add\_action('woocommerce\_update\_product\_variation', 'delete\_variation\_transient\_on\_price\_update', 10, 1); |
  |  | 266 |  |
  |  | 267 | function delete\_variation\_transient\_on\_price\_update( $variation\_id) { |
  |  | 268 |  |
  |  | 269 | global $wpdb; |
  |  | 270 | // Specify the transient key pattern for the variation |
  |  | 271 | $transient\_key\_pattern = 'elex\_dp\_product\_data\_' . $variation\_id; |
  |  | 272 |  |
  |  | 273 | $wpdb->query( |
  |  | 274 | $wpdb->prepare( |
  |  | 275 | "DELETE FROM $wpdb->options WHERE option\_name LIKE %s OR option\_name LIKE %s", |
  |  | 276 | '\_transient\_%' . $transient\_key\_pattern, |
  |  | 277 | '\_transient\_timeout\_%' . $transient\_key\_pattern |
  |  | 278 | ) |
  |  | 279 | ); |
  |  | 280 |  |
  |  | 281 | // Clear the object cache |
  |  | 282 | wp\_cache\_flush(); |
  |  | 283 |  |
  |  | 284 | } |
* ## [elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-new-calculation-handler.php](/changeset/3211131/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-new-calculation-handler.php "Show the changeset 3211131 restricted to elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-new-calculation-handler.php")

  | [r3046337](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-new-calculation-handler.php?rev=3046337#L16 "Show revision 3046337 of this file in browser") | [r3211131](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-new-calculation-handler.php?rev=3211131#L16 "Show revision 3211131 of this file in browser") |  |
  | --- | --- | --- |
  | 16 | 16 | \* @author Akshay |
  | 17 | 17 | \*/ |
  | 18 |  | class Elex\_NewCalculationHandler |
  | 19 |  | { |
  |  | 18 | class Elex\_NewCalculationHandler { |
  |  | 19 |  |
  | 20 | 20 |  |
  | 21 | 21 | public $debug\_mode = false; |
  | 22 | 22 |  |
  | 23 |  | public function \_\_construct() |
  | 24 |  | { |
  |  | 23 | public function \_\_construct() { |
  | 25 | 24 | $dummy\_settings['product\_rules\_on\_off']          = 'enable'; |
  | 26 | 25 | $dummy\_settings['combinational\_rules\_on\_off']    = 'enable'; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-new-calculation-handler.php?rev=3046337#L110) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-new-calculation-handler.php?rev=3211131#L109) |  |
  | 110 | 109 | $parent\_id                 = elex\_dp\_is\_wc\_version\_gt\_eql('2.7') ? $prod->get\_parent\_id() : $prod->parent->id; |
  | 111 | 110 | $parent\_product            = wc\_get\_product($parent\_id); |
  | 112 |  | if~~($parent\_product)~~{ |
  |  | 111 | if ($parent\_product) { |
  | 113 | 112 | $xa\_cart\_categories[$\_pid] = elex\_dp\_is\_wc\_version\_gt\_eql('2.7') ? $parent\_product->get\_category\_ids() : elex\_dp\_get\_category\_ids($parent\_product); |
  | 114 | 113 | $xa\_cart\_tags[$\_pid]       = xa\_get\_tag\_ids($\_pid); |
  | 115 |  | }~~else~~{ |
  |  | 114 | } else { |
  | 116 | 115 | $xa\_cart\_categories[$\_pid] = elex\_dp\_is\_wc\_version\_gt\_eql('2.7') ? $prod->get\_category\_ids() : elex\_dp\_get\_category\_ids($prod); |
  | 117 | 116 | $xa\_cart\_tags[$\_pid]       = xa\_get\_tag\_ids($prod); |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-new-calculation-handler.php?rev=3046337#L123) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-new-calculation-handler.php?rev=3211131#L122) |  |
  | 123 | 122 | } |
  | 124 | 123 | foreach ($xa\_cart\_categories[$\_pid] as $\_cid) { |
  | 125 |  | $xa\_cart\_categories\_items[$\_cid] = isset($xa\_cart\_categories\_items[$\_cid]) ? (~~$xa\_cart\_categories\_items[$\_cid] + 1~~) : 1; |
  | 126 |  | $xa\_cart\_categories\_units[$\_cid] = isset($xa\_cart\_categories\_units[$\_cid]) ? (~~$xa\_cart\_categories\_units[$\_cid] + $\_qnty~~) : $\_qnty; |
  |  | 124 | $xa\_cart\_categories\_items[$\_cid] = isset($xa\_cart\_categories\_items[$\_cid]) ? ( $xa\_cart\_categories\_items[$\_cid] + 1 ) : 1; |
  |  | 125 | $xa\_cart\_categories\_units[$\_cid] = isset($xa\_cart\_categories\_units[$\_cid]) ? ( $xa\_cart\_categories\_units[$\_cid] + $\_qnty ) : $\_qnty; |
  | 127 | 126 | } |
  | 128 | 127 | foreach ($xa\_cart\_tags[$\_pid] as $\_tid) { |
  | 129 |  | $xa\_cart\_tags\_items[$\_tid] = isset($xa\_cart\_tags\_items[$\_tid]) ? (~~$xa\_cart\_tags\_items[$\_tid] + 1~~) : 1; |
  | 130 |  | $xa\_cart\_tags\_units[$\_tid] = isset($xa\_cart\_tags\_units[$\_tid]) ? (~~$xa\_cart\_tags\_units[$\_tid] + $\_qnty~~) : $\_qnty; |
  |  | 128 | $xa\_cart\_tags\_items[$\_tid] = isset($xa\_cart\_tags\_items[$\_tid]) ? ( $xa\_cart\_tags\_items[$\_tid] + 1 ) : 1; |
  |  | 129 | $xa\_cart\_tags\_units[$\_tid] = isset($xa\_cart\_tags\_units[$\_tid]) ? ( $xa\_cart\_tags\_units[$\_tid] + $\_qnty ) : $\_qnty; |
  | 131 | 130 | } |
  | 132 | 131 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-new-calculation-handler.php?rev=3046337#L145) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-new-calculation-handler.php?rev=3211131#L144) |  |
  | 145 | 144 | } |
  | 146 | 145 |  |
  | 147 |  | /\*\* |
  |  | 146 | /\*\* |
  | 148 | 147 | \* Finds valid rules for this product and return discounted price based on (all rules,first match,best discount) |
  | 149 | 148 | \* |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-new-calculation-handler.php?rev=3046337#L154) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-new-calculation-handler.php?rev=3211131#L153) |  |
  | 154 | 153 | \* @return $discounted\_price |
  | 155 | 154 | \*/ |
  | 156 |  | public function elex\_dp\_getDiscountedPriceForProduct($old\_price = '', $product = null, $pid = null) |
  | 157 |  | { |
  | 158 |  | //error\_log($product->get\_id()." filter=".current\_filter()); |
  | 159 |  | global $elex\_dp\_cached\_prices; |
  | 160 |  | if (!$elex\_dp\_cached\_prices) { |
  | 161 |  | $elex\_dp\_cached\_prices = array(); |
  | 162 |  | } |
  | 163 |  |  |
  | 164 |  | if (!isset($elex\_dp\_cached\_prices[$product->get\_id()])) { |
  | 165 |  | $elex\_dp\_cached\_prices[$product->get\_id()] = array(); |
  | 166 |  | } |
  | 167 |  |  |
  | 168 |  | // if (isset($elex\_dp\_cached\_prices[$product->get\_id()][current\_filter()])) { |
  | 169 |  | //  return $elex\_dp\_cached\_prices[$product->get\_id()][current\_filter()]; |
  | 170 |  | // } |
  | 171 |  | // print("<pre>".print\_r(debug\_backtrace(),true)."</pre>"); |
  | 172 |  |  |
  | 173 |  | global $xa\_dp\_setting; |
  | 174 |  | $xa\_add\_on\_true  = true; |
  | 175 |  | $xa\_add\_on\_false = false; |
  | 176 |  | if (is\_plugin\_active('woocommerce-product-addons/woocommerce-product-addons.php')) { |
  | 177 |  | if ($xa\_dp\_setting['xa\_product\_add\_on\_option'] == 'disable') { |
  | 178 |  | $xa\_add\_on\_true  = false; |
  | 179 |  | $xa\_add\_on\_false = true; |
  | 180 |  | } |
  | 181 |  | } |
  | 182 |  |  |
  | 183 |  | //Code added to make discount apply in custom woocommerce pages. |
  | 184 |  | $product\_filters = array('woocommerce\_product\_get\_price', 'woocommerce\_product\_variation\_get\_price', 'woocommerce\_product\_variation\_get\_sale\_price', 'woocommerce\_product\_get\_sale\_price'); |
  | 185 |  |  |
  | 186 |  | if (apply\_filters('xa\_give\_discount\_on\_addon\_prices', true) == $xa\_add\_on\_false && did\_action('woocommerce\_before\_calculate\_totals') || doing\_action('woocommerce\_before\_calculate\_totals')) {   // added this code for compatiblity with woocommerce product addons |
  | 187 |  | // $elex\_dp\_cached\_prices[$product->get\_id()][current\_filter()] = $old\_price; |
  |  | 155 | public function elex\_dp\_getDiscountedPriceForProduct( $old\_price = '', $product = null, $pid = null) { |
  |  | 156 | static $cached\_prices = array(); |
  |  | 157 |  |
  |  | 158 | // Early return if product or price is not provided |
  |  | 159 | if (!$product || !$old\_price) { |
  | 188 | 160 | return $old\_price; |
  | 189 | 161 | } |
  | 190 |  | if (!is\_shop() && !is\_product() && !is\_product\_tag() &&  !is\_product\_category() && !did\_action('woocommerce\_before\_calculate\_totals') && apply\_filters('xa\_give\_discount\_on\_addon\_prices', true) == $xa\_add\_on\_true && !in\_array(current\_filter(), $product\_filters)) {   // added this code for compatiblity with woocommerce product addons |
  | 191 |  | // $elex\_dp\_cached\_prices[$product->get\_id()][current\_filter()] = $old\_price; |
  |  | 162 |  |
  |  | 163 | $product\_id = $product->get\_id(); |
  |  | 164 | if (!isset($cached\_prices[$product\_id])) { |
  |  | 165 | $cached\_prices[$product\_id] = array(); |
  |  | 166 | } |
  |  | 167 |  |
  |  | 168 | // Check if the discount calculation should be skipped |
  |  | 169 | global $xa\_hooks, $xa\_dp\_setting, $xa\_cart\_quantities, $xa\_common\_flat\_discount; |
  |  | 170 | $apply\_discount = apply\_filters('xa\_give\_discount\_on\_addon\_prices', true); |
  |  | 171 |  |
  |  | 172 | if (( !is\_shop() && !is\_product() && !is\_product\_tag() && !is\_product\_category() && !did\_action('woocommerce\_before\_calculate\_totals') ) |
  |  | 173 | || ( !$apply\_discount && ( did\_action('woocommerce\_before\_calculate\_totals') || doing\_action('woocommerce\_before\_calculate\_totals') ) ) |
  |  | 174 | ) { |
  | 192 | 175 | return $old\_price; |
  | 193 | 176 | } |
  | 194 |  | global $xa\_hooks, $xa\_common\_flat\_discount, $xa\_cart\_price, $executed\_pids; |
  | 195 |  | remove\_filter($xa\_hooks['woocommerce\_get\_price\_hook\_name'], array($this, 'elex\_dp\_getDiscountedPriceForProduct'), 22); |
  | 196 |  | remove\_filter($xa\_hooks['woocommerce\_get\_sale\_price\_hook\_name'], array($this, 'elex\_dp\_getDiscountedPriceForProduct'), 22);    // update sale price on product page |
  | 197 |  | remove\_filter('woocommerce\_product\_variation\_get\_price', array($this, 'elex\_dp\_getDiscountedPriceForProduct'), 22); |
  | 198 |  | remove\_filter('woocommerce\_product\_variation\_get\_sale\_price', array($this, 'elex\_dp\_getDiscountedPriceForProduct'), 22);    // update sale price on product page |
  | 199 |  |  |
  | 200 |  | $regular\_price = $product->get\_regular\_price(); |
  | 201 |  |  |
  | 202 |  | if (empty($pid)) { |
  | 203 |  | $pid = elex\_dp\_get\_pid($product); |
  | 204 |  | } |
  | 205 |  |  |
  | 206 |  | if ($pid == false) { |
  | 207 |  | add\_filter($xa\_hooks['woocommerce\_get\_price\_hook\_name'], array($this, 'elex\_dp\_getDiscountedPriceForProduct'), 22, 2);         // update sale price on product page |
  | 208 |  | add\_filter($xa\_hooks['woocommerce\_get\_sale\_price\_hook\_name'], array($this, 'elex\_dp\_getDiscountedPriceForProduct'), 22, 2);    // update sale price on product page |
  | 209 |  | add\_filter('woocommerce\_product\_variation\_get\_price', array($this, 'elex\_dp\_getDiscountedPriceForProduct'), 22, 2);    // update sale price on product page |
  | 210 |  | add\_filter('woocommerce\_product\_variation\_get\_sale\_price', array($this, 'elex\_dp\_getDiscountedPriceForProduct'), 22, 2);    // update sale price on product page |
  | 211 |  | $elex\_dp\_cached\_prices[$product->get\_id()][current\_filter()] = $old\_price; |
  |  | 177 | if ( !is\_cart() && !is\_checkout() && !empty( get\_transient('elex\_dp\_product\_data\_' . $product\_id) ) ) { |
  |  | 178 | $discounted\_price = get\_transient('elex\_dp\_product\_data\_' . $product\_id); |
  |  | 179 | return $discounted\_price; |
  |  | 180 | } |
  |  | 181 |  |
  |  | 182 | // If the discounted price is cached in transient, return it immediately |
  |  | 183 | if (isset($cached\_prices[$product\_id][current\_filter()])) { |
  |  | 184 | return $cached\_prices[$product\_id][current\_filter()]; |
  |  | 185 | } |
  |  | 186 | // Ensure hooks are added and removed properly |
  |  | 187 | $this->manageHooks(false); |
  |  | 188 |  |
  |  | 189 | $regular\_price = $product->get\_regular\_price(); |
  |  | 190 | $pid = $pid ?: elex\_dp\_get\_pid($product); |
  |  | 191 |  |
  |  | 192 | if (!$pid) { |
  |  | 193 | $this->manageHooks(true); |
  | 212 | 194 | return $old\_price; |
  | 213 | 195 | } |
  | 214 |  | if (((current\_filter() == $xa\_hooks['woocommerce\_get\_sale\_price\_hook\_name']) || (current\_filter() == 'woocommerce\_product\_variation\_get\_sale\_price')) && empty($old\_price)) {  // if sale price is empty then old price is regular\_price |
  |  | 196 |  |
  |  | 197 | // Set old\_price if empty in certain filters |
  |  | 198 |  |
  |  | 199 |  |
  |  | 200 | if (in\_array(current\_filter(), array($xa\_hooks['woocommerce\_get\_sale\_price\_hook\_name'], 'woocommerce\_product\_variation\_get\_sale\_price')) && empty($old\_price)) { |
  | 215 | 201 | $old\_price = $regular\_price; |
  | 216 | 202 | } |
  | 217 |  | $discounted\_price = $old\_price; |
  | 218 |  | $weight           = $product->get\_weight(); |
  | 219 |  | if (!empty($old\_price) && (!empty($product) || !empty($pid))) { |
  | 220 |  |  |
  | 221 |  | global $xa\_cart\_quantities; |
  | 222 |  | $parent\_id = $pid; |
  | 223 |  | if ($product->get\_type() == 'variation') { |
  | 224 |  | $parent\_id = elex\_dp\_is\_wc\_version\_gt\_eql('2.7') ? $product->get\_parent\_id() : $product->parent->id; |
  | 225 |  | } |
  | 226 |  | if (isset($xa\_cart\_quantities[$pid]) || isset($xa\_cart\_quantities[$parent\_id])) { |
  | 227 |  | $current\_quantity = isset($xa\_cart\_quantities[$pid]) ? $xa\_cart\_quantities[$pid] : $xa\_cart\_quantities[$parent\_id]; |
  | 228 |  | } else { |
  | 229 |  | $current\_quantity = 0; |
  | 230 |  | } |
  | 231 |  | if ($current\_quantity == 0  && class\_exists('SitePress')) { |
  | 232 |  | global $sitepress; |
  | 233 |  | $trid    = $sitepress->get\_element\_trid($pid); |
  | 234 |  | $trans   = $sitepress->get\_element\_translations($trid); |
  | 235 |  | $all\_ids = array(); |
  | 236 |  | foreach ($trans as $lan) { |
  | 237 |  | $all\_ids[] = $lan->element\_id; |
  | 238 |  | } |
  | 239 |  | foreach ($all\_ids as $\_pid) { |
  | 240 |  | if (!empty($xa\_cart\_quantities[$\_pid])) { |
  | 241 |  | $current\_quantity = $xa\_cart\_quantities[$\_pid]; |
  | 242 |  | break; |
  | 243 |  | } |
  | 244 |  | } |
  | 245 |  | } |
  |  | 203 |  |
  |  | 204 | $discounted\_price = $old\_price; |
  |  | 205 | $weight = $product->get\_weight(); |
  |  | 206 |  |
  |  | 207 | if (!empty($old\_price) && $pid) { |
  |  | 208 | $parent\_id = ( $product->get\_type() == 'variation' ) ? $product->get\_parent\_id() : $pid; |
  |  | 209 | $current\_quantity = $xa\_cart\_quantities[$pid] ?? $xa\_cart\_quantities[$parent\_id] ?? 0; |
  |  | 210 |  |
  | 246 | 211 | if (is\_shop() || is\_product\_category() || is\_product() || is\_product\_tag()) { |
  | 247 | 212 | $current\_quantity++; |
  | 248 | 213 | } |
  |  | 214 |  |
  | 249 | 215 | $objRulesValidator = new Elex\_RulesValidator(); |
  | 250 |  |  |
  | 251 | 216 | $valid\_rules = $objRulesValidator->elex\_dp\_getValidRulesForProduct($product, $pid, $current\_quantity, $discounted\_price, $weight); |
  | 252 |  |  |
  |  | 217 |  |
  | 253 | 218 | if ($this->debug\_mode) { |
  | 254 | 219 | error\_log(str\_repeat('-', 380)); |
  | 255 | 220 | error\_log('Valid Rules for Pid=' . $pid . ' and qnty=' . $current\_quantity . ' Valid Rules= ' . print\_r($valid\_rules, true)); |
  | 256 | 221 | } |
  | 257 |  | $mode = !empty($xa\_dp\_setting['mode']) ? $xa\_dp\_setting['mode'] : 'first\_match'; |
  | 258 |  | // if (!empty($executed\_pids[$pid]) && $mode == 'best\_discount' && !$product->is\_type('variation')) { |
  | 259 |  | //  $product->set\_price($executed\_pids[$pid]); |
  | 260 |  | //  add\_filter($xa\_hooks['woocommerce\_get\_price\_hook\_name'], array($this, 'elex\_dp\_getDiscountedPriceForProduct'), 22, 2);         // update sale price on product page |
  | 261 |  | //  add\_filter($xa\_hooks['woocommerce\_get\_sale\_price\_hook\_name'], array($this, 'elex\_dp\_getDiscountedPriceForProduct'), 22, 2);    // update sale price on product page |
  | 262 |  | //  add\_filter('woocommerce\_product\_variation\_get\_price', array($this, 'elex\_dp\_getDiscountedPriceForProduct'), 22, 2);    // update sale price on product page |
  | 263 |  | //  add\_filter('woocommerce\_product\_variation\_get\_sale\_price', array($this, 'elex\_dp\_getDiscountedPriceForProduct'), 22, 2);    // update sale price on product page |
  | 264 |  | //  $elex\_dp\_cached\_prices[$product->get\_id()][current\_filter()] = $executed\_pids[$pid]; |
  | 265 |  | //  return $executed\_pids[$pid]; |
  | 266 |  | // } |
  | 267 |  | if (is\_array($valid\_rules) && $valid\_rules) { |
  | 268 |  | $valid\_flat\_discount = []; |
  |  | 222 |  |
  |  | 223 | if (is\_array($valid\_rules) && $valid\_rules) { |
  | 269 | 224 | foreach ($valid\_rules as $rule\_type\_colon\_rule\_no => $rule) { |
  | 270 |  | //this section supports repeat execution for product rules |
  | 271 |  | if (isset($rule['repeat\_rule']) && $rule['repeat\_rule'] == 'yes' && !empty($rule['max']) && !empty($rule['min'])) { |
  | 272 |  | if ($rule['rule\_type'] == 'product\_rules') { |
  | 273 |  | if ($product->get\_type() == 'variation') { |
  | 274 |  | $pparent\_id = elex\_dp\_is\_wc\_version\_gt\_eql('2.7') ? $product->get\_parent\_id() : $product->parent->id; |
  | 275 |  |  |
  | 276 |  | if (is\_array($rule['product\_id']) && in\_array($pparent\_id, $rule['product\_id'])) { |
  | 277 |  | $pparent\_product  = new WC\_Product\_Variable($pparent\_id); |
  | 278 |  | $variations       = $pparent\_product->get\_children(); |
  | 279 |  | $current\_quantity = 0; |
  | 280 |  | foreach ($variations as $value) { |
  | 281 |  | if (isset($xa\_cart\_quantities[$value])) { |
  | 282 |  | $current\_quantity += $xa\_cart\_quantities[$value]; |
  | 283 |  | } |
  | 284 |  | } |
  | 285 |  | if (isset($xa\_cart\_quantities[$pparent\_id])) { |
  | 286 |  | $current\_quantity += $xa\_cart\_quantities[$value]; |
  | 287 |  | } |
  | 288 |  | if (is\_shop() || is\_product\_category() || is\_product() || is\_product\_tag()) { |
  | 289 |  | $current\_quantity++; |
  | 290 |  | } |
  | 291 |  | } |
  | 292 |  | } |
  | 293 |  | } |
  | 294 |  | $times       = intval($current\_quantity / $rule['max']); |
  | 295 |  | $total\_price = 0; |
  | 296 |  | $repeat\_qnty = (float) $rule['max']; |
  | 297 |  | if ($this->debug\_mode) { |
  | 298 |  | error\_log(str\_repeat('>', 208)); |
  | 299 |  | error\_log('Executing Rule(Repeat=True):' . $rule\_type\_colon\_rule\_no); |
  | 300 |  | } |
  | 301 |  | if (!empty($rule['discount\_type']) && $rule['discount\_type'] == 'Flat Discount') { |
  | 302 |  | $xa\_common\_flat\_discount[$rule['rule\_type'] . ':' . $rule['rule\_no'] . ':' . $pid] = floatval($rule['value']) \* floatval($times); |
  | 303 |  | if (!empty($rule['adjustment'])) { |
  | 304 |  | $adjusted\_qnty    = !empty($objRulesValidator->rule\_based\_quantity[$rule['rule\_type'] . ':' . $rule['rule\_no']]) ? $objRulesValidator->rule\_based\_quantity[$rule['rule\_type'] . ':' . $rule['rule\_no']] : $current\_quantity; |
  | 305 |  | $discounted\_price = $discounted\_price + ((float) $rule['adjustment'] / $adjusted\_qnty); |
  | 306 |  | } |
  | 307 |  | } else { |
  | 308 |  | $object\_hash = spl\_object\_hash($product); |
  | 309 |  | $object\_hash = $object\_hash . $pid; |
  | 310 |  | $r\_price     = $objRulesValidator->elex\_dp\_execute\_rule($discounted\_price, $rule\_type\_colon\_rule\_no, $rule, $repeat\_qnty, $pid, $object\_hash); |
  | 311 |  | //error\_log("$total\_price = $r\_price \* $times \* $repeat\_qnty"); |
  | 312 |  | $total\_price    = $r\_price \* $times \* $repeat\_qnty; |
  | 313 |  | $remaining\_qnty = $current\_quantity - ($times \* $repeat\_qnty); |
  | 314 |  | if ($remaining\_qnty > 0) { |
  | 315 |  | $price = isset($xa\_cart\_price[$pid]) ? $xa\_cart\_price[$pid] : 0; |
  | 316 |  | $total\_price = $total\_price + ($remaining\_qnty \* $price); |
  | 317 |  | } |
  | 318 |  | $discounted\_price = $total\_price / $current\_quantity; |
  | 319 |  | } |
  | 320 |  | } else { |
  | 321 |  | if ($this->debug\_mode) { |
  | 322 |  | error\_log(str\_repeat('>', 208)); |
  | 323 |  | error\_log('Executing Rule:' . $rule\_type\_colon\_rule\_no); |
  | 324 |  | } |
  | 325 |  | //fix for best discount mode flat discount is not getting calculated] |
  | 326 |  |  |
  | 327 |  | // if (!empty($rule['discount\_type']) && $rule['discount\_type'] == 'Flat Discount') { // removed variation condition because variations were getting executed like non flat discounts |
  | 328 |  | //  if ($rule['rule\_type'] == 'product\_rules') { |
  | 329 |  | //      $xa\_common\_flat\_discount[$rule['rule\_type'] . ':' . $rule['rule\_no'] . ':' . $pid] = floatval($rule['value']); |
  | 330 |  | //  } elseif ($rule['rule\_type'] == 'category\_rules') { |
  | 331 |  | //      $cid = !empty($rule['selected\_cids']) ? current($rule['selected\_cids']) : ''; |
  | 332 |  | //      $xa\_common\_flat\_discount[$rule['rule\_type'] . ':' . $rule['rule\_no'] . ':' . $cid] = floatval($rule['value']); |
  | 333 |  | //  } else { |
  | 334 |  | //      $xa\_common\_flat\_discount[$rule['rule\_type'] . ':' . $rule['rule\_no']] = floatval($rule['value']); |
  | 335 |  | //  } |
  | 336 |  | //  if (!empty($rule['adjustment'])) { |
  | 337 |  | //      $adjusted\_qnty    = !empty($objRulesValidator->rule\_based\_quantity[$rule['rule\_type'] . ':' . $rule['rule\_no']]) ? $objRulesValidator->rule\_based\_quantity[$rule['rule\_type'] . ':' . $rule['rule\_no']] : $current\_quantity; |
  | 338 |  | //      $discounted\_price = $discounted\_price + ((float) $rule['adjustment'] / $adjusted\_qnty); |
  | 339 |  | //  } |
  | 340 |  | // } else { |
  | 341 |  |  |
  | 342 |  | $object\_hash      = spl\_object\_hash($product); |
  | 343 |  | $object\_hash      = $object\_hash . $pid; |
  | 344 |  | $discounted\_price = $objRulesValidator->elex\_dp\_execute\_rule($discounted\_price, $rule\_type\_colon\_rule\_no, $rule, $current\_quantity, $pid, $object\_hash); |
  | 345 |  | } |
  | 346 |  | // } |
  |  | 225 | $object\_hash = spl\_object\_hash($product) . $pid; |
  |  | 226 | $discounted\_price = $objRulesValidator->elex\_dp\_execute\_rule($discounted\_price, $rule\_type\_colon\_rule\_no, $rule, $current\_quantity, $pid, $object\_hash); |
  | 347 | 227 | if ($rule['rule\_type'] != 'BOGO\_category\_rules' && $rule['rule\_type'] != 'buy\_get\_free\_rules' && $rule['rule\_type'] != 'bogo\_tag\_rules') { |
  | 348 | 228 | $product->set\_price($discounted\_price); |
  | 349 |  | ~~}~~ |
  | 350 |  |  |
  | 351 |  | ~~//Calculating the valid flat discounts.~~ |
  | 352 |  | ~~$key = $rule['rule\_type'] . ':' . $rule['rule\_no'] . ':' . $pid;~~ |
  | 353 |  | ~~if($xa\_common\_flat\_discount && array\_key\_exists($key, $xa\_common\_flat\_discount)){~~ |
  | 354 |  | ~~$valid\_flat\_discount[$key] = $key;~~ |
  | 355 |  | ~~}~~ |
  | 356 |  | ~~}~~ |
  | 357 |  | ~~if($xa\_common\_flat\_discount){~~ |
  | 358 |  | ~~foreach($xa\_common\_flat\_discount as $key => $value){~~ |
  | 359 |  | ~~$key\_parts = explode(':', $key);~~ |
  | 360 |  | ~~$current\_pid = end($key\_parts);~~ |
  | 361 |  | ~~if(!array\_key\_exists($key, $valid\_flat\_discount) && ($current\_pid == $pid)){~~ |
  | 362 |  | ~~unset($xa\_common\_flat\_discount[$key]);~~ |
  | 363 |  | ~~}~~ |
  | 364 | 229 | } |
  | 365 | 230 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-new-calculation-handler.php?rev=3046337#L367) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-new-calculation-handler.php?rev=3211131#L232) |  |
  | 367 | 232 | foreach ($xa\_common\_flat\_discount as $key => $value) { |
  | 368 | 233 | $key\_parts = explode(':', $key); |
  | 369 |  | $current\_pid = end($key\_parts); |
  | 370 |  | if ($current\_pid == $pid) { |
  |  | 234 | if (end($key\_parts) == $pid) { |
  | 371 | 235 | unset($xa\_common\_flat\_discount[$key]); |
  | 372 | 236 | } |
  | 373 | 237 | } |
  | 374 | 238 | } |
  | 375 |  | } |
  | 376 |  | $elex\_dp\_cached\_prices[$product->get\_id()][current\_filter()] = $discounted\_price; |
  | 377 |  | add\_filter($xa\_hooks['woocommerce\_get\_price\_hook\_name'], array($this, 'elex\_dp\_getDiscountedPriceForProduct'), 22, 2);         // update sale price on product page |
  | 378 |  | add\_filter($xa\_hooks['woocommerce\_get\_sale\_price\_hook\_name'], array($this, 'elex\_dp\_getDiscountedPriceForProduct'), 22, 2);    // update sale price on product page |
  | 379 |  | add\_filter('woocommerce\_product\_variation\_get\_price', array($this, 'elex\_dp\_getDiscountedPriceForProduct'), 22, 2);    // update sale price on product page |
  | 380 |  | add\_filter('woocommerce\_product\_variation\_get\_sale\_price', array($this, 'elex\_dp\_getDiscountedPriceForProduct'), 22, 2);    // update sale price on product page |
  | 381 |  | if (((current\_filter() == $xa\_hooks['woocommerce\_get\_sale\_price\_hook\_name']) || (current\_filter() == 'woocommerce\_product\_variation\_get\_sale\_price')) && ($regular\_price == $discounted\_price)) {  // if sale price is empty then old price is regular\_price |
  | 382 |  | return ''; |
  | 383 |  | } |
  | 384 |  | return $discounted\_price; |
  | 385 |  | } |
  | 386 |  |  |
  | 387 |  | public function elex\_dp\_getDiscountedPriceHTML($price, $product) |
  | 388 |  | { |
  |  | 239 |  |
  |  | 240 |  |
  |  | 241 | } |
  |  | 242 | if ( empty( get\_transient('elex\_dp\_product\_data\_' . $product\_id) ) ) { |
  |  | 243 | set\_transient( 'elex\_dp\_product\_data\_' . $product\_id, $discounted\_price ); |
  |  | 244 | } |
  |  | 245 | $cached\_prices[$product\_id][current\_filter()] = $discounted\_price; |
  |  | 246 |  |
  |  | 247 | // Restore hooks |
  |  | 248 | $this->manageHooks(true); |
  |  | 249 |  |
  |  | 250 | return ( in\_array(current\_filter(), array($xa\_hooks['woocommerce\_get\_sale\_price\_hook\_name'], 'woocommerce\_product\_variation\_get\_sale\_price')) && $regular\_price == $discounted\_price ) ? '' : $discounted\_price; |
  |  | 251 | } |
  |  | 252 |  |
  |  | 253 | // Helper method to manage hooks |
  |  | 254 | public function manageHooks( $add) { |
  |  | 255 | global $xa\_hooks; |
  |  | 256 |  |
  |  | 257 | $action = $add ? 'add\_filter' : 'remove\_filter'; |
  |  | 258 | $priority = 22; |
  |  | 259 |  |
  |  | 260 | $filters = [ |
  |  | 261 | $xa\_hooks['woocommerce\_get\_price\_hook\_name'], |
  |  | 262 | $xa\_hooks['woocommerce\_get\_sale\_price\_hook\_name'], |
  |  | 263 | 'woocommerce\_product\_variation\_get\_price', |
  |  | 264 | 'woocommerce\_product\_variation\_get\_sale\_price' |
  |  | 265 | ]; |
  |  | 266 |  |
  |  | 267 | foreach ($filters as $filter) { |
  |  | 268 | $action($filter, [$this, 'elex\_dp\_getDiscountedPriceForProduct'], $priority, 2); |
  |  | 269 | } |
  |  | 270 | } |
  |  | 271 |  |
  |  | 272 | public function elex\_dp\_getDiscountedPriceHTML( $price, $product) { |
  | 389 | 273 | // hooked to get\_price\_html filter |
  | 390 | 274 | if ($product->is\_type('simple') || $product->is\_type('variation')) { |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-new-calculation-handler.php?rev=3046337#L398) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-new-calculation-handler.php?rev=3211131#L282) |  |
  | 398 | 282 | } |
  | 399 | 283 |  |
  | 400 |  | public function elex\_dp\_getDiscountedPriceHTML\_for\_simple\_product($price, $product) |
  | 401 |  | { |
  |  | 284 | public function elex\_dp\_getDiscountedPriceHTML\_for\_simple\_product( $price, $product) { |
  | 402 | 285 | // hooked to get\_price\_html filter |
  | 403 | 286 | return $price; |
  | 404 | 287 | } |
  | 405 | 288 |  |
  | 406 |  | public function elex\_dp\_getDiscountedPriceHTML\_for\_group\_product($price, $product) |
  | 407 |  | { |
  |  | 289 | public function elex\_dp\_getDiscountedPriceHTML\_for\_group\_product( $price, $product) { |
  | 408 | 290 | // hooked to get\_price\_html filter |
  | 409 | 291 | $tax\_display\_mode = get\_option('woocommerce\_tax\_display\_shop'); |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-new-calculation-handler.php?rev=3046337#L413) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-new-calculation-handler.php?rev=3211131#L295) |  |
  | 413 | 295 | $child = wc\_get\_product($child\_id); |
  | 414 | 296 | //$child\_prices[] = 'incl' === $tax\_display\_mode ? wc\_get\_price\_including\_tax($child) : wc\_get\_price\_excluding\_tax($child); |
  | 415 |  | if($child) { |
  |  | 297 | if ($child) { |
  | 416 | 298 | if ($child->is\_type('variable')) { |
  | 417 | 299 | $prices = $child->get\_variation\_prices(true); |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-new-calculation-handler.php?rev=3046337#L441) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-new-calculation-handler.php?rev=3211131#L323) |  |
  | 441 | 323 | if ('' !== $min\_price) { |
  | 442 | 324 | $price   = $min\_price !== $max\_price ? sprintf(\_x('%1$s&ndash;%2$s', 'Price range: from-to', 'woocommerce'), wc\_price($min\_price), wc\_price($max\_price)) : wc\_price($min\_price); |
  | 443 |  | $is\_free = (~~0 == $min\_price && 0 == $max\_price~~); |
  |  | 325 | $is\_free = ( 0 == $min\_price && 0 == $max\_price ); |
  | 444 | 326 |  |
  | 445 | 327 | if ($is\_free) { |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-new-calculation-handler.php?rev=3046337#L455) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-new-calculation-handler.php?rev=3211131#L337) |  |
  | 455 | 337 | } |
  | 456 | 338 |  |
  | 457 |  | public function elex\_dp\_getDiscountedPriceHTML\_for\_variable\_product($price, $product) |
  | 458 |  | { |
  |  | 339 | public function elex\_dp\_getDiscountedPriceHTML\_for\_variable\_product( $price, $product) { |
  | 459 | 340 | // hooked to get\_price\_html filter |
  | 460 | 341 | $prices               = array(); |
* ## [elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php](/changeset/3211131/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php "Show the changeset 3211131 restricted to elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php")

  | [r3183659](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L6 "Show revision 3183659 of this file in browser") | [r3211131](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L6 "Show revision 3211131 of this file in browser") |  |
  | --- | --- | --- |
  | 6 | 6 | \* @author Akshay |
  | 7 | 7 | \*/ |
  | 8 |  | class Elex\_RulesValidator |
  | 9 |  | { |
  |  | 8 | class Elex\_RulesValidator { |
  |  | 9 |  |
  | 10 | 10 |  |
  | 11 | 11 | public $execution\_mode      = 'first\_match'; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L22) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L22) |  |
  | 22 | 22 | \* @return array $valid\_rules |
  | 23 | 23 | \*/ |
  | 24 |  | function \_\_construct($mode = '', $for\_offers\_table = false, $only\_execute\_this\_mode = '') |
  | 25 |  | { |
  |  | 24 | function \_\_construct( $mode = '', $for\_offers\_table = false, $only\_execute\_this\_mode = '') { |
  | 26 | 25 | global $xa\_dp\_setting; |
  | 27 | 26 |  |
  | 28 | 27 | $this->for\_offers\_table = $for\_offers\_table; |
  | 29 | 28 | $this->execution\_mode   = empty($mode) ? $xa\_dp\_setting['mode'] : $mode; |
  | 30 |  | $this->execution\_order  = empty($only\_execute\_this\_mode) ? (isset($xa\_dp\_setting['execution\_order']) ? $xa\_dp\_setting['execution\_order'] : array( |
  |  | 29 | $this->execution\_order  = empty($only\_execute\_this\_mode) ? ( isset($xa\_dp\_setting['execution\_order']) ? $xa\_dp\_setting['execution\_order'] : array( |
  | 31 | 30 | 'product\_rules', |
  | 32 | 31 | 'category\_rules' |
  | 33 |  | )) : array($only\_execute\_this\_mode); |
  |  | 32 | ) ) : array($only\_execute\_this\_mode); |
  | 34 | 33 | } |
  | 35 | 34 | /\*\* |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L37) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L36) |  |
  | 37 | 36 | \*/ |
  | 38 | 37 |  |
  | 39 |  | public function elex\_dp\_getValidRulesForProduct($product, $pid = null, $current\_quantity = 1, $price = 0, $weight = 0) |
  | 40 |  | { |
  |  | 38 | public function elex\_dp\_getValidRulesForProduct( $product, $pid = null, $current\_quantity = 1, $price = 0, $weight = 0) { |
  | 41 | 39 | if (empty($pid)) { |
  | 42 | 40 | $pid = elex\_dp\_get\_pid($product); |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L58) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L56) |  |
  | 58 | 56 |  |
  | 59 | 57 |  |
  | 60 |  | function elex\_dp\_getFirstMatchedRule($product, $pid, $current\_quantity = 1, $price = 0, $weight = 0) |
  | 61 |  | { |
  |  | 58 | function elex\_dp\_getFirstMatchedRule( $product, $pid, $current\_quantity = 1, $price = 0, $weight = 0) { |
  | 62 | 59 | global $xa\_dp\_rules, $xa\_first\_match\_rule\_executed; |
  | 63 | 60 | //if(!$xa\_first\_match\_rule\_executed) |
  | 64 | 61 | { |
  | 65 |  | foreach ($this->execution\_order as $rule\_type) { |
  | 66 |  | $rules = !empty($xa\_dp\_rules[$rule\_type]) ? $xa\_dp\_rules[$rule\_type] : array(); |
  | 67 |  | foreach ($rules as $rule\_no => $rule) { |
  | 68 |  | //print\_r($rule\_type.'->'.$rule\_no." pid=".$pid); |
  | 69 |  | $rule['rule\_no']   = $rule\_no; |
  | 70 |  | $rule['rule\_type'] = $rule\_type; |
  | 71 |  | if ($this->elex\_dp\_checkRuleApplicableForProduct($rule, $rule\_type, $product, $pid, $current\_quantity, $price, $weight) === true) { |
  | 72 |  | if ($rule\_type == 'product\_rules') { |
  | 73 |  | $xa\_first\_match\_rule\_executed = true; |
  | 74 |  | } |
  | 75 |  | //error\_log('type='.$rule\_type.' ruleno='.$rule\_no.' pid='.$pid); |
  | 76 |  | return array($rule\_type . ':' . $rule\_no => $rule); |
  | 77 |  | } |
  | 78 |  | } |
  | 79 |  | } |
  |  | 62 | foreach ($this->execution\_order as $rule\_type) { |
  |  | 63 | $rules = !empty($xa\_dp\_rules[$rule\_type]) ? $xa\_dp\_rules[$rule\_type] : array(); |
  |  | 64 | foreach ($rules as $rule\_no => $rule) { |
  |  | 65 | //print\_r($rule\_type.'->'.$rule\_no." pid=".$pid); |
  |  | 66 | $rule['rule\_no']   = $rule\_no; |
  |  | 67 | $rule['rule\_type'] = $rule\_type; |
  |  | 68 | if ($this->elex\_dp\_checkRuleApplicableForProduct($rule, $rule\_type, $product, $pid, $current\_quantity, $price, $weight) === true) { |
  |  | 69 | if ($rule\_type == 'product\_rules') { |
  |  | 70 | $xa\_first\_match\_rule\_executed = true; |
  |  | 71 | } |
  |  | 72 | //error\_log('type='.$rule\_type.' ruleno='.$rule\_no.' pid='.$pid); |
  |  | 73 | return array($rule\_type . ':' . $rule\_no => $rule); |
  |  | 74 | } |
  |  | 75 | } |
  |  | 76 | } |
  | 80 | 77 | } |
  | 81 | 78 | return array(); |
  | 82 | 79 | } |
  | 83 | 80 |  |
  | 84 |  | function elex\_dp\_getAllMatchedRules($product, $pid, $current\_quantity = 1, $price = 0, $weight = 0) |
  | 85 |  | { |
  |  | 81 | function elex\_dp\_getAllMatchedRules( $product, $pid, $current\_quantity = 1, $price = 0, $weight = 0) { |
  | 86 | 82 | global $xa\_dp\_rules; |
  | 87 | 83 | $valid\_rules = array(); |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L104) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L100) |  |
  | 104 | 100 | } |
  | 105 | 101 |  |
  | 106 |  | function elex\_dp\_getBestMatchedRules($product, $pid, $current\_quantity = 1, $price = 0, $weight = 0) |
  | 107 |  | { |
  |  | 102 | function elex\_dp\_getBestMatchedRules( $product, $pid, $current\_quantity = 1, $price = 0, $weight = 0) { |
  | 108 | 103 | global $xa\_dp\_rules; |
  | 109 | 104 | $valid\_rules = array(); |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L129) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L124) |  |
  | 129 | 124 | } |
  | 130 | 125 |  |
  | 131 |  | public function elex\_dp\_checkRuleApplicableForProduct(&$rule = null, $rule\_type = '', $product = null, $pid = null, $current\_quantity = 1, $price = 0, $weight = 0) |
  | 132 |  | { |
  |  | 126 | public function elex\_dp\_checkRuleApplicableForProduct( &$rule = null, $rule\_type = '', $product = null, $pid = null, $current\_quantity = 1, $price = 0, $weight = 0) { |
  | 133 | 127 | if (apply\_filters('eha\_dp\_skip\_product', false, $pid, $rule, $rule\_type) != false) { |
  | 134 | 128 | return false; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L165) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L159) |  |
  | 165 | 159 | } |
  | 166 | 160 | global $customer; |
  | 167 |  | if ((~~!empty($rule['prev\_order\_count']) || !empty($rule['prev\_order\_total\_amt'])~~) && !empty($customer)) { |
  |  | 161 | if (( !empty($rule['prev\_order\_count']) || !empty($rule['prev\_order\_total\_amt']) ) && !empty($customer)) { |
  | 168 | 162 | $order\_count = elex\_dp\_is\_wc\_version\_gt\_eql('2.7') ? $customer->get\_order\_count() : wc\_get\_customer\_order\_count($customer->id); |
  | 169 | 163 | $total\_spent = elex\_dp\_is\_wc\_version\_gt\_eql('2.7') ? $customer->get\_total\_spent() : wc\_get\_customer\_total\_spent($customer->id); |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L189) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L183) |  |
  | 189 | 183 | } |
  | 190 | 184 |  |
  | 191 |  | function elex\_dp\_checkBOGO\_RuleApplicableForProduct(&$rule = null, $product = null, $pid = null, $current\_quantity = 1, $price = 0, $weight = 0) |
  | 192 |  | { |
  |  | 185 | function elex\_dp\_checkBOGO\_RuleApplicableForProduct( &$rule = null, $product = null, $pid = null, $current\_quantity = 1, $price = 0, $weight = 0) { |
  | 193 | 186 | $rule['purchased\_product\_id'] = elex\_dp\_WPML\_Compatible\_ids($rule['purchased\_product\_id'], 'product', true); |
  | 194 | 187 | $rule['free\_product\_id']      = elex\_dp\_WPML\_Compatible\_ids($rule['free\_product\_id'], 'product', true); |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L196) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L189) |  |
  | 196 | 189 |  |
  | 197 | 190 | //If free product is selected |
  | 198 |  | if (!isset($rule['set\_free\_option']) || (~~isset($rule['set\_free\_option']) && $rule['set\_free\_option'] == 'select\_product'~~)) { |
  |  | 191 | if (!isset($rule['set\_free\_option']) || ( isset($rule['set\_free\_option']) && $rule['set\_free\_option'] == 'select\_product' )) { |
  | 199 | 192 |  |
  | 200 | 193 | if (empty($rule['purchased\_product\_id']) || empty($rule['free\_product\_id'])) { |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L237) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L230) |  |
  | 237 | 230 | } |
  | 238 | 231 | } |
  | 239 |  | if ((~~in\_array($pid, array\_keys($rule['purchased\_product\_id'])) || in\_array($parent\_id, array\_keys($rule['purchased\_product\_id']))~~) || in\_array($pid, array\_keys($rule['free\_product\_id']))) { |
  |  | 232 | if (( in\_array($pid, array\_keys($rule['purchased\_product\_id'])) || in\_array($parent\_id, array\_keys($rule['purchased\_product\_id'])) ) || in\_array($pid, array\_keys($rule['free\_product\_id']))) { |
  | 240 | 233 | $dprice = 0; |
  | 241 | 234 | foreach ($rule['free\_product\_id'] as $\_pid => $\_qnty) { |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L246) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L239) |  |
  | 246 | 239 | } |
  | 247 | 240 | $\_product = wc\_get\_product( $\_pid ); |
  | 248 |  | if~~($\_product)~~{ |
  |  | 241 | if ($\_product) { |
  | 249 | 242 | $product\_price = $\_product->get\_price(); |
  | 250 | 243 | $price\_val = !empty($product\_price) ? $product\_price : 0; |
  | 251 |  | $dprice   += (~~$price\_val \* $\_qnty~~); |
  |  | 244 | $dprice   += ( $price\_val \* $\_qnty ); |
  | 252 | 245 | } |
  | 253 | 246 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L281) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L274) |  |
  | 281 | 274 | return false; |
  | 282 | 275 | } |
  | 283 |  | if (in\_array($pid, array\_keys($rule['purchased\_product\_id'])) && !(~~$current\_quantity > 1~~) ) { |
  |  | 276 | if (in\_array($pid, array\_keys($rule['purchased\_product\_id'])) && !( $current\_quantity > 1 ) ) { |
  | 284 | 277 | return false; |
  | 285 | 278 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L310) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L303) |  |
  | 310 | 303 | } |
  | 311 | 304 | ////////if free product is already in cart with exact quanitty this code will set its price as zero |
  | 312 |  | if ((~~in\_array($pid, array\_keys($rule['purchased\_product\_id'])) || in\_array($parent\_id, array\_keys($rule['purchased\_product\_id'])) || ($pid == $product\_tosetfree)~~)) { |
  |  | 305 | if (( in\_array($pid, array\_keys($rule['purchased\_product\_id'])) || in\_array($parent\_id, array\_keys($rule['purchased\_product\_id'])) || ( $pid == $product\_tosetfree ) )) { |
  | 313 | 306 | $dprice = 0; |
  | 314 |  | $dprice = $minvalue; |
  |  | 307 | $dprice = $minvalue; |
  | 315 | 308 | if ($this->execution\_mode == 'best\_discount') { |
  | 316 | 309 | $rule['calculated\_discount'] = $dprice;    //to check best descount rule |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L323) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L316) |  |
  | 323 | 316 | return $this->elex\_dp\_check\_date\_range\_and\_roles($rule, 'buy\_get\_free\_rules'); |
  | 324 | 317 | } |
  | 325 |  | function elex\_dp\_checkBOGO\_category\_RuleApplicableForProduct(&$rule = null, $product = null, $pid = null, $current\_quantity = 1, $price = 0, $weight = 0) |
  | 326 |  | { |
  |  | 318 | function elex\_dp\_checkBOGO\_category\_RuleApplicableForProduct( &$rule = null, $product = null, $pid = null, $current\_quantity = 1, $price = 0, $weight = 0) { |
  | 327 | 319 |  |
  | 328 | 320 | $rule['purchased\_category\_id'] = elex\_dp\_WPML\_Compatible\_ids($rule['purchased\_category\_id'], 'category', true); |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L332) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L324) |  |
  | 332 | 324 |  |
  | 333 | 325 | //If free product is selected |
  | 334 |  | if (!isset($rule['set\_free\_option']) || (~~isset($rule['set\_free\_option']) && $rule['set\_free\_option'] == 'select\_product'~~)) { |
  |  | 326 | if (!isset($rule['set\_free\_option']) || ( isset($rule['set\_free\_option']) && $rule['set\_free\_option'] == 'select\_product' )) { |
  | 335 | 327 |  |
  | 336 | 328 | if (empty($rule['purchased\_category\_id']) || empty($rule['free\_product\_id'])) { |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L349) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L341) |  |
  | 349 | 341 |  |
  | 350 | 342 | $tmp1 = array\_keys($rule['free\_product\_id']); |
  | 351 |  | if (in\_array($pid, $tmp1) && in\_array($\_cid, $product\_categories) && $xa\_dp\_setting['auto\_add\_free\_product\_on\_off'] != 'on' && !(~~$xa\_cart\_categories\_items[$\_cid] > 1~~) && $current\_quantity == 1) { |
  |  | 343 | if (in\_array($pid, $tmp1) && in\_array($\_cid, $product\_categories) && $xa\_dp\_setting['auto\_add\_free\_product\_on\_off'] != 'on' && !( $xa\_cart\_categories\_items[$\_cid] > 1 ) && $current\_quantity == 1) { |
  | 352 | 344 | $add\_if\_not\_auto = $add\_if\_not\_auto + 1; |
  | 353 | 345 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L355) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L347) |  |
  | 355 | 347 | $\_qnty   = !empty($tmp[0]) ? $tmp[0] : 0; |
  | 356 | 348 | $checkon = !empty($tmp[1]) ? $tmp[1] : 'items'; |
  | 357 |  | if ($checkon == 'items' && (~~!isset($xa\_cart\_categories\_items[$\_cid]) || $xa\_cart\_categories\_items[$\_cid] < ($\_qnty)~~)) { |
  |  | 349 | if ($checkon == 'items' && ( !isset($xa\_cart\_categories\_items[$\_cid]) || $xa\_cart\_categories\_items[$\_cid] < ( $\_qnty ) )) { |
  | 358 | 350 | return false; |
  | 359 |  | } elseif ($checkon == 'units' && (~~!isset($xa\_cart\_categories\_units[$\_cid]) || $xa\_cart\_categories\_units[$\_cid] < $\_qnty~~)) { |
  |  | 351 | } elseif ($checkon == 'units' && ( !isset($xa\_cart\_categories\_units[$\_cid]) || $xa\_cart\_categories\_units[$\_cid] < $\_qnty )) { |
  | 360 | 352 | return false; |
  | 361 | 353 | } |
  | 362 | 354 | } |
  | 363 |  | if~~($add\_if\_not\_auto > 0)~~{ |
  |  | 355 | if ($add\_if\_not\_auto > 0) { |
  | 364 | 356 | return false; |
  | 365 | 357 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L369) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L361) |  |
  | 369 | 361 | $product\_price = $\_product->get\_price(); |
  | 370 | 362 | $price\_val = !empty($product\_price) ? $product\_price : 0; |
  | 371 |  | $dprice   += (~~$price\_val \* $\_qnty~~); |
  |  | 363 | $dprice   += ( $price\_val \* $\_qnty ); |
  | 372 | 364 | } |
  | 373 | 365 | if ($this->execution\_mode == 'best\_discount') { |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L408) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L400) |  |
  | 408 | 400 | foreach ($rule['purchased\_category\_id'] as $\_cid => $\_qnty\_and\_checkon) { |
  | 409 | 401 |  |
  | 410 |  | if ((~~$pid == $product\_tosetfree) && in\_array($\_cid, $product\_categories) && !($xa\_cart\_categories\_items[$\_cid] > 1) && !($current\_quantity > 1~~)) { |
  |  | 402 | if (( $pid == $product\_tosetfree ) && in\_array($\_cid, $product\_categories) && !( $xa\_cart\_categories\_items[$\_cid] > 1 ) && !( $current\_quantity > 1 )) { |
  | 411 | 403 | $add\_if\_not\_auto = $add\_if\_not\_auto + 1; |
  | 412 | 404 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L414) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L406) |  |
  | 414 | 406 | $\_qnty   = !empty($tmp[0]) ? $tmp[0] : 0; |
  | 415 | 407 | $checkon = !empty($tmp[1]) ? $tmp[1] : 'items'; |
  | 416 |  | if ($checkon == 'items' && (~~!isset($xa\_cart\_categories\_items[$\_cid]) || $xa\_cart\_categories\_items[$\_cid] < ($\_qnty)~~)) { |
  |  | 408 | if ($checkon == 'items' && ( !isset($xa\_cart\_categories\_items[$\_cid]) || $xa\_cart\_categories\_items[$\_cid] < ( $\_qnty ) )) { |
  | 417 | 409 | return false; |
  | 418 |  | } elseif ($checkon == 'units' && (~~!isset($xa\_cart\_categories\_units[$\_cid]) || $xa\_cart\_categories\_units[$\_cid] < $\_qnty~~)) { |
  |  | 410 | } elseif ($checkon == 'units' && ( !isset($xa\_cart\_categories\_units[$\_cid]) || $xa\_cart\_categories\_units[$\_cid] < $\_qnty )) { |
  | 419 | 411 | return false; |
  | 420 | 412 | } |
  | 421 | 413 | } |
  | 422 |  | if~~($add\_if\_not\_auto > 0)~~{ |
  |  | 414 | if ($add\_if\_not\_auto > 0) { |
  | 423 | 415 | return false; |
  | 424 | 416 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L438) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L430) |  |
  | 438 | 430 | } |
  | 439 | 431 |  |
  | 440 |  | function elex\_dp\_checkbogo\_tag\_rulesApplicableForProduct(&$rule = null, $product = null, $pid = null, $current\_quantity = 1, $price = 0, $weight = 0) |
  | 441 |  | { |
  |  | 432 | function elex\_dp\_checkbogo\_tag\_rulesApplicableForProduct( &$rule = null, $product = null, $pid = null, $current\_quantity = 1, $price = 0, $weight = 0) { |
  | 442 | 433 |  |
  | 443 | 434 | $rule['purchased\_tag\_id'] = elex\_dp\_WPML\_Compatible\_ids($rule['purchased\_tag\_id'], 'tag', true); |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L446) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L437) |  |
  | 446 | 437 |  |
  | 447 | 438 | //If free product is selected |
  | 448 |  | if (!isset($rule['set\_free\_option']) || (~~isset($rule['set\_free\_option']) && $rule['set\_free\_option'] == 'select\_product'~~)) { |
  |  | 439 | if (!isset($rule['set\_free\_option']) || ( isset($rule['set\_free\_option']) && $rule['set\_free\_option'] == 'select\_product' )) { |
  | 449 | 440 |  |
  | 450 | 441 | if (empty($rule['purchased\_tag\_id']) || empty($rule['free\_product\_id'])) { |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L463) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L454) |  |
  | 463 | 454 |  |
  | 464 | 455 | $tmp1 = array\_keys($rule['free\_product\_id']); |
  | 465 |  | if (in\_array($pid, $tmp1) && in\_array($\_cid, $product\_tags) && $xa\_dp\_setting['auto\_add\_free\_product\_on\_off'] != 'on' && !(~~$xa\_cart\_tags\_items[$\_cid] > 1~~) && $current\_quantity == 1) { |
  |  | 456 | if (in\_array($pid, $tmp1) && in\_array($\_cid, $product\_tags) && $xa\_dp\_setting['auto\_add\_free\_product\_on\_off'] != 'on' && !( $xa\_cart\_tags\_items[$\_cid] > 1 ) && $current\_quantity == 1) { |
  | 466 | 457 | $add\_if\_not\_auto = $add\_if\_not\_auto + 1; |
  | 467 | 458 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L469) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L460) |  |
  | 469 | 460 | $\_qnty   = !empty($tmp[0]) ? $tmp[0] : 0; |
  | 470 | 461 | $checkon = !empty($tmp[1]) ? $tmp[1] : 'items'; |
  | 471 |  | if ($checkon == 'items' && (~~!isset($xa\_cart\_tags\_items[$\_cid]) || $xa\_cart\_tags\_items[$\_cid] < ($\_qnty)~~)) { |
  |  | 462 | if ($checkon == 'items' && ( !isset($xa\_cart\_tags\_items[$\_cid]) || $xa\_cart\_tags\_items[$\_cid] < ( $\_qnty ) )) { |
  | 472 | 463 | return false; |
  | 473 |  | } elseif ($checkon == 'units' && (~~!isset($xa\_cart\_tags\_units[$\_cid]) || $xa\_cart\_tags\_units[$\_cid] < $\_qnty~~)) { |
  |  | 464 | } elseif ($checkon == 'units' && ( !isset($xa\_cart\_tags\_units[$\_cid]) || $xa\_cart\_tags\_units[$\_cid] < $\_qnty )) { |
  | 474 | 465 | return false; |
  | 475 | 466 | } |
  | 476 | 467 | } |
  | 477 |  | if~~($add\_if\_not\_auto > 0)~~{ |
  |  | 468 | if ($add\_if\_not\_auto > 0) { |
  | 478 | 469 | return false; |
  | 479 | 470 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L483) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L474) |  |
  | 483 | 474 | $product\_price = $\_product->get\_price(); |
  | 484 | 475 | $price\_val = !empty($product\_price) ? $product\_price : 0; |
  | 485 |  | $dprice   += (~~$price\_val \* $\_qnty~~); |
  |  | 476 | $dprice   += ( $price\_val \* $\_qnty ); |
  | 486 | 477 | } |
  | 487 | 478 | if ($this->execution\_mode == 'best\_discount') { |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L519) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L510) |  |
  | 519 | 510 | foreach ($rule['purchased\_tag\_id'] as $\_cid => $\_qnty\_and\_checkon) { |
  | 520 | 511 |  |
  | 521 |  | if ((~~$pid == $product\_tosetfree) && in\_array($\_cid, $product\_tags) && !($xa\_cart\_tags\_items[$\_cid] > 1) && !($current\_quantity > 1~~)) { |
  |  | 512 | if (( $pid == $product\_tosetfree ) && in\_array($\_cid, $product\_tags) && !( $xa\_cart\_tags\_items[$\_cid] > 1 ) && !( $current\_quantity > 1 )) { |
  | 522 | 513 | $add\_if\_not\_auto = $add\_if\_not\_auto + 1; |
  | 523 | 514 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L525) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L516) |  |
  | 525 | 516 | $\_qnty   = !empty($tmp[0]) ? $tmp[0] : 0; |
  | 526 | 517 | $checkon = !empty($tmp[1]) ? $tmp[1] : 'items'; |
  | 527 |  | if ($checkon == 'items' && (~~!isset($xa\_cart\_tags\_items[$\_cid]) || $xa\_cart\_tags\_items[$\_cid] < ($\_qnty)~~)) { |
  |  | 518 | if ($checkon == 'items' && ( !isset($xa\_cart\_tags\_items[$\_cid]) || $xa\_cart\_tags\_items[$\_cid] < ( $\_qnty ) )) { |
  | 528 | 519 | return false; |
  | 529 |  | } elseif ($checkon == 'units' && (~~!isset($xa\_cart\_tags\_units[$\_cid]) || $xa\_cart\_tags\_units[$\_cid] < $\_qnty~~)) { |
  |  | 520 | } elseif ($checkon == 'units' && ( !isset($xa\_cart\_tags\_units[$\_cid]) || $xa\_cart\_tags\_units[$\_cid] < $\_qnty )) { |
  | 530 | 521 | return false; |
  | 531 | 522 | } |
  | 532 | 523 | } |
  | 533 |  | if~~($add\_if\_not\_auto > 0)~~{ |
  |  | 524 | if ($add\_if\_not\_auto > 0) { |
  | 534 | 525 | return false; |
  | 535 | 526 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L549) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L540) |  |
  | 549 | 540 | } |
  | 550 | 541 |  |
  | 551 |  | function elex\_dp\_checkCategoryCombinationalRuleApplicableForProduct(&$rule = null, $product = null, $pid = null, $current\_quantity = 1, $price = 0, $weight = 0) |
  | 552 |  | { |
  |  | 542 | function elex\_dp\_checkCategoryCombinationalRuleApplicableForProduct( &$rule = null, $product = null, $pid = null, $current\_quantity = 1, $price = 0, $weight = 0) { |
  | 553 | 543 |  |
  | 554 | 544 | global $xa\_cart\_quantities; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L594) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L584) |  |
  | 594 | 584 | $\_product = wc\_get\_product($pid); |
  | 595 | 585 | $old\_price = $\_product->get\_price(); |
  | 596 |  | $rule['calculated\_discount'] = (~~(float)$old\_price - (float)$new\_price~~) \* $current\_quantity; |
  |  | 586 | $rule['calculated\_discount'] = ( (float) $old\_price - (float) $new\_price ) \* $current\_quantity; |
  | 597 | 587 | } |
  | 598 | 588 | //checking roles and tofrom date for which rule is applicable |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L600) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L590) |  |
  | 600 | 590 | } |
  | 601 | 591 |  |
  | 602 |  | function elex\_dp\_checkCategoryRuleApplicableForProduct(&$rule = null, $product = null, $pid = null, $current\_quantity = 1, $price = 0, $weight = 0) |
  | 603 |  | { |
  |  | 592 | function elex\_dp\_checkCategoryRuleApplicableForProduct( &$rule = null, $product = null, $pid = null, $current\_quantity = 1, $price = 0, $weight = 0) { |
  | 604 | 593 |  |
  | 605 | 594 | global $xa\_cart\_quantities; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L607) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L596) |  |
  | 607 | 596 | global $xa\_cart\_price; |
  | 608 | 597 | global $xa\_cart\_categories; |
  | 609 |  | $min = (~~empty($rule['min']) == true~~) ? 1 : $rule['min']; |
  | 610 |  | $max = (~~empty($rule['max']) == true~~) ? 999999999 : $rule['max']; |
  |  | 598 | $min = ( empty($rule['min']) == true ) ? 1 : $rule['min']; |
  |  | 599 | $max = ( empty($rule['max']) == true ) ? 999999999 : $rule['max']; |
  | 611 | 600 |  |
  | 612 | 601 | if ($max < $min && $max != 0) { |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L656) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L645) |  |
  | 656 | 645 | } |
  | 657 | 646 | if (!empty($xa\_cart\_weight[$\_pid])) { |
  | 658 |  | $total\_weight\_of\_this\_category += (float) (~~$qnty \* $xa\_cart\_weight[$\_pid]~~); |
  |  | 647 | $total\_weight\_of\_this\_category += (float) ( $qnty \* $xa\_cart\_weight[$\_pid] ); |
  | 659 | 648 | } |
  | 660 | 649 | if (!empty($xa\_cart\_price[$\_pid])) { |
  | 661 |  | $total\_price\_of\_this\_category += (float) (~~$qnty \* $xa\_cart\_price[$\_pid]~~); |
  |  | 650 | $total\_price\_of\_this\_category += (float) ( $qnty \* $xa\_cart\_price[$\_pid] ); |
  | 662 | 651 | } |
  | 663 | 652 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L672) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L661) |  |
  | 672 | 661 | //error\_log('total units=' . $total\_all\_units\_of\_this\_category\_in\_cart . " total items=" . $total\_items\_of\_this\_category\_in\_cart); |
  | 673 | 662 | //error\_log('total price=' . $total\_price\_of\_this\_category . " total weights=" . $total\_weight\_of\_this\_category); |
  | 674 |  | if ($rule['check\_on'] == 'TotalQuantity' && (~~$total\_all\_units\_of\_this\_category\_in\_cart < $min || $total\_all\_units\_of\_this\_category\_in\_cart > $max || empty($total\_all\_units\_of\_this\_category\_in\_cart)~~)) { |
  | 675 |  | return false; |
  | 676 |  | } elseif ($rule['check\_on'] == 'Quantity' && (~~$total\_items\_of\_this\_category\_in\_cart < $min || $total\_items\_of\_this\_category\_in\_cart > $max || empty($total\_items\_of\_this\_category\_in\_cart)~~)) { |
  | 677 |  | return false; |
  | 678 |  | } elseif ($rule['check\_on'] == 'Weight' && (~~$total\_weight\_of\_this\_category < $min || $total\_weight\_of\_this\_category > $max || empty($total\_weight\_of\_this\_category)~~)) { |
  | 679 |  | return false; |
  | 680 |  | } elseif ($rule['check\_on'] == 'Price' && (~~$total\_price\_of\_this\_category < $min || $total\_price\_of\_this\_category > $max || empty($total\_price\_of\_this\_category)~~)) { |
  |  | 663 | if ($rule['check\_on'] == 'TotalQuantity' && ( $total\_all\_units\_of\_this\_category\_in\_cart < $min || $total\_all\_units\_of\_this\_category\_in\_cart > $max || empty($total\_all\_units\_of\_this\_category\_in\_cart) )) { |
  |  | 664 | return false; |
  |  | 665 | } elseif ($rule['check\_on'] == 'Quantity' && ( $total\_items\_of\_this\_category\_in\_cart < $min || $total\_items\_of\_this\_category\_in\_cart > $max || empty($total\_items\_of\_this\_category\_in\_cart) )) { |
  |  | 666 | return false; |
  |  | 667 | } elseif ($rule['check\_on'] == 'Weight' && ( $total\_weight\_of\_this\_category < $min || $total\_weight\_of\_this\_category > $max || empty($total\_weight\_of\_this\_category) )) { |
  |  | 668 | return false; |
  |  | 669 | } elseif ($rule['check\_on'] == 'Price' && ( $total\_price\_of\_this\_category < $min || $total\_price\_of\_this\_category > $max || empty($total\_price\_of\_this\_category) )) { |
  | 681 | 670 | return false; |
  | 682 | 671 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L687) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L676) |  |
  | 687 | 676 | $\_product = wc\_get\_product($pid); |
  | 688 | 677 | $old\_price = $\_product->get\_price(); |
  | 689 |  | $rule['calculated\_discount'] = (~~(float)$old\_price - (float)$new\_price~~) \* $current\_quantity; |
  |  | 678 | $rule['calculated\_discount'] = ( (float) $old\_price - (float) $new\_price ) \* $current\_quantity; |
  | 690 | 679 | } |
  | 691 | 680 |  |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L694) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L683) |  |
  | 694 | 683 | } |
  | 695 | 684 |  |
  | 696 |  | function elex\_dp\_checkTagRuleApplicableForProduct(&$rule = null, $product = null, $pid = null, $current\_quantity = 1, $price = 0, $weight = 0) |
  | 697 |  | { |
  |  | 685 | function elex\_dp\_checkTagRuleApplicableForProduct( &$rule = null, $product = null, $pid = null, $current\_quantity = 1, $price = 0, $weight = 0) { |
  | 698 | 686 |  |
  | 699 | 687 | global $xa\_cart\_quantities; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L701) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L689) |  |
  | 701 | 689 | global $xa\_cart\_price; |
  | 702 | 690 | global $xa\_cart\_tags; |
  | 703 |  | $min = (~~empty($rule['min']) == true~~) ? 1 : $rule['min']; |
  | 704 |  | $max = (~~empty($rule['max']) == true~~) ? 999999999 : $rule['max']; |
  |  | 691 | $min = ( empty($rule['min']) == true ) ? 1 : $rule['min']; |
  |  | 692 | $max = ( empty($rule['max']) == true ) ? 999999999 : $rule['max']; |
  | 705 | 693 |  |
  | 706 | 694 | if ($max < $min && $max != 0) { |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L750) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L738) |  |
  | 750 | 738 | } |
  | 751 | 739 | if (!empty($xa\_cart\_weight[$\_pid])) { |
  | 752 |  | $total\_weight\_of\_this\_tag += (int) (~~$qnty \* $xa\_cart\_weight[$\_pid]~~); |
  |  | 740 | $total\_weight\_of\_this\_tag += (int) ( $qnty \* $xa\_cart\_weight[$\_pid] ); |
  | 753 | 741 | } |
  | 754 | 742 | if (!empty($xa\_cart\_price[$\_pid])) { |
  | 755 |  | $total\_price\_of\_this\_tag += (int) (~~$qnty \* $xa\_cart\_price[$\_pid]~~); |
  |  | 743 | $total\_price\_of\_this\_tag += (int) ( $qnty \* $xa\_cart\_price[$\_pid] ); |
  | 756 | 744 | } |
  | 757 | 745 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L766) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L754) |  |
  | 766 | 754 | //error\_log('total units=' . $total\_all\_units\_of\_this\_tag\_in\_cart . " total items=" . $total\_items\_of\_this\_tag\_in\_cart); |
  | 767 | 755 | //error\_log('total price=' . $total\_price\_of\_this\_tag . " total weights=" . $total\_weight\_of\_this\_tag); |
  | 768 |  | if ($rule['check\_on'] == 'TotalQuantity' && (~~$total\_all\_units\_of\_this\_tag\_in\_cart < $min || $total\_all\_units\_of\_this\_tag\_in\_cart > $max || empty($total\_all\_units\_of\_this\_tag\_in\_cart)~~)) { |
  | 769 |  | return false; |
  | 770 |  | } elseif ($rule['check\_on'] == 'Quantity' && (~~$total\_items\_of\_this\_tag\_in\_cart < $min || $total\_items\_of\_this\_tag\_in\_cart > $max || empty($total\_items\_of\_this\_tag\_in\_cart)~~)) { |
  | 771 |  | return false; |
  | 772 |  | } elseif ($rule['check\_on'] == 'Weight' && (~~$total\_weight\_of\_this\_tag < $min || $total\_weight\_of\_this\_tag > $max || empty($total\_weight\_of\_this\_tag)~~)) { |
  | 773 |  | return false; |
  | 774 |  | } elseif ($rule['check\_on'] == 'Price' && (~~$total\_price\_of\_this\_tag < $min || $total\_price\_of\_this\_tag > $max || empty($total\_price\_of\_this\_tag)~~)) { |
  |  | 756 | if ($rule['check\_on'] == 'TotalQuantity' && ( $total\_all\_units\_of\_this\_tag\_in\_cart < $min || $total\_all\_units\_of\_this\_tag\_in\_cart > $max || empty($total\_all\_units\_of\_this\_tag\_in\_cart) )) { |
  |  | 757 | return false; |
  |  | 758 | } elseif ($rule['check\_on'] == 'Quantity' && ( $total\_items\_of\_this\_tag\_in\_cart < $min || $total\_items\_of\_this\_tag\_in\_cart > $max || empty($total\_items\_of\_this\_tag\_in\_cart) )) { |
  |  | 759 | return false; |
  |  | 760 | } elseif ($rule['check\_on'] == 'Weight' && ( $total\_weight\_of\_this\_tag < $min || $total\_weight\_of\_this\_tag > $max || empty($total\_weight\_of\_this\_tag) )) { |
  |  | 761 | return false; |
  |  | 762 | } elseif ($rule['check\_on'] == 'Price' && ( $total\_price\_of\_this\_tag < $min || $total\_price\_of\_this\_tag > $max || empty($total\_price\_of\_this\_tag) )) { |
  | 775 | 763 | return false; |
  | 776 | 764 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L781) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L769) |  |
  | 781 | 769 | $\_product = wc\_get\_product($pid); |
  | 782 | 770 | $old\_price = $\_product->get\_price(); |
  | 783 |  | $rule['calculated\_discount'] = (~~(float)$old\_price - (float)$new\_price~~) \* $current\_quantity; |
  |  | 771 | $rule['calculated\_discount'] = ( (float) $old\_price - (float) $new\_price ) \* $current\_quantity; |
  | 784 | 772 | } |
  | 785 | 773 |  |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L788) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L776) |  |
  | 788 | 776 | } |
  | 789 | 777 |  |
  | 790 |  | function elex\_dp\_checkCartRuleApplicableForProduct(&$rule = null, $product = null, $pid = null, $current\_quantity = 1, $price = 0, $weight = 0) |
  | 791 |  | { |
  |  | 778 | function elex\_dp\_checkCartRuleApplicableForProduct( &$rule = null, $product = null, $pid = null, $current\_quantity = 1, $price = 0, $weight = 0) { |
  | 792 | 779 |  |
  | 793 | 780 | global $xa\_cart\_quantities; |
  | 794 | 781 | global $xa\_cart\_weight; |
  | 795 | 782 | global $xa\_cart\_price; |
  | 796 |  | $min  = (~~empty($rule['min']) == true~~) ? 1 : $rule['min']; |
  | 797 |  | $max  = (~~empty($rule['max']) == true~~) ? 999999999 : $rule['max']; |
  |  | 783 | $min  = ( empty($rule['min']) == true ) ? 1 : $rule['min']; |
  |  | 784 | $max  = ( empty($rule['max']) == true ) ? 999999999 : $rule['max']; |
  | 798 | 785 | $attr = $product->get\_attributes(); |
  | 799 | 786 | $attribute\_data = array(); |
  | 800 | 787 | foreach ($attr as $attribute\_name => $attribute) { |
  | 801 |  | if(is\_object($attribute)) { |
  |  | 788 | if (is\_object($attribute)) { |
  | 802 | 789 | $attribute\_values = $attribute->get\_options(); |
  | 803 | 790 |  |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L812) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L799) |  |
  | 812 | 799 | $attribute\_data[$attribute\_name] = $term\_slugs; |
  | 813 | 800 | } |
  | 814 |  | }~~else if(is\_string($attribute))~~{ |
  | 815 |  | $attribute\_data[$attribute\_name] = (array)$attribute; |
  |  | 801 | } else if (is\_string($attribute)) { |
  |  | 802 | $attribute\_data[$attribute\_name] = (array) $attribute; |
  | 816 | 803 |  |
  | 817 | 804 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L881) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L868) |  |
  | 881 | 868 | //if pid is selected in this rule |
  | 882 | 869 |  |
  | 883 |  | if (is\_cart() && (~~empty($pid) || !in\_array($pid, array\_keys($xa\_cart\_quantities))~~)) { |
  |  | 870 | if (is\_cart() && ( empty($pid) || !in\_array($pid, array\_keys($xa\_cart\_quantities)) )) { |
  | 884 | 871 | return false; |
  | 885 | 872 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L903) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L890) |  |
  | 903 | 890 | $total\_all\_units\_in\_cart += $\_qnty; |
  | 904 | 891 | if (!empty($xa\_cart\_weight[$\_pid])) { |
  | 905 |  | $total\_weight\_in\_cart += (~~$\_qnty \* $xa\_cart\_weight[$\_pid]~~); |
  |  | 892 | $total\_weight\_in\_cart += ( $\_qnty \* $xa\_cart\_weight[$\_pid] ); |
  | 906 | 893 | } |
  | 907 | 894 | if (!empty($xa\_cart\_price[$\_pid])) { |
  | 908 |  | $total\_price\_in\_cart += (~~$\_qnty \* $xa\_cart\_price[$\_pid]~~); |
  |  | 895 | $total\_price\_in\_cart += ( $\_qnty \* $xa\_cart\_price[$\_pid] ); |
  | 909 | 896 | } |
  | 910 | 897 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L912) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L899) |  |
  | 912 | 899 | //error\_log('total units=' . $total\_all\_units\_of\_this\_category\_in\_cart . " total items=" . $total\_items\_of\_this\_category\_in\_cart); |
  | 913 | 900 | //error\_log('total price=' . $total\_price\_of\_this\_category . " total weights=" . $total\_weight\_of\_this\_category); |
  | 914 |  | if ($rule['check\_on'] == 'TotalQuantity' && (~~$total\_all\_units\_in\_cart < $min || $total\_all\_units\_in\_cart > $max || empty($total\_all\_units\_in\_cart)~~)) { |
  | 915 |  | return false; |
  | 916 |  | } elseif ($rule['check\_on'] == 'Quantity' && (~~$total\_items\_in\_cart < $min || $total\_items\_in\_cart > $max || empty($total\_items\_in\_cart)~~)) { |
  | 917 |  | return false; |
  | 918 |  | } elseif ($rule['check\_on'] == 'Weight' && (~~$total\_weight\_in\_cart < $min || $total\_weight\_in\_cart > $max || empty($total\_weight\_in\_cart)~~)) { |
  | 919 |  | return false; |
  | 920 |  | } elseif ($rule['check\_on'] == 'Price' && (~~$total\_price\_in\_cart < $min || $total\_price\_in\_cart > $max || empty($total\_price\_in\_cart)~~)) { |
  |  | 901 | if ($rule['check\_on'] == 'TotalQuantity' && ( $total\_all\_units\_in\_cart < $min || $total\_all\_units\_in\_cart > $max || empty($total\_all\_units\_in\_cart) )) { |
  |  | 902 | return false; |
  |  | 903 | } elseif ($rule['check\_on'] == 'Quantity' && ( $total\_items\_in\_cart < $min || $total\_items\_in\_cart > $max || empty($total\_items\_in\_cart) )) { |
  |  | 904 | return false; |
  |  | 905 | } elseif ($rule['check\_on'] == 'Weight' && ( $total\_weight\_in\_cart < $min || $total\_weight\_in\_cart > $max || empty($total\_weight\_in\_cart) )) { |
  |  | 906 | return false; |
  |  | 907 | } elseif ($rule['check\_on'] == 'Price' && ( $total\_price\_in\_cart < $min || $total\_price\_in\_cart > $max || empty($total\_price\_in\_cart) )) { |
  | 921 | 908 | return false; |
  | 922 | 909 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L928) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L915) |  |
  | 928 | 915 | $\_product = wc\_get\_product($pid); |
  | 929 | 916 | $old\_price = $\_product->get\_price(); |
  | 930 |  | $rule['calculated\_discount'] = (~~(float)$old\_price - (float)$new\_price~~) \* $current\_quantity; |
  |  | 917 | $rule['calculated\_discount'] = ( (float) $old\_price - (float) $new\_price ) \* $current\_quantity; |
  | 931 | 918 | } |
  | 932 | 919 | //checking roles and tofrom date for which rule is applicable |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L934) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L921) |  |
  | 934 | 921 | } |
  | 935 | 922 |  |
  | 936 |  | function elex\_dp\_checkCombinationalRuleApplicableForProduct(&$rule = null, $product = null, $pid = null, $current\_quantity = 1, $price = 0, $weight = 0) |
  | 937 |  | { |
  |  | 923 | function elex\_dp\_checkCombinationalRuleApplicableForProduct( &$rule = null, $product = null, $pid = null, $current\_quantity = 1, $price = 0, $weight = 0) { |
  | 938 | 924 | global $xa\_cart\_quantities; |
  | 939 | 925 | $total\_units        = 0; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L965) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L951) |  |
  | 965 | 951 | } |
  | 966 | 952 | } |
  | 967 |  | if ((~~empty($xa\_cart\_quantities[$\_pid]) || $xa\_cart\_quantities[$\_pid] < $\_qnty) && ($total\_child\_qty == 0 || $total\_child\_qty < $\_qnty~~)) { |
  |  | 953 | if (( empty($xa\_cart\_quantities[$\_pid]) || $xa\_cart\_quantities[$\_pid] < $\_qnty ) && ( $total\_child\_qty == 0 || $total\_child\_qty < $\_qnty )) { |
  | 968 | 954 | if ($\_pid != $check\_for\_pid || empty($xa\_cart\_quantities[$pid]) || $xa\_cart\_quantities[$pid] < $\_qnty) { //code to consider parent id of variable products |
  | 969 | 955 | return false; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L976) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L962) |  |
  | 976 | 962 | } |
  | 977 | 963 | $rule['discount\_on\_product\_id'] = elex\_dp\_WPML\_Compatible\_ids($rule['discount\_on\_product\_id']); |
  | 978 |  | if (!empty($rule['discount\_on\_product\_id']) && is\_array($rule['discount\_on\_product\_id']) && (~~!in\_array($pid, $rule['discount\_on\_product\_id']) && !in\_array($product->get\_parent\_id(), $rule['discount\_on\_product\_id'])~~)) { |
  |  | 964 | if (!empty($rule['discount\_on\_product\_id']) && is\_array($rule['discount\_on\_product\_id']) && ( !in\_array($pid, $rule['discount\_on\_product\_id']) && !in\_array($product->get\_parent\_id(), $rule['discount\_on\_product\_id']) )) { |
  | 979 | 965 | return false; |
  | 980 | 966 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L985) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L971) |  |
  | 985 | 971 | $\_product = wc\_get\_product($pid); |
  | 986 | 972 | $old\_price = $\_product->get\_price(); |
  | 987 |  | $rule['calculated\_discount'] = (~~(float)$old\_price - (float)$new\_price~~) \* $current\_quantity; |
  |  | 973 | $rule['calculated\_discount'] = ( (float) $old\_price - (float) $new\_price ) \* $current\_quantity; |
  | 988 | 974 | } |
  | 989 | 975 | //checking roles and tofrom date for which rule is applicable |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L991) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L977) |  |
  | 991 | 977 | } |
  | 992 | 978 |  |
  | 993 |  | function elex\_dp\_checkProductRuleApplicableForProduct(&$rule = null, $product = null, $pid = null, $current\_quantity = 1, $price = 0, $weight = 0) |
  | 994 |  | { |
  |  | 979 | function elex\_dp\_checkProductRuleApplicableForProduct( &$rule = null, $product = null, $pid = null, $current\_quantity = 1, $price = 0, $weight = 0) { |
  | 995 | 980 | global $xa\_cart\_categories; |
  | 996 | 981 | global $xa\_cart\_quantities; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1000) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L985) |  |
  | 1000 | 985 | $pid = elex\_dp\_get\_pid($product); |
  | 1001 | 986 | } |
  | 1002 |  | $min          = (~~empty($rule['min']) == true~~) ? 1 : $rule['min']; |
  | 1003 |  | $max          = (~~empty($rule['max']) == true~~) ? 999999999 : $rule['max']; |
  | 1004 |  | $total\_price  = !empty($price) ? (~~$price \* $current\_quantity~~) : 0; |
  | 1005 |  | $total\_weight = !empty($weight) ? (~~(float)$weight \* $current\_quantity~~) : 0; |
  |  | 987 | $min          = ( empty($rule['min']) == true ) ? 1 : $rule['min']; |
  |  | 988 | $max          = ( empty($rule['max']) == true ) ? 999999999 : $rule['max']; |
  |  | 989 | $total\_price  = !empty($price) ? ( $price \* $current\_quantity ) : 0; |
  |  | 990 | $total\_weight = !empty($weight) ? ( (float) $weight \* $current\_quantity ) : 0; |
  | 1006 | 991 | if ($max < $min && $max != 0) { |
  | 1007 | 992 | return false; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1040) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L1025) |  |
  | 1040 | 1025 | if ($rule['rule\_on'] == 'products') { |
  | 1041 | 1026 | $pids = elex\_dp\_WPML\_Compatible\_ids($rule['product\_id']); |
  | 1042 |  | if (empty($pids) || (~~!is\_array($pids) || (!in\_array($check\_for\_pid, $pids) && !in\_array($pid, $pids))~~)) { |
  |  | 1027 | if (empty($pids) || ( !is\_array($pids) || ( !in\_array($check\_for\_pid, $pids) && !in\_array($pid, $pids) ) )) { |
  | 1043 | 1028 | return false; |
  | 1044 | 1029 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1074) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L1059) |  |
  | 1074 | 1059 | if ($rule['check\_on'] == 'Quantity') { |
  | 1075 | 1060 |  |
  | 1076 |  | if (is\_cart() && (~~empty($pid) || !in\_array($pid, array\_keys($xa\_cart\_quantities))~~)) { |
  |  | 1061 | if (is\_cart() && ( empty($pid) || !in\_array($pid, array\_keys($xa\_cart\_quantities)) )) { |
  | 1077 | 1062 | return false; |
  | 1078 | 1063 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1095) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L1080) |  |
  | 1095 | 1080 | foreach ($xa\_cart\_quantities as $\_pid => $\_qnty) { |
  | 1096 | 1081 | $total\_items\_in\_cart++; |
  | 1097 |  | if~~($pids && in\_array($\_pid, $pids))~~{ |
  |  | 1082 | if ($pids && in\_array($\_pid, $pids)) { |
  | 1098 | 1083 | $total\_all\_product\_items++; |
  | 1099 | 1084 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1102) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L1087) |  |
  | 1102 | 1087 |  |
  | 1103 | 1088 | //Conditions for different rule type |
  | 1104 |  | if ('products' === $rule['rule\_on'] && in\_array($pid, $rule\_product\_ids) && (~~$total\_all\_product\_items < $min || ($total\_all\_product\_items > $max && $repeat == false) || empty($total\_all\_product\_items)~~)) { |
  | 1105 |  | return false; |
  |  | 1089 | if ('products' === $rule['rule\_on'] && in\_array($pid, $rule\_product\_ids) && ( $total\_all\_product\_items < $min || ( $total\_all\_product\_items > $max && $repeat == false ) || empty($total\_all\_product\_items) )) { |
  |  | 1090 | return false; |
  | 1106 | 1091 |  |
  | 1107 |  | }else if ('categories' === $rule['rule\_on'] && $this->validate\_product\_matches\_categories(wc\_get\_product($pid), $rule)) { |
  |  | 1092 | } else if ('categories' === $rule['rule\_on'] && $this->validate\_product\_matches\_categories(wc\_get\_product($pid), $rule)) { |
  | 1108 | 1093 | $tmp=elex\_dp\_get\_category\_ids($pid); |
  | 1109 | 1094 | $product\_categories=!empty($tmp)?$tmp:array(); |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1113) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L1098) |  |
  | 1113 | 1098 | } |
  | 1114 | 1099 | foreach ($xa\_cart\_categories as $\_pid => $\_categories) { |
  | 1115 |  | $match=array\_intersect($matched,$\_categories); |
  |  | 1100 | $match=array\_intersect($matched, $\_categories); |
  | 1116 | 1101 | if (!empty($match)) { |
  | 1117 | 1102 | $total\_items\_of\_this\_category\_in\_cart++; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1126) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L1111) |  |
  | 1126 | 1111 | $total\_all\_units\_of\_this\_category\_in\_cart = 1; |
  | 1127 | 1112 | } |
  | 1128 |  | if~~($total\_items\_of\_this\_category\_in\_cart < $min || (($total\_items\_of\_this\_category\_in\_cart > $max && $repeat == false)) || empty($total\_items\_of\_this\_category\_in\_cart))~~{ |
  | 1129 |  | return false; |
  | 1130 |  | } |
  | 1131 |  |  |
  | 1132 |  | }~~else if (('cart' === $rule['rule\_on'])  && ($total\_items\_in\_cart < $min || (($total\_items\_in\_cart > $max && $repeat == false)) || empty($total\_items\_in\_cart)~~)) { |
  | 1133 |  | return false; |
  | 1134 |  | } |
  | 1135 |  | } elseif ($rule['check\_on'] == 'Weight' && (~~$total\_weight < $min || ($total\_weight > $max && $repeat == false) || empty($total\_weight)~~)) { |
  | 1136 |  | return false; |
  | 1137 |  | } elseif ($rule['check\_on'] == 'Price' && (~~$total\_price < $min || ($total\_price > $max && $repeat == false) || empty($total\_price)~~)) { |
  | 1138 |  | return false; |
  | 1139 |  | } elseif ($rule['check\_on'] == 'Units' && (~~$current\_quantity < $min || ($current\_quantity > $max && $repeat == false)~~)) { |
  |  | 1113 | if ($total\_items\_of\_this\_category\_in\_cart < $min || ( ( $total\_items\_of\_this\_category\_in\_cart > $max && $repeat == false ) ) || empty($total\_items\_of\_this\_category\_in\_cart)) { |
  |  | 1114 | return false; |
  |  | 1115 | } |
  |  | 1116 |  |
  |  | 1117 | } else if (( 'cart' === $rule['rule\_on'] )  && ( $total\_items\_in\_cart < $min || ( ( $total\_items\_in\_cart > $max && $repeat == false ) ) || empty($total\_items\_in\_cart) )) { |
  |  | 1118 | return false; |
  |  | 1119 | } |
  |  | 1120 | } elseif ($rule['check\_on'] == 'Weight' && ( $total\_weight < $min || ( $total\_weight > $max && $repeat == false ) || empty($total\_weight) )) { |
  |  | 1121 | return false; |
  |  | 1122 | } elseif ($rule['check\_on'] == 'Price' && ( $total\_price < $min || ( $total\_price > $max && $repeat == false ) || empty($total\_price) )) { |
  |  | 1123 | return false; |
  |  | 1124 | } elseif ($rule['check\_on'] == 'Units' && ( $current\_quantity < $min || ( $current\_quantity > $max && $repeat == false ) )) { |
  | 1140 | 1125 | return false; |
  | 1141 | 1126 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1147) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L1132) |  |
  | 1147 | 1132 | $\_product = wc\_get\_product($pid); |
  | 1148 | 1133 | $old\_price = $\_product->get\_price(); |
  | 1149 |  | $rule['calculated\_discount'] = (~~(float)$old\_price - (float)$new\_price~~) \* $current\_quantity; |
  |  | 1134 | $rule['calculated\_discount'] = ( (float) $old\_price - (float) $new\_price ) \* $current\_quantity; |
  | 1150 | 1135 | } |
  | 1151 | 1136 | //checking roles and tofrom date for which rule is applicable |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1153) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L1138) |  |
  | 1153 | 1138 | } |
  | 1154 | 1139 |  |
  | 1155 |  | function elex\_dp\_check\_date\_range\_and\_roles($rule, $rule\_type) |
  | 1156 |  | { |
  |  | 1140 | function elex\_dp\_check\_date\_range\_and\_roles( $rule, $rule\_type) { |
  | 1157 | 1141 | $fromdate   = $rule['from\_date']; |
  | 1158 | 1142 | $todate     = $rule['to\_date']; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1180) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L1164) |  |
  | 1180 | 1164 | $match = array\_intersect((array) $user\_roles, (array) $current\_user->roles); |
  | 1181 | 1165 | if (!in\_array('all', $user\_roles) && empty($match) && !empty($user\_roles)) { |
  | 1182 |  | if (!(~~in\_array('guest\_user', $user\_roles) && !is\_user\_logged\_in()~~)) { |
  |  | 1166 | if (!( in\_array('guest\_user', $user\_roles) && !is\_user\_logged\_in() )) { |
  | 1183 | 1167 | return false; |
  | 1184 | 1168 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1186) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L1170) |  |
  | 1186 | 1170 |  |
  | 1187 | 1171 | $now = current\_time('d-m-Y'); |
  | 1188 |  | if ((~~empty($fromdate) && empty($todate)) || (empty($fromdate) && empty($todate) == false && (strtotime($now) <= strtotime($todate))) || (empty($fromdate) == false && (strtotime($now) >= strtotime($fromdate)) && empty($todate)) || ((strtotime($now) >= strtotime($fromdate)) && (strtotime($now) <= strtotime($todate))~~)) { |
  |  | 1172 | if (( empty($fromdate) && empty($todate) ) || ( empty($fromdate) && empty($todate) == false && ( strtotime($now) <= strtotime($todate) ) ) || ( empty($fromdate) == false && ( strtotime($now) >= strtotime($fromdate) ) && empty($todate) ) || ( ( strtotime($now) >= strtotime($fromdate) ) && ( strtotime($now) <= strtotime($todate) ) )) { |
  | 1189 | 1173 | } else { |
  | 1190 | 1174 | return false; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1194) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L1178) |  |
  | 1194 | 1178 | } |
  | 1195 | 1179 |  |
  | 1196 |  | public function elex\_dp\_execute\_rule($old\_price, $rule\_type\_colon\_rule\_no, $rule, $current\_quantity = 1, $pid = 0, $object\_hash = '') |
  | 1197 |  | { |
  |  | 1180 | public function elex\_dp\_execute\_rule( $old\_price, $rule\_type\_colon\_rule\_no, $rule, $current\_quantity = 1, $pid = 0, $object\_hash = '') { |
  | 1198 | 1181 | global $executed\_rule\_pid\_price, $executed\_pids; |
  | 1199 | 1182 | $new\_price = $old\_price; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1245) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L1228) |  |
  | 1245 | 1228 | } |
  | 1246 | 1229 |  |
  | 1247 |  | public function elex\_dp\_calculate\_discount($old\_price, $rule\_no, $rule, $pid = 0, $current\_quantity = 1, $do\_not\_execute = false) |
  | 1248 |  | { |
  |  | 1230 | public function elex\_dp\_calculate\_discount( $old\_price, $rule\_no, $rule, $pid = 0, $current\_quantity = 1, $do\_not\_execute = false) { |
  | 1249 | 1231 | global $xa\_common\_flat\_discount, $xa\_cart\_quantities, $executed\_rule\_pid\_price, $xa\_cart\_categories\_units, $xa\_cart\_categories, $xa\_cart\_price; |
  | 1250 | 1232 | $new\_price           = $old\_price; |
  | 1251 |  | $type\_code           = $rule['rule\_type'] == 'product\_rules'  ?  (~~$rule['rule\_type'] . $pid~~)   :  $rule['rule\_type']; |
  |  | 1233 | $type\_code           = $rule['rule\_type'] == 'product\_rules'  ?  ( $rule['rule\_type'] . $pid )   :  $rule['rule\_type']; |
  | 1252 | 1234 | $cart\_quantity       = 0; |
  | 1253 | 1235 | $prev\_total\_discount = 0; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1269) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L1251) |  |
  | 1269 | 1251 | $rprice               = isset($xa\_cart\_price[$ppid]) ?  $xa\_cart\_price[$ppid] : 0; |
  | 1270 | 1252 | $sprice               = isset($executed\_rule\_pid\_price[$rule['rule\_type'] . ':' . $rule\_no][$ppid]) ?  $executed\_rule\_pid\_price[$rule['rule\_type'] . ':' . $rule\_no][$ppid] : $rprice; |
  | 1271 |  | $prev\_total\_discount += (~~$rprice - $sprice~~) \* $qnty; |
  |  | 1253 | $prev\_total\_discount += ( $rprice - $sprice ) \* $qnty; |
  | 1272 | 1254 | } |
  | 1273 | 1255 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1283) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L1265) |  |
  | 1283 | 1265 | $rprice               = isset($xa\_cart\_price[$ppid]) ?  $xa\_cart\_price[$ppid] : 0; |
  | 1284 | 1266 | $sprice               = isset($executed\_rule\_pid\_price[$rule['rule\_type'] . ':' . $rule\_no][$ppid]) ?  $executed\_rule\_pid\_price[$rule['rule\_type'] . ':' . $rule\_no][$ppid] : $rprice; |
  | 1285 |  | $prev\_total\_discount += (~~$rprice - $sprice~~) \* $units; |
  |  | 1267 | $prev\_total\_discount += ( $rprice - $sprice ) \* $units; |
  | 1286 | 1268 | } |
  | 1287 | 1269 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1303) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L1285) |  |
  | 1303 | 1285 | $discount\_amt = floatval($value) \* floatval($old\_price) / 100; |
  | 1304 | 1286 | } elseif ($discount\_type == 'Flat Discount') { |
  | 1305 |  | if~~($current\_quantity)~~{ |
  |  | 1287 | if ($current\_quantity) { |
  | 1306 | 1288 | if ($do\_not\_execute === true) { |
  | 1307 | 1289 | $discount\_amt = floatval($value); |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1312) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L1294) |  |
  | 1312 | 1294 | } elseif ($discount\_type == 'Fixed Price') { |
  | 1313 | 1295 | $discount\_amt = floatval($old\_price) - floatval($value); |
  | 1314 |  | } elseif~~($discount\_type == 'Coupon Discount')~~{ |
  | 1315 |  |  |
  | 1316 |  | if~~($rule['coupon\_discount\_type'] == 'percent')~~{ |
  |  | 1296 | } elseif ($discount\_type == 'Coupon Discount') { |
  |  | 1297 |  |
  |  | 1298 | if ($rule['coupon\_discount\_type'] == 'percent') { |
  | 1317 | 1299 |  |
  | 1318 | 1300 | $discount\_amt = floatval($value) \* floatval($old\_price) / 100; |
  | 1319 |  | } elseif ($rule['coupon\_discount\_type'] == 'fixed\_cart'){ |
  | 1320 |  | if~~($current\_quantity)~~{ |
  |  | 1301 | } elseif ($rule['coupon\_discount\_type'] == 'fixed\_cart') { |
  |  | 1302 | if ($current\_quantity) { |
  | 1321 | 1303 | if ($do\_not\_execute === true) { |
  | 1322 | 1304 | $discount\_amt = floatval($value); |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1326) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L1308) |  |
  | 1326 | 1308 | } |
  | 1327 | 1309 |  |
  | 1328 |  | } elseif ($rule['coupon\_discount\_type'] == 'fixed\_product'){ |
  |  | 1310 | } elseif ($rule['coupon\_discount\_type'] == 'fixed\_product') { |
  | 1329 | 1311 | $discount\_amt = floatval($old\_price) - floatval($value); |
  | 1330 | 1312 | } else { |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1339) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L1321) |  |
  | 1339 | 1321 | } |
  | 1340 | 1322 |  |
  | 1341 |  | if (!empty($max\_discount) && is\_numeric($max\_discount) && (~~(($discount\_amt \* $cart\_quantity) + $prev\_total\_discount) >= $max\_discount~~)) { |
  | 1342 |  | $discount\_amt = (~~$max\_discount - $prev\_total\_discount~~) / $cart\_quantity; |
  |  | 1323 | if (!empty($max\_discount) && is\_numeric($max\_discount) && ( ( ( $discount\_amt \* $cart\_quantity ) + $prev\_total\_discount ) >= $max\_discount )) { |
  |  | 1324 | $discount\_amt = ( $max\_discount - $prev\_total\_discount ) / $cart\_quantity; |
  | 1343 | 1325 | } |
  | 1344 | 1326 |  |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1348) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L1330) |  |
  | 1348 | 1330 |  |
  | 1349 | 1331 | } |
  | 1350 |  | ~~if($old\_price && $discount\_amt)~~{ |
  | 1351 |  | $new\_price = (float)~~$old\_price - (float)~~$discount\_amt; |
  |  | 1332 | if ($old\_price && $discount\_amt) { |
  |  | 1333 | $new\_price = (float) $old\_price - (float) $discount\_amt; |
  | 1352 | 1334 | } |
  | 1353 | 1335 | if (isset($\_GET['debug']) && $do\_not\_execute == false) { |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1357) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L1339) |  |
  | 1357 | 1339 | if (!empty($rule['discount\_on\_product\_id']) && in\_array($pid, $rule['discount\_on\_product\_id']) && !empty($rule['product\_id'][$pid]) && !empty($xa\_cart\_quantities[$pid]) && $rule['product\_id'][$pid] < $xa\_cart\_quantities[$pid]) { |
  | 1358 | 1340 | $remaining\_qnty = $xa\_cart\_quantities[$pid] - $rule['product\_id'][$pid]; |
  | 1359 |  | $new\_price      =  (~~($new\_price \* $rule['product\_id'][$pid]) + ($old\_price \* $remaining\_qnty)~~) / $xa\_cart\_quantities[$pid]; |
  |  | 1341 | $new\_price      =  ( ( $new\_price \* $rule['product\_id'][$pid] ) + ( $old\_price \* $remaining\_qnty ) ) / $xa\_cart\_quantities[$pid]; |
  | 1360 | 1342 | } |
  | 1361 | 1343 | return $new\_price; |
  | 1362 | 1344 | } |
  | 1363 | 1345 |  |
  | 1364 |  | public function elex\_dp\_SimpleExecute($old\_price, $rule\_no, $rule, $pid = 0, $current\_quantity = 1, $do\_not\_execute = false, $object\_hash = '') |
  | 1365 |  | { |
  |  | 1346 | public function elex\_dp\_SimpleExecute( $old\_price, $rule\_no, $rule, $pid = 0, $current\_quantity = 1, $do\_not\_execute = false, $object\_hash = '') { |
  | 1366 | 1347 | global $xa\_common\_flat\_discount, $xa\_cart\_quantities, $executed\_rule\_pid\_price, $xa\_cart\_categories\_units, $xa\_cart\_categories, $xa\_cart\_price; |
  | 1367 | 1348 | $new\_price           = $old\_price; |
  | 1368 |  | $type\_code           = $rule['rule\_type'] == 'product\_rules'  ?  (~~$rule['rule\_type'] . $pid~~)   :  $rule['rule\_type']; |
  |  | 1349 | $type\_code           = $rule['rule\_type'] == 'product\_rules'  ?  ( $rule['rule\_type'] . $pid )   :  $rule['rule\_type']; |
  | 1369 | 1350 | $cart\_quantity       = 0; |
  | 1370 | 1351 | $prev\_total\_discount = 0; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1386) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L1367) |  |
  | 1386 | 1367 | $rprice               = isset($xa\_cart\_price[$ppid]) ?  $xa\_cart\_price[$ppid] : 0; |
  | 1387 | 1368 | $sprice               = isset($executed\_rule\_pid\_price[$rule['rule\_type'] . ':' . $rule\_no][$ppid]) ?  $executed\_rule\_pid\_price[$rule['rule\_type'] . ':' . $rule\_no][$ppid] : $rprice; |
  | 1388 |  | $prev\_total\_discount += (~~$rprice - $sprice~~) \* $qnty; |
  |  | 1369 | $prev\_total\_discount += ( $rprice - $sprice ) \* $qnty; |
  | 1389 | 1370 | } |
  | 1390 | 1371 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1400) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L1381) |  |
  | 1400 | 1381 | $rprice               = isset($xa\_cart\_price[$ppid]) ?  $xa\_cart\_price[$ppid] : 0; |
  | 1401 | 1382 | $sprice               = isset($executed\_rule\_pid\_price[$rule['rule\_type'] . ':' . $rule\_no][$ppid]) ?  $executed\_rule\_pid\_price[$rule['rule\_type'] . ':' . $rule\_no][$ppid] : $rprice; |
  | 1402 |  | $prev\_total\_discount += (~~$rprice - $sprice~~) \* $units; |
  |  | 1383 | $prev\_total\_discount += ( $rprice - $sprice ) \* $units; |
  | 1403 | 1384 | } |
  | 1404 | 1385 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1420) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L1401) |  |
  | 1420 | 1401 | $discount\_amt = floatval($value) \* floatval($old\_price) / 100; |
  | 1421 | 1402 | } elseif ($discount\_type == 'Flat Discount') { |
  | 1422 |  | if~~($current\_quantity)~~{ |
  |  | 1403 | if ($current\_quantity) { |
  | 1423 | 1404 | if ($do\_not\_execute === true) { |
  | 1424 | 1405 | $discount\_amt = floatval($value); |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1437) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L1418) |  |
  | 1437 | 1418 | } |
  | 1438 | 1419 |  |
  | 1439 |  | if (!empty($max\_discount) && is\_numeric($max\_discount) && (~~(($discount\_amt \* $cart\_quantity) + $prev\_total\_discount) >= $max\_discount~~)) { |
  | 1440 |  | $discount\_amt = (~~$max\_discount - $prev\_total\_discount~~) / $cart\_quantity; |
  |  | 1420 | if (!empty($max\_discount) && is\_numeric($max\_discount) && ( ( ( $discount\_amt \* $cart\_quantity ) + $prev\_total\_discount ) >= $max\_discount )) { |
  |  | 1421 | $discount\_amt = ( $max\_discount - $prev\_total\_discount ) / $cart\_quantity; |
  | 1441 | 1422 | } |
  | 1442 | 1423 |  |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1453) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L1434) |  |
  | 1453 | 1434 | if (!empty($rule['discount\_on\_product\_id']) && in\_array($pid, $rule['discount\_on\_product\_id']) && !empty($rule['product\_id'][$pid]) && !empty($xa\_cart\_quantities[$pid]) && $rule['product\_id'][$pid] < $xa\_cart\_quantities[$pid]) { |
  | 1454 | 1435 | $remaining\_qnty = $xa\_cart\_quantities[$pid] - $rule['product\_id'][$pid]; |
  | 1455 |  | $new\_price      =  (~~($new\_price \* $rule['product\_id'][$pid]) + ($old\_price \* $remaining\_qnty)~~) / $xa\_cart\_quantities[$pid]; |
  |  | 1436 | $new\_price      =  ( ( $new\_price \* $rule['product\_id'][$pid] ) + ( $old\_price \* $remaining\_qnty ) ) / $xa\_cart\_quantities[$pid]; |
  | 1456 | 1437 | } |
  | 1457 | 1438 | ///// adding to cache |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1465) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L1446) |  |
  | 1465 | 1446 | } |
  | 1466 | 1447 |  |
  | 1467 |  | public function elex\_dp\_Simple\_Category\_Combinational\_Execute($old\_price, $rule\_no, $rule, $pid = 0, $current\_quantity = 1, $do\_not\_execute = false, $object\_hash = '') |
  | 1468 |  | { |
  |  | 1448 | public function elex\_dp\_Simple\_Category\_Combinational\_Execute( $old\_price, $rule\_no, $rule, $pid = 0, $current\_quantity = 1, $do\_not\_execute = false, $object\_hash = '') { |
  | 1469 | 1449 | global $xa\_common\_flat\_discount, $xa\_cart\_quantities, $executed\_rule\_pid\_price, $xa\_cart\_categories\_units, $xa\_cart\_categories, $xa\_cart\_price; |
  | 1470 | 1450 | $new\_price           = $old\_price; |
  | 1471 |  | $type\_code           = $rule['rule\_type'] == 'product\_rules'  ?  (~~$rule['rule\_type'] . $pid~~)   :  $rule['rule\_type']; |
  |  | 1451 | $type\_code           = $rule['rule\_type'] == 'product\_rules'  ?  ( $rule['rule\_type'] . $pid )   :  $rule['rule\_type']; |
  | 1472 | 1452 | $prev\_total\_discount = 0; |
  | 1473 | 1453 | $cart\_quantity       = isset($xa\_cart\_quantities[$pid]) ?  $xa\_cart\_quantities[$pid] : 0; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1478) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L1458) |  |
  | 1478 | 1458 | $rprice               = isset($xa\_cart\_price[$ppid]) ?  $xa\_cart\_price[$ppid] : 0; |
  | 1479 | 1459 | $sprice               = isset($executed\_rule\_pid\_price[$rule['rule\_type'] . ':' . $rule\_no][$ppid]) ?  $executed\_rule\_pid\_price[$rule['rule\_type'] . ':' . $rule\_no][$ppid] : $rprice; |
  | 1480 |  | $prev\_total\_discount += (~~$rprice - $sprice~~) \* $qnty; |
  |  | 1460 | $prev\_total\_discount += ( $rprice - $sprice ) \* $qnty; |
  | 1481 | 1461 | } |
  | 1482 | 1462 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1489) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L1469) |  |
  | 1489 | 1469 | $discount\_amt = floatval($value) \* floatval($old\_price) / 100; |
  | 1490 | 1470 | } elseif ($discount\_type == 'Flat Discount') { |
  | 1491 |  | if~~($current\_quantity)~~{ |
  |  | 1471 | if ($current\_quantity) { |
  | 1492 | 1472 | if ($do\_not\_execute === true) { |
  | 1493 | 1473 | $discount\_amt = floatval($value); |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1506) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L1486) |  |
  | 1506 | 1486 | } |
  | 1507 | 1487 |  |
  | 1508 |  | if (!empty($max\_discount) && is\_numeric($max\_discount) && (~~(($discount\_amt \* $cart\_quantity) + $prev\_total\_discount) >= $max\_discount~~)) { |
  | 1509 |  | $discount\_amt = (~~$max\_discount - $prev\_total\_discount~~) / $cart\_quantity; |
  |  | 1488 | if (!empty($max\_discount) && is\_numeric($max\_discount) && ( ( ( $discount\_amt \* $cart\_quantity ) + $prev\_total\_discount ) >= $max\_discount )) { |
  |  | 1489 | $discount\_amt = ( $max\_discount - $prev\_total\_discount ) / $cart\_quantity; |
  | 1510 | 1490 | } |
  | 1511 | 1491 |  |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1522) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L1502) |  |
  | 1522 | 1502 | if (!empty($rule['discount\_on\_product\_id']) && in\_array($pid, $rule['discount\_on\_product\_id']) && !empty($rule['product\_id'][$pid]) && !empty($xa\_cart\_quantities[$pid]) && $rule['product\_id'][$pid] < $xa\_cart\_quantities[$pid]) { |
  | 1523 | 1503 | $remaining\_qnty = $xa\_cart\_quantities[$pid] - $rule['product\_id'][$pid]; |
  | 1524 |  | $new\_price      =  (~~($new\_price \* $rule['product\_id'][$pid]) + ($old\_price \* $remaining\_qnty)~~) / $xa\_cart\_quantities[$pid]; |
  |  | 1504 | $new\_price      =  ( ( $new\_price \* $rule['product\_id'][$pid] ) + ( $old\_price \* $remaining\_qnty ) ) / $xa\_cart\_quantities[$pid]; |
  | 1525 | 1505 | } |
  | 1526 | 1506 | ///// adding to cache |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1534) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L1514) |  |
  | 1534 | 1514 | } |
  | 1535 | 1515 |  |
  | 1536 |  | public function elex\_dp\_Simple\_Combinational\_Execute($old\_price, $rule\_no, $rule, $pid = 0, $current\_quantity = 1, $do\_not\_execute = false, $object\_hash = '') |
  | 1537 |  | { |
  |  | 1516 | public function elex\_dp\_Simple\_Combinational\_Execute( $old\_price, $rule\_no, $rule, $pid = 0, $current\_quantity = 1, $do\_not\_execute = false, $object\_hash = '') { |
  | 1538 | 1517 | global $xa\_common\_flat\_discount, $xa\_cart\_quantities, $executed\_rule\_pid\_price, $xa\_cart\_categories\_units, $xa\_cart\_categories, $xa\_cart\_price; |
  | 1539 | 1518 | $new\_price           = $old\_price; |
  | 1540 |  | $type\_code           = $rule['rule\_type'] == 'product\_rules'  ?  (~~$rule['rule\_type'] . $pid~~)   :  $rule['rule\_type']; |
  |  | 1519 | $type\_code           = $rule['rule\_type'] == 'product\_rules'  ?  ( $rule['rule\_type'] . $pid )   :  $rule['rule\_type']; |
  | 1541 | 1520 | $prev\_total\_discount = 0; |
  | 1542 | 1521 | $cart\_quantity       = isset($xa\_cart\_quantities[$pid]) ?  $xa\_cart\_quantities[$pid] : 0; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1546) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L1525) |  |
  | 1546 | 1525 | $rprice               = isset($xa\_cart\_price[$ppid]) ?  $xa\_cart\_price[$ppid] : 0; |
  | 1547 | 1526 | $sprice               = isset($executed\_rule\_pid\_price[$rule['rule\_type'] . ':' . $rule\_no][$ppid]) ?  $executed\_rule\_pid\_price[$rule['rule\_type'] . ':' . $rule\_no][$ppid] : $rprice; |
  | 1548 |  | $prev\_total\_discount += (~~$rprice - $sprice~~) \* $qnty; |
  |  | 1527 | $prev\_total\_discount += ( $rprice - $sprice ) \* $qnty; |
  | 1549 | 1528 | } |
  | 1550 | 1529 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1557) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L1536) |  |
  | 1557 | 1536 | $discount\_amt = floatval($value) \* floatval($old\_price) / 100; |
  | 1558 | 1537 | } elseif ($discount\_type == 'Flat Discount') { |
  | 1559 |  | if~~($current\_quantity)~~{ |
  |  | 1538 | if ($current\_quantity) { |
  | 1560 | 1539 | if ($do\_not\_execute === true) { |
  | 1561 | 1540 | $discount\_amt = floatval($value); |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1574) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L1553) |  |
  | 1574 | 1553 | } |
  | 1575 | 1554 |  |
  | 1576 |  | if (!empty($max\_discount) && is\_numeric($max\_discount) && (~~(($discount\_amt \* $cart\_quantity) + $prev\_total\_discount) >= $max\_discount~~)) { |
  | 1577 |  | $discount\_amt = (~~$max\_discount - $prev\_total\_discount~~) / $cart\_quantity; |
  |  | 1555 | if (!empty($max\_discount) && is\_numeric($max\_discount) && ( ( ( $discount\_amt \* $cart\_quantity ) + $prev\_total\_discount ) >= $max\_discount )) { |
  |  | 1556 | $discount\_amt = ( $max\_discount - $prev\_total\_discount ) / $cart\_quantity; |
  | 1578 | 1557 | } |
  | 1579 | 1558 |  |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1591) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L1570) |  |
  | 1591 | 1570 | // removed this code to make restrictions work for any quantity |
  | 1592 | 1571 | //$remaining\_qnty=$xa\_cart\_quantities[$pid]-$rule['product\_id'][$pid]; |
  | 1593 |  | $new\_price =  (~~$new\_price \* $rule['product\_id'][$pid]~~); // + ($old\_price \* $remaining\_qnty ))/$xa\_cart\_quantities[$pid]; |
  |  | 1572 | $new\_price =  ( $new\_price \* $rule['product\_id'][$pid] ); // + ($old\_price \* $remaining\_qnty ))/$xa\_cart\_quantities[$pid]; |
  | 1594 | 1573 | } |
  | 1595 | 1574 | ///// adding to cache |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1604) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L1583) |  |
  | 1604 | 1583 |  |
  | 1605 | 1584 |  |
  | 1606 |  | public function elex\_dp\_Simple\_Cart\_Execute($old\_price, $rule\_no, $rule, $pid = 0, $current\_quantity = 1, $do\_not\_execute = false, $object\_hash = '') |
  | 1607 |  | { |
  |  | 1585 | public function elex\_dp\_Simple\_Cart\_Execute( $old\_price, $rule\_no, $rule, $pid = 0, $current\_quantity = 1, $do\_not\_execute = false, $object\_hash = '') { |
  | 1608 | 1586 | global $xa\_common\_flat\_discount, $xa\_cart\_quantities, $executed\_rule\_pid\_price, $xa\_cart\_categories\_units, $xa\_cart\_categories, $xa\_cart\_price; |
  | 1609 | 1587 | $new\_price           = $old\_price; |
  | 1610 |  | $type\_code           = $rule['rule\_type'] == 'product\_rules'  ?  (~~$rule['rule\_type'] . $pid~~)   :  $rule['rule\_type']; |
  |  | 1588 | $type\_code           = $rule['rule\_type'] == 'product\_rules'  ?  ( $rule['rule\_type'] . $pid )   :  $rule['rule\_type']; |
  | 1611 | 1589 | $cart\_quantity       = 0; |
  | 1612 | 1590 | $prev\_total\_discount = 0; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1617) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L1595) |  |
  | 1617 | 1595 | $rprice               = isset($xa\_cart\_price[$ppid]) ?  $xa\_cart\_price[$ppid] : 0; |
  | 1618 | 1596 | $sprice               = isset($executed\_rule\_pid\_price[$rule['rule\_type'] . ':' . $rule\_no][$ppid]) ?  $executed\_rule\_pid\_price[$rule['rule\_type'] . ':' . $rule\_no][$ppid] : $rprice; |
  | 1619 |  | $prev\_total\_discount += (~~$rprice - $sprice~~) \* $qnty; |
  |  | 1597 | $prev\_total\_discount += ( $rprice - $sprice ) \* $qnty; |
  | 1620 | 1598 | } |
  | 1621 | 1599 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1629) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L1607) |  |
  | 1629 | 1607 | $discount\_amt = floatval($value) \* floatval($old\_price) / 100; |
  | 1630 | 1608 | } elseif ($discount\_type == 'Flat Discount') { |
  | 1631 |  | if~~($current\_quantity)~~{ |
  |  | 1609 | if ($current\_quantity) { |
  | 1632 | 1610 | if ($do\_not\_execute === true) { |
  | 1633 | 1611 | $discount\_amt = floatval($value); |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1646) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L1624) |  |
  | 1646 | 1624 | } |
  | 1647 | 1625 |  |
  | 1648 |  | if (!empty($max\_discount) && is\_numeric($max\_discount) && (~~(($discount\_amt \* $cart\_quantity) + $prev\_total\_discount) >= $max\_discount~~)) { |
  | 1649 |  | $discount\_amt = (~~$max\_discount - $prev\_total\_discount~~) / $cart\_quantity; |
  |  | 1626 | if (!empty($max\_discount) && is\_numeric($max\_discount) && ( ( ( $discount\_amt \* $cart\_quantity ) + $prev\_total\_discount ) >= $max\_discount )) { |
  |  | 1627 | $discount\_amt = ( $max\_discount - $prev\_total\_discount ) / $cart\_quantity; |
  | 1650 | 1628 | } |
  | 1651 | 1629 |  |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1661) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L1639) |  |
  | 1661 | 1639 | if (!empty($rule['discount\_on\_product\_id']) && in\_array($pid, $rule['discount\_on\_product\_id']) && !empty($rule['product\_id'][$pid]) && !empty($xa\_cart\_quantities[$pid]) && $rule['product\_id'][$pid] < $xa\_cart\_quantities[$pid]) { |
  | 1662 | 1640 | $remaining\_qnty = $xa\_cart\_quantities[$pid] - $rule['product\_id'][$pid]; |
  | 1663 |  | $new\_price      =  (~~($new\_price \* $rule['product\_id'][$pid]) + ($old\_price \* $remaining\_qnty)~~) / $xa\_cart\_quantities[$pid]; |
  |  | 1641 | $new\_price      =  ( ( $new\_price \* $rule['product\_id'][$pid] ) + ( $old\_price \* $remaining\_qnty ) ) / $xa\_cart\_quantities[$pid]; |
  | 1664 | 1642 | } |
  | 1665 | 1643 | ///// adding to cache |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1674) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L1652) |  |
  | 1674 | 1652 |  |
  | 1675 | 1653 |  |
  | 1676 |  | public function elex\_dp\_Simple\_Category\_Execute($old\_price, $rule\_no, $rule, $pid = 0, $current\_quantity = 1, $do\_not\_execute = false, $object\_hash = '') |
  | 1677 |  | { |
  |  | 1654 | public function elex\_dp\_Simple\_Category\_Execute( $old\_price, $rule\_no, $rule, $pid = 0, $current\_quantity = 1, $do\_not\_execute = false, $object\_hash = '') { |
  | 1678 | 1655 | global $xa\_common\_flat\_discount, $xa\_cart\_quantities, $executed\_rule\_pid\_price, $xa\_cart\_categories\_units, $xa\_cart\_categories, $xa\_cart\_price; |
  | 1679 | 1656 | $new\_price           = $old\_price; |
  | 1680 |  | $type\_code           = $rule['rule\_type'] == 'product\_rules'  ?  (~~$rule['rule\_type'] . $pid~~)   :  $rule['rule\_type']; |
  |  | 1657 | $type\_code           = $rule['rule\_type'] == 'product\_rules'  ?  ( $rule['rule\_type'] . $pid )   :  $rule['rule\_type']; |
  | 1681 | 1658 | $cart\_quantity       = 0; |
  | 1682 | 1659 | $prev\_total\_discount = 0; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1694) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L1671) |  |
  | 1694 | 1671 | $rprice               = isset($xa\_cart\_price[$ppid]) ?  $xa\_cart\_price[$ppid] : 0; |
  | 1695 | 1672 | $sprice               = isset($executed\_rule\_pid\_price[$rule['rule\_type'] . ':' . $rule\_no][$ppid]) ?  $executed\_rule\_pid\_price[$rule['rule\_type'] . ':' . $rule\_no][$ppid] : $rprice; |
  | 1696 |  | $prev\_total\_discount += (~~$rprice - $sprice~~) \* $units; |
  |  | 1673 | $prev\_total\_discount += ( $rprice - $sprice ) \* $units; |
  | 1697 | 1674 | } |
  | 1698 | 1675 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1710) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L1687) |  |
  | 1710 | 1687 | $discount\_amt = floatval($value) \* floatval($old\_price) / 100; |
  | 1711 | 1688 | } elseif ($discount\_type == 'Flat Discount') { |
  | 1712 |  | if~~($current\_quantity)~~{ |
  |  | 1689 | if ($current\_quantity) { |
  | 1713 | 1690 | if ($do\_not\_execute === true) { |
  | 1714 | 1691 | $discount\_amt = floatval($value); |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1723) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L1700) |  |
  | 1723 | 1700 | } |
  | 1724 | 1701 |  |
  | 1725 |  | if (!empty($max\_discount) && is\_numeric($max\_discount) && (~~(($discount\_amt \* $cart\_quantity) + $prev\_total\_discount) >= $max\_discount~~)) { |
  | 1726 |  | $discount\_amt = (~~$max\_discount - $prev\_total\_discount~~) / $cart\_quantity; |
  |  | 1702 | if (!empty($max\_discount) && is\_numeric($max\_discount) && ( ( ( $discount\_amt \* $cart\_quantity ) + $prev\_total\_discount ) >= $max\_discount )) { |
  |  | 1703 | $discount\_amt = ( $max\_discount - $prev\_total\_discount ) / $cart\_quantity; |
  | 1727 | 1704 | } |
  | 1728 | 1705 |  |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1738) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L1715) |  |
  | 1738 | 1715 | if (!empty($rule['discount\_on\_product\_id']) && in\_array($pid, $rule['discount\_on\_product\_id']) && !empty($rule['product\_id'][$pid]) && !empty($xa\_cart\_quantities[$pid]) && $rule['product\_id'][$pid] < $xa\_cart\_quantities[$pid]) { |
  | 1739 | 1716 | $remaining\_qnty = $xa\_cart\_quantities[$pid] - $rule['product\_id'][$pid]; |
  | 1740 |  | $new\_price      =  (~~($new\_price \* $rule['product\_id'][$pid]) + ($old\_price \* $remaining\_qnty)~~) / $xa\_cart\_quantities[$pid]; |
  |  | 1717 | $new\_price      =  ( ( $new\_price \* $rule['product\_id'][$pid] ) + ( $old\_price \* $remaining\_qnty ) ) / $xa\_cart\_quantities[$pid]; |
  | 1741 | 1718 | } |
  | 1742 | 1719 | ///// adding to cache |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1750) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L1727) |  |
  | 1750 | 1727 | } |
  | 1751 | 1728 |  |
  | 1752 |  | public function elex\_dp\_Simple\_Tag\_Execute($old\_price, $rule\_no, $rule, $pid = 0, $current\_quantity = 1, $do\_not\_execute = false, $object\_hash = '') |
  | 1753 |  | { |
  |  | 1729 | public function elex\_dp\_Simple\_Tag\_Execute( $old\_price, $rule\_no, $rule, $pid = 0, $current\_quantity = 1, $do\_not\_execute = false, $object\_hash = '') { |
  | 1754 | 1730 | global $xa\_common\_flat\_discount, $xa\_cart\_quantities, $executed\_rule\_pid\_price, $xa\_cart\_tags\_units, $xa\_cart\_tags, $xa\_cart\_price; |
  | 1755 | 1731 | $new\_price           = $old\_price; |
  | 1756 |  | $type\_code           = $rule['rule\_type'] == 'product\_rules'  ?  (~~$rule['rule\_type'] . $pid~~)   :  $rule['rule\_type']; |
  |  | 1732 | $type\_code           = $rule['rule\_type'] == 'product\_rules'  ?  ( $rule['rule\_type'] . $pid )   :  $rule['rule\_type']; |
  | 1757 | 1733 | $cart\_quantity       = 0; |
  | 1758 | 1734 | $prev\_total\_discount = 0; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1770) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L1746) |  |
  | 1770 | 1746 | $rprice               = isset($xa\_cart\_price[$ppid]) ?  $xa\_cart\_price[$ppid] : 0; |
  | 1771 | 1747 | $sprice               = isset($executed\_rule\_pid\_price[$rule['rule\_type'] . ':' . $rule\_no][$ppid]) ?  $executed\_rule\_pid\_price[$rule['rule\_type'] . ':' . $rule\_no][$ppid] : $rprice; |
  | 1772 |  | $prev\_total\_discount += (~~$rprice - $sprice~~) \* $units; |
  |  | 1748 | $prev\_total\_discount += ( $rprice - $sprice ) \* $units; |
  | 1773 | 1749 | } |
  | 1774 | 1750 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1786) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L1762) |  |
  | 1786 | 1762 | $discount\_amt = floatval($value) \* floatval($old\_price) / 100; |
  | 1787 | 1763 | } elseif ($discount\_type == 'Flat Discount') { |
  | 1788 |  | if~~($current\_quantity)~~{ |
  |  | 1764 | if ($current\_quantity) { |
  | 1789 | 1765 | if ($do\_not\_execute === true) { |
  | 1790 | 1766 | $discount\_amt = floatval($value); |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1799) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L1775) |  |
  | 1799 | 1775 | } |
  | 1800 | 1776 |  |
  | 1801 |  | if (!empty($max\_discount) && is\_numeric($max\_discount) && (~~(($discount\_amt \* $cart\_quantity) + $prev\_total\_discount) >= $max\_discount~~)) { |
  | 1802 |  | $discount\_amt = (~~$max\_discount - $prev\_total\_discount~~) / $cart\_quantity; |
  |  | 1777 | if (!empty($max\_discount) && is\_numeric($max\_discount) && ( ( ( $discount\_amt \* $cart\_quantity ) + $prev\_total\_discount ) >= $max\_discount )) { |
  |  | 1778 | $discount\_amt = ( $max\_discount - $prev\_total\_discount ) / $cart\_quantity; |
  | 1803 | 1779 | } |
  | 1804 | 1780 |  |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1814) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L1790) |  |
  | 1814 | 1790 | if (!empty($rule['discount\_on\_product\_id']) && in\_array($pid, $rule['discount\_on\_product\_id']) && !empty($rule['product\_id'][$pid]) && !empty($xa\_cart\_quantities[$pid]) && $rule['product\_id'][$pid] < $xa\_cart\_quantities[$pid]) { |
  | 1815 | 1791 | $remaining\_qnty = $xa\_cart\_quantities[$pid] - $rule['product\_id'][$pid]; |
  | 1816 |  | $new\_price      =  (~~($new\_price \* $rule['product\_id'][$pid]) + ($old\_price \* $remaining\_qnty)~~) / $xa\_cart\_quantities[$pid]; |
  |  | 1792 | $new\_price      =  ( ( $new\_price \* $rule['product\_id'][$pid] ) + ( $old\_price \* $remaining\_qnty ) ) / $xa\_cart\_quantities[$pid]; |
  | 1817 | 1793 | } |
  | 1818 | 1794 | ///// adding to cache |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1826) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L1802) |  |
  | 1826 | 1802 | } |
  | 1827 | 1803 |  |
  | 1828 |  | public function elex\_dp\_ExecuteBOGORule($old\_price, $rule\_no, $rule, $pid = 0, $current\_quantity = 1) |
  | 1829 |  | { |
  |  | 1804 | public function elex\_dp\_ExecuteBOGORule( $old\_price, $rule\_no, $rule, $pid = 0, $current\_quantity = 1) { |
  | 1830 | 1805 | global $xa\_dp\_setting; |
  | 1831 | 1806 | global $woocommerce; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1844) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L1819) |  |
  | 1844 | 1819 | foreach ($rule['purchased\_product\_id'] as $\_pid => $\_qnty) { |
  | 1845 | 1820 | if (!empty($xa\_cart\_quantities[$\_pid]) && !empty($\_qnty) && $xa\_cart\_quantities[$\_pid] > $\_qnty) { |
  | 1846 |  | $tmp = (int) (~~$xa\_cart\_quantities[$\_pid] / $\_qnty~~); |
  |  | 1821 | $tmp = (int) ( $xa\_cart\_quantities[$\_pid] / $\_qnty ); |
  | 1847 | 1822 | if ($tmp > 1 && $tmp < $multiple) { |
  | 1848 | 1823 | $multiple = $tmp; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1859) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L1834) |  |
  | 1859 | 1834 | } |
  | 1860 | 1835 | if ($total\_childs\_qty\_in\_cart) { |
  | 1861 |  | $tmp = (int) (~~$total\_childs\_qty\_in\_cart / $\_qnty~~); |
  |  | 1836 | $tmp = (int) ( $total\_childs\_qty\_in\_cart / $\_qnty ); |
  | 1862 | 1837 | if ($tmp > 1 && $tmp < $multiple) { |
  | 1863 | 1838 | $multiple = $tmp; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1873) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L1848) |  |
  | 1873 | 1848 |  |
  | 1874 | 1849 | //If free product is set |
  | 1875 |  | if (!isset($rule['set\_free\_option']) || (~~isset($rule['set\_free\_option']) && $rule['set\_free\_option'] == 'select\_product'~~)) { |
  |  | 1850 | if (!isset($rule['set\_free\_option']) || ( isset($rule['set\_free\_option']) && $rule['set\_free\_option'] == 'select\_product' )) { |
  | 1876 | 1851 |  |
  | 1877 | 1852 | ////////if free product is already in cart with exact quanitty this code will set its price as zero |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1888) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L1863) |  |
  | 1888 | 1863 | $free\_unit = $free\_unit > $unit ? $unit : $free\_unit; |
  | 1889 | 1864 |  |
  | 1890 |  | if~~(array\_key\_exists($pid, $rule['purchased\_product\_id']) && array\_key\_exists($pid, $rule['free\_product\_id']))~~{ |
  | 1891 |  | if~~($free\_unit >= $unit)~~{ |
  | 1892 |  | $free\_unit = $unit - (int)$rule['purchased\_product\_id'][$pid]; |
  | 1893 |  | }~~else~~{ |
  | 1894 |  | $free\_unit = (~~$rule['free\_product\_id'][$pid]~~); |
  | 1895 |  | } |
  | 1896 |  | } |
  | 1897 |  | if ($all\_free\_product\_present == true && (~~is\_cart() || is\_ajax() || is\_checkout()~~)) { |
  |  | 1865 | if (array\_key\_exists($pid, $rule['purchased\_product\_id']) && array\_key\_exists($pid, $rule['free\_product\_id'])) { |
  |  | 1866 | if ($free\_unit >= $unit) { |
  |  | 1867 | $free\_unit = $unit - (int) $rule['purchased\_product\_id'][$pid]; |
  |  | 1868 | } else { |
  |  | 1869 | $free\_unit = ( $rule['free\_product\_id'][$pid] ); |
  |  | 1870 | } |
  |  | 1871 | } |
  |  | 1872 | if ($all\_free\_product\_present == true && ( is\_cart() || is\_ajax() || is\_checkout() )) { |
  | 1898 | 1873 | $total\_adjustment\_price = 0; |
  | 1899 | 1874 | if (isset($adjustment) && is\_numeric($adjustment)) { |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1906) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L1881) |  |
  | 1906 | 1881 | $total\_adjustment\_price = 0; |
  | 1907 | 1882 | } |
  | 1908 |  | if ((~~$unit - (float) $free\_unit \* $multiple~~) < 0) { //to make repeat rule work with auto add disabled |
  |  | 1883 | if (( $unit - (float) $free\_unit \* $multiple ) < 0) { //to make repeat rule work with auto add disabled |
  | 1909 | 1884 | $total\_old\_price = 0; |
  | 1910 | 1885 | } else { |
  | 1911 |  | $total\_old\_price = $old\_price \* (~~$unit - (float) $free\_unit \* $multiple~~); |
  |  | 1886 | $total\_old\_price = $old\_price \* ( $unit - (float) $free\_unit \* $multiple ); |
  | 1912 | 1887 | } |
  | 1913 | 1888 | if ($xa\_dp\_setting['auto\_add\_free\_product\_on\_off'] == 'on') { |
  | 1914 | 1889 | return  $old\_price; |
  | 1915 | 1890 | } else { |
  | 1916 |  | return (~~($total\_old\_price + $total\_adjustment\_price) / $unit~~); |
  |  | 1891 | return ( ( $total\_old\_price + $total\_adjustment\_price ) / $unit ); |
  | 1917 | 1892 | } |
  | 1918 | 1893 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1977) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L1952) |  |
  | 1977 | 1952 |  |
  | 1978 | 1953 |  |
  | 1979 |  | if ((~~$pid == $product\_tosetfree~~)) { |
  |  | 1954 | if (( $pid == $product\_tosetfree )) { |
  | 1980 | 1955 |  |
  | 1981 | 1956 | $unit      = isset($xa\_cart\_quantities[$product\_tosetfree]) ? $xa\_cart\_quantities[$product\_tosetfree] : 1; |
  | 1982 | 1957 | $free\_unit = $cheapest\_product\_quantity > $unit ? $unit : $cheapest\_product\_quantity; |
  | 1983 | 1958 |  |
  | 1984 |  | if~~(array\_key\_exists($pid, $rule['purchased\_product\_id']))~~{ |
  | 1985 |  | if~~($cheapest\_product\_quantity >= $unit)~~{ |
  | 1986 |  | $free\_unit = $unit - (int)$rule['purchased\_product\_id'][$pid]; |
  | 1987 |  | }~~else~~{ |
  |  | 1959 | if (array\_key\_exists($pid, $rule['purchased\_product\_id'])) { |
  |  | 1960 | if ($cheapest\_product\_quantity >= $unit) { |
  |  | 1961 | $free\_unit = $unit - (int) $rule['purchased\_product\_id'][$pid]; |
  |  | 1962 | } else { |
  | 1988 | 1963 | $free\_unit = $cheapest\_product\_quantity ; |
  | 1989 | 1964 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L1994) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L1969) |  |
  | 1994 | 1969 | } |
  | 1995 | 1970 |  |
  | 1996 |  | if ($all\_free\_product\_present == true && (~~is\_cart() || is\_ajax() || is\_checkout()~~)) { |
  |  | 1971 | if ($all\_free\_product\_present == true && ( is\_cart() || is\_ajax() || is\_checkout() )) { |
  | 1997 | 1972 | $total\_adjustment\_price = 0; |
  | 1998 | 1973 | if (isset($adjustment) && is\_numeric($adjustment)) { |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L2005) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L1980) |  |
  | 2005 | 1980 | $total\_adjustment\_price = 0; |
  | 2006 | 1981 | } |
  | 2007 |  | if ((~~$unit - (float) $free\_unit \* $multiple~~) < 0) { //to make repeat rule work with auto add disabled |
  |  | 1982 | if (( $unit - (float) $free\_unit \* $multiple ) < 0) { //to make repeat rule work with auto add disabled |
  | 2008 | 1983 | $total\_old\_price = 0; |
  | 2009 | 1984 | } else { |
  | 2010 |  | $total\_old\_price = $old\_price \* (~~$unit - (float) $free\_unit \* $multiple~~); |
  | 2011 |  | } |
  | 2012 |  | return (~~($total\_old\_price + $total\_adjustment\_price) / $unit~~); |
  |  | 1985 | $total\_old\_price = $old\_price \* ( $unit - (float) $free\_unit \* $multiple ); |
  |  | 1986 | } |
  |  | 1987 | return ( ( $total\_old\_price + $total\_adjustment\_price ) / $unit ); |
  | 2013 | 1988 | } |
  | 2014 | 1989 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L2029) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L2004) |  |
  | 2029 | 2004 | return $old\_price; |
  | 2030 | 2005 | } |
  | 2031 |  | public function elex\_dp\_ExecuteBOGO\_category\_Rule($old\_price, $rule\_no, $rule, $pid = 0, $current\_quantity = 1) |
  | 2032 |  | { |
  |  | 2006 | public function elex\_dp\_ExecuteBOGO\_category\_Rule( $old\_price, $rule\_no, $rule, $pid = 0, $current\_quantity = 1) { |
  | 2033 | 2007 | global $xa\_dp\_setting; |
  | 2034 | 2008 | global $woocommerce; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L2047) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L2021) |  |
  | 2047 | 2021 |  |
  | 2048 | 2022 | //If free product is set |
  | 2049 |  | if (!isset($rule['set\_free\_option']) || (~~isset($rule['set\_free\_option']) && $rule['set\_free\_option'] == 'select\_product'~~)) { |
  |  | 2023 | if (!isset($rule['set\_free\_option']) || ( isset($rule['set\_free\_option']) && $rule['set\_free\_option'] == 'select\_product' )) { |
  | 2050 | 2024 |  |
  | 2051 | 2025 | ////////if free product is already in cart with exact quanitty this code will set its price as zero |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L2066) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L2040) |  |
  | 2066 | 2040 | foreach ($rule['purchased\_category\_id'] as $\_cid => $\_qnty\_and\_checkon) { |
  | 2067 | 2041 |  |
  | 2068 |  | if ((~~array\_key\_exists($pid, $rule['free\_product\_id'])) && in\_array($\_cid, $product\_categories) && !($xa\_cart\_categories\_items[$\_cid] > 1~~)) { |
  |  | 2042 | if (( array\_key\_exists($pid, $rule['free\_product\_id']) ) && in\_array($\_cid, $product\_categories) && !( $xa\_cart\_categories\_items[$\_cid] > 1 )) { |
  | 2069 | 2043 | $add\_if\_not\_auto = $add\_if\_not\_auto + 1; |
  | 2070 | 2044 | } |
  | 2071 | 2045 | } |
  | 2072 |  | if~~($add\_if\_not\_auto > 0)~~{ |
  | 2073 |  | if~~($free\_unit >= $unit)~~{ |
  |  | 2046 | if ($add\_if\_not\_auto > 0) { |
  |  | 2047 | if ($free\_unit >= $unit) { |
  | 2074 | 2048 | $free\_unit = $unit - 1; |
  | 2075 | 2049 | } |
  | 2076 | 2050 | } |
  | 2077 | 2051 |  |
  | 2078 |  | if ($all\_free\_product\_present == true && (~~is\_cart() || is\_checkout()~~)) { |
  |  | 2052 | if ($all\_free\_product\_present == true && ( is\_cart() || is\_checkout() )) { |
  | 2079 | 2053 | $total\_adjustment\_price = 0; |
  | 2080 | 2054 | if (isset($adjustment) && is\_numeric($adjustment)) { |
  | 2081 | 2055 | $total\_adjustment\_price = $adjustment \* $free\_unit; |
  | 2082 | 2056 | } |
  | 2083 |  | $total\_old\_price = $old\_price \* (~~$unit - (float) $free\_unit~~); |
  |  | 2057 | $total\_old\_price = $old\_price \* ( $unit - (float) $free\_unit ); |
  | 2084 | 2058 | if ($xa\_dp\_setting['auto\_add\_free\_product\_on\_off'] == 'on') { |
  | 2085 | 2059 | return  $old\_price; |
  | 2086 | 2060 | } else { |
  | 2087 |  | return (~~($total\_old\_price + $total\_adjustment\_price)~~) / $unit; |
  |  | 2061 | return ( ( $total\_old\_price + $total\_adjustment\_price ) ) / $unit; |
  | 2088 | 2062 | } |
  | 2089 | 2063 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L2141) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L2115) |  |
  | 2141 | 2115 |  |
  | 2142 | 2116 | ////////if free product is already in cart with exact quanitty this code will set its price as zero |
  | 2143 |  | if ((~~$pid == $product\_tosetfree~~)) { |
  |  | 2117 | if (( $pid == $product\_tosetfree )) { |
  | 2144 | 2118 |  |
  | 2145 | 2119 | $product\_categories = !empty($xa\_cart\_categories[$pid]) ? $xa\_cart\_categories[$pid] : array(); |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L2148) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L2122) |  |
  | 2148 | 2122 | foreach ($rule['purchased\_category\_id'] as $\_cid => $\_qnty\_and\_checkon) { |
  | 2149 | 2123 |  |
  | 2150 |  | if ((~~$pid == $product\_tosetfree) && in\_array($\_cid, $product\_categories) && !($xa\_cart\_categories\_items[$\_cid] > 1~~)) { |
  |  | 2124 | if (( $pid == $product\_tosetfree ) && in\_array($\_cid, $product\_categories) && !( $xa\_cart\_categories\_items[$\_cid] > 1 )) { |
  | 2151 | 2125 | $add\_if\_not\_auto = $add\_if\_not\_auto + 1; |
  | 2152 | 2126 | } |
  | 2153 | 2127 | } |
  | 2154 |  | if~~($add\_if\_not\_auto > 0)~~{ |
  | 2155 |  | if~~($cheapest\_product\_quantity >= $unit)~~{ |
  |  | 2128 | if ($add\_if\_not\_auto > 0) { |
  |  | 2129 | if ($cheapest\_product\_quantity >= $unit) { |
  | 2156 | 2130 | $free\_unit = $unit - 1; |
  | 2157 |  | }~~else~~{ |
  |  | 2131 | } else { |
  | 2158 | 2132 | $free\_unit = $cheapest\_product\_quantity ; |
  | 2159 | 2133 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L2164) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L2138) |  |
  | 2164 | 2138 | } |
  | 2165 | 2139 |  |
  | 2166 |  | if ($all\_free\_product\_present == true && (~~is\_cart() || is\_checkout()~~)) { |
  |  | 2140 | if ($all\_free\_product\_present == true && ( is\_cart() || is\_checkout() )) { |
  | 2167 | 2141 |  |
  | 2168 | 2142 | $total\_adjustment\_price = 0; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L2171) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L2145) |  |
  | 2171 | 2145 | } |
  | 2172 | 2146 |  |
  | 2173 |  | $total\_old\_price = $old\_price \* (~~$unit - (float) $free\_unit~~); |
  | 2174 |  |  |
  | 2175 |  | return (~~($total\_old\_price + $total\_adjustment\_price)~~) / $unit; |
  |  | 2147 | $total\_old\_price = $old\_price \* ( $unit - (float) $free\_unit ); |
  |  | 2148 |  |
  |  | 2149 | return ( ( $total\_old\_price + $total\_adjustment\_price ) ) / $unit; |
  | 2176 | 2150 | } |
  | 2177 | 2151 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L2185) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L2159) |  |
  | 2185 | 2159 | } |
  | 2186 | 2160 |  |
  | 2187 |  | public function elex\_dp\_Executebogo\_tag\_rules($old\_price, $rule\_no, $rule, $pid = 0, $current\_quantity = 1) |
  | 2188 |  | { |
  |  | 2161 | public function elex\_dp\_Executebogo\_tag\_rules( $old\_price, $rule\_no, $rule, $pid = 0, $current\_quantity = 1) { |
  | 2189 | 2162 | global $xa\_dp\_setting; |
  | 2190 | 2163 | global $woocommerce; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L2217) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L2190) |  |
  | 2217 | 2190 | } |
  | 2218 | 2191 | if ($count != 0) { |
  | 2219 |  | $tmp = (int) (~~$count / $\_qnty~~); |
  |  | 2192 | $tmp = (int) ( $count / $\_qnty ); |
  | 2220 | 2193 | if ($tmp > 1 && $tmp < $multiple) { |
  | 2221 | 2194 | $multiple = $tmp; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L2231) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L2204) |  |
  | 2231 | 2204 |  |
  | 2232 | 2205 | if ($total\_items\_with\_tag != 0) { |
  | 2233 |  | $tmp = (int) (~~$total\_items\_with\_tag / $\_qnty~~); |
  |  | 2206 | $tmp = (int) ( $total\_items\_with\_tag / $\_qnty ); |
  | 2234 | 2207 | if ($tmp > 1 && $tmp < $multiple) { |
  | 2235 | 2208 | $multiple = $tmp; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L2244) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L2217) |  |
  | 2244 | 2217 |  |
  | 2245 | 2218 | //If free product is set |
  | 2246 |  | if (!isset($rule['set\_free\_option']) || (~~isset($rule['set\_free\_option']) && $rule['set\_free\_option'] == 'select\_product'~~)) { |
  |  | 2219 | if (!isset($rule['set\_free\_option']) || ( isset($rule['set\_free\_option']) && $rule['set\_free\_option'] == 'select\_product' )) { |
  | 2247 | 2220 |  |
  | 2248 | 2221 | ////////if free product is already in cart with exact quanitty this code will set its price as zero |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L2263) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L2236) |  |
  | 2263 | 2236 | foreach ($rule['purchased\_tag\_id'] as $\_cid => $\_qnty\_and\_checkon) { |
  | 2264 | 2237 |  |
  | 2265 |  | if ((~~array\_key\_exists($pid, $rule['free\_product\_id'])) && in\_array($\_cid, $product\_tags) && !($xa\_cart\_tags\_items[$\_cid] > 1~~)) { |
  |  | 2238 | if (( array\_key\_exists($pid, $rule['free\_product\_id']) ) && in\_array($\_cid, $product\_tags) && !( $xa\_cart\_tags\_items[$\_cid] > 1 )) { |
  | 2266 | 2239 | $add\_if\_not\_auto = $add\_if\_not\_auto + 1; |
  | 2267 | 2240 | } |
  | 2268 | 2241 |  |
  | 2269 | 2242 | } |
  | 2270 |  | if~~($add\_if\_not\_auto > 0)~~{ |
  | 2271 |  | if~~($free\_unit >= $unit)~~{ |
  |  | 2243 | if ($add\_if\_not\_auto > 0) { |
  |  | 2244 | if ($free\_unit >= $unit) { |
  | 2272 | 2245 | $free\_unit = $unit - 1; |
  | 2273 | 2246 | } |
  | 2274 | 2247 | } |
  | 2275 | 2248 |  |
  | 2276 |  | if ($all\_free\_product\_present == true && (~~is\_cart() || is\_checkout()~~)) { |
  |  | 2249 | if ($all\_free\_product\_present == true && ( is\_cart() || is\_checkout() )) { |
  | 2277 | 2250 | $total\_adjustment\_price = 0; |
  | 2278 | 2251 | if (isset($adjustment) && is\_numeric($adjustment)) { |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L2285) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L2258) |  |
  | 2285 | 2258 | $total\_adjustment\_price = 0; |
  | 2286 | 2259 | } |
  | 2287 |  | if ((~~$unit - (float) $free\_unit \* $multiple~~) < 0) { //to make repeat rule work with auto add disabled |
  |  | 2260 | if (( $unit - (float) $free\_unit \* $multiple ) < 0) { //to make repeat rule work with auto add disabled |
  | 2288 | 2261 | $total\_old\_price = 0; |
  | 2289 | 2262 | } else { |
  | 2290 |  | $total\_old\_price = $old\_price \* (~~$unit - (float) $free\_unit \* $multiple~~); |
  |  | 2263 | $total\_old\_price = $old\_price \* ( $unit - (float) $free\_unit \* $multiple ); |
  | 2291 | 2264 | } |
  | 2292 | 2265 | if ($xa\_dp\_setting['auto\_add\_free\_product\_on\_off'] == 'on') { |
  | 2293 | 2266 | return  $old\_price; |
  | 2294 | 2267 | } else { |
  | 2295 |  | return (~~($total\_old\_price + $total\_adjustment\_price)~~) / $unit; |
  |  | 2268 | return ( ( $total\_old\_price + $total\_adjustment\_price ) ) / $unit; |
  | 2296 | 2269 | } |
  | 2297 | 2270 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L2349) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L2322) |  |
  | 2349 | 2322 |  |
  | 2350 | 2323 | ////////if free product is already in cart with exact quanitty this code will set its price as zero |
  | 2351 |  | if ((~~$pid == $product\_tosetfree~~)) { |
  |  | 2324 | if (( $pid == $product\_tosetfree )) { |
  | 2352 | 2325 |  |
  | 2353 | 2326 | $product\_tags = !empty($xa\_cart\_tags[$pid]) ? $xa\_cart\_tags[$pid] : array(); |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L2356) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L2329) |  |
  | 2356 | 2329 | foreach ($rule['purchased\_tag\_id'] as $\_cid => $\_qnty\_and\_checkon) { |
  | 2357 | 2330 |  |
  | 2358 |  | if ((~~$pid == $product\_tosetfree) && in\_array($\_cid, $product\_tags) && !($xa\_cart\_tags\_items[$\_cid] > 1~~)) { |
  |  | 2331 | if (( $pid == $product\_tosetfree ) && in\_array($\_cid, $product\_tags) && !( $xa\_cart\_tags\_items[$\_cid] > 1 )) { |
  | 2359 | 2332 | $add\_if\_not\_auto = $add\_if\_not\_auto + 1; |
  | 2360 | 2333 | } |
  | 2361 | 2334 | } |
  | 2362 |  | if~~($add\_if\_not\_auto > 0)~~{ |
  | 2363 |  | if~~($cheapest\_product\_quantity >= $unit)~~{ |
  |  | 2335 | if ($add\_if\_not\_auto > 0) { |
  |  | 2336 | if ($cheapest\_product\_quantity >= $unit) { |
  | 2364 | 2337 | $free\_unit = $unit - 1; |
  | 2365 |  | }~~else~~{ |
  |  | 2338 | } else { |
  | 2366 | 2339 | $free\_unit = $cheapest\_product\_quantity ; |
  | 2367 | 2340 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L2373) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L2346) |  |
  | 2373 | 2346 |  |
  | 2374 | 2347 |  |
  | 2375 |  | if ($all\_free\_product\_present == true && (~~is\_cart() || is\_checkout()~~)) { |
  |  | 2348 | if ($all\_free\_product\_present == true && ( is\_cart() || is\_checkout() )) { |
  | 2376 | 2349 |  |
  | 2377 | 2350 | $total\_adjustment\_price = 0; |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L2385) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L2358) |  |
  | 2385 | 2358 | $total\_adjustment\_price = 0; |
  | 2386 | 2359 | } |
  | 2387 |  | if ((~~$unit - (float) $free\_unit \* $multiple~~) < 0) { //to make repeat rule work with auto add disabled |
  |  | 2360 | if (( $unit - (float) $free\_unit \* $multiple ) < 0) { //to make repeat rule work with auto add disabled |
  | 2388 | 2361 | $total\_old\_price = 0; |
  | 2389 | 2362 | } else { |
  | 2390 |  | $total\_old\_price = $old\_price \* (~~$unit - (float) $free\_unit \* $multiple~~); |
  | 2391 |  | } |
  | 2392 |  |  |
  | 2393 |  | return (~~($total\_old\_price + $total\_adjustment\_price)~~) / $unit; |
  |  | 2363 | $total\_old\_price = $old\_price \* ( $unit - (float) $free\_unit \* $multiple ); |
  |  | 2364 | } |
  |  | 2365 |  |
  |  | 2366 | return ( ( $total\_old\_price + $total\_adjustment\_price ) ) / $unit; |
  | 2394 | 2367 | } |
  | 2395 | 2368 | } |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3183659#L2403) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-rules-validator.php?rev=3211131#L2376) |  |
  | 2403 | 2376 | } |
  | 2404 | 2377 |  |
  | 2405 |  | public function validate\_product\_matches\_categories($product, $rule) |
  | 2406 |  | { |
  |  | 2378 | public function validate\_product\_matches\_categories( $product, $rule) { |
  | 2407 | 2379 | if ($product->is\_type('variation')) { |
  | 2408 | 2380 | $parent\_id          = elex\_dp\_is\_wc\_version\_gt\_eql('2.7') ? $product->get\_parent\_id() : $product->parent->id; |
* ## [elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-single-product-offer-table.php](/changeset/3211131/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-single-product-offer-table.php "Show the changeset 3211131 restricted to elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-single-product-offer-table.php")

  | [r2965037](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-single-product-offer-table.php?rev=2965037#L14 "Show revision 2965037 of this file in browser") | [r3211131](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-single-product-offer-table.php?rev=3211131#L14 "Show revision 3211131 of this file in browser") |  |
  | --- | --- | --- |
  | 14 | 14 |  |
  | 15 | 15 | if (!empty($offers)) { |
  | 16 |  | ?> |
  |  | 16 | ?> |
  | 17 | 17 |  |
  | 18 | 18 | <style> |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-single-product-offer-table.php?rev=2965037#L33) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-single-product-offer-table.php?rev=3211131#L33) |  |
  | 33 | 33 | <?php |
  | 34 | 34 | foreach ($offers as $type\_rule\_no => $offer) { |
  | 35 |  | ?> |
  |  | 35 | ?> |
  | 36 | 36 | <li class="<?php echo $type\_rule\_no; ?>\_item  xa\_offer\_table\_list\_item "><span class="xa\_offer\_item\_span"><?php echo apply\_filters('wpml\_translate\_single\_string', $offer, 'eh-dynamic-pricing', $type\_rule\_no); ?></span></li> |
  | 37 | 37 | <?php |
* ## [elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-single-product-pricing-table.php](/changeset/3211131/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-single-product-pricing-table.php "Show the changeset 3211131 restricted to elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-single-product-pricing-table.php")

  | [r2965037](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-single-product-pricing-table.php?rev=2965037#L61 "Show revision 2965037 of this file in browser") | [r3211131](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-single-product-pricing-table.php?rev=3211131#L61 "Show revision 3211131 of this file in browser") |  |
  | --- | --- | --- |
  | 61 | 61 | //checking if product rules are enabled on settings page |
  | 62 | 62 | global $xa\_dp\_setting; |
  | 63 |  | if (!empty($xa\_dp\_setting['product\_rules\_on\_off']) && (~~'enable' !== $xa\_dp\_setting['product\_rules\_on\_off']~~)) { |
  |  | 63 | if (!empty($xa\_dp\_setting['product\_rules\_on\_off']) && ( 'enable' !== $xa\_dp\_setting['product\_rules\_on\_off'] )) { |
  | 64 | 64 | $product\_rules = array(); |
  | 65 | 65 | } else { |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-single-product-pricing-table.php?rev=2965037#L98) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/public/elex-single-product-pricing-table.php?rev=3211131#L98) |  |
  | 98 | 98 | echo "<td class='xa\_sp\_table\_cell'> " . esc\_attr($rule['min']) . esc\_html(\_\_($unit, 'eh-dynamic-pricing-discounts')) . ' </td>'; |
  | 99 | 99 | echo "<td class='xa\_sp\_table\_cell'>"; |
  | 100 |  | echo (~~isset($rule['max']) ? esc\_html($rule['max']) : '-'~~); |
  |  | 100 | echo ( isset($rule['max']) ? esc\_html($rule['max']) : '-' ); |
  | 101 | 101 | echo ' ' . esc\_html(\_\_(isset($rule['max']) ? $unit : ' ', 'eh-dynamic-pricing-discounts')) . '</td>'; |
  | 102 | 102 | $currency\_pos = get\_option('woocommerce\_currency\_pos'); |
* ## [elex-woocommerce-dynamic-pricing-and-discounts/trunk/readme.txt](/changeset/3211131/elex-woocommerce-dynamic-pricing-and-discounts/trunk/readme.txt "Show the changeset 3211131 restricted to elex-woocommerce-dynamic-pricing-and-discounts/trunk/readme.txt")

  | [r3189520](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/readme.txt?rev=3189520#L5 "Show revision 3189520 of this file in browser") | [r3211131](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/readme.txt?rev=3211131#L5 "Show revision 3211131 of this file in browser") |  |
  | --- | --- | --- |
  | 5 | 5 | Tested up to: 6.7 |
  | 6 | 6 | Requires PHP: 7.4 |
  | 7 |  | Stable tag: 2.1.~~7~~ |
  |  | 7 | Stable tag: 2.1.8 |
  | 8 | 8 | License: GPLv2 or later |
  | 9 | 9 | License URI: http://www.gnu.org/licenses/gpl-2.0.html |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/readme.txt?rev=3189520#L142) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/readme.txt?rev=3211131#L142) |  |
  | 142 | 142 |  |
  | 143 | 143 | == Changelog == |
  |  | 144 | = 2.1.8 = |
  |  | 145 | \* Made compatible with WooCommerce 9.5 |
  |  | 146 | \* Corrected a vulnerability issue using Wordfence |
  |  | 147 | \* Optimized code to improve loading time |
  |  | 148 | \* Fixed an issue where the discount did not update when reducing the quantity |
  |  | 149 |  |
  | 144 | 150 | = 2.1.7 = |
  | 145 | 151 | \* Made compatible with WordPress 6.7 |
  | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/readme.txt?rev=3189520#L291) | […](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/readme.txt?rev=3211131#L297) |  |
  | 291 | 297 |  |
  | 292 | 298 | == Upgrade Notice == |
  |  | 299 | = 2.1.8 = |
  |  | 300 | \* Made compatible with WooCommerce 9.5 |
  |  | 301 | \* Corrected a vulnerability issue using Wordfence |
  |  | 302 | \* Optimized code to improve loading time |
  |  | 303 | \* Fixed an issue where the discount did not update when reducing the quantity |
  |  | 304 |  |
  | 293 | 305 | = 2.1.7 = |
  | 294 | 306 | \* Made compatible with WordPress 6.7 |

**Note:** See [TracChangeset](/wiki/TracChangeset)
for help on using the changeset viewer.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Unified Diff](?format=diff&new=3211131)
* [Zip Archive](?format=zip&new=3211131)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from plugins.trac.wordpress.org_a9f811db_20250114_201918.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fbrowser%2Felex-woocommerce-dynamic-pricing-and-discounts%2Ftags%2F2.1.7%2Fadmin%2Felex-importer.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← Previous Revision
* [Next Revision](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/elex-importer.php?rev=3211131 "Revision 3211131") →
* [Blame](/browser/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/elex-importer.php?annotate=blame "Annotate each line with the last changed revision (this can be time consuming...)")
* [Revision Log](/log/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.7/admin/elex-importer.php)

---

# [source:](/browser?order=name "Go to repository root") [elex-woocommerce-dynamic-pricing-and-discounts](/browser/elex-woocommerce-dynamic-pricing-and-discounts?order=name "View elex-woocommerce-dynamic-pricing-and-discounts")/[tags](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags?order=name "View tags")/[2.1.7](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.7?order=name "View 2.1.7")/[admin](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.7/admin?order=name "View admin")/[elex-importer.php](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.7/admin/elex-importer.php?order=name "View elex-importer.php")

View diff against:

View revision:

| [Last change](/changeset/2965037/elex-woocommerce-dynamic-pricing-and-discounts/trunk/admin/elex-importer.php "View differences") on this file was [2965037](/changeset/2965037/ "View changeset 2965037"), checked in by elextensions, [16 months ago](/timeline?from=2023-09-11T03%3A23%3A49Z&precision=second "See timeline at 09/11/2023 03:23:49 AM") |
| --- |
| Updated to v2.0.0 |
| **File size:** 7.4 KB | |

| Line |  |
| --- | --- |
| [1](#L1) | <?php |
| [2](#L2) | if (!defined('ABSPATH')) { |
| [3](#L3) | exit; // Exit if accessed directly |
| [4](#L4) | } |
| [5](#L5) |  |
| [6](#L6) | add\_action('admin\_init', 'elex\_dp\_import\_rules'); |
| [7](#L7) |  |
| [8](#L8) | function elex\_dp\_import\_rules() { |
| [9](#L9) | $rules\_array = get\_option('xa\_dp\_rules', array()); |
| [10](#L10) | if (isset($\_POST['import\_tab']) && !empty($\_POST['import\_tab']) && !empty($\_FILES['import\_file'])) { |
| [11](#L11) | $tab       = $\_POST['import\_tab']; |
| [12](#L12) | $type      = !empty($\_POST['import\_type'])?$\_POST['import\_type']:''; |
| [13](#L13) | $mode      = !empty($\_POST['import\_mode'])?$\_POST['import\_mode']:''; |
| [14](#L14) | $tmp       = explode('.', $\_FILES['import\_file']['name']); |
| [15](#L15) | $extension = end($tmp); |
| [16](#L16) |  |
| [17](#L17) | if ($type == 'eha-import-csv' && $extension == 'csv') { |
| [18](#L18) |  |
| [19](#L19) | if (strpos( $\_FILES['import\_file']['name'] , $tab) !== false) { |
| [20](#L20) | $import\_file = $\_FILES['import\_file']['tmp\_name']; |
| [21](#L21) | if (empty($import\_file)) { |
| [22](#L22) | wp\_safe\_redirect(admin\_url('admin.php?page=dp-import-export-page&importfailure2')); |
| [23](#L23) | return false; |
| [24](#L24) | } |
| [25](#L25) | $data   =file\_get\_contents($import\_file); |
| [26](#L26) | $header =array(); |
| [27](#L27) | if ( ( $handle = fopen( $import\_file, 'r' ) ) !== false ) { |
| [28](#L28) | $header = fgetcsv( $handle, 0, ','); |
| [29](#L29) | } |
| [30](#L30) | $rules =get\_option('xa\_dp\_rules', array()); |
| [31](#L31) | while ( ( $row = fgetcsv( $handle, 0, ',' ) ) !== false ) { |
| [32](#L32) | $rule =array(); |
| [33](#L33) | if ($tab=='product\_rules') { |
| [34](#L34) | list($offer\_name,$rule\_on,$product\_id,$category\_id,$check\_on,$min,$max,$discount\_type,$value,$max\_discount,$allow\_roles,$allow\_membership\_plans,$from\_date,$to\_date,$adjustment,$email\_ids,$prev\_order\_count,$prev\_order\_total\_amt,$repeat\_rule) = $row; |
| [35](#L35) | $cols ='offer\_name,rule\_on,product\_id,category\_id,check\_on,min,max,discount\_type,value,max\_discount,allow\_roles,allow\_membership\_plans,from\_date,to\_date,adjustment,email\_ids,prev\_order\_count,prev\_order\_total\_amt,repeat\_rule'; |
| [36](#L36) | } elseif ($tab=='combinational\_rules') { |
| [37](#L37) | list($offer\_name,$product\_id,$discount\_type,$value,$max\_discount,$allow\_roles,$allow\_membership\_plans,$from\_date,$to\_date,$adjustment,$email\_ids,$prev\_order\_count,$prev\_order\_total\_amt,$discount\_on\_product\_id) = $row; |
| [38](#L38) | $cols ='offer\_name,product\_id,discount\_type,value,max\_discount,allow\_roles,allow\_membership\_plans,from\_date,to\_date,adjustment,email\_ids,prev\_order\_count,prev\_order\_total\_amt,discount\_on\_product\_id'; |
| [39](#L39) | } elseif ($tab=='cat\_combinational\_rules') { |
| [40](#L40) | list($offer\_name,$cat\_id,$discount\_type,$value,$max\_discount,$allow\_roles,$allow\_membership\_plans,$from\_date,$to\_date,$adjustment,$email\_ids,$prev\_order\_count,$prev\_order\_total\_amt) = $row; |
| [41](#L41) | $cols ='offer\_name,cat\_id,discount\_type,value,max\_discount,allow\_roles,allow\_membership\_plans,from\_date,to\_date,adjustment,email\_ids,prev\_order\_count,prev\_order\_total\_amt'; |
| [42](#L42) | } elseif ($tab=='category\_rules') { |
| [43](#L43) | list($offer\_name,$category\_id,$check\_on,$min,$max,$discount\_type,$value,$max\_discount,$allow\_roles,$allow\_membership\_plans,$from\_date,$to\_date,$adjustment,$email\_ids,$prev\_order\_count,$prev\_order\_total\_amt) = $row; |
| [44](#L44) | $cols ='offer\_name,category\_id,check\_on,min,max,discount\_type,value,max\_discount,allow\_roles,allow\_membership\_plans,from\_date,to\_date,adjustment,email\_ids,prev\_order\_count,prev\_order\_total\_amt'; |
| [45](#L45) | } elseif ($tab=='cart\_rules') { |
| [46](#L46) | list($offer\_name,$check\_on,$min,$max,$discount\_type,$value,$max\_discount,$allow\_roles,$allow\_membership\_plans,$from\_date,$to\_date,$adjustment,$email\_ids,$prev\_order\_count,$prev\_order\_total\_amt) = $row; |
| [47](#L47) | $cols ='offer\_name,check\_on,min,max,discount\_type,value,max\_discount,allow\_roles,allow\_membership\_plans,from\_date,to\_date,adjustment,email\_ids,prev\_order\_count,prev\_order\_total\_amt'; |
| [48](#L48) | } elseif ($tab=='buy\_get\_free\_rules') { |
| [49](#L49) | list($offer\_name,$purchased\_product\_id,$free\_product\_id,$allow\_roles,$allow\_membership\_plans,$from\_date,$to\_date,$adjustment,$email\_ids,$prev\_order\_count,$prev\_order\_total\_amt) = $row; |
| [50](#L50) | $cols ='offer\_name,purchased\_product\_id,free\_product\_id,allow\_roles,allow\_membership\_plans,from\_date,to\_date,adjustment,email\_ids,prev\_order\_count,prev\_order\_total\_amt'; |
| [51](#L51) | } elseif ($tab=='BOGO\_category\_rules') { |
| [52](#L52) | list($offer\_name,$purchased\_category\_id,$free\_product\_id,$allow\_roles,$allow\_membership\_plans,$from\_date,$to\_date,$adjustment,$email\_ids,$prev\_order\_count,$prev\_order\_total\_amt) = $row; |
| [53](#L53) | $cols ='offer\_name,purchased\_category\_id,free\_product\_id,allow\_roles,allow\_membership\_plans,from\_date,to\_date,adjustment,email\_ids,prev\_order\_count,prev\_order\_total\_amt'; |
| [54](#L54) | } elseif ($tab=='bogo\_tag\_rules') { |
| [55](#L55) | list($offer\_name,$purchased\_tag\_id,$free\_product\_id,$allow\_roles,$allow\_membership\_plans,$from\_date,$to\_date,$adjustment,$email\_ids,$prev\_order\_count,$prev\_order\_total\_amt) = $row; |
| [56](#L56) | $cols ='offer\_name,purchased\_tag\_id,free\_product\_id,allow\_roles,allow\_membership\_plans,from\_date,to\_date,adjustment,email\_ids,prev\_order\_count,prev\_order\_total\_amt'; |
| [57](#L57) | } |
| [58](#L58) | $cols =explode(',', $cols); |
| [59](#L59) |  |
| [60](#L60) | foreach ($cols as $col) { |
| [61](#L61) | $tmp =$$col; |
| [62](#L62) | if ($tmp=='[]') { |
| [63](#L63) | $tmp =array(); |
| [64](#L64) | } elseif (!empty($tmp) && $tmp[0]=='[') { |
| [65](#L65) |  |
| [66](#L66) | $tmp1 = str\_replace('[', '', $tmp); |
| [67](#L67) | $tmp1 = str\_replace(']', '', $tmp1); |
| [68](#L68) | $tmp1 = explode(' | ', $tmp1); |
| [69](#L69) | $tmp  =array(); |
| [70](#L70) | foreach ($tmp1 as $keyval) { |
| [71](#L71) | $tmp2      =explode('=>', $keyval); |
| [72](#L72) | $key       =!empty($tmp2[0])?$tmp2[0]:''; |
| [73](#L73) | $val       =!empty($tmp2[1])?$tmp2[1]:''; |
| [74](#L74) | $key       =trim($key); |
| [75](#L75) | $val       =trim($val); |
| [76](#L76) | $tmp[$key] =$val; |
| [77](#L77) | } |
| [78](#L78) | } |
| [79](#L79) | $rule[$col] =$tmp; |
| [80](#L80) | } |
| [81](#L81) | if (empty($rules[$tab])) { |
| [82](#L82) | $rules[$tab][1] =$rule; |
| [83](#L83) | } else { |
| [84](#L84) | $rules[$tab][] =$rule; |
| [85](#L85) | } |
| [86](#L86) | } |
| [87](#L87) | update\_option('xa\_dp\_rules', $rules); |
| [88](#L88) |  |
| [89](#L89) | wp\_safe\_redirect(admin\_url('admin.php?page=dp-import-export-page&importsuccess')); |
| [90](#L90) | return true; |
| [91](#L91) | } else { |
| [92](#L92) | $file\_data = $\_FILES; |
| [93](#L93) | add\_action('admin\_notices', function() use ($file\_data, $tab){ |
| [94](#L94) | ?> |
| [95](#L95) | <div class="notice notice-error is-dismissible" style=""> |
| [96](#L96) | <p><?php \_e( "You can not import " . $file\_data['import\_file']['name'] . " into " . $tab , 'eh-dynamic-pricing-discounts'); ?></p> |
| [97](#L97) | </div> |
| [98](#L98) | <?php |
| [99](#L99) | }); |
| [100](#L100) | return false; |
| [101](#L101) | } |
| [102](#L102) |  |
| [103](#L103) | } elseif ($type == 'eha-import-json' && $extension == 'json') { |
| [104](#L104) |  |
| [105](#L105) | $import\_file = $\_FILES['import\_file']['tmp\_name']; |
| [106](#L106) | if (empty($import\_file)) { |
| [107](#L107) | wp\_safe\_redirect(admin\_url('admin.php?page=dp-import-export-page&importfailure2')); |
| [108](#L108) | return false; |
| [109](#L109) | } |
| [110](#L110) | $data = (array) json\_decode(file\_get\_contents($import\_file), true); |
| [111](#L111) | if (!empty($data['type']) && $data['type'] !== $tab) { |
| [112](#L112) | add\_action('admin\_notices', function() use ($data, $tab){ |
| [113](#L113) | ?> |
| [114](#L114) | <div class="notice notice-error is-dismissible" style=""> |
| [115](#L115) | <p><?php \_e( "You can not import " . $data['type'] . " into " . $tab , 'eh-dynamic-pricing-discounts'); ?></p> |
| [116](#L116) | </div> |
| [117](#L117) | <?php |
| [118](#L118) | }); |
| [119](#L119) | return false; |
| [120](#L120) | } |
| [121](#L121) | $settings = isset($data['rules'])?$data['rules']:null; |
| [122](#L122) | if (!empty($settings)) { |
| [123](#L123) | foreach ($settings as $key => $row) { |
| [124](#L124) | if (!isset($rules\_array[$tab][$key]) || $mode == 'overwrite') { |
| [125](#L125) | $rules\_array[$tab][$key] = (array) $row; |
| [126](#L126) | } elseif ($mode == 'newindex') { |
| [127](#L127) | $rules\_array[$tab][] = (array) $row; |
| [128](#L128) | } else {  //Skip |
| [129](#L129) | } |
| [130](#L130) | } |
| [131](#L131) | } |
| [132](#L132) |  |
| [133](#L133) | update\_option('xa\_dp\_rules', $rules\_array); |
| [134](#L134) | wp\_safe\_redirect(admin\_url('admin.php?page=dp-import-export-page&importsuccess')); |
| [135](#L135) | return true; |
| [136](#L136) |  |
| [137](#L137) | } else { |
| [138](#L138) | wp\_safe\_redirect(admin\_url('admin.php?page=dp-import-export-page&importfailure1')); |
| [139](#L139) | return false; |
| [140](#L140) | } |
| [141](#L141) | } |
| [142](#L142) | } |

**Note:** See [TracBrowser](/wiki/TracBrowser)
for help on using the repository browser.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Plain Text](/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.7/admin/elex-importer.php?format=txt)
* [Original Format](/export/3222465/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.7/admin/elex-importer.php)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from www.wordfence.com_c13170ca_20250114_202139.html ===


[![](https://www.wordfence.com/img/wordfence-intelligence-logo.svg)](/threat-intel/)

Have you found a vulnerability in a WordPress plugin or theme? Report vulnerabilities in WordPress plugins and themes through our [bug bounty program](https://www.wordfence.com/threat-intel/bug-bounty-program) and earn a bounty on all in-scope submissions, while we handle the responsible disclosure process on your behalf.

As a reminder, the Wordfence Intelligence Vulnerability Database API is completely free to query and utilize, both personally and commercially, and contains all the same vulnerability data as the user interface. Please review the API documentation and Webhook documentation for more information on how to query the vulnerability API endpoints and configure webhooks utilizing all the same data present in the Wordfence Intelligence user interface.

# ELEX WooCommerce Dynamic Pricing and Discounts <= 2.1.7 - Missing Authorization

 [Wordfence Intelligence](https://www.wordfence.com/threat-intel)   >    [Vulnerability Database](https://www.wordfence.com/threat-intel/vulnerabilities)   >   ELEX WooCommerce Dynamic Pricing and Discounts <= 2.1.7 - Missing Authorization

6.5

**Missing Authorization**
**CVSS Vector**
[CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:L/I:L/A:N](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:L/I:L/A:N)

| CVE | [CVE-2024-12266](https://www.cve.org/CVERecord?id=CVE-2024-12266) |
| --- | --- |
| CVSS | 6.5 (Medium) |
| Publicly Published | December 23, 2024 |
| Last Updated | December 24, 2024 |
| Researcher | [Fariq Fadillah Gusti Insani (fariqfgi)](https://www.wordfence.com/threat-intel/vulnerabilities/researchers/fariq-fadillah-gusti-insani) |

### Description

The ELEX WooCommerce Dynamic Pricing and Discounts plugin for WordPress is vulnerable to unauthorized access of data due to a missing capability check on the elex\_dp\_export\_rules() and elex\_dp\_import\_rules() functions in all versions up to, and including, 2.1.7. This makes it possible for unauthenticated attackers to import and export product rules along with obtaining phpinfo() data

#### References

* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.7/admin/elex-exporter.php#L9)
* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/browser/elex-woocommerce-dynamic-pricing-and-discounts/tags/2.1.7/admin/elex-importer.php#L8)
* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/changeset?sfp_email=&sfph_mail=&reponame=&old=3211131%40elex-woocommerce-dynamic-pricing-and-discounts&new=3211131%40elex-woocommerce-dynamic-pricing-and-discounts&sfp_email=&sfph_mail=#file7)
* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/changeset?sfp_email=&sfph_mail=&reponame=&old=3211131%40elex-woocommerce-dynamic-pricing-and-discounts&new=3211131%40elex-woocommerce-dynamic-pricing-and-discounts&sfp_email=&sfph_mail=#file8)

#### Share

[Facebook](https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Felex-woocommerce-dynamic-pricing-and-discounts%2Felex-woocommerce-dynamic-pricing-and-discounts-217-missing-authorization&t=ELEX%20WooCommerce%20Dynamic%20Pricing%20and%20Discounts%20%3C%3D%202.1.7%20-%20Missing%20Authorization "Facebook")
[Twitter](https://twitter.com/share?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Felex-woocommerce-dynamic-pricing-and-discounts%2Felex-woocommerce-dynamic-pricing-and-discounts-217-missing-authorization&text=ELEX%20WooCommerce%20Dynamic%20Pricing%20and%20Discounts%20%3C%3D%202.1.7%20-%20Missing%20Authorization "Twitter")
[LinkedIn](https://www.linkedin.com/shareArticle?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Felex-woocommerce-dynamic-pricing-and-discounts%2Felex-woocommerce-dynamic-pricing-and-discounts-217-missing-authorization "LinkedIn")
Email

## Vulnerability Details for ELEX WooCommerce Dynamic Pricing and Discounts

#### [ELEX WooCommerce Dynamic Pricing and Discounts](https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/elex-woocommerce-dynamic-pricing-and-discounts)

| Software Type | Plugin |
| --- | --- |
| Software Slug | elex-woocommerce-dynamic-pricing-and-discounts [(view on wordpress.org)](https://wordpress.org/plugins/elex-woocommerce-dynamic-pricing-and-discounts) |
| Patched? | Yes |
| Remediation | Update to version 2.1.8, or a newer patched version |
| Affected Version | * <= 2.1.7 |
| Patched Version | * 2.1.8 |

This record contains material that is subject to copyright.

**Copyright 2012-2025 Defiant Inc.**

**License:**
Defiant hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute this software vulnerability information. Any copy of the software vulnerability information you make for such purposes is authorized provided that you include a hyperlink to this vulnerability record and reproduce Defiant's copyright designation and this license in any such copy.
**[Read more.](https://www.wordfence.com/wordfence-intelligence-terms-and-conditions/)**

**Copyright 1999-2025 The MITRE Corporation**

**License:**
CVE Usage: MITRE hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute Common Vulnerabilities and Exposures (CVE®). Any copy you make for such purposes is authorized provided that you reproduce MITRE's copyright designation and this license in any such copy.
**[Read more.](https://www.cve.org/Legal/TermsOfUse)**

Have information to add, or spot any errors? Contact us at wfi-support@wordfence.com so we can make any appropriate adjustments.

Did you know Wordfence Intelligence provides free personal and commercial API access to our comprehensive WordPress vulnerability database, along with a free webhook integration to stay on top of the latest vulnerabilities added and updated in the database? Get started today!

Learn more

Want to get notified of the latest vulnerabilities that may affect your WordPress site?
 Install Wordfence on your site today to get notified immediately if your site is affected by a vulnerability that has been added to our database.

Get Wordfence

The Wordfence Intelligence WordPress vulnerability database is completely free to access and query via API. Please review the documentation on how to access and consume the vulnerability data via API.

Documentation


