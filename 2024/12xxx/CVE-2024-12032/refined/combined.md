=== Content from www.wordfence.com_58e4b2b1_20250115_084627.html ===


[![](https://www.wordfence.com/img/wordfence-intelligence-logo.svg)](/threat-intel/)

Have you found a vulnerability in a WordPress plugin or theme? Report vulnerabilities in WordPress plugins and themes through our [bug bounty program](https://www.wordfence.com/threat-intel/bug-bounty-program) and earn a bounty on all in-scope submissions, while we handle the responsible disclosure process on your behalf.

As a reminder, the Wordfence Intelligence Vulnerability Database API is completely free to query and utilize, both personally and commercially, and contains all the same vulnerability data as the user interface. Please review the API documentation and Webhook documentation for more information on how to query the vulnerability API endpoints and configure webhooks utilizing all the same data present in the Wordfence Intelligence user interface.

# Tourfic – Ultimate Hotel Booking, Travel Booking & Apartment Booking WordPress Plugin | WooCommerce Booking <= 2.15.3 - Authenticated (Subscriber+) SQL Injection

 [Wordfence Intelligence](https://www.wordfence.com/threat-intel)   >    [Vulnerability Database](https://www.wordfence.com/threat-intel/vulnerabilities)   >   Tourfic – Ultimate Hotel Booking, Travel Booking & Apartment Booking WordPress Plugin | WooCommerce Booking <= 2.15.3 - Authenticated (Subscriber+) SQL Injection

6.5

**Improper Neutralization of Special Elements used in an SQL Command ('SQL Injection')**
**CVSS Vector**
[CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:N/A:N](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:N/A:N)

| CVE | [CVE-2024-12032](https://www.cve.org/CVERecord?id=CVE-2024-12032) |
| --- | --- |
| CVSS | 6.5 (Medium) |
| Publicly Published | December 24, 2024 |
| Last Updated | December 25, 2024 |
| Researcher | [Thái An (Thái An)](https://www.wordfence.com/threat-intel/vulnerabilities/researchers/thai-an-thai-an) |

### Description

The Tourfic – Ultimate Hotel Booking, Travel Booking & Apartment Booking WordPress Plugin | WooCommerce Booking plugin for WordPress is vulnerable to SQL Injection via the 'enquiry\_id' parameter of the 'tf\_enquiry\_reply\_email\_callback' function in all versions up to, and including, 2.15.3 due to insufficient escaping on the user supplied parameter and lack of sufficient preparation on the existing SQL query. This makes it possible for authenticated attackers, with Subscriber-level access and above, to append additional SQL queries into already existing queries that can be used to extract sensitive information from the database.

#### References

* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/browser/tourfic/tags/2.14.1/inc/Core/Enquiry.php#L990)
* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/changeset/3207686/tourfic/trunk/inc/Core/Enquiry.php)

#### Share

[Facebook](https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Ftourfic%2Ftourfic-ultimate-hotel-booking-travel-booking-apartment-booking-wordpress-plugin-woocommerce-booking-2153-authenticated-subscriber-sql-injection&t=Tourfic%20%E2%80%93%20Ultimate%20Hotel%20Booking%2C%20Travel%20Booking%20%26%20Apartment%20Booking%20WordPress%20Plugin%20%7C%20WooCommerce%20Booking%20%3C%3D%202.15.3%20-%20Authenticated%20%28Subscriber%2B%29%20SQL%20Injection "Facebook")
[Twitter](https://twitter.com/share?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Ftourfic%2Ftourfic-ultimate-hotel-booking-travel-booking-apartment-booking-wordpress-plugin-woocommerce-booking-2153-authenticated-subscriber-sql-injection&text=Tourfic%20%E2%80%93%20Ultimate%20Hotel%20Booking%2C%20Travel%20Booking%20%26%20Apartment%20Booking%20WordPress%20Plugin%20%7C%20WooCommerce%20Booking%20%3C%3D%202.15.3%20-%20Authenticated%20%28Subscriber%2B%29%20SQL%20Injection "Twitter")
[LinkedIn](https://www.linkedin.com/shareArticle?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Ftourfic%2Ftourfic-ultimate-hotel-booking-travel-booking-apartment-booking-wordpress-plugin-woocommerce-booking-2153-authenticated-subscriber-sql-injection "LinkedIn")
Email

## Vulnerability Details for Tourfic – Ultimate Hotel Booking, Travel Booking & Car Rental WordPress Plugin | WooCommerce Booking

#### [Tourfic – Ultimate Hotel Booking, Travel Booking & Car Rental WordPress Plugin | WooCommerce Booking](https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/tourfic)

| Software Type | Plugin |
| --- | --- |
| Software Slug | tourfic [(view on wordpress.org)](https://wordpress.org/plugins/tourfic) |
| Patched? | Yes |
| Remediation | Update to version 2.15.4, or a newer patched version |
| Affected Version | * <= 2.15.3 |
| Patched Version | * 2.15.4 |

This record contains material that is subject to copyright.

**Copyright 2012-2025 Defiant Inc.**

**License:**
Defiant hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute this software vulnerability information. Any copy of the software vulnerability information you make for such purposes is authorized provided that you include a hyperlink to this vulnerability record and reproduce Defiant's copyright designation and this license in any such copy.
**[Read more.](https://www.wordfence.com/wordfence-intelligence-terms-and-conditions/)**

**Copyright 1999-2025 The MITRE Corporation**

**License:**
CVE Usage: MITRE hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute Common Vulnerabilities and Exposures (CVE®). Any copy you make for such purposes is authorized provided that you reproduce MITRE's copyright designation and this license in any such copy.
**[Read more.](https://www.cve.org/Legal/TermsOfUse)**

Have information to add, or spot any errors? Contact us at wfi-support@wordfence.com so we can make any appropriate adjustments.

Did you know Wordfence Intelligence provides free personal and commercial API access to our comprehensive WordPress vulnerability database, along with a free webhook integration to stay on top of the latest vulnerabilities added and updated in the database? Get started today!

Learn more

Want to get notified of the latest vulnerabilities that may affect your WordPress site?
 Install Wordfence on your site today to get notified immediately if your site is affected by a vulnerability that has been added to our database.

Get Wordfence

The Wordfence Intelligence WordPress vulnerability database is completely free to access and query via API. Please review the documentation on how to access and consume the vulnerability data via API.

Documentation



=== Content from plugins.trac.wordpress.org_77544a6c_20250115_084624.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fbrowser%2Ftourfic%2Ftags%2F2.14.1%2Finc%2FCore%2FEnquiry.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* [Blame](/browser/tourfic/tags/2.14.1/inc/Core/Enquiry.php?annotate=blame "Annotate each line with the last changed revision (this can be time consuming...)")
* [Revision Log](/log/tourfic/tags/2.14.1/inc/Core/Enquiry.php)

---

# [source:](/browser?order=name "Go to repository root") [tourfic](/browser/tourfic?order=name "View tourfic")/[tags](/browser/tourfic/tags?order=name "View tags")/[2.14.1](/browser/tourfic/tags/2.14.1?order=name "View 2.14.1")/[inc](/browser/tourfic/tags/2.14.1/inc?order=name "View inc")/[Core](/browser/tourfic/tags/2.14.1/inc/Core?order=name "View Core")/[Enquiry.php](/browser/tourfic/tags/2.14.1/inc/Core/Enquiry.php?order=name "View Enquiry.php")

View diff against:

View revision:

| [Last change](/changeset/3183828/tourfic/tags/2.14.1/inc/Core/Enquiry.php "View differences") on this file was [3183828](/changeset/3183828/ "View changeset 3183828"), checked in by themefic, [2 months ago](/timeline?from=2024-11-07T12%3A20%3A08Z&precision=second "See timeline at 11/07/2024 12:20:08 PM") |
| --- |
| tags 2.14.1 |
| **File size:** 63.0 KB | |

| Line |  |
| --- | --- |
| [1](#L1) | <?php |
| [2](#L2) |  |
| [3](#L3) | namespace Tourfic\Core; |
| [4](#L4) |  |
| [5](#L5) | defined( 'ABSPATH' ) || exit; |
| [6](#L6) |  |
| [7](#L7) | use Tourfic\Classes\Helper; |
| [8](#L8) |  |
| [9](#L9) | abstract class Enquiry { |
| [10](#L10) |  |
| [11](#L11) | private int $last\_id = 0; |
| [12](#L12) |  |
| [13](#L13) | public function \_\_construct() { |
| [14](#L14) | add\_action( 'admin\_menu', array( $this, 'add\_submenu' ) ); |
| [15](#L15) | add\_action( 'wp\_footer', array($this, 'tourfic\_ask\_question') ); |
| [16](#L16) | add\_action( 'wp\_ajax\_tf\_ask\_question', array($this, 'tourfic\_ask\_question\_ajax') ); |
| [17](#L17) | add\_action( 'wp\_ajax\_nopriv\_tf\_ask\_question', array($this, 'tourfic\_ask\_question\_ajax') ); |
| [18](#L18) |  |
| [19](#L19) | add\_action( 'wp\_ajax\_tf\_enquiry\_bulk\_action', array($this, 'tf\_enquiry\_bulk\_action\_callback') ); |
| [20](#L20) | add\_action( 'wp\_ajax\_tf\_enquiry\_filter\_post', array($this, 'tf\_enquiry\_filter\_post\_callback') ); |
| [21](#L21) | add\_action( 'wp\_ajax\_tf\_enquiry\_reply\_email', array($this, 'tf\_enquiry\_reply\_email\_callback') ); |
| [22](#L22) | add\_action( 'wp\_ajax\_tf\_enquiry\_filter\_mail', array($this, 'tf\_enquiry\_filter\_mail\_callback') ); |
| [23](#L23) |  |
| [24](#L24) | if( is\_plugin\_active( 'tourfic-email-piping/tourfic-email-piping.php' ) ) { |
| [25](#L25) | add\_filter( 'cron\_schedules', array($this, 'tf\_enquiry\_response\_schedule') ); |
| [26](#L26) | add\_action( 'init', array($this, 'tf\_enquiry\_response\_schedule\_event') ); |
| [27](#L27) | add\_action( 'tf\_enquiry\_response\_schedule', array($this, 'tf\_enquiry\_response\_schedule\_callback') ); |
| [28](#L28) | } else { |
| [29](#L29) | self::tf\_enquiry\_update\_response\_unschedule(); |
| [30](#L30) | } |
| [31](#L31) | } |
| [32](#L32) |  |
| [33](#L33) | abstract public function add\_submenu(); |
| [34](#L34) |  |
| [35](#L35) | public function enquiry\_header\_filter\_options( array $args) { |
| [36](#L36) | ?> |
| [37](#L37) | <div class="tf-booking-header-filter"> |
| [38](#L38) | <input class="enquiry-post-type" type="hidden" value="<?php echo esc\_attr( $args["post\_type"]) ?>"> |
| [39](#L39) | <div class="tf-left-search-filter"> |
| [40](#L40) | <div class="tf-bulk-action-form"> |
| [41](#L41) | <div class="tf-filter-options"> |
| [42](#L42) | <div class="tf-order-status-filter"> |
| [43](#L43) | <select class="tf-tour-filter-options tf-filter-bulk-option tf-filter-bulk-option-enquiry"> |
| [44](#L44) | <option value=""><?php esc\_html\_e( "Bulk action", "tourfic" ); ?></option> |
| [45](#L45) | <option value="trash"><?php esc\_html\_e( "Trash", "tourfic" ); ?></option> |
| [46](#L46) | <option value="mark-as-read"><?php esc\_html\_e( "Mark as Read", "tourfic" ); ?></option> |
| [47](#L47) | </select> |
| [48](#L48) | </div> |
| [49](#L49) | </div> |
| [50](#L50) | <button class="tf-order-status-filter-btn"> |
| [51](#L51) | <?php esc\_html\_e( "Apply", "tourfic" ); ?> |
| [52](#L52) | </button> |
| [53](#L53) | <div class="tf-filter-options"> |
| [54](#L54) | <div class="tf-order-status-filter-reset-btn-wrapper"> |
| [55](#L55) | <div class="tf-order-status-filter-reset-btn"> |
| [56](#L56) | <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"> |
| [57](#L57) | <mask id="mask0\_265\_944" style="mask-type:alpha" maskUnits="userSpaceOnUse" x="0" y="0" width="24" height="24"> |
| [58](#L58) | <rect width="24" height="24" fill="#D9D9D9"/> |
| [59](#L59) | </mask> |
| [60](#L60) | <g mask="url(#mask0\_265\_944)"> |
| [61](#L61) | <path d="M11 20.95C8.98333 20.7 7.3125 19.8208 5.9875 18.3125C4.6625 16.8042 4 15.0333 4 13C4 11.9 4.21667 10.8458 4.65 9.8375C5.08333 8.82917 5.7 7.95 6.5 7.2L7.925 8.625C7.29167 9.19167 6.8125 9.85 6.4875 10.6C6.1625 11.35 6 12.15 6 13C6 14.4667 6.46667 15.7625 7.4 16.8875C8.33333 18.0125 9.53333 18.7 11 18.95V20.95ZM13 20.95V18.95C14.45 18.6833 15.6458 17.9917 16.5875 16.875C17.5292 15.7583 18 14.4667 18 13C18 11.3333 17.4167 9.91667 16.25 8.75C15.0833 7.58333 13.6667 7 12 7H11.925L13.025 8.1L11.625 9.5L8.125 6L11.625 2.5L13.025 3.9L11.925 5H12C14.2333 5 16.125 5.775 17.675 7.325C19.225 8.875 20 10.7667 20 13C20 15.0167 19.3375 16.7792 18.0125 18.2875C16.6875 19.7958 15.0167 20.6833 13 20.95Z" fill="#1D2327"/> |
| [62](#L62) | </g> |
| [63](#L63) | </svg> |
| [64](#L64) | <h3 class="tf-enquiry-reset-button-text"><?php esc\_html\_e("Reset", 'tourfic'); ?></h3> |
| [65](#L65) | </div> |
| [66](#L66) | </div> |
| [67](#L67) | </div> |
| [68](#L68) | <div class="tf-filter-options"> |
| [69](#L69) | <div class="tf-order-status-filter"> |
| [70](#L70) | <select class="tf-tour-filter-options tf-filter-hotel-name tf-enquiry-filter-<?php esc\_html\_e( !empty($args['name']) ? strtolower($args['name']) : ''); ?>-name"> |
| [71](#L71) | <?php $hotel\_enquiry\_title = esc\_html\_\_( sprintf( "%s Enquiry Details", $args['name'] ), 'tourfic' ); ?> |
| [72](#L72) | <option value=""><?php esc\_html($hotel\_enquiry\_title); ?></option> |
| [73](#L73) | <?php |
| [74](#L74) | $tf\_posts\_list       = array( |
| [75](#L75) | 'posts\_per\_page' => - 1, |
| [76](#L76) | 'post\_type'      => $args['post\_type'], |
| [77](#L77) | 'post\_status'    => 'publish' |
| [78](#L78) | ); |
| [79](#L79) | $tf\_posts\_list\_query = new \WP\_Query( $tf\_posts\_list ); |
| [80](#L80) | if ( $tf\_posts\_list\_query->have\_posts() ): |
| [81](#L81) | while ( $tf\_posts\_list\_query->have\_posts() ) : $tf\_posts\_list\_query->the\_post(); |
| [82](#L82) | ?> |
| [83](#L83) | <option value="<?php echo esc\_attr(get\_the\_ID()); ?>" <?php echo ! empty( $\_GET['post'] ) && get\_the\_ID() == $\_GET['post'] ? esc\_attr( 'selected' ) : ''; ?>><?php echo esc\_html(get\_the\_title()); ?></option> |
| [84](#L84) | <?php |
| [85](#L85) | endwhile; |
| [86](#L86) | endif; |
| [87](#L87) | wp\_reset\_query(); |
| [88](#L88) | ?> |
| [89](#L89) |  |
| [90](#L90) | </select> |
| [91](#L91) | </div> |
| [92](#L92) | </div> |
| [93](#L93) |  |
| [94](#L94) | <div class="tf-filter-options"> |
| [95](#L95) | <div class="tf-order-status-filter"> |
| [96](#L96) | <select class="tf-tour-filter-options tf-filter-mail-option-enquiry"> |
| [97](#L97) | <option value=""><?php esc\_html\_e( "Filters", "tourfic" ); ?></option> |
| [98](#L98) | <option value="unread"><?php esc\_html\_e( "Unread", "tourfic" ); ?></option> |
| [99](#L99) | <?php if( function\_exists( 'is\_tf\_pro' ) && is\_tf\_pro() ): ?> |
| [100](#L100) | <option value="replied"><?php esc\_html\_e( "Replied", "tourfic" ); ?></option> |
| [101](#L101) | <option value="not-replied"><?php esc\_html\_e( "Not Replied", "tourfic" ); ?></option> |
| [102](#L102) |  |
| [103](#L103) | <?php if( is\_plugin\_active( 'tourfic-email-piping/tourfic-email-piping.php' ) ) : ?> |
| [104](#L104) | <option value="responded"><?php esc\_html\_e( "Responded", "tourfic" ); ?></option> |
| [105](#L105) | <option value="not-responded"><?php esc\_html\_e( "Not Responded", "tourfic" ); ?></option> |
| [106](#L106) | <?php endif; ?> |
| [107](#L107) |  |
| [108](#L108) | <?php endif; ?> |
| [109](#L109) | </select> |
| [110](#L110) | </div> |
| [111](#L111) | </div> |
| [112](#L112) |  |
| [113](#L113) | </div> |
| [114](#L114) | </div> |
| [115](#L115) | <form class="tf-enquiry-right-search-filter"> |
| [116](#L116) | <input type="number" value="" placeholder="<?php esc\_html\_e("Search by " . $args["name"] . " ID") ?>" id="tf-searching-enquiry-key"> |
| [117](#L117) | <button class="tf-search-by-id" type="submit"> |
| [118](#L118) | <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none"> |
| [119](#L119) | <path d="M17.5 17.5L14.5834 14.5833M16.6667 9.58333C16.6667 13.4954 13.4954 16.6667 9.58333 16.6667C5.67132 16.6667 2.5 13.4954 2.5 9.58333C2.5 5.67132 5.67132 2.5 9.58333 2.5C13.4954 2.5 16.6667 5.67132 16.6667 9.58333Z" stroke="#87888B" stroke-width="1.66667" stroke-linecap="round" stroke-linejoin="round"></path> |
| [120](#L120) | </svg> |
| [121](#L121) | </button> |
| [122](#L122) | </form> |
| [123](#L123) | </div> |
| [124](#L124) | <?php |
| [125](#L125) | } |
| [126](#L126) |  |
| [127](#L127) | public function enquiry\_details\_list(array $data, $total\_pages = 1) { |
| [128](#L128) |  |
| [129](#L129) | $post\_type = !empty($data) ? $data[0]["post\_type"] : ''; |
| [130](#L130) |  |
| [131](#L131) | if ( function\_exists( 'is\_tf\_pro' ) && is\_tf\_pro() ) { |
| [132](#L132) |  |
| [133](#L133) | if ( isset( $\_GET['paged'] ) ) { |
| [134](#L134) | $paged = $\_GET['paged']; |
| [135](#L135) | } else { |
| [136](#L136) | $paged = 1; |
| [137](#L137) | } |
| [138](#L138) | } |
| [139](#L139) | ?> |
| [140](#L140) | <div class="<?php echo apply\_filters( $post\_type . '\_booking\_oder\_table\_class', "tf-order-table-responsive") ?> tf-enquiry-table"> |
| [141](#L141) | <table class="wp-list-table table" cellpadding="0" cellspacing="0"> |
| [142](#L142) | <thead> |
| [143](#L143) | <tr> |
| [144](#L144) | <td id="cb"> |
| [145](#L145) | <div class="tf-checkbox-listing"> |
| [146](#L146) | <input id="cb-select-all-1" type="checkbox"> |
| [147](#L147) | <?php esc\_html\_e( "Name", "tourfic" ); ?> |
| [148](#L148) | </div> |
| [149](#L149) | </td> |
| [150](#L150) | <th id="uemail"> |
| [151](#L151) | <?php esc\_html\_e( "Email", "tourfic" ); ?> |
| [152](#L152) | </th> |
| [153](#L153) | <th id="post\_name"> |
| [154](#L154) | <?php !empty( $data ) && $data[0]["post\_type"] == "tf\_tours" ? esc\_html\_e("Tour Name", "tourfic") : ( !empty( $data ) && $data[0]["post\_type"] == 'tf\_hotel' ? esc\_html\_e('Hotel Name', 'tourfic') : esc\_html\_e('Apartment Name', 'tourfic') ); ?> |
| [155](#L155) | </th> |
| [156](#L156) | <th id="description"> |
| [157](#L157) | <?php esc\_html\_e( "Message", "tourfic" ); ?> |
| [158](#L158) | </th> |
| [159](#L159) | <th id="massage-date-time"> |
| [160](#L160) | <?php esc\_html\_e( "Date and Time", "tourfic" ); ?> |
| [161](#L161) | </th> |
| [162](#L162) | <th id="enquiry-action"> |
| [163](#L163) | <?php esc\_html\_e( "Action", "tourfic" ); ?> |
| [164](#L164) | </th> |
| [165](#L165) | </tr> |
| [166](#L166) | </thead> |
| [167](#L167) | <tbody> |
| [168](#L168) | <?php |
| [169](#L169) | $tf\_key = 1; |
| [170](#L170) | if( !empty( $data )) : |
| [171](#L171) | foreach ( $data as $enquiry ) { ?> |
| [172](#L172) | <?php |
| [173](#L173) | $tr\_unread\_class = $enquiry["status"] == 'unread' ? 'tf-enquiry-unread' : ( $enquiry["status"] == 'responded' && function\_exists( 'is\_tf\_pro' ) && is\_tf\_pro() ? 'tf-enquiry-responded' : '' ); |
| [174](#L174) | $submit\_time = self::convert\_to\_wp\_timezone($enquiry["submit\_time"]); |
| [175](#L175) |  |
| [176](#L176) | ?> |
| [177](#L177) | <tr class="<?php echo esc\_attr($tr\_unread\_class); ?> tf-enquiry-single-row"> |
| [178](#L178) | <input type="hidden" class="tf-enquiry-id" value="<?php echo esc\_html($enquiry["id"]); ?>"> |
| [179](#L179) | <th class="check-column"> |
| [180](#L180) | <div class="table-name-column"> |
| [181](#L181) | <div class="tf-checkbox-listing"> |
| [182](#L182) | <input id="tf-enquiry-name-checkbox" class="tf-enquiry-name-checkbox" type="checkbox" name="order\_id[]" value="<?php echo esc\_html( $enquiry['id'] ); ?>"> |
| [183](#L183) | </div> |
| [184](#L184) | <?php echo $enquiry["uname"] ? esc\_html($enquiry["uname"]) : ''; ?> |
| [185](#L185) | </div> |
| [186](#L186) | </th> |
| [187](#L187) | <td> |
| [188](#L188) | <?php echo $enquiry["uemail"] ? esc\_html($enquiry["uemail"]): ''; ?> |
| [189](#L189) | </td> |
| [190](#L190) | <td> |
| [191](#L191) | <?php echo $enquiry["post\_title"] ? esc\_html($enquiry["post\_title"]) : ''; ?> |
| [192](#L192) | </td> |
| [193](#L193) | <td> |
| [194](#L194) | <?php echo $enquiry["description"] ? (esc\_html( strlen( $enquiry["description"] ) > 100 ? esc\_html( Helper::tourfic\_character\_limit\_callback( $enquiry["description"], 100 ) ) : esc\_html( $enquiry["description"] ) )) : ''; ?> |
| [195](#L195) | </td> |
| [196](#L196) | <td class="time-n-date"> |
| [197](#L197) | <?php |
| [198](#L198) | $date\_format = !empty(Helper::tfopt("tf-date-format-for-users")) ? Helper::tfopt("tf-date-format-for-users") : get\_option('date\_format'); |
| [199](#L199) | list($date, $time) = explode(" ", $submit\_time); |
| [200](#L200) | $formateed\_time = date( get\_option('time\_format'), strtotime($time)); |
| [201](#L201) | $formateed\_date = date( $date\_format, strtotime($date)); |
| [202](#L202) | ?> |
| [203](#L203) | <div class="email-time-date"> |
| [204](#L204) | <span class="email-date"><?php echo $formateed\_date ? esc\_html( $formateed\_date ) : ''; ?></span> |
| [205](#L205) | <span class="email-time"><?php echo $formateed\_time ? esc\_html( $formateed\_time ) : ''; ?></span> |
| [206](#L206) | </div> |
| [207](#L207) | </td> |
| [208](#L208) |  |
| [209](#L209) | <td> |
| [210](#L210) | <?php |
| [211](#L211) | $actions\_details = '<a href="' . admin\_url() . 'edit.php?post\_type=' . $enquiry["post\_type"] . '&amp;page=' . $enquiry["post\_type"] . '\_enquiry' . '&amp;enquiry\_id=' . $enquiry["id"] . '&amp;action=preview" class="tf\_booking\_details\_view"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"> |
| [212](#L212) | <path d="M2.42012 12.7132C2.28394 12.4975 2.21584 12.3897 2.17772 12.2234C2.14909 12.0985 2.14909 11.9015 2.17772 11.7766C2.21584 11.6103 2.28394 11.5025 2.42012 11.2868C3.54553 9.50484 6.8954 5 12.0004 5C17.1054 5 20.4553 9.50484 21.5807 11.2868C21.7169 11.5025 21.785 11.6103 21.8231 11.7766C21.8517 11.9015 21.8517 12.0985 21.8231 12.2234C21.785 12.3897 21.7169 12.4975 21.5807 12.7132C20.4553 14.4952 17.1054 19 12.0004 19C6.8954 19 3.54553 14.4952 2.42012 12.7132Z" stroke="#1D2327" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/> |
| [213](#L213) | <path d="M12.0004 15C13.6573 15 15.0004 13.6569 15.0004 12C15.0004 10.3431 13.6573 9 12.0004 9C10.3435 9 9.0004 10.3431 9.0004 12C9.0004 13.6569 10.3435 15 12.0004 15Z" stroke="#1D2327" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/> |
| [214](#L214) | </svg></a>'; |
| [215](#L215) | echo wp\_kses($actions\_details, Helper::tf\_custom\_wp\_kses\_allow\_tags()); |
| [216](#L216) | ?> |
| [217](#L217) | </td> |
| [218](#L218) | </tr> |
| [219](#L219) | <?php if ( ! defined( 'TF\_PRO' ) && $tf\_key == 15 ) { ?> |
| [220](#L220) | <tr class="pro-row" style="text-align: center; background-color: #ededf8"> |
| [221](#L221) | <td colspan="8" style="text-align: center;"> |
| [222](#L222) | <a href="https://tourfic.com/" target="\_blank"> |
| [223](#L223) | <h3 class="tf-admin-btn tf-btn-secondary" style="color:#fff;margin: 15px 0;"><?php esc\_html\_e( 'Upgrade to Pro Version to See More', 'tourfic' ); ?></h3> |
| [224](#L224) | </a> |
| [225](#L225) | </td> |
| [226](#L226) | </tr> |
| [227](#L227) | <tr class="pro-row pro-notice-row" style="text-align: center; background-color: #ededf8"> |
| [228](#L228) | <td colspan="8" style="text-align: center;"> |
| [229](#L229) | <div class="tf-field tf-field-notice tf-pro-notice " style="width:100%;"> |
| [230](#L230) | <div class="tf-fieldset"> |
| [231](#L231) | <div class="tf-field-notice-inner tf-notice-info"> |
| [232](#L232) | <div class="tf-field-notice-icon"> |
| [233](#L233) | <i class="ri-information-fill"></i> |
| [234](#L234) | </div> |
| [235](#L235) | <div class="tf-field-notice-content has-content"> |
| [236](#L236) | <?php echo wp\_kses\_post(sprintf(\_\_("We're offering some extra filter features like %1s replied %2s, %1s not replied %2s, %1s not responded %2s, and %1s not responded %2s in our pro plan.", 'tourfic'), '<b>', '</b>', '<b>', '</b>', '<b>', '</b>', '<b>', '</b>')) ?> <a href="https://themefic.com/tourfic/pricing" target="\_blank"> <?php echo esc\_html\_\_("Upgrade to our pro package today to take advantage of these fantastic options!", 'tourfic') ?></a> |
| [237](#L237) | </div> |
| [238](#L238) | </div> |
| [239](#L239) | </div> |
| [240](#L240) | </div> |
| [241](#L241) | </td> |
| [242](#L242) | </tr> |
| [243](#L243) | <?php break;} |
| [244](#L244) | $tf\_key ++; |
| [245](#L245) | } ?> |
| [246](#L246) | <?php else: ?> |
| [247](#L247) | <tr class="no-result-found" style="text-align: center"> |
| [248](#L248) | <td colspan="8" style="text-align: center;"> |
| [249](#L249) | <h3 style="margin: 15px 0;"><?php esc\_html\_e( 'No Enquiry Found', 'tourfic' ); ?></h3> |
| [250](#L250) | </td> |
| [251](#L251) | </tr> |
| [252](#L252) | <?php endif; ?> |
| [253](#L253) |  |
| [254](#L254) | </tbody> |
| [255](#L255) | <tfoot> |
| [256](#L256) | <tr> |
| [257](#L257) | <th colspan="8"> |
| [258](#L258) | <ul class="tf-booking-details-pagination"> |
| [259](#L259) | <?php if( function\_exists( 'is\_tf\_pro' ) && is\_tf\_pro() ): ?> |
| [260](#L260) | <?php if ( ! empty( $paged ) && $paged >= 2 ) { ?> |
| [261](#L261) | <li><a href="<?php echo esc\_url($this->enquiry\_details\_pagination( $paged - 1 )); ?>"> |
| [262](#L262) | <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none"> |
| [263](#L263) | <path d="M15.8333 10.0001H4.16663M4.16663 10.0001L9.99996 15.8334M4.16663 10.0001L9.99996 4.16675" stroke="#1D2327" stroke-width="1.67" stroke-linecap="round" |
| [264](#L264) | stroke-linejoin="round"/> |
| [265](#L265) | </svg><?php esc\_html\_e( "Previous", "tourfic" ); ?></a></li> |
| [266](#L266) | <?php } |
| [267](#L267) | if ( ! empty( $total\_pages ) && $total\_pages > 1 ) { |
| [268](#L268) | for ( $i = 1; $i <= $total\_pages; $i ++ ) { |
| [269](#L269) | if ( $i == $paged ) { |
| [270](#L270) | ?> |
| [271](#L271) | <li class="active"> |
| [272](#L272) | <a href="<?php echo esc\_url($this->enquiry\_details\_pagination( $i )); ?>"><?php echo esc\_html($i); ?></a> |
| [273](#L273) | </li> |
| [274](#L274) | <?php } else { ?> |
| [275](#L275) | <li> |
| [276](#L276) | <a href="<?php echo esc\_url($this->enquiry\_details\_pagination( $i )); ?>"><?php echo esc\_html($i); ?></a> |
| [277](#L277) | </li> |
| [278](#L278) | <?php } |
| [279](#L279) | } |
| [280](#L280) | } |
| [281](#L281) | if ( ! empty( $total\_pages ) && ! empty( $paged ) && $paged < $total\_pages ) { |
| [282](#L282) | ?> |
| [283](#L283) | <li><a href="<?php echo esc\_url($this->enquiry\_details\_pagination( $paged + 1 )); ?>"><?php esc\_html\_e( "Next", "tourfic" ); ?> |
| [284](#L284) | <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none"> |
| [285](#L285) | <path d="M4.16669 10.0001H15.8334M15.8334 10.0001L10 4.16675M15.8334 10.0001L10 15.8334" stroke="#1D2327" stroke-width="1.67" stroke-linecap="round" stroke-linejoin="round"/> |
| [286](#L286) | </svg> |
| [287](#L287) | </a></li> |
| [288](#L288) | <?php } ?> |
| [289](#L289) | <?php endif; ?> |
| [290](#L290) | </ul> |
| [291](#L291) | </th> |
| [292](#L292) | </tr> |
| [293](#L293) | </tfoot> |
| [294](#L294) | </table> |
| [295](#L295) | </div> |
| [296](#L296) | <?php |
| [297](#L297) | } |
| [298](#L298) |  |
| [299](#L299) | function enquiry\_details\_pagination($page){ |
| [300](#L300) | $currentURL = home\_url($\_SERVER['REQUEST\_URI']); |
| [301](#L301) | $BaseURL = strtok($currentURL, '?'); |
| [302](#L302) | $queryString = isset($\_SERVER['QUERY\_STRING']) ? $\_SERVER['QUERY\_STRING'] : ''; |
| [303](#L303) |  |
| [304](#L304) | parse\_str($queryString, $currentURLParams); |
| [305](#L305) |  |
| [306](#L306) | if (array\_key\_exists('paged', $currentURLParams)) { |
| [307](#L307) | $currentURLParams['paged'] = $page; |
| [308](#L308) | $updatedQuery = http\_build\_query($currentURLParams); |
| [309](#L309) | return $updatedUrl = $BaseURL . '?' . $updatedQuery; |
| [310](#L310) | } else { |
| [311](#L311) | return $updatedUrl = $currentURL . '&paged=' . $page; |
| [312](#L312) | } |
| [313](#L313) | } |
| [314](#L314) |  |
| [315](#L315) | public function single\_enquiry\_details($data) { |
| [316](#L316) |  |
| [317](#L317) | global $wpdb, $current\_user; |
| [318](#L318) |  |
| [319](#L319) | $server\_data = !empty( $data["server\_data"] ) ? json\_decode($data["server\_data"], true) : array(); |
| [320](#L320) |  |
| [321](#L321) | $date\_time\_format = self::convert\_to\_wp\_timezone( $data["created\_at"] ); |
| [322](#L322) |  |
| [323](#L323) | list($date, $time) = explode(" ", $date\_time\_format); |
| [324](#L324) | $formateed\_date = date( "M d, Y", strtotime($date)); |
| [325](#L325) | $formateed\_time = date( "h:i:s A", strtotime($time)); |
| [326](#L326) | $reply\_data = !empty( $data["reply\_data"] ) ? json\_decode($data["reply\_data"], true) : array(); |
| [327](#L327) | $reply\_user = isset( $\_POST['user\_name'] ) ? sanitize\_text\_field( $\_POST['user\_name'] ) : ''; |
| [328](#L328) | $current\_user = wp\_get\_current\_user(); |
| [329](#L329) | $\_SESSION["WP"]["userId"] = $current\_user->ID; |
| [330](#L330) | $email\_body\_setting = !empty( Helper::tfopt("tf-email-piping")["email\_body\_type"] ) ? Helper::tfopt("tf-email-piping")["email\_body\_type"] : 'text'; |
| [331](#L331) |  |
| [332](#L332) | ?> |
| [333](#L333) | <div class="wrap tf\_booking\_details\_wrap tf-enquiry-details-wrap" style="margin-right: 20px;"> |
| [334](#L334) | <div id="tf-enquiry-status-loader"> |
| [335](#L335) | <img src="<?php echo esc\_url(TF\_ASSETS\_URL); ?>app/images/loader.gif" alt="Loader"> |
| [336](#L336) | </div> |
| [337](#L337) | <!-- Header Wrap - Start --> |
| [338](#L338) | <hr class="wp-header-end"> |
| [339](#L339) | <div class="tf\_booking\_wrap\_header"> |
| [340](#L340) | <div class="tf-enquiry-single-header-details"> |
| [341](#L341) | <div class="tf-single-enquiry-header-logo"> |
| [342](#L342) | <img src="<?php echo esc\_url( esc\_url(TF\_ASSETS\_APP\_URL.'images/tourfic-logo-icon-blue.png') ); ?>" alt="<?php esc\_html\_e( get\_the\_title($data["post\_id"])) ?>"> |
| [343](#L343) | </div> |
| [344](#L344) | <h1 class="wp-heading-inline"> <?php esc\_html\_e( get\_the\_title($data["post\_id"])) . esc\_html\_e(" / ID #") . esc\_html\_e($data["id"]) ?></h1> |
| [345](#L345) | </div> |
| [346](#L346) | </div> |
| [347](#L347) | <!-- Header Wrap - End --> |
| [348](#L348) | <!-- Back Button - Start --> |
| [349](#L349) | <div class="tf-single-enquiry-header-buttons"> |
| [350](#L350) | <div class="tf-enquiry-single-back-button"> |
| [351](#L351) | <a href="<?php echo esc\_url(admin\_url('edit.php?post\_type=' . $data["post\_type"] . '&page=' . $data["post\_type"] . '\_enquiry')); ?>" class="tf-enquiry-back-btn"><i class="ri-arrow-left-line"></i><?php esc\_html\_e('Back', 'tourfic'); ?></a> |
| [352](#L352) | </div> |
| [353](#L353) | <?php if( is\_plugin\_active( 'tourfic-email-piping/tourfic-email-piping.php' ) ) : ?> |
| [354](#L354) | <div class="tf-enquiry-single-back-button tf-enquiry-single-sync"> |
| [355](#L355) | <div class="tf-enquiry-single-sync-button" data-button-name="tf-enquiry-single-sysnc-button"><?php echo esc\_html\_\_("Sync Mail", 'tourfic'); ?></div> |
| [356](#L356) | </div> |
| [357](#L357) | <?php endif; ?> |
| [358](#L358) | </div> |
| [359](#L359) | <!-- Back Button - End --> |
| [360](#L360) | <!-- Enquiry Details - Start --> |
| [361](#L361) | <div class="tf-enquiry-single-details-wrapper"> <!-- Enquiry Details Main Wrapper - Start --> |
| [362](#L362) | <div class="tf-single-enquiry-left"> <!-- Enquiry Details Left - Start --> |
| [363](#L363) | <div class="tf-enquiry-details"> <!-- Enquiry mail Details Wrapper - Start --> |
| [364](#L364) | <div class="tf-enquiry-details-single-heading"> |
| [365](#L365) | <h2><?php esc\_html\_e('Details', 'tourfic'); ?></h2> |
| [366](#L366) | </div> |
| [367](#L367) | <hr class="enqury-single-title-line"> |
| [368](#L368) | <div class="tf-single-enquiry-details-content"> |
| [369](#L369) | <div class="tf-single-enquiry-details-name"> |
| [370](#L370) | <span class="tf-single-enquiry-details-label"> <?php esc\_html\_e("Name", 'tourfic') ?></span> |
| [371](#L371) | <span class="tf-single-enquiry-details-value" data-enquiry-copy-text="<?php echo esc\_html($data["uname"]); ?>"> <?php echo esc\_html($data["uname"]); ?><i class="ri-file-copy-line tf-single-enquiry-copy-btn"></i></span> |
| [372](#L372) | </div> |
| [373](#L373) | <div class="tf-single-enquiry-details-email"> |
| [374](#L374) | <span class="tf-single-enquiry-details-label"> <?php esc\_html\_e("Email", 'tourfic') ?></span> |
| [375](#L375) | <span class="tf-single-enquiry-details-value" data-enquiry-copy-text="<?php echo esc\_html($data["uemail"]); ?>"> <?php echo esc\_html($data["uemail"]); ?><i class="ri-file-copy-line tf-single-enquiry-copy-btn"></i></span> |
| [376](#L376) | </div> |
| [377](#L377) | <div class="tf-single-enquiry-details-message"> |
| [378](#L378) | <span class="tf-single-enquiry-details-label"> <?php esc\_html\_e("Message", 'tourfic') ?></span> |
| [379](#L379) | <span class="tf-single-enquiry-details-value"> <?php echo esc\_html($data["udescription"]); ?></span> |
| [380](#L380) | </div> |
| [381](#L381) | </div> |
| [382](#L382) | </div> <!-- Enquiry mail Details Wrapper - End --> |
| [383](#L383) | <?php if( function\_exists( 'is\_tf\_pro' ) && is\_tf\_pro() ): ?> |
| [384](#L384) | <?php if( count($reply\_data) == 0 ): ?> |
| [385](#L385) | <div class="tf-single-enquiry-reply-mail-button"> |
| [386](#L386) | <span> <?php esc\_html\_e( "Reply to Email", 'tourfic') ?> </span> |
| [387](#L387) | <i class="ri-mail-line"></i> |
| [388](#L388) | </div> |
| [389](#L389) | <?php endif; ?> |
| [390](#L390) | <?php $display = count($reply\_data) > 0 ? '' : 'display:none;' ?> |
| [391](#L391) | <div class="tf-enquiry-details tf-single-enquiry-reply-wrapper" style="<?php echo esc\_attr($display); ?>"> <!-- Enquiry mail Reply Wrapper - Start --> |
| [392](#L392) | <div class="tf-enquiry-details-single-heading"> |
| [393](#L393) | <h2><?php esc\_html\_e('To:', 'tourfic') ; ?> <span class="tf-single-enquiry-reply-mail"> <?php esc\_html\_e( $data["uemail"]); ?> </span></h2> |
| [394](#L394) | </div> |
| [395](#L395) | <hr class="enqury-single-title-line"> |
| [396](#L396) | <div class="tf-single-enquiry-accordion"> |
| [397](#L397) | <?php if( !empty($reply\_data) && is\_array($reply\_data)): ?> |
| [398](#L398) | <?php foreach($reply\_data as $key => $reply): ?> |
| [399](#L399) | <div class="tf-single-enquiry-accordion-item"> |
| [400](#L400) | <input type="hidden" class="tf-single-enquiry-accordion-id" value="<?php echo esc\_attr($key) ?>"> |
| [401](#L401) | <div class="tf-single-enquiry-accordion-head"> |
| [402](#L402) | <div class="tf-single-enquiry-accordion-head-left"> |
| [403](#L403) | <?php if( !empty( $reply["type"]) && "response" == $reply["type"]) : ?> |
| [404](#L404) | <i class="ri-reply-all-line tf-enquiry-response-user"></i> |
| [405](#L405) | <?php echo !empty( $reply["reply\_user"]) ? $reply["reply\_user"] : esc\_html\_\_("User", "tourfic"); ?> |
| [406](#L406) | <?php else: ?> |
| [407](#L407) | <i class="ri-reply-all-line"></i> |
| [408](#L408) | <?php esc\_html\_e("You", 'tourfic') ?> |
| [409](#L409) | <?php endif; ?> |
| [410](#L410) | <span class="tf-single-accordion-dash"><?php esc\_html\_e('―', 'tourfic') ?></span> |
| [411](#L411) | <span class="tf-single-accordion-subject"> |
| [412](#L412) | <?php if( $email\_body\_setting == 'html'): ?> |
| [413](#L413) | <?php echo !empty($reply["reply\_message\_html"]) ? ( wp\_kses\_post( strlen( strip\_tags( $reply["reply\_message\_html"] ) ) > 75 ? esc\_html\_\_( Helper::tourfic\_character\_limit\_callback( strip\_tags( $reply["reply\_message\_html"] ), 75 ) , 'tourfic' ) : esc\_html\_\_( strip\_tags( $reply["reply\_message\_html"] ) ), 'tourfic' )) : esc\_html\_\_( Helper::tourfic\_character\_limit\_callback( strip\_tags( $reply["reply\_message"] ), 75 ), "tourfic"); ?> |
| [414](#L414) | <?php elseif( $email\_body\_setting == 'text'): ?> |
| [415](#L415) | <?php echo !empty($reply["reply\_message\_text"]) ? ( wp\_kses\_post( strlen( $reply["reply\_message\_text"] ) > 75 ? esc\_html\_\_( Helper::tourfic\_character\_limit\_callback( $reply["reply\_message\_text"], 75 ) , 'tourfic' ) : esc\_html\_\_( $reply["reply\_message\_text"] ) , 'tourfic' )) :  esc\_html\_\_( Helper::tourfic\_character\_limit\_callback( strip\_tags( $reply["reply\_message"] ), 75 ), "tourfic"); ?> |
| [416](#L416) | <?php endif; ?> |
| [417](#L417) | </span> |
| [418](#L418) | </div> |
| [419](#L419) | <div class="tf-single-enquiry-accordion-head-right"> |
| [420](#L420) | <?php // esc\_html\_e( date( "M d, Y h:i:s A", strtotime($reply["submit\_time"])) ); ?> |
| [421](#L421) | <?php  esc\_html\_e( self::time\_elapsed\_string( $reply["submit\_time"]) ); ?> |
| [422](#L422) | </div> |
| [423](#L423) | </div> |
| [424](#L424) | <div id="tf-single-enquiry-accordion-<?php echo esc\_attr($key) ?>" class="tf-single-enquiry-collapse"> |
| [425](#L425) | <div class="tf-single-accordion-body"> |
| [426](#L426) | <?php |
| [427](#L427) | if( $email\_body\_setting == 'html' ) { |
| [428](#L428) | echo !empty($reply["reply\_message\_html"]) ? wp\_kses\_post($reply["reply\_message\_html"]) : $reply["reply\_message"]; |
| [429](#L429) | } else if( $email\_body\_setting == 'text' ) { |
| [430](#L430) | echo !empty($reply["reply\_message\_text"]) ? wp\_kses\_post(wpautop($reply["reply\_message\_text"])) : $reply["reply\_message"]; |
| [431](#L431) | } |
| [432](#L432) | ?> |
| [433](#L433) | </div> |
| [434](#L434) | </div> |
| [435](#L435) | <hr> |
| [436](#L436) | </div> |
| [437](#L437) | <?php endforeach; ?> |
| [438](#L438) | <?php endif; ?> |
| [439](#L439) | </div> |
| [440](#L440) | <div class="tf-single-enquiry-details-content"> |
| [441](#L441) | <?php if( count($reply\_data) > 0 ): ?> |
| [442](#L442) | <div class="tf-single-enquiry-reply-another-mail-button"> |
| [443](#L443) | <span> <?php esc\_html\_e( "Send Another Mail", 'tourfic') ?> </span> |
| [444](#L444) | <i class="ri-mail-line"></i> |
| [445](#L445) | </div> |
| [446](#L446) | <?php endif; ?> |
| [447](#L447) | <form id="tf-single-enquiry-reply-form" method="post" style="<?php echo count($reply\_data) > 0 ? 'display:none;' : '' ?>" action> |
| [448](#L448) | <?php |
| [449](#L449) | $editor\_id = 'tf-enquiry-reply-editor'; |
| [450](#L450) | $settings = array( |
| [451](#L451) | 'textarea\_name' => 'my\_custom\_textarea\_name', |
| [452](#L452) | 'textarea\_rows' => 20, |
| [453](#L453) | 'media\_buttons' => false, |
| [454](#L454) | 'wpautop' => true, |
| [455](#L455) | 'teeny' => true, |
| [456](#L456) | ); |
| [457](#L457) |  |
| [458](#L458) | wp\_editor('', $editor\_id, $settings); |
| [459](#L459) | ?> |
| [460](#L460) |  |
| [461](#L461) | <input type="hidden" class="tf-enquiry-reply-email" value="<?php echo esc\_html($data["uemail"]); ?>"> |
| [462](#L462) | <input type="hidden" class="tf-enquiry-reply-name" value="<?php echo esc\_html($data["uname"]); ?>"> |
| [463](#L463) | <input type="hidden" class="tf-enquiry-reply-id" value="<?php echo esc\_html($data["id"]); ?>"> |
| [464](#L464) | <input type="hidden" class="tf-enquiry-reply-post-id" value="<?php echo esc\_html($data["post\_id"]); ?>"> |
| [465](#L465) | <input type="hidden" name="tf-enquiry-reply-post-userID" value="<?php echo $\_SESSION['WP']['userId']; ?>" /> |
| [466](#L466) |  |
| [467](#L467) | <button class="tf-enquiry-reply-button" type="submit"> |
| [468](#L468) | <?php esc\_html\_e('Send', 'tourfic') ?> |
| [469](#L469) | <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"> |
| [470](#L470) | <g clip-path="url(#clip0\_2455\_191)"> |
| [471](#L471) | <path d="M18.3333 1.66667L12.5 18.3333L9.16662 10.8333L1.66663 7.5L18.3333 1.66667Z" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path> |
| [472](#L472) | <path d="M18.3333 1.66667L9.16663 10.8333" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path> |
| [473](#L473) | </g> |
| [474](#L474) | <defs> |
| [475](#L475) | <clipPath id="clip0\_2455\_191"> |
| [476](#L476) | <rect width="20" height="20" fill="white"></rect> |
| [477](#L477) | </clipPath> |
| [478](#L478) | </defs> |
| [479](#L479) | </svg> |
| [480](#L480) | </button> |
| [481](#L481) | </form> |
| [482](#L482) | </div> |
| [483](#L483) | </div> <!-- Enquiry mail Reply Wrapper - End --> |
| [484](#L484) | <?php else: ?> |
| [485](#L485) | <div class="tf-field tf-field-notice tf-pro-notice " style="width:100%;"> |
| [486](#L486) | <div class="tf-fieldset"> |
| [487](#L487) | <div class="tf-field-notice-inner tf-notice-info"> |
| [488](#L488) | <div class="tf-field-notice-icon"> |
| [489](#L489) | <i class="ri-information-fill"></i> |
| [490](#L490) | </div> |
| [491](#L491) | <div class="tf-field-notice-content has-content"> |
| [492](#L492) | <?php echo wp\_kses\_post(sprintf(\_\_("We're offering some exiting features like %1s sending reply from enquiry details page %2s and %1s get replies using email piping %2s in our pro plan.", 'tourfic'), '<b>', '</b>', '<b>', '</b>')) ?> <a href="https://themefic.com/tourfic/pricing" target="\_blank"> <?php echo esc\_html\_\_("Upgrade to our pro package today to take advantage of these fantastic options!", 'tourfic') ?></a> |
| [493](#L493) | </div> |
| [494](#L494) | </div> |
| [495](#L495) | </div> |
| [496](#L496) | </div> |
| [497](#L497) | <?php endif; ?> |
| [498](#L498) | </div> <!-- Enquiry Details Left - End --> |
| [499](#L499) | <div class="tf-single-enquiry-right"> <!-- Enquiry Details Right - Start --> |
| [500](#L500) | <div class="tf-enquiry-single-log-details"> |
| [501](#L501) | <div class="tf-singe-enquiry-log-details-heading"> |
| [502](#L502) | <h2> <?php esc\_html\_e("Log Details #", 'tourfic') . esc\_html\_e($data["id"]); ?> </h2> |
| [503](#L503) | <div class="enquiry-details-status"> |
| [504](#L504) | <svg xmlns="http://www.w3.org/2000/svg" width="6" height="6" viewBox="0 0 6 6" fill="none"> |
| [505](#L505) | <circle cx="3" cy="3" r="3" fill="#27BE69"/> |
| [506](#L506) | </svg> |
| [507](#L507) |  |
| [508](#L508) | <div class="enquiry-status-value"> <?php !empty( $data["enquiry\_status"] ) ? esc\_html\_e(ucfirst( $data["enquiry\_status"] ), 'tourfic') : '' ?> </div> |
| [509](#L509) | </div> |
| [510](#L510) | </div> |
| [511](#L511) | <hr class="enqury-single-title-line"> |
| [512](#L512) | <div class="tf-single-enquiry-log-details-content"> |
| [513](#L513) | <?php if( !empty( $server\_data )): ?> |
| [514](#L514) | <div class="tf-single-enquiry-log-details-single"> <!-- Single Log Details IP - Start --> |
| [515](#L515) | <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none"> |
| [516](#L516) | <g clip-path="url(#clip0\_660\_8611)"> |
| [517](#L517) | <path d="M15 6.66669C15 10.4167 10 14.1667 10 14.1667C10 14.1667 5 10.4167 5 6.66669C5 5.3406 5.52678 4.06883 6.46447 3.13115C7.40215 2.19347 8.67392 1.66669 10 1.66669C11.3261 1.66669 12.5979 2.19347 13.5355 3.13115C14.4732 4.06883 15 5.3406 15 6.66669Z" stroke="#5D5676" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/> |
| [518](#L518) | <path d="M10 8.33333C10.9205 8.33333 11.6667 7.58714 11.6667 6.66667C11.6667 5.74619 10.9205 5 10 5C9.07957 5 8.33337 5.74619 8.33337 6.66667C8.33337 7.58714 9.07957 8.33333 10 8.33333Z" stroke="#5D5676" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/> |
| [519](#L519) | <path d="M7.36246 11.6667H4.16663C3.99707 11.6759 3.83438 11.7367 3.70035 11.841C3.56631 11.9452 3.46732 12.088 3.41663 12.25L1.74996 17.25C1.66663 17.3334 1.66663 17.4167 1.66663 17.5C1.66663 18 1.99996 18.3334 2.49996 18.3334H17.5C18 18.3334 18.3333 18 18.3333 17.5C18.3333 17.4167 18.3333 17.3334 18.25 17.25L16.5833 12.25C16.5326 12.088 16.4336 11.9452 16.2996 11.841C16.1655 11.7367 16.0028 11.6759 15.8333 11.6667H12.6375" stroke="#5D5676" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/> |
| [520](#L520) | </g> |
| [521](#L521) | <defs> |
| [522](#L522) | <clipPath id="clip0\_660\_8611"> |
| [523](#L523) | <rect width="20" height="20" fill="white"/> |
| [524](#L524) | </clipPath> |
| [525](#L525) | </defs> |
| [526](#L526) | </svg> |
| [527](#L527) | <span class="tf-single-enquiry-log-details-single-value" data-enquiry-copy-text="<?php echo esc\_attr($server\_data["ip\_address"]); ?>"> <?php echo esc\_html($server\_data["ip\_address"]); ?> </span> |
| [528](#L528) | <span class="tf-single-enquiry-log-details-single-copy"> <i class="ri-file-copy-line tf-single-enquiry-copy-btn"></i></span> |
| [529](#L529) | </div> |
| [530](#L530) |  |
| [531](#L531) | <div class="tf-single-enquiry-log-details-single"> <!-- Single Log Details Browser - Start --> |
| [532](#L532) | <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none"> |
| [533](#L533) | <g clip-path="url(#clip0\_660\_8615)"> |
| [534](#L534) | <path d="M9.99996 18.3334C14.6023 18.3334 18.3333 14.6024 18.3333 10C18.3333 5.39765 14.6023 1.66669 9.99996 1.66669C5.39759 1.66669 1.66663 5.39765 1.66663 10C1.66663 14.6024 5.39759 18.3334 9.99996 18.3334Z" stroke="#5D5676" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/> |
| [535](#L535) | <path d="M9.99996 1.66669C7.86015 3.91348 6.66663 6.8973 6.66663 10C6.66663 13.1027 7.86015 16.0866 9.99996 18.3334C12.1398 16.0866 13.3333 13.1027 13.3333 10C13.3333 6.8973 12.1398 3.91348 9.99996 1.66669Z" stroke="#5D5676" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/> |
| [536](#L536) | <path d="M1.66663 10H18.3333" stroke="#5D5676" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/> |
| [537](#L537) | </g> |
| [538](#L538) | <defs> |
| [539](#L539) | <clipPath id="clip0\_660\_8615"> |
| [540](#L540) | <rect width="20" height="20" fill="white"/> |
| [541](#L541) | </clipPath> |
| [542](#L542) | </defs> |
| [543](#L543) | </svg> |
| [544](#L544) | <span class="tf-single-enquiry-log-details-single-value"> <?php echo esc\_html\_\_($server\_data["browser\_name"], 'tourfic'); ?> </span> |
| [545](#L545) | </div> |
| [546](#L546) | <div class="tf-single-enquiry-log-details-single"> <!-- Single Log Details Device - Start --> |
| [547](#L547) | <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none"> |
| [548](#L548) | <path d="M15 1.66669H5.00004C4.07957 1.66669 3.33337 2.41288 3.33337 3.33335V16.6667C3.33337 17.5872 4.07957 18.3334 5.00004 18.3334H15C15.9205 18.3334 16.6667 17.5872 16.6667 16.6667V3.33335C16.6667 2.41288 15.9205 1.66669 15 1.66669Z" stroke="#5D5676" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/> |
| [549](#L549) | <path d="M10 15H10.0083" stroke="#5D5676" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/> |
| [550](#L550) | </svg> |
| [551](#L551) | <span class="tf-single-enquiry-log-details-single-value"> <?php echo esc\_html($server\_data["os\_name"]); ?> </span> |
| [552](#L552) | </div> |
| [553](#L553) | <?php endif; ?> |
| [554](#L554) | <div class="tf-single-enquiry-log-details-single"> <!-- Single Log Details Date - Start --> |
| [555](#L555) | <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none"> |
| [556](#L556) | <path d="M15.8333 3.33331H4.16667C3.24619 3.33331 2.5 4.07951 2.5 4.99998V16.6666C2.5 17.5871 3.24619 18.3333 4.16667 18.3333H15.8333C16.7538 18.3333 17.5 17.5871 17.5 16.6666V4.99998C17.5 4.07951 16.7538 3.33331 15.8333 3.33331Z" stroke="#5D5676" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/> |
| [557](#L557) | <path d="M13.3334 1.66669V5.00002" stroke="#5D5676" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/> |
| [558](#L558) | <path d="M6.66663 1.66669V5.00002" stroke="#5D5676" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/> |
| [559](#L559) | <path d="M2.5 8.33331H17.5" stroke="#5D5676" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/> |
| [560](#L560) | <path d="M6.66663 11.6667H6.67663" stroke="#5D5676" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/> |
| [561](#L561) | <path d="M10 11.6667H10.01" stroke="#5D5676" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/> |
| [562](#L562) | <path d="M13.3334 11.6667H13.3434" stroke="#5D5676" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/> |
| [563](#L563) | <path d="M6.66663 15H6.67663" stroke="#5D5676" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/> |
| [564](#L564) | <path d="M10 15H10.01" stroke="#5D5676" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/> |
| [565](#L565) | <path d="M13.3334 15H13.3434" stroke="#5D5676" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/> |
| [566](#L566) | </svg> |
| [567](#L567) | <span class="tf-single-enquiry-log-details-single-value"> <?php echo esc\_html($formateed\_date); ?> </span> |
| [568](#L568) | </div> |
| [569](#L569) | <div class="tf-single-enquiry-log-details-single"> <!-- Single Log Details Time - Start --> |
| [570](#L570) | <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none"> |
| [571](#L571) | <g clip-path="url(#clip0\_660\_8624)"> |
| [572](#L572) | <path d="M9.99996 18.3334C14.6023 18.3334 18.3333 14.6024 18.3333 10C18.3333 5.39765 14.6023 1.66669 9.99996 1.66669C5.39759 1.66669 1.66663 5.39765 1.66663 10C1.66663 14.6024 5.39759 18.3334 9.99996 18.3334Z" stroke="#5D5676" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/> |
| [573](#L573) | <path d="M10 5V10L13.3333 11.6667" stroke="#5D5676" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/> |
| [574](#L574) | </g> |
| [575](#L575) | <defs> |
| [576](#L576) | <clipPath id="clip0\_660\_8624"> |
| [577](#L577) | <rect width="20" height="20" fill="white"/> |
| [578](#L578) | </clipPath> |
| [579](#L579) | </defs> |
| [580](#L580) | </svg> |
| [581](#L581) | <span class="tf-single-enquiry-log-details-single-value"> <?php echo esc\_html( $formateed\_time ); ?> </span> |
| [582](#L582) | </div> |
| [583](#L583) | </div> |
| [584](#L584) | </div> |
| [585](#L585) | </div> |
| [586](#L586) | </div> <!-- Enquiry Details Main Wrapper - End --> |
| [587](#L587) | </div> |
| [588](#L588) |  |
| [589](#L589) | <?php |
| [590](#L590) | } |
| [591](#L591) |  |
| [592](#L592) | static function time\_elapsed\_string($datetime) { |
| [593](#L593) |  |
| [594](#L594) | $timezone = wp\_timezone(); |
| [595](#L595) |  |
| [596](#L596) | $now = new \DateTime('now', $timezone); |
| [597](#L597) |  |
| [598](#L598) | $ago = new \DateTime($datetime, $timezone); |
| [599](#L599) |  |
| [600](#L600) | $diff = $now->diff($ago); |
| [601](#L601) |  |
| [602](#L602) | if ($diff->h == 0 && $diff->d == 0) { |
| [603](#L603) | $minutes = $diff->i; |
| [604](#L604) | if ($minutes == 0) { |
| [605](#L605) | return esc\_html\_\_('Just now', 'tourfic'); |
| [606](#L606) | } elseif ($minutes == 1) { |
| [607](#L607) | return '1 minute ago'; |
| [608](#L608) | } else { |
| [609](#L609) | return sprintf(esc\_html\_\_('%s minutes ago', 'tourfic'), $minutes); |
| [610](#L610) | } |
| [611](#L611) | } |
| [612](#L612) |  |
| [613](#L613) | if ($diff->d == 0) { |
| [614](#L614) | return 'Today ' . $ago->format('h:i A'); |
| [615](#L615) | } |
| [616](#L616) |  |
| [617](#L617) | if ($diff->d == 1) { |
| [618](#L618) | return 'Yesterday ' . $ago->format('h:i A'); |
| [619](#L619) | } |
| [620](#L620) |  |
| [621](#L621) | if ($diff->d > 1) { |
| [622](#L622) | return $ago->format('M d, Y h:i A'); |
| [623](#L623) | } |
| [624](#L624) | } |
| [625](#L625) |  |
| [626](#L626) | static function convert\_to\_wp\_timezone($date\_string, $format = 'Y-m-d H:i:s') { |
| [627](#L627) | $timezone = wp\_timezone(); |
| [628](#L628) |  |
| [629](#L629) | try { |
| [630](#L630) | $date = new \DateTime($date\_string, new \DateTimeZone('UTC')); |
| [631](#L631) |  |
| [632](#L632) | $date->setTimezone($timezone); |
| [633](#L633) |  |
| [634](#L634) | return $date->format($format); |
| [635](#L635) | } catch (\Exception $e) { |
| [636](#L636) | return 'Invalid date'; |
| [637](#L637) | } |
| [638](#L638) | } |
| [639](#L639) |  |
| [640](#L640) |  |
| [641](#L641) |  |
| [642](#L642) | public function enquiry\_table\_data( $post\_type = '', $post\_id = '', $status = '', $offset = 0, $per\_page = 0 ) { |
| [643](#L643) |  |
| [644](#L644) | global $wpdb; |
| [645](#L645) | $query = "SELECT \* FROM {$wpdb->prefix}tf\_enquiry\_data WHERE "; |
| [646](#L646) | $enquiry\_data = array(); |
| [647](#L647) |  |
| [648](#L648) | if( !empty($post\_type) ) { |
| [649](#L649) | $query .= sprintf(' post\_type = "%s"', $post\_type); |
| [650](#L650) | } |
| [651](#L651) |  |
| [652](#L652) | if(!empty($post\_type) && ( !empty($post\_id) || !empty($status)) ) { |
| [653](#L653) | $query .= ' AND'; |
| [654](#L654) | } |
| [655](#L655) |  |
| [656](#L656) | if( !empty($post\_id) ) { |
| [657](#L657) | $query.= sprintf(' post\_id = %d', $post\_id ); |
| [658](#L658) | } |
| [659](#L659) |  |
| [660](#L660) | if( !empty($post\_type) && !empty($post\_id) && !empty($status) ) { |
| [661](#L661) | $query .= ' AND'; |
| [662](#L662) | } |
| [663](#L663) |  |
| [664](#L664) | if( !empty($status) ) { |
| [665](#L665) |  |
| [666](#L666) | if( $status == 'not-replied') { |
| [667](#L667) | $query.= sprintf(' enquiry\_status != "%s"', 'replied' ); |
| [668](#L668) | } elseif( $status == 'not-responded') { |
| [669](#L669) | $query.= sprintf(' enquiry\_status != "%s"', 'responded' ); |
| [670](#L670) | } else { |
| [671](#L671) | $query.= sprintf(' enquiry\_status = "%s"', $status ); |
| [672](#L672) | } |
| [673](#L673) | } |
| [674](#L674) |  |
| [675](#L675) | $query .= " ORDER BY id DESC"; |
| [676](#L676) |  |
| [677](#L677) | if( !empty( $offset ) && !empty( $per\_page ) ) { |
| [678](#L678) | $query .= sprintf(' LIMIT %d, %d', $offset, $per\_page); |
| [679](#L679) | } |
| [680](#L680) |  |
| [681](#L681) | $results = $wpdb->get\_results( $wpdb->prepare( $query ), ARRAY\_A ); |
| [682](#L682) |  |
| [683](#L683) | if( !empty($results) ) { |
| [684](#L684) | foreach( $results as $result ) { |
| [685](#L685) | $enquiry\_data[] = array( |
| [686](#L686) | 'id' => $result['id'], |
| [687](#L687) | 'post\_title' => get\_the\_title($result['post\_id']), |
| [688](#L688) | 'post\_type' => $result['post\_type'], |
| [689](#L689) | 'uname' => $result['uname'], |
| [690](#L690) | 'uemail' => $result['uemail'], |
| [691](#L691) | 'description' => $result['udescription'], |
| [692](#L692) | 'status' => $result['enquiry\_status'], |
| [693](#L693) | 'submit\_time' => $result['created\_at'] |
| [694](#L694) | ); |
| [695](#L695) | } |
| [696](#L696) | } |
| [697](#L697) |  |
| [698](#L698) | return $enquiry\_data; |
| [699](#L699) |  |
| [700](#L700) | } |
| [701](#L701) |  |
| [702](#L702) | function tourfic\_ask\_question() { |
| [703](#L703) | ?> |
| [704](#L704) | <div id="tf-ask-question" style="display: none;"> |
| [705](#L705) | <div class="tf-aq-overlay"></div> |
| [706](#L706) | <div class="tf-aq-outer"> |
| [707](#L707) | <span class="close-aq"> |
| [708](#L708) | <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none"> |
| [709](#L709) | <path d="M15 5L5 15" stroke="#4E667E" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/> |
| [710](#L710) | <path d="M5 5L15 15" stroke="#4E667E" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/> |
| [711](#L711) | </svg> |
| [712](#L712) | </span> |
| [713](#L713) | <div class="tf-aq-inner"> |
| [714](#L714) | <div class="tf-ask-question-head-content"> |
| [715](#L715) | <div class="ask-question-svg"> |
| [716](#L716) | <svg xmlns="http://www.w3.org/2000/svg" width="82" height="65" viewBox="0 0 82 65" fill="none"> |
| [717](#L717) | <path d="M39.8433 2.87109C51.7608 2.87109 58.7471 8.37858 58.7471 17.8305C58.7471 29.748 46.4165 32.1321 46.4165 40.763H32.6912C32.6912 28.5165 41.7326 27.2009 41.7326 20.8724C41.7326 18.4883 40.5827 17.42 38.1171 17.42C35.0752 17.42 33.678 19.4751 33.678 23.9143H19.5396C19.5396 10.681 27.0206 2.87109 39.8433 2.87109ZM47.7348 53.5041C47.7348 58.5169 44.2824 61.9693 39.2697 61.9693C34.3384 61.9693 30.8861 58.5169 30.8861 53.5041C30.8861 48.5729 34.3384 45.1206 39.2697 45.1206C44.2824 45.1206 47.7348 48.5729 47.7348 53.5041Z" |
| [718](#L718) | fill="#CFE6FC"/> |
| [719](#L719) | <path d="M41.688 1C53.6056 1 60.5919 6.50748 60.5919 15.9594C60.5919 27.8769 48.2612 30.261 48.2612 38.8919H34.5359C34.5359 26.6455 43.5774 25.3298 43.5774 19.0013C43.5774 16.6173 42.4274 15.5489 39.9618 15.5489C36.92 15.5489 35.5227 17.604 35.5227 22.0432H21.3843C21.3869 8.80731 28.8653 1 41.688 1ZM49.5795 51.6331C49.5795 56.6458 46.1272 60.0982 41.1144 60.0982C36.1832 60.0982 32.7308 56.6458 32.7308 51.6331C32.7308 46.7018 36.1832 43.2495 41.1144 43.2495C46.1272 43.2468 49.5795 46.6992 49.5795 51.6331Z" |
| [720](#L720) | stroke="#1B334B" stroke-width="1.5" stroke-miterlimit="10"/> |
| [721](#L721) | <path d="M24.1691 51.6832C19.7378 56.1144 15.0908 56.6644 11.5753 53.1515C7.14403 48.7202 10.8411 43.2496 7.63346 40.0393L12.7383 34.9344C17.2933 39.4893 14.4198 43.3391 16.7723 45.6941C17.659 46.5809 18.4827 46.5493 19.401 45.6336C20.5325 44.5021 20.2878 43.218 18.6379 41.5681L23.8954 36.3106C28.8161 41.2313 28.9371 46.9151 24.1691 51.6832ZM2.40754 35.7896C0.541888 33.924 0.541888 31.3584 2.40754 29.4927C4.24161 27.6587 6.80984 27.6587 8.67286 29.5243C10.5069 31.3584 10.5069 33.9266 8.67286 35.7607C6.80984 37.6237 4.24161 37.6237 2.40754 35.7896Z" |
| [722](#L722) | fill="#CFE6FC"/> |
| [723](#L723) | <path d="M24.1795 53.064C19.7483 57.4953 15.1012 58.0452 11.5857 54.5323C7.15447 50.1011 10.8516 44.6304 7.64391 41.4202L12.7488 36.3153C17.3037 40.8702 14.4302 44.7199 16.7827 47.075C17.6695 47.9618 18.4931 47.9302 19.4114 47.0145C20.5429 45.883 20.2982 44.5989 18.6483 42.949L23.9058 37.6915C28.8239 42.6122 28.9476 48.296 24.1795 53.064ZM2.41535 37.1705C0.549701 35.3048 0.549701 32.7392 2.41535 30.8736C4.24942 29.0395 6.81765 29.0395 8.68067 30.9052C10.5147 32.7392 10.5147 35.3075 8.68067 37.1415C6.81765 39.0046 4.24942 39.0046 2.41535 37.1705Z" |
| [724](#L724) | stroke="#1B334B" stroke-width="1.5" stroke-miterlimit="10"/> |
| [725](#L725) | <path d="M75.1344 30.6488C79.9683 34.638 80.9577 39.2113 77.7921 43.0452C73.8029 47.8791 68.0034 44.7188 65.1141 48.2185L59.5461 43.6241C63.6458 38.6561 67.7534 41.1506 69.8717 38.585C70.669 37.6193 70.5611 36.8009 69.5612 35.9747C68.327 34.9563 67.0719 35.3221 65.5878 37.122L59.8566 32.3855C64.2879 27.0201 69.9348 26.357 75.1344 30.6488ZM61.3828 53.8234C59.704 55.8574 57.1489 56.1021 55.1149 54.4233C53.115 52.7734 52.8703 50.2157 54.5491 48.1843C56.199 46.1845 58.7567 45.9397 60.7566 47.5922C62.7906 49.2684 63.0353 51.8235 61.3828 53.8234Z" |
| [726](#L726) | fill="#CFE6FC"/> |
| [727](#L727) | <path d="M76.5077 30.506C81.3416 34.4951 82.331 39.0685 79.1654 42.9024C75.1762 47.7363 69.3767 44.576 66.4874 48.0757L60.9194 43.4813C65.0191 38.5133 69.1267 41.0078 71.245 38.4422C72.0423 37.4765 71.9344 36.6581 70.9345 35.8319C69.7003 34.8135 68.4452 35.1793 66.9611 36.9792L61.2273 32.2453C65.6612 26.8747 71.3081 26.2116 76.5077 30.506ZM62.7561 53.6806C61.0773 55.7146 58.5222 55.9593 56.4882 54.2805C54.4883 52.6306 54.2436 50.0729 55.9224 48.0415C57.5723 46.0416 60.13 45.7969 62.1299 47.4494C64.1639 49.1256 64.4086 51.6807 62.7561 53.6806Z" |
| [728](#L728) | stroke="#1B334B" stroke-width="1.5" stroke-miterlimit="10"/> |
| [729](#L729) | <path d="M14.8461 23.9229C13.7856 22.073 12.7252 20.2231 11.6647 18.3733C11.4121 17.9338 10.7306 18.3285 10.9832 18.7706C12.0437 20.6205 13.1041 22.4703 14.1645 24.3202C14.4172 24.7623 15.0987 24.3649 14.8461 23.9229Z" |
| [730](#L730) | fill="#1B334B"/> |
| [731](#L731) | <path d="M17.0346 22.8627C16.9057 21.2681 16.7794 19.6708 16.6505 18.0762C16.611 17.5736 15.8216 17.5683 15.8611 18.0762C15.99 19.6708 16.1163 21.2681 16.2452 22.8627C16.2873 23.3679 17.0768 23.3705 17.0346 22.8627Z" |
| [732](#L732) | fill="#1B334B"/> |
| [733](#L733) | <path d="M12.3674 25.4572C11.2912 24.7546 10.2176 24.0494 9.14137 23.3468C8.71508 23.0679 8.31775 23.7521 8.74403 24.0283C9.82027 24.7309 10.8939 25.4361 11.9701 26.1387C12.3938 26.4176 12.7911 25.7335 12.3674 25.4572Z" |
| [734](#L734) | fill="#1B334B"/> |
| [735](#L735) | <path d="M63.754 20.4706C64.3934 19.1075 65.0302 17.7419 65.6696 16.3788C65.8828 15.9209 65.2039 15.521 64.9881 15.9815C64.3487 17.3445 63.7119 18.7102 63.0724 20.0733C62.8567 20.5311 63.5382 20.9311 63.754 20.4706Z" |
| [736](#L736) | fill="#1B334B"/> |
| [737](#L737) | <path d="M65.024 22.4106C66.7818 21.2449 68.5369 20.0819 70.2947 18.9162C70.7157 18.6372 70.321 17.9531 69.8973 18.2346C68.1396 19.4003 66.3844 20.5634 64.6267 21.7291C64.203 22.008 64.5977 22.6922 65.024 22.4106Z" |
| [738](#L738) | fill="#1B334B"/> |
| [739](#L739) | <path d="M66.0904 24.4261C67.5955 24.2129 69.1007 23.9998 70.6084 23.7866C71.1084 23.7156 70.8953 22.9551 70.3979 23.0262C68.8928 23.2393 67.3876 23.4524 65.8798 23.6656C65.3799 23.734 65.593 24.4945 66.0904 24.4261Z" |
| [740](#L740) | fill="#1B334B"/> |
| [741](#L741) | <path d="M50.6624 59.706C51.9308 61.4164 53.2017 63.1268 54.47 64.8346C54.77 65.2372 55.4542 64.8451 55.1516 64.4372C53.8832 62.7268 52.6123 61.0164 51.344 59.3087C51.044 58.9034 50.3572 59.2981 50.6624 59.706Z" |
| [742](#L742) | fill="#1B334B"/> |
| [743](#L743) | <path d="M53.1403 58.175C54.2166 58.8776 55.2902 59.5828 56.3664 60.2854C56.7927 60.5643 57.19 59.8802 56.7637 59.6039C55.6875 58.9013 54.6139 58.1961 53.5377 57.4935C53.1114 57.2146 52.7167 57.8961 53.1403 58.175Z" |
| [744](#L744) | fill="#1B334B"/> |
| [745](#L745) | <path d="M26.5213 58.8527C25.3767 60.6236 24.232 62.3919 23.0874 64.1628C22.8111 64.5917 23.4926 64.9864 23.7689 64.5601C24.9135 62.7892 26.0582 61.0209 27.2029 59.25C27.4791 58.8237 26.7976 58.4264 26.5213 58.8527Z" |
| [746](#L746) | fill="#1B334B"/> |
| [747](#L747) | <path d="M24.8085 57.3504C23.5139 58.1477 22.2192 58.945 20.922 59.7397C20.4904 60.0054 20.8851 60.6896 21.3193 60.4212C22.6139 59.6239 23.9086 58.8266 25.2058 58.0319C25.64 57.7661 25.2427 57.082 24.8085 57.3504Z" |
| [748](#L748) | fill="#1B334B"/> |
| [749](#L749) | </svg> |
| [750](#L750) | </div> |
| [751](#L751) | <h3><?php esc\_html\_e( 'Your Question', 'tourfic' ); ?></h3> |
| [752](#L752) | </div> |
| [753](#L753) |  |
| [754](#L754) | <form id="ask-question" action="" method="post"> |
| [755](#L755) | <div class="tf-aq-field"> |
| [756](#L756) | <label for="your-name"><?php esc\_html\_e( 'Name', 'tourfic' ); ?></label> |
| [757](#L757) | <input type="text" name="your-name" placeholder="<?php esc\_attr\_e( 'Type full name', 'tourfic' ); ?>" required/> |
| [758](#L758) | </div> |
| [759](#L759) | <div class="tf-aq-field"> |
| [760](#L760) | <label for="your-email"><?php esc\_html\_e( 'Email', 'tourfic' ); ?></label> |
| [761](#L761) | <input type="email" name="your-email" placeholder="<?php esc\_attr\_e( 'Type email', 'tourfic' ); ?>" required/> |
| [762](#L762) | </div> |
| [763](#L763) | <div class="tf-aq-field"> |
| [764](#L764) | <label for="your-question"><?php esc\_html\_e( 'Question', 'tourfic' ); ?></label> |
| [765](#L765) | <textarea placeholder="<?php esc\_attr\_e( 'Type here...', 'tourfic' ); ?>" name="your-question" required></textarea> |
| [766](#L766) | </div> |
| [767](#L767) | <div class="tf-aq-field"> |
| [768](#L768) | <button type="reset" class="screen-reader-text"><?php esc\_html\_e( 'Reset', 'tourfic' ); ?></button> |
| [769](#L769) | <button type="submit" form="ask-question" class="button tf\_button tf-ask-question-submit"><?php esc\_html\_e( 'Submit', 'tourfic' ); ?></button> |
| [770](#L770) | <input type="hidden" name="post\_id" value="<?php echo esc\_attr( get\_the\_ID() ); ?>"> |
| [771](#L771) | <?php wp\_nonce\_field( 'ask\_question\_nonce' ); ?> |
| [772](#L772) | <div class="response"></div> |
| [773](#L773) | </div> |
| [774](#L774) | </form> |
| [775](#L775) |  |
| [776](#L776) | </div> |
| [777](#L777) | </div> |
| [778](#L778) | </div> |
| [779](#L779) | <?php |
| [780](#L780) | } |
| [781](#L781) |  |
| [782](#L782) | function tourfic\_ask\_question\_ajax() { |
| [783](#L783) |  |
| [784](#L784) | $response = array(); |
| [785](#L785) |  |
| [786](#L786) | if ( ! check\_ajax\_referer( 'ask\_question\_nonce' ) ) { |
| [787](#L787) | $response['status'] = 'error'; |
| [788](#L788) | $response['msg']    = esc\_html\_\_( 'Security error! Reload the page and try again.', 'tourfic' ); |
| [789](#L789) | echo wp\_json\_encode( $response ); |
| [790](#L790) | wp\_die(); |
| [791](#L791) | } |
| [792](#L792) |  |
| [793](#L793) | $name     = isset( $\_POST['your-name'] ) ? sanitize\_text\_field( $\_POST['your-name'] ) : null; |
| [794](#L794) | $email    = isset( $\_POST['your-email'] ) ? sanitize\_email( $\_POST['your-email'] ) : null; |
| [795](#L795) | $question = isset( $\_POST['your-question'] ) ? sanitize\_text\_field( $\_POST['your-question'] ) : null; |
| [796](#L796) | $from = "From: " . get\_option( 'blogname' ) . " <" . get\_option( 'admin\_email' ) . ">\r\n"; |
| [797](#L797) |  |
| [798](#L798) | $post\_id    = isset( $\_POST['post\_id'] ) ? intval( $\_POST['post\_id'] ) : null; |
| [799](#L799) | $post\_title = get\_the\_title( $post\_id ); |
| [800](#L800) |  |
| [801](#L801) | // Server Details |
| [802](#L802) | $user\_agent = isset( $\_SERVER['HTTP\_USER\_AGENT'] ) ? $\_SERVER['HTTP\_USER\_AGENT'] : ''; |
| [803](#L803) | $browser\_name = $this->tf\_get\_browser\_name( $user\_agent ); |
| [804](#L804) | $os\_name = php\_uname( 's' ); |
| [805](#L805) | $ip\_address = isset( $\_SERVER['REMOTE\_ADDR'] ) ? $\_SERVER['REMOTE\_ADDR'] : ''; |
| [806](#L806) |  |
| [807](#L807) | $server\_details = array( |
| [808](#L808) | 'browser\_name' => $browser\_name, |
| [809](#L809) | 'os\_name'      => $os\_name, |
| [810](#L810) | 'ip\_address'   => $ip\_address, |
| [811](#L811) | 'time'          => date\_i18n( 'Y-m-d H:i:s', current\_time( 'timestamp' ) ) |
| [812](#L812) | ); |
| [813](#L813) |  |
| [814](#L814) |  |
| [815](#L815) |  |
| [816](#L816) | //post author mail |
| [817](#L817) | $author\_id   = get\_post\_field( 'post\_author', $post\_id ); |
| [818](#L818) | $author\_mail = get\_the\_author\_meta( 'user\_email', $author\_id ); |
| [819](#L819) |  |
| [820](#L820) | // Post Author Data |
| [821](#L821) | $author\_data = get\_userdata( $author\_id ); |
| [822](#L822) |  |
| [823](#L823) | // Enquiry Store on Database |
| [824](#L824) | $tf\_post\_author\_id = get\_post\_field( 'post\_author', $post\_id ); |
| [825](#L825) | $tf\_user\_meta      = get\_userdata( $tf\_post\_author\_id ); |
| [826](#L826) | $tf\_user\_roles     = $tf\_user\_meta->roles; |
| [827](#L827) |  |
| [828](#L828) | /\*\* |
| [829](#L829) | \* Enquiry Pabbly Integration |
| [830](#L830) | \* @author Jahid |
| [831](#L831) | \*/ |
| [832](#L832) | if ( function\_exists( 'is\_tf\_pro' ) && is\_tf\_pro() ) { |
| [833](#L833) | do\_action( 'enquiry\_pabbly\_form\_trigger', $post\_id, $name, $email, $question ); |
| [834](#L834) | do\_action( 'enquiry\_zapier\_form\_trigger', $post\_id, $name, $email, $question ); |
| [835](#L835) | } |
| [836](#L836) |  |
| [837](#L837) | if ( "tf\_hotel" == get\_post\_type( $post\_id ) ) { |
| [838](#L838) | $send\_email\_to[] = ! empty( Helper::tfopt( 'h-enquiry-email' ) ) ? sanitize\_email( Helper::tfopt( 'h-enquiry-email' ) ) : sanitize\_email( get\_option( 'admin\_email' ) ); |
| [839](#L839) | } elseif ( "tf\_apartment" == get\_post\_type( $post\_id ) ) { |
| [840](#L840) | $send\_email\_to[] = ! empty( $author\_mail ) ? sanitize\_email( $author\_mail ) : sanitize\_email( get\_option( 'admin\_email' ) ); |
| [841](#L841) | } else { |
| [842](#L842) | $send\_email\_to[] = ! empty( Helper::tfopt( 't-enquiry-email' ) ) ? sanitize\_email( Helper::tfopt( 't-enquiry-email' ) ) : sanitize\_email( get\_option( 'admin\_email' ) ); |
| [843](#L843) | } |
| [844](#L844) |  |
| [845](#L845) | $tf\_vendor\_email\_enable\_setting = ! empty( Helper::tfopt( 'email\_template\_settings' )['enable\_vendor\_enquiry\_email'] ) ? Helper::tfopt( 'email\_template\_settings' )['enable\_vendor\_enquiry\_email'] : 0; |
| [846](#L846) |  |
| [847](#L847) |  |
| [848](#L848) | if ( function\_exists( 'is\_tf\_pro' ) && is\_tf\_pro() && ( $tf\_vendor\_email\_enable\_setting == 1 ) ) { |
| [849](#L849) | if ( in\_array( "tf\_vendor", $tf\_user\_roles ) ) { |
| [850](#L850) | if ( "tf\_hotel" == get\_post\_type( $post\_id ) ) { |
| [851](#L851) | $send\_email\_to[] = ! empty( $author\_mail ) ? $author\_mail : ''; |
| [852](#L852) | } elseif ( "tf\_tours" == get\_post\_type( $post\_id ) ) { |
| [853](#L853) | $send\_email\_to[] = ! empty( $author\_mail ) ? $author\_mail : ''; |
| [854](#L854) | } |
| [855](#L855) | } |
| [856](#L856) | } |
| [857](#L857) |  |
| [858](#L858) | $subject     = esc\_html\_\_( 'Someone asked question on: ', 'tourfic' ) . esc\_html( $post\_title ); |
| [859](#L859) | $message     = "{$question}"; |
| [860](#L860) | $headers[]   = 'Content-Type: text/html; charset=UTF-8'; |
| [861](#L861) | $headers[]   = $from; |
| [862](#L862) |  |
| [863](#L863) | $user\_permission = Helper::tf\_data\_types( Helper::tfopt( 'tf\_user\_permission' ) ); |
| [864](#L864) | $vendor\_access = isset( $user\_permission['vendor\_can\_manage'] ) ? $user\_permission['vendor\_can\_manage'] : array(); |
| [865](#L865) | $manager\_access = isset( $user\_permission['manager\_can\_manage'] ) ? $user\_permission['manager\_can\_manage'] : array(); |
| [866](#L866) |  |
| [867](#L867) |  |
| [868](#L868) | if ( ( !empty( $vendor\_access ) && ! in\_array( 'enquiry\_email', $vendor\_access )) || ( !empty( $manager\_access ) && ! in\_array( 'enquiry\_email', $manager\_access ) ) ) { |
| [869](#L869) | $headers[] = 'Reply-To: ' . get\_option( 'blogname' ) . ' <' . get\_option( 'admin\_email' ) . '>'; |
| [870](#L870) | } else { |
| [871](#L871) | $headers[] = 'Reply-To: ' . $name . ' <' . $email . '>'; |
| [872](#L872) | } |
| [873](#L873) |  |
| [874](#L874) | $attachments = array(); |
| [875](#L875) |  |
| [876](#L876) |  |
| [877](#L877) | if ( wp\_mail( $send\_email\_to, $subject, $message, $headers, $attachments ) ) { |
| [878](#L878) |  |
| [879](#L879) | $response['status'] = 'sent'; |
| [880](#L880) | $response['msg']    = esc\_html\_\_( 'Your question has been sent!', 'tourfic' ); |
| [881](#L881) |  |
| [882](#L882) | // Data Store to the DB |
| [883](#L883) | global $wpdb; |
| [884](#L884) | $wpdb->query( |
| [885](#L885) | $wpdb->prepare( |
| [886](#L886) | "INSERT INTO {$wpdb->prefix}tf\_enquiry\_data |
| [887](#L887) | ( post\_id, post\_type, uname, uemail, udescription, author\_id, author\_roles, enquiry\_status, server\_data, created\_at ) |
| [888](#L888) | VALUES ( %d, %s, %s, %s, %s, %d, %s, %s, %s, %s )", |
| [889](#L889) | array( |
| [890](#L890) | sanitize\_key( $post\_id ), |
| [891](#L891) | get\_post\_type( $post\_id ), |
| [892](#L892) | $name, |
| [893](#L893) | $email, |
| [894](#L894) | $question, |
| [895](#L895) | sanitize\_key( $tf\_post\_author\_id ), |
| [896](#L896) | $tf\_user\_roles[0], |
| [897](#L897) | 'unread', |
| [898](#L898) | json\_encode( $server\_details ), |
| [899](#L899) | current\_time('mysql') |
| [900](#L900) | ) |
| [901](#L901) | ) |
| [902](#L902) | ); |
| [903](#L903) | $this->last\_id = $wpdb->insert\_id; |
| [904](#L904) | } else { |
| [905](#L905) | $response['status'] = 'error'; |
| [906](#L906) | $response['msg']    = esc\_html\_\_( 'Message sent failed!', 'tourfic' ); |
| [907](#L907) | } |
| [908](#L908) |  |
| [909](#L909) | if ( function\_exists( 'is\_tf\_pro' ) && is\_tf\_pro() && $tf\_vendor\_email\_enable\_setting != 1 ) { |
| [910](#L910) | if ( in\_array( "tf\_vendor", $tf\_user\_roles ) ) { |
| [911](#L911) | if( self::tf\_vendor\_default\_enquiry\_mail( $author\_mail, $post\_id, $name, $question, $this->last\_id ) ) { |
| [912](#L912) | } else { |
| [913](#L913) | $response['status'] = 'error'; |
| [914](#L914) | $response['msg']    = esc\_html\_\_( 'Message sent failed!', 'tourfic' ); |
| [915](#L915) | } |
| [916](#L916) | } |
| [917](#L917) | } |
| [918](#L918) |  |
| [919](#L919) | echo wp\_json\_encode( $response ); |
| [920](#L920) |  |
| [921](#L921) | die(); |
| [922](#L922) | } |
| [923](#L923) |  |
| [924](#L924) | function tf\_enquiry\_bulk\_action\_callback() { |
| [925](#L925) | $response = array(); |
| [926](#L926) |  |
| [927](#L927) | if ( ! check\_ajax\_referer('updates', '\_ajax\_nonce') ) { |
| [928](#L928) | $response['status'] = 'error'; |
| [929](#L929) | $response['msg']    = esc\_html\_\_( 'Security error! Reload the page and try again.', 'tourfic' ); |
| [930](#L930) | echo wp\_json\_encode( $response ); |
| [931](#L931) | wp\_die(); |
| [932](#L932) | } |
| [933](#L933) |  |
| [934](#L934) | $enquiry\_ids = isset( $\_POST['selected\_items'] ) ? $\_POST['selected\_items'] : array(); |
| [935](#L935) | $bulk\_action = isset( $\_POST['bulk\_action'] ) ? $\_POST['bulk\_action'] : ''; |
| [936](#L936) |  |
| [937](#L937) | if ( empty( $enquiry\_ids ) ) { |
| [938](#L938) | $response['status'] = 'error'; |
| [939](#L939) | $response['msg']    = esc\_html\_\_( 'No enquiry selected!', 'tourfic' ); |
| [940](#L940) | echo wp\_json\_encode( $response ); |
| [941](#L941) | wp\_die(); |
| [942](#L942) | } |
| [943](#L943) |  |
| [944](#L944) | if ( empty( $bulk\_action ) ) { |
| [945](#L945) | $response['status'] = 'error'; |
| [946](#L946) | $response['msg']    = esc\_html\_\_( 'Select an action first!', 'tourfic' ); |
| [947](#L947) | echo wp\_json\_encode( $response ); |
| [948](#L948) | wp\_die(); |
| [949](#L949) | } |
| [950](#L950) |  |
| [951](#L951) | global $wpdb; |
| [952](#L952) |  |
| [953](#L953) | if ( 'trash' == $bulk\_action ) { |
| [954](#L954) | foreach ( $enquiry\_ids as $enquiry\_id ) { |
| [955](#L955) | $wpdb->query( |
| [956](#L956) | $wpdb->prepare( |
| [957](#L957) | "DELETE FROM {$wpdb->prefix}tf\_enquiry\_data WHERE id=%d", |
| [958](#L958) | $enquiry\_id |
| [959](#L959) | ) |
| [960](#L960) | ); |
| [961](#L961) | } |
| [962](#L962) | } else if( 'mark-as-read' == $bulk\_action ) { |
| [963](#L963) | foreach ( $enquiry\_ids as $enquiry\_id ) { |
| [964](#L964) | $wpdb->query( |
| [965](#L965) | $wpdb->prepare( |
| [966](#L966) | "UPDATE {$wpdb->prefix}tf\_enquiry\_data SET enquiry\_status=%s WHERE id=%d", |
| [967](#L967) | 'read', |
| [968](#L968) | $enquiry\_id |
| [969](#L969) | ) |
| [970](#L970) | ); |
| [971](#L971) | } |
| [972](#L972) | } |
| [973](#L973) | } |
| [974](#L974) |  |
| [975](#L975) | function tf\_enquiry\_filter\_post\_callback() { |
| [976](#L976) |  |
| [977](#L977) | $post\_id = isset( $\_POST['post\_id'] ) ? sanitize\_text\_field( $\_POST['post\_id'] ) : ''; |
| [978](#L978) | $post\_type = isset( $\_POST['post\_type'] ) ? sanitize\_text\_field( $\_POST['post\_type'] ) : ''; |
| [979](#L979) | $filter = isset( $\_POST['filter'] ) ? sanitize\_text\_field ( $\_POST['filter'] ) : ''; |
| [980](#L980) |  |
| [981](#L981) | $enquiry\_data = $this->enquiry\_table\_data( $post\_type, $post\_id, $filter ); |
| [982](#L982) |  |
| [983](#L983) | $this->enquiry\_details\_list( $enquiry\_data ); |
| [984](#L984) |  |
| [985](#L985) | wp\_reset\_postdata(); |
| [986](#L986) |  |
| [987](#L987) | wp\_die(); |
| [988](#L988) | } |
| [989](#L989) |  |
| [990](#L990) | function tf\_enquiry\_reply\_email\_callback() { |
| [991](#L991) |  |
| [992](#L992) | $response = array(); |
| [993](#L993) | global $wpdb; |
| [994](#L994) | global $current\_user; |
| [995](#L995) | $reply\_data = $wpdb->get\_results( "SELECT reply\_data FROM {$wpdb->prefix}tf\_enquiry\_data WHERE id= " . $\_POST['enquiry\_id'] ); |
| [996](#L996) | $reply\_data = json\_decode( $reply\_data[0]->reply\_data, true ); |
| [997](#L997) |  |
| [998](#L998) | check\_ajax\_referer('updates', '\_ajax\_nonce'); |
| [999](#L999) |  |
| [1000](#L1000) | $reply\_mail = isset( $\_POST['reply\_mail'] ) ? sanitize\_text\_field( $\_POST['reply\_mail'] ) : ''; |
| [1001](#L1001) | $reply\_message = isset( $\_POST['reply\_message'] ) ? wp\_kses\_post( $\_POST['reply\_message'] ) : ''; |
| [1002](#L1002) | $post\_id = isset( $\_POST['post\_id'] ) ? sanitize\_text\_field( $\_POST['post\_id'] ) : ''; |
| [1003](#L1003) | $post\_type = !empty( $post\_id ) ? get\_post\_type( $post\_id ) : ''; |
| [1004](#L1004) | $enquiry\_id = isset( $\_POST['enquiry\_id'] ) ? sanitize\_text\_field( $\_POST['enquiry\_id'] ) : ''; |
| [1005](#L1005) |  |
| [1006](#L1006) | $connection\_type = !empty( Helper::tfopt("tf-email-piping")["connection\_type"]) ? Helper::tfopt("tf-email-piping")["connection\_type"] : 'imap'; |
| [1007](#L1007) | $connection\_mail = $enquiry\_mail\_setting = ''; |
| [1008](#L1008) | if( $connection\_type == 'imap' ) { |
| [1009](#L1009) | $connection\_mail = !empty( Helper::tfopt("tf-email-piping")["imap-email-address"]) ? Helper::tfopt("tf-email-piping")["imap-email-address"] : ''; |
| [1010](#L1010) | } elseif( $connection\_type == 'gmail' ) { |
| [1011](#L1011) | $connection\_mail = !empty( Helper::tfopt("tf-email-piping")["gmail-address"]) ? Helper::tfopt("tf-email-piping")["gmail-address"] : ''; |
| [1012](#L1012) | } |
| [1013](#L1013) |  |
| [1014](#L1014) | if( $post\_type == 'tf\_hotel') { |
| [1015](#L1015) | $enquiry\_mail\_setting = !empty( Helper::tfopt("h-enquiry-email") ) ? Helper::tfopt("h-enquiry-email") : ''; |
| [1016](#L1016) | } elseif( $post\_type == 'tf\_tours') { |
| [1017](#L1017) | $enquiry\_mail\_setting = !empty( Helper::tfopt("t-enquiry-email") ) ? Helper::tfopt("t-enquiry-email") : ''; |
| [1018](#L1018) | } elseif( $post\_type == 'tf\_apartment') { |
| [1019](#L1019) | $enquiry\_mail\_setting = !empty( Helper::tfopt("a-enquiry-email") ) ? Helper::tfopt("a-enquiry-email") : ''; |
| [1020](#L1020) | } |
| [1021](#L1021) |  |
| [1022](#L1022) | $reply\_to\_email = !empty( $connection\_mail ) ? $connection\_mail : ( !empty( $enquiry\_mail\_setting ) ? $enquiry\_mail\_setting : get\_option( 'admin\_email' ) ); |
| [1023](#L1023) | $replay\_data\_last\_index = !empty( $reply\_data ) ? count( $reply\_data ) - 1 : 0; |
| [1024](#L1024) |  |
| [1025](#L1025) | // author data |
| [1026](#L1026) | $author\_id   = get\_post\_field( 'post\_author', $post\_id ); |
| [1027](#L1027) | $author\_mail = get\_the\_author\_meta( 'user\_email', $author\_id ); |
| [1028](#L1028) |  |
| [1029](#L1029) | // Post data |
| [1030](#L1030) | $tf\_post\_author\_id = get\_post\_field( 'post\_author', $post\_id ); |
| [1031](#L1031) | $tf\_user\_meta      = get\_userdata( $tf\_post\_author\_id ); |
| [1032](#L1032) | $tf\_user\_roles     = $tf\_user\_meta->roles; |
| [1033](#L1033) |  |
| [1034](#L1034) | if( empty( $reply\_message ) ) { |
| [1035](#L1035) | $response['status'] = 'error'; |
| [1036](#L1036) | $response['msg']    = esc\_html\_\_( 'Reply Message is Required!', 'tourfic' ); |
| [1037](#L1037) |  |
| [1038](#L1038) | } |
| [1039](#L1039) |  |
| [1040](#L1040) | if ( ! current\_user\_can( 'manage\_options' ) ) { |
| [1041](#L1041) | $response['status'] = 'error'; |
| [1042](#L1042) | $response['msg']    = esc\_html\_\_( 'You do not have permission to perform this action.', 'tourfic' ); |
| [1043](#L1043) | $response['msg']    = esc\_html\_\_( 'You do not have permission to perform this action.', 'tourfic' ); |
| [1044](#L1044) | } |
| [1045](#L1045) |  |
| [1046](#L1046) | if( !empty( $reply\_mail ) && !empty( $reply\_message ) ) { |
| [1047](#L1047) | $to = $reply\_mail; |
| [1048](#L1048) | $from = "From: " . get\_option( 'blogname' ) . " <" . get\_option( 'admin\_email' ) . ">\r\n"; |
| [1049](#L1049) | $subject = esc\_html\_\_("Re: Response to Your Enquiry About ", 'tourfic') . esc\_html( get\_the\_title( $post\_id ) ) . " - " . esc\_html("#".$enquiry\_id); |
| [1050](#L1050) | $header\_uid = rand( 10000000, 99999999 ); |
| [1051](#L1051) | $headers = array('Content-Type: text/html; charset=UTF-8'); |
| [1052](#L1052) | $headers[] = $from; |
| [1053](#L1053) | $headers[] = 'Reply-To: ' . $reply\_to\_email; |
| [1054](#L1054) | $headers[] = 'x-tourfic-uid: ' . $header\_uid; |
| [1055](#L1055) |  |
| [1056](#L1056) | if( !empty( $reply\_data[$replay\_data\_last\_index]["message\_id"] ) ) { |
| [1057](#L1057) | $headers[] = 'In-Reply-To: ' . $reply\_data[$replay\_data\_last\_index]["message\_id"]; |
| [1058](#L1058) | } |
| [1059](#L1059) |  |
| [1060](#L1060) | if( !empty( $reply\_data[$replay\_data\_last\_index]["references"] ) ) { |
| [1061](#L1061) | $headers[] = 'References: ' . $reply\_data[$replay\_data\_last\_index]["references"]; |
| [1062](#L1062) | } |
| [1063](#L1063) |  |
| [1064](#L1064) | $reply\_footer = ''; |
| [1065](#L1065) |  |
| [1066](#L1066) | if( is\_plugin\_active( 'tourfic-email-piping/tourfic-email-piping.php' ) ) { |
| [1067](#L1067) | $reply\_footer = "<br><p>" . esc\_html\_\_("Please reply to this email to update your enquiry.",'tourfic') . "</p>"; |
| [1068](#L1068) | } |
| [1069](#L1069) |  |
| [1070](#L1070) | $send\_mail = wp\_mail( $to, $subject, $reply\_message . $reply\_footer, $headers ); |
| [1071](#L1071) |  |
| [1072](#L1072) | $submit\_time = date\_i18n( 'Y-m-d H:i:s', current\_time( 'timestamp' ) ); |
| [1073](#L1073) |  |
| [1074](#L1074) | $reply\_data[] = array( |
| [1075](#L1075) | 'reply\_user' => !empty( $current\_user->display\_name ) ? $current\_user->display\_name : '', |
| [1076](#L1076) | 'reply\_mail' => $reply\_mail, |
| [1077](#L1077) | 'reply\_message' => $reply\_message, |
| [1078](#L1078) | 'reply\_subject' => $subject, |
| [1079](#L1079) | 'reply\_uid' => $header\_uid, |
| [1080](#L1080) | 'submit\_time' => $submit\_time |
| [1081](#L1081) | ); |
| [1082](#L1082) |  |
| [1083](#L1083) | $wpdb->query( |
| [1084](#L1084) | $wpdb->prepare( |
| [1085](#L1085) | "UPDATE {$wpdb->prefix}tf\_enquiry\_data SET enquiry\_status = %s, reply\_data = %s WHERE id = %d", |
| [1086](#L1086) | 'replied', |
| [1087](#L1087) | json\_encode( $reply\_data ), |
| [1088](#L1088) | $enquiry\_id |
| [1089](#L1089) | ) |
| [1090](#L1090) | ); |
| [1091](#L1091) |  |
| [1092](#L1092) | if ( $send\_mail ) { |
| [1093](#L1093) | $response['status'] = 'success'; |
| [1094](#L1094) | $response['msg']    = esc\_html\_\_( 'Email sent successfully!', 'tourfic' ); |
| [1095](#L1095) | } else { |
| [1096](#L1096) | $response['status'] = 'error'; |
| [1097](#L1097) | $response['msg']    = esc\_html\_\_( 'Error sending email. Check your server configurations', 'tourfic' ); |
| [1098](#L1098) | } |
| [1099](#L1099) |  |
| [1100](#L1100) | } |
| [1101](#L1101) |  |
| [1102](#L1102) |  |
| [1103](#L1103) | echo wp\_json\_encode( $response ); |
| [1104](#L1104) | wp\_die(); |
| [1105](#L1105) | } |
| [1106](#L1106) |  |
| [1107](#L1107) | function tf\_enquiry\_filter\_mail\_callback() { |
| [1108](#L1108) | $filter = isset( $\_POST['filter'] ) ? sanitize\_text\_field( $\_POST['filter'] )  : ''; |
| [1109](#L1109) | $post\_type = isset( $\_POST['post\_type'] ) ? sanitize\_text\_field( $\_POST['post\_type'] ) : ''; |
| [1110](#L1110) | $post\_id = isset( $\_POST['post\_id'] ) ? sanitize\_text\_field( $\_POST['post\_id'] ) : ''; |
| [1111](#L1111) |  |
| [1112](#L1112) | $enquiry\_data = $this->enquiry\_table\_data( $post\_type, $post\_id, $filter ); |
| [1113](#L1113) | $total\_data = !empty(count( $enquiry\_data )) ? count( $enquiry\_data ) : 0; |
| [1114](#L1114) | $per\_page = 20; |
| [1115](#L1115) |  |
| [1116](#L1116) | $this->enquiry\_details\_list( $enquiry\_data ); |
| [1117](#L1117) |  |
| [1118](#L1118) | wp\_reset\_postdata(); |
| [1119](#L1119) |  |
| [1120](#L1120) | wp\_die(); |
| [1121](#L1121) |  |
| [1122](#L1122) | wp\_die(); |
| [1123](#L1123) | } |
| [1124](#L1124) |  |
| [1125](#L1125) | static function tf\_vendor\_default\_enquiry\_mail( $vendor\_mail, $post\_id, $name, $body, $last\_id = '', $type = "new" ) { |
| [1126](#L1126) |  |
| [1127](#L1127) | $author\_name = get\_the\_author\_meta('display\_name', get\_post\_field('post\_author', $post\_id)); |
| [1128](#L1128) | $post\_name = get\_the\_title( $post\_id ); |
| [1129](#L1129) | $post\_type = get\_post\_type( $post\_id ) == "tf\_tours" ? esc\_html\_\_("Tour", 'tourfic') : ( get\_post\_type( $post\_id ) == "tf\_hotel" ? esc\_html\_\_( "Hotel", 'tourfic') : esc\_html\_\_( "Apartment", 'tourfic') ); |
| [1130](#L1130) | $subject = ""; |
| [1131](#L1131) |  |
| [1132](#L1132) | if( $type == "new" ) { |
| [1133](#L1133) | $subject .= sprintf( esc\_html\_\_( "New Enquiry #%1s: Someone Asked Question about your %2s - %3s  ", 'tourfic' ), $last\_id, $post\_type, $post\_name ); |
| [1134](#L1134) | } elseif( $type == "reply" ) { |
| [1135](#L1135) | $subject .= sprintf( esc\_html\_\_( "New Response #%1s: A New Response is Added to Enquiry Details", 'tourfic' ), $last\_id ); |
| [1136](#L1136) | } |
| [1137](#L1137) |  |
| [1138](#L1138) | $from = "From: " . get\_option( 'blogname' ) . " <" . get\_option( 'admin\_email' ) . ">\r\n"; |
| [1139](#L1139) | $headers[] = 'Content-Type: text/html; charset=UTF-8'; |
| [1140](#L1140) | $headers[] = $from; |
| [1141](#L1141) | $headers[] = 'Reply-To: no-reply@' . parse\_url( site\_url() )["host"]; |
| [1142](#L1142) | $dashboard\_link = get\_option("tf\_dashboard\_page\_id") ? get\_permalink(get\_option("tf\_dashboard\_page\_id")) : site\_url('my-account/'); |
| [1143](#L1143) | $email\_content = ''; |
| [1144](#L1144) |  |
| [1145](#L1145) |  |
| [1146](#L1146) | ob\_start(); |
| [1147](#L1147) | ?> |
| [1148](#L1148) | <div style="width:100%"> |
| [1149](#L1149) | <p> <?php echo esc\_html\_\_("Hello", 'tourfic') ?> <b><?php echo esc\_html( $author\_name ) ?></b></p> |
| [1150](#L1150) | <?php if( $type = 'new'): ?> |
| [1151](#L1151) | <p> <?php echo esc\_html\_\_("A new enquiry has been added to your dashboard", 'tourfic') ?> <?php echo !empty($name) ? esc\_html\_\_('by ', 'tourfic') . $name : '' ?></p> |
| [1152](#L1152) | <?php elseif( $type == "reply"): ?> |
| [1153](#L1153) | <p> <?php echo esc\_html\_\_("A new response has been added to", 'tourfic'); ?> #<?php echo esc\_html($last\_id) ?> <?php echo !empty($name) ? esc\_html\_\_('by ', 'tourfic') . $name : '' ?></p> |
| [1154](#L1154) | <?php endif; ?> |
| [1155](#L1155) | <?php if( !empty( $body )): ?> |
| [1156](#L1156) | <h4>Enquiry Body</h4> |
| [1157](#L1157) | <p><?php echo wp\_kses\_post( $body ) ?></p> |
| [1158](#L1158) | <?php endif; ?> |
| [1159](#L1159) | <p><?php esc\_html\_\_("Click here to go to the enquiry page:", 'tourfic') ?> <b><a href="<?php echo esc\_url( $dashboard\_link . "#/" . strtolower($post\_type) . '-' . 'enquiries' . '/' . $last\_id)  ?>"><?php echo esc\_html\_\_("View Enquiry", 'tourfic'); ?></a></b></p> |
| [1160](#L1160) | </div> |
| [1161](#L1161) | <div style="width:100%"> |
| [1162](#L1162) | <p><?php esc\_html\_\_("Reply the enquiry using dashboard reply form", 'tourfic') ?></p> |
| [1163](#L1163) | </div> |
| [1164](#L1164) | <?php |
| [1165](#L1165) | $email\_content = ob\_get\_clean(); |
| [1166](#L1166) |  |
| [1167](#L1167) | return wp\_mail( $vendor\_mail, $subject, $email\_content, $headers ); |
| [1168](#L1168) | } |
| [1169](#L1169) |  |
| [1170](#L1170) | function tf\_get\_browser\_name( $user\_agent ) { |
| [1171](#L1171) | if ( preg\_match( '/MSIE/i', $user\_agent ) && ! preg\_match( '/Opera/i', $user\_agent ) ) { |
| [1172](#L1172) | return 'Internet Explorer'; |
| [1173](#L1173) | } elseif ( preg\_match( '/Firefox/i', $user\_agent ) ) { |
| [1174](#L1174) | return 'Firefox'; |
| [1175](#L1175) | } elseif ( preg\_match( '/Chrome/i', $user\_agent ) ) { |
| [1176](#L1176) | return 'Chrome'; |
| [1177](#L1177) | } elseif ( preg\_match( '/Safari/i', $user\_agent ) ) { |
| [1178](#L1178) | return 'Safari'; |
| [1179](#L1179) | } elseif ( preg\_match( '/Opera/i', $user\_agent ) ) { |
| [1180](#L1180) | return 'Opera'; |
| [1181](#L1181) | } elseif ( preg\_match( '/Netscape/i', $user\_agent ) ) { |
| [1182](#L1182) | return 'Netscape'; |
| [1183](#L1183) | } |
| [1184](#L1184) | return 'Unknown'; |
| [1185](#L1185) | } |
| [1186](#L1186) |  |
| [1187](#L1187) | function tf\_enquiry\_response\_schedule( $schedules ) { |
| [1188](#L1188) | $interval = 60; |
| [1189](#L1189) |  |
| [1190](#L1190) | $schedules['tf\_enquiry\_response\_schedule'] = array( |
| [1191](#L1191) | 'interval' => $interval, |
| [1192](#L1192) | 'display' => esc\_attr\_\_( 'Tourfic Response Scheduler', 'tourfic' ) |
| [1193](#L1193) | ); |
| [1194](#L1194) |  |
| [1195](#L1195) | return $schedules; |
| [1196](#L1196) |  |
| [1197](#L1197) | } |
| [1198](#L1198) |  |
| [1199](#L1199) | function tf\_enquiry\_response\_schedule\_event() { |
| [1200](#L1200) | if ( ! wp\_next\_scheduled( 'tf\_enquiry\_response\_schedule' ) ) { |
| [1201](#L1201) | wp\_schedule\_event( time(), 'tf\_enquiry\_response\_schedule', 'tf\_enquiry\_response\_schedule' ); |
| [1202](#L1202) | } |
| [1203](#L1203) | } |
| [1204](#L1204) |  |
| [1205](#L1205) | function tf\_enquiry\_response\_schedule\_callback() { |
| [1206](#L1206) |  |
| [1207](#L1207) | if( function\_exists( 'is\_tf\_pro' ) && is\_tf\_pro() ) { |
| [1208](#L1208) | } else { |
| [1209](#L1209) | self::tf\_enquiry\_update\_response\_unschedule(); |
| [1210](#L1210) | } |
| [1211](#L1211) |  |
| [1212](#L1212) |  |
| [1213](#L1213) | if( empty( get\_option("tfep\_enquiry\_update\_response") )) { |
| [1214](#L1214) | return; |
| [1215](#L1215) | } |
| [1216](#L1216) |  |
| [1217](#L1217) | global $wpdb; |
| [1218](#L1218) |  |
| [1219](#L1219) | $response\_data = get\_option("tfep\_enquiry\_update\_response"); |
| [1220](#L1220) |  |
| [1221](#L1221) | $enquiry\_id = $response\_data["enquiry\_id"]; |
| [1222](#L1222) | $enquiry\_details = $wpdb->get\_results( "SELECT \* FROM {$wpdb->prefix}tf\_enquiry\_data where id= $enquiry\_id", ARRAY\_A ); |
| [1223](#L1223) | $enquiry\_details = !empty($enquiry\_details) ? $enquiry\_details[0] : array(); |
| [1224](#L1224) |  |
| [1225](#L1225) | if( $enquiry\_details["author\_roles"] != "tf\_vendor" ) { |
| [1226](#L1226) | return; |
| [1227](#L1227) | } |
| [1228](#L1228) |  |
| [1229](#L1229) | if( $enquiry\_details["enquiry\_status"] == "unread" && $enquiry\_details["enquiry\_status"] == "read" ) { |
| [1230](#L1230) | return; |
| [1231](#L1231) | } |
| [1232](#L1232) |  |
| [1233](#L1233) | if( empty( $enquiry\_details["reply\_data"] ) ) { |
| [1234](#L1234) | return; |
| [1235](#L1235) | } |
| [1236](#L1236) |  |
| [1237](#L1237) | $reply\_data = json\_decode( $enquiry\_details["reply\_data"], true ); |
| [1238](#L1238) |  |
| [1239](#L1239) | $last\_reply = end($reply\_data); |
| [1240](#L1240) |  |
| [1241](#L1241) | $vendor\_mail = get\_the\_author\_meta("user\_email", $enquiry\_details["author\_id"]); |
| [1242](#L1242) | $post\_id = $enquiry\_details["post\_id"]; |
| [1243](#L1243) | $name = !empty( $last\_reply["name"] ) ? $last\_reply["name"] : ''; |
| [1244](#L1244) | $body = !empty( $last\_reply["reply\_message\_html"] ) ? $last\_reply["reply\_message\_html"] : ''; |
| [1245](#L1245) |  |
| [1246](#L1246) | if( $response\_data["notified"] == "false") { |
| [1247](#L1247) | $reply\_to\_vendor = self::tf\_vendor\_default\_enquiry\_mail($vendor\_mail, $post\_id, $name, $body, $enquiry\_id, 'reply'); |
| [1248](#L1248) | if( $reply\_to\_vendor ) { |
| [1249](#L1249) | update\_option("tfep\_enquiry\_update\_response", ''); |
| [1250](#L1250) | } |
| [1251](#L1251) | } |
| [1252](#L1252) | } |
| [1253](#L1253) |  |
| [1254](#L1254) | public static function tf\_enquiry\_update\_response\_unschedule() { |
| [1255](#L1255) | $timestamp = wp\_next\_scheduled( 'tf\_enquiry\_response\_schedule' ); |
| [1256](#L1256) | if( $timestamp ) { |
| [1257](#L1257) | wp\_unschedule\_event( $timestamp, 'tf\_enquiry\_response\_schedule' ); |
| [1258](#L1258) | } |
| [1259](#L1259) | } |
| [1260](#L1260) |  |
| [1261](#L1261) | } |

**Note:** See [TracBrowser](/wiki/TracBrowser)
for help on using the repository browser.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Plain Text](/browser/tourfic/tags/2.14.1/inc/Core/Enquiry.php?format=txt)
* [Original Format](/export/3222687/tourfic/tags/2.14.1/inc/Core/Enquiry.php)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from plugins.trac.wordpress.org_b37b7ed2_20250115_084626.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fchangeset%2F3207686%2Ftourfic%2Ftrunk%2Finc%2FCore%2FEnquiry.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Change](/changeset/3202975/tourfic/trunk/inc/Core/Enquiry.php "Changeset 3202975 for tourfic/trunk/inc/Core/Enquiry.php")
* Next Change →

---

# Changeset [3207686](/changeset/3207686 "Show full changeset") for [tourfic/trunk/inc/Core/Enquiry.php](/browser/tourfic/trunk/inc/Core/Enquiry.php?rev=3207686 "Show entry in browser")

View differences
inline
side by side

Show
lines around each change

Show the changes in full context

Ignore:

Blank lines

Case changes

White space changes

Timestamp:
12/13/2024 02:11:27 PM
([5 weeks](/timeline?from=2024-12-13T14%3A11%3A27Z&precision=second "See timeline at 12/13/2024 02:11:27 PM") ago)

Author:
themefic
Message:

Update 2.15.4

File:

1 edited

* [tourfic/trunk/inc/Core/Enquiry.php](/browser/tourfic/trunk/inc/Core/Enquiry.php?rev=3207686 "Show entry in browser")
  (modified)
  ([2 diffs](#file0 "Show differences"))

### Legend:

Unmodified
Added
Removed

* ## [tourfic/trunk/inc/Core/Enquiry.php](/changeset/3207686/tourfic/trunk/inc/Core/Enquiry.php "Show the changeset 3207686 restricted to tourfic/trunk/inc/Core/Enquiry.php")

  | [r3202975](/browser/tourfic/trunk/inc/Core/Enquiry.php?rev=3202975#L993 "Show revision 3202975 of this file in browser") | [r3207686](/browser/tourfic/trunk/inc/Core/Enquiry.php?rev=3207686#L993 "Show revision 3207686 of this file in browser") |  |
  | --- | --- | --- |
  | 993 | 993 | global $wpdb; |
  | 994 | 994 | global $current\_user; |
  | 995 |  | $reply\_data = $wpdb->get\_results( "SELECT reply\_data FROM {$wpdb->prefix}tf\_enquiry\_data WHERE id= " . $\_POST['enquiry\_id'] ); |
  |  | 995 | $reply\_data = $wpdb->get\_results( |
  |  | 996 | $wpdb->prepare( |
  |  | 997 | "SELECT reply\_data FROM {$wpdb->prefix}tf\_enquiry\_data WHERE id= %s", |
  |  | 998 | $\_POST['enquiry\_id'] |
  |  | 999 | ) |
  |  | 1000 | ); |
  | 996 | 1001 | $reply\_data = json\_decode( $reply\_data[0]->reply\_data, true ); |
  | 997 | 1002 |  |
  | […](/browser/tourfic/trunk/inc/Core/Enquiry.php?rev=3202975#L1220) | […](/browser/tourfic/trunk/inc/Core/Enquiry.php?rev=3207686#L1225) |  |
  | 1220 | 1225 |  |
  | 1221 | 1226 | $enquiry\_id = $response\_data["enquiry\_id"]; |
  | 1222 |  | $enquiry\_details = $wpdb->get\_results( "SELECT \* FROM {$wpdb->prefix}tf\_enquiry\_data where id= $enquiry\_id", ARRAY\_A ); |
  |  | 1227 | $enquiry\_details = $wpdb->get\_results( |
  |  | 1228 | $wpdb->prepare("SELECT \* FROM {$wpdb->prefix}tf\_enquiry\_data where id= %s", $enquiry\_id), |
  |  | 1229 | ARRAY\_A |
  |  | 1230 | ); |
  | 1223 | 1231 | $enquiry\_details = !empty($enquiry\_details) ? $enquiry\_details[0] : array(); |
  | 1224 | 1232 |  |

**Note:** See [TracChangeset](/wiki/TracChangeset)
for help on using the changeset viewer.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Unified Diff](?format=diff&new=3207686)
* [Zip Archive](?format=zip&new=3207686)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)


