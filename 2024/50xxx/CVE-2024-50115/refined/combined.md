=== Content from git.kernel.org_fd31e047_20250115_095239.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=426682afec71ea3f889b972d038238807b9443e4)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=426682afec71ea3f889b972d038238807b9443e4)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=426682afec71ea3f889b972d038238807b9443e4)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=426682afec71ea3f889b972d038238807b9443e4)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Sean Christopherson <seanjc@google.com> | 2024-10-09 07:08:38 -0700 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-11-01 02:02:41 +0100 |
| commit | [426682afec71ea3f889b972d038238807b9443e4](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=426682afec71ea3f889b972d038238807b9443e4) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=426682afec71ea3f889b972d038238807b9443e4)) | |
| tree | [32bd0d2a4ac8461048bebc445506a18d1e47ccae](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=426682afec71ea3f889b972d038238807b9443e4) | |
| parent | [192709f6bc1a8bf4407093cddfdd945caca93e75](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=192709f6bc1a8bf4407093cddfdd945caca93e75) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=426682afec71ea3f889b972d038238807b9443e4&id2=192709f6bc1a8bf4407093cddfdd945caca93e75)) | |
| download | [linux-426682afec71ea3f889b972d038238807b9443e4.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-426682afec71ea3f889b972d038238807b9443e4.tar.gz) | |

KVM: nSVM: Ignore nCR3[4:0] when loading PDPTEs from memorycommit f559b2e9c5c5308850544ab59396b7d53cfc67bd upstream.
Ignore nCR3[4:0] when loading PDPTEs from memory for nested SVM, as bits
4:0 of CR3 are ignored when PAE paging is used, and thus VMRUN doesn't
enforce 32-byte alignment of nCR3.
In the absolute worst case scenario, failure to ignore bits 4:0 can result
in an out-of-bounds read, e.g. if the target page is at the end of a
memslot, and the VMM isn't using guard pages.
Per the APM:
The CR3 register points to the base address of the page-directory-pointer
table. The page-directory-pointer table is aligned on a 32-byte boundary,
with the low 5 address bits 4:0 assumed to be 0.
And the SDM's much more explicit:
4:0 Ignored
Note, KVM gets this right when loading PDPTRs, it's only the nSVM flow
that is broken.
Fixes: e4e517b4be01 ("KVM: MMU: Do not unconditionally read PDPTE from guest memory")
Reported-by: Kirk Swidowski <swidowski@google.com>
Cc: Andy Nguyen <theflow@google.com>
Cc: 3pvd <3pvd@google.com>
Cc: stable@vger.kernel.org
Signed-off-by: Sean Christopherson <seanjc@google.com>
Message-ID: <20241009140838.1036226-1-seanjc@google.com>
Signed-off-by: Paolo Bonzini <pbonzini@redhat.com>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=426682afec71ea3f889b972d038238807b9443e4)

| -rw-r--r-- | [arch/x86/kvm/svm/nested.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/arch/x86/kvm/svm/nested.c?id=426682afec71ea3f889b972d038238807b9443e4) | 6 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 5 insertions, 1 deletions

| diff --git a/arch/x86/kvm/svm/nested.c b/arch/x86/kvm/svm/nested.cindex 6f704c1037e514..6b3e0c75db945c 100644--- a/[arch/x86/kvm/svm/nested.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/x86/kvm/svm/nested.c?id=192709f6bc1a8bf4407093cddfdd945caca93e75)+++ b/[arch/x86/kvm/svm/nested.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/x86/kvm/svm/nested.c?id=426682afec71ea3f889b972d038238807b9443e4)@@ -63,8 +63,12 @@ static u64 nested\_svm\_get\_tdp\_pdptr(struct kvm\_vcpu \*vcpu, int index) u64 pdpte; int ret; + /\*+ \* Note, nCR3 is "assumed" to be 32-byte aligned, i.e. the CPU ignores+ \* nCR3[4:0] when loading PDPTEs from memory.+ \*/ ret = kvm\_vcpu\_read\_guest\_page(vcpu, gpa\_to\_gfn(cr3), &pdpte,- offset\_in\_page(cr3) + index \* 8, 8);+ (cr3 & GENMASK(11, 5)) + index \* 8, 8); if (ret) return 0; return pdpte; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-15 09:51:16 +0000



=== Content from git.kernel.org_ef57d79c_20250115_095240.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=6876793907cbe19d42e9edc8c3315a21e06c32ae)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=6876793907cbe19d42e9edc8c3315a21e06c32ae)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=6876793907cbe19d42e9edc8c3315a21e06c32ae)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=6876793907cbe19d42e9edc8c3315a21e06c32ae)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Sean Christopherson <seanjc@google.com> | 2024-10-09 07:08:38 -0700 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-11-01 01:56:06 +0100 |
| commit | [6876793907cbe19d42e9edc8c3315a21e06c32ae](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=6876793907cbe19d42e9edc8c3315a21e06c32ae) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=6876793907cbe19d42e9edc8c3315a21e06c32ae)) | |
| tree | [3fef43e8633de18064b06d4ad8432f1f33c666a3](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=6876793907cbe19d42e9edc8c3315a21e06c32ae) | |
| parent | [958f8343f4ad75d0d07298fb59e9b8e8ebaad1e7](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=958f8343f4ad75d0d07298fb59e9b8e8ebaad1e7) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=6876793907cbe19d42e9edc8c3315a21e06c32ae&id2=958f8343f4ad75d0d07298fb59e9b8e8ebaad1e7)) | |
| download | [linux-6876793907cbe19d42e9edc8c3315a21e06c32ae.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-6876793907cbe19d42e9edc8c3315a21e06c32ae.tar.gz) | |

KVM: nSVM: Ignore nCR3[4:0] when loading PDPTEs from memorycommit f559b2e9c5c5308850544ab59396b7d53cfc67bd upstream.
Ignore nCR3[4:0] when loading PDPTEs from memory for nested SVM, as bits
4:0 of CR3 are ignored when PAE paging is used, and thus VMRUN doesn't
enforce 32-byte alignment of nCR3.
In the absolute worst case scenario, failure to ignore bits 4:0 can result
in an out-of-bounds read, e.g. if the target page is at the end of a
memslot, and the VMM isn't using guard pages.
Per the APM:
The CR3 register points to the base address of the page-directory-pointer
table. The page-directory-pointer table is aligned on a 32-byte boundary,
with the low 5 address bits 4:0 assumed to be 0.
And the SDM's much more explicit:
4:0 Ignored
Note, KVM gets this right when loading PDPTRs, it's only the nSVM flow
that is broken.
Fixes: e4e517b4be01 ("KVM: MMU: Do not unconditionally read PDPTE from guest memory")
Reported-by: Kirk Swidowski <swidowski@google.com>
Cc: Andy Nguyen <theflow@google.com>
Cc: 3pvd <3pvd@google.com>
Cc: stable@vger.kernel.org
Signed-off-by: Sean Christopherson <seanjc@google.com>
Message-ID: <20241009140838.1036226-1-seanjc@google.com>
Signed-off-by: Paolo Bonzini <pbonzini@redhat.com>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=6876793907cbe19d42e9edc8c3315a21e06c32ae)

| -rw-r--r-- | [arch/x86/kvm/svm/nested.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/arch/x86/kvm/svm/nested.c?id=6876793907cbe19d42e9edc8c3315a21e06c32ae) | 6 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 5 insertions, 1 deletions

| diff --git a/arch/x86/kvm/svm/nested.c b/arch/x86/kvm/svm/nested.cindex 5d4d78c9a78727..974f30d38c79bb 100644--- a/[arch/x86/kvm/svm/nested.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/x86/kvm/svm/nested.c?id=958f8343f4ad75d0d07298fb59e9b8e8ebaad1e7)+++ b/[arch/x86/kvm/svm/nested.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/x86/kvm/svm/nested.c?id=6876793907cbe19d42e9edc8c3315a21e06c32ae)@@ -62,8 +62,12 @@ static u64 nested\_svm\_get\_tdp\_pdptr(struct kvm\_vcpu \*vcpu, int index) u64 pdpte; int ret; + /\*+ \* Note, nCR3 is "assumed" to be 32-byte aligned, i.e. the CPU ignores+ \* nCR3[4:0] when loading PDPTEs from memory.+ \*/ ret = kvm\_vcpu\_read\_guest\_page(vcpu, gpa\_to\_gfn(cr3), &pdpte,- offset\_in\_page(cr3) + index \* 8, 8);+ (cr3 & GENMASK(11, 5)) + index \* 8, 8); if (ret) return 0; return pdpte; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-15 09:51:18 +0000



=== Content from git.kernel.org_381c6664_20250115_095242.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=f559b2e9c5c5308850544ab59396b7d53cfc67bd)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=f559b2e9c5c5308850544ab59396b7d53cfc67bd)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=f559b2e9c5c5308850544ab59396b7d53cfc67bd)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=f559b2e9c5c5308850544ab59396b7d53cfc67bd)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Sean Christopherson <seanjc@google.com> | 2024-10-09 07:08:38 -0700 |
| --- | --- | --- |
| committer | Paolo Bonzini <pbonzini@redhat.com> | 2024-10-20 07:31:06 -0400 |
| commit | [f559b2e9c5c5308850544ab59396b7d53cfc67bd](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=f559b2e9c5c5308850544ab59396b7d53cfc67bd) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=f559b2e9c5c5308850544ab59396b7d53cfc67bd)) | |
| tree | [1e96d6fee6e05acc7886deca3e9bdd64645ebdb5](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=f559b2e9c5c5308850544ab59396b7d53cfc67bd) | |
| parent | [731285fbb6f5bea357d79059db865f351626e689](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=731285fbb6f5bea357d79059db865f351626e689) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=f559b2e9c5c5308850544ab59396b7d53cfc67bd&id2=731285fbb6f5bea357d79059db865f351626e689)) | |
| download | [linux-f559b2e9c5c5308850544ab59396b7d53cfc67bd.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-f559b2e9c5c5308850544ab59396b7d53cfc67bd.tar.gz) | |

KVM: nSVM: Ignore nCR3[4:0] when loading PDPTEs from memoryIgnore nCR3[4:0] when loading PDPTEs from memory for nested SVM, as bits
4:0 of CR3 are ignored when PAE paging is used, and thus VMRUN doesn't
enforce 32-byte alignment of nCR3.
In the absolute worst case scenario, failure to ignore bits 4:0 can result
in an out-of-bounds read, e.g. if the target page is at the end of a
memslot, and the VMM isn't using guard pages.
Per the APM:
The CR3 register points to the base address of the page-directory-pointer
table. The page-directory-pointer table is aligned on a 32-byte boundary,
with the low 5 address bits 4:0 assumed to be 0.
And the SDM's much more explicit:
4:0 Ignored
Note, KVM gets this right when loading PDPTRs, it's only the nSVM flow
that is broken.
Fixes: e4e517b4be01 ("KVM: MMU: Do not unconditionally read PDPTE from guest memory")
Reported-by: Kirk Swidowski <swidowski@google.com>
Cc: Andy Nguyen <theflow@google.com>
Cc: 3pvd <3pvd@google.com>
Cc: stable@vger.kernel.org
Signed-off-by: Sean Christopherson <seanjc@google.com>
Message-ID: <20241009140838.1036226-1-seanjc@google.com>
Signed-off-by: Paolo Bonzini <pbonzini@redhat.com>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=f559b2e9c5c5308850544ab59396b7d53cfc67bd)

| -rw-r--r-- | [arch/x86/kvm/svm/nested.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/arch/x86/kvm/svm/nested.c?id=f559b2e9c5c5308850544ab59396b7d53cfc67bd) | 6 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 5 insertions, 1 deletions

| diff --git a/arch/x86/kvm/svm/nested.c b/arch/x86/kvm/svm/nested.cindex d5314cb7dff4ca..cf84103ce38b97 100644--- a/[arch/x86/kvm/svm/nested.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/x86/kvm/svm/nested.c?id=731285fbb6f5bea357d79059db865f351626e689)+++ b/[arch/x86/kvm/svm/nested.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/x86/kvm/svm/nested.c?id=f559b2e9c5c5308850544ab59396b7d53cfc67bd)@@ -63,8 +63,12 @@ static u64 nested\_svm\_get\_tdp\_pdptr(struct kvm\_vcpu \*vcpu, int index) u64 pdpte; int ret; + /\*+ \* Note, nCR3 is "assumed" to be 32-byte aligned, i.e. the CPU ignores+ \* nCR3[4:0] when loading PDPTEs from memory.+ \*/ ret = kvm\_vcpu\_read\_guest\_page(vcpu, gpa\_to\_gfn(cr3), &pdpte,- offset\_in\_page(cr3) + index \* 8, 8);+ (cr3 & GENMASK(11, 5)) + index \* 8, 8); if (ret) return 0; return pdpte; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-15 09:51:19 +0000



=== Content from git.kernel.org_56247ee7_20250115_095238.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=2c4adc9b192a0815fe58a62bc0709449416cc884)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=2c4adc9b192a0815fe58a62bc0709449416cc884)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=2c4adc9b192a0815fe58a62bc0709449416cc884)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=2c4adc9b192a0815fe58a62bc0709449416cc884)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Sean Christopherson <seanjc@google.com> | 2024-10-09 07:08:38 -0700 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-11-01 01:58:32 +0100 |
| commit | [2c4adc9b192a0815fe58a62bc0709449416cc884](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=2c4adc9b192a0815fe58a62bc0709449416cc884) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=2c4adc9b192a0815fe58a62bc0709449416cc884)) | |
| tree | [52fd3912d3c2c848a07cc5252d058cab64f34844](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=2c4adc9b192a0815fe58a62bc0709449416cc884) | |
| parent | [f421a3b18aa78acb3f8433cc357853978f6940a1](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=f421a3b18aa78acb3f8433cc357853978f6940a1) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=2c4adc9b192a0815fe58a62bc0709449416cc884&id2=f421a3b18aa78acb3f8433cc357853978f6940a1)) | |
| download | [linux-2c4adc9b192a0815fe58a62bc0709449416cc884.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-2c4adc9b192a0815fe58a62bc0709449416cc884.tar.gz) | |

KVM: nSVM: Ignore nCR3[4:0] when loading PDPTEs from memorycommit f559b2e9c5c5308850544ab59396b7d53cfc67bd upstream.
Ignore nCR3[4:0] when loading PDPTEs from memory for nested SVM, as bits
4:0 of CR3 are ignored when PAE paging is used, and thus VMRUN doesn't
enforce 32-byte alignment of nCR3.
In the absolute worst case scenario, failure to ignore bits 4:0 can result
in an out-of-bounds read, e.g. if the target page is at the end of a
memslot, and the VMM isn't using guard pages.
Per the APM:
The CR3 register points to the base address of the page-directory-pointer
table. The page-directory-pointer table is aligned on a 32-byte boundary,
with the low 5 address bits 4:0 assumed to be 0.
And the SDM's much more explicit:
4:0 Ignored
Note, KVM gets this right when loading PDPTRs, it's only the nSVM flow
that is broken.
Fixes: e4e517b4be01 ("KVM: MMU: Do not unconditionally read PDPTE from guest memory")
Reported-by: Kirk Swidowski <swidowski@google.com>
Cc: Andy Nguyen <theflow@google.com>
Cc: 3pvd <3pvd@google.com>
Cc: stable@vger.kernel.org
Signed-off-by: Sean Christopherson <seanjc@google.com>
Message-ID: <20241009140838.1036226-1-seanjc@google.com>
Signed-off-by: Paolo Bonzini <pbonzini@redhat.com>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=2c4adc9b192a0815fe58a62bc0709449416cc884)

| -rw-r--r-- | [arch/x86/kvm/svm/nested.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/arch/x86/kvm/svm/nested.c?id=2c4adc9b192a0815fe58a62bc0709449416cc884) | 6 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 5 insertions, 1 deletions

| diff --git a/arch/x86/kvm/svm/nested.c b/arch/x86/kvm/svm/nested.cindex 60891b9ce25f61..acf22bd99efcd8 100644--- a/[arch/x86/kvm/svm/nested.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/x86/kvm/svm/nested.c?id=f421a3b18aa78acb3f8433cc357853978f6940a1)+++ b/[arch/x86/kvm/svm/nested.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/x86/kvm/svm/nested.c?id=2c4adc9b192a0815fe58a62bc0709449416cc884)@@ -63,8 +63,12 @@ static u64 nested\_svm\_get\_tdp\_pdptr(struct kvm\_vcpu \*vcpu, int index) u64 pdpte; int ret; + /\*+ \* Note, nCR3 is "assumed" to be 32-byte aligned, i.e. the CPU ignores+ \* nCR3[4:0] when loading PDPTEs from memory.+ \*/ ret = kvm\_vcpu\_read\_guest\_page(vcpu, gpa\_to\_gfn(cr3), &pdpte,- offset\_in\_page(cr3) + index \* 8, 8);+ (cr3 & GENMASK(11, 5)) + index \* 8, 8); if (ret) return 0; return pdpte; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-15 09:51:14 +0000



=== Content from git.kernel.org_5e7cac4f_20250115_095241.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=76ce386feb14ec9a460784fcd495d8432acce7a5)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=76ce386feb14ec9a460784fcd495d8432acce7a5)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=76ce386feb14ec9a460784fcd495d8432acce7a5)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=76ce386feb14ec9a460784fcd495d8432acce7a5)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Sean Christopherson <seanjc@google.com> | 2024-10-09 07:08:38 -0700 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-11-08 16:22:00 +0100 |
| commit | [76ce386feb14ec9a460784fcd495d8432acce7a5](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=76ce386feb14ec9a460784fcd495d8432acce7a5) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=76ce386feb14ec9a460784fcd495d8432acce7a5)) | |
| tree | [400da23e09d57addebe32af461fd511f85a691f2](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=76ce386feb14ec9a460784fcd495d8432acce7a5) | |
| parent | [0f0374d09c829e8597bee85f6713a6cc97f4d5a0](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=0f0374d09c829e8597bee85f6713a6cc97f4d5a0) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=76ce386feb14ec9a460784fcd495d8432acce7a5&id2=0f0374d09c829e8597bee85f6713a6cc97f4d5a0)) | |
| download | [linux-76ce386feb14ec9a460784fcd495d8432acce7a5.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-76ce386feb14ec9a460784fcd495d8432acce7a5.tar.gz) | |

KVM: nSVM: Ignore nCR3[4:0] when loading PDPTEs from memorycommit f559b2e9c5c5308850544ab59396b7d53cfc67bd upstream.
Ignore nCR3[4:0] when loading PDPTEs from memory for nested SVM, as bits
4:0 of CR3 are ignored when PAE paging is used, and thus VMRUN doesn't
enforce 32-byte alignment of nCR3.
In the absolute worst case scenario, failure to ignore bits 4:0 can result
in an out-of-bounds read, e.g. if the target page is at the end of a
memslot, and the VMM isn't using guard pages.
Per the APM:
The CR3 register points to the base address of the page-directory-pointer
table. The page-directory-pointer table is aligned on a 32-byte boundary,
with the low 5 address bits 4:0 assumed to be 0.
And the SDM's much more explicit:
4:0 Ignored
Note, KVM gets this right when loading PDPTRs, it's only the nSVM flow
that is broken.
Fixes: e4e517b4be01 ("KVM: MMU: Do not unconditionally read PDPTE from guest memory")
Reported-by: Kirk Swidowski <swidowski@google.com>
Cc: Andy Nguyen <theflow@google.com>
Cc: 3pvd <3pvd@google.com>
Cc: stable@vger.kernel.org
Signed-off-by: Sean Christopherson <seanjc@google.com>
Message-ID: <20241009140838.1036226-1-seanjc@google.com>
Signed-off-by: Paolo Bonzini <pbonzini@redhat.com>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=76ce386feb14ec9a460784fcd495d8432acce7a5)

| -rw-r--r-- | [arch/x86/kvm/svm/nested.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/arch/x86/kvm/svm/nested.c?id=76ce386feb14ec9a460784fcd495d8432acce7a5) | 6 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 5 insertions, 1 deletions

| diff --git a/arch/x86/kvm/svm/nested.c b/arch/x86/kvm/svm/nested.cindex e7feaa7910ab36..3e59df2ebc975c 100644--- a/[arch/x86/kvm/svm/nested.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/x86/kvm/svm/nested.c?id=0f0374d09c829e8597bee85f6713a6cc97f4d5a0)+++ b/[arch/x86/kvm/svm/nested.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/x86/kvm/svm/nested.c?id=76ce386feb14ec9a460784fcd495d8432acce7a5)@@ -75,8 +75,12 @@ static u64 nested\_svm\_get\_tdp\_pdptr(struct kvm\_vcpu \*vcpu, int index) u64 pdpte; int ret; + /\*+ \* Note, nCR3 is "assumed" to be 32-byte aligned, i.e. the CPU ignores+ \* nCR3[4:0] when loading PDPTEs from memory.+ \*/ ret = kvm\_vcpu\_read\_guest\_page(vcpu, gpa\_to\_gfn(cr3), &pdpte,- offset\_in\_page(cr3) + index \* 8, 8);+ (cr3 & GENMASK(11, 5)) + index \* 8, 8); if (ret) return 0; return pdpte; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-15 09:51:18 +0000



=== Content from git.kernel.org_21ce1382_20250115_095240.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=58cb697d80e669c56197f703e188867c8c54c494)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=58cb697d80e669c56197f703e188867c8c54c494)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=58cb697d80e669c56197f703e188867c8c54c494)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=58cb697d80e669c56197f703e188867c8c54c494)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Sean Christopherson <seanjc@google.com> | 2024-10-09 07:08:38 -0700 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-11-01 01:52:38 +0100 |
| commit | [58cb697d80e669c56197f703e188867c8c54c494](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=58cb697d80e669c56197f703e188867c8c54c494) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=58cb697d80e669c56197f703e188867c8c54c494)) | |
| tree | [26291ef8d94d930ff6398058fd032a3da06654bb](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=58cb697d80e669c56197f703e188867c8c54c494) | |
| parent | [dc39799f0cc2fa1cb43d10677715008ae74aad7c](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=dc39799f0cc2fa1cb43d10677715008ae74aad7c) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=58cb697d80e669c56197f703e188867c8c54c494&id2=dc39799f0cc2fa1cb43d10677715008ae74aad7c)) | |
| download | [linux-58cb697d80e669c56197f703e188867c8c54c494.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-58cb697d80e669c56197f703e188867c8c54c494.tar.gz) | |

KVM: nSVM: Ignore nCR3[4:0] when loading PDPTEs from memorycommit f559b2e9c5c5308850544ab59396b7d53cfc67bd upstream.
Ignore nCR3[4:0] when loading PDPTEs from memory for nested SVM, as bits
4:0 of CR3 are ignored when PAE paging is used, and thus VMRUN doesn't
enforce 32-byte alignment of nCR3.
In the absolute worst case scenario, failure to ignore bits 4:0 can result
in an out-of-bounds read, e.g. if the target page is at the end of a
memslot, and the VMM isn't using guard pages.
Per the APM:
The CR3 register points to the base address of the page-directory-pointer
table. The page-directory-pointer table is aligned on a 32-byte boundary,
with the low 5 address bits 4:0 assumed to be 0.
And the SDM's much more explicit:
4:0 Ignored
Note, KVM gets this right when loading PDPTRs, it's only the nSVM flow
that is broken.
Fixes: e4e517b4be01 ("KVM: MMU: Do not unconditionally read PDPTE from guest memory")
Reported-by: Kirk Swidowski <swidowski@google.com>
Cc: Andy Nguyen <theflow@google.com>
Cc: 3pvd <3pvd@google.com>
Cc: stable@vger.kernel.org
Signed-off-by: Sean Christopherson <seanjc@google.com>
Message-ID: <20241009140838.1036226-1-seanjc@google.com>
Signed-off-by: Paolo Bonzini <pbonzini@redhat.com>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=58cb697d80e669c56197f703e188867c8c54c494)

| -rw-r--r-- | [arch/x86/kvm/svm/nested.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/arch/x86/kvm/svm/nested.c?id=58cb697d80e669c56197f703e188867c8c54c494) | 6 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 5 insertions, 1 deletions

| diff --git a/arch/x86/kvm/svm/nested.c b/arch/x86/kvm/svm/nested.cindex e0b4f88b04b3e1..c24d7860bd530c 100644--- a/[arch/x86/kvm/svm/nested.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/x86/kvm/svm/nested.c?id=dc39799f0cc2fa1cb43d10677715008ae74aad7c)+++ b/[arch/x86/kvm/svm/nested.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/x86/kvm/svm/nested.c?id=58cb697d80e669c56197f703e188867c8c54c494)@@ -77,8 +77,12 @@ static u64 nested\_svm\_get\_tdp\_pdptr(struct kvm\_vcpu \*vcpu, int index) u64 pdpte; int ret; + /\*+ \* Note, nCR3 is "assumed" to be 32-byte aligned, i.e. the CPU ignores+ \* nCR3[4:0] when loading PDPTEs from memory.+ \*/ ret = kvm\_vcpu\_read\_guest\_page(vcpu, gpa\_to\_gfn(cr3), &pdpte,- offset\_in\_page(cr3) + index \* 8, 8);+ (cr3 & GENMASK(11, 5)) + index \* 8, 8); if (ret) return 0; return pdpte; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-15 09:51:17 +0000


