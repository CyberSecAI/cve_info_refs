=== Content from git.kernel.org_89bb1767_20250115_082912.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=c73bca72b84b453c8d26a5e7673b20adb294bf54)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=c73bca72b84b453c8d26a5e7673b20adb294bf54)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=c73bca72b84b453c8d26a5e7673b20adb294bf54)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=c73bca72b84b453c8d26a5e7673b20adb294bf54)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Petr Vaganov <p.vaganov@ideco.ru> | 2024-10-08 14:02:58 +0500 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-11-01 01:58:33 +0100 |
| commit | [c73bca72b84b453c8d26a5e7673b20adb294bf54](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=c73bca72b84b453c8d26a5e7673b20adb294bf54) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=c73bca72b84b453c8d26a5e7673b20adb294bf54)) | |
| tree | [65a2673bf73a60ccaeafa08264f2450e13b63351](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=c73bca72b84b453c8d26a5e7673b20adb294bf54) | |
| parent | [36bd0f386b7c2d0ed237105e50d8c2cd139d1bbd](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=36bd0f386b7c2d0ed237105e50d8c2cd139d1bbd) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=c73bca72b84b453c8d26a5e7673b20adb294bf54&id2=36bd0f386b7c2d0ed237105e50d8c2cd139d1bbd)) | |
| download | [linux-c73bca72b84b453c8d26a5e7673b20adb294bf54.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-c73bca72b84b453c8d26a5e7673b20adb294bf54.tar.gz) | |

xfrm: fix one more kernel-infoleak in algo dumpingcommit 6889cd2a93e1e3606b3f6e958aa0924e836de4d2 upstream.
During fuzz testing, the following issue was discovered:
BUG: KMSAN: kernel-infoleak in \_copy\_to\_iter+0x598/0x2a30
\_copy\_to\_iter+0x598/0x2a30
\_\_skb\_datagram\_iter+0x168/0x1060
skb\_copy\_datagram\_iter+0x5b/0x220
netlink\_recvmsg+0x362/0x1700
sock\_recvmsg+0x2dc/0x390
\_\_sys\_recvfrom+0x381/0x6d0
\_\_x64\_sys\_recvfrom+0x130/0x200
x64\_sys\_call+0x32c8/0x3cc0
do\_syscall\_64+0xd8/0x1c0
entry\_SYSCALL\_64\_after\_hwframe+0x79/0x81
Uninit was stored to memory at:
copy\_to\_user\_state\_extra+0xcc1/0x1e00
dump\_one\_state+0x28c/0x5f0
xfrm\_state\_walk+0x548/0x11e0
xfrm\_dump\_sa+0x1e0/0x840
netlink\_dump+0x943/0x1c40
\_\_netlink\_dump\_start+0x746/0xdb0
xfrm\_user\_rcv\_msg+0x429/0xc00
netlink\_rcv\_skb+0x613/0x780
xfrm\_netlink\_rcv+0x77/0xc0
netlink\_unicast+0xe90/0x1280
netlink\_sendmsg+0x126d/0x1490
\_\_sock\_sendmsg+0x332/0x3d0
\_\_\_\_sys\_sendmsg+0x863/0xc30
\_\_\_sys\_sendmsg+0x285/0x3e0
\_\_x64\_sys\_sendmsg+0x2d6/0x560
x64\_sys\_call+0x1316/0x3cc0
do\_syscall\_64+0xd8/0x1c0
entry\_SYSCALL\_64\_after\_hwframe+0x79/0x81
Uninit was created at:
\_\_kmalloc+0x571/0xd30
attach\_auth+0x106/0x3e0
xfrm\_add\_sa+0x2aa0/0x4230
xfrm\_user\_rcv\_msg+0x832/0xc00
netlink\_rcv\_skb+0x613/0x780
xfrm\_netlink\_rcv+0x77/0xc0
netlink\_unicast+0xe90/0x1280
netlink\_sendmsg+0x126d/0x1490
\_\_sock\_sendmsg+0x332/0x3d0
\_\_\_\_sys\_sendmsg+0x863/0xc30
\_\_\_sys\_sendmsg+0x285/0x3e0
\_\_x64\_sys\_sendmsg+0x2d6/0x560
x64\_sys\_call+0x1316/0x3cc0
do\_syscall\_64+0xd8/0x1c0
entry\_SYSCALL\_64\_after\_hwframe+0x79/0x81
Bytes 328-379 of 732 are uninitialized
Memory access of size 732 starts at ffff88800e18e000
Data copied to user address 00007ff30f48aff0
CPU: 2 PID: 18167 Comm: syz-executor.0 Not tainted 6.8.11 #1
Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS 1.15.0-1 04/01/2014
Fixes copying of xfrm algorithms where some random
data of the structure fields can end up in userspace.
Padding in structures may be filled with random (possibly sensitve)
data and should never be given directly to user-space.
A similar issue was resolved in the commit
8222d5910dae ("xfrm: Zero padding when dumping algos and encap")
Found by Linux Verification Center (linuxtesting.org) with Syzkaller.
Fixes: c7a5899eb26e ("xfrm: redact SA secret with lockdown confidentiality")
Cc: stable@vger.kernel.org
Co-developed-by: Boris Tonofa <b.tonofa@ideco.ru>
Signed-off-by: Boris Tonofa <b.tonofa@ideco.ru>
Signed-off-by: Petr Vaganov <p.vaganov@ideco.ru>
Signed-off-by: Steffen Klassert <steffen.klassert@secunet.com>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=c73bca72b84b453c8d26a5e7673b20adb294bf54)

| -rw-r--r-- | [net/xfrm/xfrm\_user.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/xfrm/xfrm_user.c?id=c73bca72b84b453c8d26a5e7673b20adb294bf54) | 4 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 3 insertions, 1 deletions

| diff --git a/net/xfrm/xfrm\_user.c b/net/xfrm/xfrm\_user.cindex 979f23cded401a..35b775cf233cde 100644--- a/[net/xfrm/xfrm\_user.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/xfrm/xfrm_user.c?id=36bd0f386b7c2d0ed237105e50d8c2cd139d1bbd)+++ b/[net/xfrm/xfrm\_user.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/xfrm/xfrm_user.c?id=c73bca72b84b453c8d26a5e7673b20adb294bf54)@@ -995,7 +995,9 @@ static int copy\_to\_user\_auth(struct xfrm\_algo\_auth \*auth, struct sk\_buff \*skb) if (!nla) return -EMSGSIZE; ap = nla\_data(nla);- memcpy(ap, auth, sizeof(struct xfrm\_algo\_auth));+ strscpy\_pad(ap->alg\_name, auth->alg\_name, sizeof(ap->alg\_name));+ ap->alg\_key\_len = auth->alg\_key\_len;+ ap->alg\_trunc\_len = auth->alg\_trunc\_len; if (redact\_secret && auth->alg\_key\_len) memset(ap->alg\_key, 0, (auth->alg\_key\_len + 7) / 8); else |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-15 08:27:50 +0000



=== Content from git.kernel.org_c5fca314_20250115_082910.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=1e8fbd2441cb2ea28d6825f2985bf7d84af060bb)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=1e8fbd2441cb2ea28d6825f2985bf7d84af060bb)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=1e8fbd2441cb2ea28d6825f2985bf7d84af060bb)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=1e8fbd2441cb2ea28d6825f2985bf7d84af060bb)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Petr Vaganov <p.vaganov@ideco.ru> | 2024-10-08 14:02:58 +0500 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-11-01 02:02:42 +0100 |
| commit | [1e8fbd2441cb2ea28d6825f2985bf7d84af060bb](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=1e8fbd2441cb2ea28d6825f2985bf7d84af060bb) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=1e8fbd2441cb2ea28d6825f2985bf7d84af060bb)) | |
| tree | [e19e37962f3be18b1688276e23dac73643328815](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=1e8fbd2441cb2ea28d6825f2985bf7d84af060bb) | |
| parent | [7abab6827b5703b8fa4fac00101a3253ff2bf58b](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=7abab6827b5703b8fa4fac00101a3253ff2bf58b) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=1e8fbd2441cb2ea28d6825f2985bf7d84af060bb&id2=7abab6827b5703b8fa4fac00101a3253ff2bf58b)) | |
| download | [linux-1e8fbd2441cb2ea28d6825f2985bf7d84af060bb.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-1e8fbd2441cb2ea28d6825f2985bf7d84af060bb.tar.gz) | |

xfrm: fix one more kernel-infoleak in algo dumpingcommit 6889cd2a93e1e3606b3f6e958aa0924e836de4d2 upstream.
During fuzz testing, the following issue was discovered:
BUG: KMSAN: kernel-infoleak in \_copy\_to\_iter+0x598/0x2a30
\_copy\_to\_iter+0x598/0x2a30
\_\_skb\_datagram\_iter+0x168/0x1060
skb\_copy\_datagram\_iter+0x5b/0x220
netlink\_recvmsg+0x362/0x1700
sock\_recvmsg+0x2dc/0x390
\_\_sys\_recvfrom+0x381/0x6d0
\_\_x64\_sys\_recvfrom+0x130/0x200
x64\_sys\_call+0x32c8/0x3cc0
do\_syscall\_64+0xd8/0x1c0
entry\_SYSCALL\_64\_after\_hwframe+0x79/0x81
Uninit was stored to memory at:
copy\_to\_user\_state\_extra+0xcc1/0x1e00
dump\_one\_state+0x28c/0x5f0
xfrm\_state\_walk+0x548/0x11e0
xfrm\_dump\_sa+0x1e0/0x840
netlink\_dump+0x943/0x1c40
\_\_netlink\_dump\_start+0x746/0xdb0
xfrm\_user\_rcv\_msg+0x429/0xc00
netlink\_rcv\_skb+0x613/0x780
xfrm\_netlink\_rcv+0x77/0xc0
netlink\_unicast+0xe90/0x1280
netlink\_sendmsg+0x126d/0x1490
\_\_sock\_sendmsg+0x332/0x3d0
\_\_\_\_sys\_sendmsg+0x863/0xc30
\_\_\_sys\_sendmsg+0x285/0x3e0
\_\_x64\_sys\_sendmsg+0x2d6/0x560
x64\_sys\_call+0x1316/0x3cc0
do\_syscall\_64+0xd8/0x1c0
entry\_SYSCALL\_64\_after\_hwframe+0x79/0x81
Uninit was created at:
\_\_kmalloc+0x571/0xd30
attach\_auth+0x106/0x3e0
xfrm\_add\_sa+0x2aa0/0x4230
xfrm\_user\_rcv\_msg+0x832/0xc00
netlink\_rcv\_skb+0x613/0x780
xfrm\_netlink\_rcv+0x77/0xc0
netlink\_unicast+0xe90/0x1280
netlink\_sendmsg+0x126d/0x1490
\_\_sock\_sendmsg+0x332/0x3d0
\_\_\_\_sys\_sendmsg+0x863/0xc30
\_\_\_sys\_sendmsg+0x285/0x3e0
\_\_x64\_sys\_sendmsg+0x2d6/0x560
x64\_sys\_call+0x1316/0x3cc0
do\_syscall\_64+0xd8/0x1c0
entry\_SYSCALL\_64\_after\_hwframe+0x79/0x81
Bytes 328-379 of 732 are uninitialized
Memory access of size 732 starts at ffff88800e18e000
Data copied to user address 00007ff30f48aff0
CPU: 2 PID: 18167 Comm: syz-executor.0 Not tainted 6.8.11 #1
Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS 1.15.0-1 04/01/2014
Fixes copying of xfrm algorithms where some random
data of the structure fields can end up in userspace.
Padding in structures may be filled with random (possibly sensitve)
data and should never be given directly to user-space.
A similar issue was resolved in the commit
8222d5910dae ("xfrm: Zero padding when dumping algos and encap")
Found by Linux Verification Center (linuxtesting.org) with Syzkaller.
Fixes: c7a5899eb26e ("xfrm: redact SA secret with lockdown confidentiality")
Cc: stable@vger.kernel.org
Co-developed-by: Boris Tonofa <b.tonofa@ideco.ru>
Signed-off-by: Boris Tonofa <b.tonofa@ideco.ru>
Signed-off-by: Petr Vaganov <p.vaganov@ideco.ru>
Signed-off-by: Steffen Klassert <steffen.klassert@secunet.com>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=1e8fbd2441cb2ea28d6825f2985bf7d84af060bb)

| -rw-r--r-- | [net/xfrm/xfrm\_user.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/xfrm/xfrm_user.c?id=1e8fbd2441cb2ea28d6825f2985bf7d84af060bb) | 4 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 3 insertions, 1 deletions

| diff --git a/net/xfrm/xfrm\_user.c b/net/xfrm/xfrm\_user.cindex 8d06a37adbd95f..eb146f574bbde7 100644--- a/[net/xfrm/xfrm\_user.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/xfrm/xfrm_user.c?id=7abab6827b5703b8fa4fac00101a3253ff2bf58b)+++ b/[net/xfrm/xfrm\_user.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/xfrm/xfrm_user.c?id=1e8fbd2441cb2ea28d6825f2985bf7d84af060bb)@@ -1102,7 +1102,9 @@ static int copy\_to\_user\_auth(struct xfrm\_algo\_auth \*auth, struct sk\_buff \*skb) if (!nla) return -EMSGSIZE; ap = nla\_data(nla);- memcpy(ap, auth, sizeof(struct xfrm\_algo\_auth));+ strscpy\_pad(ap->alg\_name, auth->alg\_name, sizeof(ap->alg\_name));+ ap->alg\_key\_len = auth->alg\_key\_len;+ ap->alg\_trunc\_len = auth->alg\_trunc\_len; if (redact\_secret && auth->alg\_key\_len) memset(ap->alg\_key, 0, (auth->alg\_key\_len + 7) / 8); else |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-15 08:27:48 +0000



=== Content from git.kernel.org_a63207d4_20250115_082911.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=6889cd2a93e1e3606b3f6e958aa0924e836de4d2)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=6889cd2a93e1e3606b3f6e958aa0924e836de4d2)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=6889cd2a93e1e3606b3f6e958aa0924e836de4d2)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=6889cd2a93e1e3606b3f6e958aa0924e836de4d2)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Petr Vaganov <p.vaganov@ideco.ru> | 2024-10-08 14:02:58 +0500 |
| --- | --- | --- |
| committer | Steffen Klassert <steffen.klassert@secunet.com> | 2024-10-11 09:00:03 +0200 |
| commit | [6889cd2a93e1e3606b3f6e958aa0924e836de4d2](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=6889cd2a93e1e3606b3f6e958aa0924e836de4d2) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=6889cd2a93e1e3606b3f6e958aa0924e836de4d2)) | |
| tree | [62f37a206ae6f84cff3cce7ad8ea64f640298dcb](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=6889cd2a93e1e3606b3f6e958aa0924e836de4d2) | |
| parent | [3f0ab59e6537c6a8f9e1b355b48f9c05a76e8563](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=3f0ab59e6537c6a8f9e1b355b48f9c05a76e8563) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=6889cd2a93e1e3606b3f6e958aa0924e836de4d2&id2=3f0ab59e6537c6a8f9e1b355b48f9c05a76e8563)) | |
| download | [linux-6889cd2a93e1e3606b3f6e958aa0924e836de4d2.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-6889cd2a93e1e3606b3f6e958aa0924e836de4d2.tar.gz) | |

xfrm: fix one more kernel-infoleak in algo dumpingDuring fuzz testing, the following issue was discovered:
BUG: KMSAN: kernel-infoleak in \_copy\_to\_iter+0x598/0x2a30
\_copy\_to\_iter+0x598/0x2a30
\_\_skb\_datagram\_iter+0x168/0x1060
skb\_copy\_datagram\_iter+0x5b/0x220
netlink\_recvmsg+0x362/0x1700
sock\_recvmsg+0x2dc/0x390
\_\_sys\_recvfrom+0x381/0x6d0
\_\_x64\_sys\_recvfrom+0x130/0x200
x64\_sys\_call+0x32c8/0x3cc0
do\_syscall\_64+0xd8/0x1c0
entry\_SYSCALL\_64\_after\_hwframe+0x79/0x81
Uninit was stored to memory at:
copy\_to\_user\_state\_extra+0xcc1/0x1e00
dump\_one\_state+0x28c/0x5f0
xfrm\_state\_walk+0x548/0x11e0
xfrm\_dump\_sa+0x1e0/0x840
netlink\_dump+0x943/0x1c40
\_\_netlink\_dump\_start+0x746/0xdb0
xfrm\_user\_rcv\_msg+0x429/0xc00
netlink\_rcv\_skb+0x613/0x780
xfrm\_netlink\_rcv+0x77/0xc0
netlink\_unicast+0xe90/0x1280
netlink\_sendmsg+0x126d/0x1490
\_\_sock\_sendmsg+0x332/0x3d0
\_\_\_\_sys\_sendmsg+0x863/0xc30
\_\_\_sys\_sendmsg+0x285/0x3e0
\_\_x64\_sys\_sendmsg+0x2d6/0x560
x64\_sys\_call+0x1316/0x3cc0
do\_syscall\_64+0xd8/0x1c0
entry\_SYSCALL\_64\_after\_hwframe+0x79/0x81
Uninit was created at:
\_\_kmalloc+0x571/0xd30
attach\_auth+0x106/0x3e0
xfrm\_add\_sa+0x2aa0/0x4230
xfrm\_user\_rcv\_msg+0x832/0xc00
netlink\_rcv\_skb+0x613/0x780
xfrm\_netlink\_rcv+0x77/0xc0
netlink\_unicast+0xe90/0x1280
netlink\_sendmsg+0x126d/0x1490
\_\_sock\_sendmsg+0x332/0x3d0
\_\_\_\_sys\_sendmsg+0x863/0xc30
\_\_\_sys\_sendmsg+0x285/0x3e0
\_\_x64\_sys\_sendmsg+0x2d6/0x560
x64\_sys\_call+0x1316/0x3cc0
do\_syscall\_64+0xd8/0x1c0
entry\_SYSCALL\_64\_after\_hwframe+0x79/0x81
Bytes 328-379 of 732 are uninitialized
Memory access of size 732 starts at ffff88800e18e000
Data copied to user address 00007ff30f48aff0
CPU: 2 PID: 18167 Comm: syz-executor.0 Not tainted 6.8.11 #1
Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS 1.15.0-1 04/01/2014
Fixes copying of xfrm algorithms where some random
data of the structure fields can end up in userspace.
Padding in structures may be filled with random (possibly sensitve)
data and should never be given directly to user-space.
A similar issue was resolved in the commit
8222d5910dae ("xfrm: Zero padding when dumping algos and encap")
Found by Linux Verification Center (linuxtesting.org) with Syzkaller.
Fixes: c7a5899eb26e ("xfrm: redact SA secret with lockdown confidentiality")
Cc: stable@vger.kernel.org
Co-developed-by: Boris Tonofa <b.tonofa@ideco.ru>
Signed-off-by: Boris Tonofa <b.tonofa@ideco.ru>
Signed-off-by: Petr Vaganov <p.vaganov@ideco.ru>
Signed-off-by: Steffen Klassert <steffen.klassert@secunet.com>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=6889cd2a93e1e3606b3f6e958aa0924e836de4d2)

| -rw-r--r-- | [net/xfrm/xfrm\_user.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/xfrm/xfrm_user.c?id=6889cd2a93e1e3606b3f6e958aa0924e836de4d2) | 4 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 3 insertions, 1 deletions

| diff --git a/net/xfrm/xfrm\_user.c b/net/xfrm/xfrm\_user.cindex 8d06a37adbd95f..eb146f574bbde7 100644--- a/[net/xfrm/xfrm\_user.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/xfrm/xfrm_user.c?id=3f0ab59e6537c6a8f9e1b355b48f9c05a76e8563)+++ b/[net/xfrm/xfrm\_user.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/xfrm/xfrm_user.c?id=6889cd2a93e1e3606b3f6e958aa0924e836de4d2)@@ -1102,7 +1102,9 @@ static int copy\_to\_user\_auth(struct xfrm\_algo\_auth \*auth, struct sk\_buff \*skb) if (!nla) return -EMSGSIZE; ap = nla\_data(nla);- memcpy(ap, auth, sizeof(struct xfrm\_algo\_auth));+ strscpy\_pad(ap->alg\_name, auth->alg\_name, sizeof(ap->alg\_name));+ ap->alg\_key\_len = auth->alg\_key\_len;+ ap->alg\_trunc\_len = auth->alg\_trunc\_len; if (redact\_secret && auth->alg\_key\_len) memset(ap->alg\_key, 0, (auth->alg\_key\_len + 7) / 8); else |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-15 08:27:49 +0000



=== Content from git.kernel.org_4acf8365_20250115_082913.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=dc2ad8e8818e4bf1a93db78d81745b4877b32972)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=dc2ad8e8818e4bf1a93db78d81745b4877b32972)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=dc2ad8e8818e4bf1a93db78d81745b4877b32972)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=dc2ad8e8818e4bf1a93db78d81745b4877b32972)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Petr Vaganov <p.vaganov@ideco.ru> | 2024-10-08 14:02:58 +0500 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-11-01 01:56:06 +0100 |
| commit | [dc2ad8e8818e4bf1a93db78d81745b4877b32972](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=dc2ad8e8818e4bf1a93db78d81745b4877b32972) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=dc2ad8e8818e4bf1a93db78d81745b4877b32972)) | |
| tree | [ef9bbb28f88dd6cb8ca7f43c9f3f3e930e452b78](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=dc2ad8e8818e4bf1a93db78d81745b4877b32972) | |
| parent | [9bb6ec11751cadc35a17352d8f0ac00225528e46](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=9bb6ec11751cadc35a17352d8f0ac00225528e46) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=dc2ad8e8818e4bf1a93db78d81745b4877b32972&id2=9bb6ec11751cadc35a17352d8f0ac00225528e46)) | |
| download | [linux-dc2ad8e8818e4bf1a93db78d81745b4877b32972.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-dc2ad8e8818e4bf1a93db78d81745b4877b32972.tar.gz) | |

xfrm: fix one more kernel-infoleak in algo dumpingcommit 6889cd2a93e1e3606b3f6e958aa0924e836de4d2 upstream.
During fuzz testing, the following issue was discovered:
BUG: KMSAN: kernel-infoleak in \_copy\_to\_iter+0x598/0x2a30
\_copy\_to\_iter+0x598/0x2a30
\_\_skb\_datagram\_iter+0x168/0x1060
skb\_copy\_datagram\_iter+0x5b/0x220
netlink\_recvmsg+0x362/0x1700
sock\_recvmsg+0x2dc/0x390
\_\_sys\_recvfrom+0x381/0x6d0
\_\_x64\_sys\_recvfrom+0x130/0x200
x64\_sys\_call+0x32c8/0x3cc0
do\_syscall\_64+0xd8/0x1c0
entry\_SYSCALL\_64\_after\_hwframe+0x79/0x81
Uninit was stored to memory at:
copy\_to\_user\_state\_extra+0xcc1/0x1e00
dump\_one\_state+0x28c/0x5f0
xfrm\_state\_walk+0x548/0x11e0
xfrm\_dump\_sa+0x1e0/0x840
netlink\_dump+0x943/0x1c40
\_\_netlink\_dump\_start+0x746/0xdb0
xfrm\_user\_rcv\_msg+0x429/0xc00
netlink\_rcv\_skb+0x613/0x780
xfrm\_netlink\_rcv+0x77/0xc0
netlink\_unicast+0xe90/0x1280
netlink\_sendmsg+0x126d/0x1490
\_\_sock\_sendmsg+0x332/0x3d0
\_\_\_\_sys\_sendmsg+0x863/0xc30
\_\_\_sys\_sendmsg+0x285/0x3e0
\_\_x64\_sys\_sendmsg+0x2d6/0x560
x64\_sys\_call+0x1316/0x3cc0
do\_syscall\_64+0xd8/0x1c0
entry\_SYSCALL\_64\_after\_hwframe+0x79/0x81
Uninit was created at:
\_\_kmalloc+0x571/0xd30
attach\_auth+0x106/0x3e0
xfrm\_add\_sa+0x2aa0/0x4230
xfrm\_user\_rcv\_msg+0x832/0xc00
netlink\_rcv\_skb+0x613/0x780
xfrm\_netlink\_rcv+0x77/0xc0
netlink\_unicast+0xe90/0x1280
netlink\_sendmsg+0x126d/0x1490
\_\_sock\_sendmsg+0x332/0x3d0
\_\_\_\_sys\_sendmsg+0x863/0xc30
\_\_\_sys\_sendmsg+0x285/0x3e0
\_\_x64\_sys\_sendmsg+0x2d6/0x560
x64\_sys\_call+0x1316/0x3cc0
do\_syscall\_64+0xd8/0x1c0
entry\_SYSCALL\_64\_after\_hwframe+0x79/0x81
Bytes 328-379 of 732 are uninitialized
Memory access of size 732 starts at ffff88800e18e000
Data copied to user address 00007ff30f48aff0
CPU: 2 PID: 18167 Comm: syz-executor.0 Not tainted 6.8.11 #1
Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS 1.15.0-1 04/01/2014
Fixes copying of xfrm algorithms where some random
data of the structure fields can end up in userspace.
Padding in structures may be filled with random (possibly sensitve)
data and should never be given directly to user-space.
A similar issue was resolved in the commit
8222d5910dae ("xfrm: Zero padding when dumping algos and encap")
Found by Linux Verification Center (linuxtesting.org) with Syzkaller.
Fixes: c7a5899eb26e ("xfrm: redact SA secret with lockdown confidentiality")
Cc: stable@vger.kernel.org
Co-developed-by: Boris Tonofa <b.tonofa@ideco.ru>
Signed-off-by: Boris Tonofa <b.tonofa@ideco.ru>
Signed-off-by: Petr Vaganov <p.vaganov@ideco.ru>
Signed-off-by: Steffen Klassert <steffen.klassert@secunet.com>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=dc2ad8e8818e4bf1a93db78d81745b4877b32972)

| -rw-r--r-- | [net/xfrm/xfrm\_user.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/xfrm/xfrm_user.c?id=dc2ad8e8818e4bf1a93db78d81745b4877b32972) | 4 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 3 insertions, 1 deletions

| diff --git a/net/xfrm/xfrm\_user.c b/net/xfrm/xfrm\_user.cindex 0cc4ed29e90151..442b1271057a11 100644--- a/[net/xfrm/xfrm\_user.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/xfrm/xfrm_user.c?id=9bb6ec11751cadc35a17352d8f0ac00225528e46)+++ b/[net/xfrm/xfrm\_user.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/xfrm/xfrm_user.c?id=dc2ad8e8818e4bf1a93db78d81745b4877b32972)@@ -978,7 +978,9 @@ static int copy\_to\_user\_auth(struct xfrm\_algo\_auth \*auth, struct sk\_buff \*skb) if (!nla) return -EMSGSIZE; ap = nla\_data(nla);- memcpy(ap, auth, sizeof(struct xfrm\_algo\_auth));+ strscpy\_pad(ap->alg\_name, auth->alg\_name, sizeof(ap->alg\_name));+ ap->alg\_key\_len = auth->alg\_key\_len;+ ap->alg\_trunc\_len = auth->alg\_trunc\_len; if (redact\_secret && auth->alg\_key\_len) memset(ap->alg\_key, 0, (auth->alg\_key\_len + 7) / 8); else |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-15 08:27:50 +0000



=== Content from git.kernel.org_5c3a6a14_20250115_082911.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=610d4cea9b442b22b4820695fc3335e64849725e)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=610d4cea9b442b22b4820695fc3335e64849725e)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=610d4cea9b442b22b4820695fc3335e64849725e)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=610d4cea9b442b22b4820695fc3335e64849725e)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Petr Vaganov <p.vaganov@ideco.ru> | 2024-10-08 14:02:58 +0500 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-11-01 01:52:38 +0100 |
| commit | [610d4cea9b442b22b4820695fc3335e64849725e](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=610d4cea9b442b22b4820695fc3335e64849725e) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=610d4cea9b442b22b4820695fc3335e64849725e)) | |
| tree | [d7cd26d5419b6ce79d41a33d34f8e5b961e627cf](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=610d4cea9b442b22b4820695fc3335e64849725e) | |
| parent | [385e2f3e0d83d18af45971dec1e257159bb6e207](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=385e2f3e0d83d18af45971dec1e257159bb6e207) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=610d4cea9b442b22b4820695fc3335e64849725e&id2=385e2f3e0d83d18af45971dec1e257159bb6e207)) | |
| download | [linux-610d4cea9b442b22b4820695fc3335e64849725e.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-610d4cea9b442b22b4820695fc3335e64849725e.tar.gz) | |

xfrm: fix one more kernel-infoleak in algo dumpingcommit 6889cd2a93e1e3606b3f6e958aa0924e836de4d2 upstream.
During fuzz testing, the following issue was discovered:
BUG: KMSAN: kernel-infoleak in \_copy\_to\_iter+0x598/0x2a30
\_copy\_to\_iter+0x598/0x2a30
\_\_skb\_datagram\_iter+0x168/0x1060
skb\_copy\_datagram\_iter+0x5b/0x220
netlink\_recvmsg+0x362/0x1700
sock\_recvmsg+0x2dc/0x390
\_\_sys\_recvfrom+0x381/0x6d0
\_\_x64\_sys\_recvfrom+0x130/0x200
x64\_sys\_call+0x32c8/0x3cc0
do\_syscall\_64+0xd8/0x1c0
entry\_SYSCALL\_64\_after\_hwframe+0x79/0x81
Uninit was stored to memory at:
copy\_to\_user\_state\_extra+0xcc1/0x1e00
dump\_one\_state+0x28c/0x5f0
xfrm\_state\_walk+0x548/0x11e0
xfrm\_dump\_sa+0x1e0/0x840
netlink\_dump+0x943/0x1c40
\_\_netlink\_dump\_start+0x746/0xdb0
xfrm\_user\_rcv\_msg+0x429/0xc00
netlink\_rcv\_skb+0x613/0x780
xfrm\_netlink\_rcv+0x77/0xc0
netlink\_unicast+0xe90/0x1280
netlink\_sendmsg+0x126d/0x1490
\_\_sock\_sendmsg+0x332/0x3d0
\_\_\_\_sys\_sendmsg+0x863/0xc30
\_\_\_sys\_sendmsg+0x285/0x3e0
\_\_x64\_sys\_sendmsg+0x2d6/0x560
x64\_sys\_call+0x1316/0x3cc0
do\_syscall\_64+0xd8/0x1c0
entry\_SYSCALL\_64\_after\_hwframe+0x79/0x81
Uninit was created at:
\_\_kmalloc+0x571/0xd30
attach\_auth+0x106/0x3e0
xfrm\_add\_sa+0x2aa0/0x4230
xfrm\_user\_rcv\_msg+0x832/0xc00
netlink\_rcv\_skb+0x613/0x780
xfrm\_netlink\_rcv+0x77/0xc0
netlink\_unicast+0xe90/0x1280
netlink\_sendmsg+0x126d/0x1490
\_\_sock\_sendmsg+0x332/0x3d0
\_\_\_\_sys\_sendmsg+0x863/0xc30
\_\_\_sys\_sendmsg+0x285/0x3e0
\_\_x64\_sys\_sendmsg+0x2d6/0x560
x64\_sys\_call+0x1316/0x3cc0
do\_syscall\_64+0xd8/0x1c0
entry\_SYSCALL\_64\_after\_hwframe+0x79/0x81
Bytes 328-379 of 732 are uninitialized
Memory access of size 732 starts at ffff88800e18e000
Data copied to user address 00007ff30f48aff0
CPU: 2 PID: 18167 Comm: syz-executor.0 Not tainted 6.8.11 #1
Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS 1.15.0-1 04/01/2014
Fixes copying of xfrm algorithms where some random
data of the structure fields can end up in userspace.
Padding in structures may be filled with random (possibly sensitve)
data and should never be given directly to user-space.
A similar issue was resolved in the commit
8222d5910dae ("xfrm: Zero padding when dumping algos and encap")
Found by Linux Verification Center (linuxtesting.org) with Syzkaller.
Fixes: c7a5899eb26e ("xfrm: redact SA secret with lockdown confidentiality")
Cc: stable@vger.kernel.org
Co-developed-by: Boris Tonofa <b.tonofa@ideco.ru>
Signed-off-by: Boris Tonofa <b.tonofa@ideco.ru>
Signed-off-by: Petr Vaganov <p.vaganov@ideco.ru>
Signed-off-by: Steffen Klassert <steffen.klassert@secunet.com>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=610d4cea9b442b22b4820695fc3335e64849725e)

| -rw-r--r-- | [net/xfrm/xfrm\_user.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/xfrm/xfrm_user.c?id=610d4cea9b442b22b4820695fc3335e64849725e) | 4 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 3 insertions, 1 deletions

| diff --git a/net/xfrm/xfrm\_user.c b/net/xfrm/xfrm\_user.cindex d65f781f7a36cd..33110f3ef7863c 100644--- a/[net/xfrm/xfrm\_user.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/xfrm/xfrm_user.c?id=385e2f3e0d83d18af45971dec1e257159bb6e207)+++ b/[net/xfrm/xfrm\_user.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/xfrm/xfrm_user.c?id=610d4cea9b442b22b4820695fc3335e64849725e)@@ -887,7 +887,9 @@ static int copy\_to\_user\_auth(struct xfrm\_algo\_auth \*auth, struct sk\_buff \*skb) if (!nla) return -EMSGSIZE; ap = nla\_data(nla);- memcpy(ap, auth, sizeof(struct xfrm\_algo\_auth));+ strscpy\_pad(ap->alg\_name, auth->alg\_name, sizeof(ap->alg\_name));+ ap->alg\_key\_len = auth->alg\_key\_len;+ ap->alg\_trunc\_len = auth->alg\_trunc\_len; if (redact\_secret && auth->alg\_key\_len) memset(ap->alg\_key, 0, (auth->alg\_key\_len + 7) / 8); else |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-15 08:27:48 +0000


