=== Content from git.kernel.org_430c8694_20250114_202009.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=ccb8e44ae3e2391235f80ffc6be59bec6b889ead)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=ccb8e44ae3e2391235f80ffc6be59bec6b889ead)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=ccb8e44ae3e2391235f80ffc6be59bec6b889ead)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=ccb8e44ae3e2391235f80ffc6be59bec6b889ead)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Md Haris Iqbal <haris.iqbal@ionos.com> | 2024-08-21 13:22:14 +0200 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-10-17 15:24:17 +0200 |
| commit | [ccb8e44ae3e2391235f80ffc6be59bec6b889ead](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=ccb8e44ae3e2391235f80ffc6be59bec6b889ead) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=ccb8e44ae3e2391235f80ffc6be59bec6b889ead)) | |
| tree | [d317adba79a718c9829c006b9c6712d334d4230a](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=ccb8e44ae3e2391235f80ffc6be59bec6b889ead) | |
| parent | [bd9a77a930498f2ec677230ea0da2e3173d42c7a](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=bd9a77a930498f2ec677230ea0da2e3173d42c7a) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=ccb8e44ae3e2391235f80ffc6be59bec6b889ead&id2=bd9a77a930498f2ec677230ea0da2e3173d42c7a)) | |
| download | [linux-ccb8e44ae3e2391235f80ffc6be59bec6b889ead.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-ccb8e44ae3e2391235f80ffc6be59bec6b889ead.tar.gz) | |

RDMA/rtrs-srv: Avoid null pointer deref during path establishment[ Upstream commit d0e62bf7b575fbfe591f6f570e7595dd60a2f5eb ]
For RTRS path establishment, RTRS client initiates and completes con\_num
of connections. After establishing all its connections, the information
is exchanged between the client and server through the info\_req message.
During this exchange, it is essential that all connections have been
established, and the state of the RTRS srv path is CONNECTED.
So add these sanity checks, to make sure we detect and abort process in
error scenarios to avoid null pointer deref.
Signed-off-by: Md Haris Iqbal <haris.iqbal@ionos.com>
Signed-off-by: Jack Wang <jinpu.wang@ionos.com>
Signed-off-by: Grzegorz Prajsner <grzegorz.prajsner@ionos.com>
Link: [https://patch.msgid.link/20240821112217.41827-9-haris.iqbal@ionos.com](https://patch.msgid.link/20240821112217.41827-9-haris.iqbal%40ionos.com)
Signed-off-by: Leon Romanovsky <leon@kernel.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=ccb8e44ae3e2391235f80ffc6be59bec6b889ead)

| -rw-r--r-- | [drivers/infiniband/ulp/rtrs/rtrs-srv.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/infiniband/ulp/rtrs/rtrs-srv.c?id=ccb8e44ae3e2391235f80ffc6be59bec6b889ead) | 13 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 11 insertions, 2 deletions

| diff --git a/drivers/infiniband/ulp/rtrs/rtrs-srv.c b/drivers/infiniband/ulp/rtrs/rtrs-srv.cindex 94ac99a4f696e7..758a3d9c2844d1 100644--- a/[drivers/infiniband/ulp/rtrs/rtrs-srv.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/infiniband/ulp/rtrs/rtrs-srv.c?id=bd9a77a930498f2ec677230ea0da2e3173d42c7a)+++ b/[drivers/infiniband/ulp/rtrs/rtrs-srv.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/infiniband/ulp/rtrs/rtrs-srv.c?id=ccb8e44ae3e2391235f80ffc6be59bec6b889ead)@@ -931,12 +931,11 @@ static void rtrs\_srv\_info\_req\_done(struct ib\_cq \*cq, struct ib\_wc \*wc) if (err) goto close; -out: rtrs\_iu\_free(iu, srv\_path->s.dev->ib\_dev, 1); return; close:+ rtrs\_iu\_free(iu, srv\_path->s.dev->ib\_dev, 1); close\_path(srv\_path);- goto out; }  static int post\_recv\_info\_req(struct rtrs\_srv\_con \*con)@@ -987,6 +986,16 @@ static int post\_recv\_path(struct rtrs\_srv\_path \*srv\_path) q\_size = SERVICE\_CON\_QUEUE\_DEPTH; else q\_size = srv->queue\_depth;+ if (srv\_path->state != RTRS\_SRV\_CONNECTING) {+ rtrs\_err(s, "Path state invalid. state %s\n",+ rtrs\_srv\_state\_str(srv\_path->state));+ return -EIO;+ }++ if (!srv\_path->s.con[cid]) {+ rtrs\_err(s, "Conn not set for %d\n", cid);+ return -EIO;+ }  err = post\_recv\_io(to\_srv\_con(srv\_path->s.con[cid]), q\_size); if (err) { |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 20:18:45 +0000



=== Content from git.kernel.org_ff6a0203_20250114_202007.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=b720792d7e8515bc695752e0ed5884e2ea34d12a)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=b720792d7e8515bc695752e0ed5884e2ea34d12a)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=b720792d7e8515bc695752e0ed5884e2ea34d12a)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b720792d7e8515bc695752e0ed5884e2ea34d12a)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Md Haris Iqbal <haris.iqbal@ionos.com> | 2024-08-21 13:22:14 +0200 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-10-17 15:26:35 +0200 |
| commit | [b720792d7e8515bc695752e0ed5884e2ea34d12a](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=b720792d7e8515bc695752e0ed5884e2ea34d12a) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=b720792d7e8515bc695752e0ed5884e2ea34d12a)) | |
| tree | [c7cfa35e12b095d255edb187d687d2f6deef5956](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=b720792d7e8515bc695752e0ed5884e2ea34d12a) | |
| parent | [efe07dfad8d49838b1ad0c25fcde0bfdb09c4954](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=efe07dfad8d49838b1ad0c25fcde0bfdb09c4954) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b720792d7e8515bc695752e0ed5884e2ea34d12a&id2=efe07dfad8d49838b1ad0c25fcde0bfdb09c4954)) | |
| download | [linux-b720792d7e8515bc695752e0ed5884e2ea34d12a.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-b720792d7e8515bc695752e0ed5884e2ea34d12a.tar.gz) | |

RDMA/rtrs-srv: Avoid null pointer deref during path establishment[ Upstream commit d0e62bf7b575fbfe591f6f570e7595dd60a2f5eb ]
For RTRS path establishment, RTRS client initiates and completes con\_num
of connections. After establishing all its connections, the information
is exchanged between the client and server through the info\_req message.
During this exchange, it is essential that all connections have been
established, and the state of the RTRS srv path is CONNECTED.
So add these sanity checks, to make sure we detect and abort process in
error scenarios to avoid null pointer deref.
Signed-off-by: Md Haris Iqbal <haris.iqbal@ionos.com>
Signed-off-by: Jack Wang <jinpu.wang@ionos.com>
Signed-off-by: Grzegorz Prajsner <grzegorz.prajsner@ionos.com>
Link: [https://patch.msgid.link/20240821112217.41827-9-haris.iqbal@ionos.com](https://patch.msgid.link/20240821112217.41827-9-haris.iqbal%40ionos.com)
Signed-off-by: Leon Romanovsky <leon@kernel.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b720792d7e8515bc695752e0ed5884e2ea34d12a)

| -rw-r--r-- | [drivers/infiniband/ulp/rtrs/rtrs-srv.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/infiniband/ulp/rtrs/rtrs-srv.c?id=b720792d7e8515bc695752e0ed5884e2ea34d12a) | 13 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 11 insertions, 2 deletions

| diff --git a/drivers/infiniband/ulp/rtrs/rtrs-srv.c b/drivers/infiniband/ulp/rtrs/rtrs-srv.cindex 94ac99a4f696e7..758a3d9c2844d1 100644--- a/[drivers/infiniband/ulp/rtrs/rtrs-srv.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/infiniband/ulp/rtrs/rtrs-srv.c?id=efe07dfad8d49838b1ad0c25fcde0bfdb09c4954)+++ b/[drivers/infiniband/ulp/rtrs/rtrs-srv.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/infiniband/ulp/rtrs/rtrs-srv.c?id=b720792d7e8515bc695752e0ed5884e2ea34d12a)@@ -931,12 +931,11 @@ static void rtrs\_srv\_info\_req\_done(struct ib\_cq \*cq, struct ib\_wc \*wc) if (err) goto close; -out: rtrs\_iu\_free(iu, srv\_path->s.dev->ib\_dev, 1); return; close:+ rtrs\_iu\_free(iu, srv\_path->s.dev->ib\_dev, 1); close\_path(srv\_path);- goto out; }  static int post\_recv\_info\_req(struct rtrs\_srv\_con \*con)@@ -987,6 +986,16 @@ static int post\_recv\_path(struct rtrs\_srv\_path \*srv\_path) q\_size = SERVICE\_CON\_QUEUE\_DEPTH; else q\_size = srv->queue\_depth;+ if (srv\_path->state != RTRS\_SRV\_CONNECTING) {+ rtrs\_err(s, "Path state invalid. state %s\n",+ rtrs\_srv\_state\_str(srv\_path->state));+ return -EIO;+ }++ if (!srv\_path->s.con[cid]) {+ rtrs\_err(s, "Conn not set for %d\n", cid);+ return -EIO;+ }  err = post\_recv\_io(to\_srv\_con(srv\_path->s.con[cid]), q\_size); if (err) { |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 20:18:43 +0000



=== Content from git.kernel.org_b95591fc_20250114_202005.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=b5d4076664465487a9a3d226756995b12fb73d71)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=b5d4076664465487a9a3d226756995b12fb73d71)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=b5d4076664465487a9a3d226756995b12fb73d71)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b5d4076664465487a9a3d226756995b12fb73d71)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Md Haris Iqbal <haris.iqbal@ionos.com> | 2024-08-21 13:22:14 +0200 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-10-17 15:22:14 +0200 |
| commit | [b5d4076664465487a9a3d226756995b12fb73d71](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=b5d4076664465487a9a3d226756995b12fb73d71) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=b5d4076664465487a9a3d226756995b12fb73d71)) | |
| tree | [464059af1572b8713f623fbfb18768d794e2166e](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=b5d4076664465487a9a3d226756995b12fb73d71) | |
| parent | [90be6ffc6ae0c01d2c79c8687be31069f45295d6](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=90be6ffc6ae0c01d2c79c8687be31069f45295d6) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b5d4076664465487a9a3d226756995b12fb73d71&id2=90be6ffc6ae0c01d2c79c8687be31069f45295d6)) | |
| download | [linux-b5d4076664465487a9a3d226756995b12fb73d71.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-b5d4076664465487a9a3d226756995b12fb73d71.tar.gz) | |

RDMA/rtrs-srv: Avoid null pointer deref during path establishment[ Upstream commit d0e62bf7b575fbfe591f6f570e7595dd60a2f5eb ]
For RTRS path establishment, RTRS client initiates and completes con\_num
of connections. After establishing all its connections, the information
is exchanged between the client and server through the info\_req message.
During this exchange, it is essential that all connections have been
established, and the state of the RTRS srv path is CONNECTED.
So add these sanity checks, to make sure we detect and abort process in
error scenarios to avoid null pointer deref.
Signed-off-by: Md Haris Iqbal <haris.iqbal@ionos.com>
Signed-off-by: Jack Wang <jinpu.wang@ionos.com>
Signed-off-by: Grzegorz Prajsner <grzegorz.prajsner@ionos.com>
Link: [https://patch.msgid.link/20240821112217.41827-9-haris.iqbal@ionos.com](https://patch.msgid.link/20240821112217.41827-9-haris.iqbal%40ionos.com)
Signed-off-by: Leon Romanovsky <leon@kernel.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b5d4076664465487a9a3d226756995b12fb73d71)

| -rw-r--r-- | [drivers/infiniband/ulp/rtrs/rtrs-srv.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/infiniband/ulp/rtrs/rtrs-srv.c?id=b5d4076664465487a9a3d226756995b12fb73d71) | 13 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 11 insertions, 2 deletions

| diff --git a/drivers/infiniband/ulp/rtrs/rtrs-srv.c b/drivers/infiniband/ulp/rtrs/rtrs-srv.cindex 726b690ebe6529..a70ccb4d4c857b 100644--- a/[drivers/infiniband/ulp/rtrs/rtrs-srv.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/infiniband/ulp/rtrs/rtrs-srv.c?id=90be6ffc6ae0c01d2c79c8687be31069f45295d6)+++ b/[drivers/infiniband/ulp/rtrs/rtrs-srv.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/infiniband/ulp/rtrs/rtrs-srv.c?id=b5d4076664465487a9a3d226756995b12fb73d71)@@ -936,12 +936,11 @@ static void rtrs\_srv\_info\_req\_done(struct ib\_cq \*cq, struct ib\_wc \*wc) if (err) goto close; -out: rtrs\_iu\_free(iu, srv\_path->s.dev->ib\_dev, 1); return; close:+ rtrs\_iu\_free(iu, srv\_path->s.dev->ib\_dev, 1); close\_path(srv\_path);- goto out; }  static int post\_recv\_info\_req(struct rtrs\_srv\_con \*con)@@ -992,6 +991,16 @@ static int post\_recv\_path(struct rtrs\_srv\_path \*srv\_path) q\_size = SERVICE\_CON\_QUEUE\_DEPTH; else q\_size = srv->queue\_depth;+ if (srv\_path->state != RTRS\_SRV\_CONNECTING) {+ rtrs\_err(s, "Path state invalid. state %s\n",+ rtrs\_srv\_state\_str(srv\_path->state));+ return -EIO;+ }++ if (!srv\_path->s.con[cid]) {+ rtrs\_err(s, "Conn not set for %d\n", cid);+ return -EIO;+ }  err = post\_recv\_io(to\_srv\_con(srv\_path->s.con[cid]), q\_size); if (err) { |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 20:18:41 +0000



=== Content from git.kernel.org_107baee0_20250114_202003.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=394b2f4d5e014820455af3eb5859eb328eaafcfd)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=394b2f4d5e014820455af3eb5859eb328eaafcfd)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=394b2f4d5e014820455af3eb5859eb328eaafcfd)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=394b2f4d5e014820455af3eb5859eb328eaafcfd)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Md Haris Iqbal <haris.iqbal@ionos.com> | 2024-08-21 13:22:14 +0200 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-10-17 15:11:51 +0200 |
| commit | [394b2f4d5e014820455af3eb5859eb328eaafcfd](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=394b2f4d5e014820455af3eb5859eb328eaafcfd) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=394b2f4d5e014820455af3eb5859eb328eaafcfd)) | |
| tree | [3d65e7b39ce87a394ddb0f7462b688cc1ed8e1ed](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=394b2f4d5e014820455af3eb5859eb328eaafcfd) | |
| parent | [eb54979471aa97182e05aa4e91a1072fa862bf62](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=eb54979471aa97182e05aa4e91a1072fa862bf62) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=394b2f4d5e014820455af3eb5859eb328eaafcfd&id2=eb54979471aa97182e05aa4e91a1072fa862bf62)) | |
| download | [linux-394b2f4d5e014820455af3eb5859eb328eaafcfd.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-394b2f4d5e014820455af3eb5859eb328eaafcfd.tar.gz) | |

RDMA/rtrs-srv: Avoid null pointer deref during path establishment[ Upstream commit d0e62bf7b575fbfe591f6f570e7595dd60a2f5eb ]
For RTRS path establishment, RTRS client initiates and completes con\_num
of connections. After establishing all its connections, the information
is exchanged between the client and server through the info\_req message.
During this exchange, it is essential that all connections have been
established, and the state of the RTRS srv path is CONNECTED.
So add these sanity checks, to make sure we detect and abort process in
error scenarios to avoid null pointer deref.
Signed-off-by: Md Haris Iqbal <haris.iqbal@ionos.com>
Signed-off-by: Jack Wang <jinpu.wang@ionos.com>
Signed-off-by: Grzegorz Prajsner <grzegorz.prajsner@ionos.com>
Link: [https://patch.msgid.link/20240821112217.41827-9-haris.iqbal@ionos.com](https://patch.msgid.link/20240821112217.41827-9-haris.iqbal%40ionos.com)
Signed-off-by: Leon Romanovsky <leon@kernel.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=394b2f4d5e014820455af3eb5859eb328eaafcfd)

| -rw-r--r-- | [drivers/infiniband/ulp/rtrs/rtrs-srv.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/infiniband/ulp/rtrs/rtrs-srv.c?id=394b2f4d5e014820455af3eb5859eb328eaafcfd) | 13 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 11 insertions, 2 deletions

| diff --git a/drivers/infiniband/ulp/rtrs/rtrs-srv.c b/drivers/infiniband/ulp/rtrs/rtrs-srv.cindex 1af6db9a6511a1..4fa916a8f38653 100644--- a/[drivers/infiniband/ulp/rtrs/rtrs-srv.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/infiniband/ulp/rtrs/rtrs-srv.c?id=eb54979471aa97182e05aa4e91a1072fa862bf62)+++ b/[drivers/infiniband/ulp/rtrs/rtrs-srv.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/infiniband/ulp/rtrs/rtrs-srv.c?id=394b2f4d5e014820455af3eb5859eb328eaafcfd)@@ -943,12 +943,11 @@ static void rtrs\_srv\_info\_req\_done(struct ib\_cq \*cq, struct ib\_wc \*wc) if (err) goto close; -out: rtrs\_iu\_free(iu, srv\_path->s.dev->ib\_dev, 1); return; close:+ rtrs\_iu\_free(iu, srv\_path->s.dev->ib\_dev, 1); close\_path(srv\_path);- goto out; }  static int post\_recv\_info\_req(struct rtrs\_srv\_con \*con)@@ -999,6 +998,16 @@ static int post\_recv\_path(struct rtrs\_srv\_path \*srv\_path) q\_size = SERVICE\_CON\_QUEUE\_DEPTH; else q\_size = srv->queue\_depth;+ if (srv\_path->state != RTRS\_SRV\_CONNECTING) {+ rtrs\_err(s, "Path state invalid. state %s\n",+ rtrs\_srv\_state\_str(srv\_path->state));+ return -EIO;+ }++ if (!srv\_path->s.con[cid]) {+ rtrs\_err(s, "Conn not set for %d\n", cid);+ return -EIO;+ }  err = post\_recv\_io(to\_srv\_con(srv\_path->s.con[cid]), q\_size); if (err) { |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 20:18:39 +0000



=== Content from git.kernel.org_10b270bb_20250114_202010.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=d0e62bf7b575fbfe591f6f570e7595dd60a2f5eb)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=d0e62bf7b575fbfe591f6f570e7595dd60a2f5eb)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=d0e62bf7b575fbfe591f6f570e7595dd60a2f5eb)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=d0e62bf7b575fbfe591f6f570e7595dd60a2f5eb)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Md Haris Iqbal <haris.iqbal@ionos.com> | 2024-08-21 13:22:14 +0200 |
| --- | --- | --- |
| committer | Leon Romanovsky <leon@kernel.org> | 2024-08-28 15:24:35 +0300 |
| commit | [d0e62bf7b575fbfe591f6f570e7595dd60a2f5eb](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=d0e62bf7b575fbfe591f6f570e7595dd60a2f5eb) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=d0e62bf7b575fbfe591f6f570e7595dd60a2f5eb)) | |
| tree | [e47d09c7708ca248ad76248c8dfb9755ca76ecf7](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=d0e62bf7b575fbfe591f6f570e7595dd60a2f5eb) | |
| parent | [ff7395890580447507b27851c06e396f75913443](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=ff7395890580447507b27851c06e396f75913443) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=d0e62bf7b575fbfe591f6f570e7595dd60a2f5eb&id2=ff7395890580447507b27851c06e396f75913443)) | |
| download | [linux-d0e62bf7b575fbfe591f6f570e7595dd60a2f5eb.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-d0e62bf7b575fbfe591f6f570e7595dd60a2f5eb.tar.gz) | |

RDMA/rtrs-srv: Avoid null pointer deref during path establishmentFor RTRS path establishment, RTRS client initiates and completes con\_num
of connections. After establishing all its connections, the information
is exchanged between the client and server through the info\_req message.
During this exchange, it is essential that all connections have been
established, and the state of the RTRS srv path is CONNECTED.
So add these sanity checks, to make sure we detect and abort process in
error scenarios to avoid null pointer deref.
Signed-off-by: Md Haris Iqbal <haris.iqbal@ionos.com>
Signed-off-by: Jack Wang <jinpu.wang@ionos.com>
Signed-off-by: Grzegorz Prajsner <grzegorz.prajsner@ionos.com>
Link: [https://patch.msgid.link/20240821112217.41827-9-haris.iqbal@ionos.com](https://patch.msgid.link/20240821112217.41827-9-haris.iqbal%40ionos.com)
Signed-off-by: Leon Romanovsky <leon@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=d0e62bf7b575fbfe591f6f570e7595dd60a2f5eb)

| -rw-r--r-- | [drivers/infiniband/ulp/rtrs/rtrs-srv.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/infiniband/ulp/rtrs/rtrs-srv.c?id=d0e62bf7b575fbfe591f6f570e7595dd60a2f5eb) | 13 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 11 insertions, 2 deletions

| diff --git a/drivers/infiniband/ulp/rtrs/rtrs-srv.c b/drivers/infiniband/ulp/rtrs/rtrs-srv.cindex ffd3e80596d0ed..05d15ff074bbad 100644--- a/[drivers/infiniband/ulp/rtrs/rtrs-srv.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/infiniband/ulp/rtrs/rtrs-srv.c?id=ff7395890580447507b27851c06e396f75913443)+++ b/[drivers/infiniband/ulp/rtrs/rtrs-srv.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/infiniband/ulp/rtrs/rtrs-srv.c?id=d0e62bf7b575fbfe591f6f570e7595dd60a2f5eb)@@ -935,12 +935,11 @@ static void rtrs\_srv\_info\_req\_done(struct ib\_cq \*cq, struct ib\_wc \*wc) if (err) goto close; -out: rtrs\_iu\_free(iu, srv\_path->s.dev->ib\_dev, 1); return; close:+ rtrs\_iu\_free(iu, srv\_path->s.dev->ib\_dev, 1); close\_path(srv\_path);- goto out; }  static int post\_recv\_info\_req(struct rtrs\_srv\_con \*con)@@ -991,6 +990,16 @@ static int post\_recv\_path(struct rtrs\_srv\_path \*srv\_path) q\_size = SERVICE\_CON\_QUEUE\_DEPTH; else q\_size = srv->queue\_depth;+ if (srv\_path->state != RTRS\_SRV\_CONNECTING) {+ rtrs\_err(s, "Path state invalid. state %s\n",+ rtrs\_srv\_state\_str(srv\_path->state));+ return -EIO;+ }++ if (!srv\_path->s.con[cid]) {+ rtrs\_err(s, "Conn not set for %d\n", cid);+ return -EIO;+ }  err = post\_recv\_io(to\_srv\_con(srv\_path->s.con[cid]), q\_size); if (err) { |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 20:18:47 +0000


