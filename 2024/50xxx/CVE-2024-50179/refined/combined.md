=== Content from git.kernel.org_32336e2d_20250114_220826.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=c08dfb1b49492c09cf13838c71897493ea3b424e)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=c08dfb1b49492c09cf13838c71897493ea3b424e)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=c08dfb1b49492c09cf13838c71897493ea3b424e)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=c08dfb1b49492c09cf13838c71897493ea3b424e)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Xiubo Li <xiubli@redhat.com> | 2024-09-05 06:22:18 +0800 |
| --- | --- | --- |
| committer | Ilya Dryomov <idryomov@gmail.com> | 2024-09-24 22:51:33 +0200 |
| commit | [c08dfb1b49492c09cf13838c71897493ea3b424e](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=c08dfb1b49492c09cf13838c71897493ea3b424e) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=c08dfb1b49492c09cf13838c71897493ea3b424e)) | |
| tree | [33712eafbf03ad06a1adeb871e21a2c6b4e7d726](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=c08dfb1b49492c09cf13838c71897493ea3b424e) | |
| parent | [74249188f31827cf1eeeee8e06474c2fbe2fc1d2](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=74249188f31827cf1eeeee8e06474c2fbe2fc1d2) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=c08dfb1b49492c09cf13838c71897493ea3b424e&id2=74249188f31827cf1eeeee8e06474c2fbe2fc1d2)) | |
| download | [linux-c08dfb1b49492c09cf13838c71897493ea3b424e.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-c08dfb1b49492c09cf13838c71897493ea3b424e.tar.gz) | |

ceph: remove the incorrect Fw reference check when dirtying pagesWhen doing the direct-io reads it will also try to mark pages dirty,
but for the read path it won't hold the Fw caps and there is case
will it get the Fw reference.
Fixes: 5dda377cf0a6 ("ceph: set i\_head\_snapc when getting CEPH\_CAP\_FILE\_WR reference")
Signed-off-by: Xiubo Li <xiubli@redhat.com>
Reviewed-by: Patrick Donnelly <pdonnell@redhat.com>
Signed-off-by: Ilya Dryomov <idryomov@gmail.com>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=c08dfb1b49492c09cf13838c71897493ea3b424e)

| -rw-r--r-- | [fs/ceph/addr.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/fs/ceph/addr.c?id=c08dfb1b49492c09cf13838c71897493ea3b424e) | 1 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 0 insertions, 1 deletions

| diff --git a/fs/ceph/addr.c b/fs/ceph/addr.cindex c4744a02db753c..0df4623785ddb8 100644--- a/[fs/ceph/addr.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/ceph/addr.c?id=74249188f31827cf1eeeee8e06474c2fbe2fc1d2)+++ b/[fs/ceph/addr.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/ceph/addr.c?id=c08dfb1b49492c09cf13838c71897493ea3b424e)@@ -95,7 +95,6 @@ static bool ceph\_dirty\_folio(struct address\_space \*mapping, struct folio \*folio)  /\* dirty the head \*/ spin\_lock(&ci->i\_ceph\_lock);- BUG\_ON(ci->i\_wr\_ref == 0); // caller should hold Fw reference if (\_\_ceph\_have\_pending\_cap\_snap(ci)) { struct ceph\_cap\_snap \*capsnap = list\_last\_entry(&ci->i\_cap\_snaps, |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 22:07:03 +0000



=== Content from git.kernel.org_f95de955_20250114_220829.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=ea98284fc4fb05f276737d2043b02b62be5a8dfb)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=ea98284fc4fb05f276737d2043b02b62be5a8dfb)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=ea98284fc4fb05f276737d2043b02b62be5a8dfb)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=ea98284fc4fb05f276737d2043b02b62be5a8dfb)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Xiubo Li <xiubli@redhat.com> | 2024-09-05 06:22:18 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-10-17 15:21:30 +0200 |
| commit | [ea98284fc4fb05f276737d2043b02b62be5a8dfb](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=ea98284fc4fb05f276737d2043b02b62be5a8dfb) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=ea98284fc4fb05f276737d2043b02b62be5a8dfb)) | |
| tree | [aa245a5512c888b6e7fda5023372b3d43cebeb13](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=ea98284fc4fb05f276737d2043b02b62be5a8dfb) | |
| parent | [90320cfc07b7d6e7a58fd8168f6380ec52ff0251](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=90320cfc07b7d6e7a58fd8168f6380ec52ff0251) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=ea98284fc4fb05f276737d2043b02b62be5a8dfb&id2=90320cfc07b7d6e7a58fd8168f6380ec52ff0251)) | |
| download | [linux-ea98284fc4fb05f276737d2043b02b62be5a8dfb.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-ea98284fc4fb05f276737d2043b02b62be5a8dfb.tar.gz) | |

ceph: remove the incorrect Fw reference check when dirtying pages[ Upstream commit c08dfb1b49492c09cf13838c71897493ea3b424e ]
When doing the direct-io reads it will also try to mark pages dirty,
but for the read path it won't hold the Fw caps and there is case
will it get the Fw reference.
Fixes: 5dda377cf0a6 ("ceph: set i\_head\_snapc when getting CEPH\_CAP\_FILE\_WR reference")
Signed-off-by: Xiubo Li <xiubli@redhat.com>
Reviewed-by: Patrick Donnelly <pdonnell@redhat.com>
Signed-off-by: Ilya Dryomov <idryomov@gmail.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=ea98284fc4fb05f276737d2043b02b62be5a8dfb)

| -rw-r--r-- | [fs/ceph/addr.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/fs/ceph/addr.c?id=ea98284fc4fb05f276737d2043b02b62be5a8dfb) | 1 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 0 insertions, 1 deletions

| diff --git a/fs/ceph/addr.c b/fs/ceph/addr.cindex dd2ce7fabbaee1..6c325efa1c4e59 100644--- a/[fs/ceph/addr.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/ceph/addr.c?id=90320cfc07b7d6e7a58fd8168f6380ec52ff0251)+++ b/[fs/ceph/addr.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/ceph/addr.c?id=ea98284fc4fb05f276737d2043b02b62be5a8dfb)@@ -94,7 +94,6 @@ static bool ceph\_dirty\_folio(struct address\_space \*mapping, struct folio \*folio)  /\* dirty the head \*/ spin\_lock(&ci->i\_ceph\_lock);- BUG\_ON(ci->i\_wr\_ref == 0); // caller should hold Fw reference if (\_\_ceph\_have\_pending\_cap\_snap(ci)) { struct ceph\_cap\_snap \*capsnap = list\_last\_entry(&ci->i\_cap\_snaps, |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 22:07:06 +0000



=== Content from git.kernel.org_2326c2a0_20250114_220828.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=c26c5ec832dd9e9dcd0a0a892a485c99889b68f0)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=c26c5ec832dd9e9dcd0a0a892a485c99889b68f0)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=c26c5ec832dd9e9dcd0a0a892a485c99889b68f0)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=c26c5ec832dd9e9dcd0a0a892a485c99889b68f0)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Xiubo Li <xiubli@redhat.com> | 2024-09-05 06:22:18 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-11-08 16:19:10 +0100 |
| commit | [c26c5ec832dd9e9dcd0a0a892a485c99889b68f0](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=c26c5ec832dd9e9dcd0a0a892a485c99889b68f0) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=c26c5ec832dd9e9dcd0a0a892a485c99889b68f0)) | |
| tree | [d4736ebd9cb12e86276fce201e3a9fe9d61ddd31](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=c26c5ec832dd9e9dcd0a0a892a485c99889b68f0) | |
| parent | [4e1e03760ee7cc4779b6306867fe0fc02921b963](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=4e1e03760ee7cc4779b6306867fe0fc02921b963) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=c26c5ec832dd9e9dcd0a0a892a485c99889b68f0&id2=4e1e03760ee7cc4779b6306867fe0fc02921b963)) | |
| download | [linux-c26c5ec832dd9e9dcd0a0a892a485c99889b68f0.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-c26c5ec832dd9e9dcd0a0a892a485c99889b68f0.tar.gz) | |

ceph: remove the incorrect Fw reference check when dirtying pages[ Upstream commit c08dfb1b49492c09cf13838c71897493ea3b424e ]
When doing the direct-io reads it will also try to mark pages dirty,
but for the read path it won't hold the Fw caps and there is case
will it get the Fw reference.
Fixes: 5dda377cf0a6 ("ceph: set i\_head\_snapc when getting CEPH\_CAP\_FILE\_WR reference")
Signed-off-by: Xiubo Li <xiubli@redhat.com>
Reviewed-by: Patrick Donnelly <pdonnell@redhat.com>
Signed-off-by: Ilya Dryomov <idryomov@gmail.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=c26c5ec832dd9e9dcd0a0a892a485c99889b68f0)

| -rw-r--r-- | [fs/ceph/addr.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/fs/ceph/addr.c?id=c26c5ec832dd9e9dcd0a0a892a485c99889b68f0) | 1 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 0 insertions, 1 deletions

| diff --git a/fs/ceph/addr.c b/fs/ceph/addr.cindex de10899da837c5..98b17992524b00 100644--- a/[fs/ceph/addr.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/ceph/addr.c?id=4e1e03760ee7cc4779b6306867fe0fc02921b963)+++ b/[fs/ceph/addr.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/ceph/addr.c?id=c26c5ec832dd9e9dcd0a0a892a485c99889b68f0)@@ -88,7 +88,6 @@ static int ceph\_set\_page\_dirty(struct page \*page)  /\* dirty the head \*/ spin\_lock(&ci->i\_ceph\_lock);- BUG\_ON(ci->i\_wr\_ref == 0); // caller should hold Fw reference if (\_\_ceph\_have\_pending\_cap\_snap(ci)) { struct ceph\_cap\_snap \*capsnap = list\_last\_entry(&ci->i\_cap\_snaps, |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 22:07:04 +0000



=== Content from git.kernel.org_37f7e014_20250114_220832.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=f863bfd0a2c6c99011c62ea71ac04f8e78707da9)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=f863bfd0a2c6c99011c62ea71ac04f8e78707da9)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=f863bfd0a2c6c99011c62ea71ac04f8e78707da9)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=f863bfd0a2c6c99011c62ea71ac04f8e78707da9)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Xiubo Li <xiubli@redhat.com> | 2024-09-05 06:22:18 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-10-17 15:11:19 +0200 |
| commit | [f863bfd0a2c6c99011c62ea71ac04f8e78707da9](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=f863bfd0a2c6c99011c62ea71ac04f8e78707da9) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=f863bfd0a2c6c99011c62ea71ac04f8e78707da9)) | |
| tree | [1e02cb2600b0070b52e533100d4c0070da7db4b1](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=f863bfd0a2c6c99011c62ea71ac04f8e78707da9) | |
| parent | [df293ea78740a41384d648041f38f645700288e1](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=df293ea78740a41384d648041f38f645700288e1) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=f863bfd0a2c6c99011c62ea71ac04f8e78707da9&id2=df293ea78740a41384d648041f38f645700288e1)) | |
| download | [linux-f863bfd0a2c6c99011c62ea71ac04f8e78707da9.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-f863bfd0a2c6c99011c62ea71ac04f8e78707da9.tar.gz) | |

ceph: remove the incorrect Fw reference check when dirtying pages[ Upstream commit c08dfb1b49492c09cf13838c71897493ea3b424e ]
When doing the direct-io reads it will also try to mark pages dirty,
but for the read path it won't hold the Fw caps and there is case
will it get the Fw reference.
Fixes: 5dda377cf0a6 ("ceph: set i\_head\_snapc when getting CEPH\_CAP\_FILE\_WR reference")
Signed-off-by: Xiubo Li <xiubli@redhat.com>
Reviewed-by: Patrick Donnelly <pdonnell@redhat.com>
Signed-off-by: Ilya Dryomov <idryomov@gmail.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=f863bfd0a2c6c99011c62ea71ac04f8e78707da9)

| -rw-r--r-- | [fs/ceph/addr.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/fs/ceph/addr.c?id=f863bfd0a2c6c99011c62ea71ac04f8e78707da9) | 1 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 0 insertions, 1 deletions

| diff --git a/fs/ceph/addr.c b/fs/ceph/addr.cindex b218a26291b8e0..e1096ca1a39b18 100644--- a/[fs/ceph/addr.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/ceph/addr.c?id=df293ea78740a41384d648041f38f645700288e1)+++ b/[fs/ceph/addr.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/ceph/addr.c?id=f863bfd0a2c6c99011c62ea71ac04f8e78707da9)@@ -95,7 +95,6 @@ static int ceph\_set\_page\_dirty(struct page \*page)  /\* dirty the head \*/ spin\_lock(&ci->i\_ceph\_lock);- BUG\_ON(ci->i\_wr\_ref == 0); // caller should hold Fw reference if (\_\_ceph\_have\_pending\_cap\_snap(ci)) { struct ceph\_cap\_snap \*capsnap = list\_last\_entry(&ci->i\_cap\_snaps, |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 22:07:09 +0000



=== Content from git.kernel.org_9be4ba6d_20250114_220825.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=9d4f619153bab7fa59736462967821d6521a38cb)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=9d4f619153bab7fa59736462967821d6521a38cb)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=9d4f619153bab7fa59736462967821d6521a38cb)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=9d4f619153bab7fa59736462967821d6521a38cb)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Xiubo Li <xiubli@redhat.com> | 2024-09-05 06:22:18 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-10-10 12:00:04 +0200 |
| commit | [9d4f619153bab7fa59736462967821d6521a38cb](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=9d4f619153bab7fa59736462967821d6521a38cb) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=9d4f619153bab7fa59736462967821d6521a38cb)) | |
| tree | [c631b335871e775bba99c642a9e351cd2bccca51](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=9d4f619153bab7fa59736462967821d6521a38cb) | |
| parent | [63104c3f527f51190b1839735bfc6d8f43f56cfa](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=63104c3f527f51190b1839735bfc6d8f43f56cfa) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=9d4f619153bab7fa59736462967821d6521a38cb&id2=63104c3f527f51190b1839735bfc6d8f43f56cfa)) | |
| download | [linux-9d4f619153bab7fa59736462967821d6521a38cb.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-9d4f619153bab7fa59736462967821d6521a38cb.tar.gz) | |

ceph: remove the incorrect Fw reference check when dirtying pages[ Upstream commit c08dfb1b49492c09cf13838c71897493ea3b424e ]
When doing the direct-io reads it will also try to mark pages dirty,
but for the read path it won't hold the Fw caps and there is case
will it get the Fw reference.
Fixes: 5dda377cf0a6 ("ceph: set i\_head\_snapc when getting CEPH\_CAP\_FILE\_WR reference")
Signed-off-by: Xiubo Li <xiubli@redhat.com>
Reviewed-by: Patrick Donnelly <pdonnell@redhat.com>
Signed-off-by: Ilya Dryomov <idryomov@gmail.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=9d4f619153bab7fa59736462967821d6521a38cb)

| -rw-r--r-- | [fs/ceph/addr.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/fs/ceph/addr.c?id=9d4f619153bab7fa59736462967821d6521a38cb) | 1 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 0 insertions, 1 deletions

| diff --git a/fs/ceph/addr.c b/fs/ceph/addr.cindex 73b5a07bf94dee..6551dac5d6191c 100644--- a/[fs/ceph/addr.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/ceph/addr.c?id=63104c3f527f51190b1839735bfc6d8f43f56cfa)+++ b/[fs/ceph/addr.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/ceph/addr.c?id=9d4f619153bab7fa59736462967821d6521a38cb)@@ -95,7 +95,6 @@ static bool ceph\_dirty\_folio(struct address\_space \*mapping, struct folio \*folio)  /\* dirty the head \*/ spin\_lock(&ci->i\_ceph\_lock);- BUG\_ON(ci->i\_wr\_ref == 0); // caller should hold Fw reference if (\_\_ceph\_have\_pending\_cap\_snap(ci)) { struct ceph\_cap\_snap \*capsnap = list\_last\_entry(&ci->i\_cap\_snaps, |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 22:07:02 +0000



=== Content from git.kernel.org_d8a996d2_20250114_220822.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=11ab19d48ab877430eed0c7d83810970bbcbc4f6)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=11ab19d48ab877430eed0c7d83810970bbcbc4f6)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=11ab19d48ab877430eed0c7d83810970bbcbc4f6)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=11ab19d48ab877430eed0c7d83810970bbcbc4f6)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Xiubo Li <xiubli@redhat.com> | 2024-09-05 06:22:18 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-10-10 11:57:14 +0200 |
| commit | [11ab19d48ab877430eed0c7d83810970bbcbc4f6](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=11ab19d48ab877430eed0c7d83810970bbcbc4f6) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=11ab19d48ab877430eed0c7d83810970bbcbc4f6)) | |
| tree | [2a28d5e49857cb08fd4795eaa717253aeb034b55](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=11ab19d48ab877430eed0c7d83810970bbcbc4f6) | |
| parent | [10a58555e0bb5cc4673c8bb73b8afc5fa651f0ac](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=10a58555e0bb5cc4673c8bb73b8afc5fa651f0ac) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=11ab19d48ab877430eed0c7d83810970bbcbc4f6&id2=10a58555e0bb5cc4673c8bb73b8afc5fa651f0ac)) | |
| download | [linux-11ab19d48ab877430eed0c7d83810970bbcbc4f6.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-11ab19d48ab877430eed0c7d83810970bbcbc4f6.tar.gz) | |

ceph: remove the incorrect Fw reference check when dirtying pages[ Upstream commit c08dfb1b49492c09cf13838c71897493ea3b424e ]
When doing the direct-io reads it will also try to mark pages dirty,
but for the read path it won't hold the Fw caps and there is case
will it get the Fw reference.
Fixes: 5dda377cf0a6 ("ceph: set i\_head\_snapc when getting CEPH\_CAP\_FILE\_WR reference")
Signed-off-by: Xiubo Li <xiubli@redhat.com>
Reviewed-by: Patrick Donnelly <pdonnell@redhat.com>
Signed-off-by: Ilya Dryomov <idryomov@gmail.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=11ab19d48ab877430eed0c7d83810970bbcbc4f6)

| -rw-r--r-- | [fs/ceph/addr.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/fs/ceph/addr.c?id=11ab19d48ab877430eed0c7d83810970bbcbc4f6) | 1 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 0 insertions, 1 deletions

| diff --git a/fs/ceph/addr.c b/fs/ceph/addr.cindex da64bb7325dbc0..7549e2b07b6af9 100644--- a/[fs/ceph/addr.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/ceph/addr.c?id=10a58555e0bb5cc4673c8bb73b8afc5fa651f0ac)+++ b/[fs/ceph/addr.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/ceph/addr.c?id=11ab19d48ab877430eed0c7d83810970bbcbc4f6)@@ -95,7 +95,6 @@ static bool ceph\_dirty\_folio(struct address\_space \*mapping, struct folio \*folio)  /\* dirty the head \*/ spin\_lock(&ci->i\_ceph\_lock);- BUG\_ON(ci->i\_wr\_ref == 0); // caller should hold Fw reference if (\_\_ceph\_have\_pending\_cap\_snap(ci)) { struct ceph\_cap\_snap \*capsnap = list\_last\_entry(&ci->i\_cap\_snaps, |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 22:06:59 +0000



=== Content from git.kernel.org_e3f217b2_20250114_220823.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=126b567a2ef65fc38a71d832bf1216c56816f231)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=126b567a2ef65fc38a71d832bf1216c56816f231)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=126b567a2ef65fc38a71d832bf1216c56816f231)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=126b567a2ef65fc38a71d832bf1216c56816f231)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Xiubo Li <xiubli@redhat.com> | 2024-09-05 06:22:18 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-11-08 16:20:35 +0100 |
| commit | [126b567a2ef65fc38a71d832bf1216c56816f231](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=126b567a2ef65fc38a71d832bf1216c56816f231) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=126b567a2ef65fc38a71d832bf1216c56816f231)) | |
| tree | [69a45ff47282c8d3dd67a25be5ffa1e2c80314c3](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=126b567a2ef65fc38a71d832bf1216c56816f231) | |
| parent | [b0de20de29b13950493a36bd4cf531200eb0e807](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=b0de20de29b13950493a36bd4cf531200eb0e807) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=126b567a2ef65fc38a71d832bf1216c56816f231&id2=b0de20de29b13950493a36bd4cf531200eb0e807)) | |
| download | [linux-126b567a2ef65fc38a71d832bf1216c56816f231.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-126b567a2ef65fc38a71d832bf1216c56816f231.tar.gz) | |

ceph: remove the incorrect Fw reference check when dirtying pages[ Upstream commit c08dfb1b49492c09cf13838c71897493ea3b424e ]
When doing the direct-io reads it will also try to mark pages dirty,
but for the read path it won't hold the Fw caps and there is case
will it get the Fw reference.
Fixes: 5dda377cf0a6 ("ceph: set i\_head\_snapc when getting CEPH\_CAP\_FILE\_WR reference")
Signed-off-by: Xiubo Li <xiubli@redhat.com>
Reviewed-by: Patrick Donnelly <pdonnell@redhat.com>
Signed-off-by: Ilya Dryomov <idryomov@gmail.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=126b567a2ef65fc38a71d832bf1216c56816f231)

| -rw-r--r-- | [fs/ceph/addr.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/fs/ceph/addr.c?id=126b567a2ef65fc38a71d832bf1216c56816f231) | 1 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 0 insertions, 1 deletions

| diff --git a/fs/ceph/addr.c b/fs/ceph/addr.cindex 34ab7b892b7003..07918559636474 100644--- a/[fs/ceph/addr.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/ceph/addr.c?id=b0de20de29b13950493a36bd4cf531200eb0e807)+++ b/[fs/ceph/addr.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/ceph/addr.c?id=126b567a2ef65fc38a71d832bf1216c56816f231)@@ -89,7 +89,6 @@ static int ceph\_set\_page\_dirty(struct page \*page)  /\* dirty the head \*/ spin\_lock(&ci->i\_ceph\_lock);- BUG\_ON(ci->i\_wr\_ref == 0); // caller should hold Fw reference if (\_\_ceph\_have\_pending\_cap\_snap(ci)) { struct ceph\_cap\_snap \*capsnap = list\_last\_entry(&ci->i\_cap\_snaps, |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 22:07:00 +0000



=== Content from git.kernel.org_1d39801c_20250114_220824.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=74b302ebad5b43ac17460fa58092d892a3cba6eb)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=74b302ebad5b43ac17460fa58092d892a3cba6eb)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=74b302ebad5b43ac17460fa58092d892a3cba6eb)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=74b302ebad5b43ac17460fa58092d892a3cba6eb)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Xiubo Li <xiubli@redhat.com> | 2024-09-05 06:22:18 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-10-10 12:02:56 +0200 |
| commit | [74b302ebad5b43ac17460fa58092d892a3cba6eb](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=74b302ebad5b43ac17460fa58092d892a3cba6eb) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=74b302ebad5b43ac17460fa58092d892a3cba6eb)) | |
| tree | [acc99f060cf6f9b5b60f77aad05ca56226f40fbf](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=74b302ebad5b43ac17460fa58092d892a3cba6eb) | |
| parent | [1bb86b02bcd63a2c929122d9ce761457a5d267da](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=1bb86b02bcd63a2c929122d9ce761457a5d267da) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=74b302ebad5b43ac17460fa58092d892a3cba6eb&id2=1bb86b02bcd63a2c929122d9ce761457a5d267da)) | |
| download | [linux-74b302ebad5b43ac17460fa58092d892a3cba6eb.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-74b302ebad5b43ac17460fa58092d892a3cba6eb.tar.gz) | |

ceph: remove the incorrect Fw reference check when dirtying pages[ Upstream commit c08dfb1b49492c09cf13838c71897493ea3b424e ]
When doing the direct-io reads it will also try to mark pages dirty,
but for the read path it won't hold the Fw caps and there is case
will it get the Fw reference.
Fixes: 5dda377cf0a6 ("ceph: set i\_head\_snapc when getting CEPH\_CAP\_FILE\_WR reference")
Signed-off-by: Xiubo Li <xiubli@redhat.com>
Reviewed-by: Patrick Donnelly <pdonnell@redhat.com>
Signed-off-by: Ilya Dryomov <idryomov@gmail.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=74b302ebad5b43ac17460fa58092d892a3cba6eb)

| -rw-r--r-- | [fs/ceph/addr.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/fs/ceph/addr.c?id=74b302ebad5b43ac17460fa58092d892a3cba6eb) | 1 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 0 insertions, 1 deletions

| diff --git a/fs/ceph/addr.c b/fs/ceph/addr.cindex c4744a02db753c..0df4623785ddb8 100644--- a/[fs/ceph/addr.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/ceph/addr.c?id=1bb86b02bcd63a2c929122d9ce761457a5d267da)+++ b/[fs/ceph/addr.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/ceph/addr.c?id=74b302ebad5b43ac17460fa58092d892a3cba6eb)@@ -95,7 +95,6 @@ static bool ceph\_dirty\_folio(struct address\_space \*mapping, struct folio \*folio)  /\* dirty the head \*/ spin\_lock(&ci->i\_ceph\_lock);- BUG\_ON(ci->i\_wr\_ref == 0); // caller should hold Fw reference if (\_\_ceph\_have\_pending\_cap\_snap(ci)) { struct ceph\_cap\_snap \*capsnap = list\_last\_entry(&ci->i\_cap\_snaps, |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 22:07:01 +0000



=== Content from git.kernel.org_cdb0c0d4_20250114_220830.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=f55e003d261baa7c57d51ae5c8ec1f5c26a35c89)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=f55e003d261baa7c57d51ae5c8ec1f5c26a35c89)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=f55e003d261baa7c57d51ae5c8ec1f5c26a35c89)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=f55e003d261baa7c57d51ae5c8ec1f5c26a35c89)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Xiubo Li <xiubli@redhat.com> | 2024-09-05 06:22:18 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-10-17 15:08:06 +0200 |
| commit | [f55e003d261baa7c57d51ae5c8ec1f5c26a35c89](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=f55e003d261baa7c57d51ae5c8ec1f5c26a35c89) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=f55e003d261baa7c57d51ae5c8ec1f5c26a35c89)) | |
| tree | [32fbb553045b53c4a394bdc88c719f604fd512ca](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=f55e003d261baa7c57d51ae5c8ec1f5c26a35c89) | |
| parent | [32ee78823dea2d54adaf6e05f86622eba359e091](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=32ee78823dea2d54adaf6e05f86622eba359e091) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=f55e003d261baa7c57d51ae5c8ec1f5c26a35c89&id2=32ee78823dea2d54adaf6e05f86622eba359e091)) | |
| download | [linux-f55e003d261baa7c57d51ae5c8ec1f5c26a35c89.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-f55e003d261baa7c57d51ae5c8ec1f5c26a35c89.tar.gz) | |

ceph: remove the incorrect Fw reference check when dirtying pages[ Upstream commit c08dfb1b49492c09cf13838c71897493ea3b424e ]
When doing the direct-io reads it will also try to mark pages dirty,
but for the read path it won't hold the Fw caps and there is case
will it get the Fw reference.
Fixes: 5dda377cf0a6 ("ceph: set i\_head\_snapc when getting CEPH\_CAP\_FILE\_WR reference")
Signed-off-by: Xiubo Li <xiubli@redhat.com>
Reviewed-by: Patrick Donnelly <pdonnell@redhat.com>
Signed-off-by: Ilya Dryomov <idryomov@gmail.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=f55e003d261baa7c57d51ae5c8ec1f5c26a35c89)

| -rw-r--r-- | [fs/ceph/addr.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/fs/ceph/addr.c?id=f55e003d261baa7c57d51ae5c8ec1f5c26a35c89) | 1 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 0 insertions, 1 deletions

| diff --git a/fs/ceph/addr.c b/fs/ceph/addr.cindex 3465ff95cb89f2..2362f2591f4ad6 100644--- a/[fs/ceph/addr.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/ceph/addr.c?id=32ee78823dea2d54adaf6e05f86622eba359e091)+++ b/[fs/ceph/addr.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/ceph/addr.c?id=f55e003d261baa7c57d51ae5c8ec1f5c26a35c89)@@ -91,7 +91,6 @@ static int ceph\_set\_page\_dirty(struct page \*page)  /\* dirty the head \*/ spin\_lock(&ci->i\_ceph\_lock);- BUG\_ON(ci->i\_wr\_ref == 0); // caller should hold Fw reference if (\_\_ceph\_have\_pending\_cap\_snap(ci)) { struct ceph\_cap\_snap \*capsnap = list\_last\_entry(&ci->i\_cap\_snaps, |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 22:07:07 +0000


