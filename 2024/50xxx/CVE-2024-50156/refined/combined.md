=== Content from git.kernel.org_ddfa7a18_20250114_185816.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=293f53263266bc4340d777268ab4328a97f041fa)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=293f53263266bc4340d777268ab4328a97f041fa)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=293f53263266bc4340d777268ab4328a97f041fa)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=293f53263266bc4340d777268ab4328a97f041fa)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Douglas Anderson <dianders@chromium.org> | 2024-10-14 09:36:08 -0700 |
| --- | --- | --- |
| committer | Abhinav Kumar <quic\_abhinavk@quicinc.com> | 2024-10-14 13:16:17 -0700 |
| commit | [293f53263266bc4340d777268ab4328a97f041fa](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=293f53263266bc4340d777268ab4328a97f041fa) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=293f53263266bc4340d777268ab4328a97f041fa)) | |
| tree | [ac745f7c73fe445dca441248707585d537ac1d6b](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=293f53263266bc4340d777268ab4328a97f041fa) | |
| parent | [358b762400bd94db2a14a72dfcef74c7da6bd845](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=358b762400bd94db2a14a72dfcef74c7da6bd845) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=293f53263266bc4340d777268ab4328a97f041fa&id2=358b762400bd94db2a14a72dfcef74c7da6bd845)) | |
| download | [linux-293f53263266bc4340d777268ab4328a97f041fa.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-293f53263266bc4340d777268ab4328a97f041fa.tar.gz) | |

drm/msm: Avoid NULL dereference in msm\_disp\_state\_print\_regs()If the allocation in msm\_disp\_state\_dump\_regs() failed then
`block->state` can be NULL. The msm\_disp\_state\_print\_regs() function
\_does\_ have code to try to handle it with:
if (\*reg)
dump\_addr = \*reg;
...but since "dump\_addr" is initialized to NULL the above is actually
a noop. The code then goes on to dereference `dump\_addr`.
Make the function print "Registers not stored" when it sees a NULL to
solve this. Since we're touching the code, fix
msm\_disp\_state\_print\_regs() not to pointlessly take a double-pointer
and properly mark the pointer as `const`.
Fixes: 98659487b845 ("drm/msm: add support to take dpu snapshot")
Signed-off-by: Douglas Anderson <dianders@chromium.org>
Reviewed-by: Abhinav Kumar <quic\_abhinavk@quicinc.com>
Patchwork: https://patchwork.freedesktop.org/patch/619657/
Link: [https://lore.kernel.org/r/20241014093605.1.Ia1217cecec9ef09eb3c6d125360cc6c8574b0e73@changeid](https://lore.kernel.org/r/20241014093605.1.Ia1217cecec9ef09eb3c6d125360cc6c8574b0e73%40changeid)
Signed-off-by: Abhinav Kumar <quic\_abhinavk@quicinc.com>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=293f53263266bc4340d777268ab4328a97f041fa)

| -rw-r--r-- | [drivers/gpu/drm/msm/disp/msm\_disp\_snapshot\_util.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/gpu/drm/msm/disp/msm_disp_snapshot_util.c?id=293f53263266bc4340d777268ab4328a97f041fa) | 15 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 8 insertions, 7 deletions

| diff --git a/drivers/gpu/drm/msm/disp/msm\_disp\_snapshot\_util.c b/drivers/gpu/drm/msm/disp/msm\_disp\_snapshot\_util.cindex add72bbc28b176..bb149281d31faa 100644--- a/[drivers/gpu/drm/msm/disp/msm\_disp\_snapshot\_util.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/msm/disp/msm_disp_snapshot_util.c?id=358b762400bd94db2a14a72dfcef74c7da6bd845)+++ b/[drivers/gpu/drm/msm/disp/msm\_disp\_snapshot\_util.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/msm/disp/msm_disp_snapshot_util.c?id=293f53263266bc4340d777268ab4328a97f041fa)@@ -48,20 +48,21 @@ static void msm\_disp\_state\_dump\_regs(u32 \*\*reg, u32 aligned\_len, void \_\_iomem \*b } } -static void msm\_disp\_state\_print\_regs(u32 \*\*reg, u32 len, void \_\_iomem \*base\_addr,- struct drm\_printer \*p)+static void msm\_disp\_state\_print\_regs(const u32 \*dump\_addr, u32 len,+ void \_\_iomem \*base\_addr, struct drm\_printer \*p) { int i;- u32 \*dump\_addr = NULL; void \_\_iomem \*addr; u32 num\_rows; + if (!dump\_addr) {+ drm\_printf(p, "Registers not stored\n");+ return;+ }+ addr = base\_addr; num\_rows = len / REG\_DUMP\_ALIGN; - if (\*reg)- dump\_addr = \*reg;- for (i = 0; i < num\_rows; i++) { drm\_printf(p, "0x%lx : %08x %08x %08x %08x\n", (unsigned long)(addr - base\_addr),@@ -89,7 +90,7 @@ void msm\_disp\_state\_print(struct msm\_disp\_state \*state, struct drm\_printer \*p)  list\_for\_each\_entry\_safe(block, tmp, &state->blocks, node) { drm\_printf(p, "====================%s================\n", block->name);- msm\_disp\_state\_print\_regs(&block->state, block->size, block->base\_addr, p);+ msm\_disp\_state\_print\_regs(block->state, block->size, block->base\_addr, p); }  drm\_printf(p, "===================dpu drm state================\n"); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 18:56:53 +0000



=== Content from git.kernel.org_53f6e7f9_20250114_185817.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=563aa81fd66a4e7e6e551a0e02bcc23957cafe2f)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=563aa81fd66a4e7e6e551a0e02bcc23957cafe2f)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=563aa81fd66a4e7e6e551a0e02bcc23957cafe2f)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=563aa81fd66a4e7e6e551a0e02bcc23957cafe2f)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Douglas Anderson <dianders@chromium.org> | 2024-10-14 09:36:08 -0700 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-11-01 02:02:28 +0100 |
| commit | [563aa81fd66a4e7e6e551a0e02bcc23957cafe2f](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=563aa81fd66a4e7e6e551a0e02bcc23957cafe2f) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=563aa81fd66a4e7e6e551a0e02bcc23957cafe2f)) | |
| tree | [bb793cbd3103dc9767acee45c1924c0141643db1](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=563aa81fd66a4e7e6e551a0e02bcc23957cafe2f) | |
| parent | [3db7f4e20e3ef3d4a28091e985827d8018c4934c](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=3db7f4e20e3ef3d4a28091e985827d8018c4934c) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=563aa81fd66a4e7e6e551a0e02bcc23957cafe2f&id2=3db7f4e20e3ef3d4a28091e985827d8018c4934c)) | |
| download | [linux-563aa81fd66a4e7e6e551a0e02bcc23957cafe2f.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-563aa81fd66a4e7e6e551a0e02bcc23957cafe2f.tar.gz) | |

drm/msm: Avoid NULL dereference in msm\_disp\_state\_print\_regs()[ Upstream commit 293f53263266bc4340d777268ab4328a97f041fa ]
If the allocation in msm\_disp\_state\_dump\_regs() failed then
`block->state` can be NULL. The msm\_disp\_state\_print\_regs() function
\_does\_ have code to try to handle it with:
if (\*reg)
dump\_addr = \*reg;
...but since "dump\_addr" is initialized to NULL the above is actually
a noop. The code then goes on to dereference `dump\_addr`.
Make the function print "Registers not stored" when it sees a NULL to
solve this. Since we're touching the code, fix
msm\_disp\_state\_print\_regs() not to pointlessly take a double-pointer
and properly mark the pointer as `const`.
Fixes: 98659487b845 ("drm/msm: add support to take dpu snapshot")
Signed-off-by: Douglas Anderson <dianders@chromium.org>
Reviewed-by: Abhinav Kumar <quic\_abhinavk@quicinc.com>
Patchwork: https://patchwork.freedesktop.org/patch/619657/
Link: [https://lore.kernel.org/r/20241014093605.1.Ia1217cecec9ef09eb3c6d125360cc6c8574b0e73@changeid](https://lore.kernel.org/r/20241014093605.1.Ia1217cecec9ef09eb3c6d125360cc6c8574b0e73%40changeid)
Signed-off-by: Abhinav Kumar <quic\_abhinavk@quicinc.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=563aa81fd66a4e7e6e551a0e02bcc23957cafe2f)

| -rw-r--r-- | [drivers/gpu/drm/msm/disp/msm\_disp\_snapshot\_util.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/gpu/drm/msm/disp/msm_disp_snapshot_util.c?id=563aa81fd66a4e7e6e551a0e02bcc23957cafe2f) | 15 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 8 insertions, 7 deletions

| diff --git a/drivers/gpu/drm/msm/disp/msm\_disp\_snapshot\_util.c b/drivers/gpu/drm/msm/disp/msm\_disp\_snapshot\_util.cindex add72bbc28b176..bb149281d31faa 100644--- a/[drivers/gpu/drm/msm/disp/msm\_disp\_snapshot\_util.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/msm/disp/msm_disp_snapshot_util.c?id=3db7f4e20e3ef3d4a28091e985827d8018c4934c)+++ b/[drivers/gpu/drm/msm/disp/msm\_disp\_snapshot\_util.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/msm/disp/msm_disp_snapshot_util.c?id=563aa81fd66a4e7e6e551a0e02bcc23957cafe2f)@@ -48,20 +48,21 @@ static void msm\_disp\_state\_dump\_regs(u32 \*\*reg, u32 aligned\_len, void \_\_iomem \*b } } -static void msm\_disp\_state\_print\_regs(u32 \*\*reg, u32 len, void \_\_iomem \*base\_addr,- struct drm\_printer \*p)+static void msm\_disp\_state\_print\_regs(const u32 \*dump\_addr, u32 len,+ void \_\_iomem \*base\_addr, struct drm\_printer \*p) { int i;- u32 \*dump\_addr = NULL; void \_\_iomem \*addr; u32 num\_rows; + if (!dump\_addr) {+ drm\_printf(p, "Registers not stored\n");+ return;+ }+ addr = base\_addr; num\_rows = len / REG\_DUMP\_ALIGN; - if (\*reg)- dump\_addr = \*reg;- for (i = 0; i < num\_rows; i++) { drm\_printf(p, "0x%lx : %08x %08x %08x %08x\n", (unsigned long)(addr - base\_addr),@@ -89,7 +90,7 @@ void msm\_disp\_state\_print(struct msm\_disp\_state \*state, struct drm\_printer \*p)  list\_for\_each\_entry\_safe(block, tmp, &state->blocks, node) { drm\_printf(p, "====================%s================\n", block->name);- msm\_disp\_state\_print\_regs(&block->state, block->size, block->base\_addr, p);+ msm\_disp\_state\_print\_regs(block->state, block->size, block->base\_addr, p); }  drm\_printf(p, "===================dpu drm state================\n"); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 18:56:54 +0000



=== Content from git.kernel.org_6d6bfaa3_20250114_185818.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=f7ad916273483748582d97cfa31054ccb19224f3)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=f7ad916273483748582d97cfa31054ccb19224f3)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=f7ad916273483748582d97cfa31054ccb19224f3)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=f7ad916273483748582d97cfa31054ccb19224f3)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Douglas Anderson <dianders@chromium.org> | 2024-10-14 09:36:08 -0700 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-11-01 01:58:21 +0100 |
| commit | [f7ad916273483748582d97cfa31054ccb19224f3](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=f7ad916273483748582d97cfa31054ccb19224f3) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=f7ad916273483748582d97cfa31054ccb19224f3)) | |
| tree | [7b10a417b50717534e5656a8f0ad30c2da4c78d6](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=f7ad916273483748582d97cfa31054ccb19224f3) | |
| parent | [33ece6c4f0c1e1133f54cc53b73fbc27965a585e](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=33ece6c4f0c1e1133f54cc53b73fbc27965a585e) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=f7ad916273483748582d97cfa31054ccb19224f3&id2=33ece6c4f0c1e1133f54cc53b73fbc27965a585e)) | |
| download | [linux-f7ad916273483748582d97cfa31054ccb19224f3.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-f7ad916273483748582d97cfa31054ccb19224f3.tar.gz) | |

drm/msm: Avoid NULL dereference in msm\_disp\_state\_print\_regs()[ Upstream commit 293f53263266bc4340d777268ab4328a97f041fa ]
If the allocation in msm\_disp\_state\_dump\_regs() failed then
`block->state` can be NULL. The msm\_disp\_state\_print\_regs() function
\_does\_ have code to try to handle it with:
if (\*reg)
dump\_addr = \*reg;
...but since "dump\_addr" is initialized to NULL the above is actually
a noop. The code then goes on to dereference `dump\_addr`.
Make the function print "Registers not stored" when it sees a NULL to
solve this. Since we're touching the code, fix
msm\_disp\_state\_print\_regs() not to pointlessly take a double-pointer
and properly mark the pointer as `const`.
Fixes: 98659487b845 ("drm/msm: add support to take dpu snapshot")
Signed-off-by: Douglas Anderson <dianders@chromium.org>
Reviewed-by: Abhinav Kumar <quic\_abhinavk@quicinc.com>
Patchwork: https://patchwork.freedesktop.org/patch/619657/
Link: [https://lore.kernel.org/r/20241014093605.1.Ia1217cecec9ef09eb3c6d125360cc6c8574b0e73@changeid](https://lore.kernel.org/r/20241014093605.1.Ia1217cecec9ef09eb3c6d125360cc6c8574b0e73%40changeid)
Signed-off-by: Abhinav Kumar <quic\_abhinavk@quicinc.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=f7ad916273483748582d97cfa31054ccb19224f3)

| -rw-r--r-- | [drivers/gpu/drm/msm/disp/msm\_disp\_snapshot\_util.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/gpu/drm/msm/disp/msm_disp_snapshot_util.c?id=f7ad916273483748582d97cfa31054ccb19224f3) | 15 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 8 insertions, 7 deletions

| diff --git a/drivers/gpu/drm/msm/disp/msm\_disp\_snapshot\_util.c b/drivers/gpu/drm/msm/disp/msm\_disp\_snapshot\_util.cindex add72bbc28b176..bb149281d31faa 100644--- a/[drivers/gpu/drm/msm/disp/msm\_disp\_snapshot\_util.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/msm/disp/msm_disp_snapshot_util.c?id=33ece6c4f0c1e1133f54cc53b73fbc27965a585e)+++ b/[drivers/gpu/drm/msm/disp/msm\_disp\_snapshot\_util.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/msm/disp/msm_disp_snapshot_util.c?id=f7ad916273483748582d97cfa31054ccb19224f3)@@ -48,20 +48,21 @@ static void msm\_disp\_state\_dump\_regs(u32 \*\*reg, u32 aligned\_len, void \_\_iomem \*b } } -static void msm\_disp\_state\_print\_regs(u32 \*\*reg, u32 len, void \_\_iomem \*base\_addr,- struct drm\_printer \*p)+static void msm\_disp\_state\_print\_regs(const u32 \*dump\_addr, u32 len,+ void \_\_iomem \*base\_addr, struct drm\_printer \*p) { int i;- u32 \*dump\_addr = NULL; void \_\_iomem \*addr; u32 num\_rows; + if (!dump\_addr) {+ drm\_printf(p, "Registers not stored\n");+ return;+ }+ addr = base\_addr; num\_rows = len / REG\_DUMP\_ALIGN; - if (\*reg)- dump\_addr = \*reg;- for (i = 0; i < num\_rows; i++) { drm\_printf(p, "0x%lx : %08x %08x %08x %08x\n", (unsigned long)(addr - base\_addr),@@ -89,7 +90,7 @@ void msm\_disp\_state\_print(struct msm\_disp\_state \*state, struct drm\_printer \*p)  list\_for\_each\_entry\_safe(block, tmp, &state->blocks, node) { drm\_printf(p, "====================%s================\n", block->name);- msm\_disp\_state\_print\_regs(&block->state, block->size, block->base\_addr, p);+ msm\_disp\_state\_print\_regs(block->state, block->size, block->base\_addr, p); }  drm\_printf(p, "===================dpu drm state================\n"); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 18:56:55 +0000



=== Content from git.kernel.org_075317ae_20250114_185817.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=e8e9f2a12a6214080c8ea83220a596f6e1dedc6c)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=e8e9f2a12a6214080c8ea83220a596f6e1dedc6c)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=e8e9f2a12a6214080c8ea83220a596f6e1dedc6c)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e8e9f2a12a6214080c8ea83220a596f6e1dedc6c)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Douglas Anderson <dianders@chromium.org> | 2024-10-14 09:36:08 -0700 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-11-01 01:55:59 +0100 |
| commit | [e8e9f2a12a6214080c8ea83220a596f6e1dedc6c](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=e8e9f2a12a6214080c8ea83220a596f6e1dedc6c) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=e8e9f2a12a6214080c8ea83220a596f6e1dedc6c)) | |
| tree | [de37f728e827c58f61da161b3595aad3b11452be](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=e8e9f2a12a6214080c8ea83220a596f6e1dedc6c) | |
| parent | [4a14351a47a6af66a27f8ce69aad1abeb4a85b83](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=4a14351a47a6af66a27f8ce69aad1abeb4a85b83) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e8e9f2a12a6214080c8ea83220a596f6e1dedc6c&id2=4a14351a47a6af66a27f8ce69aad1abeb4a85b83)) | |
| download | [linux-e8e9f2a12a6214080c8ea83220a596f6e1dedc6c.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-e8e9f2a12a6214080c8ea83220a596f6e1dedc6c.tar.gz) | |

drm/msm: Avoid NULL dereference in msm\_disp\_state\_print\_regs()[ Upstream commit 293f53263266bc4340d777268ab4328a97f041fa ]
If the allocation in msm\_disp\_state\_dump\_regs() failed then
`block->state` can be NULL. The msm\_disp\_state\_print\_regs() function
\_does\_ have code to try to handle it with:
if (\*reg)
dump\_addr = \*reg;
...but since "dump\_addr" is initialized to NULL the above is actually
a noop. The code then goes on to dereference `dump\_addr`.
Make the function print "Registers not stored" when it sees a NULL to
solve this. Since we're touching the code, fix
msm\_disp\_state\_print\_regs() not to pointlessly take a double-pointer
and properly mark the pointer as `const`.
Fixes: 98659487b845 ("drm/msm: add support to take dpu snapshot")
Signed-off-by: Douglas Anderson <dianders@chromium.org>
Reviewed-by: Abhinav Kumar <quic\_abhinavk@quicinc.com>
Patchwork: https://patchwork.freedesktop.org/patch/619657/
Link: [https://lore.kernel.org/r/20241014093605.1.Ia1217cecec9ef09eb3c6d125360cc6c8574b0e73@changeid](https://lore.kernel.org/r/20241014093605.1.Ia1217cecec9ef09eb3c6d125360cc6c8574b0e73%40changeid)
Signed-off-by: Abhinav Kumar <quic\_abhinavk@quicinc.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e8e9f2a12a6214080c8ea83220a596f6e1dedc6c)

| -rw-r--r-- | [drivers/gpu/drm/msm/disp/msm\_disp\_snapshot\_util.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/gpu/drm/msm/disp/msm_disp_snapshot_util.c?id=e8e9f2a12a6214080c8ea83220a596f6e1dedc6c) | 15 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 8 insertions, 7 deletions

| diff --git a/drivers/gpu/drm/msm/disp/msm\_disp\_snapshot\_util.c b/drivers/gpu/drm/msm/disp/msm\_disp\_snapshot\_util.cindex add72bbc28b176..bb149281d31faa 100644--- a/[drivers/gpu/drm/msm/disp/msm\_disp\_snapshot\_util.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/msm/disp/msm_disp_snapshot_util.c?id=4a14351a47a6af66a27f8ce69aad1abeb4a85b83)+++ b/[drivers/gpu/drm/msm/disp/msm\_disp\_snapshot\_util.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/msm/disp/msm_disp_snapshot_util.c?id=e8e9f2a12a6214080c8ea83220a596f6e1dedc6c)@@ -48,20 +48,21 @@ static void msm\_disp\_state\_dump\_regs(u32 \*\*reg, u32 aligned\_len, void \_\_iomem \*b } } -static void msm\_disp\_state\_print\_regs(u32 \*\*reg, u32 len, void \_\_iomem \*base\_addr,- struct drm\_printer \*p)+static void msm\_disp\_state\_print\_regs(const u32 \*dump\_addr, u32 len,+ void \_\_iomem \*base\_addr, struct drm\_printer \*p) { int i;- u32 \*dump\_addr = NULL; void \_\_iomem \*addr; u32 num\_rows; + if (!dump\_addr) {+ drm\_printf(p, "Registers not stored\n");+ return;+ }+ addr = base\_addr; num\_rows = len / REG\_DUMP\_ALIGN; - if (\*reg)- dump\_addr = \*reg;- for (i = 0; i < num\_rows; i++) { drm\_printf(p, "0x%lx : %08x %08x %08x %08x\n", (unsigned long)(addr - base\_addr),@@ -89,7 +90,7 @@ void msm\_disp\_state\_print(struct msm\_disp\_state \*state, struct drm\_printer \*p)  list\_for\_each\_entry\_safe(block, tmp, &state->blocks, node) { drm\_printf(p, "====================%s================\n", block->name);- msm\_disp\_state\_print\_regs(&block->state, block->size, block->base\_addr, p);+ msm\_disp\_state\_print\_regs(block->state, block->size, block->base\_addr, p); }  drm\_printf(p, "===================dpu drm state================\n"); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 18:56:55 +0000



=== Content from git.kernel.org_5167ce0a_20250114_185816.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=42cf045086feae77b212f0f66e742b91a5b566b7)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=42cf045086feae77b212f0f66e742b91a5b566b7)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=42cf045086feae77b212f0f66e742b91a5b566b7)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=42cf045086feae77b212f0f66e742b91a5b566b7)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Douglas Anderson <dianders@chromium.org> | 2024-10-14 09:36:08 -0700 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-11-01 01:52:33 +0100 |
| commit | [42cf045086feae77b212f0f66e742b91a5b566b7](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=42cf045086feae77b212f0f66e742b91a5b566b7) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=42cf045086feae77b212f0f66e742b91a5b566b7)) | |
| tree | [6aae684d3e383055b01042891fbf0db6a77eac04](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=42cf045086feae77b212f0f66e742b91a5b566b7) | |
| parent | [d125fbf1e128dd759e51f2ce8ab0f0d8aa66fe4c](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=d125fbf1e128dd759e51f2ce8ab0f0d8aa66fe4c) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=42cf045086feae77b212f0f66e742b91a5b566b7&id2=d125fbf1e128dd759e51f2ce8ab0f0d8aa66fe4c)) | |
| download | [linux-42cf045086feae77b212f0f66e742b91a5b566b7.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-42cf045086feae77b212f0f66e742b91a5b566b7.tar.gz) | |

drm/msm: Avoid NULL dereference in msm\_disp\_state\_print\_regs()[ Upstream commit 293f53263266bc4340d777268ab4328a97f041fa ]
If the allocation in msm\_disp\_state\_dump\_regs() failed then
`block->state` can be NULL. The msm\_disp\_state\_print\_regs() function
\_does\_ have code to try to handle it with:
if (\*reg)
dump\_addr = \*reg;
...but since "dump\_addr" is initialized to NULL the above is actually
a noop. The code then goes on to dereference `dump\_addr`.
Make the function print "Registers not stored" when it sees a NULL to
solve this. Since we're touching the code, fix
msm\_disp\_state\_print\_regs() not to pointlessly take a double-pointer
and properly mark the pointer as `const`.
Fixes: 98659487b845 ("drm/msm: add support to take dpu snapshot")
Signed-off-by: Douglas Anderson <dianders@chromium.org>
Reviewed-by: Abhinav Kumar <quic\_abhinavk@quicinc.com>
Patchwork: https://patchwork.freedesktop.org/patch/619657/
Link: [https://lore.kernel.org/r/20241014093605.1.Ia1217cecec9ef09eb3c6d125360cc6c8574b0e73@changeid](https://lore.kernel.org/r/20241014093605.1.Ia1217cecec9ef09eb3c6d125360cc6c8574b0e73%40changeid)
Signed-off-by: Abhinav Kumar <quic\_abhinavk@quicinc.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=42cf045086feae77b212f0f66e742b91a5b566b7)

| -rw-r--r-- | [drivers/gpu/drm/msm/disp/msm\_disp\_snapshot\_util.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/gpu/drm/msm/disp/msm_disp_snapshot_util.c?id=42cf045086feae77b212f0f66e742b91a5b566b7) | 15 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 8 insertions, 7 deletions

| diff --git a/drivers/gpu/drm/msm/disp/msm\_disp\_snapshot\_util.c b/drivers/gpu/drm/msm/disp/msm\_disp\_snapshot\_util.cindex 8746ceae8fca90..06f2f5a5e267e5 100644--- a/[drivers/gpu/drm/msm/disp/msm\_disp\_snapshot\_util.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/msm/disp/msm_disp_snapshot_util.c?id=d125fbf1e128dd759e51f2ce8ab0f0d8aa66fe4c)+++ b/[drivers/gpu/drm/msm/disp/msm\_disp\_snapshot\_util.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/msm/disp/msm_disp_snapshot_util.c?id=42cf045086feae77b212f0f66e742b91a5b566b7)@@ -46,20 +46,21 @@ static void msm\_disp\_state\_dump\_regs(u32 \*\*reg, u32 aligned\_len, void \_\_iomem \*b } } -static void msm\_disp\_state\_print\_regs(u32 \*\*reg, u32 len, void \_\_iomem \*base\_addr,- struct drm\_printer \*p)+static void msm\_disp\_state\_print\_regs(const u32 \*dump\_addr, u32 len,+ void \_\_iomem \*base\_addr, struct drm\_printer \*p) { int i;- u32 \*dump\_addr = NULL; void \_\_iomem \*addr; u32 num\_rows; + if (!dump\_addr) {+ drm\_printf(p, "Registers not stored\n");+ return;+ }+ addr = base\_addr; num\_rows = len / REG\_DUMP\_ALIGN; - if (\*reg)- dump\_addr = \*reg;- for (i = 0; i < num\_rows; i++) { drm\_printf(p, "0x%lx : %08x %08x %08x %08x\n", (unsigned long)(addr - base\_addr),@@ -86,7 +87,7 @@ void msm\_disp\_state\_print(struct msm\_disp\_state \*state, struct drm\_printer \*p)  list\_for\_each\_entry\_safe(block, tmp, &state->blocks, node) { drm\_printf(p, "====================%s================\n", block->name);- msm\_disp\_state\_print\_regs(&block->state, block->size, block->base\_addr, p);+ msm\_disp\_state\_print\_regs(block->state, block->size, block->base\_addr, p); }  drm\_printf(p, "===================dpu drm state================\n"); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 18:56:54 +0000


