=== Content from git.kernel.org_0a2bea6f_20250114_192657.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=69cc6fad5df4ce652d969be69acc60e269e5eea1)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=69cc6fad5df4ce652d969be69acc60e269e5eea1)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=69cc6fad5df4ce652d969be69acc60e269e5eea1)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=69cc6fad5df4ce652d969be69acc60e269e5eea1)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Huacai Chen <chenhuacai@loongson.cn> | 2024-10-21 22:11:19 +0800 |
| --- | --- | --- |
| committer | Huacai Chen <chenhuacai@loongson.cn> | 2024-10-21 22:11:19 +0800 |
| commit | [69cc6fad5df4ce652d969be69acc60e269e5eea1](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=69cc6fad5df4ce652d969be69acc60e269e5eea1) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=69cc6fad5df4ce652d969be69acc60e269e5eea1)) | |
| tree | [a63d5d22055b5d7fb5de12d9779ecac2e522a7f6](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=69cc6fad5df4ce652d969be69acc60e269e5eea1) | |
| parent | [b7296f9d5bf99330063d4bbecc43c9b33fed0137](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=b7296f9d5bf99330063d4bbecc43c9b33fed0137) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=69cc6fad5df4ce652d969be69acc60e269e5eea1&id2=b7296f9d5bf99330063d4bbecc43c9b33fed0137)) | |
| download | [linux-69cc6fad5df4ce652d969be69acc60e269e5eea1.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-69cc6fad5df4ce652d969be69acc60e269e5eea1.tar.gz) | |

LoongArch: Enable IRQ if do\_ale() triggered in irq-enabled contextUnaligned access exception can be triggered in irq-enabled context such
as user mode, in this case do\_ale() may call get\_user() which may cause
sleep. Then we will get:
BUG: sleeping function called from invalid context at arch/loongarch/kernel/access-helper.h:7
in\_atomic(): 0, irqs\_disabled(): 1, non\_block: 0, pid: 129, name: modprobe
preempt\_count: 0, expected: 0
RCU nest depth: 0, expected: 0
CPU: 0 UID: 0 PID: 129 Comm: modprobe Tainted: G W 6.12.0-rc1+ #1723
Tainted: [W]=WARN
Stack : 9000000105e0bd48 0000000000000000 9000000003803944 9000000105e08000
9000000105e0bc70 9000000105e0bc78 0000000000000000 0000000000000000
9000000105e0bc78 0000000000000001 9000000185e0ba07 9000000105e0b890
ffffffffffffffff 9000000105e0bc78 73924b81763be05b 9000000100194500
000000000000020c 000000000000000a 0000000000000000 0000000000000003
00000000000023f0 00000000000e1401 00000000072f8000 0000007ffbb0e260
0000000000000000 0000000000000000 9000000005437650 90000000055d5000
0000000000000000 0000000000000003 0000007ffbb0e1f0 0000000000000000
0000005567b00490 0000000000000000 9000000003803964 0000007ffbb0dfec
00000000000000b0 0000000000000007 0000000000000003 0000000000071c1d
...
Call Trace:
[<9000000003803964>] show\_stack+0x64/0x1a0
[<9000000004c57464>] dump\_stack\_lvl+0x74/0xb0
[<9000000003861ab4>] \_\_might\_resched+0x154/0x1a0
[<900000000380c96c>] emulate\_load\_store\_insn+0x6c/0xf60
[<9000000004c58118>] do\_ale+0x78/0x180
[<9000000003801bc8>] handle\_ale+0x128/0x1e0
So enable IRQ if unaligned access exception is triggered in irq-enabled
context to fix it.
Cc: stable@vger.kernel.org
Reported-by: Binbin Zhou <zhoubinbin@loongson.cn>
Signed-off-by: Huacai Chen <chenhuacai@loongson.cn>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=69cc6fad5df4ce652d969be69acc60e269e5eea1)

| -rw-r--r-- | [arch/loongarch/kernel/traps.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/arch/loongarch/kernel/traps.c?id=69cc6fad5df4ce652d969be69acc60e269e5eea1) | 5 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 5 insertions, 0 deletions

| diff --git a/arch/loongarch/kernel/traps.c b/arch/loongarch/kernel/traps.cindex f9f4eb00c92ef5..c57b4134f3e84b 100644--- a/[arch/loongarch/kernel/traps.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/loongarch/kernel/traps.c?id=b7296f9d5bf99330063d4bbecc43c9b33fed0137)+++ b/[arch/loongarch/kernel/traps.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/loongarch/kernel/traps.c?id=69cc6fad5df4ce652d969be69acc60e269e5eea1)@@ -555,6 +555,9 @@ asmlinkage void noinstr do\_ale(struct pt\_regs \*regs) #else unsigned int \*pc; + if (regs->csr\_prmd & CSR\_PRMD\_PIE)+ local\_irq\_enable();+ perf\_sw\_event(PERF\_COUNT\_SW\_ALIGNMENT\_FAULTS, 1, regs, regs->csr\_badvaddr);  /\*@@ -579,6 +582,8 @@ sigbus: die\_if\_kernel("Kernel ale access", regs); force\_sig\_fault(SIGBUS, BUS\_ADRALN, (void \_\_user \*)regs->csr\_badvaddr); out:+ if (regs->csr\_prmd & CSR\_PRMD\_PIE)+ local\_irq\_disable(); #endif irqentry\_exit(regs, state); } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 19:25:34 +0000



=== Content from git.kernel.org_eb2da49f_20250114_192658.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=8915ed160dbd32b5ef5864df9a9fc11db83a77bb)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=8915ed160dbd32b5ef5864df9a9fc11db83a77bb)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=8915ed160dbd32b5ef5864df9a9fc11db83a77bb)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=8915ed160dbd32b5ef5864df9a9fc11db83a77bb)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Huacai Chen <chenhuacai@loongson.cn> | 2024-10-21 22:11:19 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-11-01 01:58:33 +0100 |
| commit | [8915ed160dbd32b5ef5864df9a9fc11db83a77bb](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=8915ed160dbd32b5ef5864df9a9fc11db83a77bb) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=8915ed160dbd32b5ef5864df9a9fc11db83a77bb)) | |
| tree | [455f0f31138a3141017c9383069ceacad5d19caf](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=8915ed160dbd32b5ef5864df9a9fc11db83a77bb) | |
| parent | [cd2cef7311707a788eeb60cb73cd4b8bd7d767ed](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=cd2cef7311707a788eeb60cb73cd4b8bd7d767ed) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=8915ed160dbd32b5ef5864df9a9fc11db83a77bb&id2=cd2cef7311707a788eeb60cb73cd4b8bd7d767ed)) | |
| download | [linux-8915ed160dbd32b5ef5864df9a9fc11db83a77bb.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-8915ed160dbd32b5ef5864df9a9fc11db83a77bb.tar.gz) | |

LoongArch: Enable IRQ if do\_ale() triggered in irq-enabled contextcommit 69cc6fad5df4ce652d969be69acc60e269e5eea1 upstream.
Unaligned access exception can be triggered in irq-enabled context such
as user mode, in this case do\_ale() may call get\_user() which may cause
sleep. Then we will get:
BUG: sleeping function called from invalid context at arch/loongarch/kernel/access-helper.h:7
in\_atomic(): 0, irqs\_disabled(): 1, non\_block: 0, pid: 129, name: modprobe
preempt\_count: 0, expected: 0
RCU nest depth: 0, expected: 0
CPU: 0 UID: 0 PID: 129 Comm: modprobe Tainted: G W 6.12.0-rc1+ #1723
Tainted: [W]=WARN
Stack : 9000000105e0bd48 0000000000000000 9000000003803944 9000000105e08000
9000000105e0bc70 9000000105e0bc78 0000000000000000 0000000000000000
9000000105e0bc78 0000000000000001 9000000185e0ba07 9000000105e0b890
ffffffffffffffff 9000000105e0bc78 73924b81763be05b 9000000100194500
000000000000020c 000000000000000a 0000000000000000 0000000000000003
00000000000023f0 00000000000e1401 00000000072f8000 0000007ffbb0e260
0000000000000000 0000000000000000 9000000005437650 90000000055d5000
0000000000000000 0000000000000003 0000007ffbb0e1f0 0000000000000000
0000005567b00490 0000000000000000 9000000003803964 0000007ffbb0dfec
00000000000000b0 0000000000000007 0000000000000003 0000000000071c1d
...
Call Trace:
[<9000000003803964>] show\_stack+0x64/0x1a0
[<9000000004c57464>] dump\_stack\_lvl+0x74/0xb0
[<9000000003861ab4>] \_\_might\_resched+0x154/0x1a0
[<900000000380c96c>] emulate\_load\_store\_insn+0x6c/0xf60
[<9000000004c58118>] do\_ale+0x78/0x180
[<9000000003801bc8>] handle\_ale+0x128/0x1e0
So enable IRQ if unaligned access exception is triggered in irq-enabled
context to fix it.
Cc: stable@vger.kernel.org
Reported-by: Binbin Zhou <zhoubinbin@loongson.cn>
Signed-off-by: Huacai Chen <chenhuacai@loongson.cn>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=8915ed160dbd32b5ef5864df9a9fc11db83a77bb)

| -rw-r--r-- | [arch/loongarch/kernel/traps.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/arch/loongarch/kernel/traps.c?id=8915ed160dbd32b5ef5864df9a9fc11db83a77bb) | 5 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 5 insertions, 0 deletions

| diff --git a/arch/loongarch/kernel/traps.c b/arch/loongarch/kernel/traps.cindex aebfc3733a7607..d59052c03d9b7e 100644--- a/[arch/loongarch/kernel/traps.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/loongarch/kernel/traps.c?id=cd2cef7311707a788eeb60cb73cd4b8bd7d767ed)+++ b/[arch/loongarch/kernel/traps.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/loongarch/kernel/traps.c?id=8915ed160dbd32b5ef5864df9a9fc11db83a77bb)@@ -529,6 +529,9 @@ asmlinkage void noinstr do\_ale(struct pt\_regs \*regs) #else unsigned int \*pc; + if (regs->csr\_prmd & CSR\_PRMD\_PIE)+ local\_irq\_enable();+ perf\_sw\_event(PERF\_COUNT\_SW\_ALIGNMENT\_FAULTS, 1, regs, regs->csr\_badvaddr);  /\*@@ -553,6 +556,8 @@ sigbus: die\_if\_kernel("Kernel ale access", regs); force\_sig\_fault(SIGBUS, BUS\_ADRALN, (void \_\_user \*)regs->csr\_badvaddr); out:+ if (regs->csr\_prmd & CSR\_PRMD\_PIE)+ local\_irq\_disable(); #endif irqentry\_exit(regs, state); } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 19:25:35 +0000



=== Content from git.kernel.org_f81f9d2b_20250114_192659.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=afbfb3568d78082078acc8bb2b29bb47af87253c)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=afbfb3568d78082078acc8bb2b29bb47af87253c)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=afbfb3568d78082078acc8bb2b29bb47af87253c)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=afbfb3568d78082078acc8bb2b29bb47af87253c)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Huacai Chen <chenhuacai@loongson.cn> | 2024-10-21 22:11:19 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-11-01 02:02:42 +0100 |
| commit | [afbfb3568d78082078acc8bb2b29bb47af87253c](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=afbfb3568d78082078acc8bb2b29bb47af87253c) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=afbfb3568d78082078acc8bb2b29bb47af87253c)) | |
| tree | [2469eb5473721d02d5611703ba0eba8183dff8bf](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=afbfb3568d78082078acc8bb2b29bb47af87253c) | |
| parent | [7210bb7a0d873181e76ae5f200d18079bcc95997](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=7210bb7a0d873181e76ae5f200d18079bcc95997) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=afbfb3568d78082078acc8bb2b29bb47af87253c&id2=7210bb7a0d873181e76ae5f200d18079bcc95997)) | |
| download | [linux-afbfb3568d78082078acc8bb2b29bb47af87253c.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-afbfb3568d78082078acc8bb2b29bb47af87253c.tar.gz) | |

LoongArch: Enable IRQ if do\_ale() triggered in irq-enabled contextcommit 69cc6fad5df4ce652d969be69acc60e269e5eea1 upstream.
Unaligned access exception can be triggered in irq-enabled context such
as user mode, in this case do\_ale() may call get\_user() which may cause
sleep. Then we will get:
BUG: sleeping function called from invalid context at arch/loongarch/kernel/access-helper.h:7
in\_atomic(): 0, irqs\_disabled(): 1, non\_block: 0, pid: 129, name: modprobe
preempt\_count: 0, expected: 0
RCU nest depth: 0, expected: 0
CPU: 0 UID: 0 PID: 129 Comm: modprobe Tainted: G W 6.12.0-rc1+ #1723
Tainted: [W]=WARN
Stack : 9000000105e0bd48 0000000000000000 9000000003803944 9000000105e08000
9000000105e0bc70 9000000105e0bc78 0000000000000000 0000000000000000
9000000105e0bc78 0000000000000001 9000000185e0ba07 9000000105e0b890
ffffffffffffffff 9000000105e0bc78 73924b81763be05b 9000000100194500
000000000000020c 000000000000000a 0000000000000000 0000000000000003
00000000000023f0 00000000000e1401 00000000072f8000 0000007ffbb0e260
0000000000000000 0000000000000000 9000000005437650 90000000055d5000
0000000000000000 0000000000000003 0000007ffbb0e1f0 0000000000000000
0000005567b00490 0000000000000000 9000000003803964 0000007ffbb0dfec
00000000000000b0 0000000000000007 0000000000000003 0000000000071c1d
...
Call Trace:
[<9000000003803964>] show\_stack+0x64/0x1a0
[<9000000004c57464>] dump\_stack\_lvl+0x74/0xb0
[<9000000003861ab4>] \_\_might\_resched+0x154/0x1a0
[<900000000380c96c>] emulate\_load\_store\_insn+0x6c/0xf60
[<9000000004c58118>] do\_ale+0x78/0x180
[<9000000003801bc8>] handle\_ale+0x128/0x1e0
So enable IRQ if unaligned access exception is triggered in irq-enabled
context to fix it.
Cc: stable@vger.kernel.org
Reported-by: Binbin Zhou <zhoubinbin@loongson.cn>
Signed-off-by: Huacai Chen <chenhuacai@loongson.cn>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=afbfb3568d78082078acc8bb2b29bb47af87253c)

| -rw-r--r-- | [arch/loongarch/kernel/traps.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/arch/loongarch/kernel/traps.c?id=afbfb3568d78082078acc8bb2b29bb47af87253c) | 5 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 5 insertions, 0 deletions

| diff --git a/arch/loongarch/kernel/traps.c b/arch/loongarch/kernel/traps.cindex f9f4eb00c92ef5..c57b4134f3e84b 100644--- a/[arch/loongarch/kernel/traps.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/loongarch/kernel/traps.c?id=7210bb7a0d873181e76ae5f200d18079bcc95997)+++ b/[arch/loongarch/kernel/traps.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/loongarch/kernel/traps.c?id=afbfb3568d78082078acc8bb2b29bb47af87253c)@@ -555,6 +555,9 @@ asmlinkage void noinstr do\_ale(struct pt\_regs \*regs) #else unsigned int \*pc; + if (regs->csr\_prmd & CSR\_PRMD\_PIE)+ local\_irq\_enable();+ perf\_sw\_event(PERF\_COUNT\_SW\_ALIGNMENT\_FAULTS, 1, regs, regs->csr\_badvaddr);  /\*@@ -579,6 +582,8 @@ sigbus: die\_if\_kernel("Kernel ale access", regs); force\_sig\_fault(SIGBUS, BUS\_ADRALN, (void \_\_user \*)regs->csr\_badvaddr); out:+ if (regs->csr\_prmd & CSR\_PRMD\_PIE)+ local\_irq\_disable(); #endif irqentry\_exit(regs, state); } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 19:25:36 +0000


