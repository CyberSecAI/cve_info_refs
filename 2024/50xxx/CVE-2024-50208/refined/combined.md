=== Content from git.kernel.org_4218624d_20250115_095535.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=daac56dd98e1ba814c878ac0acd482a37f2ab94b)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=daac56dd98e1ba814c878ac0acd482a37f2ab94b)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=daac56dd98e1ba814c878ac0acd482a37f2ab94b)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=daac56dd98e1ba814c878ac0acd482a37f2ab94b)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Bhargava Chenna Marreddy <bhargava.marreddy@broadcom.com> | 2024-10-08 00:41:41 -0700 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-11-01 02:02:27 +0100 |
| commit | [daac56dd98e1ba814c878ac0acd482a37f2ab94b](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=daac56dd98e1ba814c878ac0acd482a37f2ab94b) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=daac56dd98e1ba814c878ac0acd482a37f2ab94b)) | |
| tree | [d1031afe76965d6fd68a876896b2aa3ab0f33341](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=daac56dd98e1ba814c878ac0acd482a37f2ab94b) | |
| parent | [b72853f5ada3b89b762fc8e4db9e53a3423fefbb](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=b72853f5ada3b89b762fc8e4db9e53a3423fefbb) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=daac56dd98e1ba814c878ac0acd482a37f2ab94b&id2=b72853f5ada3b89b762fc8e4db9e53a3423fefbb)) | |
| download | [linux-daac56dd98e1ba814c878ac0acd482a37f2ab94b.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-daac56dd98e1ba814c878ac0acd482a37f2ab94b.tar.gz) | |

RDMA/bnxt\_re: Fix a bug while setting up Level-2 PBL pages[ Upstream commit 7988bdbbb85ac85a847baf09879edcd0f70521dc ]
Avoid memory corruption while setting up Level-2 PBL pages for the non MR
resources when num\_pages > 256K.
There will be a single PDE page address (contiguous pages in the case of >
PAGE\_SIZE), but, current logic assumes multiple pages, leading to invalid
memory access after 256K PBL entries in the PDE.
Fixes: 0c4dcd602817 ("RDMA/bnxt\_re: Refactor hardware queue memory allocation")
Link: [https://patch.msgid.link/r/1728373302-19530-10-git-send-email-selvin.xavier@broadcom.com](https://patch.msgid.link/r/1728373302-19530-10-git-send-email-selvin.xavier%40broadcom.com)
Signed-off-by: Bhargava Chenna Marreddy <bhargava.marreddy@broadcom.com>
Signed-off-by: Selvin Xavier <selvin.xavier@broadcom.com>
Signed-off-by: Jason Gunthorpe <jgg@nvidia.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=daac56dd98e1ba814c878ac0acd482a37f2ab94b)

| -rw-r--r-- | [drivers/infiniband/hw/bnxt\_re/qplib\_res.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/infiniband/hw/bnxt_re/qplib_res.c?id=daac56dd98e1ba814c878ac0acd482a37f2ab94b) | 19 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 3 insertions, 16 deletions

| diff --git a/drivers/infiniband/hw/bnxt\_re/qplib\_res.c b/drivers/infiniband/hw/bnxt\_re/qplib\_res.cindex 1fdffd6a0f4808..96ceec1e8199a6 100644--- a/[drivers/infiniband/hw/bnxt\_re/qplib\_res.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/infiniband/hw/bnxt_re/qplib_res.c?id=b72853f5ada3b89b762fc8e4db9e53a3423fefbb)+++ b/[drivers/infiniband/hw/bnxt\_re/qplib\_res.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/infiniband/hw/bnxt_re/qplib_res.c?id=daac56dd98e1ba814c878ac0acd482a37f2ab94b)@@ -257,22 +257,9 @@ int bnxt\_qplib\_alloc\_init\_hwq(struct bnxt\_qplib\_hwq \*hwq, dst\_virt\_ptr = (dma\_addr\_t \*\*)hwq->pbl[PBL\_LVL\_0].pg\_arr; src\_phys\_ptr = hwq->pbl[PBL\_LVL\_1].pg\_map\_arr;- if (hwq\_attr->type == HWQ\_TYPE\_MR) {- /\* For MR it is expected that we supply only 1 contigous- \* page i.e only 1 entry in the PDL that will contain- \* all the PBLs for the user supplied memory region- \*/- for (i = 0; i < hwq->pbl[PBL\_LVL\_1].pg\_count;- i++)- dst\_virt\_ptr[0][i] = src\_phys\_ptr[i] |- flag;- } else {- for (i = 0; i < hwq->pbl[PBL\_LVL\_1].pg\_count;- i++)- dst\_virt\_ptr[PTR\_PG(i)][PTR\_IDX(i)] =- src\_phys\_ptr[i] |- PTU\_PDE\_VALID;- }+ for (i = 0; i < hwq->pbl[PBL\_LVL\_1].pg\_count; i++)+ dst\_virt\_ptr[0][i] = src\_phys\_ptr[i] | flag;+ /\* Alloc or init PTEs \*/ rc = \_\_alloc\_pbl(res, &hwq->pbl[PBL\_LVL\_2], hwq\_attr->sginfo); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-15 09:54:12 +0000



=== Content from git.kernel.org_ab3dd613_20250115_095536.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=de5857fa7bcc9a496a914c7e21390be873109f26)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=de5857fa7bcc9a496a914c7e21390be873109f26)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=de5857fa7bcc9a496a914c7e21390be873109f26)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=de5857fa7bcc9a496a914c7e21390be873109f26)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Bhargava Chenna Marreddy <bhargava.marreddy@broadcom.com> | 2024-10-08 00:41:41 -0700 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-11-01 01:52:33 +0100 |
| commit | [de5857fa7bcc9a496a914c7e21390be873109f26](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=de5857fa7bcc9a496a914c7e21390be873109f26) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=de5857fa7bcc9a496a914c7e21390be873109f26)) | |
| tree | [dac72d374373fef07eb938ba6c65c62692f28474](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=de5857fa7bcc9a496a914c7e21390be873109f26) | |
| parent | [e810e6d464039b64e01fd39676bd632798fae71b](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=e810e6d464039b64e01fd39676bd632798fae71b) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=de5857fa7bcc9a496a914c7e21390be873109f26&id2=e810e6d464039b64e01fd39676bd632798fae71b)) | |
| download | [linux-de5857fa7bcc9a496a914c7e21390be873109f26.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-de5857fa7bcc9a496a914c7e21390be873109f26.tar.gz) | |

RDMA/bnxt\_re: Fix a bug while setting up Level-2 PBL pages[ Upstream commit 7988bdbbb85ac85a847baf09879edcd0f70521dc ]
Avoid memory corruption while setting up Level-2 PBL pages for the non MR
resources when num\_pages > 256K.
There will be a single PDE page address (contiguous pages in the case of >
PAGE\_SIZE), but, current logic assumes multiple pages, leading to invalid
memory access after 256K PBL entries in the PDE.
Fixes: 0c4dcd602817 ("RDMA/bnxt\_re: Refactor hardware queue memory allocation")
Link: [https://patch.msgid.link/r/1728373302-19530-10-git-send-email-selvin.xavier@broadcom.com](https://patch.msgid.link/r/1728373302-19530-10-git-send-email-selvin.xavier%40broadcom.com)
Signed-off-by: Bhargava Chenna Marreddy <bhargava.marreddy@broadcom.com>
Signed-off-by: Selvin Xavier <selvin.xavier@broadcom.com>
Signed-off-by: Jason Gunthorpe <jgg@nvidia.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=de5857fa7bcc9a496a914c7e21390be873109f26)

| -rw-r--r-- | [drivers/infiniband/hw/bnxt\_re/qplib\_res.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/infiniband/hw/bnxt_re/qplib_res.c?id=de5857fa7bcc9a496a914c7e21390be873109f26) | 19 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 3 insertions, 16 deletions

| diff --git a/drivers/infiniband/hw/bnxt\_re/qplib\_res.c b/drivers/infiniband/hw/bnxt\_re/qplib\_res.cindex 00ef5f99929c40..401cb3e22f3108 100644--- a/[drivers/infiniband/hw/bnxt\_re/qplib\_res.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/infiniband/hw/bnxt_re/qplib_res.c?id=e810e6d464039b64e01fd39676bd632798fae71b)+++ b/[drivers/infiniband/hw/bnxt\_re/qplib\_res.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/infiniband/hw/bnxt_re/qplib_res.c?id=de5857fa7bcc9a496a914c7e21390be873109f26)@@ -256,22 +256,9 @@ int bnxt\_qplib\_alloc\_init\_hwq(struct bnxt\_qplib\_hwq \*hwq, dst\_virt\_ptr = (dma\_addr\_t \*\*)hwq->pbl[PBL\_LVL\_0].pg\_arr; src\_phys\_ptr = hwq->pbl[PBL\_LVL\_1].pg\_map\_arr;- if (hwq\_attr->type == HWQ\_TYPE\_MR) {- /\* For MR it is expected that we supply only 1 contigous- \* page i.e only 1 entry in the PDL that will contain- \* all the PBLs for the user supplied memory region- \*/- for (i = 0; i < hwq->pbl[PBL\_LVL\_1].pg\_count;- i++)- dst\_virt\_ptr[0][i] = src\_phys\_ptr[i] |- flag;- } else {- for (i = 0; i < hwq->pbl[PBL\_LVL\_1].pg\_count;- i++)- dst\_virt\_ptr[PTR\_PG(i)][PTR\_IDX(i)] =- src\_phys\_ptr[i] |- PTU\_PDE\_VALID;- }+ for (i = 0; i < hwq->pbl[PBL\_LVL\_1].pg\_count; i++)+ dst\_virt\_ptr[0][i] = src\_phys\_ptr[i] | flag;+ /\* Alloc or init PTEs \*/ rc = \_\_alloc\_pbl(res, &hwq->pbl[PBL\_LVL\_2], hwq\_attr->sginfo); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-15 09:54:13 +0000



=== Content from git.kernel.org_137d9883_20250115_095533.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=87cb3b0054e53e0155b630bdf8fb714ded62565f)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=87cb3b0054e53e0155b630bdf8fb714ded62565f)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=87cb3b0054e53e0155b630bdf8fb714ded62565f)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=87cb3b0054e53e0155b630bdf8fb714ded62565f)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Bhargava Chenna Marreddy <bhargava.marreddy@broadcom.com> | 2024-10-08 00:41:41 -0700 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-11-01 01:58:21 +0100 |
| commit | [87cb3b0054e53e0155b630bdf8fb714ded62565f](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=87cb3b0054e53e0155b630bdf8fb714ded62565f) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=87cb3b0054e53e0155b630bdf8fb714ded62565f)) | |
| tree | [505f668914eaead909f984c4e85e06ce239ac744](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=87cb3b0054e53e0155b630bdf8fb714ded62565f) | |
| parent | [d517cadae6c321b835b9ebc976f9aca4f64bf0cc](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=d517cadae6c321b835b9ebc976f9aca4f64bf0cc) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=87cb3b0054e53e0155b630bdf8fb714ded62565f&id2=d517cadae6c321b835b9ebc976f9aca4f64bf0cc)) | |
| download | [linux-87cb3b0054e53e0155b630bdf8fb714ded62565f.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-87cb3b0054e53e0155b630bdf8fb714ded62565f.tar.gz) | |

RDMA/bnxt\_re: Fix a bug while setting up Level-2 PBL pages[ Upstream commit 7988bdbbb85ac85a847baf09879edcd0f70521dc ]
Avoid memory corruption while setting up Level-2 PBL pages for the non MR
resources when num\_pages > 256K.
There will be a single PDE page address (contiguous pages in the case of >
PAGE\_SIZE), but, current logic assumes multiple pages, leading to invalid
memory access after 256K PBL entries in the PDE.
Fixes: 0c4dcd602817 ("RDMA/bnxt\_re: Refactor hardware queue memory allocation")
Link: [https://patch.msgid.link/r/1728373302-19530-10-git-send-email-selvin.xavier@broadcom.com](https://patch.msgid.link/r/1728373302-19530-10-git-send-email-selvin.xavier%40broadcom.com)
Signed-off-by: Bhargava Chenna Marreddy <bhargava.marreddy@broadcom.com>
Signed-off-by: Selvin Xavier <selvin.xavier@broadcom.com>
Signed-off-by: Jason Gunthorpe <jgg@nvidia.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=87cb3b0054e53e0155b630bdf8fb714ded62565f)

| -rw-r--r-- | [drivers/infiniband/hw/bnxt\_re/qplib\_res.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/infiniband/hw/bnxt_re/qplib_res.c?id=87cb3b0054e53e0155b630bdf8fb714ded62565f) | 19 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 3 insertions, 16 deletions

| diff --git a/drivers/infiniband/hw/bnxt\_re/qplib\_res.c b/drivers/infiniband/hw/bnxt\_re/qplib\_res.cindex 1fdffd6a0f4808..96ceec1e8199a6 100644--- a/[drivers/infiniband/hw/bnxt\_re/qplib\_res.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/infiniband/hw/bnxt_re/qplib_res.c?id=d517cadae6c321b835b9ebc976f9aca4f64bf0cc)+++ b/[drivers/infiniband/hw/bnxt\_re/qplib\_res.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/infiniband/hw/bnxt_re/qplib_res.c?id=87cb3b0054e53e0155b630bdf8fb714ded62565f)@@ -257,22 +257,9 @@ int bnxt\_qplib\_alloc\_init\_hwq(struct bnxt\_qplib\_hwq \*hwq, dst\_virt\_ptr = (dma\_addr\_t \*\*)hwq->pbl[PBL\_LVL\_0].pg\_arr; src\_phys\_ptr = hwq->pbl[PBL\_LVL\_1].pg\_map\_arr;- if (hwq\_attr->type == HWQ\_TYPE\_MR) {- /\* For MR it is expected that we supply only 1 contigous- \* page i.e only 1 entry in the PDL that will contain- \* all the PBLs for the user supplied memory region- \*/- for (i = 0; i < hwq->pbl[PBL\_LVL\_1].pg\_count;- i++)- dst\_virt\_ptr[0][i] = src\_phys\_ptr[i] |- flag;- } else {- for (i = 0; i < hwq->pbl[PBL\_LVL\_1].pg\_count;- i++)- dst\_virt\_ptr[PTR\_PG(i)][PTR\_IDX(i)] =- src\_phys\_ptr[i] |- PTU\_PDE\_VALID;- }+ for (i = 0; i < hwq->pbl[PBL\_LVL\_1].pg\_count; i++)+ dst\_virt\_ptr[0][i] = src\_phys\_ptr[i] | flag;+ /\* Alloc or init PTEs \*/ rc = \_\_alloc\_pbl(res, &hwq->pbl[PBL\_LVL\_2], hwq\_attr->sginfo); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-15 09:54:10 +0000



=== Content from git.kernel.org_2ac86d78_20250115_095538.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=ea701c1849e7250ea41a4f7493e0a5f136c1d47e)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=ea701c1849e7250ea41a4f7493e0a5f136c1d47e)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=ea701c1849e7250ea41a4f7493e0a5f136c1d47e)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=ea701c1849e7250ea41a4f7493e0a5f136c1d47e)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Bhargava Chenna Marreddy <bhargava.marreddy@broadcom.com> | 2024-10-08 00:41:41 -0700 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-11-01 01:55:58 +0100 |
| commit | [ea701c1849e7250ea41a4f7493e0a5f136c1d47e](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=ea701c1849e7250ea41a4f7493e0a5f136c1d47e) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=ea701c1849e7250ea41a4f7493e0a5f136c1d47e)) | |
| tree | [e95e54c78ae0e2f12b9f847214a1f2e7fe2e8fec](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=ea701c1849e7250ea41a4f7493e0a5f136c1d47e) | |
| parent | [ff80a98104c45bb7cc0689065a11d85794d42766](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=ff80a98104c45bb7cc0689065a11d85794d42766) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=ea701c1849e7250ea41a4f7493e0a5f136c1d47e&id2=ff80a98104c45bb7cc0689065a11d85794d42766)) | |
| download | [linux-ea701c1849e7250ea41a4f7493e0a5f136c1d47e.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-ea701c1849e7250ea41a4f7493e0a5f136c1d47e.tar.gz) | |

RDMA/bnxt\_re: Fix a bug while setting up Level-2 PBL pages[ Upstream commit 7988bdbbb85ac85a847baf09879edcd0f70521dc ]
Avoid memory corruption while setting up Level-2 PBL pages for the non MR
resources when num\_pages > 256K.
There will be a single PDE page address (contiguous pages in the case of >
PAGE\_SIZE), but, current logic assumes multiple pages, leading to invalid
memory access after 256K PBL entries in the PDE.
Fixes: 0c4dcd602817 ("RDMA/bnxt\_re: Refactor hardware queue memory allocation")
Link: [https://patch.msgid.link/r/1728373302-19530-10-git-send-email-selvin.xavier@broadcom.com](https://patch.msgid.link/r/1728373302-19530-10-git-send-email-selvin.xavier%40broadcom.com)
Signed-off-by: Bhargava Chenna Marreddy <bhargava.marreddy@broadcom.com>
Signed-off-by: Selvin Xavier <selvin.xavier@broadcom.com>
Signed-off-by: Jason Gunthorpe <jgg@nvidia.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=ea701c1849e7250ea41a4f7493e0a5f136c1d47e)

| -rw-r--r-- | [drivers/infiniband/hw/bnxt\_re/qplib\_res.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/infiniband/hw/bnxt_re/qplib_res.c?id=ea701c1849e7250ea41a4f7493e0a5f136c1d47e) | 19 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 3 insertions, 16 deletions

| diff --git a/drivers/infiniband/hw/bnxt\_re/qplib\_res.c b/drivers/infiniband/hw/bnxt\_re/qplib\_res.cindex 1dd36af9e68f2c..203350c6e00f5a 100644--- a/[drivers/infiniband/hw/bnxt\_re/qplib\_res.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/infiniband/hw/bnxt_re/qplib_res.c?id=ff80a98104c45bb7cc0689065a11d85794d42766)+++ b/[drivers/infiniband/hw/bnxt\_re/qplib\_res.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/infiniband/hw/bnxt_re/qplib_res.c?id=ea701c1849e7250ea41a4f7493e0a5f136c1d47e)@@ -257,22 +257,9 @@ int bnxt\_qplib\_alloc\_init\_hwq(struct bnxt\_qplib\_hwq \*hwq, dst\_virt\_ptr = (dma\_addr\_t \*\*)hwq->pbl[PBL\_LVL\_0].pg\_arr; src\_phys\_ptr = hwq->pbl[PBL\_LVL\_1].pg\_map\_arr;- if (hwq\_attr->type == HWQ\_TYPE\_MR) {- /\* For MR it is expected that we supply only 1 contigous- \* page i.e only 1 entry in the PDL that will contain- \* all the PBLs for the user supplied memory region- \*/- for (i = 0; i < hwq->pbl[PBL\_LVL\_1].pg\_count;- i++)- dst\_virt\_ptr[0][i] = src\_phys\_ptr[i] |- flag;- } else {- for (i = 0; i < hwq->pbl[PBL\_LVL\_1].pg\_count;- i++)- dst\_virt\_ptr[PTR\_PG(i)][PTR\_IDX(i)] =- src\_phys\_ptr[i] |- PTU\_PDE\_VALID;- }+ for (i = 0; i < hwq->pbl[PBL\_LVL\_1].pg\_count; i++)+ dst\_virt\_ptr[0][i] = src\_phys\_ptr[i] | flag;+ /\* Alloc or init PTEs \*/ rc = \_\_alloc\_pbl(res, &hwq->pbl[PBL\_LVL\_2], hwq\_attr->sginfo); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-15 09:54:15 +0000



=== Content from git.kernel.org_82e9ed51_20250115_095532.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=7988bdbbb85ac85a847baf09879edcd0f70521dc)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=7988bdbbb85ac85a847baf09879edcd0f70521dc)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=7988bdbbb85ac85a847baf09879edcd0f70521dc)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=7988bdbbb85ac85a847baf09879edcd0f70521dc)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Bhargava Chenna Marreddy <bhargava.marreddy@broadcom.com> | 2024-10-08 00:41:41 -0700 |
| --- | --- | --- |
| committer | Jason Gunthorpe <jgg@nvidia.com> | 2024-10-11 20:49:02 -0300 |
| commit | [7988bdbbb85ac85a847baf09879edcd0f70521dc](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=7988bdbbb85ac85a847baf09879edcd0f70521dc) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=7988bdbbb85ac85a847baf09879edcd0f70521dc)) | |
| tree | [9abfbb7aa781cd9c978adad5b62e4e121b44c7fe](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=7988bdbbb85ac85a847baf09879edcd0f70521dc) | |
| parent | [2df411353dacc4b0c911f8c4944f8ffab955391c](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=2df411353dacc4b0c911f8c4944f8ffab955391c) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=7988bdbbb85ac85a847baf09879edcd0f70521dc&id2=2df411353dacc4b0c911f8c4944f8ffab955391c)) | |
| download | [linux-7988bdbbb85ac85a847baf09879edcd0f70521dc.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-7988bdbbb85ac85a847baf09879edcd0f70521dc.tar.gz) | |

RDMA/bnxt\_re: Fix a bug while setting up Level-2 PBL pagesAvoid memory corruption while setting up Level-2 PBL pages for the non MR
resources when num\_pages > 256K.
There will be a single PDE page address (contiguous pages in the case of >
PAGE\_SIZE), but, current logic assumes multiple pages, leading to invalid
memory access after 256K PBL entries in the PDE.
Fixes: 0c4dcd602817 ("RDMA/bnxt\_re: Refactor hardware queue memory allocation")
Link: [https://patch.msgid.link/r/1728373302-19530-10-git-send-email-selvin.xavier@broadcom.com](https://patch.msgid.link/r/1728373302-19530-10-git-send-email-selvin.xavier%40broadcom.com)
Signed-off-by: Bhargava Chenna Marreddy <bhargava.marreddy@broadcom.com>
Signed-off-by: Selvin Xavier <selvin.xavier@broadcom.com>
Signed-off-by: Jason Gunthorpe <jgg@nvidia.com>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=7988bdbbb85ac85a847baf09879edcd0f70521dc)

| -rw-r--r-- | [drivers/infiniband/hw/bnxt\_re/qplib\_res.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/infiniband/hw/bnxt_re/qplib_res.c?id=7988bdbbb85ac85a847baf09879edcd0f70521dc) | 19 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 3 insertions, 16 deletions

| diff --git a/drivers/infiniband/hw/bnxt\_re/qplib\_res.c b/drivers/infiniband/hw/bnxt\_re/qplib\_res.cindex 1fdffd6a0f4808..96ceec1e8199a6 100644--- a/[drivers/infiniband/hw/bnxt\_re/qplib\_res.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/infiniband/hw/bnxt_re/qplib_res.c?id=2df411353dacc4b0c911f8c4944f8ffab955391c)+++ b/[drivers/infiniband/hw/bnxt\_re/qplib\_res.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/infiniband/hw/bnxt_re/qplib_res.c?id=7988bdbbb85ac85a847baf09879edcd0f70521dc)@@ -257,22 +257,9 @@ int bnxt\_qplib\_alloc\_init\_hwq(struct bnxt\_qplib\_hwq \*hwq, dst\_virt\_ptr = (dma\_addr\_t \*\*)hwq->pbl[PBL\_LVL\_0].pg\_arr; src\_phys\_ptr = hwq->pbl[PBL\_LVL\_1].pg\_map\_arr;- if (hwq\_attr->type == HWQ\_TYPE\_MR) {- /\* For MR it is expected that we supply only 1 contigous- \* page i.e only 1 entry in the PDL that will contain- \* all the PBLs for the user supplied memory region- \*/- for (i = 0; i < hwq->pbl[PBL\_LVL\_1].pg\_count;- i++)- dst\_virt\_ptr[0][i] = src\_phys\_ptr[i] |- flag;- } else {- for (i = 0; i < hwq->pbl[PBL\_LVL\_1].pg\_count;- i++)- dst\_virt\_ptr[PTR\_PG(i)][PTR\_IDX(i)] =- src\_phys\_ptr[i] |- PTU\_PDE\_VALID;- }+ for (i = 0; i < hwq->pbl[PBL\_LVL\_1].pg\_count; i++)+ dst\_virt\_ptr[0][i] = src\_phys\_ptr[i] | flag;+ /\* Alloc or init PTEs \*/ rc = \_\_alloc\_pbl(res, &hwq->pbl[PBL\_LVL\_2], hwq\_attr->sginfo); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-15 09:54:09 +0000



=== Content from git.kernel.org_317b7970_20250115_095537.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=df6fed0a2a1a5e57f033bca40dc316b18e0d0ce6)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=df6fed0a2a1a5e57f033bca40dc316b18e0d0ce6)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=df6fed0a2a1a5e57f033bca40dc316b18e0d0ce6)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=df6fed0a2a1a5e57f033bca40dc316b18e0d0ce6)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Bhargava Chenna Marreddy <bhargava.marreddy@broadcom.com> | 2024-10-08 00:41:41 -0700 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-11-08 16:21:57 +0100 |
| commit | [df6fed0a2a1a5e57f033bca40dc316b18e0d0ce6](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=df6fed0a2a1a5e57f033bca40dc316b18e0d0ce6) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=df6fed0a2a1a5e57f033bca40dc316b18e0d0ce6)) | |
| tree | [8480cb866cdc0bda6ca76249a6b217c86fb2ba96](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=df6fed0a2a1a5e57f033bca40dc316b18e0d0ce6) | |
| parent | [78aaf54ad5d7775aab92529ac2895acce8afd324](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=78aaf54ad5d7775aab92529ac2895acce8afd324) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=df6fed0a2a1a5e57f033bca40dc316b18e0d0ce6&id2=78aaf54ad5d7775aab92529ac2895acce8afd324)) | |
| download | [linux-df6fed0a2a1a5e57f033bca40dc316b18e0d0ce6.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-df6fed0a2a1a5e57f033bca40dc316b18e0d0ce6.tar.gz) | |

RDMA/bnxt\_re: Fix a bug while setting up Level-2 PBL pages[ Upstream commit 7988bdbbb85ac85a847baf09879edcd0f70521dc ]
Avoid memory corruption while setting up Level-2 PBL pages for the non MR
resources when num\_pages > 256K.
There will be a single PDE page address (contiguous pages in the case of >
PAGE\_SIZE), but, current logic assumes multiple pages, leading to invalid
memory access after 256K PBL entries in the PDE.
Fixes: 0c4dcd602817 ("RDMA/bnxt\_re: Refactor hardware queue memory allocation")
Link: [https://patch.msgid.link/r/1728373302-19530-10-git-send-email-selvin.xavier@broadcom.com](https://patch.msgid.link/r/1728373302-19530-10-git-send-email-selvin.xavier%40broadcom.com)
Signed-off-by: Bhargava Chenna Marreddy <bhargava.marreddy@broadcom.com>
Signed-off-by: Selvin Xavier <selvin.xavier@broadcom.com>
Signed-off-by: Jason Gunthorpe <jgg@nvidia.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=df6fed0a2a1a5e57f033bca40dc316b18e0d0ce6)

| -rw-r--r-- | [drivers/infiniband/hw/bnxt\_re/qplib\_res.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/infiniband/hw/bnxt_re/qplib_res.c?id=df6fed0a2a1a5e57f033bca40dc316b18e0d0ce6) | 19 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 3 insertions, 16 deletions

| diff --git a/drivers/infiniband/hw/bnxt\_re/qplib\_res.c b/drivers/infiniband/hw/bnxt\_re/qplib\_res.cindex 2861a2bbea6e40..af23e57fc78ed0 100644--- a/[drivers/infiniband/hw/bnxt\_re/qplib\_res.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/infiniband/hw/bnxt_re/qplib_res.c?id=78aaf54ad5d7775aab92529ac2895acce8afd324)+++ b/[drivers/infiniband/hw/bnxt\_re/qplib\_res.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/infiniband/hw/bnxt_re/qplib_res.c?id=df6fed0a2a1a5e57f033bca40dc316b18e0d0ce6)@@ -256,22 +256,9 @@ int bnxt\_qplib\_alloc\_init\_hwq(struct bnxt\_qplib\_hwq \*hwq, dst\_virt\_ptr = (dma\_addr\_t \*\*)hwq->pbl[PBL\_LVL\_0].pg\_arr; src\_phys\_ptr = hwq->pbl[PBL\_LVL\_1].pg\_map\_arr;- if (hwq\_attr->type == HWQ\_TYPE\_MR) {- /\* For MR it is expected that we supply only 1 contigous- \* page i.e only 1 entry in the PDL that will contain- \* all the PBLs for the user supplied memory region- \*/- for (i = 0; i < hwq->pbl[PBL\_LVL\_1].pg\_count;- i++)- dst\_virt\_ptr[0][i] = src\_phys\_ptr[i] |- flag;- } else {- for (i = 0; i < hwq->pbl[PBL\_LVL\_1].pg\_count;- i++)- dst\_virt\_ptr[PTR\_PG(i)][PTR\_IDX(i)] =- src\_phys\_ptr[i] |- PTU\_PDE\_VALID;- }+ for (i = 0; i < hwq->pbl[PBL\_LVL\_1].pg\_count; i++)+ dst\_virt\_ptr[0][i] = src\_phys\_ptr[i] | flag;+ /\* Alloc or init PTEs \*/ rc = \_\_alloc\_pbl(res, &hwq->pbl[PBL\_LVL\_2], hwq\_attr->sginfo); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-15 09:54:14 +0000


