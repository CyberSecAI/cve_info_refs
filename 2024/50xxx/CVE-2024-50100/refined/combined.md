=== Content from git.kernel.org_bf7c64d5_20250114_183059.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=cf7ee2291da551fc4b109fda1f6a332cb8212065)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=cf7ee2291da551fc4b109fda1f6a332cb8212065)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=cf7ee2291da551fc4b109fda1f6a332cb8212065)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=cf7ee2291da551fc4b109fda1f6a332cb8212065)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Alan Stern <stern@rowland.harvard.edu> | 2024-10-16 11:44:45 -0400 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-11-08 16:26:44 +0100 |
| commit | [cf7ee2291da551fc4b109fda1f6a332cb8212065](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=cf7ee2291da551fc4b109fda1f6a332cb8212065) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=cf7ee2291da551fc4b109fda1f6a332cb8212065)) | |
| tree | [ea84f217aae8da02f5102ab174549db69526509c](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=cf7ee2291da551fc4b109fda1f6a332cb8212065) | |
| parent | [102c4e5869e7464df671e331953e21b297f027b6](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=102c4e5869e7464df671e331953e21b297f027b6) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=cf7ee2291da551fc4b109fda1f6a332cb8212065&id2=102c4e5869e7464df671e331953e21b297f027b6)) | |
| download | [linux-cf7ee2291da551fc4b109fda1f6a332cb8212065.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-cf7ee2291da551fc4b109fda1f6a332cb8212065.tar.gz) | |

USB: gadget: dummy-hcd: Fix "task hung" problem[ Upstream commit 5189df7b8088268012882c220d6aca4e64981348 ]
The syzbot fuzzer has been encountering "task hung" problems ever
since the dummy-hcd driver was changed to use hrtimers instead of
regular timers. It turns out that the problems are caused by a subtle
difference between the timer\_pending() and hrtimer\_active() APIs.
The changeover blindly replaced the first by the second. However,
timer\_pending() returns True when the timer is queued but not when its
callback is running, whereas hrtimer\_active() returns True when the
hrtimer is queued \_or\_ its callback is running. This difference
occasionally caused dummy\_urb\_enqueue() to think that the callback
routine had not yet started when in fact it was almost finished. As a
result the hrtimer was not restarted, which made it impossible for the
driver to dequeue later the URB that was just enqueued. This caused
usb\_kill\_urb() to hang, and things got worse from there.
Since hrtimers have no API for telling when they are queued and the
callback isn't running, the driver must keep track of this for itself.
That's what this patch does, adding a new "timer\_pending" flag and
setting or clearing it at the appropriate times.
Reported-by: syzbot+f342ea16c9d06d80b585@syzkaller.appspotmail.com
Closes: https://lore.kernel.org/linux-usb/6709234e.050a0220.3e960.0011.GAE@google.com/
Tested-by: syzbot+f342ea16c9d06d80b585@syzkaller.appspotmail.com
Signed-off-by: Alan Stern <stern@rowland.harvard.edu>
Fixes: a7f3813e589f ("usb: gadget: dummy\_hcd: Switch to hrtimer transfer scheduler")
Cc: Marcello Sylvester Bauer <sylv@sylv.io>
Cc: stable@vger.kernel.org
Link: [https://lore.kernel.org/r/2dab644e-ef87-4de8-ac9a-26f100b2c609@rowland.harvard.edu](https://lore.kernel.org/r/2dab644e-ef87-4de8-ac9a-26f100b2c609%40rowland.harvard.edu)
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=cf7ee2291da551fc4b109fda1f6a332cb8212065)

| -rw-r--r-- | [drivers/usb/gadget/udc/dummy\_hcd.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/usb/gadget/udc/dummy_hcd.c?id=cf7ee2291da551fc4b109fda1f6a332cb8212065) | 20 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 15 insertions, 5 deletions

| diff --git a/drivers/usb/gadget/udc/dummy\_hcd.c b/drivers/usb/gadget/udc/dummy\_hcd.cindex 019e8f3007c945..6e18e8e76e8b9b 100644--- a/[drivers/usb/gadget/udc/dummy\_hcd.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/usb/gadget/udc/dummy_hcd.c?id=102c4e5869e7464df671e331953e21b297f027b6)+++ b/[drivers/usb/gadget/udc/dummy\_hcd.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/usb/gadget/udc/dummy_hcd.c?id=cf7ee2291da551fc4b109fda1f6a332cb8212065)@@ -254,6 +254,7 @@ struct dummy\_hcd { u32 stream\_en\_ep; u8 num\_stream[30 / 2]; + unsigned timer\_pending:1; unsigned active:1; unsigned old\_active:1; unsigned resuming:1;@@ -1304,9 +1305,11 @@ static int dummy\_urb\_enqueue( urb->error\_count = 1; /\* mark as a new urb \*/  /\* kick the scheduler, it'll do the rest \*/- if (!hrtimer\_active(&dum\_hcd->timer))+ if (!dum\_hcd->timer\_pending) {+ dum\_hcd->timer\_pending = 1; hrtimer\_start(&dum\_hcd->timer, ns\_to\_ktime(DUMMY\_TIMER\_INT\_NSECS), HRTIMER\_MODE\_REL\_SOFT);+ }  done: spin\_unlock\_irqrestore(&dum\_hcd->dum->lock, flags);@@ -1325,9 +1328,10 @@ static int dummy\_urb\_dequeue(struct usb\_hcd \*hcd, struct urb \*urb, int status) spin\_lock\_irqsave(&dum\_hcd->dum->lock, flags);  rc = usb\_hcd\_check\_unlink\_urb(hcd, urb, status);- if (!rc && dum\_hcd->rh\_state != DUMMY\_RH\_RUNNING &&- !list\_empty(&dum\_hcd->urbp\_list))+ if (rc == 0 && !dum\_hcd->timer\_pending) {+ dum\_hcd->timer\_pending = 1; hrtimer\_start(&dum\_hcd->timer, ns\_to\_ktime(0), HRTIMER\_MODE\_REL\_SOFT);+ }  spin\_unlock\_irqrestore(&dum\_hcd->dum->lock, flags); return rc;@@ -1814,6 +1818,7 @@ static enum hrtimer\_restart dummy\_timer(struct hrtimer \*t)  /\* look at each urb queued by the host side driver \*/ spin\_lock\_irqsave(&dum->lock, flags);+ dum\_hcd->timer\_pending = 0;  if (!dum\_hcd->udev) { dev\_err(dummy\_dev(dum\_hcd),@@ -1995,8 +2000,10 @@ return\_urb: if (list\_empty(&dum\_hcd->urbp\_list)) { usb\_put\_dev(dum\_hcd->udev); dum\_hcd->udev = NULL;- } else if (dum\_hcd->rh\_state == DUMMY\_RH\_RUNNING) {+ } else if (!dum\_hcd->timer\_pending &&+ dum\_hcd->rh\_state == DUMMY\_RH\_RUNNING) { /\* want a 1 msec delay here \*/+ dum\_hcd->timer\_pending = 1; hrtimer\_start(&dum\_hcd->timer, ns\_to\_ktime(DUMMY\_TIMER\_INT\_NSECS), HRTIMER\_MODE\_REL\_SOFT); }@@ -2391,8 +2398,10 @@ static int dummy\_bus\_resume(struct usb\_hcd \*hcd) } else { dum\_hcd->rh\_state = DUMMY\_RH\_RUNNING; set\_link\_state(dum\_hcd);- if (!list\_empty(&dum\_hcd->urbp\_list))+ if (!list\_empty(&dum\_hcd->urbp\_list)) {+ dum\_hcd->timer\_pending = 1; hrtimer\_start(&dum\_hcd->timer, ns\_to\_ktime(0), HRTIMER\_MODE\_REL\_SOFT);+ } hcd->state = HC\_STATE\_RUNNING; } spin\_unlock\_irq(&dum\_hcd->dum->lock);@@ -2523,6 +2532,7 @@ static void dummy\_stop(struct usb\_hcd \*hcd) struct dummy\_hcd \*dum\_hcd = hcd\_to\_dummy\_hcd(hcd);  hrtimer\_cancel(&dum\_hcd->timer);+ dum\_hcd->timer\_pending = 0; device\_remove\_file(dummy\_dev(dum\_hcd), &dev\_attr\_urbs); dev\_info(dummy\_dev(dum\_hcd), "stopped\n"); } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 18:29:36 +0000



=== Content from git.kernel.org_1d337abe_20250114_183058.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=7d85884576a3be3616c260fc1fa862a59579d1ab)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=7d85884576a3be3616c260fc1fa862a59579d1ab)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=7d85884576a3be3616c260fc1fa862a59579d1ab)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=7d85884576a3be3616c260fc1fa862a59579d1ab)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Alan Stern <stern@rowland.harvard.edu> | 2024-10-16 11:44:45 -0400 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-11-08 16:28:22 +0100 |
| commit | [7d85884576a3be3616c260fc1fa862a59579d1ab](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=7d85884576a3be3616c260fc1fa862a59579d1ab) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=7d85884576a3be3616c260fc1fa862a59579d1ab)) | |
| tree | [107e466dc369b5fb0250bc8cd84a7774bdb777c0](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=7d85884576a3be3616c260fc1fa862a59579d1ab) | |
| parent | [e028b82aba882bff67c25eff3a53211da4247814](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=e028b82aba882bff67c25eff3a53211da4247814) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=7d85884576a3be3616c260fc1fa862a59579d1ab&id2=e028b82aba882bff67c25eff3a53211da4247814)) | |
| download | [linux-7d85884576a3be3616c260fc1fa862a59579d1ab.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-7d85884576a3be3616c260fc1fa862a59579d1ab.tar.gz) | |

USB: gadget: dummy-hcd: Fix "task hung" problem[ Upstream commit 5189df7b8088268012882c220d6aca4e64981348 ]
The syzbot fuzzer has been encountering "task hung" problems ever
since the dummy-hcd driver was changed to use hrtimers instead of
regular timers. It turns out that the problems are caused by a subtle
difference between the timer\_pending() and hrtimer\_active() APIs.
The changeover blindly replaced the first by the second. However,
timer\_pending() returns True when the timer is queued but not when its
callback is running, whereas hrtimer\_active() returns True when the
hrtimer is queued \_or\_ its callback is running. This difference
occasionally caused dummy\_urb\_enqueue() to think that the callback
routine had not yet started when in fact it was almost finished. As a
result the hrtimer was not restarted, which made it impossible for the
driver to dequeue later the URB that was just enqueued. This caused
usb\_kill\_urb() to hang, and things got worse from there.
Since hrtimers have no API for telling when they are queued and the
callback isn't running, the driver must keep track of this for itself.
That's what this patch does, adding a new "timer\_pending" flag and
setting or clearing it at the appropriate times.
Reported-by: syzbot+f342ea16c9d06d80b585@syzkaller.appspotmail.com
Closes: https://lore.kernel.org/linux-usb/6709234e.050a0220.3e960.0011.GAE@google.com/
Tested-by: syzbot+f342ea16c9d06d80b585@syzkaller.appspotmail.com
Signed-off-by: Alan Stern <stern@rowland.harvard.edu>
Fixes: a7f3813e589f ("usb: gadget: dummy\_hcd: Switch to hrtimer transfer scheduler")
Cc: Marcello Sylvester Bauer <sylv@sylv.io>
Cc: stable@vger.kernel.org
Link: [https://lore.kernel.org/r/2dab644e-ef87-4de8-ac9a-26f100b2c609@rowland.harvard.edu](https://lore.kernel.org/r/2dab644e-ef87-4de8-ac9a-26f100b2c609%40rowland.harvard.edu)
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=7d85884576a3be3616c260fc1fa862a59579d1ab)

| -rw-r--r-- | [drivers/usb/gadget/udc/dummy\_hcd.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/usb/gadget/udc/dummy_hcd.c?id=7d85884576a3be3616c260fc1fa862a59579d1ab) | 20 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 15 insertions, 5 deletions

| diff --git a/drivers/usb/gadget/udc/dummy\_hcd.c b/drivers/usb/gadget/udc/dummy\_hcd.cindex ff7bee78bcc492..d5d89fadde433f 100644--- a/[drivers/usb/gadget/udc/dummy\_hcd.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/usb/gadget/udc/dummy_hcd.c?id=e028b82aba882bff67c25eff3a53211da4247814)+++ b/[drivers/usb/gadget/udc/dummy\_hcd.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/usb/gadget/udc/dummy_hcd.c?id=7d85884576a3be3616c260fc1fa862a59579d1ab)@@ -254,6 +254,7 @@ struct dummy\_hcd { u32 stream\_en\_ep; u8 num\_stream[30 / 2]; + unsigned timer\_pending:1; unsigned active:1; unsigned old\_active:1; unsigned resuming:1;@@ -1303,9 +1304,11 @@ static int dummy\_urb\_enqueue( urb->error\_count = 1; /\* mark as a new urb \*/  /\* kick the scheduler, it'll do the rest \*/- if (!hrtimer\_active(&dum\_hcd->timer))+ if (!dum\_hcd->timer\_pending) {+ dum\_hcd->timer\_pending = 1; hrtimer\_start(&dum\_hcd->timer, ns\_to\_ktime(DUMMY\_TIMER\_INT\_NSECS), HRTIMER\_MODE\_REL\_SOFT);+ }  done: spin\_unlock\_irqrestore(&dum\_hcd->dum->lock, flags);@@ -1324,9 +1327,10 @@ static int dummy\_urb\_dequeue(struct usb\_hcd \*hcd, struct urb \*urb, int status) spin\_lock\_irqsave(&dum\_hcd->dum->lock, flags);  rc = usb\_hcd\_check\_unlink\_urb(hcd, urb, status);- if (!rc && dum\_hcd->rh\_state != DUMMY\_RH\_RUNNING &&- !list\_empty(&dum\_hcd->urbp\_list))+ if (rc == 0 && !dum\_hcd->timer\_pending) {+ dum\_hcd->timer\_pending = 1; hrtimer\_start(&dum\_hcd->timer, ns\_to\_ktime(0), HRTIMER\_MODE\_REL\_SOFT);+ }  spin\_unlock\_irqrestore(&dum\_hcd->dum->lock, flags); return rc;@@ -1813,6 +1817,7 @@ static enum hrtimer\_restart dummy\_timer(struct hrtimer \*t)  /\* look at each urb queued by the host side driver \*/ spin\_lock\_irqsave(&dum->lock, flags);+ dum\_hcd->timer\_pending = 0;  if (!dum\_hcd->udev) { dev\_err(dummy\_dev(dum\_hcd),@@ -1994,8 +1999,10 @@ return\_urb: if (list\_empty(&dum\_hcd->urbp\_list)) { usb\_put\_dev(dum\_hcd->udev); dum\_hcd->udev = NULL;- } else if (dum\_hcd->rh\_state == DUMMY\_RH\_RUNNING) {+ } else if (!dum\_hcd->timer\_pending &&+ dum\_hcd->rh\_state == DUMMY\_RH\_RUNNING) { /\* want a 1 msec delay here \*/+ dum\_hcd->timer\_pending = 1; hrtimer\_start(&dum\_hcd->timer, ns\_to\_ktime(DUMMY\_TIMER\_INT\_NSECS), HRTIMER\_MODE\_REL\_SOFT); }@@ -2390,8 +2397,10 @@ static int dummy\_bus\_resume(struct usb\_hcd \*hcd) } else { dum\_hcd->rh\_state = DUMMY\_RH\_RUNNING; set\_link\_state(dum\_hcd);- if (!list\_empty(&dum\_hcd->urbp\_list))+ if (!list\_empty(&dum\_hcd->urbp\_list)) {+ dum\_hcd->timer\_pending = 1; hrtimer\_start(&dum\_hcd->timer, ns\_to\_ktime(0), HRTIMER\_MODE\_REL\_SOFT);+ } hcd->state = HC\_STATE\_RUNNING; } spin\_unlock\_irq(&dum\_hcd->dum->lock);@@ -2522,6 +2531,7 @@ static void dummy\_stop(struct usb\_hcd \*hcd) struct dummy\_hcd \*dum\_hcd = hcd\_to\_dummy\_hcd(hcd);  hrtimer\_cancel(&dum\_hcd->timer);+ dum\_hcd->timer\_pending = 0; device\_remove\_file(dummy\_dev(dum\_hcd), &dev\_attr\_urbs); dev\_info(dummy\_dev(dum\_hcd), "stopped\n"); } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 18:29:35 +0000



=== Content from git.kernel.org_cc052c35_20250114_183059.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=f828205ee3e4ddc712a13fba6c9902d51e91ddaf)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=f828205ee3e4ddc712a13fba6c9902d51e91ddaf)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=f828205ee3e4ddc712a13fba6c9902d51e91ddaf)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=f828205ee3e4ddc712a13fba6c9902d51e91ddaf)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Alan Stern <stern@rowland.harvard.edu> | 2024-10-16 11:44:45 -0400 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-10-22 15:51:33 +0200 |
| commit | [f828205ee3e4ddc712a13fba6c9902d51e91ddaf](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=f828205ee3e4ddc712a13fba6c9902d51e91ddaf) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=f828205ee3e4ddc712a13fba6c9902d51e91ddaf)) | |
| tree | [f1964eade60c846290b5da24cefe3f1e89af4866](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=f828205ee3e4ddc712a13fba6c9902d51e91ddaf) | |
| parent | [40ca0037b43ec87e181c895fa2ec97d44b3c85c3](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=40ca0037b43ec87e181c895fa2ec97d44b3c85c3) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=f828205ee3e4ddc712a13fba6c9902d51e91ddaf&id2=40ca0037b43ec87e181c895fa2ec97d44b3c85c3)) | |
| download | [linux-f828205ee3e4ddc712a13fba6c9902d51e91ddaf.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-f828205ee3e4ddc712a13fba6c9902d51e91ddaf.tar.gz) | |

USB: gadget: dummy-hcd: Fix "task hung" problemcommit 5189df7b8088268012882c220d6aca4e64981348 upstream.
The syzbot fuzzer has been encountering "task hung" problems ever
since the dummy-hcd driver was changed to use hrtimers instead of
regular timers. It turns out that the problems are caused by a subtle
difference between the timer\_pending() and hrtimer\_active() APIs.
The changeover blindly replaced the first by the second. However,
timer\_pending() returns True when the timer is queued but not when its
callback is running, whereas hrtimer\_active() returns True when the
hrtimer is queued \_or\_ its callback is running. This difference
occasionally caused dummy\_urb\_enqueue() to think that the callback
routine had not yet started when in fact it was almost finished. As a
result the hrtimer was not restarted, which made it impossible for the
driver to dequeue later the URB that was just enqueued. This caused
usb\_kill\_urb() to hang, and things got worse from there.
Since hrtimers have no API for telling when they are queued and the
callback isn't running, the driver must keep track of this for itself.
That's what this patch does, adding a new "timer\_pending" flag and
setting or clearing it at the appropriate times.
Reported-by: syzbot+f342ea16c9d06d80b585@syzkaller.appspotmail.com
Closes: https://lore.kernel.org/linux-usb/6709234e.050a0220.3e960.0011.GAE@google.com/
Tested-by: syzbot+f342ea16c9d06d80b585@syzkaller.appspotmail.com
Signed-off-by: Alan Stern <stern@rowland.harvard.edu>
Fixes: a7f3813e589f ("usb: gadget: dummy\_hcd: Switch to hrtimer transfer scheduler")
Cc: Marcello Sylvester Bauer <sylv@sylv.io>
Cc: stable@vger.kernel.org
Link: [https://lore.kernel.org/r/2dab644e-ef87-4de8-ac9a-26f100b2c609@rowland.harvard.edu](https://lore.kernel.org/r/2dab644e-ef87-4de8-ac9a-26f100b2c609%40rowland.harvard.edu)
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=f828205ee3e4ddc712a13fba6c9902d51e91ddaf)

| -rw-r--r-- | [drivers/usb/gadget/udc/dummy\_hcd.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/usb/gadget/udc/dummy_hcd.c?id=f828205ee3e4ddc712a13fba6c9902d51e91ddaf) | 20 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 15 insertions, 5 deletions

| diff --git a/drivers/usb/gadget/udc/dummy\_hcd.c b/drivers/usb/gadget/udc/dummy\_hcd.cindex ff7bee78bcc492..d5d89fadde433f 100644--- a/[drivers/usb/gadget/udc/dummy\_hcd.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/usb/gadget/udc/dummy_hcd.c?id=40ca0037b43ec87e181c895fa2ec97d44b3c85c3)+++ b/[drivers/usb/gadget/udc/dummy\_hcd.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/usb/gadget/udc/dummy_hcd.c?id=f828205ee3e4ddc712a13fba6c9902d51e91ddaf)@@ -254,6 +254,7 @@ struct dummy\_hcd { u32 stream\_en\_ep; u8 num\_stream[30 / 2]; + unsigned timer\_pending:1; unsigned active:1; unsigned old\_active:1; unsigned resuming:1;@@ -1303,9 +1304,11 @@ static int dummy\_urb\_enqueue( urb->error\_count = 1; /\* mark as a new urb \*/  /\* kick the scheduler, it'll do the rest \*/- if (!hrtimer\_active(&dum\_hcd->timer))+ if (!dum\_hcd->timer\_pending) {+ dum\_hcd->timer\_pending = 1; hrtimer\_start(&dum\_hcd->timer, ns\_to\_ktime(DUMMY\_TIMER\_INT\_NSECS), HRTIMER\_MODE\_REL\_SOFT);+ }  done: spin\_unlock\_irqrestore(&dum\_hcd->dum->lock, flags);@@ -1324,9 +1327,10 @@ static int dummy\_urb\_dequeue(struct usb\_hcd \*hcd, struct urb \*urb, int status) spin\_lock\_irqsave(&dum\_hcd->dum->lock, flags);  rc = usb\_hcd\_check\_unlink\_urb(hcd, urb, status);- if (!rc && dum\_hcd->rh\_state != DUMMY\_RH\_RUNNING &&- !list\_empty(&dum\_hcd->urbp\_list))+ if (rc == 0 && !dum\_hcd->timer\_pending) {+ dum\_hcd->timer\_pending = 1; hrtimer\_start(&dum\_hcd->timer, ns\_to\_ktime(0), HRTIMER\_MODE\_REL\_SOFT);+ }  spin\_unlock\_irqrestore(&dum\_hcd->dum->lock, flags); return rc;@@ -1813,6 +1817,7 @@ static enum hrtimer\_restart dummy\_timer(struct hrtimer \*t)  /\* look at each urb queued by the host side driver \*/ spin\_lock\_irqsave(&dum->lock, flags);+ dum\_hcd->timer\_pending = 0;  if (!dum\_hcd->udev) { dev\_err(dummy\_dev(dum\_hcd),@@ -1994,8 +1999,10 @@ return\_urb: if (list\_empty(&dum\_hcd->urbp\_list)) { usb\_put\_dev(dum\_hcd->udev); dum\_hcd->udev = NULL;- } else if (dum\_hcd->rh\_state == DUMMY\_RH\_RUNNING) {+ } else if (!dum\_hcd->timer\_pending &&+ dum\_hcd->rh\_state == DUMMY\_RH\_RUNNING) { /\* want a 1 msec delay here \*/+ dum\_hcd->timer\_pending = 1; hrtimer\_start(&dum\_hcd->timer, ns\_to\_ktime(DUMMY\_TIMER\_INT\_NSECS), HRTIMER\_MODE\_REL\_SOFT); }@@ -2390,8 +2397,10 @@ static int dummy\_bus\_resume(struct usb\_hcd \*hcd) } else { dum\_hcd->rh\_state = DUMMY\_RH\_RUNNING; set\_link\_state(dum\_hcd);- if (!list\_empty(&dum\_hcd->urbp\_list))+ if (!list\_empty(&dum\_hcd->urbp\_list)) {+ dum\_hcd->timer\_pending = 1; hrtimer\_start(&dum\_hcd->timer, ns\_to\_ktime(0), HRTIMER\_MODE\_REL\_SOFT);+ } hcd->state = HC\_STATE\_RUNNING; } spin\_unlock\_irq(&dum\_hcd->dum->lock);@@ -2522,6 +2531,7 @@ static void dummy\_stop(struct usb\_hcd \*hcd) struct dummy\_hcd \*dum\_hcd = hcd\_to\_dummy\_hcd(hcd);  hrtimer\_cancel(&dum\_hcd->timer);+ dum\_hcd->timer\_pending = 0; device\_remove\_file(dummy\_dev(dum\_hcd), &dev\_attr\_urbs); dev\_info(dummy\_dev(dum\_hcd), "stopped\n"); } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 18:29:37 +0000



=== Content from git.kernel.org_30a2b3b0_20250114_183058.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=5189df7b8088268012882c220d6aca4e64981348)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=5189df7b8088268012882c220d6aca4e64981348)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=5189df7b8088268012882c220d6aca4e64981348)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=5189df7b8088268012882c220d6aca4e64981348)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Alan Stern <stern@rowland.harvard.edu> | 2024-10-16 11:44:45 -0400 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-10-17 08:45:10 +0200 |
| commit | [5189df7b8088268012882c220d6aca4e64981348](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=5189df7b8088268012882c220d6aca4e64981348) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=5189df7b8088268012882c220d6aca4e64981348)) | |
| tree | [fe09b305984187e56ab107fa876538aeddf4e15f](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=5189df7b8088268012882c220d6aca4e64981348) | |
| parent | [9499327714de7bc5cf6c792112c1474932d8ad31](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=9499327714de7bc5cf6c792112c1474932d8ad31) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=5189df7b8088268012882c220d6aca4e64981348&id2=9499327714de7bc5cf6c792112c1474932d8ad31)) | |
| download | [linux-5189df7b8088268012882c220d6aca4e64981348.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-5189df7b8088268012882c220d6aca4e64981348.tar.gz) | |

USB: gadget: dummy-hcd: Fix "task hung" problemThe syzbot fuzzer has been encountering "task hung" problems ever
since the dummy-hcd driver was changed to use hrtimers instead of
regular timers. It turns out that the problems are caused by a subtle
difference between the timer\_pending() and hrtimer\_active() APIs.
The changeover blindly replaced the first by the second. However,
timer\_pending() returns True when the timer is queued but not when its
callback is running, whereas hrtimer\_active() returns True when the
hrtimer is queued \_or\_ its callback is running. This difference
occasionally caused dummy\_urb\_enqueue() to think that the callback
routine had not yet started when in fact it was almost finished. As a
result the hrtimer was not restarted, which made it impossible for the
driver to dequeue later the URB that was just enqueued. This caused
usb\_kill\_urb() to hang, and things got worse from there.
Since hrtimers have no API for telling when they are queued and the
callback isn't running, the driver must keep track of this for itself.
That's what this patch does, adding a new "timer\_pending" flag and
setting or clearing it at the appropriate times.
Reported-by: syzbot+f342ea16c9d06d80b585@syzkaller.appspotmail.com
Closes: https://lore.kernel.org/linux-usb/6709234e.050a0220.3e960.0011.GAE@google.com/
Tested-by: syzbot+f342ea16c9d06d80b585@syzkaller.appspotmail.com
Signed-off-by: Alan Stern <stern@rowland.harvard.edu>
Fixes: a7f3813e589f ("usb: gadget: dummy\_hcd: Switch to hrtimer transfer scheduler")
Cc: Marcello Sylvester Bauer <sylv@sylv.io>
Cc: stable@vger.kernel.org
Link: [https://lore.kernel.org/r/2dab644e-ef87-4de8-ac9a-26f100b2c609@rowland.harvard.edu](https://lore.kernel.org/r/2dab644e-ef87-4de8-ac9a-26f100b2c609%40rowland.harvard.edu)
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=5189df7b8088268012882c220d6aca4e64981348)

| -rw-r--r-- | [drivers/usb/gadget/udc/dummy\_hcd.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/usb/gadget/udc/dummy_hcd.c?id=5189df7b8088268012882c220d6aca4e64981348) | 20 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 15 insertions, 5 deletions

| diff --git a/drivers/usb/gadget/udc/dummy\_hcd.c b/drivers/usb/gadget/udc/dummy\_hcd.cindex 8820d992444882..081ac7683c0b35 100644--- a/[drivers/usb/gadget/udc/dummy\_hcd.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/usb/gadget/udc/dummy_hcd.c?id=9499327714de7bc5cf6c792112c1474932d8ad31)+++ b/[drivers/usb/gadget/udc/dummy\_hcd.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/usb/gadget/udc/dummy_hcd.c?id=5189df7b8088268012882c220d6aca4e64981348)@@ -254,6 +254,7 @@ struct dummy\_hcd { u32 stream\_en\_ep; u8 num\_stream[30 / 2]; + unsigned timer\_pending:1; unsigned active:1; unsigned old\_active:1; unsigned resuming:1;@@ -1303,9 +1304,11 @@ static int dummy\_urb\_enqueue( urb->error\_count = 1; /\* mark as a new urb \*/  /\* kick the scheduler, it'll do the rest \*/- if (!hrtimer\_active(&dum\_hcd->timer))+ if (!dum\_hcd->timer\_pending) {+ dum\_hcd->timer\_pending = 1; hrtimer\_start(&dum\_hcd->timer, ns\_to\_ktime(DUMMY\_TIMER\_INT\_NSECS), HRTIMER\_MODE\_REL\_SOFT);+ }  done: spin\_unlock\_irqrestore(&dum\_hcd->dum->lock, flags);@@ -1324,9 +1327,10 @@ static int dummy\_urb\_dequeue(struct usb\_hcd \*hcd, struct urb \*urb, int status) spin\_lock\_irqsave(&dum\_hcd->dum->lock, flags);  rc = usb\_hcd\_check\_unlink\_urb(hcd, urb, status);- if (!rc && dum\_hcd->rh\_state != DUMMY\_RH\_RUNNING &&- !list\_empty(&dum\_hcd->urbp\_list))+ if (rc == 0 && !dum\_hcd->timer\_pending) {+ dum\_hcd->timer\_pending = 1; hrtimer\_start(&dum\_hcd->timer, ns\_to\_ktime(0), HRTIMER\_MODE\_REL\_SOFT);+ }  spin\_unlock\_irqrestore(&dum\_hcd->dum->lock, flags); return rc;@@ -1813,6 +1817,7 @@ static enum hrtimer\_restart dummy\_timer(struct hrtimer \*t)  /\* look at each urb queued by the host side driver \*/ spin\_lock\_irqsave(&dum->lock, flags);+ dum\_hcd->timer\_pending = 0;  if (!dum\_hcd->udev) { dev\_err(dummy\_dev(dum\_hcd),@@ -1994,8 +1999,10 @@ return\_urb: if (list\_empty(&dum\_hcd->urbp\_list)) { usb\_put\_dev(dum\_hcd->udev); dum\_hcd->udev = NULL;- } else if (dum\_hcd->rh\_state == DUMMY\_RH\_RUNNING) {+ } else if (!dum\_hcd->timer\_pending &&+ dum\_hcd->rh\_state == DUMMY\_RH\_RUNNING) { /\* want a 1 msec delay here \*/+ dum\_hcd->timer\_pending = 1; hrtimer\_start(&dum\_hcd->timer, ns\_to\_ktime(DUMMY\_TIMER\_INT\_NSECS), HRTIMER\_MODE\_REL\_SOFT); }@@ -2390,8 +2397,10 @@ static int dummy\_bus\_resume(struct usb\_hcd \*hcd) } else { dum\_hcd->rh\_state = DUMMY\_RH\_RUNNING; set\_link\_state(dum\_hcd);- if (!list\_empty(&dum\_hcd->urbp\_list))+ if (!list\_empty(&dum\_hcd->urbp\_list)) {+ dum\_hcd->timer\_pending = 1; hrtimer\_start(&dum\_hcd->timer, ns\_to\_ktime(0), HRTIMER\_MODE\_REL\_SOFT);+ } hcd->state = HC\_STATE\_RUNNING; } spin\_unlock\_irq(&dum\_hcd->dum->lock);@@ -2522,6 +2531,7 @@ static void dummy\_stop(struct usb\_hcd \*hcd) struct dummy\_hcd \*dum\_hcd = hcd\_to\_dummy\_hcd(hcd);  hrtimer\_cancel(&dum\_hcd->timer);+ dum\_hcd->timer\_pending = 0; device\_remove\_file(dummy\_dev(dum\_hcd), &dev\_attr\_urbs); dev\_info(dummy\_dev(dum\_hcd), "stopped\n"); } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 18:29:35 +0000


