=== Content from git.kernel.org_29ec922f_20250114_221530.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=b677b94a9193ec7b6607bd1255172ae59174a382)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=b677b94a9193ec7b6607bd1255172ae59174a382)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=b677b94a9193ec7b6607bd1255172ae59174a382)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b677b94a9193ec7b6607bd1255172ae59174a382)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Peng Fan <peng.fan@nxp.com> | 2024-06-07 21:33:39 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-10-17 15:08:31 +0200 |
| commit | [b677b94a9193ec7b6607bd1255172ae59174a382](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=b677b94a9193ec7b6607bd1255172ae59174a382) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=b677b94a9193ec7b6607bd1255172ae59174a382)) | |
| tree | [b516fc9063c5a578b9c0dd576bcddb14ae788dc5](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=b677b94a9193ec7b6607bd1255172ae59174a382) | |
| parent | [37c181e389f02330ce10f35a39915e179e8267ef](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=37c181e389f02330ce10f35a39915e179e8267ef) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b677b94a9193ec7b6607bd1255172ae59174a382&id2=37c181e389f02330ce10f35a39915e179e8267ef)) | |
| download | [linux-b677b94a9193ec7b6607bd1255172ae59174a382.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-b677b94a9193ec7b6607bd1255172ae59174a382.tar.gz) | |

clk: imx: Remove CLK\_SET\_PARENT\_GATE for DRAM mux for i.MX7D[ Upstream commit a54c441b46a0745683c2eef5a359d22856d27323 ]
For i.MX7D DRAM related mux clock, the clock source change should ONLY
be done done in low level asm code without accessing DRAM, and then
calling clk API to sync the HW clock status with clk tree, it should never
touch real clock source switch via clk API, so CLK\_SET\_PARENT\_GATE flag
should NOT be added, otherwise, DRAM's clock parent will be disabled when
DRAM is active, and system will hang.
Signed-off-by: Peng Fan <peng.fan@nxp.com>
Reviewed-by: Abel Vesa <abel.vesa@linaro.org>
Link: [https://lore.kernel.org/r/20240607133347.3291040-8-peng.fan@oss.nxp.com](https://lore.kernel.org/r/20240607133347.3291040-8-peng.fan%40oss.nxp.com)
Signed-off-by: Abel Vesa <abel.vesa@linaro.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b677b94a9193ec7b6607bd1255172ae59174a382)

| -rw-r--r-- | [drivers/clk/imx/clk-imx7d.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/clk/imx/clk-imx7d.c?id=b677b94a9193ec7b6607bd1255172ae59174a382) | 4 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 2 insertions, 2 deletions

| diff --git a/drivers/clk/imx/clk-imx7d.c b/drivers/clk/imx/clk-imx7d.cindex 3f6fd7ef2a68fc..0e68e5f2d7e7da 100644--- a/[drivers/clk/imx/clk-imx7d.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/clk/imx/clk-imx7d.c?id=37c181e389f02330ce10f35a39915e179e8267ef)+++ b/[drivers/clk/imx/clk-imx7d.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/clk/imx/clk-imx7d.c?id=b677b94a9193ec7b6607bd1255172ae59174a382)@@ -498,9 +498,9 @@ static void \_\_init imx7d\_clocks\_init(struct device\_node \*ccm\_node) hws[IMX7D\_ENET\_AXI\_ROOT\_SRC] = imx\_clk\_hw\_mux2\_flags("enet\_axi\_src", base + 0x8900, 24, 3, enet\_axi\_sel, ARRAY\_SIZE(enet\_axi\_sel), CLK\_SET\_PARENT\_GATE); hws[IMX7D\_NAND\_USDHC\_BUS\_ROOT\_SRC] = imx\_clk\_hw\_mux2\_flags("nand\_usdhc\_src", base + 0x8980, 24, 3, nand\_usdhc\_bus\_sel, ARRAY\_SIZE(nand\_usdhc\_bus\_sel), CLK\_SET\_PARENT\_GATE); hws[IMX7D\_DRAM\_PHYM\_ROOT\_SRC] = imx\_clk\_hw\_mux2\_flags("dram\_phym\_src", base + 0x9800, 24, 1, dram\_phym\_sel, ARRAY\_SIZE(dram\_phym\_sel), CLK\_SET\_PARENT\_GATE);- hws[IMX7D\_DRAM\_ROOT\_SRC] = imx\_clk\_hw\_mux2\_flags("dram\_src", base + 0x9880, 24, 1, dram\_sel, ARRAY\_SIZE(dram\_sel), CLK\_SET\_PARENT\_GATE);+ hws[IMX7D\_DRAM\_ROOT\_SRC] = imx\_clk\_hw\_mux2("dram\_src", base + 0x9880, 24, 1, dram\_sel, ARRAY\_SIZE(dram\_sel)); hws[IMX7D\_DRAM\_PHYM\_ALT\_ROOT\_SRC] = imx\_clk\_hw\_mux2\_flags("dram\_phym\_alt\_src", base + 0xa000, 24, 3, dram\_phym\_alt\_sel, ARRAY\_SIZE(dram\_phym\_alt\_sel), CLK\_SET\_PARENT\_GATE);- hws[IMX7D\_DRAM\_ALT\_ROOT\_SRC] = imx\_clk\_hw\_mux2\_flags("dram\_alt\_src", base + 0xa080, 24, 3, dram\_alt\_sel, ARRAY\_SIZE(dram\_alt\_sel), CLK\_SET\_PARENT\_GATE);+ hws[IMX7D\_DRAM\_ALT\_ROOT\_SRC] = imx\_clk\_hw\_mux2("dram\_alt\_src", base + 0xa080, 24, 3, dram\_alt\_sel, ARRAY\_SIZE(dram\_alt\_sel)); hws[IMX7D\_USB\_HSIC\_ROOT\_SRC] = imx\_clk\_hw\_mux2\_flags("usb\_hsic\_src", base + 0xa100, 24, 3, usb\_hsic\_sel, ARRAY\_SIZE(usb\_hsic\_sel), CLK\_SET\_PARENT\_GATE); hws[IMX7D\_PCIE\_CTRL\_ROOT\_SRC] = imx\_clk\_hw\_mux2\_flags("pcie\_ctrl\_src", base + 0xa180, 24, 3, pcie\_ctrl\_sel, ARRAY\_SIZE(pcie\_ctrl\_sel), CLK\_SET\_PARENT\_GATE); hws[IMX7D\_PCIE\_PHY\_ROOT\_SRC] = imx\_clk\_hw\_mux2\_flags("pcie\_phy\_src", base + 0xa200, 24, 3, pcie\_phy\_sel, ARRAY\_SIZE(pcie\_phy\_sel), CLK\_SET\_PARENT\_GATE); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 22:14:07 +0000



=== Content from git.kernel.org_038b0354_20250114_221529.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=94f6cdc837e38371324cee97dfd2ef1a99a82c98)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=94f6cdc837e38371324cee97dfd2ef1a99a82c98)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=94f6cdc837e38371324cee97dfd2ef1a99a82c98)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=94f6cdc837e38371324cee97dfd2ef1a99a82c98)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Peng Fan <peng.fan@nxp.com> | 2024-06-07 21:33:39 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-10-17 15:26:38 +0200 |
| commit | [94f6cdc837e38371324cee97dfd2ef1a99a82c98](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=94f6cdc837e38371324cee97dfd2ef1a99a82c98) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=94f6cdc837e38371324cee97dfd2ef1a99a82c98)) | |
| tree | [0c8d71195ef0aa2e47a121208ef3fb733604d2c8](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=94f6cdc837e38371324cee97dfd2ef1a99a82c98) | |
| parent | [3d131f138e092c414c69860f2c897c59d660da99](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=3d131f138e092c414c69860f2c897c59d660da99) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=94f6cdc837e38371324cee97dfd2ef1a99a82c98&id2=3d131f138e092c414c69860f2c897c59d660da99)) | |
| download | [linux-94f6cdc837e38371324cee97dfd2ef1a99a82c98.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-94f6cdc837e38371324cee97dfd2ef1a99a82c98.tar.gz) | |

clk: imx: Remove CLK\_SET\_PARENT\_GATE for DRAM mux for i.MX7D[ Upstream commit a54c441b46a0745683c2eef5a359d22856d27323 ]
For i.MX7D DRAM related mux clock, the clock source change should ONLY
be done done in low level asm code without accessing DRAM, and then
calling clk API to sync the HW clock status with clk tree, it should never
touch real clock source switch via clk API, so CLK\_SET\_PARENT\_GATE flag
should NOT be added, otherwise, DRAM's clock parent will be disabled when
DRAM is active, and system will hang.
Signed-off-by: Peng Fan <peng.fan@nxp.com>
Reviewed-by: Abel Vesa <abel.vesa@linaro.org>
Link: [https://lore.kernel.org/r/20240607133347.3291040-8-peng.fan@oss.nxp.com](https://lore.kernel.org/r/20240607133347.3291040-8-peng.fan%40oss.nxp.com)
Signed-off-by: Abel Vesa <abel.vesa@linaro.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=94f6cdc837e38371324cee97dfd2ef1a99a82c98)

| -rw-r--r-- | [drivers/clk/imx/clk-imx7d.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/clk/imx/clk-imx7d.c?id=94f6cdc837e38371324cee97dfd2ef1a99a82c98) | 4 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 2 insertions, 2 deletions

| diff --git a/drivers/clk/imx/clk-imx7d.c b/drivers/clk/imx/clk-imx7d.cindex 2b77d1fc7bb946..1e1296e748357b 100644--- a/[drivers/clk/imx/clk-imx7d.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/clk/imx/clk-imx7d.c?id=3d131f138e092c414c69860f2c897c59d660da99)+++ b/[drivers/clk/imx/clk-imx7d.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/clk/imx/clk-imx7d.c?id=94f6cdc837e38371324cee97dfd2ef1a99a82c98)@@ -498,9 +498,9 @@ static void \_\_init imx7d\_clocks\_init(struct device\_node \*ccm\_node) hws[IMX7D\_ENET\_AXI\_ROOT\_SRC] = imx\_clk\_hw\_mux2\_flags("enet\_axi\_src", base + 0x8900, 24, 3, enet\_axi\_sel, ARRAY\_SIZE(enet\_axi\_sel), CLK\_SET\_PARENT\_GATE); hws[IMX7D\_NAND\_USDHC\_BUS\_ROOT\_SRC] = imx\_clk\_hw\_mux2\_flags("nand\_usdhc\_src", base + 0x8980, 24, 3, nand\_usdhc\_bus\_sel, ARRAY\_SIZE(nand\_usdhc\_bus\_sel), CLK\_SET\_PARENT\_GATE); hws[IMX7D\_DRAM\_PHYM\_ROOT\_SRC] = imx\_clk\_hw\_mux2\_flags("dram\_phym\_src", base + 0x9800, 24, 1, dram\_phym\_sel, ARRAY\_SIZE(dram\_phym\_sel), CLK\_SET\_PARENT\_GATE);- hws[IMX7D\_DRAM\_ROOT\_SRC] = imx\_clk\_hw\_mux2\_flags("dram\_src", base + 0x9880, 24, 1, dram\_sel, ARRAY\_SIZE(dram\_sel), CLK\_SET\_PARENT\_GATE);+ hws[IMX7D\_DRAM\_ROOT\_SRC] = imx\_clk\_hw\_mux2("dram\_src", base + 0x9880, 24, 1, dram\_sel, ARRAY\_SIZE(dram\_sel)); hws[IMX7D\_DRAM\_PHYM\_ALT\_ROOT\_SRC] = imx\_clk\_hw\_mux2\_flags("dram\_phym\_alt\_src", base + 0xa000, 24, 3, dram\_phym\_alt\_sel, ARRAY\_SIZE(dram\_phym\_alt\_sel), CLK\_SET\_PARENT\_GATE);- hws[IMX7D\_DRAM\_ALT\_ROOT\_SRC] = imx\_clk\_hw\_mux2\_flags("dram\_alt\_src", base + 0xa080, 24, 3, dram\_alt\_sel, ARRAY\_SIZE(dram\_alt\_sel), CLK\_SET\_PARENT\_GATE);+ hws[IMX7D\_DRAM\_ALT\_ROOT\_SRC] = imx\_clk\_hw\_mux2("dram\_alt\_src", base + 0xa080, 24, 3, dram\_alt\_sel, ARRAY\_SIZE(dram\_alt\_sel)); hws[IMX7D\_USB\_HSIC\_ROOT\_SRC] = imx\_clk\_hw\_mux2\_flags("usb\_hsic\_src", base + 0xa100, 24, 3, usb\_hsic\_sel, ARRAY\_SIZE(usb\_hsic\_sel), CLK\_SET\_PARENT\_GATE); hws[IMX7D\_PCIE\_CTRL\_ROOT\_SRC] = imx\_clk\_hw\_mux2\_flags("pcie\_ctrl\_src", base + 0xa180, 24, 3, pcie\_ctrl\_sel, ARRAY\_SIZE(pcie\_ctrl\_sel), CLK\_SET\_PARENT\_GATE); hws[IMX7D\_PCIE\_PHY\_ROOT\_SRC] = imx\_clk\_hw\_mux2\_flags("pcie\_phy\_src", base + 0xa200, 24, 3, pcie\_phy\_sel, ARRAY\_SIZE(pcie\_phy\_sel), CLK\_SET\_PARENT\_GATE); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 22:14:06 +0000



=== Content from git.kernel.org_3ad9066a_20250114_221531.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=d18dc8e14b9c794f58dae1577ccb2ab84a4a1b11)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=d18dc8e14b9c794f58dae1577ccb2ab84a4a1b11)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=d18dc8e14b9c794f58dae1577ccb2ab84a4a1b11)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=d18dc8e14b9c794f58dae1577ccb2ab84a4a1b11)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Peng Fan <peng.fan@nxp.com> | 2024-06-07 21:33:39 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-10-17 15:11:52 +0200 |
| commit | [d18dc8e14b9c794f58dae1577ccb2ab84a4a1b11](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=d18dc8e14b9c794f58dae1577ccb2ab84a4a1b11) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=d18dc8e14b9c794f58dae1577ccb2ab84a4a1b11)) | |
| tree | [e40db29d2bb204d91b53cc2b7771b6c3a1124822](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=d18dc8e14b9c794f58dae1577ccb2ab84a4a1b11) | |
| parent | [64f2ca5ce97111a364a18c31772eb46c79e8b772](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=64f2ca5ce97111a364a18c31772eb46c79e8b772) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=d18dc8e14b9c794f58dae1577ccb2ab84a4a1b11&id2=64f2ca5ce97111a364a18c31772eb46c79e8b772)) | |
| download | [linux-d18dc8e14b9c794f58dae1577ccb2ab84a4a1b11.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-d18dc8e14b9c794f58dae1577ccb2ab84a4a1b11.tar.gz) | |

clk: imx: Remove CLK\_SET\_PARENT\_GATE for DRAM mux for i.MX7D[ Upstream commit a54c441b46a0745683c2eef5a359d22856d27323 ]
For i.MX7D DRAM related mux clock, the clock source change should ONLY
be done done in low level asm code without accessing DRAM, and then
calling clk API to sync the HW clock status with clk tree, it should never
touch real clock source switch via clk API, so CLK\_SET\_PARENT\_GATE flag
should NOT be added, otherwise, DRAM's clock parent will be disabled when
DRAM is active, and system will hang.
Signed-off-by: Peng Fan <peng.fan@nxp.com>
Reviewed-by: Abel Vesa <abel.vesa@linaro.org>
Link: [https://lore.kernel.org/r/20240607133347.3291040-8-peng.fan@oss.nxp.com](https://lore.kernel.org/r/20240607133347.3291040-8-peng.fan%40oss.nxp.com)
Signed-off-by: Abel Vesa <abel.vesa@linaro.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=d18dc8e14b9c794f58dae1577ccb2ab84a4a1b11)

| -rw-r--r-- | [drivers/clk/imx/clk-imx7d.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/clk/imx/clk-imx7d.c?id=d18dc8e14b9c794f58dae1577ccb2ab84a4a1b11) | 4 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 2 insertions, 2 deletions

| diff --git a/drivers/clk/imx/clk-imx7d.c b/drivers/clk/imx/clk-imx7d.cindex 3f6fd7ef2a68fc..0e68e5f2d7e7da 100644--- a/[drivers/clk/imx/clk-imx7d.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/clk/imx/clk-imx7d.c?id=64f2ca5ce97111a364a18c31772eb46c79e8b772)+++ b/[drivers/clk/imx/clk-imx7d.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/clk/imx/clk-imx7d.c?id=d18dc8e14b9c794f58dae1577ccb2ab84a4a1b11)@@ -498,9 +498,9 @@ static void \_\_init imx7d\_clocks\_init(struct device\_node \*ccm\_node) hws[IMX7D\_ENET\_AXI\_ROOT\_SRC] = imx\_clk\_hw\_mux2\_flags("enet\_axi\_src", base + 0x8900, 24, 3, enet\_axi\_sel, ARRAY\_SIZE(enet\_axi\_sel), CLK\_SET\_PARENT\_GATE); hws[IMX7D\_NAND\_USDHC\_BUS\_ROOT\_SRC] = imx\_clk\_hw\_mux2\_flags("nand\_usdhc\_src", base + 0x8980, 24, 3, nand\_usdhc\_bus\_sel, ARRAY\_SIZE(nand\_usdhc\_bus\_sel), CLK\_SET\_PARENT\_GATE); hws[IMX7D\_DRAM\_PHYM\_ROOT\_SRC] = imx\_clk\_hw\_mux2\_flags("dram\_phym\_src", base + 0x9800, 24, 1, dram\_phym\_sel, ARRAY\_SIZE(dram\_phym\_sel), CLK\_SET\_PARENT\_GATE);- hws[IMX7D\_DRAM\_ROOT\_SRC] = imx\_clk\_hw\_mux2\_flags("dram\_src", base + 0x9880, 24, 1, dram\_sel, ARRAY\_SIZE(dram\_sel), CLK\_SET\_PARENT\_GATE);+ hws[IMX7D\_DRAM\_ROOT\_SRC] = imx\_clk\_hw\_mux2("dram\_src", base + 0x9880, 24, 1, dram\_sel, ARRAY\_SIZE(dram\_sel)); hws[IMX7D\_DRAM\_PHYM\_ALT\_ROOT\_SRC] = imx\_clk\_hw\_mux2\_flags("dram\_phym\_alt\_src", base + 0xa000, 24, 3, dram\_phym\_alt\_sel, ARRAY\_SIZE(dram\_phym\_alt\_sel), CLK\_SET\_PARENT\_GATE);- hws[IMX7D\_DRAM\_ALT\_ROOT\_SRC] = imx\_clk\_hw\_mux2\_flags("dram\_alt\_src", base + 0xa080, 24, 3, dram\_alt\_sel, ARRAY\_SIZE(dram\_alt\_sel), CLK\_SET\_PARENT\_GATE);+ hws[IMX7D\_DRAM\_ALT\_ROOT\_SRC] = imx\_clk\_hw\_mux2("dram\_alt\_src", base + 0xa080, 24, 3, dram\_alt\_sel, ARRAY\_SIZE(dram\_alt\_sel)); hws[IMX7D\_USB\_HSIC\_ROOT\_SRC] = imx\_clk\_hw\_mux2\_flags("usb\_hsic\_src", base + 0xa100, 24, 3, usb\_hsic\_sel, ARRAY\_SIZE(usb\_hsic\_sel), CLK\_SET\_PARENT\_GATE); hws[IMX7D\_PCIE\_CTRL\_ROOT\_SRC] = imx\_clk\_hw\_mux2\_flags("pcie\_ctrl\_src", base + 0xa180, 24, 3, pcie\_ctrl\_sel, ARRAY\_SIZE(pcie\_ctrl\_sel), CLK\_SET\_PARENT\_GATE); hws[IMX7D\_PCIE\_PHY\_ROOT\_SRC] = imx\_clk\_hw\_mux2\_flags("pcie\_phy\_src", base + 0xa200, 24, 3, pcie\_phy\_sel, ARRAY\_SIZE(pcie\_phy\_sel), CLK\_SET\_PARENT\_GATE); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 22:14:08 +0000



=== Content from git.kernel.org_b7ddde23_20250114_221530.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=a54c441b46a0745683c2eef5a359d22856d27323)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=a54c441b46a0745683c2eef5a359d22856d27323)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=a54c441b46a0745683c2eef5a359d22856d27323)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=a54c441b46a0745683c2eef5a359d22856d27323)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Peng Fan <peng.fan@nxp.com> | 2024-06-07 21:33:39 +0800 |
| --- | --- | --- |
| committer | Abel Vesa <abel.vesa@linaro.org> | 2024-06-21 09:35:24 +0300 |
| commit | [a54c441b46a0745683c2eef5a359d22856d27323](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=a54c441b46a0745683c2eef5a359d22856d27323) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=a54c441b46a0745683c2eef5a359d22856d27323)) | |
| tree | [5f025bf94288ae1e59805c57a62a5bca6f4a74ff](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=a54c441b46a0745683c2eef5a359d22856d27323) | |
| parent | [3d29036853b9cb07ac49e8261fca82a940be5c41](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=3d29036853b9cb07ac49e8261fca82a940be5c41) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=a54c441b46a0745683c2eef5a359d22856d27323&id2=3d29036853b9cb07ac49e8261fca82a940be5c41)) | |
| download | [linux-a54c441b46a0745683c2eef5a359d22856d27323.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-a54c441b46a0745683c2eef5a359d22856d27323.tar.gz) | |

clk: imx: Remove CLK\_SET\_PARENT\_GATE for DRAM mux for i.MX7DFor i.MX7D DRAM related mux clock, the clock source change should ONLY
be done done in low level asm code without accessing DRAM, and then
calling clk API to sync the HW clock status with clk tree, it should never
touch real clock source switch via clk API, so CLK\_SET\_PARENT\_GATE flag
should NOT be added, otherwise, DRAM's clock parent will be disabled when
DRAM is active, and system will hang.
Signed-off-by: Peng Fan <peng.fan@nxp.com>
Reviewed-by: Abel Vesa <abel.vesa@linaro.org>
Link: [https://lore.kernel.org/r/20240607133347.3291040-8-peng.fan@oss.nxp.com](https://lore.kernel.org/r/20240607133347.3291040-8-peng.fan%40oss.nxp.com)
Signed-off-by: Abel Vesa <abel.vesa@linaro.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=a54c441b46a0745683c2eef5a359d22856d27323)

| -rw-r--r-- | [drivers/clk/imx/clk-imx7d.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/clk/imx/clk-imx7d.c?id=a54c441b46a0745683c2eef5a359d22856d27323) | 4 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 2 insertions, 2 deletions

| diff --git a/drivers/clk/imx/clk-imx7d.c b/drivers/clk/imx/clk-imx7d.cindex 2b77d1fc7bb946..1e1296e748357b 100644--- a/[drivers/clk/imx/clk-imx7d.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/clk/imx/clk-imx7d.c?id=3d29036853b9cb07ac49e8261fca82a940be5c41)+++ b/[drivers/clk/imx/clk-imx7d.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/clk/imx/clk-imx7d.c?id=a54c441b46a0745683c2eef5a359d22856d27323)@@ -498,9 +498,9 @@ static void \_\_init imx7d\_clocks\_init(struct device\_node \*ccm\_node) hws[IMX7D\_ENET\_AXI\_ROOT\_SRC] = imx\_clk\_hw\_mux2\_flags("enet\_axi\_src", base + 0x8900, 24, 3, enet\_axi\_sel, ARRAY\_SIZE(enet\_axi\_sel), CLK\_SET\_PARENT\_GATE); hws[IMX7D\_NAND\_USDHC\_BUS\_ROOT\_SRC] = imx\_clk\_hw\_mux2\_flags("nand\_usdhc\_src", base + 0x8980, 24, 3, nand\_usdhc\_bus\_sel, ARRAY\_SIZE(nand\_usdhc\_bus\_sel), CLK\_SET\_PARENT\_GATE); hws[IMX7D\_DRAM\_PHYM\_ROOT\_SRC] = imx\_clk\_hw\_mux2\_flags("dram\_phym\_src", base + 0x9800, 24, 1, dram\_phym\_sel, ARRAY\_SIZE(dram\_phym\_sel), CLK\_SET\_PARENT\_GATE);- hws[IMX7D\_DRAM\_ROOT\_SRC] = imx\_clk\_hw\_mux2\_flags("dram\_src", base + 0x9880, 24, 1, dram\_sel, ARRAY\_SIZE(dram\_sel), CLK\_SET\_PARENT\_GATE);+ hws[IMX7D\_DRAM\_ROOT\_SRC] = imx\_clk\_hw\_mux2("dram\_src", base + 0x9880, 24, 1, dram\_sel, ARRAY\_SIZE(dram\_sel)); hws[IMX7D\_DRAM\_PHYM\_ALT\_ROOT\_SRC] = imx\_clk\_hw\_mux2\_flags("dram\_phym\_alt\_src", base + 0xa000, 24, 3, dram\_phym\_alt\_sel, ARRAY\_SIZE(dram\_phym\_alt\_sel), CLK\_SET\_PARENT\_GATE);- hws[IMX7D\_DRAM\_ALT\_ROOT\_SRC] = imx\_clk\_hw\_mux2\_flags("dram\_alt\_src", base + 0xa080, 24, 3, dram\_alt\_sel, ARRAY\_SIZE(dram\_alt\_sel), CLK\_SET\_PARENT\_GATE);+ hws[IMX7D\_DRAM\_ALT\_ROOT\_SRC] = imx\_clk\_hw\_mux2("dram\_alt\_src", base + 0xa080, 24, 3, dram\_alt\_sel, ARRAY\_SIZE(dram\_alt\_sel)); hws[IMX7D\_USB\_HSIC\_ROOT\_SRC] = imx\_clk\_hw\_mux2\_flags("usb\_hsic\_src", base + 0xa100, 24, 3, usb\_hsic\_sel, ARRAY\_SIZE(usb\_hsic\_sel), CLK\_SET\_PARENT\_GATE); hws[IMX7D\_PCIE\_CTRL\_ROOT\_SRC] = imx\_clk\_hw\_mux2\_flags("pcie\_ctrl\_src", base + 0xa180, 24, 3, pcie\_ctrl\_sel, ARRAY\_SIZE(pcie\_ctrl\_sel), CLK\_SET\_PARENT\_GATE); hws[IMX7D\_PCIE\_PHY\_ROOT\_SRC] = imx\_clk\_hw\_mux2\_flags("pcie\_phy\_src", base + 0xa200, 24, 3, pcie\_phy\_sel, ARRAY\_SIZE(pcie\_phy\_sel), CLK\_SET\_PARENT\_GATE); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 22:14:07 +0000



=== Content from git.kernel.org_05ba4c64_20250114_221528.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=11ceb17e6f07cc30410f3a6276cddda248a9b863)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=11ceb17e6f07cc30410f3a6276cddda248a9b863)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=11ceb17e6f07cc30410f3a6276cddda248a9b863)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=11ceb17e6f07cc30410f3a6276cddda248a9b863)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Peng Fan <peng.fan@nxp.com> | 2024-06-07 21:33:39 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-10-17 15:22:16 +0200 |
| commit | [11ceb17e6f07cc30410f3a6276cddda248a9b863](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=11ceb17e6f07cc30410f3a6276cddda248a9b863) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=11ceb17e6f07cc30410f3a6276cddda248a9b863)) | |
| tree | [e6de7e974ea0c814f2a2121110df6adbc757f414](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=11ceb17e6f07cc30410f3a6276cddda248a9b863) | |
| parent | [1d750606fedcdff7886f35a558c51b05ce2680a6](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=1d750606fedcdff7886f35a558c51b05ce2680a6) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=11ceb17e6f07cc30410f3a6276cddda248a9b863&id2=1d750606fedcdff7886f35a558c51b05ce2680a6)) | |
| download | [linux-11ceb17e6f07cc30410f3a6276cddda248a9b863.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-11ceb17e6f07cc30410f3a6276cddda248a9b863.tar.gz) | |

clk: imx: Remove CLK\_SET\_PARENT\_GATE for DRAM mux for i.MX7D[ Upstream commit a54c441b46a0745683c2eef5a359d22856d27323 ]
For i.MX7D DRAM related mux clock, the clock source change should ONLY
be done done in low level asm code without accessing DRAM, and then
calling clk API to sync the HW clock status with clk tree, it should never
touch real clock source switch via clk API, so CLK\_SET\_PARENT\_GATE flag
should NOT be added, otherwise, DRAM's clock parent will be disabled when
DRAM is active, and system will hang.
Signed-off-by: Peng Fan <peng.fan@nxp.com>
Reviewed-by: Abel Vesa <abel.vesa@linaro.org>
Link: [https://lore.kernel.org/r/20240607133347.3291040-8-peng.fan@oss.nxp.com](https://lore.kernel.org/r/20240607133347.3291040-8-peng.fan%40oss.nxp.com)
Signed-off-by: Abel Vesa <abel.vesa@linaro.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=11ceb17e6f07cc30410f3a6276cddda248a9b863)

| -rw-r--r-- | [drivers/clk/imx/clk-imx7d.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/clk/imx/clk-imx7d.c?id=11ceb17e6f07cc30410f3a6276cddda248a9b863) | 4 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 2 insertions, 2 deletions

| diff --git a/drivers/clk/imx/clk-imx7d.c b/drivers/clk/imx/clk-imx7d.cindex cbf8131c63f7e1..f26b85e8f3292d 100644--- a/[drivers/clk/imx/clk-imx7d.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/clk/imx/clk-imx7d.c?id=1d750606fedcdff7886f35a558c51b05ce2680a6)+++ b/[drivers/clk/imx/clk-imx7d.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/clk/imx/clk-imx7d.c?id=11ceb17e6f07cc30410f3a6276cddda248a9b863)@@ -498,9 +498,9 @@ static void \_\_init imx7d\_clocks\_init(struct device\_node \*ccm\_node) hws[IMX7D\_ENET\_AXI\_ROOT\_SRC] = imx\_clk\_hw\_mux2\_flags("enet\_axi\_src", base + 0x8900, 24, 3, enet\_axi\_sel, ARRAY\_SIZE(enet\_axi\_sel), CLK\_SET\_PARENT\_GATE); hws[IMX7D\_NAND\_USDHC\_BUS\_ROOT\_SRC] = imx\_clk\_hw\_mux2\_flags("nand\_usdhc\_src", base + 0x8980, 24, 3, nand\_usdhc\_bus\_sel, ARRAY\_SIZE(nand\_usdhc\_bus\_sel), CLK\_SET\_PARENT\_GATE); hws[IMX7D\_DRAM\_PHYM\_ROOT\_SRC] = imx\_clk\_hw\_mux2\_flags("dram\_phym\_src", base + 0x9800, 24, 1, dram\_phym\_sel, ARRAY\_SIZE(dram\_phym\_sel), CLK\_SET\_PARENT\_GATE);- hws[IMX7D\_DRAM\_ROOT\_SRC] = imx\_clk\_hw\_mux2\_flags("dram\_src", base + 0x9880, 24, 1, dram\_sel, ARRAY\_SIZE(dram\_sel), CLK\_SET\_PARENT\_GATE);+ hws[IMX7D\_DRAM\_ROOT\_SRC] = imx\_clk\_hw\_mux2("dram\_src", base + 0x9880, 24, 1, dram\_sel, ARRAY\_SIZE(dram\_sel)); hws[IMX7D\_DRAM\_PHYM\_ALT\_ROOT\_SRC] = imx\_clk\_hw\_mux2\_flags("dram\_phym\_alt\_src", base + 0xa000, 24, 3, dram\_phym\_alt\_sel, ARRAY\_SIZE(dram\_phym\_alt\_sel), CLK\_SET\_PARENT\_GATE);- hws[IMX7D\_DRAM\_ALT\_ROOT\_SRC] = imx\_clk\_hw\_mux2\_flags("dram\_alt\_src", base + 0xa080, 24, 3, dram\_alt\_sel, ARRAY\_SIZE(dram\_alt\_sel), CLK\_SET\_PARENT\_GATE);+ hws[IMX7D\_DRAM\_ALT\_ROOT\_SRC] = imx\_clk\_hw\_mux2("dram\_alt\_src", base + 0xa080, 24, 3, dram\_alt\_sel, ARRAY\_SIZE(dram\_alt\_sel)); hws[IMX7D\_USB\_HSIC\_ROOT\_SRC] = imx\_clk\_hw\_mux2\_flags("usb\_hsic\_src", base + 0xa100, 24, 3, usb\_hsic\_sel, ARRAY\_SIZE(usb\_hsic\_sel), CLK\_SET\_PARENT\_GATE); hws[IMX7D\_PCIE\_CTRL\_ROOT\_SRC] = imx\_clk\_hw\_mux2\_flags("pcie\_ctrl\_src", base + 0xa180, 24, 3, pcie\_ctrl\_sel, ARRAY\_SIZE(pcie\_ctrl\_sel), CLK\_SET\_PARENT\_GATE); hws[IMX7D\_PCIE\_PHY\_ROOT\_SRC] = imx\_clk\_hw\_mux2\_flags("pcie\_phy\_src", base + 0xa200, 24, 3, pcie\_phy\_sel, ARRAY\_SIZE(pcie\_phy\_sel), CLK\_SET\_PARENT\_GATE); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 22:14:05 +0000



=== Content from git.kernel.org_40b33f4f_20250114_221529.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=339273a9ddfe7632b717c2e13e81cbd5d383e1ff)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=339273a9ddfe7632b717c2e13e81cbd5d383e1ff)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=339273a9ddfe7632b717c2e13e81cbd5d383e1ff)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=339273a9ddfe7632b717c2e13e81cbd5d383e1ff)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Peng Fan <peng.fan@nxp.com> | 2024-06-07 21:33:39 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-10-17 15:24:19 +0200 |
| commit | [339273a9ddfe7632b717c2e13e81cbd5d383e1ff](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=339273a9ddfe7632b717c2e13e81cbd5d383e1ff) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=339273a9ddfe7632b717c2e13e81cbd5d383e1ff)) | |
| tree | [51f7158da1a7293a6481539ba811873a0e42ea93](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=339273a9ddfe7632b717c2e13e81cbd5d383e1ff) | |
| parent | [7fb5f957213bc7268bac449f8bfe95967c9f3f3b](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=7fb5f957213bc7268bac449f8bfe95967c9f3f3b) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=339273a9ddfe7632b717c2e13e81cbd5d383e1ff&id2=7fb5f957213bc7268bac449f8bfe95967c9f3f3b)) | |
| download | [linux-339273a9ddfe7632b717c2e13e81cbd5d383e1ff.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-339273a9ddfe7632b717c2e13e81cbd5d383e1ff.tar.gz) | |

clk: imx: Remove CLK\_SET\_PARENT\_GATE for DRAM mux for i.MX7D[ Upstream commit a54c441b46a0745683c2eef5a359d22856d27323 ]
For i.MX7D DRAM related mux clock, the clock source change should ONLY
be done done in low level asm code without accessing DRAM, and then
calling clk API to sync the HW clock status with clk tree, it should never
touch real clock source switch via clk API, so CLK\_SET\_PARENT\_GATE flag
should NOT be added, otherwise, DRAM's clock parent will be disabled when
DRAM is active, and system will hang.
Signed-off-by: Peng Fan <peng.fan@nxp.com>
Reviewed-by: Abel Vesa <abel.vesa@linaro.org>
Link: [https://lore.kernel.org/r/20240607133347.3291040-8-peng.fan@oss.nxp.com](https://lore.kernel.org/r/20240607133347.3291040-8-peng.fan%40oss.nxp.com)
Signed-off-by: Abel Vesa <abel.vesa@linaro.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=339273a9ddfe7632b717c2e13e81cbd5d383e1ff)

| -rw-r--r-- | [drivers/clk/imx/clk-imx7d.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/clk/imx/clk-imx7d.c?id=339273a9ddfe7632b717c2e13e81cbd5d383e1ff) | 4 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 2 insertions, 2 deletions

| diff --git a/drivers/clk/imx/clk-imx7d.c b/drivers/clk/imx/clk-imx7d.cindex 2b77d1fc7bb946..1e1296e748357b 100644--- a/[drivers/clk/imx/clk-imx7d.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/clk/imx/clk-imx7d.c?id=7fb5f957213bc7268bac449f8bfe95967c9f3f3b)+++ b/[drivers/clk/imx/clk-imx7d.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/clk/imx/clk-imx7d.c?id=339273a9ddfe7632b717c2e13e81cbd5d383e1ff)@@ -498,9 +498,9 @@ static void \_\_init imx7d\_clocks\_init(struct device\_node \*ccm\_node) hws[IMX7D\_ENET\_AXI\_ROOT\_SRC] = imx\_clk\_hw\_mux2\_flags("enet\_axi\_src", base + 0x8900, 24, 3, enet\_axi\_sel, ARRAY\_SIZE(enet\_axi\_sel), CLK\_SET\_PARENT\_GATE); hws[IMX7D\_NAND\_USDHC\_BUS\_ROOT\_SRC] = imx\_clk\_hw\_mux2\_flags("nand\_usdhc\_src", base + 0x8980, 24, 3, nand\_usdhc\_bus\_sel, ARRAY\_SIZE(nand\_usdhc\_bus\_sel), CLK\_SET\_PARENT\_GATE); hws[IMX7D\_DRAM\_PHYM\_ROOT\_SRC] = imx\_clk\_hw\_mux2\_flags("dram\_phym\_src", base + 0x9800, 24, 1, dram\_phym\_sel, ARRAY\_SIZE(dram\_phym\_sel), CLK\_SET\_PARENT\_GATE);- hws[IMX7D\_DRAM\_ROOT\_SRC] = imx\_clk\_hw\_mux2\_flags("dram\_src", base + 0x9880, 24, 1, dram\_sel, ARRAY\_SIZE(dram\_sel), CLK\_SET\_PARENT\_GATE);+ hws[IMX7D\_DRAM\_ROOT\_SRC] = imx\_clk\_hw\_mux2("dram\_src", base + 0x9880, 24, 1, dram\_sel, ARRAY\_SIZE(dram\_sel)); hws[IMX7D\_DRAM\_PHYM\_ALT\_ROOT\_SRC] = imx\_clk\_hw\_mux2\_flags("dram\_phym\_alt\_src", base + 0xa000, 24, 3, dram\_phym\_alt\_sel, ARRAY\_SIZE(dram\_phym\_alt\_sel), CLK\_SET\_PARENT\_GATE);- hws[IMX7D\_DRAM\_ALT\_ROOT\_SRC] = imx\_clk\_hw\_mux2\_flags("dram\_alt\_src", base + 0xa080, 24, 3, dram\_alt\_sel, ARRAY\_SIZE(dram\_alt\_sel), CLK\_SET\_PARENT\_GATE);+ hws[IMX7D\_DRAM\_ALT\_ROOT\_SRC] = imx\_clk\_hw\_mux2("dram\_alt\_src", base + 0xa080, 24, 3, dram\_alt\_sel, ARRAY\_SIZE(dram\_alt\_sel)); hws[IMX7D\_USB\_HSIC\_ROOT\_SRC] = imx\_clk\_hw\_mux2\_flags("usb\_hsic\_src", base + 0xa100, 24, 3, usb\_hsic\_sel, ARRAY\_SIZE(usb\_hsic\_sel), CLK\_SET\_PARENT\_GATE); hws[IMX7D\_PCIE\_CTRL\_ROOT\_SRC] = imx\_clk\_hw\_mux2\_flags("pcie\_ctrl\_src", base + 0xa180, 24, 3, pcie\_ctrl\_sel, ARRAY\_SIZE(pcie\_ctrl\_sel), CLK\_SET\_PARENT\_GATE); hws[IMX7D\_PCIE\_PHY\_ROOT\_SRC] = imx\_clk\_hw\_mux2\_flags("pcie\_phy\_src", base + 0xa200, 24, 3, pcie\_phy\_sel, ARRAY\_SIZE(pcie\_phy\_sel), CLK\_SET\_PARENT\_GATE); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 22:14:06 +0000


