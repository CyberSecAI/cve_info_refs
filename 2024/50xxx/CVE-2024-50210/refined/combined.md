=== Content from git.kernel.org_f9bd59ef_20250114_210813.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=e56e0ec1b79f5a6272c6e78b36e9d593aa0449af)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=e56e0ec1b79f5a6272c6e78b36e9d593aa0449af)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=e56e0ec1b79f5a6272c6e78b36e9d593aa0449af)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e56e0ec1b79f5a6272c6e78b36e9d593aa0449af)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Jinjie Ruan <ruanjinjie@huawei.com> | 2024-10-18 18:07:48 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-11-01 01:52:37 +0100 |
| commit | [e56e0ec1b79f5a6272c6e78b36e9d593aa0449af](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=e56e0ec1b79f5a6272c6e78b36e9d593aa0449af) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=e56e0ec1b79f5a6272c6e78b36e9d593aa0449af)) | |
| tree | [9f689250874d15238221b7c5636fe7763c72559a](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=e56e0ec1b79f5a6272c6e78b36e9d593aa0449af) | |
| parent | [b96eff3d83408406b30e3fe96493944859848ad8](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=b96eff3d83408406b30e3fe96493944859848ad8) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e56e0ec1b79f5a6272c6e78b36e9d593aa0449af&id2=b96eff3d83408406b30e3fe96493944859848ad8)) | |
| download | [linux-e56e0ec1b79f5a6272c6e78b36e9d593aa0449af.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-e56e0ec1b79f5a6272c6e78b36e9d593aa0449af.tar.gz) | |

posix-clock: posix-clock: Fix unbalanced locking in pc\_clock\_settime()[ Upstream commit 6e62807c7fbb3c758d233018caf94dfea9c65dbd ]
If get\_clock\_desc() succeeds, it calls fget() for the clockid's fd,
and get the clk->rwsem read lock, so the error path should release
the lock to make the lock balance and fput the clockid's fd to make
the refcount balance and release the fd related resource.
However the below commit left the error path locked behind resulting in
unbalanced locking. Check timespec64\_valid\_strict() before
get\_clock\_desc() to fix it, because the "ts" is not changed
after that.
Fixes: d8794ac20a29 ("posix-clock: Fix missing timespec64 check in pc\_clock\_settime()")
Acked-by: Richard Cochran <richardcochran@gmail.com>
Signed-off-by: Jinjie Ruan <ruanjinjie@huawei.com>
Acked-by: Anna-Maria Behnsen <anna-maria@linutronix.de>
[pabeni@redhat.com: fixed commit message typo]
Signed-off-by: Paolo Abeni <pabeni@redhat.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e56e0ec1b79f5a6272c6e78b36e9d593aa0449af)

| -rw-r--r-- | [kernel/time/posix-clock.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/kernel/time/posix-clock.c?id=e56e0ec1b79f5a6272c6e78b36e9d593aa0449af) | 6 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 3 insertions, 3 deletions

| diff --git a/kernel/time/posix-clock.c b/kernel/time/posix-clock.cindex 8127673bfc45e6..05e73d209aa87e 100644--- a/[kernel/time/posix-clock.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/kernel/time/posix-clock.c?id=b96eff3d83408406b30e3fe96493944859848ad8)+++ b/[kernel/time/posix-clock.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/kernel/time/posix-clock.c?id=e56e0ec1b79f5a6272c6e78b36e9d593aa0449af)@@ -290,6 +290,9 @@ static int pc\_clock\_settime(clockid\_t id, const struct timespec64 \*ts) struct posix\_clock\_desc cd; int err; + if (!timespec64\_valid\_strict(ts))+ return -EINVAL;+ err = get\_clock\_desc(id, &cd); if (err) return err;@@ -299,9 +302,6 @@ static int pc\_clock\_settime(clockid\_t id, const struct timespec64 \*ts) goto out; } - if (!timespec64\_valid\_strict(ts))- return -EINVAL;- if (cd.clk->ops.clock\_settime) err = cd.clk->ops.clock\_settime(cd.clk, ts); else |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 21:06:50 +0000



=== Content from git.kernel.org_b2d765ca_20250114_210810.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=a8219446b95a859488feaade674d13f9efacfa32)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=a8219446b95a859488feaade674d13f9efacfa32)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=a8219446b95a859488feaade674d13f9efacfa32)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=a8219446b95a859488feaade674d13f9efacfa32)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Jinjie Ruan <ruanjinjie@huawei.com> | 2024-10-18 18:07:48 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-11-08 16:20:51 +0100 |
| commit | [a8219446b95a859488feaade674d13f9efacfa32](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=a8219446b95a859488feaade674d13f9efacfa32) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=a8219446b95a859488feaade674d13f9efacfa32)) | |
| tree | [a3bc5238c046baa3a383628f09636ddabb4380de](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=a8219446b95a859488feaade674d13f9efacfa32) | |
| parent | [6e2bbba8bbf211f34dfcf82545bd7afb55890556](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=6e2bbba8bbf211f34dfcf82545bd7afb55890556) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=a8219446b95a859488feaade674d13f9efacfa32&id2=6e2bbba8bbf211f34dfcf82545bd7afb55890556)) | |
| download | [linux-a8219446b95a859488feaade674d13f9efacfa32.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-a8219446b95a859488feaade674d13f9efacfa32.tar.gz) | |

posix-clock: posix-clock: Fix unbalanced locking in pc\_clock\_settime()[ Upstream commit 6e62807c7fbb3c758d233018caf94dfea9c65dbd ]
If get\_clock\_desc() succeeds, it calls fget() for the clockid's fd,
and get the clk->rwsem read lock, so the error path should release
the lock to make the lock balance and fput the clockid's fd to make
the refcount balance and release the fd related resource.
However the below commit left the error path locked behind resulting in
unbalanced locking. Check timespec64\_valid\_strict() before
get\_clock\_desc() to fix it, because the "ts" is not changed
after that.
Fixes: d8794ac20a29 ("posix-clock: Fix missing timespec64 check in pc\_clock\_settime()")
Acked-by: Richard Cochran <richardcochran@gmail.com>
Signed-off-by: Jinjie Ruan <ruanjinjie@huawei.com>
Acked-by: Anna-Maria Behnsen <anna-maria@linutronix.de>
[pabeni@redhat.com: fixed commit message typo]
Signed-off-by: Paolo Abeni <pabeni@redhat.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=a8219446b95a859488feaade674d13f9efacfa32)

| -rw-r--r-- | [kernel/time/posix-clock.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/kernel/time/posix-clock.c?id=a8219446b95a859488feaade674d13f9efacfa32) | 6 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 3 insertions, 3 deletions

| diff --git a/kernel/time/posix-clock.c b/kernel/time/posix-clock.cindex 369bb5caa8e3a5..d123478a32c432 100644--- a/[kernel/time/posix-clock.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/kernel/time/posix-clock.c?id=6e2bbba8bbf211f34dfcf82545bd7afb55890556)+++ b/[kernel/time/posix-clock.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/kernel/time/posix-clock.c?id=a8219446b95a859488feaade674d13f9efacfa32)@@ -290,6 +290,9 @@ static int pc\_clock\_settime(clockid\_t id, const struct timespec64 \*ts) struct posix\_clock\_desc cd; int err; + if (!timespec64\_valid\_strict(ts))+ return -EINVAL;+ err = get\_clock\_desc(id, &cd); if (err) return err;@@ -299,9 +302,6 @@ static int pc\_clock\_settime(clockid\_t id, const struct timespec64 \*ts) goto out; } - if (!timespec64\_valid\_strict(ts))- return -EINVAL;- if (cd.clk->ops.clock\_settime) err = cd.clk->ops.clock\_settime(cd.clk, ts); else |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 21:06:47 +0000



=== Content from git.kernel.org_6b6b8c0d_20250114_210808.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=1ba33b327c3f88a7baee598979d73ab5b44d41cc)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=1ba33b327c3f88a7baee598979d73ab5b44d41cc)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=1ba33b327c3f88a7baee598979d73ab5b44d41cc)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=1ba33b327c3f88a7baee598979d73ab5b44d41cc)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Jinjie Ruan <ruanjinjie@huawei.com> | 2024-10-18 18:07:48 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-11-01 01:58:30 +0100 |
| commit | [1ba33b327c3f88a7baee598979d73ab5b44d41cc](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=1ba33b327c3f88a7baee598979d73ab5b44d41cc) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=1ba33b327c3f88a7baee598979d73ab5b44d41cc)) | |
| tree | [f0ec47cac12e9c6f64c9f73902ddd96b38dd89f0](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=1ba33b327c3f88a7baee598979d73ab5b44d41cc) | |
| parent | [7d6d46b429804b1a182106e27e2f8c0e84689e1a](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=7d6d46b429804b1a182106e27e2f8c0e84689e1a) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=1ba33b327c3f88a7baee598979d73ab5b44d41cc&id2=7d6d46b429804b1a182106e27e2f8c0e84689e1a)) | |
| download | [linux-1ba33b327c3f88a7baee598979d73ab5b44d41cc.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-1ba33b327c3f88a7baee598979d73ab5b44d41cc.tar.gz) | |

posix-clock: posix-clock: Fix unbalanced locking in pc\_clock\_settime()[ Upstream commit 6e62807c7fbb3c758d233018caf94dfea9c65dbd ]
If get\_clock\_desc() succeeds, it calls fget() for the clockid's fd,
and get the clk->rwsem read lock, so the error path should release
the lock to make the lock balance and fput the clockid's fd to make
the refcount balance and release the fd related resource.
However the below commit left the error path locked behind resulting in
unbalanced locking. Check timespec64\_valid\_strict() before
get\_clock\_desc() to fix it, because the "ts" is not changed
after that.
Fixes: d8794ac20a29 ("posix-clock: Fix missing timespec64 check in pc\_clock\_settime()")
Acked-by: Richard Cochran <richardcochran@gmail.com>
Signed-off-by: Jinjie Ruan <ruanjinjie@huawei.com>
Acked-by: Anna-Maria Behnsen <anna-maria@linutronix.de>
[pabeni@redhat.com: fixed commit message typo]
Signed-off-by: Paolo Abeni <pabeni@redhat.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=1ba33b327c3f88a7baee598979d73ab5b44d41cc)

| -rw-r--r-- | [kernel/time/posix-clock.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/kernel/time/posix-clock.c?id=1ba33b327c3f88a7baee598979d73ab5b44d41cc) | 6 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 3 insertions, 3 deletions

| diff --git a/kernel/time/posix-clock.c b/kernel/time/posix-clock.cindex 8127673bfc45e6..05e73d209aa87e 100644--- a/[kernel/time/posix-clock.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/kernel/time/posix-clock.c?id=7d6d46b429804b1a182106e27e2f8c0e84689e1a)+++ b/[kernel/time/posix-clock.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/kernel/time/posix-clock.c?id=1ba33b327c3f88a7baee598979d73ab5b44d41cc)@@ -290,6 +290,9 @@ static int pc\_clock\_settime(clockid\_t id, const struct timespec64 \*ts) struct posix\_clock\_desc cd; int err; + if (!timespec64\_valid\_strict(ts))+ return -EINVAL;+ err = get\_clock\_desc(id, &cd); if (err) return err;@@ -299,9 +302,6 @@ static int pc\_clock\_settime(clockid\_t id, const struct timespec64 \*ts) goto out; } - if (!timespec64\_valid\_strict(ts))- return -EINVAL;- if (cd.clk->ops.clock\_settime) err = cd.clk->ops.clock\_settime(cd.clk, ts); else |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 21:06:45 +0000



=== Content from git.kernel.org_4b190f05_20250114_210809.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=5f063bbf1ee6b01611c016b54e050a41506eb794)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=5f063bbf1ee6b01611c016b54e050a41506eb794)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=5f063bbf1ee6b01611c016b54e050a41506eb794)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=5f063bbf1ee6b01611c016b54e050a41506eb794)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Jinjie Ruan <ruanjinjie@huawei.com> | 2024-10-18 18:07:48 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-11-01 01:56:05 +0100 |
| commit | [5f063bbf1ee6b01611c016b54e050a41506eb794](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=5f063bbf1ee6b01611c016b54e050a41506eb794) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=5f063bbf1ee6b01611c016b54e050a41506eb794)) | |
| tree | [9f3f2b8fbeeb1535401628822a42d2daa3b3a507](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=5f063bbf1ee6b01611c016b54e050a41506eb794) | |
| parent | [3216a2bd61bb5d25b198a0de164a7b791fa5e64b](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=3216a2bd61bb5d25b198a0de164a7b791fa5e64b) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=5f063bbf1ee6b01611c016b54e050a41506eb794&id2=3216a2bd61bb5d25b198a0de164a7b791fa5e64b)) | |
| download | [linux-5f063bbf1ee6b01611c016b54e050a41506eb794.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-5f063bbf1ee6b01611c016b54e050a41506eb794.tar.gz) | |

posix-clock: posix-clock: Fix unbalanced locking in pc\_clock\_settime()[ Upstream commit 6e62807c7fbb3c758d233018caf94dfea9c65dbd ]
If get\_clock\_desc() succeeds, it calls fget() for the clockid's fd,
and get the clk->rwsem read lock, so the error path should release
the lock to make the lock balance and fput the clockid's fd to make
the refcount balance and release the fd related resource.
However the below commit left the error path locked behind resulting in
unbalanced locking. Check timespec64\_valid\_strict() before
get\_clock\_desc() to fix it, because the "ts" is not changed
after that.
Fixes: d8794ac20a29 ("posix-clock: Fix missing timespec64 check in pc\_clock\_settime()")
Acked-by: Richard Cochran <richardcochran@gmail.com>
Signed-off-by: Jinjie Ruan <ruanjinjie@huawei.com>
Acked-by: Anna-Maria Behnsen <anna-maria@linutronix.de>
[pabeni@redhat.com: fixed commit message typo]
Signed-off-by: Paolo Abeni <pabeni@redhat.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=5f063bbf1ee6b01611c016b54e050a41506eb794)

| -rw-r--r-- | [kernel/time/posix-clock.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/kernel/time/posix-clock.c?id=5f063bbf1ee6b01611c016b54e050a41506eb794) | 6 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 3 insertions, 3 deletions

| diff --git a/kernel/time/posix-clock.c b/kernel/time/posix-clock.cindex 8127673bfc45e6..05e73d209aa87e 100644--- a/[kernel/time/posix-clock.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/kernel/time/posix-clock.c?id=3216a2bd61bb5d25b198a0de164a7b791fa5e64b)+++ b/[kernel/time/posix-clock.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/kernel/time/posix-clock.c?id=5f063bbf1ee6b01611c016b54e050a41506eb794)@@ -290,6 +290,9 @@ static int pc\_clock\_settime(clockid\_t id, const struct timespec64 \*ts) struct posix\_clock\_desc cd; int err; + if (!timespec64\_valid\_strict(ts))+ return -EINVAL;+ err = get\_clock\_desc(id, &cd); if (err) return err;@@ -299,9 +302,6 @@ static int pc\_clock\_settime(clockid\_t id, const struct timespec64 \*ts) goto out; } - if (!timespec64\_valid\_strict(ts))- return -EINVAL;- if (cd.clk->ops.clock\_settime) err = cd.clk->ops.clock\_settime(cd.clk, ts); else |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 21:06:46 +0000



=== Content from git.kernel.org_cc078a57_20250114_210811.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=c7fcfdba35abc9f39b83080c2bce398dad13a943)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=c7fcfdba35abc9f39b83080c2bce398dad13a943)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=c7fcfdba35abc9f39b83080c2bce398dad13a943)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=c7fcfdba35abc9f39b83080c2bce398dad13a943)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Jinjie Ruan <ruanjinjie@huawei.com> | 2024-10-18 18:07:48 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-11-08 16:21:59 +0100 |
| commit | [c7fcfdba35abc9f39b83080c2bce398dad13a943](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=c7fcfdba35abc9f39b83080c2bce398dad13a943) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=c7fcfdba35abc9f39b83080c2bce398dad13a943)) | |
| tree | [5ab7850daebcf00a123c49dafd09b4766d2bf203](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=c7fcfdba35abc9f39b83080c2bce398dad13a943) | |
| parent | [0da93d67da9006b203b3be572d68e10f70dad734](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=0da93d67da9006b203b3be572d68e10f70dad734) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=c7fcfdba35abc9f39b83080c2bce398dad13a943&id2=0da93d67da9006b203b3be572d68e10f70dad734)) | |
| download | [linux-c7fcfdba35abc9f39b83080c2bce398dad13a943.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-c7fcfdba35abc9f39b83080c2bce398dad13a943.tar.gz) | |

posix-clock: posix-clock: Fix unbalanced locking in pc\_clock\_settime()[ Upstream commit 6e62807c7fbb3c758d233018caf94dfea9c65dbd ]
If get\_clock\_desc() succeeds, it calls fget() for the clockid's fd,
and get the clk->rwsem read lock, so the error path should release
the lock to make the lock balance and fput the clockid's fd to make
the refcount balance and release the fd related resource.
However the below commit left the error path locked behind resulting in
unbalanced locking. Check timespec64\_valid\_strict() before
get\_clock\_desc() to fix it, because the "ts" is not changed
after that.
Fixes: d8794ac20a29 ("posix-clock: Fix missing timespec64 check in pc\_clock\_settime()")
Acked-by: Richard Cochran <richardcochran@gmail.com>
Signed-off-by: Jinjie Ruan <ruanjinjie@huawei.com>
Acked-by: Anna-Maria Behnsen <anna-maria@linutronix.de>
[pabeni@redhat.com: fixed commit message typo]
Signed-off-by: Paolo Abeni <pabeni@redhat.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=c7fcfdba35abc9f39b83080c2bce398dad13a943)

| -rw-r--r-- | [kernel/time/posix-clock.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/kernel/time/posix-clock.c?id=c7fcfdba35abc9f39b83080c2bce398dad13a943) | 6 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 3 insertions, 3 deletions

| diff --git a/kernel/time/posix-clock.c b/kernel/time/posix-clock.cindex 8127673bfc45e6..05e73d209aa87e 100644--- a/[kernel/time/posix-clock.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/kernel/time/posix-clock.c?id=0da93d67da9006b203b3be572d68e10f70dad734)+++ b/[kernel/time/posix-clock.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/kernel/time/posix-clock.c?id=c7fcfdba35abc9f39b83080c2bce398dad13a943)@@ -290,6 +290,9 @@ static int pc\_clock\_settime(clockid\_t id, const struct timespec64 \*ts) struct posix\_clock\_desc cd; int err; + if (!timespec64\_valid\_strict(ts))+ return -EINVAL;+ err = get\_clock\_desc(id, &cd); if (err) return err;@@ -299,9 +302,6 @@ static int pc\_clock\_settime(clockid\_t id, const struct timespec64 \*ts) goto out; } - if (!timespec64\_valid\_strict(ts))- return -EINVAL;- if (cd.clk->ops.clock\_settime) err = cd.clk->ops.clock\_settime(cd.clk, ts); else |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 21:06:49 +0000



=== Content from git.kernel.org_68b56003_20250114_210812.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=d005400262ddaf1ca1666bbcd1acf42fe81d57ce)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=d005400262ddaf1ca1666bbcd1acf42fe81d57ce)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=d005400262ddaf1ca1666bbcd1acf42fe81d57ce)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=d005400262ddaf1ca1666bbcd1acf42fe81d57ce)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Jinjie Ruan <ruanjinjie@huawei.com> | 2024-10-18 18:07:48 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-11-08 16:19:21 +0100 |
| commit | [d005400262ddaf1ca1666bbcd1acf42fe81d57ce](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=d005400262ddaf1ca1666bbcd1acf42fe81d57ce) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=d005400262ddaf1ca1666bbcd1acf42fe81d57ce)) | |
| tree | [497b239bf21562f59ab8fbf4020007cd7ed7f7e2](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=d005400262ddaf1ca1666bbcd1acf42fe81d57ce) | |
| parent | [8f83f28d93d380fa4083f6a80fd7793f650e5278](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=8f83f28d93d380fa4083f6a80fd7793f650e5278) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=d005400262ddaf1ca1666bbcd1acf42fe81d57ce&id2=8f83f28d93d380fa4083f6a80fd7793f650e5278)) | |
| download | [linux-d005400262ddaf1ca1666bbcd1acf42fe81d57ce.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-d005400262ddaf1ca1666bbcd1acf42fe81d57ce.tar.gz) | |

posix-clock: posix-clock: Fix unbalanced locking in pc\_clock\_settime()[ Upstream commit 6e62807c7fbb3c758d233018caf94dfea9c65dbd ]
If get\_clock\_desc() succeeds, it calls fget() for the clockid's fd,
and get the clk->rwsem read lock, so the error path should release
the lock to make the lock balance and fput the clockid's fd to make
the refcount balance and release the fd related resource.
However the below commit left the error path locked behind resulting in
unbalanced locking. Check timespec64\_valid\_strict() before
get\_clock\_desc() to fix it, because the "ts" is not changed
after that.
Fixes: d8794ac20a29 ("posix-clock: Fix missing timespec64 check in pc\_clock\_settime()")
Acked-by: Richard Cochran <richardcochran@gmail.com>
Signed-off-by: Jinjie Ruan <ruanjinjie@huawei.com>
Acked-by: Anna-Maria Behnsen <anna-maria@linutronix.de>
[pabeni@redhat.com: fixed commit message typo]
Signed-off-by: Paolo Abeni <pabeni@redhat.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=d005400262ddaf1ca1666bbcd1acf42fe81d57ce)

| -rw-r--r-- | [kernel/time/posix-clock.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/kernel/time/posix-clock.c?id=d005400262ddaf1ca1666bbcd1acf42fe81d57ce) | 6 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 3 insertions, 3 deletions

| diff --git a/kernel/time/posix-clock.c b/kernel/time/posix-clock.cindex cda319c7529e50..c1e5feff8185db 100644--- a/[kernel/time/posix-clock.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/kernel/time/posix-clock.c?id=8f83f28d93d380fa4083f6a80fd7793f650e5278)+++ b/[kernel/time/posix-clock.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/kernel/time/posix-clock.c?id=d005400262ddaf1ca1666bbcd1acf42fe81d57ce)@@ -303,6 +303,9 @@ static int pc\_clock\_settime(clockid\_t id, const struct timespec64 \*ts) struct posix\_clock\_desc cd; int err; + if (!timespec64\_valid\_strict(ts))+ return -EINVAL;+ err = get\_clock\_desc(id, &cd); if (err) return err;@@ -312,9 +315,6 @@ static int pc\_clock\_settime(clockid\_t id, const struct timespec64 \*ts) goto out; } - if (!timespec64\_valid\_strict(ts))- return -EINVAL;- if (cd.clk->ops.clock\_settime) err = cd.clk->ops.clock\_settime(cd.clk, ts); else |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 21:06:49 +0000



=== Content from git.kernel.org_10c943cd_20250114_210809.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=6e62807c7fbb3c758d233018caf94dfea9c65dbd)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=6e62807c7fbb3c758d233018caf94dfea9c65dbd)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=6e62807c7fbb3c758d233018caf94dfea9c65dbd)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=6e62807c7fbb3c758d233018caf94dfea9c65dbd)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Jinjie Ruan <ruanjinjie@huawei.com> | 2024-10-18 18:07:48 +0800 |
| --- | --- | --- |
| committer | Paolo Abeni <pabeni@redhat.com> | 2024-10-23 16:05:01 +0200 |
| commit | [6e62807c7fbb3c758d233018caf94dfea9c65dbd](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=6e62807c7fbb3c758d233018caf94dfea9c65dbd) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=6e62807c7fbb3c758d233018caf94dfea9c65dbd)) | |
| tree | [956284902f28562231b31e78522a1490597c43cf](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=6e62807c7fbb3c758d233018caf94dfea9c65dbd) | |
| parent | [10ce0db787004875f4dba068ea952207d1d8abeb](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=10ce0db787004875f4dba068ea952207d1d8abeb) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=6e62807c7fbb3c758d233018caf94dfea9c65dbd&id2=10ce0db787004875f4dba068ea952207d1d8abeb)) | |
| download | [linux-6e62807c7fbb3c758d233018caf94dfea9c65dbd.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-6e62807c7fbb3c758d233018caf94dfea9c65dbd.tar.gz) | |

posix-clock: posix-clock: Fix unbalanced locking in pc\_clock\_settime()If get\_clock\_desc() succeeds, it calls fget() for the clockid's fd,
and get the clk->rwsem read lock, so the error path should release
the lock to make the lock balance and fput the clockid's fd to make
the refcount balance and release the fd related resource.
However the below commit left the error path locked behind resulting in
unbalanced locking. Check timespec64\_valid\_strict() before
get\_clock\_desc() to fix it, because the "ts" is not changed
after that.
Fixes: d8794ac20a29 ("posix-clock: Fix missing timespec64 check in pc\_clock\_settime()")
Acked-by: Richard Cochran <richardcochran@gmail.com>
Signed-off-by: Jinjie Ruan <ruanjinjie@huawei.com>
Acked-by: Anna-Maria Behnsen <anna-maria@linutronix.de>
[pabeni@redhat.com: fixed commit message typo]
Signed-off-by: Paolo Abeni <pabeni@redhat.com>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=6e62807c7fbb3c758d233018caf94dfea9c65dbd)

| -rw-r--r-- | [kernel/time/posix-clock.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/kernel/time/posix-clock.c?id=6e62807c7fbb3c758d233018caf94dfea9c65dbd) | 6 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 3 insertions, 3 deletions

| diff --git a/kernel/time/posix-clock.c b/kernel/time/posix-clock.cindex 316a4e8c97d362..1af0bb2cc45c0a 100644--- a/[kernel/time/posix-clock.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/kernel/time/posix-clock.c?id=10ce0db787004875f4dba068ea952207d1d8abeb)+++ b/[kernel/time/posix-clock.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/kernel/time/posix-clock.c?id=6e62807c7fbb3c758d233018caf94dfea9c65dbd)@@ -309,6 +309,9 @@ static int pc\_clock\_settime(clockid\_t id, const struct timespec64 \*ts) struct posix\_clock\_desc cd; int err; + if (!timespec64\_valid\_strict(ts))+ return -EINVAL;+ err = get\_clock\_desc(id, &cd); if (err) return err;@@ -318,9 +321,6 @@ static int pc\_clock\_settime(clockid\_t id, const struct timespec64 \*ts) goto out; } - if (!timespec64\_valid\_strict(ts))- return -EINVAL;- if (cd.clk->ops.clock\_settime) err = cd.clk->ops.clock\_settime(cd.clk, ts); else |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 21:06:46 +0000



=== Content from git.kernel.org_137cd78c_20250114_210811.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=b27330128eca25179637c1816d5a72d6cc408c66)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=b27330128eca25179637c1816d5a72d6cc408c66)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=b27330128eca25179637c1816d5a72d6cc408c66)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b27330128eca25179637c1816d5a72d6cc408c66)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Jinjie Ruan <ruanjinjie@huawei.com> | 2024-10-18 18:07:48 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-11-01 02:02:37 +0100 |
| commit | [b27330128eca25179637c1816d5a72d6cc408c66](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=b27330128eca25179637c1816d5a72d6cc408c66) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=b27330128eca25179637c1816d5a72d6cc408c66)) | |
| tree | [e4a6a6bb88edb170bdafde69574850ce9c92c470](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=b27330128eca25179637c1816d5a72d6cc408c66) | |
| parent | [0776e465fcb724e7f535b75a21d4c1eaffcc1235](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=0776e465fcb724e7f535b75a21d4c1eaffcc1235) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b27330128eca25179637c1816d5a72d6cc408c66&id2=0776e465fcb724e7f535b75a21d4c1eaffcc1235)) | |
| download | [linux-b27330128eca25179637c1816d5a72d6cc408c66.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-b27330128eca25179637c1816d5a72d6cc408c66.tar.gz) | |

posix-clock: posix-clock: Fix unbalanced locking in pc\_clock\_settime()[ Upstream commit 6e62807c7fbb3c758d233018caf94dfea9c65dbd ]
If get\_clock\_desc() succeeds, it calls fget() for the clockid's fd,
and get the clk->rwsem read lock, so the error path should release
the lock to make the lock balance and fput the clockid's fd to make
the refcount balance and release the fd related resource.
However the below commit left the error path locked behind resulting in
unbalanced locking. Check timespec64\_valid\_strict() before
get\_clock\_desc() to fix it, because the "ts" is not changed
after that.
Fixes: d8794ac20a29 ("posix-clock: Fix missing timespec64 check in pc\_clock\_settime()")
Acked-by: Richard Cochran <richardcochran@gmail.com>
Signed-off-by: Jinjie Ruan <ruanjinjie@huawei.com>
Acked-by: Anna-Maria Behnsen <anna-maria@linutronix.de>
[pabeni@redhat.com: fixed commit message typo]
Signed-off-by: Paolo Abeni <pabeni@redhat.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b27330128eca25179637c1816d5a72d6cc408c66)

| -rw-r--r-- | [kernel/time/posix-clock.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/kernel/time/posix-clock.c?id=b27330128eca25179637c1816d5a72d6cc408c66) | 6 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 3 insertions, 3 deletions

| diff --git a/kernel/time/posix-clock.c b/kernel/time/posix-clock.cindex 6b5d5c0021fae6..a6487a9d608533 100644--- a/[kernel/time/posix-clock.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/kernel/time/posix-clock.c?id=0776e465fcb724e7f535b75a21d4c1eaffcc1235)+++ b/[kernel/time/posix-clock.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/kernel/time/posix-clock.c?id=b27330128eca25179637c1816d5a72d6cc408c66)@@ -310,6 +310,9 @@ static int pc\_clock\_settime(clockid\_t id, const struct timespec64 \*ts) struct posix\_clock\_desc cd; int err; + if (!timespec64\_valid\_strict(ts))+ return -EINVAL;+ err = get\_clock\_desc(id, &cd); if (err) return err;@@ -319,9 +322,6 @@ static int pc\_clock\_settime(clockid\_t id, const struct timespec64 \*ts) goto out; } - if (!timespec64\_valid\_strict(ts))- return -EINVAL;- if (cd.clk->ops.clock\_settime) err = cd.clk->ops.clock\_settime(cd.clk, ts); else |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 21:06:48 +0000


