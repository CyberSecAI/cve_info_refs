=== Content from git.kernel.org_f90de259_20250114_184253.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=5ea0b7af38754d2b45ead9257bca47e84662e926)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=5ea0b7af38754d2b45ead9257bca47e84662e926)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=5ea0b7af38754d2b45ead9257bca47e84662e926)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=5ea0b7af38754d2b45ead9257bca47e84662e926)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Patrick Roy <roypat@amazon.co.uk> | 2024-10-01 09:00:41 +0100 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-10-17 15:22:28 +0200 |
| commit | [5ea0b7af38754d2b45ead9257bca47e84662e926](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=5ea0b7af38754d2b45ead9257bca47e84662e926) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=5ea0b7af38754d2b45ead9257bca47e84662e926)) | |
| tree | [5c3aa5cf2aa461d2fe484704020703c596975fd2](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=5ea0b7af38754d2b45ead9257bca47e84662e926) | |
| parent | [8608196a155cb6cfae04d96b10a2652d0327e33f](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=8608196a155cb6cfae04d96b10a2652d0327e33f) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=5ea0b7af38754d2b45ead9257bca47e84662e926&id2=8608196a155cb6cfae04d96b10a2652d0327e33f)) | |
| download | [linux-5ea0b7af38754d2b45ead9257bca47e84662e926.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-5ea0b7af38754d2b45ead9257bca47e84662e926.tar.gz) | |

secretmem: disable memfd\_secret() if arch cannot set direct mapcommit 532b53cebe58f34ce1c0f34d866f5c0e335c53c6 upstream.
Return -ENOSYS from memfd\_secret() syscall if !can\_set\_direct\_map(). This
is the case for example on some arm64 configurations, where marking 4k
PTEs in the direct map not present can only be done if the direct map is
set up at 4k granularity in the first place (as ARM's break-before-make
semantics do not easily allow breaking apart large/gigantic pages).
More precisely, on arm64 systems with !can\_set\_direct\_map(),
set\_direct\_map\_invalid\_noflush() is a no-op, however it returns success
(0) instead of an error. This means that memfd\_secret will seemingly
"work" (e.g. syscall succeeds, you can mmap the fd and fault in pages),
but it does not actually achieve its goal of removing its memory from the
direct map.
Note that with this patch, memfd\_secret() will start erroring on systems
where can\_set\_direct\_map() returns false (arm64 with
CONFIG\_RODATA\_FULL\_DEFAULT\_ENABLED=n, CONFIG\_DEBUG\_PAGEALLOC=n and
CONFIG\_KFENCE=n), but that still seems better than the current silent
failure. Since CONFIG\_RODATA\_FULL\_DEFAULT\_ENABLED defaults to 'y', most
arm64 systems actually have a working memfd\_secret() and aren't be
affected.
From going through the iterations of the original memfd\_secret patch
series, it seems that disabling the syscall in these scenarios was the
intended behavior [1] (preferred over having
set\_direct\_map\_invalid\_noflush return an error as that would result in
SIGBUSes at page-fault time), however the check for it got dropped between
v16 [2] and v17 [3], when secretmem moved away from CMA allocations.
[1]: https://lore.kernel.org/lkml/20201124164930.GK8537@kernel.org/
[2]: https://lore.kernel.org/lkml/20210121122723.3446-11-rppt@kernel.org/#t
[3]: https://lore.kernel.org/lkml/20201125092208.12544-10-rppt@kernel.org/
Link: [https://lkml.kernel.org/r/20241001080056.784735-1-roypat@amazon.co.uk](https://lkml.kernel.org/r/20241001080056.784735-1-roypat%40amazon.co.uk)
Fixes: 1507f51255c9 ("mm: introduce memfd\_secret system call to create "secret" memory areas")
Signed-off-by: Patrick Roy <roypat@amazon.co.uk>
Reviewed-by: Mike Rapoport (Microsoft) <rppt@kernel.org>
Cc: Alexander Graf <graf@amazon.com>
Cc: David Hildenbrand <david@redhat.com>
Cc: James Gowans <jgowans@amazon.com>
Cc: <stable@vger.kernel.org>
Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=5ea0b7af38754d2b45ead9257bca47e84662e926)

| -rw-r--r-- | [mm/secretmem.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/mm/secretmem.c?id=5ea0b7af38754d2b45ead9257bca47e84662e926) | 4 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 2 insertions, 2 deletions

| diff --git a/mm/secretmem.c b/mm/secretmem.cindex 04c3ac9448a188..c6006d765bbd26 100644--- a/[mm/secretmem.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/mm/secretmem.c?id=8608196a155cb6cfae04d96b10a2652d0327e33f)+++ b/[mm/secretmem.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/mm/secretmem.c?id=5ea0b7af38754d2b45ead9257bca47e84662e926)@@ -236,7 +236,7 @@ SYSCALL\_DEFINE1(memfd\_secret, unsigned int, flags) /\* make sure local flags do not confict with global fcntl.h \*/ BUILD\_BUG\_ON(SECRETMEM\_FLAGS\_MASK & O\_CLOEXEC); - if (!secretmem\_enable)+ if (!secretmem\_enable || !can\_set\_direct\_map()) return -ENOSYS;  if (flags & ~(SECRETMEM\_FLAGS\_MASK | O\_CLOEXEC))@@ -278,7 +278,7 @@ static struct file\_system\_type secretmem\_fs = {  static int \_\_init secretmem\_init(void) {- if (!secretmem\_enable)+ if (!secretmem\_enable || !can\_set\_direct\_map()) return 0;  secretmem\_mnt = kern\_mount(&secretmem\_fs); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 18:41:30 +0000



=== Content from git.kernel.org_fe208de3_20250114_184252.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=532b53cebe58f34ce1c0f34d866f5c0e335c53c6)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=532b53cebe58f34ce1c0f34d866f5c0e335c53c6)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=532b53cebe58f34ce1c0f34d866f5c0e335c53c6)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=532b53cebe58f34ce1c0f34d866f5c0e335c53c6)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Patrick Roy <roypat@amazon.co.uk> | 2024-10-01 09:00:41 +0100 |
| --- | --- | --- |
| committer | Andrew Morton <akpm@linux-foundation.org> | 2024-10-09 12:47:19 -0700 |
| commit | [532b53cebe58f34ce1c0f34d866f5c0e335c53c6](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=532b53cebe58f34ce1c0f34d866f5c0e335c53c6) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=532b53cebe58f34ce1c0f34d866f5c0e335c53c6)) | |
| tree | [b6708c9d3444c91318b20545d235bb30ff3a2155](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=532b53cebe58f34ce1c0f34d866f5c0e335c53c6) | |
| parent | [71e32fe63cb654fbf23933b10613714b2429118b](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=71e32fe63cb654fbf23933b10613714b2429118b) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=532b53cebe58f34ce1c0f34d866f5c0e335c53c6&id2=71e32fe63cb654fbf23933b10613714b2429118b)) | |
| download | [linux-532b53cebe58f34ce1c0f34d866f5c0e335c53c6.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-532b53cebe58f34ce1c0f34d866f5c0e335c53c6.tar.gz) | |

secretmem: disable memfd\_secret() if arch cannot set direct mapReturn -ENOSYS from memfd\_secret() syscall if !can\_set\_direct\_map(). This
is the case for example on some arm64 configurations, where marking 4k
PTEs in the direct map not present can only be done if the direct map is
set up at 4k granularity in the first place (as ARM's break-before-make
semantics do not easily allow breaking apart large/gigantic pages).
More precisely, on arm64 systems with !can\_set\_direct\_map(),
set\_direct\_map\_invalid\_noflush() is a no-op, however it returns success
(0) instead of an error. This means that memfd\_secret will seemingly
"work" (e.g. syscall succeeds, you can mmap the fd and fault in pages),
but it does not actually achieve its goal of removing its memory from the
direct map.
Note that with this patch, memfd\_secret() will start erroring on systems
where can\_set\_direct\_map() returns false (arm64 with
CONFIG\_RODATA\_FULL\_DEFAULT\_ENABLED=n, CONFIG\_DEBUG\_PAGEALLOC=n and
CONFIG\_KFENCE=n), but that still seems better than the current silent
failure. Since CONFIG\_RODATA\_FULL\_DEFAULT\_ENABLED defaults to 'y', most
arm64 systems actually have a working memfd\_secret() and aren't be
affected.
From going through the iterations of the original memfd\_secret patch
series, it seems that disabling the syscall in these scenarios was the
intended behavior [1] (preferred over having
set\_direct\_map\_invalid\_noflush return an error as that would result in
SIGBUSes at page-fault time), however the check for it got dropped between
v16 [2] and v17 [3], when secretmem moved away from CMA allocations.
[1]: https://lore.kernel.org/lkml/20201124164930.GK8537@kernel.org/
[2]: https://lore.kernel.org/lkml/20210121122723.3446-11-rppt@kernel.org/#t
[3]: https://lore.kernel.org/lkml/20201125092208.12544-10-rppt@kernel.org/
Link: [https://lkml.kernel.org/r/20241001080056.784735-1-roypat@amazon.co.uk](https://lkml.kernel.org/r/20241001080056.784735-1-roypat%40amazon.co.uk)
Fixes: 1507f51255c9 ("mm: introduce memfd\_secret system call to create "secret" memory areas")
Signed-off-by: Patrick Roy <roypat@amazon.co.uk>
Reviewed-by: Mike Rapoport (Microsoft) <rppt@kernel.org>
Cc: Alexander Graf <graf@amazon.com>
Cc: David Hildenbrand <david@redhat.com>
Cc: James Gowans <jgowans@amazon.com>
Cc: <stable@vger.kernel.org>
Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=532b53cebe58f34ce1c0f34d866f5c0e335c53c6)

| -rw-r--r-- | [mm/secretmem.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/mm/secretmem.c?id=532b53cebe58f34ce1c0f34d866f5c0e335c53c6) | 4 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 2 insertions, 2 deletions

| diff --git a/mm/secretmem.c b/mm/secretmem.cindex 3afb5ad701e14a..399552814fd0ff 100644--- a/[mm/secretmem.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/mm/secretmem.c?id=71e32fe63cb654fbf23933b10613714b2429118b)+++ b/[mm/secretmem.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/mm/secretmem.c?id=532b53cebe58f34ce1c0f34d866f5c0e335c53c6)@@ -238,7 +238,7 @@ SYSCALL\_DEFINE1(memfd\_secret, unsigned int, flags) /\* make sure local flags do not confict with global fcntl.h \*/ BUILD\_BUG\_ON(SECRETMEM\_FLAGS\_MASK & O\_CLOEXEC); - if (!secretmem\_enable)+ if (!secretmem\_enable || !can\_set\_direct\_map()) return -ENOSYS;  if (flags & ~(SECRETMEM\_FLAGS\_MASK | O\_CLOEXEC))@@ -280,7 +280,7 @@ static struct file\_system\_type secretmem\_fs = {  static int \_\_init secretmem\_init(void) {- if (!secretmem\_enable)+ if (!secretmem\_enable || !can\_set\_direct\_map()) return 0;  secretmem\_mnt = kern\_mount(&secretmem\_fs); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 18:41:30 +0000



=== Content from git.kernel.org_4e8271bd_20250114_184254.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=757786abe4547eb3d9d0e8350a63bdb0f9824af2)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=757786abe4547eb3d9d0e8350a63bdb0f9824af2)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=757786abe4547eb3d9d0e8350a63bdb0f9824af2)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=757786abe4547eb3d9d0e8350a63bdb0f9824af2)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Patrick Roy <roypat@amazon.co.uk> | 2024-10-01 09:00:41 +0100 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-10-17 15:27:02 +0200 |
| commit | [757786abe4547eb3d9d0e8350a63bdb0f9824af2](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=757786abe4547eb3d9d0e8350a63bdb0f9824af2) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=757786abe4547eb3d9d0e8350a63bdb0f9824af2)) | |
| tree | [542bad4a3df3a50acc599d85156f746cb0a93da4](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=757786abe4547eb3d9d0e8350a63bdb0f9824af2) | |
| parent | [ac527766ac6fee9629b470aed180e36d4907416d](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=ac527766ac6fee9629b470aed180e36d4907416d) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=757786abe4547eb3d9d0e8350a63bdb0f9824af2&id2=ac527766ac6fee9629b470aed180e36d4907416d)) | |
| download | [linux-757786abe4547eb3d9d0e8350a63bdb0f9824af2.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-757786abe4547eb3d9d0e8350a63bdb0f9824af2.tar.gz) | |

secretmem: disable memfd\_secret() if arch cannot set direct mapcommit 532b53cebe58f34ce1c0f34d866f5c0e335c53c6 upstream.
Return -ENOSYS from memfd\_secret() syscall if !can\_set\_direct\_map(). This
is the case for example on some arm64 configurations, where marking 4k
PTEs in the direct map not present can only be done if the direct map is
set up at 4k granularity in the first place (as ARM's break-before-make
semantics do not easily allow breaking apart large/gigantic pages).
More precisely, on arm64 systems with !can\_set\_direct\_map(),
set\_direct\_map\_invalid\_noflush() is a no-op, however it returns success
(0) instead of an error. This means that memfd\_secret will seemingly
"work" (e.g. syscall succeeds, you can mmap the fd and fault in pages),
but it does not actually achieve its goal of removing its memory from the
direct map.
Note that with this patch, memfd\_secret() will start erroring on systems
where can\_set\_direct\_map() returns false (arm64 with
CONFIG\_RODATA\_FULL\_DEFAULT\_ENABLED=n, CONFIG\_DEBUG\_PAGEALLOC=n and
CONFIG\_KFENCE=n), but that still seems better than the current silent
failure. Since CONFIG\_RODATA\_FULL\_DEFAULT\_ENABLED defaults to 'y', most
arm64 systems actually have a working memfd\_secret() and aren't be
affected.
From going through the iterations of the original memfd\_secret patch
series, it seems that disabling the syscall in these scenarios was the
intended behavior [1] (preferred over having
set\_direct\_map\_invalid\_noflush return an error as that would result in
SIGBUSes at page-fault time), however the check for it got dropped between
v16 [2] and v17 [3], when secretmem moved away from CMA allocations.
[1]: https://lore.kernel.org/lkml/20201124164930.GK8537@kernel.org/
[2]: https://lore.kernel.org/lkml/20210121122723.3446-11-rppt@kernel.org/#t
[3]: https://lore.kernel.org/lkml/20201125092208.12544-10-rppt@kernel.org/
Link: [https://lkml.kernel.org/r/20241001080056.784735-1-roypat@amazon.co.uk](https://lkml.kernel.org/r/20241001080056.784735-1-roypat%40amazon.co.uk)
Fixes: 1507f51255c9 ("mm: introduce memfd\_secret system call to create "secret" memory areas")
Signed-off-by: Patrick Roy <roypat@amazon.co.uk>
Reviewed-by: Mike Rapoport (Microsoft) <rppt@kernel.org>
Cc: Alexander Graf <graf@amazon.com>
Cc: David Hildenbrand <david@redhat.com>
Cc: James Gowans <jgowans@amazon.com>
Cc: <stable@vger.kernel.org>
Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=757786abe4547eb3d9d0e8350a63bdb0f9824af2)

| -rw-r--r-- | [mm/secretmem.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/mm/secretmem.c?id=757786abe4547eb3d9d0e8350a63bdb0f9824af2) | 4 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 2 insertions, 2 deletions

| diff --git a/mm/secretmem.c b/mm/secretmem.cindex 3afb5ad701e14a..399552814fd0ff 100644--- a/[mm/secretmem.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/mm/secretmem.c?id=ac527766ac6fee9629b470aed180e36d4907416d)+++ b/[mm/secretmem.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/mm/secretmem.c?id=757786abe4547eb3d9d0e8350a63bdb0f9824af2)@@ -238,7 +238,7 @@ SYSCALL\_DEFINE1(memfd\_secret, unsigned int, flags) /\* make sure local flags do not confict with global fcntl.h \*/ BUILD\_BUG\_ON(SECRETMEM\_FLAGS\_MASK & O\_CLOEXEC); - if (!secretmem\_enable)+ if (!secretmem\_enable || !can\_set\_direct\_map()) return -ENOSYS;  if (flags & ~(SECRETMEM\_FLAGS\_MASK | O\_CLOEXEC))@@ -280,7 +280,7 @@ static struct file\_system\_type secretmem\_fs = {  static int \_\_init secretmem\_init(void) {- if (!secretmem\_enable)+ if (!secretmem\_enable || !can\_set\_direct\_map()) return 0;  secretmem\_mnt = kern\_mount(&secretmem\_fs); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 18:41:31 +0000



=== Content from git.kernel.org_c90d3926_20250114_184254.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=7caf966390e6e4ebf42775df54e7ee1f280ce677)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=7caf966390e6e4ebf42775df54e7ee1f280ce677)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=7caf966390e6e4ebf42775df54e7ee1f280ce677)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=7caf966390e6e4ebf42775df54e7ee1f280ce677)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Patrick Roy <roypat@amazon.co.uk> | 2024-10-01 09:00:41 +0100 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-10-17 15:24:37 +0200 |
| commit | [7caf966390e6e4ebf42775df54e7ee1f280ce677](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=7caf966390e6e4ebf42775df54e7ee1f280ce677) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=7caf966390e6e4ebf42775df54e7ee1f280ce677)) | |
| tree | [9dc3ef1f1e8af197a9690caf34e097f2d136cf63](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=7caf966390e6e4ebf42775df54e7ee1f280ce677) | |
| parent | [e5a0031c7965d7b61a898146adfc4fe375742e2d](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=e5a0031c7965d7b61a898146adfc4fe375742e2d) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=7caf966390e6e4ebf42775df54e7ee1f280ce677&id2=e5a0031c7965d7b61a898146adfc4fe375742e2d)) | |
| download | [linux-7caf966390e6e4ebf42775df54e7ee1f280ce677.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-7caf966390e6e4ebf42775df54e7ee1f280ce677.tar.gz) | |

secretmem: disable memfd\_secret() if arch cannot set direct mapcommit 532b53cebe58f34ce1c0f34d866f5c0e335c53c6 upstream.
Return -ENOSYS from memfd\_secret() syscall if !can\_set\_direct\_map(). This
is the case for example on some arm64 configurations, where marking 4k
PTEs in the direct map not present can only be done if the direct map is
set up at 4k granularity in the first place (as ARM's break-before-make
semantics do not easily allow breaking apart large/gigantic pages).
More precisely, on arm64 systems with !can\_set\_direct\_map(),
set\_direct\_map\_invalid\_noflush() is a no-op, however it returns success
(0) instead of an error. This means that memfd\_secret will seemingly
"work" (e.g. syscall succeeds, you can mmap the fd and fault in pages),
but it does not actually achieve its goal of removing its memory from the
direct map.
Note that with this patch, memfd\_secret() will start erroring on systems
where can\_set\_direct\_map() returns false (arm64 with
CONFIG\_RODATA\_FULL\_DEFAULT\_ENABLED=n, CONFIG\_DEBUG\_PAGEALLOC=n and
CONFIG\_KFENCE=n), but that still seems better than the current silent
failure. Since CONFIG\_RODATA\_FULL\_DEFAULT\_ENABLED defaults to 'y', most
arm64 systems actually have a working memfd\_secret() and aren't be
affected.
From going through the iterations of the original memfd\_secret patch
series, it seems that disabling the syscall in these scenarios was the
intended behavior [1] (preferred over having
set\_direct\_map\_invalid\_noflush return an error as that would result in
SIGBUSes at page-fault time), however the check for it got dropped between
v16 [2] and v17 [3], when secretmem moved away from CMA allocations.
[1]: https://lore.kernel.org/lkml/20201124164930.GK8537@kernel.org/
[2]: https://lore.kernel.org/lkml/20210121122723.3446-11-rppt@kernel.org/#t
[3]: https://lore.kernel.org/lkml/20201125092208.12544-10-rppt@kernel.org/
Link: [https://lkml.kernel.org/r/20241001080056.784735-1-roypat@amazon.co.uk](https://lkml.kernel.org/r/20241001080056.784735-1-roypat%40amazon.co.uk)
Fixes: 1507f51255c9 ("mm: introduce memfd\_secret system call to create "secret" memory areas")
Signed-off-by: Patrick Roy <roypat@amazon.co.uk>
Reviewed-by: Mike Rapoport (Microsoft) <rppt@kernel.org>
Cc: Alexander Graf <graf@amazon.com>
Cc: David Hildenbrand <david@redhat.com>
Cc: James Gowans <jgowans@amazon.com>
Cc: <stable@vger.kernel.org>
Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=7caf966390e6e4ebf42775df54e7ee1f280ce677)

| -rw-r--r-- | [mm/secretmem.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/mm/secretmem.c?id=7caf966390e6e4ebf42775df54e7ee1f280ce677) | 4 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 2 insertions, 2 deletions

| diff --git a/mm/secretmem.c b/mm/secretmem.cindex 3afb5ad701e14a..399552814fd0ff 100644--- a/[mm/secretmem.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/mm/secretmem.c?id=e5a0031c7965d7b61a898146adfc4fe375742e2d)+++ b/[mm/secretmem.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/mm/secretmem.c?id=7caf966390e6e4ebf42775df54e7ee1f280ce677)@@ -238,7 +238,7 @@ SYSCALL\_DEFINE1(memfd\_secret, unsigned int, flags) /\* make sure local flags do not confict with global fcntl.h \*/ BUILD\_BUG\_ON(SECRETMEM\_FLAGS\_MASK & O\_CLOEXEC); - if (!secretmem\_enable)+ if (!secretmem\_enable || !can\_set\_direct\_map()) return -ENOSYS;  if (flags & ~(SECRETMEM\_FLAGS\_MASK | O\_CLOEXEC))@@ -280,7 +280,7 @@ static struct file\_system\_type secretmem\_fs = {  static int \_\_init secretmem\_init(void) {- if (!secretmem\_enable)+ if (!secretmem\_enable || !can\_set\_direct\_map()) return 0;  secretmem\_mnt = kern\_mount(&secretmem\_fs); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 18:41:31 +0000



=== Content from git.kernel.org_720d315e_20250114_184255.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=d0ae6ffa1aeb297aef89f49cfb894a83c329ebad)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=d0ae6ffa1aeb297aef89f49cfb894a83c329ebad)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=d0ae6ffa1aeb297aef89f49cfb894a83c329ebad)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=d0ae6ffa1aeb297aef89f49cfb894a83c329ebad)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Patrick Roy <roypat@amazon.co.uk> | 2024-10-01 09:00:41 +0100 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-10-22 15:40:41 +0200 |
| commit | [d0ae6ffa1aeb297aef89f49cfb894a83c329ebad](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=d0ae6ffa1aeb297aef89f49cfb894a83c329ebad) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=d0ae6ffa1aeb297aef89f49cfb894a83c329ebad)) | |
| tree | [62dae4f3f638a5c6d0f4e7a25f28c638e872e62a](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=d0ae6ffa1aeb297aef89f49cfb894a83c329ebad) | |
| parent | [e41710f5a61aca9d6baaa8f53908a927dd9e7aa7](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=e41710f5a61aca9d6baaa8f53908a927dd9e7aa7) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=d0ae6ffa1aeb297aef89f49cfb894a83c329ebad&id2=e41710f5a61aca9d6baaa8f53908a927dd9e7aa7)) | |
| download | [linux-d0ae6ffa1aeb297aef89f49cfb894a83c329ebad.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-d0ae6ffa1aeb297aef89f49cfb894a83c329ebad.tar.gz) | |

secretmem: disable memfd\_secret() if arch cannot set direct mapcommit 532b53cebe58f34ce1c0f34d866f5c0e335c53c6 upstream.
Return -ENOSYS from memfd\_secret() syscall if !can\_set\_direct\_map(). This
is the case for example on some arm64 configurations, where marking 4k
PTEs in the direct map not present can only be done if the direct map is
set up at 4k granularity in the first place (as ARM's break-before-make
semantics do not easily allow breaking apart large/gigantic pages).
More precisely, on arm64 systems with !can\_set\_direct\_map(),
set\_direct\_map\_invalid\_noflush() is a no-op, however it returns success
(0) instead of an error. This means that memfd\_secret will seemingly
"work" (e.g. syscall succeeds, you can mmap the fd and fault in pages),
but it does not actually achieve its goal of removing its memory from the
direct map.
Note that with this patch, memfd\_secret() will start erroring on systems
where can\_set\_direct\_map() returns false (arm64 with
CONFIG\_RODATA\_FULL\_DEFAULT\_ENABLED=n, CONFIG\_DEBUG\_PAGEALLOC=n and
CONFIG\_KFENCE=n), but that still seems better than the current silent
failure. Since CONFIG\_RODATA\_FULL\_DEFAULT\_ENABLED defaults to 'y', most
arm64 systems actually have a working memfd\_secret() and aren't be
affected.
From going through the iterations of the original memfd\_secret patch
series, it seems that disabling the syscall in these scenarios was the
intended behavior [1] (preferred over having
set\_direct\_map\_invalid\_noflush return an error as that would result in
SIGBUSes at page-fault time), however the check for it got dropped between
v16 [2] and v17 [3], when secretmem moved away from CMA allocations.
[1]: https://lore.kernel.org/lkml/20201124164930.GK8537@kernel.org/
[2]: https://lore.kernel.org/lkml/20210121122723.3446-11-rppt@kernel.org/#t
[3]: https://lore.kernel.org/lkml/20201125092208.12544-10-rppt@kernel.org/
Link: [https://lkml.kernel.org/r/20241001080056.784735-1-roypat@amazon.co.uk](https://lkml.kernel.org/r/20241001080056.784735-1-roypat%40amazon.co.uk)
Fixes: 1507f51255c9 ("mm: introduce memfd\_secret system call to create "secret" memory areas")
Signed-off-by: Patrick Roy <roypat@amazon.co.uk>
Reviewed-by: Mike Rapoport (Microsoft) <rppt@kernel.org>
Cc: Alexander Graf <graf@amazon.com>
Cc: David Hildenbrand <david@redhat.com>
Cc: James Gowans <jgowans@amazon.com>
Cc: <stable@vger.kernel.org>
Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
Signed-off-by: Mike Rapoport (Microsoft) <rppt@kernel.org>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=d0ae6ffa1aeb297aef89f49cfb894a83c329ebad)

| -rw-r--r-- | [mm/secretmem.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/mm/secretmem.c?id=d0ae6ffa1aeb297aef89f49cfb894a83c329ebad) | 4 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 2 insertions, 2 deletions

| diff --git a/mm/secretmem.c b/mm/secretmem.cindex d1986ce2e7c779..624663a9480830 100644--- a/[mm/secretmem.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/mm/secretmem.c?id=e41710f5a61aca9d6baaa8f53908a927dd9e7aa7)+++ b/[mm/secretmem.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/mm/secretmem.c?id=d0ae6ffa1aeb297aef89f49cfb894a83c329ebad)@@ -234,7 +234,7 @@ SYSCALL\_DEFINE1(memfd\_secret, unsigned int, flags) /\* make sure local flags do not confict with global fcntl.h \*/ BUILD\_BUG\_ON(SECRETMEM\_FLAGS\_MASK & O\_CLOEXEC); - if (!secretmem\_enable)+ if (!secretmem\_enable || !can\_set\_direct\_map()) return -ENOSYS;  if (flags & ~(SECRETMEM\_FLAGS\_MASK | O\_CLOEXEC))@@ -278,7 +278,7 @@ static int secretmem\_init(void) { int ret = 0; - if (!secretmem\_enable)+ if (!secretmem\_enable || !can\_set\_direct\_map()) return ret;  secretmem\_mnt = kern\_mount(&secretmem\_fs); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 18:41:32 +0000


