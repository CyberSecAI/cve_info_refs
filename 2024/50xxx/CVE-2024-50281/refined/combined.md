=== Content from git.kernel.org_d7dc26ad_20250114_203440.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=04de7589e0a95167d803ecadd115235ba2c14997)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=04de7589e0a95167d803ecadd115235ba2c14997)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=04de7589e0a95167d803ecadd115235ba2c14997)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=04de7589e0a95167d803ecadd115235ba2c14997)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | David Gstir <david@sigma-star.at> | 2024-10-29 12:34:01 +0100 |
| --- | --- | --- |
| committer | Jarkko Sakkinen <jarkko@kernel.org> | 2024-11-04 21:24:24 +0200 |
| commit | [04de7589e0a95167d803ecadd115235ba2c14997](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=04de7589e0a95167d803ecadd115235ba2c14997) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=04de7589e0a95167d803ecadd115235ba2c14997)) | |
| tree | [b2e3a1930c02ea031322140bd081a8dfe12e2584](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=04de7589e0a95167d803ecadd115235ba2c14997) | |
| parent | [4a74da044ec9ec8679e6beccc4306b936b62873f](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=4a74da044ec9ec8679e6beccc4306b936b62873f) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=04de7589e0a95167d803ecadd115235ba2c14997&id2=4a74da044ec9ec8679e6beccc4306b936b62873f)) | |
| download | [linux-04de7589e0a95167d803ecadd115235ba2c14997.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-04de7589e0a95167d803ecadd115235ba2c14997.tar.gz) | |

KEYS: trusted: dcp: fix NULL dereference in AEAD crypto operationWhen sealing or unsealing a key blob we currently do not wait for
the AEAD cipher operation to finish and simply return after submitting
the request. If there is some load on the system we can exit before
the cipher operation is done and the buffer we read from/write to
is already removed from the stack. This will e.g. result in NULL
pointer dereference errors in the DCP driver during blob creation.
Fix this by waiting for the AEAD cipher operation to finish before
resuming the seal and unseal calls.
Cc: stable@vger.kernel.org # v6.10+
Fixes: 0e28bf61a5f9 ("KEYS: trusted: dcp: fix leak of blob encryption key")
Reported-by: Parthiban N <parthiban@linumiz.com>
Closes: https://lore.kernel.org/keyrings/254d3bb1-6dbc-48b4-9c08-77df04baee2f@linumiz.com/
Signed-off-by: David Gstir <david@sigma-star.at>
Reviewed-by: Jarkko Sakkinen <jarkko@kernel.org>
Signed-off-by: Jarkko Sakkinen <jarkko@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=04de7589e0a95167d803ecadd115235ba2c14997)

| -rw-r--r-- | [security/keys/trusted-keys/trusted\_dcp.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/security/keys/trusted-keys/trusted_dcp.c?id=04de7589e0a95167d803ecadd115235ba2c14997) | 9 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 5 insertions, 4 deletions

| diff --git a/security/keys/trusted-keys/trusted\_dcp.c b/security/keys/trusted-keys/trusted\_dcp.cindex 4edc5bbbcda3c9..e908c53a803c4b 100644--- a/[security/keys/trusted-keys/trusted\_dcp.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/security/keys/trusted-keys/trusted_dcp.c?id=4a74da044ec9ec8679e6beccc4306b936b62873f)+++ b/[security/keys/trusted-keys/trusted\_dcp.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/security/keys/trusted-keys/trusted_dcp.c?id=04de7589e0a95167d803ecadd115235ba2c14997)@@ -133,6 +133,7 @@ static int do\_aead\_crypto(u8 \*in, u8 \*out, size\_t len, u8 \*key, u8 \*nonce, struct scatterlist src\_sg, dst\_sg; struct crypto\_aead \*aead; int ret;+ DECLARE\_CRYPTO\_WAIT(wait);  aead = crypto\_alloc\_aead("gcm(aes)", 0, CRYPTO\_ALG\_ASYNC); if (IS\_ERR(aead)) {@@ -163,8 +164,8 @@ static int do\_aead\_crypto(u8 \*in, u8 \*out, size\_t len, u8 \*key, u8 \*nonce, }  aead\_request\_set\_crypt(aead\_req, &src\_sg, &dst\_sg, len, nonce);- aead\_request\_set\_callback(aead\_req, CRYPTO\_TFM\_REQ\_MAY\_SLEEP, NULL,- NULL);+ aead\_request\_set\_callback(aead\_req, CRYPTO\_TFM\_REQ\_MAY\_SLEEP,+ crypto\_req\_done, &wait); aead\_request\_set\_ad(aead\_req, 0);  if (crypto\_aead\_setkey(aead, key, AES\_KEYSIZE\_128)) {@@ -174,9 +175,9 @@ static int do\_aead\_crypto(u8 \*in, u8 \*out, size\_t len, u8 \*key, u8 \*nonce, }  if (do\_encrypt)- ret = crypto\_aead\_encrypt(aead\_req);+ ret = crypto\_wait\_req(crypto\_aead\_encrypt(aead\_req), &wait); else- ret = crypto\_aead\_decrypt(aead\_req);+ ret = crypto\_wait\_req(crypto\_aead\_decrypt(aead\_req), &wait);  free\_req: aead\_request\_free(aead\_req); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 20:33:17 +0000



=== Content from git.kernel.org_3fd381db_20250114_203441.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=c75e0272289eae18c5379518a9c56ef31d65cc7d)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=c75e0272289eae18c5379518a9c56ef31d65cc7d)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=c75e0272289eae18c5379518a9c56ef31d65cc7d)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=c75e0272289eae18c5379518a9c56ef31d65cc7d)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | David Gstir <david@sigma-star.at> | 2024-10-29 12:34:01 +0100 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-11-14 13:21:07 +0100 |
| commit | [c75e0272289eae18c5379518a9c56ef31d65cc7d](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=c75e0272289eae18c5379518a9c56ef31d65cc7d) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=c75e0272289eae18c5379518a9c56ef31d65cc7d)) | |
| tree | [dc6902b52e02a75ae3aff57513f968773d83b6de](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=c75e0272289eae18c5379518a9c56ef31d65cc7d) | |
| parent | [e828b870ea9c0f39e0940ea92a3a9dbf2af8146d](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=e828b870ea9c0f39e0940ea92a3a9dbf2af8146d) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=c75e0272289eae18c5379518a9c56ef31d65cc7d&id2=e828b870ea9c0f39e0940ea92a3a9dbf2af8146d)) | |
| download | [linux-c75e0272289eae18c5379518a9c56ef31d65cc7d.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-c75e0272289eae18c5379518a9c56ef31d65cc7d.tar.gz) | |

KEYS: trusted: dcp: fix NULL dereference in AEAD crypto operationcommit 04de7589e0a95167d803ecadd115235ba2c14997 upstream.
When sealing or unsealing a key blob we currently do not wait for
the AEAD cipher operation to finish and simply return after submitting
the request. If there is some load on the system we can exit before
the cipher operation is done and the buffer we read from/write to
is already removed from the stack. This will e.g. result in NULL
pointer dereference errors in the DCP driver during blob creation.
Fix this by waiting for the AEAD cipher operation to finish before
resuming the seal and unseal calls.
Cc: stable@vger.kernel.org # v6.10+
Fixes: 0e28bf61a5f9 ("KEYS: trusted: dcp: fix leak of blob encryption key")
Reported-by: Parthiban N <parthiban@linumiz.com>
Closes: https://lore.kernel.org/keyrings/254d3bb1-6dbc-48b4-9c08-77df04baee2f@linumiz.com/
Signed-off-by: David Gstir <david@sigma-star.at>
Reviewed-by: Jarkko Sakkinen <jarkko@kernel.org>
Signed-off-by: Jarkko Sakkinen <jarkko@kernel.org>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=c75e0272289eae18c5379518a9c56ef31d65cc7d)

| -rw-r--r-- | [security/keys/trusted-keys/trusted\_dcp.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/security/keys/trusted-keys/trusted_dcp.c?id=c75e0272289eae18c5379518a9c56ef31d65cc7d) | 9 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 5 insertions, 4 deletions

| diff --git a/security/keys/trusted-keys/trusted\_dcp.c b/security/keys/trusted-keys/trusted\_dcp.cindex 4edc5bbbcda3c9..e908c53a803c4b 100644--- a/[security/keys/trusted-keys/trusted\_dcp.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/security/keys/trusted-keys/trusted_dcp.c?id=e828b870ea9c0f39e0940ea92a3a9dbf2af8146d)+++ b/[security/keys/trusted-keys/trusted\_dcp.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/security/keys/trusted-keys/trusted_dcp.c?id=c75e0272289eae18c5379518a9c56ef31d65cc7d)@@ -133,6 +133,7 @@ static int do\_aead\_crypto(u8 \*in, u8 \*out, size\_t len, u8 \*key, u8 \*nonce, struct scatterlist src\_sg, dst\_sg; struct crypto\_aead \*aead; int ret;+ DECLARE\_CRYPTO\_WAIT(wait);  aead = crypto\_alloc\_aead("gcm(aes)", 0, CRYPTO\_ALG\_ASYNC); if (IS\_ERR(aead)) {@@ -163,8 +164,8 @@ static int do\_aead\_crypto(u8 \*in, u8 \*out, size\_t len, u8 \*key, u8 \*nonce, }  aead\_request\_set\_crypt(aead\_req, &src\_sg, &dst\_sg, len, nonce);- aead\_request\_set\_callback(aead\_req, CRYPTO\_TFM\_REQ\_MAY\_SLEEP, NULL,- NULL);+ aead\_request\_set\_callback(aead\_req, CRYPTO\_TFM\_REQ\_MAY\_SLEEP,+ crypto\_req\_done, &wait); aead\_request\_set\_ad(aead\_req, 0);  if (crypto\_aead\_setkey(aead, key, AES\_KEYSIZE\_128)) {@@ -174,9 +175,9 @@ static int do\_aead\_crypto(u8 \*in, u8 \*out, size\_t len, u8 \*key, u8 \*nonce, }  if (do\_encrypt)- ret = crypto\_aead\_encrypt(aead\_req);+ ret = crypto\_wait\_req(crypto\_aead\_encrypt(aead\_req), &wait); else- ret = crypto\_aead\_decrypt(aead\_req);+ ret = crypto\_wait\_req(crypto\_aead\_decrypt(aead\_req), &wait);  free\_req: aead\_request\_free(aead\_req); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 20:33:18 +0000


