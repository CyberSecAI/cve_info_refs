=== Content from git.kernel.org_be08427e_20250114_214638.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=def3dee25cbd1c9b2ed443c3f6180e952563de77)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=def3dee25cbd1c9b2ed443c3f6180e952563de77)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=def3dee25cbd1c9b2ed443c3f6180e952563de77)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=def3dee25cbd1c9b2ed443c3f6180e952563de77)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Suraj Gupta <suraj.gupta2@amd.com> | 2024-10-30 11:55:32 +0530 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-11-14 13:20:59 +0100 |
| commit | [def3dee25cbd1c9b2ed443c3f6180e952563de77](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=def3dee25cbd1c9b2ed443c3f6180e952563de77) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=def3dee25cbd1c9b2ed443c3f6180e952563de77)) | |
| tree | [910bb18becb1407efb8daeabd5a4b58d44cee55d](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=def3dee25cbd1c9b2ed443c3f6180e952563de77) | |
| parent | [7eb923f8d4819737c07d6a8d0daef0a4d7f99e0c](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=7eb923f8d4819737c07d6a8d0daef0a4d7f99e0c) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=def3dee25cbd1c9b2ed443c3f6180e952563de77&id2=7eb923f8d4819737c07d6a8d0daef0a4d7f99e0c)) | |
| download | [linux-def3dee25cbd1c9b2ed443c3f6180e952563de77.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-def3dee25cbd1c9b2ed443c3f6180e952563de77.tar.gz) | |

net: xilinx: axienet: Enqueue Tx packets in dql before dmaengine starts[ Upstream commit 5ccdcdf186aec6b9111845fd37e1757e9b413e2f ]
Enqueue packets in dql after dma engine starts causes race condition.
Tx transfer starts once dma engine is started and may execute dql dequeue
in completion before it gets queued. It results in following kernel crash
while running iperf stress test:
kernel BUG at lib/dynamic\_queue\_limits.c:99!
<snip>
Internal error: Oops - BUG: 00000000f2000800 [#1] SMP
pc : dql\_completed+0x238/0x248
lr : dql\_completed+0x3c/0x248
Call trace:
dql\_completed+0x238/0x248
axienet\_dma\_tx\_cb+0xa0/0x170
xilinx\_dma\_do\_tasklet+0xdc/0x290
tasklet\_action\_common+0xf8/0x11c
tasklet\_action+0x30/0x3c
handle\_softirqs+0xf8/0x230
<snip>
Start dmaengine after enqueue in dql fixes the crash.
Fixes: 6a91b846af85 ("net: axienet: Introduce dmaengine support")
Signed-off-by: Suraj Gupta <suraj.gupta2@amd.com>
Link: [https://patch.msgid.link/20241030062533.2527042-2-suraj.gupta2@amd.com](https://patch.msgid.link/20241030062533.2527042-2-suraj.gupta2%40amd.com)
Signed-off-by: Jakub Kicinski <kuba@kernel.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=def3dee25cbd1c9b2ed443c3f6180e952563de77)

| -rw-r--r-- | [drivers/net/ethernet/xilinx/xilinx\_axienet\_main.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/ethernet/xilinx/xilinx_axienet_main.c?id=def3dee25cbd1c9b2ed443c3f6180e952563de77) | 4 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 2 insertions, 2 deletions

| diff --git a/drivers/net/ethernet/xilinx/xilinx\_axienet\_main.c b/drivers/net/ethernet/xilinx/xilinx\_axienet\_main.cindex 0c4c57e7fddc2c..877f190e3af4e6 100644--- a/[drivers/net/ethernet/xilinx/xilinx\_axienet\_main.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/xilinx/xilinx_axienet_main.c?id=7eb923f8d4819737c07d6a8d0daef0a4d7f99e0c)+++ b/[drivers/net/ethernet/xilinx/xilinx\_axienet\_main.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/xilinx/xilinx_axienet_main.c?id=def3dee25cbd1c9b2ed443c3f6180e952563de77)@@ -862,13 +862,13 @@ axienet\_start\_xmit\_dmaengine(struct sk\_buff \*skb, struct net\_device \*ndev) skbuf\_dma->sg\_len = sg\_len; dma\_tx\_desc->callback\_param = lp; dma\_tx\_desc->callback\_result = axienet\_dma\_tx\_cb;- dmaengine\_submit(dma\_tx\_desc);- dma\_async\_issue\_pending(lp->tx\_chan); txq = skb\_get\_tx\_queue(lp->ndev, skb); netdev\_tx\_sent\_queue(txq, skb->len); netif\_txq\_maybe\_stop(txq, CIRC\_SPACE(lp->tx\_ring\_head, lp->tx\_ring\_tail, TX\_BD\_NUM\_MAX), MAX\_SKB\_FRAGS + 1, 2 \* MAX\_SKB\_FRAGS); + dmaengine\_submit(dma\_tx\_desc);+ dma\_async\_issue\_pending(lp->tx\_chan); return NETDEV\_TX\_OK;  xmit\_error\_unmap\_sg: |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 21:45:15 +0000



=== Content from git.kernel.org_fadd3a9f_20250114_214637.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=5ccdcdf186aec6b9111845fd37e1757e9b413e2f)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=5ccdcdf186aec6b9111845fd37e1757e9b413e2f)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=5ccdcdf186aec6b9111845fd37e1757e9b413e2f)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=5ccdcdf186aec6b9111845fd37e1757e9b413e2f)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Suraj Gupta <suraj.gupta2@amd.com> | 2024-10-30 11:55:32 +0530 |
| --- | --- | --- |
| committer | Jakub Kicinski <kuba@kernel.org> | 2024-11-03 14:35:11 -0800 |
| commit | [5ccdcdf186aec6b9111845fd37e1757e9b413e2f](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=5ccdcdf186aec6b9111845fd37e1757e9b413e2f) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=5ccdcdf186aec6b9111845fd37e1757e9b413e2f)) | |
| tree | [de7620a5759b73ab845e4c20ef9260f91dea3c5a](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=5ccdcdf186aec6b9111845fd37e1757e9b413e2f) | |
| parent | [be31ec5c8efa69f4970e4554c1b760ac8ea3e543](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=be31ec5c8efa69f4970e4554c1b760ac8ea3e543) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=5ccdcdf186aec6b9111845fd37e1757e9b413e2f&id2=be31ec5c8efa69f4970e4554c1b760ac8ea3e543)) | |
| download | [linux-5ccdcdf186aec6b9111845fd37e1757e9b413e2f.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-5ccdcdf186aec6b9111845fd37e1757e9b413e2f.tar.gz) | |

net: xilinx: axienet: Enqueue Tx packets in dql before dmaengine startsEnqueue packets in dql after dma engine starts causes race condition.
Tx transfer starts once dma engine is started and may execute dql dequeue
in completion before it gets queued. It results in following kernel crash
while running iperf stress test:
kernel BUG at lib/dynamic\_queue\_limits.c:99!
<snip>
Internal error: Oops - BUG: 00000000f2000800 [#1] SMP
pc : dql\_completed+0x238/0x248
lr : dql\_completed+0x3c/0x248
Call trace:
dql\_completed+0x238/0x248
axienet\_dma\_tx\_cb+0xa0/0x170
xilinx\_dma\_do\_tasklet+0xdc/0x290
tasklet\_action\_common+0xf8/0x11c
tasklet\_action+0x30/0x3c
handle\_softirqs+0xf8/0x230
<snip>
Start dmaengine after enqueue in dql fixes the crash.
Fixes: 6a91b846af85 ("net: axienet: Introduce dmaengine support")
Signed-off-by: Suraj Gupta <suraj.gupta2@amd.com>
Link: [https://patch.msgid.link/20241030062533.2527042-2-suraj.gupta2@amd.com](https://patch.msgid.link/20241030062533.2527042-2-suraj.gupta2%40amd.com)
Signed-off-by: Jakub Kicinski <kuba@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=5ccdcdf186aec6b9111845fd37e1757e9b413e2f)

| -rw-r--r-- | [drivers/net/ethernet/xilinx/xilinx\_axienet\_main.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/ethernet/xilinx/xilinx_axienet_main.c?id=5ccdcdf186aec6b9111845fd37e1757e9b413e2f) | 4 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 2 insertions, 2 deletions

| diff --git a/drivers/net/ethernet/xilinx/xilinx\_axienet\_main.c b/drivers/net/ethernet/xilinx/xilinx\_axienet\_main.cindex d940853acc0b63..1fcbcaa85ebdb4 100644--- a/[drivers/net/ethernet/xilinx/xilinx\_axienet\_main.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/xilinx/xilinx_axienet_main.c?id=be31ec5c8efa69f4970e4554c1b760ac8ea3e543)+++ b/[drivers/net/ethernet/xilinx/xilinx\_axienet\_main.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/xilinx/xilinx_axienet_main.c?id=5ccdcdf186aec6b9111845fd37e1757e9b413e2f)@@ -924,13 +924,13 @@ axienet\_start\_xmit\_dmaengine(struct sk\_buff \*skb, struct net\_device \*ndev) skbuf\_dma->sg\_len = sg\_len; dma\_tx\_desc->callback\_param = lp; dma\_tx\_desc->callback\_result = axienet\_dma\_tx\_cb;- dmaengine\_submit(dma\_tx\_desc);- dma\_async\_issue\_pending(lp->tx\_chan); txq = skb\_get\_tx\_queue(lp->ndev, skb); netdev\_tx\_sent\_queue(txq, skb->len); netif\_txq\_maybe\_stop(txq, CIRC\_SPACE(lp->tx\_ring\_head, lp->tx\_ring\_tail, TX\_BD\_NUM\_MAX), MAX\_SKB\_FRAGS + 1, 2 \* MAX\_SKB\_FRAGS); + dmaengine\_submit(dma\_tx\_desc);+ dma\_async\_issue\_pending(lp->tx\_chan); return NETDEV\_TX\_OK;  xmit\_error\_unmap\_sg: |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 21:45:14 +0000


